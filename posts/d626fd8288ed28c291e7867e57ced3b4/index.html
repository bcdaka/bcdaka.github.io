<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt使用sqlite数据库及项目实战 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d626fd8288ed28c291e7867e57ced3b4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Qt使用sqlite数据库及项目实战">
  <meta property="og:description" content="一.sqlite使用介绍 在Qt中使用SQLite数据库非常简单，SQLite是一个轻量级的嵌入式数据库，不需要单独的数据库服务器，完全使用本地文件来存储数据。
当在Qt中使用SQLite数据库时，需要涉及到一些SQL语句以及Qt中的相关函数，接下来我将从头开始介绍所有涉及的语句以及相应的解释。
1. 连接到数据库：addDatabase 在Qt中，你可以使用QSqlDatabase来连接数据库。首先需要添加数据库类型，然后指定数据库的名称：
QSqlDatabase db = QSqlDatabase::addDatabase(&#34;QSQLITE&#34;); db.setDatabaseName(&#34;mydatabase.db&#34;); if(!db.open()) { qDebug() &lt;&lt; &#34;无法连接到数据库&#34;; return; } 在这段代码中，我们首先创建了一个名为mydatabase.db的SQLite数据库，然后通过open()函数来打开数据库连接。如果连接失败，将会输出错误信息。
2. 创建表：CREATE TABLE 一般来说，你需要在数据库中创建表来存储数据。这可以通过执行CREATE TABLE语句来实现：
QSqlQuery query; query.exec(&#34;CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)&#34;); 这里我们使用exec()函数执行SQL语句，创建了一个名为users的表，包含id、name和age三个列。
3. 插入数据：INSERT 当需要在表中插入新的数据时，可以使用SQL的INSERT INTO语句。在Qt中，可以使用QSqlQuery对象的prepare()和bindValue()函数来执行预处理插入语句：
常规的数据库插入语句 INSERT into users(id,name,age)VALUES(111,&#34;name&#34;,12) Qt中 QString name = &#34;Alice&#34;; int age = 25; QSqlQuery query; query.prepare(&#34;INSERT INTO users (name, age) VALUES (:name, :age)&#34;); query.bindValue(&#34;:name&#34;, name); query.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-05T11:44:37+08:00">
    <meta property="article:modified_time" content="2024-07-05T11:44:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt使用sqlite数据库及项目实战</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="sqlite_0"></a>一.sqlite使用介绍</h2> 
<p>在Qt中使用SQLite数据库非常简单，SQLite是一个轻量级的嵌入式数据库，不需要单独的数据库服务器，完全使用本地文件来存储数据。</p> 
<p>当在Qt中使用SQLite数据库时，需要涉及到一些SQL语句以及Qt中的相关函数，接下来我将从头开始介绍所有涉及的语句以及相应的解释。</p> 
<h3><a id="1_addDatabase_5"></a>1. <strong>连接到数据库：addDatabase</strong></h3> 
<p>在Qt中，你可以使用QSqlDatabase来连接数据库。首先需要添加数据库类型，然后指定数据库的名称：</p> 
<pre><code class="prism language-cpp">QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QSQLITE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"mydatabase.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"无法连接到数据库"</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这段代码中，我们首先创建了一个名为mydatabase.db的SQLite数据库，然后通过open()函数来打开数据库连接。如果连接失败，将会输出错误信息。</p> 
<h3><a id="2_CREATE_TABLE_19"></a>2. <strong>创建表：CREATE TABLE</strong></h3> 
<p>一般来说，你需要在数据库中创建表来存储数据。这可以通过执行CREATE TABLE语句来实现：</p> 
<pre><code class="prism language-cpp">QSqlQuery query<span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们使用exec()函数执行SQL语句，创建了一个名为users的表，包含id、name和age三个列。</p> 
<h3><a id="3_INSERT_29"></a>3. <strong>插入数据：INSERT</strong></h3> 
<p>当需要在表中插入新的数据时，可以使用SQL的INSERT INTO语句。在Qt中，可以使用QSqlQuery对象的prepare()和bindValue()函数来执行预处理插入语句：</p> 
<ul><li>常规的数据库插入语句</li></ul> 
<pre><code class="prism language-cpp">INSERT into <span class="token function">users</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token function">VALUES</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>Qt中</li></ul> 
<pre><code class="prism language-cpp">QString name <span class="token operator">=</span> <span class="token string">"Alice"</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
QSqlQuery query<span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO users (name, age) VALUES (:name, :age)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":name"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":age"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"插入数据失败："</span> <span class="token operator">&lt;&lt;</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>prepare和bindValue函数介绍</strong></li></ul> 
<p>当在Qt中进行数据库操作时，使用query.prepare()和query.bindValue()方法可以帮助你执行预处理SQL语句并绑定参数的值。这两个方法在插入操作中起到了重要作用，下面我将详细介绍它们的功能和作用：</p> 
<ol><li><strong>query.prepare()：</strong></li></ol> 
<p>在Qt中，query.prepare()方法用于准备要执行的SQL语句。它的主要作用是将SQL语句中的参数部分用占位符（如:variable）代替，从而形成一个预处理的SQL语句。通过这种方式，可以避免SQL注入攻击，并提高程序的安全性。</p> 
<p>例如，在插入操作中，你可能会使用INSERT INTO table_name (column1, column2, …) VALUES (:value1, :value2, …)这样的SQL语句，其中的:value1、:value2是占位符，用于将实际的数值动态地填充进去。使用query.prepare()方法可以将这个SQL语句准备好，等待绑定参数值。</p> 
<ol start="2"><li><strong>query.bindValue()：</strong></li></ol> 
<p>一旦调用了query.prepare()方法准备好了SQL语句，接下来就可以使用query.bindValue()方法为每个占位符绑定具体的数值。这个方法的作用是设置预处理语句中的占位符的值，从而将真实的数据插入到SQL语句中。</p> 
<p>例如，在前面的插入操作示例中，我们对name和age这两个占位符使用了query.bindValue()方法，将实际的name和age变量的值绑定到了这两个占位符上。</p> 
<p>使用query.bindValue()方法可以方便地将变量的值插入到SQL语句中，同时还可以防止数据类型转换错误和SQL注入攻击。</p> 
<p>综上所述，query.prepare()方法用于准备预处理SQL语句，并替换其中的占位符，而query.bindValue()方法则用于将实际的数值绑定到这些占位符上，从而完成对数据库的插入操作。这两个方法的结合使用可以简化代码编写，同时提高程序的安全性和可维护性。</p> 
<h3><a id="4_SELECT_69"></a>4. <strong>查询数据：SELECT</strong></h3> 
<p>查询数据最常见的方式是使用SELECT语句。在Qt中，我们可以通过exec()函数执行SELECT语句，并使用next()函数来逐行获取结果：</p> 
<pre><code class="prism language-cpp">QSqlQuery query<span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QString name <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> age <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ID:"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">" Name:"</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" Age:"</span> <span class="token operator">&lt;&lt;</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这段代码遍历了users表中的所有行，并输出每一行的ID、名称和年龄。</p> 
<ul><li><strong>query.next介绍</strong></li></ul> 
<p>在Qt中，query.next()方法用于遍历查询结果集中的下一行数据。当执行SELECT查询语句并通过exec()方法获取结果集后，可以使用query.next()方法逐行访问查询结果中的数据。</p> 
<p>每次调用query.next()方法，会将查询结果集中的指针移到下一行数据。如果存在下一行数据，则该方法返回true，并允许获取下一行数据；如果不存在下一行数据，则返回false，表示已经遍历完所有结果。</p> 
<p>一般来说，可以在一个循环中使用query.next()方法来遍历整个查询结果集，逐行获取数据并进行相应的处理。在循环中，通常会结合query.value()方法用于获取特定列的值。</p> 
<h3><a id="5_UPDATE_92"></a>5. <strong>更新数据:UPDATE</strong></h3> 
<p>在 Qt 中使用 SQLite 实现更新（修改）数据库操作可以通过执行 SQL UPDATE 语句来实现。下面是一个简单的示例代码，演示了如何使用 Qt 和 SQLite 执行更新操作：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QCoreApplication&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQuery&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlError&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    QCoreApplication <span class="token function">app</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 连接到SQLite数据库</span>
    QSqlDatabase db <span class="token operator">=</span> <span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QSQLITE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"database.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指定SQLite数据库文件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Error: Unable to connect to database."</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 执行 UPDATE 操作</span>
    QSqlQuery query<span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"UPDATE student SET name = :newName WHERE id = :id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":newName"</span><span class="token punctuation">,</span> <span class="token string">"New Name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置要更新的新名称</span>
    query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":id"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置要更新的记录的 ID</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Update successful"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Update failed:"</span> <span class="token operator">&lt;&lt;</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_DELETE_128"></a>6. <strong>删除数据：DELETE</strong></h3> 
<p>使用 QSqlQuery 类删除数据：</p> 
<pre><code class="prism language-cpp">QSqlQuery query<span class="token punctuation">;</span>
query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM your_table WHERE condition = :condition"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置删除语句</span>
query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":condition"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 绑定条件值</span>
<span class="token keyword">bool</span> success <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行删除操作</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 删除成功</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 删除失败，处理错误</span>
    <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Error:"</span> <span class="token operator">&lt;&lt;</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7_submitAll_143"></a>7. <strong>更新数据库中的数据:submitAll</strong></h3> 
<ul><li>这是对模型进行了修改，将数据提交回数据库中，以保持同步。</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">// 创建 QSqlTableModel 并设置数据库表</span>
    QSqlTableModel model<span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">setTable</span><span class="token punctuation">(</span><span class="token string">"student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从数据库中选择数据</span>

    <span class="token comment">// 创建 QTableView 并设置模型</span>
    QTableView tableView<span class="token punctuation">;</span>
    tableView<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一个按钮，当点击时提交更新</span>
    QPushButton <span class="token function">updateButton</span><span class="token punctuation">(</span><span class="token string">"Update Database"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">QObject</span><span class="token double-colon punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>updateButton<span class="token punctuation">,</span> <span class="token operator">&amp;</span>QPushButton<span class="token double-colon punctuation">::</span>clicked<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>model<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>model<span class="token punctuation">.</span><span class="token function">submitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Database update successful"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Database update failed:"</span> <span class="token operator">&lt;&lt;</span> model<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>model.submitAll介绍</li></ul> 
<p>QSqlTableModel 中的 submitAll() 函数是用于将对模型数据的更改提交到数据库中的方法。当您在 QTableView 中对数据进行了修改、插入或删除等操作后，调用 submitAll() 函数可将这些更改应用到数据库中。</p> 
<p>submitAll() 函数会执行以下操作：</p> 
<ol><li>检查模型中的每一行，如果该行的状态为 Inserted、Deleted 或 Modified，则将对应的更改提交到数据库中。</li><li>如果提交成功，会返回 true；如果提交失败，会返回 false。您可以通过检查返回值来确定提交是否成功。</li><li>如果提交失败，您可以调用 model.lastError().text() 来获取详细的错误信息。这将返回一个描述在提交过程中发生的错误的字符串。</li></ol> 
<p>在模型视图的结构中，对model是临时修改数据的中转站。</p> 
<h3><a id="8_QSqlQueryModel_179"></a>8. <strong>更新QSqlQueryModel中的数据</strong></h3> 
<p>QSqlQueryModel 是一个只读模型，无法直接编辑数据，因此更新数据的方式不同于可编辑的模型，比如 QSqlTableModel。如果您想要更新 QSqlQueryModel 中的数据，可以重新执行查询语句或者重新设置查询。</p> 
<p>以下是更新 QSqlQueryModel 中数据的一种常见方法：</p> 
<ol><li>重新执行查询语句：您可以重新设置 QSqlQueryModel 的查询语句，然后调用 setQuery() 方法重新执行查询。这将重新从数据库中读取数据并更新模型中的数据。</li></ol> 
<pre><code class="prism language-cpp">QSqlQueryModel model<span class="token punctuation">;</span>
model<span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM your_table"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>使用 clear() 方法清空数据：如果需要清空 QSqlQueryModel 中的数据，您可以调用 clear() 方法。清空数据后，您可以重新设置查询或数据源，从而实现更新。</li></ol> 
<pre><code class="prism language-cpp">model<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>需要注意的是，QSqlQueryModel 是一个只读模型，不支持直接编辑数据，如果您需要在界面上进行编辑和更新操作，可以考虑使用 QSqlTableModel 或自定义的 QAbstractTableModel。</p> 
<h3><a id="9__197"></a>9. 对指定列进行排序</h3> 
<ul><li>这是对模型进行排序</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">// 创建 QSqlQueryModel 并设置查询语句</span>
QSqlQueryModel <span class="token operator">*</span>queryModel <span class="token operator">=</span> <span class="token keyword">new</span> QSqlQueryModel<span class="token punctuation">;</span>
queryModel<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM your_table"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 QSortFilterProxyModel 并设置源模型为 QSqlQueryModel</span>
QSortFilterProxyModel <span class="token operator">*</span>sortModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSortFilterProxyModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sortModel<span class="token operator">-&gt;</span><span class="token function">setSourceModel</span><span class="token punctuation">(</span>queryModel<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置排序的列索引</span>
<span class="token keyword">int</span> sortColumn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 假设要按第1列排序</span>
sortModel<span class="token operator">-&gt;</span><span class="token function">sort</span><span class="token punctuation">(</span>sortColumn<span class="token punctuation">,</span> Qt<span class="token double-colon punctuation">::</span>AscendingOrder<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进行升序排序</span>

<span class="token comment">// 将排序后的模型设置给视图</span>
yourTableView<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>sortModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>对数据库进行排序</li></ul> 
<pre><code class="prism language-cpp"><span class="token operator">--</span> 以id列的升序方式进行排序
SELECT id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age
FROM your_table
ORDER BY id ASC<span class="token punctuation">;</span>

SELECT id <span class="token punctuation">,</span>name <span class="token punctuation">,</span>score  FROM student ORDER BY id DESC

<span class="token comment">//对模型中的数据进行排序</span>
model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT id, name, score FROM student ORDER BY id DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_228"></a>二.成绩管理系统实战</h2> 
<h3><a id="1__229"></a>1. 项目效果</h3> 
<p><img src="https://images2.imgbox.com/5b/1a/TQV3xku8_o.png" alt="在这里插入图片描述"></p> 
<ul><li>项目说明：底层存储数据用的是sqlite,界面展示数据用的是tableView和QSqlQueryModel的视图模型模式。</li></ul> 
<h3><a id="2__235"></a>2. 项目源码：</h3> 
<ul><li>类定义</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">STUDENTDLG_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STUDENTDLG_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDialog&gt;</span></span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlDatabase&gt;</span> <span class="token comment">// 专用于连接、创建数据库</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQuery&gt;</span> <span class="token comment">// 专用于DML（数据操纵语言）、DDL（数据定义语言）</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlQueryModel&gt;</span><span class="token comment">//数据库模型，用来和tableview关联</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QSqlError&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QMessageBox&gt;</span></span>



QT_BEGIN_NAMESPACE
<span class="token keyword">namespace</span> Ui <span class="token punctuation">{<!-- --></span> <span class="token keyword">class</span> <span class="token class-name">StudentDlg</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
QT_END_NAMESPACE

<span class="token keyword">class</span> <span class="token class-name">StudentDlg</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QDialog</span></span>
<span class="token punctuation">{<!-- --></span>
    Q_OBJECT

<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">StudentDlg</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">StudentDlg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> slots<span class="token operator">:</span>
    <span class="token keyword">void</span> <span class="token function">on_pushButtonSort_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButton_INSERT_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButton_DELETE_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButton_UPDATE_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">on_pushButton_SEARCH_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span> 
    <span class="token keyword">void</span> <span class="token function">CreateDatabaseFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建SQLite数据库</span>
    <span class="token keyword">void</span> <span class="token function">CreateTableFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 创建SQLite数据表</span>
    <span class="token keyword">void</span> <span class="token function">QueryTableFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 执行查询操作</span>

    QSqlDatabase sqldb<span class="token punctuation">;</span>         <span class="token comment">// 创建Qt和数据库链接</span>

    QSqlQueryModel <span class="token operator">*</span>model<span class="token operator">=</span><span class="token keyword">nullptr</span><span class="token punctuation">;</span><span class="token comment">//用来存储数据</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    Ui<span class="token double-colon punctuation">::</span>StudentDlg <span class="token operator">*</span>ui<span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// STUDENTDLG_H</span></span>

</code></pre> 
<ul><li>类实现</li></ul> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"studentdlg.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ui_studentdlg.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;QSortFilterProxyModel&gt;</span></span>

<span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">StudentDlg</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QDialog</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token function">ui</span><span class="token punctuation">(</span><span class="token keyword">new</span> Ui<span class="token double-colon punctuation">::</span>StudentDlg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ui<span class="token operator">-&gt;</span><span class="token function">setupUi</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用函数创建且打开数据库</span>
    <span class="token function">CreateDatabaseFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用函数创建数据表</span>
    <span class="token function">CreateTableFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">StudentDlg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">delete</span> ui<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">CreateDatabaseFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 创建SQLite数据库</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1：添加数据库驱动</span>
    sqldb<span class="token operator">=</span><span class="token class-name">QSqlDatabase</span><span class="token double-colon punctuation">::</span><span class="token function">addDatabase</span><span class="token punctuation">(</span><span class="token string">"QSQLITE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2：设置数据库名称</span>
    sqldb<span class="token punctuation">.</span><span class="token function">setDatabaseName</span><span class="token punctuation">(</span><span class="token string">"studentmis.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3：打开此数据库是否成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>sqldb<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"正确"</span><span class="token punctuation">,</span><span class="token string">"恭喜你，数据库打开成功！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"错误"</span><span class="token punctuation">,</span><span class="token string">"数据库打开失败，请重新检测！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">CreateTableFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     <span class="token comment">// 创建SQLite数据表</span>
<span class="token punctuation">{<!-- --></span>
    QSqlQuery createquery<span class="token punctuation">;</span>

    <span class="token comment">// 创建SQL语句</span>
    QString strsql<span class="token operator">=</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"CREATE TABLE IF NOT EXISTS student("</span>
                           <span class="token string">"id int primary key not null,"</span>
                           <span class="token string">"name text not null,"</span>
                           <span class="token string">"score real not null)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 执行SQL语句</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>createquery<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>strsql<span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"失败"</span><span class="token punctuation">,</span><span class="token string">"数据表创建失败，请重新检查！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"成功"</span><span class="token punctuation">,</span><span class="token string">"恭喜你，数据表创建成功！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 准备数据模型</span>
    model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QSqlQueryModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT id, name, score FROM student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行查询</span>

    <span class="token comment">// 将数据模型与QTableView绑定</span>
    <span class="token comment">//QTableView *tableView = new QTableView();</span>
    ui<span class="token operator">-&gt;</span> tableView<span class="token operator">-&gt;</span><span class="token function">setModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">resizeColumnsToContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调整列宽度使数据能够完全显示</span>

    <span class="token comment">// 显示QTableView</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">QueryTableFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">// 执行查询操作</span>
<span class="token punctuation">{<!-- --></span>
    QSqlQuery query<span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM users"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QString name <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> score <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ID:"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">" Name:"</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" Score:"</span> <span class="token operator">&lt;&lt;</span> score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButtonSort_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

<span class="token comment">//    QSortFilterProxyModel *sortModel = new QSortFilterProxyModel(this);</span>
<span class="token comment">//    sortModel-&gt;setSourceModel(model);</span>

<span class="token comment">//    // 设置排序的列索引</span>
<span class="token comment">//    int sortColumn = 1; // 假设要按第1列排序</span>
<span class="token comment">//    sortModel-&gt;sort(sortColumn, Qt::DescendingOrder); // 进行升序排序</span>

<span class="token comment">//    // 将排序后的模型设置给视图</span>
<span class="token comment">//    ui-&gt;tableView-&gt;setModel(sortModel);</span>

<span class="token comment">//    //使用sql语句进行操作</span>
<span class="token comment">//    QSqlQuery query;</span>
<span class="token comment">//    query.exec("SELECT id ,name ,score  FROM student ORDER BY id DESC");</span>


    <span class="token comment">//更新数据库中的数据</span>
    model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT id, name, score FROM student ORDER BY id DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//model-&gt;setQuery("SELECT * FROM student");</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_INSERT_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QSqlQuery sqlquery<span class="token punctuation">;</span>
    <span class="token keyword">int</span> id<span class="token operator">=</span>ui<span class="token operator">-&gt;</span>lineEdit_ID<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"失败"</span><span class="token punctuation">,</span><span class="token string">"提示：输入错误？学号不能为0？"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    QString name<span class="token operator">=</span>ui<span class="token operator">-&gt;</span>lineEdit_NAME<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"失败"</span><span class="token punctuation">,</span><span class="token string">"提示：输入错误？姓名不能为空？"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">double</span> score<span class="token operator">=</span>ui<span class="token operator">-&gt;</span>lineEdit_SCORE<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>score<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">||</span> score<span class="token operator">&gt;</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"失败"</span><span class="token punctuation">,</span><span class="token string">"提示：输入错误？分数范围(0-100)？"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    QString strs<span class="token operator">=</span><span class="token function">QString</span><span class="token punctuation">(</span><span class="token string">"insert into student "</span>
                         <span class="token string">"values(%1,'%2',%3)"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>sqlquery<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">critical</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"失败"</span><span class="token punctuation">,</span><span class="token string">"向数据表插入记录失败，请重新检查！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QMessageBox</span><span class="token double-colon punctuation">::</span><span class="token function">information</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"成功"</span><span class="token punctuation">,</span><span class="token string">"恭喜你，向数据表插入记录成功！"</span><span class="token punctuation">,</span>QMessageBox<span class="token double-colon punctuation">::</span>Ok<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_DELETE_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> ui<span class="token operator">-&gt;</span>lineEdit_ID<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    QSqlQuery query<span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"DELETE FROM student WHERE id = :id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置删除语句</span>
    query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":id"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 绑定条件值</span>
    <span class="token keyword">bool</span> success <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 执行删除操作</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 删除成功</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 删除失败，处理错误</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Error:"</span> <span class="token operator">&lt;&lt;</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新数据库中的数据</span>
    model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_UPDATE_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 执行 UPDATE 操作</span>
       QString New_Name<span class="token operator">=</span>ui<span class="token operator">-&gt;</span>lineEdit_NAME<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">int</span> id<span class="token operator">=</span>ui<span class="token operator">-&gt;</span>lineEdit_ID<span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       QSqlQuery query<span class="token punctuation">;</span>
       query<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token string">"UPDATE student SET name = :newName WHERE id = :id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":newName"</span><span class="token punctuation">,</span> New_Name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置要更新的新名称</span>
       query<span class="token punctuation">.</span><span class="token function">bindValue</span><span class="token punctuation">(</span><span class="token string">":id"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置要更新的记录的 ID</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Update successful"</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
           <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"Update failed:"</span> <span class="token operator">&lt;&lt;</span> query<span class="token punctuation">.</span><span class="token function">lastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">StudentDlg</span><span class="token double-colon punctuation">::</span><span class="token function">on_pushButton_SEARCH_clicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    QSqlQuery query<span class="token punctuation">;</span>
    query<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QString name <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> score <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"ID:"</span> <span class="token operator">&lt;&lt;</span> id <span class="token operator">&lt;&lt;</span> <span class="token string">" Name:"</span> <span class="token operator">&lt;&lt;</span> name <span class="token operator">&lt;&lt;</span> <span class="token string">" Score:"</span> <span class="token operator">&lt;&lt;</span> score<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新数据库中的数据</span>
    model<span class="token operator">-&gt;</span><span class="token function">setQuery</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ui<span class="token operator">-&gt;</span>tableView<span class="token operator">-&gt;</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2b213e9bbaba2b566056a9b92dfbe235/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux系统部署MongoDB开源文档型数据库并实现无公网IP远程访问</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39ffa4f921c6077d54f43a25b7d24758/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3使用pinia中的actions，需要调用接口的话</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>