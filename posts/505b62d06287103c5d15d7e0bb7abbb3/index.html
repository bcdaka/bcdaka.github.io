<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable Diffusion【插件篇】：使用After Detailer实现人脸修复 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/505b62d06287103c5d15d7e0bb7abbb3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Stable Diffusion【插件篇】：使用After Detailer实现人脸修复">
  <meta property="og:description" content="大家好，我是程序员晓晓。
在使用SD绘图的时候，默认的分辨率大小是512*512，这样设置的好处是出图效率高。但是如果涉及到人全身照的时候，经常会出现一个问题：脸部崩。主要原因是在一个比较低的像素画布上，绘制一个全身图，脸部能分配到的像素不够了。我们来看一下效果。
一. 使用高分辨率修复
上面图片的提示词：tunning female model, full body,seaside landscape, rocky cliffs, clear blue sky, white sand, flowing white dress, sunlight streaming through hair, captivating eyes, high level of detail, masterpiece（提示词中包含有full body，目的就是出一个全身图）。
我们尝试采用高分辨率修复看一下效果。
为了保证图片的一致，我们保持随机数种子一致。
点击生成按钮，效果如下：
即使使用了高清修复，我们发现脸部还是有些拉胯。可见即使使用高分辨率修复，一方面生成的图片分辨率发生了变化，另一方面生成图片效果并不是特别理想。
那么有没有办法在分辨率为512*512人物全身照的情况下正常展示人脸呢，这个就是我们今天要介绍的插件：After Detailer。
今天我们演示使用的是LibLibAI, 在LiblibAI里面集成了After Detailer插件，在这里也介绍一下After Detail插件的安装方法。
二. After Detailer插件的安装
插件地址：https://github.com/Bing-su/adetailer.git
如果无法下载，请看文末直接获取哦
我们也可以将安装包拷贝到对应的/…/stable-diffusion-webui/extensions/目录下面。
安装完成后，重启SD Web UI即可。
三. After Detailer插件的介绍
After Detailer插件的主界面如下。
After Detailer插件支持多通道，可以同时开多个单元，比如在一张照片中同时修复脸部和手部。
After Detailer启用：在使用的时候需要选中开启。
After Detailer模型：
After Detailer插件支持修复脸部、手部、和全身。但是就目前使用情况来看，修复脸部效果最好，堪称完美，修复手部和全身效果还不是太好，需要继续完善功能。
上面是常用的一些模型，如果有些模型没有的话，可以在huggingface网站进行下载：https://huggingface.co/Bingsu/adetailer/tree/main。
（如果无法下载，请看文末直接获取哦）
提示词：修复脸部、手部、全身用到的正向、负面提示词，只描述需要修复的部分即可。可以和文生图的提示词不一致。默认可以不输入。
检测/蒙版/重绘：
这些参数的设置和人脸修复的实现机制有关系。人脸修复的原理大致如下：首先，需要准备一张进行人脸修复的原始图像。插件程序会定位原始图像中人脸的中心，并确定脸部的遮罩范围。然后，在遮罩范围内增加一些噪点，并将其输入局部重绘模块，重新绘制脸部的遮罩范围。也就是说，脸部修复涉及到脸部检测、遮罩生成以及局部重绘这三个步骤。分别对应上面检测、蒙版、重绘参数设置。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-29T16:27:17+08:00">
    <meta property="article:modified_time" content="2024-01-29T16:27:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable Diffusion【插件篇】：使用After Detailer实现人脸修复</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>大家好，我是程序员晓晓。</p> 
<p>在使用SD绘图的时候，默认的分辨率大小是512*512，这样设置的好处是出图效率高。但是如果涉及到人全身照的时候，经常会出现一个问题：脸部崩。主要原因是在一个比较低的像素画布上，绘制一个全身图，脸部能分配到的像素不够了。我们来看一下效果。</p> 
<p><img src="https://images2.imgbox.com/c1/38/PnQ6MNEi_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/ef/6a/keoM7DcU_o.png" alt=""></p> 
<p><strong>一. 使用高分辨率修复</strong></p> 
<p>上面图片的提示词：tunning female model, full body,seaside landscape, rocky cliffs, clear blue sky, white sand, flowing white dress, sunlight streaming through hair, captivating eyes, high level of detail, masterpiece（提示词中包含有full body，目的就是出一个全身图）。</p> 
<p><img src="https://images2.imgbox.com/2e/96/puERbCoE_o.png" alt=""></p> 
<p>我们尝试采用高分辨率修复看一下效果。</p> 
<p><img src="https://images2.imgbox.com/58/52/U3ZWoCqf_o.png" alt=""></p> 
<p>为了保证图片的一致，我们保持随机数种子一致。</p> 
<p><img src="https://images2.imgbox.com/2e/9f/puvkUJnY_o.png" alt=""></p> 
<p>点击生成按钮，效果如下：</p> 
<p><img src="https://images2.imgbox.com/9a/07/DQCWEBhp_o.png" alt=""></p> 
<p>即使使用了高清修复，我们发现脸部还是有些拉胯。可见即使使用高分辨率修复，一方面生成的图片分辨率发生了变化，另一方面生成图片效果并不是特别理想。</p> 
<p>那么有没有办法在分辨率为512*512人物全身照的情况下正常展示人脸呢，这个就是我们今天要介绍的插件：After Detailer。</p> 
<p>今天我们演示使用的是LibLibAI, 在LiblibAI里面集成了After Detailer插件，在这里也介绍一下After Detail插件的安装方法。</p> 
<p><strong>二. After Detailer插件的安装</strong></p> 
<blockquote> 
 <p>插件地址：https://github.com/Bing-su/adetailer.git<br> 如果无法下载，请看文末直接获取哦</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/3d/cb/GB0nH0PL_o.png" alt=""></p> 
<p>我们也可以将安装包拷贝到对应的/…/stable-diffusion-webui/extensions/目录下面。</p> 
<p>安装完成后，重启SD Web UI即可。</p> 
<p><strong>三. After Detailer插件的介绍</strong></p> 
<p>After Detailer插件的主界面如下。</p> 
<p><img src="https://images2.imgbox.com/e8/fb/3OGTOBuT_o.png" alt=""></p> 
<p>After Detailer插件支持多通道，可以同时开多个单元，比如在一张照片中同时修复脸部和手部。</p> 
<p><strong>After Detailer启用</strong>：在使用的时候需要选中开启。</p> 
<p><strong>After Detailer模型</strong>：</p> 
<p><img src="https://images2.imgbox.com/dc/a3/JGjux0U3_o.png" alt=""></p> 
<p>After Detailer插件支持修复脸部、手部、和全身。但是就目前使用情况来看，修复脸部效果最好，堪称完美，修复手部和全身效果还不是太好，需要继续完善功能。</p> 
<p>上面是常用的一些模型，如果有些模型没有的话，可以在huggingface网站进行下载：https://huggingface.co/Bingsu/adetailer/tree/main。<br> （如果无法下载，请看文末直接获取哦）</p> 
<p><img src="https://images2.imgbox.com/21/59/aIyJhuHa_o.png" alt=""></p> 
<p><strong>提示词</strong>：修复脸部、手部、全身用到的正向、负面提示词，只描述需要修复的部分即可。可以和文生图的提示词不一致。默认可以不输入。</p> 
<p><strong>检测/蒙版/重绘：</strong></p> 
<p><img src="https://images2.imgbox.com/ee/dc/4x2ydlna_o.png" alt=""></p> 
<p>这些参数的设置和人脸修复的实现机制有关系。人脸修复的原理大致如下：首先，需要准备一张进行人脸修复的原始图像。插件程序会定位原始图像中人脸的中心，并确定脸部的遮罩范围。然后，在遮罩范围内增加一些噪点，并将其输入局部重绘模块，重新绘制脸部的遮罩范围。也就是说，脸部修复涉及到脸部检测、遮罩生成以及局部重绘这三个步骤。分别对应上面检测、蒙版、重绘参数设置。</p> 
<p>目前默认的参数值适用于大部分的场景，大家直接使用默认值参数的即可，无需做太多的参数调整。这里就不展开说明了。</p> 
<p><strong>四. After Detailer插件的使用</strong></p> 
<p>继续以上面的例子，先看看如何使用After Detail插件修复脸部。</p> 
<p>我们选择开启After Detailer插件，同时模型选择mediapipe_face_full。为了便于查看使用After Detailer插件的效果，这里我们将面部修复和高分辨率修复关闭掉。其他的参数设置维持不变。</p> 
<p><img src="https://images2.imgbox.com/4b/c8/y7nsxemD_o.png" alt=""></p> 
<p>最终生成的图片效果如下。一张美女的脸效果非常好。</p> 
<p><img src="https://images2.imgbox.com/85/97/YiTFEkaj_o.png" alt=""></p> 
<p>我们可以在正向提示词框中输入人物表情，比如: smile(微笑)。</p> 
<p><img src="https://images2.imgbox.com/e3/37/VbPFsf5j_o.png" alt=""></p> 
<p>我们看一下生成图片的效果。</p> 
<p><img src="https://images2.imgbox.com/a8/9c/pT8hHsoT_o.png" alt=""></p> 
<p>下面我们看一下一张图片中2张人脸崩的问题是否也可以修复。</p> 
<p>我们生成一张图片中2张人脸崩的图片。</p> 
<p>提示词：(female model wearing flowing white dress and male model:1.5), full body, looking at viewer,seaside landscape, rocky cliffs, clear blue sky, white sand, high level of detail, masterpiece</p> 
<p>大模型：ChilloutMix_Chilloutmix-Ni-pruned-fp32-fix.safetensors</p> 
<p>生成图片效果如下：</p> 
<p><img src="https://images2.imgbox.com/8e/c0/Od99ywCC_o.png" alt=""></p> 
<p>我们选择开启After Detailer插件，同时模型选择mediapipe_face_full。</p> 
<p>最终生成的图片效果如下：</p> 
<p><img src="https://images2.imgbox.com/61/48/JkbSQS9e_o.png" alt=""></p> 
<p>一张照片中有2张脸的修复效果也还不错。</p> 
<h3><a id="_115"></a>写在最后</h3> 
<p><font face="幼圆" size="4" color="red">感兴趣的小伙伴，赠送全套AIGC学习资料，包含AI绘画、AI人工智能等前沿科技教程和软件工具，具体看这里。<br> </font><br> <img src="https://images2.imgbox.com/71/52/SDgUExAk_o.png"></p> 
<p>AIGC技术的未来发展前景广阔，随着人工智能技术的不断发展，AIGC技术也将不断提高。未来，AIGC技术将在游戏和计算领域得到更广泛的应用，使游戏和计算系统具有更高效、更智能、更灵活的特性。同时，AIGC技术也将与人工智能技术紧密结合，在更多的领域得到广泛应用，对程序员来说影响至关重要。未来，AIGC技术将继续得到提高，同时也将与人工智能技术紧密结合，在更多的领域得到广泛应用。<br>  <br> <img src="https://images2.imgbox.com/2b/ff/5Of4EJUj_o.png" alt="在这里插入图片描述"></p> 
<p><strong>一、AIGC所有方向的学习路线</strong></p> 
<p>AIGC所有方向的技术点做的整理，形成各个领域的知识点汇总，它的用处就在于，你可以按照下面的知识点去找对应的学习资源，保证自己学得较为全面。</p> 
<p><img src="https://images2.imgbox.com/c1/af/4HkPCiqY_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/23/67/qQ9w38DO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>二、AIGC必备工具</strong></p> 
<p>工具都帮大家整理好了，安装就可直接上手！<br> <img src="https://images2.imgbox.com/07/ec/xoKUQKms_o.png" alt="在这里插入图片描述"></p> 
<p><strong>三、最新AIGC学习笔记</strong></p> 
<p>当我学到一定基础，有自己的理解能力的时候，会去阅读一些前辈整理的书籍或者手写的笔记资料，这些笔记详细记载了他们对一些技术点的理解，这些理解是比较独到，可以学到不一样的思路。<br> <img src="https://images2.imgbox.com/40/b1/FmyB28aH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/06/f1/8tQMNjyj_o.png" alt="在这里插入图片描述"></p> 
<p><strong>四、AIGC视频教程合集</strong></p> 
<p>观看全面零基础学习视频，看视频学习是最快捷也是最有效果的方式，跟着视频中老师的思路，从基础到深入，还是很容易入门的。</p> 
<p><img src="https://images2.imgbox.com/e9/33/YE4zBUjy_o.png" alt="在这里插入图片描述"></p> 
<p><strong>五、实战案例</strong></p> 
<p>纸上得来终觉浅，要学会跟着视频一起敲，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。<br> <img src="https://images2.imgbox.com/30/58/36QXEp8q_o.png" alt="在这里插入图片描述"></p> 
<img src="https://images2.imgbox.com/5a/96/giwL7EJt_o.png"> 若有侵权，请联系删除
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b0c4a9681c5fe8436c4f8352ad472e1d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端qrcode生成二维码详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/52c27cf94a4fcb0d415c7e50cd7f0162/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android MediaCodec 简明教程（四）：使用 MediaCodec 将视频解码到 Surface，并使用 SurfaceView 播放视频</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>