<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux中hive启动异常，最详细解决方法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6b4f7c6a54938421b3e5d93fa6edfc97/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="linux中hive启动异常，最详细解决方法">
  <meta property="og:description" content="报错结果如下： Casue by:Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient
Casue by:javax.jdo.JDOFatalDataStoreException: Unable to open a test connection to the given database. JDBC url = jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true, username = hive. Terminating connection pool (set lazyInit to true if you expect to start your database after your app). Original Exception: ------
com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure
Casue by:javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate)
原因分析： 寻找了许多资料后发现是以下问题
1、hdfs安全模式未退出 首先检查hdfs是否进入了安全模式，如果先前有过hive异常退出，就是没有关闭hive然后强制关闭计算机的情况，那么就有可能使得hdfs中的文件产生异常错误，通过关闭安全模式就可以正常进入hive。
开启安全模式 hdfs dfsadmin -safemode enter 关闭安全模式 hdfs dfsadmin -safemode leave 获取安全模式的状态 hdfs dfsadmin -safemode get 等待安全模式关闭 hdfs dfsadmin -safemode wait 查看受损模块 hdfs fsck / -delete 如果处于关闭状态后还是无法启动报错，那么就是以下第二种问题。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-27T11:48:30+08:00">
    <meta property="article:modified_time" content="2023-11-27T11:48:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux中hive启动异常，最详细解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3> 报错结果如下：</h3> 
<blockquote> 
 <p><span style="color:#fe2c24;">Casue by:</span>Unable to instantiate org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</p> 
 <p></p> 
 <p><span style="color:#fe2c24;">Casue by:</span>javax.jdo.JDOFatalDataStoreException: Unable to open a test connection to the given database. JDBC url = jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true, username = hive. Terminating connection pool (set lazyInit to true if you expect to start your database after your app). Original Exception: ------<br> com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</p> 
 <p></p> 
 <p><span style="color:#fe2c24;">Casue by:</span>javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate)</p> 
</blockquote> 
<h3> 原因分析：</h3> 
<p>寻找了许多资料后发现是以下问题</p> 
<h4>1、hdfs安全模式未退出</h4> 
<p>首先检查hdfs是否进入了安全模式，如果先前有过hive异常退出，就是没有关闭hive然后强制关闭计算机的情况，那么就有可能使得hdfs中的文件产生异常错误，通过关闭安全模式就可以正常进入hive。</p> 
<pre><code>开启安全模式
hdfs dfsadmin -safemode enter
关闭安全模式
hdfs dfsadmin -safemode leave
获取安全模式的状态
hdfs dfsadmin -safemode get
等待安全模式关闭
hdfs dfsadmin -safemode wait
查看受损模块
hdfs fsck / -delete</code></pre> 
<p><img alt="" height="42" src="https://images2.imgbox.com/6d/22/AUfvGH1x_o.png" width="692"></p> 
<p>如果处于关闭状态后还是无法启动报错，那么就是以下第二种问题。</p> 
<h4> 2、java调用ssl启动hive导致出现异常(最麻烦）</h4> 
<p>在Java8及高版本以上的版本在调用<a href="https://so.csdn.net/so/search?q=ssl&amp;spm=1001.2101.3001.7020" title="ssl">ssl</a>时会出现javax.net.ssl.SSLHandshakeException: No appropriate protocol的异常</p> 
<p>解决方法如下：</p> 
<ul><li>修改jre/lib/security/java.security中的disabledAlgorithms，删除SSLv3, TLSv1, TLSv1.1。</li></ul> 
<blockquote> 
 <p>jdk.tls.disabledAlgorithms=RC4, DES, MD5withRSA, \<br>     DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, \<br>     include jdk.disabled.namedCurves</p> 
</blockquote> 
<p> 这里比较麻烦因为linux默认保护这里的程序因此需要先将文件的权限进行改写，才可以修改保存，指令如下：</p> 
<blockquote> 
 <p>cd java.sercurity所在的目录</p> 
 <p>进入该目录后输入</p> 
 <p>sudo chmod 777 java.security </p> 
</blockquote> 
<p> 以下为修改后的结果<img alt="" height="237" src="https://images2.imgbox.com/5e/02/tiGskEs1_o.png" width="778"></p> 
<p>然后就可以打开该文件完成修改了</p> 
<p>修改前：</p> 
<p> <img alt="" height="212" src="https://images2.imgbox.com/de/89/PSiHBZnO_o.png" width="752"></p> 
<p>修改后：</p> 
<p> <img alt="" height="291" src="https://images2.imgbox.com/0f/a8/q2slG27f_o.png" width="752"></p> 
<ul><li>将conf/hive-site.xml中的内容更换为：</li></ul> 
<pre><code class="language-XML">&lt;property&gt;
    &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
    &lt;value&gt;jdbc:mysql://localhost:3306/hive?createDatabaseIfNotExist=true&amp;amp;useSSL=false&lt;/value&gt;
    &lt;description&gt;JDBC connect string for a JDBC metastore&lt;/description&gt;
&lt;/property&gt;</code></pre> 
<p> 然后就可以正常启动了。</p> 
<p>别忘记修改回去文件的权限，以免后续出现什么问题。</p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/ec/23/KlGOLBMr_o.png" width="880"> </p> 
<h4>3、数据库服务没有打开</h4> 
<p>通常来说，在系统启动之后数据库服务就会自动打开，但是不排除意外。</p> 
<p>这里以mysql数据库举例，可以使用以下指令检查数据库服务是否启动正常</p> 
<blockquote> 
 <p>service mysql status 检查状态</p> 
 <p>service mysql start</p> 
 <p>service mysql stop</p> 
 <p>service mysql restart 重启服务</p> 
</blockquote> 
<p> 如果是绿灯就表示正常了<img alt="" height="308" src="https://images2.imgbox.com/ca/4e/uZxMLg7g_o.png" width="935"></p> 
<p>问题解决hive启动成功了</p> 
<p><img alt="" height="250" src="https://images2.imgbox.com/3f/cb/zBDeI8de_o.png" width="1200"></p> 
<p></p> 
<p>最后最好每次都关闭hdfs集群再关机，不然很可能出现异常错误。</p> 
<blockquote> 
 <p>./sbin/stop-dfs.sh</p> 
</blockquote> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71c4e16bdbc834da7f208f6300c618bb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端将blob转换为可下载的url及下载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3ac2243cd53258b9a3c83dfea44d3af3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最火前端可视化Web组态软件工具</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>