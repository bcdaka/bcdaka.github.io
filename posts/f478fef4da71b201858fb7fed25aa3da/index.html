<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>有关Java读取Modbus协议连接PLC的示例（使用modbus4j） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f478fef4da71b201858fb7fed25aa3da/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="有关Java读取Modbus协议连接PLC的示例（使用modbus4j）">
  <meta property="og:description" content="有关Java读取Modbus协议的Tcp/RTU示例（使用modbus4j） 我最近碰到一个项目，获取数据来方式很多，其中一种便是Modbus协议。这个协议分为Modbus-Tcp和Modbus-RTU两种，我是这么简单理解这个协议的，主要用于信息的采集与下发，而且信息的获取和下发需要对应硬件的物理地址。
下面先讲一下一些实用的知识点，看完之后说不定你就不用开发了。
Modbus-TCP
使用的是RJ45网口通讯，可以在连接网络交互设备通过ip获取Modbus-RTU
使用485串口通信，只能通过串口连接电脑， 网上也有卖集成485串口的类似交换机的东西，可以去某宝搜索一下。还可以把串口的Modbus协议转换为ModbusTCP协议，并实现双向通信，即可以获取数据，也可以下发指令。甚至可以把数据发送到消息队列中。价格也不是很贵，如果允许买一个能减轻不少工作量，甚至不用再读下去了。但是有些设备可能无法下发，买之前要问清楚。
我使用的modbus服务是下面这款西门子的PLC，开启Modbus-TCP和Modbus-RTU均需要往里面写程序才可以，这部分不是我做的所以我不做阐述。
下面直接上Modbus-TCP和ModbusRTU的数据获取与下发代码，如果有用请点赞哦！
modubus4j Github地址 https://github.com/MangoAutomation/modbus4j
Modbus-TCP Maven依赖 &lt;dependency&gt; &lt;groupId&gt;com.infiniteautomation&lt;/groupId&gt; &lt;artifactId&gt;modbus4j&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;/dependency&gt; Java代码 import com.serotonin.modbus4j.ModbusFactory; import com.serotonin.modbus4j.ModbusMaster; import com.serotonin.modbus4j.code.DataType; import com.serotonin.modbus4j.exception.ErrorResponseException; import com.serotonin.modbus4j.exception.ModbusInitException; import com.serotonin.modbus4j.exception.ModbusTransportException; import com.serotonin.modbus4j.ip.IpParameters; import com.serotonin.modbus4j.locator.BaseLocator; import com.serotonin.modbus4j.locator.StringLocator; import com.serotonin.modbus4j.msg.*; public static void main(String[] args) throws ModbusInitException, ModbusTransportException, ErrorResponseException { IpParameters ipParameters = new IpParameters(); ipParameters.setHost(&#34;192.168.2.1&#34;); // Modbus-Tcp所在Ip地址 ipParameters.setPort(502); // 502为默认端口 ModbusFactory modbusFactory = new ModbusFactory(); ModbusMaster modbusMaster = modbusFactory.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-11T15:22:58+08:00">
    <meta property="article:modified_time" content="2024-05-11T15:22:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">有关Java读取Modbus协议连接PLC的示例（使用modbus4j）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="JavaModbusTcpRTUmodbus4j_0"></a>有关Java读取Modbus协议的Tcp/RTU示例（使用modbus4j）</h2> 
<p>我最近碰到一个项目，获取数据来方式很多，其中一种便是Modbus协议。这个协议分为Modbus-Tcp和Modbus-RTU两种，我是这么简单理解这个协议的，主要用于信息的采集与下发，而且信息的获取和下发需要对应硬件的物理地址。</p> 
<p>下面先讲一下一些实用的知识点，看完之后说不定你就不用开发了。</p> 
<ul><li>Modbus-TCP<br> 使用的是RJ45网口通讯，可以在连接网络交互设备通过ip获取</li><li>Modbus-RTU<br> 使用485串口通信，只能通过串口连接电脑，</li></ul> 
<p>网上也有卖集成485串口的类似交换机的东西，可以去某宝搜索一下。还可以把串口的Modbus协议转换为ModbusTCP协议，并实现双向通信，即可以获取数据，也可以下发指令。甚至可以把数据发送到消息队列中。价格也不是很贵，如果允许买一个能减轻不少工作量，甚至不用再读下去了。但是有些设备可能无法下发，买之前要问清楚。</p> 
<p>我使用的modbus服务是下面这款西门子的PLC，开启Modbus-TCP和Modbus-RTU均需要往里面写程序才可以，这部分不是我做的所以我不做阐述。<br> <img src="https://images2.imgbox.com/44/80/rbUiXzrI_o.png" alt="请添加图片描述"></p> 
<p>下面直接上Modbus-TCP和ModbusRTU的数据获取与下发代码，如果有用请点赞哦！</p> 
<h3><a id="modubus4j_Github_17"></a>modubus4j Github地址</h3> 
<p><a href="https://github.com/MangoAutomation/modbus4j">https://github.com/MangoAutomation/modbus4j</a></p> 
<h3><a id="ModbusTCP_19"></a>Modbus-TCP</h3> 
<ul><li>Maven依赖</li></ul> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.infiniteautomation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>modbus4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>Java代码</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span></span><span class="token class-name">ModbusFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span></span><span class="token class-name">ModbusMaster</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>code<span class="token punctuation">.</span></span><span class="token class-name">DataType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ErrorResponseException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ModbusInitException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ModbusTransportException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>ip<span class="token punctuation">.</span></span><span class="token class-name">IpParameters</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>locator<span class="token punctuation">.</span></span><span class="token class-name">BaseLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>locator<span class="token punctuation">.</span></span><span class="token class-name">StringLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>msg<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ModbusInitException</span><span class="token punctuation">,</span> <span class="token class-name">ModbusTransportException</span><span class="token punctuation">,</span> <span class="token class-name">ErrorResponseException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">IpParameters</span> ipParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IpParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ipParameters<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.2.1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Modbus-Tcp所在Ip地址</span>
	ipParameters<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">502</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 502为默认端口</span>
	<span class="token class-name">ModbusFactory</span> modbusFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModbusFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ModbusMaster</span> modbusMaster <span class="token operator">=</span> modbusFactory<span class="token punctuation">.</span><span class="token function">createTcpMaster</span><span class="token punctuation">(</span>ipParameters<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	modbusMaster<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// slaveId设备id， 所在位置</span>
	<span class="token keyword">int</span> slaveId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> offset <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
	<span class="token comment">// 读保持寄存器</span>
	<span class="token class-name">BaseLocator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">&gt;</span></span> holdingRegister <span class="token operator">=</span> <span class="token class-name">BaseLocator</span><span class="token punctuation">.</span><span class="token function">holdingRegister</span><span class="token punctuation">(</span>slaveId<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">.</span><span class="token constant">TWO_BYTE_INT_UNSIGNED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Number</span> value <span class="token operator">=</span> modbusMaster<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>holdingRegister<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"value:"</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 写</span>
	<span class="token keyword">int</span> vlaue2 <span class="token operator">=</span> <span class="token number">210</span><span class="token punctuation">;</span>
	<span class="token class-name">WriteRegisterRequest</span> registerRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WriteRegisterRequest</span><span class="token punctuation">(</span>slaveId<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> vlaue2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">WriteRegisterResponse</span> registerResponse <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WriteRegisterResponse</span><span class="token punctuation">)</span> modbusMaster<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>registerRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">!</span>registerResponse<span class="token punctuation">.</span><span class="token function">isException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 再读看看写进去没</span>
	value <span class="token operator">=</span> modbusMaster<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>holdingRegister<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"value:"</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="PS_67"></a>PS：</h3> 
<p>如果你的Modbus-Tcp服务正常，这里你也可能会出现一些问题，这里只指出我碰见的。</p> 
<ul><li> <h4><a id="1__69"></a>问题1: 你拿到的数据不正确或者没有值。</h4> </li><li> <h5><a id="_70"></a>解决方法:</h5> </li><li> 
  <ul><li>1、Modbus服务中的地址位与你获取的地址位（代码中offset变量）在命名上有所不同，modbus中是以下标1开始的，而代码中是以0开始的所以你需要-1</li></ul> </li><li> 
  <ul><li>2、西门子的PLC地址位包涵了寄存器类型的位置，例如保持寄存器是以4开头的，第一位是40001，这时你的offset应该是1，因为modbus4j中是指定寄存器类型的。在源码的RegisterRange类中，已经写给你做了转换</li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">/*
 * ============================================================================
 * GNU General Public License
 * ============================================================================
 *
 * Copyright (C) 2006-2011 Serotonin Software Technologies Inc. http://serotoninsoftware.com
 * @author Matthew Lohbihler
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>code</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * &lt;p&gt;RegisterRange class.&lt;/p&gt;
 *
 * @author Matthew Lohbihler
 * @version 5.0.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegisterRange</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/** Constant &lt;code&gt;COIL_STATUS=1&lt;/code&gt; */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">COIL_STATUS</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">/** Constant &lt;code&gt;INPUT_STATUS=2&lt;/code&gt; */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">INPUT_STATUS</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token comment">/** Constant &lt;code&gt;HOLDING_REGISTER=3&lt;/code&gt; */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">HOLDING_REGISTER</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token comment">/** Constant &lt;code&gt;INPUT_REGISTER=4&lt;/code&gt; */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">INPUT_REGISTER</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * &lt;p&gt;getFrom.&lt;/p&gt;
     *
     * @param id a int.
     * @return a int.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getFrom</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token constant">COIL_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x10000</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">HOLDING_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x40000</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x30000</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * &lt;p&gt;getTo.&lt;/p&gt;
     *
     * @param id a int.
     * @return a int.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token constant">COIL_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0xffff</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x1ffff</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">HOLDING_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x4ffff</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0x3ffff</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * &lt;p&gt;getReadFunctionCode.&lt;/p&gt;
     *
     * @param id a int.
     * @return a int.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getReadFunctionCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token constant">COIL_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token class-name">FunctionCode</span><span class="token punctuation">.</span><span class="token constant">READ_COILS</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_STATUS</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token class-name">FunctionCode</span><span class="token punctuation">.</span><span class="token constant">READ_DISCRETE_INPUTS</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">HOLDING_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token class-name">FunctionCode</span><span class="token punctuation">.</span><span class="token constant">READ_HOLDING_REGISTERS</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">INPUT_REGISTER</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token class-name">FunctionCode</span><span class="token punctuation">.</span><span class="token constant">READ_INPUT_REGISTERS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li> 
  <ul><li>3、检查你下方代码中dataType传入的类型是否与存储的类型一样，如果你不知道可以试试使用不同的类型，看看哪个和你存储的数据相同，然后再改个数据，看看是否正确。<br> BaseLocator.holdingRegister(slaveId, offset, DataType.TWO_BYTE_INT_UNSIGNED);</li></ul> </li><li> 
  <ul><li>4、查看Modbus服务存储数据的寄存器是否与你读取代码中的寄存器类型相同</li></ul> </li></ul> 
<p>如果你要获取不同类型的寄存器数据，请点开上方的github中找到源码中的测试类，类面包涵了所有的。查看其他博主发的文章也有很多，我也是抄的，没必要看我的文章，方式也很简单基本相同。</p> 
<h3><a id="ModbusRTU_182"></a>Modbus-RTU</h3> 
<p>在使用RTU协议时，由于github上的示例代码重要区域注释写着<br> <img src="https://images2.imgbox.com/4d/15/nt8FrESC_o.png" alt="请添加图片描述"><br> 我只能呵呵了…<br> 由于大家都是BS开发者，谁**写过这玩意啊，这不是2000年就淘汰的玩意吗，我**。<br> 但是我弄好了（快夸我）<br> 直接上代码</p> 
<h3><a id="Maven_190"></a>Maven依赖</h3> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 串口通信--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fazecast<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jSerialComm<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fazecast<span class="token punctuation">.</span>jSerialComm<span class="token punctuation">.</span></span><span class="token class-name">SerialPort</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fazecast<span class="token punctuation">.</span>jSerialComm<span class="token punctuation">.</span></span><span class="token class-name">SerialPortDataListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fazecast<span class="token punctuation">.</span>jSerialComm<span class="token punctuation">.</span></span><span class="token class-name">SerialPortEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>serotonin<span class="token punctuation">.</span>modbus4j<span class="token punctuation">.</span>serial<span class="token punctuation">.</span></span><span class="token class-name">SerialPortWrapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">OutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerialPortWrapperImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SerialPortWrapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> commPortId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> baudRate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> flowControlIn<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> flowControlOut<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dataBits<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> stopBits<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> parity<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SerialPort</span> serialPort<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">SerialPortWrapperImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> commPortId<span class="token punctuation">,</span> <span class="token keyword">int</span> baudRate<span class="token punctuation">,</span> <span class="token keyword">int</span> flowControlIn<span class="token punctuation">,</span>
                                 <span class="token keyword">int</span> flowControlOut<span class="token punctuation">,</span> <span class="token keyword">int</span> dataBits<span class="token punctuation">,</span> <span class="token keyword">int</span> stopBits<span class="token punctuation">,</span> <span class="token keyword">int</span> parity<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>commPortId <span class="token operator">=</span> commPortId<span class="token punctuation">;</span>
        <span class="token comment">// 波特率</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>baudRate <span class="token operator">=</span> baudRate<span class="token punctuation">;</span>
        <span class="token comment">// 输入流timeout时长 不能超过100</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlIn <span class="token operator">=</span> flowControlIn<span class="token punctuation">;</span>
        <span class="token comment">// 输出流timeout时长</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlOut <span class="token operator">=</span> flowControlOut<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dataBits <span class="token operator">=</span> dataBits<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stopBits <span class="token operator">=</span> stopBits<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>parity <span class="token operator">=</span> parity<span class="token punctuation">;</span>

		<span class="token class-name">SerialPort</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ports <span class="token operator">=</span> <span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token function">getCommPorts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印可用串口的信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Available Ports:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SerialPort</span> port <span class="token operator">:</span> ports<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>port<span class="token punctuation">.</span><span class="token function">getSystemPortName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> port<span class="token punctuation">.</span><span class="token function">getPortDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 判断可用串口存在</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>port<span class="token punctuation">.</span><span class="token function">getSystemPortName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>commPortId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort <span class="token operator">=</span> port<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setComPortParameters</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baudRate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataBits<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stopBits<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setComPortTimeouts</span><span class="token punctuation">(</span><span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token constant">TIMEOUT_READ_BLOCKING</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlIn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setFlowControl</span><span class="token punctuation">(</span><span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token constant">FLOW_CONTROL_DISABLED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setComPortParameters</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baudRate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataBits<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stopBits<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setComPortTimeouts</span><span class="token punctuation">(</span><span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token constant">TIMEOUT_READ_BLOCKING</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlIn<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flowControlOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">setFlowControl</span><span class="token punctuation">(</span><span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token constant">FLOW_CONTROL_DISABLED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">closePort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Port close"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Prot close export"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>serialPort<span class="token punctuation">.</span><span class="token function">openPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Port opened successfully."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Unable to open the port."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

 <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">InputStream</span> <span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">InputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            out <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取输入流异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> out<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OutputStream</span> <span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            out <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serialPort<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取输出流异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> out<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getBaudRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baudRate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDataBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataBits<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStopBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stopBits<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getParity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>代码这里最复杂的也就在这里，其实也不复杂主要咱也没用过太冷门了<br> 然后查看链接的串口是多少<br> 我是Mac系统，进入dev执行ls -l tty* 可以查看</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /dev
<span class="token function">ls</span> <span class="token parameter variable">-l</span> tty*

<span class="token operator">&gt;</span> crw-rw-rw-  <span class="token number">1</span> root      wheel   0x2000000 May  <span class="token number">9</span> <span class="token number">18</span>:12 <span class="token function">tty</span>
<span class="token operator">&gt;</span> crw-rw-rw-  <span class="token number">1</span> root      wheel   0x9000002 May  <span class="token number">8</span> <span class="token number">16</span>:54 tty.Bluetooth- Incoming-Port
<span class="token operator">&gt;</span> crw-rw-rw-  <span class="token number">1</span> root      wheel   0x9000000 May  <span class="token number">8</span> <span class="token number">16</span>:54 tty.PowerbeatsPro
<span class="token operator">&gt;</span> crw-rw-rw-  <span class="token number">1</span> root      wheel   0x9000004 May <span class="token number">10</span> 08:54 tty.usbserial-1140
</code></pre> 
<p>下面还有很多没有关系的我就不在这里粘贴了，可以看到第一个是蓝牙，第二个是我的蓝牙耳机，第三个“tty.usbserial-1140”就是我的usb串口，拔掉再来一次就没有了，确定是他接下来写读取数据和写入数据的代码</p> 
<p>Windows系统的同志，请在设备管理中找到串口一般是COM*</p> 
<pre><code class="prism language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ModbusInitException</span><span class="token punctuation">,</span> <span class="token class-name">ModbusTransportException</span><span class="token punctuation">,</span> <span class="token class-name">ErrorResponseException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> commPortId <span class="token operator">=</span> <span class="token string">"tty.usbserial-1120"</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> baudRate <span class="token operator">=</span> <span class="token number">9600</span><span class="token punctuation">;</span>
        <span class="token comment">// 写入timeout 不能超过100</span>
        <span class="token keyword">int</span> flowControlIn <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出timeout</span>
        <span class="token keyword">int</span> flowControlOut <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dataBits <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> stopBits <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment">// 不校验</span>
        <span class="token keyword">int</span> parity <span class="token operator">=</span> <span class="token class-name">SerialPort</span><span class="token punctuation">.</span><span class="token constant">PARITY_NONE</span><span class="token punctuation">;</span>

		<span class="token comment">// 初始化并建立链接</span>
        <span class="token class-name">SerialPortWrapperImpl</span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SerialPortWrapperImpl</span><span class="token punctuation">(</span>commPortId<span class="token punctuation">,</span> baudRate<span class="token punctuation">,</span> flowControlIn<span class="token punctuation">,</span> flowControlOut<span class="token punctuation">,</span> dataBits<span class="token punctuation">,</span> stopBits<span class="token punctuation">,</span> parity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ModbusFactory</span> modbusFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModbusFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ModbusMaster</span> master <span class="token operator">=</span> modbusFactory<span class="token punctuation">.</span><span class="token function">createRtuMaster</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        master<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 获取数据</span>
        <span class="token class-name">BaseLocator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">&gt;</span></span> loc <span class="token operator">=</span> <span class="token class-name">BaseLocator</span><span class="token punctuation">.</span><span class="token function">holdingRegister</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token class-name">DataType</span><span class="token punctuation">.</span><span class="token constant">TWO_BYTE_INT_UNSIGNED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>master<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  		
  		<span class="token comment">// 写入数据</span>
        master<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>loc<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 再看看写进去了没有</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>master<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>loc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="PS_367"></a>PS：</h3> 
<p>好了，代码到这里就结束了，大家都成功了吗？</p> 
<p>成功的同学可以走了，别忘记点赞</p> 
<p>没成功的同学请留下，搞完这几招还没成功再走<br> 以下是我遇到的问题</p> 
<ul><li> <h4><a id="1__374"></a>问题1: 打开了串口当写入信息后就重连了</h4> </li><li> <h5><a id="_375"></a>解决方法:</h5> </li><li> 
  <ul><li>1、查看你的flowControlIn和flowControlOut是否是0，因为好多文档写着0。请改成稍高的数值。因为是timeout时间所以设置0他响应了你，你却不再接收了。</li></ul> </li><li> 
  <ul><li>2、检查你的波特率是和你设备设置的相同，虽然大部分是9600但是设备其实可以更改波特率，不同的波特率传输的物理长度不同，相同单位时间内可传输的信息量也不同。</li></ul> </li><li> 
  <ul><li>3、如果上面两个都无法解决你的问题，那么可能就不是代码的问题了。你需要找到你购买的串口转USB线，看看你的串口线是怎样定义的引脚。<br> <img src="https://images2.imgbox.com/e4/a2/LYamBs6l_o.png" alt="在这里插入图片描述"><br> 没错这里只需要T/R+和T/R-两根线。我**** ，有没搞错只要两根线。<br> 对的就是只要两个，然后你需要一个引接板，和两根杜邦线。按下图连接，我这里没有杜邦线,所以只能…<br> <img src="https://images2.imgbox.com/6c/2a/N7bmqctS_o.png" alt="在这里插入图片描述"></li></ul> </li><li> <h4><a id="2_CRC_384"></a>问题2: CRC校验错误</h4> </li><li> <h5><a id="_385"></a>解决方法:</h5> </li><li> 
  <ul><li>1、 是否开启了信息校验，我们这里设置的是不开启SerialPort.PARITY_NONE;，因为PLC是不开启的。</li></ul> </li><li> <h4><a id="3__387"></a>问题3: 数据与实际内容不符</h4> </li><li> <h5><a id="_388"></a>解决方法:</h5> </li><li> 
  <ul><li>1、请回顾TCP的解决方式</li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9bdb5995aedf715ffd35f9a46180f20e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI大模型系列之三：Swin Transformer 最强CV图解（深度好文）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/352fad96faebefb6fe8b5978ee87e91c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电子资源|基于SSM&#43;vue的电子资源管理系统(源码&#43;数据库&#43;文档)​</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>