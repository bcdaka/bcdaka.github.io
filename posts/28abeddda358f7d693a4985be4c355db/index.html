<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ONLYOFFICE8.0部署集成(vue&#43;java)并配置存储为minio - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/28abeddda358f7d693a4985be4c355db/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ONLYOFFICE8.0部署集成(vue&#43;java)并配置存储为minio">
  <meta property="og:description" content="文章目录 前言一、使用docker安装onlyoffice8安装使用DockerDesktop方式命令行方式使用 HTTPS 运行展示 二、项目集成前端集成-vue3html方式后端集成-java 三、onlyoffice基础原理四、配置存储为minio1.onlyoffice配置文件挂载问题2.配置存储为minio3.验证切换minio存储是否生效1.测试方式一2.测试方式二 前言 之前也写过一个关于onlyoffice的文章，在上一篇中介绍了onlyoffice7.2版本的安装、简单的集成、和社区版、企业版、开发者版本的差异。
文章地址：https://blog.csdn.net/qq_43548590/article/details/129948103
本次则记录onlyoffice8.1.0基础环境搭建&#43;Java&#43;Vue3的集成使用
一、使用docker安装onlyoffice8安装 我这里使用的是443端口为演示，不想弄证书的可以映射80端口。如果是80端口则不要放置证书否则会出问题！
官网地址
使用DockerDesktop方式 1.首先我们拉取docker镜像
2.等着镜像拉取完成，我们来启动它，点击右边的启动按钮
宿主机的目录或文件挂载到 Docker
我这里的挂载地址为
/Users/mac/Desktop/tools/docker/onlyoffice/documentServer/xxxx这里根据自己的地址选择
命令行方式 docker run -i -t -d -p 10086:80 --name=test-onlyoffice-8.0 --restart=always --privileged=true -v /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/logs:/var/log/onlyoffice -v /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/data:/var/www/onlyoffice/Data -v /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/postgresql:/var/lib/postgresql -v /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/lib:/var/lib/onlyoffice -e JWT_ENABLED=false onlyoffice/documentserver:8.0 10086端口是访问端口，10087端口是info端口，查看方式为http协议（http://ip:10087/info）
关于镜像的相关信息自行查看
使用 HTTPS 运行 可以使用 SSL 保护对 onlyoffice 应用程序的访问，以防止未经授权的访问。虽然 CA 认证的 SSL 证书允许通过 CA 验证信任，但自签名证书也可以提供同等级别的信任验证，只要每个客户端采取一些额外步骤来验证您网站的身份。
sudo docker run -i -t -d -p 443:443 --restart=always \ -v /app/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data -e JWT_ENABLED=false onlyoffice/documentserver 要通过 SSL 保护应用程序的安全，基本上需要做两件事：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-01T13:43:52+08:00">
    <meta property="article:modified_time" content="2024-08-01T13:43:52+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ONLYOFFICE8.0部署集成(vue&#43;java)并配置存储为minio</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#dockeronlyoffice8_11" rel="nofollow">一、使用docker安装onlyoffice8安装</a></li><li><ul><li><a href="#DockerDesktop_15" rel="nofollow">使用DockerDesktop方式</a></li><li><a href="#_26" rel="nofollow">命令行方式</a></li><li><a href="#_HTTPS__35" rel="nofollow">使用 HTTPS 运行</a></li><li><a href="#_61" rel="nofollow">展示</a></li></ul> 
  </li><li><a href="#_67" rel="nofollow">二、项目集成</a></li><li><ul><li><a href="#vue3_68" rel="nofollow">前端集成-vue3</a></li><li><a href="#html_145" rel="nofollow">html方式</a></li><li><a href="#java_240" rel="nofollow">后端集成-java</a></li></ul> 
  </li><li><a href="#onlyoffice_300" rel="nofollow">三、onlyoffice基础原理</a></li><li><a href="#minio_319" rel="nofollow">四、配置存储为minio</a></li><li><ul><li><a href="#1onlyoffice_320" rel="nofollow">1.onlyoffice配置文件挂载问题</a></li><li><a href="#2minio_328" rel="nofollow">2.配置存储为minio</a></li><li><a href="#3minio_391" rel="nofollow">3.验证切换minio存储是否生效</a></li><li><ul><li><a href="#1_395" rel="nofollow">1.测试方式一</a></li><li><a href="#2_407" rel="nofollow">2.测试方式二</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p>之前也写过一个关于onlyoffice的文章，在上一篇中介绍了onlyoffice7.2版本的安装、简单的集成、和社区版、企业版、开发者版本的差异。<br> 文章地址：<a href="https://blog.csdn.net/qq_43548590/article/details/129948103">https://blog.csdn.net/qq_43548590/article/details/129948103</a></p> 
<p>本次则记录onlyoffice8.1.0基础环境搭建+Java+Vue3的集成使用</p> 
<h2><a id="dockeronlyoffice8_11"></a>一、使用docker安装onlyoffice8安装</h2> 
<p><code>我这里使用的是443端口为演示，不想弄证书的可以映射80端口。如果是80端口则不要放置证书否则会出问题！</code></p> 
<p><a href="https://helpcenter.onlyoffice.com/installation/docs-community-install-docker.aspx" rel="nofollow">官网地址</a></p> 
<h3><a id="DockerDesktop_15"></a>使用DockerDesktop方式</h3> 
<p>1.首先我们拉取docker镜像<br> <img src="https://images2.imgbox.com/b9/7e/sDtomuWB_o.png" alt="在这里插入图片描述"></p> 
<p>2.等着镜像拉取完成，我们来启动它，点击右边的启动按钮<br> 宿主机的目录或文件挂载到 Docker<br> 我这里的挂载地址为<br> /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/xxxx这里根据自己的地址选择<br> <img src="https://images2.imgbox.com/6d/79/9FO6ylFS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_26"></a>命令行方式</h3> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">10086</span>:80 <span class="token parameter variable">--name</span><span class="token operator">=</span>test-onlyoffice-8.0  <span class="token parameter variable">--restart</span><span class="token operator">=</span>always  <span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token parameter variable">-v</span> /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/logs:/var/log/onlyoffice  <span class="token parameter variable">-v</span> /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/data:/var/www/onlyoffice/Data <span class="token parameter variable">-v</span> /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/postgresql:/var/lib/postgresql <span class="token parameter variable">-v</span> /Users/mac/Desktop/tools/docker/onlyoffice/documentServer/lib:/var/lib/onlyoffice   <span class="token parameter variable">-e</span> <span class="token assign-left variable">JWT_ENABLED</span><span class="token operator">=</span>false  onlyoffice/documentserver:8.0
</code></pre> 
<blockquote> 
 <p>10086端口是访问端口，10087端口是info端口，查看方式为http协议（http://ip:10087/info）<br> 关于镜像的相关信息自行查看</p> 
</blockquote> 
<h3><a id="_HTTPS__35"></a>使用 HTTPS 运行</h3> 
<p>可以使用 SSL 保护对 onlyoffice 应用程序的访问，以防止未经授权的访问。虽然 CA 认证的 SSL 证书允许通过 CA 验证信任，但自签名证书也可以提供同等级别的信任验证，只要每个客户端采取一些额外步骤来验证您网站的身份。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">443</span>:443 <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /app/onlyoffice/DocumentServer/data:/var/www/onlyoffice/Data <span class="token parameter variable">-e</span> <span class="token assign-left variable">JWT_ENABLED</span><span class="token operator">=</span>false onlyoffice/documentserver
</code></pre> 
<p>要通过 SSL 保护应用程序的安全，基本上需要做两件事：</p> 
<ul><li>私钥 (.key)</li><li>SSL 证书 (.crt)</li></ul> 
<p>我这里使用的是自建证书，不会的参考<a href="https://blog.csdn.net/qq_43548590/article/details/140514935">openssl自建证书</a></p> 
<p>上传证书到刚才挂载的地址data下<br> 地址为：/Users/mac/Desktop/tools/docker/onlyoffice/documentServer/data/certs</p> 
<p>上传证书至certs目录，命名为onlyoffice.crt、onlyoffice.key</p> 
<blockquote> 
 <p>网页打开证书不信任问题<br> 1.自建证书需要浏览器获取信任，方式自行百度<br> 2.内网环境可以使用nginx部署项目然后添加证书</p> 
</blockquote> 
<h3><a id="_61"></a>展示</h3> 
<p>到这里onlyoffice服务就搭建完成了</p> 
<p>访问：https://ip地址:10086即可<br> <img src="https://images2.imgbox.com/b7/71/PFshakMR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_67"></a>二、项目集成</h2> 
<h3><a id="vue3_68"></a>前端集成-vue3</h3> 
<p>这里使用的是vue3为示例代码</p> 
<p>官方示例：<a href="https://api.onlyoffice.com/editors/vue" rel="nofollow">https://api.onlyoffice.com/editors/vue</a><br> 官方配置文档：<a href="https://api.onlyoffice.com/editors/config/document" rel="nofollow">https://api.onlyoffice.com/editors/config/document</a><br> 中文文档地址：<a href="https://api.onlyoffice.com/zh/editors/basic" rel="nofollow">https://api.onlyoffice.com/zh/editors/basic</a></p> 
<p>下载包</p> 
<pre><code class="prism language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> @onlyoffice/document-editor-vue
</code></pre> 
<p>页面代码</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DocumentEditor</span>
      <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>docEditor<span class="token punctuation">"</span></span>
      <span class="token attr-name">documentServerUrl</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://ip:10086/<span class="token punctuation">"</span></span>
      <span class="token attr-name">:config</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>config<span class="token punctuation">"</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> DocumentEditor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@onlyoffice/document-editor-vue"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>reactive<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"documentType"</span><span class="token operator">:</span> <span class="token string">"word"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"document"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
     <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"【经营】通用合同模板.docx"</span><span class="token punctuation">,</span>
     <span class="token string-property property">"url"</span><span class="token operator">:</span> <span class="token string">"https://你的文件地址/demo.docx"</span><span class="token punctuation">,</span>
 
    <span class="token comment">// 当前用户对于当前文档的操作权限</span>
    <span class="token string-property property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"print"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string-property property">"download"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">//用户是否可以下载</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"fileType"</span><span class="token operator">:</span> <span class="token string">"docx"</span><span class="token punctuation">,</span><span class="token comment">//文件类型</span>
    <span class="token comment">//onlyoffice用key做文件缓存索引，推荐每次都随机生成一下，不然总是读取缓存</span>
    <span class="token string-property property">"key"</span><span class="token operator">:</span> <span class="token string">"e932e7bb1e4d44xxxxxx1xx8sxx18"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"editorConfig"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 编辑器常规配置</span>
    <span class="token string-property property">"customization"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 自动保存可以关闭，常规ctrl+s更好用</span>
      <span class="token string-property property">"autosave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"compactToolbar"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"forcesave"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"toolbarNoTabs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"help"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token string-property property">"compactHeader"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"hideRightMenu"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token string-property property">"logo"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//自定义logo配置</span>
        <span class="token string-property property">"image"</span><span class="token operator">:</span> <span class="token string">"xxxx"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"imageDark"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"url"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"visible"</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"mode"</span><span class="token operator">:</span> <span class="token string">"edit"</span><span class="token punctuation">,</span><span class="token comment">//view为只能浏览  edit为编辑</span>
    <span class="token comment">//这个回调及其的重要</span>
    <span class="token string-property property">"callbackUrl"</span><span class="token operator">:</span> <span class="token string">"http://192.168.1.94:8080/onlyoffice/callback"</span><span class="token punctuation">,</span>
    <span class="token comment">// 菜单显示语言</span>
    <span class="token string-property property">"lang"</span><span class="token operator">:</span> <span class="token string">"zh-CN"</span><span class="token punctuation">,</span>
    <span class="token comment">// 当前操作用户信息</span>
    <span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"superlu"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token string">"103"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">html,body,#app</span><span class="token punctuation">{<!-- --></span><span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span> 0px<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h3><a id="html_145"></a>html方式</h3> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"text/javascript"</span> <span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token string">"http://IP:10086/web-apps/apps/api/documents/api.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
        body <span class="token punctuation">{<!-- --></span>
            width: <span class="token number">100</span>%<span class="token punctuation">;</span>
            height: 90vh<span class="token punctuation">;</span>
            display: flex<span class="token punctuation">;</span>
            flex-direction: <span class="token function">column</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">#placeholder {<!-- --></span>
            width: <span class="token number">100</span>%<span class="token punctuation">;</span>
            height: 100vh<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token string">"placeholder"</span> <span class="token assign-left variable">class</span><span class="token operator">=</span><span class="token string">"nav"</span> <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">"width: 100%; height: 100vh;"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/div<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
 
    var onDocumentReady <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console.log<span class="token punctuation">(</span><span class="token string">"文档准备好了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 
    var config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"documentType"</span><span class="token builtin class-name">:</span> <span class="token string">"word"</span>,
        <span class="token string">"historyList"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"history"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
            <span class="token string">"currentVersion"</span><span class="token builtin class-name">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"document"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"【经营】通用合同模板.docx"</span>,
            <span class="token string">"url"</span><span class="token builtin class-name">:</span> <span class="token string">"https://文件地址/demo.docx"</span>,
            <span class="token string">"permissions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"print"</span><span class="token builtin class-name">:</span> false,
                <span class="token string">"download"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>,
            <span class="token string">"attachId"</span><span class="token builtin class-name">:</span> <span class="token string">"e932e7bb1e4d449aa9a7d8b403b4b517"</span>,
            <span class="token string">"fileType"</span><span class="token builtin class-name">:</span> <span class="token string">"docx"</span>,
            <span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"e932e7bb1e4d449aa9a7d8ss517"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"editorConfig"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"customization"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"autosave"</span><span class="token builtin class-name">:</span> false,
                <span class="token string">"compactToolbar"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"forcesave"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"toolbarNoTabs"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"help"</span><span class="token builtin class-name">:</span> false,
                <span class="token string">"compactHeader"</span><span class="token builtin class-name">:</span> true,
                <span class="token string">"hideRightMenu"</span><span class="token builtin class-name">:</span> true,
            <span class="token punctuation">}</span>,
            <span class="token string">"mode"</span><span class="token builtin class-name">:</span> <span class="token string">"edit"</span>,
            <span class="token string">"callbackUrl"</span><span class="token builtin class-name">:</span> <span class="token string">"https://回调地址"</span>,
            <span class="token string">"lang"</span><span class="token builtin class-name">:</span> <span class="token string">"zh-CN"</span>,
            <span class="token string">"user"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"superlu"</span>,
                <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token string">"103"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 
    var docEditor<span class="token punctuation">;</span>
    initDocEditor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
 
    /**
     * 初始化编辑器
     */
    <span class="token keyword">function</span> <span class="token function-name function">initDocEditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        // 初始化配置
        config<span class="token punctuation">[</span><span class="token string">'events'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            onDocumentReady: onDocumentReady
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        docEditor <span class="token operator">=</span> new DocsAPI.DocEditor<span class="token punctuation">(</span><span class="token string">"placeholder"</span>, config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
 
<span class="token operator">&lt;</span>/script<span class="token operator">&gt;</span>
 
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="java_240"></a>后端集成-java</h3> 
<p>官方也有Spring版本的示例：<a href="https://github.com/ONLYOFFICE/document-server-integration/releases/latest/download/Java.Spring.Example.zip">https://github.com/ONLYOFFICE/document-server-integration/releases/latest/download/Java.Spring.Example.zip</a></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>superlu<span class="token punctuation">.</span>onlyoffice<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jakarta<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/onlyoffice"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlyOfficeController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 回调
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/callback"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">useDelimiter</span><span class="token punctuation">(</span><span class="token string">"\\A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> body <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token class-name">JSONObject</span> jsonObj <span class="token operator">=</span> <span class="token class-name">JSONObject</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jsonObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> jsonObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> downloadUri <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> jsonObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>downloadUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>HttpURLConnection</span> connection <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">InputStream</span> stream <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> fileName <span class="token operator">=</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>lang<span class="token punctuation">.</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"_create."</span> <span class="token operator">+</span> jsonObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"filetype"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> templatePath <span class="token operator">=</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            templatePath <span class="token operator">+=</span> fileName<span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"文件保存地址："</span> <span class="token operator">+</span> templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">File</span> tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>templatePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> read<span class="token punctuation">;</span>
                <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>read <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> read<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            connection<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">"{\"error\":0}"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="onlyoffice_300"></a>三、onlyoffice基础原理</h2> 
<p>onlyoffice有：</p> 
<ul><li><a href="https://api.onlyoffice.com/editors/basic" rel="nofollow">DOCUMENT SERVER（文档服务器）</a></li><li><a href="https://api.onlyoffice.com/docbuilder/basic" rel="nofollow">DOCUMENT BUILDER（文档生成器）</a></li><li><a href="https://api.onlyoffice.com/editors/conversionapi" rel="nofollow">Conversion API（转化API）</a></li></ul> 
<p>1、DOCUMENT SERVER（文档服务器）<br> 用于web页面编辑office文件，也就是最最基础的功能。上面的实例就是DOCUMENT SERVER（文档服务器）<br> 2、DOCUMENT BUILDER（文档生成器）<br> 用于通过代码生成或者操作office文件，比如后端常用的：poi等框架，onlyoffice本身也提供了这个功能【进阶】<br> 3、Conversion API（转化API）<br> 部分公司业务上会需要对文件进行转化，onlyoffice也提供了这样的功能，比如word-&gt;html、word-&gt;pdf等等【进阶】</p> 
<p>DOCUMENT SERVER（文档服务器）前后端如何进行交互<br> <img src="https://images2.imgbox.com/f2/30/MT4PhC0y_o.png" alt="在这里插入图片描述"><br> 前端操作-&gt;onlyoffice-&gt;你的后端callback 如果你有做过微信之类的回调就会比较清晰，office服务器作为中介，用于处理前端与后端的连通。 除此之外，再无其他。</p> 
<h2><a id="minio_319"></a>四、配置存储为minio</h2> 
<h3><a id="1onlyoffice_320"></a>1.onlyoffice配置文件挂载问题</h3> 
<p>为了方便修改onlyoffice配置文件，想将配置也挂载出来，但是发现容器启动的时候/etc/onlyoffice/documentserver为空。所以自己想了个办法先启动一次容器。然后使用docker命令将/etc/onlyoffice/documentserver拷贝到宿主机然后删掉容器重新启动的时候挂载进去这样就可以了。</p> 
<p>官方配置文件的描述：<a href="https://helpcenter.onlyoffice.com/installation/docs-developer-configuring.aspx" rel="nofollow">https://helpcenter.onlyoffice.com/installation/docs-developer-configuring.aspx</a></p> 
<p>onlyoffice配置文件有如下这些：<br> <img src="https://images2.imgbox.com/7b/66/lFAsLABu_o.png" alt="在这里插入图片描述"><br> <code>请不要直接编辑default.json文件的内容。每次重新启动Docker容器或将ONLYOFFICE文档升级到新版本时，默认值都会恢复，并且所有更改都将丢失。</code></p> 
<h3><a id="2minio_328"></a>2.配置存储为minio</h3> 
<blockquote> 
 <p>为什么onlyoffice可以存储到minio：<code>onlyoffice</code>本身就支持<code>aws s3</code>，而<code>minio</code>本身又兼容<code>aws s3</code>。所以才会使用minio来做文件存储，目前onlyoffice仅支持<code>本地存储</code>和<code>aws s3</code>存储。</p> 
</blockquote> 
<p>不会搭建minio的可以看我的另外一篇博客：<a href="https://blog.csdn.net/qq_43548590/article/details/131889699">https://blog.csdn.net/qq_43548590/article/details/131889699</a></p> 
<p>storage参数信息如下：</p> 
<table><thead><tr><th>参数</th><th>描述</th><th>类型</th><th>默认值</th></tr></thead><tbody><tr><td>storage.name</td><td>定义文档存储服务名称。</td><td>字符串</td><td>“storage-fs”</td></tr><tr><td>storage.fs</td><td>定义 fileSystem 对象参数。</td><td>对象</td><td></td></tr><tr><td>storage.fs.folderPath</td><td>定义存储所有文件的文件夹的路径。App_Data</td><td>字符串</td><td>“”</td></tr><tr><td>storage.fs.urlExpires</td><td>定义 fileSystem 对象的临时 URL 过期的时间（以秒为单位）。</td><td>整数</td><td>900</td></tr><tr><td>storage.fs.secretString</td><td>定义用于对 URL 进行签名的密钥字符串。</td><td>字符串</td><td>“verysecretstring”</td></tr><tr><td>storage.region</td><td>定义 Amazon 存储桶所在的 AWS 区域。</td><td>字符串</td><td>“”</td></tr><tr><td>storage.endpoint</td><td>定义 S3 AWS 文档存储终端节点。</td><td>字符串</td><td>“http://localhost/s3”</td></tr><tr><td>storage.bucketName</td><td>定义唯一的 S3 AWS 文档存储名称。</td><td>字符串</td><td>“cache”</td></tr><tr><td>storage.storageFolderName</td><td>定义存储所有文件的 S3 AWS 文档存储文件夹名称。</td><td>字符串</td><td>“files”</td></tr><tr><td>storage.cacheFolderName</td><td>定义在多租户模式下工作的缓存文件夹名称。</td><td>字符串</td><td>“data”</td></tr><tr><td>storage.urlExpires</td><td>定义 S3 AWS 文档存储的 URL 过期的时间（以毫秒为单位）。</td><td>整数</td><td>604800</td></tr><tr><td>storage.accessKeyId</td><td>定义用于访问 S3 AWS 文档存储的密钥 ID。</td><td>字符串</td><td>“AKID”</td></tr><tr><td>storage.secretAccessKey</td><td>定义用于访问 S3 AWS 文档存储的私有密钥。</td><td>字符串</td><td>“SECRET”</td></tr><tr><td>storage.sslEnabled</td><td>定义是否启用了 S3 AWS 文档存储的 SSL。</td><td>布尔</td><td>false</td></tr><tr><td>storage.s3ForcePathStyle</td><td>定义对 S3 AWS 文档存储的请求是否始终使用路径样式寻址。</td><td>布尔</td><td>true</td></tr><tr><td>storage.externalHost</td><td>定义一个外部主机，该主机将用于代替请求中指定的主机。</td><td>字符串</td><td>“”</td></tr></tbody></table> 
<p>将Amazon S3存储桶作为缓存连接到ONLYOFFICE文档<br> 官方文档：<a href="https://helpcenter.onlyoffice.com/installation/docs-connect-amazon.aspx" rel="nofollow">https://helpcenter.onlyoffice.com/installation/docs-connect-amazon.aspx</a></p> 
<blockquote> 
 <p>在官方文档中写到：</p> 
 <p>如果您更改了文件中的参数，则在ONLYOFFICE文档更新或Docker容器重启后，所有更改都将丢失。为确保您的更改在更新后仍然存在，请编辑该文件/etc/onlyoffice/documentserver/local.json</p> 
</blockquote> 
<p>但是我在<code>local.json</code>中配置了发现不起作用。我查阅了一下资料发现也有在<code>development-linux.json</code>中配置的我试了一下也不生效。最后配置在<code>production-linux.json</code>文件中才可以。注意这里根据自己的环境选择linux、mac、windows！</p> 
<hr> 
<p><code>production-linux.json</code>中配置如下信息</p> 
<p>注意的是minio的端口<br> 端口 9090 是 Web 控制台端口，<br> 端口 9000 是 S3 API 端口。</p> 
<pre><code class="prism language-json">  <span class="token string-property property">"storage"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"storage-s3"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"region"</span><span class="token operator">:</span> <span class="token string">"us-east-1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"endpoint"</span><span class="token operator">:</span> <span class="token string">"http://192.168.31.109:9000"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"bucketName"</span><span class="token operator">:</span> <span class="token string">"onlyoffice"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"storageFolderName"</span><span class="token operator">:</span> <span class="token string">"files"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"cacheFolderName"</span><span class="token operator">:</span> <span class="token string">"data"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"urlExpires"</span><span class="token operator">:</span> <span class="token number">604800</span><span class="token punctuation">,</span>
    <span class="token string-property property">"accessKeyId"</span><span class="token operator">:</span> <span class="token string">"RNTriPvDjYYnkSfK44zQ"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"secretAccessKey"</span><span class="token operator">:</span> <span class="token string">"oH9uQpoyGv4rhpxvZUVNbsKXa5PYi6f0egUboej1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"useRequestToGetUrl"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"useSignedUrl"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"sslEnabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"s3ForcePathStyle"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"externalHost"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fb/74/fg46W6ao_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3minio_391"></a>3.验证切换minio存储是否生效</h3> 
<p>访问部署的onlyoffice服务，我这里地址为http://192.168.31.109:9999/</p> 
<h4><a id="1_395"></a>1.测试方式一</h4> 
<p>启用测试示例<br> 在服务器中运行这两个命令<br> <code>第一个命令为开启测试示例，第二个命令为添加到自启动</code><br> <img src="https://images2.imgbox.com/40/7c/q6zE4iPk_o.png" alt="在这里插入图片描述"></p> 
<p>点击按钮来到测试示例页面进行测试</p> 
<p><code>值得注意的是如果这里使用localhost或者127.0.0.1访问都会出现 ‘无法保存文档’或者‘下载文件错误’的提示</code></p> 
<p>我这里是创建了一个word文档，然后保存<img src="https://images2.imgbox.com/c8/a1/kOayd85n_o.gif" alt="请添加图片描述"></p> 
<h4><a id="2_407"></a>2.测试方式二</h4> 
<p>采用上边写的vue+springboot代码来测试<br> <img src="https://images2.imgbox.com/8c/94/oQz0lzie_o.gif" alt="请添加图片描述"></p> 
<hr> 
<p>为什么要配置存储为minio呢？<br> 按照正常开发流程，用户保存文件后我们的后端接收到文件地址后需要在程序中拉取文件然后再存储到自己的指定位置（minio）。这样就很麻烦服务端拉取文件再转存需要耗费大量的性能和带宽。<br> onlyoffice文档转换完成后直接存到我们指定的minio中。但是storage属性是修改onlyoffice本地缓存为转变成对象存储。<code>文件缓存默认存储为1天，超过一天后会自动清理。</code></p> 
<p>我这里采用的方式是获取到了回调地址后后端直接操作minio将文件复制转存到我指定的文件夹下。这样就省去了拉取文件再次保存的步骤。</p> 
<hr> 
<p>本文代码已经提交gitee <a href="https://gitee.com/luzhiyong_erfou/learning-notes/tree/master/onlyoffice" rel="nofollow">https://gitee.com/luzhiyong_erfou/learning-notes/tree/master/onlyoffice</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d080d32feba5b33e06641b94e16d2289/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">人工智能会越来越闭源——对话东北大学副教授王言治 | Open AGI Forum</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e032d9607747aa816b18ee2c426b7169/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">银河麒麟桌面操作系统V10 SP1 x86_x64架构 断网离线安装Java8/Mysql5.7/Tomcat8/nginx/php/node.js 图文详解版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>