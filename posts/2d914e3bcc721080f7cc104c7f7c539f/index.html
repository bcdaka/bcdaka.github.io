<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>万物皆可爬——亮数据代理IP&#43;Python爬虫批量下载百度图片助力AI训练 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2d914e3bcc721080f7cc104c7f7c539f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="万物皆可爬——亮数据代理IP&#43;Python爬虫批量下载百度图片助力AI训练">
  <meta property="og:description" content="💂 个人网站:【 摸鱼游戏】【神级代码资源网站】【导航大全】🤟 一站式轻松构建小程序、Web网站、移动应用：👉注册地址🤟 基于Web端打造的：👉轻量化工具创作平台💅 想寻找共同学习交流，摸鱼划水的小伙伴，请点击【全栈技术交流群】 项目背景 本文档详细介绍了一个网络爬虫项目的准备和实现过程。该项目的目标是从百度图片搜索中获取图片链接并下载图片。此类爬虫项目通常用于收集大量的图片数据，以便用于训练各种人工智能模型，特别是计算机视觉模型。计算机视觉领域的研究需要大量的图像数据来训练和测试模型，以便实现图像分类、对象检测、图像生成等功能。
一、项目准备 环境配置 在开始编写爬虫之前，确保已经完成以下环境配置：
Python安装: 确保已安装Python 3.x版本。Python是一种功能强大且易于学习的编程语言，适合于各种编程任务，包括网络爬虫开发。
需要的库: Python有一个庞大的第三方库生态系统，我们将使用几个核心库来开发我们的爬虫：
requests: 用于发送HTTP请求和处理响应。json: 用于处理JSON格式的数据。urllib: 提供了在网络上获取数据的一些功能，我们主要用来进行URL编码。os: 提供了与操作系统交互的功能，用于创建文件夹等文件操作。time: 提供了时间相关的功能，例如休眠程序以及计时等。 可以使用以下命令通过pip安装这些库：
pip install requests 如果你使用的是Anaconda等集成环境，可以使用conda命令：
conda install requests 这些库将帮助我们处理HTTP请求、解析和存储数据，以及进行一些基本的系统操作。
二、爬虫设计与实现 爬虫设计思路 目标网站分析 本爬虫目标是从百度图片搜索获取图片链接并下载。百度图片搜索返回的结果是JSON格式的数据，其中包含了图片的缩略图链接。
数据获取流程 构建百度图片搜索的URL，通过GET请求获取JSON数据。解析JSON数据，提取缩略图链接。下载图片到本地存储。 代码实现 初始化爬虫类（BaiduImageSpider） import requests import json from urllib import parse import os import time class BaiduImageSpider(object): def __init__(self): self.json_count = 0 # 请求到的json文件数量（一个json文件包含30个图像文件） self.url = &#39;https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=5179920884740494226&amp;ipn=rj&amp;ct&#39; \ &#39;=201326592&amp;is=&amp;fp=result&amp;queryWord={&#39; \ &#39;}&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=-1&amp;z=&amp;ic=0&amp;hd=&amp;latest=&amp;copyright=&amp;word={&#39; \ &#39;}&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;qc=&amp;nc=1&amp;fr=&amp;expermode=&amp;nojc=&amp;pn={&#39; \ &#39;}&amp;rn=30&amp;gsm=1e&amp;1635054081427= &#39; self.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-28T09:51:57+08:00">
    <meta property="article:modified_time" content="2024-06-28T09:51:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">万物皆可爬——亮数据代理IP&#43;Python爬虫批量下载百度图片助力AI训练</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <ul><li><strong>💂 个人网站:【 <a href="https://haiyong.site/moyu" rel="nofollow">摸鱼游戏</a>】【<a href="https://code.haiyong.site" rel="nofollow">神级代码资源网站</a>】【<a href="https://nav.haiyong.site/" rel="nofollow">导航大全</a>】</strong></li><li><strong>🤟 一站式轻松构建小程序、Web网站、移动应用：👉<a href="https://cloud.memfiredb.com/auth/login?from=5VkUHt" rel="nofollow">注册地址</a></strong></li><li><strong>🤟 基于Web端打造的：👉<a href="https://sso.mapmost.com/#/login?source_inviter=ryIXGCHG" rel="nofollow">轻量化工具创作平台</a></strong></li><li><strong>💅 想寻找共同学习交流，摸鱼划水的小伙伴，请点击【<a href="https://haiyong.site/chat/" rel="nofollow">全栈技术交流群</a>】</strong></li></ul> 
</blockquote> 
<h3><a id="_5"></a>项目背景</h3> 
<p>本文档详细介绍了一个网络爬虫项目的准备和实现过程。该项目的目标是从百度图片搜索中获取图片链接并下载图片。此类爬虫项目通常用于收集大量的图片数据，以便用于训练各种人工智能模型，特别是计算机视觉模型。计算机视觉领域的研究需要大量的图像数据来训练和测试模型，以便实现图像分类、对象检测、图像生成等功能。</p> 
<h3><a id="_7"></a>一、项目准备</h3> 
<h4><a id="_8"></a>环境配置</h4> 
<p>在开始编写爬虫之前，确保已经完成以下环境配置：</p> 
<p><strong>Python安装</strong>: 确保已安装Python 3.x版本。Python是一种功能强大且易于学习的编程语言，适合于各种编程任务，包括网络爬虫开发。</p> 
<p><strong>需要的库</strong>: Python有一个庞大的第三方库生态系统，我们将使用几个核心库来开发我们的爬虫：</p> 
<ul><li><strong>requests</strong>: 用于发送HTTP请求和处理响应。</li><li><strong>json</strong>: 用于处理JSON格式的数据。</li><li><strong>urllib</strong>: 提供了在网络上获取数据的一些功能，我们主要用来进行URL编码。</li><li><strong>os</strong>: 提供了与操作系统交互的功能，用于创建文件夹等文件操作。</li><li><strong>time</strong>: 提供了时间相关的功能，例如休眠程序以及计时等。</li></ul> 
<p>可以使用以下命令通过pip安装这些库：</p> 
<pre><code class="prism language-python">pip install requests
</code></pre> 
<p>如果你使用的是Anaconda等集成环境，可以使用conda命令：</p> 
<pre><code class="prism language-python">conda install requests
</code></pre> 
<p>这些库将帮助我们处理HTTP请求、解析和存储数据，以及进行一些基本的系统操作。</p> 
<h3><a id="_34"></a>二、爬虫设计与实现</h3> 
<h4><a id="_36"></a>爬虫设计思路</h4> 
<h5><a id="_37"></a>目标网站分析</h5> 
<p>本爬虫目标是从百度图片搜索获取图片链接并下载。百度图片搜索返回的结果是JSON格式的数据，其中包含了图片的缩略图链接。</p> 
<h5><a id="_40"></a>数据获取流程</h5> 
<ol><li>构建百度图片搜索的URL，通过GET请求获取JSON数据。</li><li>解析JSON数据，提取缩略图链接。</li><li>下载图片到本地存储。</li></ol> 
<h4><a id="_44"></a>代码实现</h4> 
<h5><a id="BaiduImageSpider_45"></a>初始化爬虫类（BaiduImageSpider）</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">BaiduImageSpider</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>json_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 请求到的json文件数量（一个json文件包含30个图像文件）</span>
        self<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=5179920884740494226&amp;ipn=rj&amp;ct'</span> \
                   <span class="token string">'=201326592&amp;is=&amp;fp=result&amp;queryWord={'</span> \
                   <span class="token string">'}&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=-1&amp;z=&amp;ic=0&amp;hd=&amp;latest=&amp;copyright=&amp;word={'</span> \
                   <span class="token string">'}&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;qc=&amp;nc=1&amp;fr=&amp;expermode=&amp;nojc=&amp;pn={'</span> \
                   <span class="token string">'}&amp;rn=30&amp;gsm=1e&amp;1635054081427= '</span>
        self<span class="token punctuation">.</span>directory <span class="token operator">=</span> <span class="token string">r"C:\价值一个亿\python-mini-projects\projects\baidutupian\{}"</span>  <span class="token comment"># 存储目录  这里需要修改为自己希望保存的目录  {}不要丢</span>
        self<span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'</span><span class="token punctuation">,</span>
                          <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.9'</span><span class="token punctuation">,</span>
                          <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://image.baidu.com'</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_70"></a>创建存储文件夹</h5> 
<pre><code class="prism language-python"><span class="token comment"># 创建存储文件夹</span>
 <span class="token keyword">def</span> <span class="token function">create_directory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
     self<span class="token punctuation">.</span>directory <span class="token operator">=</span> self<span class="token punctuation">.</span>directory<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
     <span class="token comment"># 如果目录不存在则创建</span>
     <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
         os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>directory<span class="token punctuation">)</span>
     self<span class="token punctuation">.</span>directory <span class="token operator">+=</span> <span class="token string">r'\{}'</span>
</code></pre> 
<h5><a id="_82"></a>获取图像链接</h5> 
<pre><code class="prism language-python"><span class="token comment"># 获取图像链接</span>
<span class="token keyword">def</span> <span class="token function">get_image_link</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    list_image_link <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    strhtml <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">)</span>  <span class="token comment"># Get方式获取网页数据</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response content for URL </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>url<span class="token punctuation">}</span></span><span class="token string">:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>strhtml<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        jsonInfo <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>strhtml<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error decoding JSON"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> list_image_link

    <span class="token keyword">if</span> <span class="token string">'data'</span> <span class="token keyword">in</span> jsonInfo<span class="token punctuation">:</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token string">'thumbURL'</span> <span class="token keyword">in</span> jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                list_image_link<span class="token punctuation">.</span>append<span class="token punctuation">(</span>jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'thumbURL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No 'data' key in the response JSON"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> list_image_link
</code></pre> 
<h5><a id="_107"></a>下载图片</h5> 
<pre><code class="prism language-python"><span class="token comment"># 下载图片</span>
<span class="token keyword">def</span> <span class="token function">save_image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img_link<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>img_link<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"图片 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img_link<span class="token punctuation">}</span></span><span class="token string"> 下载出错"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"存储路径："</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">except</span> requests<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error downloading image: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_124"></a>主运行函数</h5> 
<pre><code class="prism language-python"><span class="token comment"># 入口函数</span>
<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    searchName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"查询内容："</span><span class="token punctuation">)</span>
    searchName_parse <span class="token operator">=</span> parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>searchName<span class="token punctuation">)</span>  <span class="token comment"># 编码</span>

    self<span class="token punctuation">.</span>create_directory<span class="token punctuation">(</span>searchName<span class="token punctuation">)</span>

    pic_number <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 图像数量</span>
    <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>json_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        pn <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">30</span>
        request_url <span class="token operator">=</span> self<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>searchName_parse<span class="token punctuation">,</span> searchName_parse<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pn<span class="token punctuation">)</span><span class="token punctuation">)</span>
        list_image_link <span class="token operator">=</span> self<span class="token punctuation">.</span>get_image_link<span class="token punctuation">(</span>request_url<span class="token punctuation">)</span>
        <span class="token keyword">for</span> link <span class="token keyword">in</span> list_image_link<span class="token punctuation">:</span>
            pic_number <span class="token operator">+=</span> <span class="token number">1</span>
            self<span class="token punctuation">.</span>save_image<span class="token punctuation">(</span>link<span class="token punctuation">,</span> self<span class="token punctuation">.</span>directory<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>pic_number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 休眠1秒，防止封ip</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>searchName <span class="token operator">+</span> <span class="token string">"----图像下载完成---------&gt;"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_146"></a>三、代码详解</h3> 
<h4><a id="__init____148"></a><code>__init__</code> 方法</h4> 
<p><strong>init</strong> 方法用于初始化爬虫类的属性。在这个方法中，我们定义了以下几个重要的属性：</p> 
<ul><li>json_count: 用于指定要请求的JSON文件数量，每个JSON文件包含多个图像条目。</li><li>url: 百度图片搜索的API URL，包含了多个参数用于构造请求。</li><li>directory: 存储下载图片的目录路径。这个路径在 create_directory 方法中被初始化和修改。</li><li>header: 请求头信息，包括用户代理、接受语言和引用页，用于模拟浏览器发送请求。</li></ul> 
<h4><a id="create_directory__157"></a><code>create_directory</code> 方法</h4> 
<p>create_directory 方法根据提供的名称创建存储图片的文件夹。具体步骤如下：</p> 
<ol><li>将 directory 属性格式化为指定的存储目录路径。</li><li>使用 os.makedirs() 方法创建多层目录，如果目录不存在的话。</li><li>将 directory 属性更新为包含图片文件名格式的路径，以便后续保存图片时直接在该路径下生成文件。</li></ol> 
<h4><a id="get_image_link__165"></a><code>get_image_link</code> 方法</h4> 
<p>get_image_link 方法负责发送GET请求获取百度图片搜索返回的JSON数据，并解析数据提取图片的缩略图链接。具体步骤如下：</p> 
<ol><li>使用 requests.get() 方法发送GET请求，获取包含图片信息的JSON数据。</li><li>尝试解析返回的JSON数据，如果解析失败则捕获 json.JSONDecodeError 异常并打印错误信息。</li><li>如果JSON数据中包含 data 键，遍历数据条目并提取每个条目中的 thumbURL（缩略图链接），将其添加到 list_image_link 列表中。</li><li>如果JSON数据中不存在 data 键，则打印相应的错误信息并返回空列表。</li></ol> 
<h4><a id="save_image__174"></a><code>save_image</code> 方法</h4> 
<p>save_image 方法用于下载图片到本地存储。具体步骤如下：</p> 
<ol><li>使用 requests.get() 方法发送GET请求，获取包含图片数据的响应。</li><li>检查响应状态码，如果返回的状态码是404，则打印错误信息表示图片下载失败。</li><li>如果响应正常，将图片数据写入以指定文件名 filename 打开的二进制文件中（使用 “wb” 模式）。</li><li>打印存储图片的路径信息，表示图片已成功保存到本地。</li></ol> 
<h4><a id="run__183"></a><code>run</code> 方法</h4> 
<p>run 方法是爬虫的主运行函数，负责处理用户输入的查询内容，循环获取图片链接并下载到本地存储。具体步骤如下：</p> 
<ol><li>提示用户输入要查询的内容，并对用户输入的内容进行URL编码，以便构造百度图片搜索的查询URL。</li><li>调用 create_directory 方法创建存储图片的目录，目录名与用户输入的查询内容相关联。</li><li>初始化 pic_number 变量，用于记录已下载的图片数量。</li><li>使用循环从0到 json_count （设定的请求的JSON文件数量）遍历，构造不同页数的百度图片搜索URL，发送请求并获取图片链接。</li><li>遍历获取的图片链接列表，逐个下载图片到本地存储，并在每次下载后休眠1秒以防止IP被封禁。</li><li>下载完成后打印提示信息，指示所有图片已成功下载并存储到指定目录中。</li></ol> 
<p>以上详细解释了每个方法在爬虫实现中的作用和具体实现步骤，确保了爬虫能够有效地从百度图片搜索中获取指定数量的图片并保存到本地。</p> 
<h3><a id="IP_196"></a>四、亮数据代理IP的使用</h3> 
<h4><a id="IP_198"></a>为什么需要代理IP</h4> 
<p>在爬取网站数据时，频繁的请求会被网站识别为异常流量，可能导致IP被封禁。使用代理IP可以隐藏真实IP，降低被封禁的风险。</p> 
<h4><a id="IP_201"></a>如何在爬虫中配置代理IP</h4> 
<p>可以使用第三方代理IP服务商提供的代理IP池，例如requests库中的proxies参数。这里我采用的是<a href="https://www.bright.cn/proxy-types/?utm_source=brand&amp;utm_campaign=brnd-mkt_cn_csdn_haiyong" rel="nofollow">亮数据IP代理服务</a>。<br> <img src="https://images2.imgbox.com/e9/1b/uLR4cuDx_o.png" alt="在这里插入图片描述" width="300"></p> 
<h4><a id="IP_205"></a>修改代码以支持代理IP</h4> 
<p>在请求中添加代理IP，例如：</p> 
<pre><code class="prism language-python">proxies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'http://user:password@proxy_ip:port'</span><span class="token punctuation">,</span>
  <span class="token string">'https'</span><span class="token punctuation">:</span> <span class="token string">'https://user:password@proxy_ip:port'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_216"></a>五、完整代码及运行结果</h3> 
<p>以下是完整的Python代码实现：</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf8 -*-</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
<span class="token keyword">import</span> os
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">BaiduImageSpider</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>json_count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 请求到的json文件数量（一个json文件包含30个图像文件）</span>
        self<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token string">'https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=5179920884740494226&amp;ipn=rj&amp;ct'</span> \
                   <span class="token string">'=201326592&amp;is=&amp;fp=result&amp;queryWord={'</span> \
                   <span class="token string">'}&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=-1&amp;z=&amp;ic=0&amp;hd=&amp;latest=&amp;copyright=&amp;word={'</span> \
                   <span class="token string">'}&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=0&amp;istype=2&amp;qc=&amp;nc=1&amp;fr=&amp;expermode=&amp;nojc=&amp;pn={'</span> \
                   <span class="token string">'}&amp;rn=30&amp;gsm=1e&amp;1635054081427= '</span>
        self<span class="token punctuation">.</span>directory <span class="token operator">=</span> <span class="token string">r"C:\价值一个亿\python-mini-projects\projects\baidutupian\{}"</span>  <span class="token comment"># 存储目录  这里需要修改为自己希望保存的目录  {}不要丢</span>
        self<span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'</span><span class="token punctuation">,</span>
                          <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'en-US,en;q=0.9'</span><span class="token punctuation">,</span>
                          <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://image.baidu.com'</span>
        <span class="token punctuation">}</span>

    <span class="token comment"># 创建存储文件夹</span>
    <span class="token keyword">def</span> <span class="token function">create_directory</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>directory <span class="token operator">=</span> self<span class="token punctuation">.</span>directory<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token comment"># 如果目录不存在则创建</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
            os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>self<span class="token punctuation">.</span>directory<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>directory <span class="token operator">+=</span> <span class="token string">r'\{}'</span>

    <span class="token comment"># 获取图像链接</span>
    <span class="token keyword">def</span> <span class="token function">get_image_link</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        list_image_link <span class="token operator">=</span>

 <span class="token punctuation">[</span><span class="token punctuation">]</span>
        strhtml <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">)</span>  <span class="token comment"># Get方式获取网页数据</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Response content for URL </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>url<span class="token punctuation">}</span></span><span class="token string">:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>strhtml<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
        
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            jsonInfo <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>strhtml<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token keyword">except</span> json<span class="token punctuation">.</span>JSONDecodeError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Error decoding JSON"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> list_image_link

        <span class="token keyword">if</span> <span class="token string">'data'</span> <span class="token keyword">in</span> jsonInfo<span class="token punctuation">:</span>
            <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token string">'thumbURL'</span> <span class="token keyword">in</span> jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    list_image_link<span class="token punctuation">.</span>append<span class="token punctuation">(</span>jsonInfo<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'thumbURL'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No 'data' key in the response JSON"</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> list_image_link

    <span class="token comment"># 下载图片</span>
    <span class="token keyword">def</span> <span class="token function">save_image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> img_link<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>img_link<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>header<span class="token punctuation">)</span>
            <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"图片 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>img_link<span class="token punctuation">}</span></span><span class="token string"> 下载出错"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>res<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"存储路径："</span> <span class="token operator">+</span> filename<span class="token punctuation">)</span>
        <span class="token keyword">except</span> requests<span class="token punctuation">.</span>RequestException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error downloading image: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token comment"># 入口函数</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        searchName <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"查询内容："</span><span class="token punctuation">)</span>
        searchName_parse <span class="token operator">=</span> parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>searchName<span class="token punctuation">)</span>  <span class="token comment"># 编码</span>

        self<span class="token punctuation">.</span>create_directory<span class="token punctuation">(</span>searchName<span class="token punctuation">)</span>

        pic_number <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 图像数量</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>json_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            pn <span class="token operator">=</span> index <span class="token operator">*</span> <span class="token number">30</span>
            request_url <span class="token operator">=</span> self<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>searchName_parse<span class="token punctuation">,</span> searchName_parse<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pn<span class="token punctuation">)</span><span class="token punctuation">)</span>
            list_image_link <span class="token operator">=</span> self<span class="token punctuation">.</span>get_image_link<span class="token punctuation">(</span>request_url<span class="token punctuation">)</span>
            <span class="token keyword">for</span> link <span class="token keyword">in</span> list_image_link<span class="token punctuation">:</span>
                pic_number <span class="token operator">+=</span> <span class="token number">1</span>
                self<span class="token punctuation">.</span>save_image<span class="token punctuation">(</span>link<span class="token punctuation">,</span> self<span class="token punctuation">.</span>directory<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>pic_number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 休眠1秒，防止封ip</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>searchName <span class="token operator">+</span> <span class="token string">"----图像下载完成---------&gt;"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    spider <span class="token operator">=</span> BaiduImageSpider<span class="token punctuation">(</span><span class="token punctuation">)</span>
    spider<span class="token punctuation">.</span>json_count <span class="token operator">=</span> <span class="token number">10</span>  <span class="token comment"># 定义下载10组图像，也就是三百张</span>
    spider<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_311"></a>演示爬虫的运行</h4> 
<p>运行以上代码，按照提示输入查询内容，爬虫将开始从百度图片搜索下载相关图片。</p> 
<p><img src="https://images2.imgbox.com/93/0a/bDtR0wbs_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_317"></a>下载的图片展示</h4> 
<p><img src="https://images2.imgbox.com/71/55/1JDMvcqZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_321"></a>六、总结</h3> 
<p>本文详细介绍了如何使用Python编写一个简单的爬虫，用于从百度图片搜索下载图片。通过分析目标网站、设计爬虫流程、实现代码以及配置代理IP，使得爬虫能够有效地获取图片数据。通过本项目，读者可以学习到基本的爬虫原理和实现方法，同时也了解到了如何处理异常情况和优化爬虫效率的方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/63beb9ab1a4ab9046da9a701550581b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">20240628 每日AI必读资讯</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/176c1827a107b23bc0179c0a0b79cae8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Git怎么下载并且使用?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>