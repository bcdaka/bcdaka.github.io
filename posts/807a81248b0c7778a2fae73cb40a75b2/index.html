<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JS中的File（一）：Blob对象详解 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/807a81248b0c7778a2fae73cb40a75b2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="JS中的File（一）：Blob对象详解">
  <meta property="og:description" content="一、定义 *Blob是web worker中的一个特征，属于来自浏览器的抽象，不可在node环境中使用
Blob是一个装着二进制数据的容器对象。Blob 对象表示一个不可变、原始数据的类文件对象。它的数据可以按文本或二进制的格式进行读取，也可以转换成 ReadableStream 来用于数据操作。
二、属性 size：只读属性，Blob中的字节数type：只读属性，表示Blob存放的媒体类型，图片、视频、文本文件等等 三、构造函数 例子：
const array = [&#39;&lt;q id=&#34;a&#34;&gt;&lt;span id=&#34;b&#34;&gt;hey!&lt;/span&gt;&lt;/q&gt;&#39;]; // 一个包含单个字符串的数组 const blob = new Blob(array, { type: &#34;text/html&#34; }); // 得到 blob 构造函数主要有两个参数：
参数一：存放文件原始数据的可迭代对象，一般放数组。数组中可以存放各种类型的文件数据格式，例如Buffer、Blob、String等等，如下：【一般都需要在资源内容外面套个中括号[]】 // Create a new Blob object var a = new Blob(); // Create a 1024-byte ArrayBuffer // buffer could also come from reading a File var buffer = new ArrayBuffer(1024); // Create ArrayBufferView objects based on buffer var shorts = new Uint16Array(buffer, 512, 128); var bytes = new Uint8Array(buffer, shorts.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T20:05:08+08:00">
    <meta property="article:modified_time" content="2024-07-23T20:05:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JS中的File（一）：Blob对象详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、定义</h3> 
<p><span style="color:#fe2c24;"><strong>*Blob是web worker中的一个特征，属于来自浏览器的抽象，不可在node环境中使用</strong></span></p> 
<p>Blob是一个装着二进制数据的容器对象。Blob 对象表示一个不可变、原始数据的类文件对象。它的数据可以按<span style="color:#fe2c24;">文本或二进制</span>的格式进行读取，也可以转换成 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream" rel="nofollow" title="ReadableStream">ReadableStream</a> 来用于数据操作。</p> 
<h3>二、属性</h3> 
<ul><li>size：只读属性，Blob中的字节数</li><li>type：只读属性，表示Blob存放的媒体类型，图片、视频、文本文件等等</li></ul> 
<h3>三、构造函数</h3> 
<p>例子：</p> 
<pre><code class="language-javascript">const array = ['&lt;q id="a"&gt;&lt;span id="b"&gt;hey!&lt;/span&gt;&lt;/q&gt;']; // 一个包含单个字符串的数组
const blob = new Blob(array, { type: "text/html" }); // 得到 blob
</code></pre> 
<p>构造函数主要有两个参数：</p> 
<ul><li>参数一：存放文件原始数据的可迭代对象，一般放数组。数组中可以存放各种类型的文件数据格式，例如Buffer、Blob、String等等，如下：【<strong><span style="color:#fe2c24;">一般都需要在资源内容外面套个中括号[]</span></strong>】</li></ul> 
<pre><code class="language-javascript">// Create a new Blob object

var a = new Blob();

// Create a 1024-byte ArrayBuffer
// buffer could also come from reading a File

var buffer = new ArrayBuffer(1024);

// Create ArrayBufferView objects based on buffer

var shorts = new Uint16Array(buffer, 512, 128);
var bytes = new Uint8Array(buffer, shorts.byteOffset + shorts.byteLength);

var b = new Blob(["foobarbazetcetc" + "birdiebirdieboo"], {type: "text/plain;charset=utf-8"});

var c = new Blob([b, shorts]);

var a = new Blob([b, c, bytes]);

</code></pre> 
<ul><li>参数二：Optionals，可选的配置项，其中主要可配置的属性有两个： 
  <ul><li>type：同第二大点中属性中的type，规定Blob对象文件读取格式</li><li>endings：可选值为transparent  和 native ，默认为前者，其含义是如果数据是文本，如何解析文本中的换行符。默认值 <code>transparent</code> 会将换行符复制到 blob 中而不会改变它们。要将换行符转换为主机系统的本地约定，请指定值 <code>native</code>。</li></ul></li></ul> 
<h3>四、常用方法和参数</h3> 
<p><strong>1、 <code>arrayBuffer()</code></strong></p> 
<p>返回一个 <span style="color:#fe2c24;"><strong>promise</strong></span>，会兑现为一个包含 blob 数据（以二进制形式）的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" rel="nofollow" title="ArrayBuffer">ArrayBuffer</a>。</p> 
<p><code>2、slice()</code></p> 
<p>使用示例：</p> 
<pre><code>slice(start, end, contentType)</code></pre> 
<p>其中参数start、end代表字节的索引，可以为正数也可以为负数，如果是负数代表这个偏移量将从末尾往前进行计算，例如-10代表Blob的倒数第10个字节。</p> 
<p>另外，start、end代表是左闭右开区间，即end索引指向的字节并不会读取进去</p> 
<p>contentType的输入会修改slice生成后新Blob对象中的内容属性type</p> 
<p><code>3、stream()</code></p> 
<p>Blob接口的 <strong><code>stream()</code></strong> 方法返回一个 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ReadableStream" rel="nofollow" title="ReadableStream">ReadableStream</a> 对象，读取它将返回包含在 <code>Blob</code> 中的数据</p> 
<p><strong><code>4、text()</code></strong></p> 
<p>Blob接口的 <strong><code>text()</code></strong> 方法返回一个<span style="color:#fe2c24;"><strong> Promise</strong></span>，其会兑现一个包含 blob 内容的 <span style="color:#fe2c24;"><strong>UTF-8 格式</strong></span>的字符串。</p> 
<h3>五、Blob的读取</h3> 
<p>1、使用FileReader对象读取Blob对象中的文件或数据</p> 
<ul><li>构造</li></ul> 
<pre><code class="language-javascript">let file_reader=new FileReader()</code></pre> 
<ul><li>指定对Blob的读取方式</li></ul> 
<pre><code class="language-javascript">file_reader.readAsArrayBuffer(blob)//fileReader中的result保存为读取文件的ArrayBuffer数据对象
file_reader.readAsBinaryString(blob) //result保存为原始二进制数据
file_reader.readAsDataURL(blob) //result保存为格式 data : ${URL格式的Base64字符串}
file_reader.readAsText(blob) //result保存为包含一个字符串以表示所读取的文件内容</code></pre> 
<ul><li>定义callBack处理读取到的文件内容</li></ul> 
<pre><code class="language-javascript">file_reader.onload = function (){
  let resultData = file_reader.result
  //....
}
</code></pre> 
<p>其中onload代表在读取操作<span style="color:#fe2c24;">成功完成</span>时触发；onloadstart代表在读取操作开始的时候触发;onloadend代表读取操作结束时触发（<span style="color:#fe2c24;">失败或成功</span>）</p> 
<p>另外callback有onerror、onabort、onprogress </p> 
<ul><li>终止读取操作</li></ul> 
<pre><code class="language-javascript">FileReader.abort()  //返回的readyState属性为DONE
</code></pre> 
<p>2、使用URL对象读取Blob为指定url格式</p> 
<p>相当于加一个url入口，来获取本域下Blob对象的资源内容</p> 
<p><strong><span style="color:#4da8ee;">以利用Blob对象进行图片下载的场景为例</span></strong>：</p> 
<pre><code class="language-javascript">const downloadUrl = URL.createObjectURL(blob)

const link = document.createElement('a')
link.href = downloadUrl
link.download = 'image.png'
link.style.display = 'none';
document.body.appendChild(link)
link.click()
document.body.removeChild(link);

// 释放 URL 对象
URL.revokeObjectURL(link.href)
</code></pre> 
<p>上述代码，借助隐藏节点 a元素标签的download属性，人为触发点击事件，完成下载</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b46cc8206178beb69262be8574f37cf6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【每日刷题Day85】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/85bbe43e27b5ff29d05c19f8b1946440/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI创业者的全面指南：揭开人工智能的神秘面纱</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>