<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python中异常值的检测和处理 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/53972b0c1b2ec2c682d90c82bf33774e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python中异常值的检测和处理">
  <meta property="og:description" content="前言 通常，咱们做数据挖掘的时候经常免不了会遇到异常值检测或者异常值处理等步骤，那么什么是异常值呢？如何检测数据中是否存在异常值？如何处理数据中的异常值？本文专门探究一下这些问题。
异常值又称离群点，是指那些在数据集中存在的不合理的值，需要注意的是，不合理的值是偏离正常范围的值，不是错误值。
异常值出现的原因：数据集中的异常值可能是由于传感器故障、人工录入错误或异常事件导致。
一、异常值的检测 异常值的检测通常有简单统计分析、3σ原则、箱型图、聚类等方法，以下详细对各个方法进行逐一说明。
1.1 简单统计分析 最常用的统计量是最大值和最小值，用来判断这个变量的取值是否超出合理的范围。在pandas中，一般使用describ属性就可以查看相关的统计量。
# 全国房价数据统计 df_dropna = df[~df.price.isna()].reset_index(drop=True) # 首先剔除NA值 df_dropna.price.describe() 1.2 3σ原则（Z-score Method） 3σ原则的前提假设是数据集符合正态分布（高斯分布），如下图：
观察上图容易得出以下数据分布情况：
数值分布在区间（μ-σ, μ&#43;σ）中的概率为 0.6826数值分布在区间（μ-2σ, μ&#43;2σ）中的概率为 0.9545数值分布在区间（μ-3σ, μ&#43;3σ）中的概率为 0.9973 可以认为，数据存在随机误差，其取值几乎全部集中在（μ-3σ, μ&#43;3σ）区间内，超出这个范围的可能性仅占不到0.3%，那么误差超过这个区间的值就识别为异常值了。
实际上，大部分真实的数据并不满足这一条件，我们就需要先对原始数据集进行Z-score变换，使用原始数据的均值（μ）和标准差（σ）进行数据的标准化。经过处理的数据也将服从标准正态分布，其均值为0，标准差为1，故3σ原则又被称为Z-score method。
Z = x − μ σ Z = \frac{x-μ}{σ} Z=σx−μ​
经过Z-score标准化后得到符合正态分布的数据，我们就可以使用3σ原则来处理数据了。演示代码如下：
# 观察原始房价数据分布情况 import matplotlib.pyplot as plt s = df_dropna.price fig = plt.figure(figsize=(6, 6)) # 创建自定义图像 ax1 = fig.add_subplot(2,1,1) # 创建子图1 ax1.scatter(s.index, s.values) # 绘制散点图 plt.grid() # 添加网格 ax2 = fig.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-13T11:12:19+08:00">
    <meta property="article:modified_time" content="2023-12-13T11:12:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python中异常值的检测和处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p> 通常，咱们做数据挖掘的时候经常免不了会遇到异常值检测或者异常值处理等步骤，那么什么是异常值呢？如何检测数据中是否存在异常值？如何处理数据中的异常值？本文专门探究一下这些问题。<br>  <strong>异常值又称离群点</strong>，是指那些在数据集中存在的不合理的值，需要注意的是，不合理的值是偏离正常范围的值，不是错误值。<br>  <strong>异常值出现的原因</strong>：数据集中的异常值可能是由于传感器故障、人工录入错误或异常事件导致。</p> 
<h2><a id="_5"></a>一、异常值的检测</h2> 
<p> 异常值的检测通常有简单统计分析、3σ原则、箱型图、聚类等方法，以下详细对各个方法进行逐一说明。</p> 
<h3><a id="11__8"></a>1.1 简单统计分析</h3> 
<p> 最常用的统计量是<strong>最大值和最小值</strong>，用来判断这个变量的取值是否超出合理的范围。在pandas中，一般使用describ属性就可以查看相关的统计量。</p> 
<pre><code class="prism language-python"><span class="token comment"># 全国房价数据统计</span>
df_dropna <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token operator">~</span>df<span class="token punctuation">.</span>price<span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 首先剔除NA值</span>
df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>describe<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d4/db/nolPkqAq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_3Zscore_Method_17"></a>1.2 3σ原则（Z-score Method）</h3> 
<p> <strong>3σ原则</strong>的前提假设是数据集符合正态分布（高斯分布），如下图：</p> 
<p><img src="https://images2.imgbox.com/d1/e9/lLCPzgCN_o.png" alt="3σ原则"><br>  观察上图容易得出以下数据分布情况：</p> 
<ul><li>数值分布在区间（μ-σ, μ+σ）中的概率为 0.6826</li><li>数值分布在区间（μ-2σ, μ+2σ）中的概率为 0.9545</li><li>数值分布在区间（μ-3σ, μ+3σ）中的概率为 0.9973</li></ul> 
<p> 可以认为，数据存在随机误差，其取值几乎全部集中在（μ-3σ, μ+3σ）区间内，超出这个范围的可能性仅占不到0.3%，那么误差超过这个区间的值就识别为异常值了。</p> 
<p> 实际上，大部分真实的数据并不满足这一条件，我们就需要先对原始数据集进行<strong>Z-score变换</strong>，使用原始数据的均值（μ）和标准差（σ）进行数据的标准化。经过处理的数据也将服从标准正态分布，其均值为0，标准差为1，故3σ原则又被称为<strong>Z-score method</strong>。</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Z 
         
        
          = 
         
         
          
          
            x 
           
          
            − 
           
          
            μ 
           
          
         
           σ 
          
         
        
       
         Z = \frac{x-μ}{σ} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.0715em;" class="mord mathnormal">Z</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1.9463em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0359em;" class="mord mathnormal">σ</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p> 经过Z-score标准化后得到符合正态分布的数据，我们就可以使用3σ原则来处理数据了。演示代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 观察原始房价数据分布情况</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

s <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 创建自定义图像</span>
ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 创建子图1</span>
ax1<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>s<span class="token punctuation">.</span>index<span class="token punctuation">,</span> s<span class="token punctuation">.</span>values<span class="token punctuation">)</span> <span class="token comment"># 绘制散点图</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 添加网格</span>
 
ax2 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 创建子图2</span>
s<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>bins<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax2<span class="token punctuation">)</span> <span class="token comment"># 绘制直方图</span>
s<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'kde'</span><span class="token punctuation">,</span> secondary_y<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax2<span class="token punctuation">)</span> <span class="token comment"># 绘制密度图，使用双坐标轴</span>
plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span>  
 
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 显示自定义图像</span>

<span class="token comment"># #########################################</span>

<span class="token comment"># Z-score变换</span>
_std <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
_mean <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_dropna<span class="token punctuation">[</span><span class="token string">'z_price'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token operator">-</span>_mean<span class="token punctuation">)</span><span class="token operator">/</span>_std<span class="token punctuation">)</span>

<span class="token comment"># 3σ原则检测异常值</span>
_mean <span class="token operator">=</span> <span class="token number">0</span>
_std <span class="token operator">=</span> <span class="token number">1</span>
mark <span class="token operator">=</span> <span class="token punctuation">(</span>_mean<span class="token operator">-</span><span class="token number">3</span><span class="token operator">*</span>_std<span class="token operator">&gt;</span>df_dropna<span class="token punctuation">[</span><span class="token string">'z_price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>df_dropna<span class="token punctuation">[</span><span class="token string">'z_price'</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>_mean<span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span>_std<span class="token punctuation">)</span> 
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token comment"># 异常数据</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/47/5d/2tIF9nQB_o.png" alt="原始数据分布"></p> 
<p> 根据实际业务需求，若数据不服从正态分布，也可以不做标准化处理，可以用远离平均值的多少倍标准差来描述（这就使Z-score方法可以适用于不同的业务场景，只是需要根据经验来确定 kσ 中的k值，这个k值就可以认为是阈值），演示代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># Z-score方法检测异常值（阈值k=3）</span>
_mean <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
_std <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
mark <span class="token operator">=</span> <span class="token punctuation">(</span>_mean<span class="token operator">-</span><span class="token number">3</span><span class="token operator">*</span>_std<span class="token operator">&gt;</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token operator">&gt;</span>_mean<span class="token operator">+</span><span class="token number">3</span><span class="token operator">*</span>_std<span class="token punctuation">)</span> 
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token comment"># 异常数据</span>
</code></pre> 
<h3><a id="13_Robust_Zscore_Method_80"></a>1.3 Robust Z-score Method</h3> 
<p> 该方法也被称为 <strong>中位数绝对偏差法</strong>。它类似于Z-score方法，只是参数有所变化。由于平均值和标准差受异常值的影响很大，因此我们使用中位数和中位数的绝对偏差来改变这个参数，公式如下：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          R 
         
        
          . 
         
        
          Z 
         
        
          . 
         
        
          s 
         
        
          c 
         
        
          o 
         
        
          r 
         
        
          e 
         
        
          = 
         
         
          
          
            0.6745 
           
          
            × 
           
           
           
             ( 
            
           
             x 
            
           
             − 
            
           
             M 
            
           
             e 
            
           
             d 
            
           
             i 
            
           
             a 
            
           
             n 
            
           
             ) 
            
           
          
          
          
            M 
           
          
            A 
           
          
            D 
           
          
         
         
        
          w 
         
        
          h 
         
        
          e 
         
        
          r 
         
        
          e 
         
         
        
          M 
         
        
          A 
         
        
          D 
         
        
          = 
         
        
          m 
         
        
          e 
         
        
          d 
         
        
          i 
         
        
          a 
         
        
          n 
         
        
          ( 
         
        
          ∣ 
         
        
          x 
         
        
          − 
         
        
          M 
         
        
          e 
         
        
          d 
         
        
          i 
         
        
          a 
         
        
          n 
         
        
          ∣ 
         
        
          ) 
         
        
       
         R.Z.score = \frac{0.6745\times \left ( x-Median\right ) }{MAD} \\ where \quad MAD=median(∣x−Median∣) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.0077em;" class="mord mathnormal">R</span><span class="mord">.</span><span style="margin-right: 0.0715em;" class="mord mathnormal">Z</span><span class="mord">.</span><span class="mord mathnormal">score</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.113em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.109em;" class="mord mathnormal">M</span><span class="mord mathnormal">A</span><span style="margin-right: 0.0278em;" class="mord mathnormal">D</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0.6745</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">M</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal">ian</span><span class="mclose delimcenter" style="top: 0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.6944em;"></span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mspace" style="margin-right: 1em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">M</span><span class="mord mathnormal">A</span><span style="margin-right: 0.0278em;" class="mord mathnormal">D</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal">ian</span><span class="mopen">(</span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">M</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal">ian</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∣</span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mclose">)</span></span></span></span></span></span></p> 
<p> 假设 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        x 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span> 服从标准正态分布，那么 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         M 
        
       
         A 
        
       
         D 
        
       
      
        MAD 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">M</span><span class="mord mathnormal">A</span><span style="margin-right: 0.0278em;" class="mord mathnormal">D</span></span></span></span></span> 会收敛于半正态分布的中位数，即正态分布的75%百分位，并且 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
         ( 
        
       
         0.75 
        
       
         ) 
        
       
         ≃ 
        
       
         0.6745 
        
       
      
        N(0.75)≃0.6745 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">N</span><span class="mopen">(</span><span class="mord">0.75</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≃</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0.6745</span></span></span></span></span>。计算出稳健Z分数后，可以根据以下异常值的判定准则：</p> 
<ul><li>如果 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∣ 
         
        
          Z 
         
        
          ∣ 
         
        
          ≤ 
         
        
          2 
         
        
       
         |Z| ≤ 2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span style="margin-right: 0.0715em;" class="mord mathnormal">Z</span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">2</span></span></span></span></span> 则结果满意（satisfactory）</li><li>如果 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2 
         
        
          ＜ 
         
        
          ∣ 
         
        
          Z 
         
        
          ∣ 
         
        
          ＜ 
         
        
          3 
         
        
       
         2＜ |Z| ＜ 3 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span class="mord cjk_fallback">＜</span><span class="mord">∣</span><span style="margin-right: 0.0715em;" class="mord mathnormal">Z</span><span class="mord">∣</span><span class="mord cjk_fallback">＜</span><span class="mord">3</span></span></span></span></span> 则结果可疑（questionable）</li><li>如果 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ∣ 
         
        
          Z 
         
        
          ∣ 
         
        
          ≥ 
         
        
          3 
         
        
       
         |Z| ≥ 3 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span style="margin-right: 0.0715em;" class="mord mathnormal">Z</span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">3</span></span></span></span></span> 则结果不满意（unsatisfactory）</li></ul> 
<p> 演示代码：</p> 
<pre><code class="prism language-python"><span class="token comment"># R.Z.score Method检测异常值</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy
<span class="token comment"># 计算R.Z.score</span>
med <span class="token operator">=</span> np<span class="token punctuation">.</span>median<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
mad <span class="token operator">=</span> scipy<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>median_absolute_deviation<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
r_z_score <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">0.6745</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token operator">-</span>med<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>median<span class="token punctuation">(</span>mad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 判定异常值</span>
mark <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>r_z_price<span class="token punctuation">.</span>values<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span> 
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token comment"># 异常数据</span>
</code></pre> 
<h3><a id="14__106"></a>1.4 箱型图（四分位距法）</h3> 
<p> <strong>箱型图</strong>提供了识别异常值的标准，异常值通常被定义为小于QL-1.5IQR或大于QU+1.5IQR的数据。QL称为下四分位数，表示全部值中有四分之一的数据取值比它小；QU称为上四分位数，表示全部值中有四分之一的数据取值比它大；IQR称为四分位数间距，是上四分位数QU与下四分位数QL之差。所以此方法又称为<strong>四分位距法</strong>，如下图。</p> 
<p><img src="https://images2.imgbox.com/8f/4f/xTdkkISs_o.png" alt="四分位距法"></p> 
<pre><code class="prism language-python"><span class="token comment"># 箱型图可视化数据</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 四分位距法检测异常值</span>
QL <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span>
QU <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.75</span><span class="token punctuation">)</span>
IQR <span class="token operator">=</span> QU <span class="token operator">-</span> QL
mark <span class="token operator">=</span> <span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price <span class="token operator">&lt;</span> QL <span class="token operator">-</span> <span class="token number">1.5</span><span class="token operator">*</span>IQR<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>QU <span class="token operator">+</span> <span class="token number">1.5</span><span class="token operator">*</span>IQR<span class="token operator">&lt;</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token comment"># 异常数据</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/b6/mjhhAIbI_o.png" alt="原始房价数据箱型图"></p> 
<h3><a id="15_Winsorization_methodPercentile_Capping_125"></a>1.5 截尾处理（Winsorization method(Percentile Capping)）</h3> 
<p> 该方法类似于IQR法。如果一个值超过了第99个百分位数的值，并且低于给定值的第1个百分位数，则被视为异常值。<br> <img src="https://images2.imgbox.com/b5/6b/WFodm9tu_o.png" alt="截尾效应"><br>  演示代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 截尾处理检测异常值</span>
up <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.99</span><span class="token punctuation">)</span>
low <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>
mark <span class="token operator">=</span> <span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price <span class="token operator">&lt;</span> low<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price <span class="token operator">&gt;</span> up<span class="token punctuation">)</span>
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token comment"># 异常数据</span>
</code></pre> 
<h3><a id="16_DBSCANDENSITYBASED_SPATIAL_CLUSTERING_OF_APPLICATIONS_WITH_NOISE_136"></a>1.6 DBSCAN聚类（DENSITY-BASED SPATIAL CLUSTERING OF APPLICATIONS WITH NOISE）</h3> 
<p> DBSCAN是一种基于密度的聚类算法，它将数据集划分为高密度区域的子组，并将稀疏区域聚类识别为异常值。集群标记-1表示该集群包含离群值，其余集群没有离群值。这种方法类似于K-means聚类。DBSCAN在多元离群值检测中具有最佳的检测效果。DBSCAN需要两个参数：</p> 
<ul><li>epsilon：一个距离参数，定义搜索附近邻居的半径。</li><li>minPts：形成集群所需的最小点数。</li></ul> 
<p> 使用以上2个参数我们就可以把每个数据点分类成：</p> 
<ul><li>核心点 ：在其半径内至少有最小数量的其他点(minPts)的点。</li><li>边界点 ： 一个点在核心点的半径内，但小于其自身半径内其他点(minPts)的最小数量。</li><li>噪声点 ： 既不是核心点也不是边界点的点。</li></ul> 
<p> 如下图所示：<br> <img src="https://images2.imgbox.com/e9/51/q8UJ95f5_o.png" alt="DBSCAN聚类"> 演示代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">import</span> DBSCAN

<span class="token keyword">def</span> <span class="token function">DBSCAN_outliers</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># df是列数据</span>
    outlier_detection <span class="token operator">=</span> DBSCAN<span class="token punctuation">(</span>eps<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'euclidean'</span><span class="token punctuation">,</span> min_samples<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    clusters <span class="token operator">=</span> outlier_detection<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>df<span class="token punctuation">.</span>values<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> clusters
</code></pre> 
<h3><a id="17_ISOLATION_FOREST_159"></a>1.7 孤立随机森林聚类（ISOLATION FOREST）</h3> 
<p> 它是一种聚类算法，属于集成决策树家族，在原理上类似于随机森林。</p> 
<p><img src="https://images2.imgbox.com/fd/2f/YaDpuyBV_o.png" alt="孤立随机森林"><br>  孤立随机森林的特点有以下几点：</p> 
<ul><li>（1）它将数据点分类为异常值和非异常值，并适用于非常高维的数据。</li><li>（2）该方法基于决策树，分离出异常值。</li><li>（3）如果结果是 -1，这意味着这个特定的数据点是一个异常值。如果结果为 1，则意味着该数据点不是异常值。</li></ul> 
<p>演示代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> IsolationForest
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">def</span> <span class="token function">IsolationForest_outliers</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># df是列数据</span>
    iso <span class="token operator">=</span> IsolationForest<span class="token punctuation">(</span>behaviour<span class="token operator">=</span><span class="token string">'new'</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> contamination<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">)</span>
    preds <span class="token operator">=</span> iso<span class="token punctuation">.</span>fit_predict<span class="token punctuation">(</span>df<span class="token punctuation">.</span>values<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> preds 
</code></pre> 
<h3><a id="18_GRUBBS_TEST_183"></a>1.8 GRUBBS TEST</h3> 
<p> Grubbs’ test 是一个假设检验方法。</p> 
<ul><li>原假设 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           H 
          
         
           0 
          
         
        
       
         H_0 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0813em;" class="mord mathnormal">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0813em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>：数据集中无异常值。</li><li>备选假设 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           H 
          
         
           1 
          
         
        
       
         H_1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0813em;" class="mord mathnormal">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0813em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>：数据集中有一个异常值。<br> ​</li></ul> 
<p> 其统计量被定义为：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           G 
          
          
          
            c 
           
          
            a 
           
          
            l 
           
          
            c 
           
          
            u 
           
          
            l 
           
          
            a 
           
          
            t 
           
          
            e 
           
          
            d 
           
          
         
        
          = 
         
         
          
          
            m 
           
          
            a 
           
          
            x 
           
          
            ( 
           
          
            ∣ 
           
           
           
             X 
            
           
             i 
            
           
          
            − 
           
           
           
             X 
            
           
             ˉ 
            
           
          
            ∣ 
           
          
            ) 
           
          
          
          
            S 
           
          
            D 
           
          
         
        
       
         G_{calculated}=\frac{max(|X_i - \bar{X}|)}{SD} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1831em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.4971em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0576em;" class="mord mathnormal">S</span><span style="margin-right: 0.0278em;" class="mord mathnormal">D</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord"><span style="margin-right: 0.0785em;" class="mord mathnormal">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8201em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">X</span></span><span class="" style="top: -3.2523em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1667em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p> 其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          X 
         
        
          ˉ 
         
        
       
      
        \bar{X} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8201em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8201em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">X</span></span><span class="" style="top: -3.2523em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1667em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span></span> 和 SD 分别代表样本均值和样本标准差。其临界值被定义为：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           G 
          
          
          
            c 
           
          
            i 
           
          
            t 
           
          
            i 
           
          
            c 
           
          
            a 
           
          
            l 
           
          
         
        
          = 
         
         
          
          
            N 
           
          
            − 
           
          
            1 
           
          
          
          
            N 
           
          
         
         
          
           
           
             ( 
            
            
            
              t 
             
             
             
               α 
              
             
               / 
              
             
               ( 
              
             
               2 
              
             
               N 
              
             
               ) 
              
             
               , 
              
             
               N 
              
             
               − 
              
             
               2 
              
             
            
            
            
              ) 
             
            
              2 
             
            
           
           
           
             N 
            
           
             − 
            
           
             2 
            
           
             + 
            
           
             ( 
            
            
            
              t 
             
             
             
               α 
              
             
               / 
              
             
               ( 
              
             
               2 
              
             
               N 
              
             
               ) 
              
             
               , 
              
             
               N 
              
             
               − 
              
             
               2 
              
             
            
            
            
              ) 
             
            
              2 
             
            
           
          
         
        
       
         G_{citical}=\frac{N-1}{\sqrt{N}} \sqrt{\frac{(t_{\alpha/(2N),N-2})^{2}}{N-2+(t_{\alpha/(2N),N-2})^{2}}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.04em; vertical-align: -1.1791em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.1833em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9267em;"><span class="svg-align" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord" style="padding-left: 0.833em;"><span style="margin-right: 0.109em;" class="mord mathnormal">N</span></span></span><span class="" style="top: -2.8867em;"><span class="pstrut" style="height: 3em;"></span><span class="hide-tail" style="min-width: 0.853em; height: 1.08em;"> 
                   <svg width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"> 
                    <path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path> 
                   </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1133em;"><span class=""></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.109em;" class="mord mathnormal">N</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.93em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.8609em;"><span class="svg-align" style="top: -5em;"><span class="pstrut" style="height: 5em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.4952em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.109em;" class="mord mathnormal">N</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.0037em;" class="mord mathnormal mtight">α</span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mtight">2</span><span style="margin-right: 0.109em;" class="mord mathnormal mtight">N</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span style="margin-right: 0.109em;" class="mord mathnormal mtight">N</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7401em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.7452em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.0037em;" class="mord mathnormal mtight">α</span><span class="mord mtight">/</span><span class="mopen mtight">(</span><span class="mord mtight">2</span><span style="margin-right: 0.109em;" class="mord mathnormal mtight">N</span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span style="margin-right: 0.109em;" class="mord mathnormal mtight">N</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7401em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.0412em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.8209em;"><span class="pstrut" style="height: 5em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 3.08em;"> 
            <svg width="400em" height="3.08em" viewbox="0 0 400000 3240" preserveaspectratio="xMinYMin slice"> 
             <path d="M473,2793
c339.3,-1799.3,509.3,-2700,510,-2702 l0 -0
c3.3,-7.3,9.3,-11,18,-11 H400000v40H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM1001 80h400000v40H1017.7z"></path> 
            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.1791em;"><span class=""></span></span></span></span></span></span></span></span></span></span></p> 
<p> 如果估计值 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          G 
         
         
         
           c 
          
         
           a 
          
         
           l 
          
         
           c 
          
         
           u 
          
         
           l 
          
         
           a 
          
         
           t 
          
         
           e 
          
         
           d 
          
         
        
       
      
        G_{calculated} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> &gt; 临界值 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          G 
         
         
         
           c 
          
         
           r 
          
         
           i 
          
         
           t 
          
         
           i 
          
         
           c 
          
         
           a 
          
         
           l 
          
         
        
       
      
        G_{critical} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.0278em;" class="mord mathnormal mtight">cr</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">a</span><span style="margin-right: 0.0197em;" class="mord mathnormal mtight">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，拒绝原假设，备选假设成立，即数据集中有一个值是异常值。<br>  一下是演示代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">as</span> stats

<span class="token keyword">def</span> <span class="token function">grubbs_test</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    mean_x <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    std_x <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    numerator <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token operator">-</span>mean_x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    g_calculated <span class="token operator">=</span> numerator <span class="token operator">/</span> std_x 
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Grubbs Calculated Value:"</span><span class="token punctuation">,</span> g_calculated<span class="token punctuation">)</span>
    t_value <span class="token operator">=</span> stats<span class="token punctuation">.</span>t<span class="token punctuation">.</span>ppf<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">0.05</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>
    g_critical <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>t_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>t_value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Grubbs Critical Value:"</span><span class="token punctuation">,</span> g_critical<span class="token punctuation">)</span>
    <span class="token keyword">if</span> g_critical <span class="token operator">&gt;</span> g_calculated<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"From grubbs_test we observe that calculated value is lesser than critical value, Accept null hypothesis and conclude that there is no outliers\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"From grubbs_test we observe that calculated value is greater than critical value, Reject null hypothesis and conclude that there is an outliers\n"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="19_Visualizing_the_data_221"></a>1.9 可视化数据（Visualizing the data）</h3> 
<p> 数据可视化对于数据清理、数据挖掘、异常值和异常组的检测、趋势和集群识别等都很有用。下面是用于发现异常值的数据可视化图列表：</p> 
<ul><li>Box and whisker plot (box plot) 箱线图</li><li>Scatter plot 散点图</li><li>Histogram 直方图</li><li>Distribution Plot. 分布图</li><li>QQ plot Q-Q图</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>gofplots <span class="token keyword">import</span> qqplot

<span class="token keyword">def</span> <span class="token function">Box_plots</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Box Plot"</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">hist_plots</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Histogram Plot"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">scatter_plots</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Age'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Fare'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Scatter Plot"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dist_plots</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Distribution plot"</span><span class="token punctuation">)</span>
    sns<span class="token punctuation">.</span>despine<span class="token punctuation">(</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">qq_plots</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    qqplot<span class="token punctuation">(</span>s<span class="token punctuation">,</span> line<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"Normal QQPlot"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_270"></a>二、异常值的处理</h2> 
<p> 异常值的存在对数据集的影响有以下方面：</p> 
<ul><li>离群值严重影响数据集的均值和标准差。这些可能在统计上给出错误的结果。</li><li>它增加了误差方差，降低了统计检验的力量。</li><li>如果异常值是非随机分布的，它们会降低正态性。</li><li>大多数机器学习算法在异常值存在时不能很好地工作。因此，检测和去除异常值是很有必要的。</li><li>它们还会影响回归、方差分析和其他统计模型假设的基本假设。</li></ul> 
<p> 所以当我们检测到数据中存在异常值时必须做适当的处理才会使得数据挖掘工作更加准确，一般的，异常值的处理方法有：删除值、改变值、插补法和分组处理。</p> 
<h3><a id="21__282"></a>2.1 删除异常值</h3> 
<p> 直接将含有异常值的记录删除，通常有两种策略：整条删除和成对删除。这种方法最简单简单易行，但缺点也不容忽视，一是，在观测值很少的情况下，这种删除操作会造成样本量不足；二是，直接删除、可能会对变量的原有分布造成影响，从而导致统计模型不稳定。</p> 
<pre><code class="prism language-python"><span class="token comment"># 删除异常值（使用3σ原则）</span>
df_drop_outlier <span class="token operator">=</span> df_dropna<span class="token punctuation">[</span><span class="token operator">~</span>mark<span class="token punctuation">]</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>drop<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 剔除异常值后的箱型图</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>boxplot<span class="token punctuation">(</span>df_drop_outlier<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/51/6e/JXhusbOp_o.png" alt="剔除异常值后房价数据箱型图"></p> 
<h3><a id="22__297"></a>2.2 数据变换</h3> 
<p> 转换变量也可以消除异常值。这些转换后的值减少了由极值引起的变化。转换方法通常有：</p> 
<ul><li>范围缩放：Scalling</li><li>对数变换：Log Transformation</li><li>立方根归一化：Cube Root Transformation</li><li>Box-Cox转换：Box-Cox Transformation</li></ul> 
<p> 这些技术将数据集中的值转换为更小的值，而且不会丢失数据。如果数据有很多极端值或倾斜，数据变换有助于使您的数据正常。但是这些技巧并不总是给你最好的结果。在所有这些方法中，box-cox变换给出了最好的结果。以下代码仅仅作为演示：</p> 
<pre><code class="prism language-python"><span class="token comment"># Scalling</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> preprocessing
scaler <span class="token operator">=</span> preprocessing<span class="token punctuation">.</span>StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># Log transformation</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
result <span class="token operator">=</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values<span class="token punctuation">)</span>

<span class="token comment"># Cube root Transformation</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
result <span class="token operator">=</span> np<span class="token punctuation">.</span>cbrt<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values<span class="token punctuation">)</span>

<span class="token comment"># Box-Cox Transformation</span>
<span class="token keyword">import</span> scipy
result<span class="token punctuation">,</span> maxlog <span class="token operator">=</span> scipy<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>boxcox<span class="token punctuation">(</span>df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>values <span class="token punctuation">,</span>lmbda<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="23__326"></a>2.3 统一值插补法</h3> 
<p> 像缺失值的归责（imputation）一样，我们也可以归责异常值。在这种方法中，我们可以使用 <strong>平均值、中位数、零值</strong> 来对异常值进行替换。由于我们进行了输入，所以没有丢失数据。应选则合适的替换，这里提及一下，选择中值不受异常值的影响。以下代码仅仅作为演示。</p> 
<pre><code class="prism language-python"><span class="token comment"># 均值替换异常值</span>
_mean <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token operator">=</span> _mean 
<span class="token comment"># 中位数替换异常值</span>
_median <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>median<span class="token punctuation">(</span><span class="token punctuation">)</span>
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token operator">=</span> _median 
<span class="token comment"># 0替换异常值</span>
df_dropna<span class="token punctuation">[</span>mark<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
</code></pre> 
<h3><a id="24__340"></a>2.4 回归插补法</h3> 
<p> 发现两个相关的变量之间的变化模式，通过使数据拟合一个函数来平滑数据，也就是<strong>回归插补</strong>。</p> 
<p> 若是变量之间存在依赖关系，也就是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
         = 
        
       
         f 
        
       
         ( 
        
       
         x 
        
       
         ) 
        
       
      
        y=f(x) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span>，那么就可以设法求出依赖关系 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
      
        f 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span></span></span></span></span>，再根据x来预测 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        y 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span></span></span></span></span>，这也是回归问题的实质。</p> 
<p> 实际问题中更常为见的假设是 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         p 
        
       
         ( 
        
       
         y 
        
       
         ) 
        
       
         = 
        
       
         N 
        
       
         ( 
        
       
         f 
        
       
         ( 
        
       
         x 
        
       
         ) 
        
       
         ) 
        
       
      
        p(y)=N(f(x)) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">N</span><span class="mopen">(</span><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span></span>，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         N 
        
       
      
        N 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.109em;" class="mord mathnormal">N</span></span></span></span></span> 为正态分布。假设 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        y 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span></span></span></span></span> 是观测值并且存在噪声数据，根据我们求出的 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        x 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        y 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span></span></span></span></span> 之间的依赖关系，再根据 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         x 
        
       
      
        x 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span> 来更新 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
      
        y 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span></span></span></span></span> 的值，这样就能去除其中的随机噪声，这就是回归去噪的原理 。</p> 
<h3><a id="25__347"></a>2.5 盖帽法</h3> 
<p> 也就是截尾处理，这其实也是一种插补方法。整行替换数据框里百分位数处于99%以上和1%以下的点：将99%以上的点值 = 99%的点值；小于1%的点值 = 1%的点值。</p> 
<pre><code class="prism language-python"><span class="token comment"># 盖帽法处理异常值</span>
up <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.99</span><span class="token punctuation">)</span>
low <span class="token operator">=</span> df_dropna<span class="token punctuation">.</span>price<span class="token punctuation">.</span>quantile<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span>
df_dropna<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_dropna<span class="token punctuation">.</span>price <span class="token operator">&gt;</span> up<span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">]</span> <span class="token operator">=</span> up 
df_dropna<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df_dropna<span class="token punctuation">.</span>price <span class="token operator">&lt;</span> low<span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">]</span> <span class="token operator">=</span> low 
</code></pre> 
<h3><a id="26__357"></a>2.6 不处理</h3> 
<p> 剔除和替换异常值或多或至少会对数据有负面影响，我们也可以根据该异常值的性质特点，使用更加稳健模型来修饰，然后直接在原数据集上进行数据挖掘。</p> 
<h2><a id="_361"></a>参考链接</h2> 
<p><a href="https://www.kaggle.com/code/nareshbhat/outlier-the-silent-killer/notebook" rel="nofollow">1.Outlier!!! The Silent Killer</a><br> <a href="https://zhuanlan.zhihu.com/p/358944859" rel="nofollow">2.数据清洗之异常值处理的常用方法</a><br> <a href="https://blog.csdn.net/m0_72662900/article/details/127061570">3.异常数据处理——3σ原则、箱线图</a><br> <a href="https://zhuanlan.zhihu.com/p/601315166" rel="nofollow">4.3sigma原则剔除异常值（极端值）</a><br> <a href="https://blog.csdn.net/tszupup/article/details/108432814">5.Python检验样本是否服从正态分布</a><br> <a href="https://www.cnblogs.com/rookieveteran/p/12871394.html#:~:text=1%20%E5%81%8F%E5%BA%A6%20b1%20%3D%20m3%20s3%20%3D%201,%E2%88%92%C2%AF%20%C2%AFx%294%20%281%20n%20%E2%88%91n%20%3D1%28x%20%E2%88%92%C2%AF%20" rel="nofollow">6.Python pandas库和stats库计算偏度和峰度(附程序)</a><br> <a href="https://zhuanlan.zhihu.com/p/403203117" rel="nofollow">7.数据预处理——3sigma原则离群值处理</a><br> <a href="http://www.labptp.com/knowledge/show-33.html" rel="nofollow">8.能力验证中稳健Z比分数的计算方法</a><br> <a href="https://zhuanlan.zhihu.com/p/480968981" rel="nofollow">9.六种常见变量标准化方法的优缺点和适用范围</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d26026f28709b385d6b96e13ceeb74b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Nginx: [emerg] the “ssl“ parameter requires ngx_http_ssl_module in /usr/local/nginx/conf/nginx.conf</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a95e1118f703dbd724a16c217cf1879c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python中栈的概念和使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>