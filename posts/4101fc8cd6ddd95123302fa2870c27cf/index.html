<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>XMl基本操作 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4101fc8cd6ddd95123302fa2870c27cf/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="XMl基本操作">
  <meta property="og:description" content="引言 使⽤Mybatis的注解⽅式，主要是来完成⼀些简单的增删改查功能. 如果需要实现复杂的SQL功能，建议使⽤XML来配置映射语句，也就是将SQL语句写在XML配置⽂件中. 之前，我们学习了，用注解的方式来实现MyBatis
接下来我们学习XML的⽅式
MyBatis XML的⽅式需要以下两步 配置数据库连接字符串和MyBatis 写持久层代码 MyBatis XML配置⽂件 配置连接字符串和MyBatis 此步骤需要进⾏两项设置，数据库连接字符串设置和 MyBatis 的 XML ⽂件配置。 # 数据库连接配置 spring: datasource: url: jdbc:mysql://127.0.0.1:3306/mybatis_test? characterEncoding=utf8&amp;useSSL=false username: root password: root driver-class-name: com.mysql.cj.jdbc.Driver # 配置 mybatis xml 的⽂件路径，在 resources/mapper 创建所有表的 xml ⽂件 //mapper是目录,自己设置 //文件名的后缀部分必须是Mapper.xml不能修改,前面可以添加内容 //这里的*代表通配符 mybatis.mapper-locations=classpath:/myBatis/*Mapper.xml mybatis: mapper-locations: classpath:mapper/**Mapper.xml 写持久层代码 持久层代码分两部分 ⽅法定义 Interface ⽅法实现: XXX.xml 添加 mapper 接⼝ 数据持久层的接⼝定义： import com.example.demo.model.UserInfo; import org.apache.ibatis.annotations.Mapper; import java.util.List; @Mapper public interface UserInfoXMlMapper { List&lt;UserInfo&gt; queryAllUser(); } 添加 UserInfoXMLMapper.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-20T18:35:22+08:00">
    <meta property="article:modified_time" content="2024-07-20T18:35:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">XMl基本操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>引言</h2> 
<blockquote> 
 <div> 
  <strong><span style="color:#646a73;">使⽤Mybatis的注解⽅式，主要是来完成⼀些简单的增删改查功能. 如果需要实现复杂的SQL功能，建议使⽤XML来配置映射语句，也就是将SQL语句写在XML配置⽂件中.</span></strong> 
 </div> 
</blockquote> 
<p>之前，我们学习了，用注解的方式来实现MyBatis</p> 
<hr> 
<p><span style="color:#1f2329;">接下来我们学习XML的⽅式</span></p> 
<div></div> 
<div> 
 <span style="color:#1f2329;">MyBatis XML的⽅式需要以下两步</span> 
</div> 
<div></div> 
<blockquote> 
 <div> 
  <ol><li><strong><span style="color:#1f2329;">配置数据库连接字符串和MyBatis </span></strong></li><li><strong><span style="color:#1f2329;">写持久层代码 </span></strong></li></ol> 
 </div> 
</blockquote> 
<p> </p> 
<hr> 
<h2><span style="color:#1f2329;">MyBatis XML配置⽂件</span></h2> 
<p></p> 
<h4 style="background-color:transparent;"><span style="color:#1f2329;">配置连接字符串和MyBatis</span></h4> 
<div> 
 <strong><span style="color:#38d8f0;">此步骤需要进⾏两项设置，数据库连接字符串设置和 MyBatis 的 XML ⽂件配置。</span></strong> 
</div> 
<div></div> 
<div> 
 <pre><code class="language-html"># 数据库连接配置
spring:
 datasource:
 url: jdbc:mysql://127.0.0.1:3306/mybatis_test?
characterEncoding=utf8&amp;useSSL=false
 username: root
 password: root
 driver-class-name: com.mysql.cj.jdbc.Driver
# 配置 mybatis xml 的⽂件路径，在 resources/mapper 创建所有表的 xml ⽂件

//mapper是目录,自己设置
//文件名的后缀部分必须是Mapper.xml不能修改,前面可以添加内容
//这里的*代表通配符
mybatis.mapper-locations=classpath:/myBatis/*Mapper.xml
mybatis:
 mapper-locations: classpath:mapper/**Mapper.xml</code></pre> 
 <h4 style="background-color:transparent;"><span style="color:#1f2329;">写持久层代码 </span></h4> 
 <div> 
  <span style="color:#1f2329;">持久层代码分两部分 </span> 
 </div> 
 <ol><li><strong><span style="color:#1f2329;">⽅法定义 Interface </span></strong></li><li><strong><span style="color:#1f2329;">⽅法实现: XXX.xml</span></strong></li></ol> 
 <p><img alt="" height="390" src="https://images2.imgbox.com/d0/17/yrByleG2_o.png" width="1200"></p> 
 <p></p> 
 <h5><strong><span style="color:#1f2329;">添加 mapper 接⼝</span></strong></h5> 
 <div></div> 
 <div></div> 
 <div> 
  <span style="color:#1f2329;">数据持久层的接⼝定义： </span> 
 </div> 
 <div></div> 
 <div> 
  <pre><code class="language-java">import com.example.demo.model.UserInfo;
import org.apache.ibatis.annotations.Mapper;
import java.util.List;
@Mapper
public interface UserInfoXMlMapper {
 List&lt;UserInfo&gt; queryAllUser();
}</code></pre> 
  <h5><span style="color:#1f2329;">添加 UserInfoXMLMapper.xml</span></h5> 
  <p><span style="color:#fe2c24;">在resources目录下添加前面在配置文件里面写的xml路径</span></p> 
  <p><img alt="" height="367" src="https://images2.imgbox.com/c0/9a/nbvgNZVG_o.png" width="752"></p> 
  <p></p> 
  <p>在xml文件里面添加如下内容：</p> 
  <p>其中，<strong>mapper标签</strong>里面的<strong>namespace属性</strong>里面填的是 <strong>mapper接口的路径</strong></p> 
  <p></p> 
  <pre><code class="language-java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.example.demo.mapper.UserMapper"&gt;
    
&lt;/mapper&gt;</code></pre> 
  <p></p> 
  <div> 
   <span style="color:#1f2329;">查询所有⽤⼾的具体实现 ：</span> 
  </div> 
  <pre><code class="language-java">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.example.demo.mapper.UserInfoXMlMapper"&gt;
 &lt;select id="queryAllUser" resultType="com.example.demo.model.UserInfo"&gt;
 select username,`password`, age, gender, phone from userinfo
 &lt;/select&gt;
&lt;/mapper&gt;</code></pre> 
  <p><img alt="" height="334" src="https://images2.imgbox.com/41/ae/qDvSZ4BC_o.png" width="1200"></p> 
  <h5><span style="color:#1f2329;">单元测试</span></h5> 
  <pre><code class="language-java">@SpringBootTest
class UserInfoMapperTest {
 @Autowired
 private UserInfoMapper userInfoMapper;
 @Test
 void queryAllUser() {
 List&lt;UserInfo&gt; userInfoList = userInfoMapper.queryAllUser();
 System.out.println(userInfoList);
 }
 
}</code></pre> 
  <h4><img alt="" height="276" src="https://images2.imgbox.com/d8/2d/5K4tF88k_o.png" width="1200"></h4> 
  <h4><span style="color:#1f2329;">增删改查操作</span></h4> 
  <h5><span style="color:#1f2329;">增(Insert)</span></h5> 
  <div> 
   <span style="color:#1f2329;">UserInfoMapper接⼝</span> 
  </div> 
  <div></div> 
  <div> 
   <pre><code class="language-java">    Integer insertUser(UserInfo userInfo);</code></pre> 
  </div> 
  <div></div> 
  <div> 
   <div> 
    <span style="color:#1f2329;">UserInfoMapper.xml实现</span> 
   </div> 
  </div> 
  <div></div> 
  <div> 
   <pre><code class="language-java">&lt;insert id="insertUser"&gt;
 insert into userinfo (username, `password`, age, gender, phone) values (#
{username}, #{password}, #{age},#{gender},#{phone})
&lt;/insert&gt;</code></pre> 
   <div></div> 
   <div> 
    <span style="color:#646a73;">如果使⽤@Param设置参数名称的话, 使⽤⽅法和注解类似UserInfoMapper接⼝: </span> 
   </div> 
   <div> 
    <div></div> 
    <div> 
     <pre><code class="language-java"> Integer insertUser(@Param("userinfo") UserInfo userInfo);</code></pre> 
     <div> 
      <span style="color:#646a73;">UserInfoMapper.xml实现: </span> 
     </div> 
     <div></div> 
     <div> 
      <pre><code class="language-java">&lt;insert id="insertUser"&gt;
 insert into userinfo (username, `password`, age, gender, phone) values
 (#{userinfo.username},#{userinfo.password},#{userinfo.age},#
{userinfo.gender},#{userinfo.phone})
&lt;/insert&gt;</code></pre> 
      <hr> 
      <div> 
       <span style="color:#1f2329;">返回⾃增 id </span> 
      </div> 
      <div></div> 
      <div> 
       <span style="color:#1f2329;">接⼝定义不变, Mapper.xml 实现 设置useGeneratedKeys 和keyProperty属性</span> 
      </div> 
      <div></div> 
      <div> 
       <pre><code class="language-java">&lt;insert id="insertUser" useGeneratedKeys="true" keyProperty="id"&gt;
 insert into userinfo (username, `password`, age, gender, phone) values
 (#{userinfo.username},#{userinfo.password},#{userinfo.age},#
{userinfo.gender},#{userinfo.phone})
&lt;/insert</code></pre> 
       <div></div> 
       <h5><span style="color:#1f2329;">删(Delete)</span></h5> 
       <div> 
        <span style="color:#1f2329;">UserInfoMapper接⼝：</span> 
       </div> 
       <div></div> 
       <div> 
        <pre><code class="language-java">Integer deleteUser(Integer id);</code></pre> 
        <div> 
         <span style="color:#1f2329;">UserInfoMapper.xml实现:</span> 
        </div> 
        <div> 
         <pre><code class="language-java">&lt;delete id="deleteUser"&gt;
 delete from userinfo where id = #{id}
&lt;/delete&gt;</code></pre> 
         <h5><span style="color:#1f2329;">改(Update)</span></h5> 
         <div> 
          <span style="color:#1f2329;">UserInfoMapper接⼝: </span> 
         </div> 
         <div></div> 
         <div> 
          <pre><code class="language-java">Integer updateUser(UserInfo userInfo);</code></pre> 
          <div> 
           <span style="color:#1f2329;">UserInfoMapper.xml实现:</span> 
          </div> 
          <div></div> 
          <div> 
           <pre><code class="language-java">&lt;update id="updateUser"&gt;
 update userinfo set username=#{username} where id=#{id}
&lt;/update&gt;</code></pre> 
           <h5><span style="color:#1f2329;">查(Select) </span></h5> 
           <div></div> 
           <div> 
            <div> 
             <span style="color:#1f2329;">同样的, 使⽤XML 的⽅式进⾏查询, 也存在数据封装的问题我们把SQL语句进⾏简单修改, 查询更多的字段内容.</span> 
            </div> 
            <div> 
             <pre><code class="language-java">&lt;select id="queryAllUser" resultType="com.example.demo.model.UserInfo"&gt;
 select id, username,`password`, age, gender, phone, delete_flag, 
create_time, update_time from userinfo
&lt;/select&gt;</code></pre> 
             <div> 
              <span style="color:#1f2329;">运⾏结果: </span> 
             </div> 
             <div></div> 
             <div> 
              <img alt="" height="243" src="https://images2.imgbox.com/d2/6d/57rhwyj0_o.png" width="1200"> 
             </div> 
             <div></div> 
             <div> 
              <div> 
               <span style="color:#1f2329;">解决办法和注解类似: </span> 
              </div> 
              <ul><li><span style="color:#1f2329;">起别名 </span></li><li><span style="color:#1f2329;">结果映射 </span></li><li><span style="color:#1f2329;">开启驼峰命名</span></li></ul> 
              <div> 
               <span style="color:#1f2329;">其中1,3的解决办法和注解⼀样,不再多说, 接下来看下xml如果来写结果映射 </span> 
              </div> 
              <div> 
               <span style="color:#1f2329;">Mapper.xml</span> 
              </div> 
             </div> 
            </div> 
           </div> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div></div> 
   <div> 
    <pre><code class="language-java">&lt;resultMap id="BaseMap" type="com.example.demo.model.UserInfo"&gt;
 &lt;id column="id" property="id"&gt;&lt;/id&gt;
    &lt;result column="delete_flag" property="deleteFlag"&gt;&lt;/result&gt;
 &lt;result column="create_time" property="createTime"&gt;&lt;/result&gt;
 &lt;result column="update_time" property="updateTime"&gt;&lt;/result&gt;
&lt;/resultMap&gt;
&lt;select id="queryAllUser" resultMap="BaseMap"&gt;
 select id, username,`password`, age, gender, phone, delete_flag, 
create_time, update_time from userinfo
&lt;/select&gt;</code></pre> 
    <p><img alt="" height="472" src="https://images2.imgbox.com/5c/98/FTNIhg77_o.png" width="1200"></p> 
   </div> 
  </div> 
 </div> 
</div> 
<h4 style="background-color:transparent;"><span style="color:#1f2329;">#{} 和 ${}</span></h4> 
<div> 
 <span style="color:#1f2329;">MyBatis 参数赋值有两种⽅式, 咱们前⾯使⽤了 </span> 
 <span style="color:#1f2329;">#{} </span> 
 <span style="color:#1f2329;">进⾏赋值, 接下来我们看下⼆者的区别 </span> 
</div> 
<div></div> 
<div> 
 <h5><span style="color:#1f2329;">#{} 和${} 使⽤ </span></h5> 
</div> 
<div> 
 <strong><span style="color:#1f2329;">先看Interger类型的参数 </span></strong> 
</div> 
<div></div> 
<div> 
 <pre><code class="language-java">@Select("select username, `password`, age, gender, phone from userinfo where 
id= #{id} ")
UserInfo queryById(Integer id);</code></pre> 
 <div> 
  <span style="color:#1f2329;">观察我们打印的⽇志</span> 
 </div> 
 <div></div> 
 <div> 
  <img alt="" height="256" src="https://images2.imgbox.com/ad/ff/Bs2lVJEG_o.png" width="1200"> 
 </div> 
</div> 
<div> 
 <span style="color:#1f2329;">发现我们输出的SQL语句：</span> 
</div> 
<div></div> 
<div> 
 <pre><code class="language-sql">select username, `password`, age, gender, phone from userinfo where id= ?</code></pre> 
 <blockquote> 
  <div> 
   <span style="color:#1f2329;">我们输⼊的参数并没有在后⾯拼接，id的值是使⽤ </span> 
   <span style="color:#1f2329;">? </span> 
   <span style="color:#1f2329;">进⾏占位. 这种SQL 我们称之为"预编译SQL" </span> 
  </div> 
 </blockquote> 
 <div> 
  <div> 
   <strong><span style="color:#fe2c24;">我们把 #{} 改成 ${} 再观察打印的⽇志: </span></strong> 
  </div> 
 </div> 
</div> 
<pre><code class="language-sql">@Select("select username, `password`, age, gender, phone from userinfo where 
id= ${id} ")
UserInfo queryById(Integer id);</code></pre> 
<p><img alt="" height="325" src="https://images2.imgbox.com/8d/5f/SXdHX64p_o.png" width="1200"></p> 
<div> 
 <span style="color:#1f2329;">可以看到, 这次的参数是直接拼接在SQL语句中了. </span> 
</div> 
<div></div> 
<div> 
 <div> 
  <strong><span style="color:#1f2329;">接下来我们再看String类型的参数 </span></strong> 
 </div> 
 <div></div> 
 <div> 
  <pre><code class="language-java">@Select("select username, `pasword`, age, gender, phone from userinfo where 
username= #{name} ")
UserInfo queryByName(String name);</code></pre> 
  <div> 
   <span style="color:#1f2329;">观察我们打印的⽇志, 结果正常返回 </span> 
  </div> 
  <div></div> 
  <div> 
   <img alt="" height="290" src="https://images2.imgbox.com/0e/ba/weRPqwPr_o.png" width="1200"> 
  </div> 
 </div> 
</div> 
<p></p> 
<div> 
 <span style="color:#fe2c24;"><strong>我们把 #{} 改成 ${} 再观察打印的⽇志</strong></span> 
</div> 
<div></div> 
<div></div> 
<pre><code class="language-java">@Select("select username, `password`, age, gender, phone from userinfo where 
username= ${name} ")
UserInfo queryByName(String name);</code></pre> 
<p><img alt="" height="321" src="https://images2.imgbox.com/83/0d/hLEeiGYk_o.png" width="1200"></p> 
<p></p> 
<div> 
 <span style="color:#1f2329;">可以看到, 这次的参数依然是直接拼接在SQL语句中了, 但是字符串作为参数时, 需要添加引号 </span> 
 <span style="color:#1f2329;">'' </span> 
 <span style="color:#1f2329;">, 使 </span> 
</div> 
<div> 
 <span style="color:#1f2329;">⽤ </span> 
 <span style="color:#1f2329;">${} </span> 
 <span style="color:#1f2329;">不会拼接引号 </span> 
 <span style="color:#1f2329;">'' </span> 
 <span style="color:#1f2329;">, 导致程序报错.</span> 
</div> 
<div></div> 
<div> 
 <div> 
  <span style="color:#1f2329;">修改代码如下:</span> 
 </div> 
 <div></div> 
 <div> 
  <pre><code class="language-java">@Select("select username, `password`, age, gender, phone from userinfo where 
username= '${name}' ")
UserInfo queryByName(String name);</code></pre> 
  <div> 
   <span style="color:#1f2329;">再次运⾏, 结果正常返回 </span> 
  </div> 
  <div></div> 
  <div> 
   <img alt="" height="337" src="https://images2.imgbox.com/a3/fb/ngYnJlg9_o.png" width="1200"> 
  </div> 
  <div></div> 
  <div> 
   <blockquote> 
    <div> 
     <span style="color:#1f2329;">从上⾯两个例⼦可以看出: </span> 
    </div> 
    <div> 
     <span style="color:#1f2329;">#{} </span> 
     <span style="color:#1f2329;">使⽤的是预编译SQL, 通过 </span> 
     <span style="color:#1f2329;">? </span> 
     <span style="color:#1f2329;">占位的⽅式, 提前对SQL进⾏编译, 然后把参数填充到SQL语句中. </span> 
    </div> 
    <div> 
     <span style="color:#1f2329;">#{} </span> 
     <span style="color:#1f2329;">会根据参数类型, ⾃动拼接引号 </span> 
     <span style="color:#1f2329;">'' </span> 
     <span style="color:#1f2329;">. </span> 
    </div> 
    <div> 
     <span style="color:#1f2329;">${} </span> 
     <span style="color:#1f2329;">会直接进⾏字符替换, ⼀起对SQL进⾏编译. 如果参数为字符串, 需要加上引号 </span> 
     <span style="color:#1f2329;">'' </span> 
     <span style="color:#1f2329;">. </span> 
    </div> 
    <div></div> 
    <div> 
     <div> 
      <span style="color:#646a73;">参数为数字类型时, 也可以加上, 查询结果不变, 但是可能会导致索引失效, 性能下降.</span> 
     </div> 
    </div> 
   </blockquote> 
   <h5><span style="color:#1f2329;">#{} 和 ${}区别</span></h5> 
   <p><span style="color:#1f2329;">#{} 和 ${} 的区别就是<strong>预编译SQL</strong>和<strong>即时SQL </strong>的区别.</span></p> 
   <blockquote> 
    <p></p> 
    <div> 
     <span style="color:#646a73;">简单回顾: </span> 
    </div> 
    <div> 
     <span style="color:#646a73;">当客⼾发送⼀条SQL语句给服务器后, ⼤致流程如下: </span> 
    </div> 
    <ol><li><span style="color:#646a73;">解析语法和语义, 校验SQL语句是否正确 </span></li><li><span style="color:#646a73;">优化SQL语句, 制定执⾏计划 </span></li><li><span style="color:#646a73;">执⾏并返回结果 </span></li></ol> 
    <div> 
     <span style="color:#646a73;">⼀条 SQL如果⾛上述流程处理, 我们称之为 Immediate Statements(即时 SQL)</span> 
    </div> 
   </blockquote> 
  </div> 
 </div> 
</div> 
<p><strong> <span style="color:#1f2329;">性能更⾼</span></strong></p> 
<div> 
 <span style="color:#1f2329;">绝⼤多数情况下, 某⼀条 SQL 语句可能会被反复调⽤执⾏, 或者每次执⾏的时候只有个别的值不同(⽐ 如 select 的 where ⼦句值不同, update 的 set ⼦句值不同, insert 的 values 值不同). 如果每次都需要经过上⾯的语法解析, SQL优化、SQL编译等，则效率就明显不⾏了. </span> 
</div> 
<div></div> 
<div> 
 <img alt="" height="415" src="https://images2.imgbox.com/1b/94/TGDsRJgn_o.png" width="1078"> 
</div> 
<div></div> 
<div> 
 <div> 
  <span style="color:#1f2329;">预编译SQL，编译⼀次之后会将编译后的SQL语句缓存起来，后⾯再次执⾏这条语句时，不会再次编译(只是输⼊的参数不同), 省去了解析优化等过程, 以此来提⾼效率</span> 
 </div> 
 <div></div> 
 <div> 
  <div> 
   <strong><span style="color:#1f2329;">更安全(防⽌SQL注⼊)</span></strong> 
  </div> 
  <div></div> 
  <div> 
   <div> 
    <span style="color:#1f2329;">SQL注⼊：是通过操作输⼊的数据来修改事先定义好的SQL语句，以达到执⾏代码对服务器进⾏攻击的⽅法。 </span> 
   </div> 
   <div> 
    <span style="color:#646a73;">由于没有对⽤⼾输⼊进⾏充分检查，⽽SQL⼜是拼接⽽成，在⽤⼾输⼊参数时，在参数中添加⼀些 </span> 
   </div> 
   <div> 
    <span style="color:#646a73;">SQL关键字，达到改变SQL运⾏结果的⽬的，也可以完成恶意攻击。</span> 
   </div> 
   <div></div> 
   <div> 
    <div> 
     <span style="color:#1f2329;">sql 注⼊代码： </span> 
     <span style="color:#d83931;">' or 1='1</span> 
    </div> 
    <div></div> 
    <div> 
     <pre><code class="language-java">@Select("select username, `password`, age, gender, phone from userinfo where 
username= '${name}' ")
List&lt;UserInfo&gt; queryByName(String name);</code></pre> 
     <div> 
      <strong><span style="color:#1f2329;">测试代码: </span></strong> 
     </div> 
     <div></div> 
     <div> 
      <span style="color:#1f2329;">正常访问情况:</span> 
     </div> 
    </div> 
   </div> 
  </div> 
 </div> 
</div> 
<p> </p> 
<pre><code class="language-java">@Test
void queryByName() {
 List&lt;UserInfo&gt; userInfos = userInfoMapper.queryByName("admin");
 System.out.println(userInfos);
}</code></pre> 
<div> 
 <span style="color:#1f2329;">结果运⾏正常</span> 
</div> 
<div></div> 
<div> 
 <img alt="" height="284" src="https://images2.imgbox.com/5d/17/sEzdK60Y_o.png" width="1200"> 
</div> 
<div></div> 
<div> 
 <div> 
  <span style="color:#1f2329;">SQL注⼊场景:</span> 
 </div> 
 <div></div> 
 <div> 
  <pre><code class="language-java">@Test
void queryByName() {
 List&lt;UserInfo&gt; userInfos = userInfoMapper.queryByName("' or 1='1");
 System.out.println(userInfos);
}</code></pre> 
  <div> 
   <span style="color:#1f2329;">结果依然被正确查询出来了, 其中参数 or被当做了SQL语句的⼀部分</span> 
   <img alt="" height="328" src="https://images2.imgbox.com/34/57/JFPvWF7K_o.png" width="1200"> 
  </div> 
  <div> 
   <div> 
    <span style="color:#1f2329;">可以看出来, 查询的数据并不是⾃⼰想要的数据. 所以⽤于查询的字段，尽量使⽤ </span> 
    <span style="color:#1f2329;">#{} </span> 
    <span style="color:#1f2329;">预查询的⽅式 </span> 
   </div> 
   <blockquote> 
    <p><span style="color:#646a73;">SQL注⼊是⼀种⾮常常⻅的数据库攻击⼿段, SQL注⼊漏洞也是⽹络世界中最普遍的漏洞之⼀. 如果发⽣在⽤⼾登录的场景中, 密码输⼊为 ' or 1='1 </span><span style="color:#646a73;">, 就可能完成登录(不是⼀定会发⽣的场景, 需要看登录代码如何写)</span></p> 
   </blockquote> 
  </div> 
 </div> 
</div> 
<h5> <span style="color:#1f2329;">排序功能</span></h5> 
<div> 
 <span style="color:#1f2329;">从上⾯的例⼦中, 可以得出结论: ${} 会有SQL注⼊的⻛险, 所以我们尽量使⽤#{}完成查询 </span> 
</div> 
<div> 
 <span style="color:#1f2329;">既然如此, 是不是 ${} 就没有存在的必要性了呢? </span> 
</div> 
<div> 
 <span style="color:#1f2329;">当然不是. </span> 
</div> 
<div></div> 
<div> 
 <div> 
  <strong><span style="color:#1f2329;">Mapper实现</span></strong> 
 </div> 
 <div></div> 
 <div> 
  <pre><code class="language-java">@Select("select id, username, age, gender, phone, delete_flag, create_time, 
update_time " +
 "from userinfo order by id ${sort} ")
List&lt;UserInfo&gt; queryAllUserBySort(String sort);</code></pre> 
  <div> 
   <span style="color:#1f2329;">使⽤</span> 
   <span style="color:#1f2329;"> ${sort} </span> 
   <span style="color:#1f2329;">可以实现排序查询, ⽽使⽤ </span> 
   <span style="color:#1f2329;">#{sort} </span> 
   <span style="color:#1f2329;">就不能实现排序查询了.</span> 
  </div> 
  <div></div> 
  <div> 
   <blockquote> 
    <div> 
     <strong><span style="color:#646a73;">注意: 此处 sort 参数为String类型, 但是SQL语句中, 排序规则是不需要加引号 </span><span style="color:#646a73;">'' </span><span style="color:#646a73;">的, 所以此时的${sort} 也不加引号</span></strong> 
    </div> 
   </blockquote> 
   <div></div> 
   <div></div> 
   <div> 
    <span style="color:#1f2329;">我们把 </span> 
    <span style="color:#1f2329;">${} </span> 
    <span style="color:#1f2329;">改成 </span> 
    <span style="color:#1f2329;">#{}</span> 
   </div> 
   <div></div> 
   <div> 
    <pre><code class="language-java">@Select("select id, username, age, gender, phone, delete_flag, create_time, 
update_time " +
 "from userinfo order by id #{sort} ")
List&lt;UserInfo&gt; queryAllUserBySort(String sort);</code></pre> 
    <p><img alt="" height="444" src="https://images2.imgbox.com/45/8f/gH1ou1td_o.png" width="1200"></p> 
    <div> 
     <strong><span style="color:#1f2329;">可以发现, 当使⽤ </span><span style="color:#1f2329;">#{sort} </span><span style="color:#1f2329;">查询时, asc 前后⾃动给加了引号, 导致 sql 错误 </span></strong> 
    </div> 
    <blockquote> 
     <div> 
      <strong><span style="color:#646a73;">#{} </span><span style="color:#646a73;">会根据参数类型判断是否拼接引号 </span><span style="color:#646a73;">'' </span></strong> 
     </div> 
     <div> 
      <strong><span style="color:#646a73;">如果参数类型为String, 就会加上 引号. </span></strong> 
     </div> 
    </blockquote> 
    <div> 
     <span style="color:#1f2329;">除此之外, 还有表名作为参数时, 也只能使⽤ </span> 
     <span style="color:#1f2329;">${}</span> 
    </div> 
    <div></div> 
    <h5><span style="color:#1f2329;">like 查询 </span></h5> 
    <p><span style="color:#1f2329;">like 使⽤ #{} 报错</span></p> 
    <div> 
     <pre><code class="language-java">@Select("select id, username, age, gender, phone, delete_flag, create_time, 
update_time " +
 "from userinfo where username like '%#{key}%' ")
List&lt;UserInfo&gt; queryAllUserByLike(String key);</code></pre> 
     <div> 
      <span style="color:#1f2329;">把 #{} 改成 ${} 可以正确查出来, 但是${}存在SQL注⼊的问题, 所以不能直接使⽤ ${}. </span> 
     </div> 
     <div> 
      <span style="color:#1f2329;">解决办法: 使⽤ mysql 的内置函数 concat() 来处理，实现代码如下：</span> 
     </div> 
    </div> 
    <pre><code class="language-java">@Select("select id, username, age, gender, phone, delete_flag, create_time, 
update_time " +
 "from userinfo where username like concat('%',#{key},'%')")
List&lt;UserInfo&gt; queryAllUserByLike(String key);</code></pre> 
    <h4 style="background-color:transparent;"><strong><span style="color:#1f2329;">数据库连接池</span></strong></h4> 
    <p></p> 
    <div> 
     <span style="color:#1f2329;">数据库连接池负责分配、管理和释放数据库连接，它允许应⽤程序重复使⽤⼀个现有的数据库连接，⽽不是再重新建⽴⼀个.</span> 
    </div> 
    <div></div> 
    <div> 
     <img alt="" height="409" src="https://images2.imgbox.com/c9/36/LVrLQMRI_o.png" width="1200"> 
    </div> 
    <div></div> 
    <div> 
     <ul><li><span style="color:#1f2329;"><strong>没有使⽤数据库连接池的情况</strong>: 每次执⾏SQL语句, 要先创建⼀个新的连接对象, 然后执⾏SQL语句, SQ语句执⾏完, 再关闭连接对象释放资源. 这种重复的创建连接, 销毁连接⽐较消耗资源</span></li><li><span style="color:#1f2329;"><strong>使⽤数据库连接池的情况</strong>: 程序启动时, 会在数据库连接池中创建⼀定数量的Connection对象, 当客⼾ 请求数据库连接池, 会从数据库连接池中获取Connection对象, 然后执⾏SQL, SQL语句执⾏完, 再把 Connection归还给连接池</span></li></ul> 
    </div> 
   </div> 
  </div> 
 </div> 
</div> 
<div> 
 <strong><span style="color:#1f2329;">优点: </span></strong> 
</div> 
<ol><li><span style="color:#1f2329;">减少了⽹络开销 </span></li><li><span style="color:#1f2329;">资源重⽤ </span></li><li><span style="color:#1f2329;">提升了系统的性能</span></li></ol> 
<blockquote> 
 <div> 
  <span style="color:#1f2329;">常⻅的数据库连接池： </span> 
 </div> 
 <ul><li><span style="color:#1f2329;">C3P0 </span></li><li><span style="color:#1f2329;">DBCP </span></li><li><span style="color:#1f2329;">Druid </span></li><li><span style="color:#1f2329;">Hikari </span></li></ul> 
 <div> 
  <span style="color:#1f2329;">⽬前⽐较流⾏的是 Hikari, Druid </span> 
 </div> 
 <div> 
  <span style="color:#1f2329;">Hikari : SpringBoot默认使⽤的数据库连接池 </span> 
 </div> 
</blockquote> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb795c0deca86b99b406f7491a03c707/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python —— 异常、模块与包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/560aba718874b59c1101bfcbb3bd2e3b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python—爬虫爬取电影页面实例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>