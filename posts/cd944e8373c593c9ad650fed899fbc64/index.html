<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【JavaScript】深入理解Promise：从基础概念到进阶用法、手写promise - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/cd944e8373c593c9ad650fed899fbc64/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【JavaScript】深入理解Promise：从基础概念到进阶用法、手写promise">
  <meta property="og:description" content="🔥 个人主页：空白诗 文章目录 一、引言二、Promise概述1. Promise的定义2. Promise的用途3. Promise的三种状态4. Promise的构造函数和基础结构5. Promise的优点6. Promise的实例方法7. Promise的静态方法 三、Promise的基本用法1. 创建一个Promise2. `then`方法3. `catch`方法4. `finally`方法5. 链式调用6. 示例代码 四、Promise的进阶用法1. `Promise.all`2. `Promise.race`3. `Promise.allSettled`4. `Promise.any`5. 使用示例 五、如何手写一个简单的Promise1. 实现Promise的基本结构2. 实现`then`方法3. 实现`catch`方法4. 实现`finally`方法5. 完整的Promise实现 六、Promise的实际应用示例1. 异步数据加载2. 多个异步任务的并行处理3. 顺序执行多个异步任务4. 处理并发的异步任务 七、总结 一、引言 在现代Web开发中，异步编程是不可避免的。无论是发起网络请求、读取文件、定时操作，还是处理事件，异步操作都无处不在。而在众多异步编程解决方案中，Promise因其简洁易用、链式调用和更好的错误处理机制，成为了开发者们的首选。
Promise是一种用于处理异步操作的JavaScript对象，它代表了一个在未来某个时间点才会完成（或失败）的操作及其结果。相比于传统的回调函数，Promise提供了一种更加优雅和便捷的方式来处理异步任务，从而避免了“回调地狱”的问题。
本文将详细讲解Promise的概念、基本用法和进阶用法，并最终手写一个简单的Promise实现。通过这篇文章，读者将不仅能够深入理解Promise的工作原理，还能学会如何在实际项目中有效地使用Promise处理异步操作。
二、Promise概述 1. Promise的定义 Promise是JavaScript中的一种对象，用于表示一个在未来某个时间点才会完成（或失败）的异步操作及其结果。它提供了一种处理异步操作的统一接口，使代码更加简洁和易于理解。与传统的回调函数相比，Promise能够更好地处理异步操作的结果和错误。
2. Promise的用途 Promise广泛用于处理各种异步操作，特别是在以下场景中：
网络请求：使用fetch或XMLHttpRequest进行Ajax调用。文件操作：读取文件、写入文件等I/O操作。定时操作：使用setTimeout或setInterval进行延时操作。事件处理：处理用户事件，如点击、输入等。数据库操作：执行数据库查询、插入、更新等操作。 通过使用Promise，开发者可以避免嵌套的回调函数（即“回调地狱”），从而使代码更加线性和易读。
3. Promise的三种状态 Promise有三种状态：
Pending（待定）：初始状态，操作尚未完成。Fulfilled（已完成）：操作成功完成，并有一个结果值。Rejected（已拒绝）：操作失败，并有一个失败原因。 一个Promise对象只能从Pending状态转变为Fulfilled状态或Rejected状态，并且状态一旦改变，就不能再改变。这种不可变性保证了Promise的可靠性和可预测性。
4. Promise的构造函数和基础结构 创建一个Promise实例需要传递一个执行函数，该函数接收两个参数：resolve和reject。这两个参数分别是函数，用于将Promise的状态从Pending变为Fulfilled或Rejected。
const promise = new Promise((resolve, reject) =&gt; { // 异步操作 if (操作成功) { resolve(成功的结果); } else { reject(失败的原因); } }); 在这个基础结构中，resolve和reject函数分别用于处理操作成功和失败的情况。当异步操作完成时，调用resolve将Promise的状态变为Fulfilled，调用reject将状态变为Rejected。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-10T10:56:08+08:00">
    <meta property="article:modified_time" content="2024-07-10T10:56:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【JavaScript】深入理解Promise：从基础概念到进阶用法、手写promise</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/97/dc/LTVvHe4X_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <strong><font color="red">🔥 个人主页：<a href="https://blog.csdn.net/m0_52827996?spm=1010.2135.3001.5343">空白诗</a></font></strong> 
</center> 
<p><img src="https://images2.imgbox.com/55/de/XYjQHFYs_o.gif" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_11" rel="nofollow">一、引言</a></li><li><a href="#Promise_22" rel="nofollow">二、Promise概述</a></li><li><ul><li><a href="#1_Promise_24" rel="nofollow">1. Promise的定义</a></li><li><a href="#2_Promise_28" rel="nofollow">2. Promise的用途</a></li><li><a href="#3_Promise_40" rel="nofollow">3. Promise的三种状态</a></li><li><a href="#4_Promise_50" rel="nofollow">4. Promise的构造函数和基础结构</a></li><li><a href="#5_Promise_67" rel="nofollow">5. Promise的优点</a></li><li><a href="#6_Promise_76" rel="nofollow">6. Promise的实例方法</a></li><li><a href="#7_Promise_97" rel="nofollow">7. Promise的静态方法</a></li></ul> 
   </li><li><a href="#Promise_119" rel="nofollow">三、Promise的基本用法</a></li><li><ul><li><a href="#1_Promise_121" rel="nofollow">1. 创建一个Promise</a></li><li><a href="#2_then_136" rel="nofollow">2. `then`方法</a></li><li><a href="#3_catch_151" rel="nofollow">3. `catch`方法</a></li><li><a href="#4_finally_165" rel="nofollow">4. `finally`方法</a></li><li><a href="#5__182" rel="nofollow">5. 链式调用</a></li><li><a href="#6__200" rel="nofollow">6. 示例代码</a></li></ul> 
   </li><li><a href="#Promise_235" rel="nofollow">四、Promise的进阶用法</a></li><li><ul><li><a href="#1_Promiseall_237" rel="nofollow">1. `Promise.all`</a></li><li><a href="#2_Promiserace_255" rel="nofollow">2. `Promise.race`</a></li><li><a href="#3_PromiseallSettled_275" rel="nofollow">3. `Promise.allSettled`</a></li><li><a href="#4_Promiseany_294" rel="nofollow">4. `Promise.any`</a></li><li><a href="#5__310" rel="nofollow">5. 使用示例</a></li></ul> 
   </li><li><a href="#Promise_367" rel="nofollow">五、如何手写一个简单的Promise</a></li><li><ul><li><a href="#1_Promise_371" rel="nofollow">1. 实现Promise的基本结构</a></li><li><a href="#2_then_424" rel="nofollow">2. 实现`then`方法</a></li><li><a href="#3_catch_482" rel="nofollow">3. 实现`catch`方法</a></li><li><a href="#4_finally_507" rel="nofollow">4. 实现`finally`方法</a></li><li><a href="#5_Promise_540" rel="nofollow">5. 完整的Promise实现</a></li></ul> 
   </li><li><a href="#Promise_696" rel="nofollow">六、Promise的实际应用示例</a></li><li><ul><li><a href="#1__698" rel="nofollow">1. 异步数据加载</a></li><li><a href="#2__734" rel="nofollow">2. 多个异步任务的并行处理</a></li><li><a href="#3__777" rel="nofollow">3. 顺序执行多个异步任务</a></li><li><a href="#4__828" rel="nofollow">4. 处理并发的异步任务</a></li></ul> 
   </li><li><a href="#_868" rel="nofollow">七、总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/0d/30/xZB9MkpR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_11"></a>一、引言</h3> 
<p>在现代Web开发中，异步编程是不可避免的。无论是发起网络请求、读取文件、定时操作，还是处理事件，异步操作都无处不在。而在众多异步编程解决方案中，Promise因其简洁易用、链式调用和更好的错误处理机制，成为了开发者们的首选。</p> 
<p>Promise是一种用于处理异步操作的JavaScript对象，它代表了一个在未来某个时间点才会完成（或失败）的操作及其结果。相比于传统的回调函数，Promise提供了一种更加优雅和便捷的方式来处理异步任务，从而避免了“回调地狱”的问题。</p> 
<p>本文将详细讲解Promise的概念、基本用法和进阶用法，并最终手写一个简单的Promise实现。通过这篇文章，读者将不仅能够深入理解Promise的工作原理，还能学会如何在实际项目中有效地使用Promise处理异步操作。</p> 
<hr> 
<h3><a id="Promise_22"></a>二、Promise概述</h3> 
<h4><a id="1_Promise_24"></a>1. Promise的定义</h4> 
<p>Promise是JavaScript中的一种对象，用于表示一个在未来某个时间点才会完成（或失败）的异步操作及其结果。它提供了一种处理异步操作的统一接口，使代码更加简洁和易于理解。与传统的回调函数相比，Promise能够更好地处理异步操作的结果和错误。</p> 
<h4><a id="2_Promise_28"></a>2. Promise的用途</h4> 
<p>Promise广泛用于处理各种异步操作，特别是在以下场景中：</p> 
<ul><li><strong>网络请求</strong>：使用<code>fetch</code>或<code>XMLHttpRequest</code>进行Ajax调用。</li><li><strong>文件操作</strong>：读取文件、写入文件等I/O操作。</li><li><strong>定时操作</strong>：使用<code>setTimeout</code>或<code>setInterval</code>进行延时操作。</li><li><strong>事件处理</strong>：处理用户事件，如点击、输入等。</li><li><strong>数据库操作</strong>：执行数据库查询、插入、更新等操作。</li></ul> 
<p>通过使用Promise，开发者可以避免嵌套的回调函数（即“回调地狱”），从而使代码更加线性和易读。</p> 
<h4><a id="3_Promise_40"></a>3. Promise的三种状态</h4> 
<p>Promise有三种状态：</p> 
<ol><li><strong>Pending（待定）</strong>：初始状态，操作尚未完成。</li><li><strong>Fulfilled（已完成）</strong>：操作成功完成，并有一个结果值。</li><li><strong>Rejected（已拒绝）</strong>：操作失败，并有一个失败原因。</li></ol> 
<p>一个Promise对象只能从Pending状态转变为Fulfilled状态或Rejected状态，并且状态一旦改变，就不能再改变。这种不可变性保证了Promise的可靠性和可预测性。</p> 
<h4><a id="4_Promise_50"></a>4. Promise的构造函数和基础结构</h4> 
<p>创建一个Promise实例需要传递一个执行函数，该函数接收两个参数：resolve和reject。这两个参数分别是函数，用于将Promise的状态从Pending变为Fulfilled或Rejected。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 异步操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>操作成功<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>成功的结果<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">reject</span><span class="token punctuation">(</span>失败的原因<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在这个基础结构中，<code>resolve</code>和<code>reject</code>函数分别用于处理操作成功和失败的情况。当异步操作完成时，调用<code>resolve</code>将Promise的状态变为Fulfilled，调用<code>reject</code>将状态变为Rejected。</p> 
<h4><a id="5_Promise_67"></a>5. Promise的优点</h4> 
<p>Promise具有以下几个显著的优点：</p> 
<ul><li><strong>链式调用</strong>：可以通过链式调用<code>then</code>方法来处理异步操作的结果，使代码更加简洁。</li><li><strong>错误处理</strong>：通过<code>catch</code>方法统一处理错误，避免了多个回调函数中重复的错误处理代码。</li><li><strong>状态管理</strong>：Promise的状态一旦改变，就不能再变，这种不可变性保证了异步操作结果的可靠性。</li><li><strong>组合操作</strong>：Promise提供了多种组合方法，如<code>Promise.all</code>、<code>Promise.race</code>、<code>Promise.allSettled</code>、<code>Promise.any</code>，使得处理多个异步操作变得更加方便。</li></ul> 
<h4><a id="6_Promise_76"></a>6. Promise的实例方法</h4> 
<ul><li><strong><code>then</code>方法</strong>：用于在Promise状态变为<code>Fulfilled</code>时，执行指定的回调函数，并返回一个新的Promise实例。</li><li><strong><code>catch</code>方法</strong>：用于在Promise状态变为<code>Rejected</code>时，执行指定的回调函数，并返回一个新的Promise实例。</li><li><strong><code>finally</code>方法</strong>：用于在Promise状态变为<code>Fulfilled</code>或<code>Rejected</code>时，执行指定的回调函数，并返回一个新的Promise实例。</li></ul> 
<pre><code class="prism language-javascript">promise
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理成功结果</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理错误</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 无论成功还是失败，都会执行的操作</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>通过这些实例方法，开发者可以灵活地处理异步操作的结果和错误，并执行最终的清理操作。</p> 
<h4><a id="7_Promise_97"></a>7. Promise的静态方法</h4> 
<table><thead><tr><th>方法名</th><th>描述</th><th>示例代码</th></tr></thead><tbody><tr><td><code>Promise.resolve</code></td><td>返回一个状态为<code>Fulfilled</code>的Promise实例。</td><td><code>Promise.resolve(42).then(value =&gt; console.log(value));</code></td></tr><tr><td><code>Promise.reject</code></td><td>返回一个状态为<code>Rejected</code>的Promise实例。</td><td><code>Promise.reject(new Error('Error')).catch(error =&gt; console.error(error));</code></td></tr><tr><td><code>Promise.all</code></td><td>接受一个Promise数组，返回一个新的Promise实例。当所有Promise都变为<code>Fulfilled</code>时，状态变为<code>Fulfilled</code>；如果有任何一个Promise变为<code>Rejected</code>，状态变为<code>Rejected</code>。</td><td><code>Promise.all([promise1, promise2]).then(values =&gt; console.log(values)).catch(error =&gt; console.error(error));</code></td></tr><tr><td><code>Promise.race</code></td><td>接受一个Promise数组，返回一个新的Promise实例。当第一个Promise变为<code>Fulfilled</code>或<code>Rejected</code>时，状态立即变为<code>Fulfilled</code>或<code>Rejected</code>。</td><td><code>Promise.race([promise1, promise2]).then(value =&gt; console.log(value)).catch(error =&gt; console.error(error));</code></td></tr><tr><td><code>Promise.allSettled</code></td><td>接受一个Promise数组，返回一个新的Promise实例。当所有Promise都变为<code>Fulfilled</code>或<code>Rejected</code>时，状态变为<code>Fulfilled</code>。</td><td><code>Promise.allSettled([promise1, promise2]).then(results =&gt; console.log(results));</code></td></tr><tr><td><code>Promise.any</code></td><td>接受一个Promise数组，返回一个新的Promise实例。当任意一个Promise变为<code>Fulfilled</code>时，状态变为<code>Fulfilled</code>；如果所有Promise都变为<code>Rejected</code>，状态变为<code>Rejected</code>。</td><td><code>Promise.any([promise1, promise2]).then(value =&gt; console.log(value)).catch(error =&gt; console.error(error));</code></td></tr></tbody></table> 
<p>这些静态方法为处理多个异步操作提供了强大的工具，使得开发者可以根据具体需求选择合适的方法来组合Promise。</p> 
<p>综上所述，Promise提供了一种简洁、高效、可维护的方式来处理异步操作，使得JavaScript的异步编程变得更加便捷和强大。</p> 
<hr> 
<h3><a id="Promise_119"></a>三、Promise的基本用法</h3> 
<h4><a id="1_Promise_121"></a>1. 创建一个Promise</h4> 
<p>创建一个Promise实例时，需要传递一个执行函数，该函数接收两个参数：<code>resolve</code>和<code>reject</code>。这两个参数分别是函数，用于将Promise的状态从Pending变为Fulfilled或Rejected。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 异步操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>操作成功<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>成功的结果<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">reject</span><span class="token punctuation">(</span>失败的原因<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_then_136"></a>2. <code>then</code>方法</h4> 
<p><code>then</code>方法用于在Promise状态变为Fulfilled时，执行指定的回调函数。它接收两个参数：第一个是处理Fulfilled状态的回调函数，第二个是处理Rejected状态的回调函数（可选）。</p> 
<pre><code class="prism language-javascript">promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'操作成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'操作失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3_catch_151"></a>3. <code>catch</code>方法</h4> 
<p><code>catch</code>方法用于在Promise状态变为Rejected时，执行指定的回调函数。它是<code>then</code>方法的语法糖，专门用于处理Rejected状态。</p> 
<pre><code class="prism language-javascript">promise
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'操作成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'操作失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4_finally_165"></a>4. <code>finally</code>方法</h4> 
<p><code>finally</code>方法用于在Promise状态变为Fulfilled或Rejected时，执行指定的回调函数。无论Promise的最终状态如何，<code>finally</code>中的回调函数都会执行。</p> 
<pre><code class="prism language-javascript">promise
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'操作成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'操作失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'操作结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5__182"></a>5. 链式调用</h4> 
<p>Promise支持链式调用，这意味着可以在一个<code>then</code>方法之后继续调用另一个<code>then</code>方法。这使得处理多个异步操作变得更加方便。</p> 
<pre><code class="prism language-javascript">promise
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一次操作成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> 另一个Promise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第二次操作成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'操作失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="6__200"></a>6. 示例代码</h4> 
<p>以下是一个完整的示例代码，展示了如何创建一个Promise并使用<code>then</code>、<code>catch</code>和<code>finally</code>方法来处理异步操作的结果和错误。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">asyncOperation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">const</span> success <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'操作成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'操作失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">asyncOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'操作结束'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在这个示例中，<code>asyncOperation</code>函数返回一个Promise，它模拟了一个异步操作，并在1秒钟后根据随机数决定操作是成功还是失败。<code>then</code>、<code>catch</code>和<code>finally</code>方法分别用于处理操作的成功结果、错误和最终的清理工作。</p> 
<hr> 
<h3><a id="Promise_235"></a>四、Promise的进阶用法</h3> 
<h4><a id="1_Promiseall_237"></a>1. <code>Promise.all</code></h4> 
<p><code>Promise.all</code>接受一个Promise数组，返回一个新的Promise实例。当所有Promise都变为Fulfilled时，新Promise的状态变为Fulfilled，并且它的结果是一个包含所有Promise结果的数组；如果有任何一个Promise变为Rejected，新Promise的状态变为Rejected，并且它的结果是第一个被拒绝的Promise的原因。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">values</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3, 42, "foo"]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_Promiserace_255"></a>2. <code>Promise.race</code></h4> 
<p><code>Promise.race</code>接受一个Promise数组，返回一个新的Promise实例。当第一个Promise变为Fulfilled或Rejected时，新Promise的状态立即变为Fulfilled或Rejected，其结果就是第一个完成的Promise的结果。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> promise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "two"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3_PromiseallSettled_275"></a>3. <code>Promise.allSettled</code></h4> 
<p><code>Promise.allSettled</code>接受一个Promise数组，返回一个新的Promise实例。当所有Promise都变为Fulfilled或Rejected时，新Promise的状态变为Fulfilled，并且它的结果是一个对象数组，每个对象表示对应的Promise的状态和结果或原因。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    results<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功:'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败:'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4_Promiseany_294"></a>4. <code>Promise.any</code></h4> 
<p><code>Promise.any</code>接受一个Promise数组，返回一个新的Promise实例。当任意一个Promise变为Fulfilled时，新Promise的状态变为Fulfilled，并且它的结果就是第一个成功的Promise的结果；如果所有Promise都变为Rejected，新Promise的状态变为Rejected，并且它的结果是一个包含所有被拒绝原因的AggregateError对象。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> promise1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> promise3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>promise1<span class="token punctuation">,</span> promise2<span class="token punctuation">,</span> promise3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "成功"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// AggregateError: All promises were rejected</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5__310"></a>5. 使用示例</h4> 
<p>以下是一个综合示例，展示了如何使用<code>Promise.all</code>、<code>Promise.race</code>、<code>Promise.allSettled</code>和<code>Promise.any</code>处理多个异步操作。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> fetchData1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token string">'数据1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fetchData2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token string">'数据2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fetchData3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>reject<span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token string">'数据3失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.all</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fetchData1<span class="token punctuation">,</span> fetchData2<span class="token punctuation">,</span> fetchData3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">values</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise.all结果:'</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Promise.all错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.race</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fetchData1<span class="token punctuation">,</span> fetchData2<span class="token punctuation">,</span> fetchData3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise.race结果:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Promise.race错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.allSettled</span>
Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fetchData1<span class="token punctuation">,</span> fetchData2<span class="token punctuation">,</span> fetchData3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">results</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise.allSettled结果:'</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.any</span>
Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fetchData1<span class="token punctuation">,</span> fetchData2<span class="token punctuation">,</span> fetchData3<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Promise.any结果:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Promise.any错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个示例展示了如何使用不同的Promise静态方法来处理多个异步操作。<code>fetchData1</code>、<code>fetchData2</code>和<code>fetchData3</code>是三个模拟异步操作的Promise，通过不同的方法组合来展示它们的结果和错误处理。</p> 
<hr> 
<h3><a id="Promise_367"></a>五、如何手写一个简单的Promise</h3> 
<p>为了更深入理解Promise的工作原理，我们将手写一个简单的Promise实现，涵盖Promise的基本功能，包括状态管理、<code>then</code>方法、<code>catch</code>方法和<code>finally</code>方法。</p> 
<h4><a id="1_Promise_371"></a>1. 实现Promise的基本结构</h4> 
<p>首先，我们需要定义Promise的三种状态：<code>Pending</code>、<code>Fulfilled</code>和<code>Rejected</code>。接下来，我们定义一个Promise类，并在构造函数中初始化状态和结果。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义静态常量，表示Promise的三种状态</span>
    <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span> <span class="token comment">// 待定态</span>
    <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">// 已完成态</span>
    <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">// 已拒绝态</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span> <span class="token comment">// 初始状态为待定态</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 初始结果值为null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 初始回调数组为空</span>

        <span class="token comment">// 定义一个resolve函数，用于将Promise的状态改为已完成态</span>
        <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    callback<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义一个reject函数，用于将Promise的状态改为已拒绝态</span>
        <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> reason<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    callback<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 尝试执行executor函数，并传入resolve和reject作为参数</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果executor执行过程中抛出错误，则调用reject函数</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...then, catch, finally 方法待实现</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这段代码中，<code>MyPromise</code>类模拟了Promise的基本行为，包括创建Promise时传入的executor函数，以及resolve和reject两个函数用于改变Promise的状态。同时，还包含了处理executor执行过程中可能抛出的错误。</p> 
<h4><a id="2_then_424"></a>2. 实现<code>then</code>方法</h4> 
<p><code>then</code>方法用于在Promise状态变为Fulfilled或Rejected时，执行指定的回调函数。我们需要处理同步和异步执行的情况，并返回一个新的Promise。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...constructor 和其他代码</span>

    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建一个新的Promise实例并返回</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 定义一个处理回调的函数</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> state<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 执行相应的回调函数，并获取其返回值</span>
                    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 如果返回值是一个Promise实例，则等待其解决或拒绝</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 如果返回值不是Promise，则直接解决新的Promise</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 如果执行回调函数时抛出错误，则拒绝新的Promise</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token comment">// 根据当前Promise的状态，执行相应的回调函数</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise已成功，则异步执行onFulfilled回调</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise已失败，则异步执行onRejected回调</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise还处于待定状态，则将回调函数保存到callbacks数组中</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...catch, finally 方法待实现</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个实现中，<code>then</code>方法接受两个参数：<code>onFulfilled</code>和<code>onRejected</code>，它们分别是Promise成功和失败时的回调函数。<code>then</code>方法会返回一个新的Promise实例。</p> 
<p>如果当前Promise已经成功或失败，<code>then</code>方法会异步执行相应的回调函数，并根据回调函数的返回值来解决或拒绝返回的新的Promise。</p> 
<p>如果当前Promise还处于待定状态，<code>then</code>方法会将回调函数保存到<code>callbacks</code>数组中，等待Promise状态改变时再执行。</p> 
<p>使用<code>setTimeout</code>是为了确保回调函数的执行是异步的，这符合Promise的规范。</p> 
<h4><a id="3_catch_482"></a>3. 实现<code>catch</code>方法</h4> 
<p>在<code>MyPromise</code>类中，<code>catch</code>方法是一个用于处理Promise被拒绝（rejected）情况的便捷方法。它实际上是对<code>then</code>方法的简化调用，只关注拒绝情况的回调函数。因此可以说：<code>catch</code>方法是<code>then</code>方法的语法糖，只需调用<code>then</code>方法并将<code>onRejected</code>作为参数传递。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...constructor, then method, 和其他代码</span>

    <span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 调用this.then方法，传入null作为成功的回调函数（因为不关心成功情况），</span>
        <span class="token comment">// 并传入onRejected作为拒绝的回调函数。</span>
        <span class="token comment">// 然后返回this.then方法的结果，它是一个新的Promise实例。</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...finally方法待实现</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个实现中，<code>catch</code>方法只接受一个参数<code>onRejected</code>，它是Promise被拒绝时的回调函数。<code>catch</code>方法会调用<code>then</code>方法，并传入<code>null</code>作为第一个参数（表示不关心Promise成功的情况），然后传入<code>onRejected</code>作为第二个参数。最后，<code>catch</code>方法会返回<code>then</code>方法的结果，即一个新的Promise实例。</p> 
<p>这样，当Promise被拒绝时，<code>catch</code>方法提供的<code>onRejected</code>回调函数会被调用，并且任何在<code>catch</code>方法中返回的Promise都会成为<code>catch</code>方法返回的Promise的结果。如果<code>onRejected</code>回调函数本身返回一个Promise，那么<code>catch</code>方法返回的Promise将会等待这个返回的Promise解决或拒绝。</p> 
<h4><a id="4_finally_507"></a>4. 实现<code>finally</code>方法</h4> 
<p>在<code>MyPromise</code>类中，<code>finally</code>方法是一个用于指定不论Promise最终是fulfilled还是rejected，都会执行的操作的方法。它返回一个Promise。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...constructor, then method, catch method, 和其他代码</span>

    <span class="token function">finally</span><span class="token punctuation">(</span>onFinally<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 调用this.then方法，传入两个回调函数：</span>
        <span class="token comment">// 第一个回调函数处理fulfilled情况，调用onFinally()并执行完毕后返回value；</span>
        <span class="token comment">// 第二个回调函数处理rejected情况，调用onFinally()并执行完毕后抛出reason。</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
            <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 当Promise成功解决时执行</span>
                <span class="token function">onFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行finally中的回调函数</span>
                <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token comment">// 返回原始值，以便链式调用中的下一个then可以使用</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 当Promise被拒绝时执行</span>
                <span class="token function">onFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行finally中的回调函数</span>
                <span class="token keyword">throw</span> reason<span class="token punctuation">;</span> <span class="token comment">// 抛出拒绝的原因，以便链式调用中的下一个catch可以捕获</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个实现中，<code>finally</code>方法接受一个参数<code>onFinally</code>，它是一个没有参数的函数，表示无论Promise最终状态如何都需要执行的操作。<code>finally</code>方法通过调用<code>then</code>方法来实现，它传入两个回调函数：一个用于处理fulfilled情况，另一个用于处理rejected情况。在这两个回调函数中，都执行了<code>onFinally()</code>，以确保无论Promise的状态如何，<code>onFinally</code>都会被调用。然后，根据Promise的状态，返回相应的值或抛出相应的错误。</p> 
<p>这样，使用<code>finally</code>方法可以让我们在Promise链的末尾添加一些清理操作，比如关闭文件、释放资源等，而不用担心这些操作会因为Promise的状态而改变。</p> 
<h4><a id="5_Promise_540"></a>5. 完整的Promise实现</h4> 
<p>以下是一个完整的Promise实现，包括状态管理、<code>then</code>、<code>catch</code>和<code>finally</code>方法。</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 定义一个简单的Promise类</span>
<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义Promise的三种状态常量</span>
    <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span> <span class="token comment">// 等待状态</span>
    <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">// 成功状态</span>
    <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">// 失败状态</span>

    <span class="token comment">// 构造函数，executor是执行器函数，接收resolve和reject两个参数</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span> <span class="token comment">// 初始状态为pending</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 存储Promise的结果值或原因</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 存储成功和失败的回调函数</span>

        <span class="token comment">// 定义resolve函数，将Promise状态变为成功</span>
        <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 只有在pending状态时才能改变状态</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span> <span class="token comment">// 将状态变为成功</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// 存储成功的结果值</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 执行所有成功的回调</span>
                    callback<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 定义reject函数，将Promise状态变为失败</span>
        <span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 只有在pending状态时才能改变状态</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> MyPromise<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span> <span class="token comment">// 将状态变为失败</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>result <span class="token operator">=</span> reason<span class="token punctuation">;</span> <span class="token comment">// 存储失败的原因</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">callback</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 执行所有失败的回调</span>
                    callback<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 执行传入的executor函数，传入resolve和reject函数，并捕获异常</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果executor执行过程中抛出异常，直接调用reject</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// then方法，接收成功和失败的回调函数</span>
    <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 返回一个新的Promise实例</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理回调函数的执行和状态传递</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> state<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行回调函数获取返回值</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果返回值是Promise，等待其状态变化</span>
                        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 否则直接将返回值作为新Promise的成功结果</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获异常并将异常作为新Promise的失败结果</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise已经是fulfilled状态，异步执行onFulfilled回调</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> MyPromise<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise已经是rejected状态，异步执行onRejected回调</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果当前Promise仍处于pending状态，将回调函数存储起来等待执行</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// catch方法，用于捕获Promise链中的错误，等同于then(null, onRejected)</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// finally方法，用于在Promise执行结束后无论结果如何都会执行的回调</span>
    <span class="token function">finally</span><span class="token punctuation">(</span>onFinally<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
            <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">onFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行finally回调</span>
                <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token comment">// 继续传递成功的结果值</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">onFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行finally回调</span>
                <span class="token keyword">throw</span> reason<span class="token punctuation">;</span> <span class="token comment">// 继续传递失败的原因</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 示例用法</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> random <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>random <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功值'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败原因'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">'处理后的值'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'失败:'</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'处理失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'处理后的结果:'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
    <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'捕获到的错误:'</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无论如何都会执行的操作'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>成功情况：</p> 
<pre><code class="prism language-bash">成功: 成功值
处理后的结果: 处理后的值
无论如何都会执行的操作
</code></pre> 
<p>失败情况：</p> 
<pre><code class="prism language-bash">失败: 失败原因
捕获到的错误: callback is not a <span class="token keyword">function</span>
无论如何都会执行的操作
</code></pre> 
<p>通过这种方式，我们实现了一个简化版的Promise，涵盖了Promise的核心功能。这个实现可以帮助我们更好地理解Promise的工作原理和异步编程的机制。</p> 
<hr> 
<h3><a id="Promise_696"></a>六、Promise的实际应用示例</h3> 
<h4><a id="1__698"></a>1. 异步数据加载</h4> 
<p>Promise常用于处理异步数据加载，例如从服务器获取数据并在页面上展示：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 定义一个函数，用于从服务器获取数据</span>
<span class="token keyword">function</span> <span class="token function">fetchDataFromServer</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用fetch API发送请求</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 检查网络响应是否成功</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回JSON数据</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Network response was not ok.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 网络请求错误处理</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 将获取的数据传递给resolve</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获异常并传递给reject</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用示例</span>
<span class="token function">fetchDataFromServer</span><span class="token punctuation">(</span><span class="token string">'https://api.example.com/data'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功获取数据:'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印成功获取的数据</span>
        <span class="token comment">// 在页面上展示数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'获取数据失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印获取数据失败的错误信息</span>
        <span class="token comment">// 处理错误情况</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码定义了一个函数<code>fetchDataFromServer</code>，该函数接收一个URL作为参数，使用<code>fetch</code> API异步从该URL获取数据，并将获取的数据解析为JSON格式。</p> 
<p>如果数据成功获取并解析，函数将通过Promise的<code>resolve</code>方法返回这些数据；如果在获取数据或解析数据过程中发生错误，函数将通过Promise的<code>reject</code>方法返回错误信息。这样，调用者可以使用<code>.then()</code>和<code>.catch()</code>方法来处理成功获取数据和获取数据失败的情况。</p> 
<h4><a id="2__734"></a>2. 多个异步任务的并行处理</h4> 
<p>Promise.all方法用于处理多个异步任务，等待所有任务完成后进行统一处理：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 定义一个函数，模拟从服务器获取用户数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUsers</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'Charlie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步获取用户数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个函数，模拟从服务器获取文章数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchPosts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Post 1'</span><span class="token punctuation">,</span> <span class="token string">'Post 2'</span><span class="token punctuation">,</span> <span class="token string">'Post 3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步获取文章数据</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.all处理多个异步任务</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">fetchUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">fetchPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>users<span class="token punctuation">,</span> posts<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'所有数据加载完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所有数据加载完成</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户列表:'</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印用户列表</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文章列表:'</span><span class="token punctuation">,</span> posts<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印文章列表</span>
        <span class="token comment">// 在页面上展示用户和文章</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'数据加载失败:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印数据加载失败的错误信息</span>
        <span class="token comment">// 处理错误情况</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码定义了两个函数<code>fetchUsers</code>和<code>fetchPosts</code>，它们分别模拟从服务器异步获取用户数据和文章数据。这两个函数都返回一个Promise对象，该对象在异步操作完成时解析。</p> 
<p>然后，代码使用<code>Promise.all</code>方法来并行执行<code>fetchUsers</code>和<code>fetchPosts</code>这两个异步任务。<code>Promise.all</code>接收一个Promise数组作为参数，并返回一个新的Promise对象。这个新的Promise对象会在所有传入的Promise都成功解析后解析，解析值为一个数组，包含所有传入Promise的解析值。</p> 
<p>在<code>Promise.all</code>的<code>.then</code>回调中，代码处理了所有异步任务成功完成的情况。它打印出一条消息表示所有数据已加载完成，并分别打印出用户列表和文章列表。</p> 
<p>如果任何一个异步任务失败，<code>Promise.all</code>返回的Promise对象会立即拒绝，并将拒绝原因传递给<code>.catch</code>回调。在<code>.catch</code>回调中，代码处理了数据加载失败的情况，并打印出错误信息。</p> 
<p>总的来说，这段代码演示了如何使用<code>Promise.all</code>来并行处理多个异步任务，并在所有任务都完成后或任何一个任务失败时进行相应的处理。</p> 
<h4><a id="3__777"></a>3. 顺序执行多个异步任务</h4> 
<p>Promise可以链式调用，实现多个异步任务的顺序执行，确保每个任务在上一个任务完成后再执行：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 定义一个模拟执行任务1的函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">performTask1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'任务1完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务1完成</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'任务1结果'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将任务1的结果传递给resolve</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步执行任务1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个模拟执行任务2的函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">performTask2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'任务2完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务2完成</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'任务2结果'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将任务2的结果传递给resolve</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步执行任务2</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 执行任务1，然后在任务1完成后执行任务2</span>
<span class="token function">performTask1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'任务1返回结果:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务1返回的结果</span>
        <span class="token keyword">return</span> <span class="token function">performTask2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回执行任务2的Promise对象</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'任务2返回结果:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务2返回的结果</span>
        <span class="token comment">// 继续执行后续任务</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'任务执行出错:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务执行出错的错误信息</span>
        <span class="token comment">// 处理错误情况</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码定义了两个函数<code>performTask1</code>和<code>performTask2</code>，它们分别模拟异步执行任务1和任务2。这两个函数都返回一个Promise对象，该对象在异步操作完成时解析，并传递任务的结果。</p> 
<p>然后，代码通过调用<code>performTask1</code>函数开始执行任务1。在任务1的Promise解析后，<code>.then</code>回调被调用，并接收任务1的结果作为参数。在这个回调中，代码打印出任务1的结果，并返回<code>performTask2</code>函数的调用结果，这是一个新的Promise对象，代表任务2的执行。</p> 
<p>当任务2的Promise解析后，第二个<code>.then</code>回调被调用，并接收任务2的结果作为参数。在这个回调中，代码打印出任务2的结果，并可以继续执行后续的任务。</p> 
<p>如果任何一个任务失败，即任何一个Promise被拒绝，<code>.catch</code>回调会被调用，并接收拒绝原因作为参数。在这个回调中，代码可以处理错误情况，并打印出错误信息。</p> 
<p>总的来说，这段代码演示了如何使用Promise的链式调用来顺序执行多个异步任务，并在每个任务完成后或任何一个任务失败时进行相应的处理。这种模式在实际开发中非常有用，特别是当您需要按顺序执行一系列异步操作，并且每个操作都依赖于前一个操作的结果时。</p> 
<h4><a id="4__828"></a>4. 处理并发的异步任务</h4> 
<p>Promise.race方法用于处理多个异步任务，只处理第一个完成的任务结果，忽略其余的任务：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 定义一个模拟执行任务1的Promise对象</span>
<span class="token keyword">const</span> task1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'任务1完成'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步执行任务1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 定义一个模拟执行任务2的Promise对象</span>
<span class="token keyword">const</span> task2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'任务2完成'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 模拟异步执行任务2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用Promise.race处理并发的异步任务</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'第一个完成的任务结果:'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印第一个完成的任务结果</span>
        <span class="token comment">// 处理第一个完成的任务结果</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'任务执行出错:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印任务执行出错的错误信息</span>
        <span class="token comment">// 处理错误情况</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码定义了两个Promise对象<code>task1</code>和<code>task2</code>，它们分别模拟异步执行任务1和任务2。<code>task1</code>将在1000毫秒后解析，而<code>task2</code>将在500毫秒后解析。</p> 
<p>然后，代码使用<code>Promise.race</code>方法来处理这两个并发的异步任务。由于<code>task2</code>的解析时间比<code>task1</code>短，因此<code>Promise.race</code>返回的Promise对象将在<code>task2</code>解析时解析。</p> 
<p>在<code>Promise.race</code>的<code>.then</code>回调中，代码处理了第一个完成的任务的结果。它打印出第一个完成的任务的结果，并可以在这里进行进一步的处理。</p> 
<p>如果任何一个任务失败，即任何一个Promise被拒绝，<code>Promise.race</code>返回的Promise对象也会被拒绝，并将拒绝原因传递给<code>.catch</code>回调。在这个回调中，代码可以处理错误情况，并打印出错误信息。</p> 
<p>总的来说，这段代码演示了如何使用<code>Promise.race</code>来处理多个并发的异步任务，并只关注第一个完成的任务的结果。这种模式在实际开发中非常有用，特别是当您有多个异步数据源，并且只需要从最快响应的那个数据源获取结果时。</p> 
<hr> 
<h3><a id="_868"></a>七、总结</h3> 
<p>Promise作为JavaScript中处理异步操作的一种重要机制，极大地简化了代码编写和异步流程控制。在本篇文章中，我们深入探讨了Promise的核心概念、基本用法、进阶技巧以及如何手写一个简单的Promise，并通过实际应用示例展示了Promise在开发中的强大功能。</p> 
<ol><li> <p><strong>Promise概述</strong>：Promise是JavaScript异步编程的核心，提供了一种更清晰、更直观的方式来处理异步操作。它具有三种状态：<code>Pending</code>、<code>Fulfilled</code>和<code>Rejected</code>，并且一旦状态改变，就不会再次改变。</p> </li><li> <p><strong>Promise的基本用法</strong>：通过Promise对象，我们可以使用<code>then</code>方法处理成功的异步结果，使用<code>catch</code>方法处理失败的异步结果，并使用<code>finally</code>方法在Promise结束时执行一些清理操作。</p> </li><li> <p><strong>Promise的进阶用法</strong>：Promise的链式调用和静态方法（如<code>Promise.all</code>、<code>Promise.race</code>等）让我们能够更加灵活地处理多个异步任务，提供了并行和顺序执行异步任务的解决方案。</p> </li><li> <p><strong>手写一个简单的Promise</strong>：通过手写一个简单的Promise实现，我们更加深入地理解了Promise的内部工作机制，包括状态管理、回调队列的处理以及异步任务的执行。</p> </li><li> <p><strong>Promise的实际应用</strong>：在实际开发中，Promise被广泛应用于异步数据加载、并行处理多个异步任务、顺序执行异步任务以及处理并发的异步任务等场景，提升了代码的可读性和维护性。</p> </li></ol> 
<p>总的来说，掌握Promise对于现代JavaScript开发者来说至关重要。它不仅帮助我们解决了回调地狱问题，还让代码更加简洁和易于理解。希望通过这篇文章，你对Promise有了更加全面和深入的理解，并能够在实际开发中灵活运用它来编写高质量的异步代码。</p> 
<p><img src="https://images2.imgbox.com/ba/25/NgG6Mdqv_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f5710febe46f6b4499a681d00142f7e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最新Wireshark查看包中gzip内容</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3856c203a71828ea634b9173a88d782b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决python安装包“ERROR: Could not install packages due to an OSError”错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>