<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ChatGLM-6B (ä»‹ç»ä»¥åŠæœ¬åœ°éƒ¨ç½²) - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ff093bb8c31600446a9fbf82ffdf495e/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ChatGLM-6B (ä»‹ç»ä»¥åŠæœ¬åœ°éƒ¨ç½²)">
  <meta property="og:description" content="ä¸­æ–‡ChatGPTå¹³æ›¿â€”â€”ChatGLM-6B ChatGLM-6Bç®€ä»‹å®˜æ–¹å®ä¾‹æœ¬åœ°éƒ¨ç½²1.ä¸‹è½½ä»£ç 2.é€šè¿‡condaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ3.ä¿®æ”¹ä»£ç 4.æ¨¡å‹é‡åŒ–5.è¯¦ç»†ä»£ç  è°ƒç”¨ç¤ºä¾‹ ChatGLM-6B ç®€ä»‹ ChatGLM-6B æ˜¯ä¸€ä¸ªå¼€æºçš„ã€æ”¯æŒä¸­è‹±åŒè¯­é—®ç­”çš„å¯¹è¯è¯­è¨€æ¨¡å‹ï¼ŒåŸºäº General Language Model (GLM) æ¶æ„ï¼Œå…·æœ‰ 62 äº¿å‚æ•°ã€‚ç»“åˆæ¨¡å‹é‡åŒ–æŠ€æœ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ¶ˆè´¹çº§çš„æ˜¾å¡ä¸Šè¿›è¡Œæœ¬åœ°éƒ¨ç½²ï¼ˆINT4 é‡åŒ–çº§åˆ«ä¸‹æœ€ä½åªéœ€ 6GB æ˜¾å­˜ï¼‰ã€‚ChatGLM-6B ä½¿ç”¨äº†å’Œ ChatGLM ç›¸åŒçš„æŠ€æœ¯ï¼Œé’ˆå¯¹ä¸­æ–‡é—®ç­”å’Œå¯¹è¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚ç»è¿‡çº¦ 1T æ ‡è¯†ç¬¦çš„ä¸­è‹±åŒè¯­è®­ç»ƒï¼Œè¾…ä»¥ç›‘ç£å¾®è°ƒã€åé¦ˆè‡ªåŠ©ã€äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ç­‰æŠ€æœ¯çš„åŠ æŒï¼Œ62 äº¿å‚æ•°çš„ ChatGLM-6B å·²ç»èƒ½ç”Ÿæˆç›¸å½“ç¬¦åˆäººç±»åå¥½çš„å›ç­”ã€‚
ChatGLM å‚è€ƒäº† ChatGPT çš„è®¾è®¡æ€è·¯ï¼Œåœ¨åƒäº¿åŸºåº§æ¨¡å‹ GLM-130B1 ä¸­æ³¨å…¥äº†ä»£ç é¢„è®­ç»ƒï¼Œé€šè¿‡æœ‰ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰ç­‰æŠ€æœ¯å®ç°äººç±»æ„å›¾å¯¹é½ã€‚ChatGLM å½“å‰ç‰ˆæœ¬æ¨¡å‹çš„èƒ½åŠ›æå‡ä¸»è¦æ¥æºäºç‹¬ç‰¹çš„åƒäº¿åŸºåº§æ¨¡å‹ GLM-130Bã€‚å®ƒæ˜¯ä¸åŒäº BERTã€GPT-3 ä»¥åŠ T5 çš„æ¶æ„ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«å¤šç›®æ ‡å‡½æ•°çš„è‡ªå›å½’é¢„è®­ç»ƒæ¨¡å‹ã€‚2022å¹´8æœˆï¼Œæˆ‘ä»¬å‘ç ”ç©¶ç•Œå’Œå·¥ä¸šç•Œå¼€æ”¾äº†æ‹¥æœ‰1300äº¿å‚æ•°çš„ä¸­è‹±åŒè¯­ç¨ å¯†æ¨¡å‹ GLM-130B1ï¼Œè¯¥æ¨¡å‹æœ‰ä¸€äº›ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š
åŒè¯­ï¼š åŒæ—¶æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ã€‚é«˜ç²¾åº¦ï¼ˆè‹±æ–‡ï¼‰ï¼š åœ¨å…¬å¼€çš„è‹±æ–‡è‡ªç„¶è¯­è¨€æ¦œå• LAMBADAã€MMLU å’Œ Big-bench-lite ä¸Šä¼˜äº GPT-3 175Bï¼ˆAPI: davinciï¼ŒåŸºåº§æ¨¡å‹ï¼‰ã€OPT-175B å’Œ BLOOM-176Bã€‚é«˜ç²¾åº¦ï¼ˆä¸­æ–‡ï¼‰ï¼š åœ¨7ä¸ªé›¶æ ·æœ¬ CLUE æ•°æ®é›†å’Œ5ä¸ªé›¶æ ·æœ¬ FewCLUE æ•°æ®é›†ä¸Šæ˜æ˜¾ä¼˜äº ERNIE TITAN 3.0 260B å’Œ YUAN 1.0-245Bã€‚å¿«é€Ÿæ¨ç†ï¼š é¦–ä¸ªå®ç° INT4 é‡åŒ–çš„åƒäº¿æ¨¡å‹ï¼Œæ”¯æŒç”¨ä¸€å° 4 å¡ 3090 æˆ– 8 å¡ 2080Ti æœåŠ¡å™¨è¿›è¡Œå¿«é€Ÿä¸”åŸºæœ¬æ— æŸæ¨ç†ã€‚å¯å¤ç°æ€§ï¼š æ‰€æœ‰ç»“æœï¼ˆè¶…è¿‡ 30 ä¸ªä»»åŠ¡ï¼‰å‡å¯é€šè¿‡æˆ‘ä»¬çš„å¼€æºä»£ç å’Œæ¨¡å‹å‚æ•°å¤ç°ã€‚è·¨å¹³å°ï¼š æ”¯æŒåœ¨å›½äº§çš„æµ·å…‰ DCUã€åä¸ºæ˜‡è…¾ 910 å’Œç”³å¨å¤„ç†å™¨åŠç¾å›½çš„è‹±ä¼Ÿè¾¾èŠ¯ç‰‡ä¸Šè¿›è¡Œè®­ç»ƒä¸æ¨ç†ã€‚ å®˜æ–¹å®ä¾‹ &gt;&gt;&gt; from transformers import AutoTokenizer, AutoModel &gt;&gt;&gt; tokenizer = AutoTokenizer.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-03-17T17:43:53+08:00">
    <meta property="article:modified_time" content="2023-03-17T17:43:53+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ChatGLM-6B (ä»‹ç»ä»¥åŠæœ¬åœ°éƒ¨ç½²)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>ä¸­æ–‡ChatGPTå¹³æ›¿â€”â€”ChatGLM-6B</h4> 
 <ul><li><a href="#ChatGLM6B_2" rel="nofollow">ChatGLM-6B</a></li><li><ul><li><a href="#_4" rel="nofollow">ç®€ä»‹</a></li><li><a href="#_23" rel="nofollow">å®˜æ–¹å®ä¾‹</a></li><li><a href="#_47" rel="nofollow">æœ¬åœ°éƒ¨ç½²</a></li><li><ul><li><a href="#1_49" rel="nofollow">1.ä¸‹è½½ä»£ç </a></li><li><a href="#2conda_55" rel="nofollow">2.é€šè¿‡condaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</a></li><li><a href="#3_70" rel="nofollow">3.ä¿®æ”¹ä»£ç </a></li><li><a href="#4_78" rel="nofollow">4.æ¨¡å‹é‡åŒ–</a></li><li><a href="#5_111" rel="nofollow">5.è¯¦ç»†ä»£ç </a></li></ul> 
   </li><li><a href="#_158" rel="nofollow">è°ƒç”¨ç¤ºä¾‹</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="ChatGLM6B_2"></a>ChatGLM-6B</h2> 
<h3><a id="_4"></a>ç®€ä»‹</h3> 
<blockquote> 
 <p>ChatGLM-6B æ˜¯ä¸€ä¸ªå¼€æºçš„ã€æ”¯æŒä¸­è‹±åŒè¯­é—®ç­”çš„å¯¹è¯è¯­è¨€æ¨¡å‹ï¼ŒåŸºäº <a href="https://github.com/THUDM/GLM">General Language Model (GLM)</a> æ¶æ„ï¼Œå…·æœ‰ 62 äº¿å‚æ•°ã€‚ç»“åˆæ¨¡å‹é‡åŒ–æŠ€æœ¯ï¼Œç”¨æˆ·å¯ä»¥åœ¨æ¶ˆè´¹çº§çš„æ˜¾å¡ä¸Šè¿›è¡Œæœ¬åœ°éƒ¨ç½²ï¼ˆINT4 é‡åŒ–çº§åˆ«ä¸‹æœ€ä½åªéœ€ 6GB æ˜¾å­˜ï¼‰ã€‚ChatGLM-6B ä½¿ç”¨äº†å’Œ <a href="https://chatglm.cn/" rel="nofollow">ChatGLM</a> ç›¸åŒçš„æŠ€æœ¯ï¼Œé’ˆå¯¹ä¸­æ–‡é—®ç­”å’Œå¯¹è¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚ç»è¿‡çº¦ 1T æ ‡è¯†ç¬¦çš„ä¸­è‹±åŒè¯­è®­ç»ƒï¼Œè¾…ä»¥ç›‘ç£å¾®è°ƒã€åé¦ˆè‡ªåŠ©ã€äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ç­‰æŠ€æœ¯çš„åŠ æŒï¼Œ62 äº¿å‚æ•°çš„ ChatGLM-6B å·²ç»èƒ½ç”Ÿæˆç›¸å½“ç¬¦åˆäººç±»åå¥½çš„å›ç­”ã€‚</p> 
</blockquote> 
<blockquote> 
 <p>ChatGLM å‚è€ƒäº† ChatGPT çš„è®¾è®¡æ€è·¯ï¼Œåœ¨åƒäº¿åŸºåº§æ¨¡å‹ GLM-130B<a href="https://chatglm.cn/blog#fn:1" rel="nofollow">1</a> ä¸­æ³¨å…¥äº†ä»£ç é¢„è®­ç»ƒï¼Œé€šè¿‡æœ‰ç›‘ç£å¾®è°ƒï¼ˆSupervised Fine-Tuningï¼‰ç­‰æŠ€æœ¯å®ç°äººç±»æ„å›¾å¯¹é½ã€‚ChatGLM å½“å‰ç‰ˆæœ¬æ¨¡å‹çš„èƒ½åŠ›æå‡ä¸»è¦æ¥æºäºç‹¬ç‰¹çš„åƒäº¿åŸºåº§æ¨¡å‹ GLM-130Bã€‚å®ƒæ˜¯ä¸åŒäº BERTã€GPT-3 ä»¥åŠ T5 çš„æ¶æ„ï¼Œæ˜¯ä¸€ä¸ªåŒ…å«å¤šç›®æ ‡å‡½æ•°çš„è‡ªå›å½’é¢„è®­ç»ƒæ¨¡å‹ã€‚2022å¹´8æœˆï¼Œæˆ‘ä»¬å‘ç ”ç©¶ç•Œå’Œå·¥ä¸šç•Œå¼€æ”¾äº†æ‹¥æœ‰1300äº¿å‚æ•°çš„ä¸­è‹±åŒè¯­ç¨ å¯†æ¨¡å‹ GLM-130B<a href="https://chatglm.cn/blog#fn:1" rel="nofollow">1</a>ï¼Œè¯¥æ¨¡å‹æœ‰ä¸€äº›ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š</p> 
 <ul><li>åŒè¯­ï¼š åŒæ—¶æ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ã€‚</li><li>é«˜ç²¾åº¦ï¼ˆè‹±æ–‡ï¼‰ï¼š åœ¨å…¬å¼€çš„è‹±æ–‡è‡ªç„¶è¯­è¨€æ¦œå• LAMBADAã€MMLU å’Œ Big-bench-lite ä¸Šä¼˜äº GPT-3 175Bï¼ˆAPI: davinciï¼ŒåŸºåº§æ¨¡å‹ï¼‰ã€OPT-175B å’Œ BLOOM-176Bã€‚</li><li>é«˜ç²¾åº¦ï¼ˆä¸­æ–‡ï¼‰ï¼š åœ¨7ä¸ªé›¶æ ·æœ¬ CLUE æ•°æ®é›†å’Œ5ä¸ªé›¶æ ·æœ¬ FewCLUE æ•°æ®é›†ä¸Šæ˜æ˜¾ä¼˜äº ERNIE TITAN 3.0 260B å’Œ YUAN 1.0-245Bã€‚</li><li>å¿«é€Ÿæ¨ç†ï¼š é¦–ä¸ªå®ç° INT4 é‡åŒ–çš„åƒäº¿æ¨¡å‹ï¼Œæ”¯æŒç”¨ä¸€å° 4 å¡ 3090 æˆ– 8 å¡ 2080Ti æœåŠ¡å™¨è¿›è¡Œå¿«é€Ÿä¸”åŸºæœ¬æ— æŸæ¨ç†ã€‚</li><li>å¯å¤ç°æ€§ï¼š æ‰€æœ‰ç»“æœï¼ˆè¶…è¿‡ 30 ä¸ªä»»åŠ¡ï¼‰å‡å¯é€šè¿‡æˆ‘ä»¬çš„å¼€æºä»£ç å’Œæ¨¡å‹å‚æ•°å¤ç°ã€‚</li><li>è·¨å¹³å°ï¼š æ”¯æŒåœ¨å›½äº§çš„æµ·å…‰ DCUã€åä¸ºæ˜‡è…¾ 910 å’Œç”³å¨å¤„ç†å™¨åŠç¾å›½çš„è‹±ä¼Ÿè¾¾èŠ¯ç‰‡ä¸Šè¿›è¡Œè®­ç»ƒä¸æ¨ç†ã€‚</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d9/b3/tR6yrlxz_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/8b/ad/eN0X1WWa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="_23"></a>å®˜æ–¹å®ä¾‹</h3> 
<pre><code>&gt;&gt;&gt; from transformers import AutoTokenizer, AutoModel
&gt;&gt;&gt; tokenizer = AutoTokenizer.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True)
&gt;&gt;&gt; model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().cuda()
&gt;&gt;&gt; response, history = model.chat(tokenizer, "ä½ å¥½", history=[])
&gt;&gt;&gt; print(response)
ä½ å¥½ğŸ‘‹!æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹ ChatGLM-6B,å¾ˆé«˜å…´è§åˆ°ä½ ,æ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚
&gt;&gt;&gt; response, history = model.chat(tokenizer, "æ™šä¸Šç¡ä¸ç€åº”è¯¥æ€ä¹ˆåŠ", history=history)
&gt;&gt;&gt; print(response)
æ™šä¸Šç¡ä¸ç€å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°ç„¦è™‘æˆ–ä¸èˆ’æœ,ä½†ä»¥ä¸‹æ˜¯ä¸€äº›å¯ä»¥å¸®åŠ©ä½ å…¥ç¡çš„æ–¹æ³•:

1. åˆ¶å®šè§„å¾‹çš„ç¡çœ æ—¶é—´è¡¨:ä¿æŒè§„å¾‹çš„ç¡çœ æ—¶é—´è¡¨å¯ä»¥å¸®åŠ©ä½ å»ºç«‹å¥åº·çš„ç¡çœ ä¹ æƒ¯,ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚å°½é‡åœ¨æ¯å¤©çš„ç›¸åŒæ—¶é—´ä¸ŠåºŠ,å¹¶åœ¨åŒä¸€æ—¶é—´èµ·åºŠã€‚
2. åˆ›é€ ä¸€ä¸ªèˆ’é€‚çš„ç¡çœ ç¯å¢ƒ:ç¡®ä¿ç¡çœ ç¯å¢ƒèˆ’é€‚,å®‰é™,é»‘æš—ä¸”æ¸©åº¦é€‚å®œã€‚å¯ä»¥ä½¿ç”¨èˆ’é€‚çš„åºŠä¸Šç”¨å“,å¹¶ä¿æŒæˆ¿é—´é€šé£ã€‚
3. æ”¾æ¾èº«å¿ƒ:åœ¨ç¡å‰åšäº›æ”¾æ¾çš„æ´»åŠ¨,ä¾‹å¦‚æ³¡ä¸ªçƒ­æ°´æ¾¡,å¬äº›è½»æŸ”çš„éŸ³ä¹,é˜…è¯»ä¸€äº›æœ‰è¶£çš„ä¹¦ç±ç­‰,æœ‰åŠ©äºç¼“è§£ç´§å¼ å’Œç„¦è™‘,ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚
4. é¿å…é¥®ç”¨å«æœ‰å’–å•¡å› çš„é¥®æ–™:å’–å•¡å› æ˜¯ä¸€ç§åˆºæ¿€æ€§ç‰©è´¨,ä¼šå½±å“ä½ çš„ç¡çœ è´¨é‡ã€‚å°½é‡é¿å…åœ¨ç¡å‰é¥®ç”¨å«æœ‰å’–å•¡å› çš„é¥®æ–™,ä¾‹å¦‚å’–å•¡,èŒ¶å’Œå¯ä¹ã€‚
5. é¿å…åœ¨åºŠä¸Šåšä¸ç¡çœ æ— å…³çš„äº‹æƒ…:åœ¨åºŠä¸Šåšäº›ä¸ç¡çœ æ— å…³çš„äº‹æƒ…,ä¾‹å¦‚çœ‹ç”µå½±,ç©æ¸¸æˆæˆ–å·¥ä½œç­‰,å¯èƒ½ä¼šå¹²æ‰°ä½ çš„ç¡çœ ã€‚
6. å°è¯•å‘¼å¸æŠ€å·§:æ·±å‘¼å¸æ˜¯ä¸€ç§æ”¾æ¾æŠ€å·§,å¯ä»¥å¸®åŠ©ä½ ç¼“è§£ç´§å¼ å’Œç„¦è™‘,ä½¿ä½ æ›´å®¹æ˜“å…¥ç¡ã€‚è¯•ç€æ…¢æ…¢å¸æ°”,ä¿æŒå‡ ç§’é’Ÿ,ç„¶åç¼“æ…¢å‘¼æ°”ã€‚

å¦‚æœè¿™äº›æ–¹æ³•æ— æ³•å¸®åŠ©ä½ å…¥ç¡,ä½ å¯ä»¥è€ƒè™‘å’¨è¯¢åŒ»ç”Ÿæˆ–ç¡çœ ä¸“å®¶,å¯»æ±‚è¿›ä¸€æ­¥çš„å»ºè®®ã€‚

</code></pre> 
<h3><a id="_47"></a>æœ¬åœ°éƒ¨ç½²</h3> 
<h4><a id="1_49"></a>1.ä¸‹è½½ä»£ç </h4> 
<pre><code>git clone https://github.com/THUDM/ChatGLM-6B.git
</code></pre> 
<h4><a id="2conda_55"></a>2.é€šè¿‡condaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h4> 
<pre><code># æ–°å»ºchatglmç¯å¢ƒ
conda create -n chatglm python=3.8
# æ¿€æ´»chatglmç¯å¢ƒ
conda activate chatglm
# å®‰è£…PyTorchç¯å¢ƒï¼ˆæ ¹æ®è‡ªå·±çš„cudaç‰ˆæœ¬é€‰æ‹©åˆé€‚çš„torchç‰ˆæœ¬ï¼‰
pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 torchaudio==0.12.1 --extra-index-url https://download.pytorch.org/whl/cu113
# å®‰è£…gradioç”¨äºå¯åŠ¨å›¾å½¢åŒ–webç•Œé¢
pip install gradio
# å®‰è£…è¿è¡Œä¾èµ–
pip install -r requirement.txt
</code></pre> 
<h4><a id="3_70"></a>3.ä¿®æ”¹ä»£ç </h4> 
<ul><li>åœ¨web_demo.pyçš„æœ€åä¸€å¥demo.queue().launch(share=True)ï¼ŒåŠ ä¸¤ä¸ªserver_name=â€œ0.0.0.0â€, server_port=1234å‚æ•°ã€‚</li></ul> 
<pre><code>demo.queue().launch(share=True,server_name="0.0.0.0",server_port=9234)
</code></pre> 
<h4><a id="4_78"></a>4.æ¨¡å‹é‡åŒ–</h4> 
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å‹ä»¥ FP16 ç²¾åº¦åŠ è½½ï¼Œè¿è¡Œä¸Šè¿°ä»£ç éœ€è¦å¤§æ¦‚ 13GB æ˜¾å­˜ã€‚å¦‚æœä½ çš„ GPU æ˜¾å­˜æœ‰é™ï¼Œå¯ä»¥å°è¯•ä»¥é‡åŒ–æ–¹å¼åŠ è½½æ¨¡å‹ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> 
<ul><li><strong>GPU</strong></li></ul> 
<pre><code># FP16ç²¾åº¦åŠ è½½ï¼Œéœ€è¦13Gæ˜¾å­˜
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().cuda()
</code></pre> 
<pre><code># int8ç²¾åº¦åŠ è½½ï¼Œéœ€è¦10Gæ˜¾å­˜
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().quantize(8).cuda()
</code></pre> 
<pre><code># int4ç²¾åº¦åŠ è½½ï¼Œéœ€è¦6Gæ˜¾å­˜
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().quantize(4).cuda()
</code></pre> 
<ul><li><strong>CPU</strong></li></ul> 
<pre><code>#32Gå†…å­˜
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).float()
</code></pre> 
<pre><code>#16Gå†…å­˜
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).bfloat16()
</code></pre> 
<h4><a id="5_111"></a>5.è¯¦ç»†ä»£ç </h4> 
<pre><code>from transformers import AutoModel, AutoTokenizer
import gradio as gr

tokenizer = AutoTokenizer.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True)
# model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().cuda()
# æŒ‰éœ€ä¿®æ”¹ï¼Œç›®å‰åªæ”¯æŒ 4/8 bit é‡åŒ–
model = AutoModel.from_pretrained("THUDM/chatglm-6b", trust_remote_code=True).half().quantize(4).cuda()
model = model.eval()

MAX_TURNS = 20
MAX_BOXES = MAX_TURNS * 2


def predict(input, history=[]):
    response, history = model.chat(tokenizer, input, history)
    updates = []
    for query, response in history:
        updates.append(gr.update(visible=True, value=query))
        updates.append(gr.update(visible=True, value=response))
    if len(updates) &lt; MAX_BOXES:
        updates = updates + [gr.Textbox.update(visible=False)] * (MAX_BOXES - len(updates))
    return [history] + updates


with gr.Blocks() as demo:
    state = gr.State([])
    text_boxes = []
    for i in range(MAX_BOXES):
        if i % 2 == 0:
            label = "æé—®ï¼š"
        else:
            label = "å›å¤ï¼š"
        text_boxes.append(gr.Textbox(visible=False, label=label))

    with gr.Row():
        with gr.Column(scale=4):
            txt = gr.Textbox(show_label=False, placeholder="Enter text and press enter").style(container=False)
        with gr.Column(scale=1):
            button = gr.Button("Generate")
    button.click(predict, [txt, state], [state] + text_boxes)
demo.queue().launch(share=True,server_name="0.0.0.0",server_port=9234)

</code></pre> 
<h3><a id="_158"></a>è°ƒç”¨ç¤ºä¾‹</h3> 
<p><img src="https://images2.imgbox.com/42/de/vp5B6ozU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/71/8f/NmWWahqL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9576dcc93cc9a40822c2f01cfae25920/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€Javaã€‘è¿˜ä¸æ‡‚thiså…³é”®å­—ï¼Ÿä¸€åˆ†é’Ÿå½»åº•å¼„æ‡‚thiså…³é”®å­—</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3fbc148c4584f308eb659c7dbd7a9b27/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Access denied for user  root @ localhost  (using password: YES)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>