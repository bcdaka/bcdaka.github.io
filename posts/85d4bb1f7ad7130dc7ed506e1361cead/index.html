<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/85d4bb1f7ad7130dc7ed506e1361cead/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶">
  <meta property="og:description" content="ç³»åˆ—ç¯‡ç« ğŸ’¥ AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½
ç›®å½• ç³»åˆ—ç¯‡ç« ğŸ’¥ä¸€ã€å‰è¨€äºŒã€å¼•å…¥èƒŒæ™¯çŸ¥è¯†åº“1ã€å®šä¹‰OpenAIå®¢æˆ·ç«¯2ã€å®šä¹‰å·¥å…·å‡½æ•°ç”Ÿæˆå™¨3ã€ä¸¤æ¬¡å¤§æ¨¡å‹APIè°ƒç”¨å°è£…4ã€user_demographicsæ•°æ®æŸ¥è¯¢æœåŠ¡å°è£…5ã€user_demographicså‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•6ã€ç¬¬ä¸€æ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•7ã€è¯»å–æ•°æ®å­—å…¸8ã€ç¬¬äºŒæ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•9ã€æ•°æ®åº“åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢æµ‹è¯•10ã€æ•°æ®åˆ†æè°ƒç”¨æµ‹è¯• ä¸‰ã€å®ç°äº¤äº’ç¡®è®¤1ã€å®šä¹‰æ•°æ®åº“åŸºæœ¬ä¿¡æ¯è·å–å‡½æ•°2ã€å‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•æ£€æŸ¥ï¼š3ã€æ•°æ®åˆ†ææµ‹è¯•4ã€å®šä¹‰SQLæå–å‡½æ•°5ã€ä¸¤æ¬¡æ¬¡å¤§æ¨¡å‹APIä¸¤æ¬¡è°ƒç”¨å°è£…æ”¹é€ 6ã€å®šä¹‰æ¶ˆæ¯åˆ—è¡¨7ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•18ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•29ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•3 å››ã€å®ç°å®Œæ•´çš„å¤šè½®å¯¹è¯æ•ˆæœäº”ã€ç»“è¯­ ä¸€ã€å‰è¨€ åœ¨Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„å®æˆ˜å¼€å‘ä¸­ï¼Œç»§æˆ‘ä»¬ä¹‹å‰å…³äºFunction CallingæŠ€æœ¯æ•´åˆçš„è®¨è®ºä¹‹åï¼Œæœ¬æ–‡å°†ä¸“æ³¨äºå®ç°ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½â€”â€”å¤šè½®å¯¹è¯æ§åˆ¶ç³»ç»Ÿã€‚è¿™ä¸€æœºåˆ¶èƒ½å¤Ÿè®©ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ç³»ç»Ÿè¿›è¡Œè¿ç»­çš„äº¤æµï¼Œä»è€Œæ›´å‡†ç¡®ã€æ›´é«˜æ•ˆåœ°å®Œæˆæ•°æ®åˆ†æä»»åŠ¡ã€‚
äºŒã€å¼•å…¥èƒŒæ™¯çŸ¥è¯†åº“ å¼•å…¥æ•°æ®å­—å…¸çŸ¥è¯†ï¼Œä½œä¸ºå¤§æ¨¡å‹å¯¹è¯çš„èƒŒæ™¯çŸ¥è¯†åº“ã€‚
1ã€å®šä¹‰OpenAIå®¢æˆ·ç«¯ å®šä¹‰å¤§æ¨¡å‹å®¢æˆ·ç«¯ï¼Œç”¨äºä¸å¤§æ¨¡å‹äº¤äº’å¯¹è¯
import openai import os import numpy as np import pandas as pd import json import io from openai import OpenAI import inspect import pymysql openai.api_key = os.getenv(&#34;OPENAI_API_KEY&#34;) client = OpenAI(api_key=openai.api_key) 2ã€å®šä¹‰å·¥å…·å‡½æ•°ç”Ÿæˆå™¨ å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆfunction callingåŠŸèƒ½éœ€è¦çš„ï¼Œå·¥å…·å‡½æ•°ä¿¡æ¯ä½“
def auto_functions(functions_list): &#34;&#34;&#34; Chatæ¨¡å‹çš„functionså‚æ•°ç¼–å†™å‡½æ•° :param functions_list: åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‡½æ•°å¯¹è±¡çš„åˆ—è¡¨ï¼› :returnï¼šæ»¡è¶³Chatæ¨¡å‹functionså‚æ•°è¦æ±‚çš„functionså¯¹è±¡ &#34;&#34;&#34; def functions_generate(functions_list): # åˆ›å»ºç©ºåˆ—è¡¨ï¼Œç”¨äºä¿å­˜æ¯ä¸ªå‡½æ•°çš„æè¿°å­—å…¸ functions = [] # å¯¹æ¯ä¸ªå¤–éƒ¨å‡½æ•°è¿›è¡Œå¾ªç¯ for function in functions_list: # è¯»å–å‡½æ•°å¯¹è±¡çš„å‡½æ•°è¯´æ˜ function_description = inspect.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-01T14:46:27+08:00">
    <meta property="article:modified_time" content="2024-06-01T14:46:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>ç³»åˆ—ç¯‡ç« ğŸ’¥</h2> 
<p><a href="https://xundaomalu.blog.csdn.net/article/details/139169884" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139190028" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139186663" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139193382" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139194151" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139205615" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216544" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216752" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#_0" rel="nofollow">ç³»åˆ—ç¯‡ç« ğŸ’¥</a></li><li><a href="#_18" rel="nofollow">ä¸€ã€å‰è¨€</a></li><li><a href="#_20" rel="nofollow">äºŒã€å¼•å…¥èƒŒæ™¯çŸ¥è¯†åº“</a></li><li><ul><li><a href="#1OpenAI_22" rel="nofollow">1ã€å®šä¹‰OpenAIå®¢æˆ·ç«¯</a></li><li><a href="#2_40" rel="nofollow">2ã€å®šä¹‰å·¥å…·å‡½æ•°ç”Ÿæˆå™¨</a></li><li><a href="#3API_97" rel="nofollow">3ã€ä¸¤æ¬¡å¤§æ¨¡å‹APIè°ƒç”¨å°è£…</a></li><li><a href="#4user_demographics_164" rel="nofollow">4ã€user_demographicsæ•°æ®æŸ¥è¯¢æœåŠ¡å°è£…</a></li><li><a href="#5user_demographics_198" rel="nofollow">5ã€user_demographicså‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•</a></li><li><a href="#6_214" rel="nofollow">6ã€ç¬¬ä¸€æ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•</a></li><li><a href="#7_241" rel="nofollow">7ã€è¯»å–æ•°æ®å­—å…¸</a></li><li><a href="#8_258" rel="nofollow">8ã€ç¬¬äºŒæ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•</a></li><li><a href="#9_285" rel="nofollow">9ã€æ•°æ®åº“åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢æµ‹è¯•</a></li><li><a href="#10_307" rel="nofollow">10ã€æ•°æ®åˆ†æè°ƒç”¨æµ‹è¯•</a></li></ul> 
  </li><li><a href="#_329" rel="nofollow">ä¸‰ã€å®ç°äº¤äº’ç¡®è®¤</a></li><li><ul><li><a href="#1_331" rel="nofollow">1ã€å®šä¹‰æ•°æ®åº“åŸºæœ¬ä¿¡æ¯è·å–å‡½æ•°</a></li><li><a href="#2_369" rel="nofollow">2ã€å‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•æ£€æŸ¥ï¼š</a></li><li><a href="#3_385" rel="nofollow">3ã€æ•°æ®åˆ†ææµ‹è¯•</a></li><li><a href="#4SQL_399" rel="nofollow">4ã€å®šä¹‰SQLæå–å‡½æ•°</a></li><li><a href="#5API_407" rel="nofollow">5ã€ä¸¤æ¬¡æ¬¡å¤§æ¨¡å‹APIä¸¤æ¬¡è°ƒç”¨å°è£…æ”¹é€ </a></li><li><a href="#6_486" rel="nofollow">6ã€å®šä¹‰æ¶ˆæ¯åˆ—è¡¨</a></li><li><a href="#71_499" rel="nofollow">7ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•1</a></li><li><a href="#82_510" rel="nofollow">8ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•2</a></li><li><a href="#93_526" rel="nofollow">9ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•3</a></li></ul> 
  </li><li><a href="#_542" rel="nofollow">å››ã€å®ç°å®Œæ•´çš„å¤šè½®å¯¹è¯æ•ˆæœ</a></li><li><a href="#_610" rel="nofollow">äº”ã€ç»“è¯­</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_18"></a>ä¸€ã€å‰è¨€</h2> 
<p>åœ¨Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„å®æˆ˜å¼€å‘ä¸­ï¼Œç»§æˆ‘ä»¬ä¹‹å‰å…³äºFunction CallingæŠ€æœ¯æ•´åˆçš„è®¨è®ºä¹‹åï¼Œæœ¬æ–‡å°†ä¸“æ³¨äºå®ç°ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½â€”â€”å¤šè½®å¯¹è¯æ§åˆ¶ç³»ç»Ÿã€‚è¿™ä¸€æœºåˆ¶èƒ½å¤Ÿè®©ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€ä¸ç³»ç»Ÿè¿›è¡Œè¿ç»­çš„äº¤æµï¼Œä»è€Œæ›´å‡†ç¡®ã€æ›´é«˜æ•ˆåœ°å®Œæˆæ•°æ®åˆ†æä»»åŠ¡ã€‚</p> 
<h2><a id="_20"></a>äºŒã€å¼•å…¥èƒŒæ™¯çŸ¥è¯†åº“</h2> 
<p>å¼•å…¥æ•°æ®å­—å…¸çŸ¥è¯†ï¼Œä½œä¸ºå¤§æ¨¡å‹å¯¹è¯çš„èƒŒæ™¯çŸ¥è¯†åº“ã€‚</p> 
<h3><a id="1OpenAI_22"></a>1ã€å®šä¹‰OpenAIå®¢æˆ·ç«¯</h3> 
<p>å®šä¹‰å¤§æ¨¡å‹å®¢æˆ·ç«¯ï¼Œç”¨äºä¸å¤§æ¨¡å‹äº¤äº’å¯¹è¯</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> openai
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">import</span> io
<span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">import</span> inspect
<span class="token keyword">import</span> pymysql

openai<span class="token punctuation">.</span>api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">)</span>

client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>api_key<span class="token operator">=</span>openai<span class="token punctuation">.</span>api_key<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_40"></a>2ã€å®šä¹‰å·¥å…·å‡½æ•°ç”Ÿæˆå™¨</h3> 
<p>å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆfunction callingåŠŸèƒ½éœ€è¦çš„ï¼Œå·¥å…·å‡½æ•°ä¿¡æ¯ä½“</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">auto_functions</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Chatæ¨¡å‹çš„functionså‚æ•°ç¼–å†™å‡½æ•°
    :param functions_list: åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‡½æ•°å¯¹è±¡çš„åˆ—è¡¨ï¼›
    :returnï¼šæ»¡è¶³Chatæ¨¡å‹functionså‚æ•°è¦æ±‚çš„functionså¯¹è±¡
    """</span>
    <span class="token keyword">def</span> <span class="token function">functions_generate</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºç©ºåˆ—è¡¨ï¼Œç”¨äºä¿å­˜æ¯ä¸ªå‡½æ•°çš„æè¿°å­—å…¸</span>
        functions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># å¯¹æ¯ä¸ªå¤–éƒ¨å‡½æ•°è¿›è¡Œå¾ªç¯</span>
        <span class="token keyword">for</span> function <span class="token keyword">in</span> functions_list<span class="token punctuation">:</span>
            <span class="token comment"># è¯»å–å‡½æ•°å¯¹è±¡çš„å‡½æ•°è¯´æ˜</span>
            function_description <span class="token operator">=</span> inspect<span class="token punctuation">.</span>getdoc<span class="token punctuation">(</span>function<span class="token punctuation">)</span>
            <span class="token comment"># è¯»å–å‡½æ•°çš„å‡½æ•°åå­—ç¬¦ä¸²</span>
            function_name <span class="token operator">=</span> function<span class="token punctuation">.</span>__name__

            system_prompt <span class="token operator">=</span> <span class="token string">'ä»¥ä¸‹æ˜¯æŸçš„å‡½æ•°è¯´æ˜ï¼š%s'</span> <span class="token operator">%</span> function_description
            user_prompt <span class="token operator">=</span> 'æ ¹æ®è¿™ä¸ªå‡½æ•°çš„å‡½æ•°è¯´æ˜ï¼Œè¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªJSONæ ¼å¼çš„å­—å…¸ï¼Œè¿™ä¸ªå­—å…¸æœ‰å¦‚ä¸‹<span class="token number">5</span>ç‚¹è¦æ±‚ï¼š\
                           <span class="token number">1.</span>å­—å…¸æ€»å…±æœ‰ä¸‰ä¸ªé”®å€¼å¯¹ï¼›\
                           <span class="token number">2.</span>ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²nameï¼Œvalueæ˜¯è¯¥å‡½æ•°çš„åå­—ï¼š<span class="token operator">%</span>sï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼›\
                           <span class="token number">3.</span>ç¬¬äºŒä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²descriptionï¼Œvalueæ˜¯è¯¥å‡½æ•°çš„å‡½æ•°çš„åŠŸèƒ½è¯´æ˜ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼›\
                           <span class="token number">4.</span>ç¬¬ä¸‰ä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²parametersï¼Œvalueæ˜¯ä¸€ä¸ªJSON Schemaå¯¹è±¡ï¼Œç”¨äºè¯´æ˜è¯¥å‡½æ•°çš„å‚æ•°è¾“å…¥è§„èŒƒã€‚\
                           <span class="token number">5.</span>è¾“å‡ºç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„å­—å…¸ï¼Œåªè¾“å‡ºè¿™ä¸ªå­—å…¸å³å¯ï¼Œå‰åä¸éœ€è¦ä»»ä½•å‰åä¿®é¥°æˆ–è¯´æ˜çš„è¯­å¥' <span class="token operator">%</span> function_name

            response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                              model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
                              messages<span class="token operator">=</span><span class="token punctuation">[</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> system_prompt<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_prompt<span class="token punctuation">}</span>
                              <span class="token punctuation">]</span>
                            <span class="token punctuation">)</span>
            json_function_description<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"```"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            json_str<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span><span class="token string">"function"</span><span class="token punctuation">:</span>json_function_description<span class="token punctuation">}</span>
            functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> functions
    
    max_attempts <span class="token operator">=</span> <span class="token number">4</span>
    attempts <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span> attempts <span class="token operator">&lt;</span> max_attempts<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            functions <span class="token operator">=</span> functions_generate<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
            <span class="token keyword">break</span>  <span class="token comment"># å¦‚æœä»£ç æˆåŠŸæ‰§è¡Œï¼Œè·³å‡ºå¾ªç¯</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            attempts <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># å¢åŠ å°è¯•æ¬¡æ•°</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å‘ç”Ÿé”™è¯¯ï¼š"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            <span class="token keyword">if</span> attempts <span class="token operator">==</span> max_attempts<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œç¨‹åºç»ˆæ­¢ã€‚"</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span>  <span class="token comment"># é‡æ–°å¼•å‘æœ€åä¸€ä¸ªå¼‚å¸¸</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨é‡æ–°è¿è¡Œ..."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> functions
</code></pre> 
<h3><a id="3API_97"></a>3ã€ä¸¤æ¬¡å¤§æ¨¡å‹APIè°ƒç”¨å°è£…</h3> 
<p>å°è£…funcation callingä¸­ä¸¤æ¬¡å¤§æ¨¡å‹APIå¾—è°ƒç”¨</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">run_conversation</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œå¤–éƒ¨å‡½æ•°è°ƒç”¨çš„å¯¹è¯æ¨¡å‹
    :param messages: å¿…è¦å‚æ•°ï¼Œå­—å…¸ç±»å‹ï¼Œè¾“å…¥åˆ°Chatæ¨¡å‹çš„messageså‚æ•°å¯¹è±¡
    :param functions_list: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œå¯ä»¥è®¾ç½®ä¸ºåŒ…å«å…¨éƒ¨å¤–éƒ¨å‡½æ•°çš„åˆ—è¡¨å¯¹è±¡
    :param model: Chatæ¨¡å‹ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ¨¡å‹ä¸ºgpt-3.5-turbo
    :returnï¼šChatæ¨¡å‹è¾“å‡ºç»“æœ
    """</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™æ‰§è¡Œæ™®é€šçš„å¯¹è¯ä»»åŠ¡</span>
    <span class="token keyword">if</span> functions_list <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
        
    <span class="token comment"># è‹¥å­˜åœ¨å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™éœ€è¦çµæ´»é€‰å–å¤–éƒ¨å‡½æ•°å¹¶è¿›è¡Œå›ç­”</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºfunctionså¯¹è±¡</span>
        tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>

        <span class="token comment"># åˆ›å»ºå¤–éƒ¨å‡½æ•°åº“å­—å…¸</span>
        available_functions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">:</span> func <span class="token keyword">for</span> func <span class="token keyword">in</span> functions_list<span class="token punctuation">}</span>

        <span class="token comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨å¤§æ¨¡å‹</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
                        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message

        tool_calls <span class="token operator">=</span> response_message<span class="token punctuation">.</span>tool_calls
        <span class="token keyword">if</span> tool_calls<span class="token punctuation">:</span>
            messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response_message<span class="token punctuation">)</span> 
            <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> tool_calls<span class="token punctuation">:</span>
                function_name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
                function_to_call <span class="token operator">=</span> available_functions<span class="token punctuation">[</span>function_name<span class="token punctuation">]</span>
                function_args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
                
                function_response <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span><span class="token operator">**</span>function_args<span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"tool_call_id"</span><span class="token punctuation">:</span> tool_call<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"tool"</span><span class="token punctuation">,</span>
                        <span class="token string">"name"</span><span class="token punctuation">:</span> function_name<span class="token punctuation">,</span>
                        <span class="token string">"content"</span><span class="token punctuation">:</span> function_response<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span> 
            <span class="token comment">## ç¬¬äºŒæ¬¡è°ƒç”¨æ¨¡å‹</span>
            second_response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
            <span class="token punctuation">)</span> 
            <span class="token comment"># è·å–æœ€ç»ˆç»“æœ</span>
            final_response <span class="token operator">=</span> second_response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
                
    <span class="token keyword">return</span> final_response
</code></pre> 
<h3><a id="4user_demographics_164"></a>4ã€user_demographicsæ•°æ®æŸ¥è¯¢æœåŠ¡å°è£…</h3> 
<p>å®šä¹‰ä¸€ä¸ªget_user_demographicså‡½æ•°ï¼Œç”¨äºè·å–user_demographics è¡¨çš„ç›¸å…³ä¿¡æ¯</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_user_demographics</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨æˆ·è·å–user_demographics è¡¨çš„ç›¸å…³ä¿¡æ¯
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLè¯­å¥
    :return SQLæŸ¥è¯¢çš„user_demographics è¡¨çš„ç›¸å…³ä¿¡æ¯
    """</span>
    mysql_pw<span class="token operator">=</span><span class="token string">"iquery_agent"</span>
    
    connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>
    user<span class="token operator">=</span><span class="token string">'iquery_agent'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>
    passwd<span class="token operator">=</span>mysql_pw<span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>
    db<span class="token operator">=</span><span class="token string">'iquery'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>
    charset<span class="token operator">=</span><span class="token string">'utf8'</span>  <span class="token comment"># å­—ç¬¦é›†é€‰æ‹©utf8   </span>
    <span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            sql <span class="token operator">=</span> sql_query
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
            results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    column_names <span class="token operator">=</span> <span class="token punctuation">[</span>desc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> desc <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>description<span class="token punctuation">]</span>

    <span class="token comment"># ä½¿ç”¨resultså’Œcolumn_namesåˆ›å»ºDataFrame</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>results<span class="token punctuation">,</span> columns<span class="token operator">=</span>column_names<span class="token punctuation">)</span>
        
    <span class="token keyword">return</span> df<span class="token punctuation">.</span>to_json<span class="token punctuation">(</span>orient <span class="token operator">=</span> <span class="token string">"records"</span><span class="token punctuation">)</span>         
</code></pre> 
<h3><a id="5user_demographics_198"></a>5ã€user_demographicså‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•</h3> 
<p>ä½¿ç”¨å·¥å…·å‡½æ•°ç”Ÿæˆå™¨ï¼Œå¯¹æµ‹è¯•æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸ç”Ÿæˆuser_demographicsç›¸å…³æ•°æ®æŸ¥è¯¢çš„å·¥å…·å‡½æ•°ä¿¡æ¯</p> 
<pre><code class="prism language-python"><span class="token comment">#å®šä¹‰å·¥å…·å‡½æ•°åˆ—è¡¨ï¼ˆå½“å‰åªæœ‰user_demographicsä¿¡æ¯è·å–çš„å‡½æ•°ï¼‰</span>
functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>get_user_demographics<span class="token punctuation">]</span>

<span class="token comment">#user_demographicsç›¸å…³æ•°æ®æŸ¥è¯¢çš„å·¥å…·å‡½æ•°ä¿¡æ¯ï¼Œç”Ÿæˆæµ‹è¯•</span>
tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
tools
</code></pre> 
<p>ç”Ÿæˆçš„å‡½æ•°ä¿¡æ¯å¦‚ä¸‹ï¼š<br> <img src="https://images2.imgbox.com/21/23/sQRRPGZG_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ³¨æ„ï¼šç»“æ„ç”Ÿæˆä¸ä¸€å®šæ­£ç¡®ï¼Œå¤§æ¨¡å‹ç¼ºå°‘ç¨³å®šæ€§ï¼›å¯èƒ½éœ€è¦å¤šæ¬¡è°ƒç”¨æµ‹è¯•ï¼›ä¹Ÿå¯ä»¥å†ç”Ÿæˆå‡½æ•°ä¸­ï¼ŒåŠ å…¥æ ¡éªŒï¼›æ¯”å¦‚ï¼šå¦‚æœç¼ºå¤±å…³é”®keyã€valueï¼Œå°±è®©å¤§æ¨¡å‹é‡æ–°ç”Ÿæˆã€‚</p> 
<h3><a id="6_214"></a>6ã€ç¬¬ä¸€æ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•</h3> 
<p>ä½¿ç”¨è‡ªç„¶è¯­è¨€å¯¹è¯çš„æ–¹å¼ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢åˆ†æ</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®user_demographicsè¡¨ä¸­ä¸ªäººå±æ€§ä¸ºè€å¹´ç”·æ€§çš„æ•°æ®æ€»å…±æœ‰å¤šå°‘æ¡ï¼Ÿ"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message       
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python">ChatCompletionMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">'assistant'</span><span class="token punctuation">,</span> function_call<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> tool_calls<span class="token operator">=</span><span class="token punctuation">[</span>ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_5VK3ywSsn76wNBfAEc17FaWr'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"sql_query":"SELECT COUNT(*) FROM user_demographics WHERE age &gt;= 60 AND gender = \'male\'"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'get_user_demographics'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¯ä»¥ä»ç»“æœä¸­æ£€æŸ¥å¤§æ¨¡å‹æ˜¯å¦æ­£å¸¸æ‰¾åˆ°è‡ªå·±ç”Ÿæˆçš„å·¥å…·å‡½æ•°ï¼Œä»¥åŠç”Ÿæˆçš„ç›¸å…³SQLæ˜¯å¦æ­£ç¡®ï¼›<br> æŸ¥è¯¢SQLä¸­ä½¿ç”¨äº†å¹´é¾„å¤§äº60å²ï¼Œæ¥æŸ¥è¯¢è€å¹´äººã€‚</p> 
<h3><a id="7_241"></a>7ã€è¯»å–æ•°æ®å­—å…¸</h3> 
<p>è¯»å–æœ¬åœ°çš„æ•°æ®å­—å…¸</p> 
<pre><code class="prism language-python"><span class="token comment"># æ‰“å¼€å¹¶è¯»å–Markdownæ–‡ä»¶</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/root/autodl-tmp/iqueryé¡¹ç›®/data/æ•°æ®å­—å…¸/iqueryæ•°æ®å­—å…¸.md'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    md_content <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
md_content
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code class="prism language-python"><span class="token string">'# iqueryæ•°æ®å­—å…¸ï¼šiqueryæ•°æ®åº“æ•°æ®å­—å…¸\n\næœ¬æ•°æ®å­—å…¸è®°å½•äº†iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨çš„åŸºæœ¬æƒ…å†µã€‚\n\n## 1.user_demographicsæ•°æ®è¡¨\n\n- åŸºæœ¬è§£é‡Š\n\n  \u200b\t\tuser_demographicsæ•°æ®è¡¨è®°å½•äº†ç”µä¿¡ç”¨æˆ·çš„ä¸ªäººåŸºæœ¬æƒ…å†µï¼Œä¸»è¦æ¶µç›–å®¢æˆ·åŸºæœ¬ç”Ÿç‰©å±æ€§ï¼ŒåŒ…æ‹¬æ€§åˆ«ã€å¹´é¾„çŠ¶å†µã€æ˜¯å¦ç»“å©šä»¥åŠæ˜¯å¦ç»æµç‹¬ç«‹ç­‰ã€‚\n\n- æ•°æ®æ¥æº\n\n  \u200b\tuser_demographicsæ•°æ®é›†ç”±ä¸€çº¿ä¸šåŠ¡äººå‘˜äººå·¥é‡‡é›†è®°å½•ï¼Œå¹¶ä¸”é€šè¿‡å›è®¿ç¡®è®¤ç›¸å…³ä¿¡æ¯ï¼Œæ•°æ®é›†çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦éƒ½éå¸¸é«˜ã€‚\n\n- å„å­—æ®µè¯´æ˜\n\n| Column Name | Description | Value Range | Value Explanation | Type |\n|-------------|-------------|-------------|-------------------|------|\n| customerID | å®¢æˆ·IDï¼Œuser_demographicsæ•°æ®è¡¨ä¸»é”® |              | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„ | VARCHAR(255) |\n| gender | ç”¨æˆ·çš„æ€§åˆ« | Female, Male | Female (å¥³æ€§), Male (ç”·æ€§) | VARCHAR(255) |\n| SeniorCitizen | æ˜¯å¦ä¸ºè€äºº | 0, 1 | 0 (ä¸æ˜¯), 1 (æ˜¯) | INT |\n| Partner | ç”¨æˆ·æ˜¯å¦æœ‰ä¼´ä¾£ | Yes, No | Yes (æœ‰), No (æ²¡æœ‰) | VARCHAR(255) |\n| Dependents | ç”¨æˆ·ç»æµæ˜¯å¦ç‹¬ç«‹ï¼Œå¾€å¾€ç”¨äºåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æˆå¹´ | No, Yes | Yes (æœ‰), No (æ²¡æœ‰) | VARCHAR(255) |\n\n## 2.user_servicesæ•°æ®è¡¨\n\n- åŸºæœ¬è§£é‡Š\n\n  \u200b        user_servicesæ•°æ®è¡¨è®°å½•äº†æ¯ä½ç”¨æˆ·è®¢è´­ç”µä¿¡æœåŠ¡çš„åŸºæœ¬æƒ…å†µï¼Œæˆªè‡³ç›®å‰ï¼Œç”µä¿¡æœåŠ¡å•†æä¾›äº†ç§ç±»å¤šæ ·çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ç”µè¯ç±»æœåŠ¡å’Œç½‘ç»œç±»æœåŠ¡ç­‰ï¼Œæœ¬æ•°æ®é›†è¡¨è®°å½•äº†æ¯ä½ç”¨æˆ·è®¢é˜…ç”µä¿¡æœåŠ¡çš„åŸºæœ¬æƒ…å†µã€‚\n\n- æ•°æ®æ¥æº\n\n  \u200b\t\tuser_servicesæ•°æ®è¡¨ç”±åå°ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºç”Ÿæˆï¼Œå¹¶æœªç»è¿‡äººå·¥æ ¡éªŒã€‚\n\n- å„å­—æ®µè¯´æ˜\n\n| Column Name | Description | Value Range | Value Explanation | Type |\n|-------------|-------------|-------------|-------------------|------|\n| customerID | å®¢æˆ·IDï¼Œuser_servicesæ•°æ®è¡¨ä¸»é”® |  | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„ | VARCHAR(255) |\n| PhoneService | ç”¨æˆ·æ˜¯å¦æœ‰ç”µè¯æœåŠ¡ | No, Yes | Yes (æœ‰), No (æ²¡æœ‰) | VARCHAR(255) |\n| MultipleLines | ç”¨æˆ·æ˜¯å¦å¼€é€šäº†å¤šæ¡ç”µè¯ä¸šåŠ¡ | No phone service, No, Yes | Yes (æœ‰å¤šæ¡ç”µè¯çº¿ä¸šåŠ¡), No (æ²¡æœ‰å¤šæ¡ç”µè¯çº¿ä¸šåŠ¡), No phone service (æ²¡æœ‰ç”µè¯æœåŠ¡) | VARCHAR(255) |\n| InternetService | ç”¨æˆ·çš„äº’è”ç½‘æœåŠ¡ç±»å‹ | DSL, Fiber optic, No | DSL (DSL), Fiber optic (å…‰çº¤), No (æ²¡æœ‰) | VARCHAR(255) |\n| OnlineSecurity | æ˜¯å¦å¼€é€šç½‘ç»œå®‰å…¨æœåŠ¡ | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n| OnlineBackup | æ˜¯å¦å¼€é€šåœ¨çº¿å¤‡ä»½æœåŠ¡ | Yes, No, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n| DeviceProtection | æ˜¯å¦å¼€é€šè®¾å¤‡ä¿æŠ¤æœåŠ¡ | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n| TechSupport | æ˜¯å¦å¼€é€šæŠ€æœ¯æ”¯æŒä¸šåŠ¡ | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n| StreamingTV | æ˜¯å¦å¼€é€šç½‘ç»œç”µè§† | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n| StreamingMovies | æ˜¯å¦å¼€é€šç½‘ç»œç”µå½± | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰ | VARCHAR(255) |\n\n## 3.user_paymentsæ•°æ®è¡¨\n\n- åŸºæœ¬è§£é‡Š\n\n  \u200b\t\tuser_paymentsæ•°æ®è¡¨è®°å½•äº†æ¯ä¸€ä½ç”¨æˆ·æ”¯ä»˜çŠ¶å†µï¼Œæ—¢åŒ…æ‹¬ç”¨æˆ·çš„æ”¯ä»˜æ–¹å¼å’ŒåˆåŒç±»å‹ï¼ŒåŒæ—¶ä¹ŸåŒ…å«ç”¨æˆ·å…·ä½“æ”¯ä»˜é‡‘é¢ï¼ŒåŒ…æ‹¬æœˆä»˜é‡‘é¢å’Œæ€»é‡‘é¢ç­‰ã€‚\n\n- æ•°æ®æ¥æº\n\n  \u200b\t\tuser_paymentsæ•°æ®è¡¨ç”±åå°è‡ªåŠ¨è®°å½•ç”Ÿæˆï¼Œå¹¶æœªç»è¿‡æ ¡éªŒã€‚\n\n- å„å­—æ®µè¯´æ˜\n\n| Column Name | Description | Value Range | Value Explanation | Type |\n|-------------|-------------|-------------|-------------------|------|\n| customerID | å®¢æˆ·IDï¼Œuser_paymentsæ•°æ®è¡¨ä¸»é”® |  | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„ | VARCHAR(255) |\n| Contract | åˆåŒç±»å‹ | Month-to-month, One year, Two year | Month-to-month (æœˆä»˜), One year (ä¸€å¹´ä»˜), Two year (ä¸¤å¹´ä»˜) | VARCHAR(255) |\n| PaperlessBilling | æ˜¯å¦æ— çº¸åŒ–è´¦å• | Yes, No | Yes (æ˜¯), No (å¦) | VARCHAR(255) |\n| PaymentMethod | æ”¯ä»˜æ–¹å¼ | Electronic check, Mailed check, Bank transfer (automatic), Credit card (automatic) | Electronic check (ç”µå­æ£€æŸ¥), Mailed check (é‚®å¯„æ”¯ç¥¨), Bank transfer (automatic) (é“¶è¡Œè½¬è´¦), Credit card (automatic) (ä¿¡ç”¨å¡) | VARCHAR(255) |\n| MonthlyCharges | æœˆè´¹ç”¨ |  | ç”¨æˆ·å¹³å‡æ¯æœˆæ”¯ä»˜è´¹ç”¨ | FLOAT        |\n| TotalCharges | æ€»è´¹ç”¨ |  | æˆªè‡³ç›®å‰ç”¨æˆ·æ€»æ¶ˆè´¹é‡‘é¢ | VARCHAR(255) |\n\n## 4.user_churn\n\n- åŸºæœ¬è§£é‡Š\n\n  \u200b\t\tuser_churnæ•°æ®è¡¨è®°å½•äº†å½“å‰ç”¨æˆ·æµå¤±æƒ…å†µã€‚\n\n- æ•°æ®æ¥æº\n\n  \u200b\t\tuser_churnæ•°æ®è¡¨ç”±åå°è‡ªåŠ¨åˆ›å»ºå¹¶è®°å½•ï¼Œå½“åˆåŒæˆªè‡³åä½†ç”¨æˆ·æœªç»­è´¹ï¼Œåˆ™åˆ¤æ–­è¯¥ç”¨æˆ·ç›®å‰å¤„äºæµå¤±çŠ¶æ€ã€‚\n\n- å„å­—æ®µè¯´æ˜\n\n| Column Name | Description | Value Range | Value Explanation | Type |\n|-------------|-------------|-------------|-------------------|------|\n| customerID | å®¢æˆ·IDï¼Œuser_churnæ•°æ®è¡¨ä¸»é”® |             | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„ | VARCHAR(255) |\n| Churn | ç”¨æˆ·æ˜¯å¦æµå¤± | No, Yes | Yes (æ˜¯), No (å¦) | VARCHAR(255) |\n\n'</span>
</code></pre> 
<h3><a id="8_258"></a>8ã€ç¬¬äºŒæ¬¡æ•°æ®æŸ¥è¯¢å¯¹è¯æµ‹è¯•</h3> 
<p>å°†æ•°æ®å­—å…¸ä½œä¸ºèƒŒæ™¯çŸ¥è¯†ï¼Œå†æ¬¡ä½¿ç”¨è‡ªç„¶è¯­è¨€å¯¹è¯çš„æ–¹å¼ï¼Œè¿›è¡Œæ•°æ®æŸ¥è¯¢åˆ†æ</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®user_demographicsè¡¨ä¸­ä¸ªäººå±æ€§ä¸ºè€å¹´ç”·æ€§çš„æ•°æ®æ€»å…±æœ‰å¤šå°‘æ¡ï¼Ÿ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python">ChatCompletionMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">'assistant'</span><span class="token punctuation">,</span> function_call<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> tool_calls<span class="token operator">=</span><span class="token punctuation">[</span>ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_e4LEDDcytWdGUx0m98plDpUa'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"sql_query":"SELECT * FROM user_demographics WHERE SeniorCitizen = 1 AND gender = \'Male\'"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'get_user_demographics'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>é€šè¿‡è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸€æ¬¡æ•°æ®æŸ¥è¯¢ä¸­ä½¿ç”¨äº†SeniorCitizen å­—æ®µï¼Œå› ä¸ºèƒŒæ™¯çŸ¥è¯†ä¸­ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ç”¨æ¥æ ‡è¯†è€äººçš„ï¼Œä¸éœ€è¦é€šè¿‡å¹´é¾„åˆ¤æ–­ã€‚<br> <img src="https://images2.imgbox.com/1e/6c/bcRJJ6DG_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="9_285"></a>9ã€æ•°æ®åº“åŸºæœ¬ä¿¡æ¯æŸ¥è¯¢æµ‹è¯•</h3> 
<p>è°ƒç”¨å¤§æ¨¡å‹APIæŸ¥è¯¢æ•°æ®åº“çš„åŸºæœ¬æƒ…å†µä¿¡æ¯</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘ä»‹ç»ä¸‹iqueryè¿™ä¸ªæ•°æ®åº“çš„åŸºæœ¬æƒ…å†µ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python"><span class="token string">'iqueryæ•°æ®åº“æ˜¯ä¸€ä¸ªç”¨äºç”µä¿¡ç”¨æˆ·æ•°æ®åˆ†æçš„æ•°æ®åº“ï¼Œä¸»è¦åŒ…æ‹¬äº†å››å¼ æ•°æ®è¡¨ï¼šuser_demographicsã€user_servicesã€user_paymentså’Œuser_churnã€‚è¿™äº›æ•°æ®è¡¨è®°å½•äº†ç”µä¿¡ç”¨æˆ·çš„ä¸ªäººåŸºæœ¬æƒ…å†µã€è®¢è´­çš„ç”µä¿¡æœåŠ¡æƒ…å†µã€æ”¯ä»˜æƒ…å†µä»¥åŠæµå¤±æƒ…å†µã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡iqueryæ•°æ®åº“ä¸­çš„æ•°æ®æ¥è¿›è¡Œç”¨æˆ·è¡Œä¸ºåˆ†æã€ç”¨æˆ·æµå¤±é¢„æµ‹ã€äº§å“å®šä»·ä¼˜åŒ–ç­‰å·¥ä½œã€‚æ¯å¼ æ•°æ®è¡¨éƒ½æœ‰å„è‡ªçš„å­—æ®µè¯´æ˜ï¼Œæ–¹ä¾¿ç”¨æˆ·äº†è§£å’Œåˆ©ç”¨æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚'</span>
</code></pre> 
<h3><a id="10_307"></a>10ã€æ•°æ®åˆ†æè°ƒç”¨æµ‹è¯•</h3> 
<p>è®©å¤§æ¨¡å‹å¸®å¿™åˆ†æuser_demographicsæ•°æ®è¡¨å’Œuser_servicesæ•°æ®è¡¨çš„æ•°æ®å¯ä¿¡åº¦ã€‚</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span> 
      <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"user_demographicsæ•°æ®è¡¨å’Œuser_servicesæ•°æ®è¡¨å“ªå¼ è¡¨çš„æ•°æ®å¯ä¿¡åº¦æ›´é«˜å‘¢ï¼Ÿ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python">æ ¹æ®æè¿°ï¼Œuser_demographicsæ•°æ®è¡¨ç”±ä¸€çº¿ä¸šåŠ¡äººå‘˜äººå·¥é‡‡é›†è®°å½•ï¼Œå¹¶é€šè¿‡å›è®¿ç¡®è®¤ç›¸å…³ä¿¡æ¯ï¼Œæ•°æ®é›†çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦éƒ½éå¸¸é«˜ã€‚è€Œuser_servicesæ•°æ®è¡¨ç”±åå°ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œå¹¶æœªç»è¿‡äººå·¥æ ¡éªŒã€‚å› æ­¤ï¼Œuser_demographicsæ•°æ®è¡¨çš„æ•°æ®å¯ä¿¡åº¦æ›´é«˜ã€‚
</code></pre> 
<h2><a id="_329"></a>ä¸‰ã€å®ç°äº¤äº’ç¡®è®¤</h2> 
<p>åœ¨æ•°æ®æŸ¥è¯¢åˆ†æå‰ï¼Œè®©å¤§æ¨¡å‹è¾“å‡ºå°†è¦æ‰§è¡Œçš„SQLï¼Œè®©ç”¨æˆ·ç¡®è®¤æ£€æŸ¥ï¼›åŒæ—¶å’¨è¯¢æ˜¯å¦éœ€è¦æ‰§è¡Œ</p> 
<h3><a id="1_331"></a>1ã€å®šä¹‰æ•°æ®åº“åŸºæœ¬ä¿¡æ¯è·å–å‡½æ•°</h3> 
<p>å®šä¹‰ä¸€ä¸ªè·å–æ•°æ®åº“åŸºæœ¬ä¿¡æ¯çš„å·¥å…·å‡½æ•°</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">sql_inter</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºè·å–iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨çš„æœ‰å…³ç›¸å…³ä¿¡æ¯ï¼Œ\
    æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†è¾“å…¥çš„SQLä»£ç ä¼ è¾“è‡³iqueryæ•°æ®åº“æ‰€åœ¨çš„MySQLç¯å¢ƒä¸­è¿›è¡Œè¿è¡Œï¼Œ\
    å¹¶æœ€ç»ˆè¿”å›SQLä»£ç è¿è¡Œç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬å‡½æ•°æ˜¯å€ŸåŠ©pymysqlæ¥è¿æ¥MySQLæ•°æ®åº“ã€‚
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæ‰§è¡Œå¯¹MySQLä¸­iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è·å¾—å„è¡¨ä¸­çš„å„ç±»ç›¸å…³ä¿¡æ¯
    :returnï¼šsql_queryåœ¨MySQLä¸­çš„è¿è¡Œç»“æœã€‚
    """</span>
    
    mysql_pw <span class="token operator">=</span> <span class="token string">"iquery_agent"</span>
    
    connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
            host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>
            user<span class="token operator">=</span><span class="token string">'iquery_agent'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>
            passwd<span class="token operator">=</span>mysql_pw<span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>
            db<span class="token operator">=</span><span class="token string">'iquery'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>
            charset<span class="token operator">=</span><span class="token string">'utf8'</span>  <span class="token comment"># å­—ç¬¦é›†é€‰æ‹©utf8</span>
        <span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            <span class="token comment"># SQLæŸ¥è¯¢è¯­å¥</span>
            sql <span class="token operator">=</span> sql_query
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

            <span class="token comment"># è·å–æŸ¥è¯¢ç»“æœ</span>
            results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_369"></a>2ã€å‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•æ£€æŸ¥ï¼š</h3> 
<pre><code class="prism language-python"><span class="token comment">#å®šä¹‰å·¥å…·å‡½æ•°åˆ—è¡¨</span>
functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>sql_inter<span class="token punctuation">]</span>

<span class="token comment">#å·¥å…·å‡½æ•°ä¿¡æ¯ç”Ÿæˆ</span>
tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
tools
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/ea/28/HFcbxJxP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ£€æŸ¥ç”Ÿæˆçš„å‡½æ•°ä¿¡æ¯ç»“æ„æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯å¦æœ‰ç¼ºå¤±çš„keyã€value</p> 
<h3><a id="3_385"></a>3ã€æ•°æ®åˆ†ææµ‹è¯•</h3> 
<pre><code class="prism language-python">messages <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®user_demographicsæ•°æ®è¡¨çš„ä¸»é”®å’Œuser_servicesæ•°æ®è¡¨çš„ä¸»é”®æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼Ÿ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
run_conversation<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/c3/f6/QU3E0j9g_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4SQL_399"></a>4ã€å®šä¹‰SQLæå–å‡½æ•°</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract_sql</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># æå–å¹¶è¿”å›'sql_query'çš„å€¼</span>
    <span class="token keyword">return</span> json_str<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sql_query'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5API_407"></a>5ã€ä¸¤æ¬¡æ¬¡å¤§æ¨¡å‹APIä¸¤æ¬¡è°ƒç”¨å°è£…æ”¹é€ </h3> 
<p>æ”¹é€ äºŒæ¬¡å¤§æ¨¡å‹APIä¸¤æ¬¡è°ƒç”¨çš„å°è£…å‡½æ•°ï¼Œå¼•å…¥ç”¨æˆ·ç¡®è®¤çš„é€»è¾‘</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">check_code_run</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>auto_run <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œå¤–éƒ¨å‡½æ•°è°ƒç”¨çš„å¯¹è¯æ¨¡å‹
    :param messages: å¿…è¦å‚æ•°ï¼Œå­—å…¸ç±»å‹ï¼Œè¾“å…¥åˆ°Chatæ¨¡å‹çš„messageså‚æ•°å¯¹è±¡
    :param functions_list: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œå¯ä»¥è®¾ç½®ä¸ºåŒ…å«å…¨éƒ¨å¤–éƒ¨å‡½æ•°çš„åˆ—è¡¨å¯¹è±¡
    :param model: Chatæ¨¡å‹ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ¨¡å‹ä¸ºgpt-3.5-turbo
    :returnï¼šChatæ¨¡å‹è¾“å‡ºç»“æœ
    """</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™æ‰§è¡Œæ™®é€šçš„å¯¹è¯ä»»åŠ¡</span>
    <span class="token keyword">if</span> functions_list <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
        
    <span class="token comment"># è‹¥å­˜åœ¨å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™éœ€è¦çµæ´»é€‰å–å¤–éƒ¨å‡½æ•°å¹¶è¿›è¡Œå›ç­”</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºfunctionså¯¹è±¡</span>
        tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
        

        <span class="token comment"># åˆ›å»ºå¤–éƒ¨å‡½æ•°åº“å­—å…¸</span>
        available_functions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">:</span> func <span class="token keyword">for</span> func <span class="token keyword">in</span> functions_list<span class="token punctuation">}</span>

        <span class="token comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨å¤§æ¨¡å‹</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
                        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        tool_calls <span class="token operator">=</span> response_message<span class="token punctuation">.</span>tool_calls
        <span class="token keyword">if</span> tool_calls<span class="token punctuation">:</span>
            messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response_message<span class="token punctuation">)</span> 
            <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> tool_calls<span class="token punctuation">:</span>
                function_name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
                function_to_call <span class="token operator">=</span> available_functions<span class="token punctuation">[</span>function_name<span class="token punctuation">]</span>
                function_args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
              
              
                <span class="token keyword">if</span> auto_run <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                    sql_query <span class="token operator">=</span> extract_sql<span class="token punctuation">(</span>function_args<span class="token punctuation">)</span>

                    res <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'å³å°†æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š%sã€‚æ˜¯å¦ç¡®è®¤å¹¶ç»§ç»­æ‰§è¡Œï¼ˆ1ï¼‰ï¼Œæˆ–è€…é€€å‡ºæœ¬æ¬¡è¿è¡Œè¿‡ç¨‹ï¼ˆ2ï¼‰'</span> <span class="token operator">%</span> sql_query<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ç»ˆæ­¢è¿è¡Œ"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">None</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ‰§è¡Œä»£ç ï¼Œè¯·ç¨å..."</span><span class="token punctuation">)</span>
                        
                function_response <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span><span class="token operator">**</span>function_args<span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"tool_call_id"</span><span class="token punctuation">:</span> tool_call<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"tool"</span><span class="token punctuation">,</span>
                        <span class="token string">"name"</span><span class="token punctuation">:</span> function_name<span class="token punctuation">,</span>
                        <span class="token string">"content"</span><span class="token punctuation">:</span> function_response<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span> 
            <span class="token comment">## ç¬¬äºŒæ¬¡è°ƒç”¨æ¨¡å‹</span>
            second_response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
            <span class="token punctuation">)</span> 
            <span class="token comment"># è·å–æœ€ç»ˆç»“æœ</span>
            final_response <span class="token operator">=</span> second_response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
    <span class="token keyword">del</span> messages
                
    <span class="token keyword">return</span> final_response
</code></pre> 
<h3><a id="6_486"></a>6ã€å®šä¹‰æ¶ˆæ¯åˆ—è¡¨</h3> 
<pre><code class="prism language-python">messages <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®iqueryæ•°æ®åº“ä¸‹user_demographicsè¡¨çš„ç¬¬10æ¡æ•°æ®å†…å®¹æ˜¯ï¼Ÿ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment">#å‡½æ•°åˆ—è¡¨æŸ¥çœ‹</span>
functions_list
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/ae/yxZxL4r9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="71_499"></a>7ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•1</h3> 
<pre><code class="prism language-python">check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> 
               functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
               model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
               auto_run <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/09/2b/zAlWbaR9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="82_510"></a>8ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•2</h3> 
<pre><code class="prism language-python">messages <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®iqueryæ•°æ®åº“ä¸‹user_demographicsè¡¨æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿ"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> 
               functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
               model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
               auto_run <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/6f/a2/g6kqjIOP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="93_526"></a>9ã€æ•°æ®æŸ¥è¯¢åˆ†ææµ‹è¯•3</h3> 
<pre><code class="prism language-python">messages <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·é—®iqueryæ•°æ®åº“ä¸‹user_demographicsè¡¨ä¸­ï¼Œç”·æ€§å’Œå¥³æ€§çš„åˆ†åˆ«æœ‰å¤šå°‘äºº"</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> 
               functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
               model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
               auto_run <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/1c/bf/R50HfkD2_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_542"></a>å››ã€å®ç°å®Œæ•´çš„å¤šè½®å¯¹è¯æ•ˆæœ</h2> 
<p>ç»è¿‡ä¸Šè¿°æ­¥éª¤çš„ä¸æ–­ä¼˜åŒ–å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬æœ€ç»ˆå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„å¤šè½®å¯¹è¯æ§åˆ¶ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿä¸ä»…èƒ½å¤Ÿç†è§£ç”¨æˆ·çš„æŸ¥è¯¢æ„å›¾ï¼Œè¿˜èƒ½å¤Ÿåœ¨éœ€è¦æ—¶å‘ç”¨æˆ·ç¡®è®¤ä¿¡æ¯ï¼Œä»è€Œä½¿å¾—æ•´ä¸ªæ•°æ®åˆ†æè¿‡ç¨‹æ›´åŠ é€æ˜ã€å¯æ§ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tiktoken

<span class="token keyword">def</span> <span class="token function">chat_with_inter</span><span class="token punctuation">(</span>functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> 
                    prompt<span class="token operator">=</span><span class="token string">"ä½ å¥½å‘€"</span><span class="token punctuation">,</span> 
                    model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
                    system_message<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    auto_run <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># åˆ›å»ºå‡½æ•°åˆ—è¡¨å¯¹åº”çš„å‚æ•°è§£é‡Šåˆ—è¡¨</span>
    functions <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
    
    <span class="token comment"># å¤šè½®å¯¹è¯é˜ˆå€¼</span>
    <span class="token keyword">if</span> <span class="token string">'gpt-4'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">6000</span>
    <span class="token keyword">elif</span> <span class="token string">'16k'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">14000</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">3000</span>
    
    messages <span class="token operator">=</span> system_message
    messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">## è®¡ç®—tokenå¤§å°</span>
    embedding_model <span class="token operator">=</span> <span class="token string">"text-embedding-ada-002"</span>
    <span class="token comment"># æ¨¡å‹å¯¹åº”çš„åˆ†è¯å™¨ï¼ˆTOKENIZERï¼‰</span>
    embedding_encoding <span class="token operator">=</span> <span class="token string">"cl100k_base"</span>
    encoding <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>get_encoding<span class="token punctuation">(</span>embedding_encoding<span class="token punctuation">)</span>
    tokens_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">(</span>prompt <span class="token operator">+</span> system_message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           
        answer <span class="token operator">=</span> check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> 
                                functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
                                model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                auto_run <span class="token operator">=</span> auto_run<span class="token punctuation">)</span>
        
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¨¡å‹å›ç­”: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>answer<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        <span class="token comment"># è¯¢é—®ç”¨æˆ·æ˜¯å¦è¿˜æœ‰å…¶ä»–é—®é¢˜</span>
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯): "</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">"é€€å‡º"</span><span class="token punctuation">:</span>
            <span class="token keyword">del</span> messages
            <span class="token keyword">break</span>

        <span class="token comment"># è®°å½•æ–°ä¸€è½®é—®ç­”</span>
        messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> answer<span class="token punctuation">}</span><span class="token punctuation">)</span>
        messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_input<span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment"># è®¡ç®—å½“å‰æ€»tokenæ•°</span>
        tokens_count <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">(</span>answer <span class="token operator">+</span> user_input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># åˆ é™¤è¶…å‡ºtokené˜ˆå€¼çš„å¯¹è¯å†…å®¹</span>
        <span class="token keyword">while</span> tokens_count <span class="token operator">&gt;=</span> tokens_thr<span class="token punctuation">:</span>
            tokens_count <span class="token operator">-=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>messages<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
chat_with_inter<span class="token punctuation">(</span>functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
                prompt<span class="token operator">=</span><span class="token string">"æˆ‘æƒ³æ ¹æ®iqueryæ•°æ®åº“ä¸­æ•°æ®åˆ†æç”¨æˆ·æµå¤±æƒ…å†µï¼Œè¯·é—®éœ€è¦ç”¨åˆ°iqueryæ•°æ®åº“ä¸­çš„å“ªå‡ å¼ è¡¨å‘¢ï¼Ÿ"</span><span class="token punctuation">,</span> 
                model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
                system_message<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                auto_run <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¯¹è¯æ•ˆæœ<br> <img src="https://images2.imgbox.com/b8/14/C6PrO92I_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_610"></a>äº”ã€ç»“è¯­</h2> 
<p>åœ¨æœ¬ç¯‡ç« ä¸­ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å¼ºåŒ–äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŠŸèƒ½ï¼Œé€šè¿‡å®ç°å¯æ§çš„å¤šè½®å¯¹è¯äº¤äº’ç¡®è®¤é€»è¾‘ï¼Œæå¤§åœ°æå‡äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚è¿™ä¸€è¿›æ­¥å°†ä¸ºæœªæ¥æ›´åŠ å¤æ‚ã€æ›´åŠ æ™ºèƒ½åŒ–çš„æ•°æ®åˆ†æå¹³å°çš„æ„å»ºå¥ å®šåšå®çš„åŸºç¡€ã€‚</p> 
<p><img src="https://images2.imgbox.com/f9/5d/OpsvMlKr_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ¯ğŸ”–æ›´å¤šä¸“æ ç³»åˆ—æ–‡ç« ï¼š<a href="https://blog.csdn.net/xiaobing259/category_12628007.html?spm=1001.2014.3001.5482"><strong>AIGC-AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯</strong></a></p> 
<blockquote> 
 <p>ğŸ˜ <strong>ä½œè€…ä»‹ç»</strong>ï¼šæˆ‘æ˜¯å¯»é“AIå°å…µï¼Œèµ„æ·±ç¨‹åºè€çŒ¿ï¼Œä»ä¸š10å¹´+ã€äº’è”ç½‘ç³»ç»Ÿæ¶æ„å¸ˆï¼Œç›®å‰ä¸“æ³¨äºAIGCçš„æ¢ç´¢ã€‚<br> ğŸ“– <strong>æŠ€æœ¯äº¤æµ</strong>ï¼šå»ºç«‹æœ‰æŠ€æœ¯äº¤æµç¾¤ï¼Œå¯ä»¥æ‰«ç ğŸ‘‡ åŠ å…¥ç¤¾ç¾¤ï¼Œ500æœ¬å„ç±»ç¼–ç¨‹ä¹¦ç±ã€AIæ•™ç¨‹ã€AIå·¥å…·ç­‰ä½ é¢†å–ï¼<br> <strong>å¦‚æœæ–‡ç« å†…å®¹å¯¹æ‚¨æœ‰æ‰€è§¦åŠ¨ï¼Œåˆ«å¿˜äº†<font color="red"><strong>ç‚¹èµã€â­å…³æ³¨ï¼Œæ”¶è—</strong></font>ï¼åŠ å…¥æˆ‘ï¼Œè®©æˆ‘ä»¬æºæ‰‹åŒè¡ŒAIçš„æ¢ç´¢ä¹‹æ—…ï¼Œä¸€èµ·å¼€å¯æ™ºèƒ½æ—¶ä»£çš„å¤§é—¨ï¼</strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1028fec28fc399d4d9418054775f3b11/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">éšå¿ƒç¬”è®°ï¼Œç¬¬å››æ›´</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/efb4eea5aa66c7672abe107e6ba3f44b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€æœºå™¨å­¦ä¹ ã€‘åŸºäºYOLOv10å®ç°ä½ çš„ç¬¬ä¸€ä¸ªè§†è§‰AIå¤§æ¨¡å‹</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>