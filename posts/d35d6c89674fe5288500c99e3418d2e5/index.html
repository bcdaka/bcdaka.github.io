<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Android WebView】WebView基础 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d35d6c89674fe5288500c99e3418d2e5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Android WebView】WebView基础">
  <meta property="og:description" content="一、简介 WebView是一个基于webkit引擎、展现web页面的控件。Android的Webview在低版本和高版本采用了不同的webkit版本内核，4.4后直接使用了Chrome。
二、重要类 以WebView类为基础，WebSettings、WebViewClient、WebChromeClient为辅助共同完成安卓段加载网页的操作。
1、WebView //1、加载网页相关 //直接加载服务器网页 my_web_view.loadUrl(&#34;https://www.baidu.com&#34;) //直接加载本地网页file:///android_asset/为固定写法） my_web_view.loadUrl(&#34;file:///android_asset/1.html&#34;) // 缓存历史清理 //Clears the resource cache. Note that the cache is per-application, // so this will clear the cache for all WebViews used. my_web_view.clearCache(true) // 清空历史（本webView浏览的） my_web_view.clearHistory() // 结合工具类 my_web_view.webViewClient = object : WebViewClient() // 设置webViewClient my_web_view.webChromeClient = object : WebChromeClient()// 设置WebChromeClient /** * 返回键处理，网页中可返回上一页，不处理返回键直接退出App * */ override fun onKeyDown(keyCode: Int, event: KeyEvent?): Boolean { //when user press back code and canGoBack if (keyCode == KeyEvent.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-18T22:45:11+08:00">
    <meta property="article:modified_time" content="2024-06-18T22:45:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Android WebView】WebView基础</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/52/65/bJn6V8rk_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_2"></a>一、简介</h2> 
<blockquote> 
 <p><code>WebView</code>是一个基于<code>webkit</code>引擎、展现<code>web</code>页面的控件。Android的Webview在低版本和高版本采用了不同的webkit版本内核，4.4后直接使用了Chrome。</p> 
</blockquote> 
<h2><a id="_6"></a>二、重要类</h2> 
<blockquote> 
 <p>以WebView类为基础，WebSettings、WebViewClient、WebChromeClient为辅助共同完成安卓段加载网页的操作。</p> 
</blockquote> 
<h6><a id="1WebView_10"></a>1、WebView</h6> 
<pre><code class="prism language-kotlin">        <span class="token comment">//1、加载网页相关</span>
        
        <span class="token comment">//直接加载服务器网页</span>
        my_web_view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"https://www.baidu.com"</span></span><span class="token punctuation">)</span>
        <span class="token comment">//直接加载本地网页file:///android_asset/为固定写法）</span>
        my_web_view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>"file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//android_asset/1.html")        </span>

        <span class="token comment">// 缓存历史清理</span>
        <span class="token comment">//Clears the resource cache. Note that the cache is per-application,</span>
        <span class="token comment">// so this will clear the cache for all WebViews used.</span>
        my_web_view<span class="token punctuation">.</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">// 清空历史（本webView浏览的）</span>
        my_web_view<span class="token punctuation">.</span><span class="token function">clearHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// 结合工具类</span>
        my_web_view<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 设置webViewClient</span>
        my_web_view<span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 设置WebChromeClient</span>

    <span class="token comment">/**
     * 返回键处理，网页中可返回上一页，不处理返回键直接退出App
     * */</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span>keyCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> event<span class="token operator">:</span> KeyEvent<span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//when user press back code and canGoBack</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> KeyEvent<span class="token punctuation">.</span>KEYCODE_BACK <span class="token operator">&amp;&amp;</span> my_web_view<span class="token punctuation">.</span><span class="token function">canGoBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            my_web_view<span class="token punctuation">.</span><span class="token function">goBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onKeyDown</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="2WebSettings_44"></a>2、WebSettings</h6> 
<pre><code class="prism language-kotlin">   <span class="token comment">/**
     * WebSettings类：对webView 进行配置管理
     * */</span>
    <span class="token annotation builtin">@SuppressLint</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SetJavaScriptEnabled"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"ObsoleteSdkInt"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">webViewSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> webSettings <span class="token operator">=</span> my_web_view<span class="token punctuation">.</span>settings
        <span class="token comment">// js交互控制</span>
        <span class="token comment">//支持js交互，动画等操作会造成cpu、电量消耗可在activity、 fragment的onResume、onStop进行开关控制</span>
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span>         
        <span class="token comment">// 适配</span>
        webSettings<span class="token punctuation">.</span>useWideViewPort <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//自适应屏幕-&gt;自动将图片调整到自适应webView 大小</span>
        webSettings<span class="token punctuation">.</span>loadWithOverviewMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//自适应屏幕-&gt;缩放到屏幕大小</span>
        <span class="token comment">//缩放</span>
        webSettings<span class="token punctuation">.</span><span class="token function">setSupportZoom</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">//支持缩放，默认为true。</span>
        webSettings<span class="token punctuation">.</span>builtInZoomControls <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//设置是否展示内置的缩放控件，默认为false</span>
        webSettings<span class="token punctuation">.</span>displayZoomControls <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//显示原生的缩放控件</span>

        <span class="token comment">//其他</span>
        webSettings<span class="token punctuation">.</span>allowFileAccess <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 可访问文件</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 支持js 自动打开新窗口</span>
        webSettings<span class="token punctuation">.</span>loadsImagesAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 支持自动加载图片</span>
        webSettings<span class="token punctuation">.</span>defaultTextEncodingName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"UTF-8"</span></span> <span class="token comment">// 默认值也是UTF-8</span>

        <span class="token comment">//缓存控制</span>
        webSettings<span class="token punctuation">.</span>domStorageEnabled <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 开启dom缓存功能</span>
        webSettings<span class="token punctuation">.</span>databaseEnabled <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 开启数据库缓存功能</span>
        webSettings<span class="token punctuation">.</span><span class="token function">setAppCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token comment">// 开启application 缓存功能</span>
        webSettings<span class="token punctuation">.</span>cacheMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>LOAD_CACHE_ELSE_NETWORK <span class="token comment">//设置缓存模式                           （LOAD_CACHE_ELSE_NETWORK，有缓存时加载缓存，即使缓存过期，没有时从网络加载）</span>
        webSettings<span class="token punctuation">.</span><span class="token function">setAppCachePath</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">""</span></span><span class="token punctuation">)</span> <span class="token comment">// 设置app缓存目录，api已弃用。</span>

        <span class="token comment">// 5.1以上默认禁止了https和http混用,开启如下</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>LOLLIPOP_MR1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            webSettings<span class="token punctuation">.</span>mixedContentMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>MIXED_CONTENT_ALWAYS_ALLOW
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3WebViewClient_87"></a>3、WebViewClient</h6> 
<blockquote> 
 <p>协助WebView工作，有一些列回调方法，用于处理各种通知 &amp; 请求事件等。</p> 
</blockquote> 
<pre><code class="prism language-java">    my_web_view<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//加载url、返回false 代表使用webView 加载url 不使用系统浏览器。</span>
            override fun <span class="token function">shouldOverrideUrlLoading</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token class-name">WebResourceRequest</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
               <span class="token comment">// 如下loadUrl，return true 这种也代表不使用系统浏览器。但是官方建议直接 return false</span>
              <span class="token comment">//  view?.loadUrl("https://www.baidu.com")</span>
              <span class="token comment">//  return true</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token comment">// 直接return false即可</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 页面加载时回调</span>
            override fun <span class="token function">onPageStarted</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> favicon<span class="token operator">:</span> <span class="token class-name">Bitmap</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPageStarted</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">,</span> favicon<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 页面加载完成时回调</span>
            override fun <span class="token function">onPageFinished</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPageFinished</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 加载页面资源时调用（如页面上有好多图片，没加载一张就会回调一次）</span>
            override fun <span class="token function">onLoadResource</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLoadResource</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 加载页面时服务器出现错误（例如404）</span>
            override fun <span class="token function">onReceivedError</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token class-name">WebResourceRequest</span><span class="token operator">?</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token class-name">WebResourceError</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onReceivedError</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">,</span> error<span class="token punctuation">)</span>
                <span class="token comment">// todo 展示自定义html页面，提示错误。</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 处理https请求</span>
            override fun <span class="token function">onReceivedSslError</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token class-name">SslErrorHandler</span><span class="token operator">?</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token class-name">SslError</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 不要使用super，否则有些手机访问不了，因为包含了一条 handler.cancel()</span>
                <span class="token comment">// super.onReceivedSslError(view, handler, error);</span>
              
                <span class="token comment">// 接受所有网站的证书，忽略SSL错误，执行访问网页。这种方式在发生ssl不会影响网页加载。</span>
                <span class="token comment">// 但是google play 认为这是不安全的操作。会给你警告。</span>
                handler<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                <span class="token comment">// handler?.cancel() // 发生ssl时挂起连接表现为白屏，默认方式。</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="4WebChromeClient_136"></a>4、WebChromeClient</h6> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * WebChromeClient类：辅助webView 处理js dialog、网站icon、网站title。
     * js的各种dialog事件触发时可由webChromeClient的响应方法回调到。
     * */</span>
    <span class="token keyword">private</span> fun <span class="token function">webChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        my_web_view<span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 获得网页进度时回调</span>
            override fun <span class="token function">onProgressChanged</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> newProgress<span class="token operator">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onProgressChanged</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> newProgress<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 获取网页的标题时回调</span>
            override fun <span class="token function">onReceivedTitle</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onReceivedTitle</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> title<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 是否由客户端处理js Alert 事件，true 代表客户端处理，false 代表客户端不处理。</span>
            <span class="token comment">// 一般客户端处理时客户端 展示对话框让用户进行选择</span>
            override fun <span class="token function">onJsAlert</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token class-name">JsResult</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Title"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">"确定"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> dialog<span class="token punctuation">,</span> which <span class="token operator">-&gt;</span>
                        result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// js Confirm 对话框拦截，true代表点击确定，false 代表点击取消。</span>
            override fun <span class="token function">onJsConfirm</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token class-name">JsResult</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onJsConfirm</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">,</span> message<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
           <span class="token comment">// 输入框拦截，true 代表返回输入框的值，false 代表返回null</span>
            override fun <span class="token function">onJsPrompt</span><span class="token punctuation">(</span>
                view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span>
                url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                message<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                defaultValue<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                result<span class="token operator">:</span> <span class="token class-name">JsPromptResult</span><span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onJsPrompt</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">,</span> message<span class="token punctuation">,</span> defaultValue<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Android__JS__189"></a>三、Android 调用 JS 代码</h2> 
<h6><a id="_191"></a>方式</h6> 
<ul><li>webView的loadUrl(" javascript:js方法()")</li><li>webView的evaluateJavascript（）</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>SunnyDay<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--内部引入法--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">showAlertDialog</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
         <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"i am js alert dialog，i am js method!"</span><span class="token operator">+</span>result<span class="token punctuation">)</span>
          <span class="token keyword">return</span> <span class="token string">"i am js method!"</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>i am a simple html page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>&gt;
</code></pre> 
<blockquote> 
 <p>如上准备个1.html文件</p> 
</blockquote> 
<h6><a id="1webViewloadUrl__217"></a>1、webView#loadUrl 加载原理及其代码</h6> 
<blockquote> 
 <p>借助webChromeClient 的各种回调处理。一般为js的各种dialog 方法触发时被安卓webViewClient的各种回调监听方法拦截消费。</p> 
</blockquote> 
<pre><code class="prism language-java">        webSettings <span class="token operator">=</span> web_view<span class="token punctuation">.</span>settings
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//允许启用js功能</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 允许js弹窗</span>
        <span class="token comment">// 加载Assets下html文件（这时js代码也就载入了）</span>
        <span class="token comment">//加载assets文件夹下的html文件时使用固定格式语法即可：file:///android_asset/文件名.html</span>
        web_view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"file:///android_asset/1.html"</span><span class="token punctuation">)</span>       
        
        web_view<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token function">callByLoadUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">//webView只是载体，内容的渲染需要使用webViewChromeClient类去实现,所以在这里写回调处理。</span>
        web_view<span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 此方法可回调到alert警告框的信息。</span>
            override fun <span class="token function">onJsAlert</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token class-name">JsResult</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                val build <span class="token operator">=</span> <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"Js showAlertDialog Method"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token string">"确定"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> dialog<span class="token punctuation">,</span> which <span class="token operator">-&gt;</span>
                        result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                build<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

   <span class="token comment">/**
     * 方式1：webView的loadUrl()
     * */</span>
    <span class="token keyword">private</span> fun <span class="token function">callByLoadUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 点击安卓按钮加载js方法</span>
        btn_call_js_method<span class="token punctuation">.</span>setOnClickListener <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 调用js时要保证网页加载完成，否则js代码调用失败。因为html中也是页面加载完成才响应的js。</span>
            web_view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"javascript:showAlertDialog(\"result\")"</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<p>（2）webView#evaluateJavascript</p> 
<pre><code class="prism language-java">        webSettings <span class="token operator">=</span> web_view<span class="token punctuation">.</span>settings
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//允许启用js功能</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 允许js弹窗</span>

        <span class="token comment">// 加载Assets下html文件（这时js代码也就载入了）</span>
        web_view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"file:///android_asset/1.html"</span><span class="token punctuation">)</span><span class="token comment">//加载assets文件夹下的html文件时使用固定格式语          法即可：file:///android_asset/文件名.html</span>
        web_view<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token function">callByEvaluateJavascript</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     
   <span class="token comment">/**
     *方式2：webView的evaluateJavascript
     * js 方法无返回值时it为 null
     */</span>
    <span class="token keyword">private</span> fun <span class="token function">callByEvaluateJavascript</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        btn_call_js_method<span class="token punctuation">.</span>setOnClickListener <span class="token punctuation">{<!-- --></span>
                web_view<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span><span class="token string">"javascript:showAlertDialog()"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"AndroidCallJsActivity"</span><span class="token punctuation">,</span> <span class="token string">""</span> <span class="token operator">+</span> it<span class="token punctuation">)</span><span class="token comment">//AndroidCallJsActivity"i am js method!"</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>（3）总结</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Android call js method practice
 * 两种方式：
 * 1、webView的loadUri(" javascript:js方法()")
 *    这种方式一般调用的为js的dialog方法，使用安卓的WebChromeClient 对应回调方法进行拦截处理。
 * 2、webView的evaluateJavascript
 *     直接调用js的方法，还可以获得js方法返回值回调
 *     js方法结果回调为String 类型值
 *     js方法无返回值，这里回调为null
 *
 *     建议以这种方式，既可快捷获得返回值，又可通过1中的dialog回调处理。
 *
 *     小结：Android call js method
 *          安卓调用js方法后可以在安卓端获得结果回调处理。
 * */</span>
</code></pre> 
<table><thead><tr><th>调用方式</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>loadUrl</td><td>方便简洁</td><td>效率低，获取返回值麻烦</td><td>不需要获取返回值时</td></tr><tr><td>evaluateJavascript</td><td>效率高</td><td>安卓4.4以上才能使用</td><td>安卓4.4以上</td></tr></tbody></table> 
<h2><a id="Js_317"></a>四、Js调用安卓代码</h2> 
<h6><a id="_319"></a>方式</h6> 
<ul><li>通过webView的addJavascriptInterface方法</li><li>通过重写webViewClient的shouldOverrideUrlLoading方法筛选url调用</li><li>通过 WebChromeClient 的dialog 回调判断筛选url调用</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>SunnyDay<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--内部引入法--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">//方式1：对象映射方式</span>
        <span class="token keyword">function</span> <span class="token function">callAndroid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             <span class="token comment">// 调用安卓的hello方法，由于安卓中添加了对象映射，test.hello()就相当于安卓的      </span>
             <span class="token comment">//JsInterface().hello()</span>
             test<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">" i am js code！ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
        <span class="token comment">//方式2：重写shouldOverrideUrlLoading 进行拦截</span>
        <span class="token keyword">function</span> <span class="token function">callAndroid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
             document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">"js://webview?arg1=111&amp;arg2=222"</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
        <span class="token comment">//方式3：WebChromeClient 的 onJsAlert、onJsConfirm、onJsPrompt 方法回调拦截 JS 对话框</span>
        <span class="token keyword">function</span> <span class="token function">callAndroid3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token comment">//1、首先搞个输入框，触发时安卓可获得回调</span>
              <span class="token comment">//2、收到回调后安卓处理，点击确定返回输入框值，点击取消返回null</span>
              <span class="token keyword">var</span> result<span class="token operator">=</span><span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"js://demo?arg1=111&amp;arg2=222"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"demo "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>i am a simple html page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
//方式1
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">callAndroid</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>点我即可调用Android的hello方法<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
//方式2
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn2<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">callAndroid2</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>方式2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
//方式3
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button3<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">callAndroid3</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>方式3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>&gt;
</code></pre> 
<h6><a id="1addJavascriptInterface_367"></a>1、addJavascriptInterface</h6> 
<p>（1）定义对象映射方法</p> 
<pre><code class="prism language-java">
<span class="token comment">/**
 * 1、自定义对象用于对象映射
 * 2、自定义方法，映射后供js对象使用
 * 3、方法必须加JavascriptInterface注解
 */</span>
<span class="token keyword">class</span> <span class="token class-name">JsInterface</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@JavascriptInterface</span>
    fun <span class="token function">hello</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"JsCallAndroidActivity"</span><span class="token punctuation">,</span> <span class="token string">"android method hello is called:$msg"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（2）映射</p> 
<pre><code class="prism language-java">        <span class="token comment">//js调用安卓方法方式1：</span>
        webSettings <span class="token operator">=</span> web_view_th<span class="token punctuation">.</span>settings
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//允许启用js功能</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 允许js弹窗</span>
        web_view_th<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"file:///android_asset/2.html"</span><span class="token punctuation">)</span>
          
        <span class="token comment">// 定义对象映射，把自定义的JsInterface映射给"test",供js对象使用。</span>
        web_view_th<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token class-name">JsInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token comment">// 一行代码十分简单</span>
</code></pre> 
<h6><a id="2webViewClientshouldOverrideUrlLoading_399"></a>2、重写webViewClient的shouldOverrideUrlLoading方法</h6> 
<pre><code class="prism language-java">        webSettings <span class="token operator">=</span> web_view_th<span class="token punctuation">.</span>settings
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//允许启用js功能</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 允许js弹窗</span>
        web_view_th<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"file:///android_asset/2.html"</span><span class="token punctuation">)</span>
          
        web_view_th<span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            override fun <span class="token function">shouldOverrideUrlLoading</span><span class="token punctuation">(</span>view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span> request<span class="token operator">:</span> <span class="token class-name">WebResourceRequest</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//view?.url //file:///android_asset/2.html ，</span>
                <span class="token comment">//注意这里的两个url不相同 get的url为   webViewLoad的，request的为动态定义的</span>
                val requestUrl <span class="token operator">=</span> request<span class="token operator">?</span><span class="token punctuation">.</span>url
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"JsCallAndroidActivity"</span><span class="token punctuation">,</span> <span class="token string">""</span> <span class="token operator">+</span> requestUrl<span class="token punctuation">)</span> <span class="token comment">//js://webview?arg1=111&amp;arg2=222</span>
                <span class="token keyword">return</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>requestUrl<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"js://webview?arg1=111&amp;arg2=222"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 符合筛选，调用安卓方法。</span>
                    <span class="token function">printLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token boolean">true</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">shouldOverrideUrlLoading</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
 <span class="token keyword">private</span> fun <span class="token function">printLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"JsCallAndroidActivity"</span><span class="token punctuation">,</span> <span class="token string">"android method：print log ！"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3_WebChromeClient_dialog_url_428"></a>3、通过 WebChromeClient 的dialog 回调判断筛选url调用</h6> 
<pre><code class="prism language-java">
webSettings <span class="token operator">=</span> web_view_th<span class="token punctuation">.</span>settings
        webSettings<span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">//允许启用js功能</span>
        webSettings<span class="token punctuation">.</span>javaScriptCanOpenWindowsAutomatically <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 允许js弹窗</span>
        web_view_th<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"file:///android_asset/2.html"</span><span class="token punctuation">)</span>
  
web_view_th<span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> object <span class="token operator">:</span> <span class="token class-name">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            override fun <span class="token function">onJsPrompt</span><span class="token punctuation">(</span>
                view<span class="token operator">:</span> <span class="token class-name">WebView</span><span class="token operator">?</span><span class="token punctuation">,</span>
                url<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                message<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                defaultValue<span class="token operator">:</span> <span class="token class-name">String</span><span class="token operator">?</span><span class="token punctuation">,</span>
                result<span class="token operator">:</span> <span class="token class-name">JsPromptResult</span><span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span> <span class="token punctuation">{<!-- --></span>
                val uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"js"</span> <span class="token operator">==</span> uri<span class="token punctuation">.</span>scheme<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"demo"</span> <span class="token operator">==</span> uri<span class="token punctuation">.</span>authority<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        result<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"JS 调用了 Android 的方法"</span><span class="token punctuation">)</span>
                        <span class="token comment">// 符合筛选，调用安卓方法。</span>
                        <span class="token function">printLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onJsPrompt</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">,</span> message<span class="token punctuation">,</span> defaultValue<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="4_460"></a>4、小结</h6> 
<pre><code class="prism language-java"><span class="token comment">/**
 * js call android method practise
 * 1、webView的addJavascriptInterface（自定义对象，“映射给的自定义字符串对象”）
 * 这种方式最简单，自定义对象，内部定义一系列方法供js调用。js拿到映射对象即可调用安卓自定义的对象方法
 *
 * 2、重写webViewClient的shouldOverrideUrlLoading方法，筛选请求的url是否为js规定的url，是规定的则调用安卓的相应方法。
 *
 * 3、通过 WebChromeClient 的onJsAlert()、onJsConfirm()、onJsPrompt（）方法回调拦截JS对话框alert()、confirm()、prompt（），原理与2一致。
 * */</span>
</code></pre> 
<table><thead><tr><th>调用方式</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>WebView.addJavascriptInterface 对象映射</td><td>方便简洁</td><td>Android 4.2 一下存在漏洞</td><td>Android 4.2 以上相对简单的应用场景</td></tr><tr><td>WebViewClient.shouldOverrideUrlLoading 回调拦截</td><td>不存在漏洞</td><td>使用复杂，需要协议约束</td><td>不需要返回值情况下</td></tr><tr><td>WebChormeClient.onJsAlert / onJsConfirm / onJsPrompt 方法回调拦截</td><td>不存在漏洞</td><td>使用复杂，需要协议约束</td><td>能满足大多数场景</td></tr></tbody></table> 
<h2><a id="Android__481"></a>五、Android 内嵌网页时登录状态同步方案</h2> 
<h6><a id="1_WebView__Cookie__483"></a>1、使用 WebView 和 Cookie 同步</h6> 
<p>Android 的 WebView 是一种能在应用中显示网页的组件。WebView 会自动处理 Cookies，但为了确保登录状态的同步，可能需要手动同步应用和 WebView 的 Cookies。</p> 
<p>(1) 获取应用中的 Cookie</p> 
<p>如果你的应用在登录后保存了 Cookie，可以通过 CookieManager 来获取这些 Cookie。</p> 
<p>(2) 将 Cookie 注入 WebView：</p> 
<p>在加载网页前，将这些 Cookie 注入 WebView 的 CookieManager。</p> 
<pre><code class="prism language-java"><span class="token class-name">CookieManager</span> cookieManager <span class="token operator">=</span> <span class="token class-name">CookieManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cookieManager<span class="token punctuation">.</span><span class="token function">setAcceptCookie</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取应用的 Cookie，假设名为 "appCookie"</span>
<span class="token class-name">String</span> appCookie <span class="token operator">=</span> <span class="token string">"key=value; domain=yourdomain.com"</span><span class="token punctuation">;</span>
cookieManager<span class="token punctuation">.</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token string">"yourdomain.com"</span><span class="token punctuation">,</span> appCookie<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载网页</span>
webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">"https://yourdomain.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>(3) 确保同步：<br> 在 WebView 加载新页面时，确保 Cookie 同步。</p> 
<pre><code class="prism language-java">webView<span class="token punctuation">.</span><span class="token function">setWebViewClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPageFinished</span><span class="token punctuation">(</span><span class="token class-name">WebView</span> view<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPageFinished</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CookieManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="2_Shared_Preferences__JavaScript_Bridge_519"></a>2、使用 Shared Preferences 和 JavaScript Bridge</h6> 
<p>这种方法可以通过 JavaScript 与 Android 应用交互，保持登录状态同步。</p> 
<p>(1)保存登录状态：<br> 登录后，将登录状态（例如 token）保存到 Shared Preferences。</p> 
<pre><code class="prism language-java"><span class="token class-name">SharedPreferences</span> sharedPref <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"MyApp"</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> sharedPref<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> <span class="token string">"your_token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>(2)设置 JavaScript 接口：<br> 在 WebView 中设置 JavaScript 接口，用于获取登录状态。</p> 
<pre><code class="prism language-java">webView<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@JavascriptInterface</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SharedPreferences</span> sharedPref <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"MyApp"</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sharedPref<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"Android"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>(3)在网页中使用：<br> 在网页的 JavaScript 中调用这个接口，获取登录状态。</p> 
<pre><code class="prism language-java">function <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">Android</span><span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在需要时调用 getToken()，例如页面加载完成后</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> token <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用 token 做进一步处理</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h6><a id="3_OAuth_SSO_563"></a>3、使用 OAuth 进行单点登录（SSO）</h6> 
<p>如果你的应用和网页都支持 OAuth，可以使用 OAuth 进行单点登录。</p> 
<p>（1）在应用中获取 OAuth Token：<br> 用户在应用中登录后，获取 OAuth Token 并保存。</p> 
<p>（2）WebView 加载网页时附加 Token：<br> 在加载网页时，将 Token 附加在 URL 或请求头中。</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://yourdomain.com?token="</span> <span class="token operator">+</span> oauthToken<span class="token punctuation">;</span>
webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者设置请求头</span>
webView<span class="token punctuation">.</span><span class="token function">setWebViewClient</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">WebResourceResponse</span> <span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span><span class="token class-name">WebView</span> view<span class="token punctuation">,</span> <span class="token class-name">WebResourceRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> <span class="token string">"Bearer "</span> <span class="token operator">+</span> oauthToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setRequestHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h6><a id="4_589"></a>4、使用统一的身份认证系统</h6> 
<p>如果你的应用和网页都使用统一的身份认证系统（如 Firebase Authentication），可以通过相同的身份认证机制同步登录状态。</p> 
<p>（1）应用中登录：<br> 使用统一的身份认证系统登录，并获取认证信息。</p> 
<p>（2）WebView 中共享认证信息：<br> 通过与身份认证系统的集成，在 WebView 中实现自动登录。</p> 
<pre><code class="prism language-java"><span class="token class-name">FirebaseAuth</span> mAuth <span class="token operator">=</span> <span class="token class-name">FirebaseAuth</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FirebaseUser</span> currentUser <span class="token operator">=</span> mAuth<span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> idToken <span class="token operator">=</span> currentUser<span class="token punctuation">.</span><span class="token function">getIdToken</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://yourdomain.com?token="</span> <span class="token operator">+</span> idToken<span class="token punctuation">;</span>
    webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="WebView_611"></a>六、WebView相关优化建议</h2> 
<h6><a id="1_WebView__613"></a>1、给 WebView 加一个加载进度条</h6> 
<blockquote> 
 <p>为了友好展示，重写 WebChromeClient 的 onProgressChanged 方法。未加载完成时展示loading进度条</p> 
</blockquote> 
<h6><a id="2_HTML__finsh__617"></a>2、提高 HTML 网页加载速度，等页面 finsh 在加载图片</h6> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> load <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        webView<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLoadsImagesAutomatically</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        webView<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setLoadsImagesAutomatically</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3onReceivedError__629"></a>3、onReceivedError 时加载自定义界面</h6> 
<blockquote> 
 <p>web的error 页面比较丑，我们可以在加载失败时，展示安卓自定义的错误展示页。</p> 
</blockquote> 
<p>4、动画、银屏、视频 合适加载释放</p> 
<blockquote> 
 <p>动画、银屏、视频 加载会造成cpu、电量消耗可在activity、 fragment的onResume、onStop进行开关控制。</p> 
</blockquote> 
<h2><a id="_639"></a>七、收获</h2> 
<h6><a id="1_641"></a>1、明文传输控制</h6> 
<blockquote> 
 <p>Android P 阻止加载任何 http 的请求,在清单文件application节点 添加android:usesCleartextTraffic=“true”</p> 
</blockquote> 
<h6><a id="2Android_50__WebView__http__https___645"></a>2、Android 5.0 之后 WebView 禁止加载 http 与 https 混合内容 。这样会造成某些资源加载失败。</h6> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span><span class="token operator">&gt;</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION_CODES</span><span class="token punctuation">.</span><span class="token constant">LOLLIPOP</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          webview<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
              <span class="token function">setMixedContentMode</span><span class="token punctuation">(</span><span class="token class-name">WebSettings</span><span class="token punctuation">.</span><span class="token constant">MIXED_CONTENT_ALWAYS_ALLOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

<span class="token comment">/*

例如：https://www.aaa.com.cn/a/b/c/d/e/index.html?uid=0011&amp;URL=http://www.bbb.com.cn/1.png 这个url

1、实际页面为：https://www.aaa.com.cn/a/b/c/d/e/index.html 后面追加了一些参数

2、h5页面上src标签加载http://www.bbb.com.cn/1.png

此时你使用webview.loadUrl("https://www.aaa.com.cn/a/b/c/d/e/index.html?uid=0011&amp;URL=http://www.bbb.com.cn/1.png") 就会出现h5 图片显示失败。

解决方案开启MixedContentMode

*/</span>
</code></pre> 
<h6><a id="3_667"></a>3、硬件加速开启导致问题</h6> 
<blockquote> 
 <p>比如不能打开 PDF，播放视频花屏等等。关闭硬件加速。</p> 
</blockquote> 
<h6><a id="4webViewClientshouldOverrideUrlLoading_671"></a>4、重写webViewClient的shouldOverrideUrlLoading</h6> 
<blockquote> 
 <p>否则系统不知道你是想用webview打开url 还是使用系统浏览器。</p> 
</blockquote> 
<h6><a id="5WebView_676"></a>5、WebView白屏问题</h6> 
<blockquote> 
 <p>原因：页面进度不到100%时显示的就是白屏，进度到100时开始加载网页资源。</p> 
 <p>解决:网上方案较多这里提示一种：进度不到100时展示加载提示。</p> 
</blockquote> 
<h2><a id="The_end_683"></a>The end</h2> 
<p><a href="https://developer.android.google.cn/reference/kotlin/android/webkit/WebView?hl=en" rel="nofollow">官方文档</a></p> 
<p><a href="https://github.com/sunnnydaydev/WebView">练习</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8870883916a17bd659f79da9ea205e73/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一文弄懂 Python os.walk()，轻松搞定文件处理和目录遍历</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bec5fc07964c010bdc713ff40a123695/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python 设计模式(第2版) -- 第一部分（创建型模式）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>