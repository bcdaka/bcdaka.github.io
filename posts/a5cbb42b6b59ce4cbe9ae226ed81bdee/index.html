<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>六种常用滤波算法代码实现及效果 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a5cbb42b6b59ce4cbe9ae226ed81bdee/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="六种常用滤波算法代码实现及效果">
  <meta property="og:description" content="总结一下比较常用的一些数据滤波算法，一阶算法可以算是比较基础，通过基本的原理可以引出其他多阶算法或者组合算法
六种常用滤波算法 mcu平台c code 1. 中值滤波2. 滑动均值滤波3. rc-低通滤波4. rc-高通滤波5. rc-带通滤波6. 卡尔曼滤波 1. 中值滤波 中值滤波顾名思义就是将连续的数据取其大小的中值代替，通常用在信号平滑且存在噪声突刺情况可以有效过滤异常数据，缺点是当信号噪声过密时滤波效果不明显，排序算法需要优化以减小ram与计算时间。
//头文件 #define MID_AVG_FILTER_SIZE (7U) //定义滤波窗口大小通常位奇数 typedef struct { float dataBuf[MID_AVG_FILTER_SIZE]; //采样数据区 u16 index; //实现循环队列的队尾下标 } mid_avg_filter_t; float Mid_avg_filter(mid_avg_filter_t* const filter, const float data); //源文件 /******************************************************************************* * @fn Mid_avg_filter * @brief 实现中值滤波 * @param filter 滤波器 * @param data 最新数据 * @return 滤波后的结果 ******************************************************************************/ float Mid_avg_filter(mid_avg_filter_t * const filter, const float data) { float tem; u16 i, j; static mid_avg_filter_t f_tmp; //临时副本，用于排序 //采用循环队列形式将最新数据入队 filter-&gt;dataBuf[filter-&gt;index] = data; filter-&gt;index = (filter-&gt;index &#43; 1) % MID_AVG_SIZE; //采用冒泡法将滤波器内数据升序排序 f_tmp=*filter; for (i = 0; i &lt; MID_AVG_SIZE - 1; i &#43;&#43;) //MID_AVG_FILTER_SIZE-1不用与自己比较 { u16 count = 0; for (j = 0; j &lt; MID_AVG_SIZE - 1 - i; j&#43;&#43;) { if (f_tmp.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-03-09T23:04:30+08:00">
    <meta property="article:modified_time" content="2023-03-09T23:04:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">六种常用滤波算法代码实现及效果</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>总结一下比较常用的一些数据滤波算法，一阶算法可以算是比较基础，通过基本的原理可以引出其他多阶算法或者组合算法</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>六种常用滤波算法 mcu平台c code</h4> 
 <ul><li><a href="#1__4" rel="nofollow">1. 中值滤波</a></li><li><a href="#2__84" rel="nofollow">2. 滑动均值滤波</a></li><li><a href="#3_rc_149" rel="nofollow">3. rc-低通滤波</a></li><li><a href="#4_rc_231" rel="nofollow">4. rc-高通滤波</a></li><li><a href="#5_rc_323" rel="nofollow">5. rc-带通滤波</a></li><li><a href="#6__341" rel="nofollow">6. 卡尔曼滤波</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__4"></a>1. 中值滤波</h2> 
<blockquote> 
 <p>中值滤波顾名思义就是将连续的数据取其大小的中值代替，通常用在信号平滑且存在噪声突刺情况可以有效过滤异常数据，缺点是当信号噪声过密时滤波效果不明显，排序算法需要优化以减小ram与计算时间。</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//头文件</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MID_AVG_FILTER_SIZE</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">7U</span><span class="token punctuation">)</span>  </span><span class="token comment">//定义滤波窗口大小通常位奇数</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> dataBuf<span class="token punctuation">[</span>MID_AVG_FILTER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//采样数据区</span>
    u16 index<span class="token punctuation">;</span>  <span class="token comment">//实现循环队列的队尾下标</span>
<span class="token punctuation">}</span> mid_avg_filter_t<span class="token punctuation">;</span>

<span class="token keyword">float</span> <span class="token function">Mid_avg_filter</span><span class="token punctuation">(</span>mid_avg_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//源文件</span>

<span class="token comment">/*******************************************************************************
 * @fn Mid_avg_filter
 * @brief 实现中值滤波
 * @param filter 滤波器
 * @param data 最新数据
 * @return 滤波后的结果
 ******************************************************************************/</span>
<span class="token keyword">float</span> <span class="token function">Mid_avg_filter</span><span class="token punctuation">(</span>mid_avg_filter_t <span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> tem<span class="token punctuation">;</span>
    u16 i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>
    <span class="token keyword">static</span> mid_avg_filter_t f_tmp<span class="token punctuation">;</span>  <span class="token comment">//临时副本，用于排序</span>
    <span class="token comment">//采用循环队列形式将最新数据入队</span>
    filter<span class="token operator">-&gt;</span>dataBuf<span class="token punctuation">[</span>filter<span class="token operator">-&gt;</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
    filter<span class="token operator">-&gt;</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> MID_AVG_SIZE<span class="token punctuation">;</span>

    <span class="token comment">//采用冒泡法将滤波器内数据升序排序</span>
    f_tmp<span class="token operator">=</span><span class="token operator">*</span>filter<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MID_AVG_SIZE <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//MID_AVG_FILTER_SIZE-1不用与自己比较</span>
    <span class="token punctuation">{<!-- --></span>
        u16 count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> MID_AVG_SIZE <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                tem <span class="token operator">=</span> f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tem<span class="token punctuation">;</span>
                count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>			<span class="token comment">//如果某一趟没有交换位置，则说明已经排好序，直接退出循环</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//取中值</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>MID_AVG_SIZE<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//判断奇偶</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span>MID_AVG_SIZE<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">+</span>f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span><span class="token punctuation">(</span>MID_AVG_SIZE<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f_tmp<span class="token punctuation">.</span>dataBuf<span class="token punctuation">[</span><span class="token punctuation">(</span>MID_AVG_SIZE<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//使用</span>
mid_avg_filter_t filter<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> dataSrc<span class="token punctuation">;</span>  <span class="token comment">//  采样数据</span>
<span class="token keyword">float</span> dataDest<span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token comment">//dataSrc=...//更新采样数据</span>
dataDest<span class="token operator">=</span><span class="token function">Mid_avg_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mid_filter<span class="token punctuation">,</span>dataSrc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取滤波数据</span>
</code></pre> 
<blockquote> 
 <p>结果（红色为采样数据，蓝色为滤波数据）<br> <img src="https://images2.imgbox.com/c0/49/55Sd4xP4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b1/16/lEgZK22s_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="2__84"></a>2. 滑动均值滤波</h2> 
<blockquote> 
 <p>滑动均值滤波原理是在一组连续的采样数据中，按照某个数据块大小，连续对该块大小的数据取均值，看起来就像一个窗口划过这组数据。<br> 优点；对于数据处理权重一致，能够将平均分布的噪声点处理综合掉。能够通过控制滑动窗口的大小控制平滑度。<br> 缺点：窗口较大容易造成较大滞后性，且脉冲干扰抑制不明显。</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//头文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SLID_WINDOW_SIZE</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">4U</span><span class="token punctuation">)</span> </span><span class="token comment">//滑动窗口大小</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> dataBuf<span class="token punctuation">[</span>SLID_WINDOW_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//采样数据区</span>
    u16 index<span class="token punctuation">;</span>  <span class="token comment">//实现循环队列的队尾下标</span>
    u16 size<span class="token punctuation">;</span>   <span class="token comment">//当前窗口内元素个数</span>
<span class="token punctuation">}</span> slid_avg_filter_t<span class="token punctuation">;</span>

<span class="token keyword">float</span> <span class="token function">Slid_avg_filter</span><span class="token punctuation">(</span>slid_avg_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//源文件</span>
<span class="token comment">/*******************************************************************************
 * @fn Slid_avg_filter
 * @brief 实现滑动滤波
 * @param filter 滤波器
 * @param data 最新数据
 * @return 滤波后的结果
 ******************************************************************************/</span>
<span class="token keyword">float</span> <span class="token function">Slid_avg_filter</span><span class="token punctuation">(</span>slid_avg_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">double</span> tem<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">//采用循环队列形式将最新数据入队</span>
  filter<span class="token operator">-&gt;</span>dataBuf<span class="token punctuation">[</span>filter<span class="token operator">-&gt;</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>index <span class="token operator">=</span> <span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> SLID_WINDOW_SIZE<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>size<span class="token operator">&lt;</span>SLID_WINDOW_SIZE<span class="token punctuation">)</span>filter<span class="token operator">-&gt;</span>size<span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">//取平均</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>u16 i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>filter<span class="token operator">-&gt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    tem<span class="token operator">+=</span>filter<span class="token operator">-&gt;</span>dataBuf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  tem<span class="token operator">/=</span>filter<span class="token operator">-&gt;</span>size<span class="token punctuation">;</span>
  <span class="token keyword">return</span> tem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//使用</span>
slid_avg_filter_t slid_filter<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> dataSrc<span class="token punctuation">;</span>  <span class="token comment">//  采样数据</span>
<span class="token keyword">float</span> dataDest<span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token comment">//dataSrc=...//更新采样数据</span>
dataDest<span class="token operator">=</span><span class="token function">Slid_avg_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slid_filter<span class="token punctuation">,</span>idataSrc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取滤波数据</span>
</code></pre> 
<blockquote> 
 <p>结果（红色为采样数据，蓝色为滤波数据）<br> <img src="https://images2.imgbox.com/93/59/eTJrwo6b_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2f/6f/QbCjh0Q1_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="3_rc_149"></a>3. rc-低通滤波</h2> 
<blockquote> 
 <p>一阶低通滤波器（Low Pass Filter，LPF），核心参数为截止频率fc，该算法可以保留截止频率以内的信号，而衰减截止频率之外的信号。主要用于去除高频噪声。<br> 一阶低通滤波公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            y 
           
          
            n 
           
          
         
           = 
          
         
           a 
          
          
          
            x 
           
          
            n 
           
          
         
           + 
          
         
           ( 
          
         
           1 
          
         
           − 
          
         
           a 
          
         
           ) 
          
          
          
            y 
           
           
           
             n 
            
           
             − 
            
           
             1 
            
           
          
          
         
           等价于 
          
         
           : 
          
          
          
          
            y 
           
          
            n 
           
          
         
           = 
          
          
          
            y 
           
           
           
             n 
            
           
             − 
            
           
             1 
            
           
          
         
           + 
          
         
           a 
          
         
           ( 
          
          
          
            x 
           
          
            n 
           
          
         
           − 
          
          
          
            y 
           
           
           
             n 
            
           
             − 
            
           
             1 
            
           
          
         
           ) 
          
          
         
           其中 
          
         
           : 
          
          
         
           a 
          
         
           = 
          
          
           
           
             T 
            
           
             s 
            
           
           
            
            
              T 
             
            
              s 
             
            
           
             + 
            
           
             R 
            
           
             C 
            
           
          
         
           = 
          
          
           
           
             T 
            
           
             s 
            
           
           
            
            
              T 
             
            
              S 
             
            
           
             + 
            
            
            
              1 
             
             
             
               2 
              
             
               π 
              
              
              
                f 
               
              
                c 
               
              
             
            
           
          
         
           = 
          
          
           
           
             2 
            
           
             π 
            
            
            
              f 
             
            
              c 
             
            
            
            
              T 
             
            
              s 
             
            
           
           
           
             2 
            
           
             π 
            
            
            
              f 
             
            
              c 
             
            
            
            
              T 
             
            
              s 
             
            
           
             + 
            
           
             1 
            
           
          
         
        
          y_n=ax_n+(1-a)y_{n-1} \\等价于:\\ y_n=y_{n-1}+a(x_n-y_{n-1}) \\其中: \\ a= \frac {T_s} {<!-- -->{T_s+RC}}= {\frac {T_s}{T_S+\frac{1}{2 \pi f_c}}}=\frac{2\pi f_cT_s}{2\pi f_cT_s+1} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7333em; vertical-align: -0.15em;"></span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">等价于</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7917em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">其中</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1963em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0715em;">RC</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.5765em; vertical-align: -1.2162em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.2649em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0576em;">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">π</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1645em;"><span class="" style="top: -2.357em; margin-left: -0.1076em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2162em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2519em; vertical-align: -0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.0359em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.0359em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 参数说明：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
         
           n 
          
         
        
       
         y_n 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为本次滤波输出值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
          
          
            n 
           
          
            − 
           
          
            1 
           
          
         
        
       
         y_{n-1} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为上次滤波输出值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           n 
          
         
        
       
         x_n 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为本次采样值。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           T 
          
         
           s 
          
         
        
       
         T_s 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为采样周期（s），<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           f 
          
         
           c 
          
         
        
       
         f_c 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为截止频率(hz)。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          a 
         
        
       
         a 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span>范围为[0,1]</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//头文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">M_PI</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M_PI</span> <span class="token expression"><span class="token punctuation">(</span><span class="token number">3.141592f</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> ts<span class="token punctuation">;</span>       <span class="token comment">//采样周期(s)</span>
    <span class="token keyword">float</span> fc<span class="token punctuation">;</span>       <span class="token comment">//截至频率(hz)</span>
    <span class="token keyword">float</span> lastYn<span class="token punctuation">;</span>   <span class="token comment">//上一次滤波值</span>
    <span class="token keyword">float</span> alpha<span class="token punctuation">;</span>    <span class="token comment">//滤波系数</span>
<span class="token punctuation">}</span> low_pass_filter_t<span class="token punctuation">;</span>
<span class="token comment">//初始化滤波系数</span>
<span class="token keyword">void</span> <span class="token function">Init_lowPass_alpha</span><span class="token punctuation">(</span>low_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> ts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//低通滤波</span>
<span class="token keyword">float</span> <span class="token function">Low_pass_filter</span><span class="token punctuation">(</span>low_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//源文件</span>
<span class="token comment">/*******************************************************************************
 * @fn Init_lowPass_alpha
 * @brief 初始化低通滤波器滤波系数
 * @param filter 滤波器
 * @param ts 采用周期 单位s
 * @return fc 截至频率 单位hz
 ******************************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">Init_lowPass_alpha</span><span class="token punctuation">(</span>low_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> ts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> fc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">float</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>M_PI<span class="token operator">*</span>fc<span class="token operator">*</span>ts<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>ts<span class="token operator">=</span>ts<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>fc<span class="token operator">=</span>fc<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastYn<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>alpha<span class="token operator">=</span>b<span class="token operator">/</span><span class="token punctuation">(</span>b<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*******************************************************************************
 * @fn Low_pass_filter
 * @brief 低通滤波函数
 * @param data 采样数据
 * @return 滤波结果
 ******************************************************************************/</span>
<span class="token keyword">float</span> <span class="token function">Low_pass_filter</span><span class="token punctuation">(</span>low_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">float</span> tem<span class="token operator">=</span>filter<span class="token operator">-&gt;</span>lastYn<span class="token operator">+</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>alpha<span class="token operator">*</span><span class="token punctuation">(</span>data<span class="token operator">-</span>filter<span class="token operator">-&gt;</span>lastYn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastYn<span class="token operator">=</span>tem<span class="token punctuation">;</span>
  <span class="token keyword">return</span> tem<span class="token punctuation">;</span>
  
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//使用</span>
low_pass_filter_t low_pass_filter<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//定义滤波器</span>
<span class="token comment">//初始化滤波器 采样周期0.005s 截至频率5hz</span>
<span class="token function">Init_lowPass_alpha</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>low_pass_filter<span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">float</span> dataSrc<span class="token punctuation">;</span>  <span class="token comment">//  采样数据</span>
<span class="token keyword">float</span> dataDest<span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token comment">//dataSrc=...//更新采样数据</span>
dataDest<span class="token operator">=</span><span class="token function">Low_pass_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>low_pass_filter<span class="token punctuation">,</span>dataSrc<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取滤波数据</span>
</code></pre> 
<blockquote> 
 <p>结果（红色为采样数据，蓝色为滤波数据）<br> <img src="https://images2.imgbox.com/ee/fb/cj9m5LdF_o.png" alt="在这里插入图片描述"><br> FFT分析如下，可以看到频率高于5hz 的数据被明显削弱<br> <img src="https://images2.imgbox.com/06/1a/IOspFGby_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="4_rc_231"></a>4. rc-高通滤波</h2> 
<blockquote> 
 <p>高通滤波器可以滤除频率低于截止频率的信号，常用于处理存在累计漂移的数据中，例如陀螺仪角速度计<br> 一阶高通滤波公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            y 
           
          
            n 
           
          
         
           = 
          
         
           a 
          
         
           ⋅ 
          
          
          
            y 
           
           
           
             n 
            
           
             − 
            
           
             1 
            
           
          
         
           + 
          
         
           a 
          
         
           ( 
          
          
          
            x 
           
          
            n 
           
          
         
           − 
          
          
          
            x 
           
           
           
             n 
            
           
             − 
            
           
             1 
            
           
          
         
           ) 
          
          
         
           其中 
          
         
           : 
          
          
         
           a 
          
         
           = 
          
          
           
           
             R 
            
           
             C 
            
           
           
           
             R 
            
           
             C 
            
           
             + 
            
            
            
              T 
             
            
              s 
             
            
           
          
         
           = 
          
          
           
           
             1 
            
            
            
              2 
             
            
              π 
             
             
             
               f 
              
             
               c 
              
             
            
           
           
            
            
              1 
             
             
             
               2 
              
             
               π 
              
              
              
                f 
               
              
                c 
               
              
             
            
           
             + 
            
            
            
              T 
             
            
              s 
             
            
           
          
         
           = 
          
          
          
            1 
           
           
           
             1 
            
           
             + 
            
           
             2 
            
           
             π 
            
            
            
              f 
             
            
              c 
             
            
            
            
              T 
             
            
              s 
             
            
           
          
         
        
          y_n=a \cdot y_{n-1}+a(x_n-x_{n-1} ) \\其中: \\ a= \frac {RC} {<!-- -->{RC+T_s}}= {\frac{\frac{1}{2 \pi f_c}} {\frac{1}{2 \pi f_c}+T_s}}=\frac{1}{1+2\pi f_cT_s} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.4445em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.7917em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">其中</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">:</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1963em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0715em;">RC</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0715em;">RC</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.9324em; vertical-align: -1.2162em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.7162em;"><span class="" style="top: -2.2649em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">π</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1645em;"><span class="" style="top: -2.357em; margin-left: -0.1076em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.8711em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right: 0.0359em;">π</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1645em;"><span class="" style="top: -2.357em; margin-left: -0.1076em; margin-right: 0.0714em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.4811em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2162em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2019em; vertical-align: -0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.0359em;">π</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.8804em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 参数说明：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
         
           n 
          
         
        
       
         y_n 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为本次滤波输出值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
          
          
            n 
           
          
            − 
           
          
            1 
           
          
         
        
       
         y_{n-1} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为上次滤波输出值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           n 
          
         
        
       
         x_n 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为本次采样值,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
          
          
            n 
           
          
            − 
           
          
            1 
           
          
         
        
       
         x_{n-1} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6389em; vertical-align: -0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2083em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为上次采样值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           T 
          
         
           s 
          
         
        
       
         T_s 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为采样周期(s)，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           f 
          
         
           c 
          
         
        
       
         f_c 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为下限频率（hz）。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          a 
         
        
       
         a 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span>范围为[0,1]</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//头文件</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> ts<span class="token punctuation">;</span>       <span class="token comment">//采样周期(s)</span>
    <span class="token keyword">float</span> fc<span class="token punctuation">;</span>       <span class="token comment">//下限频率(hz)</span>
    <span class="token keyword">float</span> lastYn<span class="token punctuation">;</span>   <span class="token comment">//上一次滤波值</span>
    <span class="token keyword">float</span> lastXn<span class="token punctuation">;</span>   <span class="token comment">//上一次采样值</span>
    <span class="token keyword">float</span> alpha<span class="token punctuation">;</span>    <span class="token comment">//滤波系数</span>
<span class="token punctuation">}</span> hight_pass_filter_t<span class="token punctuation">;</span>
<span class="token comment">//初始化滤波系数</span>
<span class="token keyword">void</span> <span class="token function">Init_hightPass_alpha</span><span class="token punctuation">(</span>hight_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> ts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> fc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//低通滤波</span>
<span class="token keyword">float</span> <span class="token function">Hight_pass_filter</span><span class="token punctuation">(</span>hight_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//源文件</span>

<span class="token comment">/*******************************************************************************
 * @fn Init_hightPass_alpha
 * @brief 初始高通滤波器滤波系数
 * @param filter 滤波器
 * @param ts 采用周期 单位s
 * @return fc 截至频率 单位hz
 ******************************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">Init_hightPass_alpha</span><span class="token punctuation">(</span>hight_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> ts<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> fc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">float</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token operator">*</span>M_PI<span class="token operator">*</span>fc<span class="token operator">*</span>ts<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>ts<span class="token operator">=</span>ts<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>fc<span class="token operator">=</span>fc<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastYn<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastXn<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>alpha<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*******************************************************************************
 * @fn Hight_pass_filter
 * @brief 高通滤波函数
 * @param data 采样数据
 * @return 滤波结果
 ******************************************************************************/</span>
<span class="token keyword">float</span> <span class="token function">Hight_pass_filter</span><span class="token punctuation">(</span>hight_pass_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> filter<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">float</span> tem<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>alpha<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>lastYn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>alpha<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>data<span class="token operator">-</span><span class="token punctuation">(</span>filter<span class="token operator">-&gt;</span>lastXn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastYn<span class="token operator">=</span>tem<span class="token punctuation">;</span>
  filter<span class="token operator">-&gt;</span>lastXn<span class="token operator">=</span>data<span class="token punctuation">;</span>
  <span class="token keyword">return</span> tem<span class="token punctuation">;</span>
  
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//使用</span>
hight_pass_filter_t hight_pass_filter<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">//定义滤波器</span>
<span class="token comment">//初始化滤波器 采样周期0.005s 下限频率20hz</span>
<span class="token function">Init_hightPass_alpha</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hight_pass_filter<span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">float</span> dataSrc<span class="token punctuation">;</span>  <span class="token comment">//  采样数据</span>
<span class="token keyword">float</span> dataDest<span class="token punctuation">;</span> <span class="token comment">//滤波数据</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//这里生成一个合成的正弦波</span>
<span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//相移0，幅度3，频率0.5hz</span>
<span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint2<span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token operator">*</span>M_PI<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相移0.5PI，幅度1，频率1hz</span>
<span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint3<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//相移0，幅度1，频率20hz</span>
<span class="token comment">//波形融合</span>
dataSrc<span class="token operator">=</span><span class="token function">Sin_cal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint1<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">Sin_cal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint2<span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">Sin_cal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//dataSrc=...//更新采样数据</span>
dataDest<span class="token operator">=</span><span class="token function">Hight_pass_filter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hight_pass_filter<span class="token punctuation">,</span>dataSrc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取滤波数据</span>
</code></pre> 
<blockquote> 
 <p>结果（红色为采样数据，蓝色为滤波数据）<br> <img src="https://images2.imgbox.com/48/70/elxODG7Q_o.png" alt="在这里插入图片描述"><br> FFT分析如下，可以看到低频数据大部分被过滤掉<br> <img src="https://images2.imgbox.com/3f/c4/57VRB7Zp_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="5_rc_323"></a>5. rc-带通滤波</h2> 
<blockquote> 
 <p>由电路原理可以知道 带通滤波器可以由低通滤波和高通滤波器组成，将两部分串级可以形成带通滤波器。<br> 如图生成三个正弦波</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint1<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">0.5f</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//相移0，幅度0.5，频率0.5hz</span>
<span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint2<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">//相移0，幅度1，频率5hz</span>
<span class="token function">Sin_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sint3<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">0.005f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//相移0，幅度0.5，频率50hz</span>
</code></pre> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/7a/10/JUalK562_o.png" alt="在这里插入图片描述"><br> 上图（红色：频率0.5hz 幅值0.5）（蓝色：频率5hz 幅值1）（黄色：频率50hz 幅值0.5）<br> 合成波形如下<br> <img src="https://images2.imgbox.com/ec/aa/kMg6g81U_o.png" alt="在这里插入图片描述"><br> 经过带通滤波频率在4hz-6hz 范围，结果为黑色波形<br> <img src="https://images2.imgbox.com/a8/d6/78SzV3bj_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="6__341"></a>6. 卡尔曼滤波</h2> 
<blockquote> 
 <p>当信号源中符合线性系统（齐次性和叠加性）并且噪声分布符合高斯分布时，可以使用卡尔曼对其滤波，具有较好效果。<br> 卡尔曼本质是预测观测器，通过估计值与观测值得出最优值。关于观测卡尔曼滤波总结为5条公式,关于卡尔曼网上教程比较多，这里不做其他解释。<br> R和Q称为超调参数，两者会影响卡尔曼增益K，Q代表预测过程噪声，越小越好，R是测量噪声，当系统的观测噪声比较明显或者数据波动较大时，可以适当增加R的值（增大增益K）。当数据比较准确时，我们应该将R取小一点（减小增益K），Q取大一点。<br> <img src="https://images2.imgbox.com/8d/fd/H8TWZ77H_o.png" alt="这里是引用"></p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token comment">//头文件</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> X_last<span class="token punctuation">;</span> <span class="token comment">//上一时刻的最优结果</span>
    <span class="token keyword">float</span> X_mid<span class="token punctuation">;</span>  <span class="token comment">//当前时刻的预测结果</span>
    <span class="token keyword">float</span> X_now<span class="token punctuation">;</span>  <span class="token comment">//当前时刻的最优结果</span>
    <span class="token keyword">float</span> P_mid<span class="token punctuation">;</span>  <span class="token comment">//当前时刻预测结果的协方差</span>
    <span class="token keyword">float</span> P_now<span class="token punctuation">;</span>  <span class="token comment">//当前时刻最优结果的协方差</span>
    <span class="token keyword">float</span> P_last<span class="token punctuation">;</span> <span class="token comment">//上一时刻最优结果的协方差</span>
    <span class="token keyword">float</span> kg<span class="token punctuation">;</span>     <span class="token comment">//kalman增益</span>
    <span class="token keyword">float</span> A<span class="token punctuation">;</span>      <span class="token comment">//系统参数</span>
    <span class="token keyword">float</span> Q<span class="token punctuation">;</span>
    <span class="token keyword">float</span> R<span class="token punctuation">;</span>
    <span class="token keyword">float</span> H<span class="token punctuation">;</span>
<span class="token punctuation">}</span>kalman_filter_t<span class="token punctuation">;</span>
<span class="token comment">///@codeEnd</span>
<span class="token comment">//初始化卡尔曼滤波器</span>
<span class="token keyword">void</span> <span class="token function">Init_KalmanInfo</span><span class="token punctuation">(</span>kalman_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> info<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> Q<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> R<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//卡尔曼过滤函数</span>
<span class="token keyword">float</span>  <span class="token function">KalmanFilter</span><span class="token punctuation">(</span>kalman_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> kalmanInfo<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> lastMeasurement<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//源文件</span>
<span class="token comment">/************************************************
* @brief Init_KalmanInfo   初始化滤波器的初始值
* @param p  滤波器指针
* @param Q 预测噪声方差 由系统外部测定给定
* @param R 测量噪声方差 由系统外部测定给定
**************************************************/</span>
<span class="token keyword">void</span> <span class="token function">Init_KalmanInfo</span><span class="token punctuation">(</span>kalman_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> Q<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">float</span> R<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//kalman* p = ( kalman*)malloc(sizeof( kalman));</span>
    p<span class="token operator">-&gt;</span>X_last <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>P_last <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">//后验状态估计值误差的方差的初始值（不要为0问题不大）</span>
    p<span class="token operator">-&gt;</span>Q <span class="token operator">=</span> Q<span class="token punctuation">;</span>       <span class="token comment">//预测（过程）噪声方差 影响收敛速率，可以根据实际需求给出</span>
    p<span class="token operator">-&gt;</span>R <span class="token operator">=</span> R<span class="token punctuation">;</span>       <span class="token comment">//测量（观测）噪声方差 可以通过实验手段获得</span>
    p<span class="token operator">-&gt;</span>A <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">//标量卡尔曼</span>
    p<span class="token operator">-&gt;</span>H <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    p<span class="token operator">-&gt;</span>X_mid <span class="token operator">=</span> p<span class="token operator">-&gt;</span>X_last<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/************************************************
* @brief KalmanFilter   卡尔曼过滤函数
* @param p  滤波器指针
* @param lastMeasurement 当前最近值
* @return 过滤后的值
**************************************************/</span>
<span class="token keyword">float</span>  <span class="token function">KalmanFilter</span><span class="token punctuation">(</span>kalman_filter_t<span class="token operator">*</span> <span class="token keyword">const</span> p<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">float</span> lastMeasurement<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	  p<span class="token operator">-&gt;</span>X_mid <span class="token operator">=</span>p<span class="token operator">-&gt;</span>A<span class="token operator">*</span>p<span class="token operator">-&gt;</span>X_last<span class="token punctuation">;</span>                   <span class="token comment">//x(k|k-1) = AX(k-1|k-1)+BU(k)</span>
    p<span class="token operator">-&gt;</span>P_mid <span class="token operator">=</span> p<span class="token operator">-&gt;</span>A<span class="token operator">*</span>p<span class="token operator">-&gt;</span>P_last<span class="token operator">+</span>p<span class="token operator">-&gt;</span>Q<span class="token punctuation">;</span>               <span class="token comment">//p(k|k-1) = Ap(k-1|k-1)A'+Q</span>
    p<span class="token operator">-&gt;</span>kg <span class="token operator">=</span> p<span class="token operator">-&gt;</span>P_mid<span class="token operator">/</span><span class="token punctuation">(</span>p<span class="token operator">-&gt;</span>P_mid<span class="token operator">+</span>p<span class="token operator">-&gt;</span>R<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//kg(k) = p(k|k-1)H'/(Hp(k|k-1)'+R)</span>
    p<span class="token operator">-&gt;</span>X_now <span class="token operator">=</span> p<span class="token operator">-&gt;</span>X_mid<span class="token operator">+</span>p<span class="token operator">-&gt;</span>kg<span class="token operator">*</span><span class="token punctuation">(</span>lastMeasurement<span class="token operator">-</span>p<span class="token operator">-&gt;</span>X_mid<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//x(k|k) = X(k|k-1)+kg(k)(Z(k)-HX(k|k-1))</span>
    p<span class="token operator">-&gt;</span>P_now <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span>p<span class="token operator">-&gt;</span>kg<span class="token punctuation">)</span><span class="token operator">*</span>p<span class="token operator">-&gt;</span>P_mid<span class="token punctuation">;</span>                <span class="token comment">//p(k|k) = (I-kg(k)H)P(k|k-1)</span>
    p<span class="token operator">-&gt;</span>P_last <span class="token operator">=</span> p<span class="token operator">-&gt;</span>P_now<span class="token punctuation">;</span>                         <span class="token comment">//状态更新</span>
    p<span class="token operator">-&gt;</span>X_last <span class="token operator">=</span> p<span class="token operator">-&gt;</span>X_now<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token operator">-&gt;</span>X_now<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<blockquote> 
 <p>滤波效果图下如下，黄色线为原始数据线，红色为添加了高斯噪声的数据线（均值为1，方差为2.25），蓝色为滤波后的数据线，在滤波参数调节较大时，滞后性比较明显。<br> <img src="https://images2.imgbox.com/f5/65/iutnepe2_o.png" alt="这里是引用"><img src="https://images2.imgbox.com/60/45/W7Y98bK4_o.png" alt="在这里插入图片描述"></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff97e09c77cf41e38d31f1316fbaeee9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue运行报错Error: Cannot find module ‘@vue/cli-plugin-babel‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/34862e8f0cba3d6282c6e5c245d08a1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MATLAB——FFT(快速傅里叶变换)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>