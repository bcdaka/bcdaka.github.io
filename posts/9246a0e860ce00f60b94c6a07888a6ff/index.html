<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>rk3588 多线程异步提高RK3588的NPU占用率，yolov5s目标检测-python摄像头实时检测65fps,c&#43;&#43;实时检测120fps - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9246a0e860ce00f60b94c6a07888a6ff/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="rk3588 多线程异步提高RK3588的NPU占用率，yolov5s目标检测-python摄像头实时检测65fps,c&#43;&#43;实时检测120fps">
  <meta property="og:description" content="简单说点记录，python要在rk3588安装虚拟环境，
首先我们要知道rk3588环境配置：
Ubuntu 18.04 python3.6/7
Ubuntu 20.04 python3.8/9
Ubuntu 22.04 python3.10/11 我的板子ubantu22.04 所以装python10，,tensorflow2.8.0要单独先下载，转出1.6.0的模型，转的时候要把代码改成rk3588平台，rk3588板子要升级1.6.0版本哦：
sudo cp /home/orangepi/xushuanglong/rknn-toolkit2-master2/rknpu2/runtime/Linux/librknn_api/aarch64/librknnrt.so /usr/lib/librknnrt.so
sudo cp /home/orangepi/xushuanglong/rknn-toolkit2-master2/rknpu2/runtime/Linux/librknn_api/aarch64/librknn_api.so /usr/lib/librknn_api.so
pc端 linux rknn-toolkit2; rk3588板子 aarch rknn_toolkit_lite2
清华源：-i https://pypi.tuna.tsinghua.edu.cn/simple
yolov5 训练的时候选noautoanchor，改激活函数relu，不然一堆乱框。
####### export.py导出onnx时要改，训练不改
def forward(self, x):
z = [] # inference output
for i in range(self.nl):
x[i] = self.m[i](x[i]) # conv
return x
pc上 rknn-toolkit2，onnx导出rknn,要改：
rknn.config(mean_values=[[0, 0, 0]], std_values=[[255, 255, 255]], target_platform=&#39;rk3588&#39;)
到此，rknn3588模型转换然后到python部署没啥问题了。
c&#43;&#43;的话，代码里把CMakeLists.txt里的位置填对，bash编译就完事了。把什么1.6.0 的opencv库， 及librknnrt.so等，粘过来。
要提高摄像头实时fps的话，要写多线程异步提高RK3588的NPU占用率，还有提高NPU，CPU定频命令
查看npu使用率：sudo cat /sys/kernel/debug/rknpu/load">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-13T18:40:08+08:00">
    <meta property="article:modified_time" content="2024-01-13T18:40:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">rk3588 多线程异步提高RK3588的NPU占用率，yolov5s目标检测-python摄像头实时检测65fps,c&#43;&#43;实时检测120fps</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>简单说点记录，python要在rk3588安装虚拟环境，<br> 首先我们要知道rk3588环境配置：</p> 
<p>Ubuntu 18.04 python3.6/7<br> Ubuntu 20.04 python3.8/9<br> Ubuntu 22.04 python3.10/11  </p> 
<p>我的板子ubantu22.04 所以装python10，,tensorflow2.8.0要单独先下载，转出1.6.0的模型，转的时候要把代码改成rk3588平台，rk3588板子要升级1.6.0版本哦：</p> 
<p>sudo cp /home/orangepi/xushuanglong/rknn-toolkit2-master2/rknpu2/runtime/Linux/librknn_api/aarch64/librknnrt.so /usr/lib/librknnrt.so<br> sudo cp /home/orangepi/xushuanglong/rknn-toolkit2-master2/rknpu2/runtime/Linux/librknn_api/aarch64/librknn_api.so /usr/lib/librknn_api.so</p> 
<p></p> 
<p>pc端  linux  rknn-toolkit2;   rk3588板子  aarch  rknn_toolkit_lite2</p> 
<p>清华源：-i https://pypi.tuna.tsinghua.edu.cn/simple</p> 
<p>yolov5 训练的时候选noautoanchor，改激活函数relu，不然一堆乱框。</p> 
<p style="margin-left:.0001pt;text-align:left;">####### export.py导出onnx时要改，训练不改</p> 
<p style="margin-left:.0001pt;text-align:left;">    def forward(self, x):</p> 
<p style="margin-left:.0001pt;text-align:left;">        z = []  # inference output</p> 
<p style="margin-left:.0001pt;text-align:left;">        for i in range(self.nl):</p> 
<p style="margin-left:.0001pt;text-align:left;">            x[i] = self.m[i](x[i])  # conv</p> 
<p style="margin-left:.0001pt;text-align:left;">        return x</p> 
<p style="margin-left:.0001pt;text-align:left;">pc上 rknn-toolkit2，onnx导出rknn,要改：</p> 
<p style="margin-left:.0001pt;text-align:left;">rknn.config(mean_values=[[0, 0, 0]], std_values=[[255, 255, 255]], target_platform='rk3588')</p> 
<p style="margin-left:.0001pt;text-align:left;">到此，rknn3588模型转换然后到python部署没啥问题了。</p> 
<p style="margin-left:.0001pt;text-align:left;">c++的话，代码里把CMakeLists.txt里的位置填对，bash编译就完事了。把什么1.6.0 的opencv库， 及librknnrt.so等，粘过来。</p> 
<p style="margin-left:.0001pt;text-align:left;">要提高摄像头实时fps的话，要写多线程异步提高RK3588的NPU占用率，还有提高NPU，CPU定频命令<br> 查看npu使用率：sudo cat /sys/kernel/debug/rknpu/load</p> 
<p style="margin-left:.0001pt;text-align:left;">然后就是摄像头，要能支持高频的摄像头才行，比如120fps的摄像头，要把opencv默认的yuyv改为mjep</p> 
<p style="margin-left:.0001pt;text-align:left;">c++:</p> 
<p>    // 设置摄像头捕获格式为 MJPG<br>     capture.set(cv::CAP_PROP_FOURCC, cv::VideoWriter::fourcc('M', 'J', 'P', 'G'));</p> 
<p>    // 设置摄像头分辨率<br>     capture.set(cv::CAP_PROP_FRAME_WIDTH, 640);<br>     capture.set(cv::CAP_PROP_FRAME_HEIGHT, 480);</p> 
<p>    // 设置摄像头帧率<br>     capture.set(cv::CAP_PROP_FPS, 120);<br>  </p> 
<p style="margin-left:.0001pt;text-align:left;">python:</p> 
<pre># 定义摄像头捕获分辨率和帧率
WIDTH, HEIGHT, FPS = 1280, 720, 120

# 初始化摄像头
cap = cv2.VideoCapture(0)
cap.set(cv2.CAP_PROP_FOURCC, cv2.VideoWriter_fourcc(*'MJPG'))
cap.set(cv2.CAP_PROP_FRAME_WIDTH, WIDTH)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, HEIGHT)
cap.set(cv2.CAP_PROP_FPS, FPS)
有问题可联系
最后放结果：
python:</pre> 
<div class="csdn-video-box"> 
 <iframe id="mcHe1C7b-1705141737887" frameborder="0" src="https://live.csdn.net/v/embed/359490" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>python 摄像头实时检测rk3588 65fps</p> 
</div> 
<pre>c++:

</pre> 
<div class="csdn-video-box"> 
 <iframe id="D5s36kNL-1705142400311" frameborder="0" src="https://live.csdn.net/v/embed/359488" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>rk3588,c++摄像头实时检测120fps</p> 
</div> 
<p></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23decc359ad89b833e76291d69261ae2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Stable Diffusion ComfyUI 速度更快，控制更精准</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcc65c80808cca3b554474aafc254338/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python 中的字符串分割函数 split() 详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>