<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【AIGC】基于大模型&#43;知识库的Code Review实践 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/144a58f0e9fb4bae074d2f925cac5183/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【AIGC】基于大模型&#43;知识库的Code Review实践">
  <meta property="og:description" content="目录
一、背景描述
二、技术原理
三、基于大模型与知识库的Code Review实践
1、选择合适的大模型与知识库
2、集成大模型与知识库到Code Review流程
3、结合人工审查
4、持续优化与改进
四、技术细节
1、gitlab配置mr的webhook
获得差异代码
2、请求通义千问获得review结果
前提条件
3、Gitlab调用代码review评论API
1. 获取私有令牌（Private Token）
2. 调用 API
3. 创建评论
4. 注意事项
参考资料
一、背景描述 一句话介绍就是：基于开源大模型 &#43; 知识库的 Code Review 实践，类似一个代码评审助手（CR Copilot）。信息安全合规问题：公司内代码直接调 ChatGPT / Claude 会有安全/合规问题，为了使用 ChatGPT / Claude 需要对代码脱敏，只提供抽象逻辑，这往往更花时间。低质量代码耗费时间：业务每天至少 10~20 个 MR 需要 CR，虽然提交时 MR 经过 单测 &#43; Lint 过滤了一些低级错误，但还有些问题（代码合理性、经验、MR 相关业务逻辑等）需要花费大量时间，最后可以先经过自动化 CR，再进行人工 CR，可大大提升 CR 效率！符合公司安全规范，所有代码数据不出内网，所有推理过程均在内网完成团队 Code Review 规范缺少执行：大部分团队的 Code Review 停留在文档纸面上，成员之间口口相传，并没有一个工具根据规范来严格执行。🌈 开箱即用：基于 Gitlab CI，仅 10 几行配置完成接入，即可对 MR 进行 CR。🔒 数据安全：基于开源大模型做私有化部署，隔离外网访问，确保代码 CR 过程仅在内网环境下完成。♾ 无调用次数限制：部署在内部平台，只有 GPU 租用成本。📚 自定义知识库：CR 助手基于提供的飞书文档进行学习，将匹配部分作为上下文，结合代码变更进行 CR，这将大大提升 CR 的准确度，也更符合团队自身的 CR 规范。🎯 评论到变更行：CR 助手将结果评论到变更代码行上，通过 Gitlab CI 通知，更及时获取 CR 助手给出的评论。 二、技术原理 三、基于大模型与知识库的Code Review实践 基于大模型与知识库的Code Review实践，具体实施细节可以归纳如下：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-10T20:44:19+08:00">
    <meta property="article:modified_time" content="2024-06-10T20:44:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【AIGC】基于大模型&#43;知识库的Code Review实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E8%83%8C%E6%99%AF%E6%8F%8F%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E8%83%8C%E6%99%AF%E6%8F%8F%E8%BF%B0" rel="nofollow">一、背景描述</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86" rel="nofollow">二、技术原理</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E7%9A%84Code%20Review%E5%AE%9E%E8%B7%B5-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E7%9A%84Code%20Review%E5%AE%9E%E8%B7%B5" rel="nofollow">三、基于大模型与知识库的Code Review实践</a></p> 
<p id="%E4%B8%80%E3%80%81%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93" rel="nofollow">1、选择合适的大模型与知识库</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%9B%86%E6%88%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E5%88%B0Code%20Review%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E9%9B%86%E6%88%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E5%88%B0Code%20Review%E6%B5%81%E7%A8%8B" rel="nofollow">2、集成大模型与知识库到Code Review流程</a></p> 
<p id="%E4%B8%89%E3%80%81%E7%BB%93%E5%90%88%E4%BA%BA%E5%B7%A5%E5%AE%A1%E6%9F%A5-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E7%BB%93%E5%90%88%E4%BA%BA%E5%B7%A5%E5%AE%A1%E6%9F%A5" rel="nofollow">3、结合人工审查</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%8C%81%E7%BB%AD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%94%B9%E8%BF%9B-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E6%8C%81%E7%BB%AD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%94%B9%E8%BF%9B" rel="nofollow">4、持续优化与改进</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82" rel="nofollow">四、技术细节</a></p> 
<p id="%E4%B8%80%E3%80%81gitlab%E9%85%8D%E7%BD%AEmr%E7%9A%84webhook-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81gitlab%E9%85%8D%E7%BD%AEmr%E7%9A%84webhook" rel="nofollow">1、gitlab配置mr的webhook</a></p> 
<p id="%E8%8E%B7%E5%BE%97%E5%B7%AE%E5%BC%82%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%E8%8E%B7%E5%BE%97%E5%B7%AE%E5%BC%82%E4%BB%A3%E7%A0%81" rel="nofollow">获得差异代码</a></p> 
<p id="2%E3%80%81%E8%AF%B7%E6%B1%82%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE%E8%8E%B7%E5%BE%97review%E7%BB%93%E6%9E%9C-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E8%AF%B7%E6%B1%82%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE%E8%8E%B7%E5%BE%97review%E7%BB%93%E6%9E%9C" rel="nofollow">2、请求通义千问获得review结果</a></p> 
<p id="o6ecl-toc" style="margin-left:80px;"><a href="#o6ecl" rel="nofollow">前提条件</a></p> 
<p id="%E4%BA%8C%E3%80%81Gitlab%E8%B0%83%E7%94%A8%E4%BB%A3%E7%A0%81review%E8%AF%84%E8%AE%BAAPI-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81Gitlab%E8%B0%83%E7%94%A8%E4%BB%A3%E7%A0%81review%E8%AF%84%E8%AE%BAAPI" rel="nofollow">3、Gitlab调用代码review评论API</a></p> 
<p id="1.%20%E8%8E%B7%E5%8F%96%E7%A7%81%E6%9C%89%E4%BB%A4%E7%89%8C%EF%BC%88Private%20Token%EF%BC%89-toc" style="margin-left:80px;"><a href="#1.%20%E8%8E%B7%E5%8F%96%E7%A7%81%E6%9C%89%E4%BB%A4%E7%89%8C%EF%BC%88Private%20Token%EF%BC%89" rel="nofollow">1. 获取私有令牌（Private Token）</a></p> 
<p id="2.%20%E8%B0%83%E7%94%A8%20API-toc" style="margin-left:80px;"><a href="#2.%20%E8%B0%83%E7%94%A8%20API" rel="nofollow">2. 调用 API</a></p> 
<p id="3.%20%E5%88%9B%E5%BB%BA%E8%AF%84%E8%AE%BA-toc" style="margin-left:80px;"><a href="#3.%20%E5%88%9B%E5%BB%BA%E8%AF%84%E8%AE%BA" rel="nofollow">3. 创建评论</a></p> 
<p id="4.%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-toc" style="margin-left:80px;"><a href="#4.%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow">4. 注意事项</a></p> 
<p id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99-toc" style="margin-left:0px;"><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">参考资料</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E8%83%8C%E6%99%AF%E6%8F%8F%E8%BF%B0">一、背景描述</h2> 
<ul><li>一句话介绍就是：基于开源大模型 + <a href="https://so.csdn.net/so/search?q=%E7%9F%A5%E8%AF%86%E5%BA%93&amp;spm=1001.2101.3001.7020" title="知识库">知识库</a>的 Code Review 实践，类似一个代码评审助手（CR Copilot）。</li><li>信息安全合规问题：公司内代码直接调 ChatGPT / Claude 会有安全/合规问题，为了使用 ChatGPT / Claude 需要对代码脱敏，只提供抽象逻辑，这往往更花时间。</li><li>低质量代码耗费时间：业务每天至少 10~20 个 MR 需要 CR，虽然提交时 MR 经过 单测 + Lint 过滤了一些低级错误，但还有些问题（代码合理性、经验、MR 相关业务逻辑等）需要花费大量时间，最后可以先经过自动化 CR，再进行人工 CR，可大大提升 CR 效率！</li><li>符合公司安全规范，<strong>所有代码数据不出内网</strong>，所有推理过程均在内网完成</li><li>团队 Code Review 规范缺少执行：大部分团队的 Code Review 停留在文档纸面上，成员之间口口相传，并没有一个工具根据规范来严格执行。</li><li>🌈 开箱即用：基于 Gitlab CI，仅 10 几行配置完成接入，即可对 MR 进行 CR。</li><li>🔒 数据安全：基于开源大模型做私有化部署，隔离外网访问，确保代码 CR 过程仅在内网环境下完成。</li><li>♾ 无调用次数限制：部署在内部平台，只有 GPU 租用成本。</li><li>📚 自定义知识库：CR 助手基于提供的飞书文档进行学习，将匹配部分作为上下文，结合代码变更进行 CR，这将大大提升 CR 的准确度，也更符合团队自身的 CR 规范。</li><li>🎯 评论到变更行：CR 助手将结果评论到变更代码行上，通过 Gitlab CI 通知，更及时获取 CR 助手给出的评论。</li></ul> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="1200" src="https://images2.imgbox.com/ec/bf/A6SOn0wM_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/3a/52/3Lp7y2A6_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bd/6e/3IqGLrTM_o.png" width="1200"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86">二、技术原理</h2> 
<p><img alt="" height="968" src="https://images2.imgbox.com/3d/8d/OiDAwTgJ_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7f/8c/IiH9p284_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/4d/9b/th3fBD6e_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E4%B8%89%E3%80%81%E5%9F%BA%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E7%9A%84Code%20Review%E5%AE%9E%E8%B7%B5">三、基于大模型与知识库的Code Review实践</h2> 
<p>基于大模型与知识库的Code Review实践，具体实施细节可以归纳如下：</p> 
<h3 id="%E4%B8%80%E3%80%81%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93">1、选择合适的大模型与知识库</h3> 
<ol><li><strong>大模型选择</strong>： 
  <ul><li>优先选择具有广泛训练数据和强大语言理解能力的模型，如GPT系列（如GPT-3.5或更高版本）。</li><li>考虑模型的领域适应性，选择对编程语言和代码结构有深入理解的模型。</li><li>评估模型的性能，包括处理速度、准确性和可扩展性。</li></ul></li><li><strong>知识库构建</strong>： 
  <ul><li>收集行业标准和最佳实践，确保知识库内容的权威性和准确性。</li><li>整合常见的代码问题和解决方案，构建易于查询和检索的知识库。</li><li>不断更新和维护知识库，确保其内容的时效性和完整性。</li></ul></li></ol> 
<h3 id="%E4%BA%8C%E3%80%81%E9%9B%86%E6%88%90%E5%A4%A7%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%9F%A5%E8%AF%86%E5%BA%93%E5%88%B0Code%20Review%E6%B5%81%E7%A8%8B">2、集成大模型与知识库到Code Review流程</h3> 
<ol><li><strong>自动化工具开发</strong>： 
  <ul><li>利用大模型开发自动化代码分析工具，如静态代码分析器、代码风格检查器等。</li><li>这些工具可以自动检测代码中的潜在问题，如语法错误、逻辑错误、性能问题等。</li><li>工具的输出结果可以作为Code Review的参考依据。</li></ul></li><li><strong>代码注释和文档生成</strong>： 
  <ul><li>利用大模型的文本生成能力，为代码片段自动生成注释和文档。</li><li>这可以提高代码的可读性和可维护性，便于其他团队成员理解和使用代码。</li></ul></li><li><strong>集成知识库</strong>： 
  <ul><li>在Code Review过程中，集成知识库作为参考资源。</li><li>审查者可以通过查询知识库来快速获取相关的行业标准和最佳实践等信息。</li><li>审查者可以利用这些信息来更准确地评估代码的质量和可靠性。</li></ul></li></ol> 
<h3 id="%E4%B8%89%E3%80%81%E7%BB%93%E5%90%88%E4%BA%BA%E5%B7%A5%E5%AE%A1%E6%9F%A5">3、结合人工审查</h3> 
<ol><li><strong>审查者角色</strong>： 
  <ul><li>审查者需要具备一定的编程能力、自然语言处理能力和领域知识。</li><li>审查者需要关注模型的输出结果，判断其是否准确可靠，并根据实际情况做出调整。</li><li>审查者还需要关注代码的逻辑、业务逻辑等方面的问题，确保代码的正确性和可靠性。</li></ul></li><li><strong>审查流程</strong>： 
  <ul><li>审查者首先使用自动化工具对代码进行初步分析。</li><li>然后，审查者可以结合知识库中的信息对代码进行深入审查。</li><li>审查者需要记录审查过程中的问题和建议，并与开发人员进行沟通和讨论。</li></ul></li></ol> 
<h3 id="%E5%9B%9B%E3%80%81%E6%8C%81%E7%BB%AD%E4%BC%98%E5%8C%96%E4%B8%8E%E6%94%B9%E8%BF%9B">4、持续优化与改进</h3> 
<ol><li><strong>数据收集与反馈</strong>： 
  <ul><li>收集Code Review过程中的数据和反馈，包括审查结果、审查者建议等。</li><li>分析这些数据，了解Code Review的效果和存在的问题。</li></ul></li><li><strong>模型优化</strong>： 
  <ul><li>根据收集的数据和反馈，对大模型进行优化和改进。</li><li>例如，可以更新模型的训练数据、调整模型的参数设置等，以提高模型的性能和准确性。</li></ul></li><li><strong>知识库更新</strong>： 
  <ul><li>定期更新和维护知识库，确保其内容的时效性和完整性。</li><li>整合新的行业标准和最佳实践到知识库中，为审查者提供更全面的参考资源。</li></ul></li></ol> 
<p>通过以上具体实施细节，可以确保基于大模型与知识库的Code Review实践能够高效、准确地评估代码的质量和可靠性，提高开发效率。</p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%8A%80%E6%9C%AF%E7%BB%86%E8%8A%82">四、技术细节</h2> 
<h3 id="%E4%B8%80%E3%80%81gitlab%E9%85%8D%E7%BD%AEmr%E7%9A%84webhook">1、gitlab配置mr的webhook</h3> 
<p>在 GitLab 中，当你想要配置 Merge Request (MR) 的 webhook（也称为“Web 钩子”或“HTTP 钩子”）时，你实际上是在设置当某个事件（如新的 MR 被创建、MR 被更新、MR 被合并等）发生时，GitLab 会向指定的 URL 发送 HTTP 请求。</p> 
<p>以下是如何在 GitLab 中配置 Merge Request 相关的 webhook 的步骤：</p> 
<ol><li><strong>登录 GitLab</strong> 并导航到你想要配置 webhook 的项目。</li><li>在项目的侧边栏中，选择 <strong>Settings</strong>（设置）。</li><li>在左侧菜单中，选择 <strong>Integrations</strong>（集成）或 <strong>Webhooks</strong>（具体取决于 GitLab 的版本和配置）。</li><li>在 Webhooks 页面上，你会看到一个用于添加新 webhook 的表单。</li><li><strong>URL</strong>：输入你想要接收 webhook 请求的 URL。这通常是一个 API 端点或 webhook 处理器的地址。</li><li><strong>Secret Token</strong>（可选）：这是一个可选的令牌，用于在发送 webhook 请求时验证请求的源。如果你在此处设置了令牌，则你的 webhook 处理器也必须包含该令牌以验证请求。</li><li><strong>Trigger</strong>（触发器）：在下拉列表中选择你想要触发 webhook 的事件。对于 Merge Request，你可能会选择 <strong>Merge Request events</strong> 或其他相关选项。确保选中了与 Merge Request 相关的事件，如 <code>Opened</code>（打开）、<code>Updated</code>（更新）、<code>Merged</code>（合并）等。</li><li><strong>Add Webhook</strong>（添加 webhook）：完成上述设置后，点击此按钮以保存 webhook 配置。</li></ol> 
<p><img alt="" height="963" src="https://images2.imgbox.com/ba/e1/r49D0TdJ_o.png" width="1200"></p> 
<p><img alt="" height="1035" src="https://images2.imgbox.com/a5/c4/tNKA0TBT_o.png" width="1200"></p> 
<p>默认本地访问会报错，需要按照如下方式开启本地访问权限</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7e/1e/wU7ZwpUK_o.png" width="1200"></p> 
<p><img alt="" height="303" src="https://images2.imgbox.com/db/ff/XHN3cR04_o.png" width="830"></p> 
<p>现在，当指定的 Merge Request 事件发生时，GitLab 会向你的 webhook URL 发送一个 HTTP 请求。这个请求将包含与事件相关的数据，你可以在你的 webhook 处理器中解析这些数据并执行相应的操作。</p> 
<p>gitlab的webhook原理</p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/20/e3/0VIXnhI1_o.png" width="721"></p> 
<p>项目代码变动往gitlab上推送相应的事件，例如代码push，新建tag，创建merge request等等；<br> gitlab收到相应事件，触发对应的webhook，设置HTTP请求的header以及request body，然后发送HTTP请求到配置的webhook的URL；<br> HTTP请求到达对应的处理服务器以后，对request body和header进行解析，包装通知内容；</p> 
<p><strong>注意</strong>：确保你的 webhook 处理器能够处理来自 GitLab 的请求，并且你的 GitLab 实例和 webhook 处理器之间的网络连接是安全的。如果你在生产环境中使用 webhook，请考虑使用 HTTPS 和身份验证来确保请求的安全性。</p> 
<p>创建MR请求</p> 
<p>获得回调结果</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ba/8a/8lFxEDsU_o.png" width="1200"></p> 
<pre><code class="language-bash">{
	"object_kind": "merge_request",
	"event_type": "merge_request",
	"user": {
		"id": 1,
		"name": "Administrator",
		"username": "root",
		"avatar_url": "https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80\u0026d=identicon",
		"email": "[REDACTED]"
	},
	"project": {
		"id": 2,
		"name": "ruoyi",
		"description": "ruoyi",
		"web_url": "http://localhost:8200/root/ruoyi",
		"avatar_url": null,
		"git_ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
		"git_http_url": "http://localhost:8200/root/ruoyi.git",
		"namespace": "Administrator",
		"visibility_level": 20,
		"path_with_namespace": "root/ruoyi",
		"default_branch": "main",
		"ci_config_path": null,
		"homepage": "http://localhost:8200/root/ruoyi",
		"url": "ssh://git@localhost:8200/root/ruoyi.git",
		"ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
		"http_url": "http://localhost:8200/root/ruoyi.git"
	},
	"object_attributes": {
		"assignee_id": 1,
		"author_id": 1,
		"created_at": "2024-06-10 01:26:41 UTC",
		"description": "Uat",
		"head_pipeline_id": null,
		"id": 2,
		"iid": 2,
		"last_edited_at": null,
		"last_edited_by_id": null,
		"merge_commit_sha": null,
		"merge_error": null,
		"merge_params": {
			"force_remove_source_branch": "1"
		},
		"merge_status": "preparing",
		"merge_user_id": null,
		"merge_when_pipeline_succeeds": false,
		"milestone_id": null,
		"source_branch": "uat",
		"source_project_id": 2,
		"state_id": 1,
		"target_branch": "main",
		"target_project_id": 2,
		"time_estimate": 0,
		"title": "Uat",
		"updated_at": "2024-06-10 01:26:41 UTC",
		"updated_by_id": null,
		"url": "http://localhost:8200/root/ruoyi/-/merge_requests/2",
		"source": {
			"id": 2,
			"name": "ruoyi",
			"description": "ruoyi",
			"web_url": "http://localhost:8200/root/ruoyi",
			"avatar_url": null,
			"git_ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
			"git_http_url": "http://localhost:8200/root/ruoyi.git",
			"namespace": "Administrator",
			"visibility_level": 20,
			"path_with_namespace": "root/ruoyi",
			"default_branch": "main",
			"ci_config_path": null,
			"homepage": "http://localhost:8200/root/ruoyi",
			"url": "ssh://git@localhost:8200/root/ruoyi.git",
			"ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
			"http_url": "http://localhost:8200/root/ruoyi.git"
		},
		"target": {
			"id": 2,
			"name": "ruoyi",
			"description": "ruoyi",
			"web_url": "http://localhost:8200/root/ruoyi",
			"avatar_url": null,
			"git_ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
			"git_http_url": "http://localhost:8200/root/ruoyi.git",
			"namespace": "Administrator",
			"visibility_level": 20,
			"path_with_namespace": "root/ruoyi",
			"default_branch": "main",
			"ci_config_path": null,
			"homepage": "http://localhost:8200/root/ruoyi",
			"url": "ssh://git@localhost:8200/root/ruoyi.git",
			"ssh_url": "ssh://git@localhost:8200/root/ruoyi.git",
			"http_url": "http://localhost:8200/root/ruoyi.git"
		},
		"last_commit": {
			"id": "a39deeac9763e89f81993bf85cc5f13efb9c3bad",
			"message": "error\n",
			"title": "error",
			"timestamp": "2024-06-10T08:16:19+08:00",
			"url": "http://localhost:8200/root/ruoyi/-/commit/a39deeac9763e89f81993bf85cc5f13efb9c3bad",
			"author": {
				"name": "luomao1",
				"email": "luomao1@lenovo.com"
			}
		},
		"work_in_progress": false,
		"total_time_spent": 0,
		"time_change": 0,
		"human_total_time_spent": null,
		"human_time_change": null,
		"human_time_estimate": null,
		"assignee_ids": [1],
		"state": "opened",
		"blocking_discussions_resolved": true,
		"action": "open"
	},
	"labels": [],
	"changes": {
		"merge_status": {
			"previous": "unchecked",
			"current": "preparing"
		}
	},
	"repository": {
		"name": "ruoyi",
		"url": "ssh://git@localhost:8200/root/ruoyi.git",
		"description": "ruoyi",
		"homepage": "http://localhost:8200/root/ruoyi"
	},
	"assignees": [{
		"id": 1,
		"name": "Administrator",
		"username": "root",
		"avatar_url": "https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80\u0026d=identicon",
		"email": "[REDACTED]"
	}]
}</code></pre> 
<h4 id="%E8%8E%B7%E5%BE%97%E5%B7%AE%E5%BC%82%E4%BB%A3%E7%A0%81">获得差异代码</h4> 
<p><a href="https://docs.gitlab.com/ee/api/merge_requests.html#list-merge-request-diffs" rel="nofollow" title="合并请求 API |GitLab的">合并请求 API |GitLab的</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/2b/24/kL1Fneju_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f5/6d/z9mTKkf9_o.png" width="1200"></p> 
<pre><code class="language-bash">{
	"assignee": {
		"avatarUrl": "https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&amp;d=identicon",
		"external": false,
		"id": 1,
		"name": "Administrator",
		"state": "active",
		"username": "root"
	},
	"author": {
		"avatarUrl": "https://www.gravatar.com/avatar/e64c7d89f26bd1972efa854d13d7dd61?s=80&amp;d=identicon",
		"external": false,
		"id": 1,
		"name": "Administrator",
		"state": "active",
		"username": "root"
	},
	"baseSha": "cafe2e5ea1d0892b8e770d84862686fb5dd9ad11",
	"changes": [{
		"aMode": "100644",
		"bMode": "100644",
		"deletedFile": false,
		"diff": "@@ -33,6 +33,8 @@ public class UserController {\n     @GetMapping(\"userinfo\")\n     public ModelAndView userinfo() {\n         SysUserVo sysUserVo = sysUserService.findByLoginName(SecurityUtil.getLoginUser().getUsername()).getData();\n+        // 密码设置错误\n+        String password = sysUserVo.getPassword();\n         sysUserVo.setPassword(null);\n         return new ModelAndView(\"user/userinfo\", \"user\", sysUserVo);\n     }\n",
		"newFile": false,
		"newPath": "src/main/java/cn/huanzi/qch/baseadmin/user/controller/UserController.java",
		"oldPath": "src/main/java/cn/huanzi/qch/baseadmin/user/controller/UserController.java",
		"renamedFile": false
	}],
	"changesCount": "1",
	"closed": false,
	"createdAt": 1717982801579,
	"description": "Uat",
	"downvotes": 0,
	"forceRemoveSourceBranch": true,
	"headSha": "a39deeac9763e89f81993bf85cc5f13efb9c3bad",
	"id": 2,
	"iid": 2,
	"labels": [],
	"latestBuildStartedAt": 1718002898301,
	"mergeStatus": "can_be_merged",
	"mergeWhenPipelineSucceeds": false,
	"merged": false,
	"projectId": 2,
	"sha": "a39deeac9763e89f81993bf85cc5f13efb9c3bad",
	"sourceBranch": "uat",
	"sourceProjectId": 2,
	"squash": true,
	"startSha": "cafe2e5ea1d0892b8e770d84862686fb5dd9ad11",
	"state": "opened",
	"targetBranch": "main",
	"targetProjectId": 2,
	"title": "Uat",
	"updatedAt": 1718006208667,
	"upvotes": 0,
	"userNotesCount": 3,
	"webUrl": "http://localhost:8200/root/ruoyi/-/merge_requests/2",
	"workInProgress": false
}</code></pre> 
<h3 id="2%E3%80%81%E8%AF%B7%E6%B1%82%E9%80%9A%E4%B9%89%E5%8D%83%E9%97%AE%E8%8E%B7%E5%BE%97review%E7%BB%93%E6%9E%9C">2、请求通义千问获得review结果</h3> 
<p><a href="https://help.aliyun.com/zh/dashscope/developer-reference/quick-start?disableWebsiteRedirect=true" rel="nofollow" title="如何快速入门通义千问API_模型服务灵积(DashScope)-阿里云帮助中心">如何快速入门通义千问API_模型服务灵积(DashScope)-阿里云帮助中心</a></p> 
<p><a href="https://www.jb51.net/program/316546iw0.htm" rel="nofollow" title="java调用通义千问API的详细完整步骤_java_脚本之家">java调用通义千问API的详细完整步骤_java_脚本之家</a></p> 
<h4 id="o6ecl"><strong>前提条件</strong></h4> 
<ul id="1b9a5f88e99f0"><li id="be444556d91kp"> <p id="13b588b73csan">DashScope SDK提供了Python和Java两个版本，请确保您已安装最新版SDK：<a href="https://help.aliyun.com/zh/dashscope/developer-reference/install-dashscope-sdk" rel="nofollow" title="安装DashScope SDK">安装DashScope SDK</a>。您也可以通过HTTP接口调用，详情请见：<a href="https://help.aliyun.com/zh/dashscope/developer-reference/api-details#32db94982cllx" rel="nofollow" title="HTTP调用接口">HTTP调用接口</a>。</p> </li></ul> 
<ul id="cfad6141cfvk3"><li id="u83127e7e"> <p id="872412c225a3h">已开通服务并获得API-KEY：<a href="https://help.aliyun.com/zh/dashscope/developer-reference/activate-dashscope-and-create-an-api-key" rel="nofollow" title="开通DashScope并创建API-KEY">开通DashScope并创建API-KEY</a>。</p> </li><li> <p><img alt="" height="866" src="https://images2.imgbox.com/63/4f/2NCXHfLC_o.png" width="1200"></p> </li><li id="db521d81fdr9i"> <p id="443bcf4ee9rb9">我们推荐您将API-KEY配置到环境变量中以降低API-KEY的泄漏风险，详情可参考<a href="https://help.aliyun.com/zh/dashscope/developer-reference/configure-api-key-through-environment-variables" rel="nofollow" title="通过环境变量配置API-KEY">通过环境变量配置API-KEY</a>。您也可以在代码中配置API-KEY，<strong>但是泄漏风险会提高</strong>。</p> 
  <ul><li> <pre id="ea3b5a07a4ad6"><code># 用您的 DashScope API-KEY 代替 YOUR_DASHSCOPE_API_KEY
## 如果您的Shell类型是Zsh，运行以下命令
echo "export DASHSCOPE_API_KEY='YOUR_DASHSCOPE_API_KEY'" &gt;&gt; ~/.zshrc</code></pre> </li></ul></li><li id="d8723ee795oy5"> <p id="e3a2f5dd91lh9">同时DashScope提供了与OpenAI兼容的接口访问服务，详情参考<a href="https://help.aliyun.com/zh/dashscope/developer-reference/compatibility-of-openai-with-dashscope/" rel="nofollow" title="OpenAI接口兼容">OpenAI接口兼容</a>。</p> </li></ul> 
<pre><code class="language-bash">{
	"requestId": "468f22eb-673d-91ed-8b2c-51db041ef92d",
	"usage": {
		"input_tokens": 25,
		"output_tokens": 68,
		"total_tokens": 93
	},
	"output": {
		"choices": [{
			"finish_reason": "stop",
			"message": {
				"role": "assistant",
				"content": "通义千问是阿里云自主研发的超大规模语言模型，能够回答问题、创作文字，还能表达观点、撰写代码。作为一个大型预训练语言模型，我能够根据您提出的指令产出相关的回复，并尽可能地提供准确和有用的信息。如果您有任何问题或需要帮助，请随时告诉我，我会尽力提供支持。"
			}
		}]
	}
}</code></pre> 
<h3 id="%E4%BA%8C%E3%80%81Gitlab%E8%B0%83%E7%94%A8%E4%BB%A3%E7%A0%81review%E8%AF%84%E8%AE%BAAPI">3、Gitlab调用代码review评论API</h3> 
<p><img alt="" height="1144" src="https://images2.imgbox.com/52/6d/88AwpKZB_o.png" width="1200"></p> 
<p></p> 
<p><a href="https://docs.gitlab.com/ee/api/commits.html" rel="nofollow" title="Commits API | GitLab">Commits API | GitLab</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/8a/35/hkOSrKki_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/4a/e6/eKLtKW0V_o.png" width="1200"></p> 
<p><strong>16.commint 提交信息 获取库的所有提交信息、创建多个文件的提交、单个文件提交、获取提交被推送到的branch、对给定分支的提交、还原至本次提交、提交与git文件的对比、查询提交评论信息、发表评论并提交、获取发表的评论、获取提交状态、查询提交合并信息、获取GPG签名</strong></p> 
<p>GitLab 提供了丰富的 API 来与 GitLab 实例进行交互，包括获取和创建 Merge Request（MR）的评论。以下是如何使用 GitLab API 来调用代码审查（Code Review）评论的相关步骤和示例。</p> 
<h4 id="1.%20%E8%8E%B7%E5%8F%96%E7%A7%81%E6%9C%89%E4%BB%A4%E7%89%8C%EF%BC%88Private%20Token%EF%BC%89">1. 获取私有令牌（Private Token）</h4> 
<p>首先，你需要从 GitLab 用户设置中获取一个私有令牌（Private Token），这将用于 API 认证。</p> 
<ol><li>登录到 GitLab。</li><li>点击右上角的用户头像，选择“Settings”（设置）。</li><li>在左侧菜单中选择“Access Tokens”（访问令牌）。</li><li>输入一个名称，选择你需要的权限范围（对于代码审查，通常需要“api”权限），然后点击“Create personal access token”（创建个人访问令牌）。</li><li>复制生成的令牌并妥善保存，因为离开页面后你将无法再次查看它。</li></ol> 
<h4 id="2.%20%E8%B0%83%E7%94%A8%20API">2. 调用 API</h4> 
<p>你可以使用任何支持 HTTP 请求的编程语言或工具来调用 GitLab API。以下是一个使用 <code>curl</code> 命令的示例，展示如何获取一个 Merge Request 的所有评论：</p> 
<blockquote> 
 <p><code>curl --header "Private-Token: YOUR_PRIVATE_TOKEN" "https://gitlab.example.com/api/v4/projects/PROJECT_ID/merge_requests/MERGE_REQUEST_IID/notes"</code></p> 
</blockquote> 
<ul><li><code>YOUR_PRIVATE_TOKEN</code>：替换为你的私有令牌。</li><li><code>gitlab.example.com</code>：替换为你的 GitLab 实例的 URL。</li><li><code>PROJECT_ID</code>：替换为你要获取评论的项目的 ID。</li><li><code>MERGE_REQUEST_IID</code>：替换为你要获取评论的 Merge Request 的内部 ID（不是全局 ID）。</li></ul> 
<h4 id="3.%20%E5%88%9B%E5%BB%BA%E8%AF%84%E8%AE%BA">3. 创建评论</h4> 
<p><a href="https://docs.gitlab.com/ee/api/notes.html#create-new-merge-request-note" rel="nofollow" title="Notes API 接口 |GitLab的">Notes API 接口 |GitLab的</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e9/3e/5N732zki_o.png" width="1200"></p> 
<p>你也可以使用 API 来创建一个新的评论。以下是一个示例：</p> 
<blockquote> 
 <p><code>curl --request POST --header "Private-Token: YOUR_PRIVATE_TOKEN" --header "Content-Type: application/json" --data '{"body":"这是一个新的评论"}' "https://gitlab.example.com/api/v4/projects/PROJECT_ID/merge_requests/MERGE_REQUEST_IID/notes"</code></p> 
</blockquote> 
<ul><li><code>body</code>：是你要创建的评论的内容。</li></ul> 
<pre><code class="language-bash">{
	"id": 2,
	"type": null,
	"body": "这是一个新的评论",
	"attachment": null,
	"author": {
		"id": 5,
		"username": "project_2_bot1",
		"name": "****",
		"state": "active",
		"avatar_url": "https://www.gravatar.com/avatar/0aaf8dea0d60673d2f8ee409dc2ec2af?s=80\u0026d=identicon",
		"web_url": "http://localhost:8200/project_2_bot1"
	},
	"created_at": "2024-06-10T07:15:02.909Z",
	"updated_at": "2024-06-10T07:15:02.909Z",
	"system": false,
	"noteable_id": 2,
	"noteable_type": "MergeRequest",
	"resolvable": false,
	"confidential": false,
	"noteable_iid": 2,
	"commands_changes": {}
}</code></pre> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="1199" src="https://images2.imgbox.com/ec/29/EIsTjeAe_o.png" width="1200"></p> 
<p><img alt="" height="1199" src="https://images2.imgbox.com/ce/77/YHJxLqTW_o.png" width="1200"></p> 
<p><img alt="" height="781" src="https://images2.imgbox.com/ee/6e/vArMODXA_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bb/90/1i1o1jpR_o.png" width="1200"></p> 
<h4 id="4.%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">4. 注意事项</h4> 
<ul><li>确保你的 GitLab 实例的 URL、项目 ID 和 Merge Request ID 都是正确的。</li><li>GitLab API 遵循 RESTful 设计原则，因此你可以使用 GET、POST、PUT、DELETE 等 HTTP 方法来执行不同的操作。</li><li>始终在发送请求时包含你的私有令牌进行认证。</li><li>GitLab API 文档是一个很好的资源，你可以在其中找到关于所有可用端点和参数的详细信息。你可以通过访问 <code>https://gitlab.example.com/help/api/README.md</code>（将 <code>gitlab.example.com</code> 替换为你的 GitLab 实例的 URL）来访问它。</li></ul> 
<h2 id="%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料</h2> 
<p><a href="https://blog.csdn.net/ytt0523_com/article/details/138659606" title="基于大模型 + 知识库的 Code Review 实践_大模型进行codereview结果对比-CSDN博客">基于大模型 + 知识库的 Code Review 实践_大模型进行codereview结果对比-CSDN博客</a></p> 
<p><a href="https://blog.csdn.net/phodal/article/details/133937665" title="AIGC 重塑软件工程 Code Review 篇：IDE 插件 + DevOps 平台协同组合-CSDN博客">AIGC 重塑软件工程 Code Review 篇：IDE 插件 + DevOps 平台协同组合-CSDN博客</a></p> 
<p><a href="https://zhuanlan.zhihu.com/p/701515648" rel="nofollow" title="🚀 CI+GPT双引擎驱动，🤖 开启AI代码评审新纪元 - 知乎 (zhihu.com)">🚀 CI+GPT双引擎驱动，🤖 开启AI代码评审新纪元 - 知乎 (zhihu.com)</a></p> 
<p><a href="https://github.com/mimo-x/Code-Review-GPT-Gitlab/" title="GitHub - mimo-x/Code-Review-GPT-Gitlab: 🤖 GPT Code Review for Gitlab （针对于 Gitlab 的 LLM 辅助 Code Review 工具）项目详细文档 👇🏻">GitHub - mimo-x/Code-Review-GPT-Gitlab: 🤖 GPT Code Review for Gitlab （针对于 Gitlab 的 LLM 辅助 Code Review 工具）项目详细文档 👇🏻</a></p> 
<p><a href="https://tqz0rsrhsvf.feishu.cn/docx/FlgzdMrj0oYOg2xXY7EcrsZZnjb" rel="nofollow" title="CodeReview with LLM in Gitlab">CodeReview with LLM in Gitlab</a></p> 
<p><a href="https://juejin.cn/post/7292692843415945225" rel="nofollow" title="基于大模型的 Code Review 实践 - 掘金 (juejin.cn)">基于大模型的 Code Review 实践 - 掘金 (juejin.cn)</a></p> 
<p><a href="https://zhuanlan.zhihu.com/p/617888638" rel="nofollow" title="玩转 ChatGPT+极狐GitLab｜自动化的MR 变更评审来了 - 知乎 (zhihu.com)">玩转 ChatGPT+极狐GitLab｜自动化的MR 变更评审来了 - 知乎 (zhihu.com)</a></p> 
<p><a href="https://blog.csdn.net/qq_18515155/article/details/110820286" title="GitLab的Webhook配置和开发_gitlab webhook-CSDN博客">GitLab的Webhook配置和开发_gitlab webhook-CSDN博客</a></p> 
<p><a href="https://www.php.cn/faq/620623.html" rel="nofollow" title="GitLab的Webhook功能及自动触发流程-git-PHP中文网">GitLab的Webhook功能及自动触发流程-git-PHP中文网</a></p> 
<p><a href="https://www.kancloud.cn/apachecn/gitlab-doc-zh/1948844" rel="nofollow" title="Review Apps · Gitlab 中文文档 · 看云">Review Apps · Gitlab 中文文档 · 看云</a></p> 
<p><a href="https://blog.csdn.net/xianpo/article/details/114300364" title="gitLabApi文档信息总结-CSDN博客">gitLabApi文档信息总结-CSDN博客</a></p> 
<p><a href="https://cloud.tencent.com/developer/article/2028108" rel="nofollow" title="Gitlab配置webhook报错：Urlis blocked: Requests to the local netwo..解决-腾讯云开发者社区-腾讯云">Gitlab配置webhook报错：Urlis blocked: Requests to the local netwo..解决-腾讯云开发者社区-腾讯云</a></p> 
<p><a href="https://www.jb51.net/program/316546iw0.htm" rel="nofollow" title="java调用通义千问API的详细完整步骤_java_脚本之家">java调用通义千问API的详细完整步骤_java_脚本之家</a></p> 
<p><a href="https://www.jianshu.com/p/e045a1b359b6" rel="nofollow" title="Gitlab API开发 - 简书">Gitlab API开发 - 简书</a></p> 
<p><a href="https://help.aliyun.com/document_detail/215696.html" rel="nofollow" title="调用CreateMergeRequestComment创建评论_云效(Apsara Devops)-阿里云帮助中心">调用CreateMergeRequestComment创建评论_云效(Apsara Devops)-阿里云帮助中心</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df43ad4203293807036bf054d632bb7e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2024华为OD机试题库-(A卷&#43;B卷&#43;C卷&#43;D卷)-(JAVA、Python、C&#43;&#43;)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c08bb4dfc28922da50b838d763e2ce83/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android ViewPager2 &#43; FragmentStateAdapter 的使用以及问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>