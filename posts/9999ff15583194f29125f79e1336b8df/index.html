<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring boot3登录开发-邮箱登录/注册接口实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9999ff15583194f29125f79e1336b8df/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="spring boot3登录开发-邮箱登录/注册接口实现">
  <meta property="og:description" content="⛰️个人主页: 蒾酒
🔥系列专栏：《spring boot实战》
🌊山高路远，行路漫漫，终有归途
目录
写在前面
上文衔接
内容简介 功能分析
所需依赖
邮箱验证登录/注册实现
1.创建交互对象 2.登录注册业务逻辑实现 最近发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。
点击跳转到学习网站
写在前面 本文介绍了springboot开发后端服务中，邮箱验证码登录/注册功能的设计与实现，坚持看完相信对你有帮助。
同时欢迎订阅springboot系列专栏，持续分享spring boot的使用经验。
上文衔接 本文衔接上文，可以看一下：
spring boot3登录开发-邮件验证码接口实现-CSDN博客
用户表设计如下：
create table user ( id bigint auto_increment comment &#39;主键&#39; primary key, user_name varchar(32) null comment &#39;用户昵称&#39;, password varchar(255) null comment &#39;密码&#39;, account varchar(64) null comment &#39;账号&#39;, user_role varchar(252) default &#39;user&#39; null comment &#39;用户角色：user / admin&#39;, avatar varchar(1024) null comment &#39;头像&#39;, create_time datetime default (now()) null comment &#39;创建时间&#39;, update_time datetime default CURRENT_TIMESTAMP null comment &#39;更新时间&#39;, is_delete tinyint(1) default 0 null comment &#39;逻辑删除：1删除/0存在&#39;, gender tinyint(1) null comment &#39;性别&#39;, user_signature varchar(255) null comment &#39;个性签名&#39;, status tinyint(1) default 1 not null comment &#39;状态：1正常0禁用&#39;, phone varchar(11) null comment &#39;手机号&#39;, email varchar(100) null comment &#39;邮箱&#39; ) comment &#39;用户表&#39;; 内容简介 上文我们已经实现了邮件验证码的发送接口，本文我们来实现这个邮箱验证登录/注册逻辑。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-16T16:17:14+08:00">
    <meta property="article:modified_time" content="2024-06-16T16:17:14+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring boot3登录开发-邮箱登录/注册接口实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> <img alt="" height="68" src="https://images2.imgbox.com/6f/52/HqTlPfvS_o.jpg" width="68"></p> 
<p>⛰️<a href="https://so.csdn.net/so/search?q=%E4%B8%AA%E4%BA%BA%E4%B8%BB%E9%A1%B5&amp;spm=1001.2101.3001.7020" title="个人主页">个人主页</a>:     <a href="https://blog.csdn.net/qq_62262918?spm=1011.2266.3001.5343" title="蒾酒">蒾酒</a></p> 
<p>🔥系列专栏：<a href="https://blog.csdn.net/qq_62262918/category_12571219.html?spm=1001.2014.3001.5482" title="《spring boot实战》">《spring boot实战》</a></p> 
<p>🌊山高路远，行路漫漫，终有归途</p> 
<hr> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2-toc" style="margin-left:0px;"><a href="#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" rel="nofollow">写在前面</a></p> 
<p id="%E4%B8%8A%E6%96%87%E8%A1%94%E6%8E%A5-toc" style="margin-left:0px;"><a href="#%E4%B8%8A%E6%96%87%E8%A1%94%E6%8E%A5" rel="nofollow">上文衔接</a></p> 
<p id="%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B-toc" style="margin-left:0px;"><a href="#%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B" rel="nofollow">内容简介 </a></p> 
<p id="%C2%A0%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%C2%A0%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90" rel="nofollow"> 功能分析</a></p> 
<p id="%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96-toc" style="margin-left:0px;"><a href="#%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96" rel="nofollow">所需依赖</a></p> 
<p id="%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0" rel="nofollow">邮箱验证登录/注册实现</a></p> 
<p id="1.%E5%88%9B%E5%BB%BA%E4%BA%A4%E4%BA%92%E5%AF%B9%E8%B1%A1%C2%A0-toc" style="margin-left:40px;"><a href="#1.%E5%88%9B%E5%BB%BA%E4%BA%A4%E4%BA%92%E5%AF%B9%E8%B1%A1%C2%A0" rel="nofollow">1.创建交互对象 </a></p> 
<p id="2.%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0%C2%A0-toc" style="margin-left:40px;"><a href="#2.%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0%C2%A0" rel="nofollow">2.登录注册业务逻辑实现 </a></p> 
<hr id="hr-toc"> 
<blockquote> 
 <p>最近发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。</p> 
 <p>    <a href="https://www.captainbed.cn/ding" rel="nofollow" title="点击跳转到学习网站">点击跳转到学习网站</a></p> 
 <p><img alt="" height="352" src="https://images2.imgbox.com/60/4d/DZywS3Xd_o.png" width="748"></p> 
</blockquote> 
<h2 id="%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">写在前面</h2> 
<p>本文介绍了springboot开发后端服务中，邮箱验证码登录/注册功能的设计与实现，坚持看完相信对你有帮助。</p> 
<p>同时欢迎订阅springboot系列专栏，持续分享spring boot的使用经验。</p> 
<h2 id="%E4%B8%8A%E6%96%87%E8%A1%94%E6%8E%A5">上文衔接</h2> 
<blockquote> 
 <p>本文衔接上文，可以看一下：</p> 
 <p><a href="https://blog.csdn.net/qq_62262918/article/details/139485591" title="spring boot3登录开发-邮件验证码接口实现-CSDN博客">spring boot3登录开发-邮件验证码接口实现-CSDN博客</a></p> 
</blockquote> 
<p>用户表设计如下：</p> 
<div> 
 <pre><code class="language-sql">create table user
(
    id             bigint auto_increment comment '主键'
        primary key,
    user_name      varchar(32)                            null comment '用户昵称',
    password       varchar(255)                           null comment '密码',
    account        varchar(64)                            null comment '账号',
    user_role      varchar(252) default 'user'            null comment '用户角色：user / admin',
    avatar         varchar(1024)                          null comment '头像',
    create_time    datetime     default (now())           null comment '创建时间',
    update_time    datetime     default CURRENT_TIMESTAMP null comment '更新时间',
    is_delete      tinyint(1)   default 0                 null comment '逻辑删除：1删除/0存在',
    gender         tinyint(1)                             null comment '性别',
    user_signature varchar(255)                           null comment '个性签名',
    status         tinyint(1)   default 1                 not null comment '状态：1正常0禁用',
    phone          varchar(11)                            null comment '手机号',
    email          varchar(100)                           null comment '邮箱'
)
    comment '用户表';

</code></pre> 
</div> 
<h2 id="%E5%86%85%E5%AE%B9%E7%AE%80%E4%BB%8B">内容简介 </h2> 
<p>上文我们已经实现了<a href="https://so.csdn.net/so/search?q=%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81&amp;spm=1001.2101.3001.7020" title="邮件验证码">邮件验证码</a>的发送接口，本文我们来实现这个邮箱验证登录/注册逻辑。</p> 
<h2 id="%C2%A0%E5%8A%9F%E8%83%BD%E5%88%86%E6%9E%90"> 功能分析</h2> 
<blockquote> 
 <ul><li>邮箱未注册过则先注册，注册完执行登录</li><li>已经注册过的邮箱，直接执行登录</li></ul> 
</blockquote> 
<h2 id="%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96">所需依赖</h2> 
<blockquote> 
 <p>redis</p> 
 <p><a href="https://blog.csdn.net/qq_62262918/article/details/136067550" title="Spring Boot3整合Redis_springboot3整合redis-CSDN博客">Spring Boot3整合Redis_springboot3整合redis-CSDN博客</a></p> 
</blockquote> 
<h2 id="%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0">邮箱验证登录/注册实现</h2> 
<h3 id="1.%E5%88%9B%E5%BB%BA%E4%BA%A4%E4%BA%92%E5%AF%B9%E8%B1%A1%C2%A0">1.创建交互对象 </h3> 
<p id="%E7%94%A8%E6%88%B7%E7%9F%AD%E4%BF%A1%E7%99%BB%E5%BD%95%2F%E6%B3%A8%E5%86%8CDTO"><strong>用户登录/注册DTO：</strong></p> 
<pre><code class="language-java">import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Pattern;
import lombok.Data;

/**
 * @author mijiupro
 */
@Data
public class UserEmailLoginDTO {
    @NotBlank(message = "邮箱不能为空")
    @Pattern(regexp = "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$", message = "邮箱格式不正确")
    private String email;

    @NotBlank( message = "验证码不能为空")
    private String captcha;

}</code></pre> 
<blockquote> 
 <p>这里用Lombok的@Data来生成getter和setter。</p> 
 <p>这里用spring boot参数验证组件来检验参数格式：</p> 
 <p><a href="https://blog.csdn.net/qq_62262918/article/details/136180252" title="spring boot3参数校验基本用法_springboot3使用校验类注解-CSDN博客">spring boot3参数校验基本用法_springboot3使用校验类注解-CSDN博客</a></p> 
</blockquote> 
<p><strong> 用户登录VO：</strong></p> 
<pre><code class="language-java">import lombok.Builder;
import lombok.Data;

import java.io.Serializable;


/**
 * @author mijiupro
 */
@Data
@Builder
public class UserLoginVO implements Serializable {
    private String token;//令牌
    private String userName;//用户名
    private String avatar;//头像
}</code></pre> 
<h3 id="2.%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%AE%9E%E7%8E%B0%C2%A0">2.登录注册业务逻辑实现 </h3> 
<pre><code class="language-java">import com.baomidou.mybatisplus.extension.conditions.query.LambdaQueryChainWrapper;
import com.mijiu.commom.enumerate.ResultEnum;
import com.mijiu.commom.exception.*;
import com.mijiu.commom.model.dto.UserEmailLoginDTO;
import com.mijiu.commom.model.vo.UserLoginVO;
import com.mijiu.commom.util.JwtUtils;
import com.mijiu.entity.User;
import com.mijiu.mapper.UserMapper;
import com.mijiu.service.UserService;
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.springframework.data.redis.core.HashOperations;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.stereotype.Service;
import org.springframework.util.DigestUtils;


import java.util.Map;
import java.util.Objects;

/**
 * &lt;p&gt;
 * 用户表 服务实现类
 * &lt;/p&gt;
 *
 * @author 蒾酒
 * @since 2024-02-03
 */
@Service
@Slf4j
public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {

    private final UserMapper userMapper;
    private final JwtUtils jwtUtils;
    private final StringRedisTemplate stringRedisTemplate;

    public UserServiceImpl(UserMapper userMapper, JwtUtils jwtUtils, StringRedisTemplate stringRedisTemplate) {
        this.userMapper = userMapper;
        this.jwtUtils = jwtUtils;
        this.stringRedisTemplate = stringRedisTemplate;
    }
    
    @Override
    public UserLoginVO emailLogin(UserEmailLoginDTO userEmailLoginDTO) {
        // 校验验证码是否存在
        HashOperations&lt;String, String, String&gt; hashOps = stringRedisTemplate.opsForHash();
        String captcha = hashOps.get("login:email:captcha:" + userEmailLoginDTO.getEmail(), "captcha");

        if (StringUtils.isEmpty(captcha)) {
            log.error("邮箱 {} 的验证码不存在或已过期", userEmailLoginDTO.getEmail());
            throw new CaptchaErrorException(ResultEnum.USER_CAPTCHA_NOT_EXIST);
        }

        // 查询用户是否已注册
        User loginUser = new LambdaQueryChainWrapper&lt;&gt;(userMapper).eq(User::getPhone, userEmailLoginDTO.getEmail()).one();

        // 如果未注册则进行注册
        if (Objects.isNull(loginUser)) {
            loginUser = registerByEmail(userEmailLoginDTO.getEmail());
        }

        // 校验验证码是否正确
        if (!userEmailLoginDTO.getCaptcha().equals(captcha)) {
            log.error("邮箱号 {} 的验证码错误", userEmailLoginDTO.getEmail());
            throw new CaptchaErrorException(ResultEnum.AUTH_CODE_ERROR);
        }
        //判断用户是否被禁用
        if (!loginUser.getStatus()) {
            throw new AccountForbiddenException(ResultEnum.USER_ACCOUNT_FORBIDDEN);
        }
        log.info("邮箱 {} 用户登录成功",userEmailLoginDTO.getEmail());

        return UserLoginVO.builder()
                .token(jwtUtils.generateToken(Map.of("userId", loginUser.getId()), "user"))
                .userName(loginUser.getUserName())
                .build();
    }

    
    // 用户邮箱注册
    private User registerByEmail(String email) {
        User user = new User();
        user.setEmail(email);
        user.setUserName(email);
        user.setStatus(true);
        if (userMapper.insert(user) &lt; 1) {
            log.error("邮箱 {} 用户注册失败！", email);
            throw new AccountRegisterFailException(ResultEnum.USER_REGISTER_FAIL);
        }

        log.info("邮箱 {} 用户注册成功", email);

        return user;
    }
}
</code></pre> 
<h2 id="4.%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3">4.测试接口</h2> 
<p>使用swagger3进行测试</p> 
<p> <a href="https://blog.csdn.net/qq_62262918/article/details/135761392?spm=1001.2014.3001.5502" title="Spring Boot3整合knife4j(swagger3)_springboot3 knife4j-CSDN博客">Spring Boot3整合knife4j(swagger3)_springboot3 knife4j-CSDN博客</a></p> 
<p><strong>调用邮箱验证码发送接口 </strong></p> 
<h2><img alt="" height="567" src="https://images2.imgbox.com/c0/27/Vpygap4t_o.png" width="1200"></h2> 
<p><strong> </strong><img alt="" height="434" src="https://images2.imgbox.com/eb/43/OUhFD4xZ_o.png" width="477"></p> 
<p><strong>调用邮箱验证登录接口</strong></p> 
<p><img alt="" height="891" src="https://images2.imgbox.com/5e/ae/F5gQdwAN_o.png" width="1200"><strong> 第一次登录所以也就自动注册成功了。</strong></p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/d3/b5/84ftWE07_o.png" width="1200"></p> 
<h2 id="%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E">写在最后</h2> 
<p>springboot实现邮箱验证登录注册到这里就结束了，本文介绍了一种通用的邮箱验证登录实现方式，代码逻辑清晰。任何问题评论区或私信讨论，欢迎指正。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c0364b74c810a7d0bc7de8b9687963c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">手把手带你搭建一个语音对话机器人，5分钟定制个人AI小助手（新手入门篇）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e7a641162274ed7c5c528d863c035ef3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flutter 实现StackAllocator简化FFI局部变量的内存管理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>