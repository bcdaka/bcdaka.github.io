<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 使用adb操作WiFi连接扫描等相关指令 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/862c78b1aebf33787451ee568fb5a7b1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android 使用adb操作WiFi连接扫描等相关指令">
  <meta property="og:description" content="Android 使用adb操作WiFi连接扫描等相关指令 文章目录 Android 使用adb操作WiFi连接扫描等相关指令一、前言二、adb shell cmd wifi 主要命令### 1、adb shell cmd wifi -h2、打开关闭WLAN3、扫描WiFi 和查看扫描列表4、连接WiFi5、查看WiFi状态(1) wifi 正常连接下的信息：(2)串口查看wifi关闭情况的信息：(3)串口查看wifi开启，但是未连接wifi情况的信息： 6、查看已保存或者连接的WiFi列表7、打开关闭热点（1）打开热点（2）关闭热点 三、其他1、adb shell cmd wifi -h 完整信息2、 adb shell cmd wifi 命令在系统中的具体代码3、svc控制 wifi、热点、蓝牙命令4、iw dev命令（1）iw dev 示例（2）通过wifi节点搜索wifi列表（3）iw dev 主要命令 5、adb简介及常用命令总结 一、前言 Android系统调试是，如果没有系统原生设置应用又需要调试验证WiFi功能时，
可以使用一些指令来验证调试WiFi相关功能，
最常用的就是 svc wifi enable/disable，或者使用iv dev来验证，
但对于AP功能就没办法验证了，并且可调试功能比较少，
其实Android系统自带有组很强大的shell指令集，
这里记录下平时使用的cmd wifi 相关指令。
系统初期开发或者定位一下wifi、热点问题会比较有用。
本文不仅详细介绍cmd wifi相关用法，并且后续有介绍系统Java代码中具体控制位置，
如果有特殊需求可以对命令进行扩展定制。
目前网上还没有这么全面介绍的文章，有wifi调试需求的可以先收藏后续慢慢查看。
二、adb shell cmd wifi 主要命令 ### 1、adb shell cmd wifi -h 查看WiFi所有指令以及参数
命令具体信息太多，最后展示。
串口查看命令具体参数技巧，grep 某个关键字：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-28T15:11:56+08:00">
    <meta property="article:modified_time" content="2024-06-28T15:11:56+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 使用adb操作WiFi连接扫描等相关指令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Android_adbWiFi_0"></a>Android 使用adb操作WiFi连接扫描等相关指令</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Android_adbWiFi_0" rel="nofollow">Android 使用adb操作WiFi连接扫描等相关指令</a></li><li><ul><li><a href="#_3" rel="nofollow">一、前言</a></li><li><a href="#adb_shell_cmd_wifi___31" rel="nofollow">二、adb shell cmd wifi 主要命令</a></li><li><ul><li><a href="#_1adb_shell_cmd_wifi_h_37" rel="nofollow">### 1、adb shell cmd wifi -h</a></li><li><a href="#2WLAN_55" rel="nofollow">2、打开关闭WLAN</a></li><li><a href="#3WiFi__63" rel="nofollow">3、扫描WiFi 和查看扫描列表</a></li><li><a href="#4WiFi_102" rel="nofollow">4、连接WiFi</a></li><li><a href="#5WiFi_126" rel="nofollow">5、查看WiFi状态</a></li><li><ul><li><a href="#1_wifi__130" rel="nofollow">(1) wifi 正常连接下的信息：</a></li><li><a href="#2wifi_155" rel="nofollow">(2)串口查看wifi关闭情况的信息：</a></li><li><a href="#3wifiwifi_166" rel="nofollow">(3)串口查看wifi开启，但是未连接wifi情况的信息：</a></li></ul> 
    </li><li><a href="#6WiFi_179" rel="nofollow">6、查看已保存或者连接的WiFi列表</a></li><li><a href="#7_203" rel="nofollow">7、打开关闭热点</a></li><li><ul><li><a href="#1_205" rel="nofollow">（1）打开热点</a></li><li><a href="#2_232" rel="nofollow">（2）关闭热点</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_242" rel="nofollow">三、其他</a></li><li><ul><li><a href="#1adb_shell_cmd_wifi_h__244" rel="nofollow">1、adb shell cmd wifi -h 完整信息</a></li><li><a href="#2_adb_shell_cmd_wifi__411" rel="nofollow">2、 adb shell cmd wifi 命令在系统中的具体代码</a></li><li><a href="#3svc_wifi_539" rel="nofollow">3、svc控制 wifi、热点、蓝牙命令</a></li><li><a href="#4iw_dev_555" rel="nofollow">4、iw dev命令</a></li><li><ul><li><a href="#1iw_dev__557" rel="nofollow">（1）iw dev 示例</a></li><li><a href="#2wifiwifi_590" rel="nofollow">（2）通过wifi节点搜索wifi列表</a></li><li><a href="#3iw_dev__626" rel="nofollow">（3）iw dev 主要命令</a></li></ul> 
    </li><li><a href="#5adb_648" rel="nofollow">5、adb简介及常用命令总结</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_3"></a>一、前言</h3> 
<p>Android系统调试是，如果没有系统原生设置应用又需要调试验证WiFi功能时，</p> 
<p>可以使用一些指令来验证调试WiFi相关功能，</p> 
<p>最常用的就是 svc wifi enable/disable，或者使用iv dev来验证，</p> 
<p>但对于AP功能就没办法验证了，并且可调试功能比较少，</p> 
<p>其实Android系统自带有组很强大的shell指令集，</p> 
<p>这里记录下平时使用的cmd wifi 相关指令。</p> 
<p>系统初期开发或者定位一下wifi、热点问题会比较有用。</p> 
<p>本文不仅详细介绍cmd wifi相关用法，并且后续有介绍系统Java代码中具体控制位置，</p> 
<p>如果有特殊需求可以对命令进行扩展定制。</p> 
<p>目前网上还没有这么全面介绍的文章，有wifi调试需求的可以先收藏后续慢慢查看。</p> 
<h3><a id="adb_shell_cmd_wifi___31"></a>二、adb shell cmd wifi 主要命令</h3> 
<h4><a id="_1adb_shell_cmd_wifi_h_37"></a>### 1、adb shell cmd wifi -h</h4> 
<p>查看WiFi所有指令以及参数</p> 
<p>命令具体信息太多，最后展示。</p> 
<p>串口查看命令具体参数技巧，grep 某个关键字：</p> 
<pre><code>console:/ # cmd wifi -h | grep   connect-network                               
  connect-network &lt;ssid&gt; open|owe|wpa2|wpa3|wep [&lt;passphrase&gt;] [-x] [-m] [-d] [-b &lt;bssid&gt;] [-r auto|none|persistent|non_persistent]
console:/ # 
</code></pre> 
<p>下面很多命令返回的结果是使用串口工具展示的，串口命令是不需要adb 连接的。</p> 
<h4><a id="2WLAN_55"></a>2、打开关闭WLAN</h4> 
<p>adb shell cmd wifi set-wifi-enabled enabled</p> 
<p>adb shell cmd wifi set-wifi-enabled disabled</p> 
<h4><a id="3WiFi__63"></a>3、扫描WiFi 和查看扫描列表</h4> 
<pre><code>adb shell cmd wifi start-scan             //扫描

adb shell cmd wifi list-scan-results    //查看扫描结果
</code></pre> 
<p>cmd wifi list-scan-results 命令扫描到的信息：</p> 
<pre><code>console:/ # 
console:/ # cmd wifi list-scan-results  
    BSSID              Frequency      RSSI           Age(sec)     SSID   Flags
  48:5f:08:ed:f7:f1       5200        -68             10.148    synwcs_5G                         [WPA2-PSK-CCMP][RSN-PSK-CCMP][WPA-PSK-CCMP][ESS]
  34:f7:16:92:87:6c       2442        -38             10.148    syrj                              [WPA-PSK-CCMP][WPA2-PSK-CCMP][RSN-PSK-CCMP][ESS]
  de:00:1a:bc:b3:4a       2422        -57             10.148    IFLYHub_86_7849                   [WPA2-PSK-CCMP][RSN-PSK-CCMP][ESS]
  80:ea:07:28:ef:1c       5240        -96             10.148    HorionRj_5G                       [WPA-PSK-CCMP+TKIP][WPA2-PSK-CCMP+TKIP][RSN-PSK-CCMP+TKIP][ESS]
  48:5f:08:45:a6:c1       5805        -53             10.148    SYEBSW-5G                         [WPA-PSK-CCMP][WPA2-PSK-CCMP][RSN-PSK-CCMP][ESS]
  f4:84:8d:24:19:35       5785        -77             10.148    synwcs-m_5G                       [WPA-PSK-CCMP][WPA2-PSK-CCMP][RSN-PSK-CCMP][ESS]

console:/ # 
</code></pre> 
<p>扫描列表中信息含义：</p> 
<pre><code>BSSID     ：MAC地址
Frequency ：信号频段，5G：5160到5865，2.4G：2401~2483MHz
RSSI      ：wifi信号强度，RSSI &gt;=-55为满格信号,level为4，每个level之间的Rssi的跳变为15
Age(sec)  ：响应时间？
SSID      ：wifi名称
Flags     ：加密格式，包含加密相关字符
</code></pre> 
<h4><a id="4WiFi_102"></a>4、连接WiFi</h4> 
<pre><code>adb shell cmd wifi connect-network wifiName wpa2 12345678
</code></pre> 
<p>//wifiName 连接WiFi名称</p> 
<p>//wpa2 加密方式,如果没有密码写 open ，最后的密码不用写</p> 
<p>//12345678 密码</p> 
<p>如果没有密码，连接xm名称的wifi：</p> 
<pre><code>cmd wifi connect-network xm open
</code></pre> 
<h4><a id="5WiFi_126"></a>5、查看WiFi状态</h4> 
<p>adb shell cmd wifi status</p> 
<h5><a id="1_wifi__130"></a>(1) wifi 正常连接下的信息：</h5> 
<pre><code>C:\Users\As11040&gt;adb shell cmd wifi status
Wifi is enabled //（1）查看到Wifi的开关状态
Wifi scanning is only available when wifi is enabled //（2）扫描状态
==== Primary ClientModeManager instance ====
Wifi is connected to "xm5G" //（3）wifi连接的名称，下面是详细信息
WifiInfo: SSID: "xm5G", BSSID: 8c:53:c3:53:c6:59, MAC: c0:f5:35:4f:a3:e0, IP: /192.168.31.17, Security type: 0, Supplicant state: COMPLETED, Wi-Fi standard: 5, RSSI: -46, Link speed: 702Mbps, Tx Link speed: 702Mbps, Max Supported Tx Link speed: 866Mbps, Rx Link speed: 780Mbps, Max Supported Rx Link speed: 866Mbps, Frequency: 5785MHz, Net ID: 2, Metered hint: false, score: 60, isUsable: true, CarrierMerged: false, SubscriptionId: -1, IsPrimary: 1, Trusted: true, Restricted: false, Ephemeral: false, OEM paid: false, OEM private: false, OSU AP: false, FQDN: &lt;none&gt;, Provider friendly name: &lt;none&gt;, Requesting package name: &lt;none&gt;"xm5G"openMLO Information: , Is TID-To-Link negotiation supported by the AP: false, AP MLD Address: &lt;none&gt;, AP MLO Link Id: &lt;none&gt;, AP MLO Affiliated links: &lt;none&gt;
successfulTxPackets: 317
successfulTxPacketsPerSecond: 2.4672825327175896
retriedTxPackets: 3898
retriedTxPacketsPerSecond: 0.4502428708131321
lostTxPackets: 42
lostTxPacketsPerSecond: 0.0
successfulRxPackets: 173
successfulRxPacketsPerSecond: 2.4364789031543634

C:\Users\As11040&gt;
</code></pre> 
<h5><a id="2wifi_155"></a>(2)串口查看wifi关闭情况的信息：</h5> 
<pre><code>console:/ # cmd wifi status                                                    
Wifi is disabled
Wifi scanning is only available when wifi is enabled
console:/ # 
</code></pre> 
<h5><a id="3wifiwifi_166"></a>(3)串口查看wifi开启，但是未连接wifi情况的信息：</h5> 
<pre><code>console:/ # cmd wifi status                                                    
Wifi is enabled
Wifi scanning is only available when wifi is enabled
==== ClientModeManager instance: ConcreteClientModeManager{id=2374293 iface=wlan0 role=ROLE_CLIENT_PRIMARY} ====
Wifi is not connected
console:/ # 
</code></pre> 
<h4><a id="6WiFi_179"></a>6、查看已保存或者连接的WiFi列表</h4> 
<pre><code>Unknown command: list-network //未连接wifi前的情况
255|console:/ # cmd wifi list-networks                                         
No networks
console:/ # 

console:/ # cmd wifi list-networks //连接wifi后的打印   
Network Id      SSID                         Security type
0            xm5G                             open
0            xm5G                             owe^
1            syrj                             wpa2-psk
1            syrj                             wpa3-sae^
console:/ # 
console:/ # 
</code></pre> 
<p>上面可以看到每连接一个wifi都会有重复多一个，另外一个信息是不准确的，这个不影响。</p> 
<h4><a id="7_203"></a>7、打开关闭热点</h4> 
<h5><a id="1_205"></a>（1）打开热点</h5> 
<pre><code>adb shell cmd wifi start-softap ap_ssidxx wpa2 12345678 -b 5
</code></pre> 
<p>// ap_ssidxx 热点名称</p> 
<p>// wpa2 加密方式</p> 
<p>//12345678 密码</p> 
<p>//-b 5 5G频段</p> 
<p>实际运行运行中，运行上面代码，会有点小问题：<br> 热点是开启了，也可以被搜到和连接上；</p> 
<p>但是打开Setings应用发现，热点名称，密码，加密类型等信息并没有修改，重启后也是无效的；</p> 
<p>所以说这个方法开启热点只能单次有效。</p> 
<h5><a id="2_232"></a>（2）关闭热点</h5> 
<pre><code>adb shell cmd wifi stop-softap
</code></pre> 
<p>关闭是没啥问题的。</p> 
<h3><a id="_242"></a>三、其他</h3> 
<h4><a id="1adb_shell_cmd_wifi_h__244"></a>1、adb shell cmd wifi -h 完整信息</h4> 
<pre><code>C:\Users\As11140&gt;adb shell cmd wifi -h
Wi-Fi (wifi) commands:
  help or -h
    Print this help text.
  get-country-code //(1)获取国家码
    Gets country code as a two-letter string
  set-wifi-enabled enabled|disabled //（2）wifi打开和关闭
    Enables/disables Wifi on this device.
  set-scan-always-available enabled|disabled //（3）设置是否扫描状态
    Sets whether scanning should be available even when wifi is off.
  list-scan-results //（4）查看扫描到的列表
    Lists the latest scan results
  start-scan //（5）开始扫描
    Start a new scan
  list-networks //（6）保存的wifi，名称和networkid
    Lists the saved networks
  forget-network &lt;networkId&gt; //（7）忘记某个网络的networkid
    Remove the network mentioned by &lt;networkId&gt;
        - Use list-networks to retrieve &lt;networkId&gt; for the network
  status  //（8）wifi当前状态，打开状态和连接状态
    Current wifi status
  set-verbose-logging enabled|disabled  //（9）wifi打印等级是否调高
    Set the verbose logging enabled or disabled
  is-verbose-logging  //（10）wifi打印等级查看
    Check whether verbose logging enabled or disabled
  start-restricting-auto-join-to-subscription-id subId
    temporarily disable all wifi networks except merged carrier networks with the given subId
  stop-restricting-auto-join-to-subscription-id
    Undo the effects of start-restricting-auto-join-to-subscription-id
  add-suggestion &lt;ssid&gt; open|owe|wpa2|wpa3 [&lt;passphrase&gt;] [-u] [-o] [-p] [-m]  [-s] [-d] [-b &lt;bssid&gt;] [-e] [-i] [-a &lt;carrierId&gt;] [-c &lt;subscriptionId&gt;]
    Add a network suggestion with provided params
    Use 'network-suggestions-set-user-approved com.android.shell yes' to approve suggestions added via shell (Needs root access)
    &lt;ssid&gt; - SSID of the network
    open|owe|wpa2|wpa3 - Security type of the network.
        - Use 'open' or 'owe' for networks with no passphrase
           - 'open' - Open networks (Most prevalent)
           - 'owe' - Enhanced open networks
        - Use 'wpa2' or 'wpa3' for networks with passphrase
           - 'wpa2' - WPA-2 PSK networks (Most prevalent)
           - 'wpa3' - WPA-3 PSK networks
    -u - Mark the suggestion untrusted.
    -o - Mark the suggestion oem paid.
    -p - Mark the suggestion oem private.
    -m - Mark the suggestion metered.
    -h - Mark the network hidden.
    -s - Share the suggestion with user.
    -d - Mark the suggestion autojoin disabled.
    -b &lt;bssid&gt; - Set specific BSSID.
    -r - Enable non_persistent randomization (disabled by default)
    -a - Mark the suggestion carrier merged
    -c &lt;carrierId&gt; - set carrier Id
    -i &lt;subscriptionId&gt; - set subscription Id, if -a is used, this must be set
  remove-suggestion &lt;ssid&gt; [-l]
    Remove a network suggestion with provided SSID of the network
    -l - Remove suggestion with lingering, if not set will disconnect immediately
  remove-all-suggestions
    Removes all suggestions added via shell
  list-suggestions  //（12）对应List&lt;WifiNetworkSuggestion&gt; ，不清楚作用
    Lists the suggested networks added via shell
  set-coex-cell-channels [lte|nr &lt;bandNumber 1-261&gt; &lt;downlinkFreqKhz or UNKNOWN: -1&gt; &lt;downlinkBandwidthKhz or UNKNOWN: 0&gt; &lt;uplinkFreqKhz or UNKNOWN: -1&gt; &lt;uplinkBandwidthKhz or UNKNOWN: 0&gt;] ...
    Sets a list of zero or more cell channels to use for coex calculations. Actual device reported cell channels will be ignored until reset-coex-cell-channels is called.
  reset-coex-cell-channels
    Removes all cell channels set in set-coex-cell-channels and returns to listening on actual device reported cell channels
  get-coex-cell-channels
    Prints the cell channels being used for coex.
  set-connected-score &lt;score&gt;
    Set connected wifi network score (to choose between LTE &amp; Wifi for default route).
    This turns off the active connected scorer (default or external).
    Only works while connected to a wifi network. This score will stay in effect until you call reset-connected-score or the device disconnects from the current network.
    &lt;score&gt; - Integer score should be in the range of 0 - 60
  reset-connected-score
    Turns on the default connected scorer.
    Note: Will clear any external scorer set.
  //（13）打开热点
  start-softap &lt;ssid&gt; (open|wpa2|wpa3|wpa3_transition|owe|owe_transition) &lt;passphrase&gt; [-b 2|5|6|any|bridged|bridged_2_5|bridged_2_6|bridged_5_6] [-x] [-f &lt;int&gt; [&lt;int&gt;]]
    Start softap with provided params
    Note that the shell command doesn't activate internet tethering. In some devices, internet sharing is possible when Wi-Fi STA is also enabled and isassociated to another AP with internet access.
    &lt;ssid&gt; - SSID of the network
    open|wpa2|wpa3|wpa3_transition|owe|owe_transition - Security type of the network.
        - Use 'open', 'owe', 'owe_transition' for networks with no passphrase
        - Use 'wpa2', 'wpa3', 'wpa3_transition' for networks with passphrase
    -b 2|5|6|any|bridged|bridged_2_5|bridged_2_6|bridged_5_6 - select the preferred bands.
        - Use '2' to select 2.4GHz band as the preferred band
        - Use '5' to select 5GHz band as the preferred band
        - Use '6' to select 6GHz band as the preferred band
        - Use 'any' to indicate no band preference
        - Use 'bridged' to indicate bridged AP which enables APs on both 2.4G + 5G
        - Use 'bridged_2_5' to indicate bridged AP which enables APs on both 2.4G + 5G
        - Use 'bridged_2_6' to indicate bridged AP which enables APs on both 2.4G + 6G
        - Use 'bridged_5_6' to indicate bridged AP which enables APs on both 5G + 6G
    Note: If the band option is not provided, 2.4GHz is the preferred band.
          The exact channel is auto-selected by FW unless overridden by force-softap-channel command or '-f &lt;int&gt; &lt;int&gt;' option
    -f &lt;int&gt; &lt;int&gt; - force exact channel frequency for operation channel
    Note: -f &lt;int&gt; &lt;int&gt; - must be the last option
          For example:
          Use '-f 2412' to enable single Soft Ap on 2412
          Use '-f 2412 5745' to enable bridged dual Soft Ap on 2412 and 5745
    -x - Specifies the SSID as hex digits instead of plain text (T and above)
  stop-softap
    Stop softap (hotspot) //（14）关闭热点
  pmksa-flush &lt;networkId&gt;
        - Flush the local PMKSA cache associated with the network id. Use list-networks to retrieve &lt;networkId&gt; for the network
  reload-resources
    Reset the WiFi resources cache which will cause them to be reloaded next time they are accessed. Necessary if overlays are manually modified.
  launch-dialog-simple [-t &lt;title&gt;] [-m &lt;message&gt;] [-l &lt;url&gt; &lt;url_start&gt; &lt;url_end&gt;] [-y &lt;positive_button_text&gt;] [-n &lt;negative_button_text&gt;] [-x &lt;neutral_button_text&gt;] [-c &lt;timeout_millis&gt;]
    Launches a simple dialog and waits up to 15 seconds to print the response.
    -t - Title
    -m - Message
    -l - URL of the message, with the start and end index inside the message
    -y - Positive Button Text
    -n - Negative Button Text
    -x - Neutral Button Text
    -c - Optional timeout in milliseconds
    -s - Use the legacy dialog implementation on the system process
  launch-dialog-p2p-invitation-sent &lt;device_name&gt; &lt;pin&gt; [-i &lt;display_id&gt;]
    Launches a P2P Invitation Sent dialog.
    &lt;device_name&gt; - Name of the device the invitation was sent to
    &lt;pin&gt; - PIN for the invited device to input
  launch-dialog-p2p-invitation-received &lt;device_name&gt; [-p] [-d &lt;pin&gt;] [-i &lt;display_id&gt;] [-c &lt;timeout_millis&gt;]
    Launches a P2P Invitation Received dialog and waits up to 15 seconds to print the response.
    &lt;device_name&gt; - Name of the device sending the invitation
    -p - Show PIN input
    -d - Display PIN &lt;pin&gt;
    -i - Display ID
    -c - Optional timeout in milliseconds
  query-interface &lt;uid&gt; &lt;package_name&gt; STA|AP|AWARE|DIRECT [-new]
    Query whether the specified could be created for the specified UID and package name, and if so - what other interfaces would be destroyed
    -new - query for a new interfaces (otherwise an existing interface is ok
  interface-priority-interactive-mode enable|disable|default
    Enable or disable asking the user when there's an interface priority conflict, |default| implies using the device default behavior.
  set-one-shot-screen-on-delay-ms &lt;delayMs&gt;
    set the delay for the next screen-on connectivity scan in milliseconds.
  set-network-selection-config &lt;enabled|disabled&gt; &lt;enabled|disabled&gt; -a &lt;associated_network_selection_override&gt;
    set whether sufficiency check is enabled for screen off case (first arg), and screen on case (second arg)
    -a - set as one of the int WifiNetworkSelectionConfig.ASSOCIATED_NETWORK_SELECTION_OVERRIDE_ values:
      0 - no override
      1 - override to enabled
      2 - override to disabled
  set-ipreach-disconnect enabled|disabled
    Sets whether CMD_IP_REACHABILITY_LOST events should trigger disconnects.
  get-ipreach-disconnect
    Gets setting of CMD_IP_REACHABILITY_LOST events triggering disconnects.
  take-bugreport
    take bugreport through betterBug. If it failed, take bugreport through bugreport manager.
  get-allowed-channel  //（15）当前设备支持的信道值，热点相关
    get allowed channels in each operation mode from wifiManager if available. Otherwise, it returns from wifiScanner.


C:\Users\As11140&gt;

</code></pre> 
<p>上面标记了15个 可能会用到的场景，其他的场景看不懂，也没怎么用过，有兴趣的可以自己看看。</p> 
<p>整个信息太多了，有时候不好找。</p> 
<p>可以在adb shell 或者设备串口中使用 grep 过滤关键字查看相关信息：</p> 
<pre><code>cmd wifi -h | grep xxx关键字    
</code></pre> 
<h4><a id="2_adb_shell_cmd_wifi__411"></a>2、 adb shell cmd wifi 命令在系统中的具体代码</h4> 
<p>Android cmd wifi 控制和查询wifi命令的控制代码都在 WifiShellCommand.java 里面。</p> 
<p>WifiShellCommand.java 代码位置：</p> 
<pre><code>Android13 或者更新版本的 WifiShellCommand.java 的具体位置：
package\modules\Wifi\service\java\com\android\server\wifi\WifiShellCommand.java
Android11 或者更旧版本的 WifiShellCommand.java 的具体位置：
frameworks\opt\net\wifi\service\java\com\android\server\wifi\WifiShellCommand.java
</code></pre> 
<p>关键代码如下：</p> 
<pre><code>public class WifiShellCommand extends BasicShellCommandHandler {
    @VisibleForTesting
    public static String SHELL_PACKAGE_NAME = "com.android.shell";

    // These don't require root access.
    // However, these do perform permission checks in the corresponding WifiService methods.
    private static final String[] NON_PRIVILEGED_COMMANDS = {//命令汇总
            "add-suggestion",
            "forget-network",
            "get-country-code",
            "help",
            "-h",
            "is-verbose-logging",
            "list-scan-results",
            "list-networks",
            "list-suggestions",
            "remove-suggestion",
            "remove-all-suggestions",
            "reset-connected-score",
            "set-connected-score",
            "set-scan-always-available",
            "set-verbose-logging",
            "set-wifi-enabled",
            "set-passpoint-enabled",
            "set-multi-internet-state",
            "start-scan",
            "start-softap",
            "status",
            "stop-softap",
            "query-interface",
            "interface-priority-interactive-mode",
            "set-one-shot-screen-on-delay-ms",
            "set-network-selection-config",
            "set-ipreach-disconnect",
            "get-ipreach-disconnect",
            "take-bugreport",
            "get-allowed-channel",
    };

    @Override
    public int onCommand(String cmd) {
        // Treat no command as help command.
        if (TextUtils.isEmpty(cmd)) {
            cmd = "help";
        }
        // Explicit exclusion from root permission
        if (ArrayUtils.indexOf(NON_PRIVILEGED_COMMANDS, cmd) == -1) {
            final int uid = Binder.getCallingUid();
            if (uid != Process.ROOT_UID) {
                throw new SecurityException(
                        "Uid " + uid + " does not have access to " + cmd + " wifi command "
                                + "(or such command doesn't exist)");
            }
        }
        final PrintWriter pw = getOutPrintWriter();
        try {
            switch (cmd) {
                case "set-ipreach-disconnect": {
                    boolean enabled = getNextArgRequiredTrueOrFalse("enabled", "disabled");
                    mWifiGlobals.setIpReachabilityDisconnectEnabled(enabled);
                    return 0;
                }
                case "set-wifi-enabled": { //开关wifi
                    boolean enabled = getNextArgRequiredTrueOrFalse("enabled", "disabled");
                    //调用 WifiService.setWifiEnabled 接口开关wifi
                    mWifiService.setWifiEnabled(SHELL_PACKAGE_NAME, enabled);
                    return 0;
                }
                case "list-networks":  //查看已连接或者已保存的wifi列表
                	//获取wifi列表
                    ParceledListSlice&lt;WifiConfiguration&gt; networks =
                            mWifiService.getConfiguredNetworks(SHELL_PACKAGE_NAME, null, false);
                    if (networks == null || networks.getList().isEmpty()) {
                        pw.println("No networks");
                    } else {
                        pw.println("Network Id      SSID                         Security type");
                        for (WifiConfiguration network : networks.getList()) {
                            String securityType = network.getSecurityParamsList().stream()
                                    .map(p -&gt; WifiConfiguration.getSecurityTypeName(
                                                    p.getSecurityType())
                                            + (p.isAddedByAutoUpgrade() ? "^" : ""))
                                    .collect(Collectors.joining("/"));
                            pw.println(String.format("%-12d %-32s %-4s",
                                    network.networkId, WifiInfo.sanitizeSsid(network.SSID),
                                    securityType));
                        }
                    }
                    return 0;
                case ...
            }
        }
    }
    
}
</code></pre> 
<p>上面只展示了set-wifi-enabled 和 list-networks 命令相关代码，</p> 
<p>其他的也是类似的调用WifiService 相关api实现具体功能，部分接口是有用print打印返回的数据。</p> 
<p>代码大概有两千多行,有兴趣的可以看看源码：</p> 
<p>http://aospxref.com/android-13.0.0_r3/xref/packages/modules/Wifi/service/java/com/android/server/wifi/WifiShellCommand.java</p> 
<h4><a id="3svc_wifi_539"></a>3、svc控制 wifi、热点、蓝牙命令</h4> 
<p>svc 主要命令：</p> 
<pre><code>adb shell svc power|wifi|bluetooth|usb|nfc 
</code></pre> 
<p>从上面介绍可以知道，其实只要记住 svc，那么就是提示其他相关命令，然后再输入功能命令，就会显示具体参数介绍。</p> 
<p>svc 功能只能对某个模块开关等基础功能。</p> 
<p>svc详解： <a href="https://blog.csdn.net/wenzhi20102321/article/details/132779708">https://blog.csdn.net/wenzhi20102321/article/details/132779708</a></p> 
<h4><a id="4iw_dev_555"></a>4、iw dev命令</h4> 
<h5><a id="1iw_dev__557"></a>（1）iw dev 示例</h5> 
<p>iw dev 命令比较特殊，这个命令是直接对节点数据进行查询和设置的，不需要经过WifiService那些Java逻辑。</p> 
<pre><code>console:/ # iw dev //查看无线设备信息,和相关节点                                                           
phy#0
        Unnamed/non-netdev interface
                wdev 0x4
                addr c2:f5:35:4f:a3:e0
                type P2P-device
                txpower 31.00 dBm
        Interface wlan1 //热点 节点
                ifindex 17
                wdev 0x2
                addr d2:4e:71:f2:ce:56
                ssid AndroidAP_1026 //热点名称
                type AP
                channel 157 (5785 MHz), width: 80 MHz, center1: 5775 MHz
                txpower 31.00 dBm
        Interface wlan0 //wifi节点
                ifindex 16
                wdev 0x1
                addr c0:f5:35:4f:a3:e0
                ssid xm5G //wifi已连接的名称
                type managed
                channel 157 (5785 MHz), width: 80 MHz, center1: 5775 MHz
                txpower 31.00 dBm
console:/ # sched_stop 
</code></pre> 
<p>这个命令我也不熟悉，是最近几天通过驱动底层开发人员一起调试设备了解到的命令。</p> 
<h5><a id="2wifiwifi_590"></a>（2）通过wifi节点搜索wifi列表</h5> 
<p>比如搜索wifi列表, iw wlan0 scan | grep SSID：</p> 
<pre><code>console:/ # iw wlan0 scan | grep SSID
        SSID: 
        SSID: syrj_5G
                 * SSID List
        SSID: B-LINK-5G_EE7180
        SSID: xm5G
        SSID: ktceb-vpn-5G
        SSID: VPN_5G
        SSID: SYEBSW-5G
        SSID: syrj
                 * SSID List
        SSID: ktceb-vpn-2.4G
        SSID: 
        SSID: SYEBSW-2.4G
console:/ # 
</code></pre> 
<p>如果没有grep SSID会看到很多打印，比如每个wifi的加密情况和其他配置信息。</p> 
<p>实际开发调试中系统有出现过上层接口无法打开wifi的情况（原因：上层调用IWifi接口卡死），</p> 
<p>但是强制up打开 wlan0 后，是直接可以使用iw wlan0 命令搜索到wifi 列表，</p> 
<p>说明内核是正常加载的，后面发现是binder IWifi异常了，是hardware 层的服务无法连接，</p> 
<p>并不是WifiManager到WifiService的 binder异常，</p> 
<p>底层适配修改了 usb_inotify 、ko驱动和相关加载逻辑进行解决。</p> 
<h5><a id="3iw_dev__626"></a>（3）iw dev 主要命令</h5> 
<pre><code>iw 命令后面加上不同的参数，例如：

iw dev interface add 用于添加一个新的接口

iw dev del 用于删除一个接口

iw dev scan 用于扫描可用的无线网络

iw dev support 用于查看设备支持的参数

dev 表示不同的节点名称，比我wifi的 wlan0

请注意，某些命令可能需要root权限才能运行。
</code></pre> 
<p>常用的就是：iw dev del，iw dev scan ，其他命令简单执行了一下，发现返回的提示数据非常多，有点看不懂。</p> 
<h4><a id="5adb_648"></a>5、adb简介及常用命令总结</h4> 
<pre><code>1、启动adb:adb start-server；adb shell start 包名/类名 启动应用
2、查看已经连接的设备：adb devices
3、adb logcat： 打印log信息
4、发送文件到设备：adb push
5、下载文件到电脑：adb pull 手机文件路径 电脑目标路径
6、截屏命令：adb shell screencap /sdcard/screen.png
传出到本地：adb pull /sdcard/screen.png
7、杀死adb：adb kill-server
8、adb连接：adb connect …(ip地址)
9、adb 命令控制：adb shell
10、adb connect/disconnect：通过wifi远程连接手机调试.
11、adb shell am：am即activity manager.
备注：该命令用来执行一些系统动作, 例如启动指定activity, 结束进程, 发送广播, 更改屏幕属性等

12、 adb root：以root身份重新进入adb

13、adb remount刷新文件系统

14、adb pull sdcard/bk100 c:/ 取出bk100文件夹下面的所有文件到c盘根目录

15、adb push c:/log.txt sdcard/ 将c盘下的log文件复制到sdcard根目录

16、adb shell am force-stop 包名 停止应用

17、adb shell am kill 包名 停止应用并杀死进程

18、adb install c:/a.apk安装a.apk到设备

19、adb uninstall 包名 卸载应用

20、adb shell input tap 100,200 点击屏幕x，y坐标

21、adb shell input swipe 250 250 300 300 滑动操作

22、adb shell input keyevent 3 模拟按键,比如home键的keycode=3，back键的keycode=4

23、studio 连接不上夜神模拟器解决方法:进入夜神bin目录——M:\Program Files (x86)\Nox\bin——执行如下命令：
nox_adb.exe connect 127.0.0.1:62001

</code></pre> 
<p>adb简介及常用命令总结详解：</p> 
<p>https://blog.csdn.net/wenzhi20102321/article/details/113487927</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbc00521d0a85949b71595ebcedbcd2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">高考填报志愿三连问，从人格优势分析兴趣和专业</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d1cfae2a3b3697c58b310bc1af6f5f2b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小程序web-view无法打开该页面的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>