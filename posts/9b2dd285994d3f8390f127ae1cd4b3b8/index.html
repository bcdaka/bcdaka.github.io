<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES高级查询Query DSL查询详解、term术语级别查询、全文检索、highlight高亮 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9b2dd285994d3f8390f127ae1cd4b3b8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ES高级查询Query DSL查询详解、term术语级别查询、全文检索、highlight高亮">
  <meta property="og:description" content="文章目录 ES高级查询Query DSLmatch_all返回源数据_source返回指定条数size分页查询from&amp;size指定字段排序sort 术语级别查询term query术语查询terms query多术语查询range query范围查询exists queryids queryprefix query前缀查询wildcard query通配符查询fuzzy query模糊查询 全文检索match query匹配查询multi_match query 多字段查询match_phrase query短语查询query_string querysimple_query_string bool query布尔查询highlight高亮基本使用自定义高亮标签多字段高亮 ES高级查询Query DSL ES中提供了一种强大的检索数据方式,这种检索方式称之为Query DSL（Domain Specified Language 领域专用语言） ,
Query DSL是利用Rest API传递JSON格式的请求体(RequestBody)数据与ES进行交互，这种方式的丰富查询语法让ES检索变得更强大，更简洁。
官网
标准格式如下
GET /索引名/_doc/_search {JOSN请求体} # 也可以省略_doc 简写成下面这种方式 GET /索引名//_search {JOSN请求体} 案例
# 无条件查询，默认返回10条数据 GET /sys_user/_search { &#34;query&#34;: { &#34;match_all&#34;: {} } } 案例数据生成，接下来的案例很多都是操作改索引
# 删除现有索引 DELETE /sys_user # 重新创建索引 指定ik分词器 PUT /sys_user { &#34;settings&#34; : { &#34;index&#34; : { &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T14:18:27+08:00">
    <meta property="article:modified_time" content="2024-08-15T14:18:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES高级查询Query DSL查询详解、term术语级别查询、全文检索、highlight高亮</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#ESQuery_DSL_2" rel="nofollow">ES高级查询Query DSL</a></li><li><ul><li><a href="#match_all_132" rel="nofollow">match_all</a></li><li><ul><li><a href="#_source_155" rel="nofollow">返回源数据_source</a></li><li><a href="#size_201" rel="nofollow">返回指定条数size</a></li><li><a href="#fromsize_224" rel="nofollow">分页查询from&amp;size</a></li><li><a href="#sort_252" rel="nofollow">指定字段排序sort</a></li></ul> 
   </li><li><a href="#_298" rel="nofollow">术语级别查询</a></li><li><ul><li><a href="#term_query_308" rel="nofollow">term query术语查询</a></li><li><a href="#terms_query_418" rel="nofollow">terms query多术语查询</a></li><li><a href="#range_query_447" rel="nofollow">range query范围查询</a></li><li><a href="#exists_query_517" rel="nofollow">exists query</a></li><li><a href="#ids_query_587" rel="nofollow">ids query</a></li><li><a href="#prefix_query_609" rel="nofollow">prefix query前缀查询</a></li><li><a href="#wildcard_query_635" rel="nofollow">wildcard query通配符查询</a></li><li><a href="#fuzzy_query_659" rel="nofollow">fuzzy query模糊查询</a></li></ul> 
   </li><li><a href="#_710" rel="nofollow">全文检索</a></li><li><ul><li><a href="#match_query_722" rel="nofollow">match query匹配查询</a></li><li><a href="#multi_match_query__831" rel="nofollow">multi_match query 多字段查询</a></li><li><a href="#match_phrase_query_857" rel="nofollow">match_phrase query短语查询</a></li><li><a href="#query_string_query_928" rel="nofollow">query_string query</a></li><li><a href="#simple_query_string_981" rel="nofollow">simple_query_string</a></li></ul> 
   </li><li><a href="#bool_query_1027" rel="nofollow">bool query布尔查询</a></li><li><a href="#highlight_1194" rel="nofollow">highlight高亮</a></li><li><ul><li><a href="#_1209" rel="nofollow">基本使用</a></li><li><a href="#_1280" rel="nofollow">自定义高亮标签</a></li><li><a href="#_1316" rel="nofollow">多字段高亮</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="ESQuery_DSL_2"></a>ES高级查询Query DSL</h2> 
<p>ES中提供了一种强大的检索数据方式,这种检索方式称之为Query DSL（Domain Specified Language 领域专用语言） ,</p> 
<p>Query DSL是利用Rest API传递JSON格式的请求体(RequestBody)数据与ES进行交互，这种方式的丰富查询语法让ES检索变得更强大，更简洁。</p> 
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl.html" rel="nofollow">官网</a></p> 
<p>标准格式如下</p> 
<pre><code class="prism language-bash">GET /索引名/_doc/_search <span class="token punctuation">{<!-- --></span>JOSN请求体<span class="token punctuation">}</span>

<span class="token comment"># 也可以省略_doc 简写成下面这种方式</span>
GET /索引名//_search <span class="token punctuation">{<!-- --></span>JOSN请求体<span class="token punctuation">}</span>
</code></pre> 
<p>案例</p> 
<pre><code class="prism language-bash"><span class="token comment"># 无条件查询，默认返回10条数据</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/eb/11/pivbVzfM_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<p>案例数据生成，接下来的案例很多都是操作改索引</p> 
<pre><code class="prism language-bash"><span class="token comment"># 删除现有索引</span>
DELETE /sys_user

<span class="token comment"># 重新创建索引 指定ik分词器</span>
PUT /sys_user
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"index"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"analysis.analyzer.default.type"</span><span class="token builtin class-name">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 创建文档,指定id</span>
PUT /sys_user/_doc/1
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"张三"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州天河公园"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java developer"</span>
<span class="token punctuation">}</span>
PUT /sys_user/_doc/2
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"李四"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">28</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州荔湾大厦"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java assistant"</span>
<span class="token punctuation">}</span>

PUT /sys_user/_doc/3
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"王五"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">26</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山公园"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"php developer"</span>
<span class="token punctuation">}</span>

PUT /sys_user/_doc/4
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"赵六"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">22</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"长沙橘子洲"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"python assistant"</span>
<span class="token punctuation">}</span>

PUT /sys_user/_doc/5
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"张龙"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">19</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"长沙麓谷企业广场"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java architect assistant"</span>
<span class="token punctuation">}</span>    
    
PUT /sys_user/_doc/6
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"赵虎"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">32</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"长沙麓谷兴工国际产业园"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java architect"</span>
<span class="token punctuation">}</span>    

PUT /sys_user/_doc/7
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"李虎"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">32</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州番禺节能科技园"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java architect"</span>
<span class="token punctuation">}</span>

PUT /sys_user/_doc/8
<span class="token punctuation">{<!-- --></span>
<span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"张星"</span>,
<span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
<span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">32</span>,
<span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"武汉东湖高新区未来智汇城"</span>,
<span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"golang developer"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h3><a id="match_all_132"></a>match_all</h3> 
<p>使用<code>match_all</code>，匹配所有文档，默认只会返回10条数据。</p> 
<p>原因：<code>_search</code>查询默认采用的是分页查询，每页记录数size的默认值为10。如果想显示更多数据，指定size</p> 
<pre><code class="prism language-bash"><span class="token comment"># 无条件查询，_search默认返回10条数据</span>
GET /sys_user/_search

<span class="token comment"># 等价于</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="_source_155"></a>返回源数据_source</h4> 
<p><code>_source</code>关键字，是一个数组，在数组中指定用来指定暂时哪些字段，类似于Mysql的<code>select 字段 from table</code> 或MongoDB中的 <code>$project</code>映射</p> 
<pre><code class="prism language-bash"><span class="token comment"># _source关键字的相关操作</span>
<span class="token comment"># 返回指定字段</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"_source"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>,<span class="token string">"age"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>


<span class="token comment">#不查看源数据，仅查看元字段</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"_source"</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>


<span class="token comment"># 只看以a开头的字段</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"_source"</span><span class="token builtin class-name">:</span> <span class="token string">"a*"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="size_201"></a>返回指定条数size</h4> 
<p>size 关键字: 指定查询结果中返回指定条数。 默认返回值10条</p> 
<pre><code class="prism language-bash"><span class="token comment"># 通过size关键字指定返回结果数</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="fromsize_224"></a>分页查询from&amp;size</h4> 
<p>size：显示应该返回的结果数量，默认是 10</p> 
<p>from：显示应该跳过的初始结果数量，默认是 0</p> 
<p>from 关键字用来指定起始返回位置，和size关键字连用可实现分页效果</p> 
<pre><code class="prism language-bash"><span class="token comment"># 通过from + size关键字实现分页</span>
<span class="token comment"># 跳过前面5个文档，共显示两个文档</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token number">5</span>, 
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="sort_252"></a>指定字段排序sort</h4> 
<p>注意：sort排序会让 <code>_score</code>相关性得分失效</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用sort关键字，按age字段降序 排序</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"order"</span><span class="token builtin class-name">:</span> <span class="token string">"desc"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>


<span class="token comment"># sort排序 + from size分页</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_all"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"order"</span><span class="token builtin class-name">:</span> <span class="token string">"desc"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"from"</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
  <span class="token string">"size"</span><span class="token builtin class-name">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h3><a id="_298"></a>术语级别查询</h3> 
<p>术语级别查询（Term-Level Queries）指的是<strong>搜索内容不经过文本分析直接用于文本匹配</strong></p> 
<p>搜索的对象大多是索引的非text类型字段。</p> 
<p><br><br></p> 
<h4><a id="term_query_308"></a>term query术语查询</h4> 
<p>Term查询，对输入不做分词。会将输入作为一个整体，在倒排索引中查找准确的词项，</p> 
<p>术语查询直接返回包含搜索内容的文档，常用来查询索引中某个类型为keyword的文本字段，类似于SQL的“=”查询，使用十分普遍。</p> 
<p><strong>注意</strong>：最好不要在term查询的字段中使用text字段，因为text字段会被分词，这样做既没有意义，还很有可能什么也查不到。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 对bool，日期，数字，结构化的文本可以利用term做精确匹配</span>
<span class="token comment"># term 精确匹配</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"25"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 思考： 查询广州白云是否有数据，为什么？</span>
<span class="token comment"># 没有数据，因为address是text类型，索引数据时会创建倒排索引，而直接用 term 广州白云这个词 倒排索引中不存在所以查询不到数据</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 采用term精确查询, 查询字段映射类型为keyword</span>
<span class="token comment"># 能查询都数据，因为address字段是类型为text 子类型为keyword，会创建一个完整address字段内容在倒排索引中</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address.keyword"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山公园"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<p>在ES中，Term查询，对输入不做分词。会将输入作为一个整体，在倒排索引中查找准确的词项，并且使用相关度算分公式为每个包含该词项的文档进行相关度算分。</p> 
<p>可以通过 <code>constant_score</code> 将查询转换成一个<code> Filtering</code>，避免算分，并利用缓存，提高性能。</p> 
<ul><li>将Query 转成 Filter，忽略TF-IDF计算，避免相关性算分的开销</li><li>Filter可以有效利用缓存</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 使用constant_score + filter 避免相关性算分</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"constant_score"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"filter"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"address.keyword"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山公园"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<p>term处理多值字段时，term查询是包含，不是等于。</p> 
<pre><code class="prism language-bash">POST /employee/_bulk
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_id"</span>:1<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"小明"</span>,<span class="token string">"interest"</span>:<span class="token punctuation">[</span><span class="token string">"跑步"</span>,<span class="token string">"篮球"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_id"</span>:2<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"小红"</span>,<span class="token string">"interest"</span>:<span class="token punctuation">[</span><span class="token string">"跳舞"</span>,<span class="token string">"画画"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_id"</span>:3<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token builtin class-name">:</span><span class="token string">"小丽"</span>,<span class="token string">"interest"</span>:<span class="token punctuation">[</span><span class="token string">"跳舞"</span>,<span class="token string">"唱歌"</span>,<span class="token string">"跑步"</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/44/68/lZXAj9FO_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h4><a id="terms_query_418"></a>terms query多术语查询</h4> 
<p><code>terms</code> 用于指定字段上匹配多个词项，这里会精确匹配指定字段中包含的任何一个词项</p> 
<pre><code class="prism language-bash"><span class="token comment"># trems 多术语匹配</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"terms"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"remark.keyword"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">"java developer"</span>,
        <span class="token string">"java assistant"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="range_query_447"></a>range query范围查询</h4> 
<p>关键字</p> 
<ul><li>range 范围关键字</li><li>gte 大于等于</li><li>lte 小于等于</li><li>gt 大于</li><li>lt 小于</li><li>now 当前时间</li></ul> 
<p><br><br></p> 
<pre><code class="prism language-bash"><span class="token comment"># 查询age在[18,25]之间的文档，并对结果做一个降序排序</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"range"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"gte"</span><span class="token builtin class-name">:</span> <span class="token number">18</span>,
        <span class="token string">"lte"</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>, 
  <span class="token string">"sort"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"order"</span><span class="token builtin class-name">:</span> <span class="token string">"desc"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>日期范围的比较 可以使用<code>now</code>表示当前时间</p> 
<pre><code class="prism language-bash"><span class="token comment"># 日期范围的比较</span>
PUT /product/_bulk
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"productId"</span><span class="token builtin class-name">:</span> <span class="token string">"XHDK-1293"</span>,<span class="token string">"price"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>,<span class="token string">"date"</span><span class="token builtin class-name">:</span> <span class="token string">"2022-01-01"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"_id"</span><span class="token builtin class-name">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"productId"</span><span class="token builtin class-name">:</span> <span class="token string">"XHDK-3566"</span>,<span class="token string">"price"</span><span class="token builtin class-name">:</span> <span class="token number">200</span>,<span class="token string">"date"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-01-01"</span><span class="token punctuation">}</span>

<span class="token comment"># 当前时间 - 2年    当然你也可以直接写"gte": "2022-08-12"</span>
GET /product/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"range"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"date"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"gte"</span><span class="token builtin class-name">:</span> <span class="token string">"now-2y"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="exists_query_517"></a>exists query</h4> 
<p>使用<code>exists</code>关键字查询，查询文档中所有存在该字段的文档</p> 
<p>字段不存在 和 字段值为null的文档都查询不出来</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查询所有存在name字段的文档数据</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"exists"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"field"</span><span class="token builtin class-name">:</span> <span class="token string">"name"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 索引一个文档，没有name字段</span>
POST /sys_user/_doc
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
  <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州天河公园111"</span>,
  <span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java developer111"</span>
<span class="token punctuation">}</span>

<span class="token comment"># 索引一个文档，name字段的值为null</span>
POST /sys_user/_doc
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span> null,
  <span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
  <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州天河公园222"</span>,
  <span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java developer222"</span>
<span class="token punctuation">}</span>

<span class="token comment"># 索引一个文档，name字段的值为""</span>
POST /sys_user/_doc
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
  <span class="token string">"sex"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">"age"</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
  <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州天河公园333"</span>,
  <span class="token string">"remark"</span><span class="token builtin class-name">:</span> <span class="token string">"java developer333"</span>
<span class="token punctuation">}</span>

<span class="token comment"># 最终只能查询到  name字段的值为"" 的文档， name字段不存在 和 name值为null的文档都查询不出来</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"exists"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"field"</span><span class="token builtin class-name">:</span> <span class="token string">"name"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="ids_query_587"></a>ids query</h4> 
<p><code>ids</code>关键字，值为数组类型，可以根据一组id查询文档数据</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用ids关键字，查询一组id对应的文档</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"ids"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"values"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token number">1,2</span>,3<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="prefix_query_609"></a>prefix query前缀查询</h4> 
<p><strong>直接根据传入的前缀去倒排索引中进行匹配，判断倒排索引中的每个term是否以所指定的前缀开头</strong>。它不会分析要搜索字符串，传入的前缀就是想要查找的前缀</p> 
<p>默认状态下，<strong>前缀查询不做相关性分数计算</strong>，它只是将所有匹配的文档返回，然后赋予所有相关分数值为1。它的行为更像是一个过滤器而不是查询。两者实际的区别就是过滤器是可以被缓存的，而前缀查询不行。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用prefilx前缀匹配查询</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"prefix"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"广州"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="wildcard_query_635"></a>wildcard query通配符查询</h4> 
<p>工作原理和prefix相同，只不过它不是只比较开头，它能支持更为复杂的匹配模式。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用wildcard通配符匹配</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"wildcard"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"*白*"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="fuzzy_query_659"></a>fuzzy query模糊查询</h4> 
<p>使用fuzziness属性来进行模糊查询，从而达到搜索有错别字的情形。</p> 
<p>fuzzy 查询会用到两个很重要的参数，fuzziness，prefix_length</p> 
<ul><li> <p>fuzziness</p> <p>对输入的关键字进行几次操作可以和倒排索引中的term词匹配。</p> <p>新增一个字符，删除一个字符，修改一个字符，每次操作可以记做编辑距离为1;</p> <p>该参数默认值为0，即不开启模糊查询; fuzzy 模糊查询 最大模糊错误必须在0-2之间</p> </li><li> <p>prefix_length</p> <p>输入的关键字前面几个字符必须要和倒排索引的term词匹配，关键字前面几个字符不允许写错</p> <p>默认值为0</p> </li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 使用fuzzy关键字进行模糊查询</span>
<span class="token comment"># 允许一个错别字，但是第一个字不能是错别字</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"fuzzy"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"白晕山"</span>,
        <span class="token string">"fuzziness"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
        <span class="token string">"prefix_length"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h3><a id="_710"></a>全文检索</h3> 
<p>全文检索查询旨在基于相关性搜索和匹配文本数据。</p> 
<p>这些查询会对输入的文本进行分析，将其拆分为词项（单个单词），并执行诸如分词、词干处理和标准化等操作。</p> 
<p>以相关性为基础进行搜索和匹配。全文检索查询使用相关性算法来确定文档与查询的匹配程度，并按照相关性进行排序。相关性可以基于词项的频率、权重和其他因素来计算。</p> 
<p><br><br></p> 
<h4><a id="match_query_722"></a>match query匹配查询</h4> 
<p>match在匹配时会对所查找的关键词进行分词，然后按分词匹配查找。</p> 
<p>match支持以下参数：</p> 
<ul><li> <p>query : 指定匹配的值</p> </li><li> <p>operator : 匹配条件类型</p> 
  <ul><li>and : 条件分词后都要匹配</li><li>or : 条件分词后有一个匹配即可(默认)</li></ul> </li><li> <p>minmum_should_match : 最低匹配度，即条件在倒排索引中最低的匹配度</p> </li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># 下面两种写法一样，两种写法都是operator分词后or的效果</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 如果只有关键词需要指定，那么match关键词下的query参数就可以省略</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 分词后 and的结果</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山"</span>,
        <span class="token string">"operator"</span><span class="token builtin class-name">:</span> <span class="token string">"and"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 如果分词后是or操作，我们也可以添加minmum_should_match 来指定最低匹配度</span>
<span class="token comment"># 至少要匹配两个分词</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山公园"</span>,
        <span class="token string">"operator"</span><span class="token builtin class-name">:</span> <span class="token string">"or"</span>,
        <span class="token string">"minimum_should_match"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<p>对于match查询，其底层逻辑的概述：</p> 
<ol><li>分词：首先，输入的查询文本会被分词器进行分词。分词器会将文本拆分成一个个词项（terms），如单词、短语或特定字符。分词器通常根据特定的语言规则和配置进行操作。</li><li>倒排索引：ES使用倒排索引来加速搜索过程。倒排索引是一种数据结构，它将词项映射到包含这些词项的文档。每个词项都有一个对应的倒排列表，其中包含了包含该词项的所有文档的引用。</li><li>匹配计算：一旦查询被分词，ES将根据查询的类型和参数计算文档与查询的匹配度。对于match查询，ES将比较查询的词项与倒排索引中的词项，并计算文档的相关性得分。相关性得分衡量了文档与查询的匹配程度。</li><li>结果返回：根据相关性得分，ES将返回最匹配的文档作为搜索结果。搜索结果通常按照相关性得分进行排序，以便最相关的文档排在前面。</li></ol> 
<p><img src="https://images2.imgbox.com/78/ea/w3xUNXjT_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<p><img src="https://images2.imgbox.com/58/ee/eDzWKEI8_o.png" alt="在这里插入图片描述"></p> 
<p><br><br><br> <img src="https://images2.imgbox.com/27/d2/z4W17Bj1_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h4><a id="multi_match_query__831"></a>multi_match query 多字段查询</h4> 
<p>让查询关键词在文档内的多个字段中进行查询</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用multi_match，让输入的关键词在多个字段中进行查找匹配</span>
<span class="token comment"># 这其中也有 operator  minimum_should_match 这些参数</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"multi_match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"长沙赵六"</span>,
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>, <span class="token string">"address"</span><span class="token punctuation">]</span>,
      <span class="token string">"operator"</span><span class="token builtin class-name">:</span> <span class="token string">"or"</span>,
      <span class="token string">"minimum_should_match"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="match_phrase_query_857"></a>match_phrase query短语查询</h4> 
<p>对搜索文本进行分词，再去倒排索引找每个分词，并<strong>要求分词相邻</strong>。可以通过<code>slop</code>参数设置允许分词之间出现的最大间隔距离</p> 
<p>我们先来使用分词器来看看一个文本是如何分词的</p> 
<pre><code class="prism language-bash">GET _analyze
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"analyzer"</span><span class="token builtin class-name">:</span> <span class="token string">"ik_max_word"</span>,
  <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e8/43/Hyk5cvaZ_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<p>那么我们现在输入文本<code>广州白云山</code>应该是能查询到数据，因为这两个分词是相邻的，如果输入文本<code>广州白云</code>应该是查询不到数据，因为这两个分词是不相邻的</p> 
<pre><code class="prism language-bash"><span class="token comment"># 能查询到数据，因为广州 白云山 这两个分词是相邻的，</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_phrase"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云山"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 查询不到数据，因为 广州 白云  这两个分词是不相邻</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_phrase"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># slop参数设置允许分词之间出现的最大间隔距离</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match_phrase"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"address"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州白云"</span>,
        <span class="token string">"slop"</span><span class="token builtin class-name">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/df/JRb2mjgb_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h4><a id="query_string_query_928"></a>query_string query</h4> 
<p>对输入的文本在文档中所有字段进行匹配搜索</p> 
<p>允许我们在单个查询字符串中指定AND | OR | NOT条件，必须大写</p> 
<p>它也支持单字段查询和多字段查询，只不过这些功能我们通过match、multi_match也能实现</p> 
<pre><code class="prism language-bash"><span class="token comment"># 未指定字段查询，查询文档中的所有字段的值</span>
<span class="token comment"># AND必须大写 文档中必须包含这两个分词才能查询出来</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"赵六 AND 橘子洲"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 指定单字段   添加default_field参数</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"default_field"</span><span class="token builtin class-name">:</span> <span class="token string">"address"</span>, 
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"赵六 OR 橘子洲"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 指定多字段  添加</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>, <span class="token string">"address"</span><span class="token punctuation">]</span>, 
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"张三 OR (赵六 AND 橘子洲)"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h4><a id="simple_query_string_981"></a>simple_query_string</h4> 
<p>类似于query_string ，但是会忽略错误的语法，同时只支持部分查询语法，不支持AND OR NOT ，如果存在AND这些会当作普通字符串处理。</p> 
<p>支持部分逻辑：</p> 
<ul><li><code>+</code>代替AND</li><li><code>|</code>代替OR</li><li><code>-</code>代替NOT</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># simple_query_string 默认的operator是OR</span>
GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"simple_query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>,<span class="token string">"address"</span><span class="token punctuation">]</span>,
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州公园"</span>,
      <span class="token string">"default_operator"</span><span class="token builtin class-name">:</span> <span class="token string">"AND"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

GET /sys_user/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"simple_query_string"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>,<span class="token string">"address"</span><span class="token punctuation">]</span>,
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"广州 + 公园"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<h3><a id="bool_query_1027"></a>bool query布尔查询</h3> 
<ul><li> <p>搜索上下文query context</p> <p>需计算每个文档与搜索条件相关性得分，有一定性能开销，带文本分析的全文检索查询语句适合放在搜索上下文中</p> </li><li> <p>过滤上下文filter context</p> <p>只判断搜索条件跟文档是否匹配，不计算相关性得分。可以使用缓存加快响应速度，术语级别查询是否放在过滤上下文中</p> </li></ul> 
<p><br><br></p> 
<table><thead><tr><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>must</td><td>可包含多个查询条件，每个条件均满足的文档才能被搜索到，每次查询需要计算相关度得分，属于搜索上下文</td></tr><tr><td>should</td><td>可包含多个查询条件，不存在must和fiter条件时，至少要满足多个查询条件中的一个，文档才能被搜索到，否则需满足的条件数量不受限制,匹配到的查询越多相关度越高，也属于搜索上下文</td></tr><tr><td>filter</td><td>可包含多个过滤条件，每个条件均满足的文档才能被搜索到，每个过滤条件不计算相关度得分，结果在一定条件下会被缓存， 属于过滤上下文</td></tr><tr><td>must_not</td><td>可包含多个过滤条件，每个条件均不满足的文档才能被搜索到，每个过滤条件不计算相关度得分，结果在一定条件下会被缓存， 属于过滤上下文</td></tr></tbody></table> 
<p><br><br></p> 
<p>案例</p> 
<p>生成案例数据</p> 
<pre><code class="prism language-bash">PUT /books
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"number_of_replicas"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">"number_of_shards"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"mappings"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"long"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
        <span class="token string">"analyzer"</span><span class="token builtin class-name">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"language"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"author"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"keyword"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"price"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"double"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"publish_time"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"date"</span>,
        <span class="token string">"format"</span><span class="token builtin class-name">:</span> <span class="token string">"yyy-MM-dd"</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,
        <span class="token string">"analyzer"</span><span class="token builtin class-name">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

POST /_bulk
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_index"</span><span class="token builtin class-name">:</span><span class="token string">"books"</span>,<span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"1"</span>, <span class="token string">"title"</span><span class="token builtin class-name">:</span><span class="token string">"Java编程思想"</span>, <span class="token string">"language"</span><span class="token builtin class-name">:</span><span class="token string">"java"</span>, <span class="token string">"author"</span><span class="token builtin class-name">:</span><span class="token string">"Bruce Eckel"</span>, <span class="token string">"price"</span>:70.20, <span class="token string">"publish_time"</span><span class="token builtin class-name">:</span><span class="token string">"2007-10-01"</span>, <span class="token string">"description"</span><span class="token builtin class-name">:</span><span class="token string">"Java学习必读经典，殿堂级著作！赢得了全球程序员的广泛赞誉。"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_index"</span><span class="token builtin class-name">:</span><span class="token string">"books"</span>,<span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span>,<span class="token string">"title"</span><span class="token builtin class-name">:</span><span class="token string">"Java程序性能优化"</span>,<span class="token string">"language"</span><span class="token builtin class-name">:</span><span class="token string">"java"</span>,<span class="token string">"author"</span><span class="token builtin class-name">:</span><span class="token string">"葛一鸣"</span>,<span class="token string">"price"</span>:46.5,<span class="token string">"publish_time"</span><span class="token builtin class-name">:</span><span class="token string">"2012-08-01"</span>,<span class="token string">"description"</span><span class="token builtin class-name">:</span><span class="token string">"让你的Java程序更快、更稳定。深入剖析软件设计层面、代码层面、JVM虚拟机层面的优化方法"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_index"</span><span class="token builtin class-name">:</span><span class="token string">"books"</span>,<span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"3"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"3"</span>,<span class="token string">"title"</span><span class="token builtin class-name">:</span><span class="token string">"Python科学计算"</span>,<span class="token string">"language"</span><span class="token builtin class-name">:</span><span class="token string">"python"</span>,<span class="token string">"author"</span><span class="token builtin class-name">:</span><span class="token string">"张若愚"</span>,<span class="token string">"price"</span>:81.4,<span class="token string">"publish_time"</span><span class="token builtin class-name">:</span><span class="token string">"2016-05-01"</span>,<span class="token string">"description"</span><span class="token builtin class-name">:</span><span class="token string">"零基础学python，光盘中作者独家整合开发winPython运行环境，涵盖了Python各个扩展库"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_index"</span><span class="token builtin class-name">:</span><span class="token string">"books"</span>,<span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"4"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"4"</span>, <span class="token string">"title"</span><span class="token builtin class-name">:</span><span class="token string">"Python基础教程"</span>, <span class="token string">"language"</span><span class="token builtin class-name">:</span><span class="token string">"python"</span>, <span class="token string">"author"</span><span class="token builtin class-name">:</span><span class="token string">"Helant"</span>, <span class="token string">"price"</span>:54.50, <span class="token string">"publish_time"</span><span class="token builtin class-name">:</span><span class="token string">"2014-03-01"</span>, <span class="token string">"description"</span><span class="token builtin class-name">:</span><span class="token string">"经典的Python入门教程，层次鲜明，结构严谨，内容翔实"</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"index"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"_index"</span><span class="token builtin class-name">:</span><span class="token string">"books"</span>,<span class="token string">"_id"</span><span class="token builtin class-name">:</span><span class="token string">"5"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token builtin class-name">:</span><span class="token string">"5"</span>,<span class="token string">"title"</span><span class="token builtin class-name">:</span><span class="token string">"JavaScript高级程序设计"</span>,<span class="token string">"language"</span><span class="token builtin class-name">:</span><span class="token string">"javascript"</span>,<span class="token string">"author"</span><span class="token builtin class-name">:</span><span class="token string">"Nicholas C. Zakas"</span>,<span class="token string">"price"</span>:66.4,<span class="token string">"publish_time"</span><span class="token builtin class-name">:</span><span class="token string">"2012-10-01"</span>,<span class="token string">"description"</span><span class="token builtin class-name">:</span><span class="token string">"JavaScript技术经典名著"</span><span class="token punctuation">}</span>
</code></pre> 
<p>bool 查询案例</p> 
<pre><code class="prism language-bash"><span class="token comment"># 使用must类型，需满足所有查询条件，属于搜索上下文</span>
GET /books/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"must"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"Java编程"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"性能优化"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment"># 使用 should 满足任意一个查询条件即可</span>
<span class="token comment"># 通过 minimum_should_match 参数指定需要满足条件的个数</span>
GET /books/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"should"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"title"</span><span class="token builtin class-name">:</span> <span class="token string">"java编程"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"性能优化"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>,
      <span class="token string">"minimum_should_match"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment"># 使用 filter 需满足所有查询条件</span>
GET /books/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"bool"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"filter"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"range"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"price"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
              <span class="token string">"gte"</span><span class="token builtin class-name">:</span> <span class="token number">20</span>,
              <span class="token string">"lte"</span><span class="token builtin class-name">:</span> <span class="token number">100</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        <span class="token punctuation">{<!-- --></span>
          <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"language"</span><span class="token builtin class-name">:</span> <span class="token string">"java"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<p><img src="https://images2.imgbox.com/6f/92/ZBPdBUva_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1a/b2/YBRGS4Uu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1d/b0/cPQiH5Ow_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h3><a id="highlight_1194"></a>highlight高亮</h3> 
<p>highlight 关键字: 可以让符合条件的文档中的关键词高亮。</p> 
<p>highlight相关属性：</p> 
<ul><li>pre_tags 前缀标签</li><li>post_tags 后缀标签</li><li>tags_schema 设置为styled可以使用内置高亮样式</li><li>require_field_match 多字段高亮需要设置为false</li></ul> 
<p><br><br></p> 
<h4><a id="_1209"></a>基本使用</h4> 
<p>示例数据</p> 
<pre><code class="prism language-bash"><span class="token comment">#指定ik分词器</span>
PUT /products
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"settings"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"index"</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
          <span class="token string">"analysis.analyzer.default.type"</span><span class="token builtin class-name">:</span> <span class="token string">"ik_max_word"</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

PUT /products/_doc/1
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"proId"</span> <span class="token builtin class-name">:</span> <span class="token string">"2"</span>,
  <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"牛仔男外套"</span>,
  <span class="token string">"desc"</span> <span class="token builtin class-name">:</span> <span class="token string">"牛仔外套男装春季衣服男春装夹克修身休闲男生潮牌工装潮流头号青年春秋棒球服男 7705浅蓝常规 XL"</span>,
  <span class="token string">"timestamp"</span> <span class="token builtin class-name">:</span> <span class="token number">1576313264451</span>,
  <span class="token string">"createTime"</span> <span class="token builtin class-name">:</span> <span class="token string">"2019-12-13 12:56:56"</span>
<span class="token punctuation">}</span>

PUT /products/_doc/2
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"proId"</span> <span class="token builtin class-name">:</span> <span class="token string">"6"</span>,
  <span class="token string">"name"</span> <span class="token builtin class-name">:</span> <span class="token string">"HLA海澜之家牛仔裤男"</span>,
  <span class="token string">"desc"</span> <span class="token builtin class-name">:</span> <span class="token string">"HLA海澜之家牛仔裤男2019时尚有型舒适HKNAD3E109A 牛仔蓝(A9)175/82A(32)"</span>,
  <span class="token string">"timestamp"</span> <span class="token builtin class-name">:</span> <span class="token number">1576314265571</span>,
  <span class="token string">"createTime"</span> <span class="token builtin class-name">:</span> <span class="token string">"2019-12-18 15:56:56"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><br><br></p> 
<p>测试</p> 
<pre><code class="prism language-bash">GET /products/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"term"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"牛仔"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"highlight"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"*"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c6/93/sCjc4sOe_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h4><a id="_1280"></a>自定义高亮标签</h4> 
<p>可以在highlight中使用<code>pre_tags</code>和<code>post_tags</code></p> 
<pre><code class="prism language-bash">GET /products/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"multi_match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token string">"牛仔"</span>,
      <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"name"</span>,<span class="token string">"desc"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"highlight"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"pre_tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;span style='color:red'&gt;"</span><span class="token punctuation">]</span>, 
    <span class="token string">"post_tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;/span&gt;"</span><span class="token punctuation">]</span>, 
    <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"*"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ea/ed/Q6oUrg7u_o.png" alt="在这里插入图片描述"></p> 
<p><br><br></p> 
<h4><a id="_1316"></a>多字段高亮</h4> 
<p>之前的案例中，都是查询匹配哪些字段，highlight高亮标签中才有这些字段数据。我们也可以指定多字段都可以有高亮数据</p> 
<p>使用多字段高亮就需要把<code>require_field_match </code>参数的值设置为false</p> 
<pre><code class="prism language-bash"><span class="token comment"># 多字段高亮</span>
<span class="token comment"># require_field_match属性设置为false 在fields中指定多个字段</span>
GET /products/_search
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"query"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"match"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"牛仔"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">"highlight"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"pre_tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;span style='color:red'&gt;"</span><span class="token punctuation">]</span>, 
    <span class="token string">"post_tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"&lt;/span&gt;"</span><span class="token punctuation">]</span>, 
    <span class="token string">"require_field_match"</span><span class="token builtin class-name">:</span> <span class="token string">"false"</span>, 
    <span class="token string">"fields"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,
      <span class="token string">"desc"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/ee/OwRZSnbH_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7e4b4f9c107c511df47c2fc293becac5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 用户管理和权限分配</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5b0f157f4b34b6890ac9b8cfe866066/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电脑如何录屏？三款电脑录屏工具分享</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>