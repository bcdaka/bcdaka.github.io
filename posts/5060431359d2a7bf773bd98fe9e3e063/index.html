<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Golang反射 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5060431359d2a7bf773bd98fe9e3e063/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Golang反射">
  <meta property="og:description" content="文章目录 基本介绍reflect包reflect.Typereflect.Valuereflect.Kind具体类型、空接口与reflect.Value的相互转换 反射应用场景修改变量的值访问结构体的字段信息调用变量所绑定的方法实现函数适配器创建任意类型的变量 基本介绍 基本介绍
在Go中，反射（reflection）是一种机制，其允许程序在运行时检查并操作变量、类型和结构的信息，而不需要提前知道它们的具体定义，使得代码更加灵活和通用。反射通常用于动态获取获取类型信息、动态创建对象、动态调用函数、动态修改对象等，在实现反射时需要用到reflect包。需要注意的是，虽然反射的功能强大，但由于其使用了运行时的类型检查和动态调用，在性能上可能会有一定的开销，因此在性能敏感的场景中，应该尽量避免过度依赖反射来实现常规的编程任务。 reflect包 reflect.Type reflect.Type
reflect.Type是reflect包中的一个接口类型，用于表示任意变量的类型信息。通过reflect包中的TypeOf函数，可以获取指定变量的类型信息。 reflect.TypeOf函数的函数原型如下：
func TypeOf(i interface{}) Type reflect.Type接口中常用的方法如下：
方法名功能Kind获取该类型对应的KindSize获取该类型的大小Elem获取该类型的元素的TypeNumField获取结构体类型的字段数NumMethod获取该类型所绑定的方法数Field获取结构体类型的第i个字段的信息Method获取该类型所绑定的第i个方法的信息FieldByName获取结构体类型的字段中，指定字段名的字段信息MethodByName获取该类型所绑定的方法中，指定方法名的方法信息NumIn获取函数/方法类型的参数个数In获取函数/方法类型的第i个参数的TypeNumOut获取函数/方法类型的返回值个数Out获取函数/方法类型的第i个返回值的Type 说明一下：
reflect.Type接口中的方法不需要用户手动实现，这些方法由反射系统在运行时为每个类型自动生成。reflect.Type接口中的方法不是对所有类型都能使用，每个方法都有其特定的适用范围和前提条件，如果在不满足调用条件的情况下调用了某个方法，则会触发panic异常。比如Elem方法只适用于数组、channel、map、指针和切片类型，NumField和Field方法只适用于结构体类型，NumIn、In、NumOut和Out方法只适用于函数或方法类型。 字段信息
通过reflect.Type接口的Field或FieldByName方法，能够获取结构体中某个字段的字段信息，获取到的字段信息通过StructField结构体进行描述。StructField结构体的定义如下：
type StructField struct { Name string // field name PkgPath string // package path Type Type // field type Tag StructTag // field tag string Offset uintptr // offset within struct, in bytes Index []int // index sequence for Type.FieldByIndex Anonymous bool // is an embedded field } 字段说明：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-31T20:05:40+08:00">
    <meta property="article:modified_time" content="2024-05-31T20:05:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Golang反射</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">基本介绍</a></li><li><a href="#reflect_9" rel="nofollow">reflect包</a></li><li><ul><li><a href="#reflectType_10" rel="nofollow">reflect.Type</a></li><li><a href="#reflectValue_96" rel="nofollow">reflect.Value</a></li><li><a href="#reflectKind_143" rel="nofollow">reflect.Kind</a></li><li><a href="#reflectValue_191" rel="nofollow">具体类型、空接口与reflect.Value的相互转换</a></li></ul> 
  </li><li><a href="#_247" rel="nofollow">反射应用场景</a></li><li><ul><li><a href="#_248" rel="nofollow">修改变量的值</a></li><li><a href="#_291" rel="nofollow">访问结构体的字段信息</a></li><li><a href="#_351" rel="nofollow">调用变量所绑定的方法</a></li><li><a href="#_438" rel="nofollow">实现函数适配器</a></li><li><a href="#_503" rel="nofollow">创建任意类型的变量</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>基本介绍</h2> 
<blockquote> 
 <p>基本介绍</p> 
</blockquote> 
<ul><li>在Go中，反射（reflection）是一种机制，其允许程序在运行时检查并操作变量、类型和结构的信息，而不需要提前知道它们的具体定义，使得代码更加灵活和通用。</li><li>反射通常用于动态获取获取类型信息、动态创建对象、动态调用函数、动态修改对象等，在实现反射时需要用到reflect包。</li><li>需要注意的是，虽然反射的功能强大，但由于其使用了运行时的类型检查和动态调用，在性能上可能会有一定的开销，因此在性能敏感的场景中，应该尽量避免过度依赖反射来实现常规的编程任务。</li></ul> 
<h2><a id="reflect_9"></a>reflect包</h2> 
<h3><a id="reflectType_10"></a>reflect.Type</h3> 
<blockquote> 
 <p>reflect.Type</p> 
</blockquote> 
<ul><li>reflect.Type是reflect包中的一个接口类型，用于表示任意变量的类型信息。</li><li>通过reflect包中的TypeOf函数，可以获取指定变量的类型信息。</li></ul> 
<p>reflect.TypeOf函数的函数原型如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">TypeOf</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> Type
</code></pre> 
<p>reflect.Type接口中常用的方法如下：</p> 
<table><thead><tr><th>方法名</th><th>功能</th></tr></thead><tbody><tr><td>Kind</td><td>获取该类型对应的Kind</td></tr><tr><td>Size</td><td>获取该类型的大小</td></tr><tr><td>Elem</td><td>获取该类型的元素的Type</td></tr><tr><td>NumField</td><td>获取结构体类型的字段数</td></tr><tr><td>NumMethod</td><td>获取该类型所绑定的方法数</td></tr><tr><td>Field</td><td>获取结构体类型的第i个字段的信息</td></tr><tr><td>Method</td><td>获取该类型所绑定的第i个方法的信息</td></tr><tr><td>FieldByName</td><td>获取结构体类型的字段中，指定字段名的字段信息</td></tr><tr><td>MethodByName</td><td>获取该类型所绑定的方法中，指定方法名的方法信息</td></tr><tr><td>NumIn</td><td>获取函数/方法类型的参数个数</td></tr><tr><td>In</td><td>获取函数/方法类型的第i个参数的Type</td></tr><tr><td>NumOut</td><td>获取函数/方法类型的返回值个数</td></tr><tr><td>Out</td><td>获取函数/方法类型的第i个返回值的Type</td></tr></tbody></table> 
<p><strong>说明一下：</strong></p> 
<ul><li>reflect.Type接口中的方法不需要用户手动实现，这些方法由反射系统在运行时为每个类型自动生成。</li><li>reflect.Type接口中的方法不是对所有类型都能使用，每个方法都有其特定的适用范围和前提条件，如果在不满足调用条件的情况下调用了某个方法，则会触发panic异常。比如Elem方法只适用于数组、channel、map、指针和切片类型，NumField和Field方法只适用于结构体类型，NumIn、In、NumOut和Out方法只适用于函数或方法类型。</li></ul> 
<blockquote> 
 <p>字段信息</p> 
</blockquote> 
<p>通过reflect.Type接口的Field或FieldByName方法，能够获取结构体中某个字段的字段信息，获取到的字段信息通过StructField结构体进行描述。StructField结构体的定义如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> StructField <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>    <span class="token comment">// field name</span>
	PkgPath <span class="token builtin">string</span> <span class="token comment">// package path</span>

	Type      Type      <span class="token comment">// field type</span>
	Tag       StructTag <span class="token comment">// field tag string</span>
	Offset    <span class="token builtin">uintptr</span>   <span class="token comment">// offset within struct, in bytes</span>
	Index     <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>     <span class="token comment">// index sequence for Type.FieldByIndex</span>
	Anonymous <span class="token builtin">bool</span>      <span class="token comment">// is an embedded field</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>字段说明：</strong></p> 
<ul><li>Name：表示该字段的名称。</li><li>PkgPath：表示该字段所在的包路径，对于可导出的字段，PkgPath为空字符串。</li><li>Type：表示该字段对应的reflect.Type。</li><li>Tag：表示该字段的Tag标签信息。</li><li>Offset：表示该字段在结构体中的偏移量。</li><li>Index：表示该字段的索引序列。</li><li>Anonymous：表示该字段是否为匿名字段。</li></ul> 
<blockquote> 
 <p>方法信息</p> 
</blockquote> 
<p>通过reflect.Type接口的Method或MethodByName方法，能够获取对应类型所绑定的某个方法的方法信息，获取到的方法信息通过Method结构体进行描述。Method结构体的定义如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> Method <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>    <span class="token comment">// method name</span>
	PkgPath <span class="token builtin">string</span> <span class="token comment">// package path</span>

	Type  Type  <span class="token comment">// method type</span>
	Func  Value <span class="token comment">// func with receiver as first argument</span>
	Index <span class="token builtin">int</span>   <span class="token comment">// index for Type.Method</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>字段说明：</strong></p> 
<ul><li>Name：表示该方法的名称。</li><li>PkgPath：表示该方法所在的包路径，对于可导出的方法，PkgPath为空字符串。</li><li>Type：表示该方法对应的reflect.Type。</li><li>Func：表示该方法对应的reflect.Value。</li><li>Index：表示该方法在对应类型的方法集中的索引。</li></ul> 
<h3><a id="reflectValue_96"></a>reflect.Value</h3> 
<blockquote> 
 <p>reflect.Value</p> 
</blockquote> 
<ul><li>reflect.Value是reflect包中的一个类型，用于表示任意变量的值。</li><li>通过reflect包中的ValueOf函数，可以获取持有指定变量的Value。</li><li>通过reflect包中的New函数，可以创建指定类型的变量，并获取持有指向该变量的指针的Value。</li></ul> 
<p>reflect.ValueOf函数的函数原型如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">ValueOf</span><span class="token punctuation">(</span>i <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> Value
<span class="token keyword">func</span> <span class="token function">New</span><span class="token punctuation">(</span>typ Type<span class="token punctuation">)</span> Value
</code></pre> 
<p>reflect.Value类型常用的方法如下：</p> 
<table><thead><tr><th>方法名</th><th>功能</th></tr></thead><tbody><tr><td>Kind</td><td>获取所持有的值对应的Kind</td></tr><tr><td>Type</td><td>获取所持有的值对应的Type</td></tr><tr><td>Elem</td><td>获取所持有的接口保管的值的Value封装，或获取所持有的指针指向的值的Value封装</td></tr><tr><td>Index</td><td>获取所持有的值的第i个元素的Value封装</td></tr><tr><td>NumField</td><td>获取所持有的结构体类型值的字段数</td></tr><tr><td>NumMethod</td><td>获取所持有的值所绑定的方法数</td></tr><tr><td>Field</td><td>获取所持有的结构体类型值的第i个字段的Value封装</td></tr><tr><td>Method</td><td>获取所持有的值所绑定的第i个方法的函数形式的Value封装</td></tr><tr><td>FieldByName</td><td>获取所持有的结构体类型值的字段中，指定字段名的字段的Value封装</td></tr><tr><td>MethodByName</td><td>获取所持有的值所绑定的方法中，指定方法名的方法的函数形式的Value封装</td></tr><tr><td>Call</td><td>指定参数调用所持有的函数，返回函数返回值的Value封装</td></tr><tr><td>Interface</td><td>返回所持有的值的interface{}类型值</td></tr><tr><td>Int、Float、Bool、String、Pointer</td><td>返回所持有的值的对应类型值，如果所持有的值不是对应的类型，则会触发panic异常</td></tr><tr><td>SetInt、SetFloat、SetBool、SetString、SetPointer</td><td>设置所持有的值，如果所持有的值不是对应的类型，则会触发panic异常</td></tr><tr><td>Set</td><td>将所持有的值设置为指定Value所持有的值，指定Value所持有值的类型必须与当前所持有值的类型相同，否则会触发panic异常</td></tr></tbody></table> 
<p><strong>说明一下：</strong></p> 
<ul><li>reflect.Value类型的方法不是对所有类型都能使用，每个方法都有其特定的适用范围和前提条件，如果在不满足调用条件的情况下调用了某个方法，则会触发panic异常。比如Elem方法只适用于接口和指针类型，NumField和Field方法只适用于结构体类型，Index方法只适用于数组、channel、切片和字符串类型，Call方法只适用于函数或方法类型。</li><li>通过Method或MethodByName方法，获取v所持有的值所绑定的某个方法的函数形式的Value封装时，返回值持有的函数总是使用v所持有的值作为receiver（即第一个参数），因此返回值在调用Call方法时不用手动传入receiver参数。</li></ul> 
<blockquote> 
 <p>reflect.Value与reflect.Type</p> 
</blockquote> 
<p>reflect.Value是一个具体的类型，而reflect.Type被设计成了一个接口类型。其原因如下：</p> 
<ul><li>类型的信息需要反射系统在运行时为每个类型自动生成，以适应各种未知的类型，将reflect.Type定义成接口类型的目的就是，指明运行时需要为每个类型生成哪些方法。</li><li>reflect.Value提供了各种访问和操作所持有值的方法，在使用reflect.Value时，通常已经知道所持有值的具体类型，这时通过reflect.Type即可获取到所持有值的类型信息，运行时不需要为其动态的生成任何方法，因此最终将reflect.Value定义成具体类型。</li></ul> 
<h3><a id="reflectKind_143"></a>reflect.Kind</h3> 
<blockquote> 
 <p>reflect.Kind</p> 
</blockquote> 
<ul><li>reflect.Kind是reflect包中的一个类型，用于表示类型的类别。</li><li>reflect.Type和reflect.Value都提供了对应的Kind方法，用于获取类型的Kind。</li></ul> 
<p>reflect.Kind本质是一个常量枚举类型。其定义如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> Kind <span class="token builtin">uint</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	Invalid Kind <span class="token operator">=</span> <span class="token boolean">iota</span>
	Bool
	Int
	Int8
	Int16
	Int32
	Int64
	Uint
	Uint8
	Uint16
	Uint32
	Uint64
	Uintptr
	Float32
	Float64
	Complex64
	Complex128
	Array
	Chan
	Func
	Interface
	Map
	Pointer
	Slice
	String
	Struct
	UnsafePointer
<span class="token punctuation">)</span>
</code></pre> 
<p><strong>说明一下：</strong></p> 
<ul><li>类型和类别可能是一对一的，比如int类型对应的Kind是Int，float32类型对应的Kind是Float32。类型和类别也可能是一对多的，比如所有结构体类型对应的Kind都是Struct，所有指针类型对应的Kind都是Pointer。</li><li>在获取变量的reflect.Value时，ValueOf函数或提取出接口值中对应的动态类型和动态值，并返回具体类型的Value。如果需要创建一个Kind为Interface的Value，可以先通过ValueOf函数获取一个指向接口的指针的Value，然后通过Value的Elem方法获取Value持有的指针指向的值的Value封装，这时获取到的Value的Kind就是Interface。</li></ul> 
<h3><a id="reflectValue_191"></a>具体类型、空接口与reflect.Value的相互转换</h3> 
<blockquote> 
 <p>具体类型、空接口与reflect.Value的相互转换</p> 
</blockquote> 
<p>在反射过程中，变量的类型经常需要在具体类型、空接口类型和reflect.Value类型之间进行转换。其转换的方式如下：</p> 
<ul><li>将变量由具体类型转换为空接口类型时，直接通过变量赋值的方式即可。</li><li>将变量由空接口类型转换为reflect.Value类型时，通过调用reflect.ValueOf函数即可。</li><li>将变量由reflect.Value类型转换为空接口类型时，通过调用reflect.Value的Interface方法即可。</li><li>将变量由空接口类型转为具体类型时，需要借助类型断言。</li></ul> 
<p>转换示意图如下：</p> 
<p><img src="https://images2.imgbox.com/bc/1a/z1ECEU7p_o.png" alt="在这里插入图片描述"></p> 
<p>转换案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Student <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Reflect</span><span class="token punctuation">(</span>iVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 具体类型-&gt;interface{}</span>

	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span> <span class="token comment">// interface{}-&gt;reflect.Value</span>

	iVal2 <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// reflect.Value-&gt;interface{}</span>

	<span class="token keyword">switch</span> val <span class="token operator">:=</span> iVal2<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// interface{}-&gt;具体类型</span>
	<span class="token keyword">case</span> Student<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"type = %T, value = %v\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"type = %T, value = %v\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token builtin">float64</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"type = %T, value = %v\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"unknown type: %T\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> stu <span class="token operator">=</span> Student<span class="token punctuation">{<!-- --></span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span> <span class="token comment">// type = main.Student, value = {Alice 14}</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment">// type = int, value = 1</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span><span class="token number">1.2</span><span class="token punctuation">)</span> <span class="token comment">// type = float64, value = 1.2</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_247"></a>反射应用场景</h2> 
<h3><a id="_248"></a>修改变量的值</h3> 
<blockquote> 
 <p>修改变量的值</p> 
</blockquote> 
<p>通过反射可以修改变量的值，具体步骤如下：</p> 
<ol><li>通过reflect.ValueOf函数，获取指向该值的指针的Value封装v1。</li><li>通过Value的Elem方法，获取v1所持有的指针指向的值的Value封装v2。</li><li>通过Value的Set系列方法，设置v2所持有的值，完成对变量的修改。</li></ol> 
<p>案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Reflect</span><span class="token punctuation">(</span>iVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span> <span class="token comment">// 获取指向该值的指针的Value封装</span>

	<span class="token keyword">switch</span> val <span class="token operator">:=</span> iVal<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">:</span>
		rVal<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetInt</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">// 获取所持有的指针指向的值的Value封装，并设置所持有的值</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"unknown type: %T\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span> <span class="token comment">// 传入的是指向变量的指针</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"a = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token comment">// a = 20</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>说明一下：</strong></p> 
<ul><li>通过反射修改变量的值时，需要通过指向对应变量的指针来修改，这样反射内部才能找到需要被修改的变量并对其进行修改。在修改变量的值时，需要先通过Value的Elem方法获取所持有的指针指向的值的Value封装（可以理解成对指针解引用），然后再调用Set系列方法修改变量的值。</li><li>除了通过Set系列方法修改变量的值外，也可以使用Set方法将当前Value所持有的值设置为另一个Value所持有的值。</li></ul> 
<h3><a id="_291"></a>访问结构体的字段信息</h3> 
<blockquote> 
 <p>访问结构体的字段信息</p> 
</blockquote> 
<p>通过反射可以访问结构体的字段信息，具体步骤如下：</p> 
<ol><li>通过reflect.ValueOf和reflect.TypeOf函数，分别获取结构体变量的Value和Type。</li><li>通过Value或Type的NumField方法，获取结构体的字段数。</li><li>通过Value的Field方法，获取指定索引字段的Value。</li><li>通过Type的Field方法，获取指定索引字段的各种信息。</li></ol> 
<p>案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Student <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>
	Age  <span class="token builtin">int</span>    <span class="token string">`json:"age"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Reflect</span><span class="token punctuation">(</span>iVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span>
	rType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span>
	rKind <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> rKind <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Struct <span class="token punctuation">{<!-- --></span> <span class="token comment">// 确保传入的变量是结构体类型</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 访问结构体的字段信息</span>
	num <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">NumField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取结构体的字段数</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		fieldInfo <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 获取结构体第i个字段的信息</span>
		filedValue <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Field</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 获取结构体第i个字段的Value封装</span>

		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"field[%d] name = %s\ttype = %v\ttag = %s\tvalue = %v\n"</span><span class="token punctuation">,</span>
			i<span class="token punctuation">,</span> fieldInfo<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> fieldInfo<span class="token punctuation">.</span>Type<span class="token punctuation">,</span> fieldInfo<span class="token punctuation">.</span>Tag<span class="token punctuation">,</span> filedValue<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> stu <span class="token operator">=</span> Student<span class="token punctuation">{<!-- --></span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>程序的运行结果如下：</p> 
<p><img src="https://images2.imgbox.com/5c/2c/VzvCU3be_o.png" alt="在这里插入图片描述"></p> 
<p><strong>说明一下：</strong></p> 
<ul><li>上述代码中通过对变量的Kind进行判断，以确保传入的变量是结构体类型。</li><li>json.Marshal函数在对结构体变量进行JSON序列化时，在函数内部就是通过反射来获取结构体字段的Tag标签的。</li></ul> 
<h3><a id="_351"></a>调用变量所绑定的方法</h3> 
<blockquote> 
 <p>调用变量所绑定的方法</p> 
</blockquote> 
<p>通过反射可以调用变量所绑定的方法，具体步骤如下：</p> 
<ol><li>通过reflect.ValueOf和reflect.TypeOf函数，分别获取变量的Value和Type。</li><li>通过Value或Type的NumMethod方法，获取变量对应的类型所绑定的方法数。</li><li>通过Value的Method方法，获取指定索引方法的Value。</li><li>通过Type的Method方法，获取指定索引方法的各种信息。</li><li>通过Value的Call方法，调用所持有的方法。</li></ol> 
<p>案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Student <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span> <span class="token string">`json:"name"`</span>
	Age  <span class="token builtin">int</span>    <span class="token string">`json:"age"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>stu Student<span class="token punctuation">)</span> <span class="token function">Study</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Study: student %s is studying...\n"</span><span class="token punctuation">,</span> stu<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>stu <span class="token operator">*</span>Student<span class="token punctuation">)</span> <span class="token function">UpdateAge</span><span class="token punctuation">(</span>age <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	stu<span class="token punctuation">.</span>Age <span class="token operator">=</span> age
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"UpdateAge: update %s age = %d...\n"</span><span class="token punctuation">,</span> stu<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> stu<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>stu Student<span class="token punctuation">)</span> <span class="token function">StuInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"StuInfo: name = %s, age = %d...\n"</span><span class="token punctuation">,</span> stu<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> stu<span class="token punctuation">.</span>Age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Reflect</span><span class="token punctuation">(</span>iVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span>
	rType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span>

	<span class="token keyword">switch</span> val <span class="token operator">:=</span> iVal<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token operator">*</span>Student<span class="token punctuation">,</span> Student<span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"------type = %v------\n"</span><span class="token punctuation">,</span> rType<span class="token punctuation">)</span>
		<span class="token comment">// 调用变量对应的类型所绑定的方法</span>
		num <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">NumMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取该类型所绑定的方法数</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"method num = %d\n"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>
		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
			methodVal <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>         <span class="token comment">// 获取该类型所绑定的第i个方法的Value封装</span>
			methodInfo <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">Method</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>       <span class="token comment">// 获取该类型所绑定的第i个方法的信息</span>
			<span class="token keyword">if</span> methodInfo<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">"UpdateAge"</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 调用时需要传参</span>
				<span class="token keyword">var</span> args <span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value
				args <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				methodVal<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token comment">// 调用方法</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				methodVal<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// 调用方法</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"unknown type: %T\n"</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> stu1 <span class="token operator">=</span> Student<span class="token punctuation">{<!-- --></span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>stu1<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"stu1 = %v\n"</span><span class="token punctuation">,</span> stu1<span class="token punctuation">)</span> <span class="token comment">// stu1 = {Alice 18}</span>

	<span class="token keyword">var</span> stu2 <span class="token operator">=</span> Student<span class="token punctuation">{<!-- --></span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">}</span>
	<span class="token function">Reflect</span><span class="token punctuation">(</span>stu2<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"stu2 = %v\n"</span><span class="token punctuation">,</span> stu2<span class="token punctuation">)</span> <span class="token comment">// stu2 = {Bob 14}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>程序的运行结果如下：</p> 
<p><img src="https://images2.imgbox.com/6e/2b/MAAW1zQm_o.png" alt="在这里插入图片描述"></p> 
<p><strong>说明一下：</strong></p> 
<ul><li>通过反射获取变量对应的类型所绑定的方法数，以及获取指定索引方法的Value封装或方法信息时，如果变量的类型是<code>type</code>，则只能访问到receiver为<code>type</code>的方法，如果变量的类型是<code>*type</code>，则能同时访问到receiver为<code>type</code>和<code>*type</code>的方法。</li><li>因为receiver为<code>*type</code>的方法中可能会对变量的值进行修改，为了让反射内部能够找到需要被修改的变量并对其进行修改，这就要求变量的类型必须是<code>*type</code>，因此如果变量的类型是<code>type</code>，那就无法访问到receiver为<code>*type</code>的方法。</li><li>Value的Call方法接收一个类型为<code>[]Value</code>的参数，表示在调用Value所持有的函数或方法时，需要传入的各个参数的Value封装，如果被调用的函数或方法无需传入任何参数，则调用Call方法时传入nil即可。同时Call方法会返回一个<code>[]Value</code>类型的返回值，表示调用Value所持有的函数或方法得到的各个返回值的Value封装。</li></ul> 
<h3><a id="_438"></a>实现函数适配器</h3> 
<blockquote> 
 <p>实现函数适配器</p> 
</blockquote> 
<p>通过反射可以实现函数适配器，具体步骤如下：</p> 
<ol><li>通过reflect.ValueOf函数，获取函数的Value。</li><li>对用户传入的用于调用函数的参数进行Value封装，并放到Value切片中。</li><li>通过Value的Call方法，指定参数调用所持有的函数，并返回函数调用的返回值。</li></ol> 
<p>案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"errors"</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">AddTwo</span><span class="token punctuation">(</span>num1 <span class="token builtin">int</span><span class="token punctuation">,</span> num2 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">AddThree</span><span class="token punctuation">(</span>num1 <span class="token builtin">int</span><span class="token punctuation">,</span> num2 <span class="token builtin">int</span><span class="token punctuation">,</span> num3 <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> num1 <span class="token operator">+</span> num2 <span class="token operator">+</span> num3
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Bridge</span><span class="token punctuation">(</span>f <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> args <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>ret <span class="token builtin">int</span><span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	rKind <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> rKind <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Func <span class="token punctuation">{<!-- --></span>
		err <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"the first arg is not a function"</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 对传入的参数进行Value封装，并放到Value切片中</span>
	num <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
	argVals <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>reflect<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		argVals<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	retVals <span class="token operator">:=</span> rVal<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>argVals<span class="token punctuation">)</span> <span class="token comment">// 调用函数</span>
	ret <span class="token operator">=</span> <span class="token function">int</span><span class="token punctuation">(</span>retVals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	ret<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">Bridge</span><span class="token punctuation">(</span>AddTwo<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"err = %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ret = %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token comment">// ret = 30</span>
	<span class="token punctuation">}</span>

	ret<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">Bridge</span><span class="token punctuation">(</span>AddThree<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"err = %v\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ret = %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span> <span class="token comment">// ret = 60</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_503"></a>创建任意类型的变量</h3> 
<blockquote> 
 <p>创建任意类型变量</p> 
</blockquote> 
<p>通过反射可以创建任意类型的变量，具体步骤如下：</p> 
<ol><li>通过reflect.ValueOf和reflect.TypeOf函数，分别获取二级指针的Value和Type，并继续通过Value和Type的Elem方法，分别获取二级指针指向的一级指针的Value和Type。</li><li>再次通过Type的Elem方法，继续获取一级指针指向的元素的Type，即需要创建的变量的类型。</li><li>通过reflect.New函数，创建指定Type的变量，并获取持有指向该变量的指针的Value封装elemVal。</li><li>通过Value的Set方法，将一级指针所持有的值设置为elemVal所持有的值，让一级指针指向创建的变量。</li></ol> 
<p>案例如下：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Student <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CreateObj</span><span class="token punctuation">(</span>iVal <span class="token keyword">interface</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	rType <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">TypeOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取二级指针指向的一级指针的Type</span>
	rVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>iVal<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取二级指针指向的一级指针的Value</span>
	rKind <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> rKind <span class="token operator">!=</span> reflect<span class="token punctuation">.</span>Ptr <span class="token punctuation">{<!-- --></span> <span class="token comment">// 确保传入的是二级指针（该类型指向的是一个指针类型）</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	elemType <span class="token operator">:=</span> rType<span class="token punctuation">.</span><span class="token function">Elem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">// 获取一级指针指向的元素的Type</span>
	elemVal <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>elemType<span class="token punctuation">)</span> <span class="token comment">// 创建elemType类型的变量，并获取持有指向该变量的指针的Value</span>
	rVal<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>elemVal<span class="token punctuation">)</span>                <span class="token comment">// 将一级指针所持有的值设置为elemVal所持有的值</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> p1 <span class="token operator">*</span>Student
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"p1 = %v\n"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">// p1 = &lt;nil&gt;</span>
	<span class="token function">CreateObj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"p1 = %v\n"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">// p1 = &amp;{ 0}</span>

	<span class="token keyword">var</span> p2 <span class="token operator">*</span><span class="token builtin">int</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"p2 = %v\n"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token comment">// p2 = &lt;nil&gt;</span>
	<span class="token function">CreateObj</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"p2 = %v\n"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token comment">// p2 = 0xc00000e0f8</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>说明一下：</strong></p> 
<ul><li>在创建变量时需要提供一个<code>*type</code>类型的指针，然后根据指针的类型创建一个<code>type</code>类型的变量，并让该指针指向这个变量，完成变量的创建。由于最终需要修改所给指针变量的指向，因此在调用CreateObj函数时需要传入该指针的地址（二级指针）。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/677eaf35452b586f6d178f74ec85740a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">算法（十一）贪婪算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/41ee7baff7cfed8d166a41b3ab903486/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">实战经验分享之移动云快速部署Stable Diffusion SDXL 1.0</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>