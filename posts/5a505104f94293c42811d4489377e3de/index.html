<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【微信公众号推送小程序消息通知】--下发统一消息接口被回收后新方案 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5a505104f94293c42811d4489377e3de/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【微信公众号推送小程序消息通知】--下发统一消息接口被回收后新方案">
  <meta property="og:description" content="序言 由于微信小程序长期订阅的消息模板和下发统一消息推送接口全部失效以后，对于小程序的消息推送可以往公众号推可以使用本文章方案。在网上看了挺多方案，有用用户列表做匹配的等，最终觉得通过关注事件触发的方案是最省事。
准备 1、微信公众平台注册服务号（订阅号是不可以推送的）与小程序，两者都需要认证并且认证主体是一致
2、微信开放平台注册账号（该账号也需要认证），绑定小程序与公众号
3、公众号根据想要的模板消息绑定服务类目，去模板消息中先挑选你的模板消息。（如果是刚注册的公众号还需要去新的功能页面添加模板消息功能，需要微信审核，不过很快）
4、微信公众号绑定小程序
5、小程序与公众号配置服务器的ip地址白名单
6、公众号配置服务器地址
整体实现流程 通过在开放平台绑定的公众号与小程序后，我们在调用微信code2Session接口的时候会返回unionid，这个unionid就是推送的关键。
用到微信接口：
1、关注事件推送：用关注事件推送接口文档地址
2、查询用户基础信息：用户基础信息接口文档地址
3、获取accessToken：获取accessToken接口文档地址
4、消息模板推送：消息模板推送接口文档地址
实现代码（Java） 这里使用第三方工具包Wx-Java（非常方便），直接实现推送代码。具体源码可以浏览https://gitee.com/binary/weixin-java-tools
先在配置文件yml配置公众号信息 # 公众号配置 wx: mp: appId: xiaochengxuappid secret: xiaochengxusecrect token: xiaochengxutoken aesKey: xiaochengxuaes # token存储在redis config-storage: type: RedisTemplate 封装推送工具类 /** * 微信公众号推送模板消息 * * @param openid 用户openid * @param templateData 模板参数 */ public void sendTemplateMsg(String openid, List&lt;WxMpTemplateData&gt; templateData) { WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder() .toUser(openid) // 模板id .templateId(templateId) // 跳转小程序appid，跳转路径 .miniProgram(new WxMpTemplateMessage.MiniProgram(weAppAppId, &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-08T16:03:42+08:00">
    <meta property="article:modified_time" content="2023-11-08T16:03:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【微信公众号推送小程序消息通知】--下发统一消息接口被回收后新方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>序言</h3> 
<p>由于微信小程序长期订阅的消息模板和下发统一消息推送接口全部失效以后，对于小程序的消息推送可以往公众号推可以使用本文章方案。在网上看了挺多方案，有用用户列表做匹配的等，最终觉得通过关注事件触发的方案是最省事。</p> 
<h3><a id="_2"></a>准备</h3> 
<p>1、<a href="https://mp.weixin.qq.com/" rel="nofollow">微信公众平台</a>注册<strong>服务号</strong>（订阅号是不可以推送的）与小程序，两者都需要认证并且<strong>认证主体是一致</strong></p> 
<p>2、<a href="https://open.weixin.qq.com/" rel="nofollow">微信开放平台</a>注册账号（该账号也需要认证），绑定小程序与公众号<br> <img src="https://images2.imgbox.com/9d/58/Gnhbgwt1_o.png" alt="在这里插入图片描述"><br> 3、公众号根据想要的模板消息绑定服务类目，去模板消息中先挑选你的模板消息。（如果是刚注册的公众号还需要去新的功能页面添加模板消息功能，需要微信审核，不过很快）<br> <img src="https://images2.imgbox.com/ea/0a/dwbOzL5L_o.png" alt="在这里插入图片描述"><br> 4、微信公众号绑定小程序<br> <img src="https://images2.imgbox.com/56/43/X66eGSyK_o.png" alt="在这里插入图片描述"><br> 5、小程序与公众号配置服务器的ip地址白名单<br> <img src="https://images2.imgbox.com/8b/57/qIv5N8N1_o.png" alt="在这里插入图片描述"><br> 6、公众号配置服务器地址<br> <img src="https://images2.imgbox.com/0f/88/IdbKwPZd_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_16"></a>整体实现流程</h3> 
<p>通过在开放平台绑定的公众号与小程序后，我们在调用微信<a href="https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/user-login/code2Session.html" rel="nofollow">code2Session</a>接口的时候会返回unionid，这个unionid就是推送的关键。</p> 
<ul><li><strong>用到微信接口：</strong><br> 1、关注事件推送：<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_event_pushes.html" rel="nofollow">用关注事件推送接口文档地址</a><br> 2、查询用户基础信息：<a href="https://developers.weixin.qq.com/doc/offiaccount/User_Management/Get_users_basic_information_UnionID.html#UinonId" rel="nofollow">用户基础信息接口文档地址</a><br> 3、获取accessToken：<a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Get_access_token.html" rel="nofollow">获取accessToken接口文档地址</a><br> 4、消息模板推送：<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Template_Message_Interface.html" rel="nofollow">消息模板推送接口文档地址</a><br> <img src="https://images2.imgbox.com/e2/de/LUJHYmES_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="Java_24"></a>实现代码（Java）</h3> 
<p>这里使用第三方工具包Wx-Java（非常方便），直接实现推送代码。具体源码可以浏览https://gitee.com/binary/weixin-java-tools</p> 
<ul><li>先在配置文件yml配置公众号信息</li></ul> 
<pre><code class="prism language-yml"><span class="token comment"># 公众号配置</span>
<span class="token key atrule">wx</span><span class="token punctuation">:</span>
  <span class="token key atrule">mp</span><span class="token punctuation">:</span>
    <span class="token key atrule">appId</span><span class="token punctuation">:</span> xiaochengxuappid
    <span class="token key atrule">secret</span><span class="token punctuation">:</span> xiaochengxusecrect
    <span class="token key atrule">token</span><span class="token punctuation">:</span> xiaochengxutoken
    <span class="token key atrule">aesKey</span><span class="token punctuation">:</span>  xiaochengxuaes
    <span class="token comment"># token存储在redis</span>
    <span class="token key atrule">config-storage</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> RedisTemplate
</code></pre> 
<ul><li>封装推送工具类</li></ul> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 微信公众号推送模板消息
     *
     * @param openid       用户openid
     * @param templateData 模板参数
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendTemplateMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> openid<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WxMpTemplateData</span><span class="token punctuation">&gt;</span></span> templateData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">WxMpTemplateMessage</span> templateMessage <span class="token operator">=</span> <span class="token class-name">WxMpTemplateMessage</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">toUser</span><span class="token punctuation">(</span>openid<span class="token punctuation">)</span>
                <span class="token comment">// 模板id</span>
                <span class="token punctuation">.</span><span class="token function">templateId</span><span class="token punctuation">(</span>templateId<span class="token punctuation">)</span>
                <span class="token comment">// 跳转小程序appid，跳转路径</span>
                <span class="token punctuation">.</span><span class="token function">miniProgram</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateMessage<span class="token punctuation">.</span>MiniProgram</span><span class="token punctuation">(</span>weAppAppId<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 模板参数</span>
                <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>templateData<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"微信公众号推送模板消息入参：{}"</span><span class="token punctuation">,</span> templateMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 成功返回msgId，否则都是抛异常</span>
            wxMpService<span class="token punctuation">.</span><span class="token function">getTemplateMsgService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendTemplateMsg</span><span class="token punctuation">(</span>templateMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">WxErrorException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"微信公众号推送模板消息异常"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ul><li>公众号接入服务器开发的代码</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">WxMpMessageRouter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">WxMpService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">WxMpXmlMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">WxMpXmlOutMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author quan
 * @date 2023/11/7 18:19
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/wx"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxPortalController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WxMpService</span> wxService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WxMpMessageRouter</span> messageRouter<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token string">"text/plain;charset=utf-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">authGet</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> appid<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"signature"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"timestamp"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"nonce"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"echostr"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> echostr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"接收到来自微信服务器的认证消息：[{}, {}, {}, {}]"</span><span class="token punctuation">,</span> signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echostr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isAnyBlank</span><span class="token punctuation">(</span>signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echostr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"请求参数非法，请核实!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>wxService<span class="token punctuation">.</span><span class="token function">switchover</span><span class="token punctuation">(</span>appid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"未找到对应appid=[%s]的配置，请核实！"</span><span class="token punctuation">,</span> appid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>wxService<span class="token punctuation">.</span><span class="token function">checkSignature</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> echostr<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token string">"非法请求"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span>produces <span class="token operator">=</span> <span class="token string">"application/xml; charset=UTF-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">post</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> appid<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> requestBody<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"signature"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"timestamp"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"nonce"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"openid"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> openid<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"encrypt_type"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> encType<span class="token punctuation">,</span>
                       <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"msg_signature"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> msgSignature<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"接收微信请求：[openid=[{}], [signature=[{}], encType=[{}], msgSignature=[{}],"</span>
                        <span class="token operator">+</span> <span class="token string">" timestamp=[{}], nonce=[{}], requestBody=[\n{}\n] "</span><span class="token punctuation">,</span>
                openid<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> encType<span class="token punctuation">,</span> msgSignature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>wxService<span class="token punctuation">.</span><span class="token function">switchover</span><span class="token punctuation">(</span>appid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"未找到对应appid=[%s]的配置，请核实！"</span><span class="token punctuation">,</span> appid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>wxService<span class="token punctuation">.</span><span class="token function">checkSignature</span><span class="token punctuation">(</span>timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"非法请求，可能属于伪造的请求！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">String</span> out <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>encType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 明文传输的消息</span>
            <span class="token class-name">WxMpXmlMessage</span> inMessage <span class="token operator">=</span> <span class="token class-name">WxMpXmlMessage</span><span class="token punctuation">.</span><span class="token function">fromXml</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">WxMpXmlOutMessage</span> outMessage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>inMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>outMessage <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            out <span class="token operator">=</span> outMessage<span class="token punctuation">.</span><span class="token function">toXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"aes"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>encType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// aes加密的消息</span>
            <span class="token class-name">WxMpXmlMessage</span> inMessage <span class="token operator">=</span> <span class="token class-name">WxMpXmlMessage</span><span class="token punctuation">.</span><span class="token function">fromEncryptedXml</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">,</span> wxService<span class="token punctuation">.</span><span class="token function">getWxMpConfigStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> msgSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"消息解密后内容为：{} "</span><span class="token punctuation">,</span> inMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">WxMpXmlOutMessage</span> outMessage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>inMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>outMessage <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            out <span class="token operator">=</span> outMessage<span class="token punctuation">.</span><span class="token function">toEncryptedXml</span><span class="token punctuation">(</span>wxService<span class="token punctuation">.</span><span class="token function">getWxMpConfigStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"组装回复信息：{}"</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> out<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">WxMpXmlOutMessage</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token class-name">WxMpXmlMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageRouter<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"路由消息时出现异常！"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>微信消息路由配置类</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author quan
 * @date 2023/11/7 18:23
 */</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WxMpConfiguration</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SubscribeHandler</span> subscribeHandler<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">WxMpMessageRouter</span> <span class="token function">messageRouter</span><span class="token punctuation">(</span><span class="token class-name">WxMpService</span> wxMpService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token class-name">WxMpMessageRouter</span> newRouter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxMpMessageRouter</span><span class="token punctuation">(</span>wxMpService<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 关注事件</span>
        newRouter<span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">msgType</span><span class="token punctuation">(</span><span class="token constant">EVENT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">event</span><span class="token punctuation">(</span><span class="token constant">SUBSCRIBE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subscribeHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> newRouter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>微信关注事件处理类</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">LambdaQueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tfcs<span class="token punctuation">.</span>web<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>bus<span class="token punctuation">.</span></span><span class="token class-name">BusWxMpUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tfcs<span class="token punctuation">.</span>web<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">BusWxMpUserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>common<span class="token punctuation">.</span>error<span class="token punctuation">.</span></span><span class="token class-name">WxErrorException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>common<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">WxSessionManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">WxMpMessageHandler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">WxMpService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">WxMpXmlMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">WxMpXmlOutMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">me<span class="token punctuation">.</span>chanjar<span class="token punctuation">.</span>weixin<span class="token punctuation">.</span>mp<span class="token punctuation">.</span>bean<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">WxMpUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 关注处理器
 *
 * @author quan
 * @date 2023/9/15 14:05
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubscribeHandler</span> <span class="token keyword">implements</span> <span class="token class-name">WxMpMessageHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BusWxMpUserService</span> wxMpUserService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">WxMpXmlOutMessage</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">WxMpXmlMessage</span> wxMessage<span class="token punctuation">,</span>
                                    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> context<span class="token punctuation">,</span> <span class="token class-name">WxMpService</span> weixinService<span class="token punctuation">,</span>
                                    <span class="token class-name">WxSessionManager</span> sessionManager<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"新关注用户 OPENID: "</span> <span class="token operator">+</span> wxMessage<span class="token punctuation">.</span><span class="token function">getFromUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取微信用户基本信息</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">WxMpUser</span> userWxInfo <span class="token operator">=</span> weixinService<span class="token punctuation">.</span><span class="token function">getUserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">userInfo</span><span class="token punctuation">(</span>wxMessage<span class="token punctuation">.</span><span class="token function">getFromUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>userWxInfo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// TODO 先检查是否存在该用户，不存在再存到数据库</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">WxErrorException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"微信公众号获取用户信息异常："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">48001</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"该公众号没有获取用户信息权限！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>业务代码调用demo</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// 通过unionid查出公众号openid</span>
<span class="token class-name">BusWxMpUser</span> wxMpUser <span class="token operator">=</span> wxMpUserService<span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BusWxMpUser</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">BusWxMpUser</span><span class="token operator">::</span><span class="token function">getUnionid</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getUnionid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> wxMpUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WxMpTemplateData</span><span class="token punctuation">&gt;</span></span> templateData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 对应消息模板的key</span>
     templateData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"character_string2"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getFlightNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     templateData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"thing10"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getStartPlace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     templateData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"thing11"</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getDestPlace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     templateData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"time3"</span><span class="token punctuation">,</span> <span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">parseDateToStr</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token constant">YYYY_MM_DD</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span><span class="token function">getFlightStartTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     templateData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"thing9"</span><span class="token punctuation">,</span> <span class="token string">"请及时处理关注事件"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     weChatUtil<span class="token punctuation">.</span><span class="token function">sendTemplateMsg</span><span class="token punctuation">(</span>wxMpUser<span class="token punctuation">.</span><span class="token function">getOpenid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> templateData<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<ul><li>推送效果<br> <img src="https://images2.imgbox.com/0e/bb/80gWIyYa_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83b16532f14dacdfe68b1df7aaaac0c6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年下半年架构案例真题及答案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c65439434e0d860c02929aef398ce1d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【LeetCode力扣】42.接雨水（困难）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>