<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python-FastAPI框架使用介绍 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d450d2b17115d3eee1acf41e1e1afa31/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python-FastAPI框架使用介绍">
  <meta property="og:description" content="Python-FastAPI框架介绍 1. FastAPI简介 ​ FastAPI 是一个现代、快速（高性能）的 Web 框架，用于构建基于 Python 的 API。它具有简单易用的特性，同时也提供了高度自动化的文档生成功能，使得开发者可以更加高效地构建和部署 API 服务。功能强大、易于使用且高性能的 Web 框架，适用于构建各种规模的 API 服务。它的简洁语法、自动生成文档和异步支持等特性使得开发 API 更加轻松和愉快
中文文档：https://fastapi.tiangolo.com/zh/
GitHub项目地址：https://github.com/tiangolo/fastapi
本篇文章会简单的介绍一下概念，然后通过一个完整的实战项目来展开介绍各个功能模块。
FastAPI 关键特性
快速高效：基于 Starlette 和 Pydantic 构建，具有高性能和低延迟的特点，支持异步处理请求，利用 Python 的协程提高并发性能。简单易用：使用标准的 Python 类型注解来定义 API 的输入和输出参数，无需编写大量的文档和验证代码。自动生成文档：通过访问 /docs 路径可以查看自动生成的交互式 API 文档，包含了每个端点的详细说明、请求和响应的模型结构以及示例请求和响应。数据验证：利用 Pydantic 提供的数据验证功能，可以自动验证请求数据的格式和类型，并进行数据转换。依赖注入：支持依赖注入，可以方便地将依赖项注入到处理函数中，例如数据库连接、配置等。类型检查：利用 Python 类型提示和 Pydantic 的数据模型，可以在开发过程中进行类型检查，减少错误和调试时间。中间件支持：支持使用中间件扩展框架的功能，例如认证、日志记录等。标准化：支持 OpenAPI 规范，可以生成符合规范的 API 文档和客户端代码。 2. FastAPI安装 安装FastAPI模块
pip install fastapi pip install uvicorn uvicorn用于运行 Python 的异步 Web 应用程序，与许多流行的 Python 框架（如 FastAPI、Starlette 等）兼容，可以帮助开发者构建高效的异步 Web 服务">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-16T18:28:20+08:00">
    <meta property="article:modified_time" content="2024-04-16T18:28:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python-FastAPI框架使用介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="PythonFastAPI_0"></a>Python-FastAPI框架介绍</h2> 
<h3><a id="1_FastAPI_2"></a>1. FastAPI简介</h3> 
<p>​ FastAPI 是一个现代、快速（高性能）的 Web 框架，用于构建基于 Python 的 API。它具有简单易用的特性，同时也提供了高度自动化的文档生成功能，使得开发者可以更加高效地构建和部署 API 服务。功能强大、易于使用且高性能的 Web 框架，适用于构建各种规模的 API 服务。它的简洁语法、自动生成文档和异步支持等特性使得开发 API 更加轻松和愉快</p> 
<p>中文文档：https://fastapi.tiangolo.com/zh/<br> GitHub项目地址：https://github.com/tiangolo/fastapi</p> 
<p>本篇文章会简单的介绍一下概念，然后通过一个完整的实战项目来展开介绍各个功能模块。</p> 
<p>FastAPI 关键特性</p> 
<ol><li><strong>快速高效</strong>：基于 Starlette 和 Pydantic 构建，具有高性能和低延迟的特点，支持异步处理请求，利用 Python 的协程提高并发性能。</li><li><strong>简单易用</strong>：使用标准的 Python 类型注解来定义 API 的输入和输出参数，无需编写大量的文档和验证代码。</li><li><strong>自动生成文档</strong>：通过访问 <code>/docs</code> 路径可以查看自动生成的交互式 API 文档，包含了每个端点的详细说明、请求和响应的模型结构以及示例请求和响应。</li><li><strong>数据验证</strong>：利用 Pydantic 提供的数据验证功能，可以自动验证请求数据的格式和类型，并进行数据转换。</li><li><strong>依赖注入</strong>：支持依赖注入，可以方便地将依赖项注入到处理函数中，例如数据库连接、配置等。</li><li><strong>类型检查</strong>：利用 Python 类型提示和 Pydantic 的数据模型，可以在开发过程中进行类型检查，减少错误和调试时间。</li><li><strong>中间件支持</strong>：支持使用中间件扩展框架的功能，例如认证、日志记录等。</li><li><strong>标准化</strong>：支持 OpenAPI 规范，可以生成符合规范的 API 文档和客户端代码。</li></ol> 
<h3><a id="2_FastAPI_26"></a>2. FastAPI安装</h3> 
<p>安装FastAPI模块</p> 
<pre><code class="prism language-python">pip install fastapi
pip install uvicorn
</code></pre> 
<blockquote> 
 <p><code>uvicorn</code>用于运行 Python 的异步 Web 应用程序，与许多流行的 Python 框架（如 FastAPI、Starlette 等）兼容，可以帮助开发者构建高效的异步 Web 服务</p> 
</blockquote> 
<h3><a id="3_FastAPI_39"></a>3. FastAPI入门体验</h3> 
<p>小试牛刀demo，跑一遍官方小示例</p> 
<ul><li>创建一个<code>main.py</code></li></ul> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :wangting_FastAPI</span>
<span class="token comment"># @File     :main.py.py</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">from</span> typing <span class="token keyword">import</span> Union
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Hello"</span><span class="token punctuation">:</span> <span class="token string">"World"</span><span class="token punctuation">}</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/items/{item_id}"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_item</span><span class="token punctuation">(</span>item_id<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> q<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"item_id"</span><span class="token punctuation">:</span> item_id<span class="token punctuation">,</span> <span class="token string">"q"</span><span class="token punctuation">:</span> q<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <pre><code>   async 关键字用于定义异步函数。异步函数可以在执行过程中暂停并允许其他代码执行，直到某些条件满足后再恢复执行。在 FastAPI 中，使用 async 可以使函数能够处理异步操作，例如异步的数据库查询、IO 操作等，以提高性能和并发能力。
在这个例子中，read_root 和 read_item 函数都是异步函数，它们使用了 async 关键字来定义。这样的函数可以通过 await 关键字调用其他异步函数，或者执行需要等待的异步操作，而不会阻塞整个应用程序的执行。
</code></pre> 
</blockquote> 
<ul><li>在 PyCharm 的 Terminal 中运行 uvicorn 命令启动 FastAPI 应用程序</li></ul> 
<pre><code class="prism language-shell">uvicorn main:app <span class="token parameter variable">--reload</span>
</code></pre> 
<blockquote> 
 <p>这里的 <code>main</code> 是你的 Python 文件名（不含扩展名main方法的意思），<code>app</code> 是你创建的 FastAPI 应用程序实例。</p> 
 <p><code>uvicorn main:app --reload</code> 命令含义如下:</p> 
 <ul><li><code>main</code>：<code>main.py</code> 文件（一个 Python “模块”）。</li><li><code>app</code>：在 <code>main.py</code> 文件中通过 <code>app = FastAPI()</code> 创建的对象。</li><li><code>--reload</code>：让服务器在更新代码后重新启动。仅在开发时使用该选项。</li></ul> 
</blockquote> 
<p>打开浏览器并验证访问：</p> 
<p>http://localhost:8000/</p> 
<p>http://localhost:8000/items/1</p> 
<p>图例1</p> 
<p><img src="https://images2.imgbox.com/97/4f/RlwPDMO4_o.png" alt=""></p> 
<p>图例2</p> 
<p><img src="https://images2.imgbox.com/5a/1b/tk8r8asP_o.png" alt=""></p> 
<blockquote> 
 <p>通过以上代码创建了一个具有以下功能的 API：</p> 
 <ul><li>通过 <em>路径</em> <code>/</code> 和 <code>/items/{item_id}</code> 接受 HTTP 请求。</li><li>以上 <em>路径</em> 都接受 <code>GET</code> <em>操作</em>（也被称为 HTTP <em>方法</em>）。</li><li><code>/items/{item_id}</code> <em>路径</em> 有一个 <em>路径参数</em> <code>item_id</code> 并且应该为 <code>int</code> 类型。</li><li><code>/items/{item_id}</code> <em>路径</em> 有一个可选的 <code>str</code> 类型的 <em>查询参数</em> <code>q</code>。</li></ul> 
</blockquote> 
<h3><a id="4_FastAPI_112"></a>4. FastAPI交互式文档</h3> 
<p>访问 http://127.0.0.1:8000/docs 可打开API文档界面</p> 
<p><img src="https://images2.imgbox.com/62/c3/WDzRS8GB_o.png" alt=""></p> 
<h3><a id="5_FastAPI_120"></a>5. FastAPI入门体验代码升级</h3> 
<p>小试牛刀demo，官方小示例迭代</p> 
<p><code>main.py</code></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> typing <span class="token keyword">import</span> Union
<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name<span class="token punctuation">:</span> <span class="token builtin">str</span>
    price<span class="token punctuation">:</span> <span class="token builtin">float</span>
    is_offer<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token punctuation">:</span> <span class="token string">"world"</span><span class="token punctuation">}</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/item/{item_id}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">read_item</span><span class="token punctuation">(</span>item_id<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> q<span class="token punctuation">:</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"item_id"</span><span class="token punctuation">:</span> item_id<span class="token punctuation">,</span> <span class="token string">"q"</span><span class="token punctuation">:</span> q<span class="token punctuation">}</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>put</span><span class="token punctuation">(</span><span class="token string">"/items/{item_id}"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">update_item</span><span class="token punctuation">(</span>item_id<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> item<span class="token punctuation">:</span> Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"item_name"</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"item_id"</span><span class="token punctuation">:</span> item_id<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>服务器将会自动重载（因为在上面的步骤中你向 <code>uvicorn</code> 命令添加了 <code>--reload</code> 选项）</p> 
 <p>由于之前在 PyCharm 的 Terminal 中运行 uvicorn 命令启动 FastAPI 应用程序，有<code>--reload</code>参数，所以无需重新运行，如没有增加这个参数，需要在Terminal中重新执行uvicorn</p> 
</blockquote> 
<p>打开URL<code>http://localhost:8000/docs</code></p> 
<p>找到put，点击 Try it out ； 可以填写参数并直接调用 API</p> 
<p>图例1：</p> 
<p><img src="https://images2.imgbox.com/22/c0/iopHXz61_o.png" alt=""></p> 
<p>点击「Execute」按钮，用户界面将会和 API 进行通信，发送参数，获取结果并在屏幕上展示</p> 
<p>图例2：</p> 
<p><img src="https://images2.imgbox.com/54/04/vjplBbCp_o.png" alt=""></p> 
<h3><a id="6_FastAPI_175"></a>6. FastAPI路径介绍</h3> 
<p>fastapi支持各种请求方式：</p> 
<table><thead><tr><th>装饰器</th><th>HTTP 方法</th><th>说明</th><th>使用注意事项</th></tr></thead><tbody><tr><td><code>@app.get()</code></td><td>GET</td><td>处理 HTTP GET 请求，获取资源的信息或数据。</td><td>应该是幂等的，不应该对服务器状态进行修改。不要包含对资源的修改操作。</td></tr><tr><td><code>@app.post()</code></td><td>POST</td><td>处理 HTTP POST 请求，创建新资源或提交数据。</td><td>POST 请求应该包含一个请求体，应避免包含敏感信息。</td></tr><tr><td><code>@app.put()</code></td><td>PUT</td><td>处理 HTTP PUT 请求，更新已存在的资源或创建指定标识的资源。</td><td>PUT 请求应该包含一个完整的资源表示，用于替换原始资源。</td></tr><tr><td><code>@app.patch()</code></td><td>PATCH</td><td>处理 HTTP PATCH 请求，部分更新已存在的资源的内容。</td><td>PATCH 请求应该包含一个用于指定需要更新的部分资源内容的请求体。应避免更新资源的标识或其他关键信息。</td></tr><tr><td><code>@app.delete()</code></td><td>DELETE</td><td>处理 HTTP DELETE 请求，删除指定资源。</td><td>DELETE 请求应该谨慎使用，应使用权限验证和确认机制。</td></tr><tr><td><code>@app.options()</code></td><td>OPTIONS</td><td>处理 HTTP OPTIONS 请求，获取目标资源支持的通信选项。</td><td>OPTIONS 请求通常由浏览器在跨域请求时发送，一般不需要直接处理。</td></tr><tr><td><code>@app.head()</code></td><td>HEAD</td><td>处理 HTTP HEAD 请求，仅返回响应头信息，不返回实际内容。获取资源的响应头信息，而不获取实际的资源内容。</td><td>HEAD 请求与 GET 请求类似，但不返回实际的资源内容。</td></tr><tr><td><code>@app.trace()</code></td><td>TRACE</td><td>处理 HTTP TRACE 请求，追踪请求在传输链路上的路径，用于调试。</td><td>TRACE 请求通常用于调试和诊断网络问题，一般不在业务逻辑中直接使用。</td></tr></tbody></table> 
<h3><a id="7_1_CRUD_192"></a>7. 项目实战示例1 (CRUD)</h3> 
<p>​ 让我们一起探索一个完整的 FastAPI 项目实战！在这个项目中，帮助大家深入了解 FastAPI 框架的强大功能，并通过实际示例演示其灵活性和易用性。项目示例可以提供一个直观、易理解的教程，帮助您快速掌握 FastAPI 的核心概念和最佳实践。跟随我们一起探索，开启您的 FastAPI 之旅。通过一个魔兽世界游戏的职业信息库的增删改查需求来慢慢了解各个功能。</p> 
<h4><a id="71__196"></a>7-1. 项目目录结构</h4> 
<p>app0415</p> 
<ul><li>app ( package包，功能模块 ) 
  <ul><li><code>__init__.py</code></li><li><code>logger.py</code></li><li><code>main.py</code></li><li><code>todo.py</code></li></ul> </li><li>bin （ 项目执行入口 ） 
  <ul><li><code>run_server.py</code></li></ul> </li><li>config （ 配置文件 ） 
  <ul><li><code>config.py</code></li></ul> </li><li>log （ 日志输出 ） 
  <ul><li>app.log</li></ul> </li><li>tmp （存放临时文件用）</li><li>requirements.txt （ 模块依赖包清单 ）</li></ul> 
<p><img src="https://images2.imgbox.com/78/61/1P8TuWuI_o.png" alt=""></p> 
<h4><a id="72__218"></a>7-2. 准备工作</h4> 
<ul><li>需要一个MySQL数据库</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 建测试库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token identifier"><span class="token punctuation">`</span>wow<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">use</span> wow<span class="token punctuation">;</span>

<span class="token comment"># 创建测试表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色id'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色简称'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_cn<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>role_pinyin<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色拼音'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>zhuangbei<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'装备类型'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tianfu<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'天赋类型'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">667</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment"># 插入样例数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'fs'</span><span class="token punctuation">,</span> <span class="token string">'法师'</span><span class="token punctuation">,</span> <span class="token string">'fashi'</span><span class="token punctuation">,</span> <span class="token string">'布甲'</span><span class="token punctuation">,</span> <span class="token string">'冰法|火法|奥法'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'ms'</span><span class="token punctuation">,</span> <span class="token string">'牧师'</span><span class="token punctuation">,</span> <span class="token string">'mushi'</span><span class="token punctuation">,</span> <span class="token string">'布甲'</span><span class="token punctuation">,</span> <span class="token string">'神牧|戒律|暗牧'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'ss'</span><span class="token punctuation">,</span> <span class="token string">'术士'</span><span class="token punctuation">,</span> <span class="token string">'shushi'</span><span class="token punctuation">,</span> <span class="token string">'布甲'</span><span class="token punctuation">,</span> <span class="token string">'毁灭|痛苦|恶魔'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'dz'</span><span class="token punctuation">,</span> <span class="token string">'盗贼'</span><span class="token punctuation">,</span> <span class="token string">'daozei'</span><span class="token punctuation">,</span> <span class="token string">'皮甲'</span><span class="token punctuation">,</span> <span class="token string">'狂徒|刺杀|敏锐'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'ws'</span><span class="token punctuation">,</span> <span class="token string">'武僧'</span><span class="token punctuation">,</span> <span class="token string">'wuseng'</span><span class="token punctuation">,</span> <span class="token string">'皮甲'</span><span class="token punctuation">,</span> <span class="token string">'酒仙|踏风|织雾'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'xd'</span><span class="token punctuation">,</span> <span class="token string">'德鲁伊'</span><span class="token punctuation">,</span> <span class="token string">'xiaode'</span><span class="token punctuation">,</span> <span class="token string">'皮甲'</span><span class="token punctuation">,</span> <span class="token string">'恢复|平衡|野性|守护'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'dh'</span><span class="token punctuation">,</span> <span class="token string">'恶魔猎手'</span><span class="token punctuation">,</span> <span class="token string">'emolieshou'</span><span class="token punctuation">,</span> <span class="token string">'皮甲'</span><span class="token punctuation">,</span> <span class="token string">'复仇|浩劫'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'lr'</span><span class="token punctuation">,</span> <span class="token string">'猎人'</span><span class="token punctuation">,</span> <span class="token string">'lieren'</span><span class="token punctuation">,</span> <span class="token string">'锁甲'</span><span class="token punctuation">,</span> <span class="token string">'兽王|生存|射击'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'sm'</span><span class="token punctuation">,</span> <span class="token string">'萨满'</span><span class="token punctuation">,</span> <span class="token string">'saman'</span><span class="token punctuation">,</span> <span class="token string">'锁甲'</span><span class="token punctuation">,</span> <span class="token string">'恢复|增强|元素'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'long'</span><span class="token punctuation">,</span> <span class="token string">'龙人'</span><span class="token punctuation">,</span> <span class="token string">'longren'</span><span class="token punctuation">,</span> <span class="token string">'锁甲'</span><span class="token punctuation">,</span> <span class="token string">'湮灭|恩护|增辉'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'dk'</span><span class="token punctuation">,</span> <span class="token string">'死亡骑士'</span><span class="token punctuation">,</span> <span class="token string">'siwangqishi'</span><span class="token punctuation">,</span> <span class="token string">'板甲'</span><span class="token punctuation">,</span> <span class="token string">'鲜血|冰霜|邪恶'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'zs'</span><span class="token punctuation">,</span> <span class="token string">'战士'</span><span class="token punctuation">,</span> <span class="token string">'zhanshi'</span><span class="token punctuation">,</span> <span class="token string">'板甲'</span><span class="token punctuation">,</span> <span class="token string">'武器|狂暴|防护'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>wow_info<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">'sq'</span><span class="token punctuation">,</span> <span class="token string">'圣骑士'</span><span class="token punctuation">,</span> <span class="token string">'shengqi'</span><span class="token punctuation">,</span> <span class="token string">'板甲'</span><span class="token punctuation">,</span> <span class="token string">'神圣|防护|惩戒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li></ul> 
<p><img src="https://images2.imgbox.com/95/28/hrzwn7AJ_o.png" alt=""></p> 
<ul><li>Postman</li></ul> 
<p>有条件建议安装一个Postman接口调试工具，非常实用方便</p> 
<ul><li>pycharm开发工具和python环境</li></ul> 
<h4><a id="73__267"></a>7-3. 代码介绍</h4> 
<h5><a id="run_serverpy_269"></a>run_server.py</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0415</span>
<span class="token comment"># @File     :run_server.py</span>
<span class="token comment"># @Time     :2024/4/15 19:46</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">import</span> uvicorn

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"app.main:app"</span><span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">,</span> <span class="token builtin">reload</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="todopy_287"></a>todo.py</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0415</span>
<span class="token comment"># @File     :todo.py</span>
<span class="token comment"># @Time     :2024/4/15 19:46</span>
<span class="token comment"># @Author   :wangting_666</span>


<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> Optional
<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseModel
<span class="token keyword">import</span> pymysql

<span class="token comment"># MySQL连接配置</span>
config <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'host'</span><span class="token punctuation">:</span> <span class="token string">'wangting_host_ip'</span><span class="token punctuation">,</span>
    <span class="token string">'port'</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
    <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
    <span class="token string">'database'</span><span class="token punctuation">:</span> <span class="token string">'wow'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token comment"># 连接到MySQL数据库</span>
<span class="token keyword">def</span> <span class="token function">connect_to_mysql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token operator">**</span>config<span class="token punctuation">)</span>


<span class="token comment"># 定义WowInfo模型</span>
<span class="token keyword">class</span> <span class="token class-name">WowInfo</span><span class="token punctuation">(</span>BaseModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span>
    role<span class="token punctuation">:</span> <span class="token builtin">str</span>
    role_cn<span class="token punctuation">:</span> <span class="token builtin">str</span>
    role_pinyin<span class="token punctuation">:</span> <span class="token builtin">str</span>
    zhuangbei<span class="token punctuation">:</span> <span class="token builtin">str</span>
    tianfu<span class="token punctuation">:</span> <span class="token builtin">str</span>


<span class="token comment"># 获取所有魔兽职业信息</span>
<span class="token keyword">def</span> <span class="token function">get_wowinfo_all</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>WowInfo<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> connect_to_mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span>pymysql<span class="token punctuation">.</span>cursors<span class="token punctuation">.</span>DictCursor<span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT * FROM wow_info"</span><span class="token punctuation">)</span>
            info <span class="token operator">=</span> <span class="token punctuation">[</span>WowInfo<span class="token punctuation">(</span><span class="token operator">**</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> info
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"查不到职业信息: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>


<span class="token comment"># 获取单个魔兽职业信息</span>
<span class="token keyword">def</span> <span class="token function">get_wowinfo</span><span class="token punctuation">(</span>role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span>WowInfo<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> connect_to_mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span>pymysql<span class="token punctuation">.</span>cursors<span class="token punctuation">.</span>DictCursor<span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"SELECT * FROM wow_info WHERE role = %s"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>role<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            info <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> WowInfo<span class="token punctuation">(</span><span class="token operator">**</span>info<span class="token punctuation">)</span> <span class="token keyword">if</span> info <span class="token keyword">else</span> <span class="token boolean">None</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"查不到职业信息: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token comment"># 创建魔兽职业信息</span>
<span class="token keyword">def</span> <span class="token function">create_wowinfo</span><span class="token punctuation">(</span>wowinfo<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> WowInfo<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> connect_to_mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
                <span class="token string">"INSERT INTO wow_info (id,role, role_cn,role_pinyin,zhuangbei,tianfu) VALUES (%s, %s, %s,%s,%s,%s)"</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>wowinfo<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>role<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>role_cn<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>role_pinyin<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>zhuangbei<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>tianfu<span class="token punctuation">)</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wowinfo
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"创建职业信息失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token comment"># 更新魔兽职业信息</span>
<span class="token keyword">def</span> <span class="token function">update_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">[</span>WowInfo<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> connect_to_mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"UPDATE wow_info SET role=%s, role_cn=%s, role_pinyin=%s,zhuangbei=%s,tianfu=%s WHERE id=%s"</span><span class="token punctuation">,</span>
                           <span class="token punctuation">(</span>wowinfo<span class="token punctuation">.</span>role<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>role_cn<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>role_pinyin<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>zhuangbei<span class="token punctuation">,</span> wowinfo<span class="token punctuation">.</span>tianfu<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wowinfo
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"更新职业信息失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token comment"># 删除魔兽职业信息</span>
<span class="token keyword">def</span> <span class="token function">delete_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        conn <span class="token operator">=</span> connect_to_mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"DELETE FROM wow_info WHERE id = %s"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"删除职业信息失败: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre> 
<h5><a id="mainpy_397"></a>main.py</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0415</span>
<span class="token comment"># @File     :main.py</span>
<span class="token comment"># @Time     :2024/4/15 19:46</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI<span class="token punctuation">,</span> HTTPException
<span class="token keyword">from</span> config<span class="token punctuation">.</span>config <span class="token keyword">import</span> settings
<span class="token keyword">from</span> app<span class="token punctuation">.</span>logger <span class="token keyword">import</span> logger
<span class="token keyword">from</span> app<span class="token punctuation">.</span>todo <span class="token keyword">import</span> WowInfo<span class="token punctuation">,</span> get_wowinfo_all<span class="token punctuation">,</span> get_wowinfo<span class="token punctuation">,</span> create_wowinfo<span class="token punctuation">,</span> update_wowinfo<span class="token punctuation">,</span> delete_wowinfo
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span>title<span class="token operator">=</span>settings<span class="token punctuation">.</span>app_name<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/get_wowinfo_all/"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>List<span class="token punctuation">[</span>WowInfo<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_wowinfos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"查询所有魔兽世界角色..."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> get_wowinfo_all<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/get_wowinfo/{role}"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_wowinfo</span><span class="token punctuation">(</span>role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"查询魔兽世界角色名称为: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>role<span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> get_wowinfo<span class="token punctuation">(</span>role<span class="token punctuation">)</span>
    <span class="token keyword">if</span> info <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f" 角色 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>role<span class="token punctuation">}</span></span><span class="token string"> 不存在."</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"查询失败"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> info


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/create_wowinfo/"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">create_new_wowinfo</span><span class="token punctuation">(</span>info<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"创建魔兽世界角色"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> create_wowinfo<span class="token punctuation">(</span>info<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>put</span><span class="token punctuation">(</span><span class="token string">"/update_wowinfo/{id}"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">update_existing_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"更新魔兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    existing_info <span class="token operator">=</span> update_wowinfo<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">)</span>
    <span class="token keyword">if</span> existing_info <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"职业信息ID:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">不存在"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"职业信息ID不存在"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> existing_info


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>delete</span><span class="token punctuation">(</span><span class="token string">"/delete_wowinfo/{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">delete_existing_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"删除魔兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    success <span class="token operator">=</span> delete_wowinfo<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> success<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string"> 不存在"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"id 不存在"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"删除魔兽世界角色 id {id}成功"</span><span class="token punctuation">}</span>
</code></pre> 
<h5><a id="loggerpy_460"></a>logger.py</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0415</span>
<span class="token comment"># @File     :logger.py</span>
<span class="token comment"># @Time     :2024/4/15 19:46</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">import</span> logging
<span class="token keyword">from</span> config<span class="token punctuation">.</span>config <span class="token keyword">import</span> settings
<span class="token keyword">import</span> os

log_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"../log"</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>log_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

logging<span class="token punctuation">.</span>basicConfig<span class="token punctuation">(</span>filename<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>log_dir<span class="token punctuation">,</span> <span class="token string">"app.log"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> level<span class="token operator">=</span>settings<span class="token punctuation">.</span>log_level<span class="token punctuation">)</span>
logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="configpy_483"></a>config.py</h5> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0415</span>
<span class="token comment"># @File     :config.py</span>
<span class="token comment"># @Time     :2024/4/15 19:46</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">from</span> pydantic <span class="token keyword">import</span> BaseSettings


<span class="token keyword">class</span> <span class="token class-name">Settings</span><span class="token punctuation">(</span>BaseSettings<span class="token punctuation">)</span><span class="token punctuation">:</span>
    app_name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"TodoApp"</span>
    log_level<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">"INFO"</span>


settings <span class="token operator">=</span> Settings<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="74__506"></a>7-4. 运行服务进行验证</h4> 
<h5><a id="741__508"></a>7-4-1. 启动服务</h5> 
<p>pycharm方式</p> 
<p><img src="https://images2.imgbox.com/fd/9d/YsnOQRwn_o.png" alt=""></p> 
<blockquote> 
 <p>我这里是通过pycharm方式，如果是服务器运行，只需要执行<code>python3 /home/wangting/run_server.py</code>运行起来即可</p> 
</blockquote> 
<p>开始功能测试之前，可以通过上方介绍的<code>/docs</code>接口查看自动生成的接口文档</p> 
<p><code>http://127.0.0.1:8000/docs</code></p> 
<p><img src="https://images2.imgbox.com/07/af/QIKc8Elq_o.png" alt=""></p> 
<h5><a id="742__524"></a>7-4-2. 验证服务</h5> 
<p>后续验证服务，get请求可以通过浏览器、postman、接口的/docs功能均可；我这里使用postman进行演示，也可以通过上方介绍的/docs中try it out 中进行execute进行调试验证</p> 
<ul><li>get_wowinfo_all</li></ul> 
<blockquote> 
 <p>get_wowinfo_all 对应了<code>get_wowinfo_all</code>方法，<code>@app.get</code>可以看出是get请求，路由是<code>/get_wowinfo_all</code></p> 
 <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/get_wowinfo_all/"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>List<span class="token punctuation">[</span>WowInfo<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_wowinfos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"查询所有魔兽世界角色..."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> get_wowinfo_all<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
</blockquote> 
<p><img src="https://images2.imgbox.com/0b/e6/poa1K6ob_o.png" alt=""></p> 
<ul><li>/get_wowinfo/{role}</li></ul> 
<blockquote> 
 <p>/get_wowinfo/{role} 对应了<code>get_wowinfo</code>方法，<code>@app.get</code>可以看出也是get请求，路由是<code>/get_wowinfo_all/{role}</code></p> 
 <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/get_wowinfo/{role}"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">read_wowinfo</span><span class="token punctuation">(</span>role<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"查询魔兽世界角色名称为: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>role<span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> get_wowinfo<span class="token punctuation">(</span>role<span class="token punctuation">)</span>
    <span class="token keyword">if</span> info <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f" 角色 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>role<span class="token punctuation">}</span></span><span class="token string"> 不存在."</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"查询失败"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> info
</code></pre> 
</blockquote> 
<ul><li></ul> 
<p><img src="https://images2.imgbox.com/f3/1d/4glcIs0z_o.png" alt=""></p> 
<ul><li>create_wowinfo</li></ul> 
<blockquote> 
 <p>create_wowinfo 对应了<code>create_wowinfo</code>方法，<code>@app.post</code>可以看出是post请求，路由是<code>/create_wowinfo/</code></p> 
 <p>但与get请求不同的是，post请求需要提供body请求体</p> 
 <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role"</span><span class="token operator">:</span> <span class="token string">"create_role"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role_cn"</span><span class="token operator">:</span> <span class="token string">"create_role_cn"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role_pinyin"</span><span class="token operator">:</span> <span class="token string">"create_role_pinyin"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"zhuangbei"</span><span class="token operator">:</span> <span class="token string">"create_zhuangbei"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tianfu"</span><span class="token operator">:</span> <span class="token string">"create_tianfu"</span>
<span class="token punctuation">}</span>
</code></pre> 
 <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">"/create_wowinfo/"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">create_new_wowinfo</span><span class="token punctuation">(</span>info<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"创建魔兽世界角色"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> create_wowinfo<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
</code></pre> 
</blockquote> 
<ul><li></ul> 
<p><img src="https://images2.imgbox.com/c0/10/sQ3niHel_o.png" alt=""></p> 
<p>此时查看一下MySQL数据库，验证是否真的写入到数据库</p> 
<p><img src="https://images2.imgbox.com/00/35/6uX8JG3b_o.png" alt=""></p> 
<ul><li>update_wowinfo/{id}</li></ul> 
<blockquote> 
 <p>update_wowinfo/{id} 对应了<code>update_wowinfo</code>方法，<code>@app.put</code>可以看出是put请求，路由是<code>/update_wowinfo/{id}</code></p> 
 <p>与post请求一样，也需要提供body请求体</p> 
 <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role"</span><span class="token operator">:</span> <span class="token string">"update_role"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role_cn"</span><span class="token operator">:</span> <span class="token string">"update_role_cn"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"role_pinyin"</span><span class="token operator">:</span> <span class="token string">"update_role_pinyin"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"zhuangbei"</span><span class="token operator">:</span> <span class="token string">"update_zhuangbei"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tianfu"</span><span class="token operator">:</span> <span class="token string">"update_tianfu"</span>
<span class="token punctuation">}</span>
</code></pre> 
 <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>put</span><span class="token punctuation">(</span><span class="token string">"/update_wowinfo/{id}"</span><span class="token punctuation">,</span> response_model<span class="token operator">=</span>WowInfo<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">update_existing_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">:</span> WowInfo<span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"更新魔兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    existing_info <span class="token operator">=</span> update_wowinfo<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> wowinfo<span class="token punctuation">)</span>
    <span class="token keyword">if</span> existing_info <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"职业信息ID:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">不存在"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"职业信息ID不存在"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> existing_info
</code></pre> 
</blockquote> 
<ul><li></ul> 
<p><img src="https://images2.imgbox.com/20/16/hidNWuoB_o.png" alt=""></p> 
<p>查询数据库数据，id=666的数据内容已经被修改</p> 
<pre><code class="prism language-shell">MariaDB <span class="token punctuation">[</span>wow<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> * from wow_info where <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token number">666</span> <span class="token punctuation">\</span>G<span class="token punctuation">;</span>
*************************** <span class="token number">1</span>. row ***************************
         id: <span class="token number">666</span>
       role: update_role
    role_cn: update_role_cn
role_pinyin: update_role_pinyin
  zhuangbei: update_zhuangbei
     tianfu: update_tianfu
</code></pre> 
<ul><li>delete_wowinfo/{id}</li></ul> 
<blockquote> 
 <p>delete_wowinfo/{id} 对应了<code>delete_wowinfo</code>方法，<code>@app.delete</code>可以看出是delete请求，路由是<code>/delete_wowinfo/{id}</code></p> 
 <pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>delete</span><span class="token punctuation">(</span><span class="token string">"/delete_wowinfo/{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">delete_existing_wowinfo</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"删除魔兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span>
    success <span class="token operator">=</span> delete_wowinfo<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> success<span class="token punctuation">:</span>
        logger<span class="token punctuation">.</span>error<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"兽世界角色 id </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string"> 不存在"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> HTTPException<span class="token punctuation">(</span>status_code<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">,</span> detail<span class="token operator">=</span><span class="token string">"id 不存在"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token punctuation">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"删除魔兽世界角色 id {id}成功"</span><span class="token punctuation">}</span>
</code></pre> 
</blockquote> 
<ul><li></ul> 
<p><img src="https://images2.imgbox.com/d9/1a/4n737fhZ_o.png" alt=""></p> 
<p>此时查询数据库数据id=666的数据内容已经不存在了</p> 
<pre><code class="prism language-shell">MariaDB <span class="token punctuation">[</span>wow<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> * from wow_info where <span class="token assign-left variable">id</span><span class="token operator">=</span><span class="token number">666</span> <span class="token punctuation">\</span>G<span class="token punctuation">;</span>
Empty <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="743__671"></a>7-4-3. 项目实战总结</h4> 
<p>​ 这个 FastAPI 项目展示了一个完整的后端应用程序，用于管理魔兽世界角色的信息。通过这个项目，我们深入了解了 FastAPI 框架的使用，以及如何构建 RESTful API。</p> 
<p>​ 首先，我们学习了如何定义数据模型，使用 Pydantic 创建了 <code>WowInfo</code> 模型来表示魔兽世界角色的信息。然后，我们编写了一系列处理 CRUD 操作的函数，用于获取、创建、更新和删除角色信息。这些函数与 MySQL 数据库进行交互，通过 pymysql 库执行 SQL 查询和操作。</p> 
<p>​ 接下来，我们使用 FastAPI 创建了一个基于路由的 Web 服务，定义了不同的端点来处理不同的 HTTP 请求。通过最常用的装饰器 <code>@app.get</code>、<code>@app.post</code>、<code>@app.put</code> 和 <code>@app.delete</code>，我们将每个端点与对应的处理函数绑定在一起。</p> 
<p>​ 最后，我们使用了日志记录功能和配置设置，使项目更具可维护性和可扩展性。我们将日志记录到文件中，并使用配置类来管理应用程序的设置。</p> 
<p>​ 这个项目为我们提供了一个完整的 FastAPI 实战示例，展示了如何使用 FastAPI 框架构建一个简单但功能完备的后端应用程序。通过这个示例，我们不仅学习了 FastAPI 框架的核心概念和基本用法，还掌握了与数据库交互、路由定义、日志记录等高级功能。</p> 
<h3><a id="8_2__685"></a>8. 项目实战示例2 (前后端)</h3> 
<h4><a id="81__687"></a>8-1. 项目目录结构</h4> 
<ul><li>app0416 
  <ul><li>server_monitor_frontend 
    <ul><li>index.html</li></ul> </li><li>server_monitor_backend.py</li></ul> </li></ul> 
<p>示例是一个前后端协作，仅展示逻辑demo，没有加入太多的功能模块</p> 
<p>在 app0416 目录下有一个名为 server_monitor_backend.py 的文件，用于启动后端 FastAPI 服务器。在同一目录下还有一个名为 server_monitor_frontend 的文件夹，其中包含一个名为 index.html 的文件，用于显示服务器监控系统的界面。如果需要自定义样式，可以在 server_monitor_frontend 文件夹中创建一个名为 style.css 的文件，并在 index.html 中引入，此目录主要用来开发前端功能。最终实现打开<code>http://127.0.0.1:8000/</code>，可以5秒刷新展示一次系统的服务器资源情况。</p> 
<h4><a id="82__700"></a>8-2. 代码介绍</h4> 
<ul><li>server_monitor_backend.py</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Project  :app0416</span>
<span class="token comment"># @File     :server_monitor_backend.py.py</span>
<span class="token comment"># @Time     :2024/4/16 19:58</span>
<span class="token comment"># @Author   :wangting_666</span>

<span class="token keyword">from</span> fastapi <span class="token keyword">import</span> FastAPI
<span class="token keyword">from</span> fastapi<span class="token punctuation">.</span>staticfiles <span class="token keyword">import</span> StaticFiles
<span class="token keyword">from</span> starlette<span class="token punctuation">.</span>responses <span class="token keyword">import</span> HTMLResponse<span class="token punctuation">,</span> FileResponse

app <span class="token operator">=</span> FastAPI<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 将静态文件目录设置为 server_monitor_frontend 目录</span>
app<span class="token punctuation">.</span>mount<span class="token punctuation">(</span><span class="token string">"/static"</span><span class="token punctuation">,</span> StaticFiles<span class="token punctuation">(</span>directory<span class="token operator">=</span><span class="token string">"server_monitor_frontend"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"static"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> response_class<span class="token operator">=</span>HTMLResponse<span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_index_page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> FileResponse<span class="token punctuation">(</span><span class="token string">"server_monitor_frontend/index.html"</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>get</span><span class="token punctuation">(</span><span class="token string">"/stats"</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">get_server_stats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Your server stats logic here</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"cpu_percent"</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">"memory_percent"</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token string">"disk_percent"</span><span class="token punctuation">:</span> <span class="token number">70</span><span class="token punctuation">}</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">import</span> uvicorn

    uvicorn<span class="token punctuation">.</span>run<span class="token punctuation">(</span>app<span class="token punctuation">,</span> host<span class="token operator">=</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><li> <p>index.html</p> </li></ul> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>服务器资源监控<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">body</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">font-family</span><span class="token punctuation">:</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Server Monitor<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stats<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">fetchStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8000/stats'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'stats'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                        &lt;p&gt;&lt;h3&gt;CPU使用率: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>data<span class="token punctuation">.</span>cpu_percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%&lt;/h3&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;h3&gt;内存使用率: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>data<span class="token punctuation">.</span>memory_percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%&lt;/h3&gt;&lt;/p&gt;
                        &lt;p&gt;&lt;h3&gt;磁盘使用率: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>data<span class="token punctuation">.</span>disk_percent<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%&lt;/h3&gt;&lt;/p&gt;
                    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error fetching stats:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">fetchStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span>fetchStats<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fetch stats every 5 seconds</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="83__780"></a>8-3. 运行服务进行验证</h4> 
<p>运行<code>server_monitor_backend.py</code></p> 
<p>打开URL ： <code>http://127.0.0.1:8000/</code></p> 
<p><img src="https://images2.imgbox.com/cf/5e/DtVEPGHz_o.png" alt=""></p> 
<h4><a id="84__788"></a>8-4. 前后端示例总结</h4> 
<p>这个案例演示了如何使用 FastAPI 构建一个简单的服务器监控系统。后端 FastAPI 提供了 <code>/stats</code> 路由，用于获取服务器的监控数据，而前端界面通过 JavaScript 定时获取数据并动态显示在页面上。这个示例结合了后端和前端技术，展示了如何利用 FastAPI 快速构建 API，以及如何使用 JavaScript 实现动态页面交互。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c65501702f36fce3fd78da486d916b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Name for argument of type [java.lang.String] not specified, and parameter name information not avail</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c5c644dcb8aadc6402a181b231241a1e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JavaSE】搞定String类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>