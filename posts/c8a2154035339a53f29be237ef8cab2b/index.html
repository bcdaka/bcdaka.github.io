<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【postgresql初级使用】视图上的触发器instead of，替代计划的rewrite，实现不一样的审计日志 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c8a2154035339a53f29be237ef8cab2b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【postgresql初级使用】视图上的触发器instead of，替代计划的rewrite，实现不一样的审计日志">
  <meta property="og:description" content="instead of 触发器 ​专栏内容：
postgresql使用入门基础手写数据库toadb并发编程 个人主页：我的主页
管理社区：开源数据库
座右铭：天行健，君子以自强不息；地势坤，君子以厚德载物.
文章目录 instead of 触发器概述 机制原理 INSTEAD OF 触发器语法 INSTEAD OF 触发器执行步骤 多触发器的优先级 审计案例解析 数据准备 创建两张数据表创建视图创建执行函数创建触发器 结果展示 信息查看新员工入职变岗调薪 总结 结尾 概述 在postgresql 中，触发器与SQL标准相比，有一个扩展特性就是可以在视图上创建触发器。
在视图上的触发器类型是’INSTEAD OF`，可以在insert, update, delete事件的before或after进行触发，
本文就来详细分享一下，并通过一个实用的审计数据的案例来展示效果。
机制原理 下面先来介绍SQL语法，然后通过介绍它的执行过程，了解它的机制原理。
INSTEAD OF 触发器语法 视图触发器的创建语法如下：
CREATE TRIGGER trigger_name INSTEAD OF [INSERT OR UPDATE OR DELETE] ON table_name FOR EACH ROW EXECUTE FUNCTION trigger_function; 在视图上的触发器，类型只有INSTEAT OF，而且它对应的触发器件有insert,update,delete，此处没有truncate事件。
另外，instead of 触发器也只能定义为行级触发器，这个原因下面会分析。
INSTEAD OF 触发器执行步骤 视图触发器执行的步骤如下
当在视图上执行INSERT、UPDATE或DELETE操作时，如果为该视图定义了INSTEAD OF触发器，那么这些操作不会直接对视图或其基础表执行。相反地，INSTEAD OF触发器会代替这些操作执行。也就是说，对于需要修改的每一行，都会触发INSTEAD OF触发器。触发器的函数需要负责执行必要的修改到视图的基础表，并在适当的情况下返回修改后的行，以便在视图中显示。这允许开发者在不影响基础表结构的情况下，通过视图执行复杂的操作逻辑。 如果视图上没有INSTEAD OF触发器，那么对视图的操作必须被转换为对基础表的操作，是直接操作基础表。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-08T09:03:44+08:00">
    <meta property="article:modified_time" content="2024-06-08T09:03:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【postgresql初级使用】视图上的触发器instead of，替代计划的rewrite，实现不一样的审计日志</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="instead_of__0"></a>instead of 触发器</h2> 
<blockquote> 
 <p>​<strong>专栏内容</strong>：</p> 
 <ul><li><a href="https://blog.csdn.net/senllang/category_12346885.html">postgresql使用入门基础</a></li><li><a href="https://senllang.blog.csdn.net/category_12338586.html" rel="nofollow">手写数据库toadb</a></li><li><a href="https://blog.csdn.net/senllang/category_12265530.html">并发编程</a></li></ul> 
</blockquote> 
<blockquote> 
 <p><strong>个人主页</strong>：<a href="https://senllang.blog.csdn.net" rel="nofollow">我的主页</a><br> <strong>管理社区</strong>：<a href="https://bbs.csdn.net/forums/a0a6ea788b3949b6a06ab4811f9eec5d">开源数据库</a><br> <strong>座右铭：天行健，君子以自强不息；地势坤，君子以厚德载物.</strong></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#instead_of__0" rel="nofollow">instead of 触发器</a></li><li><a href="#font_colorA0522D_font_13" rel="nofollow"><font color="#A0522D">概述 </font></a></li><li><a href="#font_colorA0522D_font_21" rel="nofollow"><font color="#A0522D">机制原理 </font></a></li><li><ul><li><a href="#font_colorA0522DINSTEAD_OF__font_26" rel="nofollow"><font color="#A0522D">INSTEAD OF 触发器语法 </font></a></li><li><a href="#font_colorA0522DINSTEAD_OF__font_42" rel="nofollow"><font color="#A0522D">INSTEAD OF 触发器执行步骤 </font></a></li><li><a href="#font_colorA0522D_font_58" rel="nofollow"><font color="#A0522D">多触发器的优先级 </font></a></li></ul> 
  </li><li><a href="#font_colorA0522D__font_65" rel="nofollow"><font color="#A0522D"> 审计案例解析 </font></a></li><li><ul><li><a href="#font_colorA0522D__font_77" rel="nofollow"><font color="#A0522D"> 数据准备 </font></a></li><li><ul><li><a href="#_79" rel="nofollow">创建两张数据表</a></li><li><a href="#_98" rel="nofollow">创建视图</a></li><li><a href="#_110" rel="nofollow">创建执行函数</a></li><li><a href="#_150" rel="nofollow">创建触发器</a></li></ul> 
   </li><li><a href="#font_colorA0522D__font_160" rel="nofollow"><font color="#A0522D"> 结果展示 </font></a></li><li><ul><li><a href="#_164" rel="nofollow">信息查看</a></li><li><a href="#_180" rel="nofollow">新员工入职</a></li><li><a href="#_200" rel="nofollow">变岗调薪</a></li></ul> 
  </li></ul> 
  </li><li><a href="#font_colorA0522D_font_224" rel="nofollow"><font color="#A0522D">总结 </font></a></li><li><a href="#font_colorA0522D_font_228" rel="nofollow"><font color="#A0522D">结尾 </font></a></li></ul> 
</div> 
<p></p> 
<h2><a id="font_colorA0522D_font_13"></a><font color="#A0522D">概述 </font></h2> 
<hr> 
<p>在postgresql 中，触发器与SQL标准相比，有一个扩展特性就是可以在视图上创建触发器。</p> 
<p>在视图上的触发器类型是’INSTEAD OF`，可以在insert, update, delete事件的before或after进行触发，<br> 本文就来详细分享一下，并通过一个实用的审计数据的案例来展示效果。</p> 
<h2><a id="font_colorA0522D_font_21"></a><font color="#A0522D">机制原理 </font></h2> 
<hr> 
<p>下面先来介绍SQL语法，然后通过介绍它的执行过程，了解它的机制原理。</p> 
<h3><a id="font_colorA0522DINSTEAD_OF__font_26"></a><font color="#A0522D">INSTEAD OF 触发器语法 </font></h3> 
<p>视图触发器的创建语法如下：</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> trigger_name
INSTEAD <span class="token keyword">OF</span> <span class="token punctuation">[</span><span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token operator">OR</span> <span class="token keyword">DELETE</span><span class="token punctuation">]</span>
<span class="token keyword">ON</span> table_name
<span class="token keyword">FOR EACH ROW</span> 
<span class="token keyword">EXECUTE</span> <span class="token keyword">FUNCTION</span> trigger_function<span class="token punctuation">;</span>
</code></pre> 
<p>在视图上的触发器，类型只有INSTEAT OF，而且它对应的触发器件有insert,update,delete，此处没有truncate事件。</p> 
<p>另外，instead of 触发器也只能定义为行级触发器，这个原因下面会分析。</p> 
<h3><a id="font_colorA0522DINSTEAD_OF__font_42"></a><font color="#A0522D">INSTEAD OF 触发器执行步骤 </font></h3> 
<p><strong>视图触发器执行的步骤如下</strong></p> 
<ul><li>当在视图上执行INSERT、UPDATE或DELETE操作时，如果为该视图定义了INSTEAD OF触发器，那么这些操作不会直接对视图或其基础表执行。</li><li>相反地，INSTEAD OF触发器会代替这些操作执行。也就是说，对于需要修改的每一行，都会触发INSTEAD OF触发器。</li><li>触发器的函数需要负责执行必要的修改到视图的基础表，并在适当的情况下返回修改后的行，以便在视图中显示。</li><li>这允许开发者在不影响基础表结构的情况下，通过视图执行复杂的操作逻辑。</li></ul> 
<p><img src="https://images2.imgbox.com/c3/e6/LAWwT2D9_o.png" alt="在这里插入图片描述"></p> 
<p>如果视图上没有INSTEAD OF触发器，那么对视图的操作必须被转换为对基础表的操作，是直接操作基础表。</p> 
<h3><a id="font_colorA0522D_font_58"></a><font color="#A0522D">多触发器的优先级 </font></h3> 
<ul><li>除了INSTEAD OF触发器外，还可以在视图上定义在INSERT、UPDATE或DELETE操作之前或之后执行的触发器。</li><li>但是，这些触发器只有在视图上也有INSTEAD OF触发器的情况下才会被触发。</li><li>如果没有INSTEAD OF触发器，那么任何针对视图的SQL语句都必须被重写为影响基础表的语句，然后触发的是附加到基础表上的触发器。</li></ul> 
<h2><a id="font_colorA0522D__font_65"></a><font color="#A0522D"> 审计案例解析 </font></h2> 
<hr> 
<p>为了信息的安全，一般系统都会有审计这个功能，其中审计日志会把操作记录详细记录下来，会定期时行审计或者出问题时能够帮助回溯。</p> 
<p>下面就来分享一个通过触发器实现的审计日志功能，大概设计如下：</p> 
<ul><li>应用一般不会对物理表进行直接操作，而对给它们创建对应的视图，只看到部分数据；</li><li>对于每个视图的操作事件，创建instead of类型的触发器；</li><li>在视图触发器中，对于操作的类型，数据，以及操作者用户都记录到表中；</li></ul> 
<h3><a id="font_colorA0522D__font_77"></a><font color="#A0522D"> 数据准备 </font></h3> 
<h4><a id="_79"></a>创建两张数据表</h4> 
<ul><li>一张是数据信息表emp，记录员工的薪记信息；</li><li>一张是审计数据表emp_audit， 记录操作类型，操作员，数据变动，以及时间。</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp <span class="token punctuation">(</span>
  empname <span class="token keyword">text</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  salary <span class="token keyword">integer</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp_audit<span class="token punctuation">(</span>
  operation <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  userid <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  empname <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  salary <span class="token keyword">integer</span><span class="token punctuation">,</span>
  stamp <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_98"></a>创建视图</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> emp_view <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>empname<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>salary<span class="token punctuation">,</span>
    <span class="token function">max</span><span class="token punctuation">(</span>ea<span class="token punctuation">.</span>stamp<span class="token punctuation">)</span> <span class="token keyword">AS</span> last_updated
<span class="token keyword">FROM</span> emp e
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> emp_audit ea <span class="token keyword">ON</span> ea<span class="token punctuation">.</span>empname <span class="token operator">=</span> e<span class="token punctuation">.</span>empname
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_110"></a>创建执行函数</h4> 
<ul><li>在delete时，先删除基础表的数据；如果删除成功，再插入审计表，操作类型为’D’，否则不操作审计表；</li><li>在update时，同上，先更新基础表；如果成功，才插入审计表；</li><li>在insert时，先插入基础表；然后操作审计表；</li><li>每次都将操作时间更新为当前时间；</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> update_emp_view<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">AS</span> $$
<span class="token keyword">BEGIN</span>
  <span class="token keyword">IF</span> <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'DELETE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
      <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> empname <span class="token operator">=</span> OLD<span class="token punctuation">.</span>empname<span class="token punctuation">;</span>
      <span class="token keyword">IF</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">THEN</span> 
          <span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span> 
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

      OLD<span class="token punctuation">.</span>last_updated <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_audit <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'D'</span><span class="token punctuation">,</span> <span class="token keyword">current_user</span><span class="token punctuation">,</span> OLD<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> OLD<span class="token punctuation">;</span>
  ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'UPDATE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
      <span class="token keyword">UPDATE</span> emp <span class="token keyword">SET</span> salary <span class="token operator">=</span> NEW<span class="token punctuation">.</span>salary <span class="token keyword">WHERE</span> empname <span class="token operator">=</span> OLD<span class="token punctuation">.</span>empname<span class="token punctuation">;</span>

      <span class="token keyword">IF</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">THEN</span> 
          <span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span> 
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

      NEW<span class="token punctuation">.</span>last_updated <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_audit <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'U'</span><span class="token punctuation">,</span> <span class="token keyword">current_user</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span>
  ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'INSERT'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token keyword">VALUES</span><span class="token punctuation">(</span>NEW<span class="token punctuation">.</span>empname<span class="token punctuation">,</span> NEW<span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
      NEW<span class="token punctuation">.</span>last_updated <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp_audit <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token keyword">current_user</span><span class="token punctuation">,</span> NEW<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
$$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_150"></a>创建触发器</h4> 
<p>在视图emp_view上创建instead of类型的触发器，使用上面定义的函数。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> emp_audit
  INSTEAD <span class="token keyword">OF</span> <span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token operator">OR</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> emp_view
  <span class="token keyword">FOR EACH ROW</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">FUNCTION</span> update_emp_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="font_colorA0522D__font_160"></a><font color="#A0522D"> 结果展示 </font></h3> 
<p>测试一下审计模块的效果。</p> 
<h4><a id="_164"></a>信息查看</h4> 
<p>员工管理系统中，对于薪资表结构如下：</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">\</span>d emp_view
                          View <span class="token string">"senlleng.emp_view"</span>
    Column    <span class="token operator">|</span>            Type             <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span> Default
--------------+-----------------------------+-----------+----------+---------
 empname      <span class="token operator">|</span> text                        <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 salary       <span class="token operator">|</span> integer                     <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
 last_updated <span class="token operator">|</span> timestamp without <span class="token function">time</span> zone <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span>
Triggers:
    emp_audit INSTEAD OF INSERT OR DELETE OR UPDATE ON emp_view FOR EACH ROW EXECUTE FUNCTION update_emp_view<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_180"></a>新员工入职</h4> 
<p>有新员工入职，录入新员工的薪资。</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> insert into emp_view values<span class="token punctuation">(</span><span class="token string">'zhanglei'</span>, <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
INSERT <span class="token number">0</span> <span class="token number">1</span>
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> insert into emp_view values<span class="token punctuation">(</span><span class="token string">'wangguo'</span>, <span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
INSERT <span class="token number">0</span> <span class="token number">1</span>
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> * from emp_audit <span class="token punctuation">;</span>
 operation <span class="token operator">|</span>  userid  <span class="token operator">|</span> empname  <span class="token operator">|</span> salary <span class="token operator">|</span>           stamp
-----------+----------+----------+--------+----------------------------
 I         <span class="token operator">|</span> senllang <span class="token operator">|</span> zhanglei <span class="token operator">|</span>  <span class="token number">10000</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:13:05.829596
 I         <span class="token operator">|</span> senllang <span class="token operator">|</span> wangguo  <span class="token operator">|</span>   <span class="token number">8000</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:13:24.125127
<span class="token punctuation">(</span><span class="token number">2</span> rows<span class="token punctuation">)</span>

</code></pre> 
<p>有两名新员工入职，可以看到是那个操作员录入的，并且当前录入的时间，信息都可以看到。</p> 
<h4><a id="_200"></a>变岗调薪</h4> 
<p>当人员调岗时，对应的薪资也会发生变化；</p> 
<p>或者人员离职时，需要删除对应的记录。</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> update emp_view <span class="token builtin class-name">set</span> salary <span class="token operator">=</span> <span class="token number">7500</span> where <span class="token assign-left variable">empname</span><span class="token operator">=</span><span class="token string">'wangguo'</span><span class="token punctuation">;</span>
UPDATE <span class="token number">1</span>
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> delete from emp_view where <span class="token assign-left variable">empname</span><span class="token operator">=</span><span class="token string">'zhanglei'</span><span class="token punctuation">;</span>
DELETE <span class="token number">1</span>
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> * from emp_audit <span class="token punctuation">;</span>
 operation <span class="token operator">|</span>  userid  <span class="token operator">|</span> empname  <span class="token operator">|</span> salary <span class="token operator">|</span>           stamp
-----------+----------+----------+--------+----------------------------
 I         <span class="token operator">|</span> senllang <span class="token operator">|</span> zhanglei <span class="token operator">|</span>  <span class="token number">10000</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:13:05.829596
 I         <span class="token operator">|</span> senllang <span class="token operator">|</span> wangguo  <span class="token operator">|</span>   <span class="token number">8000</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:13:24.125127
 U         <span class="token operator">|</span> senllang <span class="token operator">|</span> wangguo  <span class="token operator">|</span>   <span class="token number">7500</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:14:30.737416
 D         <span class="token operator">|</span> senllang <span class="token operator">|</span> zhanglei <span class="token operator">|</span>  <span class="token number">10000</span> <span class="token operator">|</span> <span class="token number">2024</span>-06-06 08:14:53.089083
<span class="token punctuation">(</span><span class="token number">4</span> rows<span class="token punctuation">)</span>

</code></pre> 
<p>当然审计表的权限是非常高的，只有在审计系统中才能查看，而且审计数据是不能删除的。</p> 
<h2><a id="font_colorA0522D_font_224"></a><font color="#A0522D">总结 </font></h2> 
<hr> 
<p>在视图上的instead of 触发器，可以将原本的执行计划重写 替换为触发器执行，这样可以进行更为复杂的动作，这里以审计为例，演示了触发器的效果。</p> 
<h2><a id="font_colorA0522D_font_228"></a><font color="#A0522D">结尾 </font></h2> 
<hr> 
<blockquote> 
 <p><strong>非常感谢大家的支持，在浏览的同时别忘了留下您宝贵的评论，如果觉得值得鼓励，请点赞，收藏，我会更加努力！</strong></p> 
</blockquote> 
<p>作者邮箱：study@senllang.onaliyun.com<br> 如有错误或者疏漏欢迎指出，互相学习。</p> 
<p>注：未经同意，不得转载！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/05aafb2d5d3b0ca9850d426fea18662d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【postgresql初级使用】触发器的创建删除，你不知道的触发器函数中的系统变量，数据一致性还可以这样来保证</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5189c51c52140b946dad3f94f568475b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android 14 Audio模块 音量增益 framework到HAL 层加载流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>