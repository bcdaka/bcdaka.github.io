<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>保姆级amd显卡win11搭建stable diffusion教程，GPU运算，而不是CPU运算！！！ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/46491dbe83ef6bb55bd0d5755722a9c4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="保姆级amd显卡win11搭建stable diffusion教程，GPU运算，而不是CPU运算！！！">
  <meta property="og:description" content="1.安装Git 2.安装python python版本一定要是3.10.6 如果是其他版本，请卸载后再重新安装此版本
3.git代理配置 此步骤主要是解决拉github源码慢的问题，如果有vpn客户端的同学，记得要单独再配置下git的代理配置(可具体查看自己开启VPN后的代理ip 端口，配置一样即可)。
开了VPN没配置git代理，正常网站进外网和github下载很快，但git命令拉取很慢？
网站会检查电脑的代理配置并使用，而git是检查git单独的代理配置，所以得配
4.stable diffusion web UI 源码包下载 源码地址 https://github.com/lshqqytiger/k-diffusion-directml.git
找一个纯英文目录的文件夹用于存放你的sd程序，执行命令拉取源码。注意这里是directml版本的了，这是为AMD显卡适配新二开的源码。
git clone https://github.com/lshqqytiger/k-diffusion-directml.git
如果网络没问题且配置了代理的话按步骤下好就行了
下好后直接双击执行里面的webui-user.bat 脚本
中间会下载各种的依赖库，会下载到根目录下的repositories文件夹里面
问题:
1.中间下载依赖包时出现各种git fetch失败情况的话，进入对应的依赖目录中，在上面的url上或者在文件夹空白部分右键进入git bash/cmd
然后执行git fetch 执行如果出现
git config --global --add safe.directory ‘F:/Stable Diffusion/stable-diffusion-webui’ fatal: detected dubious ownership in repository at ‘F:/Stable Diffusion/stable-diffusion-webui’ ‘F:/Stable Diffusion/stable-diffusion-webui’ is on a file system that does not record ownership To add an exception for this directory, call: git config --global --add safe.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-16T16:19:30+08:00">
    <meta property="article:modified_time" content="2024-01-16T16:19:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">保姆级amd显卡win11搭建stable diffusion教程，GPU运算，而不是CPU运算！！！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1Git_0"></a>1.安装Git</h3> 
<h3><a id="2python_4"></a>2.安装python</h3> 
<p>python版本一定要是3.10.6 如果是其他版本，请卸载后再重新安装此版本</p> 
<h3><a id="3git_11"></a>3.git代理配置</h3> 
<p>此步骤主要是解决拉github源码慢的问题，如果有vpn客户端的同学，记得要单独再配置下git的代理配置(可具体查看自己开启VPN后的代理ip 端口，配置一样即可)。</p> 
<p><img src="https://images2.imgbox.com/63/d2/DK5MbAAl_o.png" alt="在这里插入图片描述"></p> 
<p>开了VPN没配置git代理，正常网站进外网和github下载很快，但git命令拉取很慢？</p> 
<p>网站会检查电脑的代理配置并使用，而git是检查git单独的代理配置，所以得配</p> 
<h3><a id="4stable_diffusion_web_UI__26"></a>4.stable diffusion web UI 源码包下载</h3> 
<p>源码地址 <strong>https://github.com/lshqqytiger/k-diffusion-directml.git</strong><br> 找一个纯英文目录的文件夹用于存放你的sd程序，执行命令拉取源码。注意这里是directml版本的了，这是为AMD显卡适配新二开的源码。<br> <strong>git clone https://github.com/lshqqytiger/k-diffusion-directml.git</strong><br> 如果网络没问题且配置了代理的话按步骤下好就行了<br> 下好后直接双击执行里面的webui-user.bat 脚本<br> 中间会下载各种的依赖库，会下载到根目录下的repositories文件夹里面</p> 
<p>问题:</p> 
<p>1.中间下载依赖包时出现各种git fetch失败情况的话，进入对应的依赖目录中，在上面的url上或者在文件夹空白部分右键进入git bash/cmd</p> 
<p><img src="https://images2.imgbox.com/f5/63/tZWSuVLZ_o.png" alt="在这里插入图片描述"></p> 
<p>然后执行<strong>git fetch</strong> 执行如果出现</p> 
<p>git config --global --add safe.directory ‘F:/Stable Diffusion/stable-diffusion-webui’ fatal: detected dubious ownership in repository at ‘F:/Stable Diffusion/stable-diffusion-webui’ ‘F:/Stable Diffusion/stable-diffusion-webui’ is on a file system that does not record ownership To add an exception for this directory, call: git config --global --add safe.directory 'F:/Stable Diffusion/stable-diffusion-webui’等问题<br> 按照对应的提示执行<strong>git config --global --add safe.directory ‘F:/Stable Diffusion/stable-diffusion-webui’</strong><br> 然后再次执行<strong>git fetch</strong>即可</p> 
<p>解决完一个问题后再次执行<strong>webui-user.bat</strong> 脚本，期间如果又出现其他依赖库的这种情况，同理。进入<strong>repositories</strong>文件夹再进入对应的目录执行以上步骤。然后依次重复操作，直至所有的依赖库都安装完成</p> 
<h3><a id="2RuntimeError_Torch_is_not_able_to_use_GPU_add_skiptorchcudatest_to_COMMANDLINE_ARGS_variable_to_disable_this_check_59"></a>2.报错RuntimeError: Torch is not able to use GPU; add --skip-torch-cuda-test to COMMANDLINE_ARGS variable to disable this check</h3> 
<p>出现这个问题就对了，不出现就不用看本篇文章了。</p> 
<p>SD默认是仅支持N卡的，也是推荐使用N卡的，这里主要是torch会检查CUDA(这个是N卡先关的东西，我们A卡是没有的)。<br> 网上很多教程都说的是在执行脚本里加 --skip-torch-cuda-test参数，确实加了就不报错了，但推荐这种做法的人都是敷衍解决问题。加了这个后不会再使用GPU算力，而是使用处理器的CPU算力！！！ 不信，你可以试试。一试一个不吱声</p> 
<p>正确姿势是加入参数 <strong>–use-directml</strong></p> 
<p><img src="https://images2.imgbox.com/bc/95/Ml1N1Vpd_o.png" alt="在这里插入图片描述"></p> 
<p>（ps:如果显存过低，可再参考参数<br> –medvram： 为低显存（比如：4G）启用模型优化，会牺牲一点速度<br> –lowvram： 为极低显存（比如：2G）启用模型优化，会牺牲很多速度）</p> 
<p>然后继续执行脚本</p> 
<h3><a id="3AttributeError_module_torch_has_no_attribute_dml_88"></a>3.报错AttributeError: module ‘torch’ has no attribute ‘dml’</h3> 
<p>这里比较复杂一点，请严格按照下面的步骤来</p> 
<p>1.首先进入根目录下，找到文件</p> 
<p><strong>requirements_versions.txt</strong></p> 
<p><img src="https://images2.imgbox.com/9f/a2/AouRyA2L_o.png" alt="在这里插入图片描述"></p> 
<p>在末尾添加</p> 
<p><strong>torch-directml</strong></p> 
<p><img src="https://images2.imgbox.com/b6/60/kjMcf9KX_o.png" alt="在这里插入图片描述"></p> 
<p>保存后退出，然后再根目录下，点击上面的url，输入cmd进入当前目录的命令行窗口</p> 
<p>执行命令:</p> 
<p><strong>.\venv\scripts\activate pip install -r requirements.txt</strong><br> 此命令会根据刚才的<strong>requirements_versions.txt</strong>文件下载里面配置的各个组件(后面数字就是版本号)，如果一切顺利，这里最终就会安装完成<br> <img src="https://images2.imgbox.com/ad/21/1dQF5DNn_o.png" alt="在这里插入图片描述"></p> 
<p>如果中途报错<br> 就执行命令 <strong>pip install httpx==0.24.1</strong> ，然后等待安装完成<br> 这些步骤全部没问题之后，再次执行启动脚本。等待启动即可！！！</p> 
<p><strong>文末：如果进入web ui后，发现右上角有大量的请求响应报错，是没有关闭VPN的原因。退出SD，然后再关闭VPN后再次启动即可</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6803ecd5b61f03288f03abf2f2346908/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">轻松识别Midjourney等AI生成图片，开源GenImage</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f3e92e075e0ba666fde8a72552cefe8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">人工智能时代：ChatGPT破土重生（文末送书）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>