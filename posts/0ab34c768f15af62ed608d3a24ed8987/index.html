<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElasticSearch 8.x 弃用了 High Level REST Client，移除了 Java Transport Client，推荐使用 Elasticsearch Java API - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0ab34c768f15af62ed608d3a24ed8987/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ElasticSearch 8.x 弃用了 High Level REST Client，移除了 Java Transport Client，推荐使用 Elasticsearch Java API">
  <meta property="og:description" content="ElasticSearch 1、ElasticSearch学习随笔之基础介绍
2、ElasticSearch学习随笔之简单操作
3、ElasticSearch学习随笔之java api 操作
4、ElasticSearch学习随笔之SpringBoot Starter 操作
5、ElasticSearch学习随笔之嵌套操作
6、ElasticSearch学习随笔之分词算法
7、ElasticSearch学习随笔之高级检索
8、ELK技术栈介绍
9、Logstash部署与使用
10、ElasticSearch 7.x 版本使用 BulkProcessor 实现批量添加数据
11、ElasticSearch 8.x 弃用了 High Level REST Client，移除了 Java Transport Client，推荐使用 Elasticsearch Java API
12、ElasticSearch 8.x 使用 snapshot（快照）进行数据迁移
13、ElasticSearch 8.x 版本如何使用 SearchRequestBuilder 检索
14、ElasticSearch 8.x 使用 High Level Client 以 HTTPS 方式链接，SSL 证书、主机名验证器 各是什么，如何忽略
15、ElasticSearch 8.x 创建父子文档，用Join类型字段以及用has_child、has_parent 检索
16、ElasticSearch如何提高写入效率【面试题，面道既学到】
ElasticSearch，创始人 Shay Banon（谢巴农）
本文主要讲解ElasticSearch 高级搜索实战，来满足复杂的业务场景，还是用 Kibana 来操作。
文章目录 ElasticSearch前言一、ElasticSearch 先后弃用另个客户端一、为什么要弃用 TransportClient 呢？二、为什么要弃用 High Level REST Client 呢？三、Elasticsearch Java API 如何使用3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-03T08:50:16+08:00">
    <meta property="article:modified_time" content="2024-07-03T08:50:16+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ElasticSearch 8.x 弃用了 High Level REST Client，移除了 Java Transport Client，推荐使用 Elasticsearch Java API</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="ElasticSearch_0"></a>ElasticSearch</h2> 
<p>1、<a href="https://blog.csdn.net/qq_19283249/article/details/124222352">ElasticSearch学习随笔之基础介绍</a><br> 2、<a href="https://blog.csdn.net/qq_19283249/article/details/124225211">ElasticSearch学习随笔之简单操作</a><br> 3、<a href="https://blog.csdn.net/qq_19283249/article/details/124227307">ElasticSearch学习随笔之java api 操作</a><br> 4、<a href="https://blog.csdn.net/qq_19283249/article/details/124832230">ElasticSearch学习随笔之SpringBoot Starter 操作</a><br> 5、<a href="https://blog.csdn.net/qq_19283249/article/details/127000665">ElasticSearch学习随笔之嵌套操作</a><br> 6、<a href="https://blog.csdn.net/qq_19283249/article/details/130470805">ElasticSearch学习随笔之分词算法</a><br> 7、<a href="https://blog.csdn.net/qq_19283249/article/details/130473909">ElasticSearch学习随笔之高级检索</a><br> 8、<a href="https://blog.csdn.net/qq_19283249/article/details/130790590">ELK技术栈介绍</a><br> 9、<a href="https://blog.csdn.net/qq_19283249/article/details/130839158">Logstash部署与使用</a><br> 10、<a href="https://blog.csdn.net/qq_19283249/article/details/135352497">ElasticSearch 7.x 版本使用 BulkProcessor 实现批量添加数据</a><br> 11、<a href="https://blog.csdn.net/qq_19283249/article/details/135352522">ElasticSearch 8.x 弃用了 High Level REST Client，移除了 Java Transport Client，推荐使用 Elasticsearch Java API</a><br> 12、<a href="https://blog.csdn.net/qq_19283249/article/details/135581208">ElasticSearch 8.x 使用 snapshot（快照）进行数据迁移</a><br> 13、<a href="https://blog.csdn.net/qq_19283249/article/details/135818373">ElasticSearch 8.x 版本如何使用 SearchRequestBuilder 检索</a><br> 14、<a href="https://blog.csdn.net/qq_19283249/article/details/135971652">ElasticSearch 8.x 使用 High Level Client 以 HTTPS 方式链接，SSL 证书、主机名验证器 各是什么，如何忽略</a><br> 15、<a href="https://blog.csdn.net/qq_19283249/article/details/136041108">ElasticSearch 8.x 创建父子文档，用Join类型字段以及用has_child、has_parent 检索</a><br> 16、<a href="https://blog.csdn.net/qq_19283249/article/details/139362882">ElasticSearch如何提高写入效率【面试题，面道既学到】</a></p> 
<p>ElasticSearch，创始人 Shay Banon（谢巴农）<br> 本文主要讲解ElasticSearch 高级搜索实战，来满足复杂的业务场景，还是用 Kibana 来操作。</p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#ElasticSearch_0" rel="nofollow">ElasticSearch</a></li><li><a href="#_29" rel="nofollow">前言</a></li><li><a href="#ElasticSearch__32" rel="nofollow">一、ElasticSearch 先后弃用另个客户端</a></li><li><a href="#_TransportClient__47" rel="nofollow">一、为什么要弃用 TransportClient 呢？</a></li><li><a href="#_High_Level_REST_Client__59" rel="nofollow">二、为什么要弃用 High Level REST Client 呢？</a></li><li><a href="#Elasticsearch_Java_API__71" rel="nofollow">三、Elasticsearch Java API 如何使用</a></li><li><ul><li><a href="#31_pom__72" rel="nofollow">3.1 pom 依赖</a></li><li><a href="#32_ES_Client__93" rel="nofollow">3.2 ES Client 初始化</a></li><li><a href="#33__Index_117" rel="nofollow">3.3 创建 Index</a></li><li><a href="#34__138" rel="nofollow">3.4 添加数据</a></li><li><a href="#35__160" rel="nofollow">3.5 删除数据</a></li><li><a href="#36__192" rel="nofollow">3.6 修改数据</a></li><li><a href="#37__202" rel="nofollow">3.7 查询索引</a></li></ul> 
  </li><li><a href="#_212" rel="nofollow">四、小结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_29"></a>前言</h2> 
<p>最近在公司迁移项目到云服务期间，有一个项目迁移需要升级 ElasticSearch。原先用的是 ElasticSearch 6.8 版本的，迁移到云服务之后由于云服务限制，只能升级到了 ElasticSearch 8.x 版本了，对于一些别依赖来说，比如：jdbc driver、redis client 或者 mq client 可能会有些许 API 变化，所以项目中代码改动不大，但是 ElasticSearch 只要升一级，你的项目中极大可能就是 <strong>代码上下一片红</strong>，惨不忍睹啊，所以一般非必要不升级啊！</p> 
<h2><a id="ElasticSearch__32"></a>一、ElasticSearch 先后弃用另个客户端</h2> 
<p>从 <code>ElasticSearch 7.0.0</code> 版本开始，ElasticSearch 官方就不建议使用 <strong>TransportClient</strong> 客户端了，推荐使用 High Level REST Client 客户端了。<br> <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-api/current/transport-client.html" rel="nofollow">官方快速通道</a> ，想了解更多的小伙伴可以移步官方文档，慢慢品读，顺便锻炼英语阅读能力。<br> <img src="https://images2.imgbox.com/12/45/QKUMcGZ6_o.png" alt="ElasticSearch官方通知"></p> 
<p>The TransportClient is deprecated in favour of the Java High Level REST Client and will be removed in Elasticsearch 8.0.<br> 【<strong>TransportClient 是不赞成的，推荐使用 Java High Level REST Client，并且将要在 Elasticsearch 8.0 移除</strong>】</p> 
<hr> 
<p>然后接下来，从 <code>ElasticSearch 7.15.0</code> 版本开始，ElasticSearch 官方就不建议使用 <strong>High Level REST</strong> 客户端了，推荐使用 ElasticSearch-java 客户端了。<br> <a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html#java-rest-high" rel="nofollow">官方快速通道</a> ，想了解更多的小伙伴可以移步官方文档，慢慢品读，顺便锻炼英语阅读能力。</p> 
<p><img src="https://images2.imgbox.com/e3/5f/OFDjNU3V_o.png" alt="ElasticSearch官方通知"><br> The High Level REST Client is deprecated in favour of the Java API Client。<br> <strong>High Level REST Client是不赞成的，推荐使用 JAVA api 客户端</strong>，不过 High Level REST Client 7.17 版本可以和 ElasticSearch 8.x 兼容模式下使用。</p> 
<h2><a id="_TransportClient__47"></a>一、为什么要弃用 TransportClient 呢？</h2> 
<p>在 Elasticsearch 7.0.0 版本后不建议使用 TransportClient了，为什么呢？是因为它在分布式集群中的使用方式不够灵活且不够健壮。TransportClient 使用内部集群协议进行通信，这会导致以下问题：</p> 
<ol><li><strong>集群版本兼容问题</strong>：Transport Client 必须与 ElasticSearch 集群的确切版本匹配，如果有版本不匹配则会出现兼容问题，对版本特别敏感。</li><li><strong>单点故障</strong>：Transport Client 需要连接到特定的节点，如果连接的节点发生故障，客户端则无法自动重新连接到集群的其他节点。</li><li><strong>不推荐的跨版本使用</strong>： Transport Client 在集群版本升级时可能会遇到问题，因为它需要与集群完全匹配，跨版本使用会引发不兼容性问题，所以使用还不是很灵活。</li></ol> 
<p>但 Transport Client 也有有点的，比如：</p> 
<ol><li><strong>低延迟</strong>：与集群内部直接通信，可能具有比 REST 客户端更低的延迟。</li><li><strong>直接与集群通信</strong>：能够直接在集群内部进行通信和交互。</li></ol> 
<p>所以综合考虑，为了更好地兼容不同版本的集群、更灵活地处理节点故障和更广泛地支持 REST Api，在 ElasticSearch 7.x 版本开始使用 High Level REST Client 进行操作了。</p> 
<h2><a id="_High_Level_REST_Client__59"></a>二、为什么要弃用 High Level REST Client 呢？</h2> 
<p>那在 ElasticSearch 7.15.0 版本开始，官方又不建议使用 High Level REST Client 了，为什么呢？因为它是基于原生的 REST API，而这些 API 在某些情况下限制了某些功能的性能优化。与此同时，官方也推出了 Elasticsearch Java 客户端（Java 客户端）作为替代方案。这个新客户端旨在提供更好的性能、更好的稳定性，并且更易于维护和开发。<br> 缺点如下：</p> 
<ol><li><strong>性能损耗</strong>：由于是基于 REST API 的封装，可能存在性能上的一些损耗，比如相比原生的 Java 客户端可能有更高的延迟。</li><li><strong>功能限制</strong>：High Level REST Client 对于一些高级或较新的功能可能提供支持不够或者存在一些限制。</li></ol> 
<p>优点如下：</p> 
<ol><li><strong>易用性高</strong>：High Level REST Client 封装了底层的 REST API，提供了了更直观、更易用的开发方法调用 ElasticSearch 的功能。</li><li><strong>开发效率</strong>：</li><li><strong>较好的兼容性</strong>：</li></ol> 
<p>虽然 High Level REST Client 在易用性和开发效率方面有优势，但是为了获得更好的性能、更好的稳定性，并且获得更多的特性支持，官方建议从 Elasticsearch 7.15.0 版本开始，使用新的 Java 客户端进行操作。</p> 
<h2><a id="Elasticsearch_Java_API__71"></a>三、Elasticsearch Java API 如何使用</h2> 
<h3><a id="31_pom__72"></a>3.1 pom 依赖</h3> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>co<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>clients<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>elasticsearch<span class="token operator">-</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">8.7</span><span class="token number">.1</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jackson<span class="token operator">-</span>databind<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.12</span><span class="token number">.3</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.18</span><span class="token number">.22</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>provided<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="32_ES_Client__93"></a>3.2 ES Client 初始化</h3> 
<p><code>注意</code>：修改 ES 的用户名密码</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 初始化客户端
 * @return
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ElasticsearchClient</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> hostname <span class="token operator">=</span> <span class="token string">"192.168.*.*"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">9200</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"your username"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"your password"</span><span class="token punctuation">;</span>
    <span class="token comment">// 基本的用户名密码认证</span>
    <span class="token class-name">BasicCredentialsProvider</span> basicCredentialsProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicCredentialsProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    basicCredentialsProvider<span class="token punctuation">.</span><span class="token function">setCredentials</span><span class="token punctuation">(</span><span class="token class-name">AuthScope</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordCredentials</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RestClientBuilder</span> restClientBuilder <span class="token operator">=</span> <span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HttpHost</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">,</span> <span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    restClientBuilder<span class="token punctuation">.</span><span class="token function">setHttpClientConfigCallback</span><span class="token punctuation">(</span>httpAsyncClientBuilder <span class="token operator">-&gt;</span>
            httpAsyncClientBuilder<span class="token punctuation">.</span><span class="token function">setDefaultCredentialsProvider</span><span class="token punctuation">(</span>basicCredentialsProvider<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RestClient</span> restClient <span class="token operator">=</span> restClientBuilder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ElasticsearchTransport</span> transport <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestClientTransport</span><span class="token punctuation">(</span>restClient<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">JacksonJsonpMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ElasticsearchClient</span><span class="token punctuation">(</span>transport<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> esClient<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33__Index_117"></a>3.3 创建 Index</h3> 
<p>ElasticSearch-java 客户端可以使用连续调用的方式进行编程。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 创建索引
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CreateIndexResponse</span> createIndexResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">aliases</span><span class="token punctuation">(</span><span class="token string">"product_info_alias"</span><span class="token punctuation">,</span>
                            <span class="token keyword">new</span> <span class="token class-name">Alias<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isWriteIndex</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>createIndexResponse<span class="token punctuation">.</span><span class="token function">acknowledged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"创建索引成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"创建索引失败！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="34__138"></a>3.4 添加数据</h3> 
<p>定义产品信息实体类 <strong>ProductInfo</strong> ：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productDescription<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> color<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> price<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ElasticSearch-java 客户端是以 document 的方式添加数据到 ES，这个 document 就是一个 Object 对象，就是把我们创建的实体直接通过写入 <strong>Index</strong> 中，这样使用起来更加方便。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ProductInfo</span> productInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">(</span><span class="token string">"红米手机"</span><span class="token punctuation">,</span> <span class="token string">"红米 Note，智能手机，价格便宜"</span><span class="token punctuation">,</span> <span class="token string">"蓝色"</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">CreateResponse</span> createResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createRequest <span class="token operator">-&gt;</span> createRequest<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">"1003"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">document</span><span class="token punctuation">(</span>productInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"添加索引请求结果："</span> <span class="token operator">+</span> createResponse<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="35__160"></a>3.5 删除数据</h3> 
<p>以下是比较简单的删除操作，直接通过 ID 进行删除：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delDataVidId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DeleteResponse</span> deleteResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>deleteReqest <span class="token operator">-&gt;</span> deleteReqest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"按照 ID 删除索引数据结果："</span> <span class="token operator">+</span> deleteResponse<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但有时候需要按照某个条件删除，该如何做呢？代码如下：<br> <code>注意</code>：下面示例是按照条件删除的，比如参数 <strong>value</strong> 是 “苹果手机”，因为通过 productName 检索会把 “<strong>苹果</strong>” 和 “<strong>手机</strong>” 的都检索出来，那样的话就都删除了。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delDataVidQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">DeleteByQueryResponse</span> deleteByQueryResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">deleteByQuery</span><span class="token punctuation">(</span>deleteByQuery <span class="token operator">-&gt;</span> 
            deleteByQuery<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query <span class="token operator">-&gt;</span> 
                    query<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">MatchQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>builder <span class="token operator">-&gt;</span>
                            builder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"productName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"按照条件删除索引数据结果："</span> <span class="token operator">+</span> deleteByQueryResponse<span class="token punctuation">.</span><span class="token function">deleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>那我们只想删除 “苹果手机” 的数据该如何做呢？其实很简单，以 keyword【productName.keyword】的形式查询就行，代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delDataVidQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeleteByQueryResponse</span> deleteByQueryResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">deleteByQuery</span><span class="token punctuation">(</span>deleteByQuery <span class="token operator">-&gt;</span>
                deleteByQuery<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>query <span class="token operator">-&gt;</span>
                        query<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">MatchQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>builder <span class="token operator">-&gt;</span> builder<span class="token punctuation">.</span><span class="token function">queryName</span><span class="token punctuation">(</span><span class="token string">"productName.keyword"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"按照条件删除索引数据结果："</span> <span class="token operator">+</span> deleteByQueryResponse<span class="token punctuation">.</span><span class="token function">deleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="36__192"></a>3.6 修改数据</h3> 
<p>下面的示例是通过 ID 修改数据，这种都比较简单：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">updateViaId</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProductInfo</span> productInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">(</span><span class="token string">"苹果手机"</span><span class="token punctuation">,</span> <span class="token string">"苹果智能手机，价格实惠便宜"</span><span class="token punctuation">,</span> <span class="token string">"黑色"</span><span class="token punctuation">,</span> <span class="token number">5999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UpdateResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductInfo</span><span class="token punctuation">&gt;</span></span> updateResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>updateRequest <span class="token operator">-&gt;</span> updateRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>productInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"根据 ID 修改："</span> <span class="token operator">+</span> updateResponse<span class="token punctuation">.</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="37__202"></a>3.7 查询索引</h3> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ElasticsearchClient</span> esClient <span class="token operator">=</span> <span class="token function">initClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SearchResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProductInfo</span><span class="token punctuation">&gt;</span></span> searchResponse <span class="token operator">=</span> esClient<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>searchRequest <span class="token operator">-&gt;</span>
            searchRequest<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">"product_info"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">-&gt;</span> q<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token class-name">MatchQuery</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>builder <span class="token operator">-&gt;</span>
                    builder<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token string">"productName"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ProductInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    searchResponse<span class="token punctuation">.</span><span class="token function">hits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>productInfoHit <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>productInfoHit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_212"></a>四、小结</h2> 
<p>文本主要介绍了 ElasticSearch 弃用 Transport Client 和 High Level REST Client 两个客户端，在 ElasticSearch 8.x 开始官方推荐使用 ElasticSearch-java 客户端了，可在我们的项目中，如果使用 7.x 版本或者更早版本的客户端，那改造起来可不是件容易事情，不过 High Level REST Client 和 ElasticSearch-java 客户端可以兼容模式下一起使用。<br> 对于最新的 ElasticSearch-java 客户端 还有好多操作，比如分页检索、排序等，都有相对应的操作 Request，本文只举几个示例，后面陆续更新。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc6e483f81d0b264c5ef166ba11fc994/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spark性能优化（第22天）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/93ded04fb95bedf709394b9ea8a3226f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【AIGC自动化编程技巧笔记】一、起步</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>