<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用小程序中的uni方法实现uView中的upload组件并将图片上传到腾讯云 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/fddfb81a4de181ccff54fdb7df6e4800/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="用小程序中的uni方法实现uView中的upload组件并将图片上传到腾讯云">
  <meta property="og:description" content="一、uni中选择图片的方法与uview中的upload组件选择的不同 功能差异：
uni.chooseImage是uni-app框架提供的原生API，用于选择本地相册或拍照获取图片。uview中的upload组件是一个UI组件，用于上传图片或文件到服务器。 调用方式：
uni.chooseImage需要在代码中主动调用API来触发选择图片的操作。uview的upload组件是一个UI组件，需要在页面中引入并配置参数，然后通过用户交互来触发选择图片的操作。 上传功能：
uni.chooseImage只能选择图片，需要额外编写代码来实现图片上传功能。uview中的upload组件集成了上传功能，可以直接上传选择的图片或文件到服务器。 二、upload的简单使用（详细看uView的官网Upload 上传 | uView - 多平台快速开发的UI框架 - uni-app UI框架 (gitee.io)） &lt;template&gt; &lt;u-upload :action=&#34;action&#34; :file-list=&#34;fileList&#34; &gt;&lt;/u-upload&gt; &lt;/template&gt; &lt;script&gt; export default { data() { // 演示地址，请勿直接使用 action: &#39;http://www.example.com/upload&#39;, fileList: [ { url: &#39;http://pics.sc.chinaz.com/files/pic/pic9/201912/hpic1886.jpg&#39;, } ] } } &lt;/script&gt; 也可以设置手动上传 &lt;template&gt; &lt;view&gt; &lt;u-upload ref=&#34;uUpload&#34; :action=&#34;action&#34; :auto-upload=&#34;false&#34; &gt;&lt;/u-upload&gt; &lt;u-button @click=&#34;submit&#34;&gt;提交&lt;/u-button&gt; &lt;/view&gt; &lt;/template&gt; &lt;script&gt; export default { data() { // 非真实地址 action: &#39;http://www.example.com/upload&#39;, }, methods: { submit() { this.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-09T19:57:45+08:00">
    <meta property="article:modified_time" content="2024-03-09T19:57:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用小程序中的uni方法实现uView中的upload组件并将图片上传到腾讯云</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、uni中选择图片的方法与uview中的upload组件选择的不同</h3> 
<ol><li> <p><strong>功能差异</strong>：</p> 
  <ul><li><code>uni.chooseImage</code>是uni-app框架提供的原生API，用于选择本地相册或拍照获取图片。</li><li><code>uview</code>中的<code>upload</code>组件是一个UI组件，用于上传图片或文件到服务器。</li></ul></li><li> <p><strong>调用方式</strong>：</p> 
  <ul><li><code>uni.chooseImage</code>需要在代码中主动调用API来触发选择图片的操作。</li><li><code>uview</code>的<code>upload</code>组件是一个UI组件，需要在页面中引入并配置参数，然后通过用户交互来触发选择图片的操作。</li></ul></li><li> <p><strong>上传功能</strong>：</p> 
  <ul><li><code>uni.chooseImage</code>只能选择图片，需要额外编写代码来实现图片上传功能。</li><li><code>uview</code>中的<code>upload</code>组件集成了上传功能，可以直接上传选择的图片或文件到服务器。</li></ul></li></ol> 
<h3>二、upload的简单使用（详细看uView的官网<a href="https://xuqu.gitee.io/components/upload.html" rel="nofollow" title="Upload 上传 | uView - 多平台快速开发的UI框架 - uni-app UI框架 (gitee.io)">Upload 上传 | uView - 多平台快速开发的UI框架 - uni-app UI框架 (gitee.io)</a>）</h3> 
<pre><code class="language-javascript">&lt;template&gt;
	&lt;u-upload :action="action" :file-list="fileList" &gt;&lt;/u-upload&gt;
&lt;/template&gt;

&lt;script&gt;
	export default {
		data() {
			// 演示地址，请勿直接使用
			action: 'http://www.example.com/upload',
			fileList: [
				{
					url: 'http://pics.sc.chinaz.com/files/pic/pic9/201912/hpic1886.jpg',
				}
			]
		}
	}
&lt;/script&gt;</code></pre> 
<h4>也可以设置手动上传</h4> 
<pre><code class="language-javascript">&lt;template&gt;
	&lt;view&gt;
		&lt;u-upload ref="uUpload" :action="action" :auto-upload="false" &gt;&lt;/u-upload&gt;
		&lt;u-button @click="submit"&gt;提交&lt;/u-button&gt;
	&lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
	export default {
		data() {
			// 非真实地址
			action: 'http://www.example.com/upload',
		},
		methods: {
			submit() {
				this.$refs.uUpload.upload();
			},
		}
	}
&lt;/script&gt;</code></pre> 
<h3>三、用uniapp的方法实现选择图片并上传腾讯云</h3> 
<p>1.下载cos</p> 
<pre><code class="language-javascript">npm i cos-js-sdk-v5 --save</code></pre> 
<p>2.生成签名</p> 
<p>获取secretId和secretKey</p> 
<pre><code class="language-javascript">let cos = new COS({
		SecretId: '*******************************',
		SecretKey: '******************************',
	})</code></pre> 
<p>3.上传文件</p> 
<pre><code class="language-javascript">cos.uploadFile({
		Bucket: 'link-******',
		/* 填写自己的 bucket，必须字段*/
		Region: 'ap-nanjing',
		/* 存储桶所在地域，必须字段 */
		Key: filename,
		/* 存储在桶里的对象键（例如:1.jpg，a/b/test.txt，图片.jpg）支持中文，必须字段 */
		Body: selectedFile, // 上传文件对象
		SliceSize: 1024 * 1024 * 5,
		/* 触发分块上传的阈值，超过5MB使用分块上传，小于5MB使用简单上传。可自行设置，非必须 */
		onProgress: function(progressData) {
			console.log(JSON.stringify(progressData));
		}
	}, function(err, data) {
		if (err) {
			console.log('上传失败', err);
		} else {
			console.log('上传成功');
		}
	});</code></pre> 
<p>4.配置cos</p> 
<h3><img alt="" height="240" src="https://images2.imgbox.com/c9/94/IK2ixi0R_o.png" width="1093">四、完整代码</h3> 
<p>1.新建upload.js文件</p> 
<pre><code class="language-javascript">import COS from 'cos-js-sdk-v5';

//上传图片
export function Upload(selectedFile, filename) {
	console.log(selectedFile, filename);
	let cos = new COS({
		SecretId: '**********************',
		SecretKey: '*********************',
	})
	cos.uploadFile({
		Bucket: 'link-************',
		/* 填写自己的 bucket，必须字段*/
		Region: 'ap-nanjing',
		/* 存储桶所在地域，必须字段 */
		Key: filename,
		/* 存储在桶里的对象键（例如:1.jpg，a/b/test.txt，图片.jpg）支持中文，必须字段 */
		Body: selectedFile, // 上传文件对象
		SliceSize: 1024 * 1024 * 5,
		/* 触发分块上传的阈值，超过5MB使用分块上传，小于5MB使用简单上传。可自行设置，非必须 */
		onProgress: function(progressData) {
			console.log(JSON.stringify(progressData));
		}
	}, function(err, data) {
		if (err) {
			console.log('上传失败', err);
		} else {
			console.log('上传成功', data);
		}
	});
}

//删除图片
export function Delete(filename) {
	console.log(filename);
	// 找到最后一个斜杠的索引
	const lastIndex = filename.lastIndexOf('/');

	// 提取最后一个斜杠后面的字段
	const lastSegment = filename.substring(lastIndex + 1);

	console.log(lastSegment); // 输出: 289f83ec-cf17-47f1-bd99-b059e0ef33d1
	let cos = new COS({
		SecretId: 'AKIDz6FIRWTHsGg7TfvDXvFdu6OXg2Z9pbWS',
		SecretKey: '9KbnwwnV2dGoMsgQ1eFh2H4reVEnAMSK',
	})
	cos.deleteObject({
		Bucket: 'link-1320976986',
		/* 填写自己的 bucket，必须字段*/
		Region: 'ap-nanjing',
		/* 存储桶所在地域，必须字段 */
		Key: lastSegment,
		/* 存储在桶里的对象键（例如:1.jpg，a/b/test.txt，图片.jpg）支持中文，必须字段 */

	}, function(err, data) {
		if (err) {
			console.log('上传失败', err);
		} else {
			console.log('上传成功', data);
		}
	});
}

// 转换文件格式
export const parseFile = (src, name) =&gt; {
	// console.log("转换格式");
	//	let that = this
	return new Promise((resolve, reject) =&gt; {
		let xhr = null
		if (window.XMLHttpRequest) {
			xhr = new XMLHttpRequest();
		} else {
			xhr = new ActiveXObject("Microsoft.XMLHTTP");

		}
		xhr.open('GET', src, true)
		xhr.responseType = 'blob';
		xhr.onload = function(e) {
			if (this.status == 200) {
				let myBlob = this.response
				let files = new window.File(
					[myBlob],
					name, {
						type: myBlob.type
					}
				) // myBlob.type 自定义文件名
				resolve(files)
				console.log("resolve(files)");
			} else {
				reject(false)
				console.log("reject(false)");
			}
		}
		xhr.send()
	})
}</code></pre> 
<p>2.使用</p> 
<h4>注意：用uni.chooseimage方法选择的图片路径需要经过处理才能上传云</h4> 
<pre><code class="language-javascript">&lt;view class="jiantou2"&gt;
				&lt;u-icon name="more-dot-fill" color="white" @click="morefuck"&gt;&lt;/u-icon&gt;
			&lt;/view&gt;
import {
		Upload,
		Delete,
		parseFile
	} from '@/store/upload.js';
	const morefuck = async () =&gt; {
		console.log("想要获取图片");
		uni.chooseImage({
			count: 1, //上传图片的数量，默认是9
			sizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有
			sourceType: ['album'], //从相册选择
			success: async (res) =&gt; {
				console.log(res);
				const tempFilePath = res.tempFilePaths[0]; //拿到选择的图片，是一个数组
				const file = {
					url: tempFilePath, // 临时文件路径
					name: tempFilePath.substring(tempFilePath.lastIndexOf('/') +
						1) // 提取文件名
				};
				console.log(file.name, "key的值");
				uni.uploadFile({
					url: '****************************',
					filePath: tempFilePath,
					name: 'file',
					formData: {
						'key': file.name,
						'success_action_status': '200',
						// 'Signature': '&lt;Signature&gt;',
						'Content-Type': 'image/jpeg',
						'Region': 'ap-nanjing',
						'Bucket': 'link-******************',
						'SecretId': '**********************',
						// 'Timestamp': '&lt;Timestamp&gt;',
						// 'Nonce': '&lt;Nonce&gt;',
					},
					success: function(uploadRes) {
						console.log('upload success', uploadRes)
					},
					fail: function(uploadRes) {
						console.log('upload fail', uploadRes)
					},
					complete: function(uploadRes) {
						console.log('upload complete', uploadRes)
					}
				})


				const finalurl =
					"url" + file.name;
				totalmition.value.avatar = finalurl;

				putUser(totalmition.value).then(data =&gt; {
					oldtouxiang.value = totalmition.value.avatar;
					
				})

				// 转换格式
				// let blob = await parseFile(file.url, file.name);
				// 上传到腾讯云
				// Upload(blob, file.name);
				//删除老头像
				// console.log(oldoldtouxiang.value, "删除老头像");
				// Delete(oldoldtouxiang.value);
			}
		});

	};</code></pre> 
<p>这样就能用uni.chooseimage的方法选择图片并且将图片做处理然后上传到腾讯云上</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/33cb5ef968ad9d4e97f35b6dd0e7e9d5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python一元和多元线性回归模型的原理及评估【附代码】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/58ff1a000447612053f5753a801403f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">机器学习实战：决策树与随机森林预测心脏病分类问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>