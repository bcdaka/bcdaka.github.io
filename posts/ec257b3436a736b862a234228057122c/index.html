<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>单臂路由的配置（思科、华为） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ec257b3436a736b862a234228057122c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="单臂路由的配置（思科、华为）">
  <meta property="og:description" content="#交换设备
不同vlan属于不同广播域，不能互相通信，他们配置的是不同网段的IP地址，针对不同网段的IP地址进行通信，就需要用到路由技术
实现不同vlan之间的通信技术有两种
单臂路由三层交换 单臂路由 一、思科设备的单臂路由配置 在路由器上划分子接口，每一个子接口作为一个vlan的网关，需要做vlan封装交换机与主机连接的链路为：access交换机与路由器连接的链路为trunk 工作原理 配置过程 交换机 en conf t valn 10 vlan 20 exit int f0/1 sw acc vlan 10 int f0/2 sw acc vlan 20 int f0/3 sw mo trun 路由器 en conf t int g0/0.1 #将g0/1接口划分为两个子接口，这个接口是逻辑接口，并不实际存在，但是功能却和物理接口是一样的 encapsulation dot1Q 10 #为这个接口配置802.1Q协议，最后面的10是vlan 号 ip add 192.168.10.254 255.255.255.0 exit int g0/0.2 encapsulation dot1Q 20 #为这个接口配置802.1Q协议，最后面的20是vlan 号 ip add 192.168.20.254 255.255.255.0 exit int g0/0 no shut exit ip dhcp pool vlan10 network 192.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-07T21:18:30+08:00">
    <meta property="article:modified_time" content="2024-06-07T21:18:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">单臂路由的配置（思科、华为）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>#交换设备<br> <img src="https://images2.imgbox.com/2f/b2/kuDRpzRa_o.jpg" alt="在这里插入图片描述"></p> 
<p>不同vlan属于不同广播域，不能互相通信，他们配置的是不同网段的IP地址，针对不同网段的IP地址进行通信，就需要用到路由技术</p> 
<p>实现不同vlan之间的通信技术有两种</p> 
<ul><li>单臂路由</li><li>三层交换</li></ul> 
<h2><a id="_11"></a>单臂路由</h2> 
<h3><a id="_13"></a>一、思科设备的单臂路由配置</h3> 
<ul><li>在路由器上划分子接口，每一个子接口作为一个vlan的网关，需要做vlan封装</li><li>交换机与主机连接的链路为：access</li><li>交换机与路由器连接的链路为trunk</li></ul> 
<p><img src="https://images2.imgbox.com/d4/eb/M3sBQ0FZ_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_22"></a>工作原理</h4> 
<p><img src="https://images2.imgbox.com/61/a8/vtYBETPU_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_27"></a>配置过程</h4> 
<pre><code class="prism language-cmd">交换机
en
conf t
valn 10
vlan 20
exit
int f0/1
sw acc vlan 10
int f0/2
sw acc vlan 20
int f0/3
sw mo trun
</code></pre> 
<pre><code class="prism language-cmd">路由器
en
conf t
int g0/0.1   #将g0/1接口划分为两个子接口，这个接口是逻辑接口，并不实际存在，但是功能却和物理接口是一样的
encapsulation dot1Q 10                    #为这个接口配置802.1Q协议，最后面的10是vlan 号
ip add 192.168.10.254 255.255.255.0
exit
int g0/0.2
encapsulation dot1Q 20                     #为这个接口配置802.1Q协议，最后面的20是vlan 号
ip add 192.168.20.254 255.255.255.0
exit
int g0/0
no shut
exit
ip dhcp pool vlan10
network 192.168.10.0 255.255.255.0
default-router 192.168.10.254
exit
ip dhcp pool vlan20
network 192.168.20.0 255.255.255.0
default-router 192.168.20.254
end
</code></pre> 
<h3><a id="_71"></a>二、华为设备的单臂路由配置</h3> 
<p><img src="https://images2.imgbox.com/bb/85/WjC3BFcX_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e4/32/Ie4H9A2B_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1_78"></a>1.准备工作</h4> 
<ul><li>S2创建vlan10 和20并分配， 并在g0/0/2上设置trunk，允许vlan10 20 30 通过</li><li>S3创建vlan30并分配 ，并在g0/0/2上设置trunk，允许vlan10 20 30 通过</li><li>S1上创建vlan10 20 30 ，三个接口都设置trunk，允许vlan10 20 30 通过</li></ul> 
<h4><a id="2ip_84"></a>2.为路由器设置子接口ip</h4> 
<ul><li>因为三个主机的网关各不相同，但又都在R1上，所以R1的g0/0/1接口要当做3个接口来用，所以通过子接口的形式设置网关地址</li></ul> 
<pre><code class="prism language-powershell"><span class="token namespace">[R1]</span>int g0/0/1<span class="token punctuation">.</span>1
<span class="token namespace">[R1-GigabitEthernet0/0/1.1]</span>ip add 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>1<span class="token punctuation">.</span>254 24
<span class="token namespace">[R1-GigabitEthernet0/0/1.1]</span>int g0/0/1<span class="token punctuation">.</span>2
<span class="token namespace">[R1-GigabitEthernet0/0/1.2]</span>ip add 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>2<span class="token punctuation">.</span>254 24
<span class="token namespace">[R1-GigabitEthernet0/0/1.2]</span>int g0/0/1<span class="token punctuation">.</span>3
<span class="token namespace">[R1-GigabitEthernet0/0/1.3]</span>ip add 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>3<span class="token punctuation">.</span>254 24
</code></pre> 
<h4><a id="3vlan_97"></a>3.配置路由器子接口封装vlan</h4> 
<ul><li>为每一个子接口配置需要封装的vlan编号，并开启ARP广播功能</li><li>配置封装的目的是： 
  <ul><li>因为路由器不会识别带有vlan标签的数据包，所以在路由器接口接收到带有vlan标签的数据包时，需要剥离valn标签</li><li>数据在去掉vlan标签后，在路由器中中转，需要发往目的主机，而目的交换机设置了valn，所以数据在发出时还需要加上目的地的vlan标签</li></ul> </li></ul> 
<pre><code class="prism language-powershell"><span class="token namespace">[R1]</span>int g0/0/1<span class="token punctuation">.</span>1
<span class="token namespace">[R1-GigabitEthernet0/0/1.1]</span>dot1q termination vid 10
<span class="token namespace">[R1-GigabitEthernet0/0/1.1]</span>arp broadcast enable  <span class="token comment">#开启ARP广播</span>

<span class="token namespace">[R1-GigabitEthernet0/0/1.1]</span>int g0/0/1<span class="token punctuation">.</span>2
<span class="token namespace">[R1-GigabitEthernet0/0/1.2]</span>dot1q termination vid 20
<span class="token namespace">[R1-GigabitEthernet0/0/1.2]</span>arp broadcast enable 

<span class="token namespace">[R1-GigabitEthernet0/0/1.2]</span>int g0/0/1<span class="token punctuation">.</span>3
<span class="token namespace">[R1-GigabitEthernet0/0/1.3]</span>dot1q termination vid 30
<span class="token namespace">[R1-GigabitEthernet0/0/1.3]</span>arp broadcast enable 
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d934b182baa79cde06d45846164fb5f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">无涯教程-C&#43;&#43; 算法 - reverse函数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4f219ed8c3dc58321f54f5dcb1e82ff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">八款国产 AI 地狱挑战 2024 高考数学压轴大题：只给一张模糊拍屏，从读题开始考验！...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>