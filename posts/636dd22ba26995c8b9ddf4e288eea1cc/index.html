<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€é«˜æ€§èƒ½æœåŠ¡å™¨ã€‘selectæ¨¡å‹ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/636dd22ba26995c8b9ddf4e288eea1cc/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ã€é«˜æ€§èƒ½æœåŠ¡å™¨ã€‘selectæ¨¡å‹">
  <meta property="og:description" content="ğŸ”¥åšå®¢ä¸»é¡µï¼šÂ æˆ‘è¦æˆä¸ºC&#43;&#43;é¢†åŸŸå¤§ç¥
ğŸ¥ç³»åˆ—ä¸“æ ï¼šã€C&#43;&#43;æ ¸å¿ƒç¼–ç¨‹ã€‘Â ã€è®¡ç®—æœºç½‘ç»œã€‘Â ã€Linuxç¼–ç¨‹ã€‘Â ã€æ“ä½œç³»ç»Ÿã€‘
â¤ï¸æ„Ÿè°¢å¤§å®¶ç‚¹èµğŸ‘æ”¶è—â­è¯„è®ºâœï¸
æœ¬åšå®¢è‡´åŠ›äºçŸ¥è¯†åˆ†äº«ï¼Œä¸æ›´å¤šçš„äººè¿›è¡Œå­¦ä¹ äº¤æµ
IOå¤šè·¯å¤ç”¨å°±æ˜¯å¤ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä»åŸå…ˆä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨recvè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å·²ç»å°±ç»ªï¼Œé‚£ä¹ˆå¤šä¸ªå®¢æˆ·ç«¯å°±éœ€è¦å¤šä¸ªçº¿ç¨‹ï¼Œè½¬å˜æˆç°åœ¨å¤šä¸ªå®¢æˆ·ç«¯éƒ½ç”¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨select/pollå»ç»Ÿä¸€ç®¡ç†ï¼Œä¸»åŠ¨é€šçŸ¥ç”¨æˆ·å“ªäº›æ•°æ®å·²ç»å°±ç»ªï¼ˆreadï¼Œwriteï¼Œacceptç­‰äº‹ä»¶ï¼‰ï¼Œæ‰€ä»¥å¤ç”¨äº†è¿™ä¸ªçº¿ç¨‹ï¼Œå‡å°‘äº†ç³»ç»Ÿå¼€é”€ã€‚
åœ¨å®¢æˆ·ç«¯å¢åŠ æ—¶ï¼Œçº¿ç¨‹ä¸ä¼šå‘ˆO(n)å¢åŠ ã€‚
å…³äºrecvå’Œacceptå·¥ä½œæµç¨‹ accpeté€šè¿‡æœåŠ¡ç«¯æ–‡ä»¶æè¿°ç¬¦ç›‘å¬socketäº‹ä»¶ï¼Œå½“ç›‘å¬åˆ°READ_EVENTäº‹ä»¶æ—¶ï¼Œè¯´æ˜æœ‰å…¶ä»–ç½‘ç»œç«¯å‘æ­¤socketå‘é€æ•°æ®ï¼Œè§¦å‘socketè¯»äº‹ä»¶ï¼ˆä¸‰æ¬¡æ¡æ‰‹ä¸­å®¢æˆ·ç«¯ä¼šå‘é€æ•°æ®ï¼‰ï¼Œå»ºç«‹TCPè¿æ¥ã€‚
recvé€šè¿‡å®¢æˆ·ç«¯æ–‡ä»¶æè¿°ç¬¦ç›‘å¬socketäº‹ä»¶ï¼Œå½“ç›‘å¬åˆ°READ_EVENTäº‹ä»¶ï¼Œå¤„ç†äº‹ä»¶ï¼Œå°†æ•°æ®è¯»å–åˆ°ç”¨æˆ·ç¼“å†²åŒºbuffer
é€šè¿‡IOå¤ç”¨ï¼Œå®ç°ç›‘å¬åˆ°socketäº‹ä»¶å°±ç»ªåï¼Œç›´æ¥è°ƒç”¨accpetæˆ–recvå³å¯ï¼Œç›´æ¥å®ŒæˆTCPè¿æ¥æˆ–è€…æ•°æ®è¯»å–ï¼Œä¸¤ä¸ªå‡½æ•°ä¸ä¼šé˜»å¡ã€‚
å¯ä»¥å®ç°å•è¿›ç¨‹ä¸€å¯¹å¤šæ•ˆæœï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨å¹¶å‘æŠ€æœ¯
å¤„ç†çš„ä¸šåŠ¡å¤æ‚åº¦ä¸èƒ½è¿‡é«˜ï¼Œè¦åœ¨æçŸ­çš„æ—¶é—´å†…å¤„ç†è‹¥å¹²ä»»åŠ¡ï¼ŒæŠ•å…¥äºŒæ¬¡ç›‘å¬
IOå¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆselect å®ç°åŸç† select å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼æ˜¯ï¼Œå°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ªç›‘å¬é›†åˆï¼Œç„¶åè°ƒç”¨ select å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œå°±æ˜¯é€šè¿‡éå†ç›‘å¬é›†åˆçš„æ–¹å¼è¿›è¡Œæ£€æŸ¥ã€‚
å½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤ Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡éå†çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚
æ‰€ä»¥ï¼Œå¯¹äº select è¿™ç§æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ 2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€ä¸ªæ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œ ï¼Œè€Œä¸”è¿˜ä¼šå‘ç”Ÿ 2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä¿®æ”¹åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚
select ä½¿ç”¨å›ºå®šé•¿åº¦çš„ BitsMapï¼Œè¡¨ç¤ºæ–‡ç›‘å¬é›†åˆï¼Œè€Œä¸”æ‰€æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”±å†…æ ¸ä¸­çš„ FD_SETSIZE é™åˆ¶ï¼Œ é»˜è®¤æœ€å¤§å€¼ä¸º 1024ï¼Œæœ€å¤šåªèƒ½ç›‘å¬1021ä¸ªç”¨æˆ·socketï¼Œå› ä¸º0ã€1ã€2æ˜¯æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ã€‚
ç›‘å¬é›†åˆä¸­å¯¹åº”çš„socketä½ç æ˜¯1ï¼Œè¡¨ç¤ºç›‘å¬æ¬¡socketï¼Œä¸º0è¡¨ç¤ºä¸ç›‘å¬
åœ¨selectè¿™ç§I/Oå¤šè·¯å¤ç”¨æœºåˆ¶ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæƒ³ç›‘æ§çš„æ–‡ä»¶æè¿°é›†åˆé€šè¿‡å‡½æ•°å‚æ•°çš„å½¢å¼å‘Šè¯‰selectï¼Œç„¶åselectä¼šå°†è¿™äº›æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®æ‹·è´æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ï¼Œå› æ­¤ä¸ºäº†å‡å°‘è¿™ç§æ•°æ®æ‹·è´å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒLinuxå†…æ ¸å¯¹é›†åˆçš„å¤§å°åšäº†é™åˆ¶ï¼Œå¹¶è§„å®šç”¨æˆ·ç›‘æ§çš„æ–‡ä»¶æè¿°é›†åˆä¸èƒ½è¶…è¿‡1024ä¸ªï¼ŒåŒæ—¶å½“selectè¿”å›åæˆ‘ä»¬ä»…ä»…èƒ½çŸ¥é“æœ‰äº›æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤å¿…é¡»å†éå†ä¸€è¾¹æ‰¾åˆ°å…·ä½“æ˜¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™äº†ã€‚Â å®ç°æµç¨‹ æ ¸å¿ƒæ¥å£ void FD_ZERO(fd_set *fdset) åˆå§‹åŒ–ç›‘å¬é›†åˆä¸º0
void FD_SET(int fd,fd_set *fdset) å¯¹seté›†åˆä¸­fdå¯¹åº”ä½ç è®¾ç½®ä¸º1
void FD_CLR(int fd,fd_set *fdset) å¯¹seté›†åˆä¸­fdå¯¹åº”ä½ç è®¾ç½®ä¸º0
int bitcode=void FD_ISSET(int fd,fd_set *fdset) æŸ¥çœ‹fdåœ¨ç›‘å¬é›†åˆä¸­æ˜¯1è¿˜æ˜¯0ï¼Œå¹¶ç›´æ¥è¿”å›">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-06T18:37:55+08:00">
    <meta property="article:modified_time" content="2024-07-06T18:37:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€é«˜æ€§èƒ½æœåŠ¡å™¨ã€‘selectæ¨¡å‹</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>ğŸ”¥<strong>åšå®¢ä¸»é¡µ</strong>ï¼šÂ <a href="https://blog.csdn.net/Coldreams?type=blog" title="æˆ‘è¦æˆä¸ºC++é¢†åŸŸå¤§ç¥">æˆ‘è¦æˆä¸ºC++é¢†åŸŸå¤§ç¥</a><br><strong>ğŸ¥</strong><strong>ç³»åˆ—ä¸“æ </strong>ï¼š<a href="https://blog.csdn.net/coldreams/category_12692533.html" title="ã€C++æ ¸å¿ƒç¼–ç¨‹ã€‘">ã€C++æ ¸å¿ƒç¼–ç¨‹ã€‘</a>Â <a href="https://blog.csdn.net/coldreams/category_12683159.html" title="ã€è®¡ç®—æœºç½‘ç»œã€‘">ã€è®¡ç®—æœºç½‘ç»œã€‘</a>Â <a href="https://blog.csdn.net/coldreams/category_12683164.html" title="ã€Linuxç¼–ç¨‹ã€‘">ã€Linuxç¼–ç¨‹ã€‘</a>Â <a href="https://blog.csdn.net/coldreams/category_12688033.html" title="ã€æ“ä½œç³»ç»Ÿã€‘">ã€æ“ä½œç³»ç»Ÿã€‘</a><br> â¤ï¸<strong>æ„Ÿè°¢å¤§å®¶ç‚¹èµğŸ‘æ”¶è—â­è¯„è®ºâœï¸</strong></p> 
 <p id="u4bb28a99"><strong>æœ¬åšå®¢è‡´åŠ›äºçŸ¥è¯†åˆ†äº«ï¼Œä¸æ›´å¤šçš„äººè¿›è¡Œå­¦ä¹ äº¤æµ</strong></p> 
</blockquote> 
<p class="img-center"><img alt="" height="80" src="https://images2.imgbox.com/8f/35/AwEbTv3v_o.gif" width="640"></p> 
<p>IOå¤šè·¯å¤ç”¨å°±æ˜¯å¤ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œä»åŸå…ˆä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨recvè¯¢é—®å†…æ ¸æ•°æ®æ˜¯å¦å·²ç»å°±ç»ªï¼Œé‚£ä¹ˆå¤šä¸ªå®¢æˆ·ç«¯å°±éœ€è¦å¤šä¸ªçº¿ç¨‹ï¼Œè½¬å˜æˆç°åœ¨å¤šä¸ªå®¢æˆ·ç«¯éƒ½ç”¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨select/pollå»ç»Ÿä¸€ç®¡ç†ï¼Œä¸»åŠ¨é€šçŸ¥ç”¨æˆ·å“ªäº›æ•°æ®å·²ç»å°±ç»ªï¼ˆreadï¼Œwriteï¼Œacceptç­‰äº‹ä»¶ï¼‰ï¼Œæ‰€ä»¥å¤ç”¨äº†è¿™ä¸ªçº¿ç¨‹ï¼Œå‡å°‘äº†ç³»ç»Ÿå¼€é”€ã€‚</p> 
<p id="u428f8e5e"><em><strong>åœ¨å®¢æˆ·ç«¯å¢åŠ æ—¶ï¼Œçº¿ç¨‹ä¸ä¼šå‘ˆO(n)å¢åŠ </strong></em>ã€‚</p> 
<h2 id="WbWns">å…³äºrecvå’Œacceptå·¥ä½œæµç¨‹</h2> 
<p id="uaa8bd6af"><code>accpet</code>é€šè¿‡æœåŠ¡ç«¯æ–‡ä»¶æè¿°ç¬¦ç›‘å¬socketäº‹ä»¶ï¼Œå½“ç›‘å¬åˆ°<code>READ_EVENT</code>äº‹ä»¶æ—¶ï¼Œè¯´æ˜æœ‰å…¶ä»–ç½‘ç»œç«¯å‘æ­¤socketå‘é€æ•°æ®ï¼Œè§¦å‘socketè¯»äº‹ä»¶ï¼ˆä¸‰æ¬¡æ¡æ‰‹ä¸­å®¢æˆ·ç«¯ä¼šå‘é€æ•°æ®ï¼‰ï¼Œå»ºç«‹TCPè¿æ¥ã€‚</p> 
<p id="u36080f93"><code>recv</code>é€šè¿‡å®¢æˆ·ç«¯æ–‡ä»¶æè¿°ç¬¦ç›‘å¬socketäº‹ä»¶ï¼Œå½“ç›‘å¬åˆ°READ_EVENTäº‹ä»¶ï¼Œå¤„ç†äº‹ä»¶ï¼Œå°†æ•°æ®è¯»å–åˆ°ç”¨æˆ·ç¼“å†²åŒºbuffer</p> 
<p id="ud70f210f"></p> 
<p class="img-center"><img alt="" height="842" id="HP1vO" src="https://images2.imgbox.com/d6/f3/4BKYACKW_o.png" width="1200"></p> 
<p id="ufc55fb86">é€šè¿‡IOå¤ç”¨ï¼Œå®ç°ç›‘å¬åˆ°socketäº‹ä»¶å°±ç»ªåï¼Œç›´æ¥è°ƒç”¨accpetæˆ–recvå³å¯ï¼Œç›´æ¥å®ŒæˆTCPè¿æ¥æˆ–è€…æ•°æ®è¯»å–ï¼Œä¸¤ä¸ªå‡½æ•°ä¸ä¼šé˜»å¡ã€‚</p> 
<p id="u98b023e4"></p> 
<p class="img-center"><img alt="" height="434" id="JILTp" src="https://images2.imgbox.com/25/7c/rNAvdV6Q_o.png" width="1200"></p> 
<p id="u5448e695">å¯ä»¥å®ç°å•è¿›ç¨‹ä¸€å¯¹å¤šæ•ˆæœï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨å¹¶å‘æŠ€æœ¯</p> 
<p id="ud44dfaef">å¤„ç†çš„ä¸šåŠ¡å¤æ‚åº¦ä¸èƒ½è¿‡é«˜ï¼Œè¦åœ¨æçŸ­çš„æ—¶é—´å†…å¤„ç†è‹¥å¹²ä»»åŠ¡ï¼ŒæŠ•å…¥äºŒæ¬¡ç›‘å¬</p> 
<h2 id="DG6AB" style="background-color:transparent;">IOå¤šè·¯å¤ç”¨ç¬¬ä¸€ç‰ˆselect</h2> 
<p id="u38090a48"></p> 
<p class="img-center"><img alt="" height="748" id="ua9a8e2af" src="https://images2.imgbox.com/71/24/nhOMWhEg_o.png" width="1200"></p> 
<hr id="YMWSn"> 
<h3 id="Pla2u" style="background-color:transparent;">å®ç°åŸç†</h3> 
<p id="u310ff8bd"></p> 
<p class="img-center"><img alt="" height="524" id="ud7ea758d" src="https://images2.imgbox.com/8c/47/yCaWIwJV_o.png" width="1200"></p> 
<p id="u3d6b4223">select å®ç°å¤šè·¯å¤ç”¨çš„æ–¹å¼æ˜¯ï¼Œå°†å·²è¿æ¥çš„ Socket éƒ½æ”¾åˆ°ä¸€ä¸ª<strong>ç›‘å¬é›†åˆ</strong>ï¼Œç„¶åè°ƒç”¨ select å‡½æ•°å°†æ–‡ä»¶æè¿°ç¬¦é›†åˆ<strong>æ‹·è´</strong>åˆ°å†…æ ¸é‡Œï¼Œè®©å†…æ ¸æ¥æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œäº‹ä»¶äº§ç”Ÿï¼Œå°±æ˜¯é€šè¿‡<strong>éå†ç›‘å¬é›†åˆ</strong>çš„æ–¹å¼è¿›è¡Œæ£€æŸ¥ã€‚</p> 
<p id="u4c53d00f">å½“æ£€æŸ¥åˆ°æœ‰äº‹ä»¶äº§ç”Ÿåï¼Œå°†æ­¤ Socket æ ‡è®°ä¸ºå¯è¯»æˆ–å¯å†™ï¼Œ æ¥ç€å†æŠŠæ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆ<strong>æ‹·è´</strong>å›ç”¨æˆ·æ€é‡Œï¼Œç„¶åç”¨æˆ·æ€è¿˜éœ€è¦å†é€šè¿‡<strong>éå†</strong>çš„æ–¹æ³•æ‰¾åˆ°å¯è¯»æˆ–å¯å†™çš„ Socketï¼Œç„¶åå†å¯¹å…¶å¤„ç†ã€‚</p> 
<p id="udff555c6">æ‰€ä»¥ï¼Œå¯¹äº select è¿™ç§æ–¹å¼ï¼Œéœ€è¦è¿›è¡Œ <strong>2 æ¬¡ã€Œéå†ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œä¸€æ¬¡æ˜¯åœ¨å†…æ ¸æ€é‡Œï¼Œä¸€ä¸ªæ¬¡æ˜¯åœ¨ç”¨æˆ·æ€é‡Œ ï¼Œè€Œä¸”è¿˜ä¼šå‘ç”Ÿ <strong>2 æ¬¡ã€Œæ‹·è´ã€æ–‡ä»¶æè¿°ç¬¦é›†åˆ</strong>ï¼Œå…ˆä»ç”¨æˆ·ç©ºé—´ä¼ å…¥å†…æ ¸ç©ºé—´ï¼Œç”±å†…æ ¸ä¿®æ”¹åï¼Œå†ä¼ å‡ºåˆ°ç”¨æˆ·ç©ºé—´ä¸­ã€‚</p> 
<p id="u4fba7ad1">select ä½¿ç”¨å›ºå®šé•¿åº¦çš„ BitsMapï¼Œè¡¨ç¤ºæ–‡<strong>ç›‘å¬é›†åˆ</strong>ï¼Œè€Œä¸”æ‰€æ”¯æŒçš„æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°æ˜¯æœ‰é™åˆ¶çš„ï¼Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç”±å†…æ ¸ä¸­çš„ FD_SETSIZE é™åˆ¶ï¼Œ é»˜è®¤æœ€å¤§å€¼ä¸º 1024ï¼Œæœ€å¤šåªèƒ½ç›‘å¬1021ä¸ªç”¨æˆ·socketï¼Œå› ä¸º0ã€1ã€2æ˜¯æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ã€‚</p> 
<p id="ude7bb3e8">ç›‘å¬é›†åˆä¸­å¯¹åº”çš„socketä½ç æ˜¯1ï¼Œè¡¨ç¤ºç›‘å¬æ¬¡socketï¼Œä¸º0è¡¨ç¤ºä¸ç›‘å¬</p> 
<p class="img-center"><img alt="" height="918" id="u1fbe0294" src="https://images2.imgbox.com/c6/a1/o7WOIdvE_o.png" width="1200"></p> 
<p>åœ¨selectè¿™ç§I/Oå¤šè·¯å¤ç”¨æœºåˆ¶ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠæƒ³ç›‘æ§çš„æ–‡ä»¶æè¿°é›†åˆé€šè¿‡å‡½æ•°å‚æ•°çš„å½¢å¼å‘Šè¯‰selectï¼Œç„¶åselectä¼šå°†è¿™äº›æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“æ•°æ®æ‹·è´æ˜¯æœ‰æ€§èƒ½æŸè€—çš„ï¼Œå› æ­¤ä¸ºäº†å‡å°‘è¿™ç§æ•°æ®æ‹·è´å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼ŒLinuxå†…æ ¸å¯¹é›†åˆçš„å¤§å°åšäº†é™åˆ¶ï¼Œå¹¶è§„å®šç”¨æˆ·ç›‘æ§çš„æ–‡ä»¶æè¿°é›†åˆä¸èƒ½è¶…è¿‡1024ä¸ªï¼ŒåŒæ—¶å½“selectè¿”å›åæˆ‘ä»¬ä»…ä»…èƒ½çŸ¥é“æœ‰äº›æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ªï¼Œå› æ­¤å¿…é¡»å†éå†ä¸€è¾¹æ‰¾åˆ°å…·ä½“æ˜¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™äº†ã€‚Â </p> 
<hr id="k5ibE"> 
<h3 id="eJ2XP" style="background-color:transparent;">å®ç°æµç¨‹</h3> 
<p id="u4c8cd071"></p> 
<p class="img-center"><img alt="" height="1198" id="ufecb25f7" src="https://images2.imgbox.com/0b/94/6OoslrLD_o.png" width="1200"></p> 
<h3 id="oja6A" style="background-color:transparent;">æ ¸å¿ƒæ¥å£</h3> 
<blockquote> 
 <p id="ue0daf4a5"><code>void FD_ZERO(fd_set *<em>fdset</em>)</code> åˆå§‹åŒ–ç›‘å¬é›†åˆä¸º0</p> 
 <p id="ud2541e8d"><code>void FD_SET(int <em>fd</em>,fd_set *<em>fdset</em>)</code> å¯¹seté›†åˆä¸­fdå¯¹åº”ä½ç è®¾ç½®ä¸º1</p> 
 <p id="u60ef67ef"><code>void FD_CLR(int <em>fd</em>,fd_set *<em>fdset</em>)</code> å¯¹seté›†åˆä¸­fdå¯¹åº”ä½ç è®¾ç½®ä¸º0</p> 
 <p id="ufb30738a"><code>int bitcode=void FD_ISSET(int <em>fd</em>,fd_set *<em>fdset</em>)</code> æŸ¥çœ‹fdåœ¨ç›‘å¬é›†åˆä¸­æ˜¯1è¿˜æ˜¯0ï¼Œå¹¶ç›´æ¥è¿”å›</p> 
</blockquote> 
<hr id="Y3Jo8"> 
<blockquote> 
 <p id="u1716e54f"><code>int ready=select(int nfds, fd_set* readset, fd_set* writeset, fd_set* exeptset,struct timeval* timeout);</code></p> 
 <p id="uf0e560e0"><code>nfds</code>è¡¨ç¤ºè¢«selectç®¡ç†çš„æè¿°ç¬¦ä¸ªæ•°ã€‚å€¼ä¸ºæœ€å¤§æè¿°ç¬¦+1.ä¸æ˜¯æè¿°ç¬¦æœ€å¤§å€¼</p> 
 <p id="ucdaa0197"><code>readset</code>ã€<code>writeset</code>ã€<code>exeptset</code>å¯è¯»äº‹ä»¶é›†åˆã€å¯å†™äº‹ä»¶é›†åˆã€å¼‚å¸¸äº‹ä»¶é›†åˆã€‚è¿™ä¸‰è€…éƒ½å¯ä»¥å¡«null</p> 
 <p id="ue814c7b2"><code>timeout</code>è¶…æ—¶æ—¶é—´æœ‰ä¸‰ç§å«ä¹‰: é˜»å¡(null)ã€æ­£å¸¸è¶…æ—¶ã€éé˜»å¡(0)</p> 
</blockquote> 
<hr id="gtz9T"> 
<p id="u1279e760"><strong>ä½¿ç”¨æœåŠ¡å™¨æµ‹è¯•ä¸šåŠ¡ï¼š</strong></p> 
<blockquote> 
 <p id="u88f36d7c">å®¢æˆ·ç«¯å‘æ ‡å‡†è¾“å…¥å‘é€å°å†™å­—ç¬¦ä¸²ï¼ŒæœåŠ¡ç«¯å“åº”å›å¤å¯¹åº”å¤§å†™å­—ç¬¦ï¼Œ"abcAS"-&gt;"ABCAS"</p> 
 <p id="u42893e86">å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å…³é”®å­—localtimeï¼ŒæœåŠ¡ç«¯å“åº”å›å¤ç³»ç»Ÿæ—¶é—´ã€</p> 
</blockquote> 
<h3 id="B5xa9" style="background-color:transparent;">ä»£ç å®ç°</h3> 
<p id="u36d836c4">MySock.h</p> 
<pre id="mDWKa"><code class="language-cpp">#ifndef _MYSOCK_H_
#define _MYSOCK_H_

#include &lt;arpa/inet.h&gt;
#include &lt;ctype.h&gt;
#include &lt;errno.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;sys/select.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;time.h&gt;
#include &lt;unistd.h&gt;

int SOCKET(int domain, int type, int protocol);
int BIND(int sockfd, struct sockaddr* addr, socklen_t addrlen);
ssize_t RECV(int sockfd, void* buf, size_t len, int flags);
ssize_t SEND(int sockfd, void* buf, size_t len, int flags);
int CONNECT(int sockfd, struct sockaddr* addr, socklen_t addrlen);
int ACCEPT(int sockfd, struct sockaddr* addr, socklen_t* addrlen);
int LISTEN(int sockfd, int backlog);
char* FGETS(char* s, int size, FILE* stream);
int SELECT(int nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds,
           struct timeval* timeout);
int socket_init();
int return_response(int clientfd, const char* clientip);
//void strDeal(int *client_fd);

// å…¨å±€å˜é‡å£°æ˜
char recv_buf[1024];
char time_buf[64];
int serverFd, clientFd;
struct sockaddr_in clientAddr;
fd_set set, oset;
int client_array[1020];
int maxfd, ready;
socklen_t addrlen;
char clientip[16];
time_t tp;
ssize_t recvlen;
int toupper_flag;
#define SHUTDOWN 1
#endif</code></pre> 
<p id="u478a31c8">MySock.c</p> 
<pre id="Wyph0"><code class="language-cpp">#include "MySock.h"

int SOCKET(int domain, int type, int protocol) {
    int reval = socket(domain, type, protocol);
    if (reval == -1) {
        perror("socket call failed");
        exit(0);
    }
    return reval;
}

int BIND(int sockfd, struct sockaddr* addr, socklen_t addrlen) {
    int reval = bind(sockfd, addr, addrlen);
    if (reval == -1) {
        perror("bind call failed");
        exit(0);
    }
    return reval;
}

ssize_t RECV(int sockfd, void* buf, size_t len, int flags) {
    ssize_t reval;
    reval = recv(sockfd, buf, len, flags);
    return reval;
}

ssize_t SEND(int sockfd, void* buf, size_t len, int flags) {
    ssize_t reval;
    reval = send(sockfd, buf, len, flags);
    if (reval == -1)
        perror("send call failed");
    return reval;
}

int CONNECT(int sockfd, struct sockaddr* addr, socklen_t addrlen) {
    int reval = connect(sockfd, addr, addrlen);
    if (reval == -1) {
        perror("connect call failed");
        exit(0);
    }
    return reval;
}

int ACCEPT(int sockfd, struct sockaddr* addr, socklen_t* addrlen) {
    int reval = accept(sockfd, addr, addrlen);
    if (reval == -1) {
        perror("accept call failed");
        exit(0);
    }
    return reval;
}

int LISTEN(int sockfd, int backlog) {
    int reval = listen(sockfd, backlog);
    if (reval == -1) {
        perror("listen call failed");
        exit(0);
    }
    return reval;
}

char* FGETS(char* s, int size, FILE* stream) {
    char* str;
    if ((str = fgets(s, size, stream)) != NULL) {
        return str;
    } else {
        perror("fgets call failed");
        exit(0);
    }
}

int SELECT(int nfds, fd_set* readfds, fd_set* writefds, fd_set* exceptfds,
           struct timeval* timeout) {
    int reval = select(nfds, readfds, writefds, exceptfds, timeout);
    if (reval == -1) {
        perror("select call failed");
        exit(0);
    }
    return reval;
}

int socket_init() {
    struct sockaddr_in sockAddr;
    sockAddr.sin_family = AF_INET;
    sockAddr.sin_addr.s_addr = htonl(INADDR_ANY);
    sockAddr.sin_port = htons(8080);
    int sock_fd = SOCKET(AF_INET, SOCK_STREAM, 0);
    BIND(sock_fd, (struct sockaddr*)&amp;sockAddr, sizeof(sockAddr));
    LISTEN(sock_fd, 5);
    return sock_fd;
}

int return_response(int clientfd, const char* clientip) {
    char response[1024];
    bzero(response, sizeof(response));
    sprintf(response, "Hi [%s],This is TCP Server Working...\n", clientip);
    SEND(clientfd, response, sizeof(response), 0);
}
</code></pre> 
<p id="u07ad696d">SelectServer.c</p> 
<pre id="bgkqO"><code class="language-cpp">#include "MySock.h"

int main() {
    bzero(recv_buf, sizeof(recv_buf));
    bzero(time_buf, sizeof(time_buf));
    bzero(clientip,sizeof(clientip));
    serverFd = socket_init();
    FD_SET(serverFd, &amp;set); // è®¾ç½®ç›‘å¬
    int i;
    for (i = 0; i &lt; 1020; ++i) {
        client_array[i] = -1;
    }

    maxfd = serverFd;

    printf("Test Select Server is Running...\n");

    while (SHUTDOWN) {
        oset = set;
        ready = SELECT(maxfd+1, &amp;oset, NULL, NULL, NULL);
        while (ready) { // è¾¨åˆ«å°±ç»ª
            if (FD_ISSET(serverFd, &amp;oset)) {
                addrlen = sizeof(clientAddr);
                clientFd =ACCEPT(serverFd, (struct sockaddr*)&amp;clientAddr, &amp;addrlen);
                inet_ntop(AF_INET, &amp;clientAddr.sin_addr.s_addr, clientip, 16);
                printf("Listen Server Socket Successfully Call Accept, Client IP [%s], PORT[%d]\n",clientip, ntohs(clientAddr.sin_port));
                return_response(clientFd, clientip);
                if (maxfd &lt; clientFd)
                    maxfd = clientFd;
                for (i = 0; i &lt; 1020; ++i)
                    if (client_array[i] == -1) {
                        client_array[i] = clientFd;
                        break;
                    }
                FD_SET(clientFd, &amp;set);//æ–°socketè®¾ç½®ç›‘å¬
                FD_CLR(serverFd,&amp;oset);//å¤„ç†å®Œæ¯•ï¼Œæ¸…ç†å°±ç»ªé›†åˆ
            } else {
                // ä»…å¤„ç†ä¸€æ¬¡å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå•è¿›ç¨‹ä¸å…è®¸å®¢æˆ·ç«¯æŒç»­å ç”¨
                for (i = 0; i &lt; 1020; ++i)
                    {if (client_array[i] != -1)
                        if (FD_ISSET(client_array[i], &amp;oset))
                        {
                            if ((recvlen = RECV(client_array[i], recv_buf, sizeof(recv_buf), 0)) &gt;0) 
                             { // å¤„ç†å®¢æˆ·ç«¯ä¸šåŠ¡
                                    printf("Client Say:%s\n", recv_buf);
                                    if (strcmp(recv_buf, "localtime") == 0) {
                                        tp = time(NULL); // è·å–æ—¶é—´ç§å­
                                        ctime_r(&amp;tp, time_buf);
                                        time_buf[strcspn(time_buf, "\n")] = '\0';
                                        printf("[%s]Response SysTime Successfully!\n", clientip);
                                        SEND(client_array[i], time_buf, strlen(time_buf) + 1, 0);
                                        bzero(time_buf, sizeof(time_buf));
                                    } else {
                                        toupper_flag = 0;
                                        while (recvlen &gt; toupper_flag) {
                                            recv_buf[toupper_flag] = toupper(recv_buf[toupper_flag]);
                                            ++toupper_flag;
                                        }
                                        printf("[%s]Response Toupper Successfully!\n", clientip);
                                        SEND(client_array[i], recv_buf, recvlen, 0);
                                        bzero(recv_buf, sizeof(recv_buf));
                                    }
                                } else if (recvlen == 0) {
                                    FD_CLR(client_array[i], &amp;set); // åˆ é™¤ç›‘å¬
                                    close(client_array[i]);
                                    client_array[i] = -1;
                                    printf("Client is Exiting, Delete Listen Item.\n");
                                }
                                FD_CLR(client_array[i],&amp;oset);//å¤„ç†å®Œæ¯•ï¼Œæ¸…ç†å°±ç»ªé›†åˆ
                                break;
                            }
                    }
            }
            ready--;
        }
    }

    printf("Server is Over\n");
    close(serverFd);
    return 0;
}</code></pre> 
<p id="uc1c42898">Client.c</p> 
<pre id="lYTub"><code class="language-cpp">#include "MySock.c"


//å®¢æˆ·ç«¯æºç ç¼–å†™ï¼Œè¿æ¥æœåŠ¡å™¨æˆåŠŸï¼ŒæœåŠ¡å™¨åé¦ˆä¿¡æ¯

#define _IP "xxx.xxx.xxx.xxx"
#define _PORT 8080
int main()
{
    struct sockaddr_in ServerAddr;
    bzero(&amp;ServerAddr,sizeof(ServerAddr));
    ServerAddr.sin_family=AF_INET;
	ServerAddr.sin_port=htons(_PORT);
    inet_pton(AF_INET,_IP,&amp;ServerAddr.sin_addr.s_addr);
    
    int Myfd=SOCKET(AF_INET,SOCK_STREAM,0);
    //çœ‹éœ€æ±‚å†³å®šæ˜¯å¦è¦ç»‘å®š
    char Response[1024];//å­˜æ”¾æœåŠ¡ç«¯åé¦ˆä¿¡æ¯
    ssize_t recvlen;
    bzero(Response,sizeof(Response));
    char sendbuf[1024];
    
    if((CONNECT(Myfd,(struct sockaddr *)&amp;ServerAddr,sizeof(ServerAddr)))==0)
    {
    while(1)
    {    
     if((recvlen=RECV(Myfd,Response,sizeof(Response),0))&gt;0)
     {
         printf("%s\n",Response);
     }
    
    printf("Please Type Some text:");//è¯»å–æ ‡å‡†è¾“å…¥å‘é€ç»™æœåŠ¡ç«¯
    FGETS(sendbuf,sizeof(sendbuf),stdin);    
    sendbuf[strcspn(sendbuf,"\n")]='\0';
    SEND(Myfd,sendbuf,sizeof(sendbuf),0);
    }
    }
    close(Myfd);
    printf("Client is Over\n");
    return 0;
}</code></pre> 
<h3 id="esMk8" style="background-color:transparent;">è¿è¡Œç»“æœ</h3> 
<p class="img-center"><img alt="" height="366" id="u4d62d6cb" src="https://images2.imgbox.com/10/5d/us0oU3id_o.png" width="1200"></p> 
<p class="img-center"><img alt="" height="850" id="uc601bce4" src="https://images2.imgbox.com/56/81/DZn5Rcct_o.png" width="1200"></p> 
<p id="u004a2fc2">selectæ¨¡å‹ä½¿ç”¨ä¸€ä¸ªè¿›ç¨‹å®ç°å¯¹å¤šä¸ªå®¢æˆ·ç«¯çš„ç»Ÿä¸€ç®¡ç†</p> 
<p class="img-center"><img alt="" height="376" id="u9785878f" src="https://images2.imgbox.com/b3/e8/lq9CVqvF_o.png" width="1200"></p> 
<h3 id="UVdEY" style="background-color:transparent;">selectæ¨¡å¼ä¼˜ç¼ºç‚¹</h3> 
<h4 id="uacbf54fd"><strong>ä¼˜ç‚¹</strong></h4> 
<blockquote> 
 <p id="u7f12255b">1.å¯ä»¥é€šè¿‡ç®€å•çš„ä»£ç å®ç°ä¸€å¯¹å¤šæ•ˆæœï¼Œ æ¯”è¾ƒè½»é‡</p> 
 <p id="u0e402551">2.selectæ¨¡å‹æ‹¥æœ‰è¾ƒå¼ºçš„å…¼å®¹æ€§ï¼Œå„ä¸ªå¹³å°å’Œè¯­è¨€éƒ½æœ‰å®ç°</p> 
 <p id="u7d348c80">3.æ”¯æŒå¾®ç§’çº§åˆ«çš„å®šæ—¶é˜»å¡ç›‘å¬ï¼Œå¦‚æœå¯¹æ—¶é—´ç²¾åº¦æœ‰éœ€æ±‚ï¼Œselectå¯ä»¥æ»¡è¶³</p> 
 <p id="u22f4be21">4.è¾ƒä¸ºé€‚åˆç›‘å¬æ•°é‡è¾ƒå°(å±€åŸŸç½‘)ç­‰åœºæ™¯</p> 
</blockquote> 
<h4 id="ucbb3ef90"><strong>ç¼ºç‚¹</strong></h4> 
<blockquote> 
 <p id="u233684e6">1.ç›‘å¬æ•°é‡è¾ƒå°ï¼Œæœ€å¤§åªèƒ½ç›‘å¬1024,æ— æ³•æ»¡è¶³ é«˜å¹¶å‘éœ€æ±‚</p> 
 <p id="u169ad437">2.è½®è¯¢é—®é¢˜ï¼Œ éšç€è½®è¯¢æ•°é‡çš„å¢é•¿ï¼ŒIOå¤„ç†æ€§èƒ½å‘ˆçº¿æ€§ä¸‹é™</p> 
 <p id="u80b8ca60">3.ç”¨æˆ·éœ€è¦å¯¹ä¼ å‡ºä¼ å‡ºç›‘å¬é›†åˆè¿›è¡Œåˆ†ç¦»è®¾ç½®</p> 
 <p id="u054579ec">4.selectåªè¿”å›å°±ç»ªçš„æ•°é‡ï¼Œæ²¡æœ‰åé¦ˆå°±ç»ªçš„socketï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œéå†æŸ¥æ‰¾ï¼Œå¼€é”€è¾ƒå¤§</p> 
 <p id="u3abd0d9b">5.selectå¯ä»¥ç›‘å¬çš„äº‹ä»¶æ•°é‡è¾ƒå°‘ï¼Œselectè®¾ç½®ç›‘å¬æ˜¯æ‰¹å¤„ç†ä»¥é›†åˆä¸ºå•ä½çš„æ— æ³•å¯¹ä¸åŒçš„socket è®¾ç½®ä¸åŒçš„äº‹ä»¶ç›‘å¬</p> 
 <p id="u9568194f">6.selectå¤šè½®ä½¿ç”¨ä¼šå‡ºç°å¤§é‡é‡å¤çš„æ‹·è´å¼€é”€å’ŒæŒ‚è½½ç›‘å¬å¼€é”€</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/11f03ffbddb65750b4242787934ad74c/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Linuxå®‰è£…éƒ¨ç½²PostgreSQLè¯¦ç»†æ­¥éª¤</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c1685e5fbff4e81b1eee4fc1c7a057d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€Cè¯­è¨€å°çŸ¥è¯†ã€‘ç¼“å†²åŒº</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>