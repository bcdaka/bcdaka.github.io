<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 使用 WeChatFerry 搭建部署微信机器人详细教程（更新中） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5cdaa48e30122ddda4b1741210de7e9d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python 使用 WeChatFerry 搭建部署微信机器人详细教程（更新中）">
  <meta property="og:description" content="下载安装 wcferry 库 通过 pip 快速安装 wcferry
pip install wcferry 免责声明：仅供学习和技术研究使用，不得用于任何商业或非法行为，否则后果自负。
基本原理
当微信收到消息时，抢在微信处理（显示到页面）前，先让工具处理，处理完之后再交还给原来的处理模块。需要发送消息时，模拟微信发送消息，组装好消息体，调用微信发送消息的模块。获取联系人，则是遍历一块特定的内存空间。通过好友验证，则是组装好验证信息，调用微信的验证模块。数据库相关功能，则是通过获取到数据库句柄，基于 sqlite3 的接口来执行。
博客地址：微信机器人 DIY 从 0 到 1
Wcf 函数说明 WeChatFerry：一个玩微信的工具（函数说明）
函数名称描述返回类型cleanup关闭连接 回收资源Nonekeep_running阻塞进程（让 RPC 一直维持连接）is_receiving_msg是否已启动接收消息功能boolget_qrcode获取登录二维码（已经登录则返回空字符串）stris_login检查登录状态boolget_self_wxid获取登录账号的 wxidstrget_msg_types获取所有消息类型Dictget_contacts获取所有联系人List[Dict]get_friends获取所有好友List[Dict]get_dbs获取数据库List[str]get_tables获取某数据库下的表List[Dict]get_user_info获取登录账号个人信息Dictget_audio_msg取语音消息并转成 MP3strsend_text发送文本消息（可 @）int_download_file下载文件str_process_path处理路径（如果是网络路径则下载文件）strsend_image发送图片（非线程安全）intsend_file发送文件（非线程安全）intsend_xml发送 XMLintsend_emotion发送表情intsend_rich_text发送富文本消息intsend_pat_msg拍一拍群友intforward_msg转发消息intget_msg从消息队列中获取消息WxMsgenable_receiving_msg允许接收消息boolenable_recv_msg允许接收消息（旧接口）booldisable_recv_msg停止接收消息boolquery_sql执行 SQL 查询List[Dict]accept_new_friend接受好友申请intrefresh_pyq刷新朋友圈intdownload_attach下载附件intget_info_by_wxid通过 wxid 查询微信号昵称等信息dictrevoke_msg撤回消息intdecrypt_image解密图片strget_ocr_result获取 OCR 结果strdownload_image下载图片stradd_chatroom_members添加群成员intdel_chatroom_members删除群成员intinvite_chatroom_members邀请群成员intget_chatroom_members获取群成员Dictget_alias_in_chatroom获取群名片strreceive_transfer接收转账int 电脑端检测登录微信 from wcferry import Wcf wcf = Wcf() 检测微信登陆状态 检查当前 PC 端微信登陆状态？
from wcferry import Wcf wcf = Wcf() print(wcf.is_login()) 获取登录账号信息 获取当前 PC 端微信账号信息？
from wcferry import Wcf wcf = Wcf() print(wcf.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-09T14:26:44+08:00">
    <meta property="article:modified_time" content="2024-05-09T14:26:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 使用 WeChatFerry 搭建部署微信机器人详细教程（更新中）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_wcferry__0"></a>下载安装 wcferry 库</h3> 
<p>通过 pip 快速安装 wcferry</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> wcferry
</code></pre> 
<blockquote> 
 <p>免责声明：仅供学习和技术研究使用，不得用于任何商业或非法行为，否则后果自负。</p> 
</blockquote> 
<p><strong>基本原理</strong></p> 
<p>当微信收到消息时，抢在微信处理（显示到页面）前，先让工具处理，处理完之后再交还给原来的处理模块。需要发送消息时，模拟微信发送消息，组装好消息体，调用微信发送消息的模块。获取联系人，则是遍历一块特定的内存空间。通过好友验证，则是组装好验证信息，调用微信的验证模块。数据库相关功能，则是通过获取到数据库句柄，基于 sqlite3 的接口来执行。</p> 
<p><img src="https://images2.imgbox.com/a3/27/N5sqm8fd_o.png" alt="在这里插入图片描述"><br> <strong>博客地址：<a href="https://mp.weixin.qq.com/s?__biz=MzI0MjI1OTk0OQ==&amp;mid=2247485441&amp;idx=1&amp;sn=4fe95c471df43acca64a1151a63fb282&amp;chksm=e97e4a83de09c395b7c7c59ba9125de688dde4d431863be94084014fb97465266b733bdcbb14&amp;scene=21#wechat_redirect" rel="nofollow">微信机器人 DIY 从 0 到 1</a></strong></p> 
<h3><a id="Wcf__18"></a>Wcf 函数说明</h3> 
<p>WeChatFerry：一个玩微信的工具（函数说明）</p> 
<table><thead><tr><th align="left">函数名称</th><th align="left">描述</th><th align="left">返回类型</th></tr></thead><tbody><tr><td align="left"><code>cleanup</code></td><td align="left">关闭连接 回收资源</td><td align="left">None</td></tr><tr><td align="left"><code>keep_running</code></td><td align="left">阻塞进程（让 RPC 一直维持连接）</td><td align="left"></td></tr><tr><td align="left"><code>is_receiving_msg</code></td><td align="left">是否已启动接收消息功能</td><td align="left">bool</td></tr><tr><td align="left"><code>get_qrcode</code></td><td align="left">获取登录二维码（已经登录则返回空字符串）</td><td align="left">str</td></tr><tr><td align="left"><code>is_login</code></td><td align="left">检查登录状态</td><td align="left">bool</td></tr><tr><td align="left"><code>get_self_wxid</code></td><td align="left">获取登录账号的 wxid</td><td align="left">str</td></tr><tr><td align="left"><code>get_msg_types</code></td><td align="left">获取所有消息类型</td><td align="left">Dict</td></tr><tr><td align="left"><code>get_contacts</code></td><td align="left">获取所有联系人</td><td align="left">List[Dict]</td></tr><tr><td align="left"><code>get_friends</code></td><td align="left">获取所有好友</td><td align="left">List[Dict]</td></tr><tr><td align="left"><code>get_dbs</code></td><td align="left">获取数据库</td><td align="left">List[str]</td></tr><tr><td align="left"><code>get_tables</code></td><td align="left">获取某数据库下的表</td><td align="left">List[Dict]</td></tr><tr><td align="left"><code>get_user_info</code></td><td align="left">获取登录账号个人信息</td><td align="left">Dict</td></tr><tr><td align="left"><code>get_audio_msg</code></td><td align="left">取语音消息并转成 MP3</td><td align="left">str</td></tr><tr><td align="left"><code>send_text</code></td><td align="left">发送文本消息（可 @）</td><td align="left">int</td></tr><tr><td align="left"><code>_download_file</code></td><td align="left">下载文件</td><td align="left">str</td></tr><tr><td align="left"><code>_process_path</code></td><td align="left">处理路径（如果是网络路径则下载文件）</td><td align="left">str</td></tr><tr><td align="left"><code>send_image</code></td><td align="left">发送图片（非线程安全）</td><td align="left">int</td></tr><tr><td align="left"><code>send_file</code></td><td align="left">发送文件（非线程安全）</td><td align="left">int</td></tr><tr><td align="left"><code>send_xml</code></td><td align="left">发送 XML</td><td align="left">int</td></tr><tr><td align="left"><code>send_emotion</code></td><td align="left">发送表情</td><td align="left">int</td></tr><tr><td align="left"><code>send_rich_text</code></td><td align="left">发送富文本消息</td><td align="left">int</td></tr><tr><td align="left"><code>send_pat_msg</code></td><td align="left">拍一拍群友</td><td align="left">int</td></tr><tr><td align="left"><code>forward_msg</code></td><td align="left">转发消息</td><td align="left">int</td></tr><tr><td align="left"><code>get_msg</code></td><td align="left">从消息队列中获取消息</td><td align="left">WxMsg</td></tr><tr><td align="left"><code>enable_receiving_msg</code></td><td align="left">允许接收消息</td><td align="left">bool</td></tr><tr><td align="left"><code>enable_recv_msg</code></td><td align="left">允许接收消息（旧接口）</td><td align="left">bool</td></tr><tr><td align="left"><code>disable_recv_msg</code></td><td align="left">停止接收消息</td><td align="left">bool</td></tr><tr><td align="left"><code>query_sql</code></td><td align="left">执行 SQL 查询</td><td align="left">List[Dict]</td></tr><tr><td align="left"><code>accept_new_friend</code></td><td align="left">接受好友申请</td><td align="left">int</td></tr><tr><td align="left"><code>refresh_pyq</code></td><td align="left">刷新朋友圈</td><td align="left">int</td></tr><tr><td align="left"><code>download_attach</code></td><td align="left">下载附件</td><td align="left">int</td></tr><tr><td align="left"><code>get_info_by_wxid</code></td><td align="left">通过 wxid 查询微信号昵称等信息</td><td align="left">dict</td></tr><tr><td align="left"><code>revoke_msg</code></td><td align="left">撤回消息</td><td align="left">int</td></tr><tr><td align="left"><code>decrypt_image</code></td><td align="left">解密图片</td><td align="left">str</td></tr><tr><td align="left"><code>get_ocr_result</code></td><td align="left">获取 OCR 结果</td><td align="left">str</td></tr><tr><td align="left"><code>download_image</code></td><td align="left">下载图片</td><td align="left">str</td></tr><tr><td align="left"><code>add_chatroom_members</code></td><td align="left">添加群成员</td><td align="left">int</td></tr><tr><td align="left"><code>del_chatroom_members</code></td><td align="left">删除群成员</td><td align="left">int</td></tr><tr><td align="left"><code>invite_chatroom_members</code></td><td align="left">邀请群成员</td><td align="left">int</td></tr><tr><td align="left"><code>get_chatroom_members</code></td><td align="left">获取群成员</td><td align="left">Dict</td></tr><tr><td align="left"><code>get_alias_in_chatroom</code></td><td align="left">获取群名片</td><td align="left">str</td></tr><tr><td align="left"><code>receive_transfer</code></td><td align="left">接收转账</td><td align="left">int</td></tr></tbody></table> 
<h3><a id="_66"></a>电脑端检测登录微信</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_74"></a>检测微信登陆状态</h3> 
<p>检查当前 PC 端微信登陆状态？</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wcf<span class="token punctuation">.</span>is_login<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_83"></a>获取登录账号信息</h3> 
<p>获取当前 PC 端微信账号信息？</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wcf<span class="token punctuation">.</span>get_user_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span><span class="token string-property property">'wxid'</span><span class="token operator">:</span> <span class="token string">'wxid_***'</span><span class="token punctuation">,</span> <span class="token string-property property">'name'</span><span class="token operator">:</span> <span class="token string">'字里行间'</span><span class="token punctuation">,</span> <span class="token string-property property">'mobile'</span><span class="token operator">:</span> <span class="token string">'195********'</span><span class="token punctuation">,</span> <span class="token string-property property">'home'</span><span class="token operator">:</span> <span class="token string">'C:\\Users\\Administrator\\Documents\\WeChat Files\\'</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_97"></a>开辟线程监听群消息</h3> 
<p>开启线程监听消息：判断是否是群消息？</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Empty
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf<span class="token punctuation">,</span> WxMsg

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">processMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> WxMsg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>from_group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>content<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">enableReceivingMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">innerWcFerryProcessMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> wcf<span class="token punctuation">.</span>is_receiving_msg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                msg <span class="token operator">=</span> wcf<span class="token punctuation">.</span>get_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>
                processMsg<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Empty<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ERROR: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    wcf<span class="token punctuation">.</span>enable_receiving_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>innerWcFerryProcessMsg<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"ListenMessageThread"</span><span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>


enableReceivingMsg<span class="token punctuation">(</span><span class="token punctuation">)</span>

wcf<span class="token punctuation">.</span>keep_running<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_132"></a>微信消息属性说明</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">WxMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 微信消息属性说明
</code></pre> 
<p>属性说明</p> 
<table><thead><tr><th align="center">字段名</th><th align="center">类型</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">type</td><td align="center">int</td><td align="center">消息类型 可通过 <code>get_msg_types</code> 获取</td></tr><tr><td align="center">id</td><td align="center">str</td><td align="center">消息 id</td></tr><tr><td align="center">xml</td><td align="center">str</td><td align="center">消息 xml 部分</td></tr><tr><td align="center">sender</td><td align="center">str</td><td align="center">消息发送人</td></tr><tr><td align="center">roomid</td><td align="center">str</td><td align="center">（仅群消息有）群 id</td></tr><tr><td align="center">content</td><td align="center">str</td><td align="center">消息内容</td></tr><tr><td align="center">thumb</td><td align="center">str</td><td align="center">视频或图片消息的缩略图路径</td></tr><tr><td align="center">extra</td><td align="center">str</td><td align="center">视频或图片消息的路径</td></tr></tbody></table> 
<p>消息类型</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wcf<span class="token punctuation">.</span>get_msg_types<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<table><thead><tr><th align="center">消息类型编号</th><th align="center">消息类型描述</th><th align="center">属性</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">朋友圈消息</td><td align="center">int</td></tr><tr><td align="center">1</td><td align="center">文字</td><td align="center">int</td></tr><tr><td align="center">3</td><td align="center">图片</td><td align="center">int</td></tr><tr><td align="center">34</td><td align="center">语音</td><td align="center">int</td></tr><tr><td align="center">37</td><td align="center">好友确认</td><td align="center">int</td></tr><tr><td align="center">40</td><td align="center">POSSIBLEFRIEND_MSG</td><td align="center">int</td></tr><tr><td align="center">42</td><td align="center">名片</td><td align="center">int</td></tr><tr><td align="center">43</td><td align="center">视频</td><td align="center">int</td></tr><tr><td align="center">47</td><td align="center">石头剪刀布</td><td align="center">表情图片</td></tr><tr><td align="center">48</td><td align="center">位置</td><td align="center">int</td></tr><tr><td align="center">49</td><td align="center">共享实时位置、文件、转账、链接</td><td align="center">int</td></tr><tr><td align="center">50</td><td align="center">VOIPMSG</td><td align="center">int</td></tr><tr><td align="center">51</td><td align="center">微信初始化</td><td align="center">int</td></tr><tr><td align="center">52</td><td align="center">VOIPNOTIFY</td><td align="center">int</td></tr><tr><td align="center">53</td><td align="center">VOIPINVITE</td><td align="center">int</td></tr><tr><td align="center">62</td><td align="center">小视频</td><td align="center">int</td></tr><tr><td align="center">66</td><td align="center">微信红包</td><td align="center">int</td></tr><tr><td align="center">9999</td><td align="center">SYSNOTICE</td><td align="center">int</td></tr><tr><td align="center">10000</td><td align="center">红包、系统消息</td><td align="center">int</td></tr><tr><td align="center">10002</td><td align="center">撤回消息</td><td align="center">int</td></tr><tr><td align="center">1048625</td><td align="center">搜狗表情</td><td align="center">int</td></tr><tr><td align="center">16777265</td><td align="center">链接</td><td align="center">int</td></tr><tr><td align="center">436207665</td><td align="center">微信红包</td><td align="center">int</td></tr><tr><td align="center">536936497</td><td align="center">红包封面</td><td align="center">int</td></tr><tr><td align="center">754974769</td><td align="center">视频号视频</td><td align="center">int</td></tr><tr><td align="center">771751985</td><td align="center">视频号名片</td><td align="center">int</td></tr><tr><td align="center">822083633</td><td align="center">引用消息</td><td align="center">int</td></tr><tr><td align="center">922746929</td><td align="center">拍一拍</td><td align="center">int</td></tr><tr><td align="center">973078577</td><td align="center">视频号直播</td><td align="center">int</td></tr><tr><td align="center">974127153</td><td align="center">商品链接</td><td align="center">int</td></tr><tr><td align="center">975175729</td><td align="center">视频号直播</td><td align="center">int</td></tr><tr><td align="center">1040187441</td><td align="center">音乐链接</td><td align="center">int</td></tr><tr><td align="center">1090519089</td><td align="center">文件</td><td align="center">int</td></tr></tbody></table> 
<h3><a id="_wxid_198"></a>根据群名称查询群 wxid</h3> 
<p>特别注意：Wcf 没有提供根据群名称查询群 wxid 功能。我们可以先获取全部联系人数据（微信好友、微信群等等），基于 wxid 进行区分，因为微信群 wxid 后缀都是 “chatroom” 结尾。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf<span class="token punctuation">,</span> WxMsg

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>

wcf_rooms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> contact <span class="token keyword">in</span> wcf<span class="token punctuation">.</span>get_contacts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> contact<span class="token punctuation">[</span><span class="token string">'wxid'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"chatroom"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        wcf_rooms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>contact<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_chatroom_roomid</span><span class="token punctuation">(</span>wcf_rooms<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">,</span> room_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> room <span class="token keyword">in</span> wcf_rooms<span class="token punctuation">:</span>
        <span class="token keyword">if</span> room<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> room_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span> room<span class="token punctuation">[</span><span class="token string">'wxid'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>

room_id <span class="token operator">=</span> get_chatroom_roomid<span class="token punctuation">(</span>wcf_rooms<span class="token operator">=</span>wcf_rooms<span class="token punctuation">,</span> room_name<span class="token operator">=</span><span class="token string">"测试群"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_220"></a>定时发送群文件</h3> 
<p>如何进行定时发送群文件？通过 aspschedule 第三方库实现定时任务，然后调用 wcf.send_file 函数执行发送文件的消息。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> apscheduler<span class="token punctuation">.</span>schedulers<span class="token punctuation">.</span>background <span class="token keyword">import</span> BackgroundScheduler
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>

wcf_rooms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> contact <span class="token keyword">in</span> wcf<span class="token punctuation">.</span>get_contacts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> contact<span class="token punctuation">[</span><span class="token string">'wxid'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"chatroom"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        wcf_rooms<span class="token punctuation">.</span>append<span class="token punctuation">(</span>contact<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_chatroom_roomid</span><span class="token punctuation">(</span>wcf_rooms<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">,</span> room_name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> room <span class="token keyword">in</span> wcf_rooms<span class="token punctuation">:</span>
        <span class="token keyword">if</span> room<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">==</span> room_name<span class="token punctuation">:</span>
            <span class="token keyword">return</span> room<span class="token punctuation">[</span><span class="token string">'wxid'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>


<span class="token keyword">def</span> <span class="token function">schedule_task_job</span><span class="token punctuation">(</span>room_id<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> wcf<span class="token punctuation">:</span> Wcf<span class="token punctuation">)</span><span class="token punctuation">:</span>
    wcf<span class="token punctuation">.</span>send_file<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string">"test.txt"</span><span class="token punctuation">,</span> receiver<span class="token operator">=</span>room_id<span class="token punctuation">)</span>


customize_time <span class="token operator">=</span> <span class="token string">"2024-05-09 09:10:10"</span>
customize_room <span class="token operator">=</span> <span class="token string">"唤醒手腕测试群"</span>
run_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>customize_time<span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span>
room_id <span class="token operator">=</span> get_chatroom_roomid<span class="token punctuation">(</span>wcf_rooms<span class="token punctuation">,</span> customize_room<span class="token punctuation">)</span>

scheduler <span class="token operator">=</span> BackgroundScheduler<span class="token punctuation">(</span><span class="token punctuation">)</span>
scheduler<span class="token punctuation">.</span>add_job<span class="token punctuation">(</span>schedule_task_job<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>room_id<span class="token punctuation">,</span> wcf<span class="token punctuation">)</span><span class="token punctuation">,</span> run_date<span class="token operator">=</span>run_date<span class="token punctuation">)</span>
scheduler<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

wcf<span class="token punctuation">.</span>keep_running<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果</p> 
<p><img src="https://images2.imgbox.com/96/b9/OXIS0Sje_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_264"></a>监听保存语音消息</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Empty
<span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread

<span class="token keyword">from</span> wcferry <span class="token keyword">import</span> Wcf<span class="token punctuation">,</span> WxMsg

wcf <span class="token operator">=</span> Wcf<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">processMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> WxMsg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>from_group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> wcf<span class="token punctuation">.</span>get_audio_msg<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>msg<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> <span class="token builtin">dir</span><span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"audio"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"语音地址："</span> <span class="token operator">+</span> response<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">enableReceivingMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">innerWcFerryProcessMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> wcf<span class="token punctuation">.</span>is_receiving_msg<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                msg <span class="token operator">=</span> wcf<span class="token punctuation">.</span>get_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>
                processMsg<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token keyword">except</span> Empty<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ERROR: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    wcf<span class="token punctuation">.</span>enable_receiving_msg<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>innerWcFerryProcessMsg<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"ListenMessageThread"</span><span class="token punctuation">,</span> daemon<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>


enableReceivingMsg<span class="token punctuation">(</span><span class="token punctuation">)</span>

wcf<span class="token punctuation">.</span>keep_running<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_301"></a>更新中······</h3>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/503c84f0395b1271054f0c6b20a9a1f7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端-element输入框-input的一些限制(只能输入正整数和0，或者只能输入数字不可以汉字字母)，禁止输入特殊字符等</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5c13aa4f2e3b569885cc7c48c25958ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JetBrains GoLand v2024.1 安装教程 (Go语言集成开发IDE)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>