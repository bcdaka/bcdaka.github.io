<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark2.x 入门： KMeans 聚类算法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8fa98c200f6236fcfd96201652b05573/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spark2.x 入门： KMeans 聚类算法">
  <meta property="og:description" content="一 KMeans简介 KMeans 是一个迭代求解的聚类算法，其属于 划分（Partitioning） 型的聚类方法，即首先创建K个划分，然后迭代地将样本从一个划分转移到另一个划分来改善最终聚类的质量。
ML包下的KMeans方法位于org.apache.spark.ml.clustering包下，其过程大致如下：
1.根据给定的k值，选取k个样本点作为初始划分中心； 2.计算所有样本点到每一个划分中心的距离，并将所有样本点划分到距离最近的划分中心； 3.计算每个划分中样本点的平均值，将其作为新的中心； 循环进行2~3步直至达到最大迭代次数，或划分中心的变化小于某一预定义阈值 显然，初始划分中心的选取在很大程度上决定了最终聚类的质量，和MLlib包一样，ML包内置的KMeans类也提供了名为 KMeans|| 的初始划分中心选择方法，它是著名的 KMeans&#43;&#43; 方法的并行化版本，其思想是令初始聚类中心尽可能的互相远离，具体实现细节可以参见斯坦福大学的B Bahmani在PVLDB上的论文Scalable K-Means&#43;&#43;，这里不再赘述。
二 实战 与MLlib版本的Kmeans教程相同，本文亦使用UCI数据集中的鸢尾花数据Iris进行实验，它可以在iris获取，Iris数据的样本容量为150，有四个实数值的特征，分别代表花朵四个部位的尺寸，以及该样本对应鸢尾花的亚种类型（共有3种亚种类型），如下所示：
5.1,3.5,1.4,0.2,setosa ... 5.4,3.0,4.5,1.5,versicolor ... 7.1,3.0,5.9,2.1,virginica ... 在使用前，引入需要的包：
import org.apache.spark.ml.clustering.{KMeans,KMeansModel} import org.apache.spark.ml.linalg.{Vector,Vectors} 开启RDD的隐式转换：
import spark.implicits._ 下文中，我们默认名为spark的SparkSession已经创建。
为了便于生成相应的DataFrame，这里定义一个名为model_instance的case class作为DataFrame每一行（一个数据样本）的数据类型。
注：因为是非监督学习，所以不需要数据中的label,只需要使用特征向量数据就可以。
scala&gt; case class model_instance(features: org.apache.spark.ml.linalg.Vector) defined class model_instance 在定义数据类型完成后，即可将数据读入RDD[model_instance]的结构中，并通过RDD的隐式转换.toDF()方法完成RDD到DataFrame的转换：
val rawData = sc.textFile(&#34;file:///root/data/iris.txt&#34;) rawData: org.apache.spark.rdd.RDD[String] = file:///root/data/iris.txt MapPartitionsRDD[220] at textFile at &lt;console&gt;:56 scala&gt; val df = rawData.map(line =&gt;{ model_instance( Vectors.dense(line.split(&#34;,&#34;).filter(p =&gt; p.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-07T10:22:30+08:00">
    <meta property="article:modified_time" content="2024-09-07T10:22:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark2.x 入门： KMeans 聚类算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_KMeans_0"></a>一 KMeans简介</h3> 
<p><code>KMeans</code> 是一个迭代求解的聚类算法，其属于 划分（<code>Partitioning</code>） 型的聚类方法，即首先创建<code>K</code>个划分，然后迭代地将样本从一个划分转移到另一个划分来改善最终聚类的质量。</p> 
<p>ML包下的KMeans方法位于<code>org.apache.spark.ml.clustering</code>包下，其过程大致如下：</p> 
<pre><code>1.根据给定的k值，选取k个样本点作为初始划分中心；
2.计算所有样本点到每一个划分中心的距离，并将所有样本点划分到距离最近的划分中心；
3.计算每个划分中样本点的平均值，将其作为新的中心；
循环进行2~3步直至达到最大迭代次数，或划分中心的变化小于某一预定义阈值
</code></pre> 
<p>显然，初始划分中心的选取在很大程度上决定了最终聚类的质量，和MLlib包一样，ML包内置的KMeans类也提供了名为 <code>KMeans||</code> 的初始划分中心选择方法，它是著名的 <code>KMeans++</code> 方法的并行化版本，其思想是令初始聚类中心尽可能的互相远离，具体实现细节可以参见斯坦福大学的<code>B Bahmani</code>在PVLDB上的论文<a href="http://theory.stanford.edu/~sergei/papers/vldb12-kmpar.pdf" rel="nofollow">Scalable K-Means++</a>，这里不再赘述。</p> 
<h3><a id="__13"></a>二 实战</h3> 
<p>与MLlib版本的Kmeans教程相同，本文亦使用UCI数据集中的鸢尾花数据Iris进行实验，它可以在<a href="http://dblab.xmu.edu.cn/blog/wp-content/uploads/2017/03/iris.txt" rel="nofollow">iris</a>获取，Iris数据的样本容量为150，有四个实数值的特征，分别代表花朵四个部位的尺寸，以及该样本对应鸢尾花的亚种类型（共有3种亚种类型），如下所示：</p> 
<pre><code>5.1,3.5,1.4,0.2,setosa
...
5.4,3.0,4.5,1.5,versicolor
...
7.1,3.0,5.9,2.1,virginica
...
</code></pre> 
<p>在使用前，引入需要的包：</p> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>ml<span class="token punctuation">.</span>clustering<span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>KMeans<span class="token punctuation">,</span>KMeansModel<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>ml<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span>Vector<span class="token punctuation">,</span>Vectors<span class="token punctuation">}</span>
</code></pre> 
<p>开启<code>RDD</code>的隐式转换：</p> 
<pre><code class="prism language-scala"><span class="token keyword">import</span> <span class="token namespace">spark<span class="token punctuation">.</span>implicits<span class="token punctuation">.</span></span>_
</code></pre> 
<p>下文中，我们默认名为<code>spark</code>的<code>SparkSession</code>已经创建。</p> 
<p>为了便于生成相应的<code>DataFrame</code>，这里定义一个名为<code>model_instance</code>的<code>case class</code>作为<code>DataFrame</code>每一行（一个数据样本）的数据类型。<br> 注：因为是非监督学习，所以不需要数据中的label,只需要使用特征向量数据就可以。</p> 
<pre><code class="prism language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">case</span> <span class="token keyword">class</span> model_instance<span class="token punctuation">(</span>features<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>ml<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>Vector<span class="token punctuation">)</span>
defined <span class="token keyword">class</span> model_instance
</code></pre> 
<p>在定义数据类型完成后，即可将数据读入<code>RDD[model_instance]</code>的结构中，并通过RDD的隐式转换<code>.toDF()</code>方法完成<code>RDD</code>到<code>DataFrame</code>的转换：</p> 
<pre><code class="prism language-scala"><span class="token keyword">val</span> rawData <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">"file:///root/data/iris.txt"</span><span class="token punctuation">)</span>
rawData<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//root/data/iris.txt MapPartitionsRDD[220] at textFile at &lt;console&gt;:56</span>

scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> df <span class="token operator">=</span> rawData<span class="token punctuation">.</span>map<span class="token punctuation">(</span>line <span class="token keyword">=&gt;</span><span class="token punctuation">{<!-- --></span> model_instance<span class="token punctuation">(</span> Vectors<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">.</span>filter<span class="token punctuation">(</span>p <span class="token keyword">=&gt;</span> p<span class="token punctuation">.</span>matches<span class="token punctuation">(</span><span class="token string">"\\d*(\\.?)\\d*"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>_<span class="token punctuation">.</span>toDouble<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toDF<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataFrame <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token operator">:</span> vector<span class="token punctuation">]</span>
</code></pre> 
<p>与<code>MLlib</code>版的教程类似，我们使用了<code>filter</code>算子，过滤掉类标签，正则表达式<code>\\d*(\\.?)\\d*</code>可以用于匹配实数类型的数字，<code>\\d*</code>使用了<code>*</code>限定符，表示匹配0次或多次的数字字符，<code>\\.?</code>使用了?限定符，表示匹配0次或1次的小数点。</p> 
<p>在得到数据后，我们即可通过ML包的固有流程：创建<code>Estimator</code>并调用其<code>fit()</code>方法来生成相应的<code>Transformer</code>对象，很显然，在这里<code>KMeans</code>类是<code>Estimator</code>，而用于保存训练后模型的<code>KMeansModel</code>类则属于<code>Transformer</code>：</p> 
<pre><code class="prism language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> kmeansmodel <span class="token operator">=</span> <span class="token keyword">new</span> KMeans<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setK<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setFeaturesCol<span class="token punctuation">(</span><span class="token string">"features"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setPredictionCol<span class="token punctuation">(</span><span class="token string">"prediction"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
kmeansmodel<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>ml<span class="token punctuation">.</span>clustering<span class="token punctuation">.</span>KMeansModel <span class="token operator">=</span> kmeans_bdadcf53b52e
</code></pre> 
<p>与<code>MLlib</code>版本类似，ML包下的KMeans方法也有<code>Seed</code>（随机数种子）、<code>Tol</code>（收敛阈值）、<code>K</code>（簇个数）、<code>MaxIter</code>（最大迭代次数）、<code>initMode</code>（初始化方式）、<code>initStep</code>（KMeans||方法的步数）等参数可供设置，和其他的ML框架算法一样，用户可以通过相应的<code>setXXX()</code>方法来进行设置，或以<code>ParamMap</code>的形式传入参数，这里为了简介期间，使用<code>setXXX()</code>方法设置了参数<code>K</code>，其余参数均采用默认值</p> 
<p>与MLlib中的实现不同，<code>KMeansModel</code>作为一个<code>Transformer</code>，不再提供<code>predict()</code>样式的方法，而是提供了一致性的<code>transform()</code>方法，用于将存储在<code>DataFrame</code>中的给定数据集进行整体处理，生成带有预测簇标签的数据集：</p> 
<pre><code class="prism language-scala">scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> results <span class="token operator">=</span> kmeansmodel<span class="token punctuation">.</span>transform<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
results<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataFrame <span class="token operator">=</span> <span class="token punctuation">[</span>features<span class="token operator">:</span> vector<span class="token punctuation">,</span> prediction<span class="token operator">:</span> int<span class="token punctuation">]</span>
</code></pre> 
<p>为了方便观察，我们可以使用collect()方法，该方法将DataFrame中所有的数据组织成一个Array对象进行返回：</p> 
<pre><code class="prism language-scala">scala<span class="token operator">&gt;</span> results<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>row <span class="token keyword">=&gt;</span> <span class="token punctuation">{<!-- --></span>println<span class="token punctuation">(</span> row<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is predicted as cluster "</span> <span class="token operator">+</span> row<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">5.1</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span> is predicted as cluster <span class="token number">2</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">6.3</span><span class="token punctuation">,</span><span class="token number">3.3</span><span class="token punctuation">,</span><span class="token number">6.0</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">]</span> is predicted as cluster <span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">5.8</span><span class="token punctuation">,</span><span class="token number">2.7</span><span class="token punctuation">,</span><span class="token number">5.1</span><span class="token punctuation">,</span><span class="token number">1.9</span><span class="token punctuation">]</span> is predicted as cluster <span class="token number">0</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

scala<span class="token operator">&gt;</span> results<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token operator">|</span>         features<span class="token operator">|</span>prediction<span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.1</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.9</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.7</span><span class="token punctuation">,</span><span class="token number">3.2</span><span class="token punctuation">,</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.6</span><span class="token punctuation">,</span><span class="token number">3.1</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">3.6</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.4</span><span class="token punctuation">,</span><span class="token number">3.9</span><span class="token punctuation">,</span><span class="token number">1.7</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.6</span><span class="token punctuation">,</span><span class="token number">3.4</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span><span class="token number">3.4</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.4</span><span class="token punctuation">,</span><span class="token number">2.9</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.9</span><span class="token punctuation">,</span><span class="token number">3.1</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.4</span><span class="token punctuation">,</span><span class="token number">3.7</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span><span class="token number">3.4</span><span class="token punctuation">,</span><span class="token number">1.6</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.8</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">4.3</span><span class="token punctuation">,</span><span class="token number">3.0</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.8</span><span class="token punctuation">,</span><span class="token number">4.0</span><span class="token punctuation">,</span><span class="token number">1.2</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.7</span><span class="token punctuation">,</span><span class="token number">4.4</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.4</span><span class="token punctuation">,</span><span class="token number">3.9</span><span class="token punctuation">,</span><span class="token number">1.3</span><span class="token punctuation">,</span><span class="token number">0.4</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.1</span><span class="token punctuation">,</span><span class="token number">3.5</span><span class="token punctuation">,</span><span class="token number">1.4</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.7</span><span class="token punctuation">,</span><span class="token number">3.8</span><span class="token punctuation">,</span><span class="token number">1.7</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">|</span><span class="token punctuation">[</span><span class="token number">5.1</span><span class="token punctuation">,</span><span class="token number">3.8</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0.3</span><span class="token punctuation">]</span><span class="token operator">|</span>         <span class="token number">0</span><span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
only showing top <span class="token number">20</span> rows
</code></pre> 
<p>也可以通过KMeansModel类自带的clusterCenters属性获取到模型的所有聚类中心情况：</p> 
<pre><code class="prism language-scala">scala<span class="token operator">&gt;</span> kmeansmodel<span class="token punctuation">.</span>clusterCenters<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>center <span class="token keyword">=&gt;</span> <span class="token punctuation">{<!-- --></span>println<span class="token punctuation">(</span><span class="token string">"Clustering Center:"</span><span class="token operator">+</span>center<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
Clustering Center<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">5.005999999999999</span><span class="token punctuation">,</span><span class="token number">3.4180000000000006</span><span class="token punctuation">,</span><span class="token number">1.4640000000000002</span><span class="token punctuation">,</span><span class="token number">0.2439999999999999</span><span class="token punctuation">]</span>
Clustering Center<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">5.901612903225806</span><span class="token punctuation">,</span><span class="token number">2.7483870967741932</span><span class="token punctuation">,</span><span class="token number">4.393548387096774</span><span class="token punctuation">,</span><span class="token number">1.433870967741935</span><span class="token punctuation">]</span>
Clustering Center<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">6.85</span><span class="token punctuation">,</span><span class="token number">3.0736842105263147</span><span class="token punctuation">,</span><span class="token number">5.742105263157893</span><span class="token punctuation">,</span><span class="token number">2.071052631578947</span><span class="token punctuation">]</span>
</code></pre> 
<p>与MLlib下的实现相同，KMeansModel类也提供了计算 集合内误差平方和（Within Set Sum of Squared Error, WSSSE) 的方法来度量聚类的有效性，在真实K值未知的情况下，该值的变化可以作为选取合适K值的一个重要参考：</p> 
<pre><code>scala&gt; kmeansmodel.computeCost(df)
res30: Double = 78.94084142614622
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/15a00ab5053aa11342d6ed4eca1db857/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Llama中的曼巴：通过推测解码加速推理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ed79ef6e9d18fe0542f54ec25d9bfd6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot3 简单集成 Mybatis plus</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>