<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>国密SM2 后端Hutool&#43;前端sm-crypto - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a4f35a6a63248a561ad4ae9114098f98/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="国密SM2 后端Hutool&#43;前端sm-crypto">
  <meta property="og:description" content="前言 在网上找了很多文章，都只是单独说了用后端加解密及前端加解密，很少把两个结合起来一起说的文章，本文分享两者结合起来的用法和踩坑。
准备工作 前端项目引入第三方包
npm install --save sm-crypto 后端项目引入工具类
&lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.8.16&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt; &lt;artifactId&gt;bcprov-jdk15to18&lt;/artifactId&gt; &lt;version&gt;1.69&lt;/version&gt; &lt;/dependency&gt; 生成密钥 使用工具类生成两套公私钥: 服务端公私钥、客户端公私钥
前端拿服务端公钥&#43;客户端私钥
后端拿客户端公钥&#43;服务端私钥
本文仅做演示，如何安全存储密钥请自行研究。
import cn.hutool.core.util.HexUtil; import cn.hutool.crypto.BCUtil; import cn.hutool.crypto.SmUtil; import cn.hutool.crypto.asymmetric.SM2; import org.bouncycastle.crypto.engines.SM2Engine; import org.bouncycastle.jcajce.provider.asymmetric.ec.BCECPublicKey; //创建sm2 对象 SM2 sm = SmUtil.sm2(); // sm2的加解密时有两种方式即 C1C2C3、 C1C3C2， sm.setMode(SM2Engine.Mode.C1C3C2); // 生成私钥 String privateKey = HexUtil.encodeHexStr(sm.getPrivateKey().getEncoded()); log.info(&#34;私钥: {}&#34;, privateKey); // 生成公钥 String publicKey = HexUtil.encodeHexStr(sm.getPublicKey().getEncoded()); log.info(&#34;公钥: {}&#34;, publicKey); // 生成私钥 D，以D值做为js端的解密私钥 String privateKeyD = HexUtil.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-05T15:45:44+08:00">
    <meta property="article:modified_time" content="2024-02-05T15:45:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">国密SM2 后端Hutool&#43;前端sm-crypto</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_2"></a>前言</h3> 
<p>在网上找了很多文章，都只是单独说了用后端加解密及前端加解密，很少把两个结合起来一起说的文章，本文分享两者结合起来的用法和踩坑。</p> 
<h3><a id="_6"></a>准备工作</h3> 
<p>前端项目引入第三方包</p> 
<pre><code class="prism language-javascript">npm install <span class="token operator">--</span>save sm<span class="token operator">-</span>crypto
</code></pre> 
<p>后端项目引入工具类</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>cn<span class="token punctuation">.</span>hutool<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>hutool<span class="token operator">-</span>all<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">5.8</span><span class="token number">.16</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
  <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>bouncycastle<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>bcprov<span class="token operator">-</span>jdk15to18<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
  <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.69</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="_28"></a>生成密钥</h3> 
<blockquote> 
 <p>使用工具类生成两套公私钥: 服务端公私钥、客户端公私钥<br> 前端拿服务端公钥+客户端私钥<br> 后端拿客户端公钥+服务端私钥</p> 
</blockquote> 
<p>本文仅做演示，如何安全存储密钥请自行研究。</p> 
<pre><code class="prism language-java">	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HexUtil</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">BCUtil</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">SmUtil</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>asymmetric<span class="token punctuation">.</span></span><span class="token class-name">SM2</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>engines<span class="token punctuation">.</span></span><span class="token class-name">SM2Engine</span></span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jcajce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>asymmetric<span class="token punctuation">.</span>ec<span class="token punctuation">.</span></span><span class="token class-name">BCECPublicKey</span></span><span class="token punctuation">;</span>
				
	<span class="token comment">//创建sm2 对象</span>
	<span class="token class-name">SM2</span> sm <span class="token operator">=</span> <span class="token class-name">SmUtil</span><span class="token punctuation">.</span><span class="token function">sm2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        
	<span class="token comment">// sm2的加解密时有两种方式即 C1C2C3、 C1C3C2，</span>
	sm<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token class-name">SM2Engine<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span><span class="token constant">C1C3C2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		        
	<span class="token comment">// 生成私钥</span>
	<span class="token class-name">String</span> privateKey <span class="token operator">=</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"私钥: {}"</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		        
	<span class="token comment">// 生成公钥</span>
	<span class="token class-name">String</span> publicKey <span class="token operator">=</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"公钥: {}"</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	 <span class="token comment">// 生成私钥 D，以D值做为js端的解密私钥</span>
     <span class="token class-name">String</span> privateKeyD <span class="token operator">=</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span><span class="token class-name">BCUtil</span><span class="token punctuation">.</span><span class="token function">encodeECPrivateKey</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"私钥D: {}"</span><span class="token punctuation">,</span> privateKeyD<span class="token punctuation">)</span><span class="token punctuation">;</span>
     	
	<span class="token comment">// 生成公钥 Q，以Q值做为js端的加密公钥</span>
	<span class="token class-name">String</span> publicKeyQ <span class="token operator">=</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">BCECPublicKey</span><span class="token punctuation">)</span> sm<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"公钥Q: {}"</span><span class="token punctuation">,</span> publicKeyQ<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">	私 钥<span class="token operator">:</span> <span class="token number">308193020100301306072</span>a8648ce3d020106082a811ccf5501822d047930770201010420b1933b8a0c16c1bcf64dcbcc2cb822c27452dfb8a19b6167e5ee9bec963b8171a00a06082a811ccf5501822da14403420004d6fd83141fe38cee09f8f4e20a72d3ba056dcfeeda4238dc671a1f11e811293c10b8537ea0adb4b9ad1fa37d147b65c451fe4ab51054d71c810cc0e84cd8232d
	公 钥<span class="token operator">:</span> <span class="token number">3059301306072</span>a8648ce3d020106082a811ccf5501822d03420004d6fd83141fe38cee09f8f4e20a72d3ba056dcfeeda4238dc671a1f11e811293c10b8537ea0adb4b9ad1fa37d147b65c451fe4ab51054d71c810cc0e84cd8232d
	私钥<span class="token class-name">D</span><span class="token operator">:</span> <span class="token number">00</span>b1933b8a0c16c1bcf64dcbcc2cb822c27452dfb8a19b6167e5ee9bec963b8171
	公钥<span class="token class-name">Q</span><span class="token operator">:</span> <span class="token number">04d</span><span class="token number">6f</span>d83141fe38cee09f8f4e20a72d3ba056dcfeeda4238dc671a1f11e811293c10b8537ea0adb4b9ad1fa37d147b65c451fe4ab51054d71c810cc0e84cd8232d
</code></pre> 
<p><strong><font color="red">上面密钥仅供参考</font></strong></p> 
<h3><a id="_75"></a>加密及解密</h3> 
<h4><a id="1_77"></a>1.前端加密+后端解密</h4> 
<p>在需要加解密的js文件中引入sm2方法</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> sm2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sm-crypto'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sm2

<span class="token comment">// 1 - C1C3C2，0 - C1C2C3，默认为1</span>
<span class="token keyword">const</span> cipherMode <span class="token operator">=</span> <span class="token number">1</span> 

<span class="token comment">//服务端公钥 Q</span>
<span class="token keyword">const</span> publicKeyQ <span class="token operator">=</span><span class="token string">"服务端公钥 Q"</span><span class="token punctuation">;</span>

<span class="token comment">//要加密的报文</span>
<span class="token keyword">const</span> body<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"age"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string-property property">"name"</span><span class="token operator">:</span><span class="token string">"张三"</span><span class="token punctuation">}</span>

 <span class="token comment">// 加密</span>
<span class="token keyword">let</span> encryStr<span class="token operator">=</span>sm2<span class="token punctuation">.</span><span class="token function">doEncrypt</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">,</span> publicKeyQ<span class="token punctuation">,</span> cipherMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"> <span class="token comment">// 加密结果</span>
encryStr<span class="token operator">:</span> aaaba1cea1af9a9c621d75bacc7434e1eea713861885a28ab8b3a5ebc911bf971c76af94acff2ab0647b8e157e9ccb6f78e85d5173120fbb11f9be610c0194c3c7d97b069478c4f07d06982b4c691d530bb817f490f531b271ee8d52bb9babbe8305ff92782f4fe263a6ea63d010c4bb682241aff20b5c11442a
</code></pre> 
<p><strong><font color="red">注意：通过前端加密的密文没有04前缀，所以如果我们想要在后端解密需要手动加上</font></strong></p> 
<p>把密文传给后端进行解密</p> 
<pre><code class="prism language-java">	<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
	
	<span class="token comment">//服务端私钥</span>
  	<span class="token class-name">String</span> privateKey <span class="token operator">=</span> <span class="token string">"服务端私钥"</span><span class="token punctuation">;</span>
  	
  	<span class="token comment">//后端解密时,公钥可以不填</span>
    <span class="token class-name">String</span> publicKey <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    
    <span class="token comment">//手动加上前缀04</span>
	<span class="token class-name">String</span> encryStr <span class="token operator">=</span> <span class="token string">"04"</span> <span class="token operator">+</span> <span class="token string">"aaaba1cea1af9a9c621d75bacc7434e1eea713861885a28ab8b3a5ebc911bf971c76af94acff2ab0647b8e157e9ccb6f78e85d5173120fbb11f9be610c0194c3c7d97b069478c4f07d06982b4c691d530bb817f490f531b271ee8d52bb9babbe8305ff92782f4fe263a6ea63d010c4bb682241aff20b5c11442a"</span><span class="token punctuation">;</span>
	<span class="token class-name">SM2</span> sm2 <span class="token operator">=</span> <span class="token class-name">SmUtil</span><span class="token punctuation">.</span><span class="token function">sm2</span><span class="token punctuation">(</span><span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">decodeHex</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"密文: {}"</span><span class="token punctuation">,</span> encryStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypt <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>encryStr<span class="token punctuation">,</span> <span class="token class-name">KeyType<span class="token punctuation">.</span>PrivateKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"解密结果: {}"</span><span class="token punctuation">,</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">utf8Str</span><span class="token punctuation">(</span>decrypt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">密文<span class="token operator">:</span> <span class="token number">04</span>aaaba1cea1af9a9c621d75bacc7434e1eea713861885a28ab8b3a5ebc911bf971c76af94acff2ab0647b8e157e9ccb6f78e85d5173120fbb11f9be610c0194c3c7d97b069478c4f07d06982b4c691d530bb817f490f531b271ee8d52bb9babbe8305ff92782f4fe263a6ea63d010c4bb682241aff20b5c11442a
解密结果<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"age"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token operator">:</span><span class="token string">"张三"</span><span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_125"></a>2.后端加密+前端解密</h4> 
<pre><code class="prism language-java">	<span class="token comment">//后端加密时,可以不填私钥。 客户端公钥</span>
	<span class="token class-name">SM2</span> sm2 <span class="token operator">=</span> <span class="token class-name">SmUtil</span><span class="token punctuation">.</span><span class="token function">sm2</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">decodeHex</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypt <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token class-name">KeyType<span class="token punctuation">.</span>PublicKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> encryStr <span class="token operator">=</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">)</span><span class="token punctuation">;</span>
	log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"密文: {}"</span><span class="token punctuation">,</span> encryStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">	密文<span class="token operator">:</span> <span class="token number">046415900</span>ab4af09490d257cdd5aee2d0710b1e222d4386124d6e70f4e39468d2e68d7eb9830db46804b472747e42819bdd56312982da1f765a963cd4c7c51795bd8c3faa220547033740dcb2f91b17039a05c9c6081bbf9c756b90f9a09cfa8cb39e0853766394661b265c60b
</code></pre> 
<p><strong><font color="red">注意：后端密文前缀存在04，前端在解密时会在首部自动补充 04，所以我们需截取后再传入。</font></strong></p> 
<pre><code class="prism language-javascript">  <span class="token keyword">const</span> sm2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sm-crypto'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sm2

  <span class="token comment">// 1 - C1C3C2，0 - C1C2C3，默认为1</span>
  <span class="token keyword">const</span> cipherMode <span class="token operator">=</span> <span class="token number">1</span> 
  
	<span class="token comment">//客户端私钥 D</span>
  <span class="token keyword">let</span> privateKeyD<span class="token operator">=</span><span class="token string">"客户端私钥 D"</span>
  
  <span class="token comment">//去掉04前缀后的密文</span>
  <span class="token keyword">let</span> encryStr <span class="token operator">=</span><span class="token string">"6415900ab4af09490d257cdd5aee2d0710b1e222d4386124d6e70f4e39468d2e68d7eb9830db46804b472747e42819bdd56312982da1f765a963cd4c7c51795bd8c3faa220547033740dcb2f91b17039a05c9c6081bbf9c756b90f9a09cfa8cb39e0853766394661b265c60b"</span>

  <span class="token keyword">const</span> str <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">doDecrypt</span><span class="token punctuation">(</span>encryStr <span class="token punctuation">,</span> privateKeyD<span class="token punctuation">,</span> cipherMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"解密报文:"</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
</code></pre> 
<pre><code class="prism language-javascript"><span class="token literal-property property">解密报文</span><span class="token operator">:</span> Hello World
</code></pre> 
<h3><a id="_163"></a>签名及验签</h3> 
<h4><a id="1_165"></a>1.后端加签+前端验签</h4> 
<pre><code class="prism language-java">  <span class="token comment">// 服务端私钥 ,签名时可以不填公钥</span>
  <span class="token class-name">SM2</span> sm2 <span class="token operator">=</span> <span class="token class-name">SmUtil</span><span class="token punctuation">.</span><span class="token function">sm2</span><span class="token punctuation">(</span><span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">decodeHex</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">//要签名的明文数据</span>
  <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>

  <span class="token comment">//把明文字符串转为十六进制字符串</span>
  <span class="token class-name">String</span> sign <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">signHex</span><span class="token punctuation">(</span><span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"签名:{}"</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">签名<span class="token operator">:</span><span class="token number">304502207</span>b8a07c36a97c34278bf4352af13f4a1022f79816820c52a1a23d7499e24a609022100dcf53edf3f2d7f648fea027cacce90f6d101923b1215b2cb9aa6811064ed6cdd
</code></pre> 
<p>前端接受密文和签名</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * msg  明文数据即解密后数据
 * sigValueHex 后端传过来的签名(不需要进行任何处理)
 * publicKeyQ 服务端公钥 Q
 * 最后的json对象必传,否则验签失败
 */</span>
sm2<span class="token punctuation">.</span><span class="token function">doVerifySignature</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> sigValueHex<span class="token punctuation">,</span> publicKeyQ <span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">der</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 验签结果</span>

<span class="token keyword">const</span> sm2 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sm-crypto'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sm2
<span class="token keyword">let</span> signResult <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">doVerifySignature</span><span class="token punctuation">(</span>
      <span class="token string">"Hello World"</span><span class="token punctuation">,</span> <span class="token string">"304502207b8a07c36a97c34278bf4352af13f4a1022f79816820c52a1a23d7499e24a609022100dcf53edf3f2d7f648fea027cacce90f6d101923b1215b2cb9aa6811064ed6cdd"</span><span class="token punctuation">,</span>
      publicKeyQ<span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">der</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"验签结果:"</span><span class="token punctuation">,</span> signResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token literal-property property">验签结果</span><span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre> 
<h4><a id="2_206"></a>2.前端加签+后端验签</h4> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * msg  明文数据
 * privateKeyD 客户端私钥 D
 * 最后的json对象必传,否则验签失败
 */</span>
sm2<span class="token punctuation">.</span><span class="token function">doSignature</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> privateKeyD<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">der</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 签名</span>

<span class="token keyword">let</span> sign <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">doSignature</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">,</span>privateKeyD<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">der</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token literal-property property">hash</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"签名:"</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token literal-property property">签名</span><span class="token operator">:</span>30450220740a651a3f44b7647c884540b19571131da65c88e2750fd8c780d1062af16f9b022100f320694a65f1e85b0320789b9bf9b78c4cfc94f6bc6562e61072389f944ca3de
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// 客户端公钥 ,验签时可以不填私钥</span>
<span class="token class-name">SM2</span> sm2 <span class="token operator">=</span> <span class="token class-name">SmUtil</span><span class="token punctuation">.</span><span class="token function">sm2</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">decodeHex</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//解密后的报文</span>
<span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>

<span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token string">"30450220740a651a3f44b7647c884540b19571131da65c88e2750fd8c780d1062af16f9b022100f320694a65f1e85b0320789b9bf9b78c4cfc94f6bc6562e61072389f944ca3de"</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> signResult <span class="token operator">=</span> sm2<span class="token punctuation">.</span><span class="token function">verifyHex</span><span class="token punctuation">(</span><span class="token class-name">HexUtil</span><span class="token punctuation">.</span><span class="token function">encodeHexStr</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"验签结果:{}"</span><span class="token punctuation">,</span>signResult<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<pre><code class="prism language-java">验签结果<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/40609b3bdb0279fd8d166082f7ea5760/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【MySQL】在 Centos7 环境安装 MySQL -- 详细完整教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4b9e13deba186060e6dbe668ba319334/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端使用pdf.js进行pdf文件预览的第二种方式：Viewer.html</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>