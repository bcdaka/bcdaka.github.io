<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker创建 Maxwell容器 并连通Kafka - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9a432a8cb6b12d1655b7ae1a7dc849f6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="docker创建 Maxwell容器 并连通Kafka">
  <meta property="og:description" content="文章目录 概要拉取maxwell镜像添加容器卷修改配置文件启动maxwell容器检查连接情况 概要 学到使用maxwell模拟mysql主从复制的slave机，获取master机的bin-log日志后在执行一遍，一开始使用maxwell包想在docker里的linux容器直接解压安装使用，结果发现和kafka版本不匹配（个人觉得是这个问题）换了jdk版本和maxwell版本，高的低的版本都换了还是不能传到kafka，但是切换到producer=stdout 即打印在控制台是可以的，说明就是不能匹配上kafka，而且报错还很迷：
ERROR MaxwellKafkaProducer - UnknownServerException @ Position[BinlogPosition[mysql-bin.000002:749271], lastHeartbeat=0]
干脆想着使用独立的容器单独起一个maxwell算了，开始尝试单独起maxwell然后联通mysql和Kafka。
拉取maxwell镜像 docker search maxwell
找到zendesk/maxwell 然后pull
添加容器卷修改配置文件 要使用maxwell连接mysql和kafka集群 需要在配置文件里面添加mysql服务器ip/端口号/用户名/密码
要连接Kafka集群也需要指定Kafka集群的host：port
其中连接mysql还需要单独为maxwell进程创建一个远程访问用户，高版本mysql不支持一键创建远程用户了：可以参考这篇文章：MySQL ERROR 1064 (42000）——不管怎样grant总是报错，怎么回事？
daemon=true # 第一次启动时建议改为debug，可以开到mysql数据与kafka请求，稳定后再改为info log_level=info producer=kafka kafka.bootstrap.servers=IP1:9092,IP2:9092,IP3:9092 # 会往 kafka下主题为&#39;test&#39;的分区下推送数据 kafka_topic=topic_db #当producer_partition_by设置为table时，Maxwell会将生成的消息根据表名称进行分区，不同的表将会被分配到不同的分区中，默认为database producer_partition_by=primary_key client_id=maxwell_1 # mysql login info 需要先在mysql创建maxwell用户 host=IP port=3306 user=maxwell password=Admin123@qwe schema_database=maxwell 启动maxwell容器 docker run --name maxwell --net spark-cluster-1 \ -v ./:/etc/maxwell/ \ zendesk/maxwell bin/maxwell --config /etc/maxwell/config.properties 指定容器名 网络 挂载数据卷
镜像名 启动容器的时候终端需要执行的命令（即启动maxwell进程）">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-28T22:18:30+08:00">
    <meta property="article:modified_time" content="2024-05-28T22:18:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker创建 Maxwell容器 并连通Kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">概要</a></li><li><a href="#maxwell_6" rel="nofollow">拉取maxwell镜像</a></li><li><a href="#_10" rel="nofollow">添加容器卷修改配置文件</a></li><li><a href="#maxwell_36" rel="nofollow">启动maxwell容器</a></li><li><a href="#_48" rel="nofollow">检查连接情况</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>概要</h3> 
<p>学到使用maxwell模拟mysql主从复制的slave机，获取master机的bin-log日志后在执行一遍，一开始使用maxwell包想在docker里的linux容器直接解压安装使用，结果发现和kafka版本不匹配（个人觉得是这个问题）换了jdk版本和maxwell版本，高的低的版本都换了还是不能传到kafka，但是切换到producer=stdout 即打印在控制台是可以的，说明就是不能匹配上kafka，而且报错还很迷：<br> ERROR MaxwellKafkaProducer - UnknownServerException @ Position[BinlogPosition[mysql-bin.000002:749271], lastHeartbeat=0]<br> <img src="https://images2.imgbox.com/44/3e/rxcxJvXr_o.png" alt="在这里插入图片描述"><br> 干脆想着使用独立的容器单独起一个maxwell算了，开始尝试单独起maxwell然后联通mysql和Kafka。</p> 
<h3><a id="maxwell_6"></a>拉取maxwell镜像</h3> 
<p><img src="https://images2.imgbox.com/10/f9/DZwqJVEl_o.png" alt="在这里插入图片描述"><br> docker search maxwell<br> 找到zendesk/maxwell 然后pull</p> 
<h3><a id="_10"></a>添加容器卷修改配置文件</h3> 
<p>要使用maxwell连接mysql和kafka集群 需要在配置文件里面添加mysql服务器ip/端口号/用户名/密码<br> 要连接Kafka集群也需要指定Kafka集群的host：port<br> 其中连接mysql还需要单独为maxwell进程创建一个远程访问用户，高版本mysql不支持一键创建远程用户了：可以参考这篇文章：<a href="https://blog.csdn.net/maibaizhou/article/details/120670086">MySQL ERROR 1064 (42000）——不管怎样grant总是报错，怎么回事？</a></p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">daemon</span><span class="token operator">=</span>true
<span class="token comment"># 第一次启动时建议改为debug，可以开到mysql数据与kafka请求，稳定后再改为info</span>
<span class="token assign-left variable">log_level</span><span class="token operator">=</span>info

<span class="token assign-left variable">producer</span><span class="token operator">=</span>kafka
<span class="token assign-left variable">kafka.bootstrap.servers</span><span class="token operator">=</span>IP1:9092,IP2:9092,IP3:9092
<span class="token comment"># 会往 kafka下主题为'test'的分区下推送数据</span>
<span class="token assign-left variable">kafka_topic</span><span class="token operator">=</span>topic_db
<span class="token comment">#当producer_partition_by设置为table时，Maxwell会将生成的消息根据表名称进行分区，不同的表将会被分配到不同的分区中，默认为database</span>
<span class="token assign-left variable">producer_partition_by</span><span class="token operator">=</span>primary_key
<span class="token assign-left variable">client_id</span><span class="token operator">=</span>maxwell_1

<span class="token comment"># mysql login info 需要先在mysql创建maxwell用户</span>
<span class="token assign-left variable">host</span><span class="token operator">=</span>IP
<span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">3306</span>
<span class="token assign-left variable">user</span><span class="token operator">=</span>maxwell
<span class="token assign-left variable">password</span><span class="token operator">=</span>Admin123@qwe
<span class="token assign-left variable">schema_database</span><span class="token operator">=</span>maxwell

</code></pre> 
<h3><a id="maxwell_36"></a>启动maxwell容器</h3> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> maxwell <span class="token parameter variable">--net</span> spark-cluster-1 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ./:/etc/maxwell/ <span class="token punctuation">\</span> 
zendesk/maxwell bin/maxwell <span class="token parameter variable">--config</span> /etc/maxwell/config.properties
</code></pre> 
<p>指定容器名 网络 挂载数据卷<br> 镜像名 启动容器的时候终端需要执行的命令（即启动maxwell进程）<br> <img src="https://images2.imgbox.com/49/09/zlaatSDs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f9/54/blAx2q05_o.png" alt="在这里插入图片描述"><br> 启动后info里没有warn/error等报错警告信息说明成功！</p> 
<h3><a id="_48"></a>检查连接情况</h3> 
<p><img src="https://images2.imgbox.com/2b/8d/hmfgOPC1_o.png" alt="在这里插入图片描述"><br> 创建的maxwell库里生成了maxwell元数据表说明连接mysql成功！<br> <img src="https://images2.imgbox.com/10/f3/TUHvkI0W_o.png" alt="在这里插入图片描述"><br> Kafka集群里生成了topic_db主题目前说明maxwell与kafka连通 但是还没有传输数据，接下来修改mysql指定监控database里的tables，来看看maxwell是否能够将bin-log日志成功传给kafka。PS：之前在linux环境容器里就是这一步出错，maxwell可以收到bin-log日志 但是无法传给kafka。<br> 修改tables：<br> <img src="https://images2.imgbox.com/27/65/Bvzq1Dfe_o.png" alt="在这里插入图片描述"><br> 发现kafka这次成功得到数据（bin-log日志就是json格式），成功！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/376c3429f774a1827bc18df28a0e3f04/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构的希尔排序（c语言版）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ed78f16f36209723211310eb409d808/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ChatGPT Mac客户端 下载安装教程（免费 不限次数使用 还支持语音聊天）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>