<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ipsec VPN设备在边界情况 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3e800c2e209f39b0e535a5a407624417/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ipsec VPN设备在边界情况">
  <meta property="og:description" content="目录
ipsec VPN设备在边界情况
基础配置
AR1
AR2
AR3
PC
边界路由器通测试
IPSEC VPN配置
1.抓流量
AR1
AR3
2.配置IKE的安全提议（五元组）
AR1
AR3
3.配置IKE对等体
AR1
AR2
4.配置IPSEC安全提议
AR1
AR3
5.配置IPSEC的安全策略
AR1
AR3
6.接口调用
测试
ipsec VPN设备在边界情况 AR1和AR3充当两私网的边界设备，AR2充当ISP，要求PC1和PC2通过IPSEC互通
基础配置 AR1 int g 0/0/0 ip add 12.0.0.2 24 int g 0/0/1 ip add 192.168.0.1 24 ip route-static 0.0.0.0 0 12.0.0.1 AR2 int g 0/0/0 ip add 12.0.0.1 24 int g 0/0/1 ip add 21.0.0.1 24 AR3 int g 0/0/0 ip add 23.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T23:54:06+08:00">
    <meta property="article:modified_time" content="2024-07-23T23:54:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ipsec VPN设备在边界情况</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="ipsec%20VPN%E8%AE%BE%E5%A4%87%E5%9C%A8%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5-toc" style="margin-left:0px;"><a href="#ipsec%20VPN%E8%AE%BE%E5%A4%87%E5%9C%A8%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5" rel="nofollow">ipsec VPN设备在边界情况</a></p> 
<p id="%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE" rel="nofollow">基础配置</a></p> 
<p id="AR1-toc" style="margin-left:80px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR2-toc" style="margin-left:80px;"><a href="#AR2" rel="nofollow">AR2</a></p> 
<p id="AR3-toc" style="margin-left:80px;"><a href="#AR3" rel="nofollow">AR3</a></p> 
<p id="PC-toc" style="margin-left:80px;"><a href="#PC" rel="nofollow">PC</a></p> 
<p id="%E8%BE%B9%E7%95%8C%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%9A%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#%E8%BE%B9%E7%95%8C%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%9A%E6%B5%8B%E8%AF%95" rel="nofollow">边界路由器通测试</a></p> 
<p id="IPSEC%20VPN%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#IPSEC%20VPN%E9%85%8D%E7%BD%AE" rel="nofollow">IPSEC VPN配置</a></p> 
<p id="1.%E6%8A%93%E6%B5%81%E9%87%8F-toc" style="margin-left:80px;"><a href="#1.%E6%8A%93%E6%B5%81%E9%87%8F" rel="nofollow">1.抓流量</a></p> 
<p id="AR1-toc" style="margin-left:120px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR3-toc" style="margin-left:120px;"><a href="#AR3" rel="nofollow">AR3</a></p> 
<p id="2.%E9%85%8D%E7%BD%AEIKE%E7%9A%84%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE%EF%BC%88%E4%BA%94%E5%85%83%E7%BB%84%EF%BC%89-toc" style="margin-left:80px;"><a href="#2.%E9%85%8D%E7%BD%AEIKE%E7%9A%84%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE%EF%BC%88%E4%BA%94%E5%85%83%E7%BB%84%EF%BC%89" rel="nofollow">2.配置IKE的安全提议（五元组）</a></p> 
<p id="AR1-toc" style="margin-left:120px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR3-toc" style="margin-left:120px;"><a href="#AR3" rel="nofollow">AR3</a></p> 
<p id="3.%E9%85%8D%E7%BD%AEIKE%E5%AF%B9%E7%AD%89%E4%BD%93-toc" style="margin-left:80px;"><a href="#3.%E9%85%8D%E7%BD%AEIKE%E5%AF%B9%E7%AD%89%E4%BD%93" rel="nofollow">3.配置IKE对等体</a></p> 
<p id="AR1-toc" style="margin-left:120px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR2-toc" style="margin-left:120px;"><a href="#AR2" rel="nofollow">AR2</a></p> 
<p id="4.%E9%85%8D%E7%BD%AEIPSEC%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE-toc" style="margin-left:80px;"><a href="#4.%E9%85%8D%E7%BD%AEIPSEC%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE" rel="nofollow">4.配置IPSEC安全提议</a></p> 
<p id="AR1-toc" style="margin-left:120px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR3-toc" style="margin-left:120px;"><a href="#AR3" rel="nofollow">AR3</a></p> 
<p id="5.%E9%85%8D%E7%BD%AEIPSEC%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5-toc" style="margin-left:80px;"><a href="#5.%E9%85%8D%E7%BD%AEIPSEC%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5" rel="nofollow">5.配置IPSEC的安全策略</a></p> 
<p id="AR1-toc" style="margin-left:120px;"><a href="#AR1" rel="nofollow">AR1</a></p> 
<p id="AR3-toc" style="margin-left:120px;"><a href="#AR3" rel="nofollow">AR3</a></p> 
<p id="6.%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8-toc" style="margin-left:80px;"><a href="#6.%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8" rel="nofollow">6.接口调用</a></p> 
<p id="%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%E6%B5%8B%E8%AF%95" rel="nofollow">测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="ipsec%20VPN%E8%AE%BE%E5%A4%87%E5%9C%A8%E8%BE%B9%E7%95%8C%E6%83%85%E5%86%B5">ipsec VPN设备在边界情况</h2> 
<p>AR1和AR3充当两私网的边界设备，AR2充当ISP，要求PC1和PC2通过IPSEC互通</p> 
<p><img alt="" height="342" src="https://images2.imgbox.com/a5/4a/Voglw0F9_o.png" width="1046"></p> 
<h3 id="%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">基础配置</h3> 
<h4 id="AR1">AR1</h4> 
<pre>int g 0/0/0
    ip add 12.0.0.2 24
int g 0/0/1
    ip add 192.168.0.1 24
ip route-static 0.0.0.0 0 12.0.0.1</pre> 
<h4 id="AR2">AR2</h4> 
<pre>int g 0/0/0
    ip add 12.0.0.1 24
int g 0/0/1
    ip add 21.0.0.1 24</pre> 
<h4 id="AR3">AR3</h4> 
<pre>int g 0/0/0
    ip add 23.0.0.2 24
int g 0/0/1
    ip add 192.168.1.1 24
ip route-static 0.0.0.0 0 23.0.0.1</pre> 
<h4 id="PC">PC</h4> 
<p><img alt="" height="675" src="https://images2.imgbox.com/44/2f/AgmLk040_o.png" width="983"></p> 
<p><img alt="" height="658" src="https://images2.imgbox.com/74/78/6PxmmKgF_o.png" width="963"></p> 
<h4 id="%E8%BE%B9%E7%95%8C%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%9A%E6%B5%8B%E8%AF%95">边界路由器通测试</h4> 
<p><img alt="" height="307" src="https://images2.imgbox.com/e5/9e/UwtdWRIE_o.png" width="799"></p> 
<h3 id="IPSEC%20VPN%E9%85%8D%E7%BD%AE">IPSEC VPN配置</h3> 
<h4 id="1.%E6%8A%93%E6%B5%81%E9%87%8F">1.抓流量</h4> 
<h5>AR1</h5> 
<pre>acl 3000
rule permit ip source 192.168.0.0 0.0.0.255 destination 192.168.1.0 0.0.0.255</pre> 
<h5>AR3</h5> 
<pre>acl 3000rule permit ip source 192.168.1.0 0.0.0.255 destination 192.168.0.0 0.0.0.255</pre> 
<h4 id="2.%E9%85%8D%E7%BD%AEIKE%E7%9A%84%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE%EF%BC%88%E4%BA%94%E5%85%83%E7%BB%84%EF%BC%89">2.配置IKE的安全提议（五元组）</h4> 
<h5>AR1</h5> 
<pre>ike proposal 1                              //配置ike安全提议编号为1
    encryption-algorithm aes-cbc-128          //设置对称加密方式为：aes-cbc-128   
    authentication-method pre-share           //配置身份认证方式为预共享密钥（PSK）
    authentication-algorithm md5              //配置HASH算法为md5
    dh group5                               //配置DH算法质数组为5位
    sa duration 86400                       //失效时间</pre> 
<h5>AR3</h5> 
<ul><li> <p>要求两边协商参数一样</p> </li></ul> 
<pre>ike proposal 1                              //配置ike安全提议编号为1
    encryption-algorithm aes-cbc-128          //设置对称加密方式为：aes-cbc-128   
    authentication-method pre-share           //配置身份认证方式为预共享密钥（PSK）
    authentication-algorithm md5              //配置HASH算法为md5
    dh group5                               //配置DH算法质数组为5位
    sa duration 86400                       //失效时间</pre> 
<h4 id="3.%E9%85%8D%E7%BD%AEIKE%E5%AF%B9%E7%AD%89%E4%BD%93">3.配置IKE对等体</h4> 
<h5>AR1</h5> 
<pre>ike peer aa v1                              //建立对等体 名称 aa 版本1
    ike-proposal 1                          //关联安全提议
    pre-shared-key cipher 123456             //与共享密钥123456 
    exchange-mode main                      //第一阶段模式为主模式
    remote-address 23.0.0.2                 //建立对等体的目标</pre> 
<h5>AR2</h5> 
<pre>ike peer aa v1                              //建立对等体 名称 aa 版本1
    ike-proposal 1                          //关联安全提议
    pre-shared-key cipher 123456             //与共享密钥123456 
    exchange-mode main                      //第一阶段模式为主模式
    remote-address 12.0.0.2                 //建立对等体的目标</pre> 
<h4 id="4.%E9%85%8D%E7%BD%AEIPSEC%E5%AE%89%E5%85%A8%E6%8F%90%E8%AE%AE">4.配置IPSEC安全提议</h4> 
<h5>AR1</h5> 
<pre>ipsec proposal aa                           //ipsec 提议配置 名 aa
    transform esp                           //安全协议为esp
    encapsulation-mode tunnel                //要跨越公网封装模式为隧道
    esp encryption-algorithm aes-128          //加密方式aes-128
    esp authentication-algorithm md5          //HASH算法md5</pre> 
<h5>AR3</h5> 
<pre>ipsec proposal aa                           //ipsec 提议配置 名 aa
    transform esp                           //安全协议为esp
    encapsulation-mode tunnel                //要跨越公网封装模式为隧道
    esp encryption-algorithm aes-128          //加密方式aes-128
    esp authentication-algorithm md5          //HASH算法md5</pre> 
<h4 id="5.%E9%85%8D%E7%BD%AEIPSEC%E7%9A%84%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5">5.配置IPSEC的安全策略</h4> 
<h5>AR1</h5> 
<pre>ipsec policy aa 1 isakmp    //ipsec策略 名字 aa 编号 1 模式isakmp
    security acl 3000       //关联流量 acl 3000
    ike-peer aa             // 关联对等体 aa
    proposal aa             // 关联ipsec提议 aa</pre> 
<h5>AR3</h5> 
<pre>ipsec policy aa 1 isakmp    //ipsec策略 名字 aa 编号 1 模式isakmp
    security acl 3000       //关联流量 acl 3000
    ike-peer aa             // 关联对等体 aa
    proposal aa             // 关联ipsec提议 aa</pre> 
<h4 id="6.%E6%8E%A5%E5%8F%A3%E8%B0%83%E7%94%A8">6.接口调用</h4> 
<pre>int g 0/0/0
    ipsec policy aa</pre> 
<h3 id="%E6%B5%8B%E8%AF%95">测试</h3> 
<p><img alt="" height="172" src="https://images2.imgbox.com/55/db/DEMh2wIH_o.png" width="1119"></p> 
<p><img alt="" height="358" src="https://images2.imgbox.com/39/74/vluMJg5f_o.png" width="1072"><img alt="" height="329" src="https://images2.imgbox.com/aa/11/YsUVq9Ip_o.png" width="698"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1fb0dd0c8f718b21e3a3b2d42ee866a4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图——图的遍历（DFS与BFS算法详解）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1a423054128c2874fd3e9119798c3d8e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python中常用运算符的基本用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>