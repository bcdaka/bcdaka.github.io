<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>webgis入门实战案例——智慧校园 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7f5b055d81fea4fc3d87f84f95d45cc4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="webgis入门实战案例——智慧校园">
  <meta property="og:description" content="本文通过利用高德地图的JS API做一个关于智慧校园的小案例，主要内容有地图展示、地图控件的添加、标注点添加、地点打卡、驾车路径规划动画展示，文章末尾附有完整代码。后续将继续跟进其他学习案例。
目录 前置工作地图展示地图控件的添加实现点击某个地方进行标注、打卡实现简单的驾车路径规划动画上面案例的完整代码 前置工作 HTML页面的准备：创建一个id为container的地图容器
&lt;div id=&#34;container&#34;&gt;&lt;/div&gt;
对html、body、container设置宽高：
&lt;style&gt; html, body, #container{ width: 100%; height: 100%; } &lt;/style&gt; 引入高德地图相关的CSS资源
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css&#34; /&gt;
在高德开放平台上申请JS API的key和安全密钥，引入高德js相关的资源(将下面代码中的安全密钥和key替换即可)
&lt;script type=&#34;text/javascript&#34;&gt; window._AMapSecurityConfig = { securityJsCode: &#34;你的安全密钥&#34;, }; &lt;/script&gt; &lt;script src=&#34;https://webapi.amap.com/loader.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;https://webapi.amap.com/maps?v=2.0&amp;key=你的key&#34;&gt;&lt;/script&gt; &lt;script src=&#34;./js/store.js&#34;&gt;&lt;/script&gt; 地图展示 在js中创建地图对象(这样就会在界面上显示地图) var map=new AMap.Map(&#39;container&#39;,{ center:[118.91125,32.10296],//表示地图界面中心显示的位置 zoom:16,//表示地图级别 viewMode:&#39;3D&#39;,//表示地图显示模式为3D，默认是2D pitch:45,//初识地图俯仰角度 }) 其他AMap.Map属性和方法参照：
AMap.Map属性和方法
地图控件的添加 // 异步加载工具条插件，在回调函数中实例化插件，并使用插件功能 AMap.plugin([&#39;AMap.ToolBar&#39;,&#39;AMap.Scale&#39;,&#39;AMap.ControlBar&#39;,&#39;AMap.GeoJSON&#39;,&#39;AMap.MoveAnimation&#39;],function(){ // 添加缩放控件插件到地图页面 map.addControl(new AMap.ToolBar({ position:{ top:&#39;80px&#39;, right:&#39;40px&#39;, }, })); // 添加比例尺 map.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-09T10:49:25+08:00">
    <meta property="article:modified_time" content="2024-05-09T10:49:25+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">webgis入门实战案例——智慧校园</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文通过利用高德地图的JS API做一个关于智慧校园的小案例，主要内容有地图展示、地图控件的添加、标注点添加、地点打卡、驾车路径规划动画展示，文章末尾附有完整代码。后续将继续跟进其他学习案例。<br> </p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">前置工作</a></li><li><a href="#_42" rel="nofollow">地图展示</a></li><li><a href="#_59" rel="nofollow">地图控件的添加</a></li><li><a href="#_82" rel="nofollow">实现点击某个地方进行标注、打卡</a></li><li><a href="#_198" rel="nofollow">实现简单的驾车路径规划动画</a></li><li><a href="#_276" rel="nofollow">上面案例的完整代码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>前置工作</h3> 
<ul><li> <p>HTML页面的准备：创建一个id为container的地图容器</p> <p><code>&lt;div id="container"&gt;&lt;/div&gt;</code></p> <p>对html、body、container设置宽高：</p> </li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">html,
    body,
    #container</span><span class="token punctuation">{<!-- --></span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li> <p>引入高德地图相关的CSS资源</p> <p><code>&lt;link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" /&gt;</code></p> </li><li> <p>在高德开放平台上申请JS API的key和安全密钥，引入高德js相关的资源(将下面代码中的安全密钥和key替换即可)</p> </li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
window<span class="token punctuation">.</span>_AMapSecurityConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">securityJsCode</span><span class="token operator">:</span> <span class="token string">"你的安全密钥"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://webapi.amap.com/loader.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://webapi.amap.com/maps?v=2.0&amp;key=你的key<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/store.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_42"></a>地图展示</h3> 
<ul><li>在js中创建地图对象(这样就会在界面上显示地图)</li></ul> 
<pre><code class="prism language-html">var map=new AMap.Map('container',{
    center:[118.91125,32.10296],//表示地图界面中心显示的位置
    zoom:16,//表示地图级别
    viewMode:'3D',//表示地图显示模式为3D，默认是2D
    pitch:45,//初识地图俯仰角度
})
</code></pre> 
<p>其他AMap.Map属性和方法参照：</p> 
<p><a href="https://lbs.amap.com/api/javascript-api-v2/tutorails/display-a-map" rel="nofollow">AMap.Map属性和方法</a></p> 
<h3><a id="_59"></a>地图控件的添加</h3> 
<pre><code class="prism language-html">// 异步加载工具条插件，在回调函数中实例化插件，并使用插件功能
AMap.plugin(['AMap.ToolBar','AMap.Scale','AMap.ControlBar','AMap.GeoJSON','AMap.MoveAnimation'],function(){
	// 添加缩放控件插件到地图页面
     map.addControl(new AMap.ToolBar({
         position:{
             top:'80px',
             right:'40px',
         },
     }));
	// 添加比例尺
     map.addControl(new AMap.Scale());
 	// 添加控制罗盘控件
    map.addControl(new AMap.ControlBar());
    })
</code></pre> 
<p>其他插件的使用参照：</p> 
<p><a href="https://lbs.amap.com/api/javascript-api-v2/guide/abc/plugins" rel="nofollow">插件列表</a></p> 
<h3><a id="_82"></a>实现点击某个地方进行标注、打卡</h3> 
<p>监听地图的点击事件，当点击时调用函数</p> 
<pre><code>```html
map.on('click',function(e){
	// 先创建标注对象
    var marker=new AMap.Marker({
        position:e.lnglat,// 获取点击事件的位置(经纬度)
        }
    })
    map.add(marker);// 将标注添加到地图
})
```
</code></pre> 
<ul><li> <p>进阶：实现点击事件打卡，保存数据，再次打开页面时，旧数据依然在，切可以继续打卡，并在页面上显示该地点打卡了几次。</p> <pre><code class="prism language-html">// 定义一个全局变量，保存geojson
var geojson = new AMap.GeoJSON({
    geoJSON:null,
})
</code></pre> 
  <ul><li>新数据打卡</li></ul> <pre><code class="prism language-html">map.on('click',function(e){
    var marker=new AMap.Marker({
        position:e.lnglat,
        extData:{
            // 自定义属性
            _geoJsonProperties:{
                gid:geojson.getOverlays().length+1,// 打卡地点数+1
                click:0,// 初始的点击数为0
            }
        }
    })

    // 对标注点进行点击时：实现对新旧点击事件标记打卡
    marker.on('click',function(e){
        var ext=marker.getExtData();// 先得到属性
        var click = ++ext._geoJsonProperties.click;// 将该标注地点的点击事件自增然后存到click变量中

        // 使用信息提示框显示打卡信息
        var infowindow=new AMap.InfoWindow({
            anchor:'top-center',// 提示框显示的位置
            content:`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>打卡了${click}次<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>`,
        })
        // 显示窗口信息:在地图上点击的标注位置上显示信息
        infowindow.open(map,marker.getPosition());
		// 将新数据重新保存；若没有保存，则下次加载进来的数据还是没有自增的click属性值
		// 将其转为geojson格式再保存
        saveData(geojson.toGeoJSON());
    })
    // 通过geojson来管理覆盖物
    geojson.addOverlay(marker);
    // 保存数据(将geojson对象转换成标准的GeoJSON格式对象)
    saveData(geojson.toGeoJSON())
    map.add(marker);
})
</code></pre> 
  <ul><li>旧数据打卡</li></ul> <pre><code class="prism language-html">// 读取和存储数据函数
// 从Localstorage中读取数据
function getData(){
    //如果本地local storage中不存在数据
    if(!localStorage.getItem('geojson')){
        //设置一个空的初始数据，即数据初始化
        localStorage.setItem('geojson','[]')
    }
    //反之，因为localStorage中存放的是字符串数据，所以将字符串数据转换成JSON对象返回
    return JSON.parse(localStorage.getItem('geojson'))
}

// 将数据保存到Localstorage中
function saveData(data){
    //需要将数据转换成字符串类型才能存入localStorage中
    localStorage.setItem('geojson',JSON.stringify(data))
}
</code></pre> <pre><code class="prism language-html">// 导入数据，当数据为空的时候，会报错，所以在数据不为空的时候才导入
// 因为getData()返回的是对象，所以需要先将其转为字符串，判断其是否为空字符串，即空数组
if(JSON.stringify(getData())!='[]'){
    geojson.importData(getData())// 将得到的对象导入geojson变量中
    // 恢复旧数据的点击事件：拿到geojson数据中的每一个点，对拿到的每一个标注点(覆盖物)设置点击监听
    geojson.eachOverlay(function(item){
		// 对每个标注点的点击事件进行监听
        item.on('click',function(e){
            var ext=item.getExtData();
            var click = ++ext._geoJsonProperties.click;

            var infowindow=new AMap.InfoWindow({
                anchor:'top-center',
                content:`<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>打卡了${click}次<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>`,
            })

            infowindow.open(map,item.getPosition());
            saveData(geojson.toGeoJSON());// 同样保存数据
            })
    })
}
// 将导入的数据添加到地图上面；这样，刷新浏览器的时候数据就不会消失(相当于加载地图的时候就将原来存储的数据加进来)
map.add(geojson); 
</code></pre> </li></ul> 
<h3><a id="_198"></a>实现简单的驾车路径规划动画</h3> 
<p>先设置起点和终点，然后建立一个对象存储途径点经纬度坐标，然后将始末点和途径点传入driving.search函数中，遍历结果result.routes[0].steps中的每一个步骤，设置小车标注，实现动画效果</p> 
<pre><code class="prism language-html">function starts(){
	//首先引用驾车规划插件
    AMap.plugin('AMap.Driving',function(){
		// 创建驾车规划对象
        var driving =new AMap.Driving({
            map:map,// 显示在地图上
            // policy:AMap.DrivingPolicy.LEAST_TIME,
            policy:2,// 按照距离最短规划
        })
        // 设置起点和终点
        var st=new AMap.LngLat(118.903607, 32.096752);
        var end=new AMap.LngLat(118.918165, 32.098677);

        // 通过geojson得到每一个点的坐标
        var obs={
            waypoints:[],
        }
		// 将geojson中每一个点数据的坐标添加到obs对象中
        geojson.eachOverlay(function(item){
            obs.waypoints.push(item.getPosition());
        })

        // 将点的对象传入
        driving.search(st,end,obs,function(status,result){
            if(status=='complete'){
                // 路径规划成功，则接下来实现动画效果
                // console.log(result);

                var lineArr=[];// 创建存放路径的变量
                result.routes[0].steps.forEach(function(item){
                    lineArr.push(...item.path);//遍历路线的每一个步骤，将其路径展开放入lineArr中
                })
                // console.log(lineArr);
                //首先设置小车标记的起始位置
                var marker=new AMap.Marker({
                    map:map,
                    position:st,
					// 导入小车图标
                    icon:'https://webapi.amap.com/images/car.png',
                    // 为了不让小车压到路面，为其设置偏移量
                    offset:new AMap.Pixel(-26,-13),
                    // 小车在转弯的时候自动转头
                    autoRotation:true,
					// 小车初始的摆放角度
                    angle:-180,
                })
                // 构造折线变量
                var passedPolyline=new AMap.Polyline({
                    map:map,
                    strokeColor:'#AF5',
                    strokeWeight:6,
                })
                // 监听小车移动事件，根据移动事件为折线变量设置路径
                marker.on('moving',function(e){
                    passedPolyline.setPath(e.passedPath);
                })
                map.setFitView();// 让地图自适应
                marker.moveAlong(lineArr,{
                    duration:500,//更新频率
                    autoRotation:true,
                })
            }
            else{
                console.log('error');
            }
        })
    })
}
</code></pre> 
<h3><a id="_276"></a>上面案例的完整代码</h3> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>智慧校园<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 引入高德地图相关的CSS资源 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">html,
        body,
        #container</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 引入高德js相关的资源 --&gt;</span>
    <span class="token comment">&lt;!-- 密钥和key --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        window<span class="token punctuation">.</span>_AMapSecurityConfig <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">securityJsCode</span><span class="token operator">:</span> <span class="token string">"9497fb6552130d5d26e90c0c1082ca2a"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://webapi.amap.com/loader.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://webapi.amap.com/maps?v=2.0&amp;key=85aaa8a9d92f5a244271e3bc7494072f<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./js/store.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    //创建地图容器
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 高德地图css中自带有info样式 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击地图，可标注地点；点击地点，可以打卡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 高德css模板 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-card<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 17rem</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>推荐浏览路线<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>input-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">starts</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>开始动画<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">//创建地图对象</span>
    <span class="token keyword">var</span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">center</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">118.91125</span><span class="token punctuation">,</span><span class="token number">32.10296</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">zoom</span><span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">,</span>
        <span class="token literal-property property">viewMode</span><span class="token operator">:</span><span class="token string">'3D'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pitch</span><span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">//使用地图控件</span>
    AMap<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'AMap.ToolBar'</span><span class="token punctuation">,</span><span class="token string">'AMap.Scale'</span><span class="token punctuation">,</span><span class="token string">'AMap.ControlBar'</span><span class="token punctuation">,</span><span class="token string">'AMap.GeoJSON'</span><span class="token punctuation">,</span><span class="token string">'AMap.MoveAnimation'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        map<span class="token punctuation">.</span><span class="token function">addControl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>ToolBar</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">position</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">top</span><span class="token operator">:</span><span class="token string">'80px'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">right</span><span class="token operator">:</span><span class="token string">'40px'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">addControl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Scale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">addControl</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>ControlBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义一个全局变量，保存geojson</span>
    <span class="token keyword">var</span> geojson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>GeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">geoJSON</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 导入数据，当数据为空的时候，会报错，所以在数据不为空的时候才导入</span>
    <span class="token comment">// 因为getData()返回的是对象，所以需要先将其转为字符串，判断其是否为空字符串，即空数组</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string">'[]'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        geojson<span class="token punctuation">.</span><span class="token function">importData</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 将得到的对象导入geojson文件中</span>
        <span class="token comment">// 恢复旧数据的点击事件：拿到geojson数据中的每一个点，对拿到的每一个点(覆盖物)设置点击监听(随着点击事件的发生，调用后面的函数)</span>
        geojson<span class="token punctuation">.</span><span class="token function">eachOverlay</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            item<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> ext<span class="token operator">=</span>item<span class="token punctuation">.</span><span class="token function">getExtData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> click <span class="token operator">=</span> <span class="token operator">++</span>ext<span class="token punctuation">.</span>_geoJsonProperties<span class="token punctuation">.</span>click<span class="token punctuation">;</span>

                <span class="token keyword">var</span> infowindow<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>InfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">anchor</span><span class="token operator">:</span><span class="token string">'top-center'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;打卡了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>click<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">次&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                
                infowindow<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span>item<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">saveData</span><span class="token punctuation">(</span>geojson<span class="token punctuation">.</span><span class="token function">toGeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将导入的数据添加到地图上面；这样，刷新浏览器的时候数据就不会消失</span>
    map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>geojson<span class="token punctuation">)</span><span class="token punctuation">;</span>   

    <span class="token comment">//实现点击某个地方的标注效果，即监听地图的点击事件，当点击时调用函数</span>
    map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> marker<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">position</span><span class="token operator">:</span>e<span class="token punctuation">.</span>lnglat<span class="token punctuation">,</span>
            <span class="token literal-property property">extData</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 自定义属性</span>
                <span class="token literal-property property">_geoJsonProperties</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">gid</span><span class="token operator">:</span>geojson<span class="token punctuation">.</span><span class="token function">getOverlays</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">click</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 使用覆盖物的点击事件：实现对新旧点击事件标记打卡</span>
        marker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> ext<span class="token operator">=</span>marker<span class="token punctuation">.</span><span class="token function">getExtData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 先得到属性</span>
            <span class="token keyword">var</span> click <span class="token operator">=</span> <span class="token operator">++</span>ext<span class="token punctuation">.</span>_geoJsonProperties<span class="token punctuation">.</span>click<span class="token punctuation">;</span>

            <span class="token comment">// 使用信息提示框显示打卡信息</span>
            <span class="token keyword">var</span> infowindow<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>InfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">anchor</span><span class="token operator">:</span><span class="token string">'top-center'</span><span class="token punctuation">,</span><span class="token comment">//提示框显示的位置</span>
                <span class="token literal-property property">content</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div&gt;打卡了</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>click<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">次&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">//显示窗口信息:在地图上的marker上显示信息</span>
            infowindow<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span>marker<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">saveData</span><span class="token punctuation">(</span>geojson<span class="token punctuation">.</span><span class="token function">toGeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将新数据重新保存；因为没有保存读取数据的时候还是原来的值</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 通过geojson来管理覆盖物</span>
        geojson<span class="token punctuation">.</span><span class="token function">addOverlay</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 保存数据(将geojson对象转换成标准的GeoJSON格式对象)</span>
        <span class="token function">saveData</span><span class="token punctuation">(</span>geojson<span class="token punctuation">.</span><span class="token function">toGeoJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">function</span> <span class="token function">starts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        AMap<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'AMap.Driving'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> driving <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Driving</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">map</span><span class="token operator">:</span>map<span class="token punctuation">,</span>
                <span class="token comment">// policy:AMap.DrivingPolicy.LEAST_TIME,</span>
                <span class="token literal-property property">policy</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 设置起点和终点</span>
            <span class="token keyword">var</span> st<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span><span class="token number">118.903607</span><span class="token punctuation">,</span> <span class="token number">32.096752</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> end<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>LngLat</span><span class="token punctuation">(</span><span class="token number">118.918165</span><span class="token punctuation">,</span> <span class="token number">32.098677</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 通过geojson得到每一个点的坐标</span>
            <span class="token keyword">var</span> obs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">waypoints</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            geojson<span class="token punctuation">.</span><span class="token function">eachOverlay</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                obs<span class="token punctuation">.</span>waypoints<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token comment">// 将点的对象传入</span>
            driving<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span>end<span class="token punctuation">,</span>obs<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">status<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token operator">==</span><span class="token string">'complete'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 路径规划成功，则接下来实现动画效果</span>
                    <span class="token comment">// console.log(result);</span>

                    <span class="token keyword">var</span> lineArr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    result<span class="token punctuation">.</span>routes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>steps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        lineArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>item<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//遍历路线的每一个步骤，将其路径展开放入lineArr中</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token comment">// console.log(lineArr);</span>
                    <span class="token comment">//首先设置小车标记的起始位置</span>
                    <span class="token keyword">var</span> marker<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">map</span><span class="token operator">:</span>map<span class="token punctuation">,</span>
                        <span class="token literal-property property">position</span><span class="token operator">:</span>st<span class="token punctuation">,</span>
                        <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'https://webapi.amap.com/images/car.png'</span><span class="token punctuation">,</span>
                        <span class="token comment">// 为了不让小车压到路面，为其设置偏移量</span>
                        <span class="token literal-property property">offset</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Pixel</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token comment">// 小车在转弯的时候转头</span>
                        <span class="token literal-property property">autoRotation</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">angle</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token comment">// 构造折线对象</span>
                    <span class="token keyword">var</span> passedPolyline<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">AMap<span class="token punctuation">.</span>Polyline</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">map</span><span class="token operator">:</span>map<span class="token punctuation">,</span>
                        <span class="token literal-property property">strokeColor</span><span class="token operator">:</span><span class="token string">'#AF5'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">strokeWeight</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token comment">// 监听小车移动事件，根据折线事件来建立移动轨迹</span>
                    marker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'moving'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        passedPolyline<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>passedPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    map<span class="token punctuation">.</span><span class="token function">setFitView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 让地图自适应</span>
                    marker<span class="token punctuation">.</span><span class="token function">moveAlong</span><span class="token punctuation">(</span>lineArr<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token comment">//更新频率</span>
                        <span class="token literal-property property">autoRotation</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>js代码</strong></p> 
<pre><code class="prism language-js"><span class="token comment">// 从Localstorage中读取数据</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果本地local storage中不存在数据</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'geojson'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//设置一个空的初始数据，即数据初始化</span>
        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'geojson'</span><span class="token punctuation">,</span><span class="token string">'[]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//反之，因为localStorage中存放的是字符串数据，所以将字符串数据转换成JSON对象返回</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'geojson'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将数据保存到Localstorage中</span>
<span class="token keyword">function</span> <span class="token function">saveData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//需要将数据转换成字符串类型才能存入localStorage中</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'geojson'</span><span class="token punctuation">,</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>本文参考的学习视频：<a href="https://www.bilibili.com/video/BV1Ui4y1U7c6/?p=45&amp;spm_id_from=333.1007.top_right_bar_window_history.content.click&amp;vd_source=84749e0276a9a18aa675892ad2c4903c" rel="nofollow">GIS | 零基础入门WebGIS开发，《智慧校园》项目实战</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c57488b41c1a56be1097b47bbbf905fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【python基础】python经典题目100题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/110dafbdf0a133c1a1d4c4847c95327a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA GUI 学生信息管理系统（Swing）（详细）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>