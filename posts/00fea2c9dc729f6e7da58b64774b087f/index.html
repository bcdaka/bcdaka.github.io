<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€Linuxã€‘è¿›ç¨‹é—´é€šä¿¡ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/00fea2c9dc729f6e7da58b64774b087f/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ã€Linuxã€‘è¿›ç¨‹é—´é€šä¿¡">
  <meta property="og:description" content="ğŸ‘€æ¨Šæ¢“æ…•ï¼šä¸ªäººä¸»é¡µ
ğŸ¥ä¸ªäººä¸“æ ï¼šã€ŠCè¯­è¨€ã€‹ã€Šæ•°æ®ç»“æ„ã€‹ã€Šè“æ¡¥æ¯è¯•é¢˜ã€‹ã€ŠLeetCodeåˆ·é¢˜ç¬”è®°ã€‹ã€Šå®è®­é¡¹ç›®ã€‹ã€ŠC&#43;&#43;ã€‹ã€ŠLinuxã€‹ã€Šç®—æ³•ã€‹
ğŸŒæ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿ
ç›®å½•
å‰è¨€
1.è¿›ç¨‹é—´é€šä¿¡
1.1è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„
1.2è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼
1.2.1ä¸€èˆ¬è§„å¾‹
1.2.2å…·ä½“åšæ³•
2.ç®¡é“
2.1å‘½ä»¤è¡Œä¸Šçš„ç®¡é“
2.2åŒ¿åç®¡é“Â 2.2.1åŒ¿åç®¡é“çš„åŸç†
2.2.2ç³»ç»Ÿè°ƒç”¨pipe()
2.2.3ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ®Šæƒ…å†µ
2.2.4ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ€§Â 2.2.5ç®¡é“çš„å¤§å°
2.2.6è¿›ç¨‹æ± 
æºç 
å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹å¯¼è‡´ç®¡é“æœ‰å¤šä¸ªå†™ç«¯çš„é—®é¢˜è§£å†³
2.3å‘½åç®¡é“
2.3.1ä½¿ç”¨å‘½ä»¤åˆ›å»ºå‘½åç®¡é“
2.3.2ä½¿ç”¨ç¨‹åºåˆ›å»ºå‘½åç®¡é“
2.3.3ç”¨å‘½åç®¡é“å®ç°server&amp;clienté€šä¿¡Â 3.system Vè¿›ç¨‹é—´é€šä¿¡
3.1system Vå…±äº«å†…å­˜
3.1.1åŸç†
3.1.2å…±äº«å†…å­˜çš„å»ºç«‹ä¸é‡Šæ”¾
3.1.3ç³»ç»Ÿè°ƒç”¨å‡½æ•°
åˆ›å»ºå…±äº«å†…å­˜â€”â€”shmgetå‡½æ•°
æŒ‚æ¥å…±äº«å†…å­˜â€”â€”shmatå‡½æ•°
æ‹†å¸å…±äº«å†…å­˜â€”â€”shmdtå‡½æ•°
é‡Šæ”¾å…±äº«å†…å­˜â€”â€”shmctlå‡½æ•°
3.1.4å‘½ä»¤è¡Œæ“ä½œå…±äº«å†…å­˜
æŸ¥çœ‹å…±äº«å†…å­˜ä¿¡æ¯â€”â€”ipcså‘½ä»¤
é‡Šæ”¾å…±äº«å†…å­˜â€”â€”ipcrm -m shmidå‘½ä»¤
3.1.5ç”¨å…±äº«å†…å­˜å®ç°server&amp;clienté€šä¿¡
æºç 
ç®¡é“æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶çš„è®²è§£
3.1.6system Vå…±äº«å†…å­˜é€šä¿¡æ–¹å¼ä¸ç®¡é“é€šä¿¡çš„å¯¹æ¯”
3.2system Væ¶ˆæ¯é˜Ÿåˆ—
3.3system Vä¿¡å·é‡
å‰è¨€ ç”±äºè¿›ç¨‹é—´å…·æœ‰ç‹¬ç«‹æ€§ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®è·å–ç”šè‡³ä¿®æ”¹å¯¹æ–¹çš„æ•°æ®çš„ï¼Œä½†æ˜¯åœ¨å®é™…éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›ç¨‹ä¹‹é—´è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥å¿…é¡»å¼€å‘æŸç§æ–¹å¼ä½¿è¿›ç¨‹é—´å¯ä»¥å»ºç«‹è”ç³»ã€‚
åœ¨æœ€å¼€å§‹ï¼Œè¿›ç¨‹é—´é€šä¿¡æœ€åŸå§‹çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ç®¡é“ï¼Œå½“ç„¶éšä¹‹ä¹Ÿæœ‰è¯¸å¤šä¸åŒçš„è¿›ç¨‹é—´é€šä¿¡çš„æ ‡å‡†ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸‹å§ï¼
æ¬¢è¿å¤§å®¶ğŸ“‚æ”¶è—ğŸ“‚ä»¥ä¾¿æœªæ¥åšé¢˜æ—¶å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ€è·¯ï¼Œå·§å¦™çš„æ–¹æ³•å¯ä»¥äº‹åŠåŠŸå€ã€‚Â =========================================================================
GITEEç›¸å…³ä»£ç ï¼šğŸŒŸæ¨Šé£ (fanfei_c) - Gitee.comğŸŒŸ
=========================================================================
1.è¿›ç¨‹é—´é€šä¿¡ 1.1è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ æ•°æ®ä¼ è¾“ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†å®ƒçš„æ•°æ®å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚èµ„æºå…±äº«ï¼šå¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«åŒæ ·çš„èµ„æºã€‚é€šçŸ¥äº‹ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å‘å¦ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥å®ƒï¼ˆå®ƒä»¬ï¼‰å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼ˆå¦‚è¿›ç¨‹ç»ˆæ­¢æ—¶è¦é€šçŸ¥çˆ¶è¿›ç¨‹ï¼‰ã€‚è¿›ç¨‹æ§åˆ¶ï¼šæœ‰äº›è¿›ç¨‹å¸Œæœ›å®Œå…¨æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼ˆå¦‚Debugè¿›ç¨‹ï¼‰ï¼Œæ­¤æ—¶æ§åˆ¶è¿›ç¨‹å¸Œæœ›èƒ½å¤Ÿæ‹¦æˆªå¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰é™·å…¥å’Œå¼‚å¸¸ï¼Œå¹¶èƒ½å¤ŸåŠæ—¶çŸ¥é“å®ƒçš„çŠ¶æ€æ”¹å˜ã€‚ æ€»ç»“ï¼šæˆ‘ä»¬å¾€å¾€éœ€è¦å¤šä¸ªè¿›ç¨‹ååŒå®Œæˆä¸€äº›äº‹æƒ…ã€‚
1.2è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼ 1.2.1ä¸€èˆ¬è§„å¾‹ è¿›ç¨‹é—´é€šä¿¡çš„æœ¬è´¨å°±æ˜¯è®©ä¸åŒçš„è¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºï¼Œæˆ‘ä»¬éœ€è¦ä¸€å—ç©ºé—´ä½œä¸ºäº¤æ¢æ•°æ®çš„ã€ ç©ºé—´ã€ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯è¿›ç¨‹é—´çš„ç‹¬ç«‹æ€§ï¼Œè¿™å—ã€ ç©ºé—´ã€ä¸èƒ½ç”±é€šä¿¡åŒæ–¹ä»»ä½•ä¸€ä¸ªæä¾›ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¥æä¾›ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹ä¸€èˆ¬å°±æ˜¯æ“ä½œç³»ç»Ÿã€‚">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-05T14:00:00+08:00">
    <meta property="article:modified_time" content="2024-05-05T14:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€Linuxã€‘è¿›ç¨‹é—´é€šä¿¡</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="%E2%80%8B%E7%BC%96%E8%BE%91" style="text-align:center;"><a id="AI_0"></a><img alt="" height="174" src="https://images2.imgbox.com/5c/9b/pgMlwkcc_o.png" width="395"></h3> 
<p style="text-align:center;"><strong>ğŸ‘€<span style="color:#98c091;">æ¨Šæ¢“æ…•ï¼š</span><strong><strong><strong><strong><strong><strong><strong><a href="https://blog.csdn.net/2301_77112634?type=blog" title="ä¸ªäººä¸»é¡µ">ä¸ªäººä¸»é¡µ</a></strong></strong></strong></strong></strong></strong></strong></strong></p> 
<p style="text-align:center;"><strong>Â ğŸ¥<span style="color:#956fe7;">ä¸ªäººä¸“æ ï¼š</span><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdn.cn/e7GFn" rel="nofollow" title="ã€ŠCè¯­è¨€ã€‹">ã€ŠCè¯­è¨€ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdn.cn/jUErT" rel="nofollow" title="ã€Šæ•°æ®ç»“æ„ã€‹">ã€Šæ•°æ®ç»“æ„ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdn.cn/q3iyZ" rel="nofollow" title="ã€Šè“æ¡¥æ¯è¯•é¢˜ã€‹">ã€Šè“æ¡¥æ¯è¯•é¢˜ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdn.cn/IUyeH" rel="nofollow" title="ã€ŠLeetCodeåˆ·é¢˜ç¬”è®°ã€‹">ã€ŠLeetCodeåˆ·é¢˜ç¬”è®°ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdn.cn/uK6me" rel="nofollow" title="ã€Šå®è®­é¡¹ç›®ã€‹">ã€Šå®è®­é¡¹ç›®ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdnimg.cn/uOlnu" rel="nofollow" title="ã€ŠC++ã€‹">ã€ŠC++ã€‹</a></strong></strong></strong></strong></strong></strong></strong><strong><strong><strong><strong><strong><strong><strong><a href="http://t.csdnimg.cn/cUhZr" rel="nofollow" title="ã€ŠLinuxã€‹">ã€ŠLinuxã€‹</a></strong></strong></strong></strong><strong><strong><strong><strong><a href="http://t.csdnimg.cn/S7d8A" rel="nofollow" title="ã€Šç®—æ³•ã€‹">ã€Šç®—æ³•ã€‹</a></strong></strong></strong></strong></strong></strong></strong></strong></p> 
<p style="text-align:center;"><strong>ğŸŒ<span style="color:#faa572;">æ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿ</span></strong></p> 
<hr> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">å‰è¨€</a></p> 
<p id="1.%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-toc" style="margin-left:0px;"><a href="#1.%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1" rel="nofollow">1.è¿›ç¨‹é—´é€šä¿¡</a></p> 
<p id="1.1%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E7%9B%AE%E7%9A%84-toc" style="margin-left:40px;"><a href="#1.1%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E7%9B%AE%E7%9A%84" rel="nofollow">1.1è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„</a></p> 
<p id="1.2%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E5%BC%8F-toc" style="margin-left:40px;"><a href="#1.2%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E5%BC%8F" rel="nofollow">1.2è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼</a></p> 
<p id="1.2.1%E4%B8%80%E8%88%AC%E8%A7%84%E5%BE%8B-toc" style="margin-left:80px;"><a href="#1.2.1%E4%B8%80%E8%88%AC%E8%A7%84%E5%BE%8B" rel="nofollow">1.2.1ä¸€èˆ¬è§„å¾‹</a></p> 
<p id="1.2.2%E5%85%B7%E4%BD%93%E5%81%9A%E6%B3%95-toc" style="margin-left:80px;"><a href="#1.2.2%E5%85%B7%E4%BD%93%E5%81%9A%E6%B3%95" rel="nofollow">1.2.2å…·ä½“åšæ³•</a></p> 
<p id="2.%E7%AE%A1%E9%81%93-toc" style="margin-left:0px;"><a href="#2.%E7%AE%A1%E9%81%93" rel="nofollow">2.ç®¡é“</a></p> 
<p id="2.1%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E7%9A%84%E7%AE%A1%E9%81%93-toc" style="margin-left:40px;"><a href="#2.1%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E7%9A%84%E7%AE%A1%E9%81%93" rel="nofollow">2.1å‘½ä»¤è¡Œä¸Šçš„ç®¡é“</a></p> 
<p id="2.2%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%C2%A0-toc" style="margin-left:40px;"><a href="#2.2%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%C2%A0" rel="nofollow">2.2åŒ¿åç®¡é“Â </a></p> 
<p id="2.2.1%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%E7%9A%84%E5%8E%9F%E7%90%86-toc" style="margin-left:80px;"><a href="#2.2.1%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%E7%9A%84%E5%8E%9F%E7%90%86" rel="nofollow">2.2.1åŒ¿åç®¡é“çš„åŸç†</a></p> 
<p id="2.2.2%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8pipe()-toc" style="margin-left:80px;"><a href="#2.2.2%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8pipe%28%29" rel="nofollow">2.2.2ç³»ç»Ÿè°ƒç”¨pipe()</a></p> 
<p id="2.2.3%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5-toc" style="margin-left:80px;"><a href="#2.2.3%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5" rel="nofollow">2.2.3ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ®Šæƒ…å†µ</a></p> 
<p id="2.2.4%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%80%A7%C2%A0-toc" style="margin-left:80px;"><a href="#2.2.4%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%80%A7%C2%A0" rel="nofollow">2.2.4ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ€§Â </a></p> 
<p id="2.2.5%E7%AE%A1%E9%81%93%E7%9A%84%E5%A4%A7%E5%B0%8F-toc" style="margin-left:80px;"><a href="#2.2.5%E7%AE%A1%E9%81%93%E7%9A%84%E5%A4%A7%E5%B0%8F" rel="nofollow">2.2.5ç®¡é“çš„å¤§å°</a></p> 
<p id="2.2.6%E8%BF%9B%E7%A8%8B%E6%B1%A0-toc" style="margin-left:80px;"><a href="#2.2.6%E8%BF%9B%E7%A8%8B%E6%B1%A0" rel="nofollow">2.2.6è¿›ç¨‹æ± </a></p> 
<p id="%E6%BA%90%E7%A0%81-toc" style="margin-left:120px;"><a href="#%E6%BA%90%E7%A0%81" rel="nofollow">æºç </a></p> 
<p id="%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%8B%B7%E8%B4%9D%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%AE%A1%E9%81%93%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%86%99%E7%AB%AF%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3-toc" style="margin-left:120px;"><a href="#%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%8B%B7%E8%B4%9D%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%AE%A1%E9%81%93%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%86%99%E7%AB%AF%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3" rel="nofollow">å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹å¯¼è‡´ç®¡é“æœ‰å¤šä¸ªå†™ç«¯çš„é—®é¢˜è§£å†³</a></p> 
<p id="2.3%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93-toc" style="margin-left:40px;"><a href="#2.3%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93" rel="nofollow">2.3å‘½åç®¡é“</a></p> 
<p id="%C2%A02.3.1%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93-toc" style="margin-left:80px;"><a href="#%C2%A02.3.1%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93" rel="nofollow">2.3.1ä½¿ç”¨å‘½ä»¤åˆ›å»ºå‘½åç®¡é“</a></p> 
<p id="2.3.2%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93-toc" style="margin-left:80px;"><a href="#2.3.2%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93" rel="nofollow">2.3.2ä½¿ç”¨ç¨‹åºåˆ›å»ºå‘½åç®¡é“</a></p> 
<p id="2.3.3%E7%94%A8%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1%C2%A0-toc" style="margin-left:80px;"><a href="#2.3.3%E7%94%A8%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1%C2%A0" rel="nofollow">2.3.3ç”¨å‘½åç®¡é“å®ç°server&amp;clienté€šä¿¡Â </a></p> 
<p id="3.system%20V%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1-toc" style="margin-left:0px;"><a href="#3.system%20V%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1" rel="nofollow">3.system Vè¿›ç¨‹é—´é€šä¿¡</a></p> 
<p id="3.1system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98-toc" style="margin-left:40px;"><a href="#3.1system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98" rel="nofollow">3.1system Vå…±äº«å†…å­˜</a></p> 
<p id="3.1.1%E5%8E%9F%E7%90%86-toc" style="margin-left:80px;"><a href="#3.1.1%E5%8E%9F%E7%90%86" rel="nofollow">3.1.1åŸç†</a></p> 
<p id="3.1.2%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E7%9A%84%E5%BB%BA%E7%AB%8B%E4%B8%8E%E9%87%8A%E6%94%BE-toc" style="margin-left:80px;"><a href="#3.1.2%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E7%9A%84%E5%BB%BA%E7%AB%8B%E4%B8%8E%E9%87%8A%E6%94%BE" rel="nofollow">3.1.2å…±äº«å†…å­˜çš„å»ºç«‹ä¸é‡Šæ”¾</a></p> 
<p id="3.1.3%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0-toc" style="margin-left:80px;"><a href="#3.1.3%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0" rel="nofollow">3.1.3ç³»ç»Ÿè°ƒç”¨å‡½æ•°</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmget%E5%87%BD%E6%95%B0-toc" style="margin-left:120px;"><a href="#%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmget%E5%87%BD%E6%95%B0" rel="nofollow">åˆ›å»ºå…±äº«å†…å­˜â€”â€”shmgetå‡½æ•°</a></p> 
<p id="%E6%8C%82%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmat%E5%87%BD%E6%95%B0-toc" style="margin-left:120px;"><a href="#%E6%8C%82%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmat%E5%87%BD%E6%95%B0" rel="nofollow">æŒ‚æ¥å…±äº«å†…å­˜â€”â€”shmatå‡½æ•°</a></p> 
<p id="%E6%8B%86%E5%8D%B8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmdt%E5%87%BD%E6%95%B0-toc" style="margin-left:120px;"><a href="#%E6%8B%86%E5%8D%B8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmdt%E5%87%BD%E6%95%B0" rel="nofollow">æ‹†å¸å…±äº«å†…å­˜â€”â€”shmdtå‡½æ•°</a></p> 
<p id="%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmctl%E5%87%BD%E6%95%B0-toc" style="margin-left:120px;"><a href="#%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmctl%E5%87%BD%E6%95%B0" rel="nofollow">é‡Šæ”¾å…±äº«å†…å­˜â€”â€”shmctlå‡½æ•°</a></p> 
<p id="3.1.4%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98-toc" style="margin-left:80px;"><a href="#3.1.4%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98" rel="nofollow">3.1.4å‘½ä»¤è¡Œæ“ä½œå…±äº«å†…å­˜</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%E2%80%94%E2%80%94ipcs%E5%91%BD%E4%BB%A4-toc" style="margin-left:120px;"><a href="#%E6%9F%A5%E7%9C%8B%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%E2%80%94%E2%80%94ipcs%E5%91%BD%E4%BB%A4" rel="nofollow">æŸ¥çœ‹å…±äº«å†…å­˜ä¿¡æ¯â€”â€”ipcså‘½ä»¤</a></p> 
<p id="%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94ipcrm%20-m%20shmid%E5%91%BD%E4%BB%A4-toc" style="margin-left:120px;"><a href="#%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94ipcrm%20-m%20shmid%E5%91%BD%E4%BB%A4" rel="nofollow">é‡Šæ”¾å…±äº«å†…å­˜â€”â€”ipcrm -m shmidå‘½ä»¤</a></p> 
<p id="3.1.5%E7%94%A8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1-toc" style="margin-left:80px;"><a href="#3.1.5%E7%94%A8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1" rel="nofollow">3.1.5ç”¨å…±äº«å†…å­˜å®ç°server&amp;clienté€šä¿¡</a></p> 
<p id="%E6%BA%90%E7%A0%81-toc" style="margin-left:120px;"><a href="#%E6%BA%90%E7%A0%81" rel="nofollow">æºç </a></p> 
<p id="%C2%A0%E7%AE%A1%E9%81%93%E6%8F%90%E4%BE%9B%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%8D%8F%E5%90%8C%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%B2%E8%A7%A3-toc" style="margin-left:120px;"><a href="#%C2%A0%E7%AE%A1%E9%81%93%E6%8F%90%E4%BE%9B%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%8D%8F%E5%90%8C%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%B2%E8%A7%A3" rel="nofollow">Â ç®¡é“æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶çš„è®²è§£</a></p> 
<p id="3.1.6system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E4%B8%8E%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%84%E5%AF%B9%E6%AF%94-toc" style="margin-left:80px;"><a href="#3.1.6system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E4%B8%8E%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%84%E5%AF%B9%E6%AF%94" rel="nofollow">3.1.6system Vå…±äº«å†…å­˜é€šä¿¡æ–¹å¼ä¸ç®¡é“é€šä¿¡çš„å¯¹æ¯”</a></p> 
<p id="3.2system%20V%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97-toc" style="margin-left:40px;"><a href="#3.2system%20V%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" rel="nofollow">3.2system Væ¶ˆæ¯é˜Ÿåˆ—</a></p> 
<p id="3.3system%20V%E4%BF%A1%E5%8F%B7%E9%87%8F-toc" style="margin-left:40px;"><a href="#3.3system%20V%E4%BF%A1%E5%8F%B7%E9%87%8F" rel="nofollow">3.3system Vä¿¡å·é‡</a></p> 
<hr id="hr-toc"> 
<h2>å‰è¨€</h2> 
<p>ç”±äºè¿›ç¨‹é—´å…·æœ‰ç‹¬ç«‹æ€§ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®è·å–ç”šè‡³ä¿®æ”¹å¯¹æ–¹çš„æ•°æ®çš„ï¼Œä½†æ˜¯åœ¨å®é™…éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿›ç¨‹ä¹‹é—´è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥å¿…é¡»å¼€å‘æŸç§æ–¹å¼ä½¿è¿›ç¨‹é—´å¯ä»¥å»ºç«‹è”ç³»ã€‚</p> 
<p>åœ¨æœ€å¼€å§‹ï¼Œè¿›ç¨‹é—´é€šä¿¡æœ€åŸå§‹çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ç®¡é“ï¼Œå½“ç„¶éšä¹‹ä¹Ÿæœ‰è¯¸å¤šä¸åŒçš„è¿›ç¨‹é—´é€šä¿¡çš„æ ‡å‡†ï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸‹å§ï¼</p> 
<hr> 
<p><span style="color:#ed7976;"><strong>æ¬¢è¿å¤§å®¶ğŸ“‚</strong></span><span style="color:#be191c;"><strong>æ”¶è—</strong></span><span style="color:#ed7976;"><strong>ğŸ“‚ä»¥ä¾¿æœªæ¥åšé¢˜æ—¶å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æ€è·¯ï¼Œå·§å¦™çš„æ–¹æ³•å¯ä»¥äº‹åŠåŠŸå€ã€‚Â </strong></span></p> 
<p><span style="color:#0d0016;"><strong>=========================================================================</strong></span></p> 
<p><span style="color:#9c8ec1;"><strong>GITEEç›¸å…³ä»£ç ï¼š</strong></span><span style="color:#0d0016;"><strong>ğŸŒŸ</strong></span><a href="https://gitee.com/fanfei_c" rel="nofollow" title="æ¨Šé£ (fanfei_c) - Gitee.com">æ¨Šé£ (fanfei_c) - Gitee.com</a><span style="color:#0d0016;"><strong>ğŸŒŸ</strong></span></p> 
<p><span style="color:#0d0016;"><strong>=========================================================================</strong></span></p> 
<hr> 
<h2 id="1.%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1">1.è¿›ç¨‹é—´é€šä¿¡</h2> 
<h3 id="1.1%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E7%9B%AE%E7%9A%84">1.1è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„</h3> 
<ul><li>æ•°æ®ä¼ è¾“ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†å®ƒçš„æ•°æ®å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚</li><li>èµ„æºå…±äº«ï¼šå¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«åŒæ ·çš„èµ„æºã€‚</li><li>é€šçŸ¥äº‹ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å‘å¦ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥å®ƒï¼ˆå®ƒä»¬ï¼‰å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼ˆå¦‚è¿›ç¨‹ç»ˆæ­¢æ—¶è¦é€šçŸ¥çˆ¶è¿›ç¨‹ï¼‰ã€‚</li><li>è¿›ç¨‹æ§åˆ¶ï¼šæœ‰äº›è¿›ç¨‹å¸Œæœ›å®Œå…¨æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰§è¡Œï¼ˆå¦‚Debugè¿›ç¨‹ï¼‰ï¼Œæ­¤æ—¶æ§åˆ¶è¿›ç¨‹å¸Œæœ›èƒ½å¤Ÿæ‹¦æˆªå¦ä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰é™·å…¥å’Œå¼‚å¸¸ï¼Œå¹¶èƒ½å¤ŸåŠæ—¶çŸ¥é“å®ƒçš„çŠ¶æ€æ”¹å˜ã€‚</li></ul> 
<p>æ€»ç»“ï¼šæˆ‘ä»¬å¾€å¾€éœ€è¦å¤šä¸ªè¿›ç¨‹ååŒå®Œæˆä¸€äº›äº‹æƒ…ã€‚</p> 
<h3 id="1.2%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E5%BC%8F">1.2è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼</h3> 
<h4 id="1.2.1%E4%B8%80%E8%88%AC%E8%A7%84%E5%BE%8B">1.2.1ä¸€èˆ¬è§„å¾‹</h4> 
<p>è¿›ç¨‹é—´é€šä¿¡çš„æœ¬è´¨å°±æ˜¯è®©ä¸åŒçš„è¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºï¼Œæˆ‘ä»¬éœ€è¦ä¸€å—ç©ºé—´ä½œä¸ºäº¤æ¢æ•°æ®çš„ã€ ç©ºé—´ã€ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯è¿›ç¨‹é—´çš„ç‹¬ç«‹æ€§ï¼Œè¿™å—ã€ ç©ºé—´ã€ä¸èƒ½ç”±é€šä¿¡åŒæ–¹ä»»ä½•ä¸€ä¸ªæä¾›ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªç¬¬ä¸‰æ–¹æ¥æä¾›ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹ä¸€èˆ¬å°±æ˜¯æ“ä½œç³»ç»Ÿã€‚</p> 
<h4 id="1.2.2%E5%85%B7%E4%BD%93%E5%81%9A%E6%B3%95">1.2.2å…·ä½“åšæ³•</h4> 
<p>æ“ä½œç³»ç»Ÿæä¾›çš„ã€ ç©ºé—´ã€æœ‰ä¸åŒçš„æ ·å¼ï¼Œå°±å†³å®šäº†æœ‰ä¸åŒçš„é€šä¿¡æ–¹å¼ã€‚</p> 
<p>æœ¬ç¯‡æ–‡ç« åé¢æåˆ°çš„å…±äº«å†…å­˜å’Œä¿¡å·é‡éƒ½æ˜¯åŸºäºã€ SystemÂ V IPCã€çš„é€šä¿¡æ–¹æ¡ˆï¼Œè¿™ç§æ˜¯æœ¬åœ°ä¸»æœºçš„è¿›ç¨‹é—´é€šä¿¡ï¼Œåœ¨å½“å‰å…¶å®ä¹Ÿå·²ç»å¹¶ä¸æµè¡Œï¼Œç°åœ¨ä¸€èˆ¬ä½¿ç”¨ç½‘ç»œçš„è¿›ç¨‹é—´é€šä¿¡ã€ POSIX IPCã€æ–¹æ¡ˆï¼Œå½“ç„¶è¿™é‡Œæˆ‘ä»¬åªæ˜¯ä»¥å­¦ä¹ ä¸ºç›®çš„ã€‚</p> 
<ul><li>ç®¡é“ï¼ˆåŒ¿åã€å‘½åï¼‰ï¼›</li><li>å…±äº«å†…å­˜ï¼›</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆæœ¬ç¯‡æ–‡ç« ç•¥ï¼‰ï¼›</li><li>ä¿¡å·é‡ï¼›</li></ul> 
<hr> 
<p><strong>è¿›ç¨‹é—´é€šä¿¡åˆ†ç±»</strong></p> 
<p>ç®¡é“</p> 
<ul><li>åŒ¿åç®¡é“</li><li>å‘½åç®¡é“</li></ul> 
<p>System V IPC</p> 
<ul><li>System V æ¶ˆæ¯é˜Ÿåˆ—</li><li>System V å…±äº«å†…å­˜</li><li>System V ä¿¡å·é‡</li></ul> 
<p>POSIX IPC</p> 
<ul><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>å…±äº«å†…å­˜</li><li>ä¿¡å·é‡</li><li>äº’æ–¥é‡</li><li>æ¡ä»¶å˜é‡</li><li>è¯»å†™é”</li></ul> 
<hr> 
<h2 id="2.%E7%AE%A1%E9%81%93">2.ç®¡é“</h2> 
<h3 id="2.1%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8A%E7%9A%84%E7%AE%A1%E9%81%93">2.1å‘½ä»¤è¡Œä¸Šçš„ç®¡é“</h3> 
<p>ç®¡é“æ˜¯Unixä¸­æœ€å¤è€çš„è¿›ç¨‹é—´é€šä¿¡çš„å½¢å¼ï¼Œæˆ‘ä»¬æŠŠä»ä¸€ä¸ªè¿›ç¨‹è¿æ¥åˆ°å¦ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®æµç§°ä¸ºä¸€ä¸ªâ€œç®¡é“â€ã€‚</p> 
<p>ä¾‹å¦‚ï¼Œç»Ÿè®¡æˆ‘ä»¬å½“å‰ä½¿ç”¨äº‘æœåŠ¡å™¨ä¸Šçš„ç™»å½•ç”¨æˆ·ä¸ªæ•°ï¼š</p> 
<p><img alt="" height="112" src="https://images2.imgbox.com/dd/e9/qymIVDLI_o.png" width="734"></p> 
<p>å…¶ä¸­ï¼Œwhoå‘½ä»¤å’Œwcå‘½ä»¤éƒ½æ˜¯ä¸¤ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œå½“å®ƒä»¬è¿è¡Œèµ·æ¥åå°±å˜æˆäº†ä¸¤ä¸ªè¿›ç¨‹ï¼Œwhoè¿›ç¨‹é€šè¿‡æ ‡å‡†è¾“å‡ºå°†æ•°æ®é€åˆ°ã€ ç®¡é“ã€å½“ä¸­ï¼Œwcè¿›ç¨‹å†é€šè¿‡æ ‡å‡†è¾“å…¥ä»ã€ ç®¡é“ã€å½“ä¸­è¯»å–æ•°æ®ï¼Œè‡³æ­¤ä¾¿å®Œæˆäº†æ•°æ®çš„ä¼ è¾“ã€‚</p> 
<blockquote> 
 <p><strong>è¡¥å……ï¼š</strong>whoå‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰äº‘æœåŠ¡å™¨çš„ç™»å½•ç”¨æˆ·ï¼ˆä¸€è¡Œæ˜¾ç¤ºä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œwc -lç”¨äºç»Ÿè®¡å½“å‰çš„è¡Œæ•°ã€‚</p> 
</blockquote> 
<h3 id="2.2%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%C2%A0">2.2åŒ¿åç®¡é“Â </h3> 
<h4 id="2.2.1%E5%8C%BF%E5%90%8D%E7%AE%A1%E9%81%93%E7%9A%84%E5%8E%9F%E7%90%86">2.2.1åŒ¿åç®¡é“çš„åŸç†</h4> 
<p>ä¸€ä¸ªtask_structå­˜æœ‰ä¸€ä¸ªæ–‡ä»¶ç»“æ„ä½“æŒ‡é’ˆ*filesï¼ŒæŒ‡å‘fileç»“æ„ä½“ï¼Œfileç»“æ„ä½“ä¸­å­˜åœ¨ä¸€ä»½æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œè¡¨ä¸­å­˜å‚¨ç€æŒ‡å‘æ–‡ä»¶æµçš„æŒ‡é’ˆï¼š</p> 
<p><img alt="" height="458" src="https://images2.imgbox.com/ec/27/S91ibDda_o.png" width="1200"></p> 
<p>å½“çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹ä¼šç”Ÿæˆä¸€ä»½è‡ªå·±çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œæ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­çš„å†…å®¹éƒ½æ˜¯æ‹·è´è‡ªçˆ¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œçˆ¶å­è¿›ç¨‹æ‹¥æœ‰äº†ä¸€ä»½å…±äº«çš„æ•°æ®åŒºï¼š</p> 
<p><img alt="" height="953" src="https://images2.imgbox.com/f5/9e/Otq5HmLr_o.png" width="1200"></p> 
<p>ä½†æ˜¯å­è¿›ç¨‹çš„æ–‡ä»¶æµä¸çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æµç›¸åŒï¼Œæ¯”å¦‚çˆ¶è¿›ç¨‹æ˜¯ä»¥è¯»çš„æ–¹å¼æ‰“å¼€çš„æ–‡ä»¶æµï¼Œé‚£ç›¸åº”çš„å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹ç›¸åŒä¹Ÿåªèƒ½æ˜¯ä»¥è¯»æ–¹å¼æ‰“å¼€ï¼Œè¿™ä¹Ÿå¹¶ä¸èƒ½è¾¾åˆ°æˆ‘ä»¬è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ã€‚</p> 
<p>å…¶å®æˆ‘ä»¬å¯ä»¥è¿™æ ·æ“ä½œï¼Œè®©çˆ¶è¿›ç¨‹æ‰“å¼€æŸä¸ªæ–‡ä»¶ä¸¤æ¬¡ï¼Œå¹¶ä¸”åˆ†åˆ«ä»¥è¯»å’Œå†™çš„æ–¹å¼æ‰“å¼€ï¼Œç„¶åå­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹ï¼Œä¹Ÿæ‹¥æœ‰ä¸¤ä¸ªæ–‡ä»¶æµï¼Œä¹‹åå…³é—­çˆ¶è¿›ç¨‹ä¸­å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æµï¼Œå†å…³é—­å­è¿›ç¨‹ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æµï¼Œæ¯”å¦‚å…³é—­çš„æ˜¯çˆ¶è¿›ç¨‹çš„è¯»æ–‡ä»¶æµå’Œå­è¿›ç¨‹çš„å†™æ–‡ä»¶æµï¼Œæ­¤æ—¶çˆ¶è¿›ç¨‹å°±æ˜¯å‘è¯¥ã€ å…±äº«ç©ºé—´ã€ å†™çš„ä¸€æ–¹ï¼Œè€Œå­è¿›ç¨‹å°±æ˜¯ä»è¯¥ã€ å…±äº«ç©ºé—´ã€è¯»çš„ä¸€æ–¹ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†è¿›ç¨‹é—´é€šä¿¡ã€‚</p> 
<p><img alt="" height="991" src="https://images2.imgbox.com/39/1b/LzmNqubM_o.png" width="879"></p> 
<blockquote> 
 <p>ç®¡é“åªèƒ½è¢«è®¾è®¡æˆå•å‘é€šä¿¡ã€‚</p> 
</blockquote> 
<p>Â ç”±äºåŒ¿åç®¡é“è¿™ç§æ–¹å¼æ˜¯é€šè¿‡å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹æ•°æ®æ¥è¾¾åˆ°çš„è¿›ç¨‹é—´é€šä¿¡çš„ç›®çš„ï¼Œæ‰€ä»¥åŒ¿åç®¡é“åªæ”¯æŒå¸¦æœ‰ã€ è¡€ç¼˜å…³ç³»ã€çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</p> 
<p>ä»¥ä¸Šè¿™ç§æ–¹å¼å¾ˆæ˜æ˜¾æ˜¯åŸºäºæ–‡ä»¶çš„ï¼Œè®©ä¸åŒè¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºçš„é€šä¿¡æ–¹å¼ï¼Œè¿™ç§é€šä¿¡æ–¹å¼å°±æ˜¯ç®¡é“ã€‚</p> 
<h4 id="2.2.2%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8pipe()">2.2.2ç³»ç»Ÿè°ƒç”¨pipe()</h4> 
<p>ä¸ºäº†æ”¯æŒç®¡é“é€šä¿¡ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼špipe();</p> 
<p><img alt="" height="770" src="https://images2.imgbox.com/ab/3d/hL1U18wZ_o.png" width="1200"></p> 
<p>pipeå‡½æ•°ç”¨äºåˆ›å»ºåŒ¿åç®¡é“ï¼Œpipeå‡½æ•°çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">int pipe(int pipefd[2]);</code></pre> 
<p>pipeå‡½æ•°çš„å‚æ•°æ˜¯ä¸€ä¸ªè¾“å‡ºå‹å‚æ•°ï¼Œæ•°ç»„pipefdç”¨äºè¿”å›ä¸¤ä¸ªæŒ‡å‘ç®¡é“è¯»ç«¯å’Œå†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦ï¼š</p> 
<table><thead><tr><th style="text-align:center;">æ•°ç»„å…ƒç´ </th><th style="text-align:center;">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center;">pipefd[0]</td><td style="text-align:center;">ç®¡é“è¯»ç«¯çš„æ–‡ä»¶æè¿°ç¬¦</td></tr><tr><td style="text-align:center;">pipefd[1]</td><td style="text-align:center;">ç®¡é“å†™ç«¯çš„æ–‡ä»¶æè¿°ç¬¦</td></tr></tbody></table> 
<p>pipeå‡½æ•°è°ƒç”¨æˆåŠŸæ—¶è¿”å›0ï¼Œè°ƒç”¨å¤±è´¥æ—¶è¿”å›-1ã€‚Â </p> 
<p>é€šè¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹è¿›è¡Œçˆ¶å­è¿›ç¨‹é—´çš„é€šä¿¡ï¼š</p> 
<p>éªŒè¯ä»£ç ï¼š</p> 
<pre><code class="language-cpp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;

//å†™å‡½æ•°
void writer(int wfd)
{
    const char *str = "hello father, I am child";
    char buffer[128];
    int cnt = 0;
    pid_t pid = getpid();
    while(1)
    {
        //å‘bufferä¸­å†™å…¥å­—ç¬¦ä¸²
        snprintf(buffer, sizeof(buffer), "message: %s, pid: %d, count: %d\n", str, pid, cnt);
        //å‘wfdæè¿°ç¬¦ä¸­å†™å…¥å­—ç¬¦ä¸²buffer
        write(wfd, buffer, strlen(buffer));
        cnt++;
        sleep(1);
    }
}

//è¯»å‡½æ•°
void reader(int rfd)
{
    char buffer[1024];
    while(1)
    {
        //ä»rfdæè¿°ç¬¦ä¸­è¯»å–å­—ç¬¦ä¸²åˆ°buffer
        ssize_t n = read(rfd, buffer, sizeof(buffer)-1);
        (void)n;//å»é™¤æœªä½¿ç”¨å˜é‡nçš„è­¦å‘Š
        printf("father get a message: %s", buffer);
    }
}


int main()
{
    int pipefd[2];
    int n = pipe(pipefd);
    if(n &lt; 0) return 1;
    printf("pipefd[0]: %d, pipefd[1]: %d\n", pipefd[0]/*read*/, pipefd[1]/*write*/); // 3, 4

    pid_t id = fork();
    if(id == 0)
    {
        //child: w
        close(pipefd[0]);

        writer(pipefd[1]);

        exit(0);
    }

    // father: r
    close(pipefd[1]);

    reader(pipefd[0]);
    wait(NULL);

    return 0;
}</code></pre> 
<p>éªŒè¯ç»“æœï¼šÂ </p> 
<p><img alt="" height="549" src="https://images2.imgbox.com/2e/e0/o3EqJxhw_o.png" width="1200"></p> 
<hr> 
<h4 id="2.2.3%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%83%85%E5%86%B5">2.2.3ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ®Šæƒ…å†µ</h4> 
<ol><li>å†™ç«¯è¿›ç¨‹ä¸å†™ï¼Œå¹¶ä¸”ç®¡é“å†…éƒ¨æ— æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹åº”çš„è¯»ç«¯è¿›ç¨‹å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç®¡é“é‡Œé¢æœ‰æ•°æ®ã€‚</li><li>è¯»ç«¯è¿›ç¨‹ä¸è¯»ï¼Œå¹¶ä¸”ç®¡é“å†…éƒ¨è¢«å†™æ»¡ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹åº”çš„å†™ç«¯è¿›ç¨‹å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç®¡é“å½“ä¸­çš„æ•°æ®è¢«è¯»ç«¯è¿›ç¨‹è¯»å–èµ°ã€‚</li><li>å†™ç«¯è¿›ç¨‹å°†æ•°æ®å†™å®Œåå°†å†™ç«¯å…³é—­ï¼Œé‚£ä¹ˆè¯»ç«¯è¿›ç¨‹ä¼šå°†ç®¡é“å½“ä¸­çš„æ•°æ®è¯»å®Œï¼Œè¿”å›å€¼ä¸º0ï¼Œè¡¨ç¤ºè¯»ç»“æŸã€‚</li><li>è¯»ç«¯è¿›ç¨‹ä¸è¯»å¹¶ä¸”å…³é—­ï¼Œè€Œå†™ç«¯è¿›ç¨‹è¿˜åœ¨ä¸€ç›´å‘ç®¡é“å†™å…¥æ•°æ®ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šé€šè¿‡ã€ ä¿¡å·13ï¼šSIGPIPE ã€å°†å†™ç«¯è¿›ç¨‹æ€æ‰ã€‚</li></ol> 
<h4 id="2.2.4%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%844%E7%A7%8D%E7%89%B9%E6%80%A7%C2%A0">2.2.4ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ€§Â </h4> 
<ol><li>è‡ªå¸¦åŒæ­¥ä¸äº’æ–¥æœºåˆ¶ï¼Œä¸¤ä¸ªè¿›ç¨‹å¿…é¡»è¦æŒ‰ç…§æŸç§æ¬¡åºæ¥å¯¹ç®¡é“è¿›è¡Œæ“ä½œï¼ŒåŒæ­¥çš„ä»»åŠ¡ä¹‹é—´æœ‰æ˜ç¡®çš„é¡ºåºå…³ç³»ï¼›</li></ol> 
<blockquote> 
 <ul><li><strong>åŒæ­¥ï¼š</strong>Â ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ååŒæ­¥è°ƒï¼ŒæŒ‰é¢„å®šçš„å…ˆåæ¬¡åºè¿è¡Œã€‚æ¯”å¦‚ï¼ŒAä»»åŠ¡çš„è¿è¡Œä¾èµ–äºBä»»åŠ¡äº§ç”Ÿçš„æ•°æ®ã€‚</li><li><strong>äº’æ–¥ï¼š</strong>Â ä¸€ä¸ªå…¬å…±èµ„æºåŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ï¼Œå¤šä¸ªè¿›ç¨‹ä¸èƒ½åŒæ—¶ä½¿ç”¨å…¬å…±èµ„æºã€‚</li></ul> 
</blockquote> 
<ol><li>é¢å‘å­—èŠ‚æµï¼Œå¯¹äºè¿›ç¨‹Aå†™å…¥ç®¡é“å½“ä¸­çš„æ•°æ®ï¼Œè¿›ç¨‹Bæ¯æ¬¡ä»ç®¡é“è¯»å–çš„æ•°æ®çš„å¤šå°‘æ˜¯ä»»æ„çš„ï¼Œè¿™ç§è¢«ç§°ä¸ºæµå¼æœåŠ¡ï¼›</li><li>ç®¡é“çš„ç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹ï¼Œç®¡é“æœ¬è´¨ä¸Šæ˜¯é€šè¿‡æ–‡ä»¶è¿›è¡Œé€šä¿¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç®¡é“ä¾èµ–äºæ–‡ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆå½“æ‰€æœ‰æ‰“å¼€è¯¥æ–‡ä»¶çš„è¿›ç¨‹éƒ½é€€å‡ºåï¼Œè¯¥æ–‡ä»¶ä¹Ÿå°±ä¼šè¢«é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥è¯´ç®¡é“çš„ç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹ï¼›</li><li>ç®¡é“æ˜¯åŠåŒå·¥é€šä¿¡çš„ï¼Œå³å•å‘é€šä¿¡ã€‚</li></ol> 
<blockquote> 
 <p>åœ¨æ•°æ®é€šä¿¡ä¸­ï¼Œæ•°æ®åœ¨çº¿è·¯ä¸Šçš„ä¼ é€æ–¹å¼å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p> 
 <ul><li>å•å·¥é€šä¿¡(Simplex Communication)ï¼šå•å·¥æ¨¡å¼çš„æ•°æ®ä¼ è¾“æ˜¯å•å‘çš„ã€‚é€šä¿¡åŒæ–¹ä¸­ï¼Œä¸€æ–¹å›ºå®šä¸ºå‘é€ç«¯ï¼Œå¦ä¸€æ–¹å›ºå®šä¸ºæ¥æ”¶ç«¯ã€‚</li><li>åŠåŒå·¥é€šä¿¡(Half Duplex)ï¼šåŠåŒå·¥æ•°æ®ä¼ è¾“æŒ‡æ•°æ®å¯ä»¥åœ¨ä¸€ä¸ªä¿¡å·è½½ä½“çš„ä¸¤ä¸ªæ–¹å‘ä¸Šä¼ è¾“ï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶ä¼ è¾“ã€‚</li><li>å…¨åŒå·¥é€šä¿¡(Full Duplex)ï¼šå…¨åŒå·¥é€šä¿¡å…è®¸æ•°æ®åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠåŒæ—¶ä¼ è¾“ï¼Œå®ƒçš„èƒ½åŠ›ç›¸å½“äºä¸¤ä¸ªå•å·¥é€šä¿¡æ–¹å¼çš„ç»“åˆã€‚å…¨åŒå·¥å¯ä»¥åŒæ—¶(ç¬æ—¶)è¿›è¡Œä¿¡å·çš„åŒå‘ä¼ è¾“ã€‚</li></ul> 
</blockquote> 
<h4 id="2.2.5%E7%AE%A1%E9%81%93%E7%9A%84%E5%A4%A7%E5%B0%8F">2.2.5ç®¡é“çš„å¤§å°</h4> 
<p>å‰é¢æˆ‘ä»¬æåˆ°ï¼Œå½“ç®¡é“æ»¡äº†çš„æ—¶å€™...</p> 
<p>é‚£ä¹ˆåœ¨linuxä¸­ç®¡é“çš„å¤§å°æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p> 
<p><span style="color:#1c7331;"><strong>ç®¡é“çš„æœ€å¤§å®¹é‡æ˜¯65536 å­—èŠ‚=64 KBã€‚</strong></span></p> 
<p>ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªPIPE_BUFçš„æ¦‚å¿µã€‚</p> 
<p>å½“å•æ¬¡å†™å…¥çš„æ•°æ®é‡ä¸å¤§äºPIPE_BUFæ—¶ï¼Œlinuxå°†ä¿è¯å†™å…¥æ•°æ®çš„ã€ åŸå­æ€§ ã€ã€‚</p> 
<p><span style="color:#1c7331;"><strong>linuxä¸­PIPE_BUFçš„å¤§å°ä¸º4096 å­—èŠ‚= 4 KB.</strong></span></p> 
<hr> 
<h4 id="2.2.6%E8%BF%9B%E7%A8%8B%E6%B1%A0">2.2.6è¿›ç¨‹æ± </h4> 
<p>æ“ä½œç³»ç»Ÿéšæ—¶éšåœ°éƒ½æœ‰å¯èƒ½æ”¶åˆ°ç”¨æˆ·åˆ›å»ºè¿›ç¨‹çš„è¯·æ±‚ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¸ºäº†èŠ‚çœå¼€é”€ï¼Œå¾€å¾€æ˜¯ä¸€æ¬¡ç”³è¯·åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆå‡å°‘ç³»ç»Ÿè°ƒç”¨çš„æ¬¡æ•°ã€‚</p> 
<p>æ”¾åˆ°ç°å®åœºæ™¯é‡Œï¼Œæ¯”å¦‚æˆ‘éœ€è¦å®Œæˆä¸€é¡¹ä»»åŠ¡ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿåœ¨æˆ‘æå‡ºè¯·æ±‚åæ‰å¼€å§‹åˆ›å»ºè¿›ç¨‹æ˜¯ä¸æ˜¯æ•ˆç‡ä¼šå¾ˆä½ä¸‹ï¼Œæ‰€ä»¥ä¸€èˆ¬æ“ä½œç³»ç»Ÿéƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹æ± ï¼Œå¯ä»¥éšæ—¶æ»¡è¶³ä¸åŒä»»åŠ¡çš„è¿›ç¨‹åˆ›å»ºè¯·æ±‚ã€‚</p> 
<p>æ‰€ä»¥æˆ‘ä»¬å¸Œæœ›æ“ä½œç³»ç»Ÿå¯ä»¥ä¸€æ¬¡åˆ›å»ºä¸€æ‰¹è¿›ç¨‹ï¼Œé‚£ä¹ˆåŸºäºåˆšæ‰å­¦ä¹ çš„åŒ¿åç®¡é“ï¼Œæˆ‘å¯ä¸å¯ä»¥å®ç°ä»¥ä¸‹è¿™æ ·çš„åŠŸèƒ½å‘¢ï¼Ÿ</p> 
<p>ä¸€ä¸ªçˆ¶è¿›ç¨‹åˆ›å»ºå¤šä¸ªå­è¿›ç¨‹ï¼ŒåŒæ—¶é…å¤‡ç›¸åŒæ•°é‡çš„ç®¡é“ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡ç®¡é“å‘å­è¿›ç¨‹å‘é€æŒ‡ä»¤ï¼Œè¦æ±‚å­è¿›ç¨‹å®ŒæˆæŸæŸä»»åŠ¡ã€‚</p> 
<blockquote> 
 <p>æ³¨æ„ï¼šä¸‹é™„æºç ä¸éƒ¨åˆ†æºç è®²è§£ã€‚</p> 
</blockquote> 
<h5 id="%E6%BA%90%E7%A0%81">æºç </h5> 
<p>processpool.cc</p> 
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;cstdlib&gt;
#include &lt;vector&gt;
#include &lt;unistd.h&gt;
#include &lt;ctime&gt;
#include &lt;sys/wait.h&gt;
#include "task.hpp"

using namespace std;

enum
{
    UsageError = 1,
    ArgError,
    PipeError
};

void Usage(const std::string &amp;proc)
{
    cout &lt;&lt; "Usage: " &lt;&lt; proc &lt;&lt; " subprocess-num" &lt;&lt; endl;
}

//ç®¡é“ç±»
class Channel
{
public:
    Channel(int wfd, pid_t sub_id, const std::string &amp;name)
        : _wfd(wfd), _sub_process_id(sub_id), _name(name)
    {
    }

    string name() { return _name; }
    int wfd() { return _wfd; }
    pid_t pid() { return _sub_process_id; }
    void Close() { close(_wfd); }
    ~Channel()
    {
    }

private:
    int _wfd; // ç®¡é“å†™ç«¯æ–‡ä»¶æè¿°ç¬¦è¡¨
    pid_t _sub_process_id;// å­è¿›ç¨‹pid
    string _name; //ç®¡é“åç§°
};

//è¿›ç¨‹æ± ç±»
class ProcessPool
{
public:
    ProcessPool(int sub_process_num) : _sub_process_num(sub_process_num)
    {
    }

    //åˆ›å»ºè¿›ç¨‹
    int CreateProcess(work_t work) // å›è°ƒå‡½æ•°
    {
        std::vector&lt;int&gt; fds; // ä¸ºäº†å¤„ç†å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹æè¿°ç¬¦è¡¨æ—¶å¼•èµ·çš„é—®é¢˜æ‰€æ­å»ºçš„å®¹å™¨
        for (int number = 0; number &lt; _sub_process_num; number++)
        {
            int pipefd[2]{0};
            int n = pipe(pipefd);
            if (n &lt; 0)
                return PipeError;
            pid_t id = fork();
            if (id == 0)
            {
                //å¤„ç†å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹æè¿°ç¬¦è¡¨æ—¶å¼•èµ·é—®é¢˜ï¼ˆä¸‹é¢è¯¦è°ˆï¼‰
                if (!fds.empty())
                {
                    std::cout &lt;&lt; "close w fd: ";
                    for (auto fd : fds)
                    {
                        close(fd);
                        std::cout &lt;&lt; fd &lt;&lt; " ";
                    }
                    std::cout &lt;&lt; std::endl;
                }

                // sleep(1);
                // child -&gt; r
                close(pipefd[1]);
                // æ‰§è¡Œä»»åŠ¡
                dup2(pipefd[0], 0);//é‡å®šå‘
                work(pipefd[0]);
                exit(0);
            }

            // sleep(2);
            string cname = "channel-" + to_string(number);
            // father
            close(pipefd[0]);
            channels.push_back(Channel(pipefd[1], id, cname));

            // æŠŠçˆ¶è¿›ç¨‹çš„wfdä¿å­˜ï¼Œåˆ›å»ºåç»­å…¶ä»–å­è¿›ç¨‹æ—¶ï¼ŒåŠæ—¶å…³é—­å½“å‰ç®¡é“çš„å†™ç«¯
            fds.push_back(pipefd[1]);
        }
        return 0;
    }

    //ç®¡é“è´Ÿè½½å‡è¡¡ï¼Œæ¯æ¬¡é€‰å–ä¸‹ä¸€ä¸ªç®¡é“è½®è¯¢
    int NextChannel()
    {
        static int next = 0;
        int c = next;
        next++;
        next %= channels.size();
        return c;
    }

    //å‘é€ä»»åŠ¡ç 
    void SendTaskCode(int index, uint32_t code)
    {
        cout &lt;&lt; "send code: " &lt;&lt; code &lt;&lt; " to " &lt;&lt; channels[index].name() &lt;&lt; " sub prorcess id: " &lt;&lt; channels[index].pid() &lt;&lt; endl;
        write(channels[index].wfd(), &amp;code, sizeof(code));
    }

    // è®©å­è¿›ç¨‹å…¨éƒ¨é€€å‡ºï¼Œåªéœ€è¦å…³é—­æ‰€æœ‰çš„Channel wå³å¯ï¼
    void KillAll()
    {
        for (auto &amp;channel : channels)
        {
            channel.Close();
            pid_t pid = channel.pid();
            
            //å›æ”¶å­è¿›ç¨‹
            pid_t rid = waitpid(pid, nullptr, 0);
            if (rid == pid)
            {
                std::cout &lt;&lt; "wait sub process: " &lt;&lt; pid &lt;&lt; " success..." &lt;&lt; std::endl;
            }
            std::cout &lt;&lt; channel.name() &lt;&lt; " close done" &lt;&lt; " sub process quit now : " &lt;&lt; channel.pid() &lt;&lt; std::endl;
        }
    }

    ~ProcessPool()
    {
    }

private:
    int _sub_process_num; // å­è¿›ç¨‹æ•°é‡
    vector&lt;Channel&gt; channels; // ç®¡é“å®¹å™¨
};


//è¿›ç¨‹æ± æ§åˆ¶
void CtrlProcessPool(ProcessPool *processpool_ptr, int cnt)
{
    while (cnt)
    {
        // a. é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹å’Œé€šé“
        int channel = processpool_ptr-&gt;NextChannel();
        // cout &lt;&lt; channel.name() &lt;&lt; endl;

        // b. ä½ è¦é€‰æ‹©ä¸€ä¸ªä»»åŠ¡
        uint32_t code = NextTask();

        // c. å‘é€ä»»åŠ¡
        processpool_ptr-&gt;SendTaskCode(channel, code);

        sleep(1);
        cnt--;
    }
}

// ./processpool 5
int main(int argc, char *argv[])
{
    if (argc != 2)
    {
        Usage(argv[0]);
        return UsageError;
    }
    //è·å–å‘½ä»¤è¡Œå‚æ•°ï¼šåˆ›å»ºçš„å­è¿›ç¨‹ä¸ªæ•°
    int sub_process_num = std::stoi(argv[1]);
    if (sub_process_num &lt;= 0)
        return ArgError;

    srand((uint64_t)time(nullptr));

    // 1. åˆ›å»ºé€šä¿¡ä¿¡é“å’Œå­è¿›ç¨‹
    ProcessPool *processpool_ptr = new ProcessPool(sub_process_num);
    processpool_ptr-&gt;CreateProcess(worker);

    // 2. æ§åˆ¶å­è¿›ç¨‹
    CtrlProcessPool(processpool_ptr, 10);

    std::cout &lt;&lt; "task run done" &lt;&lt; std::endl;
    // sleep(100);

    // 3. å›æ”¶å­è¿›ç¨‹
    processpool_ptr-&gt;KillAll();

    delete processpool_ptr;
    return 0;
}</code></pre> 
<p>task.hpp</p> 
<pre><code class="language-cpp">#pragma once

#include &lt;iostream&gt;
#include &lt;unistd.h&gt;

using namespace std;

typedef void(*work_t)(int);  //å‡½æ•°æŒ‡é’ˆç±»å‹
typedef void(*task_t)(int,pid_t);  //å‡½æ•°æŒ‡é’ˆç±»å‹

void PrintLog(int fd, pid_t pid)
{
    cout &lt;&lt; "sub process: " &lt;&lt; pid &lt;&lt; ", fd: " &lt;&lt; fd&lt;&lt; ", task is : printf log task\n" &lt;&lt; endl;
}

void ReloadConf(int fd, pid_t pid)
{
    cout &lt;&lt; "sub process: " &lt;&lt; pid &lt;&lt; ", fd: " &lt;&lt; fd&lt;&lt; ", task is : reload conf task\n" &lt;&lt; endl;
}

void ConnectMysql(int fd, pid_t pid)
{
    cout &lt;&lt; "sub process: " &lt;&lt; pid &lt;&lt; ", fd: " &lt;&lt; fd&lt;&lt; ", task is : connect mysql task\n" &lt;&lt; endl;
}

task_t tasks[3] = {PrintLog, ReloadConf, ConnectMysql};

uint32_t NextTask()
{
    return rand() % 3;
}

void worker(int fd)
{
    // ä»0ä¸­è¯»å–ä»»åŠ¡å³å¯ï¼
    while(true)
    {
        uint32_t command_code = 0;
        ssize_t n = read(0, &amp;command_code, sizeof(command_code));
        if(n == sizeof(command_code))
        {
            if(command_code &gt;= 3) continue;
            tasks[command_code](fd, getpid());
        }
        else if(n == 0)
        {
            std::cout &lt;&lt; "sub process: " &lt;&lt; getpid() &lt;&lt; " quit now..." &lt;&lt; std::endl;
            break;
        }
    }
    
}</code></pre> 
<hr> 
<h5 id="%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%8B%B7%E8%B4%9D%E7%88%B6%E8%BF%9B%E7%A8%8B%E5%AF%BC%E8%87%B4%E7%AE%A1%E9%81%93%E6%9C%89%E5%A4%9A%E4%B8%AA%E5%86%99%E7%AB%AF%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3">å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹å¯¼è‡´ç®¡é“æœ‰å¤šä¸ªå†™ç«¯çš„é—®é¢˜è§£å†³</h5> 
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦éœ€è¦ç ”ç©¶ä¸€ä¸‹ï¼šå­è¿›ç¨‹çš„å›æ”¶ä¸ç®¡é“çš„å…³é—­å¯èƒ½ä¼šå¼•å‘çš„é—®é¢˜ã€‚</p> 
<p>ä»¥ä¸Šä»£ç æ˜¯å¤„ç†å®Œbugçš„ç»“æœï¼Œé—®é¢˜ä¸»è¦å‘ç”Ÿåœ¨åˆ›å»ºå¤šä¸ªå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹éƒ½ä¼šå®Œæ•´åœ°æ‹·è´çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œè¿™å°±ä¼šå¼•å‘å­è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦è¡¨æ‹·è´ä¸‹æ¥ä¸éœ€è¦çš„è¯»å†™æ–‡ä»¶æµï¼Œè¿™æ ·è¯´æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬ç”»å›¾æ¥è¯´æ˜ï¼š</p> 
<p><img alt="" height="697" src="https://images2.imgbox.com/67/c2/qGySAaaq_o.png" width="1200"></p> 
<p>ä½ ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå½“çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹2æ—¶ï¼ŒÂ ç”±äºå­è¿›ç¨‹2çš„æ–‡ä»¶æè¿°ç¬¦è¡¨æ˜¯æ‹·è´çš„çˆ¶è¿›ç¨‹ï¼Œé‚£ä¹ˆä¹Ÿä¼šä¸€å¹¶å°†çˆ¶è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦è¡¨ä¸­ä¸‹æ ‡ä¸º4çš„æµæ‹·è´è¿‡æ¥ï¼Œå¯¼è‡´å­è¿›ç¨‹2ä¸­çš„æ–‡ä»¶æè¿°ç¬¦è¡¨ä¹Ÿæœ‰æŒ‡å‘ç®¡é“1çš„æµã€‚</p> 
<p>å¦‚æœä½ ç¡®ä¿å­è¿›ç¨‹2ä¸ä¼šå‘ç®¡é“1å†™å…¥æ•°æ®çš„è¯ï¼Œå¥½åƒä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p> 
<p>æ³¨æ„ï¼šä¸»è¦é—®é¢˜å‘ç”Ÿåœ¨å…³é—­ç®¡é“å’Œå›æ”¶å­è¿›ç¨‹ä¸Šã€‚</p> 
<p>æ ¹æ®ç®¡é“é€šä¿¡çš„4ç§ç‰¹æ®Šæƒ…å†µä¹‹ä¸€ï¼šæˆ‘ä»¬å¦‚ä½•è®©è¯»ç«¯è¿›ç¨‹ï¼ˆå­è¿›ç¨‹ï¼‰é€€å‡ºå‘¢ï¼Ÿ</p> 
<p>åªéœ€è¦å…³é—­æˆ‘ä»¬ç®¡é“çš„å†™ç«¯ï¼Œé‚£ä¹ˆè¯»ç«¯è¿›ç¨‹å°±ä¼šå…³é—­ã€‚</p> 
<p>ä½†æ˜¯ç”±äºç®¡é“1çš„å†™ç«¯æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯çˆ¶è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯å­è¿›ç¨‹2ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹è¿˜èƒ½æ§åˆ¶å­è¿›ç¨‹çš„å…³é—­ä¹ˆï¼Ÿ</p> 
<p>æ­£å¸¸æ¥è®²ï¼šåº”è¯¥æ˜¯çˆ¶è¿›ç¨‹è¦å…³é—­æŸä¸ªå­è¿›ç¨‹ï¼Œåªéœ€è¦å…³é—­é“¾æ¥è¯¥å­è¿›ç¨‹çš„ç®¡é“çš„å†™ç«¯å³å¯ï¼Œç°åœ¨çš„æƒ…å†µå°±æ˜¯ï¼Œå°±ç®—çˆ¶è¿›ç¨‹å…³é—­äº†ç®¡é“çš„å†™ç«¯ï¼Œé‚£ä¹ˆè¿˜æœ‰ç”±äºåˆ›å»ºå­è¿›ç¨‹æ‹·è´çš„é—®é¢˜ï¼Œåç»­çš„å…¶ä»–å­è¿›ç¨‹éƒ½ä¼šæœ‰è¯¥ç®¡é“çš„å†™ç«¯ã€‚</p> 
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæˆ‘ç»™å‡ºçš„æºç åœ¨åˆ›å»ºè¿›ç¨‹æ± å‡½æ•°ä¸­å·²ç»ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæˆ‘å•ç‹¬æ‹¿å‡ºæ¥åšè®²è§£ï¼š</p> 
<pre><code class="language-cpp">//åˆ›å»ºè¿›ç¨‹
int CreateProcess(work_t work) // å›è°ƒå‡½æ•°
{
    std::vector&lt;int&gt; fds; // ä¸ºäº†å¤„ç†å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹æè¿°ç¬¦è¡¨æ—¶å¼•èµ·çš„é—®é¢˜æ‰€æ­å»ºçš„å®¹å™¨
    for (int number = 0; number &lt; _sub_process_num; number++)
    {
        int pipefd[2]{ 0 };
        int n = pipe(pipefd);
        if (n &lt; 0)
            return PipeError;
        pid_t id = fork();
        if (id == 0)
        {
            //å¤„ç†å­è¿›ç¨‹æ‹·è´çˆ¶è¿›ç¨‹æè¿°ç¬¦è¡¨æ—¶å¼•èµ·é—®é¢˜ï¼ˆä¸‹é¢è¯¦è°ˆï¼‰
            if (!fds.empty())
            {
                std::cout &lt;&lt; "close w fd: ";
                for (auto fd : fds)
                {
                    close(fd);
                    std::cout &lt;&lt; fd &lt;&lt; " ";
                }
                std::cout &lt;&lt; std::endl;
            }

            // sleep(1);
            // child -&gt; r
            close(pipefd[1]);
            // æ‰§è¡Œä»»åŠ¡
            dup2(pipefd[0], 0);//é‡å®šå‘
            work(pipefd[0]);
            exit(0);
        }

        // sleep(2);
        string cname = "channel-" + to_string(number);
        // father
        close(pipefd[0]);
        channels.push_back(Channel(pipefd[1], id, cname));

        // æŠŠçˆ¶è¿›ç¨‹çš„wfdä¿å­˜ï¼Œåˆ›å»ºåç»­å…¶ä»–å­è¿›ç¨‹æ—¶ï¼ŒåŠæ—¶å…³é—­å½“å‰ç®¡é“çš„å†™ç«¯
        fds.push_back(pipefd[1]);
    }
    return 0;
}</code></pre> 
<p>æ ¹æ®æ³¨é‡Šï¼Œæˆ‘ä»¬ç»´æŠ¤äº†ä¸€ä¸ªvectorå®¹å™¨ï¼Œåœ¨æ¯æ¬¡åˆ›å»ºå­è¿›ç¨‹åï¼Œå°†çˆ¶è¿›ç¨‹å½“å‰çš„wfdä¿å­˜ï¼Œæ”¾åœ¨ä¸Šé¢å›¾ç¤ºä¸­çš„ä¾‹å­å°±æ˜¯ä¸‹æ ‡ä¸º4çš„æ–‡ä»¶æµï¼Œä¿å­˜åï¼Œåœ¨åˆ›å»ºæ–°çš„å­è¿›ç¨‹æ—¶ï¼Œåˆ¤æ–­å®¹å™¨fdsæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œè¯æ˜å¯èƒ½ä¼šå‘ç”Ÿæ‹·è´é£é™©ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠæ—¶å°†ä¹‹å‰ä¿å­˜çš„ä¸‹æ ‡ä¸º4çš„æ–‡ä»¶æµå…³é—­ï¼Œé€šè¿‡ç»´æŠ¤è¿™æ ·ä¸€ä¸ªvectorï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚</p> 
<hr> 
<h3 id="2.3%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93">2.3å‘½åç®¡é“</h3> 
<p>å‘½åç®¡é“ä¸åŒ¿åç®¡é“çš„åŒºåˆ«åœ¨äºï¼šå‘½åç®¡é“å¯ä»¥è®©æ²¡æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼Œå…¶ä»–å¹¶æ— å·®åˆ«ã€‚</p> 
<p>é‚£ä¹ˆæˆ‘ä»¬ä¹‹å‰è¯´è¿‡è¿›ç¨‹é—´é€šä¿¡çš„æœ¬è´¨å°±æ˜¯ï¼šè¿›ç¨‹é—´é€šä¿¡çš„æœ¬è´¨å°±æ˜¯è®©ä¸åŒçš„è¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºï¼Œ</p> 
<p>é‚£ä¹ˆå¦‚ä½•å®ç°ä¸¤ä¸ªæ¯«ä¸ç›¸å…³è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å‘¢ï¼Œå¾ˆæ˜æ˜¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸¤ä¸ªè¿›ç¨‹éƒ½å¯ä»¥çœ‹åˆ°çš„æ–‡ä»¶ï¼Œå‘½åç®¡é“å°±æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–‡ä»¶ï¼Œä¸¤ä¸ªè¿›ç¨‹é€šè¿‡å‘½åç®¡é“çš„è·¯å¾„æ–‡ä»¶åæ‰“å¼€åŒä¸€ä¸ªç®¡é“æ–‡ä»¶ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªè¿›ç¨‹ä¹Ÿå°±çœ‹åˆ°äº†åŒä¸€ä»½èµ„æºï¼Œè¿›è€Œå°±å¯ä»¥è¿›è¡Œé€šä¿¡äº†ã€‚</p> 
<p><strong>æ³¨æ„ï¼š</strong></p> 
<ol><li>æ™®é€šæ–‡ä»¶æ˜¯å¾ˆéš¾åšåˆ°é€šä¿¡çš„ï¼Œå³ä¾¿åšåˆ°é€šä¿¡ä¹Ÿæ— æ³•è§£å†³ä¸€äº›å®‰å…¨é—®é¢˜ã€‚</li><li>å‘½åç®¡é“å’ŒåŒ¿åç®¡é“ä¸€æ ·ï¼Œéƒ½æ˜¯å†…å­˜æ–‡ä»¶ï¼Œåªä¸è¿‡å‘½åç®¡é“åœ¨ç£ç›˜æœ‰ä¸€ä¸ªç®€å•çš„æ˜ åƒï¼Œä½†è¿™ä¸ªæ˜ åƒçš„å¤§å°æ°¸è¿œä¸º0ï¼Œå› ä¸ºå‘½åç®¡é“å’ŒåŒ¿åç®¡é“éƒ½ä¸ä¼šå°†é€šä¿¡æ•°æ®åˆ·æ–°åˆ°ç£ç›˜å½“ä¸­ã€‚</li></ol> 
<h4 id="%C2%A02.3.1%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93">2.3.1ä½¿ç”¨å‘½ä»¤åˆ›å»ºå‘½åç®¡é“</h4> 
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>mkfifo</code>å‘½ä»¤åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“ã€‚</p> 
<pre><code class="language-cpp">mkfifo fifo</code></pre> 
<p><img alt="" height="255" src="https://images2.imgbox.com/43/5c/Un2H2Lt0_o.png" width="852"></p> 
<p>ä½¿ç”¨è¿™ä¸ªå‘½åç®¡é“æ–‡ä»¶ï¼Œå°±èƒ½å®ç°ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡äº†ã€‚æˆ‘ä»¬åœ¨ä¸€ä¸ªè¿›ç¨‹ï¼ˆè¿›ç¨‹Aï¼‰ä¸­ç”¨shellè„šæœ¬æ¯ç§’å‘å‘½åç®¡é“å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆè¿›ç¨‹Bï¼‰å½“ä¸­ç”¨catå‘½ä»¤ä»å‘½åç®¡é“å½“ä¸­è¿›è¡Œè¯»å–ã€‚</p> 
<p>ç°è±¡å°±æ˜¯å½“è¿›ç¨‹Aå¯åŠ¨åï¼Œè¿›ç¨‹Bä¼šæ¯ç§’ä»å‘½åç®¡é“ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²æ‰“å°åˆ°æ˜¾ç¤ºå™¨ä¸Šã€‚è¿™å°±è¯æ˜äº†è¿™ä¸¤ä¸ªæ¯«ä¸ç›¸å…³çš„è¿›ç¨‹å¯ä»¥é€šè¿‡å‘½åç®¡é“è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p> 
<p><img alt="" height="320" src="https://images2.imgbox.com/1d/e1/zzfiOc7E_o.png" width="1200"></p> 
<blockquote> 
 <p>æ³¨æ„ï¼šä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå½“ç®¡é“çš„è¯»ç«¯è¿›ç¨‹é€€å‡ºåï¼Œå†™ç«¯è¿›ç¨‹å†å‘ç®¡é“å†™å…¥æ•°æ®å°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œæ­¤æ—¶å†™ç«¯è¿›ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿæ€æ‰ï¼Œåœ¨è¿™é‡Œå°±å¯ä»¥å¾ˆå¥½çš„å¾—åˆ°éªŒè¯ï¼šå½“æˆ‘ä»¬ç»ˆæ­¢æ‰è¯»ç«¯è¿›ç¨‹åï¼Œå› ä¸ºå†™ç«¯æ‰§è¡Œçš„å¾ªç¯è„šæœ¬æ˜¯ç”±å‘½ä»¤è¡Œè§£é‡Šå™¨bashæ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ­¤æ—¶bashå°±ä¼šè¢«æ“ä½œç³»ç»Ÿæ€æ‰ï¼Œæˆ‘ä»¬çš„äº‘æœåŠ¡å™¨ä¹Ÿå°±é€€å‡ºäº†ã€‚Â </p> 
</blockquote> 
<hr> 
<h4 id="2.3.2%E4%BD%BF%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%88%9B%E5%BB%BA%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93">2.3.2ä½¿ç”¨ç¨‹åºåˆ›å»ºå‘½åç®¡é“</h4> 
<p>åœ¨ç¨‹åºä¸­åˆ›å»ºå‘½åç®¡é“ä½¿ç”¨mkfifoå‡½æ•°ï¼Œmkfifoå‡½æ•°çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">int mkfifo(const char *pathname, mode_t mode);</code></pre> 
<p><strong>å‚æ•°ï¼šÂ </strong></p> 
<ul><li>å‚æ•°pathnameï¼šåˆ›å»ºçš„ç®¡é“çš„è·¯å¾„æ–‡ä»¶åã€‚</li><li>å‚æ•°modeï¼šåˆ›å»ºå‘½åç®¡é“æ–‡ä»¶çš„é»˜è®¤æƒé™ã€‚</li></ul> 
<p>ä¸ºäº†é¿å…åˆ›å»ºå‡ºæ¥ç®¡é“æ–‡ä»¶çš„æƒé™å€¼å—åˆ°umaskï¼ˆæ–‡ä»¶é»˜è®¤æ©ç ï¼‰çš„å½±å“ï¼Œå¯ä»¥åˆ©ç”¨umaskå‡½æ•°ä¸»åŠ¨æ–‡ä»¶é»˜è®¤æ©ç è®¾ç½®ä¸º0ã€‚</p> 
<pre><code class="language-cpp">umask(0); //å°†æ–‡ä»¶æ©ç è®¾ç½®ä¸º0</code></pre> 
<blockquote> 
 <p>tipsï¼šå®é™…åˆ›å»ºå‡ºæ¥æ–‡ä»¶çš„æƒé™ä¸ºï¼šmode&amp;(~umask)ã€‚umaskçš„é»˜è®¤å€¼ä¸€èˆ¬ä¸º0002ï¼Œå½“æˆ‘ä»¬è®¾ç½®modeå€¼ä¸º0666æ—¶å®é™…åˆ›å»ºå‡ºæ¥æ–‡ä»¶çš„æƒé™ä¸º0664ã€‚</p> 
</blockquote> 
<p><strong>Â è¿”å›å€¼</strong>ï¼š</p> 
<ul><li>å‘½åç®¡é“åˆ›å»ºæˆåŠŸï¼Œè¿”å›0ã€‚</li><li>å‘½åç®¡é“åˆ›å»ºå¤±è´¥ï¼Œè¿”å›-1ã€‚</li></ul> 
<hr> 
<h4 id="2.3.3%E7%94%A8%E5%91%BD%E5%90%8D%E7%AE%A1%E9%81%93%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1%C2%A0">2.3.3ç”¨å‘½åç®¡é“å®ç°server&amp;clienté€šä¿¡Â </h4> 
<p>å®ç°æœåŠ¡ç«¯(server)å’Œå®¢æˆ·ç«¯(client)ä¹‹é—´çš„é€šä¿¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®©æœåŠ¡ç«¯è¿è¡Œèµ·æ¥ï¼Œæˆ‘ä»¬éœ€è¦è®©æœåŠ¡ç«¯è¿è¡Œååˆ›å»ºä¸€ä¸ªå‘½åç®¡é“æ–‡ä»¶ï¼Œç„¶åå†ä»¥è¯»çš„æ–¹å¼æ‰“å¼€è¯¥å‘½åç®¡é“æ–‡ä»¶ï¼Œä¹‹åæœåŠ¡ç«¯å°±å¯ä»¥ä»è¯¥å‘½åç®¡é“å½“ä¸­è¯»å–å®¢æˆ·ç«¯å‘æ¥çš„é€šä¿¡ä¿¡æ¯äº†ã€‚</p> 
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ªFifoç±»ï¼Œè®©è¯¥ç±»æ›¿æˆ‘ä»¬å¤„ç†æœ‰å…³ç®¡é“çš„åˆ›å»ºé”€æ¯çš„æ“ä½œï¼š</p> 
<pre><code class="language-cpp">#ifndef __COMM_HPP__
#define __COMM_HPP__

#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;cerrno&gt;
#include &lt;cstring&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;

using namespace std;

#define Mode 0666
#define Path "./fifo"

class Fifo
{
public:
    Fifo(const string &amp;path) : _path(path)
    {
        umask(0);
        int n = mkfifo(_path.c_str(), Mode);
        if (n == 0)
        {
            cout &lt;&lt; "mkfifo success" &lt;&lt; endl;
        }
        else
        {
            cerr &lt;&lt; "mkfifo failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
        }
    }
    ~Fifo()
    {
        int n = unlink(_path.c_str());
        if (n == 0)
        {
            cout &lt;&lt; "remove fifo file " &lt;&lt; _path &lt;&lt; " success" &lt;&lt; endl;
        }
        else
        {
            cerr &lt;&lt; "remove failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
        }
    }

private:
    string _path; // æ–‡ä»¶è·¯å¾„+æ–‡ä»¶å
};

#endif</code></pre> 
<p>æœåŠ¡ç«¯çš„ä»£ç å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">//server.c
#include "comm.h"

int main()
{
    Fifo fifo(Path);

    int rfd = open(Path, O_RDONLY);
    if (rfd &lt; 0)
    {
        cerr &lt;&lt; "open failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
        return 1;
    }
    // å¦‚æœæˆ‘ä»¬çš„å†™ç«¯æ²¡æ‰“å¼€ï¼Œå…ˆè¯»æ‰“å¼€ï¼Œopençš„æ—¶å€™å°±ä¼šé˜»å¡ï¼Œç›´åˆ°æŠŠå†™ç«¯æ‰“å¼€ï¼Œè¯»openæ‰ä¼šè¿”å›
    cout &lt;&lt; "open success" &lt;&lt; endl;

    char buffer[1024];
    while (true)
    {
        ssize_t n = read(rfd, buffer, sizeof(buffer) - 1);
        if (n &gt; 0)
        {
            buffer[n] = 0;//åŠ ä¸Š'\0'æ–¹ä¾¿è¾“å‡º
            cout &lt;&lt; "client say : " &lt;&lt; buffer &lt;&lt; endl;
        }
        else if (n == 0)
        {
            cout &lt;&lt; "client quit, me too!!" &lt;&lt; endl;//å†™ç«¯é€€å‡ºï¼Œè¯»ç«¯ä¹Ÿé€€å‡º
            break;
        }
        else
        {
            cerr &lt;&lt; "read failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
            break;
        }
    }

    close(rfd);
    return 0;
}</code></pre> 
<p>å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œå› ä¸ºæœåŠ¡ç«¯è¿è¡Œèµ·æ¥åå‘½åç®¡é“æ–‡ä»¶å°±å·²ç»è¢«åˆ›å»ºäº†ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åªéœ€ä»¥å†™çš„æ–¹å¼æ‰“å¼€è¯¥å‘½åç®¡é“æ–‡ä»¶ï¼Œä¹‹åå®¢æˆ·ç«¯å°±å¯ä»¥å°†é€šä¿¡ä¿¡æ¯å†™å…¥åˆ°å‘½åç®¡é“æ–‡ä»¶å½“ä¸­ï¼Œè¿›è€Œå®ç°å’ŒæœåŠ¡ç«¯çš„é€šä¿¡ã€‚</p> 
<p>å®¢æˆ·ç«¯çš„ä»£ç å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">//client.c
#include "comm.h"

int main()
{
	int wfd = open(PATH, O_WRONLY); //ä»¥å†™çš„æ–¹å¼æ‰“å¼€å‘½åç®¡é“æ–‡ä»¶
	if (wfd &lt; 0){
		cerr &lt;&lt; "open failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
		return 1;
	}
	string inbuffer;
	while (true)
    {
        cout &lt;&lt; "Please Enter Your Message# ";
        std::getline(cin, inbuffer);
        if(inbuffer == "quit") break;
        ssize_t n = write(wfd, inbuffer.c_str(), inbuffer.size());
        if (n &lt; 0)
        {
            cerr &lt;&lt; "write failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
            break;
        }
    }
	close(wfd); //é€šä¿¡å®Œæ¯•ï¼Œå…³é—­å‘½åç®¡é“æ–‡ä»¶
	return 0;
}</code></pre> 
<hr> 
<h2 id="3.system%20V%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1">3.system Vè¿›ç¨‹é—´é€šä¿¡</h2> 
<p>system Vè¿›ç¨‹é—´é€šä¿¡ä»ç„¶æ˜¯ä¸€ç§æœ¬åœ°é€šä¿¡æ–¹æ¡ˆï¼Œä¸åŒçš„æ˜¯ï¼Œç®¡é“çš„å®ç°å…¶å®æ˜¯åŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œä¸éœ€è¦å•ç‹¬è®¾è®¡æ¨¡å—ï¼Œè€Œsystem V IPCæ˜¯æ“ä½œç³»ç»Ÿç‰¹åœ°è®¾è®¡çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­ä¸“é—¨è®¾è®¡çš„é€šä¿¡æ–¹æ¡ˆã€‚</p> 
<p>system V IPCæä¾›çš„é€šä¿¡æ–¹å¼æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p> 
<ul><li>system Vå…±äº«å†…å­˜</li><li>system Væ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç•¥ï¼‰</li><li>system Vä¿¡å·é‡ï¼ˆç•¥ï¼‰</li></ul> 
<p>å…¶ä¸­ï¼Œsystem Vå…±äº«å†…å­˜å’Œsystem Væ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä»¥ä¼ é€æ•°æ®ä¸ºç›®çš„çš„ï¼Œè€Œsystem Vä¿¡å·é‡æ˜¯ä¸ºäº†ä¿è¯è¿›ç¨‹é—´çš„åŒæ­¥ä¸äº’æ–¥è€Œè®¾è®¡çš„ï¼Œè™½ç„¶system Vä¿¡å·é‡å’Œé€šä¿¡å¥½åƒæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½†å±äºé€šä¿¡èŒƒç•´ã€‚</p> 
<h3 id="3.1system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98">3.1system Vå…±äº«å†…å­˜</h3> 
<h4 id="3.1.1%E5%8E%9F%E7%90%86">3.1.1åŸç†</h4> 
<p>system Vå…±äº«å†…å­˜çš„é€šä¿¡æ–¹æ¡ˆçš„æœ¬è´¨ä»ç„¶æ˜¯è®©ä¸åŒè¿›ç¨‹çœ‹åˆ°åŒä¸€ä»½èµ„æºï¼Œåªä¸è¿‡è¿™ä¸ªèµ„æºç°åœ¨å˜æˆäº†ç‰©ç†å†…å­˜ã€‚</p> 
<p>åœ¨ç‰©ç†å†…å­˜å½“ä¸­ç”³è¯·ä¸€å—å†…å­˜ç©ºé—´ï¼Œç„¶åå°†è¿™å—å†…å­˜ç©ºé—´åˆ†åˆ«ä¸å„ä¸ªè¿›ç¨‹å„è‡ªçš„é¡µè¡¨ä¹‹é—´å»ºç«‹æ˜ å°„ï¼Œå†åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´å½“ä¸­å¼€è¾Ÿç©ºé—´å¹¶å°†è™šæ‹Ÿåœ°å€å¡«å……åˆ°å„è‡ªé¡µè¡¨çš„å¯¹åº”ä½ç½®ï¼Œä½¿å¾—è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€ä¹‹é—´å»ºç«‹èµ·å¯¹åº”å…³ç³»ï¼Œè‡³æ­¤è¿™äº›è¿›ç¨‹ä¾¿çœ‹åˆ°äº†åŒä¸€ä»½ç‰©ç†å†…å­˜ï¼Œè¿™å—ç‰©ç†å†…å­˜å°±å«åšå…±äº«å†…å­˜ã€‚</p> 
<p><img alt="" height="517" src="https://images2.imgbox.com/2b/d5/qLImp2kZ_o.png" width="1200"></p> 
<hr> 
<p>ç³»ç»Ÿä¸­ä¸€å®šæœ‰å¾ˆå¤šä¸ªè¿›ç¨‹é—´è¿›è¡Œé€šä¿¡ï¼Œä¹Ÿå°±æ˜¯è¯´å…±äº«å†…å­˜åœ¨å†…æ ¸ä¸­åŒæ—¶å¯ä»¥å­˜åœ¨å¾ˆå¤šä¸ªï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿéœ€è¦å°†è¿™äº›å…±äº«å†…å­˜ç®¡ç†èµ·æ¥ï¼šå…ˆæè¿°ï¼Œå†ç»„ç»‡ã€‚</p> 
<p>ç”¨æˆ·çº§å…±äº«å†…å­˜çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">struct shmid_ds {
	struct ipc_perm     shm_perm;   /* operation perms */
	int         shm_segsz;  /* size of segment (bytes) */
	__kernel_time_t     shm_atime;  /* last attach time */
	__kernel_time_t     shm_dtime;  /* last detach time */
	__kernel_time_t     shm_ctime;  /* last change time */
	__kernel_ipc_pid_t  shm_cpid;   /* pid of creator */
	__kernel_ipc_pid_t  shm_lpid;   /* pid of last operator */
	unsigned short      shm_nattch; /* no. of current attaches */
	unsigned short      shm_unused; /* compatibility */
	void            *shm_unused2;   /* ditto - used by DIPC */
	void            *shm_unused3;   /* unused */
};</code></pre> 
<p>å½“æˆ‘ä»¬ç”³è¯·äº†ä¸€å—å…±äº«å†…å­˜åï¼Œä¸ºäº†è®©è¦å®ç°é€šä¿¡çš„è¿›ç¨‹èƒ½å¤Ÿçœ‹åˆ°åŒä¸€ä¸ªå…±äº«å†…å­˜ï¼Œå› æ­¤æ¯ä¸€ä¸ªå…±äº«å†…å­˜è¢«ç”³è¯·æ—¶éƒ½æœ‰ä¸€ä¸ªkeyå€¼ï¼Œè¿™ä¸ªkeyå€¼ç”¨äºæ ‡è¯†ç³»ç»Ÿä¸­å…±äº«å†…å­˜çš„å”¯ä¸€æ€§ã€‚</p> 
<p>å¯ä»¥çœ‹åˆ°ä¸Šé¢å…±äº«å†…å­˜æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯ã€ shm_permã€ï¼Œã€ shm_permã€æ˜¯ä¸€ä¸ªã€ ipc_permã€ç±»å‹çš„ç»“æ„ä½“å˜é‡ï¼Œæ¯ä¸ªå…±äº«å†…å­˜çš„ã€ keyã€å€¼å­˜å‚¨åœ¨ã€ shm_permã€è¿™ä¸ªç»“æ„ä½“å˜é‡å½“ä¸­ï¼Œå…¶ä¸­ã€ ipc_permã€ç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š</p> 
<pre><code class="language-cpp">struct ipc_perm{
	__kernel_key_t  key;
	__kernel_uid_t  uid;
	__kernel_gid_t  gid;
	__kernel_uid_t  cuid;
	__kernel_gid_t  cgid;
	__kernel_mode_t mode;
	unsigned short  seq;
};</code></pre> 
<p>è¿™ä¸ªkeyå€¼æˆ‘ä»¬æ”¾åˆ°æ¥ä¸‹æ¥çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¸­å†åšè®²è§£ã€‚</p> 
<hr> 
<h4 id="3.1.2%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E7%9A%84%E5%BB%BA%E7%AB%8B%E4%B8%8E%E9%87%8A%E6%94%BE">3.1.2å…±äº«å†…å­˜çš„å»ºç«‹ä¸é‡Šæ”¾</h4> 
<p>å…±äº«å†…å­˜çš„å»ºç«‹å¤§è‡´åŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p> 
<ol><li>åœ¨ç‰©ç†å†…å­˜å½“ä¸­ç”³è¯·å…±äº«å†…å­˜ç©ºé—´ã€‚</li><li>å°†ç”³è¯·åˆ°çš„å…±äº«å†…å­˜æŒ‚æ¥åˆ°åœ°å€ç©ºé—´ï¼Œå³å»ºç«‹æ˜ å°„å…³ç³»ã€‚</li></ol> 
<p>å…±äº«å†…å­˜çš„é‡Šæ”¾å¤§è‡´åŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªè¿‡ç¨‹ï¼š</p> 
<ol><li>å°†å…±äº«å†…å­˜ä¸åœ°å€ç©ºé—´å»å…³è”ï¼Œå³å–æ¶ˆæ˜ å°„å…³ç³»ã€‚</li><li>é‡Šæ”¾å…±äº«å†…å­˜ç©ºé—´ï¼Œå³å°†ç‰©ç†å†…å­˜å½’è¿˜ç»™ç³»ç»Ÿã€‚</li></ol> 
<p>é‚£ä¹ˆå¦‚ä½•å®Œæˆä»¥ä¸Šè¿‡ç¨‹å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°æ“ä½œçš„å¯¹è±¡éƒ½æ˜¯å†…æ ¸çº§æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥è¿™é‡Œä¸€å®šéœ€è¦OSæä¾›ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥å­¦ä¹ ä¸‹å§ï¼Â </p> 
<hr> 
<h4 id="3.1.3%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0">3.1.3ç³»ç»Ÿè°ƒç”¨å‡½æ•°</h4> 
<h5 id="%E5%88%9B%E5%BB%BA%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmget%E5%87%BD%E6%95%B0">åˆ›å»ºå…±äº«å†…å­˜â€”â€”shmgetå‡½æ•°</h5> 
<pre><code class="language-cpp">int shmget(key_t key, size_t size, int shmflg);</code></pre> 
<p>shmgetå‡½æ•°çš„å‚æ•°è¯´æ˜ï¼š</p> 
<ul><li>keyï¼Œè¡¨ç¤ºå¾…åˆ›å»ºå…±äº«å†…å­˜åœ¨ç³»ç»Ÿå½“ä¸­çš„å”¯ä¸€æ ‡è¯†ã€‚</li><li>sizeï¼Œè¡¨ç¤ºå¾…åˆ›å»ºå…±äº«å†…å­˜çš„å¤§å°ï¼Œå†…æ ¸ä¸­å…±äº«å†…å­˜çš„å¤§å°æ˜¯ä»¥4KBä¸ºåŸºæœ¬å•ä½çš„ï¼Œå»ºè®®ç”³è¯·å¤§å°æ˜¯4KBçš„æ•´æ•°å€ã€‚</li><li>shmflgï¼Œè¡¨ç¤ºåˆ›å»ºå…±äº«å†…å­˜çš„æ–¹å¼ã€‚</li></ul> 
<p>shmgetå‡½æ•°çš„è¿”å›å€¼è¯´æ˜ï¼š</p> 
<ul><li>shmgetè°ƒç”¨æˆåŠŸï¼Œè¿”å›ä¸€ä¸ªæœ‰æ•ˆçš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦ï¼ˆç”¨æˆ·å±‚æ ‡è¯†ç¬¦shmidï¼‰ã€‚</li><li>shmgetè°ƒç”¨å¤±è´¥ï¼Œè¿”å›-1ã€‚</li></ul> 
<blockquote> 
 <p style="text-align:center;"><strong>å‚æ•°keyè®²è§£</strong></p> 
 <p>keyå€¼æˆ‘ä»¬éœ€è¦é€šè¿‡ftokå‡½æ•°è·å–ï¼š</p> 
 <pre><code class="language-cpp">key_t ftok(const char *pathname, int proj_id);</code></pre> 
 <p>ftokå‡½æ•°çš„ä½œç”¨ï¼šå°†ä¸€ä¸ªå·²å­˜åœ¨çš„è·¯å¾„åpathnameå’Œä¸€ä¸ªæ•´æ•°æ ‡è¯†ç¬¦proj_idè½¬æ¢æˆä¸€ä¸ªkeyå€¼ï¼Œç§°ä¸ºIPCé”®å€¼ï¼Œåœ¨ä½¿ç”¨shmgetå‡½æ•°è·å–å…±äº«å†…å­˜æ—¶ï¼Œè¿™ä¸ªkeyå€¼ä¼šè¢«å¡«å……è¿›ç»´æŠ¤å…±äº«å†…å­˜çš„æ•°æ®ç»“æ„å½“ä¸­ã€‚</p> 
 <p></p> 
 <p>æ€è€ƒï¼šè¿™ä¸ªkeyå€¼ä¸ºä»€ä¹ˆè¦è®©ç”¨æˆ·ä¼ å…¥å‘¢ï¼Ÿ</p> 
 <p>å› ä¸ºåªè¦é€šä¿¡åŒæ–¹çº¦å®šå¥½å‚æ•°ï¼Œä¸¤ä¸ªé€šä¿¡çš„è¿›ç¨‹å°±èƒ½é€šè¿‡ftokå‡½æ•°ç”Ÿæˆç›¸åŒçš„keyï¼Œå°±ç›¸å½“äºä»–ä»¬çœ‹åˆ°äº†é‚£ä¸ªåŒä¸€ä¸ªå†…å­˜ï¼Œå°±èƒ½å»ºç«‹é€šä¿¡äº†ã€‚è€Œåè¿‡æ¥å¦‚æœè¿™ä¸ªkeyæ˜¯ç”±å†…æ ¸æ¥è®¾å®šï¼Œé‚£è¿›ç¨‹Bå¦‚ä½•çŸ¥é“è¿›ç¨‹Aåˆ›å»ºçš„å…±äº«å†…å­˜çš„keyå‘¢ï¼Œä»–ä»¬ä¹‹é—´å¯è¿˜æ²¡æœ‰å»ºç«‹é€šä¿¡å‘¢ï¼Ÿ</p> 
 <p></p> 
 <p><strong>æ³¨æ„</strong>ï¼špathnameæ‰€æŒ‡å®šçš„æ–‡ä»¶å¿…é¡»å­˜åœ¨ä¸”å¯å­˜å–ã€‚</p> 
</blockquote> 
<blockquote> 
 <p style="text-align:center;"><strong>å‚æ•°shmflgè®²è§£</strong></p> 
 <table border="1" cellpadding="1" cellspacing="1" style="width:650px;"><tbody><tr><td style="text-align:center;"><strong>ç»„åˆæ–¹å¼</strong></td><td style="text-align:center;"><strong>ä½œç”¨</strong></td></tr><tr><td style="text-align:center;">IPC_CREAT</td><td style="text-align:center;">å¦‚æœå†…æ ¸ä¸­ä¸å­˜åœ¨é”®å€¼ä¸keyç›¸ç­‰çš„å…±äº«å†…å­˜ï¼Œåˆ™æ–°å»ºä¸€ä¸ªå…±äº«å†…å­˜å¹¶è¿”å›è¯¥å…±äº«å†…å­˜çš„å¥æŸ„ï¼›å¦‚æœå­˜åœ¨è¿™æ ·çš„å…±äº«å†…å­˜ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥å…±äº«å†…å­˜çš„å¥æŸ„</td></tr><tr><td style="text-align:center;">IPC_CREAT | IPC_EXCL</td><td style="text-align:center;">å¦‚æœå†…æ ¸ä¸­ä¸å­˜åœ¨é”®å€¼ä¸keyç›¸ç­‰çš„å…±äº«å†…å­˜ï¼Œåˆ™æ–°å»ºä¸€ä¸ªå…±äº«å†…å­˜å¹¶è¿”å›è¯¥å…±äº«å†…å­˜çš„å¥æŸ„ï¼›å¦‚æœå­˜åœ¨è¿™æ ·çš„å…±äº«å†…å­˜ï¼Œåˆ™å‡ºé”™è¿”å›ï¼Œå³å¦‚æœåˆ›å»ºæˆåŠŸï¼Œåˆ™ä¸€å®šæ˜¯å…¨æ–°çš„å…±äº«å†…å­˜</td></tr><tr><td style="text-align:center;">IPC_CREAT | IPC_EXCL | æƒé™</td><td style="text-align:center;">æŒ‡å®šåˆ›å»ºçš„å…±äº«å†…å­˜æƒé™ï¼Œæ¯”å¦‚IPC_CREAT | IPC_EXCL | 0666</td></tr></tbody></table> 
</blockquote> 
<blockquote> 
 <ul><li>æ–‡ä»¶çš„ç”Ÿå‘½å‘¨æœŸéšè¿›ç¨‹ï¼›</li><li>å…±äº«å†…å­˜çš„ç”Ÿå‘½å‘¨æœŸéšå†…æ ¸ï¼›Â </li></ul> 
 <p>è¿›ç¨‹ç»“æŸï¼Œå¦‚æœæˆ‘ä»¬ä¸ä¸»åŠ¨é‡Šæ”¾å…±äº«å†…å­˜ï¼Œå®ƒä¼šä¸€ç›´å­˜åœ¨ï¼Œé™¤éç³»ç»Ÿé‡å¯ã€‚</p> 
</blockquote> 
<hr> 
<h5 id="%E6%8C%82%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmat%E5%87%BD%E6%95%B0">æŒ‚æ¥å…±äº«å†…å­˜â€”â€”shmatå‡½æ•°</h5> 
<pre><code class="language-cpp">void *shmat(int shmid, const void *shmaddr, int shmflg);</code></pre> 
<p>shmatå‡½æ•°çš„å‚æ•°è¯´æ˜ï¼š</p> 
<ul><li>shmidï¼Œè¡¨ç¤ºå¾…å…³è”å…±äº«å†…å­˜çš„ç”¨æˆ·çº§æ ‡è¯†ç¬¦ã€‚</li><li>shmaddrï¼ŒæŒ‡å®šå…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´çš„æŸä¸€åœ°å€ï¼Œé€šå¸¸è®¾ç½®ä¸ºNULLï¼Œå³è®©å†…æ ¸è‡ªå·±å†³å®šä¸€ä¸ªåˆé€‚çš„åœ°å€ä½ç½®ã€‚</li><li>shmflgï¼Œè¡¨ç¤ºå…³è”å…±äº«å†…å­˜æ—¶è®¾ç½®çš„æŸäº›å±æ€§ã€‚</li></ul> 
<p>shmatå‡½æ•°çš„è¿”å›å€¼è¯´æ˜ï¼š</p> 
<ul><li>shmatè°ƒç”¨æˆåŠŸï¼Œè¿”å›å…±äº«å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„èµ·å§‹åœ°å€ã€‚</li><li>shmatè°ƒç”¨å¤±è´¥ï¼Œè¿”å›(void*)-1ã€‚</li></ul> 
<p>å…¶ä¸­ï¼Œä½œä¸ºshmatå‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ å…¥çš„å¸¸ç”¨çš„é€‰é¡¹æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š</p> 
<table><thead><tr><th style="text-align:center;">é€‰é¡¹</th><th style="text-align:center;">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center;">SHM_RDONLY</td><td style="text-align:center;">å…³è”å…±äº«å†…å­˜ååªè¿›è¡Œè¯»å–æ“ä½œ</td></tr><tr><td style="text-align:center;">SHM_RND</td><td style="text-align:center;">è‹¥shmaddrä¸ä¸ºNULLï¼Œåˆ™å…³è”åœ°å€è‡ªåŠ¨å‘ä¸‹è°ƒæ•´ä¸ºSHMLBAçš„æ•´æ•°å€ã€‚å…¬å¼ï¼šshmaddr-(shmaddr%SHMLBA)</td></tr><tr><td style="text-align:center;">0</td><td style="text-align:center;">é»˜è®¤ä¸ºè¯»å†™æƒé™</td></tr></tbody></table> 
<hr> 
<h5 id="%E6%8B%86%E5%8D%B8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmdt%E5%87%BD%E6%95%B0">æ‹†å¸å…±äº«å†…å­˜â€”â€”shmdtå‡½æ•°</h5> 
<pre><code class="language-cpp">int shmdt(const void *shmaddr);</code></pre> 
<p>Â å–æ¶ˆå…±äº«å†…å­˜ä¸è¿›ç¨‹åœ°å€ç©ºé—´ä¹‹é—´çš„å…³è”ã€‚</p> 
<p>shmdtå‡½æ•°çš„å‚æ•°è¯´æ˜ï¼š</p> 
<ul><li>shmaddrï¼Œå¾…æ‹†å¸çš„å…±äº«å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå³è°ƒç”¨shmatå‡½æ•°æ—¶å¾—åˆ°çš„èµ·å§‹åœ°å€ã€‚</li></ul> 
<p>shmdtå‡½æ•°çš„è¿”å›å€¼è¯´æ˜ï¼š</p> 
<ul><li>shmdtè°ƒç”¨æˆåŠŸï¼Œè¿”å›0ã€‚</li><li>shmdtè°ƒç”¨å¤±è´¥ï¼Œè¿”å›-1ã€‚</li></ul> 
<hr> 
<h5 id="%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94shmctl%E5%87%BD%E6%95%B0">é‡Šæ”¾å…±äº«å†…å­˜â€”â€”shmctlå‡½æ•°</h5> 
<pre><code class="language-cpp">int shmctl(int shmid, int cmd, struct shmid_ds *buf);</code></pre> 
<p>shmctlå‡½æ•°ç”¨äºæ§åˆ¶å…±äº«å†…å­˜ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„å‚æ•°cmdçš„ä¸åŒï¼Œæ‰§è¡Œä¸åŒçš„åŠ¨ä½œã€‚Â </p> 
<p>shmctlå‡½æ•°çš„å‚æ•°è¯´æ˜ï¼š</p> 
<ul><li>shmidï¼Œè¡¨ç¤ºæ‰€æ§åˆ¶å…±äº«å†…å­˜çš„ç”¨æˆ·çº§æ ‡è¯†ç¬¦ã€‚</li><li>cmdï¼Œè¡¨ç¤ºå…·ä½“çš„æ§åˆ¶åŠ¨ä½œã€‚</li><li>bufï¼Œç”¨äºè·å–æˆ–è®¾ç½®æ‰€æ§åˆ¶å…±äº«å†…å­˜çš„æ•°æ®ç»“æ„ã€‚</li></ul> 
<p>shmctlå‡½æ•°çš„è¿”å›å€¼è¯´æ˜ï¼š</p> 
<ul><li>shmctlè°ƒç”¨æˆåŠŸï¼Œè¿”å›0ã€‚</li><li>shmctlè°ƒç”¨å¤±è´¥ï¼Œè¿”å›-1ã€‚</li></ul> 
<p>å…¶ä¸­ï¼Œä½œä¸ºshmctlå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥çš„å¸¸ç”¨çš„é€‰é¡¹æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼š</p> 
<table><thead><tr><th style="text-align:center;">é€‰é¡¹</th><th style="text-align:center;">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center;">IPC_STAT</td><td style="text-align:center;">è·å–å…±äº«å†…å­˜çš„ä¿¡æ¯ï¼Œæ­¤æ—¶å‚æ•°bufä½œä¸ºè¾“å‡ºå‹å‚æ•°</td></tr><tr><td style="text-align:center;">IPC_SET</td><td style="text-align:center;">åœ¨è¿›ç¨‹æœ‰è¶³å¤Ÿæƒé™çš„å‰æä¸‹ï¼Œå°†å½“å‰å…±äº«å†…å­˜çš„ä¿¡æ¯ï¼ˆshmid_dsç»“æ„ä½“ï¼‰è®¾ç½®ä¸ºbufæ‰€æŒ‡çš„æ•°æ®ç»“æ„ä¸­çš„ä¿¡æ¯</td></tr><tr><td style="text-align:center;">IPC_RMID</td><td style="text-align:center;">åˆ é™¤å…±äº«å†…å­˜æ®µ</td></tr></tbody></table> 
<hr> 
<h4 id="3.1.4%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98">3.1.4å‘½ä»¤è¡Œæ“ä½œå…±äº«å†…å­˜</h4> 
<h5 id="%E6%9F%A5%E7%9C%8B%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF%E2%80%94%E2%80%94ipcs%E5%91%BD%E4%BB%A4">æŸ¥çœ‹å…±äº«å†…å­˜ä¿¡æ¯â€”â€”ipcså‘½ä»¤</h5> 
<p><img alt="" height="461" src="https://images2.imgbox.com/e3/fd/MB39sclY_o.png" width="1200">Â å•ç‹¬ä½¿ç”¨ipcså‘½ä»¤æ—¶ï¼Œä¼šé»˜è®¤åˆ—å‡ºæ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ä»¥åŠä¿¡å·é‡ç›¸å…³çš„ä¿¡æ¯ï¼Œè‹¥åªæƒ³æŸ¥çœ‹å®ƒä»¬ä¹‹é—´æŸä¸€ä¸ªçš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥é€‰æ‹©æºå¸¦ä»¥ä¸‹é€‰é¡¹<strong>ï¼š</strong></p> 
<ul><li>-qï¼šåˆ—å‡ºæ¶ˆæ¯é˜Ÿåˆ—ç›¸å…³ä¿¡æ¯ã€‚</li><li>-mï¼šåˆ—å‡ºå…±äº«å†…å­˜ç›¸å…³ä¿¡æ¯ã€‚</li><li>-sï¼šåˆ—å‡ºä¿¡å·é‡ç›¸å…³ä¿¡æ¯ã€‚</li></ul> 
<p>ä¾‹å¦‚ï¼Œæºå¸¦-mé€‰é¡¹æŸ¥çœ‹å…±äº«å†…å­˜ç›¸å…³ä¿¡æ¯ï¼š</p> 
<p><img alt="" height="249" src="https://images2.imgbox.com/67/30/XPDiPIYr_o.png" width="1200"></p> 
<p>ä¿¡æ¯ä»‹ç»ï¼š</p> 
<table><thead><tr><th style="text-align:center;">æ ‡é¢˜</th><th style="text-align:center;">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center;">key</td><td style="text-align:center;">ç³»ç»ŸåŒºåˆ«å„ä¸ªå…±äº«å†…å­˜çš„å”¯ä¸€æ ‡è¯†</td></tr><tr><td style="text-align:center;">shmid</td><td style="text-align:center;">å…±äº«å†…å­˜çš„ç”¨æˆ·å±‚idï¼ˆå¥æŸ„ï¼‰</td></tr><tr><td style="text-align:center;">owner</td><td style="text-align:center;">å…±äº«å†…å­˜çš„æ‹¥æœ‰è€…</td></tr><tr><td style="text-align:center;">perms</td><td style="text-align:center;">å…±äº«å†…å­˜çš„æƒé™</td></tr><tr><td style="text-align:center;">bytes</td><td style="text-align:center;">å…±äº«å†…å­˜çš„å¤§å°</td></tr><tr><td style="text-align:center;">nattch</td><td style="text-align:center;">å…³è”å…±äº«å†…å­˜çš„è¿›ç¨‹æ•°</td></tr><tr><td style="text-align:center;">status</td><td style="text-align:center;">å…±äº«å†…å­˜çš„çŠ¶æ€</td></tr></tbody></table> 
<p><strong>æ³¨æ„ï¼š</strong>Â keyæ˜¯åœ¨å†…æ ¸å±‚é¢ä¸Šä¿è¯å…±äº«å†…å­˜å”¯ä¸€æ€§çš„æ–¹å¼ï¼Œè€Œshmidæ˜¯åœ¨ç”¨æˆ·å±‚é¢ä¸Šä¿è¯å…±äº«å†…å­˜çš„å”¯ä¸€æ€§ï¼Œåœ¨ç³»ç»Ÿè°ƒç”¨ä¸­ä½ ä¼šå‘ç°åŸºæœ¬ä¸Šä½¿ç”¨çš„éƒ½æ˜¯shmidä½œä¸ºå‚æ•°ã€‚</p> 
<h5 id="%E9%87%8A%E6%94%BE%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E2%80%94%E2%80%94ipcrm%20-m%20shmid%E5%91%BD%E4%BB%A4">é‡Šæ”¾å…±äº«å†…å­˜â€”â€”ipcrm -m shmidå‘½ä»¤</h5> 
<p><strong>æ³¨æ„</strong>ï¼šè¿™é‡Œå‘½ä»¤è¡Œå‚æ•°æ˜¯shmidï¼Œä¸æ˜¯keyã€‚</p> 
<p>æ¯”å¦‚ï¼š</p> 
<p><img alt="" height="458" src="https://images2.imgbox.com/a5/ae/bS5z3idp_o.png" width="1200"></p> 
<hr> 
<h4 id="3.1.5%E7%94%A8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E5%AE%9E%E7%8E%B0server%26client%E9%80%9A%E4%BF%A1">3.1.5ç”¨å…±äº«å†…å­˜å®ç°server&amp;clienté€šä¿¡</h4> 
<p>è¯¥ç¨‹åºé‡ç‚¹åœ¨äºå­¦ä¹ ä½¿ç”¨å…±äº«å†…å­˜çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œå¹¶ä¸”ç”±äºå…±äº«å†…å­˜ä¸æä¾›è¿›ç¨‹é—´çš„ååŒæœºåˆ¶ï¼Œæ‰€ä»¥ååŒå·¥ä½œéœ€è¦ç”¨æˆ·æä¾›ï¼Œä¸€èˆ¬ä½¿ç”¨ã€ ä¿¡å·é‡ã€è§£å†³ï¼Œä½†ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å­¦ä¹ ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ã€ ç®¡é“ã€è§£å†³ã€‚</p> 
<h5>æºç </h5> 
<p><strong>Comm.hpp</strong></p> 
<pre><code class="language-cpp">#pragma once

#include &lt;iostream&gt;
#include &lt;cerrno&gt;
#include &lt;cstring&gt;
#include &lt;cstdlib&gt;
#include &lt;string&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
#include &lt;sys/types.h&gt;

using namespace std;

const char *pathname = "/home/ff/linux/test_24_04_14 ";
const int proj_id = 0x66;

// åœ¨å†…æ ¸ä¸­ï¼Œå…±äº«å†…å­˜çš„å¤§å°æ˜¯ä»¥4KBä¸ºåŸºæœ¬å•ä½çš„. ä½ åªèƒ½ç”¨ä½ ç”³è¯·çš„å¤§å°ã€‚å»ºè®®ç”³è¯·å¤§å°æ˜¯n*4KB
const int defaultsize = 4096; // å•ä½æ˜¯å­—èŠ‚

// è½¬åŒ–æˆ16è¿›åˆ¶æ•°
std::string ToHex(key_t k)
{
  char buffer[1024];
  snprintf(buffer, sizeof(buffer), "0x%x", k);
  return buffer;
}

// è®¡ç®—keyå€¼
key_t GetShmKeyOrDie()
{
  key_t k = ftok(pathname, proj_id);
  if (k &lt; 0)
  {
    std::cerr &lt;&lt; "ftok error, errno : " &lt;&lt; errno &lt;&lt; ", error string: " &lt;&lt; strerror(errno) &lt;&lt; std::endl;
    exit(1);
  }
  return k;
}

// åˆ›å»ºå…±äº«å†…å­˜
int CreateShmOrDie(key_t key, int size, int flag)
{
  int shmid = shmget(key, size, flag);
  if (shmid &lt; 0)
  {
    std::cerr &lt;&lt; "shmget error, errno : " &lt;&lt; errno &lt;&lt; ", error string: " &lt;&lt; strerror(errno) &lt;&lt; std::endl;
    exit(2);
  }
  return shmid;
}

// å°è£…
int CreateShm(key_t key, int size)
{
  // IPC_CREAT: ä¸å­˜åœ¨å°±åˆ›å»ºï¼Œå­˜åœ¨å°±è·å–
  // IPC_EXCL: æ²¡æœ‰æ„ä¹‰
  // IPC_CREAT | IPC_EXCL: ä¸å­˜åœ¨å°±åˆ›å»ºï¼Œå­˜åœ¨å°±å‡ºé”™è¿”å›
  return CreateShmOrDie(key, size, IPC_CREAT | IPC_EXCL | 0666);
}

// å°è£…
int GetShm(key_t key, int size)
{
  return CreateShmOrDie(key, size, IPC_CREAT);
}

// é‡Šæ”¾å…±äº«å†…å­˜
void DeleteShm(int shmid)
{
  int n = shmctl(shmid, IPC_RMID, nullptr);
  if (n &lt; 0)
  {
    std::cerr &lt;&lt; "shmctl error" &lt;&lt; std::endl;
  }
  else
  {
    std::cout &lt;&lt; "shmctl delete shm success, shmid: " &lt;&lt; shmid &lt;&lt; std::endl;
  }
}

// æ‰“å°å…±äº«å†…å­˜ä¿¡æ¯
void ShmDebug(int shmid)
{
  struct shmid_ds shmds;
  int n = shmctl(shmid, IPC_STAT, &amp;shmds);
  if (n &lt; 0)
  {
    std::cerr &lt;&lt; "shmctl error" &lt;&lt; std::endl;
    return;
  }
  std::cout &lt;&lt; "shmds.shm_segsz: " &lt;&lt; shmds.shm_segsz &lt;&lt; std::endl;
  std::cout &lt;&lt; "shmds.shm_nattch:" &lt;&lt; shmds.shm_nattch &lt;&lt; std::endl;
  std::cout &lt;&lt; "shmds.shm_ctime:" &lt;&lt; shmds.shm_ctime &lt;&lt; std::endl;
  std::cout &lt;&lt; "shmds.shm_perm.__key:" &lt;&lt; ToHex(shmds.shm_perm.__key) &lt;&lt; std::endl;
}

// æŒ‚æ¥å…±äº«å†…å­˜
void *ShmAttach(int shmid)
{
  void *addr = shmat(shmid, nullptr, 0);
  if ((long long int)addr == -1)
  {
    std::cerr &lt;&lt; "shmat error" &lt;&lt; std::endl;
    return nullptr;
  }
  return addr;
}

// æ‹†å¸å…±äº«å†…å­˜
void ShmDetach(void *addr)
{
  int n = shmdt(addr);
  if (n &lt; 0)
  {
    std::cerr &lt;&lt; "shmdt error" &lt;&lt; std::endl;
  }
}</code></pre> 
<p><strong>æœåŠ¡ç«¯</strong></p> 
<pre><code class="language-cpp">#include "Comm.hpp"
#include "Fifo.hpp"
#include &lt;unistd.h&gt;

int main()
{
  // 1. è·å–key
  key_t key = GetShmKeyOrDie();
  std::cout &lt;&lt; "key: " &lt;&lt; ToHex(key) &lt;&lt; std::endl;
  // sleep(2);

  // 2. åˆ›å»ºå…±äº«å†…å­˜
  int shmid = CreateShm(key, defaultsize);
  std::cout &lt;&lt; "shmid: " &lt;&lt; shmid &lt;&lt; std::endl;
  // sleep(2);

  // ShmDebug(shmid);
  // 4. å°†å…±äº«å†…å­˜å’Œè¿›ç¨‹è¿›è¡ŒæŒ‚æ¥(å…³è”)
  char *addr = (char *)ShmAttach(shmid);
  std::cout &lt;&lt; "Attach shm success, addr: " &lt;&lt; ToHex((uint64_t)addr) &lt;&lt; std::endl;

  // 0. åˆ©ç”¨ç®¡é“å®ç°è¿›ç¨‹é—´ååŒæœºåˆ¶
  Fifo fifo;
  Sync syn;
  syn.OpenReadOrDie();

  // å¯ä»¥è¿›è¡Œé€šä¿¡äº†
  for (;;)
  {
    // Waitè¿”å›å€¼ï¼š
    // çœŸï¼šç®¡é“è¯»ç«¯è¯»å–åˆ°æ•°æ®ï¼Œè¯æ˜æ­¤æ—¶æœ‰è¿›ç¨‹å‘ä½ å‘æ•°æ®äº†
    // å‡ï¼šç®¡é“è¯»ç«¯è¯»åˆ°æœ«å°¾æˆ–è€…è¯»å–å¤±è´¥
    if (!syn.Wait())
      break;
    cout &lt;&lt; "shm content: " &lt;&lt; addr &lt;&lt; std::endl;
  }

  // æ‹†å¸å…±äº«å†…å­˜ï¼Œè§£é™¤å…³è”
  ShmDetach(addr);
  std::cout &lt;&lt; "Detach shm success, addr: " &lt;&lt; ToHex((uint64_t)addr) &lt;&lt; std::endl;

  // 3. é‡Šæ”¾å…±äº«å†…å­˜
  DeleteShm(shmid);
  return 0;
}</code></pre> 
<p><strong>å®¢æˆ·ç«¯Â </strong></p> 
<pre><code class="language-cpp">#include "Comm.hpp"
#include "Fifo.hpp"
#include &lt;unistd.h&gt;

int main()
{
  key_t key = GetShmKeyOrDie();
  std::cout &lt;&lt; "key: " &lt;&lt; ToHex(key) &lt;&lt; std::endl;
  // sleep(2);

  int shmid = GetShm(key, defaultsize);
  std::cout &lt;&lt; "shmid: " &lt;&lt; shmid &lt;&lt; std::endl;
  // sleep(2);

  char *addr = (char *)ShmAttach(shmid);
  std::cout &lt;&lt; "Attach shm success, addr: " &lt;&lt; ToHex((uint64_t)addr) &lt;&lt; std::endl;
  // sleep(5);

  // åˆå§‹åŒ–å…±äº«å†…å­˜æ•°æ®
  memset(addr, 0, defaultsize);
  Sync syn;
  syn.OpenWriteOrDie();

  // å¯ä»¥è¿›è¡Œé€šä¿¡äº†
  for (char c = 'A'; c &lt;= 'Z'; c++) // pipe, fifo, -&gt;read/write-&gt;ç³»ç»Ÿè°ƒç”¨ï¼Œ shm -&gt; æ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ï¼
  {
    addr[c - 'A'] = c;
    sleep(1);

    // å‘ç®¡é“å†™æ•°æ®ï¼Œå”¤é†’è¯»ç«¯å¯ä»¥è¯»äº†
    syn.Wakeup();
  }

  // æ‹†å¸å…±äº«å†…å­˜
  ShmDetach(addr);
  std::cout &lt;&lt; "Detach shm success, addr: " &lt;&lt; ToHex((uint64_t)addr) &lt;&lt; std::endl;
  sleep(5);

  return 0;
}</code></pre> 
<p><strong>ç®¡é“æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶Â </strong></p> 
<pre><code class="language-cpp">#ifndef __COMM_HPP__
#define __COMM_HPP__

#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;cerrno&gt;
#include &lt;cstring&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;cassert&gt;

using namespace std;

#define Mode 0666
#define Path "./fifo"

class Fifo
{
public:
  Fifo(const string &amp;path = Path) : _path(path)
  {
    umask(0);
    int n = mkfifo(_path.c_str(), Mode);
    if (n == 0)
    {
      cout &lt;&lt; "mkfifo success" &lt;&lt; endl;
    }
    else
    {
      cerr &lt;&lt; "mkfifo failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
    }
  }
  ~Fifo()
  {
    int n = unlink(_path.c_str());
    if (n == 0)
    {
      cout &lt;&lt; "remove fifo file " &lt;&lt; _path &lt;&lt; " success" &lt;&lt; endl;
    }
    else
    {
      cerr &lt;&lt; "remove failed, errno: " &lt;&lt; errno &lt;&lt; ", errstring: " &lt;&lt; strerror(errno) &lt;&lt; endl;
    }
  }

private:
  string _path; // æ–‡ä»¶è·¯å¾„+æ–‡ä»¶å
};

// åˆ©ç”¨ç®¡é“æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶
class Sync
{
public:
  Sync() : rfd(-1), wfd(-1)
  {
  }
  void OpenReadOrDie()
  {
    rfd = open(Path, O_RDONLY);
    if (rfd &lt; 0)
      exit(1);
  }
  void OpenWriteOrDie()
  {
    wfd = open(Path, O_WRONLY);
    if (wfd &lt; 0)
      exit(1);
  }

  // å®ç°è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼ŒæœåŠ¡ç«¯ç”¨
  bool Wait()
  {
    bool ret = true;
    uint32_t c = 0;
    ssize_t n = read(rfd, &amp;c, sizeof(uint32_t));
    if (n == sizeof(uint32_t))
    {
      std::cout &lt;&lt; "server wakeup, begin read shm..." &lt;&lt; std::endl;
    }
    else if (n == 0)
    {
      ret = false;
    }
    else
    {
      return false;
    }
    return ret;
  }

  // å®ç°è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼Œå®¢æˆ·ç«¯ç”¨
  void Wakeup()
  {
    uint32_t c = 0;
    ssize_t n = write(wfd, &amp;c, sizeof(c));
    assert(n == sizeof(uint32_t));

    std::cout &lt;&lt; "wakeup server..." &lt;&lt; std::endl;
  }
  ~Sync() {}

private:
  int rfd;
  int wfd;
};

#endif</code></pre> 
<hr> 
<h5 id="%C2%A0%E7%AE%A1%E9%81%93%E6%8F%90%E4%BE%9B%E8%BF%9B%E7%A8%8B%E9%97%B4%E5%8D%8F%E5%90%8C%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%B2%E8%A7%A3">Â ç®¡é“æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶çš„è®²è§£</h5> 
<p>ä»€ä¹ˆæ˜¯è¿›ç¨‹é—´ååŒæœºåˆ¶å‘¢ï¼Ÿ</p> 
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡ç®¡é“çš„4ç§ç‰¹æ®Šæƒ…å†µï¼Œæ¯”å¦‚ï¼š</p> 
<p>å†™ç«¯è¿›ç¨‹ä¸å†™ï¼Œå¹¶ä¸”ç®¡é“å†…éƒ¨æ— æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶å¯¹åº”çš„è¯»ç«¯è¿›ç¨‹å°±ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç®¡é“é‡Œé¢æœ‰æ•°æ®ã€‚</p> 
<p>ä½ ä¼šå‘ç°ç®¡é“é€šä¿¡æ˜¯å¯ä»¥è®©é€šä¿¡åŒæ–¹è¿›ç¨‹ååŒé…åˆçš„ï¼ŒæŸä¸€æ–¹è¿›ç¨‹ä¼šæ ¹æ®å¦ä¸€æ–¹è¿›ç¨‹çš„çŠ¶æ€åšå‡ºååº”ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„ã€ ååŒã€ã€‚</p> 
<p>ä½†æ˜¯å…±äº«å†…å­˜å¹¶ä¸æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼Œå¦‚æœä½ ä¸æä¾›ååŒæœºåˆ¶çš„è¯ï¼Œå°±ä¼šå‡ºç°ä¸ç®¡å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘æ²¡å‘æ•°æ®ï¼ŒæœåŠ¡ç«¯éƒ½ä¸€ç›´æ¥æ”¶çš„æƒ…å†µï¼š</p> 
<p><img alt="" height="311" src="https://images2.imgbox.com/eb/c7/IFTSBLsF_o.png" width="1080"></p> 
<blockquote> 
 <p>ç®¡é“é€šä¿¡æ”¯æŒè¿›ç¨‹é—´ååŒæœºåˆ¶æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸å®ç°çš„ï¼Œå…±äº«å†…å­˜å¹¶ä¸æ”¯æŒååŒæœºåˆ¶ï¼Œå¦‚æœéœ€è¦ï¼Œç”¨æˆ·çº§å®ç°å³å¯ã€‚</p> 
</blockquote> 
<p>å®ç°ååŒæœºåˆ¶ä¸€èˆ¬éƒ½é‡‡ç”¨ä¿¡å·é‡æ¥è§£å†³ï¼Œä½†ç”±äºæˆ‘ä»¬è¿˜æ²¡æœ‰å­¦ä¹ ä¿¡å·é‡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç®¡é“æ¥å®ç°ã€‚</p> 
<p>å…¶å®åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯è¿›ç¨‹åœ¨åˆ©ç”¨å…±äº«å†…å­˜é€šä¿¡ä¹‹å‰ï¼Œåˆ©ç”¨ç®¡é“çš„ååŒæœºåˆ¶è¿›è¡Œé˜»å¡å³å¯ã€‚</p> 
<pre><code class="language-cpp">// å®ç°è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼ŒæœåŠ¡ç«¯ç”¨
bool Wait()
{
  bool ret = true;
  uint32_t c = 0;
  ssize_t n = read(rfd, &amp;c, sizeof(uint32_t));
  if (n == sizeof(uint32_t))
  {
    std::cout &lt;&lt; "server wakeup, begin read shm..." &lt;&lt; std::endl;
  }
  else if (n == 0)
  {
    ret = false;
  }
  else
  {
    return false;
  }
  return ret;
}

// å®ç°è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼Œå®¢æˆ·ç«¯ç”¨
void Wakeup()
{
  uint32_t c = 0;
  ssize_t n = write(wfd, &amp;c, sizeof(c));
  assert(n == sizeof(uint32_t));

  std::cout &lt;&lt; "wakeup server..." &lt;&lt; std::endl;
}</code></pre> 
<p>ä»¥ä¸Šæ˜¯å¾ˆç®€å•çš„å¯¹ç®¡é“æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼Œrfdä»£è¡¨ç®¡é“çš„è¯»ç«¯ï¼Œwfdä»£è¡¨ç®¡é“çš„å†™ç«¯ï¼ŒWait()å®ç°çš„å°±æ˜¯ä»ç®¡é“ä¸­è¯»å–æ•°æ®åˆ°cï¼ŒWakeup()å®ç°çš„å°±æ˜¯å‘ç®¡é“ä¸­å†™å…¥æ•°æ®ï¼Œç»è¿‡å‰é¢ç®¡é“é€šä¿¡çš„å­¦ä¹ æˆ‘ä»¬çŸ¥é“åªæœ‰å½“å†™ç«¯å‘è¯»ç«¯å†™æ•°æ®æ—¶ï¼Œè¯»ç«¯æ‰è¯»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†å‘ç®¡é“å†™çš„æ“ä½œï¼ˆWakeup()ï¼‰æ”¾åˆ°å®¢æˆ·ç«¯æ¯æ¬¡å‘å…±äº«å†…å­˜å†™å…¥æ•°æ®ä¹‹åï¼Œå³ï¼š</p> 
<pre><code class="language-cpp">// å®¢æˆ·ç«¯
for (char c = 'A'; c &lt;= 'Z'; c++) // pipe, fifo, -&gt;read/write-&gt;ç³»ç»Ÿè°ƒç”¨ï¼Œ shm -&gt; æ²¡æœ‰ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼ï¼
{
  addr[c - 'A'] = c;
  sleep(1);

  // å‘ç®¡é“å†™æ•°æ®ï¼Œå”¤é†’è¯»ç«¯å¯ä»¥è¯»äº†
  syn.Wakeup();
}</code></pre> 
<p>åœ¨Wakeup()è°ƒç”¨ä¹‹å‰ç”±äºç®¡é“çš„è¯»ç«¯æ²¡æœ‰æ£€æµ‹åˆ°å†™ç«¯å†™æ•°æ®ï¼Œæ‰€ä»¥è¯»ç«¯ä¼šé˜»å¡ç­‰å¾…å†™ç«¯å†™ï¼Œå³ï¼š</p> 
<pre><code class="language-cpp">// æœåŠ¡ç«¯
for (;;)
{
  // Waitè¿”å›å€¼ï¼š
  // çœŸï¼šç®¡é“è¯»ç«¯è¯»å–åˆ°æ•°æ®ï¼Œè¯æ˜æ­¤æ—¶æœ‰è¿›ç¨‹å‘ä½ å‘æ•°æ®äº†
  // å‡ï¼šç®¡é“è¯»ç«¯è¯»åˆ°æœ«å°¾æˆ–è€…è¯»å–å¤±è´¥
  if (!syn.Wait())
    break;
  cout &lt;&lt; "shm content: " &lt;&lt; addr &lt;&lt; std::endl;
}</code></pre> 
<p>æ‰€ä»¥è¿™æ ·å°±å®ç°äº†è¿›ç¨‹é—´çš„ååŒæœºåˆ¶ã€‚</p> 
<hr> 
<h4 id="3.1.6system%20V%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F%E4%B8%8E%E7%AE%A1%E9%81%93%E9%80%9A%E4%BF%A1%E7%9A%84%E5%AF%B9%E6%AF%94">3.1.6system Vå…±äº«å†…å­˜é€šä¿¡æ–¹å¼ä¸ç®¡é“é€šä¿¡çš„å¯¹æ¯”</h4> 
<p>å…±äº«å†…å­˜æ˜¯æ‰€æœ‰è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ä¸­<strong>æœ€å¿«</strong>çš„ä¸€ç§é€šä¿¡æ–¹å¼ã€‚</p> 
<p>ç”±å…±äº«å†…å­˜çš„åŸç†æˆ‘ä»¬çŸ¥é“ï¼Œè¿™æ ·çš„é€šä¿¡æ–¹å¼ï¼Œå› ä¸ºæœ‰é¡µè¡¨æ˜ å°„çš„å­˜åœ¨ï¼Œæå–å…±äº«å†…å­˜ä¸­çš„æ•°æ®å¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´éƒ½ç›¸å½“äºåœ¨è‡ªå·±çš„åœ°å€ç©ºé—´ä¸­å–æ•°æ®ï¼Œè€Œä¸”é€šä¿¡è¿‡ç¨‹ä¸éœ€è¦åƒç®¡é“ä¸€æ ·æ¯æ¬¡é€šä¿¡éƒ½éœ€è¦è°ƒç”¨ç³»ç»Ÿè°ƒç”¨æ¥å£readã€writeã€‚</p> 
<p>ä½†æ˜¯å…±äº«å†…å­˜å¹¶ä¸æä¾›è¿›ç¨‹é—´ååŒæœºåˆ¶ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ç®¡é“æ˜¯è‡ªå¸¦åŒæ­¥ä¸äº’æ–¥æœºåˆ¶çš„ï¼Œæ‰€ä»¥è¿™ä¹Ÿç®—æ˜¯å…±äº«å†…å­˜çš„ä¸€ä¸ªç¼ºç‚¹ã€‚</p> 
<hr> 
<h3 id="3.2system%20V%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97">3.2system Væ¶ˆæ¯é˜Ÿåˆ—</h3> 
<p>æ¶ˆæ¯é˜Ÿåˆ—å®é™…ä¸Šåœ¨å½“å‰å·²ç»è¢«æ·˜æ±°äº†ï¼Œæˆ–è€…è¯´system Vçš„é€šä¿¡æ–¹æ¡ˆéƒ½å·²ç»è½ä¼äº†ï¼Œç°åœ¨å¤§éƒ¨åˆ†éƒ½æ˜¯ç½‘ç»œé€šä¿¡ï¼Œæ‰€ä»¥è¿™é‡Œæ¶ˆæ¯é˜Ÿåˆ—æˆ‘å¹¶ä¸æ‰“ç®—ç»†è®²äº†ã€‚</p> 
<p>æ¶ˆæ¯é˜Ÿåˆ—å®é™…ä¸Šå°±æ˜¯åœ¨ç³»ç»Ÿå†…æ ¸å½“ä¸­åˆ›å»ºäº†ä¸€ä¸ªé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—å½“ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªæ•°æ®å—ï¼Œè¿™äº›æ•°æ®å—éƒ½ç”±ç±»å‹å’Œä¿¡æ¯ä¸¤éƒ¨åˆ†æ„æˆï¼Œä¸¤ä¸ªäº’ç›¸é€šä¿¡çš„è¿›ç¨‹é€šè¿‡æŸç§æ–¹å¼çœ‹åˆ°åŒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹å‘å¯¹æ–¹å‘æ•°æ®æ—¶ï¼Œéƒ½åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„é˜Ÿå°¾æ·»åŠ æ•°æ®å—ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹è·å–æ•°æ®å—æ—¶ï¼Œéƒ½åœ¨æ¶ˆæ¯é˜Ÿåˆ—çš„é˜Ÿå¤´å–æ•°æ®å—ã€‚</p> 
<p>å…¶ä¸­æ¶ˆæ¯é˜Ÿåˆ—å½“ä¸­çš„æŸä¸€ä¸ªæ•°æ®å—æ˜¯ç”±è°å‘é€ç»™è°çš„ï¼Œå–å†³äºæ•°æ®å—çš„ç±»å‹ã€‚</p> 
<p>æ¶ˆæ¯é˜Ÿåˆ—çš„ç”¨æˆ·çº§æ•°æ®ç»“æ„ä¸å…±äº«å†…å­˜çš„å†…æ ¸çº§æ•°æ®ç»“æ„éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸”ç³»ç»Ÿè°ƒç”¨æ¥å£ä¸å…±äº«å†…å­˜ä¹Ÿååˆ†ç›¸ä¼¼ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p> 
<hr> 
<h3 id="3.3system%20V%E4%BF%A1%E5%8F%B7%E9%87%8F">3.3system Vä¿¡å·é‡</h3> 
<p>è¿™é‡Œæˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹åŒæ­¥ä¸äº’æ–¥ã€‚</p> 
<blockquote> 
 <p>äº’æ–¥ï¼šç«äº‰ä¸´ç•Œèµ„æºæ—¶ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨è¯¥ä¸´ç•Œèµ„æºã€‚</p> 
 <p>åŒæ­¥ï¼šåœ¨ä¿è¯äº’æ–¥çš„å‰æä¸‹ï¼Œæœ‰é¡ºåºåœ°æŒæœ‰ä¸´ç•Œèµ„æºï¼Œé¿å…è¿›ç¨‹é¥¥é¥¿ã€‚</p> 
</blockquote> 
<p>ä¿¡å·é‡æˆ‘ä»¬ä¸»è¦æ”¾åœ¨çº¿ç¨‹éƒ¨åˆ†å†ä¸å¤§å®¶æ¢è®¨ï¼Œè¿™é‡Œç›´æ¥è·³è¿‡ã€‚</p> 
<hr> 
<p style="text-align:center;"><span style="color:#0d0016;"><strong>=========================================================================</strong></span></p> 
<p style="text-align:center;"><span style="color:#956fe7;"><strong>å¦‚æœä½ å¯¹è¯¥ç³»åˆ—æ–‡ç« æœ‰å…´è¶£çš„è¯ï¼Œæ¬¢è¿æŒç»­å…³æ³¨åšä¸»åŠ¨æ€ï¼Œåšä¸»ä¼šæŒç»­è¾“å‡ºä¼˜è´¨å†…å®¹</strong></span></p> 
<p style="text-align:center;"><span style="color:#0d0016;"><strong>ğŸåšä¸»å¾ˆéœ€è¦å¤§å®¶çš„æ”¯æŒï¼Œä½ çš„æ”¯æŒæ˜¯æˆ‘åˆ›ä½œçš„ä¸ç«­åŠ¨åŠ›ğŸ</strong></span></p> 
<p style="text-align:center;"><span style="color:#0d0016;"><strong>ğŸŒŸ</strong></span><span style="color:#79c6cd;"><strong>~ ç‚¹èµæ”¶è—ï¼‹å…³æ³¨ ~</strong></span><span style="color:#0d0016;"><strong>ğŸŒŸ</strong></span></p> 
<p style="text-align:center;"><span style="color:#0d0016;"><strong>=========================================================================</strong></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/827fa90b59aacf479fa8095dcb94c85a/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">7ä¸ªVS Codeå¤§æ¨¡å‹AIæ’ä»¶ï¼Œç¼–ç¨‹å¦‚è™æ·»ç¿¼</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2af1a80a1ce6ace19d1b53cca4a443f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ä¸€å¯¹ä¸€WebRTCè§†é¢‘é€šè¯ç³»åˆ—ï¼ˆå››ï¼‰â€”â€”offerã€answerã€candidateä¿¡ä»¤å®ç°</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>