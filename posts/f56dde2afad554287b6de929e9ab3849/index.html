<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习-下采样（全网最详解） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f56dde2afad554287b6de929e9ab3849/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="机器学习-下采样（全网最详解）">
  <meta property="og:description" content="文章目录 相关介绍逻辑回归不平衡数据集下采样逻辑回归与下采样结合 下采样运用1.导入相关包2.数据预处理3.数据下采样与合并4.绘制下采样图像5. 划分数据集6. 模型训练与评估7. 阈值调整与性能评估 总结1.下采样的优点2.下采样的缺点 相关介绍 逻辑回归 逻辑回归是一种预测分类结果的线性模型。它使用逻辑函数（通常是Sigmoid函数）来将线性模型的输出转换为概率。逻辑回归的目标是最小化预测概率和实际标签之间的误差，这通常通过梯度下降等优化算法实现。
不平衡数据集 在许多实际应用中，数据集往往是不平衡的，即某些类别的样本数量远多于其他类别。这种不平衡可能导致模型偏向于多数类，从而影响少数类的预测性能。
下采样 下采样是一种处理不平衡数据集的方法，通过减少多数类的样本来平衡数据集。在下采样过程中，可以从多数类中随机选择样本进行删除，直到多数类和少数类的样本数量达到一个相对平衡的状态。
逻辑回归与下采样结合 将逻辑回归与下采样结合使用，可以处理不平衡数据集上的二分类问题。具体步骤如下：
下采样：从多数类中随机选择样本进行删除，以减少多数类的样本数量，使数据集更加平衡。逻辑回归模型训练：使用下采样后的平衡数据集训练逻辑回归模型。模型评估：使用适当的评估指标（如准确率、召回率、F1分数等）评估模型的性能。 下采样运用 1.导入相关包 import matplotlib.pylab as plt import numpy as np import pandas as pd from pylab import mpl def cm_plot(y, yp): from sklearn.metrics import confusion_matrix import matplotlib.pyplot as plt cm = confusion_matrix(y, yp) plt.matshow(cm, cmap=plt.cm.Blues) plt.colorbar() for x in range(len(cm)): for y in range(len(cm)): plt.annotate(cm[x, y], xy=(y, x), horizontalalignment=&#39;center&#39;, verticalalignment=&#39;center&#39;) plt.ylabel(&#39;True label&#39;) plt.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-20T20:55:16+08:00">
    <meta property="article:modified_time" content="2024-08-20T20:55:16+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习-下采样（全网最详解）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">相关介绍</a></li><li><ul><li><a href="#_2" rel="nofollow">逻辑回归</a></li><li><a href="#_5" rel="nofollow">不平衡数据集</a></li><li><a href="#_7" rel="nofollow">下采样</a></li><li><a href="#_9" rel="nofollow">逻辑回归与下采样结合</a></li></ul> 
  </li><li><a href="#_15" rel="nofollow">下采样运用</a></li><li><ul><li><a href="#1_16" rel="nofollow">1.导入相关包</a></li><li><a href="#2_43" rel="nofollow">2.数据预处理</a></li><li><a href="#3_76" rel="nofollow">3.数据下采样与合并</a></li><li><a href="#4_92" rel="nofollow">4.绘制下采样图像</a></li><li><a href="#5__108" rel="nofollow">5. 划分数据集</a></li><li><a href="#6__120" rel="nofollow">6. 模型训练与评估</a></li><li><a href="#7__167" rel="nofollow">7. 阈值调整与性能评估</a></li></ul> 
  </li><li><a href="#_191" rel="nofollow">总结</a></li><li><ul><li><a href="#1_192" rel="nofollow">1.下采样的优点</a></li><li><a href="#2_200" rel="nofollow">2.下采样的缺点</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>相关介绍</h2> 
<h3><a id="_2"></a>逻辑回归</h3> 
<p>逻辑回归是一种预测分类结果的线性模型。它使用逻辑函数（通常是Sigmoid函数）来将线性模型的输出转换为概率。逻辑回归的目标是最小化预测概率和实际标签之间的误差，这通常通过梯度下降等优化算法实现。</p> 
<h3><a id="_5"></a>不平衡数据集</h3> 
<p>在许多实际应用中，数据集往往是不平衡的，即某些类别的样本数量远多于其他类别。这种不平衡可能导致模型偏向于多数类，从而影响少数类的预测性能。</p> 
<h3><a id="_7"></a>下采样</h3> 
<p>下采样是一种处理不平衡数据集的方法，通过减少多数类的样本来平衡数据集。在下采样过程中，可以从多数类中随机选择样本进行删除，直到多数类和少数类的样本数量达到一个相对平衡的状态。</p> 
<h3><a id="_9"></a>逻辑回归与下采样结合</h3> 
<p>将逻辑回归与下采样结合使用，可以处理不平衡数据集上的二分类问题。具体步骤如下：</p> 
<ul><li>下采样：从多数类中随机选择样本进行删除，以减少多数类的样本数量，使数据集更加平衡。</li><li>逻辑回归模型训练：使用下采样后的平衡数据集训练逻辑回归模型。</li><li>模型评估：使用适当的评估指标（如准确率、召回率、F1分数等）评估模型的性能。</li></ul> 
<h2><a id="_15"></a>下采样运用</h2> 
<h3><a id="1_16"></a>1.导入相关包</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pylab <span class="token keyword">as</span> plt
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> pylab <span class="token keyword">import</span> mpl


<span class="token keyword">def</span> <span class="token function">cm_plot</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> yp<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix
    <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

    cm <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y<span class="token punctuation">,</span> yp<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>matshow<span class="token punctuation">(</span>cm<span class="token punctuation">,</span> cmap<span class="token operator">=</span>plt<span class="token punctuation">.</span>cm<span class="token punctuation">.</span>Blues<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>cm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>cm<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> xy<span class="token operator">=</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> horizontalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span> verticalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'True label'</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Predicted label'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> plt

</code></pre> 
<p>导入相关的包，并绘制混淆矩阵，其中对应包的作用如下：</p> 
<ul><li>pandas：用于数据处理和分析。</li><li>matplotlib.pyplot：用于绘制图形，这里主要用于绘制散点图来直观展示“广告投入”与“销售额”之间的关系。</li><li>numpy：提供了高性能的多维数组对象以及这些数组的操作。</li></ul> 
<h3><a id="2_43"></a>2.数据预处理</h3> 
<ul><li>读取数据：使用pandas库读取creditcard.csv文件。</li><li>查看数据：通过data.head()查看数据的前5行。</li><li>数据标准化：使用StandardScaler对Amount列进行标准化处理，使其符合正态分布。</li><li>删除无用列：删除Time列，因为它对欺诈检测不是很有用。</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""第一步，数据预处理"""</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">r"./creditcard.csv"</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 默认打印前5行</span>

<span class="token triple-quoted-string string">"""绘制图像，查看正负样本个数"""</span>
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Microsoft YaHei'</span><span class="token punctuation">]</span>
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>

lables_count <span class="token operator">=</span> pd<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"正负样本数"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"类别"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"频数"</span><span class="token punctuation">)</span>
lables_count<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""数据标准化，查看正负样本个数"""</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> StandardScaler

scaler <span class="token operator">=</span> StandardScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Amount'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
data<span class="token punctuation">[</span><span class="token string">'Amount'</span><span class="token punctuation">]</span> <span class="token operator">=</span> scaler<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Amount'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Time'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/35/TkEc2UJ4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_76"></a>3.数据下采样与合并</h3> 
<ul><li>下采样：由于数据集中正常交易（类别0）和欺诈交易（类别1）的数量极不均衡，因此使用下采样技术来平衡数据集。</li><li>合并数据集：将下采样后的正常交易数据和欺诈交易数据合并成一个新的数据集data_c。</li></ul> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""下采样解决样本不均衡问题"""</span>
positive_eg <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">]</span>
negative_eg <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">]</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>seed<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
positive_eg <span class="token operator">=</span> positive_eg<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>negative_eg<span class="token punctuation">)</span><span class="token punctuation">)</span>

data_c <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>positive_eg<span class="token punctuation">,</span> negative_eg<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data_c<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/77/86/l5YnpuBy_o.png" alt="合并数据集data_c"></p> 
<h3><a id="4_92"></a>4.绘制下采样图像</h3> 
<p>绘制图像：再次绘制正负样本数的条形图，以验证下采样的效果</p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""绘制图像，查看正负样本个数"""</span>
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Microsoft YaHei'</span><span class="token punctuation">]</span>
mpl<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>

lables_count <span class="token operator">=</span> pd<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>data_c<span class="token punctuation">[</span><span class="token string">'Class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"正负样本数"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"类别"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"频数"</span><span class="token punctuation">)</span>
lables_count<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ef/f3/YaTC41FM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5__108"></a>5. 划分数据集</h3> 
<p>划分数据集：使用train_test_split函数将数据集划分为训练集和测试集，以及一个更小的训练集（X_train_w, y_train_w）用于交叉验证。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

X <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Class'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> data<span class="token punctuation">.</span>Class
<span class="token class-name">X_train</span><span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
X_train_w<span class="token punctuation">,</span> X_test_w<span class="token punctuation">,</span> y_train_w<span class="token punctuation">,</span> y_test_w <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="6__120"></a>6. 模型训练与评估</h3> 
<ul><li>模型训练：使用逻辑回归模型进行训练。</li><li>交叉验证：通过交叉验证（cross_val_score）来找到最佳的正则化参数C，这里使用召回率（recall）作为评分指标。使用最佳参数C建立最终模型，并在训练集和测试集上进行预测。</li><li>打印报告：打印分类报告（classification_report），包括精确度、召回率、F1分数等指标。</li><li>绘制混淆矩阵：使用自定义的cm_plot函数绘制混淆矩阵，以可视化模型性能。</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score

scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
c_param_range <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span>  <span class="token comment"># 参数</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> c_param_range<span class="token punctuation">:</span>  <span class="token comment"># 第1词循环的时候C=0.01，</span>
    lr <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>C<span class="token operator">=</span>i<span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">,</span> solver<span class="token operator">=</span><span class="token string">'lbfgs'</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
    score <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>lr<span class="token punctuation">,</span> X_train_w<span class="token punctuation">,</span> y_train_w<span class="token punctuation">,</span> cv<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> scoring<span class="token operator">=</span><span class="token string">'recall'</span><span class="token punctuation">)</span>
    score_mean <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>  <span class="token comment"># 交叉验证后的召回率</span>
    scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span>score_mean<span class="token punctuation">)</span>  <span class="token comment"># 所有交叉验证的召回率</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>score_mean<span class="token punctuation">)</span>

best_c <span class="token operator">=</span> c_param_range<span class="token punctuation">[</span>np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 寻找scores中最大值对应的C</span>

<span class="token comment"># 建立最优模型</span>
lr <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span>C<span class="token operator">=</span>best_c<span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">,</span> solver<span class="token operator">=</span><span class="token string">'lbfgs'</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>
lr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train_w<span class="token punctuation">,</span> y_train_w<span class="token punctuation">)</span>

<span class="token comment"># 绘制混淆矩阵</span>
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> metrics

train_predicted_w <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train_w<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>y_train_w<span class="token punctuation">,</span> train_predicted_w<span class="token punctuation">)</span><span class="token punctuation">)</span>
cm_plot<span class="token punctuation">(</span>y_train_w<span class="token punctuation">,</span> train_predicted_w<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

test_predicted_w <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test_w<span class="token punctuation">)</span>  <span class="token comment"># 小数据测试</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>y_test_w<span class="token punctuation">,</span> test_predicted_w<span class="token punctuation">)</span><span class="token punctuation">)</span>
cm_plot<span class="token punctuation">(</span>y_test_w<span class="token punctuation">,</span> test_predicted_w<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

train_predicted <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> train_predicted<span class="token punctuation">)</span><span class="token punctuation">)</span>
cm_plot<span class="token punctuation">(</span>y_train<span class="token punctuation">,</span> train_predicted<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

test_predicted <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_predicted<span class="token punctuation">)</span><span class="token punctuation">)</span>
cm_plot<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> test_predicted<span class="token punctuation">)</span><span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/93/30/KbZzNnjY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7__167"></a>7. 阈值调整与性能评估</h3> 
<ul><li>阈值调整：通过调整预测概率的阈值来探索不同阈值对召回率的影响。逻辑回归模型输出的是属于每个类别的概率，通过调整这个阈值（默认为0.5），可以改变预测结果。</li><li>计算召回率：对于每个阈值，计算召回率，并打印分类报告和混淆矩阵。</li></ul> 
<pre><code class="prism language-python">thresholds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>
recalls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span>
    y_predict_proba <span class="token operator">=</span> lr<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span>

    y_predict_proba <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>y_predict_proba<span class="token punctuation">)</span>
    y_predict_proba <span class="token operator">=</span> y_predict_proba<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># 当预测概率大于i，0.1，0.2，预测的标签设置1</span>
    y_predict_proba<span class="token punctuation">[</span>y_predict_proba<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token comment"># 当预测概率小于等于i 预测的标签设置为0</span>
    y_predict_proba<span class="token punctuation">[</span>y_predict_proba<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

    recall <span class="token operator">=</span> metrics<span class="token punctuation">.</span>recall_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_predict_proba<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    recalls<span class="token punctuation">.</span>append<span class="token punctuation">(</span>recall<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>metrics<span class="token punctuation">.</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_predict_proba<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># cm_plot(y_test, y_predict_proba[1]).show()</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{} Recall metric in the testing dataset: {:.3f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> recall<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="_191"></a>总结</h2> 
<h3><a id="1_192"></a>1.下采样的优点</h3> 
<ul><li>减少计算量：下采样通过减少数据的尺寸，使得后续处理层需要处理的参数数量减少，从而加速了训练和推理过程。这对于处理大规模数据集或实时应用尤为重要。</li><li>提高鲁棒性：通过聚合相邻像素的信息，下采样可以使网络对图像中的小变化（如平移、旋转等）更加鲁棒。这种特性有助于提升模型在复杂场景下的泛化能力。</li><li>特征抽象：随着网络深度的增加，下采样有助于捕获更高层次的抽象特征。这些特征对于许多任务（如分类、目标检测等）来说是至关重要的。</li><li>防止过拟合：通过减少特征图的尺寸，下采样可以作为一种正则化手段，有助于防止网络在训练数据上过拟合。这对于提升模型的泛化性能具有重要意义。</li><li>增大感知野：下采样使得每个神经元能够覆盖更大的输入区域，从而增大感知野。这有助于网络捕捉更全局的信息，对于理解图像的整体结构非常有帮助。</li></ul> 
<h3><a id="2_200"></a>2.下采样的缺点</h3> 
<ul><li>信息丢失：下采样过程中会丢失一些细节信息，如边缘信息等。这些信息对于某些任务（如需要精细边缘检测的图像分割任务）来说非常重要。因此，在设计网络结构时，需要权衡下采样层的位置和数量，以确保在保留足够信息的同时实现高效的特征提取。</li><li>精度损失：强力的下采样虽然能够减少计算量并提高鲁棒性，但也会在一定程度上损失精度。因此，在实际应用中需要根据具体任务的需求来选择合适的下采样策略。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79e468b799df2b61513eb6bbb42f33c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C/C&#43;&#43;控制台贪吃蛇游戏的实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b78ff6dec64045e0e4f527a8769bf2d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx 从入门到精通</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>