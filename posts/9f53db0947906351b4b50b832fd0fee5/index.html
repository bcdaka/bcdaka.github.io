<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring File Storage（文件的对象存储）框架基本使用指南 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9f53db0947906351b4b50b832fd0fee5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spring File Storage（文件的对象存储）框架基本使用指南">
  <meta property="og:description" content="概述 本文仅作为快速入门，深入学习及使用详见官网
云存储
在开发过程当中，会使用到存文档、图片、视频、音频等等，这些都会涉及存储的问题，文件可以直接存服务器，但需要考虑带宽和存储空间，另外一种方式就是使用云存储。目前主流的云存储有阿里云OSS、华为云OBS、七牛云Kodo、腾讯云COS、百度云 BOS、又拍云USS、MinIO 等。
X Spring File Storage 介绍
在 SpringBoot 中通过简单的方式将文件存储到 本地、FTP、SFTP、WebDAV、谷歌云存储、阿里云OSS、华为云OBS、七牛云Kodo、腾讯云COS、百度云 BOS、又拍云USS、MinIO、 AWS S3、金山云 KS3、美团云 MSS、京东云 OSS、天翼云 OOS、移动云 EOS、沃云 OSS、 网易数帆 NOS、Ucloud US3、青云 QingStor、平安云 OBS、首云 OSS、IBM COS、其它兼容 S3 协议的平台。
支持的平台如下图:
快速入门 添加依赖 &lt;dependencies&gt; &lt;!-- spring-file-storage 必须要引入 --&gt; &lt;dependency&gt; &lt;groupId&gt;cn.xuyanwu&lt;/groupId&gt; &lt;artifactId&gt;spring-file-storage&lt;/artifactId&gt; &lt;version&gt;2.1.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 华为云OBS 不使用的情况下可以不引入 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.huaweicloud&lt;/groupId&gt; &lt;artifactId&gt;esdk-obs-java&lt;/artifactId&gt; &lt;version&gt;3.22.12&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 阿里云OSS 不使用的情况下可以不引入 --&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt; &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt; &lt;version&gt;3.16.1&lt;/version&gt; &lt;/dependency&gt; 添加配置文件 注：以下配置是 2.1.0 版本的配置
dromara: x-file-storage: #文件存储配置 default-platform: huawei-obs-1 #默认使用的存储平台 thumbnail-suffix: &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-05T09:29:39+08:00">
    <meta property="article:modified_time" content="2024-08-05T09:29:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring File Storage（文件的对象存储）框架基本使用指南</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>概述</h2> 
<p>本文仅作为快速入门，深入学习及使用详见<a href="https://spring-file-storage.xuyanwu.cn" rel="nofollow">官网</a></p> 
<p><strong>云存储</strong></p> 
<p>在开发过程当中，会使用到存文档、图片、视频、音频等等，这些都会涉及存储的问题，文件可以直接存服务器，但需要考虑带宽和存储空间，另外一种方式就是使用云存储。目前主流的云存储有阿里云OSS、华为云OBS、七牛云Kodo、腾讯云COS、百度云 BOS、又拍云USS、MinIO 等。</p> 
<p><strong>X Spring File Storage 介绍</strong></p> 
<p>在 SpringBoot 中通过简单的方式将文件存储到 本地、FTP、SFTP、WebDAV、谷歌云存储、阿里云OSS、华为云OBS、七牛云Kodo、腾讯云COS、百度云 BOS、又拍云USS、MinIO、 AWS S3、金山云 KS3、美团云 MSS、京东云 OSS、天翼云 OOS、移动云 EOS、沃云 OSS、 网易数帆 NOS、Ucloud US3、青云 QingStor、平安云 OBS、首云 OSS、IBM COS、其它兼容 S3 协议的平台。</p> 
<p>支持的平台如下图:</p> 
<p><img src="https://images2.imgbox.com/6f/7f/EYVkgY0c_o.jpg" alt="在这里插入图片描述"></p> 
<br> 
<h2><a id="_19"></a>快速入门</h2> 
<h3><a id="_21"></a>添加依赖</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- spring-file-storage 必须要引入 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.xuyanwu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-file-storage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 华为云OBS 不使用的情况下可以不引入 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.huaweicloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>esdk-obs-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.22.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 阿里云OSS 不使用的情况下可以不引入 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.16.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<br> 
<h3><a id="_47"></a>添加配置文件</h3> 
<p>注：以下配置是 2.1.0 版本的配置</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">dromara</span><span class="token punctuation">:</span>
  <span class="token key atrule">x-file-storage</span><span class="token punctuation">:</span> <span class="token comment">#文件存储配置</span>
    <span class="token key atrule">default-platform</span><span class="token punctuation">:</span> huawei<span class="token punctuation">-</span>obs<span class="token punctuation">-</span><span class="token number">1</span> <span class="token comment">#默认使用的存储平台</span>
    <span class="token key atrule">thumbnail-suffix</span><span class="token punctuation">:</span> <span class="token string">".min.jpg"</span> <span class="token comment">#缩略图后缀，例如【.min.jpg】【.png】</span>
    <span class="token comment"># 对应平台的配置写在这里，注意缩进要对齐</span>
    <span class="token key atrule">huawei-obs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> huawei<span class="token punctuation">-</span>obs<span class="token punctuation">-</span><span class="token number">1</span> <span class="token comment"># 存储平台标识</span>
        <span class="token key atrule">enable-storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># 启用存储。只有状态开启才会被识别到</span>
        <span class="token key atrule">access-key</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span>
        <span class="token key atrule">secret-key</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span>
        <span class="token key atrule">end-point</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span>
        <span class="token key atrule">bucket-name</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span>
        <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token punctuation">?</span><span class="token punctuation">?</span> <span class="token comment"># 访问域名，注意“/”结尾，例如：http://abc.obs.com/</span>
        <span class="token key atrule">base-path</span><span class="token punctuation">:</span> test/ <span class="token comment"># 基础路径</span>
    <span class="token comment"># 本地存储（升级版）</span>
    <span class="token key atrule">local-plus</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>plus<span class="token punctuation">-</span><span class="token number">1</span> <span class="token comment"># 存储平台标识</span>
        <span class="token key atrule">enable-storage</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment">#启用存储</span>
        <span class="token key atrule">enable-access</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#启用访问（线上请使用 Nginx 配置，效率更高）</span>
        <span class="token key atrule">domain</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>8080/file/ <span class="token comment"># 访问域名，例如：“http://127.0.0.1:8030/file/”，注意后面要和 path-patterns 保持一致，“/”结尾，本地存储建议使用相对路径，方便后期更换域名</span>
        <span class="token key atrule">base-path</span><span class="token punctuation">:</span> local<span class="token punctuation">-</span>plus/ <span class="token comment"># 基础路径</span>
        <span class="token key atrule">path-patterns</span><span class="token punctuation">:</span> /file/<span class="token important">**</span> <span class="token comment"># 访问路径</span>
        <span class="token key atrule">storage-path</span><span class="token punctuation">:</span> D<span class="token punctuation">:</span>/Temp/ <span class="token comment"># 存储路径</span>
</code></pre> 
<br> 
<h3><a id="_79"></a>编码</h3> 
<h4><a id="_81"></a>显式的开启文件上传功能</h4> 
<p>在启动类上加上<code>@EnableFileStorage</code>注解</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableFileStorage</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringFileStorageTestApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringFileStorageTestApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<br> 
<h4><a id="_99"></a>上传</h4> 
<p>支持 File、MultipartFile、byte[]、InputStream、URL、URI、String、HttpServletRequest，大文件会自动分片上传。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileDetailController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FileStorageService</span> fileStorageService<span class="token punctuation">;</span><span class="token comment">//注入实列</span>

    <span class="token comment">/**
     * 上传文件
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileStorageService<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 上传文件，成功返回文件 url
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">upload2</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"upload/"</span><span class="token punctuation">)</span> <span class="token comment">//保存到相对路径下，为了方便管理，不需要可以不写</span>
                <span class="token punctuation">.</span><span class="token function">setObjectId</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span>   <span class="token comment">//关联对象id，为了方便管理，不需要可以不写</span>
                <span class="token punctuation">.</span><span class="token function">setObjectType</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token comment">//关联对象类型，为了方便管理，不需要可以不写</span>
                <span class="token punctuation">.</span><span class="token function">putAttr</span><span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span> <span class="token comment">//保存一些属性，可以在切面、保存上传记录、自定义存储平台等地方获取使用，不需要可以不写</span>
                <span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//将文件上传到对应地方</span>
        <span class="token keyword">return</span> fileInfo <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">"上传失败！"</span> <span class="token operator">:</span> fileInfo<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 上传图片，成功返回文件信息
     * 图片处理使用的是 https://github.com/coobird/thumbnailator
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload-image"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">uploadImage</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileStorageService<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">image</span><span class="token punctuation">(</span>img <span class="token operator">-&gt;</span> img<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//将图片大小调整到 1000*1000</span>
                <span class="token punctuation">.</span><span class="token function">thumbnail</span><span class="token punctuation">(</span>th <span class="token operator">-&gt;</span> th<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//再生成一张 200*200 的缩略图</span>
                <span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 上传文件到指定存储平台，成功返回文件信息
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload-platform"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">uploadPlatform</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileStorageService<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setPlatform</span><span class="token punctuation">(</span><span class="token string">"aliyun-oss-1"</span><span class="token punctuation">)</span>    <span class="token comment">//使用指定的存储平台</span>
                <span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 直接读取 HttpServletRequest 中的文件进行上传，成功返回文件信息
     * 使用这种方式有些注意事项，请查看文档 基础功能-上传 章节
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/upload-request"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">uploadPlatform</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fileStorageService<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<h4><a id="_167"></a>文件是否存在、下载、删除</h4> 
<pre><code class="prism language-java"><span class="token comment">//手动构造文件信息，可用于其它操作</span>
<span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPlatform</span><span class="token punctuation">(</span><span class="token string">"huawei-obs-1"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setBasePath</span><span class="token punctuation">(</span><span class="token string">"test/"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"aa/"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setFilename</span><span class="token punctuation">(</span><span class="token string">"image.png"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setThFilename</span><span class="token punctuation">(</span><span class="token string">"image.png.min.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//文件是否存在</span>
<span class="token keyword">boolean</span> exists <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//下载</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 下载到文件</span>
fileStorageService<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"C:\\a.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 下载缩略图</span>
fileStorageService<span class="token punctuation">.</span><span class="token function">downloadTh</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"C:\\th.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除</span>
fileStorageService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 如果将文件记录保存到数据库中，还可以更方便的根据 URL 进行操作</span>
<span class="token comment">//直接从数据库中获取 FileInfo 对象，更加方便执行其它操作</span>
<span class="token class-name">FileInfo</span> fileInfo <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">getFileInfoByUrl</span><span class="token punctuation">(</span><span class="token string">"https://abc.def.com/test/aa/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//文件是否存在</span>
<span class="token keyword">boolean</span> exists <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"https://abc.def.com/test/aa/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//下载</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> fileStorageService<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">"https://abc.def.com/test/aa/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//删除</span>
fileStorageService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"https://abc.def.com/test/aa/image.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h4><a id="_202"></a>监听器</h4> 
<pre><code class="prism language-java"><span class="token comment">// 下载文件 显示进度</span>
fileStorageService<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setProgressMonitor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProgressListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下载开始"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">progress</span><span class="token punctuation">(</span><span class="token keyword">long</span> progressSize<span class="token punctuation">,</span><span class="token keyword">long</span> allSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已下载 "</span> <span class="token operator">+</span> progressSize <span class="token operator">+</span> <span class="token string">" 总大小"</span> <span class="token operator">+</span> allSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"下载结束"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"C:\\a.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h4><a id="_226"></a>切面</h4> 
<p>工具还提供了每种操作的切面，可以在每个动作的前后进行干预，比如打日志，实现 <code>FileStorageAspect</code> 类重写对应动作的 xxxAround 方法。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 使用切面打印文件上传和删除的日志
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogFileStorageAspect</span> <span class="token keyword">implements</span> <span class="token class-name">FileStorageAspect</span> <span class="token punctuation">{<!-- --></span>
 
    <span class="token comment">/**
     * 上传，成功返回文件信息，失败返回 null
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">uploadAround</span><span class="token punctuation">(</span><span class="token class-name">UploadAspectChain</span> chain<span class="token punctuation">,</span> <span class="token class-name">FileInfo</span> fileInfo<span class="token punctuation">,</span> <span class="token class-name">UploadPretreatment</span> pre<span class="token punctuation">,</span> <span class="token class-name">FileStorage</span> fileStorage<span class="token punctuation">,</span> <span class="token class-name">FileRecorder</span> fileRecorder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"上传文件 before -&gt; {}"</span><span class="token punctuation">,</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileInfo <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>fileInfo<span class="token punctuation">,</span>pre<span class="token punctuation">,</span>fileStorage<span class="token punctuation">,</span>fileRecorder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"上传文件 after -&gt; {}"</span><span class="token punctuation">,</span>fileInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<h3><a id="_253"></a>表设计</h3> 
<pre><code class="prism language-sql"><span class="token comment">-- mysql</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>file_detail<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>file_detail<span class="token punctuation">`</span></span>
<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件访问地址'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>size<span class="token punctuation">`</span></span>  <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件大小，单位字节'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>filename<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件名称'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>original_filename<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'原始文件名'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>base_path<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'基础存储路径'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>path<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'存储路径'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>ext<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci  <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件扩展名'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>content_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'MIME类型'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>platform<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci  <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'存储平台'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>th_url<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'缩略图访问路径'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>th_filename<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'缩略图名称'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>th_size<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'缩略图大小，单位字节'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>th_content_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'缩略图MIME类型'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>object_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件所属对象id'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>object_type<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'文件所属对象类型，例如用户头像，评价图片'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>attr<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'附加属性'</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span>
  <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span>
  <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8
  <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'文件记录表'</span>
  ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>


<span class="token comment">-- postgre 自定义</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token string">"file_detail"</span> <span class="token punctuation">(</span>
    id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    url <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token string">"size"</span> <span class="token keyword">BIGINT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    filename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    original_filename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    base_path <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token string">"path"</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    ext <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    content_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    platform <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    th_url <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    th_filename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    th_size <span class="token keyword">bigint</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    th_content_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    object_id <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    object_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    attr <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">TIMESTAMP</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    project_id UUID <span class="token boolean">null</span><span class="token punctuation">,</span>
    tenant_id UUID <span class="token boolean">null</span><span class="token punctuation">,</span>
    <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- Column comments</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">TABLE</span> file_detail <span class="token operator">IS</span> <span class="token string">'文件记录表'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>id <span class="token operator">IS</span> <span class="token string">'主键'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>url <span class="token operator">IS</span> <span class="token string">'文件访问地址'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span><span class="token string">"size"</span> <span class="token operator">IS</span> <span class="token string">'文件大小，单位字节'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>filename <span class="token operator">IS</span> <span class="token string">'文件名称'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>original_filename <span class="token operator">IS</span> <span class="token string">'原始文件名'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>base_path <span class="token operator">IS</span> <span class="token string">'基础存储路径'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span><span class="token string">"path"</span> <span class="token operator">IS</span> <span class="token string">'存储路径'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>ext <span class="token operator">IS</span> <span class="token string">'文件扩展名'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>content_type <span class="token operator">IS</span> <span class="token string">'MIME类型'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>platform <span class="token operator">IS</span> <span class="token string">'存储平台'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>th_url <span class="token operator">IS</span> <span class="token string">'缩略图访问路径'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>th_filename <span class="token operator">IS</span> <span class="token string">'缩略图名称'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>th_size <span class="token operator">IS</span> <span class="token string">'缩略图大小，单位字节'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>th_content_type <span class="token operator">IS</span> <span class="token string">'缩略图MIME类型'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>object_id <span class="token operator">IS</span> <span class="token string">'文件所属对象id'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>object_type <span class="token operator">IS</span> <span class="token string">'文件所属对象类型，例如用户头像，评价图'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>attr <span class="token operator">IS</span> <span class="token string">'附加属性'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>create_time <span class="token operator">IS</span> <span class="token string">'创建时间'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>project_id <span class="token operator">IS</span> <span class="token string">'项目id'</span><span class="token punctuation">;</span>
<span class="token keyword">COMMENT</span> <span class="token keyword">ON</span> <span class="token keyword">COLUMN</span> <span class="token keyword">public</span><span class="token punctuation">.</span>file_detail<span class="token punctuation">.</span>tenant_id <span class="token operator">IS</span> <span class="token string">'租户id'</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h2><a id="_337"></a>参考</h2> 
<ul><li><a href="https://blog.csdn.net/m0_68408835/article/details/130237609">Springboot 中快速完成文件上传，整合多平台神器</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc238cd8826809489ee54732e496bc4f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA如何去掉编辑框右侧的竖线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/47e1e0b0d380105cad2643a2ee5607be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大数据-65 Kafka 高级特性 分区 Broker自动再平衡 ISR 副本 宕机恢复再重平衡 实测</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>