<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KubeSphere介绍及一键安装k8s - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/34e220bb1566faa62f8f551a49759748/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="KubeSphere介绍及一键安装k8s">
  <meta property="og:description" content="KubeSphere介绍 官网地址：https://kubesphere.io/zh/
KubeSphere愿景是打造一个以 Kubernetes 为内核的云原生分布式操作系统，它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大减轻开发、测试、运维的日常工作的复杂度。
全栈的 Kubernetes 容器云 PaaS 解决方案，KubeSphere 是在 Kubernetes 之上构建的以应用为中心的多租户（NS、sa ）容器平台，提供全栈的 IT 自动化运维的能力，简化企业的 DevOps 工作流。KubeSphere 提供了运维友好的向导式操作界面，帮助企业快速构建一个强大和功能丰富的容器云平台。
KubeSphere 作为企业级的全栈化容器平台，为用户提供了一个极致体验的 Web 控制台，让您能够像使用任何其他互联网产品一样，快速上手各项功能与服务。KubeSphere 目前提供了工作负载管理、微服务治理、DevOps 工程、Source to Image、多租户管理、多维度监控、日志查询与收集、告警通知、服务与网络、应用管理、基础设施管理、镜像管理、应用配置密钥管理等功能模块，并支持对接多种开源的存储与网络方案，支持高性能的商业存储与网络服务。
线上Demo体验：https://kubesphere.cloud/login/?redirect=%2Fconsole%2Fmanaged-cluster%2F
参考设置pwd：Aa123456.
KubeKey一键部署K8S集群 官方文档：https://kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/multioverview/
一台master node（初始化主节点）、两台 work node（ join加入主节点）
安装docker
#移除以前的docker sudo yum remove docker \ docker-client \ docker-client-latest \ docker-common \ docker-latest \ docker-latest-logrotate \ docker-logrotate \ docker-engine # 配置yum源 sudo yum install -y yum-utils sudo yum-config-manager \ --add-repo \ https://download.docker.com/linux/centos/docker-ce.repo # 安装docker sudo yum install -y docker-ce docker-ce-cli containerd.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-26T00:01:02+08:00">
    <meta property="article:modified_time" content="2024-07-26T00:01:02+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">KubeSphere介绍及一键安装k8s</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="KubeSphere_0"></a>KubeSphere介绍</h3> 
<p>官网地址：https://kubesphere.io/zh/</p> 
<p>KubeSphere愿景是打造一个<strong>以 Kubernetes 为内核的云原生分布式操作系统</strong>，它的架构可以非常方便地使第三方应用与云原生生态组件进行<strong>即插即用</strong>（plug-and-play）的集成，支持云原生应用在多云与多集群的统一分发和运维管理。提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大减轻开发、测试、运维的日常工作的复杂度。</p> 
<p>全栈的 Kubernetes 容器云 PaaS 解决方案，<strong>KubeSphere 是在 Kubernetes 之上构建的以应用为中心的多租户（NS、sa ）容器平台</strong>，提供全栈的 IT 自动化运维的能力，简化企业的 DevOps 工作流。KubeSphere 提供了运维友好的<strong>向导式操作界面</strong>，帮助企业快速构建一个强大和功能丰富的容器云平台。</p> 
<p>KubeSphere 作为企业级的全栈化容器平台，为用户提供了一个极致体验的 Web 控制台，让您能够像使用任何其他互联网产品一样，快速上手各项功能与服务。KubeSphere 目前提供了工作负载管理、微服务治理、DevOps 工程、Source to Image、多租户管理、多维度监控、日志查询与收集、告警通知、服务与网络、应用管理、基础设施管理、镜像管理、应用配置密钥管理等功能模块，并支持对接多种开源的存储与网络方案，支持高性能的商业存储与网络服务。</p> 
<p>线上Demo体验：https://kubesphere.cloud/login/?redirect=%2Fconsole%2Fmanaged-cluster%2F</p> 
<p>参考设置pwd：Aa123456.</p> 
<h3><a id="KubeKeyK8S_16"></a>KubeKey一键部署K8S集群</h3> 
<p>官方文档：https://kubesphere.io/zh/docs/v3.4/installing-on-linux/introduction/multioverview/</p> 
<p>一台master node（初始化主节点）、两台 work node（ join加入主节点）</p> 
<blockquote> 
 <p>安装docker</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment">#移除以前的docker</span>
<span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>
    docker-client <span class="token punctuation">\</span>
    docker-client-latest <span class="token punctuation">\</span>
    docker-common <span class="token punctuation">\</span>
    docker-latest <span class="token punctuation">\</span>
    docker-latest-logrotate <span class="token punctuation">\</span>
    docker-logrotate <span class="token punctuation">\</span>
    docker-engine

<span class="token comment"># 配置yum源</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils
<span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo

<span class="token comment"># 安装docker    </span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> docker-ce docker-ce-cli containerd.io

<span class="token comment"># 配置阿里云镜像</span>
<span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
{
  "registry-mirrors": ["https://qiyb9988.mirror.aliyuncs.com"]
}
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>

<span class="token comment"># 启动Docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
<span class="token comment"># 设置开机启动Docker</span>
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
 
<span class="token comment"># 检查是否安装成功</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run hello-world
</code></pre> 
<blockquote> 
 <p>系统环境准备</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 节点之中不可以有重复的主机名，mac地址等，设置不同的hostname</span>
hostnamectl set-hostname k8s-master
hostnamectl set-hostname k8s-node1
hostnamectl set-hostname k8s-node2

<span class="token comment"># 关闭防火墙</span>
<span class="token function">sudo</span> systemctl stop firewalld 
<span class="token function">sudo</span> systemctl disable firewalld

<span class="token comment"># 将SElinux设置为permissive模式，禁用</span>
<span class="token function">sudo</span> setenforce <span class="token number">0</span>
<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/^SELINUX=enforcin$/SELINUX=permissive/'</span> /etc/selinux/config 

<span class="token comment"># 关闭swap分区</span>
<span class="token function">sudo</span> swapoff <span class="token parameter variable">-a</span>
<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab

<span class="token comment"># 允许 iptables 检查桥接流量(所有节点)</span>
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/modules-load.d/k8s.conf</span>
br_netfilter
EOF</span>

<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/sysctl.d/k8s.conf</span>
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF</span>

<span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">--system</span>

<span class="token comment"># 安装依赖</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> socat conntrack ebtables ipset net-tools

<span class="token comment"># 配置ssh互访，所有节点</span>
ssh-keygen

ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa.pub root@192.168.0.111

ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa.pub root@192.168.0.112

ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa.pub root@192.168.0.113
</code></pre> 
<blockquote> 
 <p>下载KubeKey</p> 
</blockquote> 
<p>使用这里下载好的解压即可，也可使用curl 这行命令进行下载<br> 链接：https://pan.baidu.com/s/1eiGc2t–IXmBFhtIQVK9Sg?pwd=c8ly<br> 提取码：c8ly</p> 
<pre><code class="prism language-shell"><span class="token comment"># 只在master上执行即可</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KKZONE</span><span class="token operator">=</span>cn

<span class="token function">curl</span> <span class="token parameter variable">-sfL</span> https://get-kk.kubesphere.io <span class="token operator">|</span> <span class="token function">sh</span> -

<span class="token comment"># 为 kk 添加可执行权限：</span>
<span class="token function">chmod</span> +x kk
</code></pre> 
<blockquote> 
 <p>创建集群</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 创建集群配置文件</span>
./kk create config --with-kubernetes v1.22.12 --with-kubesphere v3.4.0

<span class="token function">vim</span> config-sample.yaml

spec:
  hosts:
  - <span class="token punctuation">{<!-- --></span>name: master, address: <span class="token number">192.168</span>.0.111, internalAddress: <span class="token number">192.168</span>.0.111, user: root, password: <span class="token string">"123456"</span><span class="token punctuation">}</span>
  - <span class="token punctuation">{<!-- --></span>name: node1, address: <span class="token number">192.168</span>.0.112, internalAddress: <span class="token number">192.168</span>.0.112, user: root, password: <span class="token string">"123456"</span><span class="token punctuation">}</span>
  - <span class="token punctuation">{<!-- --></span>name: node2, address: <span class="token number">192.168</span>.0.113, internalAddress: <span class="token number">192.168</span>.0.113, user: root, password: <span class="token string">"123456"</span><span class="token punctuation">}</span>
  roleGroups:
    etcd:
    - master
    control-plane: 
    - master
    worker:
    - node1
    - node2

<span class="token comment"># 创建集群 整个安装过程可能需要 10 到 20 分钟，具体取决于您的计算机和网络环境</span>
./kk create cluster <span class="token parameter variable">-f</span> config-sample.yaml

<span class="token comment"># 安装完成后，您会看到如下内容</span>
<span class="token number">10</span>:17:15 CST success: <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
<span class="token comment">#####################################################</span>
<span class="token comment">###              Welcome to KubeSphere!           ###</span>
<span class="token comment">#####################################################</span>

Console: http://192.168.0.110:30880
Account: admin
Password: P@88w0rd
NOTES：
  <span class="token number">1</span>. After you log into the console, please check the
     monitoring status of <span class="token function">service</span> components <span class="token keyword">in</span>
     <span class="token string">"Cluster Management"</span><span class="token builtin class-name">.</span> If any <span class="token function">service</span> is not
     ready, please <span class="token function">wait</span> patiently <span class="token keyword">until</span> all components 
     are up and running.
  <span class="token number">2</span>. Please change the default password after login.

<span class="token comment">#####################################################</span>
https://kubesphere.io             <span class="token number">2023</span>-10-26 <span class="token number">10</span>:25:15
<span class="token comment">#####################################################</span>
<span class="token number">10</span>:25:32 CST success: <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
<span class="token number">10</span>:25:32 CST Pipeline<span class="token punctuation">[</span>CreateClusterPipeline<span class="token punctuation">]</span> execute successfully
Installation is complete.

Please check the result using the command:

	kubectl logs <span class="token parameter variable">-n</span> kubesphere-system <span class="token variable"><span class="token variable">$(</span>kubectl get pod <span class="token parameter variable">-n</span> kubesphere-system <span class="token parameter variable">-l</span> <span class="token string">'app in (ks-install, ks-installer)'</span> <span class="token parameter variable">-o</span> <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'{.items[0].metadata.name}'</span><span class="token variable">)</span></span> <span class="token parameter variable">-f</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/7a/wCe6CMyU_o.png" alt="在这里插入图片描述"></p> 
<p>看到这里就算安装成功！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5d6829c9b5285de6b8dc7f40c0872df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spark实时（五）：InputSource数据源案例演示</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7d86b045464b7a328c585c33d31281a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">kafka源码阅读-ReplicaStateMachine(副本状态机)解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>