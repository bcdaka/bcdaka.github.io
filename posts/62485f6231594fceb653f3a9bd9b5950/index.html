<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>javascript阻止浏览器回退事件 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/62485f6231594fceb653f3a9bd9b5950/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="javascript阻止浏览器回退事件">
  <meta property="og:description" content="最近做一个金融相关的项目，甲方想要一个能阻止浏览器回退的方案以实现用户操作包括浏览器左上角按钮，鼠标右键打开菜单选择返回，或者alt&#43;键盘左键的情况下能不丢失用户键入数据或者操作的动作。
从我调查来看因为浏览器安全策略问题没办法直接屏蔽掉回退功能，在用户交互之前（新进入一个界面不进行鼠标点击，滚轮或者键盘操作）或者连续点击回退按钮的情况下总会出现屏蔽失效的问题 这个问题没办法改变 但是可以阻止用户因为误触导致画面回退用户的数据或者动作操作丢失的问题。
1.强行阻止
在JavaScript中，阻止浏览器回退事件通常使用window.onbeforeunload事件。但是，目前的浏览器安全策略可能会要求用户与页面进行交互后才能触发该事件。
这是为了防止恶意网站滥用此功能，强制用户停留在页面上，阻止其离开。通过在用户与页面进行交互时才允许触发window.onbeforeunload事件，浏览器确保用户可以自由地离开页面，同时在必要时提供一些保护。
以下是一个示例，展示了如何使用window.onbeforeunload事件来阻止浏览器回退：
window.onbeforeunload = function() { return &#34;确定要离开此页面吗？&#34;; }; 要阻止浏览器右键菜单中的返回按钮（不阻止整个右键菜单的弹出），你可以使用beforeunload事件来捕获用户离开页面的行为，并在事件处理程序中阻止默认的返回行为。以下是一个示例代码：
window.addEventListener(&#39;beforeunload&#39;, function(event) { event.preventDefault(); event.returnValue = &#39;&#39;; // 兼容旧版本浏览器 }); 这段代码将监听窗口的beforeunload事件，并在事件处理程序中调用preventDefault()方法来阻止默认的返回行为。为了兼容旧版本的浏览器，我们还将设置event.returnValue为空字符串。
通过这种方式，当用户在右键菜单中选择返回按钮时，浏览器将不会执行返回操作。
2.修改历史记录
要在JavaScript中阻止浏览器的回退事件（即用户按下浏览器的后退按钮），你可以使用history.pushState()方法来修改浏览器的历史记录，从而阻止默认的后退行为。以下是一个示例代码：
window.history.pushState(null, null, window.location.href); window.onpopstate = function(event) { window.history.pushState(null, null, window.location.href); }; 这段代码将在页面加载时调用pushState()方法，将当前URL添加到浏览器的历史记录中。然后，当用户按下浏览器的后退按钮时，onpopstate事件将触发，并再次调用pushState()方法，将当前URL再次添加到历史记录中。当然第一个pushState()方法是为了要画面一跳转进来就压入历史记录中。
这样做的效果是，当用户按下后退按钮时，浏览器的历史记录中只有一个页面条目，即当前页面的URL，因此无法回退到前一个页面。
请注意，阻止浏览器的回退事件可能会影响用户的导航体验，因为他们可能无法像预期的那样回退到前一个页面。请谨慎使用此功能，并确保在特定情况下进行适当的测试和验证。
可以搭配以下代码使用：
history.back() // 与在浏览器点击后退按钮相同 （）里面可以填参数是回退的页面数history.forward() //与在浏览器中点击向前按钮相同（）里面可以填参数是回退的页面数history.go(1); // go() 里面的参数表示跳转页面的个数 例如 history.go(1) 表示前进一个页面history.go(-1); // go() 里面的参数表示跳转页面的个数 例如 history.go(-1) 表示后退一个页面 详情可以了解JavaScript window.history 对象包含浏览器的历史
以上是一个简略的修改history来实现功能的方法 另附（浏览器左上角按钮，鼠标右键打开菜单选择返回，或者alt&#43;键盘左键的控制历史记录实现回退）：
// 阻止浏览器的回退事件（包括后退按钮、右键返回、Alt&#43;左键） window.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-23T04:15:59+08:00">
    <meta property="article:modified_time" content="2024-06-23T04:15:59+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">javascript阻止浏览器回退事件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近做一个金融相关的项目，甲方想要一个能阻止浏览器回退的方案以实现用户操作包括浏览器左上角按钮，鼠标右键打开菜单选择返回，或者alt+键盘左键的情况下能不丢失用户键入数据或者操作的动作。</p> 
<p>从我调查来看因为浏览器安全策略问题没办法直接屏蔽掉回退功能，在用户交互之前（新进入一个界面不进行鼠标点击，滚轮或者键盘操作）或者连续点击回退按钮的情况下总会出现屏蔽失效的问题 这个问题没办法改变 但是可以阻止用户因为误触导致画面回退用户的数据或者动作操作丢失的问题。</p> 
<p>1.强行阻止</p> 
<p>在JavaScript中，阻止浏览器回退事件通常使用<code>window.onbeforeunload</code>事件。但是，目前的浏览器安全策略可能会要求用户与页面进行交互后才能触发该事件。</p> 
<p>这是为了防止恶意网站滥用此功能，强制用户停留在页面上，阻止其离开。通过在用户与页面进行交互时才允许触发<code>window.onbeforeunload</code>事件，浏览器确保用户可以自由地离开页面，同时在必要时提供一些保护。</p> 
<p>以下是一个示例，展示了如何使用<code>window.onbeforeunload</code>事件来阻止浏览器回退：</p> 
<pre><code class="language-javascript">window.onbeforeunload = function() {
  return "确定要离开此页面吗？";
};</code></pre> 
<p>要阻止浏览器右键菜单中的返回按钮（不阻止整个右键菜单的弹出），你可以使用<code>beforeunload</code>事件来捕获用户离开页面的行为，并在事件处理程序中阻止默认的返回行为。以下是一个示例代码：</p> 
<pre><code class="language-javascript">window.addEventListener('beforeunload', function(event) {
  event.preventDefault();
  event.returnValue = ''; // 兼容旧版本浏览器
});</code></pre> 
<p>这段代码将监听窗口的<code>beforeunload</code>事件，并在事件处理程序中调用<code>preventDefault()</code>方法来阻止默认的返回行为。为了兼容旧版本的浏览器，我们还将设置<code>event.returnValue</code>为空字符串。</p> 
<p>通过这种方式，当用户在右键菜单中选择返回按钮时，浏览器将不会执行返回操作。</p> 
<p>2.修改历史记录</p> 
<p>要在JavaScript中阻止浏览器的回退事件（即用户按下浏览器的后退按钮），你可以使用<code>history.pushState()</code>方法来修改浏览器的历史记录，从而阻止默认的后退行为。以下是一个示例代码：</p> 
<pre><code class="language-javascript">window.history.pushState(null, null, window.location.href);
window.onpopstate = function(event) {
  window.history.pushState(null, null, window.location.href);
};</code></pre> 
<p>这段代码将在页面加载时调用<code>pushState()</code>方法，将当前URL添加到浏览器的历史记录中。然后，当用户按下浏览器的后退按钮时，<code>onpopstate</code>事件将触发，并再次调用<code>pushState()</code>方法，将当前URL再次添加到历史记录中。当然第一个pushState()方法是为了要画面一跳转进来就压入历史记录中。</p> 
<p>这样做的效果是，当用户按下后退按钮时，浏览器的历史记录中只有一个页面条目，即当前页面的URL，因此无法回退到前一个页面。</p> 
<p>请注意，阻止浏览器的回退事件可能会影响用户的导航体验，因为他们可能无法像预期的那样回退到前一个页面。请谨慎使用此功能，并确保在特定情况下进行适当的测试和验证。</p> 
<p>可以搭配以下代码使用：</p> 
<ul><li>history.back() // 与在浏览器点击后退按钮相同 （）里面可以填参数是回退的页面数</li><li>history.forward() //与在浏览器中点击向前按钮相同（）里面可以填参数是回退的页面数</li><li>history.go(1); // go() 里面的参数表示跳转页面的个数 例如 history.go(1) 表示前进一个页面</li><li>history.go(-1); // go() 里面的参数表示跳转页面的个数 例如 history.go(-1) 表示后退一个页面</li></ul> 
<p>详情可以了解<a class="link-info" href="https://www.runoob.com/js/js-window-history.html" rel="nofollow" title="JavaScript window.history 对象包含浏览器的历史">JavaScript window.history 对象包含浏览器的历史</a></p> 
<p>以上是一个简略的修改history来实现功能的方法 </p> 
<p>另附（浏览器左上角按钮，鼠标右键打开菜单选择返回，或者alt+键盘左键的控制历史记录实现回退）：</p> 
<pre><code class="language-javascript">// 阻止浏览器的回退事件（包括后退按钮、右键返回、Alt+左键）
window.history.pushState(null, null, window.location.href);
window.onpopstate = function(event) {
  window.history.pushState(null, null, window.location.href);
};

// 阻止右键返回事件
window.addEventListener('mousedown', function(event) {
  if (event.button === 2) { // 右键点击
    event.preventDefault();
    event.stopPropagation();
  }
});

// 阻止Alt+左键的回退事件
window.addEventListener('keydown', function(event) {
  if (event.altKey &amp;&amp; event.keyCode === 37) { // Alt+左键
    event.preventDefault();
    event.stopPropagation();
  }
});</code></pre> 
<p>这段代码首先阻止浏览器的回退事件，使用和前面一样的方法，即在页面加载时调用pushState()方法，并在onpopstate事件中再次调用pushState()方法。</p> 
<p>然后，通过监听鼠标的mousedown事件，检测是否为右键点击（event.button === 2），如果是，则调用preventDefault()和stopPropagation()方法阻止默认的右键返回事件。</p> 
<p>最后，通过监听键盘的keydown事件，并检测是否按下了Alt键和左键（event.altKey &amp;&amp; event.keyCode === 37），如果是，则同样调用preventDefault()和stopPropagation()方法阻止默认的Alt+左键回退事件。</p> 
<p>3.Vue.js、React 和 Angular 的示例代码实现</p> 
<p>Vue.js</p> 
<pre><code class="language-html">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 页面内容 --&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  mounted() {
    // 监听浏览器的 popstate 事件
    window.addEventListener('popstate', this.handlePopstate);
  },
  beforeDestroy() {
    // 组件销毁时移除事件监听
    window.removeEventListener('popstate', this.handlePopstate);
  },
  methods: {
    handlePopstate(event) {
      // 阻止浏览器回退事件的默认行为
      event.preventDefault();
      
      // 可以在这里执行你自定义的逻辑
    }
  }
};
&lt;/script&gt;</code></pre> 
<p>在 Vue 组件的 <code>mounted</code> 生命周期钩子中添加了对 <code>popstate</code> 事件的监听，当浏览器触发回退事件时，会调用 <code>handlePopstate</code> 方法来阻止默认行为，并在其中执行自定义逻辑。在组件销毁时，使用 <code>beforeDestroy</code> 钩子来移除事件监听。</p> 
<p>React:</p> 
<pre><code class="language-javascript">import React, { useEffect } from 'react';

const MyComponent = () =&gt; {
  useEffect(() =&gt; {
    const handlePopstate = (event) =&gt; {
      // 阻止浏览器回退事件的默认行为
      event.preventDefault();
      
      // 可以在这里执行你自定义的逻辑
    };

    // 监听浏览器的 popstate 事件
    window.addEventListener('popstate', handlePopstate);

    return () =&gt; {
      // 组件卸载时移除事件监听
      window.removeEventListener('popstate', handlePopstate);
    };
  }, []);

  return (
    &lt;div&gt;
      {/* 页面内容 */}
    &lt;/div&gt;
  );
};

export default MyComponent;</code></pre> 
<p>使用 React 的函数式组件和 <code>useEffect</code> 钩子来添加和移除对 <code>popstate</code> 事件的监听。在 <code>handlePopstate</code> 方法中，阻止了浏览器回退事件的默认行为，并在其中执行自定义的逻辑。</p> 
<p>Angular:</p> 
<pre><code class="language-javascript">import { Component, HostListener } from '@angular/core';

@Component({
  selector: 'app-my-component',
  template: `
    &lt;!-- 页面内容 --&gt;
  `,
})
export class MyComponent {
  @HostListener('window:popstate', ['$event'])
  onPopstate(event: Event) {
    // 阻止浏览器回退事件的默认行为
    event.preventDefault();
    
    // 可以在这里执行你自定义的逻辑
  }
}</code></pre> 
<p>使用 Angular 的 <code>@HostListener</code> 装饰器将 <code>onPopstate</code> 方法绑定到 <code>window</code> 对象的 <code>popstate</code> 事件上。在 <code>onPopstate</code> 方法中，阻止了浏览器回退事件的默认行为，并在其中执行自定义的逻辑。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/66949c23098989da181620341da6df74/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是dB？dBm、dBc、dBi、dBd怎么计算，有什么区别？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/baa133643ec92c2a0190195825d54c2f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机Java项目｜基于SpringBoot的网上摄影工作室</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>