<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python | 超前滞后分析 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1aa5aa7b748ec60f40c4ab1d5b75ecc6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python | 超前滞后分析">
  <meta property="og:description" content="Nino SST Indices (Nino 1&#43;2, 3, 3.4, 4; ONI and TNI) 有几个指标用于监测热带太平洋，所有这些指标都是基于海表温度(SST)异常在一个给定的区域的平均值。通常，异常是相对于30年的周期来计算的。厄尔尼诺3.4指数(Niño 3.4 index)和海洋厄尔尼诺指数(Oceanic Niño Index (ONI))是定义厄尔尼诺和拉尼娜事件最常用的指数。其他index用于帮助描述每个事件的独特性质。
El Niño 1、2、3和4 的范围如下所示：
Niño 1&#43;2 (0-10S，90W-80W) :
厄尔尼诺1 &#43; 2区域是Niño海表温度区域中最小和最东部的区域，与南美洲沿海地区相对应，在那里El Niño,首先被当地居民识别发现。这一指数往往是Niño海表温度指数中变化最大的。 Niño 3(5N-5S，150W-90W) :
这个区域曾经是监测和预测El Niño现象的主要焦点，但是研究人员后来了解到，ENSO 海洋-大气耦合相互作用的关键区域位于更西部(Trenberth，1997)。因此，Niño 3.4和 ONI 成为定义厄尔尼诺和拉尼娜事件的首选。
Niño 3.4(5N-5S，170W-120W) :Niño3.4异常可以被认为代表从日期线到南美海岸的横跨太平洋的赤道 SST 的平均值。Niño 3.4 index通常使用5个月的连续平均值，El Niño or La Niña是在Niño 3.4 SST 超过 &#43;/-0.4 C 6个月或更长时间内确定的。 ONI (5N-5S，170W-120W) :
ONI 使用与厄尔尼诺3.4指数相同的区域。ONI 采用的是连续3个月的平均值，要被归类为全面的厄尔尼诺或拉尼娜现象，异常必须至少连续5个月超过 &#43; 0.5 C 或 -0.5 C。这是美国国家海洋和大气管理局使用的定义。 Niño 4(5N-5S，160E-150W) :">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-09T11:59:07+08:00">
    <meta property="article:modified_time" content="2024-04-09T11:59:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python | 超前滞后分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Nino_SST_Indices_Nino_12_3_34_4_ONI_and_TNI_0"></a>Nino SST Indices (Nino 1+2, 3, 3.4, 4; ONI and TNI)</h2> 
<p>有几个指标用于监测热带太平洋，所有这些指标都是基于海表温度(SST)异常在一个给定的区域的平均值。通常，异常是相对于30年的周期来计算的。厄尔尼诺3.4指数<code>(Niño 3.4 index)</code>和海洋厄尔尼诺指数<code>(Oceanic Niño Index (ONI))</code>是定义厄尔尼诺和拉尼娜事件最常用的指数。其他<code>index</code>用于帮助描述每个事件的独特性质。</p> 
<p><img src="https://images2.imgbox.com/06/af/SEKJPWdL_o.png" alt="oni.monthly.smoo_stro"></p> 
<p>El Niño 1、2、3和4 的范围如下所示：</p> 
<p><img src="https://images2.imgbox.com/67/73/ymdfhhMh_o.png" alt="El Niño index regions"></p> 
<p><code>Niño 1+2 (0-10S，90W-80W) </code>:</p> 
<ul><li>厄尔尼诺1 + 2区域是Niño海表温度区域中最小和最东部的区域，与南美洲沿海地区相对应，在那里El Niño,首先被当地居民识别发现。这一指数往往是Niño海表温度指数中变化最大的。</li></ul> 
<p><code>Niño 3(5N-5S，150W-90W) </code>:</p> 
<ul><li>这个区域曾经是监测和预测El Niño现象的主要焦点，但是研究人员后来了解到，ENSO 海洋-大气耦合相互作用的关键区域位于更西部(Trenberth，1997)。因此，<code>Niño 3.4和 ONI 成为定义厄尔尼诺和拉尼娜事件的首选</code>。<br> <code>Niño 3.4(5N-5S，170W-120W)</code> :</li><li>Niño3.4异常可以被认为代表从日期线到南美海岸的横跨太平洋的赤道 SST 的平均值。Niño 3.4 index通常使用5个月的连续平均值，<code>El Niño or La Niña</code>是在Niño 3.4 SST 超过 +/-0.4 C 6个月或更长时间内确定的。</li></ul> 
<p><code>ONI (5N-5S，170W-120W)</code> :</p> 
<ul><li>ONI 使用与厄尔尼诺3.4指数相同的区域。ONI 采用的是连续3个月的平均值，要被归类为全面的厄尔尼诺或拉尼娜现象，<code>异常必须至少连续5个月超过 + 0.5 C 或 -0.5 C</code>。这是美国国家海洋和大气管理局使用的定义。</li></ul> 
<p><code>Niño 4(5N-5S，160E-150W)</code> :</p> 
<ul><li>厄尔尼诺4指数捕捉赤道太平洋中部的海表温度异常。这个区域的变化往往比其他厄尔尼诺区域少。</li></ul> 
<p>为了定义每个 <code>El Niño or La Niña</code> 事件的独特性，Trenberth 和 Stepaniak (2001)认为，应该将厄尔尼诺3.4指数与他们引入的一个指数结合使用，这个指数被称为跨尼诺指数(<code>Trans-Niño Index，TNI</code>)。<code>TN</code>I 被定义为厄尔尼诺1 + 2和厄尔尼诺4区域之间标准化海表温度异常的差异。TNI 因此测量了赤道太平洋中部和东部海表温度异常的梯度。当海表温度梯度特别大时(比如，由于尼诺4区域的正异常和尼诺1 + 2区域的负异常) ，一些研究人员将该事件归类为<code>“太平洋中部的厄尔尼诺现象”</code>或“<code>El Niño Modoki</code>”，尽管将这种类型的事件作为一个单独的现象进行区分是一个问题或争论。</p> 
<h2><a id="Nino_34_index__29"></a>Nino 3.4 index 的具体计算步骤</h2> 
<ul><li> <p>1、选择厄尔尼诺3.4区域(5N-5S，170W-120W)的<code>sst</code>月平均数据</p> </li><li> <p>2、计算Nino 3.4区域内每个月的异常</p> </li><li> <p>3、计算每个月异常的区域平均值</p> </li><li> <p>4、去线性趋势化处理（也可以不去）</p> </li></ul> 
<h3><a id="_40"></a>代码实现过程：</h3> 
<pre><code class="prism language-python">
<span class="token comment"># == netcdf file name and location"</span>
fnc <span class="token operator">=</span> <span class="token string">'oisst_monthly.nc'</span>
dmask <span class="token operator">=</span> xr<span class="token punctuation">.</span>open_dataset<span class="token punctuation">(</span><span class="token string">'lsmask.nc'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dmask<span class="token punctuation">)</span>

ds <span class="token operator">=</span> xr<span class="token punctuation">.</span>open_dataset<span class="token punctuation">(</span>fnc<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ds<span class="token punctuation">)</span>

<span class="token comment"># === Climatology and Anomalies</span>
sst <span class="token operator">=</span> ds<span class="token punctuation">.</span>sst<span class="token punctuation">.</span>where<span class="token punctuation">(</span>dmask<span class="token punctuation">.</span>mask<span class="token punctuation">.</span>isel<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
clm <span class="token operator">=</span> sst<span class="token punctuation">.</span>sel<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token builtin">slice</span><span class="token punctuation">(</span><span class="token string">'1982-01-01'</span><span class="token punctuation">,</span><span class="token string">'2020-12-01'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'time.month'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">)</span>
anm <span class="token operator">=</span> <span class="token punctuation">(</span>sst<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'time.month'</span><span class="token punctuation">)</span> <span class="token operator">-</span> clm<span class="token punctuation">)</span>
<span class="token comment">#print(clm)</span>
<span class="token comment"># -- Detorending</span>
<span class="token keyword">def</span> <span class="token function">detrend_dim</span><span class="token punctuation">(</span>da<span class="token punctuation">,</span> dim<span class="token punctuation">,</span> deg<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># detrend along a single dimension</span>
    p <span class="token operator">=</span> da<span class="token punctuation">.</span>polyfit<span class="token punctuation">(</span>dim<span class="token operator">=</span>dim<span class="token punctuation">,</span> deg<span class="token operator">=</span>deg<span class="token punctuation">)</span>
    fit <span class="token operator">=</span> xr<span class="token punctuation">.</span>polyval<span class="token punctuation">(</span>da<span class="token punctuation">[</span>dim<span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>polyfit_coefficients<span class="token punctuation">)</span>
    <span class="token keyword">return</span> da <span class="token operator">-</span> fit

<span class="token keyword">def</span> <span class="token function">cal_nino34</span><span class="token punctuation">(</span>ds<span class="token punctuation">,</span>lat1<span class="token punctuation">,</span>lat2<span class="token punctuation">,</span>lon1<span class="token punctuation">,</span>lon2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ds <span class="token operator">=</span> ds<span class="token punctuation">.</span>sel<span class="token punctuation">(</span>lat<span class="token operator">=</span><span class="token builtin">slice</span><span class="token punctuation">(</span>lat1<span class="token punctuation">,</span>lat2<span class="token punctuation">)</span><span class="token punctuation">,</span>lon<span class="token operator">=</span><span class="token builtin">slice</span><span class="token punctuation">(</span>lon1<span class="token punctuation">,</span>lon2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    clm <span class="token operator">=</span> ds<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'time.month'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">)</span>
    an_ds <span class="token operator">=</span> ds<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'time.month'</span><span class="token punctuation">)</span> <span class="token operator">-</span> clm
    an_ds <span class="token operator">=</span> an_ds<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'lon'</span><span class="token punctuation">,</span><span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    an_ds <span class="token operator">=</span> detrend_dim<span class="token punctuation">(</span>an_ds<span class="token punctuation">,</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>deg<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> an_ds


nino3_4 <span class="token operator">=</span> cal_nino34<span class="token punctuation">(</span>sst<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">190</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">)</span>
nino3_4<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="_78"></a>结果展示：</h2> 
<p><img src="https://images2.imgbox.com/4c/47/VGwnClFg_o.png" alt="nino3.4-index"></p> 
<h2><a id="_83"></a>平滑</h2> 
<p>还可以对于指数进行平滑，使结果看起来更好看一点。如果指数平滑了，后续计算相关相关时也需要对于输入的其他变量进行统一平滑。</p> 
<pre><code class="prism language-python">
ninoSD<span class="token operator">=</span>nino3_4<span class="token operator">/</span>nino3_4<span class="token punctuation">.</span>std<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">)</span>
rninoSD<span class="token operator">=</span>ninoSD<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token string">'time'</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/82/98/jrpQdGmn_o.png" alt="nino3.4-index-smooth"></p> 
<h2><a id="_98"></a>计算超前滞后</h2> 
<p>相关性和回归分析部分：</p> 
<p>Leading：</p> 
<ul><li>通过计算NINO指数（rninoSD）和时间滞后12个时间步长的rdanm之间的相关系数和回归系数。类似地，也计算了时间滞后6个时间步长的相关系数和回归系数。<br> Simultaneous：</li><li>计算NINO指数（rninoSD）和rdanm之间同期的相关系数和回归系数。<br> Lagging：</li><li>计算NINO指数（rninoSD）和时间滞后6、12、18个时间步长的rdanm之间的相关系数和回归系数。</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># -- Running mean</span>

ranm <span class="token operator">=</span> anm<span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> center<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token string">'time'</span><span class="token punctuation">)</span>
rdanm <span class="token operator">=</span> detrend_dim<span class="token punctuation">(</span>ranm<span class="token punctuation">,</span><span class="token string">'time'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># -- Correlation &amp; Regression</span>


<span class="token comment"># Leading</span>
corM12 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
regM12 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span> rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
corM6 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
regM6 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span> rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

<span class="token comment"># simultaneous</span>
cor0 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
reg0 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

<span class="token comment"># Laging</span>
corP6 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
regP6 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span> rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
corP12 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
regP12 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span> rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values
corP18 <span class="token operator">=</span> xr<span class="token punctuation">.</span>corr<span class="token punctuation">(</span>rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span>
regP18 <span class="token operator">=</span> xr<span class="token punctuation">.</span>cov<span class="token punctuation">(</span> rninoSD<span class="token punctuation">,</span> rdanm<span class="token punctuation">.</span>shift<span class="token punctuation">(</span>time<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token operator">/</span>rninoSD<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token string">'time'</span><span class="token punctuation">,</span>skipna<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values

</code></pre> 
<h2><a id="_138"></a>绘图</h2> 
<pre><code class="prism language-python"><span class="token comment"># -- figure plot</span>

<span class="token keyword">def</span> <span class="token function">makefig</span><span class="token punctuation">(</span>cor<span class="token punctuation">,</span> reg<span class="token punctuation">,</span>title<span class="token punctuation">,</span> grid_space<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 修复 0 度和 360 度经度附近未显示数据的伪影</span>
  cor <span class="token operator">=</span> gvutil<span class="token punctuation">.</span>xr_add_cyclic_longitudes<span class="token punctuation">(</span>cor<span class="token punctuation">,</span> <span class="token string">'lon'</span><span class="token punctuation">)</span>
  reg <span class="token operator">=</span> gvutil<span class="token punctuation">.</span>xr_add_cyclic_longitudes<span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token string">'lon'</span><span class="token punctuation">)</span>
  <span class="token comment"># 添加等距柱面投影，中心经度为210°</span>
  ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span>grid_space<span class="token punctuation">,</span>
          projection<span class="token operator">=</span>ccrs<span class="token punctuation">.</span>PlateCarree<span class="token punctuation">(</span>central_longitude<span class="token operator">=</span><span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># 添加海岸线</span>
  ax<span class="token punctuation">.</span>coastlines<span class="token punctuation">(</span>linewidth<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
  
  <span class="token comment"># 设置坐标范围</span>
  gvutil<span class="token punctuation">.</span>set_axes_limits_and_ticks<span class="token punctuation">(</span>ax<span class="token punctuation">,</span>
                                 xlim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 ylim<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 xticks<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 yticks<span class="token operator">=</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  
  <span class="token comment"># Use geocat.viz.util convenience function to add minor and major tick lines</span>
  gvutil<span class="token punctuation">.</span>add_major_minor_ticks<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> labelsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
  
  <span class="token comment"># Use geocat.viz.util convenience function to make latitude, longitude tick labels</span>
  gvutil<span class="token punctuation">.</span>add_lat_lon_ticklabels<span class="token punctuation">(</span>ax<span class="token punctuation">)</span>
  
  <span class="token comment">#设置colorbar</span>
  newcmp <span class="token operator">=</span> cmaps<span class="token punctuation">.</span>NCV_blu_red
  index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>  <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span>  <span class="token number">165</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">,</span> <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">235</span><span class="token punctuation">,</span> <span class="token number">250</span> <span class="token punctuation">]</span>
  color_list <span class="token operator">=</span> <span class="token punctuation">[</span>newcmp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>colors <span class="token keyword">for</span> i <span class="token keyword">in</span> index<span class="token punctuation">]</span>
  <span class="token comment"># 设置colorbar中间颜色为白色</span>
  color_list<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span>
  color_list<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span>
  
  <span class="token comment"># 定义填色图的参数</span>
  kwargs <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
    vmin <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>
    vmax <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    levels <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">,</span>
    colors<span class="token operator">=</span>color_list<span class="token punctuation">,</span>
    add_colorbar<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># allow for colorbar specification later</span>
    transform<span class="token operator">=</span>ccrs<span class="token punctuation">.</span>PlateCarree<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ds projection</span>
  <span class="token punctuation">)</span>
  
  <span class="token comment"># 相关系数的填色图</span>
  fillplot <span class="token operator">=</span> cor<span class="token punctuation">.</span>plot<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>  <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

  <span class="token comment"># 添加陆地、地形</span>
  ax<span class="token punctuation">.</span>add_feature<span class="token punctuation">(</span>cfeature<span class="token punctuation">.</span>LAND<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'lightgray'</span><span class="token punctuation">,</span> zorder<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  ax<span class="token punctuation">.</span>add_feature<span class="token punctuation">(</span>cfeature<span class="token punctuation">.</span>COASTLINE<span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> zorder<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  
  <span class="token comment"># 设置等值线参数</span>
  <span class="token comment"># Specify contour levels excluding 0</span>
  delc<span class="token operator">=</span><span class="token number">0.2</span>
  levels <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> delc<span class="token punctuation">)</span>
  levels <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>levels<span class="token punctuation">,</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>delc<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> delc<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># 回归系数为等值线</span>
  rad <span class="token operator">=</span> reg<span class="token punctuation">.</span>plot<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span>
                  colors<span class="token operator">=</span><span class="token string">'black'</span><span class="token punctuation">,</span>
                  alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span>
                  linewidths<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span>
                  add_labels<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                  levels<span class="token operator">=</span>levels<span class="token punctuation">,</span>
                  transform<span class="token operator">=</span>ccrs<span class="token punctuation">.</span>PlateCarree<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  pe <span class="token operator">=</span> <span class="token punctuation">[</span>PathEffects<span class="token punctuation">.</span>withStroke<span class="token punctuation">(</span>linewidth<span class="token operator">=</span><span class="token number">2.0</span><span class="token punctuation">,</span> foreground<span class="token operator">=</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>rad<span class="token punctuation">.</span>collections<span class="token punctuation">,</span> path_effects<span class="token operator">=</span>pe<span class="token punctuation">)</span>
  <span class="token comment"># 设置标题、及其位置、大小</span>
  gvutil<span class="token punctuation">.</span>set_titles_and_labels<span class="token punctuation">(</span>ax<span class="token punctuation">,</span>
                             lefttitle<span class="token operator">=</span>title<span class="token punctuation">,</span>
                             lefttitlefontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>
                             righttitle<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
                             righttitlefontsize<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>
                             xlabel<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>
                             ylabel<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> ax<span class="token punctuation">,</span> fillplot

<span class="token comment"># Show the plot</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
grid <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_gridspec<span class="token punctuation">(</span>ncols<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">#grid = fig.add_gridspec(ncols=2, nrows=3, hspace=-0.20)</span>


ax1<span class="token punctuation">,</span> fill1 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>corP18<span class="token punctuation">,</span>regP18<span class="token punctuation">,</span><span class="token string">'18-month lag'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">,</span> fill2 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>corP12<span class="token punctuation">,</span>regP12<span class="token punctuation">,</span><span class="token string">'12-month lag'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax3<span class="token punctuation">,</span> fill3 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>corP6<span class="token punctuation">,</span>regP6<span class="token punctuation">,</span><span class="token string">'6-month lag'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax4<span class="token punctuation">,</span> fill4 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>cor0<span class="token punctuation">,</span>reg0<span class="token punctuation">,</span><span class="token string">'Simultaneous'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax5<span class="token punctuation">,</span> fill5 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>corM6<span class="token punctuation">,</span>regM6<span class="token punctuation">,</span><span class="token string">'6-month lead'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax6<span class="token punctuation">,</span> fill6 <span class="token operator">=</span> makefig<span class="token punctuation">(</span>corM12<span class="token punctuation">,</span>regM12<span class="token punctuation">,</span><span class="token string">'12-month lead'</span><span class="token punctuation">,</span> grid<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

fig<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span>fill6<span class="token punctuation">,</span>
                 ax<span class="token operator">=</span><span class="token punctuation">[</span>ax1<span class="token punctuation">,</span> ax2<span class="token punctuation">,</span> ax3<span class="token punctuation">,</span> ax4<span class="token punctuation">,</span> ax5<span class="token punctuation">,</span> ax6<span class="token punctuation">]</span><span class="token punctuation">,</span>
                 drawedges<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                 orientation<span class="token operator">=</span><span class="token string">'horizontal'</span><span class="token punctuation">,</span>
                 shrink<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>
                 pad<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span>
                 extendfrac<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">,</span>
                 extendrect<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
  
fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span><span class="token string">'SST correlation &amp; regression with Nino3.4'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>draw<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/d4/9f/g8Wsrvtj_o.png" alt="sst_lead_lag_corr_reg-smooth"></p> 
<blockquote> 
 <p>https://climatedataguide.ucar.edu/climate-data/nino-sst-indices-nino-12-3-34-4-oni-and-tni</p> 
 <p>Trenberth, Kevin &amp; National Center for Atmospheric Research Staff (Eds). Last modified 2024-03-20 "The Climate Data Guide: Nino SST Indices (Nino 1+2, 3, 3.4, 4; ONI and TNI).”</p> 
 <p>Trenberth, K.E. and Stepaniak, D.P. (2001) Indices of El Nino Evolution. Journal of Climate, 14, 1697-1701.<br> https://doi.org/10.1175/1520-0442(2001)014&lt;1697:LIOENO&gt;2.0.CO;2</p> 
 <p>https://climate.usu.edu/people/yoshi/pyclm101/index.html</p> 
</blockquote> 
<p>本文由<a href="https://mdnice.com/?platform=4" rel="nofollow">mdnice</a>多平台发布</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6fa227c5a3fe76f87c006f64074d378c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mac OS系统中Beyond Compare 4破解方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5ad27f6e8be0a542405a8bcad30031c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">采用Flink CDC操作SQL Server数据库获取增量变更数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>