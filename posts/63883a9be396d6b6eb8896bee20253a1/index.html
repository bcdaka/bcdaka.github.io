<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka学习之：mac 上安装 kafka - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/63883a9be396d6b6eb8896bee20253a1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Kafka学习之：mac 上安装 kafka">
  <meta property="og:description" content="文章目录 Brew 安装1. xcode-select --install2. brew install kafka Docker 安装1. 构建 docker-compose.ymldocker 文件解析zookeeperkafka 2. 通过 docker 构建容器并对外提供服务 MAC 本机 Kafka 启动（使用 默认设置）检测 kafka 是否正确启动方法1: 使用lsof命令方法 2：使用Kafka命令行工具 server.properties 一览 Brew 安装 打开终端 1. xcode-select --install 首先要安装这个东西，否则安不了 kafkaxcode-select --install 安装完成后，你可能需要同意Xcode和相关工具的许可协议。这可以通过以下命令完成：sudo xcodebuild -license 2. brew install kafka 安装 kafkabrew install kafka Docker 安装 如果你已经安装了Docker，可以使用Docker来运行Kafka和ZooKeeper。 1. 构建 docker-compose.yml 在终端中创建一个docker-compose.yml文件，内容如下： version: &#39;2&#39; services: zookeeper: image: wurstmeister/zookeeper ports: - &#34;2181:2181&#34; kafka: image: wurstmeister/kafka ports: - &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-30T00:52:58+08:00">
    <meta property="article:modified_time" content="2024-03-30T00:52:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka学习之：mac 上安装 kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Brew__1" rel="nofollow">Brew 安装</a></li><li><ul><li><a href="#1_xcodeselect_install_4" rel="nofollow">1. xcode-select --install</a></li><li><a href="#2_brew_install_kafka_14" rel="nofollow">2. brew install kafka</a></li></ul> 
  </li><li><a href="#Docker__21" rel="nofollow">Docker 安装</a></li><li><ul><li><a href="#1__dockercomposeyml_24" rel="nofollow">1. 构建 docker-compose.yml</a></li><li><ul><li><a href="#docker__45" rel="nofollow">docker 文件解析</a></li><li><ul><li><a href="#zookeeper_46" rel="nofollow">zookeeper</a></li><li><a href="#kafka_60" rel="nofollow">kafka</a></li></ul> 
   </li></ul> 
   </li><li><a href="#2__docker__80" rel="nofollow">2. 通过 docker 构建容器并对外提供服务</a></li></ul> 
  </li><li><a href="#MAC__Kafka___88" rel="nofollow">MAC 本机 Kafka 启动（使用 默认设置）</a></li><li><ul><li><a href="#_kafka__107" rel="nofollow">检测 kafka 是否正确启动</a></li><li><ul><li><a href="#1_lsof_108" rel="nofollow">方法1: 使用lsof命令</a></li><li><a href="#_2Kafka_114" rel="nofollow">方法 2：使用Kafka命令行工具</a></li></ul> 
   </li><li><a href="#serverproperties__166" rel="nofollow">server.properties 一览</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Brew__1"></a>Brew 安装</h2> 
<ul><li>打开终端</li></ul> 
<h3><a id="1_xcodeselect_install_4"></a>1. xcode-select --install</h3> 
<ul><li>首先要安装这个东西，否则安不了 kafka<pre><code>xcode-select --install
</code></pre> </li><li>安装完成后，你可能需要同意Xcode和相关工具的许可协议。这可以通过以下命令完成：<pre><code>sudo xcodebuild -license
</code></pre> </li></ul> 
<h3><a id="2_brew_install_kafka_14"></a>2. brew install kafka</h3> 
<ul><li>安装 kafka<pre><code class="prism language-python">brew install kafka
</code></pre> </li></ul> 
<h2><a id="Docker__21"></a>Docker 安装</h2> 
<ul><li>如果你已经安装了Docker，可以使用Docker来运行Kafka和ZooKeeper。</li></ul> 
<h3><a id="1__dockercomposeyml_24"></a>1. 构建 docker-compose.yml</h3> 
<ul><li>在终端中创建一个docker-compose.yml文件，内容如下：</li></ul> 
<pre><code class="prism language-python">version<span class="token punctuation">:</span> <span class="token string">'2'</span>
services<span class="token punctuation">:</span>
  zookeeper<span class="token punctuation">:</span>
    image<span class="token punctuation">:</span> wurstmeister<span class="token operator">/</span>zookeeper
    ports<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token string">"2181:2181"</span>
  kafka<span class="token punctuation">:</span>
    image<span class="token punctuation">:</span> wurstmeister<span class="token operator">/</span>kafka
    ports<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token string">"9092:9092"</span>
    environment<span class="token punctuation">:</span>
      KAFKA_ADVERTISED_HOST_NAME<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
      KAFKA_ZOOKEEPER_CONNECT<span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>
    volumes<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock<span class="token punctuation">:</span><span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock
</code></pre> 
<h4><a id="docker__45"></a>docker 文件解析</h4> 
<h5><a id="zookeeper_46"></a>zookeeper</h5> 
<blockquote> 
 <ul><li>首先通过 <code>services</code> 定义了容器使用的所有服务，由于 <code>kafka</code> 启动需要借助于 <code>zookeeper</code>，所以我们要同时在 docker 容器中具备 <code>kafka</code> 和 <code>zookeeper</code> 两种服务</li></ul> 
</blockquote> 
<pre><code class="prism language-python">  zookeeper<span class="token punctuation">:</span>
    image<span class="token punctuation">:</span> wurstmeister<span class="token operator">/</span>zookeeper
    ports<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token string">"2181:2181"</span>
</code></pre> 
<blockquote> 
 <ul><li><code>zookeeper:</code> 这是服务的名称，在这个配置中表示 <code>Zookeeper</code> 服务。</li><li><code>image:</code> 使用的Docker镜像，此处是 <code>wurstmeister/zookeeper</code>。这是一个预配置的 <code>Zookeeper</code> 镜像，适合与<code>Kafka</code>协同工作。</li><li><code>ports:"2181:2181"</code> 将容器内的 <code>2181</code> 端口映射到宿主机的 <code>2181</code> 端口。Zookeeper 默认监听 <code>2181</code> 端口，用于 <code>kafka</code> 客户端连接。</li></ul> 
</blockquote> 
<h5><a id="kafka_60"></a>kafka</h5> 
<pre><code class="prism language-python">  kafka<span class="token punctuation">:</span>
    image<span class="token punctuation">:</span> wurstmeister<span class="token operator">/</span>kafka
    ports<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token string">"9092:9092"</span>
    environment<span class="token punctuation">:</span>
      KAFKA_ADVERTISED_HOST_NAME<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
      KAFKA_ZOOKEEPER_CONNECT<span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span><span class="token number">2181</span>
    volumes<span class="token punctuation">:</span>
      <span class="token operator">-</span> <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock<span class="token punctuation">:</span><span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock
</code></pre> 
<blockquote> 
 <ul><li><code>kafka</code> 这是另一个服务，表示Kafka服务器。</li><li><code>image</code> 使用的是 <code>wurstmeister/kafka</code> 镜像，这是一个预配置的<code>Kafka</code>镜像。</li><li><code>ports: "9092:9092"</code> 将容器内的<code>9092</code>端口映射到宿主机的<code>9092</code>端口。Kafka默认监听<code>9092</code>端口，用于客户端连接。</li><li><code>environment</code> 设置环境变量来配置Kafka。</li><li><code>KAFKA_ADVERTISED_HOST_NAME</code> 告知Kafka如何将自己广告给客户端。在这里设置为<code>127.0.0.1</code>，意味着Kafka将只能从宿主机本地访问。</li><li><code>KAFKA_ZOOKEEPER_CONNECT</code> 指定Kafka如何连接到Zookeeper。<code>zookeeper:2181</code> 表示使用此Docker Compose配置中定义的zookeeper服务及其2181端口。</li><li><code>volumes: /var/run/docker.sock:/var/run/docker.sock</code> 将宿主机的Docker套接字文件挂载到容器中。这允许Kafka容器管理其他Docker容器，通常用于动态创建和管理Kafka集群的Broker。</li></ul> 
</blockquote> 
<h3><a id="2__docker__80"></a>2. 通过 docker 构建容器并对外提供服务</h3> 
<ul><li>选择适合你的需求的安装方法。安装完成后，你就可以开始使用Kafka进行消息队列的开发和测试了。</li></ul> 
<pre><code class="prism language-python">docker<span class="token operator">-</span>compose up
</code></pre> 
<h2><a id="MAC__Kafka___88"></a>MAC 本机 Kafka 启动（使用 默认设置）</h2> 
<ul><li>首先启动 <code>zookeeper</code></li></ul> 
<pre><code class="prism language-python">brew services start zookeeper
</code></pre> 
<ul><li>如果是本地安装的 kafka，则直接可以用下列命令启动，默认情况下Kafka会监听在9092端口上。这个默认行为是由Kafka的配置文件决定的，该配置文件通常位于<code>/usr/local/etc/kafka/server.properties</code>（如果你是通过Homebrew安装的Kafka）而我是 M1 芯片的 macbook，我的默认安装地址是 <code>/opt/homebrew/etc/kafka/server.properties</code></li></ul> 
<pre><code class="prism language-python">brew services start kafka
</code></pre> 
<ul><li>如果更改了 <code>server.properties</code> 则需要重新运行 kafka 来生效设置</li></ul> 
<pre><code class="prism language-python">brew services restart kafka
</code></pre> 
<h3><a id="_kafka__107"></a>检测 kafka 是否正确启动</h3> 
<h4><a id="1_lsof_108"></a>方法1: 使用lsof命令</h4> 
<pre><code class="prism language-python">lsof <span class="token operator">-</span>i <span class="token punctuation">:</span><span class="token number">9092</span>
</code></pre> 
<ul><li>这个命令会列出所有监听在9092端口的进程。如果Kafka已经启动并且在此端口上监听，你应该能看到它的进程信息。如果这个命令返回了关于Kafka进程的信息，那么就意味着Kafka已经在9092端口上正确启动了。</li></ul> 
<h4><a id="_2Kafka_114"></a>方法 2：使用Kafka命令行工具</h4> 
<ul><li>执行以下命令来创建一个新主题：</li></ul> 
<pre><code class="prism language-python">kafka<span class="token operator">-</span>topics <span class="token operator">-</span><span class="token operator">-</span>create <span class="token operator">-</span><span class="token operator">-</span>topic test <span class="token operator">-</span><span class="token operator">-</span>partitions <span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span>replication<span class="token operator">-</span>factor <span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span>bootstrap<span class="token operator">-</span>server localhost<span class="token punctuation">:</span><span class="token number">9092</span>
</code></pre> 
<ul><li>如果这个命令成功执行并没有报错，那么就意味着Kafka服务已经在监听9092端口并且可以正常工作。 如果出现错误，错误信息可能会提供为何无法连接到Kafka的线索。</li></ul> 
<blockquote> 
 <p>我在运行上述内容的时候创建失败，原因是我没有事先启动 <code>zookeeper</code>，错误信息如下：</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">707</span><span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient clientId<span class="token operator">=</span>adminclient<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> Connection to node <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>localhost<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">)</span> could <span class="token keyword">not</span> be established<span class="token punctuation">.</span> Node may <span class="token keyword">not</span> be available<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">811</span><span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient clientId<span class="token operator">=</span>adminclient<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> Connection to node <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>localhost<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">)</span> could <span class="token keyword">not</span> be established<span class="token punctuation">.</span> Node may <span class="token keyword">not</span> be available<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">913</span><span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient clientId<span class="token operator">=</span>adminclient<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> Connection to node <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>localhost<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">)</span> could <span class="token keyword">not</span> be established<span class="token punctuation">.</span> Node may <span class="token keyword">not</span> be available<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient clientId<span class="token operator">=</span>adminclient<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> Connection to node <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>localhost<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">)</span> could <span class="token keyword">not</span> be established<span class="token punctuation">.</span> Node may <span class="token keyword">not</span> be available<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">54</span><span class="token punctuation">:</span><span class="token number">04</span><span class="token punctuation">,</span><span class="token number">522</span><span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient clientId<span class="token operator">=</span>adminclient<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> Connection to node <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">(</span>localhost<span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9092</span><span class="token punctuation">)</span> could <span class="token keyword">not</span> be established<span class="token punctuation">.</span> Node may <span class="token keyword">not</span> be available<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>kafka<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>NetworkClient<span class="token punctuation">)</span>
</code></pre> 
<ul><li>然后查看了日志 <code>/opt/homebrew/var/log/kafka/kafka_output.log</code> 内容：</li></ul> 
<pre><code class="prism language-python">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectException<span class="token punctuation">:</span> Connection refused
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>pollConnect<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>pollConnectNow<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">682</span><span class="token punctuation">)</span>
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>SocketChannelImpl<span class="token punctuation">.</span>finishConnect<span class="token punctuation">(</span>SocketChannelImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">973</span><span class="token punctuation">)</span>
        at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxnSocketNIO<span class="token punctuation">.</span>doTransport<span class="token punctuation">(</span>ClientCnxnSocketNIO<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">344</span><span class="token punctuation">)</span>
        at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxn$SendThread<span class="token punctuation">.</span>run<span class="token punctuation">(</span>ClientCnxn<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1289</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">648</span><span class="token punctuation">]</span> INFO Opening socket connection to server localhost<span class="token operator">/</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">2181.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxn<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">650</span><span class="token punctuation">]</span> WARN Session <span class="token number">0x0</span> <span class="token keyword">for</span> server localhost<span class="token operator">/</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span> Closing socket connection<span class="token punctuation">.</span> Attempting reconnect <span class="token keyword">except</span> it <span class="token keyword">is</span> a SessionExpiredException<span class="token punctuation">.</span> <span class="token punctuation">(</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxn<span class="token punctuation">)</span>
java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>ConnectException<span class="token punctuation">:</span> Connection refused
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>pollConnect<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>pollConnectNow<span class="token punctuation">(</span>Net<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">682</span><span class="token punctuation">)</span>
        at java<span class="token punctuation">.</span>base<span class="token operator">/</span>sun<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>ch<span class="token punctuation">.</span>SocketChannelImpl<span class="token punctuation">.</span>finishConnect<span class="token punctuation">(</span>SocketChannelImpl<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">973</span><span class="token punctuation">)</span>
        at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxnSocketNIO<span class="token punctuation">.</span>doTransport<span class="token punctuation">(</span>ClientCnxnSocketNIO<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">344</span><span class="token punctuation">)</span>
        at org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ClientCnxn$SendThread<span class="token punctuation">.</span>run<span class="token punctuation">(</span>ClientCnxn<span class="token punctuation">.</span>java<span class="token punctuation">:</span><span class="token number">1289</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token number">2024</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">29</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">220</span><span class="token punctuation">]</span> INFO <span class="token punctuation">[</span>ZooKeeperClient Kafka server<span class="token punctuation">]</span> Closing<span class="token punctuation">.</span> <span class="token punctuation">(</span>kafka<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>ZooKeeperClient<span class="token punctuation">)</span>
</code></pre> 
<ul><li>可以看到是没有启动 <code>zookeeper</code>，所以手动启动一下：</li></ul> 
<pre><code class="prism language-python">brew services start zookeeper
</code></pre> 
<ul><li>再重新启动一下 <code>kafka</code>：</li></ul> 
<pre><code class="prism language-python">brew services restart kafka
</code></pre> 
<ul><li>然后就可以成功运行了，再次测试创建 <code>topic</code> 就成功了</li></ul> 
<h3><a id="serverproperties__166"></a>server.properties 一览</h3> 
<ul><li>这里展示一下整体的 kafka 的 property 文档，让大家可以看清楚一些：</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the "License"); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token comment">#</span>
<span class="token comment"># This configuration file is intended for use in ZK-based mode, where Apache ZooKeeper is required.</span>
<span class="token comment"># See kafka.server.KafkaConfig for additional details and defaults</span>
<span class="token comment">#</span>

<span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
broker<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment">############################# Socket Server Settings #############################</span>

<span class="token comment"># The address the socket server listens on. If not configured, the host name will be equal to the value of</span>
<span class="token comment"># java.net.InetAddress.getCanonicalHostName(), with PLAINTEXT listener name, and port 9092.</span>
<span class="token comment">#   FORMAT:</span>
<span class="token comment">#     listeners = listener_name://host_name:port</span>
<span class="token comment">#   EXAMPLE:</span>
<span class="token comment">#     listeners = PLAINTEXT://your.host.name:9092</span>
<span class="token comment">#listeners=PLAINTEXT://:9092</span>

<span class="token comment"># Listener name, hostname and port the broker will advertise to clients.</span>
<span class="token comment"># If not set, it uses the value for "listeners".</span>
<span class="token comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span>

<span class="token comment"># Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="token comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>

<span class="token comment"># The number of threads that the server uses for receiving requests from the network and sending responses to the network</span>
num<span class="token punctuation">.</span>network<span class="token punctuation">.</span>threads<span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># The number of threads that the server uses for processing requests, which may include disk I/O</span>
num<span class="token punctuation">.</span>io<span class="token punctuation">.</span>threads<span class="token operator">=</span><span class="token number">8</span>

<span class="token comment"># The send buffer (SO_SNDBUF) used by the socket server</span>
socket<span class="token punctuation">.</span>send<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span><span class="token builtin">bytes</span><span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The receive buffer (SO_RCVBUF) used by the socket server</span>
socket<span class="token punctuation">.</span>receive<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">.</span><span class="token builtin">bytes</span><span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The maximum size of a request that the socket server will accept (protection against OOM)</span>
socket<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">.</span><span class="token builtin">bytes</span><span class="token operator">=</span><span class="token number">104857600</span>


<span class="token comment">############################# Log Basics #############################</span>

<span class="token comment"># A comma separated list of directories under which to store log files</span>
log<span class="token punctuation">.</span>dirs<span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>homebrew<span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>kafka<span class="token operator">-</span>logs

<span class="token comment"># The default number of log partitions per topic. More partitions allow greater</span>
<span class="token comment"># parallelism for consumption, but this will also result in more files across</span>
<span class="token comment"># the brokers.</span>
num<span class="token punctuation">.</span>partitions<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.</span>
<span class="token comment"># This value is recommended to be increased for installations with data dirs located in RAID array.</span>
num<span class="token punctuation">.</span>recovery<span class="token punctuation">.</span>threads<span class="token punctuation">.</span>per<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token builtin">dir</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Internal Topic Settings  #############################</span>
<span class="token comment"># The replication factor for the group metadata internal topics "__consumer_offsets" and "__transaction_state"</span>
<span class="token comment"># For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.</span>
offsets<span class="token punctuation">.</span>topic<span class="token punctuation">.</span>replication<span class="token punctuation">.</span>factor<span class="token operator">=</span><span class="token number">1</span>
transaction<span class="token punctuation">.</span>state<span class="token punctuation">.</span>log<span class="token punctuation">.</span>replication<span class="token punctuation">.</span>factor<span class="token operator">=</span><span class="token number">1</span>
transaction<span class="token punctuation">.</span>state<span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">.</span>isr<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Log Flush Policy #############################</span>

<span class="token comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span>
<span class="token comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span>
<span class="token comment"># There are a few important trade-offs here:</span>
<span class="token comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span>
<span class="token comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span>
<span class="token comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span>
<span class="token comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span>
<span class="token comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span>

<span class="token comment"># The number of messages to accept before forcing a flush of data to disk</span>
<span class="token comment">#log.flush.interval.messages=10000</span>

<span class="token comment"># The maximum amount of time a message can sit in a log before we force a flush</span>
<span class="token comment">#log.flush.interval.ms=1000</span>

<span class="token comment">############################# Log Retention Policy #############################</span>

<span class="token comment"># The following configurations control the disposal of log segments. The policy can</span>
<span class="token comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span>
<span class="token comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span>
<span class="token comment"># from the end of the log.</span>

<span class="token comment"># The minimum age of a log file to be eligible for deletion due to age</span>
log<span class="token punctuation">.</span>retention<span class="token punctuation">.</span>hours<span class="token operator">=</span><span class="token number">168</span>

<span class="token comment"># A size-based retention policy for logs. Segments are pruned from the log unless the remaining</span>
<span class="token comment"># segments drop below log.retention.bytes. Functions independently of log.retention.hours.</span>
<span class="token comment">#log.retention.bytes=1073741824</span>

<span class="token comment"># The maximum size of a log segment file. When this size is reached a new log segment will be created.</span>
<span class="token comment">#log.segment.bytes=1073741824</span>

<span class="token comment"># The interval at which log segments are checked to see if they can be deleted according</span>
<span class="token comment"># to the retention policies</span>
log<span class="token punctuation">.</span>retention<span class="token punctuation">.</span>check<span class="token punctuation">.</span>interval<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">300000</span>

<span class="token comment">############################# Zookeeper #############################</span>

<span class="token comment"># Zookeeper connection string (see zookeeper docs for details).</span>
<span class="token comment"># This is a comma separated host:port pairs, each corresponding to a zk</span>
<span class="token comment"># server. e.g. "127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002".</span>
<span class="token comment"># You can also append an optional chroot string to the urls to specify the</span>
<span class="token comment"># root directory for all kafka znodes.</span>
zookeeper<span class="token punctuation">.</span>connect<span class="token operator">=</span>localhost<span class="token punctuation">:</span><span class="token number">2181</span>

<span class="token comment"># Timeout in ms for connecting to zookeeper</span>
zookeeper<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>timeout<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">18000</span>


<span class="token comment">############################# Group Coordinator Settings #############################</span>

<span class="token comment"># The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.</span>
<span class="token comment"># The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.</span>
<span class="token comment"># The default value for this is 3 seconds.</span>
<span class="token comment"># We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.</span>
<span class="token comment"># However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.</span>
group<span class="token punctuation">.</span>initial<span class="token punctuation">.</span>rebalance<span class="token punctuation">.</span>delay<span class="token punctuation">.</span>ms<span class="token operator">=</span><span class="token number">0</span>

</code></pre> 
<ul><li> <p>其中最重要的是下面几个（一般需要改动的）：</p> 
  <ul><li><code>broker.id</code>，如果你设置了一个运算集群，其中有多个 kafka 的节点，那么每个节点都是一个 <code>broker</code>，而每个 broker 的 id 都不能相同</li><li><code>#listeners=PLAINTEXT://:9092</code> 这个一般是注释掉的（当默认只有一个节点的时候就默认使用 <code>9092</code> 端口启动这个 <code>broker</code>）但是如果有多个 <code>broker</code> 的时候，请把这里进行修改，使得每个 <code>broker</code> 的监听端口不同，修改的方式就是去掉注释变成 <code>listeners=PLAINTEXT://:xxxx</code> 其中 <code>xxxx</code> 是你自己想用的端口号</li><li><code>log.dirs=/opt/homebrew/var/lib/kafka-logs</code> kafka 会默认将日志文件放到这个位置</li><li><code>zookeeper.connect=localhost:2181</code> 这个是连接 zookeeper 的端口，也要配置正确</li></ul> </li><li> <p>还有更多设置的意义，如果大家想深入了解 kafka，建议去 <a href="https://www.bilibili.com/video/BV1Gp421m7UN?p=22&amp;spm_id_from=pageDriver&amp;vd_source=e162db2199c43956dc501bc6c0725612" rel="nofollow">这个网址</a> 去看视频</p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c6f4b34190a0b49823ad0ab1748796f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Web Components（web组件）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4cf677ee4f3f94e334a25f068b2ecd2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">人工智能大语言模型微调技术：SFT 监督微调、LoRA 微调方法、P-tuning v2 微调方法、Freeze 监督微调方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>