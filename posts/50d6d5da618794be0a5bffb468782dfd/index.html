<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【项目日记（三）】搜索引擎-搜索模块 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/50d6d5da618794be0a5bffb468782dfd/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【项目日记（三）】搜索引擎-搜索模块">
  <meta property="og:description" content="❣博主主页: 33的博客❣
▶️文章专栏分类:项目日记◀️
🚚我的代码仓库: 33的代码仓库🚚
🫵🫵🫵关注我带你了解更多项目内容
目录 1.前言2.项目回顾3.搜索流程3.1分词3.2触发3.3去重3.4排序3.5包装 4.总结 1.前言 在前面的文章中，我们已经完成了索引的制作，既然已经制作好了索引，我们该如何更具输入内容，匹配对应的结果呢?接下来我们就一起完成搜索模块。
2.项目回顾 到目前为止，我们已经实现了2个类，Parser和Index。
实现Parser类：
1.通过递归枚举出所有的HTML文件。
2.针对每一个HTML进行解析操作。
a)标题：直接使用文件名称
b)URL:基于文件路径进行简单的字符串拼接
c)正文：去掉script和html标签
3.把解析内容通过addDoc放入Index类中
实现Index类：
正排索引：ArrayList
倒排索引：HashMap&lt;String,ArrayList&gt;
1.查正排：直接按照下标来取ArrayList中的元素
2.查倒排：直接按照Key，来区HashMap中的元素
3.添加文档，供Parser类调用
a)构建正排索引，构造DocInfo对象，添加到索引末尾
b)构建倒排索引，先对标题，正文进行分词操作，统计词频，添加到Map中去
4.保存索引：基于json格式把索引数据保存到指定文件中。
5.加载索引：基于json格式对数据进行解析，存入内存。
3.搜索流程 1.【分词】根据输入内容进行分词操作2.【触发】针对分词结果来查倒排3.【去重】针对相同的文档进行去重4.【排序】针对去重结果按照权重排序5.【包装】针对排序结果查正牌，包装为Result进行返回数据 3.1分词 在使用Ansj技术进行分词操作的时候，会把空格，以及一些高频词例如a，an，is 等词语都分出来，但这些词语和我们的查询内容关联性并不大，我们就单独罗列出来，进行排除。网上有许多暂停词表可以自行下载，例如：
private static String STOP_WORD_PATH=&#34;D:/doc_searcher_index/stop_word.txt&#34;; private HashSet&lt;String&gt; stopWords=new HashSet&lt;&gt;(); public DocSearcher(){ index.load(); loadStopWords(); } public void loadStopWords(){ try (BufferedReader bufferedReader=new BufferedReader(new FileReader(STOP_WORD_PATH))){ while (true){ String line=bufferedReader.readLine(); if (line==null){ break; } stopWords.add(line); } } catch (IOException e) { throw new RuntimeException(e); } } List&lt;Term&gt; oldTerms=ToAnalysis.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-02T08:30:00+08:00">
    <meta property="article:modified_time" content="2024-07-02T08:30:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【项目日记（三）】搜索引擎-搜索模块</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>❣博主主页: <a href="https://blog.csdn.net/weixin_69049913?type=blog">33的博客</a>❣<br> ▶️文章专栏分类:<a href="https://blog.csdn.net/weixin_69049913/category_12713140.html?spm=1001.2014.3001.5482">项目日记</a>◀️<br> 🚚我的代码仓库: <a href="https://gitee.com/thirtythree-code" rel="nofollow">33的代码仓库</a>🚚<br> 🫵🫵🫵<strong>关注我带你了解更多项目内容</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/36/ab/Vg5TQQf9_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_8" rel="nofollow">1.前言</a></li><li><a href="#2_10" rel="nofollow">2.项目回顾</a></li><li><a href="#3_30" rel="nofollow">3.搜索流程</a></li><li><ul><li><a href="#31_37" rel="nofollow">3.1分词</a></li><li><a href="#32_70" rel="nofollow">3.2触发</a></li><li><a href="#33_83" rel="nofollow">3.3去重</a></li><li><a href="#34_149" rel="nofollow">3.4排序</a></li><li><a href="#35_160" rel="nofollow">3.5包装</a></li></ul> 
  </li><li><a href="#4_244" rel="nofollow">4.总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_8"></a>1.前言</h2> 
<blockquote> 
 <p>在前面的文章中，我们已经完成了索引的制作，既然已经制作好了索引，我们该如何更具输入内容，匹配对应的结果呢?接下来我们就一起完成搜索模块。</p> 
</blockquote> 
<h2><a id="2_10"></a>2.项目回顾</h2> 
<p>到目前为止，我们已经实现了2个类，Parser和Index。<br> <strong>实现Parser类：</strong><br> <font color="orange">1.通过递归枚举出所有的HTML文件。<br> 2.针对每一个HTML进行解析操作。<br> a)标题：直接使用文件名称<br> b)URL:基于文件路径进行简单的字符串拼接<br> c)正文：去掉script和html标签<br> 3.把解析内容通过addDoc放入Index类中</font></p> 
<p><strong>实现Index类：</strong><br> <font color="orane">正排索引：ArrayList<br> 倒排索引：HashMap&lt;String,ArrayList&gt;<br> 1.查正排：直接按照下标来取ArrayList中的元素<br> 2.查倒排：直接按照Key，来区HashMap中的元素<br> 3.添加文档，供Parser类调用<br> a)构建正排索引，构造DocInfo对象，添加到索引末尾<br> b)构建倒排索引，先对标题，正文进行分词操作，统计词频，添加到Map中去<br> 4.保存索引：基于json格式把索引数据保存到指定文件中。<br> 5.加载索引：基于json格式对数据进行解析，存入内存。</font></p> 
<h2><a id="3_30"></a>3.搜索流程</h2> 
<ul><li>1.【分词】根据输入内容进行分词操作</li><li>2.【触发】针对分词结果来查倒排</li><li>3.【去重】针对相同的文档进行去重</li><li>4.【排序】针对去重结果按照权重排序</li><li>5.【包装】针对排序结果查正牌，包装为Result进行返回数据</li></ul> 
<h3><a id="31_37"></a>3.1分词</h3> 
<p>在使用Ansj技术进行分词操作的时候，会把空格，以及一些高频词例如a，an，is 等词语都分出来，但这些词语和我们的查询内容关联性并不大，我们就单独罗列出来，进行排除。网上有许多暂停词表可以自行下载，例如：<br> <img src="https://images2.imgbox.com/e4/4a/sck0saKa_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span>  <span class="token class-name">String</span> <span class="token constant">STOP_WORD_PATH</span><span class="token operator">=</span><span class="token string">"D:/doc_searcher_index/stop_word.txt"</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stopWords<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">DocSearcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        index<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">loadStopWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">loadStopWords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">BufferedReader</span> bufferedReader<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token constant">STOP_WORD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               <span class="token class-name">String</span> line<span class="token operator">=</span>bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                   <span class="token keyword">break</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               stopWords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>    
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Term</span><span class="token punctuation">&gt;</span></span> oldTerms<span class="token operator">=</span><span class="token class-name">ToAnalysis</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Term</span><span class="token punctuation">&gt;</span></span> terms<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Term</span> term<span class="token operator">:</span>oldTerms<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>stopWords<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>term<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            terms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>term<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>          
</code></pre> 
<h3><a id="32_70"></a>3.2触发</h3> 
<pre><code class="prism language-java"> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> termResult<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Term</span> term<span class="token operator">:</span>terms<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> word<span class="token operator">=</span>term<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span> invertedList<span class="token operator">=</span>index<span class="token punctuation">.</span><span class="token function">getInverted</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>invertedList<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            termResult<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>invertedList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33_83"></a>3.3去重</h3> 
<p>前面，我们对用户输入的结果进行触发操作的时候，一个词可能出现在多个文档中，同理，一个文档也可能存在多个分词结果，如果我们不对相同的文档进行去重，那么一个文档针对不同的分词结果就会出现多次，这样显然不合理的。索引我们需要对相同的文档进行去重。那么具体该如何操作呢？触<strong>发的结果是一个二维数组，可以利用两个有序数组排序的思想进行去重，只不过这里运用的是多个有序数组排序。</strong></p> 
<ul><li>1.针对每一行按照升序排序</li><li>2.借助优先级队列，争对多个有序数组进行合并</li><li>3.初始化队列，把每一行第一个元素放入队列</li><li>4.循环的取每行首个元素，遇到相同的DocId，权重相加</li></ul> 
<pre><code class="prism language-java"> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span> allTermResult<span class="token operator">=</span><span class="token function">mergeResult</span><span class="token punctuation">(</span>termResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Pos</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> row<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> col<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Pos</span><span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token punctuation">,</span> <span class="token keyword">int</span> col<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>row <span class="token operator">=</span> row<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>col <span class="token operator">=</span> col<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span> <span class="token function">mergeResult</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> source<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//1.针对每一行按照升序排序</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span> curRow<span class="token operator">:</span>source<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            curRow<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Weight</span> o1<span class="token punctuation">,</span> <span class="token class-name">Weight</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> o1<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>o2<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">//2.借助优先级队列，争对多个有序数组进行合并</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span> target<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pos</span><span class="token punctuation">&gt;</span></span> queue<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pos</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token annotation punctuation">@Override</span>
          <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Pos</span> o1<span class="token punctuation">,</span> <span class="token class-name">Pos</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              <span class="token class-name">Weight</span> w1<span class="token operator">=</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o1<span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token class-name">Weight</span> w2<span class="token operator">=</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> w1<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>w2<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//3.初始化队列，把每一行第一个元素放入队列</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>row<span class="token operator">&lt;</span>source<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>row<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Pos</span><span class="token punctuation">(</span>row<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//循环的取每行首个元素</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token class-name">Pos</span> minPos<span class="token operator">=</span>queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">Weight</span> curWeight<span class="token operator">=</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>minPos<span class="token punctuation">.</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>minPos<span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token class-name">Weight</span> lastWeight<span class="token operator">=</span>target<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">//遇到相同的文章，权重相加</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>lastWeight<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>curWeight<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                  lastWeight<span class="token punctuation">.</span><span class="token function">setWeight</span><span class="token punctuation">(</span>lastWeight<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>curWeight<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                  target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>curWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
              target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>curWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token class-name">Pos</span> newPos<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Pos</span><span class="token punctuation">(</span>minPos<span class="token punctuation">.</span>row<span class="token punctuation">,</span>minPos<span class="token punctuation">.</span>col<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>newPos<span class="token punctuation">.</span>col<span class="token operator">&gt;=</span>source<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>newPos<span class="token punctuation">.</span>row<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token keyword">continue</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>newPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<h3><a id="34_149"></a>3.4排序</h3> 
<pre><code class="prism language-java">  allTermResult<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Weight</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Weight</span> o1<span class="token punctuation">,</span> <span class="token class-name">Weight</span> o2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//按照降序排序</span>
                <span class="token keyword">return</span> o2<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>o1<span class="token punctuation">.</span><span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="35_160"></a>3.5包装</h3> 
<p>需要注意的是返回的结果为标题，URL，描述，而描述不能直接把正文返回，而是返回一段包含用户分词结果的一小段描述。生成描述的思路：可以回去到所有分词结果，遍历分词结果，看哪个结果在正文中出现，那么直接截取分词的前10个字符和后160个字符来进行描述。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Result{"</span> <span class="token operator">+</span>
                <span class="token string">"title='"</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", url='"</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", desc='"</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> desc<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>desc <span class="token operator">=</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Result</span><span class="token punctuation">&gt;</span></span> results<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Weight</span> weight<span class="token operator">:</span>allTermResult<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">DocInfo</span> docInfo<span class="token operator">=</span>index<span class="token punctuation">.</span><span class="token function">getDocInfo</span><span class="token punctuation">(</span>weight<span class="token punctuation">.</span><span class="token function">getDocId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Result</span> result<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span>docInfo<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>docInfo<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result<span class="token punctuation">.</span><span class="token function">setDesc</span><span class="token punctuation">(</span><span class="token class-name">GenDesc</span><span class="token punctuation">(</span>docInfo<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>terms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            results<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token class-name">GenDesc</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Term</span><span class="token punctuation">&gt;</span></span> terms<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> firstPos<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Term</span> term<span class="token operator">:</span>terms<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> word<span class="token operator">=</span>term<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//避免出现word前后带有标点符号</span>
            content<span class="token operator">=</span>content<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\b"</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">"\\b"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            firstPos<span class="token operator">=</span>content<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPos<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPos<span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"..."</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span> desc<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> descBeg<span class="token operator">=</span>firstPos<span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span>firstPos<span class="token operator">-</span><span class="token number">60</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>descBeg<span class="token operator">+</span><span class="token number">160</span><span class="token operator">&gt;</span>content<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            desc<span class="token operator">=</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>descBeg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            desc<span class="token operator">=</span>content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>descBeg<span class="token punctuation">,</span>descBeg<span class="token operator">+</span><span class="token number">160</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"..."</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//把描述中和分词结果相同的部分设置为斜体加上&lt;i&gt;标签，方便前端标红</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Term</span> term<span class="token operator">:</span>terms<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> word<span class="token operator">=</span>term<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//进行忽略大小写的全词匹配</span>
            desc<span class="token operator">=</span>desc<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"(?i) "</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token string">"&lt;i&gt; "</span><span class="token operator">+</span>word<span class="token operator">+</span><span class="token string">" &lt;/i&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="4_244"></a>4.总结</h2> 
<blockquote> 
 <p>这篇文章主要介绍了，搜索引擎的搜锁模块，这部分的难点主要是去重操作，去重的时候需要用到我们之前学过的数据结构，小根堆结合多个有序数组完成去重操作！</p> 
</blockquote> 
<p><code>下期预告：搜索引擎（四）</code></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31e8f3ac4c5851af96dc2cc56169906f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信小程序留言板1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d3d9a9352ad8761548f36312b1e67a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue项目访问 域名/index.html 空页面问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>