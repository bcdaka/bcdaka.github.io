<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>什么是跨域? 出现原因及解决方法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e4c797b3ca4027a79d4071e68ed3edd0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="什么是跨域? 出现原因及解决方法">
  <meta property="og:description" content="目录 一、什么是跨域二、为什么有跨域问题？三、解决跨域问题的方案1.Jsonp2.nginx3.CORS3.1 什么是cors3.2 原理 四、GateWay网关中实现跨域步骤 一、什么是跨域 跨域：浏览器对于javascript的同源策略的限制 。
同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。
设想这样一种情况：A 网站是一家银行，用户登录以后，A 网站在用户的机器上设置了一个 Cookie，包含了一些隐私信息（比如存款总额）。用户离开 A 网站以后，又去访问 B 网站，如果没有同源限制，B 网站可以读取 A 网站的 Cookie，那么隐私信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。
以下情况都属于跨域：
跨域原因说明
示例
域名不同
www.jd.com 与 www.taobao.com
域名相同，端口不同
www.jd.com:8080 与 www.jd.com:8081
二级域名不同
item.jd.com 与 miaosha.jd.com
如果域名和端口都相同，但是请求路径不同，不属于跨域，如：
www.jd.com/item
www.jd.com/goods
http和https也属于跨域
常见的问题
二、为什么有跨域问题？ 跨域不一定都会有跨域问题。
因为跨域问题是浏览器对于ajax请求的一种安全限制：一个页面发起的ajax请求，只能是与当前页域名相同的路径，这能有效的阻止跨站攻击。
因此：跨域问题 是针对ajax的一种限制。
但是这却给我们的开发带来了不便，而且在实际生产环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同，怎么办？
三、解决跨域问题的方案 1.Jsonp Jsonp
最早的解决方案，利用script标签可以跨域的原理实现。
https://www.w3cschool.cn/json/json-jsonp.html
限制： 需要服务的支持只能发起GET请求 原理：
Jsonp其实就是一个跨域解决方案。Js跨域请求数据是不可以的，但是js跨域请求js脚本是可以的。可以把数据封装成一个js语句，做一个方法的调用。跨域请求js脚本可以得到此脚本。得到js脚本之后会立即执行。可以把数据做为参数传递到方法中。就可以获得数据。从而解决跨域问题。
2.nginx nginx反向代理
思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式
缺点：需要在nginx进行额外配置，语义不清晰
前端server的域名为：fe.server.com 后端服务的域名为：dev.server.com 现在我在fe.server.com对dev.server.com发起请求一定会出现跨域。 现在我们只需要启动一个nginx服务器，将server_name设置为fe.server.com,然后设置相应的location以拦截前端需要跨域的请求，最后将请求代理回dev.server.com。如下面的配置： server { listen 80; server_name fe.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-26T10:47:39+08:00">
    <meta property="article:modified_time" content="2023-10-26T10:47:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">什么是跨域? 出现原因及解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、什么是跨域</a></li><li><a href="#_55" rel="nofollow">二、为什么有跨域问题？</a></li><li><a href="#_60" rel="nofollow">三、解决跨域问题的方案</a></li><li><ul><li><a href="#1Jsonp_61" rel="nofollow">1.Jsonp</a></li><li><a href="#2nginx_73" rel="nofollow">2.nginx</a></li><li><a href="#3CORS_95" rel="nofollow">3.CORS</a></li><li><ul><li><a href="#31_cors_108" rel="nofollow">3.1 什么是cors</a></li><li><a href="#32__119" rel="nofollow">3.2 原理</a></li></ul> 
  </li></ul> 
  </li><li><a href="#GateWay_169" rel="nofollow">四、GateWay网关中实现跨域步骤</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、什么是跨域</h2> 
<p>跨域：浏览器对于javascript的同源策略的限制 。</p> 
<p>同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。<br> 设想这样一种情况：A 网站是一家银行，用户登录以后，A 网站在用户的机器上设置了一个 Cookie，包含了一些隐私信息（比如存款总额）。用户离开 A 网站以后，又去访问 B 网站，如果没有同源限制，B 网站可以读取 A 网站的 Cookie，那么隐私信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。<br> <img src="https://images2.imgbox.com/9c/83/2z7yNMq5_o.png" alt="在这里插入图片描述"></p> 
<p>以下情况都属于跨域：</p> 
<table class="MsoNormalTable" border="1" cellspacing="0"><tbody><tr><td><p class="MsoNormal"><b><font face="宋体">跨域原因说明</font></b><b></b></p></td><td><p class="MsoNormal"><b><font face="宋体">示例</font></b><b></b></p></td></tr><tr><td><p class="MsoNormal"><font face="宋体">域名不同</font></p></td><td><p class="MsoNormal"><span class="15">www.jd.com</span> <font face="宋体">与</font> <span class="15">www.taobao.com</span></p></td></tr><tr><td><p class="MsoNormal"><font face="宋体">域名相同，端口不同</font></p></td><td><p class="MsoNormal"><span class="15">www.jd.com:8080</span> <font face="宋体">与</font> <span class="15">www.jd.com:8081</span></p></td></tr><tr><td><p class="MsoNormal"><font face="宋体">二级域名不同</font></p></td><td><p class="MsoNormal"><span class="15">item.jd.com</span> <font face="宋体">与</font> <span class="15">miaosha.jd.com</span></p></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/3f/6d/Of7l4bf7_o.png" alt="在这里插入图片描述"></p> 
<p>如果域名和端口都相同，但是请求路径不同，不属于跨域，如：<br> www.jd.com/item<br> www.jd.com/goods<br> http和https也属于跨域</p> 
<p><strong>常见的问题</strong><br> <img src="https://images2.imgbox.com/fb/3b/nu8Z0IU5_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_55"></a>二、为什么有跨域问题？</h2> 
<p>跨域不一定都会有跨域问题。<br> 因为跨域问题是浏览器对于ajax请求的一种安全限制：一个页面发起的ajax请求，只能是与当前页域名相同的路径，这能有效的阻止跨站攻击。<br> 因此：跨域问题 是针对ajax的一种限制。<br> 但是这却给我们的开发带来了不便，而且在实际生产环境中，肯定会有很多台服务器之间交互，地址和端口都可能不同，怎么办？</p> 
<h2><a id="_60"></a>三、解决跨域问题的方案</h2> 
<h3><a id="1Jsonp_61"></a>1.Jsonp</h3> 
<ul><li>Jsonp<br> 最早的解决方案，利用script标签可以跨域的原理实现。<br> https://www.w3cschool.cn/json/json-jsonp.html<br> 限制： 
  <ul><li>需要服务的支持</li><li>只能发起GET请求</li></ul> </li></ul> 
<p>原理：<br> Jsonp其实就是一个跨域解决方案。Js跨域请求数据是不可以的，但是js跨域请求js脚本是可以的。可以把数据封装成一个js语句，做一个方法的调用。跨域请求js脚本可以得到此脚本。得到js脚本之后会立即执行。可以把数据做为参数传递到方法中。就可以获得数据。从而解决跨域问题。<br> <img src="https://images2.imgbox.com/af/b3/bCG53wjQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2nginx_73"></a>2.nginx</h3> 
<ul><li> <p>nginx反向代理</p> <p>思路是：利用nginx把跨域反向代理为不跨域，支持各种请求方式<br> 缺点：需要在nginx进行额外配置，语义不清晰</p> </li></ul> 
<pre><code class="prism language-cpp">前端server的域名为：fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com
后端服务的域名为：dev<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com
现在我在fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com对dev<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com发起请求一定会出现跨域。
现在我们只需要启动一个nginx服务器，将server_name设置为fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com<span class="token punctuation">,</span>然后设置相应的location以拦截前端需要跨域的请求，最后将请求代理回dev<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com。如下面的配置：
server <span class="token punctuation">{<!-- --></span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        location <span class="token operator">/</span> <span class="token punctuation">{<!-- --></span>
                proxy_pass dev<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
这样就可以完美绕过浏览器的同源策略了。
fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com访问nginx的fe<span class="token punctuation">.</span>server<span class="token punctuation">.</span>com属于同源访问，而nginx对服务端转发的请求不会触发浏览器的同源策略。
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/e6/R5OnzRWe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3CORS_95"></a>3.CORS</h3> 
<ul><li> <p>CORS<br> 规范化的跨域请求解决方案，安全可靠。<br> 优势：</p> 
  <ul><li>在服务端进行控制是否允许跨域，可自定义规则</li><li>支持各种请求方式</li></ul> <p>缺点：</p> 
  <ul><li>会产生额外的请求(预检)</li></ul> <p><img src="https://images2.imgbox.com/2d/66/77FYsoGL_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h4><a id="31_cors_108"></a>3.1 什么是cors</h4> 
<p>CORS是一个W3C标准，全称是"跨域资源共享"（Cross-origin resource sharing）。</p> 
<p>它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。<br> XMLHttpRequest：Ajax的核心对象<br> <strong>CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</strong></p> 
<ul><li>浏览器端：不用考虑<br> 目前，所有浏览器都支持该功能（IE10以下不行）。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。</li><li>服务端：进行相关设置<br> CORS通信与AJAX没有任何差别，因此你不需要改变以前的业务逻辑。只不过，浏览器会在请求中携带一些头信息，我们需要以此判断是否允许其跨域，然后在响应头中加入一些信息即可。这一般通过过滤器完成即可。</li></ul> 
<h4><a id="32__119"></a>3.2 原理</h4> 
<p><strong>预检请求</strong><br> 跨域请求会在正式通信之前，增加一次HTTP查询请求，称为"预检"请求（preflight）。<br> 浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些HTTP动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的XMLHttpRequest请求，否则就报错。</p> 
<pre><code class="prism language-cpp">    OPTIONS <span class="token operator">/</span>cors HTTP<span class="token operator">/</span><span class="token number">1.1</span>
    Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:8888</span>
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Method<span class="token operator">:</span> GET
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Headers<span class="token operator">:</span> X<span class="token operator">-</span>Custom<span class="token operator">-</span>Header
    User<span class="token operator">-</span>Agent<span class="token operator">:</span> Mozilla<span class="token operator">/</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<ul><li>Origin：会指出当前请求属于哪个域（协议+域名+端口）。服务会根据这个值决定是否允许其跨域。</li><li>Access-Control-Request-Method：接下来会用到的请求方式，比如PUT</li><li>Access-Control-Request-Headers：会额外用到的头信息<br> 一个“预检”请求的样板：</li></ul> 
<p><strong>预检请求的响应</strong><br> 服务的收到预检请求，如果许可跨域，会发出响应：</p> 
<pre><code class="prism language-cpp">    HTTP<span class="token operator">/</span><span class="token number">1.1</span> <span class="token number">200</span> OK
    Date<span class="token operator">:</span> Mon<span class="token punctuation">,</span> <span class="token number">01</span> Dec <span class="token number">2008</span> <span class="token number">01</span><span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">39</span> GMT
    Server<span class="token operator">:</span> Apache<span class="token operator">/</span><span class="token number">2.0</span><span class="token punctuation">.</span><span class="token number">61</span> <span class="token punctuation">(</span>Unix<span class="token punctuation">)</span>
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//localhost:8888</span>
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Credentials<span class="token operator">:</span> <span class="token boolean">true</span>
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Methods<span class="token operator">:</span> GET<span class="token punctuation">,</span> POST<span class="token punctuation">,</span> PUT
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Headers<span class="token operator">:</span> X<span class="token operator">-</span>Custom<span class="token operator">-</span>Header
    Access<span class="token operator">-</span>Control<span class="token operator">-</span>Max<span class="token operator">-</span>Age<span class="token operator">:</span> <span class="token number">1728000</span>
    Content<span class="token operator">-</span>Type<span class="token operator">:</span> text<span class="token operator">/</span>html<span class="token punctuation">;</span> charset<span class="token operator">=</span>utf<span class="token operator">-</span><span class="token number">8</span>
    Content<span class="token operator">-</span>Encoding<span class="token operator">:</span> gzip
    Content<span class="token operator">-</span>Length<span class="token operator">:</span> <span class="token number">0</span>
    Keep<span class="token operator">-</span>Alive<span class="token operator">:</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max<span class="token operator">=</span><span class="token number">100</span>
    Connection<span class="token operator">:</span> Keep<span class="token operator">-</span>Alive
    Content<span class="token operator">-</span>Type<span class="token operator">:</span> text<span class="token operator">/</span>plain
</code></pre> 
<p>如果服务器允许跨域，需要在返回的响应头中携带下面信息：</p> 
<ul><li>Access-Control-Allow-Origin：可接受的域，是一个具体域名或者*（代表任意域名）</li><li>Access-Control-Allow-Credentials：是否允许携带cookie，默认情况下，cors不会携带cookie，除非这个值是true</li><li>Access-Control-Allow-Methods：允许访问的方式</li><li>Access-Control-Allow-Headers：允许携带的头</li><li>Access-Control-Max-Age：本次许可的有效时长，单位是秒，过期之前的ajax请求就无需再次进行预检了</li></ul> 
<p>有关cookie：<br> 要想操作cookie，需要满足以下条件：</p> 
<ul><li>服务的响应头中需要携带Access-Control-Allow-Credentials并且为true。</li><li>浏览器发起ajax需要指定withCredentials 为true</li></ul> 
<p><img src="https://images2.imgbox.com/a5/38/d8UGGxyN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="GateWay_169"></a>四、GateWay网关中实现跨域步骤</h2> 
<p><strong>大概流程</strong><br> <strong>建server-gateway模块</strong><br> <strong>修改配置pom.xml</strong></p> 
<pre><code class="prism language-cpp"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project xmlns<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>gmallparent<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>donglin<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>modelVersion<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>server<span class="token operator">-</span>gateway<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>maven<span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>target<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>donglin<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>common<span class="token operator">-</span>util<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 服务注册 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>discovery<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 服务配置<span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
                <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>alibaba<span class="token operator">-</span>nacos<span class="token operator">-</span>config<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
        <span class="token operator">--</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring<span class="token operator">-</span>cloud<span class="token operator">-</span>starter<span class="token operator">-</span>gateway<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>project<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>在resources下添加配置文件</strong><br> <strong>application.yml</strong><br> 80端口要对接前端的端口号(记得检查注册中心有没有api-gateway)</p> 
<pre><code class="prism language-cpp">server<span class="token operator">:</span>
  port<span class="token operator">:</span> <span class="token number">80</span>
spring<span class="token operator">:</span>
  application<span class="token operator">:</span>
    name<span class="token operator">:</span> api<span class="token operator">-</span>gateway
  cloud<span class="token operator">:</span>
    nacos<span class="token operator">:</span>
      discovery<span class="token operator">:</span>
        server<span class="token operator">-</span>addr<span class="token operator">:</span> <span class="token number">192.168</span><span class="token punctuation">.</span><span class="token number">121.128</span><span class="token operator">:</span><span class="token number">8848</span>
    gateway<span class="token operator">:</span>
      discovery<span class="token operator">:</span>      #是否与服务发现组件进行结合，通过 <span class="token function">serviceId</span><span class="token punctuation">(</span>必须设置成大写<span class="token punctuation">)</span> 转发到具体的服务实例。默认为<span class="token boolean">false</span>，设为<span class="token boolean">true</span>便开启通过服务中心的自动根据 serviceId 创建路由的功能。
        locator<span class="token operator">:</span>      #路由访问方式：http<span class="token operator">:</span><span class="token comment">//Gateway_HOST:Gateway_PORT/大写的serviceId/**，其中微服务应用名默认大写访问。</span>
          enabled<span class="token operator">:</span> <span class="token boolean">true</span>
      routes<span class="token operator">:</span>
        <span class="token operator">-</span> id<span class="token operator">:</span> service<span class="token operator">-</span>product
          uri<span class="token operator">:</span> lb<span class="token operator">:</span><span class="token comment">//service-product</span>
          predicates<span class="token operator">:</span>
            <span class="token operator">-</span> Path<span class="token operator">=</span><span class="token comment">/*/product/** # 路径匹配

</span></code></pre> 
<p><strong>在网关中实现跨域</strong><br> <strong>全局配置类实现</strong><br> 包名：com.donglin.gmall.gateway.config<br> CorsConfig类</p> 
<pre><code class="prism language-cpp">@Configuration
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CorsConfig</span> <span class="token punctuation">{<!-- --></span>
    @Bean
    <span class="token keyword">public</span> CorsWebFilter <span class="token function">corsWebFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        <span class="token comment">// cors跨域配置对象</span>
        CorsConfiguration configuration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置允许访问的网络</span>
        configuration<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置是否从服务器获取cookie</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置请求方法 * 表示任意</span>
        configuration<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 所有请求头信息 * 表示任意</span>

        <span class="token comment">// 配置源对象</span>
        UrlBasedCorsConfigurationSource configurationSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        configurationSource<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span> configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// cors过滤器对象</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">CorsWebFilter</span><span class="token punctuation">(</span>configurationSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>启动类</strong></p> 
<pre><code class="prism language-cpp">package com<span class="token punctuation">.</span>donglin<span class="token punctuation">.</span>gmall<span class="token punctuation">.</span>gateway<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token module">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token module">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>SpringBootApplication</span><span class="token punctuation">;</span>

@SpringBootApplication
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerGatewayApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>ServerGatewayApplication<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2b962e19b77f127368253f5b63ec75f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WebClient, HttpClient, OkHttp: 三个Java HTTP客户端的比较</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/738d800070de3f317692e3993c3e3691/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">11.初始JavaScript[初步了解何为js]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>