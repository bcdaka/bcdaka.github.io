<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JDBC 技术 | Java连接MySQL数据库（四万字零基础保姆级超全详解） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6a7feb0e71a4348490e83bd87b17ca19/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="JDBC 技术 | Java连接MySQL数据库（四万字零基础保姆级超全详解）">
  <meta property="og:description" content="文章目录 前言一. JDBC概述1. JDBC 概念2. JDBC 本质3. JDBC 的好处 二. JDBC 快速入门1. 编写Java 程序步骤2. 在IDEA 中的操作流程3. 正式编写 Java程序 三. JDBC API详解1. DriverManager 类2. Connection 接口2.1 获取执行SQL语句的对象 3 .ResultSet 类3.1 概述3.2 代码实现使用ResultSet 对象 4. Statement 接口4.1 概述4.2 代码实现4.3 Statement 对象应用案例 5. PreparedStatement 接口5.1 什么是SQL注入5.2 代码模拟SQL注入问题5.3 PreparedStatement 概述5.4 使用 PreparedStatement 改进刚才存在SQL注入漏洞的代码5.5 PreparedStatement 对象的原理5.6 小结 6. JDBC API 小结 四. 封装 JDBCUtils 工具类1. JDBCUtils 的封装2. JDBCUtils 测试 五. JDBC 事务管理六. JDBC 批处理七. 数据库连接池1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-03-27T15:25:44+08:00">
    <meta property="article:modified_time" content="2023-03-27T15:25:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JDBC 技术 | Java连接MySQL数据库（四万字零基础保姆级超全详解）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_JDBC_6" rel="nofollow">一. JDBC概述</a></li><li><ul><li><a href="#1_JDBC__9" rel="nofollow">1. JDBC 概念</a></li><li><a href="#2_JDBC__20" rel="nofollow">2. JDBC 本质</a></li><li><a href="#3_JDBC__28" rel="nofollow">3. JDBC 的好处</a></li></ul> 
  </li><li><a href="#_JDBC__36" rel="nofollow">二. JDBC 快速入门</a></li><li><ul><li><a href="#1_Java__48" rel="nofollow">1. 编写Java 程序步骤</a></li><li><a href="#2_IDEA__117" rel="nofollow">2. 在IDEA 中的操作流程</a></li><li><a href="#3__Java_172" rel="nofollow">3. 正式编写 Java程序</a></li></ul> 
  </li><li><a href="#_JDBC_API_248" rel="nofollow">三. JDBC API详解</a></li><li><ul><li><a href="#1_DriverManager__250" rel="nofollow">1. DriverManager 类</a></li><li><a href="#2_Connection__306" rel="nofollow">2. Connection 接口</a></li><li><ul><li><a href="#21_SQL_314" rel="nofollow">2.1 获取执行SQL语句的对象</a></li></ul> 
   </li><li><a href="#3_ResultSet__348" rel="nofollow">3 .ResultSet 类</a></li><li><ul><li><a href="#31___350" rel="nofollow">3.1 概述</a></li><li><a href="#32__ResultSet__388" rel="nofollow">3.2 代码实现使用ResultSet 对象</a></li></ul> 
   </li><li><a href="#4_Statement__453" rel="nofollow">4. Statement 接口</a></li><li><ul><li><a href="#41___455" rel="nofollow">4.1 概述</a></li><li><a href="#42___472" rel="nofollow">4.2 代码实现</a></li><li><a href="#43_Statement__551" rel="nofollow">4.3 Statement 对象应用案例</a></li></ul> 
   </li><li><a href="#5_PreparedStatement__619" rel="nofollow">5. PreparedStatement 接口</a></li><li><ul><li><a href="#51__SQL_627" rel="nofollow">5.1 什么是SQL注入</a></li><li><a href="#52__SQL_632" rel="nofollow">5.2 代码模拟SQL注入问题</a></li><li><a href="#53__PreparedStatement__694" rel="nofollow">5.3 PreparedStatement 概述</a></li><li><a href="#54___PreparedStatement_SQL_734" rel="nofollow">5.4 使用 PreparedStatement 改进刚才存在SQL注入漏洞的代码</a></li><li><a href="#55__PreparedStatement__836" rel="nofollow">5.5 PreparedStatement 对象的原理</a></li><li><a href="#56__954" rel="nofollow">5.6 小结</a></li></ul> 
   </li><li><a href="#6_JDBC_API__964" rel="nofollow">6. JDBC API 小结</a></li></ul> 
  </li><li><a href="#__JDBCUtils__968" rel="nofollow">四. 封装 JDBCUtils 工具类</a></li><li><ul><li><a href="#1__JDBCUtils__970" rel="nofollow">1. JDBCUtils 的封装</a></li><li><a href="#2_JDBCUtils__1046" rel="nofollow">2. JDBCUtils 测试</a></li></ul> 
  </li><li><a href="#_JDBC__1129" rel="nofollow">五. JDBC 事务管理</a></li><li><a href="#_JDBC__1272" rel="nofollow">六. JDBC 批处理</a></li><li><a href="#__1347" rel="nofollow">七. 数据库连接池</a></li><li><ul><li><a href="#1__1349" rel="nofollow">1. 数据库连接池简介</a></li><li><a href="#2__1376" rel="nofollow">2. 数据库连接池种类</a></li><li><a href="#3_Druid__1392" rel="nofollow">3. Druid 的使用</a></li><li><a href="#4__1432" rel="nofollow">4. 代码实现连接池</a></li></ul> 
  </li><li><a href="#_Apachedbutils__1565" rel="nofollow">八. Apache--dbutils 工具类开发</a></li><li><ul><li><a href="#1_Apachedbutils__1567" rel="nofollow">1. Apache--dbutils 的引入</a></li><li><a href="#2_dbutils__1719" rel="nofollow">2. dbutils 的使用</a></li><li><ul><li><a href="#21__dbutils__DQL_1745" rel="nofollow">2.1 使用 dbutils 执行 DQL（查询）操作</a></li><li><ul><li><a href="#211__1750" rel="nofollow">2.1.1 查询的结果是多行记录</a></li><li><a href="#212__1834" rel="nofollow">2.1.2 查询的结果是单行记录(即单个对象)</a></li><li><a href="#213__object_1865" rel="nofollow">2.1.3 查询的结果是单行单列（返回的就是 object对象）</a></li></ul> 
    </li><li><a href="#22__dbutils__DML_update_insert_delete__1896" rel="nofollow">2.2 使用 dbutils 执行 DML 操作(update, insert, delete 增删改)</a></li><li><a href="#3_dbutils__1937" rel="nofollow">3. dbutils 小结</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_DAO_BasicDao_1948" rel="nofollow">九. DAO类和 BasicDao类</a></li><li><ul><li><a href="#1_DAO__1950" rel="nofollow">1. DAO 类的引入</a></li><li><a href="#2__BasicDAO__1978" rel="nofollow">2. BasicDAO 应用实例</a></li><li><ul><li><a href="#21_utils__1992" rel="nofollow">2.1 utils 包（存放工具类）</a></li><li><a href="#22_javabean_pojo_domain__JavaBean_2041" rel="nofollow">2.2 javabean/ pojo/ domain 包（存放与表映射的 JavaBean实体类）</a></li><li><a href="#23_dao__DAO__BasicDAO__2121" rel="nofollow">2.3 dao 包（存放操作表的 DAO 类和通用的 BasicDAO 类）</a></li><li><a href="#24_test__2222" rel="nofollow">2.4 test 包（存放测试类）</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_JDBC__2262" rel="nofollow">十. JDBC 案例练习</a></li><li><ul><li><a href="#1___2264" rel="nofollow">1. 需求</a></li><li><a href="#2___2275" rel="nofollow">2. 案例实现</a></li><li><ul><li><a href="#21___2277" rel="nofollow">2.1 环境准备</a></li><li><a href="#22___2507" rel="nofollow">2.2 查询表中所有记录</a></li><li><a href="#23___2528" rel="nofollow">2.3 添加数据</a></li><li><a href="#24___2547" rel="nofollow">2.4 修改数据</a></li><li><a href="#25___2572" rel="nofollow">2.5 删除数据</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>管他啥是啥，看就完了！如果觉得博主写的不错，可以点赞关注支持一下博主哦！有什么地方存在不足或者错误的，烦请各位大佬在评论区指正。万分感谢！！</p> 
<p>本文结合了韩顺平零基础学java，黑马程序员零基础学 JavaWeb，等多个视频的相关知识内容整理而来。花费了很多很多的时间，大家有兴趣也可以结合视频一起xi</p> 
<h2><a id="_JDBC_6"></a>一. JDBC概述</h2> 
<p>在开发中我们使用的是 Java语言，那么势必要通过 Java语言操作数据库中的数据。这就是接下来要学习的 JDBC 技术。</p> 
<h3><a id="1_JDBC__9"></a>1. JDBC 概念</h3> 
<p><strong>JDBC 就是使用 Java语言操作关系型数据库的一套API。全称： <code>Java DataBase Connectivity</code> ，Java 数据库连接</strong>。</p> 
<p><img src="https://images2.imgbox.com/fe/d2/RDTVtOXD_o.png" alt="在这里插入图片描述"><br> 我们开发的同一套Java代码是无法操作不同的关系型数据库的，因为每一个关系型数据库的底层实现细节都不一样。如果这样，问题就很大了，在公司中可以在开发阶段使用的是MySQL数据库，而上线时公司最终选用 Oracle数据库，这就导致我们需要对代码进行大量修改，这显然并不是我们想看到的。</p> 
<p>所以我们想要做到的就是，<strong>同一套Java代码可以操作不同的关系型数据库</strong>，而此时sun公司就制定了一套标准接口<code>JDBC</code>，JDBC 中定义了所有操作关系型数据库的规则。</p> 
<p>众所周知，接口是无法直接使用的，因此就需要自定义类去实现接口，而这些自定义的实现类就由各个关系型数据库的厂商提供（我们也将这些实现类称为：<mark>驱动</mark>）。</p> 
<h3><a id="2_JDBC__20"></a>2. JDBC 本质</h3> 
<p><code>JDBC</code> 是官方（sun公司）定义的一套操作所有关系型数据库的规则，即接口。</p> 
<p>各个数据库的厂商去实现这套接口，并给我们提供了数据库驱动（jar 包）。</p> 
<p>于是我们便可以使用这套接口<code>JDBC</code>进行编程，而真正执行的代码是驱动（jar 包）中的实现类。</p> 
<h3><a id="3_JDBC__28"></a>3. JDBC 的好处</h3> 
<ol><li> <p>各数据库厂商都使用了相同的接口，因此我们的Java 代码不需要针对不同数据库分别开发。</p> </li><li> <p>我们可随时替换使用的数据库，而访问数据库的 Java代码基本不变。</p> </li><li> <p>以后我们编写操作数据库的代码时，只需要面向 <code>JDBC</code>（接口），需要操作哪个关系型数据库就导入该数据库的驱动（jar 包）即可。比如，我们想要操作 MySQL数据库，只需要在项目中导入MySQL数据库的驱动（jar 包）。如下图就是MySQL驱动包：<br> <img src="https://images2.imgbox.com/08/c9/GmUhqbRK_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<h2><a id="_JDBC__36"></a>二. JDBC 快速入门</h2> 
<p><strong>先来看看通过Java 操作MySQL数据库的流程：</strong><br> <img src="https://images2.imgbox.com/4a/8e/fosYqsYd_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>第一步：编写Java程序代码。</p> 
 <p>第二步：Java程序将要执行的SQL语句发送到 MySQL服务端。</p> 
 <p>第三步：MySQL服务端接收到SQL语句并执行该SQL语句（在执行语句前还会<mark>检查和编译SQL 语句</mark>）。</p> 
 <p>第四步：将SQL语句执行的结果返回给 Java程序。</p> 
</blockquote> 
<h3><a id="1_Java__48"></a>1. 编写Java 程序步骤</h3> 
<p><strong>第一步，创建一个 project，并导入MySQL 驱动 jar包</strong>。</p> 
<p><img src="https://images2.imgbox.com/17/5d/VRDQKvjB_o.png" alt="在这里插入图片描述"></p> 
<p><strong>第二步，注册驱动</strong></p> 
<pre><code class="prism language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>第三步，获取数据库连接</strong></p> 
<p>Java代码需要发送SQL语句给MySQL服务端，就需要先与服务端建立连接。</p> 
<pre><code class="prism language-java"><span class="token comment">// 定义需要连接的数据库信息</span>
<span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql://localhost:3306/hsp_db02?serverTimezone=UTC"</span><span class="token punctuation">;</span>
<span class="token comment">// 连接数据库的用户名和密码</span>
<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
<span class="token comment">// 根据上面提供的数据库信息，获取对应数据库的一个连接对象</span>
<span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>url</code> 中各个属性含义如下：</p> 
<ul><li>(1) <code>jdbc:mysql</code>：规定表示协议，通过 JDBC 的方式连接 MySQL数据库。</li><li>(2) <code>localhost</code>：表示主机，也可以是 ip地址</li><li>(3) <code>3306</code>：表示mysql 监听的端口</li><li>(4) <code>hsp_db02</code>：表示连接到 MySQL 中的的哪个数据库</li><li>(5) <code>?</code>：其后面是<mark>键值对</mark>，可以有多个键值对（用<code>&amp;</code>连接），提供不同的功能。</li></ul> 
<blockquote> 
 <p>补充：MySQL 的连接本质是 socket 连接。可以不用理会本句话。</p> 
</blockquote> 
<p><strong>第四步，定义SQL语句</strong></p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update …"</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>第五步，获取执行SQL语句的对象</strong></p> 
<blockquote> 
 <p>执行SQL语句需要一个<mark>SQL执行对象</mark>，而这个执行对象就是<code>Statement</code>对象</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// 通过上面得到的数据库连接对象conn，创建一个 SQL执行对象 Statement</span>
<span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>第六步，执行SQL语句。</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// 调用Statement 对象的executeUpdate() 方法，执行SQL 语句</span>
stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> 
<p><strong>第七步，处理返回结果</strong></p> 
<p>执行SQL 语句后，会返回一个结果，我们可以获取该结果，并根据具体的业务需求对其进行各种操作。</p> 
<p><strong>第八步，释放数据库连接资源</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// 释放数据库的Statement对象和Connection对象</span>
stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2_IDEA__117"></a>2. 在IDEA 中的操作流程</h3> 
<p><strong>1. 创建一个新的 project</strong></p> 
<p><img src="https://images2.imgbox.com/31/b6/HaU3nCVU_o.png" alt=""></p> 
<p><strong>2. 定义 project 的名称，并指定其存储位置</strong></p> 
<p><img src="https://images2.imgbox.com/7d/56/pVEwXAqX_o.png" alt=""></p> 
<p><strong>3. 对 project 进行设置，设置其 JDK版本、编译版本</strong></p> 
<p><img src="https://images2.imgbox.com/17/66/oSN4UVU4_o.png" alt=""></p> 
<p><strong>4. 在project 中创建一个新模块<code>module</code>，并指定模块的名称及存储位置</strong></p> 
<p><img src="https://images2.imgbox.com/ce/42/d6gnQLUH_o.png" alt=""></p> 
<p><strong>5. 在 <code>module</code> 中导入MySQL 数据库的驱动（jar 包）</strong></p> 
<p>将MySQL 的驱动放在 <code>module</code>下的<code>lib目录</code>（随意命名，常用）下，并将该驱动添加为<strong>库文件</strong></p> 
<p><img src="https://images2.imgbox.com/70/c3/wnuwr1V8_o.png" alt=""></p> 
<p><strong>6. 在添加驱动为库文件的时候，有如下三个选项</strong></p> 
<ul><li><code>Global Library</code> ： 全局有效</li><li><code>Project Library</code> : 项目有效</li><li><code>Module Library</code>：模块有效</li></ul> 
<blockquote> 
 <p>此处我们选择全局有效，如下图：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/17/36/Yx6gjQXX_o.png" alt=""></p> 
<p><strong>7. 在<code>src</code>目录下创建一个测试类</strong></p> 
<p><img src="https://images2.imgbox.com/fe/a2/FzsX5GRO_o.png" alt=""></p> 
<p><mark>这样我们就在IDEA 开发工具中成功创建一个可以使用 <code>JDBC</code> 连接MySQL 数据库的项目了。</mark></p> 
<h3><a id="3__Java_172"></a>3. 正式编写 Java程序</h3> 
<p><strong>1. 直接在程序中指定连接数据库的所有参数，代码如下：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * JDBC快速入门
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 注册驱动</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建议写上，不写也不会报错</span>
        <span class="token comment">// 2. 获取数据库连接</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///localhost:3306/db1"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 定义sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update account set money = 2000 where id = 1"</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 获取执行sql的对象 Statement</span>
        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5. 执行sql，返回执行的结果，用 count变量接收</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 方法返回表中受影响的行数</span>
        <span class="token comment">// 6. 处理结果</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 7. 释放资源</span>
        stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>补充：我们还可以使用<code>配置文件</code>来加载连接数据库的参数信息。</strong></p> 
 <p>1.我们只需要将数据库信息另外保存在一个<code>properties</code>配置文件中，然后在Java 程序代码中加载该配置文件即可连接数据库。</p> 
 <p>2.若之后我们需要更改连接数据库的信息，只需要修改配置文件中的内容即可，而无需修改Java程序中的代码。如下：</p> 
</blockquote> 
<ul><li><code>properties</code>配置文件如下：</li></ul> 
<pre><code class="prism language-properties">user=root
password=1234
url=jdbc:mysql://localhost:3306/db1?rewriteBatchedStatements=true
driver=com.mysql.cj.jdbc.Driver
</code></pre> 
<ul><li>Java 程序如下：</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">JDBCDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.通过Properties 对象获取配置文件的信息</span>
    <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src\\mysql.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2.获取连接数据库的相关参数信息</span>
    <span class="token class-name">String</span> user <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> driver <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建议写上</span>

    <span class="token comment">// 4.获取数据库连接</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5.输出连接</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"通过配置文件方式连接"</span> <span class="token operator">+</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_JDBC_API_248"></a>三. JDBC API详解</h2> 
<h3><a id="1_DriverManager__250"></a>1. DriverManager 类</h3> 
<p><strong>DriverManager（驱动管理类）作用：</strong></p> 
<p><strong>1. 注册驱动</strong></p> 
<p><img src="https://images2.imgbox.com/c6/71/O4Khn8pk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">registerDriver</span><span class="token punctuation">(</span><span class="token class-name">Driver</span> driver<span class="token punctuation">)</span> <span class="token comment">// 使用DriverManager注册给定的驱动程序</span>
</code></pre> 
<ul><li><strong><code>registerDriver()</code>方法是用于注册驱动的，但是我们上面做的入门案例中</strong>注册驱动<strong>步骤并不是这样写的。而是如下实现：</strong></li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>我们查询MySQL提供的<code>Driver类</code>，看它是如何实现的，源码如下：</strong></li></ul> 
<p><img src="https://images2.imgbox.com/9c/02/K8cf13VS_o.png" alt=""></p> 
<p>可以发现，在 <code>Driver</code>类中的静态代码块中已经执行 <code>DriverManager</code> 类中的 <code>registerDriver()</code> 方法进行驱动的注册了，那么我们只需要加载 <code>Driver</code> 类，<code>DriverManager</code> 类中的静态代码块就会执行。而语句<code>Class.forName("com.mysql.cj.jdbc.Driver");</code> 就可以加载 <code>Driver</code> 类。</p> 
<blockquote> 
 <p><mark>提示：</mark></p> 
 <ul><li>MySQL 5之后的驱动包，可以省略注册驱动的步骤</li><li>它会自动加载jar包中<code>META-INF/services/Java.sql.Driver</code>文件中的驱动类</li></ul> 
</blockquote> 
<p><strong>2. 获取数据库连接</strong></p> 
<p><img src="https://images2.imgbox.com/c7/bd/bqMql9PH_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> user<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token comment">// 尝试建立与给定数据库 url的连接</span>
</code></pre> 
<p><strong>方法中的参数说明如下：</strong></p> 
<ol><li><strong>url ： 连接路径</strong></li></ol> 
<blockquote> 
 <p>语法：<code>jdbc:mysql://ip地址(域名):端口号/数据库名称?参数键值对1&amp;参数键值对2…</code></p> 
 <p>示例：<code>jdbc:mysql://127.0.0.1:3306/db1?useSSL=false</code></p> 
 <ul><li> <p>如果连接的是本机 mysql服务器，并且mysql服务默认端口是3306，则 url 可以简写为：<code>jdbc:mysql:///数据库名称?参数键值对</code></p> </li><li> <p>配置 <code>useSSL=false</code> 键值对，表示禁用安全连接方式，解决使用数据库时出现的警告提示。</p> </li></ul> 
</blockquote> 
<ol start="2"><li><strong>user ：用户名</strong></li><li><strong>password ：密码</strong></li></ol> 
<h3><a id="2_Connection__306"></a>2. Connection 接口</h3> 
<p><strong><code>Connection</code>（数据库连接对象）接口作用：</strong></p> 
<ul><li>获取执行 SQL语句的对象（<mark>有三种</mark>）</li><li>管理事务（该部分放在后面专门讲解）</li></ul> 
<h4><a id="21_SQL_314"></a>2.1 获取执行SQL语句的对象</h4> 
<p><strong>1. 第一种：普通执行 SQL 语句的对象 <code>Statement</code></strong></p> 
<p>入门案例中就是通过下面方法获取的执行对象。</p> 
<pre><code class="prism language-java"><span class="token class-name">Statement</span> stmt <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>2. 第二种：可以<mark>预编译SQL语句</mark>并执行 SQL语句的对象 <code>PreparedStatement</code>，还可以防止<mark>SQL注入漏洞</mark></strong></p> 
<p>通过下面方式获取的SQL语句执行对象 <code>PreparedStatement</code> 是我们下面会重点进行讲解的，它可以<strong>预编译SQL语句</strong>，还可以预防<strong>SQL注入漏洞</strong>。方法如下（这里先有个印象）：</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"..."</span><span class="token punctuation">;</span>
<span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> connecttion<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>3. 第三种：执行存储过程的对象</strong></p> 
<p>通过下面方式获取的 <code>CallableStatement</code> 执行对象是用来执行<strong>存储过程</strong>的，而存储过程在MySQL中不常用，所以这个我们将不进行讲解。</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"..."</span><span class="token punctuation">;</span>
<span class="token class-name">CallableStatement</span> cstmp <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareCall</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3_ResultSet__348"></a>3 .ResultSet 类</h3> 
<h4><a id="31___350"></a>3.1 概述</h4> 
<p><mark><strong>ResultSet（结果集对象）类作用：封装了 DQL 查询语句查询返回的结果。</strong></mark></p> 
<p><strong>我们执行了 DQL 语句后就会返回该对象，对应执行 DQL 语句的方法如下：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">ResultSet</span> <span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token comment">//执行DQL 语句，返回 ResultSet 对象</span>
</code></pre> 
<p><strong>我们需要从 <code>ResultSet</code> 对象中获取我们想要的数据，而<code>ResultSet</code> 对象也给我们提供了操作查询结果数据的方法，如下：</strong></p> 
<blockquote> 
 <p><strong>方法1：<code>boolean next() {}</code></strong></p> 
 <ul><li>将光标从当前位置向下移动一行</li><li>判断当前行是否为有效行</li></ul> 
 <p><strong>方法返回值说明：</strong></p> 
 <ul><li>true ： 有效行，当前行有数据</li><li>false ： 无效行，当前行没有数据</li></ul> 
</blockquote> 
<blockquote> 
 <p><strong>方法2：<code>xxx getXxx(参数)</code>：获取字段的数据</strong></p> 
 <ul><li><code>Xxx</code> : 数据类型；如： <code>int getInt(参数)</code> ；<code>String getString(参数)</code></li><li>方法中的参数： 
   <ul><li>int 类型的参数：字段的编号，从1开始</li><li>String 类型的参数： 字段的名称</li></ul> </li></ul> 
</blockquote> 
<p><strong>如下图为执行DQL语句后返回的查询结果：</strong></p> 
<p><img src="https://images2.imgbox.com/f3/5f/FqfJgTsE_o.png" alt="在这里插入图片描述"></p> 
<p>一开始光标指定于第一行前，如图所示红色箭头指向于表头行。当我们调用了 <code>next()</code> 方法后，光标就下移指向第一行记录，方法返回结果为 true，此时就可以通过 <code>getInt("id")</code> 获取当前行 <code>id</code> 字段的值，也可以通过 <code>getString("id")</code> 获取<code>id</code>字段的值。如果想获取下一行记录中的数据，则继续调用 <code>next()</code> 方法即可，以此类推。</p> 
<h4><a id="32__ResultSet__388"></a>3.2 代码实现使用ResultSet 对象</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
  * 执行 DQL语句
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testResultSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. 定义sql</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from account"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 获取statement对象</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 5. 执行sql，获取到ResultSet 结果集对象</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 6. 处理结果集， 使用 while 遍历 rs中的所有记录</span>
    
    <span class="token comment">/* 获取字段的值有两种方式，第一种是通过传入字段的序号，如下：*/</span>
    <span class="token comment">// 6.1 光标向下移动一行，并且判断当前行是否有数据</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 6.2 根据字段序号获取数据  getXxx()</span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> money <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/*第二种获取字段的值的方法是通过传入字段名，如下：*/</span>
    <span class="token comment">// 6.1 光标向下移动一行，并且判断当前行是否有数据</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 6.2 根据字段名获取数据  getXxx()</span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> money <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"--------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 7. 释放资源</span>
    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_Statement__453"></a>4. Statement 接口</h3> 
<h4><a id="41___455"></a>4.1 概述</h4> 
<p><mark>Statement 对象的作用就是用来执行 SQL语句。而针对不同类型的 SQL语句使用的方法也不一样。</mark></p> 
<p><strong>1. 执行DDL、DML语句</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token comment">// 执行给定的sql语句，这可能是 INSERT, UPDATE, 或DELETE 语句，或者不返回任何内容，如 DDL语句。</span>
</code></pre> 
<p><strong>2. 执行DQL语句（查询语句）</strong></p> 
<p><img src="https://images2.imgbox.com/c7/f8/nBKVJD3n_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token class-name">ReseltSet</span> <span class="token function">execueteQuery</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token comment">// 执行给定的 sql语句，该语句返回单个 ResultSet 对象。	</span>
</code></pre> 
<h4><a id="42___472"></a>4.2 代码实现</h4> 
<p><strong>1. Statement 对象执行DML语句</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
  * 执行DML语句
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. 定义sql</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update account set money = 3000 where id = 1"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 获取执行sql的对象 Statement</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 5. 执行sql</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行完DML语句，返回受影响的行数</span>
    
    <span class="token comment">// 6. 处理结果</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改成功~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改失败~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 7. 释放资源</span>
    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2. Statement 对象执行DDL语句</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
  * 执行DDL语句
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDDL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. 定义sql</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"drop database db2"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 获取执行sql的对象 Statement</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 5. 执行sql</span>
    <span class="token keyword">int</span> count <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行完DDL语句，可能是 0</span>
    
    <span class="token comment">// 6. 处理结果</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 7. 释放资源</span>
    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><mark>注意：以后开发很少使用 Java代码操作DDL语句</mark></p> 
<h4><a id="43_Statement__551"></a>4.3 Statement 对象应用案例</h4> 
<p><strong>需求：查询 account账户表数据，封装为 Account对象，并且存储到ArrayList集合中</strong></p> 
<p><img src="https://images2.imgbox.com/4b/42/FskA1evL_o.png" alt=""></p> 
<p><strong>代码实现</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
  * 查询account 账户表数据，封装为Account对象，并且存储到ArrayList集合中
  * 1. 定义实体类 Account。简单的定义三个字段id、name、money，此处未提供定义代码
  * 2. 查询数据，封装到 Account对象中
  * 3. 将Account对象存入ArrayList集合中
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testResultSet2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">//2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//3. 定义sql</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from account"</span><span class="token punctuation">;</span>

    <span class="token comment">//4. 获取statement对象</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//5. 执行sql,返回查询结果集</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建集合</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">// 6. 将结果集中的数据存入集合中</span>
    <span class="token comment">// 6.1 光标向下移动一行，并且判断当前行是否有数据</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.2 获取数据  getXxx()</span>
        <span class="token keyword">int</span> id <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> money <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token string">"money"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//6.3 赋值</span>
        account<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6.4 存入集合</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 输出集合数据</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//7. 释放资源</span>
    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5_PreparedStatement__619"></a>5. PreparedStatement 接口</h3> 
<p><strong><code>PreparedStatement</code>接口的作用：预编译SQL语句并执行SQL语句；预防SQL注入问题。</strong></p> 
<p>对上面的作用中<strong>SQL注入问题</strong>大家肯定不理解。那我们先对 SQL注入问题进行说明。</p> 
<h4><a id="51__SQL_627"></a>5.1 什么是SQL注入</h4> 
<p><strong><mark>SQL注入</mark>是指不法分子通过操作输入的内容，来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。</strong></p> 
<h4><a id="52__SQL_632"></a>5.2 代码模拟SQL注入问题</h4> 
<p><strong>SQL注入漏洞场景</strong>：假如某个网站的数据库中的用户表中存储了该网站所有用户的用户名和密码，我们在登录某个网页时必须要输入用户表中存在的用户名和密码才能成功登录。若该网站在对用户表的数据执行SQL 查询的方式和我们上面使用Statement 对象的一样，则会存在SQL注入漏洞，即非网站用户的不法分子可以通过输入某种特殊的密码成功登录该网站。</p> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.假设下面的用户名和密码是不法分子输入的，用户表中不存在该用户</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"sjdljfld"</span><span class="token punctuation">;</span><span class="token comment">// 用户名随便</span>
    <span class="token class-name">String</span> pwd <span class="token operator">=</span> <span class="token string">"' or '1' = '1"</span><span class="token punctuation">;</span><span class="token comment">// 密码要和此处的密码一样（逻辑类似也行）</span>
    
    <span class="token comment">// 定义 SQL语句，这个语句是网站去用户表中查询用户记录的语句</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_user where username = '"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"' and password = '"</span> <span class="token operator">+</span> pwd <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4.获取stmt对象</span>
    <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 5.执行sql语句</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 6.判断登录是否成功，如果rs 中存在数据，即代表能在表中查询到用户记录，则可以登录成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录成功~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录失败~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//7. 释放资源</span>
    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><mark>上面控制台输出的结果是 “登陆成功~”。明明用户表中并不存在不法分子输入的用户名和密码，为什么执行SQL 语句后返回的结果集中竟然会有数据呢？这就是上面所说的 SQL注入漏洞。</mark></p> 
<p><strong>SQL注入漏洞的原理：上面代码中最终进行查询的sql 语句是将不法分子输入的用户名和密码拼接后的 sql 语句，拼接后的 sql语句如下：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'sjdljfld'</span> <span class="token operator">and</span> password <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">or</span> <span class="token string">'1'</span> <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
</code></pre> 
<p>从上面语句可以看出，条件 <code>username = 'sjdljfld' and password = ''</code> 无论是否满足，<code>or</code> 后面的条件 <code>'1' = '1'</code> 是始终满足的，因此最终该查询条件是一定成立的，所以返回的查询结果为 true。按照逻辑，不法分子就可以正常的进行登陆了。而这就是<mark>SQL注入漏洞</mark>问题。</p> 
<p><strong>那么该如何解决？这里就可以将SQL语句的执行对象 <code>Statement</code> 换成 <code>PreparedStatement</code> 对象。</strong></p> 
<p>接下来我们来学习另一个执行SQL语句的对象 <code>PreparedStatement</code> ，该对象可以预防 SQL注入的问题，并且还可以预编译SQL 语句，提高性能。</p> 
<h4><a id="53__PreparedStatement__694"></a>5.3 PreparedStatement 概述</h4> 
<p><mark><strong>PreparedStatement 作用：（1）预编译 SQL语句并执行语句；（2）预防 SQL注入问题。</strong></mark></p> 
<p><strong>1. 获取 PreparedStatement 对象：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// 定义SQL语句, SQL语句中的参数值，使用占位符 ？替代</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user where username = ? and password = ?"</span><span class="token punctuation">;</span>

<span class="token comment">// 通过 Connection 对象获取执行SQL语句的对象 PreparedStatement，并传入对应的SQL语句，此时会对SQL 语句进行预编译</span>
<span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>2. 设置参数值</strong></p> 
<p>上面的 sql语句中的参数使用了<code>?</code>进行占位，在正式执行 sql 语句之前肯定要设置这些占位符<code>?</code> 的值。</p> 
<blockquote> 
 <p><strong><code>PreparedStatement</code>对象中的 <code>setXxx(参数1，参数2)</code>方法：给占位符<code>?</code> 赋值。</strong></p> 
 <ul><li>Xxx：即数据类型 。如：<code>setInt (参数1，参数2);</code></li><li>参数1： 占位符 <code>？</code>的索引编号，从1 开始。</li><li>参数2： 占位符<code>？</code>对应的值。</li></ul> 
</blockquote> 
<p><strong>3. 执行SQL语句</strong></p> 
<blockquote> 
 <p><strong><code>executeUpdate();</code> 执行DDL语句和DML语句</strong></p> 
 <p><strong><code>executeQuery();</code> 执行DQL查询语句</strong></p> 
</blockquote> 
<p><mark>注意：调用这两个方法时不需要再传递SQL语句了，是因为在获取 SQL语句执行对象 <code>PreparedStatement</code>时已经对 SQL语句进行预编译了。</mark></p> 
<h4><a id="54___PreparedStatement_SQL_734"></a>5.4 使用 PreparedStatement 改进刚才存在SQL注入漏洞的代码</h4> 
<p><strong>1. 改进 DQL 查询语句（版本一），代码如下：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPreparedStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 假设下面的用户名和密码是不法分子输入的，用户表中不存在该用户</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> pwd <span class="token operator">=</span> <span class="token string">"' or '1' = '1"</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.定义sql语句</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_user where username = ? and password = ?"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4.获取执行sql语句的 PreparedStatement 对象，注意此处要传递 sql语句</span>
    <span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 5.设置占位符 ？的值，下面的1和2 分别代表占位符的序号</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 给第一个？ 赋值 name</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 给第二个？ 赋值 pwd</span>
    
    <span class="token comment">// 6.执行sql语句，不需要再传入 sql语句了</span>
    <span class="token comment">// 注意：执行DQL查询语句使用 executeQuery()方法；如果执行的是 DML语句(update, insert, delete。。。)，则使用的是 executeUpdate()方法。</span>
	<span class="token comment">// ResultSet resultSet = pstmt.executeQuery(sql); 该语句会报错</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> pstmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 判断登录是否成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录成功~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录失败~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//7. 释放资源</span>
    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>执行上面语句后，输出结果为 “登录失败~”，成功解决了<mark>SQL注入漏洞</mark>。</strong></li></ul> 
<p><strong>那么<code>PreparedStatement</code>又是如何解决该漏洞的？原来它是将特殊字符进行了转义，转义后的SQL语句如下：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> username <span class="token operator">=</span> <span class="token string">'sjdljfld'</span> <span class="token operator">and</span> password <span class="token operator">=</span> <span class="token string">'\' or \'1\' = \'1'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>此时执行该语句，则程序会报错，不法分子不能再非法登录网站了。</li></ul> 
<p><strong>2. 执行 DML语句，代码如下：</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 演示PreparedStatement使用 dml语句
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"all"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreparedStatementDML_</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 1. 注册驱动</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//建议写上</span>

        <span class="token comment">// 2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 组织SqL语句</span>
        <span class="token comment">// 删除表中记录</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"delete from admin where name = ?"</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 4. 获取执行sql语句的 PreparedStatement 对象，注意此处要传递 sql语句</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 5. 给占位符 ? 赋值</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 6. 执行 dml 语句使用 executeUpdate()方法</span>
        <span class="token keyword">int</span> rows <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rows <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"执行成功"</span> <span class="token operator">:</span> <span class="token string">"执行失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 7. 关闭连接</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="55__PreparedStatement__836"></a>5.5 PreparedStatement 对象的原理</h4> 
<blockquote> 
 <p><strong><code>PreparedStatement</code>对象的好处：</strong></p> 
 <ul><li>预编译SQL语句，性能更高</li><li>防止SQL注入：<mark>将敏感字符进行转义</mark></li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6a/dd/WMBjk31S_o.png" alt=""></p> 
<p><strong>Java代码操作数据库流程如上图所示：</strong></p> 
<ol><li> <p>将sql语句发送到MySQL服务器端</p> </li><li> <p>MySQL服务端会对SQL语句进行如下操作：</p> 
  <ul><li> <p><strong>检查SQL语句</strong>：检查SQL语句的语法是否正确。</p> </li><li> <p><strong>编译SQL语句</strong>：将SQL语句编译成可执行的函数。</p> 
    <blockquote> 
     <p><strong>检查SQL和编译SQL</strong>花费的时间比<strong>执行SQL</strong>的时间还要长。如果我们只是重新设置SQL语句中的参数，那么检查SQL语句和编译SQL语句这两步操作将不需要重复执行。这样就提高了性能。</p> 
    </blockquote> </li><li> <p><strong>执行SQL语句</strong></p> </li></ul> </li></ol> 
<p><strong>接下来我们通过查询日志来看一下<code>PreparedStatement 对象</code>预编译SQL语句的原理。</strong></p> 
<p><strong>1. 开启<code>PreparedStatement</code> 对象的预编译功能</strong></p> 
<p>在代码中编写数据库的 <code>url</code> 时需要加上以下参数键值对来开启预编译功能。而我们之前根本就没有开启<strong>预编译功能</strong>，只是解决了<strong>SQL注入漏洞</strong>。开启预编译功能参数键值对如下：</p> 
<pre><code class="prism language-sql">useServerPrepStmts<span class="token operator">=</span><span class="token boolean">true</span>
</code></pre> 
<p><strong>2. 配置MySQL执行日志（重启 mysql服务后生效）</strong></p> 
<p>在mysql 的配置文件<code>my.ini</code>中添加如下配置：</p> 
<pre><code class="prism language-ini">log-output=FILE
general-log=1
general_log_file="D:\mysql.log"
slow-query-log=1
slow_query_log_file="D:\mysql_slow.log"
long_query_time=2
</code></pre> 
<p><strong>3. Java测试代码如下：</strong></p> 
<pre><code class="prism language-java"> <span class="token comment">/**
   * PreparedStatement 预编译SQL语句原理
   */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testPreparedStatement2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1. 注册驱动</span>
    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建议写上</span>
    
    <span class="token comment">//2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
    <span class="token comment">// 在 url 中添加 useServerPrepStmts=true 参数键值对开启预编译功能</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false&amp;useServerPrepStmts=true"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
    <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3.接收用户输入的用户名和密码</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> pwd <span class="token operator">=</span> <span class="token string">"' or '1' = '1"</span><span class="token punctuation">;</span>

    <span class="token comment">// 4.定义sql语句</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_user where username = ? and password = ?"</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取 pstmt对象</span>
    <span class="token class-name">PreparedStatement</span> pstmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 设置占位符 ？的值</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> pwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行sql语句</span>
    rs <span class="token operator">=</span> pstmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 重新设置占位符 ？的值</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 再次执行sql语句</span>
    rs <span class="token operator">=</span> pstmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 判断登录是否成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录成功~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"登录失败~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//7. 释放资源</span>
    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    pstmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>4. 执行SQL语句，查看 <code>D:\mysql.log</code> 日志如下:</strong></p> 
<p><img src="https://images2.imgbox.com/6b/1a/8KFmhIbN_o.png" alt="在这里插入图片描述"></p> 
<p><mark>上图中第三行中的 <code>Prepare</code> 是对SQL语句进行了预编译。第四行和第五行是执行了两次SQL语句，而第二次执行SQL语句前并没有再对SQL语句进行预编译。由此可以看出<code>PreparedStatement</code>对象可以提前对 SQL语句进行预编译，提高了性能。</mark></p> 
<h4><a id="56__954"></a>5.6 小结</h4> 
<p>在获取<code>PreparedStatement</code>对象的同时，便会将 sql语句发送给 mysql服务器进行<strong>检查和编译</strong>（检查和编译这些步骤若在执行sql 语句时才进行会很耗时）。</p> 
<p>因此在<strong>执行sql语句</strong>时就不用对其再进行检查和编译了，速度更快。</p> 
<p>如果 sql语句的模板一样，则只需要进行一次检查和编译，而更改语句的参数多次执行查询时便不再需要进行<strong>检查和编译</strong>，这样会大大提高性能。</p> 
<h3><a id="6_JDBC_API__964"></a>6. JDBC API 小结</h3> 
<p><img src="https://images2.imgbox.com/d4/ff/EAZ9kgUo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1f/c6/X2psIbxw_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__JDBCUtils__968"></a>四. 封装 JDBCUtils 工具类</h2> 
<h3><a id="1__JDBCUtils__970"></a>1. JDBCUtils 的封装</h3> 
<p>在 <code>JDBC</code> 中，<strong>获取数据库的连接</strong>和<strong>释放资源</strong>的操作是经常使用到的，因此可以将连接数据库和释放资源的操作封装为一个工具类 <strong>JDBCUtils</strong>，这样会简化我们的代码。</p> 
<p><strong><code>JDBCUtils</code> ：是一个工具类，完成 mysql 的连接和关闭资源。</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 这是一个工具类，完成与 mysql的连接和关闭资源
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtils</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 定义相关的属性(4个), 因为只需要一份，因此使用 static</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> user<span class="token punctuation">;</span> <span class="token comment">//用户名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span> <span class="token comment">//密码</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span> <span class="token comment">//url</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> driver<span class="token punctuation">;</span> <span class="token comment">//驱动名</span>

    <span class="token comment">// 在静态代码块初始化</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 从配置文件导入数据库的信息</span>
            <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src\\mysql.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 获取数据库相关的属性值</span>
            user <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            url <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            driver <span class="token operator">=</span> properties<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 在实际开发中，可以这样处理</span>
            <span class="token comment">// 1. 将编译异常转成 运行异常</span>
            <span class="token comment">// 2. 调用者，可以选择捕获该异常，也可以选择默认处理该异常，比较方便</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个静态方法用于连接数据库, 返回与数据库的一个连接对象 Connection</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//1. 将编译异常转成 运行异常</span>
            <span class="token comment">//2. 调用者，可以选择捕获该异常，也可以选择默认处理该异常，比较方便.</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 定义一个静态方法用于关闭数据库相关资源</span>
    <span class="token comment">/*
        1. ResultSet 结果集
        2. Statement 或者 PreparedStatement 执行SQL语句的对象
        3. Connection 数据库连接
        4. 如果需要关闭资源，就传入对象，否则传入 null
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> set<span class="token punctuation">,</span> <span class="token class-name">Statement</span> statement<span class="token punctuation">,</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 判断是否为 null</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>set <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                set<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>statement <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 将编译异常转成运行异常抛出</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>将<strong>获取数据库的连接</strong>和<strong>释放资源</strong>的操作成功封装为一个工具类后，在之后我们如果需要这些操作，就只需要调用该工具类中的相关方法，简化代码开发。</p> 
<h3><a id="2_JDBCUtils__1046"></a>2. JDBCUtils 测试</h3> 
<p><strong>操作 actor 表，表结构如下：</strong></p> 
<p><img src="https://images2.imgbox.com/a8/7b/OTCsSgRy_o.png" alt="在这里插入图片描述"></p> 
<p><strong>测试代码如下</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 该类演示如何使用JDBCUtils工具类，完成dml 语句和 select查询语句的使用
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtils_Use</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 完成 DQL 查询语句</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1. 声明JDBC 中需要用到的几个变量</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> set <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        
        <span class="token comment">//2. 组织一个sql语句</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from actor where id = ?"</span><span class="token punctuation">;</span>

        <span class="token comment">//3. 调用JDBCUtils工具类中的方法，获取数据库的连接，并获取执行sql语句的对象 PreparedStatement</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// com.mysql.jdbc.JDBC4Connection</span>
            preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 给占位符 ? 赋值</span>
            <span class="token comment">// 执行sql, 得到结果集</span>
            set <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 遍历该结果集，打印输出数据</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> id <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> sex <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Date</span> borndate <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"borndate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> phone <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> borndate <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 调用JDBCUtils工具类中的方法关闭相关资源</span>
            <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 完成 DML 语句，insert , update, delete</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//1. 声明JDBC 中需要用到的几个变量</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">//2. 组织一个sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update actor set name = ? where id = ?"</span><span class="token punctuation">;</span>
        
        <span class="token comment">//3. 调用JDBCUtils工具类中的方法，获取数据库的连接，并获取执行sql语句的对象 PreparedStatement</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给占位符 ? 赋值</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"周星驰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行sql语句</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 调用JDBCUtils工具类中的方法关闭相关资源</span>
            <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>经过测试不难看出，将<strong>获取数据库的连接</strong>和<strong>释放资源</strong>的操作成功封装为一个工具类后，大大方便了我们使用 <code>JDBC</code>。</p> 
<h2><a id="_JDBC__1129"></a>五. JDBC 事务管理</h2> 
<p><strong><mark>数据库事务（Transaction）</mark> 是由若干个SQL语句构成的一个操作序列，有点类似于Java 线程中的<code>synchronized</code>同步。数据库系统保证在一个事务中的所有SQL语句要么全部执行成功，要么全部不执行，即数据库事务具有<code>ACID</code>特性：</strong></p> 
<ul><li>Atomicity：原子性</li><li>Consistency：一致性</li><li>Isolation：隔离性</li><li>Durability：持久性</li></ul> 
<p><strong>数据库事务可以并发执行，而数据库系统从效率考虑，对事务定义了不同的4种隔离级别。分别对应可能出现的数据不一致的情况：</strong></p> 
<table><thead><tr><th align="center">Isolation Level</th><th align="center">脏读（Dirty Read）</th><th align="center">不可重复读（Non Repeatable Read）</th><th align="center">幻读（Phantom Read）</th></tr></thead><tbody><tr><td align="center">Read Uncommitted</td><td align="center">Yes</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="center">Read Committed</td><td align="center">-</td><td align="center">Yes</td><td align="center">Yes</td></tr><tr><td align="center">Repeatable Read</td><td align="center">-</td><td align="center">-</td><td align="center">Yes</td></tr><tr><td align="center">Serializable</td><td align="center">-</td><td align="center">-</td><td align="center">-</td></tr></tbody></table> 
<p>对应用程序来说，数据库事务非常重要，很多运行着关键任务的应用程序，都必须依赖数据库事务，来保证程序运行的结果正确。</p> 
<blockquote> 
 <p>举个例子：假设小明准备给小红支付100元，两人在数据库中对应的用户id 分别是<code>123</code>和<code>456</code>，那么用两条SQL语句操作如下：</p> 
</blockquote> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">-</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">123</span> <span class="token operator">AND</span> balance <span class="token operator">&gt;=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">UPDATE</span> accounts <span class="token keyword">SET</span> balance <span class="token operator">=</span> balance <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">456</span><span class="token punctuation">;</span>
</code></pre> 
<p>这两条语句必须以事务方式执行才能保证业务的正确性，因为一旦第一条SQL执行成功而第二条SQL失败的话，系统的钱就会凭空减少100。而有了<strong>事务</strong>，要么这笔转账全部成功；要么转账操作失败，双方账户的钱都不变。</p> 
<p><strong>先回顾一下MySQL事务管理的操作：</strong></p> 
<blockquote> 
 <p><strong>开启事务 ： BEGIN; 或者 START TRANSACTION</strong></p> 
 <p><strong>提交事务 ： COMMIT</strong></p> 
 <p><strong>回滚事务 ： ROLLBACK</strong></p> 
</blockquote> 
<p><strong>要在 JDBC中执行事务，本质上就是如何把多条SQL语句包裹在一个<mark>数据库事务</mark>中执行。接下来学习 JDBC 中事务管理的方法。<code>Connection</code> 接口中定义了3个对应事务管理的方法：</strong></p> 
<p><strong>1. 开启事务</strong></p> 
<p>参数 <code>autoCommit</code> ：表示是否自动提交事务，true 表示自动提交事务，false 表示手动提交事务。而<strong>开启事务</strong>需要将该参数设为为 false。</p> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> autoCommit<span class="token punctuation">)</span> <span class="token comment">// 将此连接的事务自动提交模式设置为给定状态</span>
</code></pre> 
<p><strong>2. 提交事务</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 使上次提交/回滚以来所做的所有更改成为永久状态，并释放此 Connection对象当前持有的所有数据库锁。</span>
</code></pre> 
<p><strong>3. 回滚事务</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">// 撤销当前事务中所做的所有更改，并释放此 Connection对象当前持有的所有数据库锁。</span>
</code></pre> 
<p><strong>举一个案例，代码实现如下：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * JDBC 事务：Connection,管理事务
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCDemo3_Connection</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1. 注册驱动</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//2. 获取连接：如果连接的是本机mysql并且端口是默认的 3306 可以简化书写</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"jdbc:mysql:///db1?useSSL=false"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"root"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"1234"</span><span class="token punctuation">;</span>
        <span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//3. 定义sql</span>
        <span class="token class-name">String</span> sql1 <span class="token operator">=</span> <span class="token string">"update account set money = 3000 where id = 1"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sql2 <span class="token operator">=</span> <span class="token string">"update account set money = 3000 where id = 2"</span><span class="token punctuation">;</span>
        
        <span class="token comment">//4. 获取普通执行sql语句的对象 Statement</span>
        <span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 事务管理</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ============开启事务==========</span>
            conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行sql</span>
            <span class="token keyword">int</span> count1 <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//受影响的行数</span>
            <span class="token comment">// 处理结果</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// 此处会产生异常</span>
            
            <span class="token comment">// 执行sql</span>
            <span class="token keyword">int</span> count2 <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//受影响的行数</span>
            <span class="token comment">// 处理结果</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count2<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// ============提交事务==========</span>
            <span class="token comment">// 程序运行到此处，说明没有出现任何问题，则需求提交事务</span>
            conn<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ============回滚事务==========</span>
            <span class="token comment">// 程序在执行过程中如果出现了异常，就会tiao到这个地方，此时就需要回滚事务</span>
            conn<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行过程发生了异常，撤销执行的 sql语句。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            conn<span class="token punctuation">.</span><span class="token function">setAutoCommit</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 关闭资源</span>
            <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> stmt<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li> <p>其中，开启事务的关键代码是<code>conn.setAutoCommit(false)</code>，表示关闭事务的自动提交。手动提交事务的代码在执行完指定的若干条SQL语句后，调用<code>conn.commit()</code>方法<strong>手动提交事务</strong>。</p> </li><li> <p>要注意事务不是总能成功的，如果事务提交失败，会抛出<strong>SQL异常</strong>（也可能在执行SQL语句的时候就抛出了），此时我们必须捕获该异常并调用<code>conn.rollback()</code>方法来进行<strong>回滚事务</strong>。最后，在<code>finally</code>中通过<code>conn.setAutoCommit(true)</code>方法把自动提交事务的状态恢复到初始值并关闭数据库的资源。</p> </li></ul> 
<p>实际上，默认情况下，我们获取到<code>Connection</code>连接后，总是处于<strong>事务“自动提交”模式</strong>，也就是每执行一条SQL语句，都会作为一个事务<strong>自动提交</strong>。只要关闭了<code>Connection</code>的<code>autoCommit</code>模式，那么就可以在一个事务中执行多条SQL语句，一个事务以<code>commit()</code>方法手动提交结束。</p> 
<p><mark><strong>如果要设定事务的隔离级别，可以使用如下代码：</strong></mark></p> 
<pre><code class="prism language-java"><span class="token comment">// 设定事务的隔离级别为 READ COMMITTED:</span>
conn<span class="token punctuation">.</span><span class="token function">setTransactionIsolation</span><span class="token punctuation">(</span><span class="token class-name">Connection</span><span class="token punctuation">.</span>TRANSACTION_READ_COMMITTED<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>如果没有调用上述方法，那么会使用数据库的默认隔离级别。MySQL的默认隔离级别是<code>REPEATABLE_READ</code>。</li></ul> 
<h2><a id="_JDBC__1272"></a>六. JDBC 批处理</h2> 
<p>使用 JDBC操作数据库的时候，经常会执行一些<strong>批量操作</strong>。例如，一次性给某个会员增加若干张优惠券，我们可以执行以下SQL语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> coupons <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">,</span> expires<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'DISCOUNT'</span><span class="token punctuation">,</span> <span class="token string">'2030-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> coupons <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">,</span> expires<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">234</span><span class="token punctuation">,</span> <span class="token string">'DISCOUNT'</span><span class="token punctuation">,</span> <span class="token string">'2030-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> coupons <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">,</span> expires<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">345</span><span class="token punctuation">,</span> <span class="token string">'DISCOUNT'</span><span class="token punctuation">,</span> <span class="token string">'2030-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> coupons <span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> <span class="token keyword">type</span><span class="token punctuation">,</span> expires<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">,</span> <span class="token string">'DISCOUNT'</span><span class="token punctuation">,</span> <span class="token string">'2030-12-31'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>实际上在使用 <code>JDBC</code> 的<code>PreparedStatement</code>对象执行上面的SQL语句时，只有占位符<code>?</code>不同，SQL语句实际上是一样的：</p> 
<pre><code class="prism language-java"><span class="token comment">// paramsList 集合中存储了若干个优惠券对象。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> params <span class="token operator">:</span> paramsList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">PreparedStatement</span> ps <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">preparedStatement</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO coupons (user_id, type, expires) VALUES (?,?,?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ps<span class="token punctuation">.</span><span class="token function">setLong</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ps<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> params<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> ps<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过一个循环来执行每个SQL语句虽然可行，但是性能很低。MySQL数据库对SQL语句结构相同，只有参数不同的若干条SQL语句可以作为一次<strong>batch执行</strong>，即<strong>批量执行</strong>。MySQL对于这种操作有特别优化，速度远远快于使用循环执行多条SQL语句。</p> 
<p>在 <code>JDBC</code>代码中，我们可以利用MySQL数据库的这一特性，把同一个SQL语句但参数不同的若干次操作合并为一次<strong>batch 执行</strong>操作（批处理操作）。<code>JDBC</code> 的<mark>批处理操作</mark>中包含以下几个方法：</p> 
<blockquote> 
 <p><code>addBatch()</code>：添加需要批量处理的SQL语句或者参数进批处理包</p> 
 <p><code>executeBatch()</code>：执行批处理包里的所有SQL语句</p> 
 <p><code>clearBatch()</code>：清空批处理包里面的所有SQL语句</p> 
</blockquote> 
<p>我们以<mark>批量插入</mark>为例，示例代码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">batch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"insert into admin values(null, ?, ?)"</span><span class="token punctuation">;</span><span class="token comment">// admin表结构不重要</span>
    <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开始执行"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token comment">// 设置每条sql 语句的参数</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"jack"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 逐条将 sql 语句加入到批处理包中，此时还没有执行sql语句</span>
        preparedStatement<span class="token punctuation">.</span><span class="token function">addBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 当有1000条记录时，再一次批量执行sql语句</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 将批处理包里面的sql语句全部执行</span>
            <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ns <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行完成后，清空批处理包中所有的sql语句</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">clearBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 关闭连接</span>
    <span class="token class-name">JDBCUtils</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行<strong>批处理操作</strong>和执行单条SQL语句的不同点在于，执行<strong>批处理操作</strong>需要对同一个<code>PreparedStatement</code>对象反复设置参数并调用<code>addBatch()</code>方法，这样就相当于给一条SQL语句加上了多组参数，相当于变成了 <strong>“多条”</strong> SQL语句。</p> 
<p>第二个不同点是<strong>批处理操作</strong>执行SQL语句时调用的不是<code>executeUpdate()</code>方法，而是<code>executeBatch()</code>方法，因为我们给一条SQL语句设置了多组参数，相应的，执行后的返回结果也是多个<code>int</code>值，因此返回类型为<code>int[]</code>数组。遍历<code>int[]</code>数组即可获取SQL语句的每组参数执行后影响的结果数量。</p> 
<h2><a id="__1347"></a>七. 数据库连接池</h2> 
<h3><a id="1__1349"></a>1. 数据库连接池简介</h3> 
<blockquote> 
 <p><strong>数据库连接池是个容器，负责分配和管理 数据库连接(Connection)。</strong></p> 
 <ul><li>它允许多个应用程序<mark>重复使用</mark>一个现有的空闲<code>Connection</code>对象，而不是再重新建立一个。</li><li>它可以释放空闲时间超过最大空闲时间的<code>Connection</code>对象来避免因为没有释放数据库连接而引起的数据库连接遗漏。</li><li>好处： 
   <ul><li>资源重用</li><li>提升系统响应速度</li><li>避免数据库连接遗漏</li></ul> </li></ul> 
</blockquote> 
<p>之前我们代码中使用的<strong>数据库连接</strong>都是新建一个<code>Connection</code>对象，而我们在使用完毕后就会将其销毁。这样重复创建销毁的过程其实是特别耗费计算机的性能以及时间的。</p> 
<p><strong>而使用了数据库连接池后，就能复用<code>Connection</code>对象，如下图：</strong></p> 
<p><img src="https://images2.imgbox.com/3c/fa/Sglr1SaE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/55/f9/f76wD6dS_o.png" alt=""></p> 
<p><strong>数据库连接池</strong>是在一开始就创建好了一些<strong>连接（<code>Connection</code>）对象</strong>存储起来。当用户需要连接数据库时，不需要再创建新的连接，只需要从连接池中获取一个空闲的连接进行使用即可。在连接使用完毕后，用户再将连接<strong>归还</strong>给连接池。</p> 
<p>这样就可以起到<strong>资源复用</strong>的效果，也节省了频繁创建连接、销毁连接所花费的时间，从而提升了系统响应的速度。</p> 
<h3><a id="2__1376"></a>2. 数据库连接池种类</h3> 
<p>JDBC 连接池有一个标准的接口**<code>javax.sql.DataSource</code>**，注意这个类位于Java标准库中，但仅仅是接口。要使用 JDBC连接池，我们必须选择一个 JDBC连接池接口的实现类。常用的 JDBC 连接池有：</p> 
<ul><li>DBCP</li><li>C3P0</li><li>Druid</li></ul> 
<p>有了数据库连接池后，以后我们就不需要通过 <code>DriverManager</code> 对象获取 <code>Connection</code> 对象了，而是通过<strong>连接池（<code>DataSource</code>）</strong> 来获取 <code>Connection</code> 对象。</p> 
<p>目前常用的连接池是：<mark>Druid 连接池</mark>，它的性能比其他两个会好一些。</p> 
<p><strong>Druid（德鲁伊）连接池</strong></p> 
<ul><li>Druid 连接池是阿里巴巴开源的数据库连接池项目。</li><li>功能强大，性能优秀，是Java语言最好的数据库连接池之一。</li></ul> 
<h3><a id="3_Druid__1392"></a>3. Druid 的使用</h3> 
<blockquote> 
 <ul><li><strong>导入jar包 druid-1.1.12.jar</strong></li><li><strong>定义配置文件</strong></li><li><strong>加载配置文件</strong></li><li><strong>获取数据库连接池对象</strong></li><li><strong>获取连接</strong></li></ul> 
</blockquote> 
<p><strong>第一步，现在想要通过代码实现<code>druid</code>连接池获取连接，首先需要先将<code>druid</code>的 jar包放到项目下的 lib下并添加为库文件。</strong> 如下图：</p> 
<p><img src="https://images2.imgbox.com/d1/0c/WPEKL4Ry_o.png" alt=""></p> 
<p><strong>第二步，接着就需要创建一个配置文件<code>druid.properties</code>，其中包含数据库的信息。项目结构如下：</strong></p> 
<p><img src="https://images2.imgbox.com/03/f4/SLZAqMW2_o.png" alt="在这里插入图片描述"></p> 
<p>编写的配置文件<code>druid.properties</code>如下：</p> 
<pre><code class="prism language-properties">driverClassName=com.mysql.cj.jdbc.Driver
url=jdbc:mysql:///db1?useSSL=false&amp;useServerPrepStmts=true
username=root
password=1234
# 初始化连接数量
initialSize=5
# 最大连接数
maxActive=10
# 最大等待时间
maxWait=3000
</code></pre> 
<p>通常连接池提供了大量的参数可以配置，例如，维护的最小、最大活动的连接数；指定一个连接在空闲一段时间后自动关闭等，我们需要根据应用程序的负载合理地配置这些参数。此外，大多数连接池都提供了详细的实时状态以便进行监控。</p> 
<h3><a id="4__1432"></a>4. 代码实现连接池</h3> 
<p><strong>1. 使用<code>druid</code>的代码如下（版本一）：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Druid数据库连接池演示
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DruidDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1. 导入jar包</span>
        <span class="token comment">// 2. 定义配置文件</span>
        <span class="token comment">// 3. 加载配置文件</span>
        <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        prop<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"jdbc-demo/src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 注意这个路径是你存放文件的路径</span>
        <span class="token comment">// 4. 创建一个指定参数的数据库连接池, 即获取Druid 连接池</span>
        <span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. 获取数据库连接 Connection</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取到了连接后就可以继续做其他操作了</span>
        
        <span class="token comment">// 6. 释放连接</span>
        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过连接池获取连接时，并不需要指定 JDBC 的相关URL、用户名、密码等信息，因为这些信息已经存储在连接池内部了（也就是我们一开始定义的的配置文件<code>druid.properties</code>中了）。</p> 
<p>一开始，连接池内部并没有连接，所以，第一次调用<code>dataSource.getConnection()</code>，会迫使连接池内部先创建一个<code>Connection</code>对象，再返回给客户端使用。当我们调用<code>connection.close()</code>方法时，不是真正 <strong>“关闭”</strong> 了<code>Connection</code>对象，而是将<code>Connection</code>对象释放回连接池中，以便下次获取<code>Connection</code>对象时能直接得到。</p> 
<p>因此，连接池内部维护了若干个<code>Connection</code>对象，每当有程序调用了<code>dataSource.getConnection()</code>方法，连接池就会选择一个空闲的连接，并把它标记为 <mark>“正在使用”</mark> ，然后返回给程序。如果对程序中调用了<code>Connection.close()</code>方法，那么连接池就会把该连接标记为 <mark>“空闲”</mark> 状态，等待下次调用。这样一来，我们就通过连接池维护了少量<code>Connection</code>对象，但可以频繁地和多个程序进行连接了。</p> 
<p><strong>2. 使用<code>druid</code>的代码如下（版本二：创建一个基于<code>druid</code>数据库连接池的工具类）</strong></p> 
<p>有了数据库连接池后，我们就可以改进我们之前创建的用于简化我们开发操作的<code>JDBCUtils</code>工具类了。新的工具类<code>JDBCUtilsByDruid</code>如下：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 基于druid数据库连接池的工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtilsByDruid</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">;</span>

    <span class="token comment">// 在静态代码块完成数据库连接池的初始化</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"jdbc-demo/src/druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dataSource <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 编写 getConnection 方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 关闭资源, 注意：在数据库连接池技术中，close()方法不是真的断掉连接，而只是将连接Connection对象归还给连接池</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> resultSet<span class="token punctuation">,</span> <span class="token class-name">Statement</span> statement<span class="token punctuation">,</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>statement <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试使用 druid 工具类获取数据库连接</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 测试使用druid 工具类获取连接
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"all"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtilsByDruid_USE</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 1. 得到连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 组织一个sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from actor where id &gt;= ?"</span><span class="token punctuation">;</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> set <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 3. 创建PreparedStatement 对象</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 看一下获取到的连接的运行类型 com.alibaba.druid.pool.DruidPooledConnection</span>
            
            preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 给占位符 ? 赋值</span>
            <span class="token comment">// 4. 执行sql, 得到结果集</span>
            set <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 5. 遍历该结果集</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> id <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// getName()</span>
                <span class="token class-name">String</span> sex <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// getSex()</span>
                <span class="token class-name">Date</span> borndate <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"borndate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> phone <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> borndate <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 6. 关闭资源，即将连接放回连接池中</span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_Apachedbutils__1565"></a>八. Apache–dbutils 工具类开发</h2> 
<h3><a id="1_Apachedbutils__1567"></a>1. Apache–dbutils 的引入</h3> 
<p><strong>我们之前在使用<code>PreparedStatement</code>对象的<code>executeQuery()</code>方法查询数据库表中的数据时，返回的结果是<code>ResultSet</code>类型，可是在使用原始的<code>ResultSet</code>结果集时，会出现一些问题：</strong></p> 
<ol><li><code>ResultSet</code> 结果集和 <code>Connection</code>连接是相关联的，在关闭<code>Connection</code>连接后，我们得到的<code>ResultSet</code>结果集也不能使用了。</li><li>使用<code>ResultSet</code>结果集不利于管理获取到的数据。</li></ol> 
<p><strong>这些问题的解决方法是将数据库中的一张表映射为 Java 中的一个类，这些和表相映射的Java 类我们称为<code>JavaBean/ PoJo/ Domain</code>类。我们再将 <code>ResultSet</code> 结果集中的每条记录数据封装成 <code>JavaBean</code>类的一个个对象，最后将这些对象存储到 <code>ArrayList</code> 集合中。示意图如下：</strong></p> 
<p><img src="https://images2.imgbox.com/69/fd/C4ostkw4_o.png" alt="在这里插入图片描述"></p> 
<p><strong>创建一个Java 类对应数据库中的一张表。代码如下：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Actor对象和 actor表的记录对应
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Actor</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// Java中的 Bean, POJO, Domain 类，三种叫法</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> borndate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token comment">// 一定要定义一个无参构造器[反射需要]</span>
    <span class="token keyword">public</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> sex<span class="token punctuation">,</span> <span class="token class-name">Date</span> borndate<span class="token punctuation">,</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>borndate <span class="token operator">=</span> borndate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">String</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getBorndate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> borndate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBorndate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> borndate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>borndate <span class="token operator">=</span> borndate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"\nActor{"</span> <span class="token operator">+</span>
                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", sex='"</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", borndate="</span> <span class="token operator">+</span> borndate <span class="token operator">+</span>
                <span class="token string">", phone='"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>将查询得到的<code>ResultSet</code>结果集数据封装成一个Arraylist 集合。代码演示：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 用土方法演示将查询得到的结果集数据封装成一个Arraylist 集合
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"all"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtilsByDruid_USE</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Actor</span><span class="token punctuation">&gt;</span></span> <span class="token function">testSelectToArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 1. 得到连接</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 组织一个sql</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from actor where id &gt;= ?"</span><span class="token punctuation">;</span>
        <span class="token class-name">PreparedStatement</span> preparedStatement <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ResultSet</span> set <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建 ArrayList对象,存放actor对象</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Actor</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. 通过JDBCUtilsByDruid 获取数据库连接池中的一个连接，并获取一个 PreparedStatement 对象</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            preparedStatement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
            preparedStatement<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 给占位符 ?赋值</span>
            <span class="token comment">// 4. 执行sql, 得到结果集</span>
            set <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 5. 遍历该结果集，取出每条记录，封装成对应的 JavaBean类对象</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> id <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> sex <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"sex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Date</span> borndate <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token string">"borndate"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> phone <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 6. 把得到的resultset 的一条记录，封装成一个 Actor对象，并放入到list集合中</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> borndate<span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
			
            <span class="token comment">// 遍历list 集合，输出每个actor 对象</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Actor</span> actor <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"id="</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span> <span class="token operator">+</span> actor<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 7. 关闭资源</span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> preparedStatement<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 返回该list集合。因为ArrayList 集合和 Connection连接没有任何关联，所以在释放连接后该集合可以复用</span>
        <span class="token keyword">return</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_dbutils__1719"></a>2. dbutils 的使用</h3> 
<p><strong><code>dbutils</code>：<code>commons-dbutils</code> 是 Apache 组织提供的一个开源 JDBC 工具类库，它是对 JDBC 的封装，使用dbutils 能极大简化 JDBC编码的工作量。常用的类和接口如下：</strong></p> 
<table><thead><tr><th>类或接口</th><th align="center">功能</th></tr></thead><tbody><tr><td>QueryRunner</td><td align="center">该类封装了SQL的执行，是线程安全的。可以实现增、删、改、查、批处理等操作</td></tr><tr><td>ResultSetHandler</td><td align="center">该接口用于处理<code>Java.sql.ResultSet</code>结果集，将数据按要求转换为另一种形式</td></tr><tr><td>ArrayHandler</td><td align="center">把结果集中的第一行数据转成对象数组</td></tr><tr><td>ArrayListHandler</td><td align="center">把结果集中的每一行数据都转成一个数组，再存放到 List中</td></tr><tr><td>BeanHandler</td><td align="center">将结果集中的第一行数据封装到一个对应的 <code>JavaBean</code> 实例中</td></tr><tr><td>BeanListHandler</td><td align="center">将结果集中的每一行数据都封装到一个对应的 <code>JavaBean</code> 实例中，存放到 List中</td></tr><tr><td>ColumnListHandler</td><td align="center">将结果集中某一列的数据存放到 List中</td></tr><tr><td>KeyedHandler(name)</td><td align="center">将结果集中的每行数据都封装到 Map 里，再把这些 Map 再存到一个Map 里，其 key为指定的 key</td></tr><tr><td>MapHandler</td><td align="center">将结果集中的第一行数据封装到一个Map 里 ，key 是列名，value 就是对应的值</td></tr><tr><td>MapListHandler</td><td align="center">将结果集中的每一行数据都封装到一个Map 里，然后再存放到 List中</td></tr></tbody></table> 
<p><strong>应用实例：使用<code>dbutils</code>和<code>Druid</code> 连接池，完成对数据库中<code>actor</code>表的增删改查操作。表结构如下：</strong></p> 
<p><img src="https://images2.imgbox.com/9e/a8/uxDXYr0A_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="21__dbutils__DQL_1745"></a>2.1 使用 dbutils 执行 DQL（查询）操作</h4> 
<p><mark>注意：需要先引入 dbutils 相关的 jar包，将其加入到 Project中。添加 JAR<br> 包的步骤和上面我们添加的一样，此处不再介绍。</mark></p> 
<h5><a id="211__1750"></a>2.1.1 查询的结果是多行记录</h5> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 演示查询的结果是多行记录的情况
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"all"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DBUtils_USE</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQueryMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span> 

        <span class="token comment">// 1. 得到 连接 (druid)</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. 创建 QueryRunner 对象</span>
        <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. 定义sql 语句</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from actor where id &gt;= ?"</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 4. 执行 QueryRunner 对象中的方法进行查询，将查询到的多行记录结果集封装成 List集合</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Actor</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span>
                queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Actor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">/*解读 query()方法：
        
        (1) query() 方法就是执行sql 语句，得到 Resultset结果集 ---封装到 --&gt; ArrayList 集合中，最后返回 ArrayList 集合。
        (2) query() 方法中的参数含义：
        	* connection: 连接
        	* sql : 执行的sql语句
        	* new BeanListHandler&lt;&gt;(Actor.class): 在将 resultset -&gt; Actor 对象 -&gt; 封装到 ArrayList 。底层使用了反射机制 去获取Actor 类的属性，然后进行封装
        	* 1 ：就是给 sql 语句中的占位符 ? 赋值，可以有多个值，因为是可变形参 Object... params
        (3) query()方法结束后, 底层会自动销毁 PreparedStatment 和 Resultset对象
		*/</span>
		
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"输出集合的信息："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Actor</span> actor <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 5. 释放资源</span>
        <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>queryRunner.query()</code> 方法源码分析：</p> 
<pre><code class="prism language-java"><span class="token comment">// 分析 queryRunner.query() 方法:</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Connection</span> conn<span class="token punctuation">,</span> <span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">ResultSetHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> rsh<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token class-name">PreparedStatement</span> stmt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 定义PreparedStatement</span>
    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 接收返回的 ResultSet</span>
    <span class="token class-name">T</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 返回 ArrayList</span>

    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        stmt <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建PreparedStatement</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fillStatement</span><span class="token punctuation">(</span>stmt<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 对 sql 进行 ? 占位符赋值</span>
        rs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行sql,返回resultset</span>
        <span class="token comment">// 将返回的 resultset 转换成 arrayList[result] [使用到反射，对传入class对象处理]</span>
        result <span class="token operator">=</span> rsh<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> var33<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rethrow</span><span class="token punctuation">(</span>var33<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭resultset</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Statement</span><span class="token punctuation">)</span>stmt<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭preparedstatement对象</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 返回 List 集合</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="212__1834"></a>2.1.2 查询的结果是单行记录(即单个对象)</h5> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 演示 apache-dbutils + druid 完成 查询的结果是单行记录(单个对象)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuerySingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1. 得到 连接 (druid)</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 创建 QueryRunner</span>
    <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 3. 定义sql语句</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from actor where id = ?"</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 4. 执行相关的方法，返回单个对象。解读：因为返回的是单行记录&lt;---&gt;单个对象, 因此使用的参数 Hander 是 BeanHandler</span>
    <span class="token class-name">Actor</span> actor <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Actor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 输出对象信息</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. 释放资源</span>
    <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="213__object_1865"></a>2.1.3 查询的结果是单行单列（返回的就是 object对象）</h5> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 演示apache-dbutils + druid 完成查询结果是单行单列-返回的就是object</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testScalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 1. 得到 连接 (druid)</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. 创建 QueryRunner</span>
        <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 定义sql语句</span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select name from actor where id = ?"</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 4. 执行相关的方法，返回单行单列 , 返回的就是Object。解读： 因为返回的是一个对象, 使用的参数 Handler 就是 ScalarHandler</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 输出对象信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5. 释放资源</span>
        <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22__dbutils__DML_update_insert_delete__1896"></a>2.2 使用 dbutils 执行 DML 操作(update, insert, delete 增删改)</h4> 
<p><strong>表和 <code>JavaBean</code> 类的类型映射关系如下：</strong></p> 
<p><img src="https://images2.imgbox.com/97/36/zSpkDXlR_o.png" alt="在这里插入图片描述"></p> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 演示 apache-dbutils + druid 完成 dml 操作(update, insert ,delete)</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 1. 得到 连接 (druid)</span>
    <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 2. 创建 QueryRunner</span>
    <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 3. 这里组织sql 完成 update, insert, delete</span>
    <span class="token comment">// String sql = "update actor set name = ? where id = ?";</span>
    <span class="token comment">// String sql = "insert into actor values(null, ?, ?, ?, ?)";</span>
    <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"delete from actor where id = ?"</span><span class="token punctuation">;</span>

    <span class="token comment">/* 4. 
    解读：
    (1) 执行dml 操作所使用的方法是 queryRunner.update()
    (2) 返回的值是受影响的行数 (affected: 受影响)
    */</span>
    <span class="token keyword">int</span> affectedRow <span class="token operator">=</span> queryRunner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>affectedRow <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"执行成功"</span> <span class="token operator">:</span> <span class="token string">"执行没有影响到表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 5. 释放资源</span>
    <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3_dbutils__1937"></a>3. dbutils 小结</h4> 
<p>为了方便管理我们执行sql 语句后获取到的结果数据，我们使用一个<code>JavaBean</code> 类来映射数据库中的一张表。我们再将 <code>ResultSet</code> 结果集中的每条记录数据封装成 <code>JavaBean</code>类的一个个对象，最后将这些对象存储到 <code>ArrayList</code> 集合中。</p> 
<p>而这些查询、封装和存储的操作，dbutils 已经帮我们封装好了，我们只需要使用 dbutils 中的API，便可以快捷完成开发。</p> 
<p>使用 dbutils 执行 DQL（查询）操作，需要创建一个<code>QueryRunner</code> 对象，所使用的方法是：<code>query(Connection conn, String sql, ResultSetHandler&lt;T&gt; rsh, Object... params)</code>方法。</p> 
<p>使用 dbutils 执行 DML（增、删、改）操作，需要创建一个<code>QueryRunner</code> 对象，所使用的方法是：<code>update(Connection conn, String sql, Object... params)</code>方法。</p> 
<h2><a id="_DAO_BasicDao_1948"></a>九. DAO类和 BasicDao类</h2> 
<h3><a id="1_DAO__1950"></a>1. DAO 类的引入</h3> 
<p><strong><code>apache-dbutils</code>工具类库和<code>Druid</code>连接池简化了 JDBC 开发，但还有不足：</strong></p> 
<ol><li> <p>SQL语句是固定的，不能通过参数传入，通用性不好，需要进行改进，更方便地执行增删改查操作。</p> </li><li> <p>对于 <code>select</code>查询操作，如果有返回值，返回类型不能固定，需要使用泛型。</p> </li><li> <p>将来操作的表很多，业务需求复杂，不可能只靠一个 <code>JavaBean</code>类完成。</p> </li></ol> 
<p><strong>由此引出<code>DAO</code>类 和<code>BasicDAO</code>类，看看在实际开发中，应该如何处理，示意图如下：</strong></p> 
<p><img src="https://images2.imgbox.com/b0/6d/VJsR7AIb_o.png" alt=""><br> <img src="https://images2.imgbox.com/ab/b7/dbrLmWi5_o.png" alt=""></p> 
<p><strong>1. <code>DAO</code>： data access object 数据访问对象</strong></p> 
<p><strong>2.<code>BasicDAO</code>：通用<code>DAO</code>类，是专门和数据库交互的，即完成对数据库（表）的 crud 操作。</strong></p> 
<p><strong>3. 在<code>BaiscDao</code>的基础上，实现一张表对应一个<code>JavaBean</code>实体类并对应一个<mark>专门操作</mark>该表的<code>Dao</code>类，更好的完成功能。比如：<code>Customer</code>表 &lt;==&gt; <code>Customer.Java</code>类（<code>JavaBean</code>）&lt;==&gt; <code>CustomerDao.Java</code>。</strong></p> 
<h3><a id="2__BasicDAO__1978"></a>2. BasicDAO 应用实例</h3> 
<p><img src="https://images2.imgbox.com/16/54/wdpH0Zca_o.png" alt=""></p> 
<p><strong>完成一个简单设计，使用<code>apache-dbutils</code>工具类库和<code>Druid</code>连接池，对数据库中的<code>actor</code>表进行增删改查操作。<code>actor</code>表映射<code>Actor</code>实体类，要求使用<code>ActorDAO</code>类和<code>BasicDAO</code>类对表进行<mark>增删改查</mark>操作。</strong></p> 
<p><code>actor</code>表结构如下：</p> 
<p><img src="https://images2.imgbox.com/0f/fc/pDkdAfw6_o.png" alt=""></p> 
<h4><a id="21_utils__1992"></a>2.1 utils 包（存放工具类）</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 基于druid数据库连接池的工具类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDBCUtilsByDruid</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> ds<span class="token punctuation">;</span>

    <span class="token comment">// 在静态代码块完成 ds初始化</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            properties<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"src\\druid.properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ds <span class="token operator">=</span> <span class="token class-name">DruidDataSourceFactory</span><span class="token punctuation">.</span><span class="token function">createDataSource</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 编写getConnection方法</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> ds<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 关闭连接, 老师再次强调： 在数据库连接池技术中，close 不是真的断掉连接</span>
    <span class="token comment">// 而是把使用的Connection对象放回连接池</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> resultSet<span class="token punctuation">,</span> <span class="token class-name">Statement</span> statement<span class="token punctuation">,</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resultSet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>statement <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>connection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22_javabean_pojo_domain__JavaBean_2041"></a>2.2 javabean/ pojo/ domain 包（存放与表映射的 JavaBean实体类）</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Actor类的对象和 actor表的记录对应
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Actor</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// JavaBean, POJO, Domain 对象</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sex<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> borndate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//一定要定义一个无参构造器[反射需要]</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Actor</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> sex<span class="token punctuation">,</span> <span class="token class-name">Date</span> borndate<span class="token punctuation">,</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>borndate <span class="token operator">=</span> borndate<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">String</span> sex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getBorndate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> borndate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBorndate</span><span class="token punctuation">(</span><span class="token class-name">Date</span> borndate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>borndate <span class="token operator">=</span> borndate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"\nActor{"</span> <span class="token operator">+</span>
                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", sex='"</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", borndate="</span> <span class="token operator">+</span> borndate <span class="token operator">+</span>
                <span class="token string">", phone='"</span> <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="23_dao__DAO__BasicDAO__2121"></a>2.3 dao 包（存放操作表的 DAO 类和通用的 BasicDAO 类）</h4> 
<p><strong><code>BasicDAO</code> 类如下：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 开发BasicDAO 类, 是其他所有 DAO类 的父类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicDAO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 泛型指定具体类型</span>

    <span class="token keyword">private</span> <span class="token class-name">QueryRunner</span> qr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 开发通用的 dml 方法, 针对任意表(增删改操作)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> update <span class="token operator">=</span> qr<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> update<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询操作：返回结果为多个对象(即查询的结果是多行记录)的通用方法, 针对任意表</span>
    <span class="token comment">/**
     *
     * @param sql sql 语句，可以有 ?
     * @param clazz 传入一个类的Class对象 比如 Actor.class
     * @param parameters 传入 ? 的具体的值，可以是多个
     * @return 根据 Actor.class 返回对应的 ArrayList 集合
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryMulti</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询操作：返回结果为单行记录 的通用方法，针对任意表</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">querySingle</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span>  qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 查询操作：返回结果为单行单列，即返回单值(Object 对象)的通用方法，针对任意表</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">queryScalar</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> qr<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilsByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong><code>ActorDAO</code> 类如下：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 专门操作 actor表的 DAO 类，继承了 BasicDAO 类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActorDAO</span> <span class="token keyword">extends</span> <span class="token class-name">BasicDAO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Actor</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1. 继承了 BasicDAO 类中所有的方法</span>
    <span class="token comment">// 2. 根据业务需求，可以编写特有的方法</span>
   	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="24_test__2222"></a>2.4 test 包（存放测试类）</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 测试类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDAO</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 测试ActorDAO 对 actor表 crud操作</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testActorDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">ActorDAO</span> actorDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActorDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 1. 查询多行记录</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Actor</span><span class="token punctuation">&gt;</span></span> actors <span class="token operator">=</span> actorDAO<span class="token punctuation">.</span><span class="token function">queryMulti</span><span class="token punctuation">(</span><span class="token string">"select * from actor where id &gt;= ?"</span><span class="token punctuation">,</span> <span class="token class-name">Actor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===查询结果==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Actor</span> actor <span class="token operator">:</span> actors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. 查询单行记录</span>
        <span class="token class-name">Actor</span> actor <span class="token operator">=</span> actorDAO<span class="token punctuation">.</span><span class="token function">querySingle</span><span class="token punctuation">(</span><span class="token string">"select * from actor where id = ?"</span><span class="token punctuation">,</span> <span class="token class-name">Actor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====查询单行结果===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>actor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. 查询单行单列</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> actorDAO<span class="token punctuation">.</span><span class="token function">queryScalar</span><span class="token punctuation">(</span><span class="token string">"select name from actor where id = ?"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====查询单行单列值==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. dml 操作：insert ,update, delete</span>
        <span class="token keyword">int</span> update <span class="token operator">=</span> actorDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"insert into actor values(null, ?, ?, ?, ?)"</span><span class="token punctuation">,</span> <span class="token string">"张无忌"</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">,</span> <span class="token string">"2000-11-11"</span><span class="token punctuation">,</span> <span class="token string">"999"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>update <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"执行成功"</span> <span class="token operator">:</span> <span class="token string">"执行没有影响表"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_JDBC__2262"></a>十. JDBC 案例练习</h2> 
<p>最后让我们来通过一个案例来练习一下我们的 JDBC 吧。</p> 
<h3><a id="1___2264"></a>1. 需求</h3> 
<p><strong>完成商品品牌数据的增删改查操作</strong></p> 
<ul><li>查询：查询所有数据</li><li>添加：添加品牌</li><li>修改：根据id修改</li><li>删除：根据id删除</li></ul> 
<h3><a id="2___2275"></a>2. 案例实现</h3> 
<h4><a id="21___2277"></a>2.1 环境准备</h4> 
<p><strong>1. 创建案例所需的数据库，数据库表 <code>tb_brand</code>如下：</strong></p> 
<pre><code class="prism language-sql"><span class="token comment">-- 删除tb_brand表</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> tb_brand<span class="token punctuation">;</span>
<span class="token comment">-- 创建tb_brand表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> tb_brand <span class="token punctuation">(</span>
    <span class="token comment">-- id 主键</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    <span class="token comment">-- 品牌名称</span>
    brand_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">-- 企业名称</span>
    company_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">-- 排序字段</span>
    ordered <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token comment">-- 描述信息</span>
    description <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">-- 状态：0：禁用  1：启用</span>
    <span class="token keyword">status</span> <span class="token keyword">int</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 添加数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> tb_brand <span class="token punctuation">(</span>brand_name<span class="token punctuation">,</span> company_name<span class="token punctuation">,</span> ordered<span class="token punctuation">,</span> description<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">)</span>
<span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">'三只松鼠'</span><span class="token punctuation">,</span> <span class="token string">'三只松鼠股份有限公司'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'好吃不上火'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'华为'</span><span class="token punctuation">,</span> <span class="token string">'华为技术有限公司'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'华为致力于把数字世界带入每个人、每个家庭、每个组织，构建万物互联的智能世界'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token string">'小米'</span><span class="token punctuation">,</span> <span class="token string">'小米科技有限公司'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">'are you ok'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>2. 在<code>pojo</code>包下创建与<code>tb_brand</code>表映射的实体类 <code>Brand</code></strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 品牌
 * alt + 鼠标左键：整列编辑
 * 在实体类中，基本数据类型建议使用其对应的包装类型
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Brand</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// id 主键</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token comment">// 品牌名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> brandName<span class="token punctuation">;</span>
    <span class="token comment">// 企业名称</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> companyName<span class="token punctuation">;</span>
    <span class="token comment">// 排序字段</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> ordered<span class="token punctuation">;</span>
    <span class="token comment">// 描述信息</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
    <span class="token comment">// 状态：0：禁用  1：启用</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Brand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Brand</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> brandName<span class="token punctuation">,</span> <span class="token class-name">String</span> companyName<span class="token punctuation">,</span> <span class="token keyword">int</span> ordered<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">,</span> <span class="token keyword">int</span> status<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brandName <span class="token operator">=</span> brandName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>companyName <span class="token operator">=</span> companyName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ordered <span class="token operator">=</span> ordered<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getBrandName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> brandName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBrandName</span><span class="token punctuation">(</span><span class="token class-name">String</span> brandName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brandName <span class="token operator">=</span> brandName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getCompanyName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> companyName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCompanyName</span><span class="token punctuation">(</span><span class="token class-name">String</span> companyName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>companyName <span class="token operator">=</span> companyName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrdered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> ordered<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> ordered<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ordered <span class="token operator">=</span> ordered<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> description<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token class-name">String</span> description<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token keyword">int</span> status<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"\nBrand{"</span> <span class="token operator">+</span>
                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>
                <span class="token string">", brandName='"</span> <span class="token operator">+</span> brandName <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", companyName='"</span> <span class="token operator">+</span> companyName <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", order="</span> <span class="token operator">+</span> ordered <span class="token operator">+</span>
                <span class="token string">", description='"</span> <span class="token operator">+</span> description <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>
                <span class="token string">", status="</span> <span class="token operator">+</span> status <span class="token operator">+</span>
                <span class="token char">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>在<code>dao</code>包下创建<code>BasicDAO</code>和<code>BrandDAO</code>类。如下：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BasicDAO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">QueryRunner</span> queryRunner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 开发通用的 dml 方法, 针对任意表(增删改操作)
     * @param sql
     * @param parameters
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> queryRunner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询操作：返回结果为多个对象(即查询的结果是多行记录)的通用方法, 针对任意表
     * @param sql
     * @param clazz
     * @param parameters
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryMulti</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询操作：返回结果为单行记录 的通用方法，针对任意表
     * @param sql
     * @param clazz
     * @param parameters
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">querySingle</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span>  queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询操作：返回结果为单行单列，即返回单值(Object 对象)的通用方法，针对任意表
     * @param sql
     * @param parameters
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">queryScalar</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            connection <span class="token operator">=</span> <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> queryRunner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ScalarHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span>  <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将编译异常-&gt;运行异常 ,抛出</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JDBCUtilByDruid</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong><code>BrandDAO</code>类继承自<code>BasicDAO</code>类，此处无需额外再定义方法。</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BrandDAO</span> <span class="token keyword">extends</span> <span class="token class-name">BasicDAO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre> 
<p><mark>注意：还需要创建<code>utils</code>包，存放<code>JDBCUtilsByDruid</code>工具类，该工具类的代码上面已经给出，此处不提供了。</mark></p> 
<h4><a id="22___2507"></a>2.2 查询表中所有记录</h4> 
<p><strong>在<code>test</code>包下创建测试类<code>testBrand</code>：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> testBrand <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">BrandDAO</span> brandDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSelectMulti</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from tb_brand;"</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Brand</span><span class="token punctuation">&gt;</span></span> brands <span class="token operator">=</span> brandDAO<span class="token punctuation">.</span><span class="token function">queryMulti</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token class-name">Brand</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>brands<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="23___2528"></a>2.3 添加数据</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> testBrand <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">BrandDAO</span> brandDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testInsert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"insert into tb_brand(brand_name, company_name, ordered, description, status) values(?,?,?,?,?);"</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> insert <span class="token operator">=</span> brandDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token string">"腾讯"</span><span class="token punctuation">,</span> <span class="token string">"腾讯公司"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">"我们是鹅厂"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="24___2547"></a>2.4 修改数据</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> testBrand <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">BrandDAO</span> brandDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"update tb_brand\n"</span> <span class="token operator">+</span>
                <span class="token string">"set brand_name  = ?,\n"</span> <span class="token operator">+</span>
                <span class="token string">"company_name= ?,\n"</span> <span class="token operator">+</span>
                <span class="token string">"ordered     = ?,\n"</span> <span class="token operator">+</span>
                <span class="token string">"description = ?,\n"</span> <span class="token operator">+</span>
                <span class="token string">"status      = ?\n"</span> <span class="token operator">+</span>
                <span class="token string">"where id = ?"</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> update <span class="token operator">=</span> brandDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token string">"腾讯"</span><span class="token punctuation">,</span> <span class="token string">"腾讯公司"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">"我们是鹅厂，我们的工资很高"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="25___2572"></a>2.5 删除数据</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> testBrand <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">BrandDAO</span> brandDAO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrandDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">" delete from tb_brand where id = ?"</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> delete <span class="token operator">=</span> brandDAO<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b36e63d1a41de31c1bac26450f64a6db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PyTorch 深度学习实战 | 基于生成式对抗网络生成动漫人物</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d6735a3fba5a167434a4f0fb97cab54e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">机器学习——线性回归</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>