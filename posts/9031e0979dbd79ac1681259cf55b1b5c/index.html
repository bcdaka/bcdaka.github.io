<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mongodb操作与Java（四）MongoTemplate的使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9031e0979dbd79ac1681259cf55b1b5c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Mongodb操作与Java（四）MongoTemplate的使用">
  <meta property="og:description" content="目录
mongoClient和MongoTemplate二者区别
代码实践
配置
SpringBoot 工程依赖和配置
准备代码
创建实体类
新增 插入文档
存储文档
更新
删除文档
查询
事务
前言-与正文无关
​ 生活远不止眼前的苦劳与奔波，它还充满了无数值得我们去体验和珍惜的美好事物。在这个快节奏的世界中，我们往往容易陷入工作的漩涡，忘记了停下脚步，感受周围的世界。让我们一起提醒自己，要适时放慢脚步，欣赏生活中的每一道风景，享受与家人朋友的温馨时光，发现那些平凡日子里隐藏的幸福时刻。因为，这些点点滴滴汇聚起来的，才是构成我们丰富多彩生活的本质。希望每个人都能在繁忙的生活中找到自己的快乐之源，不仅仅为了生存而工作，更为了更好的生活而生活.
​ 送你张美图！希望你开心！
mongoClient和MongoTemplate二者区别 Springboot 操作 MongoDB 有两种方式。
第一种方式是采用 Springboot 官方推荐的 JPA 方式，这种操作方式，使用简单但是灵活性比较差。也就是MongoClient
第二种方式是采用 Spring Data MongoDB 基于 MongoDB 官方 Java API 封装的 MongoTemplate 操作类对 MongoDB 进行操作，这种方式非常灵活，能满足绝大部分需求。也就是MongoTemplate
本文将采用第二种方式进行介绍！
MongoClient
MongoClient 是 MongoDB 官方 Java 驱动库提供的类。可以理解为是mysql的Jdbc框架，它直接与 MongoDB 服务器进行通信，负责建立连接、发送查询和命令以及接收响应。使用 MongoClient 通常涉及到编写比较底层的代码。你需要自己管理连接、编写查询语句、处理结果集等。它提供了与 MongoDB 交互的最大灵活性，允许你执行几乎所有类型的数据库操作，包括那些 Spring Data MongoDB 可能尚未提供支持的操作。
MongoTemplate
定义：MongoTemplate 是 Spring Data MongoDB 提供的一个高级抽象，它封装了 MongoClient，提供了一个更高层次的模板方法 API 来简化 MongoDB 的操作。可以理解为是mysql的Mybatis框架。MongoTemplate 提供了相对简单的方法来执行查询、更新、删除等操作，同时集成了 Spring 的转换和异常处理机制。使用 MongoTemplate，你不需要关心低层次的数据库连接和错误处理。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-30T11:11:13+08:00">
    <meta property="article:modified_time" content="2024-05-30T11:11:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mongodb操作与Java（四）MongoTemplate的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="mongoClient%E5%92%8CMongoTemplate%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB-toc" style="margin-left:0px;"><a href="#mongoClient%E5%92%8CMongoTemplate%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB" rel="nofollow">mongoClient和MongoTemplate二者区别</a></p> 
<p id="%E4%BB%A3%E7%A0%81%E5%AE%9E%E8%B7%B5-toc" style="margin-left:0px;"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E8%B7%B5" rel="nofollow">代码实践</a></p> 
<p id="%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E9%85%8D%E7%BD%AE" rel="nofollow">配置</a></p> 
<p id="SpringBoot%20%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%92%8C%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#SpringBoot%20%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%92%8C%E9%85%8D%E7%BD%AE" rel="nofollow">SpringBoot 工程依赖和配置</a></p> 
<p id="%E5%87%86%E5%A4%87%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#%E5%87%86%E5%A4%87%E4%BB%A3%E7%A0%81" rel="nofollow">准备代码</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB" rel="nofollow">创建实体类</a></p> 
<p id="%E6%96%B0%E5%A2%9E%C2%A0-toc" style="margin-left:80px;"><a href="#%E6%96%B0%E5%A2%9E%C2%A0" rel="nofollow">新增 </a></p> 
<p id="%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3-toc" style="margin-left:120px;"><a href="#%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3" rel="nofollow">插入文档</a></p> 
<p id="%E5%AD%98%E5%82%A8%E6%96%87%E6%A1%A3-toc" style="margin-left:120px;"><a href="#%E5%AD%98%E5%82%A8%E6%96%87%E6%A1%A3" rel="nofollow">存储文档</a></p> 
<p id="%E6%9B%B4%E6%96%B0-toc" style="margin-left:80px;"><a href="#%E6%9B%B4%E6%96%B0" rel="nofollow">更新</a></p> 
<p id="%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-toc" style="margin-left:80px;"><a href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3" rel="nofollow">删除文档</a></p> 
<p id="%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#%E6%9F%A5%E8%AF%A2" rel="nofollow">查询</a></p> 
<p id="%E4%BA%8B%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E4%BA%8B%E5%8A%A1" rel="nofollow">事务</a></p> 
<hr id="hr-toc"> 
<p>前言-与正文无关</p> 
<p>​    生活远不止眼前的苦劳与奔波，它还充满了无数值得我们去体验和珍惜的美好事物。在这个快节奏的世界中，我们往往容易陷入工作的漩涡，忘记了停下脚步，感受周围的世界。让我们一起提醒自己，要适时放慢脚步，欣赏生活中的每一道风景，享受与家人朋友的温馨时光，发现那些平凡日子里隐藏的幸福时刻。因为，这些点点滴滴汇聚起来的，才是构成我们丰富多彩生活的本质。希望每个人都能在繁忙的生活中找到自己的快乐之源，不仅仅为了生存而工作，更为了更好的生活而生活.</p> 
<p>​       送你张美图！希望你开心！</p> 
<p><img alt="" height="1024" src="https://images2.imgbox.com/5e/8c/dy76wnwz_o.jpg" width="1024"></p> 
<h2 style="margin-left:0px;text-align:justify;"></h2> 
<h2 id="mongoClient%E5%92%8CMongoTemplate%E4%BA%8C%E8%80%85%E5%8C%BA%E5%88%AB" style="margin-left:0px;text-align:justify;">mongoClient和<code><span style="color:#0d0d0d;">MongoTemplate</span></code>二者区别</h2> 
<p>Springboot 操作 MongoDB 有两种方式。</p> 
<p>第一种方式是采用 Springboot 官方推荐的 JPA 方式，这种操作方式，使用简单但是灵活性比较差。也就是<code><span style="color:#0d0d0d;">MongoClient</span></code></p> 
<p>第二种方式是采用 Spring Data MongoDB 基于 MongoDB 官方 Java API 封装的 MongoTemplate 操作类对 MongoDB 进行操作，这种方式非常灵活，能满足绝大部分需求。也就是<code><span style="color:#0d0d0d;">MongoTemplate</span></code></p> 
<p>本文将采用第二种方式进行介绍！</p> 
<p style="margin-left:0;text-align:justify;"><code><span style="color:#0d0d0d;">MongoClient</span></code></p> 
<p style="margin-left:0;text-align:justify;"><code><strong><span style="color:#0d0d0d;">MongoClient</span></strong></code> 是 MongoDB 官方 Java 驱动库提供的类。可以理解为是mysql的Jdbc框架，它直接与 MongoDB 服务器进行通信，负责建立连接、发送查询和命令以及接收响应。使用 <code><strong><span style="color:#0d0d0d;">MongoClient</span></strong></code> 通常涉及到编写比较底层的代码。你需要自己管理连接、编写查询语句、处理结果集等。它提供了与 MongoDB 交互的最大灵活性，允许你执行几乎所有类型的数据库操作，包括那些 Spring Data MongoDB 可能尚未提供支持的操作。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><code><span style="color:#0d0d0d;">MongoTemplate</span></code></p> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#0d0d0d;">定义</span></strong>：<code><strong><span style="color:#0d0d0d;">MongoTemplate</span></strong></code> 是 Spring Data MongoDB 提供的一个高级抽象，它封装了 <code><strong><span style="color:#0d0d0d;">MongoClient</span></strong></code>，提供了一个更高层次的模板方法 API 来简化 MongoDB 的操作。可以理解为是mysql的Mybatis框架。<code><strong><span style="color:#0d0d0d;">MongoTemplate</span></strong></code> 提供了相对简单的方法来执行查询、更新、删除等操作，同时集成了 Spring 的转换和异常处理机制。使用 <code><strong><span style="color:#0d0d0d;">MongoTemplate</span></strong></code>，你不需要关心低层次的数据库连接和错误处理。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 id="%E4%BB%A3%E7%A0%81%E5%AE%9E%E8%B7%B5">代码实践</h2> 
<h3 id="%E9%85%8D%E7%BD%AE">配置</h3> 
<h4 id="SpringBoot%20%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%92%8C%E9%85%8D%E7%BD%AE">SpringBoot 工程依赖和配置</h4> 
<pre><code class="language-XML">&lt;!-- 引入springboot --&gt;
&lt;parent&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;
&lt;/parent&gt;
 
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>添加配置文件</strong></p> 
<p>在application.properties文件中添加mongodb相关配置！</p> 
<blockquote> 
 <p>#配置数据库连接地址<br> spring.data.mongodb.uri=mongodb://userName:password@127.0.0.1:27017/dbName</p> 
 <ul><li> <p>userName：表示用户名，根据实际情况填写即可</p> </li></ul> 
 <ul><li> <p>password：表示用户密码，根据实际情况填写即可</p> </li></ul> 
 <ul><li> <p>dbName：表示数据库，可以自定义，初始化数据的时候，会自动创建</p> </li></ul> 
</blockquote> 
<h3 id="%E5%87%86%E5%A4%87%E4%BB%A3%E7%A0%81" style="margin-left:0px;text-align:justify;">准备代码</h3> 
<h4 id="%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB">创建实体类</h4> 
<p>创建一个实体类Person，其中注解@Document(collection="persons")表示当前实体类对应的集合名称是persons，类似于关系型数据库中的表名称。</p> 
<p>注解@Id表示当前字段，在集合结构中属于主键类型。</p> 
<pre><code class="language-java">/**
 * 使用@Document注解指定集合名称
 */
@Document(collection="persons")
public class Person implements Serializable {
    private static final long serialVersionUID = -3258839839160856613L;
 
    /**
     * 使用@Id注解指定MongoDB中的 _id 主键
     */
    @Id
    private Long id;
 
    private String userName;
 
    private String passWord;
 
    private Integer age;
 
    private Date createTime;
 
    //...get/set
 
    @Override
    public String toString() {
        return "Person{" +
                "id=" + id +
                ", userName='" + userName + '\'' +
                ", passWord='" + passWord + '\'' +
                ", age=" + age +
                ", createTime=" + createTime +
                '}';
    }
}</code></pre> 
<h4 id="%E6%96%B0%E5%A2%9E%C2%A0">新增 </h4> 
<h5 id="%E6%8F%92%E5%85%A5%E6%96%87%E6%A1%A3">插入文档</h5> 
<p>MongoTemplate提供了insert()方法，用于插入文档，示例代码如下：</p> 
<ul><li> <p>用于插入文档</p> </li></ul> 
<blockquote>
  没指定集合名称时，会取 @Document注解中的集合名称 
</blockquote> 
<p></p> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 插入文档
     * @throws Exception
     */
    @Test
    public void insert() throws Exception {
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
        mongoTemplate.insert(person);
    }
}</code></pre> 
<ul><li> <p>自定义集合名称，插入文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 自定义集合，插入文档
     * @throws Exception
     */
    @Test
    public void insertCustomCollection() throws Exception {
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
        mongoTemplate.insert(person, "custom_person");
    }
}</code></pre> 
<ul><li> <p>自定义集合，<a href="https://so.csdn.net/so/search?q=%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5&amp;spm=1001.2101.3001.7020" title="批量插入">批量插入</a>文档</p> </li></ul> 
<blockquote>
  如果采用批量插入文档，必须指定集合名称 
</blockquote> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 自定义集合，批量插入文档
     * @throws Exception
     */
    @Test
    public void insertBatch() throws Exception {
        List&lt;Person&gt; personList = new ArrayList&lt;&gt;();
        Person person1 =new Person();
        person1.setId(10l);
        person1.setUserName("张三");
        person1.setPassWord("123456");
        person1.setCreateTime(new Date());
        personList.add(person1);
 
        Person person2 =new Person();
        person2.setId(11l);
        person2.setUserName("李四");
        person2.setPassWord("123456");
        person2.setCreateTime(new Date());
        personList.add(person2);
 
        mongoTemplate.insert(personList, "custom_person");
    }
}</code></pre> 
<h5 id="%E5%AD%98%E5%82%A8%E6%96%87%E6%A1%A3">存储文档</h5> 
<p>MongoTemplate提供了save()方法，用于存储文档。</p> 
<p>在存储文档的时候会通过主键 ID 进行判断，如果存在就更新，否则就插入，示例代码如下：</p> 
<ul><li> <p>存储文档，如果没有插入，否则通过主键ID更新</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 存储文档，如果没有插入，否则更新
     * @throws Exception
     */
    @Test
    public void save() throws Exception {
        Person person =new Person();
        person.setId(13l);
        person.setUserName("八八");
        person.setPassWord("123456");
        person.setAge(40);
        person.setCreateTime(new Date());
        mongoTemplate.save(person);
    }
}</code></pre> 
<ul><li> <p>自定义集合，存储文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 自定义集合，存储文档
     * @throws Exception
     */
    @Test
    public void saveCustomCollection() throws Exception {
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
        mongoTemplate.save(person, "custom_person");
    }
}</code></pre> 
<h4 id="%E6%9B%B4%E6%96%B0">更新</h4> 
<p>MongoTemplate提供了updateFirst()和updateMulti()方法，用于更新文档，示例代码如下：</p> 
<ul><li> <p>更新文档，匹配查询到的文档数据中的第一条数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 更新文档，匹配查询到的文档数据中的第一条数据
     * @throws Exception
     */
    @Test
    public void updateFirst() throws Exception {
        //更新对象
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三123");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
 
        //更新条件
        Query query= new Query(Criteria.where("id").is(person.getId()));
 
        //更新值
        Update update= new Update().set("userName", person.getUserName()).set("passWord", person.getPassWord());
        //更新查询满足条件的文档数据（第一条）
        UpdateResult result =mongoTemplate.updateFirst(query,update, Person.class);
        if(result!=null){
            System.out.println("更新条数：" + result.getMatchedCount());
        }
    }
}</code></pre> 
<ul><li> <p>更新文档，匹配查询到的文档数据中的所有数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 更新文档，匹配查询到的文档数据中的所有数据
     * @throws Exception
     */
    @Test
    public void updateMany() throws Exception {
        //更新对象
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
 
        //更新条件
        Query query= new Query(Criteria.where("id").is(person.getId()));
 
        //更新值
        Update update= new Update().set("userName", person.getUserName()).set("passWord", person.getPassWord());
        //更新查询满足条件的文档数据（全部）
        UpdateResult result = mongoTemplate.updateMulti(query, update, Person.class);
        if(result!=null){
            System.out.println("更新条数：" + result.getMatchedCount());
        }
    }
}</code></pre> 
<p></p> 
<h4 id="%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3">删除文档</h4> 
<p>MongoTemplate提供了remove()、findAndRemove()和findAllAndRemove()方法，用于删除文档，示例代码如下：</p> 
<ul><li> <p>删除符合条件的所有文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 更新文档，匹配查询到的文档数据中的所有数据
     * @throws Exception
     */
    @Test
    public void updateMany() throws Exception {
        //更新对象
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
 
        //更新条件
        Query query= new Query(Criteria.where("id").is(person.getId()));
 
        //更新值
        Update update= new Update().set("userName", person.getUserName()).set("passWord", person.getPassWord());
        //更新查询满足条件的文档数据（全部）
        UpdateResult result = mongoTemplate.updateMulti(query, update, Person.class);
        if(result!=null){
            System.out.println("更新条数：" + result.getMatchedCount());
        }
    }
}</code></pre> 
<ul><li> <p>删除符合条件的单个文档，并返回删除的文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 删除符合条件的单个文档，并返回删除的文档
     * @throws Exception
     */
    @Test
    public void findAndRemove() throws Exception {
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
 
        Query query = new Query(Criteria.where("id").is(person.getId()));
        Person result = mongoTemplate.findAndRemove(query, Person.class);
        System.out.println("删除的文档数据：" + result.toString());
    }
}</code></pre> 
<ul><li> <p>删除符合条件的所有文档，并返回删除的文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 删除符合条件的所有文档，并返回删除的文档
     * @throws Exception
     */
    @Test
    public void findAllAndRemove() throws Exception {
        Person person =new Person();
        person.setId(1l);
        person.setUserName("张三");
        person.setPassWord("123456");
        person.setCreateTime(new Date());
 
        Query query = new Query(Criteria.where("id").is(person.getId()));
        List&lt;Person&gt; result = mongoTemplate.findAllAndRemove(query, Person.class);
        System.out.println("删除的文档数据：" + result.toString());
    }
}</code></pre> 
<h4 id="%E6%9F%A5%E8%AF%A2">查询</h4> 
<p></p> 
<p>MongoTemplate提供了非常多的文档查询方法，日常开发中用的最多的就是find()方法，示例代码如下：</p> 
<ul><li> <p>查询集合中的全部文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 查询集合中的全部文档数据
     * @throws Exception
     */
    @Test
    public void findAll() throws Exception {
        List&lt;Person&gt; result = mongoTemplate.findAll(Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<ul><li> <p>查询集合中指定的ID文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 查询集合中指定的ID文档数据
     * @throws Exception
     */
    @Test
    public void findById() {
        long id = 1l;
        Person result = mongoTemplate.findById(id, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<ul><li> <p>根据条件查询集合中符合条件的文档，返回第一条数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据条件查询集合中符合条件的文档，返回第一条数据
     */
    @Test
    public void findOne() {
        String userName = "张三";
        Query query = new Query(Criteria.where("userName").is(userName));
        Person result = mongoTemplate.findOne(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>根据条件查询集合中符合条件的文档</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据条件查询集合中符合条件的文档
     */
    @Test
    public void findByCondition() {
        String userName = "张三";
        Query query = new Query(Criteria.where("userName").is(userName));
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>根据【AND】关联多个查询条件，查询集合中的文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据【AND】关联多个查询条件，查询集合中的文档数据
     */
    @Test
    public void findByAndCondition() {
        // 创建条件
        Criteria criteriaUserName = Criteria.where("userName").is("张三");
        Criteria criteriaPassWord = Criteria.where("passWord").is("123456");
        // 创建条件对象，将上面条件进行 AND 关联
        Criteria criteria = new Criteria().andOperator(criteriaUserName, criteriaPassWord);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<ul><li> <p>根据【OR】关联多个查询条件，查询集合中的文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据【OR】关联多个查询条件，查询集合中的文档数据
     */
    @Test
    public void findByOrCondition() {
        // 创建条件
        Criteria criteriaUserName = Criteria.where("userName").is("张三");
        Criteria criteriaPassWord = Criteria.where("passWord").is("123456");
        // 创建条件对象，将上面条件进行 OR 关联
        Criteria criteria = new Criteria().orOperator(criteriaUserName, criteriaPassWord);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>根据【IN】关联多个查询条件，查询集合中的文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据【IN】关联多个查询条件，查询集合中的文档数据
     */
    @Test
    public void findByInCondition() {
        // 设置查询条件参数
        List&lt;Long&gt; ids = Arrays.asList(1l, 10l, 11l);
        // 创建条件
        Criteria criteria = Criteria.where("id").in(ids);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>根据【逻辑运算符】查询集合中的文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据【逻辑运算符】查询集合中的文档数据
     */
    @Test
    public void findByOperator() {
        // 设置查询条件参数
        int min = 20;
        int max = 35;
        Criteria criteria = Criteria.where("age").gt(min).lte(max);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>根据【正则表达式】查询集合中的文档数据</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
    /**
     * 根据【正则表达式】查询集合中的文档数据
     */
    @Test
    public void findByRegex() {
        // 设置查询条件参数
        String regex = "^张*";
        Criteria criteria = Criteria.where("userName").regex(regex);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<ul><li> <p>根据单个条件查询集合中的文档数据，并按指定字段进行排序与限制指定数目</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
   /**
     * 根据单个条件查询集合中的文档数据，并按指定字段进行排序与限制指定数目
     */
    @Test
    public void findByConditionAndSortLimit() {
        String userName = "张三";
        //从第一行开始，查询2条数据返回
        Query query = new Query(Criteria.where("userName").is(userName)).with(Sort.by("createTime")).limit(2).skip(1);
        List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);
        System.out.println("查询结果：" + result.toString());
    }
}</code></pre> 
<p></p> 
<ul><li> <p>统计集合中符合【查询条件】的文档【数量】</p> </li></ul> 
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class PersonServiceTest {
 
    @Autowired
    private MongoTemplate mongoTemplate;
 
   /**
     * 统计集合中符合【查询条件】的文档【数量】
     */
    @Test
    public void countNumber() {
        // 设置查询条件参数
        String regex = "^张*";
        Criteria criteria = Criteria.where("userName").regex(regex);
        // 创建查询对象，然后将条件对象添加到其中
        Query query = new Query(criteria);
        long count = mongoTemplate.count(query, Person.class);
        System.out.println("统计结果：" + count);
    }
}</code></pre> 
<h3 id="%E4%BA%8B%E5%8A%A1">事务</h3> 
<p>单节点 mongodb 不支持事务，需要搭建 MongoDB 复制集才有事务，使用方式和mysql一样在springboot中。</p> 
<p></p> 
<p></p> 
<p>------------------------------------------与正文内容无关------------------------------------ 如果觉的文章写对各位读者老爷们有帮助的话，麻烦点赞加关注呗！作者在这拜谢了!</p> 
<p>混口饭吃了！如果你需要Java 、Python毕设、商务合作、技术交流、就业指导、技术支持度过试用期。请在关注私信我，本人看到一定马上回复！</p> 
<p>这是我全部文章所在目录，看看是否有你需要的，如果遇到觉得不对地方请留言，看到后我会查阅进行改正。</p> 
<p>A乐神-CSDN博客</p> 
<p>关注在文章左上角，作者信息处。</p> 
<p><img alt="" height="384" src="https://images2.imgbox.com/5a/2c/ZDYCzhJB_o.png" width="295"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0691be40b11c57c2fbd58d8090dcb5c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">开源VS闭源：AI未来的十字路口</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/101891757d59d3c2e9ae4f0038a63f16/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">现代化实时数仓 SelectDB 再次登顶 ClickBench 全球数据库分析性能排行榜！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>