<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>kafka架构&#43;原理&#43;源码 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f5ae444a94ebde1cef7e14455d9ec253/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="kafka架构&#43;原理&#43;源码">
  <meta property="og:description" content="1.安装jdk17 sudo yum -y update sudo wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm sudo yum -y install ./jdk-17_linux-x64_bin.rpm sudo java -version 2.安装kafka How to easily install kafka without zookeeper | Aditya’s Blog 1.kafka架构图 2.kafka producer 在 Kafka 中，一个文件并不直接对应一个分区，但每个分区会有多个文件来存储其数据。
Kafka 存储结构 分区: Kafka 的每个主题（topic）可以有一个或多个分区。每个分区是一个有序的、不可变的消息日志。
日志文件: 每个分区会被存储在一组日志文件中。Kafka 将每个分区的数据分成多个日志段（log segments）文件，这些文件是按时间顺序生成的，文件名中包含文件的创建时间戳和其他信息。
文件结构 分区目录: 每个分区在 Kafka 的日志目录下有一个目录，例如 /tmp/kafka-logs/topic1-0。这个目录的名称中包含了主题名称和分区编号。
日志段文件: 在每个分区目录下，会有多个日志段文件，这些文件通常以 .log 为后缀。例如，00000000000000000000.log、00000000000000000001.log 等。
索引文件: 除了日志文件外，每个日志段还有对应的索引文件 (.index) 和时间戳文件 (.timeindex)，用于加速数据的查找和存取。
示例 假设你有一个主题 my-topic，它有两个分区（0 和 1），在 Kafka 的数据目录下，你会看到类似以下的文件结构：
bash
复制代码
/tmp/kafka-logs/my-topic-0/ 00000000000000000000.log 00000000000000000000.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-28T20:32:33+08:00">
    <meta property="article:modified_time" content="2024-07-28T20:32:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">kafka架构&#43;原理&#43;源码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.安装jdk17</h2> 
<pre><code class="language-bash">sudo yum -y update
sudo wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm
sudo yum -y install ./jdk-17_linux-x64_bin.rpm
sudo java -version</code></pre> 
<h2>2.安装kafka</h2> 
<h2><a href="https://adityasridhar.com/posts/how-to-easily-install-kafka-without-zookeeper" rel="nofollow" title="How to easily install kafka without zookeeper | Aditya’s Blog">How to easily install kafka without zookeeper | Aditya’s Blog</a></h2> 
<h2>1.kafka架构图</h2> 
<p><img alt="" height="500" src="https://images2.imgbox.com/ae/d2/nFI2172t_o.png" width="953"></p> 
<p></p> 
<h2>2.kafka producer</h2> 
<p><img alt="" height="866" src="https://images2.imgbox.com/66/0c/bFL9zlsq_o.png" width="1200"></p> 
<blockquote> 
 <p>在 Kafka 中，<strong>一个文件</strong>并不直接对应一个分区，但每个<strong>分区</strong>会有多个<strong>文件</strong>来存储其数据。</p> 
 <h4>Kafka 存储结构</h4> 
 <ul><li> <p><strong>分区</strong>: Kafka 的每个主题（topic）可以有一个或多个分区。每个分区是一个有序的、不可变的消息日志。</p> </li><li> <p><strong>日志文件</strong>: 每个分区会被存储在一组日志文件中。Kafka 将每个分区的数据分成多个日志段（log segments）文件，这些文件是按时间顺序生成的，文件名中包含文件的创建时间戳和其他信息。</p> </li></ul> 
 <h4>文件结构</h4> 
 <ul><li> <p><strong>分区目录</strong>: 每个分区在 Kafka 的日志目录下有一个目录，例如 <code>/tmp/kafka-logs/topic1-0</code>。这个目录的名称中包含了主题名称和分区编号。</p> </li><li> <p><strong>日志段文件</strong>: 在每个分区目录下，会有多个日志段文件，这些文件通常以 <code>.log</code> 为后缀。例如，<code>00000000000000000000.log</code>、<code>00000000000000000001.log</code> 等。</p> </li><li> <p><strong>索引文件</strong>: 除了日志文件外，每个日志段还有对应的索引文件 (<code>.index</code>) 和时间戳文件 (<code>.timeindex</code>)，用于加速数据的查找和存取。</p> </li></ul> 
 <h4>示例</h4> 
 <p>假设你有一个主题 <code>my-topic</code>，它有两个分区（<code>0</code> 和 <code>1</code>），在 Kafka 的数据目录下，你会看到类似以下的文件结构：</p> 
 <pre></pre> 
 <p>bash</p> 
 <p>复制代码</p> 
 <p><code>/tmp/kafka-logs/my-topic-0/ 00000000000000000000.log 00000000000000000000.index 00000000000000000000.timeindex ... /tmp/kafka-logs/my-topic-1/ 00000000000000000000.log 00000000000000000000.index 00000000000000000000.timeindex ... </code></p> 
 <h4>总结</h4> 
 <ul><li><strong>一个分区</strong>会有多个文件，通常包括日志文件、索引文件和时间戳文件。</li><li><strong>一个文件</strong>（日志段文件）只是存储分区数据的一部分，多个文件一起构成了分区的完整数据。</li></ul> 
 <p>这使得 Kafka 可以高效地管理和存储大量的数据，同时保持高性能的数据读写能力。</p> 
</blockquote> 
<p></p> 
<blockquote> 
 <h2>payload</h2> 
 <p>在 Kafka 中，<strong>文件中的 payload</strong> 指的是实际存储的消息数据。每个分区中的日志文件包含了分区所有消息的原始数据，即消息的 payload。下面是关于这些 payload 的一些详细信息：</p> 
 <h4>消息的结构</h4> 
 <p>在 Kafka 中，消息（或记录）的结构包括以下几个主要部分：</p> 
 <ol><li> <p><strong>键（Key）</strong>: 可选的消息键，用于消息的分区策略。键在消息存储中可能会被序列化和附加到消息的开头。</p> </li><li> <p><strong>值（Value）</strong>: 消息的实际内容，这就是我们通常所说的 payload。它是消息的主要数据部分。</p> </li><li> <p><strong>时间戳（Timestamp）</strong>: 消息的时间戳，通常是消息被生产者发送的时间。</p> </li><li> <p><strong>头（Headers）</strong>: 可选的消息头，用于附加元数据到消息中。</p> </li></ol> 
 <h4>Kafka 日志文件中的数据格式</h4> 
 <p>Kafka 使用二进制格式来存储消息数据，日志文件中的数据通常是按照以下结构存储的：</p> 
 <ol><li> <p><strong>消息偏移量</strong>: 每条消息在分区中的位置，这个偏移量用于快速访问和定位消息。</p> </li><li> <p><strong>消息的长度</strong>: 消息的总长度（包括键、值、时间戳等）。</p> </li><li> <p><strong>消息内容</strong>: 实际的消息数据。根据配置，消息内容可能包括：</p> 
   <ul><li><strong>键</strong>: 消息的键（如果存在）。</li><li><strong>值</strong>: 消息的值（payload）。</li><li><strong>时间戳</strong>: 消息的时间戳。</li><li><strong>消息头</strong>: 消息的头部信息（如果存在）。</li></ul></li></ol> 
 <h4>文件内容示例</h4> 
 <p>在分区的日志文件中，消息数据以二进制形式存储。例如，一个日志文件可能包含如下内容：</p> 
 <ul><li><strong>Message Offset</strong>: 位置1</li><li><strong>Message Length</strong>: 200 bytes</li><li><strong>Message Payload</strong>: 包含消息键、值、时间戳等数据</li></ul> 
 <h4>读取和解析</h4> 
 <p>Kafka 客户端（如生产者和消费者）通过 Kafka 协议与 Kafka broker 交互，发送和接收这些消息数据。客户端使用协议来读取这些二进制数据并将其解码为实际的消息对象。</p> 
 <h4>总结</h4> 
 <p><strong>Payload</strong> 是指消息的实际内容，它存储在 Kafka 日志文件中。在日志文件里，payload 是消息的一部分，包括在写入分区日志文件时的实际数据内容。Kafka 的设计旨在高效地管理和存储这些数据，保证高吞吐量和低延迟。</p> 
</blockquote> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/40/b2/pL0hyPbJ_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/cd/ee/YobVZIT9_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e265dc34fc4b6d3f49bcf54e07c403d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Webpack 从入门到精通</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44284dd0b36f421d24a1aa0b510ed3d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一篇笔记总结HTML基础知识</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>