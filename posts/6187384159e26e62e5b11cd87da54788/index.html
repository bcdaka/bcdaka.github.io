<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡15ï¼š Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¹‹æ•´åˆå°è£…Toolså’ŒMemoryåŠŸèƒ½ä»£ç  - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6187384159e26e62e5b11cd87da54788/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡15ï¼š Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¹‹æ•´åˆå°è£…Toolså’ŒMemoryåŠŸèƒ½ä»£ç ">
  <meta property="og:description" content="ç³»åˆ—ç¯‡ç« ğŸ’¥ AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°
ç›®å½• ç³»åˆ—ç¯‡ç« ğŸ’¥ä¸€ã€å‰è¨€äºŒã€MemoryåŠŸèƒ½å®ç°ä¹‹åœ¨çº¿äº‘ç›˜ç±»å°è£…1ã€åˆ›å»ºOpenAiå®¢æˆ·ç«¯2ã€å®šä¹‰æœ¬åœ°äº‘ç›˜æ–‡ä»¶ç›®å½•åˆ›å»ºæ–¹æ³•3ã€å®šä¹‰docæ–‡æ¡£åˆ›å»ºæ–¹æ³•4ã€å®šä¹‰æ–‡ä»¶å†…å®¹è¿½åŠ æ–¹æ³•5ã€å®šä¹‰è·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•6ã€å®šä¹‰æ¸…ç†æ–‡ä»¶å†…å®¹çš„æ–¹æ³•7ã€å®šä¹‰è·å–æ–‡ä»¶åˆ—è¡¨çš„æ–¹æ³•8ã€å®šä¹‰æ–‡ä»¶é‡å‘½åçš„æ–¹æ³•9ã€å®šä¹‰åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•10ã€å®šä¹‰è¿½åŠ å›¾ç‰‡çš„æ–¹æ³•11ã€å®šä¹‰ä¸€ä¸ªäº‘ç›˜æ–‡ä»¶æ“ä½œç±» ä¸‰ã€MemoryåŠŸèƒ½å®ç°ä¹‹æ¶ˆæ¯å·¥å…·ç±»å°è£…1ã€å®šä¹‰æ¶ˆæ¯ç®¡ç†ç±»2ã€æµ‹è¯•-æŸ¥çœ‹æ¶ˆæ¯ç®¡ç†å™¨3ã€æµ‹è¯•-è¿½åŠ æ¶ˆæ¯4ã€æµ‹è¯•-åˆ é™¤æ¶ˆæ¯5ã€æ·»åŠ èƒŒæ™¯çŸ¥è¯† å››ã€ToolsåŠŸèƒ½ä¹‹å‡½æ•°å°è£…1ã€è·å–è¡¨ç»“æ„åŸºæœ¬ä¿¡æ¯ï¼ˆå·¥å…·å‡½æ•°ï¼‰2ã€æå–SQLæ•°æ®åˆ°pythonå˜é‡ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰3ã€pythonä»£ç è§£é‡Šå™¨ï¼ˆå·¥å…·å‡½æ•°ï¼‰4ã€functionå‡½æ•°ä¿¡æ¯ç”Ÿæˆå™¨ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰5ã€functionå‡½æ•°è°ƒç”¨è¾…åŠ©ç±» ä¸‰ã€ç»“è¯­ ä¸€ã€å‰è¨€ åœ¨å‰é¢ç¯‡ç« ä¸­æˆ‘ä»¬å®ç°äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­çš„Toolså’ŒMemoryç›¸å…³ä»£ç è½åœ°å®è·µï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬å°†å¯¹è¿™ä¸¤å¤§å—åŠŸèƒ½ä»£ç è¿›è¡Œæ•´åˆå°è£…ã€‚
äºŒã€MemoryåŠŸèƒ½å®ç°ä¹‹åœ¨çº¿äº‘ç›˜ç±»å°è£… 1ã€åˆ›å»ºOpenAiå®¢æˆ·ç«¯ ## å¯¼å…¥ä¾èµ– import openai import os import numpy as np import pandas as pd import json import io from openai import OpenAI import inspect import pymysql import tiktoken from docx import Document import matplotlib.pyplot as plt import seaborn as sns import tempfile import ast from IPython.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-04T07:46:00+08:00">
    <meta property="article:modified_time" content="2024-06-04T07:46:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡15ï¼š Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¹‹æ•´åˆå°è£…Toolså’ŒMemoryåŠŸèƒ½ä»£ç </h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>ç³»åˆ—ç¯‡ç« ğŸ’¥</h2> 
<p><a href="https://xundaomalu.blog.csdn.net/article/details/139169884" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139190028" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139186663" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139193382" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139194151" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139205615" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216544" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216752" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139372376" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139391333?spm=1001.2014.3001.5502" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139399366" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#_1" rel="nofollow">ç³»åˆ—ç¯‡ç« ğŸ’¥</a></li><li><a href="#_21" rel="nofollow">ä¸€ã€å‰è¨€</a></li><li><a href="#Memory_23" rel="nofollow">äºŒã€MemoryåŠŸèƒ½å®ç°ä¹‹åœ¨çº¿äº‘ç›˜ç±»å°è£…</a></li><li><ul><li><a href="#1OpenAi_24" rel="nofollow">1ã€åˆ›å»ºOpenAiå®¢æˆ·ç«¯</a></li><li><a href="#2_53" rel="nofollow">2ã€å®šä¹‰æœ¬åœ°äº‘ç›˜æ–‡ä»¶ç›®å½•åˆ›å»ºæ–¹æ³•</a></li><li><a href="#3doc_78" rel="nofollow">3ã€å®šä¹‰docæ–‡æ¡£åˆ›å»ºæ–¹æ³•</a></li><li><a href="#4_112" rel="nofollow">4ã€å®šä¹‰æ–‡ä»¶å†…å®¹è¿½åŠ æ–¹æ³•</a></li><li><a href="#5_151" rel="nofollow">5ã€å®šä¹‰è·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•</a></li><li><a href="#6_193" rel="nofollow">6ã€å®šä¹‰æ¸…ç†æ–‡ä»¶å†…å®¹çš„æ–¹æ³•</a></li><li><a href="#7_218" rel="nofollow">7ã€å®šä¹‰è·å–æ–‡ä»¶åˆ—è¡¨çš„æ–¹æ³•</a></li><li><a href="#8_237" rel="nofollow">8ã€å®šä¹‰æ–‡ä»¶é‡å‘½åçš„æ–¹æ³•</a></li><li><a href="#9_258" rel="nofollow">9ã€å®šä¹‰åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•</a></li><li><a href="#10_288" rel="nofollow">10ã€å®šä¹‰è¿½åŠ å›¾ç‰‡çš„æ–¹æ³•</a></li><li><a href="#11_348" rel="nofollow">11ã€å®šä¹‰ä¸€ä¸ªäº‘ç›˜æ–‡ä»¶æ“ä½œç±»</a></li></ul> 
  </li><li><a href="#Memory_433" rel="nofollow">ä¸‰ã€MemoryåŠŸèƒ½å®ç°ä¹‹æ¶ˆæ¯å·¥å…·ç±»å°è£…</a></li><li><ul><li><a href="#1_434" rel="nofollow">1ã€å®šä¹‰æ¶ˆæ¯ç®¡ç†ç±»</a></li><li><a href="#2_648" rel="nofollow">2ã€æµ‹è¯•-æŸ¥çœ‹æ¶ˆæ¯ç®¡ç†å™¨</a></li><li><a href="#3_656" rel="nofollow">3ã€æµ‹è¯•-è¿½åŠ æ¶ˆæ¯</a></li><li><a href="#4_669" rel="nofollow">4ã€æµ‹è¯•-åˆ é™¤æ¶ˆæ¯</a></li><li><a href="#5_677" rel="nofollow">5ã€æ·»åŠ èƒŒæ™¯çŸ¥è¯†</a></li></ul> 
  </li><li><a href="#Tools_698" rel="nofollow">å››ã€ToolsåŠŸèƒ½ä¹‹å‡½æ•°å°è£…</a></li><li><ul><li><a href="#1_699" rel="nofollow">1ã€è·å–è¡¨ç»“æ„åŸºæœ¬ä¿¡æ¯ï¼ˆå·¥å…·å‡½æ•°ï¼‰</a></li><li><a href="#2SQLpython_744" rel="nofollow">2ã€æå–SQLæ•°æ®åˆ°pythonå˜é‡ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰</a></li><li><a href="#3python_787" rel="nofollow">3ã€pythonä»£ç è§£é‡Šå™¨ï¼ˆå·¥å…·å‡½æ•°ï¼‰</a></li><li><a href="#4function_916" rel="nofollow">4ã€functionå‡½æ•°ä¿¡æ¯ç”Ÿæˆå™¨ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰</a></li><li><a href="#5function_975" rel="nofollow">5ã€functionå‡½æ•°è°ƒç”¨è¾…åŠ©ç±»</a></li></ul> 
  </li><li><a href="#_1062" rel="nofollow">ä¸‰ã€ç»“è¯­</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_21"></a>ä¸€ã€å‰è¨€</h2> 
<p>åœ¨å‰é¢ç¯‡ç« ä¸­æˆ‘ä»¬å®ç°äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­çš„Toolså’ŒMemoryç›¸å…³ä»£ç è½åœ°å®è·µï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬å°†å¯¹è¿™ä¸¤å¤§å—åŠŸèƒ½ä»£ç è¿›è¡Œæ•´åˆå°è£…ã€‚</p> 
<h2><a id="Memory_23"></a>äºŒã€MemoryåŠŸèƒ½å®ç°ä¹‹åœ¨çº¿äº‘ç›˜ç±»å°è£…</h2> 
<h3><a id="1OpenAi_24"></a>1ã€åˆ›å»ºOpenAiå®¢æˆ·ç«¯</h3> 
<pre><code class="prism language-python"><span class="token comment">## å¯¼å…¥ä¾èµ–</span>
<span class="token keyword">import</span> openai
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> json
<span class="token keyword">import</span> io
<span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">import</span> inspect
<span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> tiktoken
<span class="token keyword">from</span> docx <span class="token keyword">import</span> Document
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> tempfile
<span class="token keyword">import</span> ast
<span class="token keyword">from</span> IPython<span class="token punctuation">.</span>display <span class="token keyword">import</span> display<span class="token punctuation">,</span> Markdown<span class="token punctuation">,</span> Code
<span class="token keyword">import</span> shutil
<span class="token keyword">import</span> copy
<span class="token keyword">from</span> openai <span class="token keyword">import</span>  APIConnectionError<span class="token punctuation">,</span>AuthenticationError

openai<span class="token punctuation">.</span>api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"OPENAI_API_KEY"</span><span class="token punctuation">)</span>

client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span>api_key<span class="token operator">=</span>openai<span class="token punctuation">.</span>api_key<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_53"></a>2ã€å®šä¹‰æœ¬åœ°äº‘ç›˜æ–‡ä»¶ç›®å½•åˆ›å»ºæ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">create_or_get_folder</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    æ ¹æ®é¡¹ç›®åˆ›å»ºäº‘ç›˜ç›®å½•
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    full_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span> folder_name<span class="token punctuation">)</span>
    <span class="token comment"># å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ƒ</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ç›®å½• </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>folder_name<span class="token punctuation">}</span></span><span class="token string"> åˆ›å»ºæˆåŠŸ"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"ç›®å½• </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>folder_name<span class="token punctuation">}</span></span><span class="token string"> å·²å­˜åœ¨"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> full_path
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>create_or_get_folder<span class="token punctuation">(</span>folder_name <span class="token operator">=</span> <span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/60/38/mCV3at7F_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3doc_78"></a>3ã€å®šä¹‰docæ–‡æ¡£åˆ›å»ºæ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_or_get_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åˆ›å»ºæˆ–è·å–æ–‡ä»¶è·¯å¾„
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    full_path_folder<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span>folder_name<span class="token punctuation">)</span>
    file_path_doc <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">.doc'</span></span><span class="token punctuation">)</span>
    
    
     <span class="token comment"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span>
    
    <span class="token comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_path_doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶å­˜åœ¨ï¼Œæ‰“å¼€å¹¶è¿½åŠ å†…å®¹</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span>file_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£å¯¹è±¡</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token comment"># ä¿å­˜æ–‡æ¡£</span>
    document<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path_doc<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> file_path_doc
</code></pre> 
<pre><code class="prism language-python">create_or_get_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8e/75/a9PI3Wce_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4_112"></a>4ã€å®šä¹‰æ–‡ä»¶å†…å®¹è¿½åŠ æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">append_content_in_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">,</span> qa_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""""
    å¾€æ–‡ä»¶é‡Œè¿½åŠ å†…å®¹
    @param folder_name=ç›®å½•åï¼Œdoc_name=æ–‡ä»¶åï¼Œqa_string=è¿½åŠ çš„å†…å®¹
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    <span class="token comment">## ç›®å½•åœ°å€</span>
    full_path_folder<span class="token operator">=</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name
    <span class="token comment">## æ–‡ä»¶åœ°å€</span>
    full_path_doc <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".doc"</span>  

    <span class="token comment"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span>
    
    <span class="token comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶å­˜åœ¨ï¼Œæ‰“å¼€å¹¶è¿½åŠ å†…å®¹</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£å¯¹è±¡</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># è¿½åŠ å†…å®¹</span>
    document<span class="token punctuation">.</span>add_paragraph<span class="token punctuation">(</span>qa_string<span class="token punctuation">)</span>
    <span class="token comment"># ä¿å­˜æ–‡æ¡£</span>
    document<span class="token punctuation">.</span>save<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å†…å®¹å·²è¿½åŠ åˆ° </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">my_dict <span class="token operator">=</span> <span class="token string">"å¤©é’è‰²ç­‰çƒŸé›¨ï¼Œè€Œæˆ‘åœ¨ç­‰ä½ "</span>
append_content_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">,</span>qa_string<span class="token operator">=</span>my_dict<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/44/ee/9JfdSSPS_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="5_151"></a>5ã€å®šä¹‰è·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token comment">## å®ç°æ ¹æ®é¡¹ç›®å’Œæ–‡ä»¶è·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•</span>

<span class="token keyword">from</span> docx <span class="token keyword">import</span> Document
<span class="token keyword">import</span> os

<span class="token keyword">def</span> <span class="token function">get_file_content</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å®ç°æ ¹æ®é¡¹ç›®åå’Œæ–‡ä»¶åè·å–æ–‡ä»¶å†…å®¹çš„æ–¹æ³•
    @param project_name:é¡¹ç›®åï¼Œfile_nameï¼šæ–‡ä»¶å
    @return æ–‡ä»¶å†…å®¹
    """</span>
    <span class="token comment"># æ„å»ºæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span>
    full_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".doc"</span>
 
    <span class="token comment"># ç¡®ä¿æ–‡ä»¶å­˜åœ¨</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"æ–‡ä»¶ä¸å­˜åœ¨"</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># åŠ è½½æ–‡æ¡£</span>
        doc <span class="token operator">=</span> Document<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span>
        content <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token comment"># éå†æ–‡æ¡£ä¸­çš„æ¯ä¸ªæ®µè½ï¼Œå¹¶æ”¶é›†æ–‡æœ¬</span>
        <span class="token keyword">for</span> para <span class="token keyword">in</span> doc<span class="token punctuation">.</span>paragraphs<span class="token punctuation">:</span>
            content<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        
        <span class="token comment"># å°†æ‰€æœ‰æ®µè½æ–‡æœ¬åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿”å›</span>
        <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span>
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">get_file_content<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="6_193"></a>6ã€å®šä¹‰æ¸…ç†æ–‡ä»¶å†…å®¹çš„æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> docx <span class="token keyword">import</span> Document

<span class="token keyword">def</span> <span class="token function">clear_content_in_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># æ‰“å¼€æ–‡æ¡£</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">.doc'</span></span><span class="token punctuation">)</span>
    doc <span class="token operator">=</span> Document<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>

    <span class="token comment"># éå†æ¯ä¸€ä¸ªæ®µè½ï¼Œè®¾ç½®å…¶æ–‡æœ¬ä¸ºç©ºå­—ç¬¦ä¸²</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> doc<span class="token punctuation">.</span>paragraphs<span class="token punctuation">:</span>
        <span class="token keyword">for</span> run <span class="token keyword">in</span> p<span class="token punctuation">.</span>runs<span class="token punctuation">:</span>
            run<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">''</span>

    <span class="token comment"># ä¿å­˜ä¿®æ”¹åçš„æ–‡æ¡£</span>
    doc<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ–‡æ¡£å†…å®¹æ¸…é™¤å®Œæ¯•"</span><span class="token punctuation">)</span>
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">clear_content_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="7_218"></a>7ã€å®šä¹‰è·å–æ–‡ä»¶åˆ—è¡¨çš„æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">list_files_in_folder</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åˆ—ä¸¾å½“å‰æ–‡ä»¶å¤¹çš„å…¨éƒ¨æ–‡ä»¶
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    full_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span>folder_name <span class="token punctuation">)</span>
    file_names <span class="token operator">=</span> <span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>full_path<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        
    <span class="token keyword">return</span> file_names
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">list_files_in_folder<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="8_237"></a>8ã€å®šä¹‰æ–‡ä»¶é‡å‘½åçš„æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">rename_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">,</span> new_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ä¿®æ”¹æŒ‡å®šçš„æ–‡æ¡£åç§°
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">.doc'</span></span><span class="token punctuation">)</span>
    new_file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>new_name<span class="token punctuation">}</span></span><span class="token string">.doc'</span></span><span class="token punctuation">)</span>
    <span class="token comment"># é‡å‘½åæ–‡ä»¶</span>
    os<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> new_file_path<span class="token punctuation">)</span>
      
    <span class="token keyword">return</span> new_name
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">rename_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">,</span>new_name<span class="token operator">=</span><span class="token string">"æ•°æ®å¯è§†åŒ–åˆ†ææŠ¥å‘Š"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="9_258"></a>9ã€å®šä¹‰åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">delete_all_files_in_folder</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åˆ é™¤æŸæ–‡ä»¶å¤¹å†…å…¨éƒ¨æ–‡ä»¶
    """</span>
    <span class="token comment"># å®šä¹‰è¦åˆ é™¤çš„ç›®å½•è·¯å¾„</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    full_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>base_path<span class="token punctuation">,</span>folder_name<span class="token punctuation">)</span>
    <span class="token comment"># éå†æ•´ä¸ªç›®å½•</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># æ„é€ æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„</span>
        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>full_path<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™åˆ é™¤æ–‡ä»¶</span>
            <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span> <span class="token keyword">or</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>islink<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                os<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
            <span class="token comment"># å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™åˆ é™¤æ–‡ä»¶å¤¹</span>
            <span class="token keyword">elif</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>file_path<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶å·²æ¸…é™¤å®Œæ¯•"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to delete %s. Reason: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">delete_all_files_in_folder<span class="token punctuation">(</span>folder_name <span class="token operator">=</span> <span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="10_288"></a>10ã€å®šä¹‰è¿½åŠ å›¾ç‰‡çš„æ–¹æ³•</h3> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> docx <span class="token keyword">import</span> Document
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> os
<span class="token keyword">import</span> tempfile

<span class="token keyword">def</span> <span class="token function">append_img_in_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""""
    å¾€æ–‡ä»¶é‡Œè¿½åŠ å›¾ç‰‡
    @param folder_name=ç›®å½•åï¼Œdoc_name=æ–‡ä»¶åï¼Œimg=å›¾ç‰‡å¯¹è±¡ï¼Œæ•°æ®ç±»å‹ä¸ºmatplotlib.figure.Figureå¯¹è±¡
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    <span class="token comment">## ç›®å½•åœ°å€</span>
    full_path_folder<span class="token operator">=</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name
    <span class="token comment">## æ–‡ä»¶åœ°å€</span>
    full_path_doc <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".doc"</span>
    

    <span class="token comment"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span>
    
    <span class="token comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
        <span class="token comment"># æ–‡ä»¶å­˜åœ¨ï¼Œæ‰“å¼€å¹¶è¿½åŠ å†…å®¹</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£å¯¹è±¡</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># è¿½åŠ å›¾ç‰‡</span>
    <span class="token comment"># å°†matplotlibçš„Figureå¯¹è±¡ä¿å­˜ä¸ºä¸´æ—¶å›¾ç‰‡æ–‡ä»¶</span>
    <span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> suffix<span class="token operator">=</span><span class="token string">'.png'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tmpfile<span class="token punctuation">:</span>
        img<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>tmpfile<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'png'</span><span class="token punctuation">)</span>
        <span class="token comment"># å°†å›¾ç‰‡æ’å…¥åˆ°.docxæ–‡æ¡£ä¸­</span>
        document<span class="token punctuation">.</span>add_picture<span class="token punctuation">(</span>tmpfile<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    
    <span class="token comment"># ä¿å­˜æ–‡æ¡£</span>
    document<span class="token punctuation">.</span>save<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å›¾ç‰‡å·²è¿½åŠ åˆ° </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># åˆ›å»ºä¸€ä¸ªå›¾å½¢</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/8c/w79whhV2_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">append_img_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"æµ‹è¯•å‡½æ•°"</span><span class="token punctuation">,</span>doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æ"</span><span class="token punctuation">,</span>img<span class="token operator">=</span>fig<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/dc/xjnpujfT_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="11_348"></a>11ã€å®šä¹‰ä¸€ä¸ªäº‘ç›˜æ–‡ä»¶æ“ä½œç±»</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">CloudFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºæ“ä½œäº‘ç›˜æ–‡ä»¶
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> 
                 project_name<span class="token punctuation">,</span> 
                 part_name<span class="token punctuation">,</span> 
                 doc_content <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># é¡¹ç›®åç§°ï¼Œå³é¡¹ç›®æ–‡ä»¶å¤¹åç§°</span>
        self<span class="token punctuation">.</span>project_name <span class="token operator">=</span> project_name
        <span class="token comment"># é¡¹ç›®æŸéƒ¨åˆ†åç§°ï¼Œå³é¡¹ç›®æ–‡ä»¶åç§°</span>
        self<span class="token punctuation">.</span>part_name <span class="token operator">=</span> part_name
         <span class="token comment"># é¡¹ç›®æ–‡ä»¶å¤¹ID</span>
        <span class="token comment"># è‹¥é¡¹ç›®æ–‡ä»¶å¤¹IDä¸ºç©ºï¼Œåˆ™è·å–é¡¹ç›®æ–‡ä»¶å¤¹ID</span>
        
        folder_path<span class="token operator">=</span>create_or_get_folder<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">)</span>
         
        <span class="token comment"># åˆ›å»ºæ—¶è·å–å½“å‰é¡¹ç›®ä¸­å…¶ä»–æ–‡ä»¶åç§°åˆ—è¡¨</span>
        self<span class="token punctuation">.</span>doc_list <span class="token operator">=</span> list_files_in_folder<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">)</span>
        

        file_path <span class="token operator">=</span> create_or_get_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span> 
                                       doc_name<span class="token operator">=</span>part_name<span class="token punctuation">)</span>
        
        <span class="token comment"># é¡¹ç›®æ–‡ä»¶å…·ä½“å†…å®¹ï¼Œç›¸å½“äºå¤šè½®å¯¹è¯å†…å®¹</span>
        self<span class="token punctuation">.</span>doc_content <span class="token operator">=</span> doc_content
        <span class="token comment"># è‹¥åˆå§‹contentä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶è¿½åŠ å…¥æ–‡æ¡£å†…</span>
        <span class="token keyword">if</span> doc_content <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            append_content_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span> 
                                  doc_name<span class="token operator">=</span>part_name<span class="token punctuation">,</span> 
                                  dict_list<span class="token operator">=</span>doc_content<span class="token punctuation">)</span>
            

    <span class="token keyword">def</span> <span class="token function">get_doc_content</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        æ ¹æ®é¡¹ç›®æŸæ–‡ä»¶çš„æ–‡ä»¶IDï¼Œè·å–å¯¹åº”çš„æ–‡ä»¶å†…å®¹
        """</span>     
        self<span class="token punctuation">.</span>doc_content <span class="token operator">=</span> get_file_content<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">,</span> doc_name<span class="token operator">=</span>self<span class="token punctuation">.</span>part_name<span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>doc_content

    <span class="token keyword">def</span> <span class="token function">append_doc_content</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        æ ¹æ®é¡¹ç›®æŸæ–‡ä»¶çš„æ–‡ä»¶IDï¼Œè¿½åŠ æ–‡ä»¶å†…å®¹
        """</span>  
        append_content_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">,</span>
                                  doc_name<span class="token operator">=</span>self<span class="token punctuation">.</span>part_name<span class="token punctuation">,</span> 
                                  dict_list<span class="token operator">=</span>content<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">clear_content</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        æ¸…ç©ºæŸæ–‡ä»¶å†…çš„å…¨éƒ¨å†…å®¹
        """</span>  
        clear_content_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">,</span> doc_name<span class="token operator">=</span>self<span class="token punctuation">.</span>part_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete_all_files</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        åˆ é™¤å½“å‰é¡¹ç›®æ–‡ä»¶å¤¹å†…çš„å…¨éƒ¨æ–‡ä»¶
        """</span>  
        delete_all_files_in_folder<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update_doc_list</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        æ›´æ–°å½“å‰é¡¹ç›®æ–‡ä»¶å¤¹å†…çš„å…¨éƒ¨æ–‡ä»¶åç§°
        """</span>
        self<span class="token punctuation">.</span>doc_list <span class="token operator">=</span> list_files_in_folder<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rename_doc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        ä¿®æ”¹å½“å‰æ–‡ä»¶åç§°
        """</span>
        self<span class="token punctuation">.</span>part_name <span class="token operator">=</span> rename_doc_in_drive<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>self<span class="token punctuation">.</span>project_name<span class="token punctuation">,</span> doc_name<span class="token operator">=</span>self<span class="token punctuation">.</span>part_name<span class="token punctuation">,</span> 
                                                 new_name<span class="token operator">=</span>new_name<span class="token punctuation">)</span>
</code></pre> 
<p>æœ¬åœ°å­˜å‚¨æµ‹è¯•</p> 
<pre><code class="prism language-python">c1 <span class="token operator">=</span> CloudFile<span class="token punctuation">(</span>project_name<span class="token operator">=</span><span class="token string">'æµ‹è¯•é¡¹ç›®'</span><span class="token punctuation">,</span> part_name<span class="token operator">=</span><span class="token string">'æµ‹è¯•æ–‡æ¡£1'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c4/a0/5sU0mXxO_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="Memory_433"></a>ä¸‰ã€MemoryåŠŸèƒ½å®ç°ä¹‹æ¶ˆæ¯å·¥å…·ç±»å°è£…</h2> 
<h3><a id="1_434"></a>1ã€å®šä¹‰æ¶ˆæ¯ç®¡ç†ç±»</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MessageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    MessageManagerï¼Œç”¨äºåˆ›å»ºChatæ¨¡å‹èƒ½å¤Ÿæ¥æ”¶å’Œè§£è¯»çš„messageså¯¹è±¡ã€‚è¯¥å¯¹è±¡æ˜¯åŸå§‹Chatæ¨¡å‹æ¥æ”¶çš„\
    messageså¯¹è±¡çš„æ›´é«˜çº§è¡¨ç°å½¢å¼ï¼ŒMessageManagerç±»å¯¹è±¡å°†å­—å…¸ç±»å‹çš„listä½œä¸ºå…¶å±æ€§ä¹‹ä¸€ï¼ŒåŒæ—¶è¿˜èƒ½\
    èƒ½åŒºåˆ†ç³»ç»Ÿæ¶ˆæ¯å’Œå†å²å¯¹è¯æ¶ˆæ¯ï¼Œå¹¶ä¸”èƒ½å¤Ÿè‡ªè¡Œè®¡ç®—å½“å‰å¯¹è¯çš„tokené‡ï¼Œå¹¶æ‰§èƒ½å¤Ÿåœ¨appendçš„åŒæ—¶åˆ \
    å‡æœ€æ—©å¯¹è¯æ¶ˆæ¯ï¼Œä»è€Œèƒ½å¤Ÿæ›´åŠ é¡ºç•…çš„è¾“å…¥å¤§æ¨¡å‹å¹¶å®Œæˆå¤šè½®å¯¹è¯éœ€æ±‚ã€‚
    """</span>
    
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> 
                 system_content_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                 question<span class="token operator">=</span><span class="token string">'ä½ å¥½ã€‚'</span><span class="token punctuation">,</span>
                 tokens_thr<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> 
                 project<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        self<span class="token punctuation">.</span>system_content_list <span class="token operator">=</span> system_content_list
        <span class="token comment"># ç³»ç»Ÿæ¶ˆæ¯æ–‡æ¡£åˆ—è¡¨ï¼Œç›¸å½“äºå¤–éƒ¨è¾“å…¥æ–‡æ¡£åˆ—è¡¨</span>
        system_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># é™¤ç³»ç»Ÿæ¶ˆæ¯å¤–å†å²å¯¹è¯æ¶ˆæ¯</span>
        history_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># ç”¨äºä¿å­˜å…¨éƒ¨æ¶ˆæ¯çš„list</span>
        messages_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># ç³»ç»Ÿæ¶ˆæ¯å­—ç¬¦ä¸²</span>
        system_content <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment"># å†å²æ¶ˆæ¯å­—ç¬¦ä¸²ï¼Œæ­¤æ—¶ä¸ºç”¨æˆ·è¾“å…¥ä¿¡æ¯</span>
        history_content <span class="token operator">=</span> question
        <span class="token comment"># ç³»ç»Ÿæ¶ˆæ¯+å†å²æ¶ˆæ¯å­—ç¬¦ä¸²</span>
        content_all <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment"># è¾“å…¥åˆ°messagesä¸­ç³»ç»Ÿæ¶ˆæ¯ä¸ªæ•°ï¼Œåˆå§‹æƒ…å†µä¸º0</span>
        num_of_system_messages <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># å…¨éƒ¨ä¿¡æ¯çš„tokenæ•°é‡</span>
        all_tokens_count <span class="token operator">=</span> <span class="token number">0</span>
        
        encoding <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>encoding_for_model<span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># å°†å¤–éƒ¨è¾“å…¥æ–‡æ¡£åˆ—è¡¨ä¾æ¬¡ä¿å­˜ä¸ºç³»ç»Ÿæ¶ˆæ¯</span>
        <span class="token keyword">if</span> system_content_list <span class="token operator">!=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>      
            <span class="token keyword">for</span> content <span class="token keyword">in</span> system_content_list<span class="token punctuation">:</span>
                system_messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> content<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment"># åŒæ—¶è¿›è¡Œå…¨æ–‡æ¡£æ‹¼æ¥</span>
                system_content <span class="token operator">+=</span> content
                
            <span class="token comment"># è®¡ç®—ç³»ç»Ÿæ¶ˆæ¯token</span>
            system_tokens_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>system_content<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># æ‹¼æ¥ç³»ç»Ÿæ¶ˆæ¯</span>
            messages_all <span class="token operator">+=</span> system_messages
            <span class="token comment"># è®¡ç®—ç³»ç»Ÿæ¶ˆæ¯ä¸ªæ•°</span>
            num_of_system_messages <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>system_content_list<span class="token punctuation">)</span>
                
            <span class="token comment"># è‹¥å­˜åœ¨æœ€å¤§tokenæ•°é‡é™åˆ¶</span>
            <span class="token keyword">if</span> tokens_thr <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token comment"># è‹¥ç³»ç»Ÿæ¶ˆæ¯è¶…å‡ºé™åˆ¶</span>
                <span class="token keyword">if</span> system_tokens_count <span class="token operator">&gt;=</span> tokens_thr<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"system_messagesçš„tokensæ•°é‡è¶…å‡ºé™åˆ¶ï¼Œå½“å‰ç³»ç»Ÿæ¶ˆæ¯å°†ä¸ä¼šè¢«è¾“å…¥æ¨¡å‹"</span><span class="token punctuation">)</span>            
                    <span class="token comment"># åˆ é™¤ç³»ç»Ÿæ¶ˆæ¯</span>
                    system_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    messages_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token comment"># ç³»ç»Ÿæ¶ˆæ¯ä¸ªæ•°æ¸…é›¶</span>
                    num_of_system_messages <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token comment"># ç³»ç»Ÿæ¶ˆæ¯tokenæ•°æ¸…é›¶</span>
                    system_tokens_count <span class="token operator">=</span> <span class="token number">0</span>
                    
            all_tokens_count <span class="token operator">+=</span> system_tokens_count
        
        <span class="token comment"># åˆ›å»ºé¦–æ¬¡å¯¹è¯æ¶ˆæ¯</span>
        history_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token comment"># åˆ›å»ºå…¨éƒ¨æ¶ˆæ¯åˆ—è¡¨</span>
        messages_all <span class="token operator">+=</span> history_messages
        
        <span class="token comment"># è®¡ç®—ç”¨æˆ·é—®é¢˜token</span>
        user_tokens_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>question<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># è®¡ç®—æ€»tokenæ•°</span>
        all_tokens_count <span class="token operator">+=</span> user_tokens_count
        
        <span class="token comment"># è‹¥å­˜åœ¨æœ€å¤§tokené™åˆ¶</span>
        <span class="token keyword">if</span> tokens_thr <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># è‹¥è¶…å‡ºæœ€å¤§tokené™åˆ¶</span>
            <span class="token keyword">if</span> all_tokens_count <span class="token operator">&gt;=</span> tokens_thr<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å½“å‰ç”¨æˆ·é—®é¢˜çš„tokensæ•°é‡è¶…å‡ºé™åˆ¶ï¼Œè¯¥æ¶ˆæ¯æ— æ³•è¢«è¾“å…¥åˆ°æ¨¡å‹ä¸­"</span><span class="token punctuation">)</span>  
                <span class="token comment"># åŒæ—¶æ¸…ç©ºç³»ç»Ÿæ¶ˆæ¯å’Œç”¨æˆ·æ¶ˆæ¯</span>
                history_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                system_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                messages_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                num_of_system_messages <span class="token operator">=</span> <span class="token number">0</span>
                all_tokens_count <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token comment"># å…¨éƒ¨messagesä¿¡æ¯</span>
        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> messages_all
        <span class="token comment"># system_messagesä¿¡æ¯</span>
        self<span class="token punctuation">.</span>system_messages <span class="token operator">=</span> system_messages
        <span class="token comment"># user_messagesä¿¡æ¯</span>
        self<span class="token punctuation">.</span>history_messages <span class="token operator">=</span> history_messages
        <span class="token comment"># messagesä¿¡æ¯ä¸­å…¨éƒ¨contentçš„tokenæ•°é‡</span>
        self<span class="token punctuation">.</span>tokens_count <span class="token operator">=</span> all_tokens_count
        <span class="token comment"># ç³»ç»Ÿä¿¡æ¯æ•°é‡</span>
        self<span class="token punctuation">.</span>num_of_system_messages <span class="token operator">=</span> num_of_system_messages
        <span class="token comment"># æœ€å¤§tokenæ•°é‡é˜ˆå€¼</span>
        self<span class="token punctuation">.</span>tokens_thr <span class="token operator">=</span> tokens_thr
        <span class="token comment"># tokenæ•°è®¡ç®—ç¼–ç æ–¹å¼</span>
        self<span class="token punctuation">.</span>encoding <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>encoding_for_model<span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>
        <span class="token comment"># messageæŒ‚é çš„é¡¹ç›®</span>
        self<span class="token punctuation">.</span>project <span class="token operator">=</span> project
     
    <span class="token comment"># åˆ é™¤éƒ¨åˆ†å¯¹è¯ä¿¡æ¯</span>
    <span class="token keyword">def</span> <span class="token function">messages_pop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> manual<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">reduce_tokens</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
            drop_message <span class="token operator">=</span> self<span class="token punctuation">.</span>history_messages<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>index<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>tokens_count <span class="token operator">-=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>drop_message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>tokens_thr <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> self<span class="token punctuation">.</span>tokens_count <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>tokens_thr<span class="token punctuation">:</span>
                reduce_tokens<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> manual<span class="token punctuation">:</span>
            <span class="token keyword">if</span> index <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                reduce_tokens<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>history_messages<span class="token punctuation">)</span> <span class="token keyword">or</span> index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                reduce_tokens<span class="token punctuation">(</span>index<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Invalid index value: {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># æ›´æ–°messages</span>
        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> self<span class="token punctuation">.</span>system_messages <span class="token operator">+</span> self<span class="token punctuation">.</span>history_messages
       
    <span class="token comment"># å¢åŠ éƒ¨åˆ†å¯¹è¯ä¿¡æ¯</span>
    <span class="token keyword">def</span> <span class="token function">messages_append</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_messages<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token comment"># è‹¥æ˜¯å•ç‹¬ä¸€ä¸ªå­—å…¸ï¼Œæˆ–JSONæ ¼å¼å­—å…¸</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>new_messages<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token builtin">dict</span> <span class="token keyword">or</span> <span class="token builtin">type</span><span class="token punctuation">(</span>new_messages<span class="token punctuation">)</span> <span class="token keyword">is</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>chat_completion_message<span class="token punctuation">.</span>ChatCompletionMessage<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_messages<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>tokens_count <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>new_messages<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token comment"># è‹¥æ–°æ¶ˆæ¯ä¹Ÿæ˜¯MessageManagerå¯¹è±¡</span>
        <span class="token keyword">elif</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>new_messages<span class="token punctuation">,</span> MessageManager<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>messages <span class="token operator">+=</span> new_messages<span class="token punctuation">.</span>messages
            self<span class="token punctuation">.</span>tokens_count <span class="token operator">+=</span> new_messages<span class="token punctuation">.</span>tokens_count

        <span class="token comment"># é‡æ–°æ›´æ–°history_messages</span>
        self<span class="token punctuation">.</span>history_messages <span class="token operator">=</span> self<span class="token punctuation">.</span>messages<span class="token punctuation">[</span>self<span class="token punctuation">.</span>num_of_system_messages<span class="token punctuation">:</span> <span class="token punctuation">]</span>
        
        <span class="token comment"># å†æ‰§è¡Œpopï¼Œè‹¥æœ‰éœ€è¦ï¼Œåˆ™ä¼šåˆ é™¤éƒ¨åˆ†å†å²æ¶ˆæ¯</span>
        self<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
      
    <span class="token comment"># å¤åˆ¶ä¿¡æ¯</span>
    <span class="token keyword">def</span> <span class="token function">copy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºä¸€ä¸ªæ–°çš„ MessageManager å¯¹è±¡ï¼Œå¤åˆ¶æ‰€æœ‰é‡è¦çš„å±æ€§</span>
        system_content_str_list <span class="token operator">=</span> <span class="token punctuation">[</span>message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token keyword">for</span> message <span class="token keyword">in</span> self<span class="token punctuation">.</span>system_messages<span class="token punctuation">]</span>
        new_obj <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>
            system_content_list<span class="token operator">=</span>copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>system_content_str_list<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ä½¿ç”¨æ·±å¤åˆ¶æ¥å¤åˆ¶ç³»ç»Ÿæ¶ˆæ¯</span>
            question<span class="token operator">=</span>self<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>history_messages <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span>
            tokens_thr<span class="token operator">=</span>self<span class="token punctuation">.</span>tokens_thr
        <span class="token punctuation">)</span>
        <span class="token comment"># å¤åˆ¶ä»»ä½•å…¶ä»–éœ€è¦å¤åˆ¶çš„å±æ€§</span>
        new_obj<span class="token punctuation">.</span>history_messages <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>history_messages<span class="token punctuation">)</span>  <span class="token comment"># ä½¿ç”¨æ·±å¤åˆ¶æ¥å¤åˆ¶å†å²æ¶ˆæ¯</span>
        new_obj<span class="token punctuation">.</span>messages <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>messages<span class="token punctuation">)</span>  <span class="token comment"># ä½¿ç”¨æ·±å¤åˆ¶æ¥å¤åˆ¶æ‰€æœ‰æ¶ˆæ¯</span>
        new_obj<span class="token punctuation">.</span>tokens_count <span class="token operator">=</span> self<span class="token punctuation">.</span>tokens_count
        new_obj<span class="token punctuation">.</span>num_of_system_messages <span class="token operator">=</span> self<span class="token punctuation">.</span>num_of_system_messages
        
        <span class="token keyword">return</span> new_obj
    
    <span class="token comment"># å¢åŠ ç³»ç»Ÿæ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">add_system_messages</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_system_content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        system_content_list <span class="token operator">=</span> self<span class="token punctuation">.</span>system_content_list
        system_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># è‹¥æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶è½¬åŒ–ä¸ºlist</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>new_system_content<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
            new_system_content <span class="token operator">=</span> <span class="token punctuation">[</span>new_system_content<span class="token punctuation">]</span>
            
        system_content_list<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>new_system_content<span class="token punctuation">)</span>
        new_system_content_str <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> content <span class="token keyword">in</span> new_system_content<span class="token punctuation">:</span>
            new_system_content_str <span class="token operator">+=</span> content
        new_token_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>new_system_content_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tokens_count <span class="token operator">+=</span> new_token_count
        self<span class="token punctuation">.</span>system_content_list <span class="token operator">=</span> system_content_list
        <span class="token keyword">for</span> message <span class="token keyword">in</span> system_content_list<span class="token punctuation">:</span>
            system_messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> message<span class="token punctuation">}</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>system_messages <span class="token operator">=</span> system_messages
        self<span class="token punctuation">.</span>num_of_system_messages <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>system_content_list<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> system_messages <span class="token operator">+</span> self<span class="token punctuation">.</span>history_messages
        
        <span class="token comment"># å†æ‰§è¡Œpopï¼Œè‹¥æœ‰éœ€è¦ï¼Œåˆ™ä¼šåˆ é™¤éƒ¨åˆ†å†å²æ¶ˆæ¯</span>
        self<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        
    <span class="token comment"># åˆ é™¤ç³»ç»Ÿæ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">delete_system_messages</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        system_content_list <span class="token operator">=</span> self<span class="token punctuation">.</span>system_content_list
        <span class="token keyword">if</span> system_content_list <span class="token operator">!=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            system_content_str <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword">for</span> content <span class="token keyword">in</span> system_content_list<span class="token punctuation">:</span>
                system_content_str <span class="token operator">+=</span> content
            delete_token_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>system_content_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>tokens_count <span class="token operator">-=</span> delete_token_count
            self<span class="token punctuation">.</span>num_of_system_messages <span class="token operator">=</span> <span class="token number">0</span>
            self<span class="token punctuation">.</span>system_content_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>system_messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>messages <span class="token operator">=</span> self<span class="token punctuation">.</span>history_messages
     
    <span class="token comment"># æ¸…é™¤å¯¹è¯æ¶ˆæ¯ä¸­çš„functionæ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">delete_function_messages</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># ç”¨äºåˆ é™¤å¤–éƒ¨å‡½æ•°æ¶ˆæ¯</span>
        history_messages <span class="token operator">=</span> self<span class="token punctuation">.</span>history_messages
        <span class="token comment"># ä»åå‘å‰è¿­ä»£åˆ—è¡¨</span>
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>history_messages<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            message <span class="token operator">=</span> history_messages<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
            <span class="token comment">## è¿™å„¿ä¼°è®¡æœ‰é—®é¢˜</span>
            <span class="token keyword">if</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"function_call"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> message<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"role"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"function"</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span>manual<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_648"></a>2ã€æµ‹è¯•-æŸ¥çœ‹æ¶ˆæ¯ç®¡ç†å™¨</h3> 
<pre><code class="prism language-python">msg1 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span><span class="token punctuation">)</span>
msg1<span class="token punctuation">.</span>system_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/d6/2e/DonvF5df_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3_656"></a>3ã€æµ‹è¯•-è¿½åŠ æ¶ˆæ¯</h3> 
<pre><code class="prism language-python">msg1<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/17/8a/WtTI3z6p_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg1<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"ä½ å¥½ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ ï¼Ÿ"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
msg1<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/41/45/opAURyXx_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4_669"></a>4ã€æµ‹è¯•-åˆ é™¤æ¶ˆæ¯</h3> 
<pre><code class="prism language-python">msg1<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span>manual<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
msg1<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/60/9d/BJyw4IgL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="5_677"></a>5ã€æ·»åŠ èƒŒæ™¯çŸ¥è¯†</h3> 
<pre><code class="prism language-python"><span class="token comment"># æ•°æ®å­—å…¸æ–‡ä»¶</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/root/autodl-tmp/iqueryé¡¹ç›®/data/æ•°æ®å­—å…¸/iqueryæ•°æ®å­—å…¸.md'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    data_dictionary <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># æ•°æ®åˆ†ææŠ¥å‘Šç¼–å†™ä¸“å®¶æ–‡æ¡£</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/root/autodl-tmp/iqueryé¡¹ç›®/data/ä¸šåŠ¡çŸ¥è¯†/æœ¬å…¬å¸æ•°æ®åˆ†æå¸ˆä¸šåŠ¡ä»‹ç».md'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    da_instruct <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">msg2 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">,</span> da_instruct<span class="token punctuation">]</span><span class="token punctuation">)</span>
msg2<span class="token punctuation">.</span>system_messages
</code></pre> 
<p>è¾“å‡º<br> <img src="https://images2.imgbox.com/20/89/GsLwYLQ9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="Tools_698"></a>å››ã€ToolsåŠŸèƒ½ä¹‹å‡½æ•°å°è£…</h2> 
<h3><a id="1_699"></a>1ã€è·å–è¡¨ç»“æ„åŸºæœ¬ä¿¡æ¯ï¼ˆå·¥å…·å‡½æ•°ï¼‰</h3> 
<p>å®šä¹‰ä¸€ä¸ªSQLå·¥å…·å‡½æ•°ï¼Œç”¨äºè·å–è¡¨ç»“æ„ä¿¡æ¯ï¼Œä½œä¸ºå¤§æ¨¡å‹ç”ŸæˆSQLçš„èƒŒæ™¯çŸ¥è¯†</p> 
<pre><code class="prism language-python"><span class="token comment">## mysql hive sparksql</span>
<span class="token keyword">def</span> <span class="token function">sql_inter</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token string">'globals()'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºè·å–iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨çš„æœ‰å…³ç›¸å…³ä¿¡æ¯ï¼Œ\
    æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†è¾“å…¥çš„SQLä»£ç ä¼ è¾“è‡³iqueryæ•°æ®åº“æ‰€åœ¨çš„MySQLç¯å¢ƒä¸­è¿›è¡Œè¿è¡Œï¼Œ\
    å¹¶æœ€ç»ˆè¿”å›SQLä»£ç è¿è¡Œç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬å‡½æ•°æ˜¯å€ŸåŠ©pymysqlæ¥è¿æ¥MySQLæ•°æ®åº“ã€‚
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæ‰§è¡Œå¯¹MySQLä¸­iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è·å¾—å„è¡¨ä¸­çš„å„ç±»ç›¸å…³ä¿¡æ¯
    :param g: gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯
    :returnï¼šsql_queryåœ¨MySQLä¸­çš„è¿è¡Œç»“æœã€‚
    """</span>
    
    mysql_pw <span class="token operator">=</span> <span class="token string">"iquery_agent"</span>
    
    connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
            host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>
            user<span class="token operator">=</span><span class="token string">'iquery_agent'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>
            passwd<span class="token operator">=</span>mysql_pw<span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>
            db<span class="token operator">=</span><span class="token string">'iquery'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>
            charset<span class="token operator">=</span><span class="token string">'utf8'</span>  <span class="token comment"># å­—ç¬¦é›†é€‰æ‹©utf8</span>
        <span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
            <span class="token comment"># SQLæŸ¥è¯¢è¯­å¥</span>
            sql <span class="token operator">=</span> sql_query
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

            <span class="token comment"># è·å–æŸ¥è¯¢ç»“æœ</span>
            results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    
    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>results<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">sql_inter<span class="token punctuation">(</span>sql_query<span class="token operator">=</span><span class="token string">'SELECT COUNT(*) FROM user_demographics;'</span><span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2SQLpython_744"></a>2ã€æå–SQLæ•°æ®åˆ°pythonå˜é‡ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰</h3> 
<p>å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºå°†æŸ¥è¯¢åˆ°çš„è®°å½•æå–ä¿å­˜åˆ°æœ¬åœ°pythonå˜é‡ä¸­</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span>df_name<span class="token punctuation">,</span>g<span class="token operator">=</span><span class="token string">'globals()'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºå€ŸåŠ©pymysqlï¼Œå°†MySQLä¸­çš„iqueryæ•°æ®åº“ä¸­çš„è¡¨è¯»å–å¹¶ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ã€‚
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæå–MySQLä¸­iqueryæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ã€‚
    :param df_name: å°†MySQLæ•°æ®åº“ä¸­æå–çš„è¡¨æ ¼è¿›è¡Œæœ¬åœ°ä¿å­˜æ—¶çš„å˜é‡åï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚
    :param g: gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯
    :returnï¼šè¡¨æ ¼è¯»å–å’Œä¿å­˜ç»“æœ
    """</span>
    
    mysql_pw <span class="token operator">=</span> <span class="token string">"iquery_agent"</span>
    
    connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
            host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>
            user<span class="token operator">=</span><span class="token string">'iquery_agent'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>
            passwd<span class="token operator">=</span>mysql_pw<span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>
            db<span class="token operator">=</span><span class="token string">'iquery'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>
            charset<span class="token operator">=</span><span class="token string">'utf8'</span>  <span class="token comment"># å­—ç¬¦é›†é€‰æ‹©utf8</span>
        <span class="token punctuation">)</span>
    
    
    <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>df_name<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span> connection<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token string">"å·²æˆåŠŸå®Œæˆ%så˜é‡åˆ›å»º"</span> <span class="token operator">%</span> df_name
</code></pre> 
<pre><code class="prism language-python">extract_data<span class="token punctuation">(</span>sql_query <span class="token operator">=</span> <span class="token string">'SELECT * FROM user_demographics;'</span><span class="token punctuation">,</span> 
             df_name <span class="token operator">=</span> <span class="token string">'user_demographics_df'</span><span class="token punctuation">,</span> 
             g <span class="token operator">=</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/9d/XQUrgMl6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä»pythonå˜é‡ä¸­å–å‡ºæ•°æ®æŸ¥çœ‹</p> 
<pre><code class="prism language-python">user_demographics_df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/d0/OsiIX8Qw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3python_787"></a>3ã€pythonä»£ç è§£é‡Šå™¨ï¼ˆå·¥å…·å‡½æ•°ï¼‰</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">python_inter</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span>g<span class="token operator">=</span><span class="token string">'globals()'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢å’Œå¤„ç†ï¼Œå¹¶è·å–æœ€ç»ˆæŸ¥è¯¢æˆ–å¤„ç†ç»“æœã€‚
    :param py_code: å­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ï¼Œç”¨äºæ‰§è¡Œå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡Œæ“ä½œ
    :param g: gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯
    :returnï¼šä»£ç è¿è¡Œçš„æœ€ç»ˆç»“æœ
    """</span>    
    <span class="token comment"># æ·»åŠ å›¾ç‰‡å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ç»˜å›¾ä»£ç ï¼Œåˆ™åˆ›å»ºfigå¯¹è±¡</span>
    py_code <span class="token operator">=</span> insert_fig_object<span class="token punctuation">(</span>py_code<span class="token punctuation">)</span>
    global_vars_before <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    global_vars_after <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    new_vars <span class="token operator">=</span> global_vars_after <span class="token operator">-</span> global_vars_before
    <span class="token keyword">if</span> new_vars<span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>var<span class="token punctuation">:</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>var<span class="token punctuation">]</span> <span class="token keyword">for</span> var <span class="token keyword">in</span> new_vars<span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"å·²ç»é¡ºåˆ©æ‰§è¡Œä»£ç "</span>
</code></pre> 
<p>æ£€æŸ¥å›¾å½¢å¯¹è±¡ï¼Œèµ‹å€¼ç»™figï¼ˆæ–¹ä¾¿é€šè¿‡å…¨å±€å˜é‡figè¿›è¡Œç»Ÿä¸€çš„ç»˜å›¾å¯¹è±¡æ“ä½œï¼‰</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">insert_fig_object</span><span class="token punctuation">(</span>code_str<span class="token punctuation">,</span>g<span class="token operator">=</span><span class="token string">'globals()'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ä¸ºå›¾ç‰‡åˆ›å»ºfigå¯¹è±¡
    :param g: gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯
    """</span>
    <span class="token comment">#print("å¼€å§‹ç”»å›¾äº†")</span>
    <span class="token keyword">global</span> fig
    <span class="token comment"># æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ fig å¯¹è±¡çš„åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token string">'fig = plt.figure'</span> <span class="token keyword">in</span> code_str <span class="token keyword">or</span> <span class="token string">'fig, ax = plt.subplots()'</span> <span class="token keyword">in</span> code_str<span class="token punctuation">:</span>
        <span class="token keyword">return</span> code_str  <span class="token comment"># å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›åŸå§‹ä»£ç å­—ç¬¦ä¸²</span>

    <span class="token comment"># å®šä¹‰å¯èƒ½çš„åº“åˆ«åå’Œå…¨å</span>
    plot_aliases <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'plt.'</span><span class="token punctuation">,</span> <span class="token string">'matplotlib.pyplot.'</span><span class="token punctuation">,</span><span class="token string">'plot'</span><span class="token punctuation">]</span>
    sns_aliases <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sns.'</span><span class="token punctuation">,</span> <span class="token string">'seaborn.'</span><span class="token punctuation">]</span>

    <span class="token comment"># å¯»æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°ç»˜å›¾ç›¸å…³ä»£ç çš„ä½ç½®</span>
    first_plot_occurrence <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span>alias<span class="token punctuation">)</span> <span class="token keyword">for</span> alias <span class="token keyword">in</span> plot_aliases <span class="token operator">+</span> sns_aliases <span class="token keyword">if</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span>alias<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    <span class="token comment"># å¦‚æœæ‰¾åˆ°ç»˜å›¾ä»£ç ï¼Œåˆ™åœ¨è¯¥ä½ç½®ä¹‹å‰æ’å…¥ fig å¯¹è±¡çš„åˆ›å»º</span>
    <span class="token keyword">if</span> first_plot_occurrence <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        plt_figure_index <span class="token operator">=</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'plt.figure'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> plt_figure_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token comment"># å¯»æ‰¾ plt.figure åçš„æ‹¬å·ä½ç½®ï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰å‚æ•°</span>
            closing_bracket_index <span class="token operator">=</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> plt_figure_index<span class="token punctuation">)</span>
            <span class="token comment"># å¦‚æœæ‰¾åˆ°äº† plt.figure()ï¼Œåˆ™æ›¿æ¢ä¸º fig = plt.figure()</span>
            modified_str <span class="token operator">=</span> code_str<span class="token punctuation">[</span><span class="token punctuation">:</span>plt_figure_index<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'fig = '</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>plt_figure_index<span class="token punctuation">:</span>closing_bracket_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>closing_bracket_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            modified_str <span class="token operator">=</span> code_str<span class="token punctuation">[</span><span class="token punctuation">:</span>first_plot_occurrence<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'fig = plt.figure()\n'</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>first_plot_occurrence<span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> modified_str
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> code_str  <span class="token comment"># å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»˜å›¾ä»£ç ï¼Œåˆ™è¿”å›åŸå§‹ä»£ç å­—ç¬¦ä¸²</span>
</code></pre> 
<p>å›¾å½¢ç»˜åˆ¶ä»£ç æµ‹è¯•</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token comment"># æ•°æ®</span>
categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Category 1'</span><span class="token punctuation">,</span> <span class="token string">'Category 2'</span><span class="token punctuation">,</span> <span class="token string">'Category 3'</span><span class="token punctuation">,</span> <span class="token string">'Category 4'</span><span class="token punctuation">]</span>
values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>

<span class="token comment"># åˆ›å»º Figure å¯¹è±¡</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># åœ¨ Axes å¯¹è±¡ ax ä¸Šåˆ›å»ºæ¡å½¢å›¾</span>
ax<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>categories<span class="token punctuation">,</span> values<span class="token punctuation">)</span>

<span class="token comment"># æ·»åŠ æ ‡é¢˜å’Œæ ‡ç­¾</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Bar Chart Example'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Categories'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Values'</span><span class="token punctuation">)</span>

<span class="token comment"># æ˜¾ç¤ºå›¾è¡¨</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/29/pcEQejGP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>insert_fig_objectæ–¹æ³•æµ‹è¯•</p> 
<pre><code class="prism language-python">code_string <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
import matplotlib.pyplot as plt
# æ•°æ®
categories = ['Category 1', 'Category 2', 'Category 3', 'Category 4']
values = [4, 7, 1, 8]

# åˆ›å»º Figure å¯¹è±¡
fig, ax = plt.subplots()

# åœ¨ Axes å¯¹è±¡ ax ä¸Šåˆ›å»ºæ¡å½¢å›¾
ax.bar(categories, values)

# æ·»åŠ æ ‡é¢˜å’Œæ ‡ç­¾
ax.set_title('Bar Chart Example')
ax.set_xlabel('Categories')
ax.set_ylabel('Values')

# æ˜¾ç¤ºå›¾è¡¨
plt.show()
"""</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>insert_fig_object<span class="token punctuation">(</span>code_str <span class="token operator">=</span> code_string<span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/87/4e/WLdAcOOL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>py_code <span class="token operator">=</span> code_string<span class="token punctuation">,</span> g<span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/b9/dXNPWUHT_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">æŸ¥çœ‹figå¯¹è±¡
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/d8/78Cu1g6E_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4function_916"></a>4ã€functionå‡½æ•°ä¿¡æ¯ç”Ÿæˆå™¨ï¼ˆè¾…åŠ©å‡½æ•°ï¼‰</h3> 
<p>å®šä¹‰ä¸€ä¸ªç”¨äºç”Ÿæˆfunction calling å‡½æ•°ä¿¡æ¯çš„ï¼Œè¾…åŠ©å‡½æ•°ï¼ˆä¸ºäº†ä¿è¯ç¨³å®šæ€§ï¼Œå®è·µä½¿ç”¨æ˜¯æœ€å¥½æ‰‹å·¥ç¼–å†™ï¼Œé¿å…å¤§æ¨¡å‹ç”Ÿæˆçš„ç»“æ„ä½“ä¸å¤ªç¨³å®šï¼‰</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">auto_functions</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Chatæ¨¡å‹çš„functionså‚æ•°ç¼–å†™å‡½æ•°
    :param functions_list: åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‡½æ•°å¯¹è±¡çš„åˆ—è¡¨ï¼›
    :returnï¼šæ»¡è¶³Chatæ¨¡å‹functionså‚æ•°è¦æ±‚çš„functionså¯¹è±¡
    """</span>
    <span class="token keyword">def</span> <span class="token function">functions_generate</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºç©ºåˆ—è¡¨ï¼Œç”¨äºä¿å­˜æ¯ä¸ªå‡½æ•°çš„æè¿°å­—å…¸</span>
        functions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># å¯¹æ¯ä¸ªå¤–éƒ¨å‡½æ•°è¿›è¡Œå¾ªç¯</span>
        <span class="token keyword">for</span> function <span class="token keyword">in</span> functions_list<span class="token punctuation">:</span>
            <span class="token comment"># è¯»å–å‡½æ•°å¯¹è±¡çš„å‡½æ•°è¯´æ˜</span>
            function_description <span class="token operator">=</span> inspect<span class="token punctuation">.</span>getdoc<span class="token punctuation">(</span>function<span class="token punctuation">)</span>
            <span class="token comment"># è¯»å–å‡½æ•°çš„å‡½æ•°åå­—ç¬¦ä¸²</span>
            function_name <span class="token operator">=</span> function<span class="token punctuation">.</span>__name__

            system_prompt <span class="token operator">=</span> <span class="token string">'ä»¥ä¸‹æ˜¯æŸçš„å‡½æ•°è¯´æ˜ï¼š%s'</span> <span class="token operator">%</span> function_description
            user_prompt <span class="token operator">=</span> 'æ ¹æ®è¿™ä¸ªå‡½æ•°çš„å‡½æ•°è¯´æ˜ï¼Œè¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªJSONæ ¼å¼çš„å­—å…¸ï¼Œè¿™ä¸ªå­—å…¸æœ‰å¦‚ä¸‹<span class="token number">5</span>ç‚¹è¦æ±‚ï¼š\
                           <span class="token number">1.</span>å­—å…¸æ€»å…±æœ‰ä¸‰ä¸ªé”®å€¼å¯¹ï¼›\
                           <span class="token number">2.</span>ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²nameï¼Œvalueæ˜¯è¯¥å‡½æ•°çš„åå­—ï¼š<span class="token operator">%</span>sï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼›\
                           <span class="token number">3.</span>ç¬¬äºŒä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²descriptionï¼Œvalueæ˜¯è¯¥å‡½æ•°çš„å‡½æ•°çš„åŠŸèƒ½è¯´æ˜ï¼Œä¹Ÿæ˜¯å­—ç¬¦ä¸²ï¼›\
                           <span class="token number">4.</span>ç¬¬ä¸‰ä¸ªé”®å€¼å¯¹çš„Keyæ˜¯å­—ç¬¦ä¸²parametersï¼Œvalueæ˜¯ä¸€ä¸ªJSON Schemaå¯¹è±¡ï¼Œç”¨äºè¯´æ˜è¯¥å‡½æ•°çš„å‚æ•°è¾“å…¥è§„èŒƒã€‚\
                           <span class="token number">5.</span>è¾“å‡ºç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªJSONæ ¼å¼çš„å­—å…¸ï¼Œåªè¾“å‡ºè¿™ä¸ªå­—å…¸å³å¯ï¼Œå‰åä¸éœ€è¦ä»»ä½•å‰åä¿®é¥°æˆ–è¯´æ˜çš„è¯­å¥' <span class="token operator">%</span> function_name

            response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                              model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
                              messages<span class="token operator">=</span><span class="token punctuation">[</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> system_prompt<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_prompt<span class="token punctuation">}</span>
                              <span class="token punctuation">]</span>
                            <span class="token punctuation">)</span>
            json_function_description<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"```"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            json_str<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span><span class="token string">"function"</span><span class="token punctuation">:</span>json_function_description<span class="token punctuation">}</span>
            functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> functions
    
    max_attempts <span class="token operator">=</span> <span class="token number">4</span>
    attempts <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span> attempts <span class="token operator">&lt;</span> max_attempts<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            functions <span class="token operator">=</span> functions_generate<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
            <span class="token keyword">break</span>  <span class="token comment"># å¦‚æœä»£ç æˆåŠŸæ‰§è¡Œï¼Œè·³å‡ºå¾ªç¯</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            attempts <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># å¢åŠ å°è¯•æ¬¡æ•°</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å‘ç”Ÿé”™è¯¯ï¼š"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            <span class="token keyword">if</span> attempts <span class="token operator">==</span> max_attempts<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œç¨‹åºç»ˆæ­¢ã€‚"</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span>  <span class="token comment"># é‡æ–°å¼•å‘æœ€åä¸€ä¸ªå¼‚å¸¸</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨é‡æ–°è¿è¡Œ..."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> functions
</code></pre> 
<h3><a id="5function_975"></a>5ã€functionå‡½æ•°è°ƒç”¨è¾…åŠ©ç±»</h3> 
<p>è´Ÿè´£æ‰¿æ¥å¤–éƒ¨å‡½æ•°è°ƒç”¨æ—¶ç›¸å…³åŠŸèƒ½æ”¯æŒã€‚<br> ç±»å±æ€§åŒ…æ‹¬å¤–éƒ¨å‡½æ•°åˆ—è¡¨ã€å¤–éƒ¨å‡½æ•°å‚æ•°è¯´æ˜åˆ—è¡¨ã€ä»¥åŠè°ƒç”¨æ–¹å¼è¯´æ˜ä¸‰é¡¹ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">AvailableFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å¤–éƒ¨å‡½æ•°ç±»ï¼Œä¸»è¦è´Ÿè´£æ‰¿æ¥å¤–éƒ¨å‡½æ•°è°ƒç”¨æ—¶ç›¸å…³åŠŸèƒ½æ”¯æŒã€‚ç±»å±æ€§åŒ…æ‹¬å¤–éƒ¨å‡½æ•°åˆ—è¡¨ã€å¤–éƒ¨å‡½æ•°å‚æ•°è¯´æ˜åˆ—è¡¨ã€ä»¥åŠè°ƒç”¨æ–¹å¼è¯´æ˜ä¸‰é¡¹ã€‚
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> functions_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> functions<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> function_call<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>functions_list <span class="token operator">=</span> functions_list
        self<span class="token punctuation">.</span>functions <span class="token operator">=</span> functions
        self<span class="token punctuation">.</span>functions_dic <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>function_call <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token comment"># å½“å¤–éƒ¨å‡½æ•°åˆ—è¡¨ä¸ä¸ºç©ºã€ä¸”å¤–éƒ¨å‡½æ•°å‚æ•°è§£é‡Šä¸ºç©ºæ—¶ï¼Œè°ƒç”¨auto_functionsåˆ›å»ºå¤–éƒ¨å‡½æ•°è§£é‡Šåˆ—è¡¨</span>
        <span class="token keyword">if</span> functions_list <span class="token operator">!=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>functions_dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">:</span> func <span class="token keyword">for</span> func <span class="token keyword">in</span> functions_list<span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>function_call <span class="token operator">=</span> function_call
            <span class="token keyword">if</span> functions <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>functions <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
       
    <span class="token comment"># å¢åŠ å¤–éƒ¨å‡½æ•°æ–¹æ³•ï¼Œå¹¶ä¸”åŒæ—¶å¯ä»¥æ›´æ¢å¤–éƒ¨å‡½æ•°è°ƒç”¨è§„åˆ™</span>
    <span class="token keyword">def</span> <span class="token function">add_function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> new_function<span class="token punctuation">,</span> function_description<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> function_call_update<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>functions_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_function<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>functions_dic<span class="token punctuation">[</span>new_function<span class="token punctuation">.</span>__name__<span class="token punctuation">]</span> <span class="token operator">=</span> new_function
        <span class="token keyword">if</span> function_description <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            new_function_description <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span><span class="token punctuation">[</span>new_function<span class="token punctuation">]</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_function_description<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>function_description<span class="token punctuation">)</span>
        <span class="token keyword">if</span> function_call_update <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>function_call <span class="token operator">=</span> function_call_update
</code></pre> 
<pre><code class="prism language-python">af <span class="token operator">=</span> AvailableFunctions<span class="token punctuation">(</span>functions_list<span class="token operator">=</span><span class="token punctuation">[</span>sql_inter<span class="token punctuation">,</span> extract_data<span class="token punctuation">,</span> python_inter<span class="token punctuation">]</span><span class="token punctuation">)</span>
af<span class="token punctuation">.</span>functions_list
</code></pre> 
<p><img src="https://images2.imgbox.com/e6/f2/NRWmCHeu_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">af<span class="token punctuation">.</span>functions_dic
</code></pre> 
<p><img src="https://images2.imgbox.com/10/ff/pn75FNM5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">af<span class="token punctuation">.</span>function_call
</code></pre> 
<p><img src="https://images2.imgbox.com/ac/b4/T0bwDg1I_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">af<span class="token punctuation">.</span>functions
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span>
  <span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'sql_inter'</span><span class="token punctuation">,</span>
   <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨äºè·å–iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨çš„æœ‰å…³ç›¸å…³ä¿¡æ¯ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†è¾“å…¥çš„SQLä»£ç ä¼ è¾“è‡³iqueryæ•°æ®åº“æ‰€åœ¨çš„MySQLç¯å¢ƒä¸­è¿›è¡Œè¿è¡Œï¼Œå¹¶æœ€ç»ˆè¿”å›SQLä»£ç è¿è¡Œç»“æœã€‚'</span><span class="token punctuation">,</span>
   <span class="token string">'parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
    <span class="token string">'properties'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'sql_query'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
      <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæ‰§è¡Œå¯¹MySQLä¸­iqueryæ•°æ®åº“ä¸­å„å¼ è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è·å¾—å„è¡¨ä¸­çš„å„ç±»ç›¸å…³ä¿¡æ¯ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token string">'g'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
      <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sql_query'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span>
  <span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'extract_data'</span><span class="token punctuation">,</span>
   <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨äºå€ŸåŠ©pymysqlï¼Œå°†MySQLä¸­çš„iqueryæ•°æ®åº“ä¸­çš„è¡¨è¯»å–å¹¶ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ã€‚'</span><span class="token punctuation">,</span>
   <span class="token string">'parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
    <span class="token string">'properties'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'sql_query'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
      <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæå–MySQLä¸­iqueryæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token string">'df_name'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
      <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å°†MySQLæ•°æ®åº“ä¸­æå–çš„è¡¨æ ¼è¿›è¡Œæœ¬åœ°ä¿å­˜æ—¶çš„å˜é‡åï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token string">'g'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sql_query'</span><span class="token punctuation">,</span> <span class="token string">'df_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span>
  <span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'python_inter'</span><span class="token punctuation">,</span>
   <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨äºå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢å’Œå¤„ç†ï¼Œå¹¶è·å–æœ€ç»ˆæŸ¥è¯¢æˆ–å¤„ç†ç»“æœã€‚'</span><span class="token punctuation">,</span>
   <span class="token string">'parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'$schema'</span><span class="token punctuation">:</span> <span class="token string">'http://-schema.org/draft-07/schema#'</span><span class="token punctuation">,</span>
    <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
    <span class="token string">'properties'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'py_code'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
      <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ï¼Œç”¨äºæ‰§è¡Œå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡Œæ“ä½œ'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token string">'g'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'gï¼Œå­—ç¬¦ä¸²å½¢å¼å˜é‡ï¼Œè¡¨ç¤ºç¯å¢ƒå˜é‡ï¼Œæ— éœ€è®¾ç½®ï¼Œä¿æŒé»˜è®¤å‚æ•°å³å¯'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_1062"></a>ä¸‰ã€ç»“è¯­</h2> 
<p>æœ¬æ–‡ä¸­æˆ‘ä»¬å°è£…è½åœ°äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­çš„Toolså’ŒMemoryç›¸å…³ä»£ç ï¼Œä¸‹ä¸€ç¯‡ç« ä¸­æˆ‘å°†è½åœ°å®è·µAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ ¸å¿ƒæ¨¡å—Planï¼Œæ¢ç´¢å‘æ˜äººç±»æ„å›¾ï¼Œä¼˜åŒ–æ•´ä¸ªå†³ç­–æµç¨‹ã€‚</p> 
<p><img src="https://images2.imgbox.com/79/98/wuBjWCuw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ¯ğŸ”–æ›´å¤šä¸“æ ç³»åˆ—æ–‡ç« ï¼š<a href="https://blog.csdn.net/xiaobing259/category_12628007.html?spm=1001.2014.3001.5482"><strong>AIGC-AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯</strong></a></p> 
<blockquote> 
 <p>ğŸ˜ <strong>ä½œè€…ä»‹ç»</strong>ï¼šæˆ‘æ˜¯å¯»é“AIå°å…µï¼Œèµ„æ·±ç¨‹åºè€çŒ¿ï¼Œä»ä¸š10å¹´+ã€äº’è”ç½‘ç³»ç»Ÿæ¶æ„å¸ˆï¼Œç›®å‰ä¸“æ³¨äºAIGCçš„æ¢ç´¢ã€‚<br> ğŸ“– <strong>æŠ€æœ¯äº¤æµ</strong>ï¼šå»ºç«‹æœ‰æŠ€æœ¯äº¤æµç¾¤ï¼Œå¯ä»¥æ‰«ç ğŸ‘‡ åŠ å…¥ç¤¾ç¾¤ï¼Œ500æœ¬å„ç±»ç¼–ç¨‹ä¹¦ç±ã€AIæ•™ç¨‹ã€AIå·¥å…·ç­‰ä½ é¢†å–ï¼<br> <strong>å¦‚æœæ–‡ç« å†…å®¹å¯¹æ‚¨æœ‰æ‰€è§¦åŠ¨ï¼Œåˆ«å¿˜äº†<font color="red"><strong>ç‚¹èµã€â­å…³æ³¨ï¼Œæ”¶è—</strong></font>ï¼åŠ å…¥æˆ‘ï¼Œè®©æˆ‘ä»¬æºæ‰‹åŒè¡ŒAIçš„æ¢ç´¢ä¹‹æ—…ï¼Œä¸€èµ·å¼€å¯æ™ºèƒ½æ—¶ä»£çš„å¤§é—¨ï¼</strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3d50bb8591107bf3750f0178fda8557c/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">IDEAè¿æ¥SQL serveræ•°æ®åº“(ä¿å§†çº§è¯¦ç»†ä¸”å¿…å‘ï¼ŒåŒ…æ‹¬é˜²ç«å¢™ã€ SQL Server ç½‘ç»œé…ç½®ç­‰é—®é¢˜è§£å†³ï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f12df46f16a96fd9b6e47403849a2b5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ä¸€ç¯‡æ–‡ç« è®²é€æ•°æ®ç»“æ„ä¹‹æ ‘andäºŒå‰æ ‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>