<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringAI通过Ollama连接大语言模型通义千问 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/05928717e6766736f903b4be79098330/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringAI通过Ollama连接大语言模型通义千问">
  <meta property="og:description" content="随着大语言模型发展越来越成熟，Apache开源组织也出了自己的SpringAI开源工程
Spring AI项目旨在简化包含人工智能功能的应用程序的开发，避免不必要的复杂性。
该项目从著名的 Python 项目（例如 LangChain 和 LlamaIndex）中汲取灵感，但 Spring AI 并不是这些项目的直接移植。
支持所有主要模型，例如 OpenAI、Ollama、Azure OpenAI、Amazon Bedrock、Huggingface、Google VertextAI、Mistral AI。
支持的模型类型包括“聊天”和“文本到图像”，还有更多模型类型正在开发中。
支持所有主要矢量数据库提供商，例如 Apache Cassandra、Azure 矢量搜索、Chroma、Milvus、Neo4j、PostgreSQL/PGVector、PineCone、Qdrant、Redis 和 Weaviate
本博文分两部分，ollama环境搭建，SpringAI连接通义千问（源代码放在文章最后，可以下载）
说明：本代码使用jdk版本为17
先看效果：
一、ollama环境搭建 可以参考这篇文章的中的第三部分 【三、LLM语言模型搭建】，搭建是一样的，在此就不重复了
FastGTP环境搭建，可直接使用在项目上
二、SpringAI连接通义千问 1、配置文件，如下 上代码
server: port: 8080 spring: application: name: ai ai: ollama: base-url: http://192.168.1.200:11434 chat: enabled: true options: model: qwen:0.5b 2、java连接关键代码
String systemPrompt = &#34;{prompt}&#34;; SystemPromptTemplate systemPromptTemplate = new SystemPromptTemplate(systemPrompt); String userPrompt = message; Message userMessage = new UserMessage(userPrompt); Message systemMessage = systemPromptTemplate.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-16T23:10:14+08:00">
    <meta property="article:modified_time" content="2024-05-16T23:10:14+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringAI通过Ollama连接大语言模型通义千问</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>随着大语言模型发展越来越成熟，Apache开源组织也出了自己的SpringAI开源工程</p> 
<p>Spring AI项目旨在简化包含人工智能功能的应用程序的开发，避免不必要的复杂性。<br> 该项目从著名的 Python 项目（例如 LangChain 和 LlamaIndex）中汲取灵感，但 Spring AI 并不是这些项目的直接移植。<br> 支持所有主要模型，例如 OpenAI、Ollama、Azure OpenAI、Amazon Bedrock、Huggingface、Google VertextAI、Mistral AI。<br> 支持的模型类型包括“聊天”和“文本到图像”，还有更多模型类型正在开发中。<br> 支持所有主要矢量数据库提供商，例如 Apache Cassandra、Azure 矢量搜索、Chroma、Milvus、Neo4j、PostgreSQL/PGVector、PineCone、Qdrant、Redis 和 Weaviate</p> 
<p>本博文分两部分，ollama环境搭建，SpringAI连接通义千问（源代码放在文章最后，可以下载）</p> 
<p>说明：本代码使用jdk版本为17</p> 
<p>先看效果：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b8/d0/ihg32O6u_o.gif"></p> 
<h2>一、ollama环境搭建</h2> 
<p>可以参考这篇文章的中的第三部分  【三、LLM语言模型搭建】，搭建是一样的，在此就不重复了</p> 
<p><a href="https://www.yxtblog.com/article/1/240428230131000136" rel="nofollow" title="FastGTP环境搭建，可直接使用在项目上">FastGTP环境搭建，可直接使用在项目上</a></p> 
<h2>二、SpringAI连接通义千问</h2> 
<p>1、配置文件，如下 上代码</p> 
<pre><code class="hljs">server:
  port: 8080
spring:
  application:
    name: ai
  ai:
    ollama:
      base-url: http://192.168.1.200:11434
      chat:
        enabled: true
        options:
          model: qwen:0.5b</code></pre> 
<p>2、java连接关键代码</p> 
<pre><code class="hljs"> String systemPrompt = "{prompt}";
        SystemPromptTemplate systemPromptTemplate = new SystemPromptTemplate(systemPrompt);
        String userPrompt = message;
        Message userMessage = new UserMessage(userPrompt);
        Message systemMessage = systemPromptTemplate.createMessage(MapUtil.of("prompt", "you are a helpful AI assistant"));

        List&lt;Message&gt; list = new ArrayList&lt;&gt;();
        list.add(userMessage);
        list.add(systemMessage);
        Prompt prompt = new Prompt(list);
        Flux&lt;String&gt; response =chatClient.stream(prompt).flatMap(res-&gt;{
            List&lt;Generation&gt; generations = res.getResults();
            if(CollUtil.isNotEmpty(generations)){
                for(Generation generation:generations){
                    AssistantMessage assistantMessage =  generation.getOutput();
                    String content = assistantMessage.getContent();
                    System.out.println(content);
                    return Flux.just(content);
                }
            }
            return Flux.empty();
        });</code></pre> 
<p id="w-e-element-81">3、测试，访问 http://localhost:8080/chat?message=用python写个排序算法：</p> 
<p id="w-e-element-84">使用Apifox工具测（百度自行下载），截下截图：</p> 
<p><img alt="" height="722" src="https://images2.imgbox.com/b8/44/xvlQGBfg_o.png" width="1200"></p> 
<p></p> 
<h5>三、源代码下载</h5> 
<p><img alt="" height="172" src="https://images2.imgbox.com/f6/7e/H3JMIvVd_o.png" width="300"></p> 
<p>AI-Auto-config  工程是使用springboot的bootstrap.yml配置连接ollama<br> AI-Manual-Config  手动配置连接ollama方式</p> 
<p>下载地址：<a href="https://pan.baidu.com/s/10-Xm5_znPtKsh0GqgZpbWw?pwd=im9t%C2%A0" rel="nofollow" title="百度网盘 请输入提取码">百度网盘 请输入提取码</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/48d2cdc0f665d49b59f6ed99dd597103/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">彻底解决 `ModuleNotFoundError: No module named ‘MySQLdb‘` 这个错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fc19cba1371b629de125daa77bc07a11/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">国内唯一！阿里云荣膺MongoDB “2024年度DBaaS认证合作伙伴奖”</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>