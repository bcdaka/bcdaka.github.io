<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WPF TabControl使用时遇到的一些问题 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/eb4f41af9cb62e7a471b7cc89a97e4b8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="WPF TabControl使用时遇到的一些问题">
  <meta property="og:description" content="近期遇到的不少问题都是由于TabControl以及DataGrid导致的，不能单独说这两个控件有BUG，但是组合使用时，确实会遇到不少奇怪的问题
框架版本依然是.NET472
切换TabItem导致光标自动被设置到了某个TextBox中去了 解决了上一篇遇到的DataGrid的问题之后，但是我的界面布局是TabControl–&gt;TabItem–&gt;DataGrid–&gt;TextBox的结构，而我的TextBox则是DataGrid的最后一列，也是唯一一列可编辑列，
当我把所有的其他列都设置为ReadOnly之后，结果切换TabItem会导致焦点自动被最后一列的TextBox捕获，切换Tab后，TextBox自动进入编辑状态，而这是我不期望的情况
我判断这个是因为ReadOnly导致原本前面的单元格不再能够停靠焦点，因此尝试强制为前面的元素设置Focusable=True，发现能够解决这个问题了
第二种情况 解决了上面的问题之后，我了解导致TabItem的自动切换焦点机制，我发现我有很多其他地方也有类似问题，于是我都设置了一下Focusable，但是我在某个地方发现，这样的设置没有生效。
在一个TabItem–&gt;(StackPanel1 , StackPanel2–&gt;TextBox) 的这样的结构中，为第一个元素添加Focusable后，焦点依然被TextBox自动捕获了，
查询了一下，发现原来是TabIndex被设置成了3，TabIndex决定了用Tab进行焦点切换时的优先级，数字越小，优先级越高，默认是INT32_MAX，
于是，我将TabIndex相关设定删除后，发现果然解决了问题
TabItem的自动切换焦点也会按照TabIndex的属性来搜索当前子节点中优先级最高的节点来设置焦点
堆栈调试 我加入了GotFocus事件处理函数，来进行堆栈跟踪，下面就是截取的切换Tabitem时发生的函数调用，从中可以看到，发生了两次Focus操作，第一次Focus就是我从当前面板，点击了TabItem之后，焦点从当前位置切换到了TabItem之上
而当TabItem获得焦点之后，就立刻触发了它的默认处理函数，处理函数之中就会调用MoveFocus将焦点转移，而转移对象就是归属于目标TabItem的优先级最高的子元素
在 System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised) 在 System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args) 在 System.Windows.FrameworkElement.OnGotFocus(RoutedEventArgs e) 在 System.Windows.UIElement.IsFocused_Changed(DependencyObject d, DependencyPropertyChangedEventArgs e) 在 System.Windows.DependencyObject.OnPropertyChanged(DependencyPropertyChangedEventArgs e) 在 System.Windows.FrameworkElement.OnPropertyChanged(DependencyPropertyChangedEventArgs e) 在 System.Windows.Controls.TextBox.OnPropertyChanged(DependencyPropertyChangedEventArgs e) 在 System.Windows.DependencyObject.NotifyPropertyChange(DependencyPropertyChangedEventArgs args) 在 System.Windows.DependencyObject.UpdateEffectiveValue(EntryIndex entryIndex, DependencyProperty dp, PropertyMetadata metadata, EffectiveValueEntry oldEntry, EffectiveValueEntry&amp; newEntry, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType) 在 System.Windows.DependencyObject.SetValueCommon(DependencyProperty dp, Object value, PropertyMetadata metadata, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType, Boolean isInternal) 在 System.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-13T19:47:31+08:00">
    <meta property="article:modified_time" content="2024-08-13T19:47:31+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WPF TabControl使用时遇到的一些问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>近期遇到的不少问题都是由于TabControl以及DataGrid导致的，不能单独说这两个控件有BUG，但是组合使用时，确实会遇到不少奇怪的问题</p> 
<p>框架版本依然是.NET472</p> 
<h3><a id="TabItemTextBox_4"></a>切换TabItem导致光标自动被设置到了某个TextBox中去了</h3> 
<p>解决了上一篇遇到的DataGrid的问题之后，但是我的界面布局是TabControl–&gt;TabItem–&gt;DataGrid–&gt;TextBox的结构，而我的TextBox则是DataGrid的最后一列，也是唯一一列可编辑列，</p> 
<p>当我把所有的其他列都设置为ReadOnly之后，结果切换TabItem会导致焦点自动被最后一列的TextBox捕获，切换Tab后，TextBox自动进入编辑状态，而这是我不期望的情况</p> 
<p>我判断这个是因为ReadOnly导致原本前面的单元格不再能够停靠焦点，因此尝试强制为前面的元素设置Focusable=True，发现能够解决这个问题了</p> 
<h3><a id="_11"></a>第二种情况</h3> 
<p>解决了上面的问题之后，我了解导致TabItem的自动切换焦点机制，我发现我有很多其他地方也有类似问题，于是我都设置了一下Focusable，但是我在某个地方发现，这样的设置没有生效。</p> 
<p>在一个TabItem–&gt;(StackPanel1 , StackPanel2–&gt;TextBox) 的这样的结构中，为第一个元素添加Focusable后，焦点依然被TextBox自动捕获了，</p> 
<p>查询了一下，发现原来是TabIndex被设置成了3，TabIndex决定了用Tab进行焦点切换时的优先级，数字越小，优先级越高，默认是INT32_MAX，</p> 
<p>于是，我将TabIndex相关设定删除后，发现果然解决了问题</p> 
<p>TabItem的自动切换焦点也会按照TabIndex的属性来搜索当前子节点中优先级最高的节点来设置焦点</p> 
<h3><a id="_22"></a>堆栈调试</h3> 
<p>我加入了GotFocus事件处理函数，来进行堆栈跟踪，下面就是截取的切换Tabitem时发生的函数调用，从中可以看到，发生了两次Focus操作，第一次Focus就是我从当前面板，点击了TabItem之后，焦点从当前位置切换到了TabItem之上</p> 
<p>而当TabItem获得焦点之后，就立刻触发了它的默认处理函数，处理函数之中就会调用MoveFocus将焦点转移，而转移对象就是归属于目标TabItem的优先级最高的子元素</p> 
<pre><code class="prism language-csharp">   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>EventRoute<span class="token punctuation">.</span><span class="token function">InvokeHandlersImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> reRaised<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseEventImpl</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">.</span><span class="token function">OnGotFocus</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">IsFocused_Changed</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> d<span class="token punctuation">,</span> <span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>TextBox<span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">NotifyPropertyChange</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">UpdateEffectiveValue</span><span class="token punctuation">(</span><span class="token class-name">EntryIndex</span> entryIndex<span class="token punctuation">,</span> <span class="token class-name">DependencyProperty</span> dp<span class="token punctuation">,</span> <span class="token class-name">PropertyMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">EffectiveValueEntry</span> oldEntry<span class="token punctuation">,</span> EffectiveValueEntry<span class="token operator">&amp;</span> newEntry<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithDeferredReference<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithCurrentValue<span class="token punctuation">,</span> <span class="token class-name">OperationType</span> operationType<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">SetValueCommon</span><span class="token punctuation">(</span><span class="token class-name">DependencyProperty</span> dp<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">PropertyMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithDeferredReference<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithCurrentValue<span class="token punctuation">,</span> <span class="token class-name">OperationType</span> operationType<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isInternal<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyKey</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>FocusManager<span class="token punctuation">.</span><span class="token function">OnFocusedElementChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> d<span class="token punctuation">,</span> <span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">NotifyPropertyChange</span><span class="token punctuation">(</span><span class="token class-name">DependencyPropertyChangedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">UpdateEffectiveValue</span><span class="token punctuation">(</span><span class="token class-name">EntryIndex</span> entryIndex<span class="token punctuation">,</span> <span class="token class-name">DependencyProperty</span> dp<span class="token punctuation">,</span> <span class="token class-name">PropertyMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">EffectiveValueEntry</span> oldEntry<span class="token punctuation">,</span> EffectiveValueEntry<span class="token operator">&amp;</span> newEntry<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithDeferredReference<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithCurrentValue<span class="token punctuation">,</span> <span class="token class-name">OperationType</span> operationType<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>DependencyObject<span class="token punctuation">.</span><span class="token function">SetValueCommon</span><span class="token punctuation">(</span><span class="token class-name">DependencyProperty</span> dp<span class="token punctuation">,</span> <span class="token class-name">Object</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">PropertyMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithDeferredReference<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> coerceWithCurrentValue<span class="token punctuation">,</span> <span class="token class-name">OperationType</span> operationType<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> isInternal<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>FocusManager<span class="token punctuation">.</span><span class="token function">SetFocusedElement</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> element<span class="token punctuation">,</span> <span class="token class-name">IInputElement</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardNavigation<span class="token punctuation">.</span><span class="token function">UpdateFocusedElement</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> focusTarget<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">.</span><span class="token function">OnGotKeyboardFocus</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">KeyboardFocusChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventArgs<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Delegate</span> handler<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventHandlerInfo<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> routedEventArgs<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>EventRoute<span class="token punctuation">.</span><span class="token function">InvokeHandlersImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> reRaised<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseEventImpl</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseTrustedEvent</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessStagingArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessInput</span><span class="token punctuation">(</span><span class="token class-name">InputEventArgs</span> input<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">ChangeFocus</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> focus<span class="token punctuation">,</span> <span class="token class-name">Int32</span> timestamp<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">TryChangeFocus</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> newFocus<span class="token punctuation">,</span> <span class="token class-name">IKeyboardInputProvider</span> keyboardInputProvider<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askOld<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askNew<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> forceToNullIfFailed<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> focus<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askOld<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askNew<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> forceToNullIfFailed<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token class-name">IInputElement</span> element<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardNavigation<span class="token punctuation">.</span><span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> currentElement<span class="token punctuation">,</span> <span class="token class-name">TraversalRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ModifierKeys</span> modifierKeys<span class="token punctuation">,</span> <span class="token class-name">DependencyObject</span> firstElement<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> fromProcessInputTabKey<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>FrameworkElement<span class="token punctuation">.</span><span class="token function">MoveFocus</span><span class="token punctuation">(</span><span class="token class-name">TraversalRequest</span> request<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>TabItem<span class="token punctuation">.</span><span class="token function">OnPreviewGotKeyboardFocus</span><span class="token punctuation">(</span><span class="token class-name">KeyboardFocusChangedEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventArgs<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Delegate</span> handler<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventHandlerInfo<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> routedEventArgs<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>EventRoute<span class="token punctuation">.</span><span class="token function">InvokeHandlersImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> reRaised<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseEventImpl</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseTrustedEvent</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessStagingArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessInput</span><span class="token punctuation">(</span><span class="token class-name">InputEventArgs</span> input<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">TryChangeFocus</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> newFocus<span class="token punctuation">,</span> <span class="token class-name">IKeyboardInputProvider</span> keyboardInputProvider<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askOld<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askNew<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> forceToNullIfFailed<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> focus<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askOld<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> askNew<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> forceToNullIfFailed<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>KeyboardDevice<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token class-name">IInputElement</span> element<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">Focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>TabItem<span class="token punctuation">.</span><span class="token function">SetFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Controls<span class="token punctuation">.</span>TabItem<span class="token punctuation">.</span><span class="token function">OnMouseLeftButtonDown</span><span class="token punctuation">(</span><span class="token class-name">MouseButtonEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventArgs<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Delegate</span> handler<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventHandlerInfo<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> routedEventArgs<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>EventRoute<span class="token punctuation">.</span><span class="token function">InvokeHandlersImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> reRaised<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">ReRaiseEventAs</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">RoutedEvent</span> newEvent<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">OnMouseDownThunk</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">MouseButtonEventArgs</span> e<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventArgs<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Delegate</span> handler<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>RoutedEventHandlerInfo<span class="token punctuation">.</span><span class="token function">InvokeHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> routedEventArgs<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>EventRoute<span class="token punctuation">.</span><span class="token function">InvokeHandlersImpl</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> reRaised<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseEventImpl</span><span class="token punctuation">(</span><span class="token class-name">DependencyObject</span> sender<span class="token punctuation">,</span> <span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>UIElement<span class="token punctuation">.</span><span class="token function">RaiseTrustedEvent</span><span class="token punctuation">(</span><span class="token class-name">RoutedEventArgs</span> args<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessStagingArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputManager<span class="token punctuation">.</span><span class="token function">ProcessInput</span><span class="token punctuation">(</span><span class="token class-name">InputEventArgs</span> input<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>InputProviderSite<span class="token punctuation">.</span><span class="token function">ReportInput</span><span class="token punctuation">(</span><span class="token class-name">InputReport</span> inputReport<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Interop<span class="token punctuation">.</span>HwndMouseInputProvider<span class="token punctuation">.</span><span class="token function">ReportInput</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hwnd<span class="token punctuation">,</span> <span class="token class-name">InputMode</span> mode<span class="token punctuation">,</span> <span class="token class-name">Int32</span> timestamp<span class="token punctuation">,</span> <span class="token class-name">RawMouseActions</span> actions<span class="token punctuation">,</span> <span class="token class-name">Int32</span> x<span class="token punctuation">,</span> <span class="token class-name">Int32</span> y<span class="token punctuation">,</span> <span class="token class-name">Int32</span> wheel<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Interop<span class="token punctuation">.</span>HwndMouseInputProvider<span class="token punctuation">.</span><span class="token function">FilterMessage</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hwnd<span class="token punctuation">,</span> <span class="token class-name">WindowMessage</span> msg<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> wParam<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">,</span> Boolean<span class="token operator">&amp;</span> handled<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Interop<span class="token punctuation">.</span>HwndSource<span class="token punctuation">.</span><span class="token function">InputFilterMessage</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hwnd<span class="token punctuation">,</span> <span class="token class-name">Int32</span> msg<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> wParam<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">,</span> Boolean<span class="token operator">&amp;</span> handled<span class="token punctuation">)</span>
   在 MS<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>HwndWrapper<span class="token punctuation">.</span><span class="token function">WndProc</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hwnd<span class="token punctuation">,</span> <span class="token class-name">Int32</span> msg<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> wParam<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">,</span> Boolean<span class="token operator">&amp;</span> handled<span class="token punctuation">)</span>
   在 MS<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>HwndSubclass<span class="token punctuation">.</span><span class="token function">DispatcherCallbackOperation</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>ExceptionWrapper<span class="token punctuation">.</span><span class="token function">InternalRealCall</span><span class="token punctuation">(</span><span class="token class-name">Delegate</span> callback<span class="token punctuation">,</span> <span class="token class-name">Object</span> args<span class="token punctuation">,</span> <span class="token class-name">Int32</span> numArgs<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>ExceptionWrapper<span class="token punctuation">.</span><span class="token function">TryCatchWhen</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">Delegate</span> callback<span class="token punctuation">,</span> <span class="token class-name">Object</span> args<span class="token punctuation">,</span> <span class="token class-name">Int32</span> numArgs<span class="token punctuation">,</span> <span class="token class-name">Delegate</span> catchHandler<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">LegacyInvokeImpl</span><span class="token punctuation">(</span><span class="token class-name">DispatcherPriority</span> priority<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> timeout<span class="token punctuation">,</span> <span class="token class-name">Delegate</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span> args<span class="token punctuation">,</span> <span class="token class-name">Int32</span> numArgs<span class="token punctuation">)</span>
   在 MS<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>HwndSubclass<span class="token punctuation">.</span><span class="token function">SubclassWndProc</span><span class="token punctuation">(</span><span class="token class-name">IntPtr</span> hwnd<span class="token punctuation">,</span> <span class="token class-name">Int32</span> msg<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> wParam<span class="token punctuation">,</span> <span class="token class-name">IntPtr</span> lParam<span class="token punctuation">)</span>
   在 MS<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>UnsafeNativeMethods<span class="token punctuation">.</span><span class="token function">DispatchMessage</span><span class="token punctuation">(</span>MSG<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span>
   在 MS<span class="token punctuation">.</span>Win32<span class="token punctuation">.</span>UnsafeNativeMethods<span class="token punctuation">.</span><span class="token function">DispatchMessage</span><span class="token punctuation">(</span>MSG<span class="token operator">&amp;</span> msg<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Dispatcher<span class="token punctuation">.</span><span class="token function">PushFrameImpl</span><span class="token punctuation">(</span><span class="token class-name">DispatcherFrame</span> frame<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Application<span class="token punctuation">.</span><span class="token function">RunDispatcher</span><span class="token punctuation">(</span><span class="token class-name">Object</span> ignore<span class="token punctuation">)</span>
   在 System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Application<span class="token punctuation">.</span><span class="token function">RunInternal</span><span class="token punctuation">(</span><span class="token class-name">Window</span> window<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_105"></a>总结</h3> 
<p>处理了这几个问题之后，现在对于WPF对于焦点的处理有了更加深入的理解，理解之后，有很多奇怪的问题，也就变得合理了起来，由于在网上没有搜索到类似问题的资料，因此记录一下自己遇到的问题，和解决的方案和思路，方便自己，也为其他人提供一下相似问题的解决思路。</p> 
<p>这是上一份DataGrid相关问题的文章链接<br> <a href="https://blog.csdn.net/skyrim_H/article/details/141087626?spm=1001.2014.3001.5502">WPF DataGrid调试错误总结</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/978854eb71d8c21809b9e5b23b697fe9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">学习记录——day30 网络编程 端口号port 套接字socket TCP实现网络通信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d54470caf4fed9c5c2f6d9014bcf051f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数学建模】介绍论文书写格式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>