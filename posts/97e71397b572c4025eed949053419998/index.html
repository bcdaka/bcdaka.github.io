<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Ambari】HDP单机自动化安装（基础环境和MySQL脚本一键安装） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/97e71397b572c4025eed949053419998/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Ambari】HDP单机自动化安装（基础环境和MySQL脚本一键安装）">
  <meta property="og:description" content="🦄 个人主页——🎐开着拖拉机回家_Linux,大数据运维-CSDN博客 🎐✨🍁
🪁🍁🪁🍁🪁🍁🪁🍁 🪁🍁🪁🍁🪁🍁🪁 🪁🍁🪁🍁🪁🍁🪁🍁🪁🍁🪁🍁
感谢点赞和关注 ，每天进步一点点！加油！
目录
一、版本信息
1.1大数据组件版本
1.2Apache Components
1.3Databases支持版本
二、安装包上传
三 、服务器基础环境配置
3.1配置修改
3.2服务器环境配置
3.3MySQL数据库安装
四、安装Ambari-server
4.1 安装ambari-server
4.2 检查REPO源
五、HDP 安装
Get Started
Select Version
Install Options
Confirm Hosts
Choose Services
Assign Masters
Assign Slaves and Clients
Customize Services
CREDENTIALS
DATABASES
DIRECTORIES
ALL CONFIGURATIONS
Review
六、开启Kerberos
6.1 kerberos服务检查
6.2 Ambari启动kerberos
Get Started
Configure Kerberos
Install and Test Kerberos Client
Configure Identities
Confirm Configuration">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-27T08:39:31+08:00">
    <meta property="article:modified_time" content="2023-11-27T08:39:31+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Ambari】HDP单机自动化安装（基础环境和MySQL脚本一键安装）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="534" id="h3Xxk" src="https://images2.imgbox.com/91/bb/3ZY5xOwp_o.png" width="950"></p> 
<blockquote> 
 <p id="u5d85d1e0" style="text-align:center;">🦄 <strong>个人主页</strong>——🎐<a href="https://blog.csdn.net/qq_35995514?type=blog" title="开着拖拉机回家_Linux,大数据运维-CSDN博客">开着拖拉机回家_Linux,大数据运维-CSDN博客</a> 🎐✨🍁</p> 
 <p id="u68fd9b7c" style="text-align:center;">🪁🍁🪁🍁🪁🍁🪁🍁 🪁🍁🪁🍁🪁🍁🪁 🪁🍁🪁🍁🪁🍁🪁🍁🪁🍁🪁🍁</p> 
 <p id="u61d52a22" style="text-align:center;"><strong>感谢点赞和关注 ，每天进步一点点！加油！</strong></p> 
 <p></p> 
</blockquote> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="FxqY4-toc" style="margin-left:0px;"><a href="#FxqY4" rel="nofollow">一、版本信息</a></p> 
<p id="uRtYE-toc" style="margin-left:40px;"><a href="#uRtYE" rel="nofollow">1.1大数据组件版本</a></p> 
<p id="HOKJX-toc" style="margin-left:40px;"><a href="#HOKJX" rel="nofollow">1.2Apache Components</a></p> 
<p id="zJigj-toc" style="margin-left:40px;"><a href="#zJigj" rel="nofollow">1.3Databases支持版本</a></p> 
<p id="8ICAZ-toc" style="margin-left:0px;"><a href="#8ICAZ" rel="nofollow">二、安装包上传</a></p> 
<p id="TXe5U-toc" style="margin-left:0px;"><a href="#TXe5U" rel="nofollow">三 、服务器基础环境配置</a></p> 
<p id="hzznJ-toc" style="margin-left:40px;"><a href="#hzznJ" rel="nofollow">3.1配置修改</a></p> 
<p id="doiAM-toc" style="margin-left:40px;"><a href="#doiAM" rel="nofollow">3.2服务器环境配置</a></p> 
<p id="pi1t5-toc" style="margin-left:40px;"><a href="#pi1t5" rel="nofollow">3.3MySQL数据库安装</a></p> 
<p id="a35bD-toc" style="margin-left:0px;"><a href="#a35bD" rel="nofollow">四、安装Ambari-server</a></p> 
<p id="7JASe-toc" style="margin-left:40px;"><a href="#7JASe" rel="nofollow">4.1 安装ambari-server</a></p> 
<p id="ZXMiP-toc" style="margin-left:40px;"><a href="#ZXMiP" rel="nofollow">4.2 检查REPO源</a></p> 
<p id="Q8KOi-toc" style="margin-left:0px;"><a href="#Q8KOi" rel="nofollow">五、HDP 安装</a></p> 
<p id="Lb6Ra-toc" style="margin-left:40px;"><a href="#Lb6Ra" rel="nofollow">Get Started</a></p> 
<p id="AnV7y-toc" style="margin-left:40px;"><a href="#AnV7y" rel="nofollow">Select Version</a></p> 
<p id="qeJzx-toc" style="margin-left:40px;"><a href="#qeJzx" rel="nofollow">Install Options</a></p> 
<p id="PTl7H-toc" style="margin-left:40px;"><a href="#PTl7H" rel="nofollow">Confirm Hosts</a></p> 
<p id="o9YFd-toc" style="margin-left:40px;"><a href="#o9YFd" rel="nofollow">Choose Services</a></p> 
<p id="St0PZ-toc" style="margin-left:40px;"><a href="#St0PZ" rel="nofollow">Assign Masters</a></p> 
<p id="lhRbq-toc" style="margin-left:40px;"><a href="#lhRbq" rel="nofollow">Assign Slaves and Clients</a></p> 
<p id="Gc1Ob-toc" style="margin-left:40px;"><a href="#Gc1Ob" rel="nofollow">Customize Services</a></p> 
<p id="m1TIp-toc" style="margin-left:80px;"><a href="#m1TIp" rel="nofollow">CREDENTIALS</a></p> 
<p id="Gq959-toc" style="margin-left:80px;"><a href="#Gq959" rel="nofollow">DATABASES</a></p> 
<p id="ht5hP-toc" style="margin-left:80px;"><a href="#ht5hP" rel="nofollow">DIRECTORIES</a></p> 
<p id="J0xeX-toc" style="margin-left:80px;"><a href="#J0xeX" rel="nofollow">ALL CONFIGURATIONS</a></p> 
<p id="3C7SM-toc" style="margin-left:40px;"><a href="#3C7SM" rel="nofollow">Review</a></p> 
<p id="cQsN2-toc" style="margin-left:0px;"><a href="#cQsN2" rel="nofollow">六、开启Kerberos</a></p> 
<p id="Cakax-toc" style="margin-left:40px;"><a href="#Cakax" rel="nofollow">6.1 kerberos服务检查</a></p> 
<p id="9479S-toc" style="margin-left:40px;"><a href="#9479S" rel="nofollow">6.2 Ambari启动kerberos</a></p> 
<p id="zQY7V-toc" style="margin-left:80px;"><a href="#zQY7V" rel="nofollow">Get Started</a></p> 
<p id="vtz6o-toc" style="margin-left:80px;"><a href="#vtz6o" rel="nofollow">Configure Kerberos</a></p> 
<p id="CIcqU-toc" style="margin-left:80px;"><a href="#CIcqU" rel="nofollow">Install and Test Kerberos Client</a></p> 
<p id="s8bPU-toc" style="margin-left:80px;"><a href="#s8bPU" rel="nofollow">Configure Identities</a></p> 
<p id="KB1ea-toc" style="margin-left:80px;"><a href="#KB1ea" rel="nofollow">Confirm Configuration</a></p> 
<p id="9o9n2-toc" style="margin-left:80px;"><a href="#9o9n2" rel="nofollow">Stop Services</a></p> 
<p id="0XUk4-toc" style="margin-left:80px;"><a href="#0XUk4" rel="nofollow">Kerberize Cluster</a></p> 
<p id="MgUZT-toc" style="margin-left:80px;"><a href="#MgUZT" rel="nofollow">Start and Test Services</a></p> 
<p id="QoVZW-toc" style="margin-left:0px;"><a href="#QoVZW" rel="nofollow">七、脚本附录说明</a></p> 
<hr id="hr-toc"> 
<h2><span style="color:#956fe7;">一、版本信息</span></h2> 
<hr id="jVrhT"> 
<h3 id="uRtYE" style="background-color:transparent;"><span style="color:#4da8ee;">1.1大数据组件版本</span></h3> 
<hr id="FBhmP"> 
<table id="PW41u"><tbody><tr><td> <p id="736b1402d6dba78dc1ee6068d75d7082" style="text-align:center;"><strong>组件</strong></p> </td><td> <p id="f32d60375d32c8d7e739198f2f98c5f3" style="text-align:center;"><strong>版本</strong></p> </td></tr><tr><td> <p id="729debb0fef17da72210c13a0b282b56" style="text-align:center;"><strong>操作系统</strong></p> </td><td> <p id="50e62d11cb81442e044a3a36e3df4978" style="text-align:center;"><strong>CentOS7.2-7.9</strong></p> </td></tr><tr><td> <p id="99dfd7c88bb42a5d9c52aee6cea963df" style="text-align:center;"><strong>ambari</strong></p> </td><td> <p id="965706b1eed7156fb07aad466778a7c1" style="text-align:center;"><strong>2.7.4</strong></p> </td></tr><tr><td> <p id="060fa8f7e01d2e7c1519567b59163de3" style="text-align:center;"><strong>HDP</strong></p> </td><td> <p id="4aff2c4d8877bdb1c469a90021ffe7f2" style="text-align:center;"><strong>3.3.1.0</strong></p> </td></tr><tr><td> <p id="4f523e7f99e0eb8be2b5aa63f9ff13c9" style="text-align:center;"><strong>HDP-GPL</strong></p> </td><td> <p id="c573fd5f053ee0474d9d43182b2fa1a6" style="text-align:center;"><strong>3.3.1.0</strong></p> </td></tr><tr><td> <p id="d3178cf5b35d4127e2a8b048fe69f0e5" style="text-align:center;"><strong>HDP-UTILS</strong></p> </td><td> <p id="86057ec024f78cb838e8b7c030e8af66" style="text-align:center;"><strong>1.1.0.22</strong></p> </td></tr><tr><td> <p id="0bc3d1566fd549ff55cd71263cba9ff5" style="text-align:center;"><strong>JDK</strong></p> </td><td> <p id="505375a7a9bc327053e00f0077d3ecc6" style="text-align:center;"><strong>jdk-8u162-linux-x64.tar.gz</strong></p> </td></tr><tr><td> <p id="0df15aeec9541c0e9f2a4422455622f2" style="text-align:center;"><strong>MySQL</strong></p> </td><td> <p id="9508b1e81e81cd1c43dd01e46ea86dbb" style="text-align:center;"><strong>5.7</strong></p> </td></tr></tbody></table> 
<h3 id="HOKJX"><span style="color:#4da8ee;">1.2Apache Components</span></h3> 
<hr id="qEGWF"> 
<table id="PfBfb"><tbody><tr><td> <p id="83e12cf07812cfa874be33bd80fcde95" style="text-align:center;"><strong>组件名称</strong></p> </td><td> <p id="470ee81fa18e126fc3b06e3695322ed2" style="text-align:center;"><strong>Apache版本</strong></p> </td></tr><tr><td> <p id="0d93cce5962e4c52bf12f9a500cf0f88" style="text-align:center;"><strong>Apache Ambari</strong></p> </td><td> <p id="ba479d14286e111d07d35077f1809268" style="text-align:center;"><strong>2.7.4</strong></p> </td></tr><tr><td> <p id="6a4cb7c77562b9c98ce87d692bc0bed0" style="text-align:center;"><strong>Apache Zookeeper</strong></p> </td><td> <p id="c37dedbdb9903b416e530a561ca43c8e" style="text-align:center;"><strong>3.4.6</strong></p> </td></tr><tr><td> <p id="4d236e8f0ab78f87bb66ca715e07a28a" style="text-align:center;"><strong>Apache Hadoop</strong></p> </td><td> <p id="7a2e770dc7df04f6d7fb62d4ffcdf3f0" style="text-align:center;"><strong>3.1.1</strong></p> </td></tr><tr><td> <p id="84bac1e81731fcf05b5e07abb4c906dc" style="text-align:center;"><strong>Apache Hive</strong></p> </td><td> <p id="1002f837362aa80698fdc9ee60ac588e" style="text-align:center;"><strong>3.1.0</strong></p> </td></tr><tr><td> <p id="29721c0b623ee65417728bde974b4af7" style="text-align:center;"><strong>Apache HBase</strong></p> </td><td> <p id="2f7803d8d54fa1f38574442d21c927a6" style="text-align:center;"><strong>2.0.2</strong></p> </td></tr><tr><td> <p id="abacc4fba37f82bb1d420247782456b8" style="text-align:center;"><strong>Apache Ranger</strong></p> </td><td> <p id="9450e4e9aa90d658c07e8d2d18a4c25f" style="text-align:center;"><strong>1.2.0.3.1</strong></p> </td></tr><tr><td> <p id="37d1739235f2b6235dd7dbcf57d54e0c" style="text-align:center;"><strong>Apache Spark 2</strong></p> </td><td> <p id="ecb9e3951f02815d30ab1a1d8d0ee87a" style="text-align:center;"><strong>2.3.0</strong></p> </td></tr><tr><td> <p id="66ac41bed569e92848caa4dad12317b9" style="text-align:center;"><strong>Apache TEZ</strong></p> </td><td> <p id="f892a1f3fe712872db907f8eeef46ad8" style="text-align:center;"><strong>0.9.1</strong></p> </td></tr></tbody></table> 
<h3 id="zJigj"><span style="color:#4da8ee;">1.3Databases支持版本</span></h3> 
<hr id="VeOfj"> 
<table id="TSKE9"><tbody><tr><td> <p id="a837a2ca0498eb7eda7e9135115e161b">Name</p> </td><td> <p id="0763be64b430a402ac50d6e9d695572c">Version</p> </td></tr><tr><td> <p id="e324852a2f87080e2cf3230461bdae55">PostgreSQL</p> </td><td> <p id="9c9c2aa7ff1724c2da7985cea3d5bc8e">10.7 10.5 10.2 9.6</p> </td></tr><tr><td> <p id="5abbf53e10bdce11b31a82cf3c048e57">MySQL</p> </td><td> <p id="5e59024a3d9e76132b40adc955b5156c">5.7</p> </td></tr><tr><td> <p id="59b511a344e1cdace7cc443066ced39c">MariaDB</p> </td><td> <p id="c866dbf00489c94179a5a2f3772986a4">10.2</p> </td></tr></tbody></table> 
<p id="u685919c6"></p> 
<hr id="SuEAF"> 
<h2 id="8ICAZ"><span style="color:#956fe7;">二、安装包上传</span></h2> 
<hr id="E3yUL"> 
<p id="2169febbc5029a5e8d3aa051fffb9a52">使用工具将安装包上传到Linux服务器，如上传到/opt 目录，如下命令进入/opt目录并解压安装包，包名日期可能有所变动。</p> 
<pre id="JcqPL"><code>cd /opt
tar -zxvf windp-aio-deploy-build20231114.tar.gz
cd  /opt/windp-aio-deploy</code></pre> 
<p class="img-center"><img alt="" height="740" id="Nb1cv" src="https://images2.imgbox.com/8a/ee/WHv3Gm39_o.png" width="985"></p> 
<p id="b456f14befc707b25037bd64c64dcb60">安装包解压后目录结构：</p> 
<p class="img-center"><img alt="" height="299" id="OmULP" src="https://images2.imgbox.com/7d/85/4izigkPu_o.png" width="1164"></p> 
<p id="3e74165839fb5a8fa11b85bb5d5e6159">windp-aio-deploy-buildxxxxxxxx.tar.gz 包内容说明</p> 
<table id="U24Ko"><tbody><tr><td> <p id="8c291872fceeb8df558b124e536bee71" style="text-align:center;"><strong>包、脚本和目录</strong></p> </td><td> <p id="e208973e0eda585c97af6ad8e5b75c90" style="text-align:center;"><strong>说明</strong></p> </td></tr><tr><td> <p id="ac74fe88b0584e368015cdbd20835dee" style="text-align:center;">HDP-WinDP-AIO-Platform-final.tar.gz</p> </td><td> <p id="57bc968dae70fba133bd86bdf6a20ce7" style="text-align:center;">Ambari安装包</p> </td></tr><tr><td> <p id="c5db846f2cf2226a27cf83b11b3de967" style="text-align:center;">jdk-8u162-linux-x64.tar.gz</p> </td><td> <p id="eb3468d62242ed77531c78fb3efa506b" style="text-align:center;">JDK安装包</p> </td></tr><tr><td> <p id="67573a40ac921c44081db5d810b977a8" style="text-align:center;">mysql-5.7.44-el7-x86_64.tar.gz</p> </td><td> <p id="39d824606ccbe677cd86e33765d7c92e" style="text-align:center;">MySQL安装包</p> </td></tr><tr><td> <p id="e07703591698150830914b3ae5d356f6" style="text-align:center;">install_base.sh</p> </td><td> <p id="26ec0a7e21b32635a6bf2b499d0ea125" style="text-align:center;">基础环境配置和初始化</p> </td></tr><tr><td> <p id="fe07b5602890072aac4c694f06e4485c" style="text-align:center;">install_mysql.sh</p> </td><td> <p id="8144bfe775a7ef688bddacf97afbd546" style="text-align:center;">MySQL安装</p> </td></tr><tr><td> <p id="7081d048f52d591e596f2797d83f1ac7" style="text-align:center;">install_repo.sh</p> </td><td> <p id="62ac49111e8f075ffc476a90bc318b4a" style="text-align:center;">HDP源配置和Ambari安装</p> </td></tr><tr><td> <p id="35c5c11b8ac297352139cec66e4f10d7" style="text-align:center;">config</p> </td><td> <p id="e73642c3a93a52db9bbeeaff4224941b" style="text-align:center;">配置文件</p> </td></tr><tr><td> <p id="42ab0d341d4d78af980197301d6d0e56" style="text-align:center;">repo</p> </td><td> <p id="040a42990f2d23bce2ac324b369ddccf" style="text-align:center;">HDP-repo源文件</p> </td></tr></tbody></table> 
<hr id="X35GH"> 
<h2 id="TXe5U"><span style="color:#956fe7;">三 、服务器基础环境配置</span></h2> 
<hr id="gwoq2"> 
<h3 id="hzznJ"><span style="color:#4da8ee;">3.1配置修改</span></h3> 
<hr> 
<p id="fd9320bd9206b1ccb7c9e4dbad64a706">确认是否/opt为安装目录，如果不是则要修改路径，root 用户密码修改，需要修改部分已标红，修改完成后在Linux服务器命令行执行如下命令：</p> 
<pre id="smerB"><code class="language-bash">cat &gt; /opt/windp-aio-deploy/config/global.sh &lt;&lt; EOF
#######################
#部署相关全局参数定义
#######################
# root 密码保存
root_passwd=winner
# mysql配置
myurl=127.0.0.1
myuser=root
mypwd=Winner001
myport=3306
mydb=ipvacloud
# HDP包解压目录
install_path=/hadoop
hdp_tar_name=HDP-WinDP-AIO-Platform-final.tar.gz
# mysql 安装目录
mysql_install_path=/usr/local
EOF</code></pre> 
<p id="152e97fead25dadc012f7046168d10cd"></p> 
<p id="86d191a083d55bb58288181c19c78376">执行如下命令，检查文件是否保存成功。</p> 
<pre id="uPc00"><code> cat  /opt/windp-aio-deploy/config/global.sh</code></pre> 
<p class="img-center"><img alt="" height="492" id="rUy8L" src="https://images2.imgbox.com/3f/7e/pNUnurDx_o.png" width="1113"></p> 
<h3 id="doiAM"><span style="color:#4da8ee;">3.2服务器环境配置</span></h3> 
<hr id="eC1n3"> 
<p id="de816a022b6426172a912e58efcb119b">执行如下命令，等待执行完成</p> 
<pre id="e8LPZ"><code>cd  /opt/windp-aio-deploy/
sh install_base.sh</code></pre> 
<p id="2a41355dfca9eb2966d82bc559fc2c05">执行如下命令，查看JDK是否配置成功，显示如图JJDK版本信息则配置成功。</p> 
<pre id="XAYXx"><code>bash
source /etc/profile
java -version</code></pre> 
<p class="img-center"><img alt="" height="194" id="LKcB0" src="https://images2.imgbox.com/b4/e7/0ME3CXFV_o.png" width="897"></p> 
<h3 id="pi1t5"><span style="color:#4da8ee;">3.3MySQL数据库安装</span></h3> 
<hr id="mWnVv"> 
<p id="973ee0d918158866fcbc44c69c90dfcb">执行如下命令，等待MySQL安装完成：<a href="https://kangll.blog.csdn.net/article/details/134350572?spm=1001.2014.3001.5502" rel="nofollow" title="【Linux】Centos7 shell实现MySQL5.7 tar 一键安装-CSDN博客">【Linux】Centos7 shell实现MySQL5.7 tar 一键安装-CSDN博客</a></p> 
<pre id="gl1eg"><code>cd  /opt/windp-aio-deploy/
sh install_mysql.sh</code></pre> 
<p id="51a8f63b5d9635b3f17b2bf1c61e1525">执行如下命令，查看MySQL是否启动成功，显示如图“running”则表示MySQL启动成功。</p> 
<pre id="hKbe6"><code>cd  /opt/windp-aio-deploy/
/etc/init.d/mysqld status</code></pre> 
<p id="822a36f69a58729ef16eb8011f7f1921"></p> 
<p class="img-center"><img alt="" height="137" id="g3nY9" src="https://images2.imgbox.com/31/18/6jO8yNIn_o.png" width="885"></p> 
<hr id="X9SEi"> 
<h2 id="a35bD"><span style="color:#956fe7;">四、安装Ambari-server</span></h2> 
<hr id="NMZC6"> 
<h3 id="7JASe"><span style="color:#4da8ee;">4.1 安装ambari-server</span></h3> 
<hr id="edHZ6"> 
<p id="2acc2dd8154583cbfd2bfd363eea938e">执行如下命令，等待Ambari-Server 配置启动完成，需要等待10分钟左右。</p> 
<pre id="EEM3S"><code>cd  /opt/windp-aio-deploy/
sh install_repo.sh</code></pre> 
<p id="f866ee52cbdfa8342d2a893cdde09b79">执行如下命令，查看Ambari-Server是否启动成功，显示如图“running”则表示启动成功。</p> 
<pre id="it5GW"><code>ambari-server status</code></pre> 
<p class="img-center"><img alt="" height="192" id="CBDLX" src="https://images2.imgbox.com/69/98/UIpfgyBo_o.png" width="1043"></p> 
<p id="c9d26f419cc2c4c438edd42df8801f62">如果Ambari-Server没有启动成功，执行如下命令尝试重启。</p> 
<pre id="L9Kow"><code>ambari-server restart</code></pre> 
<p class="img-center"><img alt="" height="315" id="Tk9G4" src="https://images2.imgbox.com/12/4f/pN5cZPww_o.png" width="1191"></p> 
<h3 id="ZXMiP"><span style="color:#4da8ee;">4.2 检查REPO源</span></h3> 
<hr id="lkvlU"> 
<p id="17f2b734188edb992b63c654a33f54fb">执行完上一步脚本配置的REPO源可以在浏览器中查看。需要将示例IP地址换成部署WinDP-AIO Linux本机的IP。如下是示例IP地址：</p> 
<pre id="mtplB"><code>http://192.168.2.161/ambari/
http://192.168.2.161/HDP/
http://192.168.2.161/HDP-UTILS/
http://192.168.2.161/HDP-GPL/</code></pre> 
<p id="35a617e0615eae475c814b1fb3b42cee"></p> 
<p class="img-center"><img alt="" height="338" id="yRfS8" src="https://images2.imgbox.com/75/0e/2dk4R9RG_o.png" width="730"></p> 
<p id="69b3bc54bb499a8ae5fd9d75d4526cf7"></p> 
<p class="img-center"><img alt="" height="348" id="X8T9x" src="https://images2.imgbox.com/48/da/89PFmFjf_o.png" width="722"></p> 
<p id="88e880bb248bfeca467ed2d313ca5ffa"></p> 
<p class="img-center"><img alt="" height="365" id="fZXwO" src="https://images2.imgbox.com/38/7e/XyMr6rZP_o.png" width="733"></p> 
<p id="2c42ac39092e1e224c1bd0ae33bf2e45"></p> 
<p class="img-center"><img alt="" height="358" id="Ra9dC" src="https://images2.imgbox.com/f0/86/akf0d5Fo_o.png" width="730"></p> 
<p id="0e784d2abb755b94b72aee83dd498071"><strong>注意：</strong>如果某个地址从浏览器访问失败则说明配置的基础环境有问题，需要检查基础环境的配置。</p> 
<hr id="oqEyC"> 
<h2 id="Q8KOi"><span style="color:#956fe7;">五、HDP 安装</span></h2> 
<hr id="FVk6A"> 
<p id="5fc7e1f6c8ed15bedabb61bc9f8e32a4">登录Ambari-Server, 地址为IP:8080，示例地址：<a href="http://192.168.2.161:8080/" rel="nofollow" title="http://192.168.2.161:8080/">http://192.168.2.161:8080/</a>，账号密码默认：admin。</p> 
<p id="97cf186e22103fcaa7f814c41c4f5785">第一次登录进去的默认界面如下图所示，点击红框按钮。</p> 
<p class="img-center"><img alt="" height="363" id="I4gUu" src="https://images2.imgbox.com/27/a2/rlYfgkvB_o.png" width="1000"></p> 
<h3 id="Lb6Ra">Get Started</h3> 
<p id="a75a369c63fce819f74bc5b6bb2b9ee1">输入集群名称 “winner”，点击NEXT</p> 
<p class="img-center"><img alt="" height="411" id="oaRvT" src="https://images2.imgbox.com/53/5e/0ZQ0fUsZ_o.png" width="1000"></p> 
<h3 id="AnV7y">Select Version</h3> 
<p id="0923825266c612f3dac3344f0eb4e55f">选择HDP的版本，这里使用的是3.1版本，repo选择“Use Local Repository”</p> 
<p id="dbbe98161d085c38c8fd61ddc4144963"></p> 
<p class="img-center"><img alt="" height="790" id="BnSot" src="https://images2.imgbox.com/c4/c2/gIRB3AQI_o.png" width="1200"></p> 
<p id="cab6bd430734a5e2f74a6d06251608e1">保留redhat7的地址 栏，其它系统选择“Remove”</p> 
<p id="17cc230fac83927abe1b84ea1ee8ce1b"></p> 
<p class="img-center"><img alt="" height="742" id="BWQX4" src="https://images2.imgbox.com/77/b5/Nc50swse_o.png" width="1200"></p> 
<p id="fd6d72e0f801f8d1bd30bd6a255bdafa">将如下URL 依次复制到Base URL 地址栏中，然后 下一步</p> 
<pre id="QoBuO"><code>http://windp-aio/HDP/centos7/3.1.4.0-315
http://windp-aio/HDP-GPL/centos7/3.1.4.0-315
http://windp-aio/HDP-UTILS/centos7/1.1.0.22</code></pre> 
<p id="023dbf1d0c2db75902ba18dc7ff0bc8d"></p> 
<p class="img-center"><img alt="" height="733" id="FSnjO" src="https://images2.imgbox.com/7d/75/16t61xJY_o.png" width="1200"></p> 
<h3 id="qeJzx">Install Options</h3> 
<ul><li id="c3c8b30b590364367b471f56a4fd3aa1">Target Hosts : windp_aio</li><li id="08670dee36b5a390f60e737ce36035b4">Host Registration Information: 选择红框Provide your SSH Private Key to automatically register hosts</li></ul> 
<p class="img-center"><img alt="" height="722" id="NBbAN" src="https://images2.imgbox.com/2a/e4/vlcUtcIC_o.png" width="1200"></p> 
<p id="ce5ebbbfa017e7adc3a2ad50301fb347">在Linux服务器上执行如下命令将私钥下载到Windows本地</p> 
<pre id="jr0Nc"><code>sz  /root/.ssh/id_rsa</code></pre> 
<p id="c2e3876f4cef1596a3f5d162f7804ce1"></p> 
<p class="img-center"><img alt="" height="551" id="Nvjna" src="https://images2.imgbox.com/f9/cc/SdcgdsaQ_o.png" width="1200"></p> 
<p id="ab022b909e12b4bf0b46db6f07576af0">将下载的私钥文件从本地上传，点击选择“CHOOSE FILE”，选中“id_rsa”文件后选择打开。</p> 
<p class="img-center"><img alt="" height="802" id="n9KXq" src="https://images2.imgbox.com/d4/6d/t3xLyEBQ_o.png" width="1200"></p> 
<p id="9a378eabba61f6f54c55d83ab37df5d5"></p> 
<p id="c24e257a2c6e9d8e5f764f29dbbb32e4">如下图 私钥文件上传完成，ssh的用户和端口采用默认，我们选择下一步</p> 
<ul><li id="a86f357cdf6f4dfd93c9f56778774eb2"><strong>SSH User Account: root</strong></li><li id="d894c76c081b80c45f0f706d2f82b715"><strong>SSH Port Number: 22 </strong></li></ul> 
<p class="img-center"><img alt="" height="887" id="iDSdL" src="https://images2.imgbox.com/e8/4a/7voFmTqK_o.png" width="1200"></p> 
<p id="d0f8d13d67add37b868bc90a3cac2d59">弹出Warning（一般是主机名不符合规范），可以忽略。</p> 
<p class="img-center"><img alt="" height="441" id="yAHHB" src="https://images2.imgbox.com/12/74/l7tqs371_o.png" width="1000"></p> 
<h3 id="PTl7H">Confirm Hosts</h3> 
<p id="fc2fe478350699706a0beae1bdf2f9ec">等待服务器注册，<strong>如下的 check 信息要检查通过才行，</strong>可能会检查出问题，有什么问题就解决什么问题。</p> 
<p class="img-center"><img alt="" height="618" id="ObyR3" src="https://images2.imgbox.com/67/df/zqK3JasC_o.png" width="1200"></p> 
<p id="17324c4b6e752b4fda267d29423f1c91">点击进入 “ <a href="http://192.168.2.161:8080/" rel="nofollow" title="Click here to see the check results.">Click here to see the check results.</a>” 可以检查主机检查项是否通过</p> 
<p id="70e067d089de931a5dfeea7210b7a8a8">，如果有问题说明基础环境配置有问题，如果没有问题，选择“CLOSE”，下一步</p> 
<p id="eb5b00c2b6866759ec9fb8d966e1a494"></p> 
<p class="img-center"><img alt="" height="815" id="UgiDc" src="https://images2.imgbox.com/d3/08/qJ6dpwSo_o.png" width="1075"></p> 
<h3 id="o9YFd">Choose Services</h3> 
<p id="2aee308c228aa7e7ea1c493518043c2d">选择要安装的组件: HDFS、YARN + MapReduce2、Tez、Hive、HBase、ZooKeeper、Infra Solr、Ambari Metrics、Ranger、Spark2, 选择完成后下一步</p> 
<p class="img-center"><img alt="" height="878" id="N2X5m" src="https://images2.imgbox.com/16/ed/s9ySlvLV_o.png" width="1200"></p> 
<p id="af9d75de6889f500f22fbae59753e693">如果有Warning 直接忽略安装</p> 
<p class="img-center"><img alt="" height="339" id="mI3oo" src="https://images2.imgbox.com/68/13/b6GOMRvt_o.png" width="1000"></p> 
<h3 id="St0PZ">Assign Masters</h3> 
<p id="a12585fc35f4bb7b5978a00c7fcf18c2">单机环境，直接下一步</p> 
<p class="img-center"><img alt="" height="417" id="JQFDB" src="https://images2.imgbox.com/ce/59/ZiytTKTD_o.png" width="1000"></p> 
<h3 id="lhRbq">Assign Slaves and Clients</h3> 
<p id="e878e27a1c974eda34c4d5292826da5d">选择服务器上安装的客户端，默认已选择，下一步</p> 
<p class="img-center"><img alt="" height="317" id="mIg8Z" src="https://images2.imgbox.com/ea/a3/SJ8lmyoM_o.png" width="1000"></p> 
<h3 id="Gc1Ob">Customize Services</h3> 
<h4 id="m1TIp">CREDENTIALS</h4> 
<p id="454adfd7c0cc234a4ac745e8134be59b">配置密码，建议使用一种好记 ， 我们统一使用 “Winner001”,密码复制到所有的“password”框中,密码已存在的框采用覆盖。完成后下一步</p> 
<p class="img-center"><img alt="" height="843" id="iWqyk" src="https://images2.imgbox.com/f0/61/mutCcuTZ_o.png" width="1200"></p> 
<h4 id="Gq959">DATABASES</h4> 
<p id="645be65471a597b02bcc1c600e866e67">点击选择database，配置hive数据库，确保测试通过，Hive Database 选择 Existing MySQL / MariaDB</p> 
<ul><li id="24f60a9d2d8d1a33cf69f64de6a17700">DatabaseName:hive</li><li id="85445b0f5abe9459ca6f0378e49b7eda">Uesr:hive</li><li id="385e6ab1d3e34fde6e2b6534ef82a017">Database Password: Winner001</li><li id="ba83288acdcd5501f3cd69dc803da5dd">DatabaseURL:jdbc:mysql://windp-aio/hive</li></ul> 
<p class="img-center"><img alt="" height="894" id="Gx169" src="https://images2.imgbox.com/f4/fd/sv3ba4ud_o.png" width="1200"></p> 
<p id="396a62c0606443b067132958c6d99f61"><strong>注意：</strong>测试连接不通过可以按照提示， 命令行手动设置驱动包的位置，执行如下命令后尝试再次测试连接：</p> 
<pre id="gOeUU"><code>ambari-server setup --jdbc-db=mysql --jdbc-driver=/usr/share/java/mysql-connector-java.jar</code></pre> 
<p class="img-center"><img alt="" height="208" id="x618b" src="https://images2.imgbox.com/59/0a/NaI9oSPi_o.png" width="1200"></p> 
<p id="86fa9e63d8b17ea0bd3c880c53250871">点击选中 “RANGER”，进行ranger数据库配置，确保测试通过</p> 
<ul><li id="07d25aaaa53571ac583d47dbf07d43ad">DatabaseName:ranger</li><li id="6ccbccc4967928271b57ca343a279863">Uesr:ranger</li><li id="0e9b04ecbeb0606f3e9aaba76dacb40d">Database Password: Winner001</li><li id="8f2b410589b0a027ab33af26bcceeafe">DatabaseURL:jdbc:mysql://windp-aio/ranger</li><li id="942fbe19bd439024da101f3f50831b6d">Ranger DB host：windp-aio</li></ul> 
<p class="img-center"><img alt="" height="950" id="nupVe" src="https://images2.imgbox.com/39/37/ww2OHNJW_o.png" width="1200"></p> 
<p id="5c9a04d53d3ce91a74acecf5da057022"></p> 
<p class="img-center"><img alt="" height="682" id="g1ulm" src="https://images2.imgbox.com/2b/c0/lMUhYwTy_o.png" width="1200"></p> 
<p id="9ca3ebf7c3c2d31c7b6cf1a651c9ff44">设置完成后，下一步</p> 
<h4 id="ht5hP">DIRECTORIES</h4> 
<p id="66d2cfefb7c7b3b1cbbe7647ba94edcb">默认配置下一步, 安装完成后我们再对存储路径做进一步规划修改，一般存储数据和日志路径要配置为数据盘目录。</p> 
<p class="img-center"><img alt="" height="856" id="L6OXM" src="https://images2.imgbox.com/3f/b8/brM5AA6q_o.png" width="1200"></p> 
<p id="b0b42085fd4ee2e602b17ff6bf378af6"><strong>ACCOUNTS</strong></p> 
<p id="eb4fb58736eafe10560af11a702ca0c2">账号信息确定，使用默认配置，直接下一步</p> 
<p class="img-center"><img alt="" height="730" id="puLFg" src="https://images2.imgbox.com/3f/b7/2P8v8TMi_o.png" width="1200"></p> 
<h4 id="J0xeX">ALL CONFIGURATIONS</h4> 
<p id="b46a7ed1ec3f3237f3dcbb3ae1f5070a">组件参数修改，根据资源大小自行修改，像NameNode ，HBase Master默认都是1G ，根据生产环境资源情况自行修改，我们采用默认，下一步。</p> 
<p class="img-center"><img alt="" height="489" id="psEgm" src="https://images2.imgbox.com/22/55/fb9BPFZK_o.png" width="1000"></p> 
<p id="8082b3274f62a37ca52578e772de15ac">确认下一步</p> 
<p class="img-center"><img alt="" height="418" id="yJoSG" src="https://images2.imgbox.com/da/a0/1r0mPtyE_o.png" width="1000"></p> 
<h3 id="3C7SM">Review</h3> 
<p id="f88560953d9955cc6d40b7b9b098149d">点击DEPLOY</p> 
<p class="img-center"><img alt="" height="409" id="cCDM7" src="https://images2.imgbox.com/ed/d4/5YbFqHUn_o.png" width="1000"></p> 
<p id="8b8fa68fcf97384797d7db35cbb549ba">组件安装中，安装需要40分钟左右</p> 
<p class="img-center"><img alt="" height="620" id="qvKuU" src="https://images2.imgbox.com/42/17/OaIhOPrn_o.png" width="1200"></p> 
<p id="3c3d8113520d5fbf0bd530c95fada4b3">安装完成,下一步， 如果某些组件安装失败我们需要查看日志分析原因。</p> 
<p class="img-center"><img alt="" height="622" id="mXZTs" src="https://images2.imgbox.com/94/4b/UftE2pjp_o.png" width="1200"></p> 
<p id="8c56472fb8fc38436356e060d352df6b">点击 COMPLETE</p> 
<p class="img-center"><img alt="" height="412" id="xphPO" src="https://images2.imgbox.com/be/cd/CYQRYl2K_o.png" width="1000"></p> 
<p id="b1ec6a39a563a768b5a312439a9eb162">安装完成，启动失败的组件我们逐个击破就行。</p> 
<p class="img-center"><img alt="" height="818" id="lvZVT" src="https://images2.imgbox.com/3d/e9/gZ9V105r_o.png" width="1200"></p> 
<hr id="CRUH3"> 
<h2 id="cQsN2"><span style="color:#956fe7;">六、开启Kerberos</span></h2> 
<hr id="VyPVr"> 
<h3 id="Cakax"><span style="color:#4da8ee;">6.1 kerberos服务检查</span></h3> 
<hr id="rZZmD"> 
<p id="d1e921121e4b3918217e847672568e2e">执行如下命令，查看krb5kdc，kadmin服务是否启动成功，显示如图“running”则启动成功。</p> 
<pre id="Dvxdn"><code>cd  /opt/windp-aio-deploy/
systemctl status krb5kdc.service
systemctl status kadmin.service</code></pre> 
<p id="0011fc7e2e26430b288c7c347bee8bed">krb5kdc，kadmin检查这两个服务为 running 状态，如果没有启动成功尝试重启。</p> 
<p class="img-center"><img alt="" height="574" id="xuL4b" src="https://images2.imgbox.com/00/8f/axYwU8aW_o.png" width="1200"></p> 
<p id="d11ba7709e7a37624a75320a768e8784">如果 没有启动，尝试重启服务命令如下：</p> 
<pre id="WvLlZ"><code>cd  /opt/windp-aio-deploy/
systemctl restart  krb5kdc.service
systemctl restart  kadmin.service</code></pre> 
<h3 id="9479S"><span style="color:#4da8ee;">6.2 Ambari启动kerberos</span></h3> 
<hr id="Eu87h"> 
<p id="516079b9edb2c5ddf715f5ea4660562c">进入Ambari 管理界面，选中启用Kerberos，点击“ENABLE KERBEROS”</p> 
<p class="img-center"><img alt="" height="805" id="J8AS4" src="https://images2.imgbox.com/45/4e/4DtgI56x_o.png" width="1000"></p> 
<p id="a21699c6600e8f91277ca759a4fda35f">Warning 不用理会，点击“PROCEED ANYWAY”</p> 
<p class="img-center"><img alt="" height="389" id="CZgvp" src="https://images2.imgbox.com/d2/0a/tmkX01U5_o.png" width="1000"></p> 
<h4 id="zQY7V">Get Started</h4> 
<p id="4b733ba17761b4f8da74c5d320b18364">如下图选MIT KDC， 下面的三个框我们都要选上，下一步</p> 
<p class="img-center"><img alt="" height="782" id="bT3sL" src="https://images2.imgbox.com/1d/26/dKARYaK5_o.png" width="1200"></p> 
<h4 id="vtz6o">Configure Kerberos</h4> 
<p id="ed868b624d58ad437a376ae6ebe44378">将如下配置复制到对应的位置，确保测试通过，填好之后下一步</p> 
<ul><li id="8611d4b7ecd854b1d03cad7c6e496b38">Kadmin host: windp-aio</li><li id="99a1d0a51e561f36080dabfc578812a2">Realm name: WINNER.COM</li><li id="41c7313c66af31d4bb125a853025d49c">Admin principal: admin/admin@WINNER.COM</li><li id="0ca1a010fd7e837e784f4c679548de96">Admin password: winner@001</li></ul> 
<p id="76e59a73b798f38fcce01072913f24ea"></p> 
<p class="img-center"><img alt="" height="817" id="WzUU9" src="https://images2.imgbox.com/d2/58/CeEBZJbO_o.png" width="1200"></p> 
<h4 id="CIcqU">Install and Test Kerberos Client</h4> 
<p id="82b2220dfe6c46c115f35ed3e559359c">Kerberos Client 安装和测试完成之后，下一步</p> 
<p class="img-center"><img alt="" height="489" id="Pl2EN" src="https://images2.imgbox.com/d9/26/Aw2JArJ5_o.png" width="1200"></p> 
<h4 id="s8bPU">Configure Identities</h4> 
<p id="66d4b885c7a6daea1082ece7c481baf7">默认 直接下一步</p> 
<p class="img-center"><img alt="" height="709" id="uHSjx" src="https://images2.imgbox.com/57/7b/s0prf9NJ_o.png" width="1200"></p> 
<h4 id="KB1ea">Confirm Configuration</h4> 
<p id="efb204ba8ca8eea9e75f215b6966b07f">默认直接下一步</p> 
<p class="img-center"><img alt="" height="495" id="tOgsU" src="https://images2.imgbox.com/b0/a8/g8TdUCYG_o.png" width="1200"></p> 
<h4 id="9o9n2">Stop Services</h4> 
<p id="6ede15550fa485c89c4e5deacdfbbc57">停止所有服务，等待执行完成后下一步</p> 
<p class="img-center"><img alt="" height="513" id="TiEvw" src="https://images2.imgbox.com/81/b0/gkj9QgWq_o.png" width="1200"></p> 
<h4 id="0XUk4">Kerberize Cluster</h4> 
<p id="f1d0eccc83b7c5554c4bfb46a1b9d02a">全部通过后下一步 ，如若失败尝试重试解决问题。</p> 
<p class="img-center"><img alt="" height="531" id="T7iQw" src="https://images2.imgbox.com/be/31/DegD6s6e_o.png" width="1200"></p> 
<h4 id="MgUZT">Start and Test Services</h4> 
<p id="df5290414a5a54135c34c8e137fc1a97">启动全部服务并进行测试，全部启动成功需要10分钟左右</p> 
<p class="img-center"><img alt="" height="330" id="dlj7F" src="https://images2.imgbox.com/18/13/tokL17Kf_o.png" width="1000"></p> 
<p id="5f39d4c2baff6ef7ed265dc4201d3c9b">启动完成 下一步</p> 
<p class="img-center"><img alt="" height="504" id="iUD16" src="https://images2.imgbox.com/0d/0b/lXCl5rvG_o.png" width="1200"></p> 
<p id="407a2dba62fb307ce537f8dbd583dcc5">如果启动失败进行启动尝试，或者没有关系直接点击COMPLETE ，然后查看启动不了的组件，逐个解决。</p> 
<p class="img-center"><img alt="" height="330" id="WJGuI" src="https://images2.imgbox.com/e0/0f/RGNd4qoK_o.png" width="1000"></p> 
<p id="7f8bad22d3fb5f40d115db5bb0656bd8">启动完成</p> 
<p class="img-center"><img alt="" height="425" id="oHVMp" src="https://images2.imgbox.com/79/33/j5Y6TxHy_o.png" width="1000"></p> 
<p id="d5e88509c281142dd27375e03a303f57">客户端认证</p> 
<p class="img-center"><img alt="" height="356" id="u8436bd3a" src="https://images2.imgbox.com/6d/f1/ImZLAfEb_o.png" width="1200"></p> 
<hr> 
<h2 id="QoVZW"><span style="color:#956fe7;">七、脚本附录说明</span></h2> 
<hr id="pSyKU"> 
<p id="u148b930a">包结构以及配置文件</p> 
<p class="img-center"><img alt="" height="740" id="u127f616a" src="https://images2.imgbox.com/6e/bc/7XzXLV5V_o.png" width="1200"></p> 
<p id="u564f9184"><strong>install_base.sh</strong></p> 
<pre id="Rczqy"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2023-11-10
# Desc: 基础环境配置,包括服务器设置,JDK,免密,kerberos配置
#

#set -x
BASEDIR=$(cd "$(dirname "$0")"; pwd)
# 加载配置
source  $BASEDIR/config/global.sh

# public 主机名和root密码 
ip=$(ip addr show | grep -E 'inet [0-9]' | awk '{print $2}' | awk -F '/' '{print $1}' | sed -n '$p')
ssh_hosts=${ip}
ssh_networkname=(windp-aio)
# global.sh 配置文件中获取
ssh_passwd=$root_passwd
kerberos_user=winner_spark

###########################
# 配置基本环境
###########################
base_os_config() {
	# tools
	sudo yum install expect  bash-completion  lrzsz  tree  vim  wget  net-tools  libaio perl -y

	# hostname
	sudo hostnamectl set-hostname $ssh_networkname

	# hosts
	sudo cat &gt; /etc/hosts &lt;&lt; EOF
$ip $ssh_networkname
EOF
	## firewalld disable
	sudo systemctl stop firewalld
	sudo systemctl disable firewalld
	sudo systemctl status firewalld

	## selinux disable
	sudo sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config
        sudo setenforce 0

        ## hugepage
        cat &gt; /etc/rc.local &lt;&lt; EOF
if test -f /sys/kernel/mm/transparent_hugepage/defrag; then
 echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
fi
if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
fi
EOF

	## chrony
	sudo yum install chrony -y
	sudo systemctl restart  chronyd
	sudo systemctl enable chronyd
	sudo systemctl status chronyd
        
        # httpd  
	sudo yum -y install httpd
	sudo systemctl restart httpd.service
	sudo systemctl enable httpd.service 
	sudo systemctl status httpd.service 

	## kerberos client
	sudo yum install -y krb5-workstation krb5-libs
}


########################
# 生成本地ssh公钥
########################
create_ssh_pub(){
	echo "生成本地ssh公钥"
	/usr/bin/expect &lt;&lt; eof
	# 设置捕获字符串后，期待回复的超时时间
	set timeout 30
	 
	spawn ssh-keygen -t rsa -b 1024
	 
	## 开始进连续捕获
	expect	{
		".ssh/id_rsa)"      { send "\n";  exp_continue }
		"Overwrite (y/n)?"  { send "y\n"; exp_continue }
		"no passphrase):"   { send "\n";  exp_continue }
		"passphrase again:" { send "\n";  exp_continue }
	}
eof
}
 
########################
# 定义复制ssh公钥方法
########################
copy_ssh(){
       
        if [ ! -f /root/.ssh/id_rsa.pub ];then
             create_ssh_pub
        fi

	echo "复制公钥到对应的主机上"
	/usr/bin/expect &lt;&lt; eof
	# 设置捕获字符串后，期待回复的超时时间
	set timeout 30
	 
	spawn ssh-copy-id -i /root/.ssh/id_rsa.pub $1@$2
	 
	## 开始进连续捕获
	expect	{
		"connecting (yes/no)?" { send "yes\n";  exp_continue }
		"s password:"          { send "${ssh_passwd}\n"; exp_continue }
	}
eof
}

########################
# 配置免密
########################
config_ssh() {
	for name in ${ssh_networkname[*]};do
		timeout 5 ssh root@${name} "echo ${name}: 'This is success!'"
		if [[ $? -ne 0 ]];then
			echo "复制文件到: ${name}"
			copy_ssh root ${name} &gt; /dev/null
		fi
	done
         
        echo "********** ssh installation completed **********"
}

########################
# 配置JDK环境
########################
config_java_home() {
	## java
	sudo mkdir -p /usr/java
        if [ -f $BASEDIR/jdk-8u162-linux-x64.tar.gz ];then
             tar -zxvf $BASEDIR/jdk-8u162-linux-x64.tar.gz -C /usr/java 
        fi

        java_home=$(cat /etc/profile | grep 'JAVA_HOME=')
        if [ -z "$java_home" ]; then
            echo 'export JAVA_HOME=/usr/java/jdk1.8.0_162' &gt;&gt; /etc/profile 
	    echo 'export CLASSPATH=$JAVA_HOME/lib/' &gt;&gt; /etc/profile
	    echo 'export PATH=$PATH:$JAVA_HOME/bin' &gt;&gt; /etc/profile
        fi
	source /etc/profile
	java -version
        echo "********** JDK installation completed **********"
}

########################
# 配置kerberos,安装启动
########################
config_krb5() {
        # kerberos server and client
        sudo yum install krb5-server krb5-libs krb5-workstation -y

        # config file
        cat $BASEDIR/config/krb5.conf &gt; /etc/krb5.conf
	cat $BASEDIR/config/kdc.conf  &gt; /var/kerberos/krb5kdc/kdc.conf
	cat $BASEDIR/config/kadm5.acl &gt; /var/kerberos/krb5kdc/kadm5.acl
        
        echo "******* 创建kdc数据库 *********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kdb5_util create -s -r WINNER.COM $1@$2
         
        ## 开始进连续捕获
        expect  {
                "Enter KDC database master key:" { send "${ssh_passwd}\n"; exp_continue }
                "master key to verify:"          { send "${ssh_passwd}\n"; exp_continue }
        }
eof
        echo "******** 创建admin实例 *********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:"    { send "addprinc admin/admin\n"; exp_continue }
                "Enter password for principal"    { send "${ssh_passwd}\n"; exp_continue }
                "Re-enter password for principal" { send "${ssh_passwd}\n";  }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof

        # start kdc and kadmin 
        sudo systemctl restart krb5kdc
        sudo systemctl enable krb5kdc
        sudo systemctl restart kadmin
        sudo systemctl enable kadmin

	# add linux user 
	useradd winner_spark
	# keytabs file path
        mkdir -p /etc/security/keytabs/
        
        echo "********** kerberos installation completed **********"
}

##################################
# 配置kerberos用户: winner_spark 
# 生成keytab 文件
##################################
config_kerberos_user() {
        echo "******** 创建winner_spark用户实例 ********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:"    { send "addprinc ${kerberos_user}\n"; exp_continue }
                "Enter password for principal"    { send "${ssh_passwd}\n"; exp_continue }
                "Re-enter password for principal" { send "${ssh_passwd}\n"; }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof

       echo "******** winner_spark用户生成keytab文件 ********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:" { send "xst -k /etc/security/keytabs/${kerberos_user}.keytab ${kerberos_user}@WINNER.COM\n";  }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof
       sleep 2s
       # modify keytab file privilege    
       chown ${kerberos_user}:${kerberos_user} /etc/security/keytabs/${kerberos_user}.keytab
       echo "********** kerberos user winner_spark add completed **********"
}

# 配置基础环境
base_os_config

# 配置 root用户免密 
config_ssh

# 配置JDK
config_java_home

# 配置kerberos,并启动
config_krb5

# 配置kerberos用户: winner_spark, 生成keytab 文件
config_kerberos_user</code></pre> 
<p id="u98dbeb8b"></p> 
<p id="u90a728f8"><strong>install_mysql.sh</strong></p> 
<pre id="Q81Us"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2023-11-10
# Desc: install mysql5.7.27
#
echo "******** INSTALL MYSQL *********"
####################################
BASEDIR=$(cd "$(dirname "$0")"; pwd)
# 加载数据库默认连接信息
source  $BASEDIR/config/global.sh
install_path=$mysql_install_path
hostname=`"hostname"`

#####################################

# 卸载原有的mariadb
OLD_MYSQL=`rpm -qa|grep mariadb`
profile=/etc/profile
for mariadb in $OLD_MYSQL
do
     rpm -e --nodeps $mariadb
done

# 删除原有的my.cnf
sudo rm -rf /etc/my.cnf

#添加用户组 用户
sudo groupadd mysql
sudo useradd -g mysql mysql

# 解压mysql包并修改名称
tar -zxvf  $BASEDIR/mysql-5.7.44-el7-x86_64.tar.gz -C $install_path
sudo mv $install_path/mysql-5.7.44-el7-x86_64 $install_path/mysql

# 更改所属的组和用户
sudo chown -R mysql $install_path/mysql
sudo chgrp -R mysql $install_path/mysql

sudo mkdir -p $install_path/mysql/data
sudo mkdir -p $install_path/mysql/log
sudo chown -R mysql:mysql $install_path/mysql/data

# 粘贴配置文件my.cnf 内容见八 中的 my.cnf
cp -f $BASEDIR/config/my.cnf $install_path/mysql/

# 安装mysql
$install_path/mysql/bin/mysql_install_db --user=mysql --basedir=$install_path/mysql/ --datadir=$install_path/mysql/data/

# 设置文件及目录权限：
cp $install_path/mysql/support-files/mysql.server /etc/init.d/mysqld
sudo chown 777 $install_path/mysql/my.cnf
sudo chmod +x /etc/init.d/mysqld

sudo mkdir /var/lib/mysql
sudo chmod 777  /var/lib/mysql

# 启动mysql
/etc/init.d/mysqld start

# 设置开机启动
chkconfig --level 35 mysqld on
chmod +x /etc/rc.d/init.d/mysqld
chkconfig --add mysqld

# 修改环境变量 
# 行数需根据实际情况修改
#sed '78s/$/&amp;:\/usr\/local\/mysql\/bin/' -i $profile
ln -s $install_path/mysql/bin/mysql /usr/bin
ln -s /var/lib/mysql/mysql.sock   /tmp/
cat &gt; /etc/profile.d/mysql.sh&lt;&lt;EOF
  export PATH=$PATH:$install_path/mysql/bin
EOF
mysqlPw=`sed -n 2p /root/.mysql_secret`
mysqlPwTMP=`sed -n 2p /root/.mysql_secret`1
ssh $hostname "source /etc/profile;mysqladmin -h'$myurl' -u'$myuser' -p'$mysqlPw' password '$mysqlPwTMP';mysqladmin -h'$myurl' -u'$myuser' -p'$mysqlPwTMP' password '$mypwd';exit"

echo "******** MYSQL installation completed ********"</code></pre> 
<p>如下是repo源的配置还有Ambari的配置启动</p> 
<p id="u12cc6808"><strong>install_repo.sh</strong></p> 
<pre id="KnwEN"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2023-11-10
# Desc: 配置HDP repo
#

set -x
BASEDIR=$(cd "$(dirname "$0")"; pwd)
#
source  $BASEDIR/config/global.sh
# HDP tar install path
config_path=$install_path
tar_name=$hdp_tar_name

###########################
# 配置 HDP repo
###########################
config_repo() {
  	mkdir -p $config_path
        if [ -f $BASEDIR/$tar_name ];then
             tar -zxvf $BASEDIR/$tar_name -C $config_path
        fi
 
	sudo ln -s $config_path/hdp/ambari /var/www/html/ambari
	sudo ln -s $config_path/hdp/HDP /var/www/html/HDP
	sudo ln -s $config_path/hdp/HDP-GPL /var/www/html/HDP-GPL
	sudo ln -s $config_path/hdp/HDP-UTILS /var/www/html/HDP-UTILS
   
        sudo cp -f $BASEDIR/repo/* /etc/yum.repos.d/
        sudo yum clean all
        sudo yum makecache
        sudo yum repolist
        echo "********** repo installation completed **********"
}

###########################
# 初始化db
###########################
config_db() {

       mysql -h${myurl} -u${myuser} -p${mypwd} &lt; $BASEDIR/config/init_db.sql 
       mysql -h${myurl} -u${myuser} -p${mypwd} ambari  &lt; $BASEDIR/config/Ambari-DDL-MySQL-CREATE.sql
}

###########################
# install ambari
###########################
install_ambari() {
       sudo yum install ambari-server -y
       sudo mkdir -p /usr/share/java/
       cp $BASEDIR/config/mysql-connector-java.jar /usr/share/java/
       cat $BASEDIR/config/ambari.properties &gt; /etc/ambari-server/conf/ambari.properties
       cp  $BASEDIR/config/password.dat /etc/ambari-server/conf/
       ambari-server restart
       ambari-server status
}

###########################
# 修改服务 ambari,如下服务默认不安装，选择隐藏
###########################
config_metainfo_modify(){
	       
	stack_path=/var/lib/ambari-server/resources/stacks/HDP
	cat $BASEDIR/repo/services/ACCUMULO/metainfo.xml    &gt;  $stack_path/3.0/services/ACCUMULO/metainfo.xml
	cat $BASEDIR/repo/services/KAFKA/metainfo.xml       &gt;  $stack_path/3.1/services/KAFKA/metainfo.xml
	cat $BASEDIR/repo/services/PIG/metainfo.xml         &gt;  $stack_path/3.1/services/PIG/metainfo.xml
	cat $BASEDIR/repo/services/DRUID/metainfo.xml       &gt;  $stack_path/3.0/services/DRUID/metainfo.xml
	cat $BASEDIR/repo/services/LOGSEARCH/metainfo.xml   &gt;  $stack_path/3.0/services/LOGSEARCH/metainfo.xml
	cat $BASEDIR/repo/services/SUPERSET/metainfo.xml    &gt;  $stack_path/3.0/services/SUPERSET/metainfo.xml
	cat $BASEDIR/repo/services/ATLAS/metainfo.xml       &gt;  $stack_path/3.1/services/ATLAS/metainfo.xml
	cat $BASEDIR/repo/services/ZEPPELIN/metainfo.xml    &gt;  $stack_path/3.0/services/ZEPPELIN/metainfo.xml      
	cat $BASEDIR/repo/services/STORM/metainfo.xml       &gt;  $stack_path/3.0/services/STORM/metainfo.xml
	cat $BASEDIR/repo/services/RANGER_KMS/metainfo.xml  &gt;  $stack_path/3.1/services/RANGER_KMS/metainfo.xml
	cat $BASEDIR/repo/services/OOZIE/metainfo.xml       &gt;  $stack_path/3.0/services/OOZIE/metainfo.xml
	cat $BASEDIR/repo/services/KNOX/metainfo.xml        &gt;  $stack_path/3.1/services/KNOX/metainfo.xml
	cat $BASEDIR/repo/services/SQOOP/metainfo.xml       &gt;  $stack_path/3.0/services/SQOOP/metainfo.xml
	cat $BASEDIR/repo/services/SMARTSENSE/metainfo.xml  &gt;  $stack_path/3.0/services/SMARTSENSE/metainfo.xml
        ambari-server restart
}
config_repo
config_db
install_ambari
config_metainfo_modify
</code></pre> 
<p id="ubab82f7d"></p> 
<p id="udadd4db8">cat repo/services/ACCUMULO/metainfo.xml</p> 
<p id="u9e385046">我们把这些组件选择隐藏了，默认不安装，不会出现在组件安装的选择项里面。</p> 
<pre id="XruMs"><code class="language-XML">&lt;metainfo&gt;
  &lt;schemaVersion&gt;2.0&lt;/schemaVersion&gt;
  &lt;services&gt;
    &lt;service&gt;
      &lt;name&gt;ACCUMULO&lt;/name&gt;
      &lt;deleted&gt;true&lt;/deleted&gt;
      &lt;!-- 省略 ---&gt;
    &lt;/service&gt;
  &lt;/services&gt;
&lt;/metainfo&gt;
</code></pre> 
<p id="u6000bd2d">global.sh</p> 
<pre id="rYwRt"><code class="language-bash">#######################
#部署相关全局参数定义
#######################
# root 密码保存
root_passwd=winner@001
# mysql配置
myurl=127.0.0.1
myuser=root
mypwd=Winner001
myport=3306
mydb=ipvacloud
# HDP包解压目录
install_path=/hadoop
hdp_tar_name=HDP-WinDP-AIO-Platform-final.tar.gz
# mysql 安装目录
mysql_install_path=/usr/local</code></pre> 
<p id="ueee06445">init_db.sql</p> 
<pre id="wWBao"><code class="language-sql">use mysql;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'Winner001' WITH GRANT OPTION;
create database ambari character set utf8;
CREATE USER 'ambari'@'%' IDENTIFIED BY 'Winner001';
GRANT ALL PRIVILEGES ON *.* TO 'ambari'@'%';
FLUSH PRIVILEGES;

create database hive character set utf8;
CREATE USER 'hive'@'%' IDENTIFIED BY 'Winner001';
GRANT ALL PRIVILEGES ON *.* TO 'hive'@'%';
FLUSH PRIVILEGES;

create database ranger character set utf8;
CREATE USER 'ranger'@'%' IDENTIFIED BY 'Winner001';
GRANT ALL PRIVILEGES ON *.* TO 'ranger'@'%';
FLUSH PRIVILEGES;</code></pre> 
<p id="ufeb43de6"><strong>ambari.properties</strong>，ambari配置文件需要修改数据库连接和JDK路径</p> 
<pre id="MIB1C"><code class="language-python">#
# Copyright 2011 The Apache Software Foundation
#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#
#Sat Nov 04 12:10:44 CST 2023
agent.package.install.task.timeout=1800
agent.stack.retry.on_repo_unavailability=false
agent.stack.retry.tries=5
agent.task.timeout=900
agent.threadpool.size.max=25
ambari-server.user=root
ambari.python.wrap=ambari-python-wrap
bootstrap.dir=/var/run/ambari-server/bootstrap
bootstrap.script=/usr/lib/ambari-server/lib/ambari_server/bootstrap.py
bootstrap.setup_agent.script=/usr/lib/ambari-server/lib/ambari_server/setupAgent.py
check_database_skipped=false
client.threadpool.size.max=25
common.services.path=/var/lib/ambari-server/resources/common-services
custom.action.definitions=/var/lib/ambari-server/resources/custom_action_definitions
custom.mysql.jdbc.name=mysql-connector-java.jar
extensions.path=/var/lib/ambari-server/resources/extensions
gpl.license.accepted=true
http.cache-control=no-store
http.charset=utf-8
http.pragma=no-cache
http.strict-transport-security=max-age=31536000
http.x-content-type-options=nosniff
http.x-frame-options=DENY
http.x-xss-protection=1; mode=block
java.home=/usr/java/jdk1.8.0_162
java.releases=jdk1.8
java.releases.ppc64le=
jce.download.supported=true
jdk.download.supported=true
jdk1.8.desc=Oracle JDK 1.8 + Java Cryptography Extension (JCE) Policy Files 8
jdk1.8.dest-file=jdk-8u112-linux-x64.tar.gz
jdk1.8.home=/usr/jdk64/
jdk1.8.jcpol-file=jce_policy-8.zip
jdk1.8.jcpol-url=http://public-repo-1.hortonworks.com/ARTIFACTS/jce_policy-8.zip
jdk1.8.re=(jdk.*)/jre
jdk1.8.url=http://public-repo-1.hortonworks.com/ARTIFACTS/jdk-8u112-linux-x64.tar.gz
kerberos.keytab.cache.dir=/var/lib/ambari-server/data/cache
kerberos.operation.verify.kdc.trust=true
metadata.path=/var/lib/ambari-server/resources/stacks
mpacks.staging.path=/var/lib/ambari-server/resources/mpacks
pid.dir=/var/run/ambari-server
previous.custom.mysql.jdbc.name=mysql-connector-java.jar
recommendations.artifacts.lifetime=1w
recommendations.dir=/var/run/ambari-server/stack-recommendations
resources.dir=/var/lib/ambari-server/resources
rolling.upgrade.skip.packages.prefixes=
security.server.disabled.ciphers=TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384|TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384|TLS_RSA_WITH_AES_256_CBC_SHA256|TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384|TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384|TLS_DHE_RSA_WITH_AES_256_CBC_SHA256|TLS_DHE_DSS_WITH_AES_256_CBC_SHA256|TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA|TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA|TLS_RSA_WITH_AES_256_CBC_SHA|TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA|TLS_ECDH_RSA_WITH_AES_256_CBC_SHA|TLS_DHE_RSA_WITH_AES_256_CBC_SHA|TLS_DHE_DSS_WITH_AES_256_CBC_SHA|TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256|TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256|TLS_RSA_WITH_AES_128_CBC_SHA256|TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA256|TLS_ECDH_RSA_WITH_AES_128_CBC_SHA256|TLS_DHE_RSA_WITH_AES_128_CBC_SHA256|TLS_DHE_DSS_WITH_AES_128_CBC_SHA256|TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA|TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA|TLS_RSA_WITH_AES_128_CBC_SHA|TLS_ECDH_ECDSA_WITH_AES_128_CBC_SHA|TLS_ECDH_RSA_WITH_AES_128_CBC_SHA|TLS_DHE_RSA_WITH_AES_128_CBC_SHA|TLS_DHE_DSS_WITH_AES_128_CBC_SHA|TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA|TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA|TLS_ECDH_ECDSA_WITH_3DES_EDE_CBC_SHA|TLS_ECDH_RSA_WITH_3DES_EDE_CBC_SHA|SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA|SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA|TLS_EMPTY_RENEGOTIATION_INFO_SCSV|TLS_DH_anon_WITH_AES_256_CBC_SHA256|TLS_ECDH_anon_WITH_AES_256_CBC_SHA|TLS_DH_anon_WITH_AES_256_CBC_SHA|TLS_DH_anon_WITH_AES_128_CBC_SHA256|TLS_ECDH_anon_WITH_AES_128_CBC_SHA|TLS_DH_anon_WITH_AES_128_CBC_SHA|TLS_ECDH_anon_WITH_3DES_EDE_CBC_SHA|SSL_DH_anon_WITH_3DES_EDE_CBC_SHA|SSL_RSA_WITH_DES_CBC_SHA|SSL_DHE_RSA_WITH_DES_CBC_SHA|SSL_DHE_DSS_WITH_DES_CBC_SHA|SSL_DH_anon_WITH_DES_CBC_SHA|SSL_RSA_EXPORT_WITH_DES40_CBC_SHA|SSL_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA|SSL_DHE_DSS_EXPORT_WITH_DES40_CBC_SHA|SSL_DH_anon_EXPORT_WITH_DES40_CBC_SHA|TLS_RSA_WITH_NULL_SHA256|TLS_ECDHE_ECDSA_WITH_NULL_SHA|TLS_ECDHE_RSA_WITH_NULL_SHA|SSL_RSA_WITH_NULL_SHA|TLS_ECDH_ECDSA_WITH_NULL_SHA|TLS_ECDH_RSA_WITH_NULL_SHA|TLS_ECDH_anon_WITH_NULL_SHA|SSL_RSA_WITH_NULL_MD5|TLS_KRB5_WITH_3DES_EDE_CBC_SHA|TLS_KRB5_WITH_3DES_EDE_CBC_MD5|TLS_KRB5_WITH_DES_CBC_SHA|TLS_KRB5_WITH_DES_CBC_MD5|TLS_KRB5_EXPORT_WITH_DES_CBC_40_SHA|TLS_KRB5_EXPORT_WITH_DES_CBC_40_MD5
security.server.keys_dir=/var/lib/ambari-server/keys
server.connection.max.idle.millis=900000
server.execution.scheduler.isClustered=false
server.execution.scheduler.maxDbConnections=5
server.execution.scheduler.maxThreads=5
server.execution.scheduler.misfire.toleration.minutes=480
server.fqdn.service.url=http://169.254.169.254/latest/meta-data/public-hostname
server.http.session.inactive_timeout=1800
server.jdbc.connection-pool=c3p0
server.jdbc.connection-pool.acquisition-size=5
server.jdbc.connection-pool.idle-test-interval=7200
server.jdbc.connection-pool.max-age=0
server.jdbc.connection-pool.max-idle-time=14400
server.jdbc.connection-pool.max-idle-time-excess=0
server.jdbc.database=mysql
server.jdbc.database_name=ambari
server.jdbc.driver=com.mysql.jdbc.Driver
server.jdbc.driver.path=/usr/share/java/mysql-connector-java.jar
server.jdbc.hostname=localhost
server.jdbc.port=3306
server.jdbc.rca.driver=com.mysql.jdbc.Driver
server.jdbc.rca.url=jdbc:mysql://localhost:3306/ambari
server.jdbc.rca.user.name=ambari
server.jdbc.rca.user.passwd=/etc/ambari-server/conf/password.dat
server.jdbc.url=jdbc:mysql://localhost:3306/ambari
server.jdbc.user.name=ambari
server.jdbc.user.passwd=/etc/ambari-server/conf/password.dat
server.os_family=redhat7
server.os_type=centos7
server.persistence.type=remote
server.python.log.level=INFO
server.python.log.name=ambari-server-command.log
server.stages.parallel=true
server.task.timeout=1200
server.tmp.dir=/var/lib/ambari-server/data/tmp
server.version.file=/var/lib/ambari-server/resources/version
shared.resources.dir=/usr/lib/ambari-server/lib/ambari_commons/resources
skip.service.checks=false
stack.java.home=/usr/java/jdk1.8.0_162
stackadvisor.script=/var/lib/ambari-server/resources/scripts/stack_advisor.py
ulimit.open.files=65536
upgrade.parameter.convert.hive.tables.timeout=86400
upgrade.parameter.move.hive.tables.timeout=86400
user.inactivity.timeout.default=0
user.inactivity.timeout.role.readonly.default=0
views.ambari.request.connect.timeout.millis=30000
views.ambari.request.read.timeout.millis=45000
views.http.cache-control=no-store
views.http.charset=utf-8
views.http.pragma=no-cache
views.http.strict-transport-security=max-age=31536000
views.http.x-content-type-options=nosniff
views.http.x-frame-options=SAMEORIGIN
views.http.x-xss-protection=1; mode=block
views.request.connect.timeout.millis=5000
views.request.read.timeout.millis=10000
views.skip.home-directory-check.file-system.list=wasb,adls,adl
webapp.dir=/usr/lib/ambari-server/web</code></pre> 
<p id="u58d7822d">password.dat（数据库密码）</p> 
<pre id="LQs46"><code>Winner001</code></pre> 
<p id="u6875f3c2">my.cnf</p> 
<pre id="RPeQ8"><code class="language-bash">[mysql]
socket=/var/lib/mysql/mysql.sock
# set mysql client default chararter
default-character-set=utf8

[mysqld]
socket=/var/lib/mysql/mysql.sock
# set mysql server port  
port = 3306
# set mysql install base dir
basedir=/usr/local/mysql
# set the data store dir
datadir=/usr/local/mysql/data
# set the number of allow max connnection
max_connections=200
# set server charactre default encoding
character-set-server=utf8
# the storage engine
default-storage-engine=INNODB
lower_case_table_names=1
max_allowed_packet=16M
explicit_defaults_for_timestamp=true
[mysql.server]
user=mysql
basedir=/usr/local/mysql</code></pre> 
<p id="u24e8cd75">krb5.conf （kerberos配置）</p> 
<pre id="NOMZ1"><code>[libdefaults]
  renew_lifetime = 7d
  forwardable = true
  default_realm = WINNER.COM
  ticket_lifetime = 24h
  dns_lookup_realm = false
  dns_lookup_kdc = false
  default_ccache_name = /tmp/krb5cc_%{uid}
  #default_tgs_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5
  #default_tkt_enctypes = aes des3-cbc-sha1 rc4 des-cbc-md5

[logging]
  default = FILE:/var/log/krb5kdc.log
  admin_server = FILE:/var/log/kadmind.log
  kdc = FILE:/var/log/krb5kdc.log

[realms]
  WINNER.COM = {
    admin_server = windp-aio
    kdc = windp-aio
  }</code></pre> 
<p id="u2ea96f14">repo源</p> 
<p class="img-center"><img alt="" height="789" id="uce7a564c" src="https://images2.imgbox.com/d3/68/fx6b2Ioj_o.png" width="924"></p> 
<p id="ubb64f926">ambari.repo</p> 
<pre id="f6CrZ"><code>#VERSION_NUMBER=2.7.4.0-118
[ambari-2.7.4.0]
#json.url = http://public-repo-1.hortonworks.com/HDP/hdp_urlinfo.json
name=ambari Version - ambari-2.7.4.0
baseurl=http://windp-aio/ambari/centos7/2.7.4.0-118/
gpgcheck=1
gpgkey=http://windp-aio/ambari/centos7/2.7.4.0-118/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins
enabled=1
priority=1</code></pre> 
<p id="u5f6b74fd">hdp.repo</p> 
<pre id="efkCy"><code>#VERSION_NUMBER=3.1.4.0-315
[HDP-3.1.4.0]
name=HDP Version - HDP-3.1.4.0
baseurl=http://windp-aio/HDP/centos7/3.1.4.0-315
gpgcheck=1
gpgkey=http://windp-aio/HDP/centos7/3.1.4.0-315/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins
enabled=1
priority=1


[HDP-UTILS-1.1.0.22]
name=HDP-UTILS Version - HDP-UTILS-1.1.0.22
baseurl=http://windp-aio/HDP-UTILS/centos7/1.1.0.22
gpgcheck=1
gpgkey=http://windp-aio/HDP/centos7/3.1.4.0-315/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins
enabled=1
priority=1
</code></pre> 
<p id="u6ca40cac">hdp.gpl.repo</p> 
<pre id="gdxSY"><code>#VERSION_NUMBER=3.1.4.0-315
[HDP-GPL-3.1.4.0]
name=HDP-GPL Version - HDP-GPL-3.1.4.0
baseurl=http://windp-aio/HDP-GPL/centos7/3.1.4.0-315
gpgcheck=1
gpgkey=http://windp-aio/HDP-GPL/centos7/3.1.4.0-315/RPM-GPG-KEY/RPM-GPG-KEY-Jenkins
enabled=1
priority=1
</code></pre> 
<p><span style="color:#fe2c24;"><strong>总结：</strong></span>如上是单机测试环境，我们可以将集群扩展到多台 完成集群安装。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/081f29ea3a6d3cc1721d31dec6d75ea1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hivesql 将json格式字符串转为数组</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/71c4e16bdbc834da7f208f6300c618bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端将blob转换为可下载的url及下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>