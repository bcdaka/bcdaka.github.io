<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Termux配置安卓编译环境 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e4b896aed68dae86e41f24e32257afa4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Termux配置安卓编译环境">
  <meta property="og:description" content="前言 Termux安装后，就相当于把手机变成了一台Linux服务器，而且现在手机卡通常是能拿到ipv6公网地址的，所以，这个服务器能干啥？
编程搭建网站跑脚本 本文讲述的就是怎么在Termux搭建安卓编译环境，实现手机app自产自编，自己搞自己，脱离电脑搞app开发。
Step1 配置sdkmanager 打开android 官网，下载sdkmanager最新版，推送到Termux中，创建android sdk 保存目录，解压commandline-tools并进行调整，参考android sdk标准目录，把解压内容都放到latest中。
不要直接解压，这个commandline-tools解压后不是标准目录。
标准的sdk目录是这样的
脚本执行处理：
curl -O https://googledownloads.cn/android/repository/commandlinetools-linux-11076708_latest.zip ANDROID_HOME=~/android/sdk/ mkdir -p $ANDROID_HOME unzip `ls |grep &#34;commandlinetools-linux.*_latest.zip&#34;` -d $ANDROID_HOME # cmdline-tools 的产物需要移动到cmdline-tools/latest目录中，这是android sdk固定的路径组织形式 # 压缩包没有包含在latest文件夹中，自己移动一下 mv $ANDROID_HOME/cmdline-tools/* $ANDROID_HOME/latest mv $ANDROID_HOME/latest $ANDROID_HOME/cmdline-tools 啥，命令有点多，手指打字累死
那还是连接个蓝牙键盘吧，打开手机otg功能，就可以自由输入了，啥，你没有蓝牙键盘？没事，淘宝几元一个usb otg转接头，把键盘插到手机上也可以。
啥？都没有，那你还是开启sshd服务，电脑连接手机吧，可以参考作者前一篇文。
Step2 配置android环境变量 命令
vim ~/.bashrc 配置：
echo &#34;用户：&#34;$(whoami) if pgrep -x &#34;sshd&#34; &gt;/dev/null then echo #echo &#34;sshd运行中...&#34; else sshd echo &#34;自动启动sshd&#34; fi export ANDROID_HOME=~/android/sdk export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$PATH 执行source .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-16T14:56:57+08:00">
    <meta property="article:modified_time" content="2024-02-16T14:56:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Termux配置安卓编译环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_2"></a>前言</h3> 
<p>Termux安装后，就相当于把手机变成了一台Linux服务器，而且现在手机卡通常是能拿到ipv6公网地址的，所以，这个服务器能干啥？</p> 
<ul><li>编程</li><li>搭建网站</li><li>跑脚本</li></ul> 
<p>本文讲述的就是怎么在Termux搭建安卓编译环境，实现手机app自产自编，自己搞自己，脱离电脑搞app开发。</p> 
<h3><a id="Step1_sdkmanager_11"></a>Step1 配置sdkmanager</h3> 
<p>打开android 官网，下载sdkmanager最新版，推送到Termux中，创建android sdk 保存目录，解压commandline-tools并进行调整，参考android sdk标准目录，把解压内容都放到latest中。<br> 不要直接解压，这个commandline-tools解压后不是标准目录。</p> 
<p>标准的sdk目录是这样的<br> <img src="https://images2.imgbox.com/d7/3e/TUHsERnk_o.png" alt="在这里插入图片描述"></p> 
<p>脚本执行处理：</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://googledownloads.cn/android/repository/commandlinetools-linux-11076708_latest.zip

<span class="token assign-left variable">ANDROID_HOME</span><span class="token operator">=~</span>/android/sdk/
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">$ANDROID_HOME</span>
<span class="token function">unzip</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ls</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"commandlinetools-linux.*_latest.zip"</span><span class="token variable">`</span></span> <span class="token parameter variable">-d</span> <span class="token variable">$ANDROID_HOME</span>
<span class="token comment"># cmdline-tools 的产物需要移动到cmdline-tools/latest目录中，这是android sdk固定的路径组织形式</span>
<span class="token comment"># 压缩包没有包含在latest文件夹中，自己移动一下</span>
<span class="token function">mv</span> <span class="token variable">$ANDROID_HOME</span>/cmdline-tools/* <span class="token variable">$ANDROID_HOME</span>/latest
<span class="token function">mv</span> <span class="token variable">$ANDROID_HOME</span>/latest <span class="token variable">$ANDROID_HOME</span>/cmdline-tools


</code></pre> 
<p><strong>啥，命令有点多，手指打字累死</strong></p> 
<p>那还是连接个蓝牙键盘吧，打开手机otg功能，就可以自由输入了，啥，你没有蓝牙键盘？没事，淘宝几元一个usb otg转接头，把键盘插到手机上也可以。</p> 
<p>啥？都没有，那你还是开启sshd服务，电脑连接手机吧，可以参考作者前一篇文。</p> 
<h3><a id="Step2_android_40"></a>Step2 配置android环境变量</h3> 
<p>命令</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> ~/.bashrc
</code></pre> 
<p>配置：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"用户："</span><span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span>
 
<span class="token keyword">if</span> pgrep <span class="token parameter variable">-x</span> <span class="token string">"sshd"</span> <span class="token operator">&gt;</span>/dev/null
  <span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span>
   <span class="token comment">#echo "sshd运行中..."</span>
  <span class="token keyword">else</span>
    sshd
    <span class="token builtin class-name">echo</span> <span class="token string">"自动启动sshd"</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ANDROID_HOME</span><span class="token operator">=~</span>/android/sdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ANDROID_HOME</span>/cmdline-tools/latest/bin:<span class="token environment constant">$PATH</span>
</code></pre> 
<p>执行<code>source .bashrc</code> 更新环境变量，使之生效<br> 不生效就干掉Termux，重新打开。</p> 
<h3><a id="Step3_android_sdk_67"></a>Step3 下载android sdk开发工具</h3> 
<p>sdkmanager下载之后不代表弄完了android开发环境，这个sdkmanager仅仅是个管理sdk的命令行工具，它是用来下载、更新、移除安卓sdk的。</p> 
<p>所以，通过它安装目前最新的安卓版本开发工具吧：</p> 
<pre><code class="prism language-bash"><span class="token comment">#查看sdk列表</span>
sdkmanager <span class="token parameter variable">--list</span>
<span class="token comment">#安装安卓14平台开发工具</span>
sdkmanager <span class="token parameter variable">--install</span> <span class="token string">"platforms;android-34"</span>
<span class="token comment">#安装支持安卓14的构建工具</span>
sdkmanager <span class="token parameter variable">--install</span> <span class="token string">"build-tools;34.0.0"</span>
</code></pre> 
<h3><a id="Step3_Java_81"></a>Step3 配置Java环境</h3> 
<p>Termux显然不能直接安装android studio来使用，所以需要我们自己配置java环境（当然，你又在Termux中安装ubutun当我没说）</p> 
<p>Termux 官方的jdk是17，比较新，正常来说，本文发布时安卓开发用得最多的是jdk11，jdk17部分老项目无法编译。</p> 
<p>但是jdk11的Termux兼容版本被原作者干掉了，所以，想折腾的兄弟去github再找找吧，不行就自己编译。</p> 
<p>不用纠结，上jdk17，编译不了的项目，给它升级！</p> 
<p>Termux安装jdk17一条命令即可：</p> 
<pre><code class="prism language-bash">pkg <span class="token function">install</span> openjdk-17
</code></pre> 
<p><strong>哈哈哈，啊啊啊~你仰天大笑一声，竖子！敢尔。你以为不过如此，和linux平台搞环境一毛一样，于是你匆匆忙忙安装git，然后迫不及待地下载一个项目来编译，结果编译失败，你傻眼了。</strong></p> 
<h3><a id="Step5_sdk_96"></a>Step5 安卓sdk环境修复</h3> 
<h4><a id="_98"></a>第一个异常</h4> 
<p>你的操作过程如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 下载一个git项目</span>
<span class="token function">git</span> clone xxxx.git
<span class="token builtin class-name">cd</span> xxxx
<span class="token comment"># 赋予gradle脚本执行权限</span>
<span class="token function">chmod</span> +x ./gradlew
./gradlew build
</code></pre> 
<p>你得到的错误如下：<br> <img src="https://images2.imgbox.com/c4/af/U3d8CVfd_o.png" alt="在这里插入图片描述"></p> 
<p>原因很简单，环境变量ANDROID_HOME没配置？？？什么，之前不是配置了吗？你不管了，你知道<code>Termux</code>和正常的<code>Linux</code>还是有区别的，于是<code>vim local.properties</code> 编辑文件，指定了</p> 
<pre><code class="prism language-bash"><span class="token comment"># 写全路径，不写$ANDROID_HOME，读不到</span>
<span class="token assign-left variable">sdk.dir</span><span class="token operator">=</span>/data/data/com.termux/files/home/android/sdk
</code></pre> 
<p><strong>再然后，编译，你又傻眼了</strong></p> 
<h4><a id="_121"></a>第二个异常</h4> 
<p><img src="https://images2.imgbox.com/67/ec/GfF6E6Bw_o.png" alt="在这里插入图片描述"></p> 
<p>你观察发现，似乎报错是说这个错误正常不应该出现。所以是sdk异常？<br> 问谷歌，你找到了原因，原来是google编译的安卓sdk没有arm版本，而现代手机通常都是arm-v8-64架构。<br> github一番，你千辛万苦找到了sdk工具的各种架构版本：<br> <a href="https://github.com/lzhiyong/android-sdk-tools/releases/tag/34.0.3">https://github.com/lzhiyong/android-sdk-tools/releases/tag/34.0.3</a></p> 
<p><a href="https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-aarch64.zip">https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-aarch64.zip</a></p> 
<p><a href="https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-arm.zip">https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-arm.zip</a></p> 
<p><a href="https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-i686.zip">https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-i686.zip</a></p> 
<p><a href="https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-x86_64.zip">https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-x86_64.zip</a></p> 
<p>你选择了<code>arm</code>版本下载，按照指引将其解压到sdk对应的目录，并覆盖掉。</p> 
<p>命令：</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-O</span> https://github.com/lzhiyong/android-sdk-tools/releases/download/34.0.3/android-sdk-tools-static-arm.zip

<span class="token function">unzip</span> android-sdk-tools-static-arm.zip <span class="token parameter variable">-d</span> ./armtools
<span class="token comment"># 下载的是34版本的，所以，覆盖到34版本的目录</span>
<span class="token function">cp</span> <span class="token parameter variable">-p</span> ./armtools/build-tools/*  ~/android/sdk/build-tools/34.0.0
<span class="token function">cp</span> <span class="token parameter variable">-p</span> ./armtools/platform-tools/*  ~/android/sdk/platform-tools 
</code></pre> 
<p><strong>再次编译项目，你懵逼了，怎么还是一样的错误？你不禁深深地怀疑人生。</strong></p> 
<p>经过一个香烟的思考时间后，你终于把目光看向这一行报错代码：<br> <code>/data/data/com.termux/files/home/.gradle/caches/transforms-4/2e9d53eb8f30ecd552adf0fe0f14f8c5/transformed/aapt2-8.4.0-alpha07-11315950-linux/aapt2[2]: syntax error: unexpected '(' </code></p> 
<p>这说明.gradle下存在一个aapt2，gradle编译的时根本没拿sdk目录的aapt 文件？</p> 
<p>你进到报错的目录一看，果然如此！</p> 
<p>你不禁跃跃欲试：“大胆点？我直接把这个gradle路径下的aapt2替换掉？”</p> 
<p>说干就干。<br> 因为sdk目录的aapt2已经被替换了，所以，你直接命令行覆盖报错：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 注意，因为gradle草丹的缓存机制，每个人甚至每个项目的路径都不一样，请按照自己报错的路径进行替换</span>
<span class="token function">cp</span> <span class="token parameter variable">-f</span> ~/android/sdk/build-tools/34.0.0/aapt2 /data/data/com.termux/files/home/.gradle/caches/transforms-4/2e9d53eb8f30ecd552adf0fe0f14f8c5/transformed/aapt2-8.4.0-alpha07-11315950-linux/aapt2
</code></pre> 
<p>再次编译，<code>./gradlew assembleDebug</code><br> Good good study, day day up.<br> Success！</p> 
<p>可以愉快地去安装apk了。</p> 
<p><img src="https://images2.imgbox.com/60/c5/g62EKGb4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Setup6_apk_179"></a>Setup6 安装apk到手机中</h3> 
<p>编译已经完成，我相信，大家可以随意拖apk出来，然后点击安装了。</p> 
<p>不外呼：<code>cp ./app/build/outputs/apk/debug/app-debug.apk /sdcard/</code><br> 然后打开手机，去点击安装嘛。</p> 
<p>不过，现在我要介绍的是，执行adb安装到本手机上。</p> 
<p>adb在sdk的platform-tools下，将其添加到环境变量中，以便运行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"用户："</span><span class="token variable"><span class="token variable">$(</span><span class="token function">whoami</span><span class="token variable">)</span></span>
 
<span class="token keyword">if</span> pgrep <span class="token parameter variable">-x</span> <span class="token string">"sshd"</span> <span class="token operator">&gt;</span>/dev/null
  <span class="token keyword">then</span>
   <span class="token builtin class-name">echo</span>
   <span class="token comment">#echo "sshd运行中..."</span>
  <span class="token keyword">else</span>
    sshd
    <span class="token builtin class-name">echo</span> <span class="token string">"自动启动sshd"</span>
<span class="token keyword">fi</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ANDROID_HOME</span><span class="token operator">=~</span>/android/sdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$ANDROID_HOME</span>/cmdline-tools/latest/bin:<span class="token variable">$ANDROID_HOME</span>/platform-tools:<span class="token environment constant">$PATH</span>

</code></pre> 
<p>如果，我是说如果你是普通运用，只想用adb安装东西，不想安装sdk那么繁琐，完全可以执行命令安装<code>pkg install android-tools</code><br> 这会安装一个旧版本的安卓开发工具包，包含adb。</p> 
<p>接下来就是重头戏。平时我们都是电脑调式手机，现在如何让手机自己调试自己呢？</p> 
<p>换个角度，平时电脑执行adb，相当与Termux现在是电脑，如何让手机开启调式后，连上自己呢？</p> 
<p><strong>我们可以通过开启wifi调试来使Termux中的adb连接到手机本身</strong></p> 
<p>具体步骤：</p> 
<ul><li>手机和电脑同一个局域网，且连接USB到电脑</li><li>手机开启wifi调试模式</li><li>获取wifi调试地址，命令连接：adb connect xxxxx:xxx</li></ul> 
<p>以上是针对android11及以上手机，如果是安卓10以以下的手机：</p> 
<ul><li><code>adb tcpip 6666</code> 开启手机调式端口，6666</li><li>打开Termux，·adb connect 手机ip:6666· 即可连接</li><li>拔掉USB。正常在Termux使用adb调式</li></ul> 
<p>和一般的adb wifi调试没有任何区别</p> 
<p>你突然咦地一声,有这么复杂吗?——我怎么记得Termux中通过<code>pkg install android-tools</code>安装的adb能够直接连接到当前设备进行调试，不需要借助wifi调试？<br> 没错，termux仓库中的安卓开发工具确实有这个能力，所以，安装它吧，然后替换掉安卓sdk的这个些个工具。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8e5d3d339fa48a15950729d5ee6adac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql——update更新数据的方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24f14b968126a348ec6300550dbee937/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大数据技术原理与应用实验指南——HBase编程实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>