<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【STM32】时钟体系 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5f165a123f3317be764233f16fcacba4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【STM32】时钟体系">
  <meta property="og:description" content="一、时钟体系
为什么需要时钟？
时钟可以为系统提供精确的定时，比如时间显示，定时器，pwm…
为芯片各功能模块提供工作势能,使能各组管脚工作，如果不使能，管脚无法工作
同步数据传输
给单片机提供一个时钟信号（一个非常稳定的频率信号），使单片机各内部组件同步工作，并且在和外部设备通信时是也能达到同步。
动态调整运行频率，就可以控制性能与功耗！
1、参考手册 STM32F4xx 中文参考手册.pdf 第 106 页
2、时钟源
a.可以使用三种不同的时钟源来驱动系统时钟 (SYSCLK)，CPU 运行的频率为 168MHz：
● HSI 振荡器时钟（16MHz），也就是高速内部时钟，一般来说很少用，因为精度没有外部高速时钟那么高。
● HSE 振荡器时钟，也就是高速外部时钟，GECM4 开发板 8MHz。
● 主 PLL (PLL) 时钟
b.器件具有以下两个次级时钟源：
● 32 kHz 低速内部 RC (LSI RC)，该 RC 用于驱动独立看门狗，也可选择提供给 RTC 用于停机/待机模式下的自动唤醒。
● 32.768 kHz 低速外部晶振（LSE 晶振），用于驱动 RTC 时钟 (RTCCLK)对于每个时钟源来说，在未使用时都可单独打开或者关闭，以降低功耗。
3、时钟树
时钟树就是关注时钟源和时钟的流向，嵌入式系统中的模块和外设工作都以时钟为基准。有了时钟树，就有了时钟域。嵌入式中除了内核，还有各个单元，每个单元工作在不同的时钟频率下，给每个单元提供不同的时钟。
实际应用中根据需要配置外设的时钟控制开关，选择需要的时钟频率，并可关闭不用外设时钟。
时钟树分析 51单片机和STM32时钟体系对比 二、PLL
2.1 概述
PLL(Phase Locked Loop)： 为锁相回路或锁相环，用来统一整合时钟信号，使高频器件正常工作，如内存的存取资料等。
PLL基于振荡器中的反馈技术，许多电子设备要正常工作，通常需要外部的输入信号与内部的振荡信号同步。
一般的晶振由于工艺与成本原因，做不到很高的频率，而在需要高频应用时，由相应的器件VCO，实现转成高频，但并不稳定，故利用锁相环路就可以实现稳定且高频的时钟信号。
2.2 基本组成
锁相环路是一种反馈控制电路，简称锁相环（PLL,Phase-Locked Loop）。锁相环的特点是：利用外部输入的参考信号控制环路内部振荡信号的频率和相位。因锁相环可以实现输出信号频率对输入信号频率的自动跟踪，所以锁相环通常用于闭环跟踪电路。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-27T11:05:33+08:00">
    <meta property="article:modified_time" content="2024-08-27T11:05:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【STM32】时钟体系</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>一、时钟体系</strong></p> 
<p>为什么需要时钟？</p> 
<ol><li> <p>时钟可以为系统提供精确的定时，比如时间显示，定时器，pwm…</p> </li><li> <p>为芯片各功能模块提供工作势能,使能各组管脚工作，如果不使能，管脚无法工作</p> </li><li> <p>同步数据传输</p> </li></ol> 
<p>给单片机提供一个时钟信号（一个非常稳定的频率信号），使单片机各内部组件同步工作，并且在和外部设备通信时是也能达到同步。</p> 
<p>动态调整运行频率，就可以控制性能与功耗！</p> 
<p>1、参考手册 STM32F4xx 中文参考手册.pdf 第 106 页</p> 
<p>2、时钟源</p> 
<p>a.可以使用三种不同的时钟源来驱动系统时钟 (SYSCLK)，CPU 运行的频率为 168MHz：</p> 
<p>● HSI 振荡器时钟（16MHz），也就是高速内部时钟，<strong>一般来说很少用，因为精度没有外部高速时钟那么高。</strong></p> 
<p>● HSE 振荡器时钟，也就是高速外部时钟，GECM4 开发板 8MHz。</p> 
<p>● 主 PLL (PLL) 时钟</p> 
<p>b.器件具有以下两个次级时钟源：</p> 
<p>● 32 kHz 低速内部 RC (LSI RC)，该 RC 用于驱动独立看门狗，也可选择提供给 RTC 用于停机/待机模式下的自动唤醒。</p> 
<p>● 32.768 kHz 低速外部晶振（LSE 晶振），用于驱动 RTC 时钟 (RTCCLK)对于每个时钟源来说，在未使用时都可单独打开或者关闭，以降低功耗。</p> 
<p>3、时钟树</p> 
<p>时钟树就是关注时钟源和时钟的流向，嵌入式系统中的模块和外设工作都以时钟为基准。有了时钟树，就有了时钟域。嵌入式中除了内核，还有各个单元，每个单元工作在不同的时钟频率下，给每个单元提供不同的时钟。</p> 
<p>实际应用中根据需要配置外设的时钟控制开关，选择需要的时钟频率，并可关闭不用外设时钟。</p> 
<p><img src="https://images2.imgbox.com/44/1f/Mko2y7ie_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_42"></a>时钟树分析</h4> 
<p><img src="https://images2.imgbox.com/86/fc/spyVAGb2_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="51STM32_46"></a>51单片机和STM32时钟体系对比</h5> 
<p><img src="https://images2.imgbox.com/90/36/lAgiz93E_o.png" alt="在这里插入图片描述"><br> <strong>二、PLL</strong></p> 
<p><strong>2.1 概述</strong></p> 
<p>PLL(Phase Locked Loop)： 为锁相回路或锁相环，用来统一整合时钟信号，使高频器件正常工作，如内存的存取资料等。</p> 
<p>PLL基于振荡器中的反馈技术，许多电子设备要正常工作，通常需要外部的输入信号与内部的振荡信号同步。</p> 
<p>一般的晶振由于工艺与成本原因，做不到很高的频率，而在需要高频应用时，由相应的器件VCO，实现转成高频，但并不稳定，故利用锁相环路就可以实现稳定且高频的时钟信号。</p> 
<p><strong>2.2 基本组成</strong></p> 
<p>锁相环路是一种反馈控制电路，简称锁相环（PLL,Phase-Locked Loop）。锁相环的特点是：利用外部输入的参考信号控制环路内部振荡信号的频率和相位。因锁相环可以实现输出信号频率对输入信号频率的自动跟踪，所以锁相环通常用于闭环跟踪电路。</p> 
<p>锁相环在工作的过程中，当输出信号的频率与输入信号的频率相等时，输出电压与输入电压保持固定的相位差值，即输出电压与输入电压的相位被锁住，这就是锁相环名称的由来。锁相环通常由鉴相器（PD,Phase Detector）、环路滤波器（LF,Loop Filter）和压控振荡器（VCO,Voltage Controlled Oscillator）三部分组成。</p> 
<p>锁相环的工作原理是检测输入信号和输出信号的相位差，并将检测出的相位差信号通过鉴相器转换成电压信号输出，经低通滤波器滤波后形成压控振荡器的控制电压，对振荡器输出信号的频率实施控制，再通过反馈通路把振荡器输出信号的频率、相位反馈到鉴相器。</p> 
<p>锁相环在工作过程中，当输出信号的频率成比例地反映输入信号的频率时，输出电压与输入电压保持固定的相位差值，这样输出电压与输入电压的相位就被锁住了。</p> 
<p>​ <img src="https://images2.imgbox.com/8c/99/5hx2KIEj_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.3 类比说明</strong></p> 
<p>我们刚开始学车的时候，在道路上开车，眼睛就好像一个鉴相器，负责发现车行驶的方向（反馈）和前方的路（输入）是否有差别，把差别输入大脑进行判断，然后指挥双手旋转方向盘，旋转方向盘的动作转换成车的行驶方向，如下图所示。</p> 
<p>​ <img src="https://images2.imgbox.com/a7/f5/uK0M50Zg_o.png" alt="在这里插入图片描述"></p> 
<p>我们通过这么一个闭环过程不断地调节方向盘，保证车行驶在正道上。</p> 
<p><strong>2.3 相位差</strong></p> 
<p>两个频率相同的交流电相位的差叫做相位差，或者叫做相差，又称“相角差”、“相差”、“周相差”或“位相差”。两个作周期变化的物理量的相之间的差值。它为正值时称前者超前于后者，为负值时则滞后于后者。它为零或π的偶数倍时，两物理量同相;为π的奇数倍时则称反相。</p> 
<p>这两个频率相同的交流电，可以是两个交流电流，可以是两个交流电压，可以是两个交流电动势，也可以是这三种量中的任何两个。两个同频率正弦量的相位差就等于初相之差。是一个不随时间变化的常数。也可以是一个元件上的电流与电压的相位变化。任意一个正弦量y = Asin(wt+ j0）的相位为(wt+ j0），两个同频率正弦量的相位差（与时间t无关）。设第一个正弦量的初相为 j01，第二个正弦量的初相为 j02，则这两个正弦量的相位差为j12 = j01 - j02。</p> 
<p><img src="https://images2.imgbox.com/a7/1b/QDIFP5PN_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.4 PLL配置参数</strong></p> 
<p>​ <img src="https://images2.imgbox.com/df/4c/3I9qtPHa_o.png" alt="在这里插入图片描述"></p> 
<p>不同的芯片，倍频（频率翻倍）公式是不一样的，需要查询芯片手册！</p> 
<p><strong>三、SystemInit系统初始化函数</strong></p> 
<p>1.其实第一个执行的文件是汇编文件</p> 
<ul><li>栈的初始化，提供函数调用的时候进行现场保护和现场恢复</li><li>堆的初始化，为申请内存提供空间，调用malloc</li><li>执行Reset_Handler，意思说上电复位后执行的动作</li><li>执行SystemInit函数</li><li>跳转到main函数</li></ul> 
<p>2.初始化Flash接口，更新PLL系统频率</p> 
<pre><code class="prism language-c"><span class="token comment">/**

  * @brief  Setup the microcontroller system
  * Initialize the Embedded Flash Interface, the PLL and update the
  * SystemFrequency variable.
  * @param  None
  * @retval None
    */</span>
    <span class="token keyword">void</span> <span class="token function">SystemInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token comment">/* Configure the System clock source, PLL Multiplier and Divider factors,
         AHB/APBx prescalers and Flash settings ----------------------------------*/</span>
      <span class="token function">SetSysClock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>3.调用SetSysClock函数设置PLL时钟，然后进行分频</p> 
<pre><code class="prism language-c"><span class="token comment">/**

  * @brief  Configures the System clock source, PLL Multiplier and Divider factors,
  * AHB/APBx prescalers and Flash settings
  * @Note   This function should be called only once the RCC clock configuration  
  * is reset to the default reset state (done in SystemInit() function).   
  * @param  None
  * @retval None
    */</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">SetSysClock</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">/* Configure the main PLL */</span>
        RCC<span class="token operator">-&gt;</span>PLLCFGR <span class="token operator">=</span> PLL_M <span class="token operator">|</span> <span class="token punctuation">(</span>PLL_N <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PLL_P <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                       <span class="token punctuation">(</span>RCC_PLLCFGR_PLLSRC_HSE<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>PLL_Q <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
            

 

system_stm32f4xx<span class="token punctuation">.</span>c文件有以下倍频<span class="token punctuation">(</span>PLL_N<span class="token punctuation">)</span>与分频<span class="token punctuation">(</span>PLL_M、PLL_P<span class="token punctuation">)</span>因子：



<span class="token comment">/* PLL_VCO = (HSE_VALUE or HSI_VALUE / PLL_M) * PLL_N */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PLL_M</span>      <span class="token expression"><span class="token number">8</span>     </span><span class="token comment">//(记得修改为8)</span></span>
<span class="token comment">/* USB OTG FS, SDIO and RNG Clock =  PLL_VCO / PLLQ */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PLL_Q</span>      <span class="token expression"><span class="token number">7</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span>STM32F40_41xxx<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PLL_N</span>      <span class="token expression"><span class="token number">336</span></span></span>
<span class="token comment">/* SYSCLK = PLL_VCO / PLL_P */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PLL_P</span>      <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* STM32F40_41xxx */</span></span>
</code></pre> 
<p>​</p> 
<p>由于官方的代码是使用外部高速晶振25MHz，VSTC-M4开发板是使用外部高速晶振8MHz，所以PLL的倍频因子要进行修改，只修改<strong>PLL_M为8</strong>。</p> 
<p>4.阅读system_stm32f4xx.c文件的头部注释</p> 
<ul><li> <pre><code>   ```c
</code></pre> <p>*=============================================================================<br> *=============================================================================</p> 
  <ul><li> <pre><code>               Supported STM32F40xxx/41xxx devices
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               System Clock source                    | PLL (HSE)
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               SYSCLK(Hz)                             | 168000000
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               HCLK(Hz)                               | 168000000
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               AHB Prescaler                          | 1
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               APB1 Prescaler                         | 4
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               APB2 Prescaler                         | 2
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               HSE Frequency(Hz)                      | 25000000   开发板外部晶振是8MHz，我们要将25MHz修改为8MHz
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLL_M                                  | 25
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLL_N                                  | 336
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLL_P                                  | 2
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLL_Q                                  | 7
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLLI2S_N                               | NA
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               PLLI2S_R                               | NA
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               I2S input clock                        | NA
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               VDD(V)                                 | 3.3
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Main regulator output voltage          | Scale1 mode
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Flash Latency(WS)                      | 5
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Prefetch Buffer                        | ON
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Instruction cache                      | ON
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Data cache                             | ON
               *-----------------------------------------------------------------------------
</code></pre> </li><li> <pre><code>               Require 48MHz for USB OTG FS,          | Disabled
</code></pre> </li><li> <pre><code>               SDIO and RNG clock                     |
               *-----------------------------------------------------------------------------
               *============================================================================
</code></pre> </li></ul> <pre><code>
</code></pre> </li></ul> 
<p><strong>去掉</strong>stm32f4xx.h的<strong>只读属性</strong></p> 
<p>​ <img src="https://images2.imgbox.com/58/c6/y9e32drq_o.png" alt="在这里插入图片描述"></p> 
<p>接着修改stm32f4xx.h以下内容，行127将外部晶振频率值修改为8MHz。</p> 
<pre><code class="prism language-c">   <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span><span class="token function">defined</span>  <span class="token punctuation">(</span>HSE_VALUE<span class="token punctuation">)</span>   #define <span class="token function">HSE_VALUE</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token number">8000000</span><span class="token punctuation">)</span> </span><span class="token comment">/*!&lt; Value of the External oscillator in Hz */</span> <span class="token expression"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> </span></span><span class="token comment">/* HSE_VALUE */</span>               </span>
</code></pre> 
<p>最后按照PLL的运算公式，最终得到输出频率为168MHz。</p> 
<p>​ <img src="https://images2.imgbox.com/a1/e0/hCf7RqZo_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_263"></a>注意事项</h4> 
<p>1.在《STM32F4xx中文参考手册》 P117页，PLL_M、PLL_N、PLL_P，这三个参数都有一定的范围限制，详细如下：</p> 
<p>​ 2≤ PLL_M ≤63 192≤ PLL_N ≤432 PLL_P：2、4、6、8</p> 
<h5><a id="_269"></a>练习：</h5> 
<pre><code class="prism language-c">尝试将CPU频率设置为<span class="token number">216</span>MHZ，感受超频快感  HSE<span class="token operator">=</span><span class="token number">8</span>M M<span class="token operator">=</span><span class="token number">8</span> N<span class="token operator">=</span><span class="token number">432</span> P<span class="token operator">=</span><span class="token number">2</span>
尝试将CPU频率设置为<span class="token number">84</span>MHZ，感受蜗牛的速度  HSE<span class="token operator">=</span><span class="token number">8</span>M M<span class="token operator">=</span><span class="token number">8</span> N<span class="token operator">=</span><span class="token number">336</span> P<span class="token operator">=</span><span class="token number">4</span>
</code></pre> 
<p><strong>四、时钟源</strong></p> 
<p>在特殊的应用场景，为了达到最高的能效比，没有必要使用到PLL，可将HSE、HSI作为系统时钟源。例如，在智能手表锁屏的情况下，如果使用PLL配置过后输出的频率会造成过多的功耗，降低自身的续航能力；同时要维持计步与测量心率功能。因此，PLL在锁屏下的应用场景并不合适，在保证功能实现的前提下，尽可能降低功耗，可以切换频率更低的时钟源提供给系统时钟。</p> 
<p>​ <img src="https://images2.imgbox.com/34/5d/Gmycy0Wl_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/08/96/iNkc09kD_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/38/64/xueJyTsx_o.png" alt="在这里插入图片描述"></p> 
<p>1.选择PLL作为系统时钟源</p> 
<pre><code class="prism language-c"> RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token punctuation">(</span>RCC_CFGR_SW<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">|=</span> RCC_CFGR_SW_PLL<span class="token punctuation">;</span>	               
</code></pre> 
<p>2.选择HSI作为系统时钟源</p> 
<pre><code class="prism language-c">RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token punctuation">(</span>RCC_CFGR_SW<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">|=</span> RCC_CFGR_SW_HSI<span class="token punctuation">;</span>	               
</code></pre> 
<p>3.选择HSE作为系统时钟源</p> 
<pre><code class="prism language-c">RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token punctuation">(</span>RCC_CFGR_SW<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
RCC<span class="token operator">-&gt;</span>CFGR <span class="token operator">|=</span> RCC_CFGR_SW_HSE<span class="token punctuation">;</span>               
</code></pre> 
<p><img src="https://images2.imgbox.com/db/a0/bOe7YICm_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_314"></a>练习：</h6> 
<pre><code class="prism language-c">在代码当中添加时钟源切换功能（支持 HSI、 HSE、 PLL）， 观察流水灯运行速度的变化。
</code></pre> 
<p><strong>五、应用场景</strong></p> 
<p>调节 CPU 的运行频率，来控制系统的性能与功耗。比较典型的例子就是说手机/笔记本电脑都有高性能模式、平衡模式、低性能模式。</p> 
<p>​ <img src="https://images2.imgbox.com/00/ec/u429mSIB_o.png" alt="在这里插入图片描述"></p> 
<p>​ <img src="https://images2.imgbox.com/3c/e6/S4gwwQ4f_o.png" alt="在这里插入图片描述"></p> 
<p>I</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a9b44ebea1a11d8b4600d215045e0a62/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【网络】数据链路层-MAC帧</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e54dc5d945bbcc04a0091da601cb5672/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">获取服务器时间</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>