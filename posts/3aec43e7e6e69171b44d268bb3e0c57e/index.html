<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>扩散模型（Diffusion model）代码详细解读 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3aec43e7e6e69171b44d268bb3e0c57e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="扩散模型（Diffusion model）代码详细解读">
  <meta property="og:description" content="扩散模型代码详细解读 代码地址：denoising-diffusion-pytorch/denoising_diffusion_pytorch.py at main · lucidrains/denoising-diffusion-pytorch (github.com)
前向过程和后向过程的代码都在GaussianDiffusion​这个类中。​
有问题可以一起讨论！
常见问题解决 Why self-conditioning? · Issue #94 · lucidrains/denoising-diffusion-pytorch (github.com)
&#34;pred_x0&#34; preforms better than &#34;pred_noise&#34; · Issue #58 · lucidrains/denoising-diffusion-pytorch (github.com)
What is objective=pred_x0 and how do you use it? · Issue #34 · lucidrains/denoising-diffusion-pytorch (github.com)
Conditional generation · Issue #7 · lucidrains/denoising-diffusion-pytorch (github.com)
Questions About DDPM · Issue #10 · lucidrains/denoising-diffusion-pytorch (github.com)
The difference between pred_x0, pred_v, pred_noise three objectives · Issue #153 · lucidrains/denoising-diffusion-pytorch (github.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-01T20:39:06+08:00">
    <meta property="article:modified_time" content="2024-03-01T20:39:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">扩散模型（Diffusion model）代码详细解读</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>扩散模型代码详细解读</h2> 
<p>代码地址：<a href="https://github.com/lucidrains/denoising-diffusion-pytorch/blob/main/denoising_diffusion_pytorch/denoising_diffusion_pytorch.py">denoising-diffusion-pytorch/denoising_diffusion_pytorch.py at main · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<p>前向过程和后向过程的代码都在<code>GaussianDiffusion</code>​这个类中。​</p> 
<p>有问题可以一起讨论！</p> 
<h3><a id="_7"></a>常见问题解决</h3> 
<p><a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/94">Why self-conditioning? · Issue #94 · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<p><a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/58">"pred_x0" preforms better than "pred_noise" · Issue #58 · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<p><a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/34">What is <code>objective=pred_x0</code> and how do you use it? · Issue #34 · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<p><a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/7">Conditional generation · Issue #7 · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<p><a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/10">Questions About DDPM · Issue #10 · lucidrains/denoising-diffusion-pytorch (github.com)</a><br> <a href="https://github.com/lucidrains/denoising-diffusion-pytorch/issues/153">The difference between pred_x0, pred_v, pred_noise three objectives · Issue #153 · lucidrains/denoising-diffusion-pytorch (github.com)</a></p> 
<h3><a id="_20"></a>前向训练过程</h3> 
<h4><a id="p_losses_22"></a>p_losses</h4> 
<p>首先是p_losses函数，这个是训练过程的主体部分。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">p_losses</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_start<span class="token punctuation">,</span> t<span class="token punctuation">,</span> noise <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> h<span class="token punctuation">,</span> w <span class="token operator">=</span> x_start<span class="token punctuation">.</span>shape
	<span class="token comment"># 首先随机生成噪声</span>
        noise <span class="token operator">=</span> default<span class="token punctuation">(</span>noise<span class="token punctuation">,</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>x_start<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># noise sample</span>
	<span class="token comment"># 噪声采样,注意这个是一次性完成的</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>q_sample<span class="token punctuation">(</span>x_start <span class="token operator">=</span> x_start<span class="token punctuation">,</span> t <span class="token operator">=</span> t<span class="token punctuation">,</span> noise <span class="token operator">=</span> noise<span class="token punctuation">)</span>

        <span class="token comment"># if doing self-conditioning, 50% of the time, predict x_start from current set of times</span>
        <span class="token comment"># and condition with unet with that</span>
        <span class="token comment"># this technique will slow down training by 25%, but seems to lower FID significantly</span>

	<span class="token comment"># 判断是否进行self-condition,就是利用前面步骤预测出的x0来辅助当前的预测</span>
        x_self_cond <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>self_condition <span class="token keyword">and</span> random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                x_self_cond <span class="token operator">=</span> self<span class="token punctuation">.</span>model_predictions<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">.</span>pred_x_start
                x_self_cond<span class="token punctuation">.</span>detach_<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># predict and take gradient step</span>

	<span class="token comment"># 将采样的x和self condition的x一起输入到model当中,这个model是UNet结构</span>
        model_out <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_self_cond<span class="token punctuation">)</span>
	<span class="token comment"># 模型预测的目标，分为三种</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_noise'</span><span class="token punctuation">:</span>
            target <span class="token operator">=</span> noise
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_x0'</span><span class="token punctuation">:</span>
            target <span class="token operator">=</span> x_start
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_v'</span><span class="token punctuation">:</span>
            v <span class="token operator">=</span> self<span class="token punctuation">.</span>predict_v<span class="token punctuation">(</span>x_start<span class="token punctuation">,</span> t<span class="token punctuation">,</span> noise<span class="token punctuation">)</span>
            target <span class="token operator">=</span> v
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'unknown objective </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>objective<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
	<span class="token comment"># 计算损失</span>
        loss <span class="token operator">=</span> self<span class="token punctuation">.</span>loss_fn<span class="token punctuation">(</span>model_out<span class="token punctuation">,</span> target<span class="token punctuation">,</span> reduction <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">)</span>
        loss <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>loss<span class="token punctuation">,</span> <span class="token string">'b ... -&gt; b (...)'</span><span class="token punctuation">,</span> <span class="token string">'mean'</span><span class="token punctuation">)</span>

        loss <span class="token operator">=</span> loss <span class="token operator">*</span> extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>p2_loss_weight<span class="token punctuation">,</span> t<span class="token punctuation">,</span> loss<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
        <span class="token keyword">return</span> loss<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>对其中的extract函数进行分析，extract函数实现如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_shape<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># Extract some coefficients at specified timesteps,</span>
    <span class="token comment"># then reshape to [batch_size, 1, 1, 1, 1, ...] for broadcasting purposes.</span>
    b<span class="token punctuation">,</span> <span class="token operator">*</span>_ <span class="token operator">=</span> t<span class="token punctuation">.</span>shape
    <span class="token comment"># 使用了gather函数</span>
    out <span class="token operator">=</span> a<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>
    <span class="token keyword">return</span> out<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x_shape<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="q_sample_82"></a>q_sample</h4> 
<p>然后介绍p_losses函数中使用的其他函数，第一个是q_sample函数，它的作用是加上噪声，对应论文的公式：<br> <img src="https://images2.imgbox.com/cb/c9/lo1Y2onD_o.png" alt="在这里插入图片描述"></p> 
<p>其中<code>self.sqrt_alphas_cumprod</code>​和<code>self.sqrt_one_minus_alphas_cumprod</code>​分别是alpha的累乘值和1-alpha的累乘值，x_start相当于x0，noise相当于z。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">q_sample</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_start<span class="token punctuation">,</span> t<span class="token punctuation">,</span> noise<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        noise <span class="token operator">=</span> default<span class="token punctuation">(</span>noise<span class="token punctuation">,</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>x_start<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_start <span class="token operator">+</span>
            extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_one_minus_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> noise
        <span class="token punctuation">)</span>
</code></pre> 
<h4><a id="model_predictions_99"></a>model_predictions</h4> 
<p>然后是model_predictions函数，它的实现如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">model_predictions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_self_cond <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> clip_x_start <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 输入到UNet结构中获得输出</span>
        model_output <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_self_cond<span class="token punctuation">)</span>
        maybe_clip <span class="token operator">=</span> partial<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>clamp<span class="token punctuation">,</span> <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">)</span> <span class="token keyword">if</span> clip_x_start <span class="token keyword">else</span> identity
	<span class="token comment"># 暂不明确它的作用</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_noise'</span><span class="token punctuation">:</span>
            pred_noise <span class="token operator">=</span> model_output
            x_start <span class="token operator">=</span> self<span class="token punctuation">.</span>predict_start_from_noise<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> pred_noise<span class="token punctuation">)</span>
            x_start <span class="token operator">=</span> maybe_clip<span class="token punctuation">(</span>x_start<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_x0'</span><span class="token punctuation">:</span>
            x_start <span class="token operator">=</span> model_output
            x_start <span class="token operator">=</span> maybe_clip<span class="token punctuation">(</span>x_start<span class="token punctuation">)</span>
            pred_noise <span class="token operator">=</span> self<span class="token punctuation">.</span>predict_noise_from_start<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>objective <span class="token operator">==</span> <span class="token string">'pred_v'</span><span class="token punctuation">:</span>
            v <span class="token operator">=</span> model_output
            x_start <span class="token operator">=</span> self<span class="token punctuation">.</span>predict_start_from_v<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
            x_start <span class="token operator">=</span> maybe_clip<span class="token punctuation">(</span>x_start<span class="token punctuation">)</span>
            pred_noise <span class="token operator">=</span> self<span class="token punctuation">.</span>predict_noise_from_start<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">)</span>
	<span class="token comment"># 返回得到的噪声和</span>
        <span class="token keyword">return</span> ModelPrediction<span class="token punctuation">(</span>pred_noise<span class="token punctuation">,</span> x_start<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="objective_128"></a>几种objective</h5> 
<p>model_predictions函数中有一个难点，就是其中的self.objective，它有三种形式：</p> 
<ul><li>pred_noise：这个相当于是预测噪声，此时UNet模型的输出是噪声</li><li>pred_x0：这个相当于是预测最开始的x，此时UNet模型的输出是去噪的图像</li><li>pred_v：这个相当于是预测速度v，它在<a href="https://arxiv.org/pdf/2202.00512v2.pdf" rel="nofollow">这篇文章</a>中提出。然后根据速度求出最开始的x，最后预测出噪声。</li></ul> 
<p>如图所示：​<br> <img src="https://images2.imgbox.com/7f/2f/NXzW1lDG_o.png" alt="在这里插入图片描述"></p> 
<p>在上面的三种objective中，还涉及到了几种预测方法的实现，具体如下：</p> 
<p>（1）predict_start_from_noise：这个函数的作用是根据噪声noise预测最开始的x，也就是去噪的图像。</p> 
<p>其中<code>self.sqrt_recip_alphas_cumprod</code>​和<code>self.sqrt_recipm1_alphas_cumprod</code>​来自<img src="https://images2.imgbox.com/ed/cd/pdJofl3k_o.png" alt="在这里插入图片描述"><br> 公式，它们分别为：<img src="https://images2.imgbox.com/8e/3b/jnYVhdhK_o.png" alt="在这里插入图片描述"><br> 和<img src="https://images2.imgbox.com/96/f1/eiCpXWwG_o.png" alt="在这里插入图片描述"><br> 。</p> 
<p>公式来源文章：<a href="https://proceedings.neurips.cc/paper/2020/file/4c5bcfec8584af0d967f1ab10179ca4b-Paper.pdf" rel="nofollow">DDPM</a></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">predict_start_from_noise</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_t<span class="token punctuation">,</span> t<span class="token punctuation">,</span> noise<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_recip_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_t <span class="token operator">-</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_recipm1_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> noise
    <span class="token punctuation">)</span>
</code></pre> 
<p>它对应论文中的公式如下：<br> <img src="https://images2.imgbox.com/0f/80/eQ1X8heP_o.png" alt="在这里插入图片描述"></p> 
<p>（2）predict_noise_from_start：这个函数的作用是根据图像预测噪声，也就是加噪声。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">predict_noise_from_start</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_t<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x0<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span>extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_recip_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_t <span class="token operator">-</span> x0<span class="token punctuation">)</span> <span class="token operator">/</span> \
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_recipm1_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
</code></pre> 
<p>它对应论文中的公式如下：<br> <img src="https://images2.imgbox.com/fc/93/EbSEGrFB_o.png" alt="在这里插入图片描述"><br> 需要注意它是反推过来的，过程如下：</p> 
<p>（3）predict_v：预测速度v</p> 
<pre><code class="prism language-python"> <span class="token keyword">def</span> <span class="token function">predict_v</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_start<span class="token punctuation">,</span> t<span class="token punctuation">,</span> noise<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span>
         extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> noise <span class="token operator">-</span>
         extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_one_minus_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_start<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_start
     <span class="token punctuation">)</span>
</code></pre> 
<p>它对应论文中的公式：<img src="https://images2.imgbox.com/89/3b/U8NWs8RR_o.png" alt="在这里插入图片描述"></p> 
<p>（4）predict_start_from_v：根据速度v预测最初的x，也就是图像</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">predict_start_from_v</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_t<span class="token punctuation">,</span> t<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_t <span class="token operator">-</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>sqrt_one_minus_alphas_cumprod<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> v
    <span class="token punctuation">)</span>
</code></pre> 
<p>它对应论文中的公式如下：<img src="https://images2.imgbox.com/8a/48/ntpw8I4C_o.png" alt="在这里插入图片描述">其中zt相当于xt。</p> 
<h3><a id="_202"></a>后向采样过程</h3> 
<h4><a id="sample_204"></a>sample函数</h4> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">sample</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span> return_all_timesteps <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    image_size<span class="token punctuation">,</span> channels <span class="token operator">=</span> self<span class="token punctuation">.</span>image_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>channels
    <span class="token comment"># 采样的函数</span>
    sample_fn <span class="token operator">=</span> self<span class="token punctuation">.</span>p_sample_loop <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>is_ddim_sampling <span class="token keyword">else</span> self<span class="token punctuation">.</span>ddim_sample
    <span class="token comment"># 调用该函数</span>
    <span class="token keyword">return</span> sample_fn<span class="token punctuation">(</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> channels<span class="token punctuation">,</span> image_size<span class="token punctuation">,</span> image_size<span class="token punctuation">)</span><span class="token punctuation">,</span> return_all_timesteps <span class="token operator">=</span> return_all_timesteps<span class="token punctuation">)</span>
</code></pre> 
<p>该函数的作用是获取采样的函数然后进行调用，采样函数分成两种：p_sample_loop和ddim_sample。</p> 
<h4><a id="p_sample_loop_218"></a>p_sample_loop函数</h4> 
<pre><code class="prism language-python"> <span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token keyword">def</span> <span class="token function">p_sample_loop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> shape<span class="token punctuation">,</span> return_all_timesteps <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     batch<span class="token punctuation">,</span> device <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>betas<span class="token punctuation">.</span>device
     <span class="token comment"># 随机生成噪声图像</span>
     img <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> device <span class="token operator">=</span> device<span class="token punctuation">)</span>
     imgs <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">]</span>

     x_start <span class="token operator">=</span> <span class="token boolean">None</span>
     <span class="token comment"># 遍历所有的t</span>
     <span class="token keyword">for</span> t <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">reversed</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_timesteps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">'sampling loop time step'</span><span class="token punctuation">,</span> total <span class="token operator">=</span> self<span class="token punctuation">.</span>num_timesteps<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token comment"># 判断是否使用self-condition</span>
	 self_cond <span class="token operator">=</span> x_start <span class="token keyword">if</span> self<span class="token punctuation">.</span>self_condition <span class="token keyword">else</span> <span class="token boolean">None</span>
         <span class="token comment"># 进行采样,得到去噪的图像</span>
         img<span class="token punctuation">,</span> x_start <span class="token operator">=</span> self<span class="token punctuation">.</span>p_sample<span class="token punctuation">(</span>img<span class="token punctuation">,</span> t<span class="token punctuation">,</span> self_cond<span class="token punctuation">)</span>
         imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
     <span class="token comment"># 判断是否返回每个步骤的img还是最后一步的img</span>
     ret <span class="token operator">=</span> img <span class="token keyword">if</span> <span class="token keyword">not</span> return_all_timesteps <span class="token keyword">else</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> dim <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token comment"># 归一化</span>
     ret <span class="token operator">=</span> self<span class="token punctuation">.</span>unnormalize<span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
     <span class="token keyword">return</span> ret
</code></pre> 
<p>其中涉及到归一化函数<code>self.unnormalize</code>​，含有两种</p> 
<pre><code class="prism language-python"><span class="token comment"># normalization functions</span>
<span class="token keyword">def</span> <span class="token function">normalize_to_neg_one_to_one</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> img <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span>
<span class="token keyword">def</span> <span class="token function">unnormalize_to_zero_to_one</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>t <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.5</span>
</code></pre> 
<h5><a id="p_sample_253"></a>p_sample函数</h5> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">p_sample</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> t<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> x_self_cond <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    b<span class="token punctuation">,</span> <span class="token operator">*</span>_<span class="token punctuation">,</span> device <span class="token operator">=</span> <span class="token operator">*</span>x<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> x<span class="token punctuation">.</span>device
    batched_times <span class="token operator">=</span> torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> device <span class="token operator">=</span> x<span class="token punctuation">.</span>device<span class="token punctuation">,</span> dtype <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span>
    <span class="token comment"># 获得平均值,方差和x0</span>
    model_mean<span class="token punctuation">,</span> _<span class="token punctuation">,</span> model_log_variance<span class="token punctuation">,</span> x_start <span class="token operator">=</span> self<span class="token punctuation">.</span>p_mean_variance<span class="token punctuation">(</span>x <span class="token operator">=</span> x<span class="token punctuation">,</span> t <span class="token operator">=</span> batched_times<span class="token punctuation">,</span> x_self_cond <span class="token operator">=</span> x_self_cond<span class="token punctuation">,</span> clip_denoised <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># 随机生成一个噪声	  </span>
    noise <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">if</span> t <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0.</span> <span class="token comment"># no noise if t == 0</span>
    <span class="token comment"># 得到预测的图像,img = 平均值 + exp(0.5 * 方差) * noise</span>
    pred_img <span class="token operator">=</span> model_mean <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">*</span> model_log_variance<span class="token punctuation">)</span><span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> noise
    <span class="token keyword">return</span> pred_img<span class="token punctuation">,</span> x_start
</code></pre> 
<h5><a id="p_mean_variance_269"></a>p_mean_variance函数</h5> 
<p>其中含有<code>p_mean_variance</code>​函数，代码实现如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">p_mean_variance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_self_cond <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> clip_denoised <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 输入到UNet网络进行预测</span>
    preds <span class="token operator">=</span> self<span class="token punctuation">.</span>model_predictions<span class="token punctuation">(</span>x<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_self_cond<span class="token punctuation">)</span>
    <span class="token comment"># 得到预测的x0</span>
    x_start <span class="token operator">=</span> preds<span class="token punctuation">.</span>pred_x_start
    <span class="token comment"># 压缩x0中值的范围至[-1,1]</span>
    <span class="token keyword">if</span> clip_denoised<span class="token punctuation">:</span>
        x_start<span class="token punctuation">.</span>clamp_<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">)</span>
    <span class="token comment"># 得到x0后根据xt和t得到分布的平均值和方差</span>
    model_mean<span class="token punctuation">,</span> posterior_variance<span class="token punctuation">,</span> posterior_log_variance <span class="token operator">=</span> self<span class="token punctuation">.</span>q_posterior<span class="token punctuation">(</span>x_start <span class="token operator">=</span> x_start<span class="token punctuation">,</span> x_t <span class="token operator">=</span> x<span class="token punctuation">,</span> t <span class="token operator">=</span> t<span class="token punctuation">)</span>
    <span class="token keyword">return</span> model_mean<span class="token punctuation">,</span> posterior_variance<span class="token punctuation">,</span> posterior_log_variance<span class="token punctuation">,</span> x_start
</code></pre> 
<h5><a id="q_posterior_287"></a>q_posterior函数</h5> 
<p>其中<code>q_posterior</code>​函数的实现如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">q_posterior</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x_start<span class="token punctuation">,</span> x_t<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 计算平均值</span>
    posterior_mean <span class="token operator">=</span> <span class="token punctuation">(</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>posterior_mean_coef1<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_start <span class="token operator">+</span>
        extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>posterior_mean_coef2<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">*</span> x_t
    <span class="token punctuation">)</span>
    <span class="token comment"># 计算方差</span>
    posterior_variance <span class="token operator">=</span> extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>posterior_variance<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token comment"># 获得一个压缩范围的方差,且取对数</span>
    posterior_log_variance_clipped <span class="token operator">=</span> extract<span class="token punctuation">(</span>self<span class="token punctuation">.</span>posterior_log_variance_clipped<span class="token punctuation">,</span> t<span class="token punctuation">,</span> x_t<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">return</span> posterior_mean<span class="token punctuation">,</span> posterior_variance<span class="token punctuation">,</span> posterior_log_variance_clipped
</code></pre> 
<p>平均值和方差对应的公式如下：</p> 
<p><img src="https://images2.imgbox.com/ee/cb/XOSKiJFv_o.png" alt="在这里插入图片描述"></p> 
<p>其中<code>self.posterior_mean_coef1</code>​对应的是x0前面的系数，<code>self.posterior_mean_coef2</code>​对应的是xt前面的系数。</p> 
<p>​<code>self.posterior_variance</code>​对应的beta那部分的系数。</p> 
<h4><a id="ddim_sample_314"></a>ddim_sample函数</h4> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@torch<span class="token punctuation">.</span>no_grad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">ddim_sample</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> shape<span class="token punctuation">,</span> return_all_timesteps <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    batch<span class="token punctuation">,</span> device<span class="token punctuation">,</span> total_timesteps<span class="token punctuation">,</span> sampling_timesteps<span class="token punctuation">,</span> eta<span class="token punctuation">,</span> objective <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>betas<span class="token punctuation">.</span>device<span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_timesteps<span class="token punctuation">,</span> self<span class="token punctuation">.</span>sampling_timesteps<span class="token punctuation">,</span> self<span class="token punctuation">.</span>ddim_sampling_eta<span class="token punctuation">,</span> self<span class="token punctuation">.</span>objective
    times <span class="token operator">=</span> torch<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> total_timesteps <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> steps <span class="token operator">=</span> sampling_timesteps <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># [-1, 0, 1, 2, ..., T-1] when sampling_timesteps == total_timesteps</span>
    times <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">reversed</span><span class="token punctuation">(</span>times<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    time_pairs <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>times<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> times<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [(T-1, T-2), (T-2, T-3), ..., (1, 0), (0, -1)]</span>
    img <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>shape<span class="token punctuation">,</span> device <span class="token operator">=</span> device<span class="token punctuation">)</span>
    imgs <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">]</span>
    x_start <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> time<span class="token punctuation">,</span> time_next <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span>time_pairs<span class="token punctuation">,</span> desc <span class="token operator">=</span> <span class="token string">'sampling loop time step'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time_cond <span class="token operator">=</span> torch<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">(</span>batch<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">,</span> device <span class="token operator">=</span> device<span class="token punctuation">,</span> dtype <span class="token operator">=</span> torch<span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">)</span>
        self_cond <span class="token operator">=</span> x_start <span class="token keyword">if</span> self<span class="token punctuation">.</span>self_condition <span class="token keyword">else</span> <span class="token boolean">None</span>
        pred_noise<span class="token punctuation">,</span> x_start<span class="token punctuation">,</span> <span class="token operator">*</span>_ <span class="token operator">=</span> self<span class="token punctuation">.</span>model_predictions<span class="token punctuation">(</span>img<span class="token punctuation">,</span> time_cond<span class="token punctuation">,</span> self_cond<span class="token punctuation">,</span> clip_x_start <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token keyword">if</span> time_next <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            img <span class="token operator">=</span> x_start
            <span class="token keyword">continue</span>

        alpha <span class="token operator">=</span> self<span class="token punctuation">.</span>alphas_cumprod<span class="token punctuation">[</span>time<span class="token punctuation">]</span>
        alpha_next <span class="token operator">=</span> self<span class="token punctuation">.</span>alphas_cumprod<span class="token punctuation">[</span>time_next<span class="token punctuation">]</span>
        sigma <span class="token operator">=</span> eta <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha <span class="token operator">/</span> alpha_next<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha_next<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> alpha_next <span class="token operator">-</span> sigma <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span>
        noise <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn_like<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        img <span class="token operator">=</span> x_start <span class="token operator">*</span> alpha_next<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> \
              c <span class="token operator">*</span> pred_noise <span class="token operator">+</span> \
              sigma <span class="token operator">*</span> noise
    ret <span class="token operator">=</span> img <span class="token keyword">if</span> <span class="token keyword">not</span> return_all_timesteps <span class="token keyword">else</span> torch<span class="token punctuation">.</span>stack<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span> dim <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
    ret <span class="token operator">=</span> self<span class="token punctuation">.</span>unnormalize<span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret
</code></pre> 
<p>上面部分依据的公式为：（<a href="https://arxiv.org/pdf/2010.02502.pdf" rel="nofollow">文章</a>）<br> <img src="https://images2.imgbox.com/41/99/N1Nq6nRe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/16/53/TxsXAtxC_o.png" alt="在这里插入图片描述"><br> 对这些函数的功能做一个总结，为：</p> 
<ul><li>q_sample：实现的从x0到xt扩散过程；</li><li>q_posterior_mean_variance：实现的是后验分布的均值和方差的计算公式；</li><li>predict_start_from_noise：q_sample的逆过程，根据预测的噪音来生成；</li><li>p_mean_variance：根据预测的噪音来计算的均值和方差；</li><li>p_sample：单个去噪step；</li><li>p_sample_loop：整个去噪音过程，即生成过程。</li></ul> 
<h3><a id="UNet_358"></a>训练的模型(UNet)</h3> 
<p>后续会继续更新！<br> 对您有帮助请点赞收藏哦！</p> 
<h3><a id="_361"></a>参考文章</h3> 
<p><a href="https://zhuanlan.zhihu.com/p/628093355" rel="nofollow">DDIM模型代码实现</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7869282fc985ba0b443ad361e7a25a5c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GitHub Copilot extension activation error: ‘No access to GitHub Copilot found‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/392c5934c2ef6ffc3c0de3ac718388b2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【LeetCode】力扣刷题攻略路线推荐！适合新手小白入门~（含各类题目序号）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>