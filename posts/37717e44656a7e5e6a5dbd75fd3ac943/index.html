<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C/C&#43;&#43; 常用加密与解密算法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/37717e44656a7e5e6a5dbd75fd3ac943/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C/C&#43;&#43; 常用加密与解密算法">
  <meta property="og:description" content="计算机安全和数据隐私是现代应用程序设计中至关重要的方面。为了确保数据的机密性和完整性，常常需要使用加密和解密算法。C&#43;&#43;是一种广泛使用的编程语言，提供了许多加密和解密算法的实现。本文将介绍一些在C&#43;&#43;中常用的加密与解密算法，这其中包括Xor异或、BASE64、AES、MD5、SHA256、RSA等。
异或加解密 异或（XOR）加密算法是一种基于异或运算的简单且常见的加密技术。在异或加密中，每个位上的值通过与一个密钥位进行异或运算来改变。这种加密算法的简单性和高效性使得它在某些场景下很有用，尤其是对于简单的数据加密需求。
异或运算是一种逻辑运算，其规则如下：
0 XOR 0 = 00 XOR 1 = 11 XOR 0 = 11 XOR 1 = 0 在异或加密中，将明文与密钥进行逐位异或运算。如果明文位和密钥位相同，则结果为0；如果不同，则结果为1。这个过程是可逆的，即可以通过再次异或同样的密钥来还原原始明文。
#include &lt;Windows.h&gt; #include &lt;iostream&gt; using namespace std; // 获取异或整数 long GetXorKey(const char* StrPasswd) { char cCode[32] = { 0 }; strcpy(cCode, StrPasswd); DWORD Xor_Key = 0; for (unsigned int x = 0; x &lt; strlen(cCode); x&#43;&#43;) { Xor_Key = Xor_Key * 4 &#43; cCode[x]; } return Xor_Key; } // 异或为字符串 std::string XorEncrypt(std::string content, std::string secretKey) { for (UINT i = 0; i &lt; content.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-26T11:57:09+08:00">
    <meta property="article:modified_time" content="2023-11-26T11:57:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C/C&#43;&#43; 常用加密与解密算法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>计算机安全和数据隐私是现代应用程序设计中至关重要的方面。为了确保数据的机密性和完整性，常常需要使用加密和解密算法。C++是一种广泛使用的编程语言，提供了许多加密和解密算法的实现。本文将介绍一些在C++中常用的加密与解密算法，这其中包括Xor异或、BASE64、AES、MD5、SHA256、RSA等。</p> 
<h4><a id="_2"></a>异或加解密</h4> 
<p>异或（XOR）加密算法是一种基于异或运算的简单且常见的加密技术。在异或加密中，每个位上的值通过与一个密钥位进行异或运算来改变。这种加密算法的简单性和高效性使得它在某些场景下很有用，尤其是对于简单的数据加密需求。</p> 
<p>异或运算是一种逻辑运算，其规则如下：</p> 
<ul><li>0 XOR 0 = 0</li><li>0 XOR 1 = 1</li><li>1 XOR 0 = 1</li><li>1 XOR 1 = 0</li></ul> 
<p>在异或加密中，将明文与密钥进行逐位异或运算。如果明文位和密钥位相同，则结果为0；如果不同，则结果为1。这个过程是可逆的，即可以通过再次异或同样的密钥来还原原始明文。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

using namespace std<span class="token punctuation">;</span>

<span class="token comment">// 获取异或整数</span>
<span class="token keyword">long</span> <span class="token function">GetXorKey</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> StrPasswd<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> cCode<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>cCode<span class="token punctuation">,</span> StrPasswd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	DWORD Xor_Key <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>cCode<span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Xor_Key <span class="token operator">=</span> Xor_Key <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> cCode<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Xor_Key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 异或为字符串</span>
std<span class="token operator">::</span>string <span class="token function">XorEncrypt</span><span class="token punctuation">(</span>std<span class="token operator">::</span>string content<span class="token punctuation">,</span> std<span class="token operator">::</span>string secretKey<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>UINT i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> content<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		content<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^=</span> secretKey<span class="token punctuation">[</span>i <span class="token operator">%</span> secretKey<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 计算加密密钥</span>
	<span class="token keyword">long</span> ref <span class="token operator">=</span> <span class="token function">GetXorKey</span><span class="token punctuation">(</span><span class="token string">"lyshark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"计算异或密钥: "</span> <span class="token operator">&lt;&lt;</span> ref <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

	<span class="token comment">// 执行异或加密</span>
	<span class="token keyword">char</span> szBuffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello lyshark"</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>szBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		szBuffer<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> szBuffer<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^</span> ref<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"加密后: "</span> <span class="token operator">&lt;&lt;</span> szBuffer<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 直接异或字符串</span>
	std<span class="token operator">::</span>string xor_string <span class="token operator">=</span> <span class="token string">"hello lyshark"</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"加密后: "</span> <span class="token operator">&lt;&lt;</span> <span class="token function">XorEncrypt</span><span class="token punctuation">(</span>xor_string<span class="token punctuation">,</span> <span class="token string">"lyshark"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行后对特定字符串异或处理，如下图；</p> 
<p><img src="https://images2.imgbox.com/c7/e0/hn5S0Lsy_o.png" alt=""></p> 
<h4><a id="BASE64_71"></a>BASE64加解密</h4> 
<p>Base64 是一种常见的编码和解码算法，用于将二进制数据转换成可打印的 ASCII 字符串，以及将这样的字符串还原回二进制数据。Base64 编码是一种将二进制数据表示为 ASCII 字符的方式，广泛应用于数据传输和存储领域。</p> 
<p>Base64 编码基于一组 64 个字符的编码表，通常包括大写字母 A-Z、小写字母 a-z、数字 0-9，以及两个额外的字符 ‘+’ 和 ‘/’。这样的字符集是为了确保编码后的数据是可打印的，并且在不同系统之间可以被准确传输。</p> 
<p>编码的过程如下：</p> 
<ol><li>将待编码的数据划分为每 3 个字节一组（24 位）。</li><li>将每组 3 个字节拆分成 4 个 6 位的块。</li><li>每个 6 位的块对应编码表中的一个字符。</li><li>如果数据长度不是 3 的倍数，使用 ‘=’ 字符进行填充。</li></ol> 
<p>解码的过程是编码的逆过程。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token comment">// base64 转换表, 共64个</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span> base64_alphabet<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
	<span class="token char">'A'</span><span class="token punctuation">,</span> <span class="token char">'B'</span><span class="token punctuation">,</span> <span class="token char">'C'</span><span class="token punctuation">,</span> <span class="token char">'D'</span><span class="token punctuation">,</span> <span class="token char">'E'</span><span class="token punctuation">,</span> <span class="token char">'F'</span><span class="token punctuation">,</span> <span class="token char">'G'</span><span class="token punctuation">,</span>
	<span class="token char">'H'</span><span class="token punctuation">,</span> <span class="token char">'I'</span><span class="token punctuation">,</span> <span class="token char">'J'</span><span class="token punctuation">,</span> <span class="token char">'K'</span><span class="token punctuation">,</span> <span class="token char">'L'</span><span class="token punctuation">,</span> <span class="token char">'M'</span><span class="token punctuation">,</span> <span class="token char">'N'</span><span class="token punctuation">,</span>
	<span class="token char">'O'</span><span class="token punctuation">,</span> <span class="token char">'P'</span><span class="token punctuation">,</span> <span class="token char">'Q'</span><span class="token punctuation">,</span> <span class="token char">'R'</span><span class="token punctuation">,</span> <span class="token char">'S'</span><span class="token punctuation">,</span> <span class="token char">'T'</span><span class="token punctuation">,</span>
	<span class="token char">'U'</span><span class="token punctuation">,</span> <span class="token char">'V'</span><span class="token punctuation">,</span> <span class="token char">'W'</span><span class="token punctuation">,</span> <span class="token char">'X'</span><span class="token punctuation">,</span> <span class="token char">'Y'</span><span class="token punctuation">,</span> <span class="token char">'Z'</span><span class="token punctuation">,</span>
	<span class="token char">'a'</span><span class="token punctuation">,</span> <span class="token char">'b'</span><span class="token punctuation">,</span> <span class="token char">'c'</span><span class="token punctuation">,</span> <span class="token char">'d'</span><span class="token punctuation">,</span> <span class="token char">'e'</span><span class="token punctuation">,</span> <span class="token char">'f'</span><span class="token punctuation">,</span> <span class="token char">'g'</span><span class="token punctuation">,</span>
	<span class="token char">'h'</span><span class="token punctuation">,</span> <span class="token char">'i'</span><span class="token punctuation">,</span> <span class="token char">'j'</span><span class="token punctuation">,</span> <span class="token char">'k'</span><span class="token punctuation">,</span> <span class="token char">'l'</span><span class="token punctuation">,</span> <span class="token char">'m'</span><span class="token punctuation">,</span> <span class="token char">'n'</span><span class="token punctuation">,</span>
	<span class="token char">'o'</span><span class="token punctuation">,</span> <span class="token char">'p'</span><span class="token punctuation">,</span> <span class="token char">'q'</span><span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">,</span> <span class="token char">'s'</span><span class="token punctuation">,</span> <span class="token char">'t'</span><span class="token punctuation">,</span>
	<span class="token char">'u'</span><span class="token punctuation">,</span> <span class="token char">'v'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">,</span> <span class="token char">'x'</span><span class="token punctuation">,</span> <span class="token char">'y'</span><span class="token punctuation">,</span> <span class="token char">'z'</span><span class="token punctuation">,</span>
	<span class="token char">'0'</span><span class="token punctuation">,</span> <span class="token char">'1'</span><span class="token punctuation">,</span> <span class="token char">'2'</span><span class="token punctuation">,</span> <span class="token char">'3'</span><span class="token punctuation">,</span> <span class="token char">'4'</span><span class="token punctuation">,</span> <span class="token char">'5'</span><span class="token punctuation">,</span> <span class="token char">'6'</span><span class="token punctuation">,</span> <span class="token char">'7'</span><span class="token punctuation">,</span> <span class="token char">'8'</span><span class="token punctuation">,</span> <span class="token char">'9'</span><span class="token punctuation">,</span>
	<span class="token char">'+'</span><span class="token punctuation">,</span> <span class="token char">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 解码时使用</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> base64_suffix_map<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">253</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span>
	<span class="token number">52</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">254</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span>
	<span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span>
	<span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span>
	<span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span>
	<span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span>
	<span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> src<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> lnum<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> rnum<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	src <span class="token operator">&lt;&lt;=</span> lnum<span class="token punctuation">;</span> <span class="token comment">// src = src &lt;&lt; lnum;</span>
	src <span class="token operator">&gt;&gt;=</span> rnum<span class="token punctuation">;</span> <span class="token comment">// src = src &gt;&gt; rnum;</span>
	<span class="token keyword">return</span> src<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> indata<span class="token punctuation">,</span> <span class="token keyword">int</span> inlen<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> outdata<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> outlen<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>indata <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> inlen <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 源字符串长度, 如果in_len不是3的倍数, 那么需要补成3的倍数</span>
	<span class="token keyword">int</span> in_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">// 需要补齐的字符个数, 这样只有2, 1, 0(0的话不需要拼接, )</span>
	<span class="token keyword">int</span> pad_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token keyword">if</span> <span class="token punctuation">(</span>inlen <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pad_num <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">-</span> inlen <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 拼接后的长度, 实际编码需要的长度(3的倍数)</span>
	in_len <span class="token operator">=</span> inlen <span class="token operator">+</span> pad_num<span class="token punctuation">;</span>

	<span class="token comment">// 编码后的长度</span>
	<span class="token keyword">int</span> out_len <span class="token operator">=</span> in_len <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">;</span>

	<span class="token comment">// 定义指针指向传出data的首地址</span>
	<span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> outdata<span class="token punctuation">;</span>

	<span class="token comment">//编码, 长度为调整后的长度, 3字节一组</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> in_len<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 将indata第一个字符向右移动2bit(丢弃2bit)</span>
		<span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token operator">*</span>indata <span class="token operator">&gt;&gt;</span> <span class="token number">2</span><span class="token punctuation">;</span>

		<span class="token comment">// 对应base64转换表的字符</span>
		<span class="token keyword">char</span> c <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token comment">// 将对应字符(编码后字符)赋值给outdata第一字节</span>
		<span class="token operator">*</span>p <span class="token operator">=</span> c<span class="token punctuation">;</span>

		<span class="token comment">//处理最后一组(最后3字节)的数据</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> inlen <span class="token operator">+</span> pad_num <span class="token operator">-</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> pad_num <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pad_num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span>indata<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token char">'='</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pad_num <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 编码后的数据要补两个 '='</span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span>indata<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token char">'='</span><span class="token punctuation">;</span>
				<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token char">'='</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 处理正常的3字节的数据</span>
			<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span>indata<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cmove_bits</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token operator">*</span><span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> base64_alphabet<span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">(</span>indata <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		p <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">;</span>
		indata <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>outlen <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token operator">*</span>outlen <span class="token operator">=</span> out_len<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> indata<span class="token punctuation">,</span> <span class="token keyword">int</span> inlen<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> outdata<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">*</span> outlen<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>indata <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> inlen <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> outdata <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> outlen <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>inlen <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 需要解码的数据不是4字节倍数</span>
		<span class="token keyword">return</span> ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>indata<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 需要解码的数据对应的ASCII值对应base64_suffix_map的值</span>
		c <span class="token operator">=</span> base64_suffix_map<span class="token punctuation">[</span>indata<span class="token punctuation">[</span>x<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token comment">// 对应的值不在转码表中</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">255</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

		<span class="token comment">// 对应的值是换行或者回车</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">253</span><span class="token punctuation">)</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">254</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 对应的值是'='</span>
			c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> g<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 将其依次放入一个int型中占3字节</span>
		t <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">|</span> c<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>y <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			outdata<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> outdata<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>t <span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>g <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span> outdata<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>t <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			y <span class="token operator">=</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>outlen <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token operator">*</span>outlen <span class="token operator">=</span> i<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> str1<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello lyshark"</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> str3<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> str2<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token function">base64_encode</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">,</span> str2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"加密后: %s 长度: %d\n"</span><span class="token punctuation">,</span> str2<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">base64_decode</span><span class="token punctuation">(</span>str2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">,</span> str3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"解密后: %s 长度: %d\n"</span><span class="token punctuation">,</span> str3<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行后对特定字符串base64处理，如下图；</p> 
<p><img src="https://images2.imgbox.com/40/14/k0g5mu9d_o.png" alt=""></p> 
<h4><a id="AES_287"></a>AES对称加解密</h4> 
<p>高级加密标准（Advanced Encryption Standard，AES）是一种对称密钥加密算法，广泛用于保护敏感数据的机密性。AES 是一种块密码算法，支持不同的密钥长度（128、192、256 比特），并且在安全性和性能之间取得了很好的平衡。</p> 
<p>AES 操作在固定大小的数据块上进行，每个数据块大小为 128 比特（16 字节）。AES 使用称为轮（rounds）的迭代结构来执行加密和解密。轮数取决于密钥长度，分别为 10 轮（128 比特密钥）、12 轮（192 比特密钥）和 14 轮（256 比特密钥）。AES可使用16、24或32字节密钥(对应128、192和256位)，AES分为ECB和CBC模式，处理的数据必须是块大小16的倍数。</p> 
<p>AES 的基本加密流程包括以下步骤：</p> 
<ol><li><strong>密钥扩展（Key Expansion）：</strong> 根据输入密钥生成轮密钥，用于后续的轮函数。</li><li><strong>初始轮（Initial Round）：</strong> 将明文与第一轮密钥进行逐字节的异或操作。</li><li><strong>轮运算（Rounds）：</strong> 重复执行一系列轮函数，每轮包括四个操作：字节替代、行移位、列混淆和轮密钥加。</li><li><strong>最终轮（Final Round）：</strong> 在最后一轮中，省略列混淆步骤。</li></ol> 
<p>AES 的解密过程与加密过程相似，但使用的是逆操作，如逆字节替代、逆行移位、逆列混淆和逆轮密钥加。</p> 
<p><code>CryptAcquireContext</code>函数，用于获取或创建与加密服务提供程序（CSP）相关联的密码学上下文。这个函数的目的是为了建立与加密服务提供程序相关的密码学上下文，使得后续的加密操作可以在这个上下文中进行。</p> 
<p>以下是<code>CryptAcquireContext</code>函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span>
  HCRYPTPROV <span class="token operator">*</span>phProv<span class="token punctuation">,</span>
  LPCTSTR    pszContainer<span class="token punctuation">,</span>
  LPCTSTR    pszProvider<span class="token punctuation">,</span>
  DWORD      dwProvType<span class="token punctuation">,</span>
  DWORD      dwFlags
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>phProv</code>: 一个指向<code>HCRYPTPROV</code>类型的指针，用于接收密码学上下文的句柄。</li><li><code>pszContainer</code>: 字符串，指定与密钥集关联的容器名称。可以为<code>NULL</code>，表示不使用容器。</li><li><code>pszProvider</code>: 字符串，指定要使用的CSP的名称。如果为<code>NULL</code>，将使用默认的提供程序。</li><li><code>dwProvType</code>: 指定CSP的类型。例如，<code>PROV_RSA_FULL</code>表示使用RSA算法的提供程序。</li><li><code>dwFlags</code>: 指定标志，控制函数的行为。例如，<code>CRYPT_VERIFYCONTEXT</code>表示验证上下文，而不是尝试使用特定的密钥。</li></ul> 
<p><code>CryptCreateHash</code> 函数，用于创建一个与密码学上下文相关联的哈希对象。哈希对象可用于计算数据的哈希值，常用于数字签名、数据完整性验证等安全操作。</p> 
<p>以下是<code>CryptCreateHash</code>函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptCreateHash</span><span class="token punctuation">(</span>
  HCRYPTPROV hProv<span class="token punctuation">,</span>
  ALG_ID     Algid<span class="token punctuation">,</span>
  HCRYPTKEY  hKey<span class="token punctuation">,</span>
  DWORD      dwFlags<span class="token punctuation">,</span>
  HCRYPTHASH <span class="token operator">*</span>phHash
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hProv</code>: 与哈希对象关联的密码学上下文的句柄。</li><li><code>Algid</code>: 哈希算法的标识，例如<code>CALG_MD5</code>表示MD5算法。</li><li><code>hKey</code>: 与哈希对象关联的密钥。在哈希计算中，通常不需要密钥，因此可以将其设为<code>NULL</code>。</li><li><code>dwFlags</code>: 控制函数的行为的标志。一般设为0。</li><li><code>phHash</code>: 一个指向<code>HCRYPTHASH</code>类型的指针，用于接收哈希对象的句柄。</li></ul> 
<p>成功调用该函数后，<code>phHash</code>将包含一个指向新创建的哈希对象的句柄，该对象与指定的密码学上下文和哈希算法相关联。</p> 
<p><code>CryptHashData</code>函数，用于将数据添加到哈希对象中，从而更新哈希值。它常用于在计算数字签名或验证数据完整性时，逐步处理数据块并更新哈希值。</p> 
<p>以下是<code>CryptHashData</code>函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptHashData</span><span class="token punctuation">(</span>
  HCRYPTHASH hHash<span class="token punctuation">,</span>
  <span class="token keyword">const</span> BYTE <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD      dwDataLen<span class="token punctuation">,</span>
  DWORD      dwFlags
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hHash</code>: 指向哈希对象的句柄。</li><li><code>pbData</code>: 指向包含要添加到哈希对象的数据的缓冲区的指针。</li><li><code>dwDataLen</code>: 数据缓冲区的字节数。</li><li><code>dwFlags</code>: 控制函数的行为的标志。一般设为0。</li></ul> 
<p>成功调用后，哈希对象的状态将被更新以反映已添加的数据，从而计算新的哈希值。这使得可以逐步处理大型数据，而不需要将整个数据加载到内存中。</p> 
<p><code>CryptDeriveKey</code> 函数，用于从一个密码导出密钥。这个函数通常用于从用户提供的密码生成对称密钥，这样就可以用于加密或解密数据。</p> 
<p>以下是 <code>CryptDeriveKey</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptDeriveKey</span><span class="token punctuation">(</span>
  HCRYPTPROV hProv<span class="token punctuation">,</span>
  ALG_ID     Algid<span class="token punctuation">,</span>
  HCRYPTHASH hBaseData<span class="token punctuation">,</span>
  DWORD      dwFlags<span class="token punctuation">,</span>
  HCRYPTKEY  <span class="token operator">*</span>phKey
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hProv</code>: 一个有效的 CSP（Cryptographic Service Provider）句柄。</li><li><code>Algid</code>: 密钥算法标识符，指定要创建的密钥类型。</li><li><code>hBaseData</code>: 与密钥生成相关的基本数据的哈希对象的句柄。可以为 <code>NULL</code>。</li><li><code>dwFlags</code>: 控制函数的行为的标志。一般设为 0。</li><li><code>phKey</code>: 指向 HCRYPTKEY 类型的指针，用于接收生成的密钥的句柄。</li></ul> 
<p>成功调用后，<code>phKey</code> 将包含一个新的密钥句柄，可以用于后续的加密和解密操作。密钥的具体属性（比如大小）由 <code>Algid</code> 参数决定。</p> 
<p><code>CryptEncrypt</code> 函数，用于对数据进行加密。这个函数通常用于加密一个数据块，例如一个文件或一个消息。</p> 
<p>以下是 <code>CryptEncrypt</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptEncrypt</span><span class="token punctuation">(</span>
  HCRYPTKEY hKey<span class="token punctuation">,</span>
  HCRYPTHASH hHash<span class="token punctuation">,</span>
  BOOL      Final<span class="token punctuation">,</span>
  DWORD     dwFlags<span class="token punctuation">,</span>
  BYTE      <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD     <span class="token operator">*</span>pdwDataLen<span class="token punctuation">,</span>
  DWORD     dwBufLen
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hKey</code>: 用于加密数据的密钥的句柄。</li><li><code>hHash</code>: 句柄，指定一个哈希对象。对称算法不需要哈希，因此可以为 <code>NULL</code>。</li><li><code>Final</code>: 指定是否是最后一个数据块。如果是最后一个数据块，将设置为 <code>TRUE</code>。</li><li><code>dwFlags</code>: 控制函数的行为的标志。一般设为 0。</li><li><code>pbData</code>: 指向要加密的数据的指针。</li><li><code>pdwDataLen</code>: 指向一个变量，用于输入数据的大小，输出加密后数据的大小。</li><li><code>dwBufLen</code>: 缓冲区的大小。</li></ul> 
<p>成功调用后，<code>pbData</code> 将包含加密后的数据。<code>pdwDataLen</code> 将包含加密后数据的实际大小。</p> 
<p><code>CryptDecrypt</code> 函数，用于对数据进行解密。这个函数通常用于解密一个数据块，例如一个文件或一个消息。</p> 
<p>以下是 <code>CryptDecrypt</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptDecrypt</span><span class="token punctuation">(</span>
  HCRYPTKEY hKey<span class="token punctuation">,</span>
  HCRYPTHASH hHash<span class="token punctuation">,</span>
  BOOL      Final<span class="token punctuation">,</span>
  DWORD     dwFlags<span class="token punctuation">,</span>
  BYTE      <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD     <span class="token operator">*</span>pdwDataLen
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hKey</code>: 用于解密数据的密钥的句柄。</li><li><code>hHash</code>: 句柄，指定一个哈希对象。对称算法不需要哈希，因此可以为 <code>NULL</code>。</li><li><code>Final</code>: 指定是否是最后一个数据块。如果是最后一个数据块，将设置为 <code>TRUE</code>。</li><li><code>dwFlags</code>: 控制函数的行为的标志。一般设为 0。</li><li><code>pbData</code>: 指向要解密的数据的指针。</li><li><code>pdwDataLen</code>: 指向一个变量，用于输入解密前数据的大小，输出解密后数据的大小。</li></ul> 
<p>成功调用后，<code>pbData</code> 将包含解密后的数据。<code>pdwDataLen</code> 将包含解密后数据的实际大小。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token comment">// AES加密</span>
BOOL <span class="token function">AesEncrypt</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span> pPassword<span class="token punctuation">,</span> BYTE<span class="token operator">*</span> pData<span class="token punctuation">,</span> DWORD<span class="token operator">&amp;</span> dwDataLength<span class="token punctuation">,</span> DWORD dwBufferLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	BOOL bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
	HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HCRYPTHASH hCryptHash <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HCRYPTKEY hCryptKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD dwPasswordLength <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>pPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_AES<span class="token punctuation">,</span> CRYPT_VERIFYCONTEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptCreateHash</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> CALG_MD5<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptHashData</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">,</span> pPassword<span class="token punctuation">,</span> dwPasswordLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptDeriveKey</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> CALG_AES_128<span class="token punctuation">,</span> hCryptHash<span class="token punctuation">,</span> CRYPT_EXPORTABLE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptEncrypt</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">,</span> dwBufferLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptKey <span class="token operator">||</span> hCryptHash <span class="token operator">||</span> hCryptProv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">CryptDestroyKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// AES解密</span>
BOOL <span class="token function">AesDecrypt</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span> pPassword<span class="token punctuation">,</span> BYTE<span class="token operator">*</span> pData<span class="token punctuation">,</span> DWORD<span class="token operator">&amp;</span> dwDataLength<span class="token punctuation">,</span> DWORD dwBufferLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	BOOL bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
	HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HCRYPTHASH hCryptHash <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HCRYPTKEY hCryptKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD dwPasswordLength <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>pPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_AES<span class="token punctuation">,</span> CRYPT_VERIFYCONTEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptCreateHash</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> CALG_MD5<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptHashData</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">,</span> pPassword<span class="token punctuation">,</span> dwPasswordLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptDeriveKey</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> CALG_AES_128<span class="token punctuation">,</span> hCryptHash<span class="token punctuation">,</span> CRYPT_EXPORTABLE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptDecrypt</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptKey <span class="token operator">||</span> hCryptHash <span class="token operator">||</span> hCryptProv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">CryptDestroyKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	BYTE pData<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	DWORD dwDataLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> Msg <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"hello lyshark"</span><span class="token punctuation">;</span>

	<span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>pData<span class="token punctuation">,</span> Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	dwDataLength <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token operator">::</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>pData<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// AES 加密</span>
	<span class="token function">AesEncrypt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"123321"</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"AES 加密长度: %d 加密后: %s \n"</span><span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> pData<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// AES 解密</span>
	<span class="token function">AesDecrypt</span><span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token string">"123321"</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> MAX_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"AES 解密长度: %d 解密后: %s \n"</span><span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> pData<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码运行，实现对特定字符串<code>hello lyshark</code>加密，并使用密码<code>123321</code>，如下图所示；</p> 
<p><img src="https://images2.imgbox.com/d2/c6/rfiWu2AR_o.png" alt=""></p> 
<h4><a id="MD5SHA256_519"></a>MD5/SHA256单向加解密</h4> 
<p>MD5（Message Digest Algorithm 5）是一种广泛使用的哈希函数，常用于生成数据的数字签名。MD5 产生的哈希值（摘要）通常是一个 128 位的十六进制数字，通常表示为 32 个字符。尽管 MD5 在过去广泛用于校验文件完整性和生成密码散列，但由于其容易受到碰撞攻击的影响，现在已被更安全的哈希算法如 SHA-256 取代。</p> 
<p>MD5 是一种不可逆的哈希函数，其核心原理包括以下几步：</p> 
<ol><li><strong>填充：</strong> 对输入数据进行填充，使其长度满足 512 位的倍数，并在数据尾部附加原始数据长度的二进制表示。</li><li><strong>初始化：</strong> 初始化 128 位的缓冲区，用于存储中间计算结果。</li><li><strong>处理块：</strong> 将填充后的数据按照 512 位的块进行划分，每个块进行一系列的运算，更新缓冲区。</li><li><strong>输出：</strong> 将最终得到的缓冲区内容作为 MD5 的输出。</li></ol> 
<p>MD5 的核心操作主要包括四轮循环，每轮循环包含 16 次操作。这些操作涉及位运算、逻辑运算和模运算等，以及对缓冲区内容的不断更新。</p> 
<p>SHA-256（Secure Hash Algorithm 256-bit）是 SHA-2 家族中的一员，是一种广泛使用的密码哈希函数。SHA-256 生成的哈希值长度为 256 位，通常以 64 个字符的十六进制字符串表示。SHA-256 在密码学和数据完整性验证中得到广泛应用，被认为是一种安全可靠的哈希算法。</p> 
<p>SHA-256 的基本原理与 MD5 类似，但具有更复杂的设计和更长的输出长度。其核心过程包括以下几个步骤：</p> 
<ol><li><strong>填充：</strong> 将输入数据填充到满足 512 位块大小的倍数，并在数据尾部添加原始数据长度的二进制表示。</li><li><strong>初始化：</strong> 初始化 256 位的缓冲区，用于存储中间计算结果。</li><li><strong>处理块：</strong> 将填充后的数据按照 512 位的块进行划分，每个块进行一系列的运算，更新缓冲区。</li><li><strong>输出：</strong> 将最终得到的缓冲区内容作为 SHA-256 的输出。</li></ol> 
<p>SHA-256 的核心操作包括四轮循环，每轮循环包含 64 次操作。这些操作包括位运算、逻辑运算、模运算等，以及对缓冲区内容的不断更新。</p> 
<p><code>CryptAcquireContext</code> 函数，用于获取密码学上下文句柄。这个函数通常是在进行加密和解密操作之前调用的第一步。</p> 
<p>以下是 <code>CryptAcquireContext</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span>
  HCRYPTPROV <span class="token operator">*</span>phProv<span class="token punctuation">,</span>
  LPCTSTR    pszContainer<span class="token punctuation">,</span>
  LPCTSTR    pszProvider<span class="token punctuation">,</span>
  DWORD      dwProvType<span class="token punctuation">,</span>
  DWORD      dwFlags
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>phProv</code>: 用于接收密码学上下文句柄的指针。</li><li><code>pszContainer</code>: 指定密钥容器的名称。可以为 <code>NULL</code>。</li><li><code>pszProvider</code>: 指定加密服务提供者的名称。可以为 <code>NULL</code>。</li><li><code>dwProvType</code>: 指定提供者类型。常见的类型包括 <code>PROV_RSA_FULL</code>、<code>PROV_RSA_AES</code> 等。</li><li><code>dwFlags</code>: 控制函数的行为的标志。通常为 0。</li></ul> 
<p>成功调用后，<code>phProv</code> 将包含一个密码学上下文句柄，该句柄用于后续的加密和解密操作。</p> 
<p><code>CryptGetHashParam</code> 函数，用于检索哈希对象的参数。哈希对象是用于计算数据摘要的对象，通常在密码学操作中使用。</p> 
<p>以下是 <code>CryptGetHashParam</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptGetHashParam</span><span class="token punctuation">(</span>
  HCRYPTHASH hHash<span class="token punctuation">,</span>
  DWORD      dwParam<span class="token punctuation">,</span>
  BYTE       <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD      <span class="token operator">*</span>pdwDataLen<span class="token punctuation">,</span>
  DWORD      dwFlags
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hHash</code>: 哈希对象的句柄。</li><li><code>dwParam</code>: 指定要检索的参数类型。常见的参数类型包括 <code>HP_HASHVAL</code>（获取哈希值）和 <code>HP_HASHSIZE</code>（获取哈希值的大小）等。</li><li><code>pbData</code>: 用于接收参数数据的缓冲区。</li><li><code>pdwDataLen</code>: 用于指定输入缓冲区的大小，并在成功调用后包含实际返回的数据长度。</li><li><code>dwFlags</code>: 控制函数的行为的标志。通常为 0。</li></ul> 
<p>成功调用后，<code>pbData</code> 缓冲区中将包含请求的参数数据。</p> 
<p><code>CryptDestroyHash</code> 函数，用于销毁哈希对象。哈希对象是在进行哈希计算时创建的对象，使用完毕后需要通过 <code>CryptDestroyHash</code> 来释放相关资源。</p> 
<p>以下是 <code>CryptDestroyHash</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>
  HCRYPTHASH hHash
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hHash</code>: 要销毁的哈希对象的句柄。</li></ul> 
<p>函数返回一个布尔值，表示是否成功销毁哈希对象。如果成功，返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p> 
<p><code>CryptReleaseContext</code> 函数，用于释放密码学上下文。密码学上下文是在进行加密或哈希操作时所创建的，使用完毕后需要通过 <code>CryptReleaseContext</code> 来释放相关资源。</p> 
<p>以下是 <code>CryptReleaseContext</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>
  HCRYPTPROV hProv<span class="token punctuation">,</span>
  DWORD      dwFlags
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hProv</code>: 要释放的密码学上下文的句柄。</li><li><code>dwFlags</code>: 一组标志，通常可以设置为零。</li></ul> 
<p>函数返回一个布尔值，表示是否成功释放密码学上下文。如果成功，返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p> 
<p>这两个算法都是单向加密算法，其可以将一段任意字符串压缩为一个唯一常数。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

BOOL <span class="token function">CalculateHash</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span> pData<span class="token punctuation">,</span> DWORD dwDataLength<span class="token punctuation">,</span> ALG_ID algHashType<span class="token punctuation">,</span> BYTE<span class="token operator">*</span><span class="token operator">*</span> ppHashData<span class="token punctuation">,</span> DWORD<span class="token operator">*</span> pdwHashDataLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HCRYPTHASH hCryptHash <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	BYTE<span class="token operator">*</span> pHashData <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD dwHashDataLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	DWORD dwTemp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	BOOL bRet <span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{<!-- --></span>
		bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_AES<span class="token punctuation">,</span> CRYPT_VERIFYCONTEXT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptCreateHash</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> algHashType<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptHashData</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		dwTemp <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>dwHashDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token function">CryptGetHashParam</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">,</span> HP_HASHSIZE<span class="token punctuation">,</span> <span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dwHashDataLength<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwTemp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pHashData <span class="token operator">=</span> new BYTE<span class="token punctuation">[</span>dwHashDataLength<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">RtlZeroMemory</span><span class="token punctuation">(</span>pHashData<span class="token punctuation">,</span> dwHashDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
		bRet <span class="token operator">=</span> <span class="token operator">::</span><span class="token function">CryptGetHashParam</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">,</span> HP_HASHVAL<span class="token punctuation">,</span> pHashData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwHashDataLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">*</span>ppHashData <span class="token operator">=</span> pHashData<span class="token punctuation">;</span>
		<span class="token operator">*</span>pdwHashDataLength <span class="token operator">=</span> dwHashDataLength<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pHashData<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			delete<span class="token punctuation">[</span><span class="token punctuation">]</span>pHashData<span class="token punctuation">;</span>
			pHashData <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptHash <span class="token operator">||</span> hCryptProv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>hCryptHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> szBuf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello lyshark"</span><span class="token punctuation">;</span>
	BYTE<span class="token operator">*</span> pHashData <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD dwHashDataLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">// MD5</span>
	<span class="token function">CalculateHash</span><span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span><span class="token punctuation">)</span>szBuf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>szBuf<span class="token punctuation">)</span><span class="token punctuation">,</span> CALG_MD5<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pHashData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwHashDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>DWORD x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> dwHashDataLength<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> pHashData<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// SHA256</span>
	<span class="token function">CalculateHash</span><span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span><span class="token punctuation">)</span>szBuf<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>szBuf<span class="token punctuation">)</span><span class="token punctuation">,</span> CALG_SHA_256<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pHashData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwHashDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>DWORD x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> dwHashDataLength<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> pHashData<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	delete<span class="token punctuation">[</span><span class="token punctuation">]</span>pHashData<span class="token punctuation">;</span>
	pHashData <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码运行后，则可以计算出<code>hello lyshark</code>字符串的<code>md5</code>以及<code>sha256</code>摘要信息，如下所示；</p> 
<p><img src="https://images2.imgbox.com/80/7f/u5xZ7Es7_o.png" alt=""></p> 
<h4><a id="RSA_696"></a>RSA对称加解密</h4> 
<p>RSA（Rivest–Shamir–Adleman）是一种非对称加密算法，于1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨米尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）三位密码学家提出。RSA算法基于两个大素数的乘积的难解性问题，它广泛用于安全通信和数字签名等领域。</p> 
<p>RSA算法涉及到两个密钥：公钥和私钥。其中，公钥用于加密，私钥用于解密。其基本原理建立在两个数论问题上：</p> 
<ul><li><strong>大整数分解问题：</strong> 将一个大合数分解为两个质数的乘积的难度。</li><li><strong>欧拉函数和模反演问题：</strong> 利用欧拉函数和模反演性质，确保仅有私钥的持有者能够有效地解密。</li></ul> 
<p>RSA算法的密钥生成过程包括以下步骤：</p> 
<ol><li><strong>选择两个大素数 p 和 q。</strong></li><li><strong>计算 n = pq，n 称为模数。</strong></li><li><strong>计算欧拉函数 φ(n) = (p-1)(q-1)。</strong></li><li><strong>选择公钥 e，满足 1 &lt; e &lt; φ(n)，且 e 与 φ(n) 互质。</strong></li><li><strong>计算私钥 d，使得 de ≡ 1 (mod φ(n))。</strong></li></ol> 
<p>公钥是 (n, e)，私钥是 (n, d)。</p> 
<p>加密和解密过程如下：</p> 
<p><img src="https://images2.imgbox.com/d7/63/NVxaa2gp_o.png" alt=""></p> 
<p>RSA算法的安全性基于大整数分解问题的困难性，即在已知 <em>n</em> 的情况下，要找到 <em>p</em> 和 <em>q</em> 的乘积。当 <em>n</em> 非常大时，这一过程变得非常耗时，使得RSA算法在当前的计算资源下被广泛应用于加密通信和数字签名。</p> 
<p><code>CryptGenKey</code> 是 Windows Cryptographic API (CryptoAPI) 中的一个函数，用于生成密钥。该函数允许应用程序生成对称密钥、非对称密钥对以及用于哈希的密钥。</p> 
<p>以下是 <code>CryptGenKey</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptGenKey</span><span class="token punctuation">(</span>
  HCRYPTPROV hProv<span class="token punctuation">,</span>
  ALG_ID     Algid<span class="token punctuation">,</span>
  DWORD      dwFlags<span class="token punctuation">,</span>
  HCRYPTKEY  <span class="token operator">*</span>phKey
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hProv</code>: 用于生成密钥的密码学服务提供者 (CSP) 的句柄。</li><li><code>Algid</code>: 标识要生成的密钥类型，可以是对称密钥算法、非对称密钥算法或用于哈希的密钥算法。</li><li><code>dwFlags</code>: 控制密钥生成的标志。对于不同的密钥类型，可能有不同的标志。</li><li><code>phKey</code>: 生成的密钥的句柄。</li></ul> 
<p>函数返回一个布尔值，表示是否成功生成密钥。如果成功，返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p> 
<p><code>CryptExportKey</code> 函数是 Windows Cryptographic API (CryptoAPI) 中的一个函数，用于导出密钥的原始或简单 BLOB 格式。密钥 BLOB 包含密钥的完整信息，以便在不同的系统或进程之间传输密钥。</p> 
<p>以下是 <code>CryptExportKey</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptExportKey</span><span class="token punctuation">(</span>
  HCRYPTKEY hKey<span class="token punctuation">,</span>
  HCRYPTKEY hExpKey<span class="token punctuation">,</span>
  DWORD     dwBlobType<span class="token punctuation">,</span>
  DWORD     dwFlags<span class="token punctuation">,</span>
  BYTE      <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD     <span class="token operator">*</span>pdwDataLen
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hKey</code>: 要导出的密钥的句柄。</li><li><code>hExpKey</code>: 导出密钥的密码学服务提供者 (CSP) 句柄。通常，使用与 <code>hKey</code> 相同的 CSP。</li><li><code>dwBlobType</code>: 导出的 BLOB 类型，可以是简单 BLOB 或原始 BLOB。</li><li><code>dwFlags</code>: 导出操作的标志。</li><li><code>pbData</code>: 用于接收导出的密钥 BLOB 的缓冲区。</li><li><code>pdwDataLen</code>: 指向存储密钥 BLOB 大小的变量的指针。在调用函数之前，应将其设置为缓冲区的大小；在调用函数后，它将包含实际写入缓冲区的字节数。</li></ul> 
<p>函数返回一个布尔值，表示是否成功导出密钥。如果成功，返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p> 
<p><code>CryptImportKey</code> 函数是 Windows Cryptographic API (CryptoAPI) 中的一个函数，用于导入密钥的原始或简单 BLOB 格式。该函数通常与 <code>CryptExportKey</code> 函数一起使用，用于在不同的系统或进程之间传输密钥。</p> 
<p>以下是 <code>CryptImportKey</code> 函数的一般格式：</p> 
<pre><code class="prism language-c">BOOL <span class="token function">CryptImportKey</span><span class="token punctuation">(</span>
  HCRYPTPROV hProv<span class="token punctuation">,</span>
  <span class="token keyword">const</span> BYTE <span class="token operator">*</span>pbData<span class="token punctuation">,</span>
  DWORD      dwDataLen<span class="token punctuation">,</span>
  HCRYPTKEY  hPubKey<span class="token punctuation">,</span>
  DWORD      dwFlags<span class="token punctuation">,</span>
  HCRYPTKEY  <span class="token operator">*</span>phKey
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><code>hProv</code>: 密钥将与之关联的密码学服务提供者 (CSP) 的句柄。</li><li><code>pbData</code>: 包含要导入的密钥 BLOB 的缓冲区的指针。</li><li><code>dwDataLen</code>: 密钥 BLOB 的长度（以字节为单位）。</li><li><code>hPubKey</code>: 用于解密密钥 BLOB 的公钥的句柄。</li><li><code>dwFlags</code>: 导入密钥的标志。</li><li><code>phKey</code>: 指向导入的密钥的句柄的指针。</li></ul> 
<p>函数返回一个布尔值，表示是否成功导入密钥。如果成功，返回 <code>TRUE</code>，否则返回 <code>FALSE</code>。</p> 
<p>RSA算法包括公钥与私钥两部，加密时会先使用RSA生成公钥与私钥，然后在进行加密。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

using namespace std<span class="token punctuation">;</span>

<span class="token comment">// 生成公钥和私钥</span>
BOOL <span class="token function">GenerateKey</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span><span class="token operator">*</span>ppPublicKey<span class="token punctuation">,</span> DWORD <span class="token operator">*</span>pdwPublicKeyLength<span class="token punctuation">,</span> BYTE <span class="token operator">*</span><span class="token operator">*</span>ppPrivateKey<span class="token punctuation">,</span> DWORD <span class="token operator">*</span>pdwPrivateKeyLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  BOOL bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
  HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  HCRYPTKEY hCryptKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  BYTE <span class="token operator">*</span>pPublicKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD dwPublicKeyLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  BYTE <span class="token operator">*</span>pPrivateKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD dwPrivateKeyLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">do</span>
  <span class="token punctuation">{<!-- --></span>
    bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_FULL<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptGenKey</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> AT_KEYEXCHANGE<span class="token punctuation">,</span> CRYPT_EXPORTABLE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptExportKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PUBLICKEYBLOB<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPublicKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    pPublicKey <span class="token operator">=</span> new BYTE<span class="token punctuation">[</span>dwPublicKeyLength<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">RtlZeroMemory</span><span class="token punctuation">(</span>pPublicKey<span class="token punctuation">,</span> dwPublicKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptExportKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PUBLICKEYBLOB<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pPublicKey<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPublicKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptExportKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PRIVATEKEYBLOB<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPrivateKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    pPrivateKey <span class="token operator">=</span> new BYTE<span class="token punctuation">[</span>dwPrivateKeyLength<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">RtlZeroMemory</span><span class="token punctuation">(</span>pPrivateKey<span class="token punctuation">,</span> dwPrivateKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptExportKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PRIVATEKEYBLOB<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pPrivateKey<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPrivateKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token operator">*</span>ppPublicKey <span class="token operator">=</span> pPublicKey<span class="token punctuation">;</span>
    <span class="token operator">*</span>pdwPublicKeyLength <span class="token operator">=</span> dwPublicKeyLength<span class="token punctuation">;</span>
    <span class="token operator">*</span>ppPrivateKey <span class="token operator">=</span> pPrivateKey<span class="token punctuation">;</span>
    <span class="token operator">*</span>pdwPrivateKeyLength <span class="token operator">=</span> dwPrivateKeyLength<span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span>
    <span class="token function">CryptDestroyKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptProv<span class="token punctuation">)</span>
    <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 公钥加密数据</span>
BOOL <span class="token function">RsaEncrypt</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span>pPublicKey<span class="token punctuation">,</span> DWORD dwPublicKeyLength<span class="token punctuation">,</span> BYTE <span class="token operator">*</span>pData<span class="token punctuation">,</span> DWORD <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">,</span> DWORD dwBufferLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  BOOL bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
  HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  HCRYPTKEY hCryptKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  <span class="token keyword">do</span>
  <span class="token punctuation">{<!-- --></span>
    bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_FULL<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptImportKey</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> pPublicKey<span class="token punctuation">,</span> dwPublicKeyLength<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptEncrypt</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">,</span> dwBufferLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span>
    <span class="token function">CryptDestroyKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptProv<span class="token punctuation">)</span>
    <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 私钥解密数据</span>
BOOL <span class="token function">RsaDecrypt</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span>pPrivateKey<span class="token punctuation">,</span> DWORD dwProvateKeyLength<span class="token punctuation">,</span> BYTE <span class="token operator">*</span>pData<span class="token punctuation">,</span> DWORD <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  BOOL bRet <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
  HCRYPTPROV hCryptProv <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  HCRYPTKEY hCryptKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  <span class="token keyword">do</span>
  <span class="token punctuation">{<!-- --></span>
    bRet <span class="token operator">=</span> <span class="token function">CryptAcquireContext</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hCryptProv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PROV_RSA_FULL<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptImportKey</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> pPrivateKey<span class="token punctuation">,</span> dwProvateKeyLength<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    bRet <span class="token operator">=</span> <span class="token function">CryptDecrypt</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pData<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>FALSE <span class="token operator">==</span> bRet<span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span>
    <span class="token function">CryptDestroyKey</span><span class="token punctuation">(</span>hCryptKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hCryptProv<span class="token punctuation">)</span>
    <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>hCryptProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bRet<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  BYTE <span class="token operator">*</span>pPublicKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD dwPublicKeyLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  BYTE <span class="token operator">*</span>pPrivateKey <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD dwPrivateKeyLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  BYTE <span class="token operator">*</span>pData <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD dwDataLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  DWORD dwBufferLength <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>

  pData <span class="token operator">=</span> new BYTE<span class="token punctuation">[</span>dwBufferLength<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">RtlZeroMemory</span><span class="token punctuation">(</span>pData<span class="token punctuation">,</span> dwBufferLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">lstrcpy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>pData<span class="token punctuation">,</span> <span class="token string">"hello lyshark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dwDataLength <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">lstrlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>pData<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 输出加密前原始数据</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"加密前原始数据: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwDataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> pData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 生成公钥和私钥</span>
  <span class="token function">GenerateKey</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pPublicKey<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPublicKeyLength<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pPrivateKey<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPrivateKeyLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"公钥: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwPublicKeyLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2x"</span><span class="token punctuation">,</span> pPublicKey<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"私钥: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwPrivateKeyLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2x"</span><span class="token punctuation">,</span> pPrivateKey<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使用公钥加密</span>
  <span class="token function">RsaEncrypt</span><span class="token punctuation">(</span>pPublicKey<span class="token punctuation">,</span> dwPublicKeyLength<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> dwDataLength<span class="token punctuation">,</span> dwBufferLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"公钥加密: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwDataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> pData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使用私钥解密</span>
  <span class="token function">RsaDecrypt</span><span class="token punctuation">(</span>pPrivateKey<span class="token punctuation">,</span> dwPrivateKeyLength<span class="token punctuation">,</span> pData<span class="token punctuation">,</span> dwDataLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"私钥解密: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dwDataLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%x"</span><span class="token punctuation">,</span> pData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  delete<span class="token punctuation">[</span><span class="token punctuation">]</span>pData<span class="token punctuation">;</span>
  delete<span class="token punctuation">[</span><span class="token punctuation">]</span>pPrivateKey<span class="token punctuation">;</span>
  delete<span class="token punctuation">[</span><span class="token punctuation">]</span>pPublicKey<span class="token punctuation">;</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行后生成公钥与私钥，并对字符串加密与解密，如下图所示；</p> 
<p><img src="https://images2.imgbox.com/86/46/otYOZ91d_o.png" alt=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0fe23bc1710b1c08011f98703b09e501/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS7下MySQL-8.1.0 数据库下载及安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bd5f59f03e59bd6749e4d31ecc86e446/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">人工智能入门教学——AI代理（AI Agent）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>