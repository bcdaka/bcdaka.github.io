<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2024年最全金格插件WebOffice2024使用体会(1)，2024年最新面试干货分享 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/473055cba0ec720e97f96c27103e4a61/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="2024年最全金格插件WebOffice2024使用体会(1)，2024年最新面试干货分享">
  <meta property="og:description" content="最后 由于文档内容过多，为了避免影响到大家的阅读体验，在此只以截图展示部分内容
开源分享：【大厂前端面试题解析&#43;核心总结学习笔记&#43;真实项目实战&#43;最新讲解视频】
}
}
this.WebSetMsgByName(“USERNAME”, this.UserName); // 加载UserName
this.WebSetMsgByName(“FILENAME”, this.FileName); // 加载FileName
this.WebSetMsgByName(“FILETYPE”, this.FileType); // 加载FileType
this.WebSetMsgByName(“RECORDID”, this.RecordID); // 加载RecordID
this.WebSetMsgByName(“EDITTYPE”, this.EditType); // 加载RecordID
this.WebSetMsgByName(“OPTION”, “LOADFILE”); // 发送请求LOADFILE
从jsp页面中之前定义属性获取值。
if (this.LOADFILE(httpclient)) // Http下载服务器文件
this.LOADFILE(httpclient))方法从服务器开始下载文件，代码中
this.LOADFILE = function(httpclient)
{
this.Status =
“”;
httpclient.ShowProgressUI =
this.ShowWindow;
this.ConsoleOut(
“ 开始打开链接…”);
if (httpclient.Open(
this.HttpMethod.Post,
this.WebUrl,
false))
// true
// 异步方式
// false同步
{
this.ConsoleOut(
“ 链接打开成功，开始进行数据包发送…”);
// 这里采用异步方式打开文档
if (httpclient.Send()) {
this.ConsoleOut(">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-14T20:19:02+08:00">
    <meta property="article:modified_time" content="2024-05-14T20:19:02+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2024年最全金格插件WebOffice2024使用体会(1)，2024年最新面试干货分享</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_2"></a>最后</h4> 
<p><img src="https://images2.imgbox.com/d2/d2/Xjb205cQ_o.png" alt="前15.PNG"></p> 
<p><img src="https://images2.imgbox.com/5f/06/72oW0JMu_o.png" alt="前16.PNG"></p> 
<blockquote> 
 <p>由于文档内容过多，为了避免影响到大家的阅读体验，在此只以截图展示部分内容</p> 
 <p><strong><a href="https://bbs.csdn.net/forums/4304bb5a486d4c3ab8389e65ecb71ac0">开源分享：【大厂前端面试题解析+核心总结学习笔记+真实项目实战+最新讲解视频】</a></strong></p> 
</blockquote> 
<p>}</p> 
<ol start="37"><li></ol> 
<p>}</p> 
<p>this.WebSetMsgByName(“USERNAME”, this.UserName); // 加载UserName</p> 
<p>this.WebSetMsgByName(“FILENAME”, this.FileName); // 加载FileName</p> 
<p>this.WebSetMsgByName(“FILETYPE”, this.FileType); // 加载FileType</p> 
<p>this.WebSetMsgByName(“RECORDID”, this.RecordID); // 加载RecordID</p> 
<p>this.WebSetMsgByName(“EDITTYPE”, this.EditType); // 加载RecordID</p> 
<p>this.WebSetMsgByName(“OPTION”, “LOADFILE”); // 发送请求LOADFILE</p> 
<p>从jsp页面中之前定义属性获取值。</p> 
<p><code>if (this.LOADFILE(httpclient)) // Http下载服务器文件</code></p> 
<p>this.LOADFILE(httpclient))方法从服务器开始下载文件，代码中</p> 
<ol><li></ol> 
<p>this.LOADFILE = function(httpclient)</p> 
<ol start="2"><li></ol> 
<p>{<!-- --></p> 
<ol start="3"><li></ol> 
<p>this.Status =</p> 
<p>“”;</p> 
<ol start="4"><li></ol> 
<p>httpclient.ShowProgressUI =</p> 
<p>this.ShowWindow;</p> 
<ol start="5"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 开始打开链接…”);</p> 
<ol start="6"><li></ol> 
<p>if (httpclient.Open(</p> 
<p>this.HttpMethod.Post,</p> 
<p>this.WebUrl,</p> 
<p>false))</p> 
<p>// true</p> 
<ol start="7"><li></ol> 
<p>// 异步方式</p> 
<ol start="8"><li></ol> 
<p>// false同步</p> 
<ol start="9"><li></ol> 
<p>{<!-- --></p> 
<ol start="10"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 链接打开成功，开始进行数据包发送…”);</p> 
<ol start="11"><li></ol> 
<p>// 这里采用异步方式打开文档</p> 
<ol start="12"><li></ol> 
<p>if (httpclient.Send()) {<!-- --></p> 
<ol start="13"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 数据包发送成功…状态值：”+httpclient.GetResponseHeader(</p> 
<p>“MsgError”));</p> 
<ol start="14"><li></ol> 
<p>if (httpclient.GetResponseHeader(</p> 
<p>“MsgError”) ==</p> 
<p>“404”) {<!-- --></p> 
<ol start="15"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 后台未找到对应文档，开始创建一个空白文档…”);</p> 
<ol start="16"><li></ol> 
<p>this.CreateFile();</p> 
<ol start="17"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 空白文档创建成功…”);</p> 
<ol start="18"><li></ol> 
<p>this.getOfficeVersion();</p> 
<p>// 打开文档后，判断当前office版本</p> 
<ol start="19"><li></ol> 
<p>httpclient.Clear();</p> 
<ol start="20"><li></ol> 
<p>return</p> 
<p>true;</p> 
<ol start="21"><li></ol> 
<p>}</p> 
<ol start="23"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 开始将后台文档保存到本地…”);</p> 
<ol start="24"><li></ol> 
<p>/*</p> 
<ol start="25"><li></ol> 
<p>* , Math.round(Math.random() * 100000)</p> 
<ol start="26"><li></ol> 
<p>*/</p> 
<ol start="27"><li></ol> 
<p>if (</p> 
<p>this.hiddenSaveLocal(httpclient,</p> 
<p>this,</p> 
<p>false,</p> 
<p>false)) {<!-- --></p> 
<ol start="28"><li></ol> 
<p>var mSaveResult =</p> 
<p>this</p> 
<ol start="29"><li></ol> 
<p>.WebOpenLocalFile(</p> 
<p>this.DownloadedFileTempPathName);</p> 
<ol start="31"><li></ol> 
<p>if (mSaveResult ==</p> 
<ol start="0"><li>{<!-- --></li></ol> 
<p>// 打开本地磁盘文件</p> 
<ol start="32"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 文档打开成功…”);</p> 
<ol start="33"><li></ol> 
<p>this.getOfficeVersion();</p> 
<p>// 打开文档后，判断当前office版本</p> 
<ol start="34"><li></ol> 
<p>return</p> 
<p>true;</p> 
<ol start="35"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>1){<!-- --></p> 
<ol start="36"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“可能当前授权码错误，请确认iWebOffice2015.js的授权是否正确（或乱码）”</p> 
<ol start="37"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="38"><li></ol> 
<p>this.Status =</p> 
<p>“可能当前授权码错误，请确认iWebOffice2015.js的授权是否正确（或乱码）”;</p> 
<ol start="39"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="40"><li></ol> 
<p>window.close();</p> 
<ol start="41"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="42"><li></ol> 
<p>}</p> 
<ol start="43"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>2){<!-- --></p> 
<ol start="44"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“没有找到文档，请确认WebOpenLocalFile打开文档的路径是否正确”</p> 
<ol start="45"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="46"><li></ol> 
<p>this.Status =</p> 
<p>“有找到文档，请确认WebOpenLocalFile打开文档的路径是否正确”;</p> 
<ol start="47"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="48"><li></ol> 
<p>window.close();</p> 
<ol start="49"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="50"><li></ol> 
<p>}</p> 
<ol start="51"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>3){<!-- --></p> 
<ol start="52"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“没有权限导致文档打开失败，请用管理员身份运行浏览器后重试”</p> 
<ol start="53"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="54"><li></ol> 
<p>this.Status =</p> 
<p>“没有权限导致文档打开失败，请用管理员身份运行浏览器后重试”;</p> 
<ol start="55"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="56"><li></ol> 
<p>window.close();</p> 
<ol start="57"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="58"><li></ol> 
<p>}</p> 
<ol start="59"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>4){<!-- --></p> 
<ol start="60"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“文件可能损坏，请确定服务器文档是否已经损坏”</p> 
<ol start="61"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="62"><li></ol> 
<p>this.Status =</p> 
<p>“文件可能损坏，请确定服务器文档是否已经损坏”;</p> 
<ol start="63"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="64"><li></ol> 
<p>window.close();</p> 
<ol start="65"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="66"><li></ol> 
<p>}</p> 
<ol start="67"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>5){<!-- --></p> 
<ol start="68"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“未安装Office或者注册表有损坏”</p> 
<ol start="69"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="70"><li></ol> 
<p>this.Status =</p> 
<p>“未安装Office或者注册表有损坏”;</p> 
<ol start="71"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="72"><li></ol> 
<p>window.close();</p> 
<ol start="73"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="74"><li></ol> 
<p>}</p> 
<ol start="75"><li></ol> 
<p>}</p> 
<p>else</p> 
<p>if(mSaveResult ==</p> 
<p>6){<!-- --></p> 
<ol start="76"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>“文件被占用，请结束Office进程后重试”</p> 
<ol start="77"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="78"><li></ol> 
<p>this.Status =</p> 
<p>“文件被占用，请结束Office进程后重试”;</p> 
<ol start="79"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="80"><li></ol> 
<p>window.close();</p> 
<ol start="81"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="82"><li></ol> 
<p>}</p> 
<ol start="83"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="84"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>" 打开文档时未知错误！错误码为： "</p> 
<ol start="85"><li></ol> 
<ul><li>mSaveResult);</li></ul> 
<ol start="86"><li></ol> 
<p>var windows = window.confirm(</p> 
<p>"打开文档时未知错误！错误码为： "</p> 
<ol start="87"><li></ol> 
<ul><li>mSaveResult</li></ul> 
<ol start="88"><li></ol> 
<ul><li></ul> 
<p>“\r\r单击“确定”关闭。单击“取消”继续。”);</p> 
<ol start="89"><li></ol> 
<p>this.Status =</p> 
<p>"打开文档时未知错误！错误码为： "</p> 
<ol start="90"><li></ol> 
<ul><li>mSaveResult;</li></ul> 
<ol start="91"><li></ol> 
<p>if (windows ==</p> 
<ol><li>{<!-- --></li></ol> 
<ol start="92"><li></ol> 
<p>window.close();</p> 
<ol start="93"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="94"><li></ol> 
<p>}</p> 
<ol start="95"><li></ol> 
<p>}</p> 
<ol start="96"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="97"><li></ol> 
<p>// 失败后，this.Status的值由hiddenSaveLocal返回</p> 
<ol start="98"><li></ol> 
<p>this.Status =</p> 
<p>“保存文档到本地 失败”;</p> 
<ol start="99"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="100"><li></ol> 
<p>}</p> 
<ol start="101"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="102"><li></ol> 
<p>this.Status =</p> 
<p>“数据包发送失败！请检查链接&lt;” +</p> 
<p>this.WebUrl +</p> 
<p>“&gt;是否正确或网络是否畅通。”;</p> 
<ol start="103"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="104"><li></ol> 
<p>}</p> 
<ol start="105"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="106"><li></ol> 
<p>this.Status =</p> 
<p>“打开链接&lt;” +</p> 
<p>this.WebUrl +</p> 
<p>“&gt;失败！请检查网络是否畅通。”;</p> 
<ol start="107"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="108"><li></ol> 
<p>}</p> 
<ol start="109"><li></ol> 
<p>}</p> 
<p>加载文档的原理：采用http请求的方式，采用异步来实现文档加载：if (httpclient.Open(this.HttpMethod.Post, this.WebUrl, false)) // true。第一个参数固定不变，是模拟http的post请求、第二个参数：this.WebUrl内放置的即使我们的后台核心处理类的地址、第三个参数是异步同步的设置；</p> 
<p>加载文档的核心处理类：这里后台文件OfficeServer我们需要按实际业务需求更改一下，这里我直接贴我的代码，由于我们只先说文档打开，所以就只贴一部分代码了，经过http请求响应的核心处理类OfficeServer；</p> 
<p>加载文档的核心处理方法：核心方法是protected void service（）{<!-- --></p> 
<p>}</p> 
<p>方法体：</p> 
<ol><li></ol> 
<p>logger.info(</p> 
<p>“进入service方法”);</p> 
<ol start="2"><li></ol> 
<p>this.mCommand =</p> 
<p>“”;</p> 
<ol start="3"><li></ol> 
<p>this.mFileBody =</p> 
<p>null;</p> 
<ol start="4"><li></ol> 
<p>this.mFilePath = request.getSession().getServletContext().getRealPath(</p> 
<p>“/”);</p> 
<ol start="5"><li></ol> 
<p>try {<!-- --></p> 
<ol start="6"><li></ol> 
<p>if (request.getMethod().equalsIgnoreCase(</p> 
<p>“POST”)) {<!-- --></p> 
<ol start="7"><li></ol> 
<p>this.MsgObj.setSendType(</p> 
<p>“JSON”);</p> 
<ol start="8"><li></ol> 
<p>//文件上传</p> 
<ol start="9"><li></ol> 
<p>this.MsgObj.Load(request);</p> 
<ol start="10"><li></ol> 
<p>this.mOption =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“OPTION”);</p> 
<ol start="11"><li></ol> 
<p>this.mUserName =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“USERNAME”);</p> 
<ol start="13"><li></ol> 
<p>//20190403</p> 
<ol start="14"><li></ol> 
<p>if (</p> 
<p>this.mOption.equalsIgnoreCase(</p> 
<p>“LOADFILE”)) {<!-- --></p> 
<ol start="15"><li></ol> 
<p>//如果是下载模式</p> 
<ol start="16"><li></ol> 
<p>this.mRecordID =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“RECORDID”);</p> 
<ol start="17"><li></ol> 
<p>this.mFileName =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“FILENAME”);</p> 
<ol start="18"><li></ol> 
<p>this.MsgObj.MsgTextClear();</p> 
<ol start="20"><li></ol> 
<p>this.mFilePath =</p> 
<p>this.mFilePath.replace(</p> 
<p>‘\\’,</p> 
<p>‘/’);</p> 
<p>// web跟目录</p> 
<ol start="21"><li></ol> 
<p>this.mFilePath =</p> 
<p>this.mFilePath +</p> 
<p>“upload_files”;</p> 
<ol start="23"><li></ol> 
<p>String finalAdd =mFilePath+</p> 
<p>“/”+mFileName;</p> 
<ol start="25"><li></ol> 
<p>if(MsgObj.MsgFileLoad(finalAdd)){<!-- --></p> 
<ol start="26"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档加载成功”);</p> 
<ol start="27"><li></ol> 
<p>}</p> 
<p>else{<!-- --></p> 
<ol start="28"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档加载失败”);</p> 
<ol start="29"><li></ol> 
<p>}</p> 
<p>代码中 <strong>this.mFilePath即使你tomcat下面的附件文件夹地址</strong></p> 
<p>接下来是 <strong>MsgObj.MsgFileLoad方法</strong></p> 
<ol><li></ol> 
<p>public boolean MsgFileLoad(String fileName) throws IOException</p> 
<ol start="2"><li></ol> 
<p>{<!-- --></p> 
<ol start="3"><li></ol> 
<p>File f =</p> 
<p>new File(fileName);</p> 
<ol start="4"><li></ol> 
<p>if (!f.exists()) {<!-- --></p> 
<ol start="5"><li></ol> 
<p>throw</p> 
<p>new FileNotFoundException(fileName);</p> 
<ol start="6"><li></ol> 
<p>}</p> 
<ol start="8"><li></ol> 
<p>ByteArrayOutputStream bos =</p> 
<p>new ByteArrayOutputStream((</p> 
<p>int)f.length());</p> 
<ol start="9"><li></ol> 
<p>BufferedInputStream in =</p> 
<p>null;</p> 
<ol start="10"><li></ol> 
<p>try {<!-- --></p> 
<ol start="11"><li></ol> 
<p>in =</p> 
<p>new BufferedInputStream(</p> 
<p>new FileInputStream(f));</p> 
<ol start="12"><li></ol> 
<p>int buf_size =</p> 
<p>1024;</p> 
<ol start="13"><li></ol> 
<p>byte[] buffer =</p> 
<p>new</p> 
<p>byte[buf_size];</p> 
<ol start="14"><li></ol> 
<p>int len =</p> 
<p>0;</p> 
<ol start="15"><li></ol> 
<p>while (-</p> 
<p>1 != (len = in.read(buffer,</p> 
<p>0, buf_size))) {<!-- --></p> 
<ol start="16"><li></ol> 
<p>bos.write(buffer,</p> 
<p>0, len);</p> 
<ol start="17"><li></ol> 
<p>}</p> 
<ol start="18"><li></ol> 
<p>this.mFileBody = bos.toByteArray();</p> 
<ol start="19"><li></ol> 
<p>return</p> 
<p>true;</p> 
<ol start="20"><li></ol> 
<p>}</p> 
<p>catch (IOException e) {<!-- --></p> 
<ol start="21"><li></ol> 
<p>e.printStackTrace();</p> 
<ol start="22"><li></ol> 
<p>throw e;</p> 
<ol start="23"><li></ol> 
<p>}</p> 
<p>finally {<!-- --></p> 
<ol start="24"><li></ol> 
<p>try {<!-- --></p> 
<ol start="25"><li></ol> 
<p>in.close();</p> 
<ol start="26"><li></ol> 
<p>}</p> 
<p>catch (IOException e) {<!-- --></p> 
<ol start="27"><li></ol> 
<p>e.printStackTrace();</p> 
<ol start="28"><li></ol> 
<p>}</p> 
<ol start="29"><li></ol> 
<p>bos.close();</p> 
<ol start="30"><li></ol> 
<p>}</p> 
<ol start="31"><li></ol> 
<p>}</p> 
<p>我们不需要修改什么地方。直接引用官网给的demo就行。</p> 
<p>总结：</p> 
<p>===</p> 
<p>一：js文件</p> 
<p>1.1 页面中需要引入的属性设置</p> 
<p>二：核心处理类</p> 
<p>2.后台文件需要修改的只是将 <strong>this.mFilePath 定义为自己的tomcat附件的文件夹地址</strong></p> 
<p>成果展示</p> 
<hr> 
<p><img src="https://images2.imgbox.com/aa/32/YymRwdn6_o.png" alt="页面展示"></p> 
<p>页面展示</p> 
<p>左上角根据实际业务需求，只开放了打开文档（打开文档之前提过，页面初始化，带着提前准备的参数，已经打开）、保存到服务器两个功能。</p> 
<hr> 
<p><strong>打开文档之后，可以在线编辑文档，word自己带的功能，在这里全部都适用，这点不用担心。</strong></p> 
<p><strong>修改文档之后就开始保存了，接下来就是保存文档的正题。</strong></p> 
<hr> 
<p>4.2 在线编辑以及服务器保存实现</p> 
<hr> 
<p>老样子，直接贴代码</p> 
<p><strong>OpenAndSave_Word.jsp</strong>中</p> 
<ol><li></ol> 
<p>//保存文档</p> 
<ol start="2"><li></ol> 
<p>function</p> 
<p>SaveDocument() {<!-- --></p> 
<ol start="3"><li></ol> 
<p>if (WebOfficeObj.WebSave()) {<!-- --></p> 
<p>//交互OfficeServer的OPTION=“SAVEFILE”</p> 
<ol start="4"><li></ol> 
<p>WebOfficeObj</p> 
<p>.WebClose();</p> 
<ol start="5"><li></ol> 
<p>window</p> 
<p>.close();</p> 
<ol start="6"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="7"><li></ol> 
<p>alert(WebOfficeObj.Status);</p> 
<ol start="8"><li></ol> 
<p>StatusMsg(WebOfficeObj.Status);</p> 
<ol start="9"><li></ol> 
<p>}</p> 
<ol start="10"><li></ol> 
<p>}</p> 
<p><strong>WebOffice.js</strong>中</p> 
<p>处理方法：</p> 
<p>方法体：</p> 
<ol start="2"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 保存文件…”);</p> 
<ol start="3"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 开始…”);</p> 
<ol start="4"><li></ol> 
<p>this.Status =</p> 
<p>“”;</p> 
<ol start="5"><li></ol> 
<p>var httpclient =</p> 
<p>this.obj.Http;</p> 
<p>// 设置http对象</p> 
<ol start="6"><li></ol> 
<p>httpclient.Clear();</p> 
<ol start="7"><li></ol> 
<p>//一如既往，这里是属性赋值</p> 
<ol start="8"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“USERNAME”,</p> 
<p>this.UserName);</p> 
<ol start="9"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“RECORDID”,</p> 
<p>this.RecordID);</p> 
<ol start="10"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“TEMPLATE”,</p> 
<p>this.Template);</p> 
<ol start="11"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“SUBJECT”,</p> 
<p>this.Subject);</p> 
<ol start="12"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“AUTHOR”,</p> 
<p>this.Author);</p> 
<ol start="13"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“HTMLPATH”,</p> 
<p>this.HTMLPath);</p> 
<ol start="14"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“FILETYPE”,</p> 
<p>this.FileType);</p> 
<ol start="15"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“OPTION”,</p> 
<p>“SAVEFILE”);</p> 
<ol start="16"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“FILENAME”,</p> 
<p>this.FileName);</p> 
<p>// 加载FileName</p> 
<ol start="18"><li></ol> 
<p>//判断是否保存空文档的方法</p> 
<ol start="19"><li></ol> 
<p>if(</p> 
<p>this.WebSetAllowEmpty()){<!-- --></p> 
<ol start="20"><li></ol> 
<p>//文档保存到本地</p> 
<ol start="21"><li></ol> 
<p>var mSaveResult =</p> 
<p>this.WebSaveLocalFile(</p> 
<p>this.getFilePath()</p> 
<ol start="22"><li></ol> 
<ul><li></ul> 
<p>this.FileName);</p> 
<ol start="23"><li></ol> 
<p>if (!(mSaveResult ==</p> 
<p>0)) {<!-- --></p> 
<ol start="24"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 保存本地文档失败！错误代码为：” + mSaveResult);</p> 
<ol start="25"><li></ol> 
<p>this.Status =</p> 
<p>“保存本地文档失败！错误代码为：” + mSaveResult;</p> 
<ol start="26"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="27"><li></ol> 
<p>}</p> 
<ol start="28"><li></ol> 
<p>}</p> 
<p>else{<!-- --></p> 
<ol start="29"><li></ol> 
<p>alert(</p> 
<p>“文档没有内容，是否确定保存”);</p> 
<ol start="30"><li></ol> 
<p>}</p> 
<ol start="31"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 将文档保存到本地成功…”);</p> 
<ol start="32"><li></ol> 
<p>this.sendMode =</p> 
<p>“SaveFile”;</p> 
<ol start="33"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 开始将文档保存到服务器…”);</p> 
<ol start="34"><li></ol> 
<p>// 判断本地文件是否大于指定的文件大小，如果大于不保存</p> 
<ol start="35"><li></ol> 
<p>if (</p> 
<p>this.WebSetMaxFileSize(</p> 
<p>this.FilePath +</p> 
<p>this.FileName)) {<!-- --></p> 
<ol start="36"><li></ol> 
<p>//这里需要将这个值传递到后台</p> 
<ol start="37"><li></ol> 
<p>var add =</p> 
<p>this.FilePath +</p> 
<p>this.FileName;</p> 
<ol start="38"><li></ol> 
<p>//这里需要将本地隐藏目录传递到后台。如果单一传递路径，json编译会出错，需要修改一下</p> 
<ol start="39"><li></ol> 
<p>//var add = add.replace(“\\”,“\\\\”);</p> 
<ol start="41"><li></ol> 
<p>var arrayStr = add.split(</p> 
<p>“\\”);</p> 
<ol start="42"><li></ol> 
<p>this.WebSetMsgByName(</p> 
<p>“FILEPATH”,arrayStr);</p> 
<ol start="43"><li></ol> 
<p>//开始保存到服务器了</p> 
<ol start="44"><li></ol> 
<p>if (</p> 
<p>this.SAVEFILE(httpclient,</p> 
<p>this.FilePath +</p> 
<p>this.FileName)) {<!-- --></p> 
<ol start="45"><li></ol> 
<p>this.ConsoleOut(</p> 
<p>“ 成功将文档保存到服务器…”);</p> 
<ol start="46"><li></ol> 
<p>var ISO = httpclient.GetResponseHeader(</p> 
<p>“ISO”);</p> 
<p>// 获取返回值</p> 
<ol start="47"><li></ol> 
<p>this.Status =</p> 
<p>“成功将文档保存到服务器”;</p> 
<ol start="48"><li></ol> 
<p>return</p> 
<p>true;</p> 
<ol start="49"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="50"><li></ol> 
<p>//STATUS 由this.SAVEFILE返回</p> 
<ol start="51"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="52"><li></ol> 
<p>}</p> 
<ol start="53"><li></ol> 
<p>}</p> 
<p>else {<!-- --></p> 
<ol start="54"><li></ol> 
<p>this.Status =</p> 
<p>“保存失败：MaxFileSize只能允许保存：&lt;” +</p> 
<p>this.MaxFileSize /</p> 
<p>1024</p> 
<ol start="55"><li></ol> 
<ul><li></ul> 
<p>“&gt;” +</p> 
<p>“M”;</p> 
<ol start="56"><li></ol> 
<p>return</p> 
<p>false;</p> 
<ol start="57"><li></ol> 
<p>}</p> 
<p><strong>这里得插几句我的思路和理解了。</strong></p> 
<p>所谓的在线编辑保存就是从服务器先获得你需要修改的文档也就是文档模板，之后将模板加载出来，这个时候WebOffice会将文档存放在一个叫做<strong>down</strong>的目录中（win+r 输入 %appdata% 看到一个）</p> 
<p><img src="https://images2.imgbox.com/1a/b2/BctOHu37_o.png" alt="文档上传隐藏目录"></p> 
<p>文档加载隐藏目录</p> 
<p><img src="https://images2.imgbox.com/41/06/aMvc12g1_o.png" alt="文档加载2"></p> 
<p>隐藏目录</p> 
<p>之后我们开始文档编辑，编辑完，WebOffice会将这个形成的临时文件存放到隐藏目录叫做<strong>up</strong>的文件夹中，我们点击保存的时候，如果实际需求是不能覆盖原先模板，我们将存放在up中的文件实际完整地址获取到，将文件上传到我们的tomcat附件目录中，<strong>后期我们在数据库中通过版本控制，实现每次加载的模板总是最新的模板</strong>（最后修改人上传的文档模板）。</p> 
<p>说了几句废话，开始继续贴代码</p> 
<p><strong>OfficeServer.java中</strong></p> 
<ol><li></ol> 
<p>//20190403 文档在线编辑保存</p> 
<ol start="2"><li></ol> 
<p>else</p> 
<p>if (</p> 
<p>this.mOption.equalsIgnoreCase(</p> 
<p>“SAVEFILE”)) {<!-- --></p> 
<ol start="4"><li></ol> 
<p>this.mRecordID =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“RECORDID”);</p> 
<ol start="5"><li></ol> 
<p>this.mFileName =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“FILENAME”);</p> 
<ol start="6"><li></ol> 
<p>this.mFileType =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“FILETYPE”);</p> 
<ol start="7"><li></ol> 
<p>String userName =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“USERNAME”);</p> 
<ol start="9"><li></ol> 
<p>//这里这个路径 必须特殊处理掉</p> 
<ol start="10"><li></ol> 
<p>String mFilePath =</p> 
<p>this.MsgObj.GetMsgByName(</p> 
<p>“FILEPATH”);</p> 
<ol start="12"><li></ol> 
<p>this.mFileBody =</p> 
<p>this.MsgObj.MsgFileBody();</p> 
<ol start="13"><li></ol> 
<p>this.mFileSize =</p> 
<p>this.MsgObj.MsgFileSize();</p> 
<ol start="14"><li></ol> 
<p>this.mFileDate =</p> 
<p>this.DbaObj.GetDateTime();</p> 
<ol start="16"><li></ol> 
<p>this.MsgObj.MsgTextClear();</p> 
<ol start="18"><li></ol> 
<p>//获取tomcat下面附件的地址</p> 
<ol start="19"><li></ol> 
<p>this.mFilePath =</p> 
<p>this.mFilePath.replace(</p> 
<p>‘\\’,</p> 
<p>‘/’);</p> 
<p>// web跟目录</p> 
<ol start="20"><li></ol> 
<p>this.mFilePath =</p> 
<p>this.mFilePath +</p> 
<p>“upload_files”+</p> 
<p>“”;</p> 
<ol start="21"><li></ol> 
<p>String newPath =</p> 
<p>this.mFilePath+</p> 
<p>“/”+mFileName;</p> 
<ol start="23"><li></ol> 
<p>//得到旧的文件地址(文件的隐藏目录) 。</p> 
<ol start="24"><li></ol> 
<p>String oldPath =mFilePath.replace(</p> 
<p>‘,’,</p> 
<p>‘/’);</p> 
<ol start="26"><li></ol> 
<p>//自己定义的方法，主要是存数据库中</p> 
<ol start="27"><li></ol> 
<p>if (SaveFile(</p> 
<p>this.mRecordID,</p> 
<p>this.mFileName,</p> 
<p>this.mFileType,</p> 
<p>this.mFileBody,</p> 
<p>this.mFileSize,</p> 
<p>this.mFileDate,userName, newPath,oldPath)) {<!-- --></p> 
<ol start="28"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档保存成功”);</p> 
<ol start="29"><li></ol> 
<p>}</p> 
<p>else{<!-- --></p> 
<ol start="30"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档保存失败”);</p> 
<ol start="31"><li></ol> 
<p>}</p> 
<ol start="32"><li></ol> 
<p>}</p> 
<p>这个方法主要是实现：获取自己想要存入数据库中的各个属性值、获得两个文件存储的完整目录，为后期上传做准备。</p> 
<ol><li></ol> 
<p>private</p> 
<p>boolean SaveFile(</p> 
<p>String mRecordID,</p> 
<p>String mFileName,</p> 
<p>String mFileType,byte [] mFileBody,</p> 
<p>int mFileSize,</p> 
<p>String mFileDate,</p> 
<p>String userName,</p> 
<p>String newPath,</p> 
<p>String oldPath ) {<!-- --></p> 
<ol start="2"><li></ol> 
<p>boolean mResult =</p> 
<p>false;</p> 
<ol start="3"><li></ol> 
<p>try {<!-- --></p> 
<ol start="4"><li></ol> 
<p>Connection myconn = ConnectionManager.getDefaultConnection();</p> 
<ol start="5"><li></ol> 
<p>try {<!-- --></p> 
<ol start="6"><li></ol> 
<p>myconn.setAutoCommit(</p> 
<p>false);</p> 
<ol start="7"><li></ol> 
<p>Statement stmt = myconn.createStatement();</p> 
<ol start="8"><li></ol> 
<p>ResultSet rs =</p> 
<p>null;</p> 
<ol start="9"><li></ol> 
<p>//参数赋值</p> 
<ol start="10"><li></ol> 
<p>this.mFileType = mFileType;</p> 
<ol start="11"><li></ol> 
<p>this.mUserName = userName;</p> 
<ol start="12"><li></ol> 
<p>this.mFileName = mFileName;</p> 
<ol start="13"><li></ol> 
<p>this.mFileSize = this.MsgObj.MsgFileSize();</p> 
<ol start="14"><li></ol> 
<p>String mxId = Asstool.getMaxHirisunId();</p> 
<ol start="15"><li></ol> 
<p>String uploadDate = Asstool.getSystemDatetimetostring();</p> 
<ol start="17"><li></ol> 
<p>try {<!-- --></p> 
<ol start="19"><li></ol> 
<p>//判断文档之前是否上传过</p> 
<ol start="20"><li></ol> 
<p>String Sql =</p> 
<p>"select t.conid from ulob.slavefiles t "</p> 
<ol start="21"><li></ol> 
<ul><li></ul> 
<p>" where t.pk_id='"+mRecordID+</p> 
<p>"’ "</p> 
<ol start="22"><li></ol> 
<ul><li></ul> 
<p>" order by t.uploaddate desc";</p> 
<ol start="23"><li></ol> 
<p>List</p> 
<p>list = SingleTableOperation.getSimpleRecords(Sql);</p> 
<ol start="24"><li></ol> 
<p>if(</p> 
<p>list.size()&gt;</p> 
<p>0){<!-- --></p> 
<ol start="25"><li></ol> 
<p>//此文档之前上传过</p> 
<ol start="26"><li></ol> 
<p>//取出主表id 去查询明细</p> 
<ol start="27"><li></ol> 
<p>String conId = ((</p> 
<p>List)(</p> 
<p>list.get(</p> 
<p>0))).get(</p> 
<p>0).toString();</p> 
<ol start="29"><li></ol> 
<p>//用之前存在子表中的字段更新即将插入的数据</p> 
<ol start="30"><li></ol> 
<p>String sqlSelectMx =</p> 
<p>"select t1.* from ulob.slavefiles_version t1 "</p> 
<ol start="31"><li></ol> 
<ul><li></ul> 
<p>" where t1.recordid='"+conId+</p> 
<p>"’ "</p> 
<ol start="32"><li></ol> 
<ul><li></ul> 
<p>" order by t1.history desc";</p> 
<ol start="33"><li></ol> 
<p>List listMx = SingleTableOperation.getSimpleRecords(sqlSelectMx);</p> 
<ol start="34"><li></ol> 
<p>if(listMx.size()&gt;</p> 
<p>0){<!-- --></p> 
<ol start="35"><li></ol> 
<p>List listOne =(</p> 
<p>List) listMx.get(</p> 
<p>0);</p> 
<ol start="37"><li></ol> 
<p>//ulob.slavefiles 主键 。作为子表的引用</p> 
<ol start="38"><li></ol> 
<p>String recordId = listOne.get(</p> 
<p>0).toString();</p> 
<ol start="39"><li></ol> 
<p>//人名</p> 
<ol start="40"><li></ol> 
<p>String userName1 = this.mUserName;</p> 
<ol start="41"><li></ol> 
<p>//版本号</p> 
<ol start="42"><li></ol> 
<p>String history = listOne.get(</p> 
<p>5).toString();</p> 
<ol start="43"><li></ol> 
<p>//表id</p> 
<ol start="44"><li></ol> 
<p>String Mxid = mxId;</p> 
<ol start="45"><li></ol> 
<p>//大小</p> 
<ol start="46"><li></ol> 
<p>int fileSize = this.mFileSize;</p> 
<ol start="48"><li></ol> 
<p>String fileName = (</p> 
<p>new Date()).getTime()+recordId+this.mFileType;</p> 
<ol start="50"><li></ol> 
<p>//路径不变。但是得截取只要纯路径 不含名字</p> 
<ol start="51"><li></ol> 
<p>String filePath = listOne.get(</p> 
<p>3).toString();</p> 
<ol start="52"><li></ol> 
<p>filePath = filePath.substring(</p> 
<p>0,filePath.lastIndexOf(</p> 
<p>“/”));</p> 
<ol start="53"><li></ol> 
<p>filePath = filePath+</p> 
<p>“/”+fileName;</p> 
<ol start="54"><li></ol> 
<p>//</p> 
<ol start="55"><li></ol> 
<p>String inedit = listOne.get(</p> 
<p>9).toString();</p> 
<ol start="57"><li></ol> 
<p>try {<!-- --></p> 
<ol start="58"><li></ol> 
<p>//在线编辑 分为两步：第一步插入数据库 。第二步复制隐藏目录下的文件到 系统的附件文件夹</p> 
<ol start="59"><li></ol> 
<p>String insertSql =</p> 
<p>" insert into ulob.slavefiles_version "</p> 
<ol start="60"><li></ol> 
<ul><li></ul> 
<p>" (recordid,filedate,filebody,filepath,username,history,id,filesize,filename,isedit,edituser,editdata ) "</p> 
<ol start="61"><li></ol> 
<ul><li></ul> 
<p>" values('"+recordId+</p> 
<p>“‘,to_date(’”+uploadDate+</p> 
<p>“‘,‘yyyy-mm-dd hh24:mi:ss’),empty_blob(),’”+filePath+</p> 
<p>“‘,’”+userName1+</p> 
<p>“‘,’”</p> 
<ol start="62"><li></ol> 
<ul><li></ul> 
<p>String.valueOf((</p> 
<p>Integer.parseInt(history)+</p> 
<p>1))+</p> 
<p>“‘,’”+Mxid+</p> 
<p>“‘,’”+fileSize+</p> 
<p>“‘,’”+fileName+</p> 
<p>“‘,’”+inedit+</p> 
<p>“‘,’”+userName+</p> 
<p>“‘,to_date(’”+uploadDate+</p> 
<p>"',‘yyyy-mm-dd hh24:mi:ss’)) ";</p> 
<ol start="64"><li></ol> 
<p>//更新</p> 
<ol start="65"><li></ol> 
<p>TableOperation.ExecuteUpdateSQL(insertSql);</p> 
<ol start="67"><li></ol> 
<p>rs = stmt</p> 
<ol start="68"><li></ol> 
<p>.executeQuery(</p> 
<p>“select filebody from ulob.slavefiles_version t where='”</p> 
<ol start="69"><li></ol> 
<ul><li>Mxid +</li></ul> 
<p>“’ for update”);</p> 
<ol start="70"><li></ol> 
<p>//实现在线编辑的第一部分：</p> 
<ol start="71"><li></ol> 
<p>if (rs.next()) {<!-- --></p> 
<ol start="73"><li></ol> 
<p>Blob blob = rs.getBlob(</p> 
<p>1);</p> 
<ol start="74"><li></ol> 
<p>OutputStream out = ((oracle.sql.BLOB) blob)</p> 
<ol start="75"><li></ol> 
<p>.getBinaryOutputStream();</p> 
<ol start="76"><li></ol> 
<p>byte[] b =</p> 
<p>new byte[((oracle.sql.BLOB) blob)</p> 
<ol start="77"><li></ol> 
<p>.getBufferSize()];</p> 
<ol start="79"><li></ol> 
<p>File file =</p> 
<p>new File(oldPath);</p> 
<ol start="80"><li></ol> 
<p>InputStream fis =</p> 
<p>new FileInputStream(file);</p> 
<ol start="81"><li></ol> 
<p>int len =</p> 
<p>0;</p> 
<ol start="82"><li></ol> 
<p>while ((len = fis.read(b)) !=</p> 
<p>-1)</p> 
<ol start="83"><li></ol> 
<p>out.write(b,</p> 
<p>0, len);</p> 
<ol start="84"><li></ol> 
<p>out.close();</p> 
<ol start="85"><li></ol> 
<p>myconn.commit();</p> 
<ol start="87"><li></ol> 
<p>mResult=</p> 
<p>true;</p> 
<ol start="88"><li></ol> 
<p>}</p> 
<ol start="90"><li></ol> 
<p>}</p> 
<p>catch (</p> 
<p>Exception e) {<!-- --></p> 
<ol start="91"><li></ol> 
<p>// TODO: handle exception</p> 
<ol start="92"><li></ol> 
<p>e.printStackTrace();</p> 
<ol start="93"><li></ol> 
<p>}</p> 
<p>finally {<!-- --></p> 
<ol start="95"><li></ol> 
<p>myconn.close();</p> 
<ol start="96"><li></ol> 
<p>this.MsgObj.MsgFileSave(filePath);</p> 
<p>//zhazha</p> 
<ol start="98"><li></ol> 
<p>}</p> 
<ol start="99"><li></ol> 
<p>}</p> 
<h4><a id="_8833"></a>最后</h4> 
<p><img src="https://images2.imgbox.com/48/54/F8Eni7kA_o.png" alt="前15.PNG"></p> 
<p><img src="https://images2.imgbox.com/dc/fc/B7KbyGHh_o.png" alt="前16.PNG"></p> 
<blockquote> 
 <p>由于文档内容过多，为了避免影响到大家的阅读体验，在此只以截图展示部分内容</p> 
 <p><strong><a href="https://bbs.csdn.net/forums/4304bb5a486d4c3ab8389e65ecb71ac0">开源分享：【大厂前端面试题解析+核心总结学习笔记+真实项目实战+最新讲解视频】</a></strong></p> 
</blockquote> 
<p>mFileName,</p> 
<p>this.mFileType,</p> 
<p>this.mFileBody,</p> 
<p>this.mFileSize,</p> 
<p>this.mFileDate,userName, newPath,oldPath)) {<!-- --></p> 
<ol start="28"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档保存成功”);</p> 
<ol start="29"><li></ol> 
<p>}</p> 
<p>else{<!-- --></p> 
<ol start="30"><li></ol> 
<p>System.</p> 
<p>out.println(</p> 
<p>“文档保存失败”);</p> 
<ol start="31"><li></ol> 
<p>}</p> 
<ol start="32"><li></ol> 
<p>}</p> 
<p>这个方法主要是实现：获取自己想要存入数据库中的各个属性值、获得两个文件存储的完整目录，为后期上传做准备。</p> 
<ol><li></ol> 
<p>private</p> 
<p>boolean SaveFile(</p> 
<p>String mRecordID,</p> 
<p>String mFileName,</p> 
<p>String mFileType,byte [] mFileBody,</p> 
<p>int mFileSize,</p> 
<p>String mFileDate,</p> 
<p>String userName,</p> 
<p>String newPath,</p> 
<p>String oldPath ) {<!-- --></p> 
<ol start="2"><li></ol> 
<p>boolean mResult =</p> 
<p>false;</p> 
<ol start="3"><li></ol> 
<p>try {<!-- --></p> 
<ol start="4"><li></ol> 
<p>Connection myconn = ConnectionManager.getDefaultConnection();</p> 
<ol start="5"><li></ol> 
<p>try {<!-- --></p> 
<ol start="6"><li></ol> 
<p>myconn.setAutoCommit(</p> 
<p>false);</p> 
<ol start="7"><li></ol> 
<p>Statement stmt = myconn.createStatement();</p> 
<ol start="8"><li></ol> 
<p>ResultSet rs =</p> 
<p>null;</p> 
<ol start="9"><li></ol> 
<p>//参数赋值</p> 
<ol start="10"><li></ol> 
<p>this.mFileType = mFileType;</p> 
<ol start="11"><li></ol> 
<p>this.mUserName = userName;</p> 
<ol start="12"><li></ol> 
<p>this.mFileName = mFileName;</p> 
<ol start="13"><li></ol> 
<p>this.mFileSize = this.MsgObj.MsgFileSize();</p> 
<ol start="14"><li></ol> 
<p>String mxId = Asstool.getMaxHirisunId();</p> 
<ol start="15"><li></ol> 
<p>String uploadDate = Asstool.getSystemDatetimetostring();</p> 
<ol start="17"><li></ol> 
<p>try {<!-- --></p> 
<ol start="19"><li></ol> 
<p>//判断文档之前是否上传过</p> 
<ol start="20"><li></ol> 
<p>String Sql =</p> 
<p>"select t.conid from ulob.slavefiles t "</p> 
<ol start="21"><li></ol> 
<ul><li></ul> 
<p>" where t.pk_id='"+mRecordID+</p> 
<p>"’ "</p> 
<ol start="22"><li></ol> 
<ul><li></ul> 
<p>" order by t.uploaddate desc";</p> 
<ol start="23"><li></ol> 
<p>List</p> 
<p>list = SingleTableOperation.getSimpleRecords(Sql);</p> 
<ol start="24"><li></ol> 
<p>if(</p> 
<p>list.size()&gt;</p> 
<p>0){<!-- --></p> 
<ol start="25"><li></ol> 
<p>//此文档之前上传过</p> 
<ol start="26"><li></ol> 
<p>//取出主表id 去查询明细</p> 
<ol start="27"><li></ol> 
<p>String conId = ((</p> 
<p>List)(</p> 
<p>list.get(</p> 
<p>0))).get(</p> 
<p>0).toString();</p> 
<ol start="29"><li></ol> 
<p>//用之前存在子表中的字段更新即将插入的数据</p> 
<ol start="30"><li></ol> 
<p>String sqlSelectMx =</p> 
<p>"select t1.* from ulob.slavefiles_version t1 "</p> 
<ol start="31"><li></ol> 
<ul><li></ul> 
<p>" where t1.recordid='"+conId+</p> 
<p>"’ "</p> 
<ol start="32"><li></ol> 
<ul><li></ul> 
<p>" order by t1.history desc";</p> 
<ol start="33"><li></ol> 
<p>List listMx = SingleTableOperation.getSimpleRecords(sqlSelectMx);</p> 
<ol start="34"><li></ol> 
<p>if(listMx.size()&gt;</p> 
<p>0){<!-- --></p> 
<ol start="35"><li></ol> 
<p>List listOne =(</p> 
<p>List) listMx.get(</p> 
<p>0);</p> 
<ol start="37"><li></ol> 
<p>//ulob.slavefiles 主键 。作为子表的引用</p> 
<ol start="38"><li></ol> 
<p>String recordId = listOne.get(</p> 
<p>0).toString();</p> 
<ol start="39"><li></ol> 
<p>//人名</p> 
<ol start="40"><li></ol> 
<p>String userName1 = this.mUserName;</p> 
<ol start="41"><li></ol> 
<p>//版本号</p> 
<ol start="42"><li></ol> 
<p>String history = listOne.get(</p> 
<p>5).toString();</p> 
<ol start="43"><li></ol> 
<p>//表id</p> 
<ol start="44"><li></ol> 
<p>String Mxid = mxId;</p> 
<ol start="45"><li></ol> 
<p>//大小</p> 
<ol start="46"><li></ol> 
<p>int fileSize = this.mFileSize;</p> 
<ol start="48"><li></ol> 
<p>String fileName = (</p> 
<p>new Date()).getTime()+recordId+this.mFileType;</p> 
<ol start="50"><li></ol> 
<p>//路径不变。但是得截取只要纯路径 不含名字</p> 
<ol start="51"><li></ol> 
<p>String filePath = listOne.get(</p> 
<p>3).toString();</p> 
<ol start="52"><li></ol> 
<p>filePath = filePath.substring(</p> 
<p>0,filePath.lastIndexOf(</p> 
<p>“/”));</p> 
<ol start="53"><li></ol> 
<p>filePath = filePath+</p> 
<p>“/”+fileName;</p> 
<ol start="54"><li></ol> 
<p>//</p> 
<ol start="55"><li></ol> 
<p>String inedit = listOne.get(</p> 
<p>9).toString();</p> 
<ol start="57"><li></ol> 
<p>try {<!-- --></p> 
<ol start="58"><li></ol> 
<p>//在线编辑 分为两步：第一步插入数据库 。第二步复制隐藏目录下的文件到 系统的附件文件夹</p> 
<ol start="59"><li></ol> 
<p>String insertSql =</p> 
<p>" insert into ulob.slavefiles_version "</p> 
<ol start="60"><li></ol> 
<ul><li></ul> 
<p>" (recordid,filedate,filebody,filepath,username,history,id,filesize,filename,isedit,edituser,editdata ) "</p> 
<ol start="61"><li></ol> 
<ul><li></ul> 
<p>" values('"+recordId+</p> 
<p>“‘,to_date(’”+uploadDate+</p> 
<p>“‘,‘yyyy-mm-dd hh24:mi:ss’),empty_blob(),’”+filePath+</p> 
<p>“‘,’”+userName1+</p> 
<p>“‘,’”</p> 
<ol start="62"><li></ol> 
<ul><li></ul> 
<p>String.valueOf((</p> 
<p>Integer.parseInt(history)+</p> 
<p>1))+</p> 
<p>“‘,’”+Mxid+</p> 
<p>“‘,’”+fileSize+</p> 
<p>“‘,’”+fileName+</p> 
<p>“‘,’”+inedit+</p> 
<p>“‘,’”+userName+</p> 
<p>“‘,to_date(’”+uploadDate+</p> 
<p>"',‘yyyy-mm-dd hh24:mi:ss’)) ";</p> 
<ol start="64"><li></ol> 
<p>//更新</p> 
<ol start="65"><li></ol> 
<p>TableOperation.ExecuteUpdateSQL(insertSql);</p> 
<ol start="67"><li></ol> 
<p>rs = stmt</p> 
<ol start="68"><li></ol> 
<p>.executeQuery(</p> 
<p>“select filebody from ulob.slavefiles_version t where='”</p> 
<ol start="69"><li></ol> 
<ul><li>Mxid +</li></ul> 
<p>“’ for update”);</p> 
<ol start="70"><li></ol> 
<p>//实现在线编辑的第一部分：</p> 
<ol start="71"><li></ol> 
<p>if (rs.next()) {<!-- --></p> 
<ol start="73"><li></ol> 
<p>Blob blob = rs.getBlob(</p> 
<p>1);</p> 
<ol start="74"><li></ol> 
<p>OutputStream out = ((oracle.sql.BLOB) blob)</p> 
<ol start="75"><li></ol> 
<p>.getBinaryOutputStream();</p> 
<ol start="76"><li></ol> 
<p>byte[] b =</p> 
<p>new byte[((oracle.sql.BLOB) blob)</p> 
<ol start="77"><li></ol> 
<p>.getBufferSize()];</p> 
<ol start="79"><li></ol> 
<p>File file =</p> 
<p>new File(oldPath);</p> 
<ol start="80"><li></ol> 
<p>InputStream fis =</p> 
<p>new FileInputStream(file);</p> 
<ol start="81"><li></ol> 
<p>int len =</p> 
<p>0;</p> 
<ol start="82"><li></ol> 
<p>while ((len = fis.read(b)) !=</p> 
<p>-1)</p> 
<ol start="83"><li></ol> 
<p>out.write(b,</p> 
<p>0, len);</p> 
<ol start="84"><li></ol> 
<p>out.close();</p> 
<ol start="85"><li></ol> 
<p>myconn.commit();</p> 
<ol start="87"><li></ol> 
<p>mResult=</p> 
<p>true;</p> 
<ol start="88"><li></ol> 
<p>}</p> 
<ol start="90"><li></ol> 
<p>}</p> 
<p>catch (</p> 
<p>Exception e) {<!-- --></p> 
<ol start="91"><li></ol> 
<p>// TODO: handle exception</p> 
<ol start="92"><li></ol> 
<p>e.printStackTrace();</p> 
<ol start="93"><li></ol> 
<p>}</p> 
<p>finally {<!-- --></p> 
<ol start="95"><li></ol> 
<p>myconn.close();</p> 
<ol start="96"><li></ol> 
<p>this.MsgObj.MsgFileSave(filePath);</p> 
<p>//zhazha</p> 
<ol start="98"><li></ol> 
<p>}</p> 
<ol start="99"><li></ol> 
<p>}</p> 
<h4><a id="_11107"></a>最后</h4> 
<p>[外链图片转存中…(img-c7XDkaGK-1715689114956)]</p> 
<p>[外链图片转存中…(img-Uwk2VvrU-1715689114957)]</p> 
<blockquote> 
 <p>由于文档内容过多，为了避免影响到大家的阅读体验，在此只以截图展示部分内容</p> 
 <p><strong><a href="https://bbs.csdn.net/forums/4304bb5a486d4c3ab8389e65ecb71ac0">开源分享：【大厂前端面试题解析+核心总结学习笔记+真实项目实战+最新讲解视频】</a></strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57ff872fd6400afb05c6753a2a739504/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue前端获取 切换麦克风，播放采集音频和采集音量大小_vue页面唤起麦克风</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3ae81cbc40e31d89df12006125c5b81d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024年精选推荐的16个向量数据库：提升你的AI应用性能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>