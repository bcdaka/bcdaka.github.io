<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java启动jar包设置内存分配详细说明 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/633dfaa67f8a91b8a65bd5c695b286b2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Java启动jar包设置内存分配详细说明">
  <meta property="og:description" content="在微服务架构越来越盛行的情况下，我们通常一个系统都会拆成很多个小的服务，但是最终部署的时候又因为没有那么多服务器只能把多个服务部署在同一台服务器上，这个时候问题就来了，服务器内存不够，这个时候我们就需要对每个服务的内存开始精细分配，以达到充分利用每一台服务器的目的
首先来看一下我们用来启动 jar 包的常用命令
nohup java -Xms512m -Xmx512m -Xmn256m -Xss512k -server -XX:&#43;HeapDumpOnOutOfMemoryError -jar your-application.jar &gt; output.log 2&gt;&amp;1 &amp; 下面我们来一点点的解析这行命令
nohup:
在后台运行命令并忽略挂起信号（这个应该都知道没什么好说的）。
-Xms512m：
含义：设置 JVM 初始堆内存大小为 512MB。
作用：JVM 启动时分配的初始内存大小，确保在应用程序启动时有足够的内存。
-Xmx512m：
含义：设置 JVM 最大堆内存大小为 512MB。
作用：JVM 运行过程中可以使用的最大内存限制，防止应用程序占用过多的系统内存。
-Xmn256m：
含义：设置新生代内存大小为 256MB。
作用：控制新生代（Young Generation）的大小，新生代用于存放新创建的对象。适当调整可以影响垃圾回收的频率和性能。
-Xss512k：
含义：设置每个线程的栈大小为 512KB。
作用：控制每个线程的栈内存大小。如果应用程序创建大量线程或有深度递归调用，需要适当调整该值。
-server：
含义：启用 JVM 的服务器模式。
作用：服务器模式针对长期运行的服务器应用程序进行了优化，包括更高级的编译优化和垃圾回收策略。
-XX:&#43;HeapDumpOnOutOfMemoryError：
含义：在发生内存溢出错误（OutOfMemoryError）时生成堆转储文件。
作用：当应用程序由于内存不足而崩溃时，生成堆转储文件（heap dump），便于后续进行内存分析和调试。
知道了这些参数的含义以及作用，在使用的过程中还有些地方需要注意
调整堆内存大小：根据应用程序的实际内存需求，调整 -Xms 和 -Xmx的值。通常，初始堆大小（-Xms）和最大堆大小（-Xmx）应该设置为相同，以避免 JVM在运行过程中调整堆大小带来的开销。
-Xms1024m -Xmx1024m
新生代内存调整：新生代（-Xmn）的大小应该根据应用程序对象的生命周期进行调整。一般来说，新生代应占堆内存的 1/3 到1/4。
-Xmn512m
垃圾回收器选择：不同的垃圾回收器适用于不同类型的应用程序。常见的垃圾回收器有 G1、CMS 和 Parallel GC。可以根据应用程序的特点选择合适的垃圾回收器。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T09:44:29+08:00">
    <meta property="article:modified_time" content="2024-06-26T09:44:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java启动jar包设置内存分配详细说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在微服务架构越来越盛行的情况下，我们通常一个系统都会拆成很多个小的服务，但是最终部署的时候又因为没有那么多服务器只能把多个服务部署在同一台服务器上，这个时候问题就来了，服务器内存不够，这个时候我们就需要对每个服务的内存开始精细分配，以达到充分利用每一台服务器的目的</p> 
<p>首先来看一下我们用来启动 jar 包的常用命令</p> 
<pre><code class="prism language-bash"><span class="token function">nohup</span> <span class="token function">java</span> <span class="token parameter variable">-Xms512m</span> <span class="token parameter variable">-Xmx512m</span> <span class="token parameter variable">-Xmn256m</span> <span class="token parameter variable">-Xss512k</span> <span class="token parameter variable">-server</span> <span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span> <span class="token parameter variable">-jar</span> your-application.jar <span class="token operator">&gt;</span> output.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>下面我们来一点点的解析这行命令</p> 
<blockquote> 
 <p>nohup:<br> 在后台运行命令并忽略挂起信号（这个应该都知道没什么好说的）。<br> <br></p> 
 <p>-Xms512m：<br> 含义：设置 JVM 初始堆内存大小为 512MB。<br> 作用：JVM 启动时分配的初始内存大小，确保在应用程序启动时有足够的内存。<br> <br></p> 
 <p>-Xmx512m：<br> 含义：设置 JVM 最大堆内存大小为 512MB。<br> 作用：JVM 运行过程中可以使用的最大内存限制，防止应用程序占用过多的系统内存。<br> <br></p> 
 <p>-Xmn256m：<br> 含义：设置新生代内存大小为 256MB。<br> 作用：控制新生代（Young Generation）的大小，新生代用于存放新创建的对象。适当调整可以影响垃圾回收的频率和性能。<br> <br></p> 
 <p>-Xss512k：<br> 含义：设置每个线程的栈大小为 512KB。<br> 作用：控制每个线程的栈内存大小。如果应用程序创建大量线程或有深度递归调用，需要适当调整该值。<br> <br></p> 
 <p>-server：<br> 含义：启用 JVM 的服务器模式。<br> 作用：服务器模式针对长期运行的服务器应用程序进行了优化，包括更高级的编译优化和垃圾回收策略。<br> <br></p> 
 <p>-XX:+HeapDumpOnOutOfMemoryError：<br> 含义：在发生内存溢出错误（OutOfMemoryError）时生成堆转储文件。<br> 作用：当应用程序由于内存不足而崩溃时，生成堆转储文件（heap dump），便于后续进行内存分析和调试。</p> 
</blockquote> 
<p>知道了这些参数的含义以及作用，在使用的过程中还有些地方需要注意</p> 
<blockquote> 
 <p>调整堆内存大小：根据应用程序的实际内存需求，调整 -Xms 和 -Xmx的值。通常，初始堆大小（-Xms）和最大堆大小（-Xmx）应该设置为相同，以避免 JVM在运行过程中调整堆大小带来的开销。<br> -Xms1024m -Xmx1024m<br> <br></p> 
 <p>新生代内存调整：新生代（-Xmn）的大小应该根据应用程序对象的生命周期进行调整。一般来说，新生代应占堆内存的 1/3 到1/4。<br> -Xmn512m<br> <br></p> 
 <p>垃圾回收器选择：不同的垃圾回收器适用于不同类型的应用程序。常见的垃圾回收器有 G1、CMS 和 Parallel GC。可以根据应用程序的特点选择合适的垃圾回收器。<br> G1 垃圾回收器（适合具有低延迟要求的应用程序）<br> -XX:+UseG1GC<br> CMS 垃圾回收器（适合需要短暂停顿时间的应用程序）<br> -XX:+UseConcMarkSweepGC<br> 并行垃圾回收器（适合高吞吐量要求的应用程序）<br> -XX:+UseParallelGC<br> <br></p> 
 <p>元空间大小调整：调整元空间（Metaspace）大小，避免频繁的元空间扩展。<br> -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m<br> <br></p> 
 <p>垃圾回收日志：启用垃圾回收日志，以便于调试和优化垃圾回收。<br> -Xlog:gc*:file=gc.log:time,level,tags<br> <br></p> 
 <p>线程栈大小调整：根据应用程序的线程使用情况调整线程栈大小。<br> -Xss1m<br> <br></p> 
 <p>启用类数据共享<br> -XX:+UseAppCDS<br> <br></p> 
 <p>启用自适应大小线程池：<br> -XX:+UseAdaptiveSizePolicy</p> 
</blockquote> 
<p>综合一下就是下面这条命令</p> 
<pre><code class="prism language-bash"><span class="token function">nohup</span> <span class="token function">java</span> <span class="token parameter variable">-Xms1024m</span> <span class="token parameter variable">-Xmx1024m</span> <span class="token parameter variable">-Xmn512m</span> <span class="token parameter variable">-Xss1m</span> <span class="token parameter variable">-server</span> <span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span> <span class="token parameter variable">-XX:+UseG1GC</span> <span class="token parameter variable">-XX:MetaspaceSize</span><span class="token operator">=</span>128m <span class="token parameter variable">-XX:MaxMetaspaceSize</span><span class="token operator">=</span>256m -Xlog:gc*:file<span class="token operator">=</span>gc.log:time,level,tags <span class="token parameter variable">-jar</span> your-application.jar <span class="token operator">&gt;</span> output.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre> 
<p>接着我们再来说一下简洁版的启动命令</p> 
<pre><code class="prism language-bash"><span class="token function">nohup</span> <span class="token function">java</span> <span class="token parameter variable">-jar</span> your-application.jar <span class="token operator">&amp;</span>
</code></pre> 
<blockquote> 
 <p>在没有指定任何 JVM 参数的情况下，使用 nohup java -jar your-application.jar &amp; 启动 Java 应用程序时，JVM将使用默认的内存设置。这些默认值通常取决于 JVM 的版本、操作系统以及系统的可用内存。以下是一些默认设置的概述：<br> <br></p> 
 <p>堆内存：<br> 默认初始堆大小（-Xms）：通常为物理内存的 1/64，但不超过 1GB。<br> 默认最大堆大小（-Xmx）：通常为物理内存的 1/4，但不超过32GB。<br> <br></p> 
 <p>新生代内存：<br> 新生代大小（-Xmn）：默认情况下，新生代的大小会根据堆大小动态调整。<br> <br></p> 
 <p>线程栈大小：<br> 默认线程栈大小（-Xss）：这取决于操作系统和 JVM 实现。通常在 Linux 上为 1MB，Windows 上为 320KB。<br> <br></p> 
 <p>垃圾回收器：<br> JVM 会选择默认的垃圾回收器，这通常是并行垃圾回收器（Parallel GC），具体取决于 JVM 的版本。<br> <br></p> 
 <p>元空间：<br> 默认情况下，元空间（Metaspace）大小会动态调整。</p> 
</blockquote> 
<p>这个呢大家也可以直接在服务器上查看</p> 
<pre><code class="prism language-bash"><span class="token function">java</span> <span class="token parameter variable">-XX:+PrintFlagsFinal</span> <span class="token parameter variable">-version</span>
</code></pre> 
<p>也可以在程序运行时查看</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Runtime</span> runtime <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> maxMemory <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> allocatedMemory <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> freeMemory <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">freeMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Max Memory: "</span> <span class="token operator">+</span> maxMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">" MB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Allocated Memory: "</span> <span class="token operator">+</span> allocatedMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">" MB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Free Memory: "</span> <span class="token operator">+</span> freeMemory <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">" MB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>我这个就是本机默认的，明显有些大了</p> 
<p><img src="https://images2.imgbox.com/7f/5e/aMRwPfx3_o.png" alt="在这里插入图片描述"></p> 
<p>好了，合理分配内存，节约服务器空间从你我做起</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d0037a7738f3b33e388339e08a7e151/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【乐吾乐2D可视化组态编辑器】连线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/535bb4f9a115d2e37797b3bcaea288c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ChatGPT 桌面客户端正式发布</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>