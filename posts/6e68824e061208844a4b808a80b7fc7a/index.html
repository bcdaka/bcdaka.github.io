<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C 开源库之cJSON - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6e68824e061208844a4b808a80b7fc7a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C 开源库之cJSON">
  <meta property="og:description" content="cJSON简介 CJSON库是一个用于解析和生成JSON数据的C语言库。 它提供了一组函数，使得在C语言中操作JSON数据变得简单而高效。 您可以使用CJSON库来解析从服务器返回的JSON数据，或者将C语言数据结构转换为JSON格式以进行传输。
cJSON 使用 官网地址：https://sourceforge.net/projects/cjson/
cJSON只有一个cjson.h 和cjson.c 文件，可以很方便的集成到其他项目中。cJSON支持将JSON数据解析为cJSON对象，也支持将cJSON对象转换为JSON数据。cJSON的使用非常简单，只需要包含 cjson.h 头文件，然后调用相应的API即可完成JSON数据的解析和生成。
cJSON 数据生成 新增cjson_demo1.c 文件
#include&lt;stdio.h&gt; #include&lt;string.h&gt; #include&lt;stdlib.h&gt; #include &#34;cJSON.h&#34; /** * 目标：1、引入cjson 库依赖文件(cJSON.c/cJSON.h) * 2、cjson 库基本使用 */ int main(){ // 第一步：创建cJSON 对象 cJSON *jsonObject = cJSON_CreateObject(); // 第二步：输出cJSON 对象 char *content = cJSON_Print(jsonObject); printf(&#34;%s\n&#34;, content); // 第三步：cJSON 对象添加属性:基本属性之字符串 cJSON_AddItemToObject(jsonObject, &#34;name&#34;, cJSON_CreateString(&#34;周志刚&#34;)); content = cJSON_Print(jsonObject); printf(&#34;%s\n&#34;, content); // 第三步：cJSON 对象添加属性:基本属性之整形 cJSON_AddItemToObject(jsonObject, &#34;age&#34;, cJSON_CreateNumber(32)); content = cJSON_Print(jsonObject); printf(&#34;%s\n&#34;, content); // 第三步：cJSON 对象添加属性:基本属性之bool cJSON_AddItemToObject(jsonObject, &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T02:17:17+08:00">
    <meta property="article:modified_time" content="2024-08-15T02:17:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C 开源库之cJSON</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>cJSON简介 </h2> 
<p>        CJSON库是一个<strong>用于解析和生成JSON数据的C语言库</strong>。 它提供了一组函数，使得在C语言中操作JSON数据变得简单而高效。 您可以使用CJSON库来解析从服务器返回的JSON数据，或者将C语言数据结构转换为JSON格式以进行传输。</p> 
<h2>cJSON 使用</h2> 
<p>官网地址：<a class="link-info" href="https://sourceforge.net/projects/cjson/" rel="nofollow" title="https://sourceforge.net/projects/cjson/">https://sourceforge.net/projects/cjson/</a></p> 
<p>cJSON只有一个cjson.h 和cjson.c 文件，可以很方便的集成到其他项目中。cJSON支持将JSON数据解析为cJSON对象，也支持将cJSON对象转换为JSON数据。cJSON的使用非常简单，只需要包含 cjson.h 头文件，然后调用相应的API即可完成JSON数据的解析和生成。</p> 
<h3>cJSON 数据生成</h3> 
<p>新增cjson_demo1.c 文件</p> 
<pre><code class="hljs">#include&lt;stdio.h&gt;
#include&lt;string.h&gt;
#include&lt;stdlib.h&gt;
#include "cJSON.h"
/**
 * 目标：1、引入cjson 库依赖文件(cJSON.c/cJSON.h)
 *      2、cjson 库基本使用 
 */
int main(){
    // 第一步：创建cJSON 对象
    cJSON *jsonObject = cJSON_CreateObject();
    // 第二步：输出cJSON 对象
    char *content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
    // 第三步：cJSON 对象添加属性:基本属性之字符串
    cJSON_AddItemToObject(jsonObject, "name", cJSON_CreateString("周志刚"));
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
     // 第三步：cJSON 对象添加属性:基本属性之整形
    cJSON_AddItemToObject(jsonObject, "age", cJSON_CreateNumber(32));
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
     // 第三步：cJSON 对象添加属性:基本属性之bool
    cJSON_AddItemToObject(jsonObject, "man", cJSON_CreateBool(1));
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
    // 第三步：cJSON 对象添加属性:基本属性之NULL
    cJSON_AddItemToObject(jsonObject, "woman", cJSON_CreateNull());
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
    // 第四步：cJSON 对象添加属性:复杂属性之数组
    cJSON * childs = cJSON_CreateArray();
    cJSON_AddItemToArray(childs, cJSON_CreateString("周晨曦"));
    cJSON_AddItemToArray(childs, cJSON_CreateString("周晨宇"));
    cJSON_AddItemToObject(jsonObject, "childs", childs);
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);
    // 第四步：cJSON 对象添加属性:复杂属性之cJSON对象
    cJSON *wife = cJSON_CreateObject();
    cJSON_AddItemToObject(wife, "name", cJSON_CreateString("王珍"));
    cJSON_AddItemToObject(jsonObject, "wife", wife);
    content = cJSON_Print(jsonObject);
    printf("%s\n",  content);

    // 第五步：输出json 字符串到指定文件
    FILE *file = fopen("output.json", "w+");
    if(file == NULL){
        perror("fopen failed !!\n");
        return -1;
    }
    char buffer[1024];
    // 初始化
    memset(buffer, 0,1024);
    // 赋值
    strcpy(buffer, content);
    int length = strlen(buffer);
    // 文件写入
    if(fwrite(buffer, length, 1, file) &lt;=0){
        perror("fwrite failed !!\n");
        return -1;
    } 
    // 文件关闭
    fclose(file);

    // 释放cJSON 对象和字符串
    cJSON_Delete(jsonObject);

    free(content);
    return 0;
}</code></pre> 
<blockquote> 
 <p>编译：gcc cJSON.c cjson_demo1.c -o cjson_demo1 -lm</p> 
 <p>执行：./cjson_demo1</p> 
</blockquote> 
<p>执行效果：</p> 
<p><img alt="" height="217" src="https://images2.imgbox.com/a3/4e/55rQOR4D_o.png" width="405"> </p> 
<h3> cJSON 数据解析</h3> 
<p>新增cjson_demo2.c 文件</p> 
<pre><code class="hljs">#include&lt;stdio.h&gt;
#include&lt;string.h&gt;
#include&lt;stdlib.h&gt;
#include "cJSON.h"
/**
 * 目标：1、引入cjson 库依赖文件(cJSON.c/cJSON.h)
 *      2、cjson 库基本使用 
 */
int main(){
  
    // 第一步：从指定文件读取json 字符串
    FILE *file = fopen("output.json", "r");
    if(file == NULL){
        perror("fopen failed !!\n");
        return -1;
    }
    char buffer[1024];
    // 初始化
    memset(buffer, 0,1024);
    // 文件读取
    fread(buffer, 1024, 1, file);
    // 文件关闭
    fclose(file);

     // 第二步：解析json 字符串
     cJSON *jsonObject = cJSON_Parse(buffer);
     if(jsonObject == NULL){
        perror("Parse failed!\n");
        return -1;

     }
     // 第三步：解析键值对
    cJSON *name =cJSON_GetObjectItem(jsonObject, "name");
    char *content = cJSON_Print(name);
    printf("%s\n",  content);

    // 第四步: 解析JSON对象
    cJSON *wife = cJSON_GetObjectItem(jsonObject, "wife");
    content = cJSON_Print(wife);
    printf("%s\n",  content);

    // 第五步: 解析JSON数组
    cJSON *childs = cJSON_GetObjectItem(jsonObject, "childs");
    content = cJSON_Print(childs);
    printf("%s\n",  content);


     // 释放cJSON 对象和字符串
    cJSON_Delete(jsonObject);

    free(content);

    return 0;
}</code></pre> 
<blockquote> 
 <p>编译：gcc cJSON.c cjson_demo2.c -o cjson_demo2 -lm</p> 
 <p>执行：./cjson_demo2</p> 
</blockquote> 
<p>执行效果:</p> 
<p><img alt="" height="250" src="https://images2.imgbox.com/7f/e7/YwAE5QNP_o.png" width="1200"> </p> 
<h2>cJSON 问题 </h2> 
<p>问题一：找不到pow和floor函数：undefined reference to <code>pow' 和 undefined reference to</code>floor’</p> 
<p><img alt="" height="167" src="https://images2.imgbox.com/6d/60/kdtZeqdi_o.png" width="1064"></p> 
<p>解决办法： 编译需要添加math库/libm，在编译代码中添加"-lm"。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0810acca9a12f82fb2c96e7a81456af6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">重要信息：关于 Oracle RAC 环境下 Apache Tomcat 漏洞（CVE-2024-21733）的解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6463395cac9dbd77849f8afd0830aed8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数组与链表--python</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>