<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手把手搭建基于.NET 8.0的Web API项目 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/069152e9efb6a35e13908b978de1d818/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="手把手搭建基于.NET 8.0的Web API项目">
  <meta property="og:description" content="1.背景 工作以后，大部分时间都是在做基于业务的CRUD工作，软件产品或者项目的框架基本都早就搭建好了，程序员只需要在框架内去填格子打代码就行了。于是，我抽了时间来搭建个简单的三层架构模式的web api项目，技术点大概如下：三层架构&#43;EFCore&#43;.Net 8.0 Web Api&#43;AutoMap&#43;IOC容器。本文是我搭建项目的一个过程，比较简单和粗糙，但是完整，适合学习和练手。
2.操作 2.1 项目的架构图 其实图1是我最开始的设计结构，但是设计风格有提到：模块间应该依赖抽象，而不是具体的实现。所以我将结构改造为了图2，针对业务逻辑层和数据访问层开了一个抽象接口层。
2.2 新增项目 按照如下操作，创建项目：SimpleWebApi
2.3 新增类库 按照下图新增类库：SimpleWebApi.Migration、SimpleWebApi.Business.Service、SimpleWebApi.Business.Service.Interface
注意：SimpleWebApi.Migration是数据库访问
SimpleWebApi.Business.Service、SimpleWebApi.Business.Service.Interface是做业务逻辑
2.4 支持EFCore 找到类库：SimpleWebApi.Migration，并给这个项目，添加如下nuget包：Microsoft.EntityFrameworkCore、Microsoft.EntityFrameworkCore.SqlServer、Microsoft.EntityFrameworkCore.Tools、Microsoft.EntityFrameworkCore.Design
按照如下所示：添加Model和DBContext
Commodity的代码如下：
using System; using System.Collections.Generic; namespace SimpleWebApi.Migration.Models; public partial class Commodity { public int Id { get; set; } public long? ProductId { get; set; } public int? CategoryId { get; set; } public string? Title { get; set; } public decimal? Price { get; set; } public string?">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-20T14:32:00+08:00">
    <meta property="article:modified_time" content="2024-01-20T14:32:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手把手搭建基于.NET 8.0的Web API项目</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h6>1.背景</h6> 
<p>工作以后，大部分时间都是在做基于业务的CRUD工作，软件产品或者项目的框架基本都早就搭建好了，程序员只需要在框架内去填格子打代码就行了。于是，我抽了时间来搭建个简单的三层架构模式的web api项目，技术点大概如下：三层架构+EFCore+.Net 8.0 Web Api+AutoMap+IOC容器。本文是我搭建项目的一个过程，比较简单和粗糙，但是完整，适合学习和练手。</p> 
<h6>2.操作</h6> 
<h6>2.1 项目的架构图</h6> 
<p>其实图1是我最开始的设计结构，但是设计风格有提到：模块间应该依赖抽象，而不是具体的实现。所以我将结构改造为了图2，针对业务逻辑层和数据访问层开了一个抽象接口层。</p> 
<p><img alt="" height="417" src="https://images2.imgbox.com/73/cb/oendch9t_o.png" width="1038"></p> 
<h6>2.2 新增项目</h6> 
<p>按照如下操作，创建项目：SimpleWebApi</p> 
<p><img alt="" height="623" src="https://images2.imgbox.com/b9/de/FTrlQ57A_o.png" width="1019"></p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/fe/77/FxJF25af_o.png" width="1014"></p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/95/fb/rBF0EQvR_o.png" width="1014"></p> 
<p><img alt="" height="829" src="https://images2.imgbox.com/d7/71/oZlWeyEY_o.png" width="1200"></p> 
<h6>2.3 新增类库</h6> 
<p>按照下图新增类库：SimpleWebApi.Migration、SimpleWebApi.Business.Service、SimpleWebApi.Business.Service.Interface</p> 
<p>注意：SimpleWebApi.Migration是数据库访问</p> 
<p>SimpleWebApi.Business.Service、SimpleWebApi.Business.Service.Interface是做业务逻辑</p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/a4/63/NhjYCdYh_o.png" width="1014"></p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/94/4d/WXajinjf_o.png" width="1014"></p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/10/73/M9nVK0NI_o.png" width="1014"></p> 
<h6>2.4 支持EFCore</h6> 
<p>找到类库：SimpleWebApi.Migration，并给这个项目，添加如下nuget包：Microsoft.EntityFrameworkCore、Microsoft.EntityFrameworkCore.SqlServer、Microsoft.EntityFrameworkCore.Tools、Microsoft.EntityFrameworkCore.Design</p> 
<p><img alt="" height="439" src="https://images2.imgbox.com/6f/90/uzHDwVWC_o.png" width="937"></p> 
<p>按照如下所示：添加Model和DBContext</p> 
<p><img alt="" height="163" src="https://images2.imgbox.com/89/94/kVF3o6Jp_o.png" width="418"></p> 
<p>Commodity的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;

namespace SimpleWebApi.Migration.Models;

public partial class Commodity
{
    public int Id { get; set; }

    public long? ProductId { get; set; }

    public int? CategoryId { get; set; }

    public string? Title { get; set; }

    public decimal? Price { get; set; }

    public string? Url { get; set; }

    public string? ImageUrl { get; set; }
}
</code></pre> 
<p>CompanyInfo的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;

namespace SimpleWebApi.Migration.Models;

public partial class CompanyInfo
{
    public int CompanyId { get; set; }

    public string? Name { get; set; }

    public DateTime? CreateTime { get; set; }

    public int CreatorId { get; set; }

    public int? LastModifierId { get; set; }

    public DateTime? LastModifyTime { get; set; }

    public virtual ICollection&lt;SysUser&gt; SysUsers { get; set; } = new List&lt;SysUser&gt;();
}
</code></pre> 
<p>SysUser的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;

namespace SimpleWebApi.Migration.Models;

public partial class SysUser
{
    public int Id { get; set; }

    public string? Name { get; set; }

    public string? Password { get; set; }

    public int Status { get; set; }

    public string? Phone { get; set; }

    public string? Mobile { get; set; }

    public string? Address { get; set; }

    public string? Email { get; set; }

    public long? Qq { get; set; }

    public string? WeChat { get; set; }

    public int? Sex { get; set; }

    public DateTime? LastLoginTime { get; set; }

    public DateTime? CreateTime { get; set; }

    public int? CreateId { get; set; }

    public DateTime? LastModifyTime { get; set; }

    public int? LastModifyId { get; set; }

    public int? CompanyId { get; set; }

    public virtual CompanyInfo? Company { get; set; }
}
</code></pre> 
<p>AdvancedCustomerDbContext的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;
using Microsoft.EntityFrameworkCore;
using SimpleWebApi.Migration.Models;

namespace SimpleWebApi.Migration
{

    public class AdvancedCustomerDbContext : DbContext
    {
        public AdvancedCustomerDbContext()
        {
        }

        public AdvancedCustomerDbContext(DbContextOptions&lt;AdvancedCustomerDbContext&gt; options)
            : base(options)
        {
        }

        public virtual DbSet&lt;Commodity&gt; Commodities { get; set; }

        public virtual DbSet&lt;CompanyInfo&gt; CompanyInfos { get; set; }

        public virtual DbSet&lt;SysUser&gt; SysUsers { get; set; }

        protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
#warning To protect potentially sensitive information in your connection string, you should move it out of source code. You can avoid scaffolding the connection string by using the Name= syntax to read it from configuration - see https://go.microsoft.com/fwlink/?linkid=2131148. For more guidance on storing connection strings, see https://go.microsoft.com/fwlink/?LinkId=723263.
            =&gt; optionsBuilder.UseSqlServer("Data Source=127.0.0.1;Initial Catalog=AdvancedCustomerDB_Init;Persist Security Info=True;User ID=sa;Password=****;Encrypt=False;TrustServerCertificate=true");

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            modelBuilder.Entity&lt;Commodity&gt;(entity =&gt;
            {
                entity.ToTable("Commodity");

                entity.Property(e =&gt; e.ImageUrl)
                    .HasMaxLength(1000)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Price).HasColumnType("decimal(18, 2)");
                entity.Property(e =&gt; e.Title)
                    .HasMaxLength(500)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Url)
                    .HasMaxLength(1000)
                    .IsUnicode(false);
            });

            modelBuilder.Entity&lt;CompanyInfo&gt;(entity =&gt;
            {
                entity.HasKey(e =&gt; e.CompanyId).HasName("PK_Company");

                entity.ToTable("CompanyInfo");

                entity.Property(e =&gt; e.CreateTime).HasColumnType("datetime");
                entity.Property(e =&gt; e.LastModifyTime).HasColumnType("datetime");
                entity.Property(e =&gt; e.Name)
                    .HasMaxLength(50)
                    .IsUnicode(false);
            });

            modelBuilder.Entity&lt;SysUser&gt;(entity =&gt;
            {
                entity.ToTable("SysUser");

                entity.Property(e =&gt; e.Address)
                    .HasMaxLength(500)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.CreateTime).HasColumnType("datetime");
                entity.Property(e =&gt; e.Email)
                    .HasMaxLength(50)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.LastLoginTime).HasColumnType("datetime");
                entity.Property(e =&gt; e.LastModifyTime).HasColumnType("datetime");
                entity.Property(e =&gt; e.Mobile)
                    .HasMaxLength(12)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Name)
                    .HasMaxLength(50)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Password)
                    .HasMaxLength(50)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Phone)
                    .HasMaxLength(12)
                    .IsUnicode(false);
                entity.Property(e =&gt; e.Qq).HasColumnName("QQ");
                entity.Property(e =&gt; e.WeChat)
                    .HasMaxLength(50)
                    .IsUnicode(false);

                entity.HasOne(d =&gt; d.Company).WithMany(p =&gt; p.SysUsers)
                    .HasForeignKey(d =&gt; d.CompanyId)
                    .OnDelete(DeleteBehavior.Cascade)
                    .HasConstraintName("FK_SysUser_CompanyInfo");
            });

            OnModelCreatingPartial(modelBuilder);
        }

        public void OnModelCreatingPartial(ModelBuilder modelBuilder)
        {

        }
    }
}</code></pre> 
<h6>2.5 业务逻辑抽象层</h6> 
<p>找到项目“SimpleWebApi.Business.Service.Interface”，新增项目引用-SimpleWebApi.Migration，如下图：</p> 
<p><img alt="" height="566" src="https://images2.imgbox.com/69/a1/7LoW9qs3_o.png" width="1200"></p> 
<p></p> 
<p>按照下图添加以下接口：</p> 
<p><img alt="" height="120" src="https://images2.imgbox.com/ce/06/BpjBxUr0_o.png" width="426"></p> 
<p>IBaseService的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service.Interface
{
    public interface IBaseService
    {

        public IQueryable&lt;T&gt; Query&lt;T&gt;(Expression&lt;Func&lt;T,bool&gt;&gt; funcWhere) where T : class;
    }
}
</code></pre> 
<p>ICommodityService的代码如下：</p> 
<pre><code class="language-cs">using SimpleWebApi.Migration.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service.Interface
{
    public interface ICommodityService:IBaseService
    {

        public bool AddCommodity(Commodity commodity);

        public IQueryable&lt;Commodity&gt; GetCommodity(int Id);

     

    }
}
</code></pre> 
<p>ICompanyInfoService的代码如下：</p> 
<pre><code class="language-cs">using SimpleWebApi.Migration.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service.Interface
{
    public interface ICompanyInfoService:IBaseService
    {
        CompanyInfo GetCompany(int companyID);  
    }
}
</code></pre> 
<p>ISysUserService的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service.Interface
{
    public interface ISysUserService:IBaseService
    {
    }
}
</code></pre> 
<p>2.6 业务逻辑层</p> 
<p>找到项目“SimpleWebApi.Business.Service”，新增项目引用如下：SimpleWebApi.Business.Service.Interface和 SimpleWebApi.Migration<br><img alt="" height="516" src="https://images2.imgbox.com/5a/87/dYWelj5U_o.png" width="1200"></p> 
<p>按照下图添加以下类：</p> 
<p><img alt="" height="124" src="https://images2.imgbox.com/c0/51/4UhnZjR9_o.png" width="425"></p> 
<p>BaseService的代码如下：</p> 
<pre><code class="language-cs">using Microsoft.EntityFrameworkCore;
using SimpleWebApi.Business.Service.Interface;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Linq.Expressions;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service
{
    public class BaseService:IBaseService
    {
        protected DbContext Context;
        public BaseService(DbContext context)
        {
            Console.WriteLine($"{this.GetType().Name}被构造了......");
            this.Context= context;   
        }
        public IQueryable&lt;T&gt; Query&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; funcWhere) where T : class
        {
            return this.Context.Set&lt;T&gt;().Where&lt;T&gt;(funcWhere);   
        }
  
    }
}
</code></pre> 
<p></p> 
<p>CommodityService的代码如下：</p> 
<pre><code class="language-cs">using Microsoft.EntityFrameworkCore;
using SimpleWebApi.Business.Service.Interface;
using SimpleWebApi.Migration.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service
{
    public class CommodityService : BaseService, ICommodityService
    {
        public CommodityService(DbContext context):base(context) 
        {
                
        }

        public bool AddCommodity(Commodity commodity)
        {
            this.Context.Set&lt;Commodity&gt;().Add(commodity);
            int num= this.Context.SaveChanges();
            return num &gt; 0;
        }

        public IQueryable&lt;Commodity&gt; GetCommodity(int Id)
        {
            var list= this.Context.Set&lt;Commodity&gt;().Where(a =&gt; a.Id == Id);
            return list;
        }
    }
}
</code></pre> 
<p></p> 
<p>CompanyInfoService的代码如下：</p> 
<pre><code class="language-cs">using Microsoft.EntityFrameworkCore;
using SimpleWebApi.Business.Service.Interface;
using SimpleWebApi.Migration.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service
{
    public class CompanyInfoService:BaseService, ICompanyInfoService
    {
        public CompanyInfoService(DbContext context):base(context)
        {
                
        }

        public CompanyInfo GetCompany(int companyID)
        {
            var company = this.Context.Set&lt;CompanyInfo&gt;().Where(a=&gt;a.CompanyId==companyID).FirstOrDefault();
            return company; 
        }
    }
}
</code></pre> 
<p></p> 
<p>SysUserService的代码如下：</p> 
<pre><code class="language-cs">using Microsoft.EntityFrameworkCore;
using SimpleWebApi.Business.Service.Interface;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace SimpleWebApi.Business.Service
{
    public class SysUserService:BaseService, ISysUserService
    {
        public SysUserService(DbContext context) : base(context)
        {
                
        }
    }
}
</code></pre> 
<h6>2.6 UI</h6> 
<p>找到项目“SimpleWebApi”，并新增项目引用：</p> 
<p>SimpleWebApi.Business.Service、SimpleWebApi.Business.Service.Interface、SimpleWebApi.Migration</p> 
<p><img alt="" height="500" src="https://images2.imgbox.com/37/cc/ykwskkr5_o.png" width="1200"></p> 
<p>按照如下，新增nuget包引用：AutoMapper、AutoMapper.Extensions.Microsoft.DependencyInjection</p> 
<p><img alt="" height="573" src="https://images2.imgbox.com/01/97/QgZL6OIR_o.png" width="1200"></p> 
<p></p> 
<p>新增文件夹DTO和Map,并新增类文件和AutoMapper的规则文件</p> 
<p><img alt="" height="372" src="https://images2.imgbox.com/4b/a5/moKZ4xlm_o.png" width="455"></p> 
<p>CommodityDTO的代码如下：</p> 
<pre><code class="language-cs">using System;
using System.Collections.Generic;

namespace SimpleWebApi;

public class CommodityDTO
{
    public int CommodityId { get; set; }

    public long? ProductId { get; set; }

    public int? CategoryId { get; set; }

    public string? Title { get; set; }

    public decimal? Price { get; set; }

    public string? Url { get; set; }

    public string? ImageUrl { get; set; }
}
</code></pre> 
<p>CompanyInfoDTO的代码如下：</p> 
<pre><code class="language-cs">using SimpleWebApi.Migration.Models;
using System;
using System.Collections.Generic;

namespace SimpleWebApi;

public class CompanyInfoDTO
{
    public int CompanyId { get; set; }

    public string? Name { get; set; }

    public DateTime? CreateTime { get; set; }

    public int CreatorId { get; set; }

    public int? LastModifierId { get; set; }

    public DateTime? LastModifyTime { get; set; }

    public virtual ICollection&lt;SysUser&gt; SysUsers { get; set; } = new List&lt;SysUser&gt;();
}
</code></pre> 
<p>AuotoMapConfig的代码如下：</p> 
<pre><code class="language-cs">using AutoMapper;
using SimpleWebApi.Migration.Models;

namespace SimpleWebApi
{
    public class AuotoMapConfig:Profile
    {
        public AuotoMapConfig()
        {
            CreateMap&lt;Commodity, CommodityDTO&gt;().ForMember(c=&gt;c.CommodityId, s=&gt;s.MapFrom(c=&gt;c.Id))
                .ForMember(c=&gt;c.ProductId,s=&gt;s.MapFrom(c=&gt;c.ProductId))
                .ForMember(c=&gt;c.CategoryId,s=&gt;s.MapFrom(c=&gt;c.CategoryId))
                .ForMember(c=&gt;c.Title,s=&gt;s.MapFrom(c=&gt;c.Title))
                .ForMember(c=&gt;c.Price,s=&gt;s.MapFrom(c=&gt;c.Price))
                .ForMember(c=&gt;c.Url,s=&gt;s.MapFrom(c=&gt;c.Url))
                .ForMember(c=&gt;c.ImageUrl,s=&gt;s.MapFrom(c=&gt;c.ImageUrl));

            CreateMap&lt;CompanyInfo, CompanyInfoDTO&gt;();

        }

    }
}
</code></pre> 
<p>为了添加对象映射，DBContext，对象注入等，打开Program文件，按照如下添加</p> 
<p><img alt="" height="927" src="https://images2.imgbox.com/c3/dd/SOkrrqs7_o.png" width="1200"></p> 
<p><img alt="" height="887" src="https://images2.imgbox.com/d1/9b/TOzIzBbA_o.png" width="1200"></p> 
<p>上图的红色代码如下：</p> 
<pre><code class="language-cs">  //查询数据库真实数据的业务逻辑层服务注册
  builder.Services.AddTransient&lt;ICommodityService, CommodityService&gt;();
  builder.Services.AddTransient&lt;ICompanyInfoService, CompanyInfoService&gt;();

  //添加DbContext
  //builder.Services.AddDbContext&lt;AdvancedCustomerDbContext&gt;();
  builder.Services.AddTransient&lt;DbContext, AdvancedCustomerDbContext&gt;();

  //支持AutoMapper
  builder.Services.AddAutoMapper(options =&gt;
  {
      options.AddProfile&lt;AuotoMapConfig&gt;();

  });</code></pre> 
<p>选中“Controllers”文件夹新增控制器 ApiController</p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/57/a9/W7WjpBHY_o.png" width="1200"></p> 
<p>ApiController代码如下：</p> 
<pre><code class="language-cs">using AutoMapper;
using Microsoft.AspNetCore.Mvc;
using SimpleWebApi.Business.Service.Interface;
using SimpleWebApi.Migration.Models;
using System.Linq.Expressions;

namespace SimpleWebApi.Controllers
{
    [ApiController]
    [Route("api/[controller]/[action]")]
    public class ApiController : ControllerBase
    {
        private readonly ILogger&lt;ApiController&gt; _logger;

        private ICommodityService _comService;
        private ICompanyInfoService _companyService;

        private IMapper _mapper;

        public ApiController(ILogger&lt;ApiController&gt; logger, ICommodityService comService, ICompanyInfoService companyService, IMapper mapper)
        {
            _logger = logger;
            _comService = comService;
            _companyService = companyService;
            _mapper = mapper;
        }

        [HttpGet]
        public IEnumerable&lt;CommodityDTO&gt; GetCommodity(int Id)
        {
            Expression&lt;Func&lt;Commodity, bool&gt;&gt; funcWhere = null;
            funcWhere = a =&gt; a.Id == Id;
            var commodityList = _comService.Query(funcWhere);
            List&lt;CommodityDTO&gt; list = new List&lt;CommodityDTO&gt;();
            _mapper.Map&lt;IQueryable&lt;Commodity&gt;, List&lt;CommodityDTO&gt;&gt;(commodityList, list);

            return list;

        }

        [HttpGet]
        public CompanyInfoDTO GetCompanyInfo(int companyId)
        {
            var company = _companyService.GetCompany(companyId);
            CompanyInfoDTO dto = new CompanyInfoDTO();
            _mapper.Map&lt;CompanyInfo, CompanyInfoDTO&gt;(company, dto);

            return dto;

        }
    }
}
</code></pre> 
<p> 这里有个小坑，打开SimpleWebApi.csproj，按照下图设置，可以解决问题</p> 
<pre><code class="language-cs">&lt;InvariantGlobalization&gt;false&lt;/InvariantGlobalization&gt;</code></pre> 
<p><img alt="" height="653" src="https://images2.imgbox.com/08/f8/t8OHcSGU_o.png" width="1200"></p> 
<p>ps：默认该数据值是true，运行程序后会异常，异常提示如下:</p> 
<pre><code class="language-cs">System.Globalization.CultureNotFoundException
  HResult=0x80070057
  Message=Only the invariant culture is supported in globalization-invariant mode. See https://aka.ms/GlobalizationInvariantMode for more information. (Parameter 'name')
en-us is an invalid culture identifier.
  Source=System.Private.CoreLib
  StackTrace:
   在 System.Globalization.CultureInfo.GetCultureInfo(String name)
   在 Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   在 Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   在 Microsoft.Data.SqlClient.SqlConnection.Open()
   在 Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerConnection.OpenDbConnection(Boolean errorsExpected)
   在 Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   在 Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   在 Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   在 Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   在 Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.&lt;&gt;c.&lt;MoveNext&gt;b__21_0(DbContext _, Enumerator enumerator)
   在 Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   在 Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
   在 System.Collections.Generic.List`1..ctor(IEnumerable`1 collection)
   在 System.Linq.Enumerable.ToList[TSource](IEnumerable`1 source)
   在 SimpleProjectDemo.Controllers.WeatherForecastController.Get2() 在 E:\Vs_Project\SimpleProjectDemo\SimpleProjectDemo\Controllers\WeatherForecastController.cs 中: 第 50 行
   在 Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.SyncObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   在 Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.&lt;&lt;InvokeActionMethodAsync&gt;g__Logged|12_1&gt;d.MoveNext()
</code></pre> 
<h6>2.7 运行项目</h6> 
<p>运行项目，如下图所示显示Swagger页面:<br><img alt="" height="907" src="https://images2.imgbox.com/52/da/IZhXaJpx_o.png" width="1200"></p> 
<p>用接口api/Api/GetCommodity 来测试下</p> 
<p><img alt="" height="886" src="https://images2.imgbox.com/e4/fd/rWJ9xWpT_o.png" width="1200"></p> 
<h6>3.结论</h6> 
<p>至此，操作完成。成功的搭建了一个简单的.net 8.0的web api项目。</p> 
<p>ps:本项目的代码都很简单，真诚建议跟着指引来敲代码梳理思路，不过考虑极端情况，我还是打包代码上传到了csdn。有需要的童鞋可以按需<a class="link-info" href="https://download.csdn.net/download/wzl644/88764821" title="下载">下载</a>。谢谢。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8960a5458f626f716f5b84adfb12e6a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI大模型开发架构设计（1）——LLM大模型Agent剖析和应用案例实战</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/550979f9b363e994e8b59b11bb4e4bfa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu安装Java并且配置JAVA_HOME</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>