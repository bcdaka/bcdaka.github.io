<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot 整合 Sentinel 实现流量控制 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4bd07acf36a24aab6435b30ef9ed1ff8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spring Boot 整合 Sentinel 实现流量控制">
  <meta property="og:description" content="在微服务架构中，流量控制是保障系统稳定性和高可用性的关键技术之一。阿里巴巴开源的 Sentinel 是一款面向分布式系统的流量防护组件，旨在从流量控制、熔断降级、系统负载保护等多个维度保障服务的稳定性。本文将详细介绍如何在 Spring Boot 项目中整合 Sentinel 实现流量控制。
1. Sentinel 简介 Sentinel 是阿里巴巴开源的一个轻量级流量控制框架，主要用于保护分布式服务的稳定性。其核心功能包括：
实时监控：通过控制台可以实时查看系统的流量、响应时间等数据。
流量控制：可以针对不同的资源设定不同的流量控制规则。
熔断降级：在服务不稳定或出现故障时，自动进行熔断降级处理。
系统自适应保护：根据系统的运行状况，自动调整流量控制策略。
2. Spring Boot 项目初始化 首先，我们需要创建一个 Spring Boot 项目。可以通过 Spring Initializr 创建项目，选择合适的依赖，如 Spring Web 等。
mvn archetype:generate -DgroupId=com.example -DartifactId=sentinel-demo -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=falsecd sentinel-demo 在 pom.xml 中添加 Spring Boot 相关依赖：
&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.6.3&lt;/version&gt; &lt;/parent&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 3. 引入 Sentinel 依赖 在 pom.xml 中添加 Sentinel 依赖：
&lt;dependency&gt; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt; &lt;version&gt;2.2.5.RELEASE&lt;/version&gt; &lt;/dependency&gt; 4.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-31T10:00:00+08:00">
    <meta property="article:modified_time" content="2024-08-31T10:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot 整合 Sentinel 实现流量控制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>在微服务架构中，流量控制是保障系统稳定性和高可用性的关键技术之一。阿里巴巴开源的 Sentinel 是一款面向分布式系统的流量防护组件，旨在从流量控制、熔断降级、系统负载保护等多个维度保障服务的稳定性。本文将详细介绍如何在 Spring Boot 项目中整合 Sentinel 实现流量控制。</p> 
</blockquote> 
<h3><strong>1. Sentinel 简介</strong></h3> 
<p>Sentinel 是阿里巴巴开源的一个轻量级流量控制框架，主要用于保护分布式服务的稳定性。其核心功能包括：</p> 
<ul><li> <p><strong>实时监控</strong>：通过控制台可以实时查看系统的流量、响应时间等数据。</p> </li><li> <p><strong>流量控制</strong>：可以针对不同的资源设定不同的流量控制规则。</p> </li><li> <p><strong>熔断降级</strong>：在服务不稳定或出现故障时，自动进行熔断降级处理。</p> </li><li> <p><strong>系统自适应保护</strong>：根据系统的运行状况，自动调整流量控制策略。</p> </li></ul> 
<h3><strong>2. Spring Boot 项目初始化</strong></h3> 
<p>首先，我们需要创建一个 Spring Boot 项目。可以通过 Spring Initializr 创建项目，选择合适的依赖，如 Spring Web 等。</p> 
<pre><code class="language-vbnet">mvn archetype:generate -DgroupId=com.example -DartifactId=sentinel-demo -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=falsecd sentinel-demo</code></pre> 
<p>在 pom.xml 中添加 Spring Boot 相关依赖：</p> 
<pre><code class="language-XML">&lt;parent&gt;    
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;    
    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;    
    &lt;version&gt;2.6.3&lt;/version&gt;
&lt;/parent&gt;
&lt;dependencies&gt;    
    &lt;dependency&gt;        
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre> 
<h3><strong>3. 引入 Sentinel 依赖</strong></h3> 
<p>在 pom.xml 中添加 Sentinel 依赖：</p> 
<pre><code class="language-XML">&lt;dependency&gt;    
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;    
    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;                      
    &lt;version&gt;2.2.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<h3><strong>4. 配置 Sentinel</strong></h3> 
<p>在 application.yml 文件中进行 Sentinel 的基本配置：</p> 
<pre><code class="language-javascript">spring:  
    cloud:   
        sentinel:      
            transport:        
                dashboard: localhost:8080  # Sentinel 控制台地址        
                    port: 8719  # 客户端向控制台上报信息的端口</code></pre> 
<p>启动 Sentinel 控制台，下载 Sentinel 控制台 jar 包并启动：</p> 
<pre><code class="language-javascript">java -jar sentinel-dashboard-1.8.0.jar</code></pre> 
<h3><strong>5. </strong><strong>实现流量控制</strong></h3> 
<h4><strong>5.1 定义资源</strong></h4> 
<p>在 Spring Boot 中，可以使用 Sentinel 提供的注解来定义受保护的资源。创建一个简单的控制器：</p> 
<pre><code class="language-java">package com.example.sentineldemo.controller;
import com.alibaba.csp.sentinel.annotation.SentinelResource;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;

    @RestControllerpublic
    class TestController {
        @GetMapping("/hello")
        @SentinelResource("helloResource")
        public String hello() {
            return "Hello, Sentinel!";
        }
    }</code></pre> 
<p>在上述代码中，我们使用 @SentinelResource 注解将 /hello 接口标记为一个受保护的资源，资源名为 helloResource。</p> 
<h4><strong>5.2 配置规则</strong></h4> 
<p>可以通过编程的方式或在控制台上配置流量控制规则。以下是通过编程的方式配置流量控制规则的示例：</p> 
<pre><code class="language-java"> package com.example.sentineldemo.config;
import com.alibaba.csp.sentinel.slots.block.RuleConstant;import com.alibaba.csp.sentinel.slots.block.flow.FlowRule;import com.alibaba.csp.sentinel.slots.block.flow.FlowRuleManager;
import javax.annotation.PostConstruct;import java.util.ArrayList;import java.util.List;

    @Configurationpublic
    class SentinelConfig {
        @PostConstruct
        public void initFlowRules() {
            List&lt;FlowRule&gt; rules = new ArrayList&lt;&gt;();
            FlowRule rule = new FlowRule();
            rule.setResource("helloResource");
            rule.setGrade(RuleConstant.FLOW_GRADE_QPS);
            rule.setCount(1); // 限制 QPS 为 1        rules.add(rule);        FlowRuleManager.loadRules(rules);    }}

</code></pre> 
<p>上述代码中，在@PostConstruct方法中配置了流量控制规则，限制 helloResource 资源的 QPS 为 1。</p> 
<h3><strong>6. 控制台监控</strong></h3> 
<p>在启动 Spring Boot 项目后，可以通过 Sentinel 控制台查看流量控制效果。打开浏览器访问 http://localhost:8080，在控制台中可以看到受保护的资源和相关的监控数据。</p> 
<h3><strong>7. 实践中的一些建议</strong></h3> 
<ol><li> <p><strong>合理设置流量控制规则</strong>：根据实际业务需求和系统性能设置合理的流量控制规则，避免过度限制或保护不足。</p> </li><li> <p><strong>结合熔断降级机制</strong>：在流量控制的基础上，结合熔断降级机制，进一步提高系统的稳定性和可用性。</p> </li><li> <p><strong>监控和报警</strong>：及时监控系统的运行状况，设置报警机制，及时发现和处理异常情况。</p> </li><li> <p><strong>性能优化</strong>：定期进行性能测试和优化，确保系统能够在高并发场景下稳定运行。</p> </li></ol> 
<h3><strong>8. 总结</strong></h3> 
<p>本文详细介绍了在 Spring Boot 项目中整合 Sentinel 实现流量控制的步骤，包括项目初始化、引入依赖、配置 Sentinel、定义受保护的资源以及配置流量控制规则。通过合理设置流量控制规则和结合熔断降级机制，可以有效保障系统的稳定性和高可用性。Sentinel 作为一款强大的流量控制框架，能够在分布式系统中发挥重要作用。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08542a1b7d65b054725f06e709af051b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【MySQL】字节跳动MySQL连环40问（网图）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a51c2fcc8bb725576b515eea9b048be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MCU官方IDE软件安装及学习教程集合 — STM32CubeIDE（STM32）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>