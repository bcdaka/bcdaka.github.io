<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch 安全通信配置（SSL/TLS） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f9b7283cac9ce417d29bb62f75bccadb/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Elasticsearch 安全通信配置（SSL/TLS）">
  <meta property="og:description" content="随着网络安全威胁的日益增长，确保数据在传输过程中的安全性变得至关重要。Elasticsearch 作为一种分布式搜索和分析引擎，通常需要在不同节点之间传递数据，也需要与外部客户端进行通信。为了防止数据在传输过程中被窃取或篡改，必须为 Elasticsearch 配置安全通信机制。SSL/TLS（安全套接层/传输层安全协议）是实现安全通信的标准方法。本文将详细介绍如何为 Elasticsearch 配置 SSL/TLS，以确保集群节点之间和客户端与服务器之间的通信安全。
9.3 安全通信配置（SSL/TLS） Elasticsearch 提供了内置的 SSL/TLS 支持，通过配置传输层和 HTTP 层的加密，可以确保集群内部和外部通信的安全性。SSL/TLS 的配置涉及证书的生成和管理、配置文件的修改，以及客户端的配置。
1. 生成证书 配置 SSL/TLS 的第一步是生成和管理证书。Elasticsearch 提供了一个简单的工具 elasticsearch-certutil，可以用来生成证书。通常，我们需要生成一个证书颁发机构（CA）证书，并基于此 CA 签发节点证书。
1.1 生成 CA 证书 首先，使用 elasticsearch-certutil 生成 CA 证书：
bin/elasticsearch-certutil ca 该命令会生成一个 CA 证书文件（例如 elastic-stack-ca.p12），该文件将用于签发集群节点和客户端的证书。
1.2 生成节点证书 接下来，为 Elasticsearch 节点生成证书：
bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 该命令会生成一个 .p12 文件，包含节点的公钥和私钥以及 CA 证书。你可以为每个节点生成单独的证书，也可以为多个节点生成共享证书。
1.3 生成自签名证书 如果不使用 CA，可以直接生成自签名证书：
bin/elasticsearch-certutil cert --self-signed 这种方式适用于小型集群或测试环境，但生产环境中推荐使用 CA 签发的证书。
2. 配置 Elasticsearch 传输层加密 传输层加密用于保护 Elasticsearch 节点之间的通信。通过配置传输层加密，可以确保集群内部的数据传输不被窃听或篡改。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-21T16:45:00+08:00">
    <meta property="article:modified_time" content="2024-08-21T16:45:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch 安全通信配置（SSL/TLS）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>随着网络安全威胁的日益增长，确保数据在传输过程中的安全性变得至关重要。Elasticsearch 作为一种分布式搜索和分析引擎，通常需要在不同节点之间传递数据，也需要与外部客户端进行通信。为了防止数据在传输过程中被窃取或篡改，必须为 Elasticsearch 配置安全通信机制。SSL/TLS（安全套接层/传输层安全协议）是实现安全通信的标准方法。本文将详细介绍如何为 Elasticsearch 配置 SSL/TLS，以确保集群节点之间和客户端与服务器之间的通信安全。</p> 
<h3><a id="93_SSLTLS_2"></a>9.3 安全通信配置（SSL/TLS）</h3> 
<p>Elasticsearch 提供了内置的 SSL/TLS 支持，通过配置传输层和 HTTP 层的加密，可以确保集群内部和外部通信的安全性。SSL/TLS 的配置涉及证书的生成和管理、配置文件的修改，以及客户端的配置。</p> 
<h4><a id="1__6"></a>1. 生成证书</h4> 
<p>配置 SSL/TLS 的第一步是生成和管理证书。Elasticsearch 提供了一个简单的工具 <code>elasticsearch-certutil</code>，可以用来生成证书。通常，我们需要生成一个证书颁发机构（CA）证书，并基于此 CA 签发节点证书。</p> 
<h5><a id="11__CA__10"></a>1.1 生成 CA 证书</h5> 
<p>首先，使用 <code>elasticsearch-certutil</code> 生成 CA 证书：</p> 
<pre><code class="prism language-bash">bin/elasticsearch-certutil ca
</code></pre> 
<p>该命令会生成一个 CA 证书文件（例如 <code>elastic-stack-ca.p12</code>），该文件将用于签发集群节点和客户端的证书。</p> 
<h5><a id="12__20"></a>1.2 生成节点证书</h5> 
<p>接下来，为 Elasticsearch 节点生成证书：</p> 
<pre><code class="prism language-bash">bin/elasticsearch-certutil cert <span class="token parameter variable">--ca</span> elastic-stack-ca.p12
</code></pre> 
<p>该命令会生成一个 <code>.p12</code> 文件，包含节点的公钥和私钥以及 CA 证书。你可以为每个节点生成单独的证书，也可以为多个节点生成共享证书。</p> 
<h5><a id="13__30"></a>1.3 生成自签名证书</h5> 
<p>如果不使用 CA，可以直接生成自签名证书：</p> 
<pre><code class="prism language-bash">bin/elasticsearch-certutil cert --self-signed
</code></pre> 
<p>这种方式适用于小型集群或测试环境，但生产环境中推荐使用 CA 签发的证书。</p> 
<h4><a id="2__Elasticsearch__40"></a>2. 配置 Elasticsearch 传输层加密</h4> 
<p>传输层加密用于保护 Elasticsearch 节点之间的通信。通过配置传输层加密，可以确保集群内部的数据传输不被窃听或篡改。</p> 
<h5><a id="21__SSLTLS_44"></a>2.1 配置节点之间的 SSL/TLS</h5> 
<p>在 Elasticsearch 配置文件 <code>elasticsearch.yml</code> 中，为传输层启用 SSL/TLS：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">xpack.security.transport.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.transport.ssl.verification_mode</span><span class="token punctuation">:</span> certificate
<span class="token key atrule">xpack.security.transport.ssl.keystore.path</span><span class="token punctuation">:</span> <span class="token string">"/path/to/elastic-certificates.p12"</span>
<span class="token key atrule">xpack.security.transport.ssl.truststore.path</span><span class="token punctuation">:</span> <span class="token string">"/path/to/elastic-certificates.p12"</span>
</code></pre> 
<ul><li><code>xpack.security.transport.ssl.enabled</code>: 启用节点之间的 SSL/TLS 加密。</li><li><code>xpack.security.transport.ssl.verification_mode</code>: 设置证书验证模式。<code>certificate</code> 表示仅验证证书，<code>full</code> 表示验证证书和主机名。</li><li><code>xpack.security.transport.ssl.keystore.path</code>: 指定包含节点证书和私钥的密钥库路径。</li><li><code>xpack.security.transport.ssl.truststore.path</code>: 指定包含 CA 证书的信任库路径。</li></ul> 
<h5><a id="22__60"></a>2.2 配置证书验证</h5> 
<p>可以根据集群的需求调整证书验证的严格程度。常见的选项包括：</p> 
<ul><li><code>none</code>: 不验证证书。</li><li><code>certificate</code>: 验证证书的有效性，但不验证主机名。</li><li><code>full</code>: 验证证书和主机名，确保通信安全。</li></ul> 
<p>在生产环境中，推荐使用 <code>full</code> 模式，以确保集群安全。</p> 
<h4><a id="3__Elasticsearch_HTTP__70"></a>3. 配置 Elasticsearch HTTP 层加密</h4> 
<p>HTTP 层加密用于保护 Elasticsearch 与外部客户端（如 Kibana、Logstash）之间的通信。通过为 HTTP 层配置 SSL/TLS，可以确保用户数据和查询请求在传输过程中不被窃取或篡改。</p> 
<h5><a id="31__HTTP_SSLTLS_74"></a>3.1 启用 HTTP SSL/TLS</h5> 
<p>在 <code>elasticsearch.yml</code> 中配置 HTTP 层的 SSL/TLS：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">xpack.security.http.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.http.ssl.keystore.path</span><span class="token punctuation">:</span> <span class="token string">"/path/to/elastic-certificates.p12"</span>
<span class="token key atrule">xpack.security.http.ssl.truststore.path</span><span class="token punctuation">:</span> <span class="token string">"/path/to/elastic-certificates.p12"</span>
</code></pre> 
<ul><li><code>xpack.security.http.ssl.enabled</code>: 启用 HTTP 层的 SSL/TLS 加密。</li><li><code>xpack.security.http.ssl.keystore.path</code>: 指定包含节点证书和私钥的密钥库路径。</li><li><code>xpack.security.http.ssl.truststore.path</code>: 指定包含 CA 证书的信任库路径。</li></ul> 
<p>通过这些配置，Elasticsearch 的 HTTP API 将通过 HTTPS 提供服务，确保客户端与集群之间的通信安全。</p> 
<h4><a id="4__Kibana__Elasticsearch__SSLTLS_90"></a>4. 配置 Kibana 与 Elasticsearch 的 SSL/TLS</h4> 
<p>如果你的 Elasticsearch 集群启用了 HTTPS，则 Kibana 也需要配置为通过 HTTPS 连接 Elasticsearch。</p> 
<p>在 <code>kibana.yml</code> 中进行以下配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">elasticsearch.ssl.certificateAuthorities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"/path/to/elastic-stack-ca.crt"</span> <span class="token punctuation">]</span>
<span class="token key atrule">elasticsearch.ssl.verificationMode</span><span class="token punctuation">:</span> full
</code></pre> 
<ul><li><code>elasticsearch.ssl.certificateAuthorities</code>: 指定 CA 证书路径，用于验证 Elasticsearch 服务器的证书。</li><li><code>elasticsearch.ssl.verificationMode</code>: 设置为 <code>full</code>，以确保 Kibana 验证服务器证书和主机名。</li></ul> 
<p>如果 Kibana 也需要通过 HTTPS 访问（例如为了安全登录），可以启用 Kibana 的 HTTPS 支持：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">server.ssl.certificate</span><span class="token punctuation">:</span> /path/to/kibana<span class="token punctuation">-</span>cert.crt
<span class="token key atrule">server.ssl.key</span><span class="token punctuation">:</span> /path/to/kibana<span class="token punctuation">-</span>key.key
</code></pre> 
<h4><a id="5__Elasticsearch__SSLTLS_112"></a>5. 配置客户端与 Elasticsearch 的 SSL/TLS</h4> 
<p>对于通过 HTTP API 与 Elasticsearch 交互的客户端（如 Logstash、Beats、Curl 等），也需要配置 SSL/TLS 以确保安全通信。</p> 
<h5><a id="51__Logstash_116"></a>5.1 配置 Logstash</h5> 
<p>如果使用 Logstash 将数据发送到启用了 SSL/TLS 的 Elasticsearch 集群，可以在 Logstash 的配置文件中添加以下内容：</p> 
<pre><code class="prism language-plaintext">output {
  elasticsearch {
    hosts =&gt; ["https://your-es-host:9200"]
    ssl =&gt; true
    cacert =&gt; "/path/to/elastic-stack-ca.crt"
  }
}
</code></pre> 
<ul><li><code>ssl</code>: 启用 SSL/TLS 连接。</li><li><code>cacert</code>: 指定 CA 证书路径，用于验证 Elasticsearch 服务器的证书。</li></ul> 
<h5><a id="52__Beats_133"></a>5.2 配置 Beats</h5> 
<p>如果使用 Filebeat、Metricbeat 等工具来收集数据并发送到 Elasticsearch，同样需要启用 SSL/TLS：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">output.elasticsearch</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"https://your-es-host:9200"</span><span class="token punctuation">]</span>
  <span class="token key atrule">ssl.certificate_authorities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"/path/to/elastic-stack-ca.crt"</span><span class="token punctuation">]</span>
</code></pre> 
<p>通过这些配置，Beats 工具将在传输过程中保护数据安全。</p> 
<h4><a id="6__145"></a>6. 测试和验证配置</h4> 
<p>配置完成后，需要验证 SSL/TLS 是否正确工作。你可以通过以下步骤进行测试：</p> 
<ol><li> <p><strong>检查 Elasticsearch 启动日志</strong>：启动 Elasticsearch 时，检查日志中是否有任何与 SSL/TLS 相关的错误信息。</p> </li><li> <p><strong>使用 HTTPS 访问 Elasticsearch</strong>：在浏览器或命令行工具（如 Curl）中使用 HTTPS 访问 Elasticsearch 的 REST API，确保返回正确的响应。</p> <pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-u</span> elastic:password <span class="token parameter variable">--cacert</span> /path/to/elastic-stack-ca.crt https://your-es-host:9200
</code></pre> </li><li> <p><strong>验证节点间通信</strong>：确保集群中的所有节点都可以正常通信，检查分片分配和集群状态是否正常。</p> </li></ol> 
<h4><a id="7__159"></a>7. 常见问题排查</h4> 
<ul><li> <p><strong>证书错误</strong>：如果证书配置不正确，Elasticsearch 或客户端可能会拒绝连接。确保证书路径、密钥和权限设置正确。</p> </li><li> <p><strong>验证模式错误</strong>：如果使用自签名证书或证书中的主机名与实际不匹配，可能需要调整 <code>verification_mode</code> 设置，或生成新的证书。</p> </li><li> <p><strong>TLS 版本不兼容</strong>：确保 Elasticsearch 和客户端支持相同的 TLS 版本。可以通过配置 <code>xpack.security.transport.ssl.supported_protocols</code> 来指定支持的 TLS 版本。</p> </li></ul> 
<h4><a id="_167"></a>总结</h4> 
<p>为 Elasticsearch 配置 SSL/TLS 是确保数据传输安全的关键步骤。通过配置传输层和 HTTP 层的加密，可以有效防止数据在网络传输过程中被窃听或篡改。配置过程中，生成和管理证书、正确配置节点和客户端的通信设置，以及定期验证和测试安全配置，都是保障集群安全运行的重要环节。</p> 
<p>在生产环境中，强烈建议启用 SSL/TLS 加密，并结合其他安全措施，如用户认证和授权、审计日志等，全面保护 Elasticsearch 集群的数据安全。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39cd9968cf53f7d7778eb327f617b94b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">企业级Web服务器性能优化实践指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5cace383c717517250959fff4961671/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">云手机解决了TikTok哪些账号运营难题？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>