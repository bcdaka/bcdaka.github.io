<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python爬虫 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0ff605956534e70441083a49a383845b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python爬虫">
  <meta property="og:description" content="爬虫 1.什么是爬虫2.基础入门之简单的页面设计3.urllib基本使用，一个类型六个方法4.urllib下载5. 请求对象的定制6.get请求的quote方法7. get请求urlencode方法8.urllib_post请求百度翻译9.百度翻译详细版10.urllib_ajax的get请求豆瓣电影的第一页11.get请求豆瓣电影的前十页12.ajax_post请求肯德基官网13.异常14.微博的cookie登录15.handler处理器的基本使用16.urllib代理17.代理池18.xpath的基本使用19.解析_百度一下20.站长素材21.jsonpath22.用jsonpath解析淘票票23.BeautifulSoup24.bs4获取星巴克数据25.Selenium26.selenium元素定位27.举例Selenium邓紫棋28.Selenium 其他操作29.selenium-phantomjs30.selenium-handless31.request基本使用request中的get请求32.request中的post请求33.request_代理34.request免验证登录古诗词网35.scrapy基本使用36.58同城实例37.汽车之家38.当当网39.电影天堂40.crawlspider 1.什么是爬虫 网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。
2.基础入门之简单的页面设计 这一部分主要是为了展示怎样在爬虫中寻找网页中信息，在这些代码中展示的是一个列表，
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;!-- table 表格 tr 行 td 列 --&gt; &lt;table width = &#34;200px&#34; height = &#34;200px&#34; border = &#34;1px&#34;&gt; &lt;tr&gt; &lt;td&gt; 姓名 &lt;/td&gt; &lt;td&gt; 年龄 &lt;/td&gt; &lt;td&gt; 性别 &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt; 张三 &lt;/td&gt; &lt;td&gt; 18 &lt;/td&gt; &lt;td&gt; 男 &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;!-- ul li (无序列表) 爬虫使用很多--&gt; &lt;ul&gt; &lt;li&gt;铁锅炖大鹅&lt;/li&gt; &lt;li&gt;小鸡炖蘑菇&lt;/li&gt; &lt;li&gt;锅包肉&lt;/li&gt; &lt;/ul&gt; &lt;!">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-02T16:41:42+08:00">
    <meta property="article:modified_time" content="2024-08-02T16:41:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python爬虫</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>爬虫</h4> 
 <ul><li><a href="#1_1" rel="nofollow">1.什么是爬虫</a></li><li><a href="#2_3" rel="nofollow">2.基础入门之简单的页面设计</a></li><li><a href="#3urllib_60" rel="nofollow">3.urllib基本使用，一个类型六个方法</a></li><li><a href="#4urllib_122" rel="nofollow">4.urllib下载</a></li><li><a href="#5__146" rel="nofollow">5. 请求对象的定制</a></li><li><a href="#6getquote_199" rel="nofollow">6.get请求的quote方法</a></li><li><a href="#7_geturlencode_241" rel="nofollow">7. get请求urlencode方法</a></li><li><a href="#8urllib_post_292" rel="nofollow">8.urllib_post请求百度翻译</a></li><li><a href="#9_356" rel="nofollow">9.百度翻译详细版</a></li><li><a href="#10urllib_ajaxget_394" rel="nofollow">10.urllib_ajax的get请求豆瓣电影的第一页</a></li><li><a href="#11get_407" rel="nofollow">11.get请求豆瓣电影的前十页</a></li><li><a href="#12ajax_post_490" rel="nofollow">12.ajax_post请求肯德基官网</a></li><li><a href="#13_554" rel="nofollow">13.异常</a></li><li><a href="#14cookie_580" rel="nofollow">14.微博的cookie登录</a></li><li><a href="#15handler_608" rel="nofollow">15.handler处理器的基本使用</a></li><li><a href="#16urllib_657" rel="nofollow">16.urllib代理</a></li><li><a href="#17_701" rel="nofollow">17.代理池</a></li><li><a href="#18xpath_737" rel="nofollow">18.xpath的基本使用</a></li><li><a href="#19__806" rel="nofollow">19.解析_百度一下</a></li><li><a href="#20_835" rel="nofollow">20.站长素材</a></li><li><a href="#21jsonpath_886" rel="nofollow">21.jsonpath</a></li><li><a href="#22jsonpath_969" rel="nofollow">22.用jsonpath解析淘票票</a></li><li><a href="#23BeautifulSoup_1025" rel="nofollow">23.BeautifulSoup</a></li><li><a href="#24bs4_1138" rel="nofollow">24.bs4获取星巴克数据</a></li><li><a href="#25Selenium_1163" rel="nofollow">25.Selenium</a></li><li><a href="#26selenium_1180" rel="nofollow">26.selenium元素定位</a></li><li><a href="#27Selenium_1224" rel="nofollow">27.举例Selenium邓紫棋</a></li><li><a href="#28Selenium__1268" rel="nofollow">28.Selenium 其他操作</a></li><li><a href="#29seleniumphantomjs_1420" rel="nofollow">29.selenium-phantomjs</a></li><li><a href="#30seleniumhandless_1436" rel="nofollow">30.selenium-handless</a></li><li><a href="#31request_1478" rel="nofollow">31.request基本使用</a></li><li><a href="#requestget_1505" rel="nofollow">request中的get请求</a></li><li><a href="#32requestpost_1553" rel="nofollow">32.request中的post请求</a></li><li><a href="#33request__1582" rel="nofollow">33.request_代理</a></li><li><a href="#34request_1607" rel="nofollow">34.request免验证登录古诗词网</a></li><li><a href="#35scrapy_1703" rel="nofollow">35.scrapy基本使用</a></li><li><a href="#3658_1739" rel="nofollow">36.58同城实例</a></li><li><a href="#37_1775" rel="nofollow">37.汽车之家</a></li><li><a href="#38_1804" rel="nofollow">38.当当网</a></li><li><a href="#39_1932" rel="nofollow">39.电影天堂</a></li><li><a href="#40crawlspider_1983" rel="nofollow">40.crawlspider</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_1"></a>1.什么是爬虫</h2> 
<p>网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。</p> 
<h2><a id="2_3"></a>2.基础入门之简单的页面设计</h2> 
<p>这一部分主要是为了展示怎样在爬虫中寻找网页中信息，在这些代码中展示的是一个列表，</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--   table  表格
           tr     行
           td     列
     --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">width</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>200px<span class="token punctuation">"</span></span> <span class="token attr-name">height</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>200px<span class="token punctuation">"</span></span> <span class="token attr-name">border</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>1px<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    姓名
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    年龄
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    性别
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    张三
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    18
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                    男
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--   ul  li (无序列表) 爬虫使用很多--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>铁锅炖大鹅<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>小鸡炖蘑菇<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>锅包肉<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--    ol  li (有序列表) 更少一点--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>穿衣服<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>下床<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>洗漱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--    超链接--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.atguigu.com/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>尚硅谷<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8c/6d/lBXINiwq_o.png" alt="上述代码运行时产生的图片"></p> 
<h2><a id="3urllib_60"></a>3.urllib基本使用，一个类型六个方法</h2> 
<p>首先引用urllib，其中url代表我们想访问的网站网址，接下来我们要模拟一个浏览器向服务器发送请求，<br> 使用</p> 
<pre><code class="prism language-python">responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
</code></pre> 
<p>来向服务器发送请求，用urllib来接收，从而我们就接收到了来自网站的源码，之后我们使用read()方法来读取，但是read()返回的是字节形式的二进制数据，我们无法读取，这时我们就可以解码，把二进制数据解码为字符串，使用decode(‘UTF-8’),这样我们就可以读取了。<br> ** 一个类型六个方法 **<br> 一个类型指的是我们上面提到的responce，也就是从服务器返回的数据，是HTTPResponce类型的。<br> 六个方法：</p> 
<pre><code class="prism language-python"> content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment"># 读取五个字节</span>
<span class="token comment"># read读取时是按照字节去读取的，括号中是5说明读取5个字节</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 读取一行</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 读取所有行，一行一行读，直到读完</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>getcode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 一个小知识 ，返回状态码，如果是200，说明没问题</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>geturl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 获取网站的地址，url指向的网站</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 获取headers，也就是模拟的浏览器的信息</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 基本使用</span>
<span class="token comment"># 使用urllib获取百度首页的源码</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># （1）定义一个url   就是要访问的地址</span>
url <span class="token operator">=</span> <span class="token string">'http://www.baidu.com'</span>
<span class="token comment"># （2）模拟浏览器向服务器发送请求,responce就是响应</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># （3）获取响应中的原码</span>
<span class="token comment"># read 方法，返回的是字节形式的二进制数据</span>
<span class="token comment"># 要将二进制数据转换成字符串</span>
<span class="token comment"># 二进制 -&gt; 字符串  解码  decode('编码的格式')</span>
<span class="token comment"># content = responce.read().decode('UTF-8')</span>
<span class="token comment"># 一个类型和六个方法</span>
<span class="token comment"># responce 是HTTPResponce类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>responce<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 按照一个字节一个字节去读</span>
<span class="token comment"># content = responce.read(5) # 读取五个字节</span>
<span class="token comment"># print(content)</span>
<span class="token comment"># （4）打印数据</span>
<span class="token comment"># print(content)</span>
<span class="token comment"># 读取一行</span>
<span class="token comment"># content = responce.readline()</span>
<span class="token comment"># 一行一行地读直到读完</span>
<span class="token comment"># content = responce.readlines()</span>
<span class="token comment"># print(content)</span>
<span class="token comment"># 返回状态码  如果是200，证明我们没有错</span>
<span class="token comment"># print(responce.getcode())</span>
<span class="token comment"># 返回url地址</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>geturl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 获取的一些状态信息</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 一个类型HTTPresponce</span>
<span class="token comment"># 六个方法read readline readlines getcode geturl getheaders</span>
</code></pre> 
<h2><a id="4urllib_122"></a>4.urllib下载</h2> 
<p>下载需要使用</p> 
<pre><code class="prism language-python">urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>filename <span class="token operator">=</span> <span class="token string">'filename'</span><span class="token punctuation">)</span>
</code></pre> 
<p>其中url代表一个下载的网页，filename代表文件的名字，其中文件名字后要加文件格式，例如jpg,mp4等</p> 
<pre><code class="prism language-python"><span class="token comment"># 下载</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 下载一个网页</span>
<span class="token comment"># url_page = 'http://www.baidu.com'</span>
<span class="token comment"># url代表下载的路径，filename代表文件的名字</span>
<span class="token comment"># 在python中，可以变量的名字，也可以直接写值</span>
<span class="token comment"># urllib.request.urlretrieve(url_page,'baidu.html')</span>
<span class="token comment"># 下载图片</span>
url_img <span class="token operator">=</span> <span class="token string">'https://img2.baidu.com/it/u=260402465,3171771956&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=500&amp;h=889'</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url <span class="token operator">=</span> url_img<span class="token punctuation">,</span>filename<span class="token operator">=</span><span class="token string">'you.jpg'</span><span class="token punctuation">)</span>
<span class="token comment"># 下载视频</span>
url_video <span class="token operator">=</span> <span class="token string">'https://vdept3.bdstatic.com/mda-mhej5kskcde2e1e3/cae_h264_nowatermark/1629034712771677277/mda-mhej5kskcde2e1e3.mp4?v_from_s=hkapp-haokan-hbe&amp;auth_key=1721966751-0-0-d761b7436e0f490614a8f1832a35f960&amp;bcevod_channel=searchbox_feed&amp;pd=1&amp;cr=0&amp;cd=0&amp;pt=3&amp;logid=0351188068&amp;vid=3964562110483450965&amp;klogid=0351188068&amp;abtest='</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url_video<span class="token punctuation">,</span><span class="token string">'ban.mp4'</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="5__146"></a>5. 请求对象的定制</h2> 
<p>有些网站中的开头为https://，说明在其中加入了ssl，这也是一种反爬虫的手段。</p> 
<pre><code class="prism language-html">https://www.baidu.com/s?tn=15007414_15_dg&amp;ie=utf-8&amp;wd=邓紫棋
</code></pre> 
<p>分析这个网址，其中有协议https://，有主机www.baidu.com，有路径s , 参数wd</p> 
<pre><code class="prism language-python"><span class="token comment">#  http/https   www.baidu.com  80/443       s     wd = 邓紫棋      #</span>
<span class="token comment">#    协议            主机        端口号       路径     参数           锚点</span>
<span class="token comment"># http  端口号 80</span>
<span class="token comment"># https 443</span>
<span class="token comment"># mysql 3306</span>
<span class="token comment"># oracle 1521</span>
<span class="token comment"># redis 6379</span>
<span class="token comment"># mongodb 27017</span>
</code></pre> 
<p>我们需要构建一个请求对象来访问<br> <img src="https://images2.imgbox.com/51/20/iFXolrgu_o.png" alt="在这里插入图片描述"><br> 在这里我们可以获得User-Agent的信息,来假借这一信息来向服务器发送信息，又因为urlopen中不能存放字典，所以我们可以通过<br> <code>request = urllib.request.Request(url = url1,headers=headers)</code>来接收headers和url，并且由于参数顺序问题我们只能通过关键字传参的方式</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url1 <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>

<span class="token comment"># url的组成</span>
<span class="token comment"># https 中加入了 ssl</span>
<span class="token comment"># https://www.baidu.com/s?tn=15007414_15_dg&amp;ie=utf-8&amp;wd=邓紫棋</span>
<span class="token comment">#  http/https   www.baidu.com  80/443       s     wd = 邓紫棋      #</span>
<span class="token comment">#    协议            主机        端口号       路径     参数           锚点</span>
<span class="token comment"># http  端口号 80</span>
<span class="token comment"># https 443</span>
<span class="token comment"># mysql 3306</span>
<span class="token comment"># oracle 1521</span>
<span class="token comment"># redis 6379</span>
<span class="token comment"># mongodb 27017</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

<span class="token comment"># 请求对象的定制</span>
<span class="token comment"># 因为urlopen中不能储存字典，所以headers不能传递出去</span>
<span class="token comment"># 因为参数顺序问题，不能直接写url和headers</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url1<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token comment"># 第一个反爬 ： UA</span>
</code></pre> 
<h2><a id="6getquote_199"></a>6.get请求的quote方法</h2> 
<p>当我们访问<code>https://www.baidu.com/s?tn=15007414_15_dg&amp;ie=utf-8&amp;wd=%E9%82%93%E7%B4%AB%E6%A3%8B</code>这个网站时，我们看不懂后面的这些乱码，所以我们改为</p> 
<pre><code class="prism language-html">https://www.baidu.com/s?wd=邓紫棋 
</code></pre> 
<p>可是这时却报错，因为浏览器不认识中文，这时我们就应该把‘邓紫棋’换成unicode编码的形式，使用：</p> 
<pre><code class="prism language-python">name <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span><span class="token string">'邓紫棋'</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样我们就可以获取到邓紫棋三个字的unicode编码了。然后把之前的url和name结合起来就可以获取网址了。</p> 
<pre><code class="prism language-python"><span class="token comment"># https://www.baidu.com/s?tn=15007414_15_dg&amp;ie=utf-8&amp;wd=%E9%82%93%E7%B4%AB%E6%A3%8B</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token comment"># 需求 获取https://www.baidu.com/s?wd=邓紫棋  的网页源码</span>
url <span class="token operator">=</span> <span class="token string">' https://www.baidu.com/s?wd='</span>

<span class="token comment"># 请求对象的定制，是为了解决反爬的第一种手段</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, likeGecko) Chrome / 127.0.0.0Safari / 537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 将邓紫棋三个字变成unicode编码的格式</span>
<span class="token comment"># 我们依赖urllib.parse</span>

name <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span><span class="token string">'邓紫棋'</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> url <span class="token operator">+</span> name
<span class="token comment"># 请求对象的定制</span>

request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

<span class="token comment"># 模拟浏览器向服务器发送请求</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 获取相应的内容</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="7_geturlencode_241"></a>7. get请求urlencode方法</h2> 
<p>上面的实例中只有‘邓紫棋’一个中文，当我们有多个中文检索词时，还用quote就比较麻烦了，这是我们有一个更好的方法：</p> 
<pre><code class="prism language-python">data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'wd'</span> <span class="token punctuation">:</span> <span class="token string">'周杰伦'</span><span class="token punctuation">,</span>
    <span class="token string">'sex'</span><span class="token punctuation">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
    <span class="token string">'location'</span><span class="token punctuation">:</span><span class="token string">'中国台湾'</span>
<span class="token punctuation">}</span>
new_data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> 
<p>这样我们就可以把这些元素都融合在一起了，这时我们就可以获取到想要的带有中文检索字的网址了，然后再定制请求对象想服务器发送请求就可以了。</p> 
<pre><code class="prism language-python"><span class="token comment"># urlencode应用场景：多个参数的时候</span>

<span class="token comment"># import urllib.parse</span>
<span class="token comment"># https://www.baidu.com/s?wd=周杰伦&amp;sex=男</span>

<span class="token comment"># data = {<!-- --></span>
<span class="token comment">#    'wd' : '周杰伦',</span>
<span class="token comment">#    'sex':'男'</span>
<span class="token comment"># }</span>
<span class="token comment"># a = urllib.parse.urlencode(data)</span>
<span class="token comment"># print(a)</span>

<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
base_url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/s?'</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'wd'</span> <span class="token punctuation">:</span> <span class="token string">'周杰伦'</span><span class="token punctuation">,</span>
    <span class="token string">'sex'</span><span class="token punctuation">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
    <span class="token string">'location'</span><span class="token punctuation">:</span><span class="token string">'中国台湾'</span>
<span class="token punctuation">}</span>
new_data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>new_data<span class="token punctuation">)</span>
<span class="token comment"># 路径</span>
url <span class="token operator">=</span> base_url <span class="token operator">+</span> new_data

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 请求对象的定制</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment"># 模拟浏览器向服务器发送请求</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 获取网页源码的数据</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="8urllib_post_292"></a>8.urllib_post请求百度翻译</h2> 
<p>我们在对百度翻译进行爬虫时，需要先找到网址<code>'https://fanyi.baidu.com/sug'</code><br> 然后我们可以在图中发现Request Method是POST，我们需要知道post的请求参数必须要进行编码，我们在图中得知一个字典类型的数据，这就是我们要在网站中查找的内容，我们用data来接收它，然后用urlencode编码一下：</p> 
<pre><code class="prism language-python">data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
</code></pre> 
<p>但是这样得到的是字符串，我们传入的是字节码，所以说post传入的参数需要编码，<code>data = urllib.parse.urlencode(data).encode('UTF-8')</code>，而且post传入的参数不会拼接到url后面，而是放到请求对象定制的参数中，</p> 
<pre><code class="prism language-python">request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
</code></pre> 
<p>之后模拟浏览器向服务器发送请求，得到的数据我们看不懂，所以我们要对其进行改变，把字符串变成json数据，</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/27/ec/bpuQMA9o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c5/b1/WTsAB9kl_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># post请求</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
url <span class="token operator">=</span> <span class="token string">'https://fanyi.baidu.com/sug'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'kw'</span><span class="token punctuation">:</span><span class="token string">'spider'</span>
<span class="token punctuation">}</span>

<span class="token comment"># post的请求参数必须要进行编码</span>
<span class="token comment"># data = urllib.parse.urlencode(data)   &lt;- 这样是字符串，而传入的是字节码</span>
data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
<span class="token comment"># post请求的参数不会拼接在url后面，而是需要放到请求对象定制的参数中</span>
<span class="token comment"># post请求的参数必须要进行编码</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span> data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

<span class="token comment"># print(request)</span>

<span class="token comment"># 模拟浏览器向服务器发送请求</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 获取相应的数据</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token comment"># post请求方式的参数 必须编码 data = urllib.parse.urlencode(data).encode('UTF-8')</span>
<span class="token comment"># 编码之后必须调用encode方法</span>
<span class="token comment"># 参数放在请求对象定制的方法中</span>

<span class="token comment"># 字符串变成json数据</span>
<span class="token keyword">import</span> json
obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="9_356"></a>9.百度翻译详细版</h2> 
<p>由于反爬手段的提升我找不到之前的v2文件，所以这一段没有爬取成功…</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span>  urllib<span class="token punctuation">.</span>parse
url <span class="token operator">=</span> <span class="token string">'https://fanyi.baidu.com/v2transapi?from=en&amp;to=zh'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment"># 'cookie'最重要，但是我找不到</span>

    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'from'</span> <span class="token punctuation">:</span> <span class="token string">'en'</span><span class="token punctuation">,</span>
    <span class="token string">'to'</span> <span class="token punctuation">:</span> <span class="token string">'zh'</span><span class="token punctuation">,</span>
    <span class="token string">'query'</span> <span class="token punctuation">:</span> <span class="token string">'love'</span><span class="token punctuation">,</span>
    <span class="token string">'transtype'</span><span class="token punctuation">:</span><span class="token string">'realtime'</span><span class="token punctuation">,</span>
    <span class="token string">'simple_means_flag'</span><span class="token punctuation">:</span><span class="token string">'3'</span><span class="token punctuation">,</span>
    <span class="token string">'sign'</span><span class="token punctuation">:</span><span class="token string">'198772.518981'</span><span class="token punctuation">,</span>
    <span class="token string">'token'</span><span class="token punctuation">:</span><span class="token string">'5483bfa652979b41f9c90d91f3de875d'</span><span class="token punctuation">,</span>
    <span class="token string">'domain'</span><span class="token punctuation">:</span><span class="token string">'common'</span>
<span class="token punctuation">}</span>
<span class="token comment"># post请求的参数必须编码</span>
data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token comment"># 请求对象的定制</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

<span class="token comment"># 模拟浏览器向服务器发送请求</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token comment"># 获取相应的数据</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> json
obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="10urllib_ajaxget_394"></a>10.urllib_ajax的get请求豆瓣电影的第一页</h2> 
<p>我们在检查中发现类型是get<br> 网址为：<code>https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;start=0&amp;limit=20</code><br> 之后我们构建请求对象，模拟浏览器向服务器传递信息，接收到content后，我们想把它下载到本地，可以使用open方法，open方法默认情况下是使用gbk编码，如果我们想保存汉字，那么需要我们在open格式中指定编码格式为‘UTF-8’</p> 
<pre><code class="prism language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'douban1.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/57/80/fRALUVOV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fe/08/uk9BYtCW_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11get_407"></a>11.get请求豆瓣电影的前十页</h2> 
<p>如果我们想下载多页数据时，一次一次输入网址会很麻烦，我们登录网站发现这些网址都是有规律的，通过分析可知start = (page-1) * 20，这样我们就想到可以使用for循环来为我们下载，首先在程序入口处输入起始页和终止页，然后通过for循环，找到每一页，每一页中都有自己的请求对象，</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_request</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action='</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'start'</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token string">'limit'</span> <span class="token punctuation">:</span> <span class="token string">'20'</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    url <span class="token operator">=</span> base_url <span class="token operator">+</span> data
    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> request
</code></pre> 
<p>其他的就和访问一页的数据是相同的，在最后下载时：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">down_load</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span> <span class="token punctuation">(</span><span class="token string">'douban'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<p>有一个小坑，就是page必须要强制类型转换为str才能和文件名结合起来。</p> 
<pre><code class="prism language-python"><span class="token comment"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;start=0&amp;limit=20</span>

<span class="token comment"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;start=20&amp;limit=20</span>

<span class="token comment"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;start=40&amp;limit=20</span>

<span class="token comment"># https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;start=60&amp;limit=20</span>

<span class="token comment"># page   1  2  3  4</span>
<span class="token comment"># start  0  20 40 60</span>
<span class="token comment"># start = (page-1) * 20</span>

<span class="token comment"># 下载豆瓣电影前十页的数据</span>
<span class="token comment"># （1）请求对象定制</span>

<span class="token comment"># (2)获取相应的数据</span>

<span class="token comment"># (3)下载数据</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">def</span> <span class="token function">create_request</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action='</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'start'</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">20</span><span class="token punctuation">,</span>
        <span class="token string">'limit'</span> <span class="token punctuation">:</span> <span class="token string">'20'</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    url <span class="token operator">=</span> base_url <span class="token operator">+</span> data
    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> request

<span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content
<span class="token keyword">def</span> <span class="token function">down_load</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span> <span class="token punctuation">(</span><span class="token string">'douban'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>


<span class="token comment"># 程序入口：</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    start_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入起始的页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    end_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入结束的页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_page<span class="token punctuation">,</span>end_page<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 每一页都有自己请求的定制</span>
        request <span class="token operator">=</span>  create_request<span class="token punctuation">(</span>page<span class="token punctuation">)</span>
<span class="token comment"># 获取响应的数据</span>
        content <span class="token operator">=</span> get_content<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 下载</span>
        down_load<span class="token punctuation">(</span>page<span class="token punctuation">,</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="12ajax_post_490"></a>12.ajax_post请求肯德基官网</h2> 
<p><img src="https://images2.imgbox.com/bf/4f/qhrtknLh_o.png" alt="在这里插入图片描述"><br> 当我们想在肯德基官网获取餐厅信息时，我们可以使用ajax_post方法，首先我们在官网中获取一些信息：<br> <img src="https://images2.imgbox.com/4e/db/MIOO3yx9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/96/fa/OlsVrt4H_o.png" alt="在这里插入图片描述"><br> 我们在不同页面中发现这些网址只有page是不同的，那么我们还是可以利用一个for循环，分别记录每一页，然后构建针对不同page的请求对象来模拟访问就可以了。</p> 
<pre><code class="prism language-python"><span class="token comment"># 2页</span>
<span class="token comment"># https://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname</span>
<span class="token comment"># post请求</span>
<span class="token comment"># cname: 北京</span>
<span class="token comment"># pid:</span>
<span class="token comment"># pageIndex: 2</span>
<span class="token comment"># pageSize: 10</span>
<span class="token comment"># 1页</span>
<span class="token comment"># https://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname</span>
<span class="token comment"># cname: 北京</span>
<span class="token comment"># pid:</span>
<span class="token comment"># pageIndex: 1</span>
<span class="token comment"># pageSize: 10</span>

<span class="token keyword">import</span>  urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span>  urllib<span class="token punctuation">.</span>parse
<span class="token keyword">def</span> <span class="token function">create_request</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    base_url <span class="token operator">=</span> <span class="token string">'https://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname'</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string">'cname'</span><span class="token punctuation">:</span> <span class="token string">'北京'</span><span class="token punctuation">,</span>
         <span class="token string">'pid'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
         <span class="token string">'pageIndex'</span><span class="token punctuation">:</span> page<span class="token punctuation">,</span>
         <span class="token string">'pageSize'</span><span class="token punctuation">:</span> <span class="token string">'10'</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> base_url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> request

<span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content


<span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'kfc_'</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    start_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'输入起始页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    end_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'输入结束页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_page<span class="token punctuation">,</span>end_page<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 请求对象的定制</span>
        request <span class="token operator">=</span> create_request<span class="token punctuation">(</span>page<span class="token punctuation">)</span>
<span class="token comment"># 获取网页源码</span>
        content <span class="token operator">=</span> get_content<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 下载</span>
        download<span class="token punctuation">(</span>page<span class="token punctuation">,</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="13_554"></a>13.异常</h2> 
<p>当我们有时访问失败时，可以使用try_except来确保程序稳定运行，而且我们也可以通过try_except来分析出是哪一种错误，例如有HTTPError，URLError等</p> 
<pre><code class="prism language-python"><span class="token comment"># URLError / HTTPError</span>
<span class="token keyword">import</span>  urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span>  urllib<span class="token punctuation">.</span>error
url <span class="token operator">=</span> <span class="token string">'https://blog.csdn.net/sulixu/article/details/1198189491'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    request  <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

    responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

    content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">except</span> urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>HTTPError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'系统正在升级...'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>URLError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'系统正在升级...'</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="14cookie_580"></a>14.微博的cookie登录</h2> 
<p>在访问微博时，我们是需要登录的，如果想要跳过登录，我们可以借助UA和cookie值进入，有时还会需要referer，它是判断你的访问是从哪一个网站来的，如果不是它规定的网站，就会报错，不会给你返回值，此外还要判断个人信息页面是否是utf-8类型，否则也会出错。<br> <img src="https://images2.imgbox.com/1b/1b/fVlhrkTT_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 适用场景；数据采集时，需要绕过登录，然后进入到某个页面</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 个人信息页面是utf-8,但是还是报了错，因为并没有进入到个人信息页面，而是跳转到了登录页面</span>
<span class="token comment"># 那么登录页面不是utf-8</span>
url <span class="token operator">=</span> <span class="token string">'https://weibo.cn/78529754/info'</span>
<span class="token comment"># 访问不成功是因为请求头信息不够</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment"># refer 判断当前路径是不是由上一个路径进来的，一般情况下做图片防盗链</span>
    <span class="token string">'referer'</span><span class="token punctuation">:</span><span class="token string">'https://weibo.cn/'</span><span class="token punctuation">,</span>
    <span class="token string">'user-agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/5.36'</span><span class="token punctuation">,</span>
<span class="token comment"># cookie中携带有你的登录信息，如果登陆之后有cookie</span>
     <span class="token string">'cookie'</span> <span class="token punctuation">:</span> <span class="token string">'_T_WM=d2f35cbdfece6f640ede045818da88d5; SCF=Alr8vNiruaP9jRc7fqN_u9cTZn_1GmCjtpbbrJMiFLUWPKB-jG35pMkTSbEq70HhKEFgJCW78xgnIpPa7lHcw2o.; SUB=_2A25LoMf-DeRhGeFG7lAY9yvIzzqIHXVo3EU2rDV6PUJbktANLRHYkW1NeUVJpU0UhBUoxjmFEWVW38OwxCHmgCDg; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WF2wIbYV-gP9mnBVAM.0zdv5NHD95QN1h-E1KMfShBcWs4DqcjGwJfodJ9Rdntt; SSOLoginState=17220708; ALF=1724662958'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 请求对象的定制</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment"># 模拟浏览器向服务器发送请求</span>
responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 获取相应的数据</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token comment"># 将数据保存到本地</span>
<span class="token keyword">with</span> <span class="token builtin">open</span> <span class="token punctuation">(</span><span class="token string">'weibo.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="15handler_608"></a>15.handler处理器的基本使用</h2> 
<p>在上述例子中，cookie值都是不变的，但是当cookie随着我们的访问一直变化我们应该怎么办呢？这是我们就可以使用handler，下面我们使用访问百度来举例子：<br> 我们需要三个方法：</p> 
<pre><code class="prism language-python">handler   build_opener   <span class="token builtin">open</span>
</code></pre> 
<p>和之前不同的是，我们构建完请求对象后，我们不能用urlopen来模拟浏览器访问服务器，而是通过：</p> 
<pre><code class="prism language-python"><span class="token comment"># handler  build_opener  open</span>
<span class="token comment"># 获取handler对象</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取opener对象</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

<span class="token comment"># 调用open方法</span>
responce <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
</code></pre> 
<p>来获取responce。</p> 
<pre><code class="prism language-python"><span class="token comment"># 动态cookie和代理不能简单使用请求对象的定制</span>
<span class="token comment"># 使用handler来访问百度，获取网页源码</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>

headlers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span>

<span class="token comment"># handler  build_opener  open</span>
<span class="token comment"># 获取handler对象</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 获取opener对象</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

<span class="token comment"># 调用open方法</span>
responce <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="16urllib_657"></a>16.urllib代理</h2> 
<p>当我们不想让服务器知道我们的ip地址，或者在访问一些国外网站需要国外ip是时，可以使用代理服务器，我们不再用<code>responce = urllib.request.urlopen(request)</code>,而是通过一个代理ip来模拟浏览器，而且要注意proxies是一个字典类型的，要注意格式，使用：</p> 
<pre><code class="prism language-python">proxies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16817'</span>
<span class="token punctuation">}</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>

opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

responce <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
</code></pre> 
<p>来获取responce。</p> 
<pre><code class="prism language-python"><span class="token comment"># 代理服务器</span>
<span class="token comment"># 访问国外站点，访问一些单位或团体内部资源，提高访问速度，隐藏真实ip</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/s?wd=ip'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 请求对象</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment"># 模拟浏览器：</span>
<span class="token comment"># responce = urllib.request.urlopen(request)</span>
proxies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16817'</span>
<span class="token punctuation">}</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>

opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

responce <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 获取相应信息</span>
content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token comment"># 保存</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'daili.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="17_701"></a>17.代理池</h2> 
<p>当我们使用代理ip访问时，访问次数多了也会被封，所以我们可以使用多个ip分别随机访问，这样就不会被检测到了，我们需要引入<code>import random</code>，然后将proxies随机一下，这样就可以每次使用不同的ip了，然后就像代理ip一样输入就好了。</p> 
<pre><code class="prism language-python"><span class="token comment"># 代理池</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
proxies_pool <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16811111'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16822222'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16833333'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">'http'</span><span class="token punctuation">:</span><span class="token string">'118.24.219.151:16844444'</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">import</span> random

proxies <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>proxies_pool<span class="token punctuation">)</span>

url <span class="token operator">=</span> <span class="token string">'http://www.baidu.com/s?wd=ip'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span>proxies <span class="token operator">=</span> proxies<span class="token punctuation">)</span>

opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>

responce <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'daili.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="18xpath_737"></a>18.xpath的基本使用</h2> 
<p>xpath可以用来获取网页源码中的部分数据，这样我们就可以在其中添加条件，来获取我们需要的特定的数据，下面是一个html文件我们在其中查找特定的元素</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>l1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>c1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>北京<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>l2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>上海<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>c1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>武汉<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>c2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>深圳<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>河北<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>东北<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>首先我们要先调用<code>from lxml import etree</code>，然后我们用xpath来解析本地文件，<code>tree = etree.parse('XPATH.html') </code>然后就可以个根据不同的需求获取不同的信息。</p> 
<pre><code class="prism language-python"><span class="token comment"># 获取网页源码部分数据的一种方式</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># xpath解析</span>
<span class="token comment"># (1)本地文件   etree.parse</span>
<span class="token comment"># (2)服务器响应文件 responce.read().decode('utf-8')    *****  etree.HTML()</span>
<span class="token comment"># xpath解析本地文件</span>
tree <span class="token operator">=</span> etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'XPATH.html'</span><span class="token punctuation">)</span>
<span class="token comment"># 1.路径查询：</span>
<span class="token comment">#   //：查找所有子孙节点，不考虑层级关系</span>
<span class="token comment">#   / : 查找子节点</span>
<span class="token comment"># tree.xpath('xpath路径')</span>
<span class="token comment"># lilist = tree.xpath('//body//ul')</span>
<span class="token comment"># 判断列表的长度</span>
<span class="token comment"># print(len(lilist))</span>

<span class="token comment"># 2.谓词查询</span>
<span class="token comment">#   //div[@id]</span>
<span class="token comment">#   //div[@id = "maincontent"]</span>
<span class="token comment"># test()获取标签的内容</span>
lilist <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/li[@id]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>lilist<span class="token punctuation">)</span>
<span class="token comment"># 找到标签为l1的标签</span>
li_list <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/l1[@id = "l1"]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>li_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 查找到id为l1标签的class属性值</span>
<span class="token comment"># 3.属性查询：//@class</span>
li <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/li[@id = "l1"]/@class'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>

<span class="token comment"># 4.模糊查询</span>
<span class="token comment"># //div[contains(@id,"he")] id包含he</span>
<span class="token comment"># //div[starts-with(@id,"he")]  id以he开头</span>
li__list <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/li[contains(@id,"l")]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>li__list<span class="token punctuation">)</span>
<span class="token comment"># 查询id的值以l开头的li标签</span>
liilist <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/li[starts-with(@id,"l")]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>liilist<span class="token punctuation">)</span>
<span class="token comment"># 查询id为l1并且class为c1的</span>
li_list <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul/li[@id = "l1" and @class = "c1"]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>li_list<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="19__806"></a>19.解析_百度一下</h2> 
<p>当我们想象获取“百度一下”这四个字时，用到了xpath工具<br> <img src="https://images2.imgbox.com/e2/db/kCrmUF9p_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token comment"># 获取我们想要的</span>
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># 解析服务器相应的文件</span>
tree <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

result <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//input[@id = "su"]/@value'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="20_835"></a>20.站长素材</h2> 
<p><img src="https://images2.imgbox.com/70/33/cQsaErAE_o.png" alt="在这里插入图片描述"><br> 当我们在站长素材这个网站上下载图片时，首先我们要找到图片的网址，我们发现第一页和其他页不同，第一页是没有page的，所以我们用if-else语句来分别提取出第一页和其他页，然后模拟浏览器向服务器发送请求，并且根据获得的源码在其中找到图片名字和网址所在的子孙类，下载就可以了。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token comment"># 需求：前十页图片，第一页和其他页的数据不同</span>
<span class="token comment"># https://sc.chinaz.com/tupian/weimeiyijingtupian.html</span>
<span class="token comment"># https://sc.chinaz.com/tupian/weimeiyijingtupian_2.html</span>

<span class="token comment"># 请求对象的定制</span>
<span class="token keyword">def</span> <span class="token function">create_request</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>page <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">'https://sc.chinaz.com/tupian/weimeiyijingtupian.html'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">'https://sc.chinaz.com/tupian/weimeiyijingtupian_'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">'.html'</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, likeGecko) Chrome / 127.0.0.0Safari / 537.36'</span>
    <span class="token punctuation">}</span>
    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token keyword">return</span> request
<span class="token comment"># 获取网页源码</span>
<span class="token keyword">def</span> <span class="token function">get_content</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
    content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> content
<span class="token comment"># 下载</span>
<span class="token keyword">def</span> <span class="token function">down_load</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 下载图片</span>
<span class="token comment"># urllib.request.urlretrieve('图片地址','文件名字')</span>
    tree <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    namelist <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class = "container"]//img//@alt'</span><span class="token punctuation">)</span>
<span class="token comment"># 一般图片网站都会懒加载</span>
    srclist <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class = "container"]//img//@data-original'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>namelist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> namelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        src <span class="token operator">=</span> srclist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        url <span class="token operator">=</span> <span class="token string">'https:'</span><span class="token operator">+</span>src
        urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>filename <span class="token operator">=</span> <span class="token string">'./lovlmg/'</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    start_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入起始页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    end_page <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入结束页码'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start_page<span class="token punctuation">,</span>end_page<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 请求对象的定制</span>
        request <span class="token operator">=</span> create_request<span class="token punctuation">(</span>page<span class="token punctuation">)</span>
<span class="token comment"># 获取网页源码</span>
        content <span class="token operator">=</span> get_content<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token comment"># 下载</span>
        down_load<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="21jsonpath_886"></a>21.jsonpath</h2> 
<p>下面是一个json文件，我们使用jsonpath来查找我们想要的元素。在此之前我们都要提前下载jsonpath，在json库中就可以下载<br> <img src="https://images2.imgbox.com/f6/64/D23aGIat_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span> <span class="token string-property property">"store"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"book"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"reference"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"Nigel Rees"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"Sayings of the Century"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">8.95</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"fiction"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"Evelyn Waugh"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"Sword of Honour"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">12.99</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"fiction"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"Herman Melville"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"Moby Dick"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"isbn"</span><span class="token operator">:</span> <span class="token string">"0-553-21311-3"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">8.99</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"category"</span><span class="token operator">:</span> <span class="token string">"fiction"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"J. R. R. Tolkien"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"The Lord of the Rings"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"isbn"</span><span class="token operator">:</span> <span class="token string">"0-395-19395-8"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">22.99</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"bicycle"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"color"</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"price"</span><span class="token operator">:</span> <span class="token number">19.95</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/ce/I9WBkVFq_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> jsonpath

obj <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'解析jsonpath.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(obj)</span>
<span class="token comment"># 书店所有书的作者</span>

author_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$.store.book[*].author'</span><span class="token punctuation">)</span>

<span class="token comment"># print(author_list)</span>

<span class="token comment"># 所有的作者</span>
author_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..author'</span><span class="token punctuation">)</span>
<span class="token comment"># print(author_list)</span>

<span class="token comment"># store下面的所有元素</span>
tag_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$.store.*'</span><span class="token punctuation">)</span>
<span class="token comment"># print(tag_list)</span>

<span class="token comment"># store里所有的钱</span>
price_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$.store..price'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>price_list<span class="token punctuation">)</span>

<span class="token comment"># 第三个书</span>
book <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..book[2]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span>

<span class="token comment"># 最后一本书</span>
book <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..book[(@.length-1)]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span>

<span class="token comment"># 前面的两本书</span>
book_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..book[0,1]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_list<span class="token punctuation">)</span>
<span class="token comment"># 条件过滤需要在()前面加一个?号</span>
<span class="token comment"># 过滤出所有含有isbn的书</span>
book_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..book[?(@.isbn)]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_list<span class="token punctuation">)</span>
<span class="token comment"># 哪本书超过了十块钱</span>
book_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..book[?(@.price&gt;10)]'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>book_list<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="22jsonpath_969"></a>22.用jsonpath解析淘票票</h2> 
<p>这一节我们要在淘票票网站中获取城市信息，首先我们找到网站和城市的json文件，在其中我们要进行切割来获取我们想要的部分。<br> <img src="https://images2.imgbox.com/c9/09/9YchimYk_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url <span class="token operator">=</span> <span class="token string">'https://dianying.taobao.com/cityAction.json?activityId&amp;_ksTS=1722168119996_108&amp;jsoncallback=jsonp109&amp;action=cityAction&amp;n_s=new&amp;event_submit_doGetAllRegion=true'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'accept'</span><span class="token punctuation">:</span><span class="token string">'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01'</span><span class="token punctuation">,</span>
<span class="token string">'accept-language'</span><span class="token punctuation">:</span><span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
<span class="token string">'bx-v'</span><span class="token punctuation">:</span><span class="token string">'2.5.14'</span><span class="token punctuation">,</span>
<span class="token string">'cookie'</span><span class="token punctuation">:</span>
<span class="token string">'t=164d761e0b05d3b06cdd6bf1f9b678a7; cookie2=18db62f7815a4ae14ef8d13a956326d3; v=0; _tb_token_=fbe3708e067b3; cna=u/MsH/Vh8XoCAXzuRuYVHkpC; xlly_s=1; isg=BJCQTO2mwrV1Gp6xP-s5jLwjYd7iWXSjvRF2bIpgH-u-xTFvMmnmM167nY0lECx7'</span><span class="token punctuation">,</span>
<span class="token string">'priority'</span><span class="token punctuation">:</span>
<span class="token string">'u=1, i'</span><span class="token punctuation">,</span>
<span class="token string">'referer'</span><span class="token punctuation">:</span>
<span class="token string">'https://dianying.taobao.com/'</span><span class="token punctuation">,</span>
<span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span>
<span class="token string">'"Not)A;Brand";v="99", "Google Chrome";v="127", "Chromium";v="127"'</span><span class="token punctuation">,</span>
<span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span>
<span class="token string">'?0'</span><span class="token punctuation">,</span>
<span class="token string">'sec-ch-ua-platform'</span><span class="token punctuation">:</span>
<span class="token string">'"Windows"'</span><span class="token punctuation">,</span>
<span class="token string">'sec-fetch-dest'</span><span class="token punctuation">:</span>
<span class="token string">'empty'</span><span class="token punctuation">,</span>
<span class="token string">'sec-fetch-mode'</span><span class="token punctuation">:</span>
<span class="token string">'cors'</span><span class="token punctuation">,</span>
<span class="token string">'sec-fetch-site'</span><span class="token punctuation">:</span>
<span class="token string">'same-origin'</span><span class="token punctuation">,</span>
<span class="token string">'user-agent'</span><span class="token punctuation">:</span>
<span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
<span class="token string">'x-requested-with'</span><span class="token punctuation">:</span>
<span class="token string">'XMLHttpRequest'</span>
<span class="token punctuation">}</span>

request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url <span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token comment"># 切割</span>
content <span class="token operator">=</span> content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'淘票票.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">import</span> json
<span class="token keyword">import</span> jsonpath

obj <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'淘票票.json'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

city_list <span class="token operator">=</span> jsonpath<span class="token punctuation">.</span>jsonpath<span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'$..regionName'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>city_list<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="23BeautifulSoup_1025"></a>23.BeautifulSoup</h2> 
<p>BeautifulSoup是一种解析HTML和XML的第三方库，可以查找文件中的特定标签的元素。<br> 比如以下的HTML文件：</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>l1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>张三<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>l2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>李四<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>王五<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>a1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>哈哈哈<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>嘿嘿嘿嘿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">title</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>a2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>d1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>
        哈哈哦好啊
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>p1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>p1<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>呵呵呵<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-python，">from bs4 import BeautifulSoup

# 通过解析本地文件来讲解bs4的基础语法
# 默认打开文件格式是gbk
soup = BeautifulSoup(open('BeautifulSoup.html',encoding='utf-8'),'lxml')

# print(soup)

# bs4基本语法
# (1)根据标签名字来查找节点
# 找到的是第一个符合条件的数据
# print(soup.a)
# print(soup.a.attrs) # 获取标签的属性和属性值

# bs4的一些函数
# (1) find 返回的是第一个符合条件的数据
# print(soup.find('a'))
# 使用title标签来找到相应的对象
# print(soup.find('a',title = "a2"))
# 可以加一个_来代表html中的class，因为class是python中的类
# print(soup,find('a',class_ = "a1"))
# (2) find_all 返回的是一个列表并且返回了所有的a标签
# print(soup.find_all('a'))
# 如果想获取多个标签的数据，那么需要在find_all的参数中添加的是列表的数据
# print(soup.find_all(['a','span']))
# limit作用是查找前几个数据
# print(soup.find_all('li',limit = 2))

# (3) select（推荐）
# select方法返回的是一个列表，并且会返回多个数据
print(soup.select('a'))
# 可以通过 . 代表class，我们把这种操作叫做类选择器
print(soup.select('.a1'))

# id
# id = l1 ,用 # 代替
print(soup.select('#l1'))

# 属性选择器
# 查找到li标签中有id的标签

print(soup.select('li[id]'))

# 找到id为l2的标签
print(soup.select('li[id = "l2"]'))

# 层级选择器
# 后代选择器
# 找到div下面的li
print(soup.select('div li'))
# 子代选择器
# 某标签的第一级子标签
# 注意：很多的计算机编程语言中如果不加空格不会输出内容，但是在bs4中不会报错
print(soup.select('div &gt; ul &gt; li'))

# 找到a标签和li标签的所有对象
print(soup.select('a,li'))

# 节点信息
# 获取节点内容
obj = soup.select('#d1')[0]
# 如果标签对象中只有内容，但是如果标签对象中除了内容还有标签，那么string中获取不到数据，而get_text()是可以获取的
print(obj.string)
print(obj.get_text())

# 节点的属性
# 通过id来获取p标签
obj = soup.select('#p1')[0]
# name 是标签的名字
print(obj.name)
# 将属性值作为一个字典返回
print(obj.attrs)

# 获取节点的属性
opj = soup.select('#p1')[0]
print(obj.attrs.get('class'))
print(obj.get('class'))
print(obj['class'])

</code></pre> 
<h2><a id="24bs4_1138"></a>24.bs4获取星巴克数据</h2> 
<p>当我们想获取星巴克中咖啡种类的数据时，首先我们找到官网，然后获取到返回数据，使用<code>name_list = soup.select('ul[grid padded-3 product] strong')</code>来获取咖啡名</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

url <span class="token operator">=</span> <span class="token string">'https://www.starbucks.com.cn/menu/'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>

responce <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
<span class="token comment"># //ul[@class = "grid padded-3 product"]//strong/text()</span>
name_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'ul[grid padded-3 product] strong'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> name <span class="token keyword">in</span> name_list<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>string<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="25Selenium_1163"></a>25.Selenium</h2> 
<p>Selenium是一个</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver

<span class="token comment"># Chrome浏览器</span>
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://www.jd.com'</span><span class="token punctuation">)</span>

<span class="token comment"># 获取网页源码</span>
content <span class="token operator">=</span> driver<span class="token punctuation">.</span>page_source

<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>


</code></pre> 
<h2><a id="26selenium_1180"></a>26.selenium元素定位</h2> 
<p>（1）id 可以唯一定位到一个元素（全局唯一）<br> <code>find_element(By.ID, "id名")</code><br> （2）name 要确保是全局唯一的<br> <code>find_element(By.NAME, "name名")</code><br> （3）class name 相当于样式容易重复<br> <code>find_element(By.CLASS_NAME, "class名)"</code><br> （4）link text 有时候不是一个输入框也不是一个按钮，而是一个文字链接，例如百度搜索界面左上角的新闻，可能重复。<br> <code>find_element(By.LINK_TEXT, "link_text名称")</code><br> （5）partial link text 部分链接定位，链接的部分名称，会有重复的可能。<br> <code>find_element(By.PARTIAL_LINK_TEXT, "名称")</code><br> （6）tag name 标签（很多），类似&lt;div模块,&lt;a，&lt;link,&lt;span,&lt;input,非常容易重复。<br> <code>find_element(By.TAG_NAME, "input") find_element(By.TAG_NAME, "名称") find_element(By.TAG_NAME, "标签")</code><br> （7）xpath 全局唯一<br> 获取xpath：右击鼠标-检查，定位到元素，在弹出的elements选中的地方鼠标右击-copy-copyxpath<br> xpath格式注意事项：双引号之间有双引号的时候，把里面的双引号改成单引号。<br> //* 省略了前面的路径<br> <code>find_element(By.XPATH, "名称")</code><br> （8）css selector 元素样式<br> 获取css selector：右击鼠标-检查，定位到元素，在弹出的elements选中的地方鼠标右击-copy-copyselector<br> <code>find_element(By.CSS_SELECTOR, "名称")</code></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># id定位</span>
<span class="token comment"># &lt;input id="toolbar-search-input" autocomplete="off" type="text" value="" placeholder="C++难在哪里？"&gt;</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span><span class="token string">"toolbar-search-input"</span><span class="token punctuation">)</span>
<span class="token comment"># driver.find_element_by_id</span>

<span class="token comment"># name 定位</span>
<span class="token comment"># &lt;meta name="keywords" content="CSDN博客,CSDN学院,CSDN论坛,CSDN直播"&gt;</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span><span class="token string">"keywords"</span><span class="token punctuation">)</span>
<span class="token comment"># driver.find_element_by_name</span>

<span class="token comment"># class 定位</span>
<span class="token comment"># &lt;div class="toolbar-search-container"&gt;</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>CLASS_NAME<span class="token punctuation">,</span><span class="token string">"toolbar-search-container"</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="27Selenium_1224"></a>27.举例Selenium邓紫棋</h2> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver <span class="token comment">#获得浏览器驱动</span>
<span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

<span class="token comment">#获得谷歌浏览器驱动，注意一定要大写浏览器名称</span>
driver<span class="token operator">=</span>webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#输入要打开的网址</span>
url<span class="token operator">=</span><span class="token string">"https://www.baidu.com/"</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token comment">#用id来定位百度搜索框,定位一个是element，定位多个是elements</span>
<span class="token comment">#kw和su都是名字，框中输入名字，点击百度一下</span>
<span class="token comment">#driver.find_elements_by_id("kw").send_keys("邓紫棋")写法已经被弃用</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"kw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"邓紫棋"</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"su"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#太快看不到添加sleep</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># 滑到底部</span>
js_buttom <span class="token operator">=</span> <span class="token string">'document.documentElement.scrollTop=100000'</span>
driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js_buttom<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 获取下一页的按钮</span>
<span class="token builtin">next</span> <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span><span class="token string">"//a[@class='n']"</span><span class="token punctuation">)</span>

<span class="token comment"># 点击下一页</span>
<span class="token builtin">next</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 回到上一页</span>
driver<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">#quit在关闭的同时还能进行清理，close只是关闭</span>
driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="28Selenium__1268"></a>28.Selenium 其他操作</h2> 
<p>元素定位好之后进行<br> （1）click 点击对象</p> 
<pre><code class="prism language-python">click<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#点击百度一下</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"su"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（2）send_keys 在对象上模拟按键输入</p> 
<pre><code class="prism language-python">send_keys<span class="token punctuation">(</span><span class="token string">" 要输入的内容"</span><span class="token punctuation">)</span>
<span class="token comment">#搜索框中输入邓紫棋</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"kw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"邓紫棋"</span><span class="token punctuation">)</span>
</code></pre> 
<p>（3）clear 清除对象的内容</p> 
<pre><code class="prism language-python">clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#清除搜索框中的内容</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"kw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（4）submit 提交表单<br> 如果出现type=“submit”的情况submit 可以替换click操作，效果一样。</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#点击百度一下</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"su"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（5）text 用于获取元素的文本信息</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span>text
<span class="token comment">#获取百度界面上的信息（之后用print打印出来）</span>
text<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"s-top-left"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
</code></pre> 
<p>浏览器的操作<br> （1）浏览器最大化</p> 
<pre><code class="prism language-python">maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（1）设置浏览器宽、高</p> 
<pre><code class="prism language-python">set_window_size<span class="token punctuation">(</span>宽<span class="token punctuation">,</span>高<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>set_window_size<span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">600</span><span class="token punctuation">)</span>
</code></pre> 
<p>（1）操作浏览器的前进、后退</p> 
<pre><code class="prism language-python"><span class="token comment">#后退</span>
back<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#前进</span>
forward<span class="token punctuation">(</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（4）控制浏览器滚动条<br> 用js语言，数值为0滚动条往顶端拉，数值越大滚动条往下端拉。</p> 
<pre><code class="prism language-python">js1<span class="token operator">=</span><span class="token string">"var q=documentElement.Scro1lTop=数值"</span>
<span class="token comment">#滚动条往顶端拉</span>
js1<span class="token operator">=</span><span class="token string">"var q=documentElement.Scro1lTop=0"</span>
<span class="token comment">#滚动条往下拉</span>
js1<span class="token operator">=</span><span class="token string">"var q=documentElement.Scro1lTop=10000"</span>
<span class="token comment">#执行操作</span>
driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span>js1<span class="token punctuation">)</span>
</code></pre> 
<p>6.键盘事件<br> 以一些常用键举例<br> （1）enter键</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys
send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>
</code></pre> 
<p>以禅道的登录为例</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token comment">#导入键盘包</span>
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">"复制禅道登录界面的地址"</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment">#浏览器最大化</span>
driver<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#输入自己的用户名和密码，输完密码后在密码框中点击enter键登录</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"account"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"用户名"</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"密码"</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（2）Tab键</p> 
<pre><code class="prism language-python">切换焦点
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys
send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>TAB<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> time

<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">"输入自己的禅道登录的地址"</span>
driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>maximize_window<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#把光标从登录框切换到密码框</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"account"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"account"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>TAB<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>（3）键盘组合用法</p> 
<pre><code class="prism language-python"><span class="token comment">#ctrl+a 全选输入框内容</span>
send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>CONTROL<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token comment">#ctrl+x 剪切输入框内容</span>
send_keys<span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>CONTROL<span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">)</span>
</code></pre> 
<p>7.鼠标事件<br> 模拟鼠标<br> （1）常用鼠标事件</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys<span class="token punctuation">,</span> ActionChains
<span class="token comment">#右击</span>
<span class="token punctuation">.</span>context_click<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">#双击</span>
double_click<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#拖动</span>
drag_and_drop<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">#移动,把鼠标移动到相应位置</span>
move_to_element<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> 
<p>（2）举例</p> 
<pre><code class="prism language-python"><span class="token comment">#导包</span>
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver <span class="token keyword">import</span> Keys<span class="token punctuation">,</span> ActionChains
<span class="token comment">#假设已经处于禅道登录界面，输入用户名</span>
su<span class="token operator">=</span>driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> <span class="token string">"account"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>
<span class="token comment">#ActionChains首先要知道要操作的是哪个浏览器</span>
<span class="token comment">#右击登录输入框</span>
<span class="token comment">#perform执行</span>
ActionChains<span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">.</span>context_click<span class="token punctuation">(</span>su<span class="token punctuation">)</span><span class="token punctuation">.</span>perform<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="29seleniumphantomjs_1420"></a>29.selenium-phantomjs</h2> 
<p>由于phantomjs已经被很多公司淘汰不再使用，所以这里不做赘述</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Phantomjs<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 已经弃用</span>
</code></pre> 
<h2><a id="30seleniumhandless_1436"></a>30.selenium-handless</h2> 
<p>Chrome Headless是一个无界面的浏览器环境，它是Google Chrome浏览器在59版本之后新增的一种运行模式。与传统的浏览器不同，Chrome Headless可以在后台执行网页操作，而无需显示可见的用户界面。</p> 
<p>Chrome Headless提供了一种方便的方式来进行自动化测试、网络爬虫和数据抓取等任务。它通过模拟用户在浏览器中的行为，实现了对网页的自动化操作和交互。在执行过程中，Chrome Headless可以访问和操纵网页的DOM结构、执行JavaScript代码、提交表单、点击按钮等。</p> 
<p>由于没有可见的界面，Chrome Headless相比传统浏览器具有一些优势。首先，它更轻量级，节省了系统资源，并且执行速度更快。其次，它稳定性高，不受弹窗、广告或其他干扰因素的影响。此外，Chrome Headless还提供了丰富的调试工具和API，方便开发者进行调试和监控。</p> 
<p>使用Selenium框架结合Chrome Headless可以实现自动化测试和网页爬虫等应用场景。开发人员可以利用Selenium的API来编写脚本，控制Chrome Headless执行各种操作，并获取网页内容和处理结果。</p> 
<pre><code class="prism language-python"><span class="token comment"># from selenium import webdriver</span>
<span class="token comment"># from selenium.webdriver.chrome.options import Options</span>

<span class="token comment"># chrome_options = Options()</span>
<span class="token comment"># chrome_options.add_argument('--headless')</span>
<span class="token comment"># chrome_options.add_argument('--disable-gpu')</span>

<span class="token comment"># path = r'C:\Program Files\Google\Chrome\Application\chrome.exe'</span>
<span class="token comment"># chrome_options.binary_location = path</span>

<span class="token comment"># browser = webdriver.Chrome(options = chrome_options)</span>

<span class="token comment"># url = 'https://www.baidu.com'</span>

<span class="token comment"># browser.get(url)</span>

<span class="token comment"># 封装</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>chrome<span class="token punctuation">.</span>options <span class="token keyword">import</span> Options
<span class="token keyword">def</span> <span class="token function">share_browser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
     chrome_options <span class="token operator">=</span> Options<span class="token punctuation">(</span><span class="token punctuation">)</span>
     chrome_options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--headless'</span><span class="token punctuation">)</span>
     chrome_options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--disable-gpu'</span><span class="token punctuation">)</span>
<span class="token comment"># path是Google浏览器的位置</span>
     path <span class="token operator">=</span> <span class="token string">r'C:\Program Files\Google\Chrome\Application\chrome.exe'</span>
     chrome_options<span class="token punctuation">.</span>binary_location <span class="token operator">=</span> path

     browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options <span class="token operator">=</span> chrome_options<span class="token punctuation">)</span>
     <span class="token keyword">return</span> browser
browser <span class="token operator">=</span> share_browser<span class="token punctuation">(</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>

</code></pre> 
<h2><a id="31request_1478"></a>31.request基本使用</h2> 
<p>request类似于urllib，但是request是python中独有的库，能用更简短的代码写出和urllib同样的效果，request中有一个类型和六个属性，和urllib是相似的</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com'</span>

responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">)</span>

<span class="token comment"># 一个类型和六个属性</span>
<span class="token comment"># responce类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>responce<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 设置编码格式</span>
responce<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
<span class="token comment"># 以字符串的形式返回了网页源码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

<span class="token comment"># 返回一个url地址</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token comment"># 返回的是二进制的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token comment"># 返回相应的状态码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
<span class="token comment"># 返回的是响应头</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>responce<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="requestget_1505"></a>request中的get请求</h2> 
<p>首先分析一下urllib和request的区别，然后我们在request中只需要</p> 
<pre><code class="prism language-python">responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>text
</code></pre> 
<p>这两行代码就可以搞定，还是很便捷的。再传入时，在get中有一个param参数，是可以传入输入参数的。</p> 
<pre><code class="prism language-python"><span class="token comment"># urllib</span>
<span class="token comment"># （1）一个类型和六个方法</span>
<span class="token comment"># （2）get请求</span>
<span class="token comment"># （3）post请求，百度翻译</span>
<span class="token comment"># （4）ajax 的 post请求</span>
<span class="token comment"># （5）ajax 的 post请求</span>
<span class="token comment"># （6）cookie登录 微博</span>
<span class="token comment"># （7）代理</span>

<span class="token comment"># request</span>
<span class="token comment"># （1）一个类型和六个属性</span>
<span class="token comment"># （2）get请求</span>
<span class="token comment"># （3）post请求</span>
<span class="token comment"># （4）代理</span>
<span class="token comment"># （5）cookie验证码</span>

<span class="token keyword">import</span> requests
<span class="token comment"># 问号也可以不加</span>
url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/s?'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'wd'</span> <span class="token punctuation">:</span> <span class="token string">'北京'</span>
<span class="token punctuation">}</span>
<span class="token comment"># url叫做请求资源路径，params叫做参数，kwargs是字典</span>
responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>text
<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token comment"># 参数无需urlencode编码</span>
<span class="token comment"># 参数需要params传递</span>
<span class="token comment"># 不需要请求对象定制</span>

</code></pre> 
<h2><a id="32requestpost_1553"></a>32.request中的post请求</h2> 
<p>在request中post请求中，我们还是据百度翻译的例子，这次post请求中的data也是传入的参数，由于content返回的是字符串类型，我们通过json编码为字典，这样我们就可以看懂了。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://fanyi.baidu.com/sug'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
<span class="token string">'cookie'</span> <span class="token punctuation">:</span>
<span class="token string">'BAIDUID_BFESS=7AD549AF735289E0C107221311EA1BE0:FG=1; BIDUPSID=7AD549AF735289E0C107221311EA1BE0; PSTM=1722243178; ZFY=:Aw39gqGc9br6vsj:BXTHad0qWcTvm9FKwjHVw648DZCg:C; BA_HECTOR=01040k8ga405052l0405a12l9ostdu1jajvkn1u; BDRCVFR[V3EOV_cRy1C]=mk3SLVN4HKm; H_PS_PSSID=60453_60470_60492_60500_60519_60552_60566_60554; delPer=0; PSINO=1; BDORZ=FFFB88E999055A3F8A630C64834BD6D0; ab_sr=1.0.1_NTU5NjJiZTkxMGQ4YWM4YzkzODU2YzIwMGE1MmIxNTg3MDc5ODIxZGI2YWY4NDY1YmZlOWY2ZmNjNjc2MjdmZTdmMTRkMjdkZjJkZGM3MjBhZDI5MWM0NzMzODVkYjkwYzZiNTcxNDk3YjZjZjQ3NmYyNDE1OWNkYzU3NzBjODg5NWNjYWM3YzY3ZTcyMGQxMTgzY2QwMTI5ZDRmZTZiZQ==; RT="z=1&amp;dm=baidu.com&amp;si=24cae920-18e9-4b5b-8bb3-c1f662e67412&amp;ss=lz9u6d1w&amp;sl=1&amp;tt=l0&amp;bcn=https%3A%2F%2Ffclog.baidu.com%2Flog%2Fweirwood%3Ftype%3Dperf&amp;ld=1d0"'</span>
<span class="token punctuation">}</span>

data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'kw'</span> <span class="token punctuation">:</span> <span class="token string">'eye'</span>

<span class="token punctuation">}</span>
<span class="token comment"># url请求地址，data请求参数，kwargs字典</span>
responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>text

<span class="token keyword">import</span> json

obj <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>content<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="33request__1582"></a>33.request_代理</h2> 
<p>这个也就是多个ip传入防止被查封，只要把proxy代理ip传入就可以了</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/s?'</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'wd'</span> <span class="token punctuation">:</span> <span class="token string">'ip'</span>
<span class="token punctuation">}</span>

proxy <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'https'</span> <span class="token punctuation">:</span> <span class="token string">'121.230.210.31:3256'</span>
<span class="token punctuation">}</span>
responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>proxies<span class="token operator">=</span>proxy<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>text

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'daili2.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="34request_1607"></a>34.request免验证登录古诗词网</h2> 
<p><img src="https://images2.imgbox.com/28/fc/iygTiBMC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/33/c6/mJKJggPA_o.png" alt="在这里插入图片描述"></p> 
<p>在这其中我们也不知道那些数据是有用的，所以我们先观察：<br> <img src="https://images2.imgbox.com/7e/90/LAu9lxkQ_o.png" alt="在这里插入图片描述"><br> 在这些数据中由两个我们没有找到的<code># __VIEWSTATE: vmkHKKt/kQxZnU3DdbFiulx/YaTER7m22csaKd4SZSS8an8DiKnioUZXZti28v5Kj7ouFNngtqLop5buxudkBNq5I+0NvucbIfDZjyUxRs5l5Iv7EY/tkDhCR0Ez21N/6JCIXHwPhAy055YerBP/kY98yi8= __VIEWSTATEGENERATOR: C93BE1AE</code>，这时我们在源码中找到：<br> <img src="https://images2.imgbox.com/c5/c0/4C5Ulz6o_o.png" alt="在这里插入图片描述"><br> 这里显示这两个Hidden的数据，说明这两个我们是无法查看的，之后我们用request获取网页源码，并用bs4来获取这两个数据，之后我们又在登录页面找到了验证码的相关图片，我们把它下载下来，通过session的工具来表示我们这两次登录（我们下一次还要登陆），是相同的，然后利用ddddocr 来读取图片中的信息，</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> ddddocr                       <span class="token comment"># 导入 ddddocr</span>
ocr <span class="token operator">=</span> ddddocr<span class="token punctuation">.</span>DdddOcr<span class="token punctuation">(</span>show_ad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>      <span class="token comment"># 实例化</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'code.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>     <span class="token comment"># 打开图片</span>
    img_bytes <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment"># 读取图片</span>
res <span class="token operator">=</span> ocr<span class="token punctuation">.</span>classification<span class="token punctuation">(</span>img_bytes<span class="token punctuation">)</span>  <span class="token comment"># 识别</span>
</code></pre> 
<p>这样我们就可以获取到所有的信息了，之后通过data传入后我们就可以登录进页面了。</p> 
<pre><code class="prism language-python"><span class="token comment"># 古诗词网</span>
<span class="token comment"># 通过登录然后进入到主页面</span>
<span class="token comment"># 通过找登录接口发现登录的时候需要的参数很多</span>
<span class="token comment"># __VIEWSTATE: vmkHKKt/kQxZnU3DdbFiulx/YaTER7m22csaKd4SZSS8an8DiKnioUZXZti28v5Kj7ouFNngtqLop5buxudkBNq5I+0NvucbIfDZjyUxRs5l5Iv7EY/tkDhCR0Ez21N/6JCIXHwPhAy055YerBP/kY98yi8=</span>
<span class="token comment"># __VIEWSTATEGENERATOR: C93BE1AE</span>
<span class="token comment"># from: http://www.gushiwen.cn/user/collect.aspx</span>
<span class="token comment"># email: 19933725376</span>
<span class="token comment"># pwd: jijiji</span>
<span class="token comment"># code: ZVMZ</span>
<span class="token comment"># denglu: 登录</span>

<span class="token comment"># 我们观察到__VIEWSTATE,__VIEWSTATEGENERATOR，不认识</span>
<span class="token comment"># code是一个变化的量</span>
<span class="token comment"># 难点（1）：__VIEWSTATE,__VIEWSTATEGENERATOR</span>
<span class="token comment"># 通过源码可以知道我们找到了这两个值，所以只要我们获取源码，再解析就可以了</span>
<span class="token comment"># 难点（2）：验证码</span>
<span class="token keyword">import</span> requests

<span class="token comment"># 登录页面</span>
url <span class="token operator">=</span> <span class="token string">'https://www.gushiwen.cn/user/login.aspx?from=http://www.gushiwen.cn/user/collect.aspx'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment"># 获取页面源码</span>
responce <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

content <span class="token operator">=</span> responce<span class="token punctuation">.</span>text

<span class="token comment"># 解析页面源码，然后获取__VIEWSTATE,__VIEWSTATEGENERATOR</span>
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>

<span class="token comment"># 获取__VIEWSTATE</span>
viewstate <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">"#__VIEWSTATE"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token comment"># 获取__VIEWSTATEGENERATOR</span>
viewstategenerator <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#__VIEWSTATEGENERATOR'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>
<span class="token comment"># 获取验证码图片</span>
code <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#imgCode'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
code_url <span class="token operator">=</span> <span class="token string">'https://so.gushiwen.cn'</span> <span class="token operator">+</span> code


<span class="token comment"># session()方法 使请求对象变成一个对象</span>
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
responce_code <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>code_url<span class="token punctuation">)</span>
<span class="token comment"># 注意此时要使用二进制数据</span>
content_code <span class="token operator">=</span> responce_code<span class="token punctuation">.</span>content
<span class="token comment"># wb的模式就是将二进制数据写入文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'code.jpg'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content_code<span class="token punctuation">)</span>
<span class="token comment"># 把图片下载到本地之后，观察验证码</span>
<span class="token keyword">import</span> ddddocr                       <span class="token comment"># 导入 ddddocr</span>
ocr <span class="token operator">=</span> ddddocr<span class="token punctuation">.</span>DdddOcr<span class="token punctuation">(</span>show_ad<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>      <span class="token comment"># 实例化</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'code.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>     <span class="token comment"># 打开图片</span>
    img_bytes <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment"># 读取图片</span>
res <span class="token operator">=</span> ocr<span class="token punctuation">.</span>classification<span class="token punctuation">(</span>img_bytes<span class="token punctuation">)</span>  <span class="token comment"># 识别</span>
<span class="token comment"># 点击登录</span>
url_post <span class="token operator">=</span>  <span class="token string">'https://www.gushiwen.cn/user/login.aspx?from=http://www.gushiwen.cn/user/collect.aspx'</span>

data_post <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
<span class="token string">'__VIEWSTATE'</span><span class="token punctuation">:</span> viewstate<span class="token punctuation">,</span>
<span class="token string">'__VIEWSTATEGENERATOR'</span><span class="token punctuation">:</span>viewstategenerator<span class="token punctuation">,</span>
<span class="token string">'from'</span><span class="token punctuation">:</span> <span class="token string">'http://www.gushiwen.cn/user/collect.aspx'</span><span class="token punctuation">,</span>
<span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'19933725376'</span><span class="token punctuation">,</span>
<span class="token string">'pwd'</span><span class="token punctuation">:</span> <span class="token string">'Ylp197419'</span><span class="token punctuation">,</span>
<span class="token string">'code'</span><span class="token punctuation">:</span> res<span class="token punctuation">,</span>
<span class="token string">'denglu'</span><span class="token punctuation">:</span> <span class="token string">'登录'</span>
<span class="token punctuation">}</span>

responce_post <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data_post<span class="token punctuation">)</span>
content_post <span class="token operator">=</span> responce_post<span class="token punctuation">.</span>text

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'gushiwen.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content_post<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="35scrapy_1703"></a>35.scrapy基本使用</h2> 
<p>scrapy项目的建立<br> 1.创建爬虫的项目 scrapy startproject 项目的名字<br> 注意：项目的名字不允许使用数字开头 也不能包含中文<br> 2.创建爬虫文件：<br> 要在spider文件夹中去创建爬虫文件<br> cd 项目的名字\项目的名字\spiders<br> cd scrapy_baidu_001\scrapy_baidu_001\spiders</p> 
<pre><code>            创建爬虫文件
            scrapy genspider 爬虫文件的名字 要爬取的网页
            eg : scrapy genspider baidu www.baidu.com
            一般不需要添加https://
            因为文件中自动添加https://
</code></pre> 
<p>3.运行爬虫代码<br> scrapy crawl 爬虫的名字<br> eg: scrapy crawl baidu</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">BaiduSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 爬虫的名字  用于使用爬虫的时候使用的值</span>
    name <span class="token operator">=</span> <span class="token string">"baidu"</span>
<span class="token comment"># 允许访问的域名</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"www.baidu.com"</span><span class="token punctuation">]</span>
<span class="token comment"># 起始的url地址 指的是第一次访问的域名 也就是在allowed_domains的前面加了https://</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">]</span>

<span class="token comment"># 运行start_urls之后执行的方法，方法中的responce就是返回的对象</span>
<span class="token comment"># 相当于responce = urllib.request.urlopen()</span>
<span class="token comment"># 也相当于responce = requests.get()</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"苍茫的天涯是我的爱"</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="3658_1739"></a>36.58同城实例</h2> 
<p>1.scrapy项目的结构<br> 项目名字<br> 项目名字<br> spiders文件夹（存储的是爬出文件）<br> init<br> 自定义的爬虫文件<br> init<br> items 定义数据结构的地方，爬取的内容都包含哪些<br> middlewares 中间件 代理<br> pipelines 管道 用来处理下载的数据<br> settings 配置文件 一般robot协议，ua定义等</p> 
<p>2.responce的属性和方法<br> responce.text 获取相应的字符串<br> responce.body 获取的是二进制数据<br> responce.xpath(’ 这里写xpath路径 ') 直接用xpath方法来解析responce中的内容<br> responce.extract() 提取seletor对象的data属性值<br> responce.extract_first() 提取列表的第一个数据</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">TcSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"tc"</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"cangzhou.58.com"</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://cangzhou.58.com/sou/?key=%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        content <span class="token operator">=</span> response<span class="token punctuation">.</span>text
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"===================="</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="37_1775"></a>37.汽车之家</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">CarSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"car"</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"car.autohome.com.cn"</span><span class="token punctuation">]</span>
<span class="token comment"># 后面是html时，后面不能加/</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://car.autohome.com.cn/price/brand-15.html"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class = "main-title"]/a/text()'</span><span class="token punctuation">)</span>
        price_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class = "main-lever"]//span/span/text()'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>name_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            name <span class="token operator">=</span> name_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            price <span class="token operator">=</span> price_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>price<span class="token punctuation">)</span>

</code></pre> 
<pre><code class="prism language-python">BOT_NAME <span class="token operator">=</span> <span class="token string">"scrapy_carhome_003"</span>

SPIDER_MODULES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"scrapy_carhome_003.spiders"</span><span class="token punctuation">]</span>
NEWSPIDER_MODULE <span class="token operator">=</span> <span class="token string">"scrapy_carhome_003.spiders"</span>

</code></pre> 
<h2><a id="38_1804"></a>38.当当网</h2> 
<p>当当网爬取书名，图片和价格</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy_dangdang_004<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapyDangdang004Item

<span class="token keyword">class</span> <span class="token class-name">DangSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"dang"</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"category.dangdang.com"</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://category.dangdang.com/cp01.01.02.00.00.00.html"</span><span class="token punctuation">]</span>

    base_url <span class="token operator">=</span> <span class="token string">'https://category.dangdang.com/pg'</span>
    page <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># pipeline 下载数据</span>
<span class="token comment"># item 定义数据结构</span>
<span class="token comment"># src = '//ul[@id="component_59"]/li//img/@data-original'</span>
<span class="token comment"># alt = '//ul[@id="component_59"]/li//img/@alt'</span>
<span class="token comment"># price = '//ul[@id="component_59"]/li//p[@class = "price"]/span[1]/text()'</span>
        li_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//ul[@id="component_59"]/li'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
            <span class="token comment"># 第一张图片和其他的不一样</span>
            src <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//img/@data-original'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> src<span class="token punctuation">:</span>
                src <span class="token operator">=</span> src
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                src <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            name <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//img/@alt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            price <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'.//p[@class = "price"]/span[1]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>

            book <span class="token operator">=</span> ScrapyDangdang004Item<span class="token punctuation">(</span>src <span class="token operator">=</span> src<span class="token punctuation">,</span>name <span class="token operator">=</span> name <span class="token punctuation">,</span>price<span class="token operator">=</span>price<span class="token punctuation">)</span>
            <span class="token comment"># yield就是返回一个值,有一个book就交给pipelines</span>
            <span class="token keyword">yield</span> book

<span class="token comment">#       每一页的爬取的业务逻辑都是一样的，所以我们只需要将执行的那个页面的请求再次调用parse方法就可以了</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>page <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>page <span class="token operator">=</span> self<span class="token punctuation">.</span>page <span class="token operator">+</span> <span class="token number">1</span>

            url <span class="token operator">=</span> self<span class="token punctuation">.</span>base_url <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>page<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'-cp01.01.02.00.00.00.html'</span>
        <span class="token comment"># 怎么去调用parse方法</span>
        <span class="token comment"># scrapy.Request就是scrapy的get请求</span>
            <span class="token comment"># url就是请求地址，callback就是你要执行的那个函数，parse不允许加圆括号</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>

</code></pre> 
<p>items:</p> 
<pre><code class="prism language-python"><span class="token comment"># Define here the models for your scraped items</span>
<span class="token comment">#</span>
<span class="token comment"># See documentation in:</span>
<span class="token comment"># https://docs.scrapy.org/en/latest/topics/items.html</span>

<span class="token keyword">import</span> scrapy


<span class="token keyword">class</span> <span class="token class-name">ScrapyDangdang004Item</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># define the fields for your item here like:</span>
    <span class="token comment"># name = scrapy.Field()</span>
    <span class="token comment"># 通俗的说就是你要下载的数据都有什么</span>
    <span class="token comment"># 图片</span>
    src <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 名字</span>
    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 价格</span>
    price <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>pipelines:</p> 
<pre><code class="prism language-python"><span class="token comment"># Define your item pipelines here</span>
<span class="token comment">#</span>
<span class="token comment"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="token comment"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>


<span class="token comment"># useful for handling different item types with a single interface</span>
<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter

<span class="token comment"># 如果想使用管道的话，就必须在settings中开启管道</span>
<span class="token keyword">class</span> <span class="token class-name">ScrapyDangdang004Pipeline</span><span class="token punctuation">:</span>
    <span class="token comment"># 在爬虫文件执行之前就执行</span>
    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'book.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>

    <span class="token comment"># items 就是yield 后面的 book 对象</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment">#  with open('book.json','a',encoding='utf-8') as fp:</span>
<span class="token comment"># write方法必须要写一个字符串，而不能是其他的对象</span>
<span class="token comment"># w模式会每一个对象都打开一次文件，之后覆盖之前的数据</span>
<span class="token comment"># fp.write(str(item))</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
    <span class="token comment"># 在爬虫文件结束之后执行的方法</span>
    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 多条管道同时下载</span>
<span class="token comment"># 定义管道类</span>
<span class="token comment"># 在settings中开启管道</span>
<span class="token comment"># "scrapy_dangdang_004.pipelines.DangDangDownload":301</span>
<span class="token keyword">class</span> <span class="token class-name">DangDangDownload</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">'https:'</span><span class="token operator">+</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span>
        filename <span class="token operator">=</span> <span class="token string">'./books/'</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
        urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>filename<span class="token operator">=</span>filename<span class="token punctuation">)</span>
        <span class="token keyword">return</span> item

</code></pre> 
<p>settings:</p> 
<pre><code class="prism language-python">BOT_NAME <span class="token operator">=</span> <span class="token string">"scrapy_dangdang_004"</span>

SPIDER_MODULES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"scrapy_dangdang_004.spiders"</span><span class="token punctuation">]</span>
NEWSPIDER_MODULE <span class="token operator">=</span> <span class="token string">"scrapy_dangdang_004.spiders"</span>



ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment"># 管道可以有很多个，管道是有优先级的，优先级是1到1000，值越小优先级越高</span>
    <span class="token string">"scrapy_dangdang_004.pipelines.ScrapyDangdang004Pipeline"</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token string">"scrapy_dangdang_004.pipelines.DangDangDownload"</span><span class="token punctuation">:</span><span class="token number">301</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="39_1932"></a>39.电影天堂</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy_movie_099<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapyMovie099Pipeline

<span class="token keyword">class</span> <span class="token class-name">MvSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"mv"</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"www.dytt8.net"</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://www.dytt8.net/html/gndy/china/index.html"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a_list <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="co_content8"]//td[2]//a[2]'</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> a <span class="token keyword">in</span> a_list<span class="token punctuation">:</span>
            name <span class="token operator">=</span> a<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            href <span class="token operator">=</span> a<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 第二页的地址</span>
            url <span class="token operator">=</span> <span class="token string">'https://www.dytt8.net'</span> <span class="token operator">+</span> href
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_second<span class="token punctuation">,</span>meta <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span> <span class="token punctuation">:</span> name<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_second</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>responce<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 注意：如果拿不到数据，一定要检查xpath语法是否正确</span>
        src <span class="token operator">=</span> responce<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@id = "Zoom"]//img/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract_first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        name <span class="token operator">=</span> responce<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>

        movie <span class="token operator">=</span> ScrapyMovie099Pipeline<span class="token punctuation">(</span>src <span class="token operator">=</span> src<span class="token punctuation">,</span>name<span class="token operator">=</span>name<span class="token punctuation">)</span>
        <span class="token keyword">yield</span> movie
</code></pre> 
<p>piplines:</p> 
<pre><code class="prism language-python"><span class="token comment"># Define your item pipelines here</span>
<span class="token comment">#</span>
<span class="token comment"># Don't forget to add your pipeline to the ITEM_PIPELINES setting</span>
<span class="token comment"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span>


<span class="token comment"># useful for handling different item types with a single interface</span>
<span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter


<span class="token keyword">class</span> <span class="token class-name">ScrapyMovie099Pipeline</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'movie.json'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="40crawlspider_1983"></a>40.crawlspider</h2> 
<p>CrawlSpider<br> Spider是爬虫文件中爬虫类的父类，CrawlSpider是它的子类。多被用作于专业实现全站数据爬取，将一个页面下所有页码对应的数据进行爬取。</p> 
<p>创建项目<br> 创建scrapy工程： scrapy startproject ProjectName<br> 进入工程：cd ProjectName<br> 创建crawlspider项目：scrapy genspider -t crawl SpiderName www.xxx.com<br> 回顾 创建普通爬虫项目：scrapy genspider SpiderName www.xxx.com</p> 
<p>crawlspider默认生成的内容</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider<span class="token punctuation">,</span> Rule


<span class="token keyword">class</span> <span class="token class-name">FutureSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'future'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'www.xxx.com/'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.xxx.com/'</span><span class="token punctuation">]</span>

    rules <span class="token operator">=</span> <span class="token punctuation">(</span>
        Rule<span class="token punctuation">(</span>LinkExtractor<span class="token punctuation">(</span>allow<span class="token operator">=</span><span class="token string">r'Items/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token string">'parse_item'</span><span class="token punctuation">,</span> follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        i <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token comment">#i['domain_id'] = response.xpath('//input[@id="sid"]/@value').extract()</span>
        <span class="token comment">#i['name'] = response.xpath('//div[@id="name"]').extract()</span>
        <span class="token comment">#i['description'] = response.xpath('//div[@id="description"]').extract()</span>
        <span class="token keyword">return</span> i
</code></pre> 
<p>crawlspider中没有parse函数</p> 
<p>LinkExtractors 链接提取器<br> 链接提取器：根据指定规则（参数：allow = ‘正则’ 提取链接的规则）在页面中进行链接（URL）的提取。每个LinkExtractors有唯一的公共方法extract_links()，它接收一个Response对象，并返回一个scrapy.link.Link对象｡链接提取器，要实例化一次和extract_links方法会根据不同的响应调用多次提取链接｡</p> 
<p>常用参数<br> 以下都包含str or list<br> allow：allow = ‘re’，满足括号中正则的值会被提取，如果为空（allow = r’'）则会全部匹配，提取所有<br> deny：URL必须匹配才能被排除（即，未提取）的单个正则表达式（或正则表达式列表）。它优先于allow参数。如果未给出（或为空），则不会排除任何链接。<br> allow_domains：该domains（URL范围）会被提取的，如[‘www.baidu.com’,‘www.sogou.com’]<br> deny_domains：该domains（URL范围）不会被提取的<br> strict_xpaths：是一个XPath（或XPath的列表），和allow共同过滤URL，只有xpath满足的范围内的URL会被提取</p> 
<p>rules(Rule 规则解析器)<br> 接收链接提取器提取到的所有链接，对其发送请求，并根据指定规则（callback）解析数据。rules中可以有1个或多个Rule对象，每个Rule定制特定操作，如有重复，则按序使用。</p> 
<p>常用参数<br> rules是一个元组或列表，包含Rule参数<br> LinkExtractor：链接提取器，通过正则或xpath进行页面URL匹配<br> callback：通过LinkExtractor提取的URL返回的响应数据的回调函数，没有则表示不会对响应数据进行回调函数的处理<br> follow：LinkExtractor提取的URL对应的响应数据是否还会继续被rules中的规则进行提取</p> 
<p>That’s all.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2a795995b92dd3858dc626afa45aca0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">文心一言的实用指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f3a838022920792f4fdeba041247adf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">欧科云链7月安全月报 | 私钥泄露损失约占总损失88%，超2.6亿美元</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>