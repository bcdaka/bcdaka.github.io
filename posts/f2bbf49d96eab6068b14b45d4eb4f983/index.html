<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【RabbitMQ】基于rabbitMQ 实现 MQTT server服务端 | 快速拉起mqtt服务 | docker 部署 RabbitMQ 配置 MQTT - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f2bbf49d96eab6068b14b45d4eb4f983/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【RabbitMQ】基于rabbitMQ 实现 MQTT server服务端 | 快速拉起mqtt服务 | docker 部署 RabbitMQ 配置 MQTT">
  <meta property="og:description" content="基于rabbitMq的MQTT rabbitmq的官方文档地址：https://www.rabbitmq.com/docs/mqtt
目前已经支持的MQTT版本如下：3.1、3.1.1、5.0
1、创建rabbitMQ 服务 一键拉起rabbitmq
&gt; docker run -d --name rabbitmq --restart always -p 15672:15672 -p 5672:5672 -p 1883:1883 rabbitmq:3-management 1.1、端口说明 在使用 Docker 部署 RabbitMQ 并开通 MQTT 服务时，你需要确保以下端口在安全组中是开放的：
AMQP 端口（默认端口：5672）： 这是 RabbitMQ 使用的端口，用于 AMQP 协议。确保你的安全组允许来自需要访问 RabbitMQ 的客户端的流量通过这个端口。
管理界面端口（默认端口：15672）： 如果你需要访问 RabbitMQ 的 Web 管理界面，你需要开放这个端口。
MQTT 端口（默认端口：1883）： 这是 MQTT 服务使用的端口。确保这个端口也被安全组允许通过，以便 MQTT 客户端可以连接到 RabbitMQ 的 MQTT 服务。
在我们启动docker container时，没有修改映射的端口，则可以直接使用如上端口
根据你的安全策略和网络配置，你可能还需要考虑其他端口或配置，例如 TLS 加密通信等。确保只开放必要的端口，并采取适当的安全措施来保护你的 RabbitMQ 服务。
1.2、dashboard - 检查 5672、1883 端口 使用telnet如果没有refused则说明端口放开且是通的
telnet 127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-11T13:53:23+08:00">
    <meta property="article:modified_time" content="2024-04-11T13:53:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【RabbitMQ】基于rabbitMQ 实现 MQTT server服务端 | 快速拉起mqtt服务 | docker 部署 RabbitMQ 配置 MQTT</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="rabbitMqMQTT_0"></a>基于rabbitMq的MQTT</h2> 
<p>rabbitmq的官方文档地址：<a href="https://www.rabbitmq.com/docs/mqtt" rel="nofollow">https://www.rabbitmq.com/docs/mqtt</a><br> 目前已经支持的MQTT版本如下：<code>3.1</code>、<code>3.1.1</code>、<code>5.0</code><br> <img src="https://images2.imgbox.com/91/b3/hhQzhTDR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1rabbitMQ__6"></a>1、创建rabbitMQ 服务</h3> 
<blockquote> 
 <p>一键拉起rabbitmq</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> rabbitmq <span class="token parameter variable">--restart</span> always <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token parameter variable">-p</span> <span class="token number">1883</span>:1883 rabbitmq:3-management
</code></pre> 
<h4><a id="11_12"></a>1.1、端口说明</h4> 
<p>在使用 Docker 部署 RabbitMQ 并开通 MQTT 服务时，你需要确保以下端口在安全组中是开放的：</p> 
<ul><li> <p><strong>AMQP 端口</strong>（默认端口：<code>5672</code>）： 这是 RabbitMQ 使用的端口，用于 AMQP 协议。确保你的安全组允许来自需要访问 RabbitMQ 的客户端的流量通过这个端口。</p> </li><li> <p><strong>管理界面端口</strong>（默认端口：<code>15672</code>）： 如果你需要访问 RabbitMQ 的 Web 管理界面，你需要开放这个端口。</p> </li><li> <p><strong>MQTT 端口</strong>（默认端口：<code>1883</code>）： 这是 MQTT 服务使用的端口。确保这个端口也被安全组允许通过，以便 MQTT 客户端可以连接到 RabbitMQ 的 MQTT 服务。</p> </li></ul> 
<p>在我们启动docker container时，没有修改映射的端口，则可以直接使用如上端口<br> 根据你的安全策略和网络配置，你可能还需要考虑其他端口或配置，例如 TLS 加密通信等。确保只开放必要的端口，并采取适当的安全措施来保护你的 RabbitMQ 服务。</p> 
<h4><a id="12dashboard___56721883__25"></a>1.2、dashboard - 检查 5672、1883 端口</h4> 
<blockquote> 
 <p>使用telnet如果没有refused则说明端口放开且是通的</p> 
</blockquote> 
<pre><code class="prism language-bash">telnet <span class="token number">127.0</span>.0.1 <span class="token number">5672</span>
telnet <span class="token number">127.0</span>.0.1 <span class="token number">1883</span>
</code></pre> 
<h4><a id="13dashboard___15672__32"></a>1.3、dashboard - 检查 15672 端口</h4> 
<blockquote> 
 <p>http://127.0.0.1:15672/#/ 可以看到dashboard界面<br> 如果我们没有在启动容器时，设置账号密码<br> 则默认账号密码如下：<br> 账号：<code>guest</code><br> 密码：<code>guest</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/7c/7a/YdrYzyuP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2MQTT_42"></a>2、配置MQTT服务</h3> 
<h4><a id="21Docker__MQTT__44"></a>2.1、Docker 容器中配置 MQTT 插件</h4> 
<p>要在 Docker 容器中配置 MQTT 插件： 进入 RabbitMQ 容器，启用 MQTT 插件，退出后并重新启动 RabbitMQ docker服务。</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rabbitmq /bin/bash
rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_mqtt
<span class="token comment"># 然后退出容器</span>
<span class="token builtin class-name">exit</span>
</code></pre> 
<p>重启RabbitMQ的docker服务</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> restart rabbitmq
</code></pre> 
<h4><a id="22MQTT_59"></a>2.2、配置MQTT账号密码</h4> 
<p>在默认情况下，RabbitMQ 安装后是没有账号密码的，也就是说初始情况下，你可以直接连接到 RabbitMQ 服务。但是，为了安全起见，你应该设置一个密码来保护 RabbitMQ 服务器。</p> 
<p>你可以通过以下步骤设置 RabbitMQ 的账号密码：（<code>无需重启docker</code>）</p> 
<p>启用 RabbitMQ 管理插件： 如果你还没有启用 RabbitMQ 的管理插件，你可以使用以下命令启用它：</p> 
<pre><code class="prism language-bash">rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management
</code></pre> 
<p><img src="https://images2.imgbox.com/4f/c6/UtqINHwC_o.png" alt="在这里插入图片描述"></p> 
<p>创建用户： 使用以下命令创建一个新用户（例如，用户名为 “admin”）：</p> 
<pre><code class="prism language-bash">rabbitmqctl add_user admin your_password
</code></pre> 
<p><img src="https://images2.imgbox.com/25/72/FmzixwYz_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">rabbitmqctl set_permissions <span class="token parameter variable">-p</span> / admin <span class="token string">".*"</span> <span class="token string">".*"</span> <span class="token string">".*"</span>
</code></pre> 
<p>这会创建一个名为 “admin” 的用户，并将密码设置为 “your_password”。记得将 “your_password” <code>替换为你想要设置的密码</code>。</p> 
<p>授予管理员权限： 使用以下命令为新用户授予管理员权限：</p> 
<pre><code class="prism language-bash">rabbitmqctl set_user_tags admin administrator
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/71/kTqphIdT_o.png" alt="在这里插入图片描述"></p> 
<p>设置权限： 最后，你可能需要设置权限，以便用户可以执行所需的操作。例如，你可以使用以下命令授予用户对所有虚拟主机的完全权限：</p> 
<pre><code class="prism language-bash">rabbitmqctl set_permissions <span class="token parameter variable">-p</span> / admin <span class="token string">".*"</span> <span class="token string">".*"</span> <span class="token string">".*"</span>
</code></pre> 
<p>这将为用户 “admin” 授予对所有虚拟主机的所有操作权限。</p> 
<p><img src="https://images2.imgbox.com/76/82/lXcmlBb8_o.png" alt="在这里插入图片描述"></p> 
<p>通过执行这些步骤，你就可以设置一个账号密码来保护 RabbitMQ 服务器了。确保密码足够安全，并且只向需要访问 RabbitMQ 的用户分享。</p> 
<h3><a id="3MQTT_104"></a>3、测试MQTT链接</h3> 
<h4><a id="31golang_MQTT_demo_106"></a>3.1、golang 链接MQTT demo</h4> 
<blockquote> 
 <p>使用代码链接MQTT 并将 <code>client_id</code> 设置为 <code>go_client</code></p> 
</blockquote> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"os"</span>
	<span class="token string">"os/signal"</span>
	<span class="token string">"syscall"</span>

	MQTT <span class="token string">"github.com/eclipse/paho.mqtt.golang"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span>client MQTT<span class="token punctuation">.</span>Client<span class="token punctuation">,</span> message MQTT<span class="token punctuation">.</span>Message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Received message on topic: %s\n"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">Topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Message: %s\n"</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">Payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建 MQTT 连接参数</span>
	opts <span class="token operator">:=</span> MQTT<span class="token punctuation">.</span><span class="token function">NewClientOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddBroker</span><span class="token punctuation">(</span><span class="token string">"tcp://your-address:your-port"</span><span class="token punctuation">)</span>
	opts<span class="token punctuation">.</span><span class="token function">SetClientID</span><span class="token punctuation">(</span><span class="token string">"go_client"</span><span class="token punctuation">)</span>
	opts<span class="token punctuation">.</span><span class="token function">SetUsername</span><span class="token punctuation">(</span><span class="token string">"your-username"</span><span class="token punctuation">)</span> <span class="token comment">// 设置用户名</span>
	opts<span class="token punctuation">.</span><span class="token function">SetPassword</span><span class="token punctuation">(</span><span class="token string">"your-password"</span><span class="token punctuation">)</span> <span class="token comment">// 设置密码</span>

	<span class="token comment">// 创建 MQTT 客户端实例</span>
	client <span class="token operator">:=</span> MQTT<span class="token punctuation">.</span><span class="token function">NewClient</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span>

	<span class="token comment">// 连接到 MQTT 代理</span>
	<span class="token keyword">if</span> token <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> token<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 订阅主题</span>
	<span class="token keyword">if</span> token <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token string">"test/topic"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> onMessageReceived<span class="token punctuation">)</span><span class="token punctuation">;</span> token<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">panic</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Connected to MQTT broker"</span><span class="token punctuation">)</span>

	<span class="token comment">// 等待信号</span>
	sig <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> os<span class="token punctuation">.</span>Signal<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	signal<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span>sig<span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>SIGINT<span class="token punctuation">,</span> syscall<span class="token punctuation">.</span>SIGTERM<span class="token punctuation">)</span>
	<span class="token operator">&lt;-</span>sig

	<span class="token comment">// 断开连接</span>
	client<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token number">250</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Disconnected from MQTT broker"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="32RabbitMQdashboard_158"></a>3.2、查看RabbitMQ的dashboard</h4> 
<blockquote> 
 <p>进入到 Connections 的tabs</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ab/30/DONbMALw_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>可以看到 <code>client_id</code> 是 <code>go_client</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/90/54/3oLObkzr_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="33MQTTX_MQTT_168"></a>3.3、MQTTX 链接MQTT</h4> 
<blockquote> 
 <p>配置如下：<br> 需要注意的是 <code>rabbitmq</code>的<code>dashboard账号密码</code>，与 <code>MQTT</code>的<code>账号密码</code>并不是一套</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b1/9a/dlE2peig_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/84845961d31d389f51df261e1ebbbc72/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">初始SpringBoot：详解特性和结构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2a93b8151915ae03578564885496528b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle ORA-28547:connection to server failed,probable Oracle Net admin error</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>