<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLO训练自己的数据集 | 格式转换 | JSON、TXT、XML文件的相互转换 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/874e92ca7fee287ce4634dd254944a12/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="YOLO训练自己的数据集 | 格式转换 | JSON、TXT、XML文件的相互转换">
  <meta property="og:description" content="YOLO训练自己的数据集 | 格式转换 | 未完待续... 场景1.将JSON文件转换为TXT文件,并按照比例划分训练集、验证集、测试集☀需求分析🌙转换步骤🌙step 1.将JSON文件转换为XML文件step 2.将XML文件转换为TXT文件，并按照比例划分训练集、测试集、验证集 ------------------------------------------------------------------------------------------场景2.将JSON文件直接转换成TXT文件☀需求分析🌙转换步骤🌙 ------------------------------------------------------------------------------------------场景3.将TXT文件直接转换成JSON文件☀需求分析🌙转换步骤🌙 ------------------------------------------------------------------------------------------场景4.将TXT文件直接转换成XML文件☀需求分析🌙转换步骤🌙 场景1.将JSON文件转换为TXT文件,并按照比例划分训练集、验证集、测试集☀ 需求分析🌙 当我们在使用了Labelme等一系列数据标注软件后，便会得到与图片对应的JSON文件，但我们在训练YOLO模型之前，通常需要将标注数据转换为YOLO能识别的格式，也即TXT文件格式。再用于训练模型。而TXT格式是一种简单易读的文本格式，可以方便地手动修改标签中的信息，例如类别名称、边界框坐标等。将标签转换为TXT格式是为了方便后续的YOLO训练和测试，并提高工作效率。
转换步骤🌙 step 1.将JSON文件转换为XML文件 创建create_xml_anno.py文件
from xml.dom.minidom import Document class CreateAnno: def __init__(self, ): self.doc = Document() # 创建DOM文档对象 self.anno = self.doc.createElement(&#39;annotation&#39;) # 创建根元素 self.doc.appendChild(self.anno) self.add_folder() self.add_path() self.add_source() self.add_segmented() # self.add_filename() # self.add_pic_size(width_text_str=str(width), height_text_str=str(height), depth_text_str=str(depth)) def add_folder(self, floder_text_str=&#39;JPEGImages&#39;): floder = self.doc.createElement(&#39;floder&#39;) ##建立自己的开头 floder_text = self.doc.createTextNode(floder_text_str) ##建立自己的文本信息 floder.appendChild(floder_text) ##自己的内容 self.anno.appendChild(floder) def add_filename(self, filename_text_str=&#39;00000.jpg&#39;): filename = self.doc.createElement(&#39;filename&#39;) filename_text = self.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-16T21:36:03+08:00">
    <meta property="article:modified_time" content="2023-08-16T21:36:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLO训练自己的数据集 | 格式转换 | JSON、TXT、XML文件的相互转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/6a/8a/pah4oTsh_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>YOLO训练自己的数据集 | 格式转换 | 未完待续...</h4> 
 <ul><li><a href="#1JSONTXT_5" rel="nofollow">场景1.将JSON文件转换为TXT文件,并按照比例划分训练集、验证集、测试集☀</a></li><li><ul><li><a href="#_6" rel="nofollow">需求分析🌙</a></li><li><a href="#_8" rel="nofollow">转换步骤🌙</a></li><li><ul><li><a href="#step_1JSONXML_9" rel="nofollow">step 1.将JSON文件转换为XML文件</a></li><li><a href="#step_2XMLTXT_231" rel="nofollow">step 2.将XML文件转换为TXT文件，并按照比例划分训练集、测试集、验证集</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_321" rel="nofollow">------------------------------------------------------------------------------------------</a></li><li><a href="#2JSONTXT_322" rel="nofollow">场景2.将JSON文件直接转换成TXT文件☀</a></li><li><ul><li><a href="#_323" rel="nofollow">需求分析🌙</a></li><li><a href="#_325" rel="nofollow">转换步骤🌙</a></li></ul> 
  </li><li><a href="#_372" rel="nofollow">------------------------------------------------------------------------------------------</a></li><li><a href="#3TXTJSON_373" rel="nofollow">场景3.将TXT文件直接转换成JSON文件☀</a></li><li><ul><li><a href="#_374" rel="nofollow">需求分析🌙</a></li><li><a href="#_376" rel="nofollow">转换步骤🌙</a></li></ul> 
  </li><li><a href="#_477" rel="nofollow">------------------------------------------------------------------------------------------</a></li><li><a href="#4TXTXML_478" rel="nofollow">场景4.将TXT文件直接转换成XML文件☀</a></li><li><ul><li><a href="#_479" rel="nofollow">需求分析🌙</a></li><li><a href="#_481" rel="nofollow">转换步骤🌙</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1JSONTXT_5"></a>场景1.将JSON文件转换为TXT文件,并按照比例划分训练集、验证集、测试集☀</h2> 
<h3><a id="_6"></a>需求分析🌙</h3> 
<p>当我们在使用了<mark>Labelme</mark>等一系列数据标注软件后，便会得到与图片对应的JSON文件，但我们在训练YOLO模型之前，通常需要将标注数据转换为YOLO能识别的格式，也即TXT文件格式。再用于训练模型。而TXT格式是一种简单易读的文本格式，可以方便地手动修改标签中的信息，例如类别名称、边界框坐标等。将标签转换为TXT格式是为了方便后续的YOLO训练和测试，并提高工作效率。</p> 
<h3><a id="_8"></a>转换步骤🌙</h3> 
<h4><a id="step_1JSONXML_9"></a>step 1.将JSON文件转换为XML文件</h4> 
<p>创建<mark>create_xml_anno.py</mark>文件</p> 
<pre><code class="prism language-c">from xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom import Document


class CreateAnno<span class="token operator">:</span>
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span>doc <span class="token operator">=</span> <span class="token function">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  # 创建DOM文档对象
        self<span class="token punctuation">.</span>anno <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'annotation'</span><span class="token punctuation">)</span>  # 创建根元素
        self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>anno<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span><span class="token function">add_folder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">add_path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">add_source</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token function">add_segmented</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">self</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">add_filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">self</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">add_pic_size</span><span class="token punctuation">(</span>width_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> height_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> depth_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

    def <span class="token function">add_folder</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> floder_text_str<span class="token operator">=</span><span class="token char">'JPEGImages'</span><span class="token punctuation">)</span><span class="token operator">:</span>
        floder <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'floder'</span><span class="token punctuation">)</span>  ##建立自己的开头
        floder_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>floder_text_str<span class="token punctuation">)</span>  ##建立自己的文本信息
        floder<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>floder_text<span class="token punctuation">)</span>  ##自己的内容
        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>floder<span class="token punctuation">)</span>

    def <span class="token function">add_filename</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename_text_str<span class="token operator">=</span><span class="token char">'00000.jpg'</span><span class="token punctuation">)</span><span class="token operator">:</span>
        filename <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'filename'</span><span class="token punctuation">)</span>
        filename_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>filename_text_str<span class="token punctuation">)</span>
        filename<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>filename_text<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>

    def <span class="token function">add_path</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path_text_str<span class="token operator">=</span><span class="token string">"None"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        path <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'path'</span><span class="token punctuation">)</span>
        path_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>path_text_str<span class="token punctuation">)</span>
        path<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>path_text<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>

    def <span class="token function">add_source</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> database_text_str<span class="token operator">=</span><span class="token string">"Unknow"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        source <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'source'</span><span class="token punctuation">)</span>
        database <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'database'</span><span class="token punctuation">)</span>
        database_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>database_text_str<span class="token punctuation">)</span>  # 元素内容写入
        database<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>database_text<span class="token punctuation">)</span>
        source<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>

    def <span class="token function">add_pic_size</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> width_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span> height_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span> depth_text_str<span class="token operator">=</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        size <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'size'</span><span class="token punctuation">)</span>
        width <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'width'</span><span class="token punctuation">)</span>
        width_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>width_text_str<span class="token punctuation">)</span>  # 元素内容写入
        width<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>width_text<span class="token punctuation">)</span>
        size<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span>

        height <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'height'</span><span class="token punctuation">)</span>
        height_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>height_text_str<span class="token punctuation">)</span>
        height<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>height_text<span class="token punctuation">)</span>
        size<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span>

        depth <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'depth'</span><span class="token punctuation">)</span>
        depth_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>depth_text_str<span class="token punctuation">)</span>
        depth<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>depth_text<span class="token punctuation">)</span>
        size<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>

    def <span class="token function">add_segmented</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> segmented_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        segmented <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'segmented'</span><span class="token punctuation">)</span>
        segmented_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>segmented_text_str<span class="token punctuation">)</span>
        segmented<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>segmented_text<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>segmented<span class="token punctuation">)</span>

    def <span class="token function">add_object</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                   name_text_str<span class="token operator">=</span><span class="token string">"None"</span><span class="token punctuation">,</span>
                   xmin_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span>
                   ymin_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span>
                   xmax_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span>
                   ymax_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span>
                   pose_text_str<span class="token operator">=</span><span class="token string">"Unspecified"</span><span class="token punctuation">,</span>
                   truncated_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">,</span>
                   difficult_text_str<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        object <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'object'</span><span class="token punctuation">)</span>
        name <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'name'</span><span class="token punctuation">)</span>
        name_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>name_text_str<span class="token punctuation">)</span>
        name<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>name_text<span class="token punctuation">)</span>
        object<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>

        pose <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'pose'</span><span class="token punctuation">)</span>
        pose_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>pose_text_str<span class="token punctuation">)</span>
        pose<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pose_text<span class="token punctuation">)</span>
        object<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pose<span class="token punctuation">)</span>

        truncated <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'truncated'</span><span class="token punctuation">)</span>
        truncated_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>truncated_text_str<span class="token punctuation">)</span>
        truncated<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>truncated_text<span class="token punctuation">)</span>
        object<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>truncated<span class="token punctuation">)</span>

        difficult <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'difficult'</span><span class="token punctuation">)</span>
        difficult_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>difficult_text_str<span class="token punctuation">)</span>
        difficult<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>difficult_text<span class="token punctuation">)</span>
        object<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>difficult<span class="token punctuation">)</span>

        bndbox <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'bndbox'</span><span class="token punctuation">)</span>
        xmin <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'xmin'</span><span class="token punctuation">)</span>
        xmin_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>xmin_text_str<span class="token punctuation">)</span>
        xmin<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xmin_text<span class="token punctuation">)</span>
        bndbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xmin<span class="token punctuation">)</span>

        ymin <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'ymin'</span><span class="token punctuation">)</span>
        ymin_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>ymin_text_str<span class="token punctuation">)</span>
        ymin<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ymin_text<span class="token punctuation">)</span>
        bndbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ymin<span class="token punctuation">)</span>

        xmax <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'xmax'</span><span class="token punctuation">)</span>
        xmax_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>xmax_text_str<span class="token punctuation">)</span>
        xmax<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xmax_text<span class="token punctuation">)</span>
        bndbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span>

        ymax <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token char">'ymax'</span><span class="token punctuation">)</span>
        ymax_text <span class="token operator">=</span> self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>ymax_text_str<span class="token punctuation">)</span>
        ymax<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ymax_text<span class="token punctuation">)</span>
        bndbox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>ymax<span class="token punctuation">)</span>
        object<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>bndbox<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>anno<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span>

    def <span class="token function">get_anno</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>anno

    def <span class="token function">get_doc</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>doc

    def <span class="token function">save_doc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> save_path<span class="token punctuation">)</span><span class="token operator">:</span>
        with <span class="token function">open</span><span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> as f<span class="token operator">:</span>
            self<span class="token punctuation">.</span>doc<span class="token punctuation">.</span><span class="token function">writexml</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token char">'\t'</span><span class="token punctuation">,</span> newl<span class="token operator">=</span><span class="token char">'\n'</span><span class="token punctuation">,</span> addindent<span class="token operator">=</span><span class="token char">'\t'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>
</code></pre> 
<p>再创建<mark>read_json_anno.py</mark>文件</p> 
<pre><code class="prism language-c">import numpy as np
import json
class ReadAnno<span class="token operator">:</span>
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> json_path<span class="token punctuation">,</span> process_mode<span class="token operator">=</span><span class="token string">"rectangle"</span><span class="token punctuation">)</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span>json_data <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span>json_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>filename <span class="token operator">=</span> self<span class="token punctuation">.</span>json_data<span class="token punctuation">[</span><span class="token char">'imagePath'</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>width <span class="token operator">=</span> self<span class="token punctuation">.</span>json_data<span class="token punctuation">[</span><span class="token char">'imageWidth'</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> self<span class="token punctuation">.</span>json_data<span class="token punctuation">[</span><span class="token char">'imageHeight'</span><span class="token punctuation">]</span>

        self<span class="token punctuation">.</span>coordis <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        assert process_mode in <span class="token punctuation">[</span><span class="token string">"rectangle"</span><span class="token punctuation">,</span> <span class="token string">"polygon"</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> process_mode <span class="token operator">==</span> <span class="token string">"rectangle"</span><span class="token operator">:</span>
            self<span class="token punctuation">.</span><span class="token function">process_polygon_shapes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        elif process_mode <span class="token operator">==</span> <span class="token string">"polygon"</span><span class="token operator">:</span>
            self<span class="token punctuation">.</span><span class="token function">process_polygon_shapes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    def <span class="token function">process_rectangle_shapes</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">for</span> single_shape in self<span class="token punctuation">.</span>json_data<span class="token punctuation">[</span><span class="token char">'shapes'</span><span class="token punctuation">]</span><span class="token operator">:</span>
            bbox_class <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span>
            xmin <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            ymin <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            xmax <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            ymax <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>coordis<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xmin<span class="token punctuation">,</span> ymin<span class="token punctuation">,</span> xmax<span class="token punctuation">,</span> ymax<span class="token punctuation">,</span> bbox_class<span class="token punctuation">]</span><span class="token punctuation">)</span>

    def <span class="token function">process_polygon_shapes</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">for</span> single_shape in self<span class="token punctuation">.</span>json_data<span class="token punctuation">[</span><span class="token char">'shapes'</span><span class="token punctuation">]</span><span class="token operator">:</span>
            bbox_class <span class="token operator">=</span> single_shape<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span>
            temp_points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> couple_point in single_shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token operator">:</span>
                x <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>couple_point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                y <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span>couple_point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                temp_points<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span>
            temp_points <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>temp_points<span class="token punctuation">)</span>
            xmin<span class="token punctuation">,</span> ymin <span class="token operator">=</span> temp_points<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            xmax<span class="token punctuation">,</span> ymax <span class="token operator">=</span> temp_points<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>coordis<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">[</span>xmin<span class="token punctuation">,</span> ymin<span class="token punctuation">,</span> xmax<span class="token punctuation">,</span> ymax<span class="token punctuation">,</span> bbox_class<span class="token punctuation">]</span><span class="token punctuation">)</span>

    def <span class="token function">get_width_height</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>width<span class="token punctuation">,</span> self<span class="token punctuation">.</span>height

    def <span class="token function">get_filename</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>filename

    def <span class="token function">get_coordis</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>coordis
</code></pre> 
<p>最后创建<mark>main.py</mark>文件，需要修改<mark>root_json_dir</mark>、<mark>root_save_xml_dir</mark></p> 
<pre><code class="prism language-c">import os
from tqdm import tqdm

from read_json_anno import ReadAnno
from create_xml_anno import CreateAnno


def <span class="token function">json_transform_xml</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> xml_path<span class="token punctuation">,</span> process_mode<span class="token operator">=</span><span class="token string">"rectangle"</span><span class="token punctuation">)</span><span class="token operator">:</span>
    json_path <span class="token operator">=</span> json_path
    json_anno <span class="token operator">=</span> <span class="token function">ReadAnno</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> process_mode<span class="token operator">=</span>process_mode<span class="token punctuation">)</span>
    width<span class="token punctuation">,</span> height <span class="token operator">=</span> json_anno<span class="token punctuation">.</span><span class="token function">get_width_height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    filename <span class="token operator">=</span> json_anno<span class="token punctuation">.</span><span class="token function">get_filename</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    coordis <span class="token operator">=</span> json_anno<span class="token punctuation">.</span><span class="token function">get_coordis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    xml_anno <span class="token operator">=</span> <span class="token function">CreateAnno</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xml_anno<span class="token punctuation">.</span><span class="token function">add_filename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    xml_anno<span class="token punctuation">.</span><span class="token function">add_pic_size</span><span class="token punctuation">(</span>width_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span> height_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> depth_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> xmin<span class="token punctuation">,</span> ymin<span class="token punctuation">,</span> xmax<span class="token punctuation">,</span> ymax<span class="token punctuation">,</span> label in coordis<span class="token operator">:</span>
        xml_anno<span class="token punctuation">.</span><span class="token function">add_object</span><span class="token punctuation">(</span>name_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            xmin_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>xmin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            ymin_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>ymin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            xmax_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            ymax_text_str<span class="token operator">=</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span>ymax<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    xml_anno<span class="token punctuation">.</span><span class="token function">save_doc</span><span class="token punctuation">(</span>xml_path<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    root_json_dir <span class="token operator">=</span> r<span class="token string">"放存放JSON文件的路径"</span>  
    root_save_xml_dir <span class="token operator">=</span> r<span class="token string">"放即将生成的XML文件的保存路径"</span> 
    <span class="token keyword">for</span> json_filename in <span class="token function">tqdm</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>root_json_dir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span> json_filename<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'json'</span><span class="token operator">:</span>
            json_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root_json_dir<span class="token punctuation">,</span> json_filename<span class="token punctuation">)</span>
            save_xml_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>root_save_xml_dir<span class="token punctuation">,</span> json_filename<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">".json"</span><span class="token punctuation">,</span> <span class="token string">".xml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">json_transform_xml</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> save_xml_path<span class="token punctuation">,</span> process_mode<span class="token operator">=</span><span class="token string">"polygon"</span><span class="token punctuation">)</span> # labelme原数据的标注方式<span class="token punctuation">(</span>矩形rectangle和多边形polygon<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="step_2XMLTXT_231"></a>step 2.将XML文件转换为TXT文件，并按照比例划分训练集、测试集、验证集</h4> 
<p>创建<mark>xml_to_txt.py</mark>文件</p> 
<pre><code class="prism language-c">import os
import shutil
import random
# 保证随机可复现
random<span class="token punctuation">.</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
def <span class="token function">split_data</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> new_file_path<span class="token punctuation">,</span> train_rate<span class="token punctuation">,</span> val_rate<span class="token punctuation">,</span> test_rate<span class="token punctuation">)</span><span class="token operator">:</span>
        eachclass_image <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> image in os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">:</span>
            eachclass_image<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
        total <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>eachclass_image<span class="token punctuation">)</span>
        random<span class="token punctuation">.</span><span class="token function">shuffle</span><span class="token punctuation">(</span>eachclass_image<span class="token punctuation">)</span>
        train_images <span class="token operator">=</span> eachclass_image<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span><span class="token keyword">int</span><span class="token punctuation">(</span>train_rate <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">]</span> # 注意左闭右开
        val_images <span class="token operator">=</span> eachclass_image<span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">(</span>train_rate <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>train_rate <span class="token operator">+</span> val_rate<span class="token punctuation">)</span> <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token punctuation">]</span>  # 注意左闭右开
        test_images <span class="token operator">=</span> eachclass_image<span class="token punctuation">[</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>train_rate <span class="token operator">+</span> val_rate<span class="token punctuation">)</span> <span class="token operator">*</span> total<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">]</span>

        # 训练集
        <span class="token keyword">for</span> image in train_images<span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
            old_path <span class="token operator">=</span> file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            new_path1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'train'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span>
            new_path <span class="token operator">=</span> new_path1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span></span></span>
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> new_path<span class="token punctuation">)</span>
        new_name <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'train'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span><span class="token punctuation">)</span>
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>new_name<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
        <span class="token keyword">for</span> im in new_name<span class="token operator">:</span>
            old_xmlpath <span class="token operator">=</span> xmlpath <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'old'</span><span class="token punctuation">,</span>old_xmlpath<span class="token punctuation">)</span>
            new_xmlpath1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'train'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'labels'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span>
            new_xmlpath <span class="token operator">=</span> new_xmlpath1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'xml name'</span><span class="token punctuation">,</span>new_xmlpath<span class="token punctuation">)</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token function">open</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_xmlpath<span class="token punctuation">,</span> new_xmlpath<span class="token punctuation">)</span>

        # 验证集
        <span class="token keyword">for</span> image in val_images<span class="token operator">:</span>
            old_path <span class="token operator">=</span> file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            new_path1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'val'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span>
            new_path <span class="token operator">=</span> new_path1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> new_path<span class="token punctuation">)</span>
        new_name <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'val'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> im in new_name<span class="token operator">:</span>
            old_xmlpath <span class="token operator">=</span> xmlpath <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            new_xmlpath1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'val'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'labels'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span>
            new_xmlpath <span class="token operator">=</span> new_xmlpath1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token function">open</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_xmlpath<span class="token punctuation">,</span> new_xmlpath<span class="token punctuation">)</span>

        #测试集
        <span class="token keyword">for</span> image in test_images<span class="token operator">:</span>
            old_path <span class="token operator">=</span> file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            new_path1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'test'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_path1<span class="token punctuation">)</span>
            new_path <span class="token operator">=</span> new_path1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> image
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_path<span class="token punctuation">,</span> new_path<span class="token punctuation">)</span>
        new_name <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'test'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'images'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> im in new_name<span class="token operator">:</span>
            old_xmlpath <span class="token operator">=</span> xmlpath <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            new_xmlpath1 <span class="token operator">=</span> new_file_path <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'test'</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token char">'labels'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span><span class="token operator">:</span>
                os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>new_xmlpath1<span class="token punctuation">)</span>
            new_xmlpath <span class="token operator">=</span> new_xmlpath1 <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> im<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'txt'</span>
            <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token function">open</span><span class="token punctuation">(</span>f<span class="token char">'{old_xmlpath}'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
            shutil<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>old_xmlpath<span class="token punctuation">,</span> new_xmlpath<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'ok'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token char">'__main__'</span><span class="token operator">:</span>
    file_path <span class="token operator">=</span> <span class="token string">"存放图片的文件夹路径//"</span>
    xmlpath <span class="token operator">=</span> <span class="token char">'存放xml文件的路径//'</span>
    new_file_path <span class="token operator">=</span> <span class="token string">"存放生成数据集的路径//"</span>
    <span class="token function">split_data</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> new_file_path<span class="token punctuation">,</span> train_rate<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> val_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> test_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>#这里是划分比例，可自己调节，一般是<span class="token number">8</span>：<span class="token number">1</span>：<span class="token number">1</span>，也有<span class="token number">7</span>：<span class="token number">2</span>：<span class="token number">1</span>的划分比例情况没具体划分情况看数据集的大小
</code></pre> 
<p>运行<mark>xml_to_txt.py</mark>文件后看到这样的格式，也就代表成功啦<br> <img src="https://images2.imgbox.com/c7/fc/JseJ1mKh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_321"></a>------------------------------------------------------------------------------------------</h2> 
<h2><a id="2JSONTXT_322"></a>场景2.将JSON文件直接转换成TXT文件☀</h2> 
<h3><a id="_323"></a>需求分析🌙</h3> 
<p>有的小伙伴再使用了<mark>Labelme</mark>这种标注软件之后，想直接把JSON文件转换为TXT文件，当然这也是可以的，废话不多说，直接上代码</p> 
<h3><a id="_325"></a>转换步骤🌙</h3> 
<p>创建<mark>json_to_txt.py</mark>文件，需要修改<mark>txt_name</mark>、<mark>json_floder_path</mark></p> 
<pre><code class="prism language-c">import json
import os
import pandas as pd
def <span class="token function">convert</span><span class="token punctuation">(</span>img_size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token operator">:</span>
    x1 <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    y1 <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    x2 <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    y2 <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
def <span class="token function">decode_json</span><span class="token punctuation">(</span>json_floder_path<span class="token punctuation">,</span> json_name<span class="token punctuation">,</span>label<span class="token punctuation">)</span><span class="token operator">:</span>
    txt_name <span class="token operator">=</span> r<span class="token char">'这里存放即将生成txt文件的路径/'</span> <span class="token operator">+</span> json_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'.txt'</span>  
    txt_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>txt_name<span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
    json_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>json_floder_path<span class="token punctuation">,</span> json_name<span class="token punctuation">)</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    img_w <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token char">'imageWidth'</span><span class="token punctuation">]</span>
    img_h <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token char">'imageHeight'</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i in data<span class="token punctuation">[</span><span class="token char">'shapes'</span><span class="token punctuation">]</span><span class="token operator">:</span>
        <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token char">'shape_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'rectangle'</span><span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>label<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> i<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
                new_label<span class="token operator">=</span>pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">[</span>i<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                label<span class="token operator">=</span>label<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>new_label<span class="token punctuation">,</span>ignore_index<span class="token operator">=</span>True<span class="token punctuation">)</span>
            try<span class="token operator">:</span>
                x1 <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> img_w
                y1 <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> img_h
                x2 <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> img_w
                y2 <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> img_h
                n <span class="token operator">=</span> label<span class="token punctuation">[</span>label<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                bb <span class="token operator">=</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span>
                bbox <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img_w<span class="token punctuation">,</span> img_h<span class="token punctuation">)</span><span class="token punctuation">,</span> bb<span class="token punctuation">)</span>
                txt_file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">for</span> a in bbox<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>
            except IndexError<span class="token operator">:</span>
                <span class="token function">print</span><span class="token punctuation">(</span>json_name<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token char">'的'</span><span class="token operator">+</span>i<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">"标签坐标缺失"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> label
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    json_floder_path <span class="token operator">=</span> r<span class="token char">'这里存放你存json文件的路径/'</span> 
    json_names <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>json_floder_path<span class="token punctuation">)</span>
    label<span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">DataFrame</span><span class="token punctuation">(</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> json_name in json_names<span class="token operator">:</span>
        <span class="token keyword">if</span> json_name<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'json'</span><span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>json_name<span class="token punctuation">)</span>
            label<span class="token operator">=</span><span class="token function">decode_json</span><span class="token punctuation">(</span>json_floder_path<span class="token punctuation">,</span> json_name<span class="token punctuation">,</span>label<span class="token punctuation">)</span>

    label<span class="token punctuation">.</span><span class="token function">to_csv</span><span class="token punctuation">(</span><span class="token char">'label.txt'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token char">'\t'</span><span class="token punctuation">,</span> index<span class="token operator">=</span>True<span class="token punctuation">)</span> 
</code></pre> 
<h2><a id="_372"></a>------------------------------------------------------------------------------------------</h2> 
<h2><a id="3TXTJSON_373"></a>场景3.将TXT文件直接转换成JSON文件☀</h2> 
<h3><a id="_374"></a>需求分析🌙</h3> 
<p>有的小伙伴在将JSON文件转换为TXT文件后，就把JSON文件给删除了，但是后续想要对图像进行再次标注的时候，无法找到原始的JSON数据，产生了想要重新标注的危险想法，以下代码可实现对TXT文件直接转换为JSON文件的需求，废话不多说，直接上代码</p> 
<h3><a id="_376"></a>转换步骤🌙</h3> 
<p>创建<mark>txt_to_json.py</mark>文件,这里假设需要数据集有两类，分别为<mark>dog</mark>和<mark>cat</mark>,如果你的标签名是别的，那么就需要修改<mark>class_name</mark>,你将修改的是<mark>txt_folder</mark>、<mark>output_folder</mark>，<mark>img_folder</mark>。</p> 
<pre><code class="prism language-c">import os
import json
import base64
import cv2

def <span class="token function">read_txt_file</span><span class="token punctuation">(</span>txt_file<span class="token punctuation">)</span><span class="token operator">:</span>
    with <span class="token function">open</span><span class="token punctuation">(</span>txt_file<span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">)</span> as f<span class="token operator">:</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">readlines</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> line in lines<span class="token operator">:</span>
        line <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        class_name <span class="token operator">=</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        bbox <span class="token operator">=</span> <span class="token punctuation">[</span>coord <span class="token keyword">for</span> coord in line<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token char">'class_name'</span><span class="token operator">:</span> class_name<span class="token punctuation">,</span> <span class="token char">'bbox'</span><span class="token operator">:</span> bbox<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data

def <span class="token function">convert_to_labelme</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> image_path<span class="token punctuation">,</span> image_size<span class="token punctuation">)</span><span class="token operator">:</span>
    labelme_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token char">'version'</span><span class="token operator">:</span> <span class="token char">'4.5.6'</span><span class="token punctuation">,</span>
        <span class="token char">'flags'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token char">'shapes'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token char">'imagePath'</span><span class="token operator">:</span> json_image_path<span class="token punctuation">,</span>
        <span class="token char">'imageData'</span><span class="token operator">:</span> None<span class="token punctuation">,</span>
        <span class="token char">'imageHeight'</span><span class="token operator">:</span> image_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token char">'imageWidth'</span><span class="token operator">:</span> image_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> obj in data<span class="token operator">:</span>
        dx <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        dy <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        dw <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        dh <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

        w <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>dw<span class="token punctuation">)</span> <span class="token operator">*</span> image_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        h <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>dh<span class="token punctuation">)</span> <span class="token operator">*</span> image_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        center_x <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> image_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        center_y <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> image_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        x1 <span class="token operator">=</span> center_x <span class="token operator">-</span> w<span class="token operator">/</span><span class="token number">2</span>
        y1 <span class="token operator">=</span> center_y <span class="token operator">-</span> h<span class="token operator">/</span><span class="token number">2</span>
        x2 <span class="token operator">=</span> center_x <span class="token operator">+</span> w<span class="token operator">/</span><span class="token number">2</span>
        y2 <span class="token operator">=</span> center_y <span class="token operator">+</span> h<span class="token operator">/</span><span class="token number">2</span>

        <span class="token keyword">if</span> obj<span class="token punctuation">[</span><span class="token char">'dog'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'0'</span><span class="token operator">:</span> #判断对应的标签名称，写入json文件中
            label <span class="token operator">=</span> <span class="token function">str</span><span class="token punctuation">(</span><span class="token char">'grape'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            label <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token char">'cat'</span><span class="token punctuation">]</span>
        shape_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token char">'label'</span><span class="token operator">:</span> label<span class="token punctuation">,</span>
            <span class="token char">'points'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token char">'group_id'</span><span class="token operator">:</span> None<span class="token punctuation">,</span>
            <span class="token char">'shape_type'</span><span class="token operator">:</span> <span class="token char">'rectangle'</span><span class="token punctuation">,</span>
            <span class="token char">'flags'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        labelme_data<span class="token punctuation">[</span><span class="token char">'shapes'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>shape_data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> labelme_data

def <span class="token function">save_labelme_json</span><span class="token punctuation">(</span>labelme_data<span class="token punctuation">,</span> image_path<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span><span class="token operator">:</span>
    with <span class="token function">open</span><span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> <span class="token char">'rb'</span><span class="token punctuation">)</span> as f<span class="token operator">:</span>
        image_data <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    labelme_data<span class="token punctuation">[</span><span class="token char">'imageData'</span><span class="token punctuation">]</span> <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">b64encode</span><span class="token punctuation">(</span>image_data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token char">'utf-8'</span><span class="token punctuation">)</span>

    with <span class="token function">open</span><span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span> as f<span class="token operator">:</span>
        json<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span>labelme_data<span class="token punctuation">,</span> f<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

# 设置文件夹路径和输出文件夹路径
txt_folder <span class="token operator">=</span> r<span class="token string">"存放txt文件的文件夹路径//"</span>  
output_folder <span class="token operator">=</span> r<span class="token string">"输出json文件的文件夹路径//"</span>  
img_folder <span class="token operator">=</span> r<span class="token string">"存放对应标签的图片文件夹路径//"</span> 

# 创建输出文件夹
<span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">)</span><span class="token operator">:</span>
    os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">)</span>

# 遍历txt文件夹中的所有文件
<span class="token keyword">for</span> filename in os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>txt_folder<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">if</span> filename<span class="token punctuation">.</span><span class="token function">endswith</span><span class="token punctuation">(</span><span class="token char">'.txt'</span><span class="token punctuation">)</span><span class="token operator">:</span>
        # 生成对应的输出文件名
        output_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">splitext</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'.json'</span>

        # 读取txt文件
        txt_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>txt_folder<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
        data <span class="token operator">=</span> <span class="token function">read_txt_file</span><span class="token punctuation">(</span>txt_file<span class="token punctuation">)</span>

        # 设置图片路径和尺寸
        image_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">splitext</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'.jpg'</span>  # 图片文件名与txt文件名相同，后缀为<span class="token punctuation">.</span>jpg
        image_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>img_folder<span class="token punctuation">,</span> image_filename<span class="token punctuation">)</span>
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">image</span><span class="token expression">_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">720</span><span class="token punctuation">)</span>  # 根据实际情况修改</span></span>
        json_image_path <span class="token operator">=</span> image_path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'\\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"image_path:"</span><span class="token punctuation">,</span> image_path<span class="token punctuation">)</span>
        image_size <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">.</span>shape

        # 转化为LabelMe格式
        labelme_data <span class="token operator">=</span> <span class="token function">convert_to_labelme</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> image_path<span class="token punctuation">,</span> image_size<span class="token punctuation">)</span>

        # 保存为LabelMe JSON文件
        output_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>output_folder<span class="token punctuation">,</span> output_filename<span class="token punctuation">)</span>
        <span class="token function">save_labelme_json</span><span class="token punctuation">(</span>labelme_data<span class="token punctuation">,</span> image_path<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span>

</code></pre> 
<h2><a id="_477"></a>------------------------------------------------------------------------------------------</h2> 
<h2><a id="4TXTXML_478"></a>场景4.将TXT文件直接转换成XML文件☀</h2> 
<h3><a id="_479"></a>需求分析🌙</h3> 
<p>当我们需要对数据集利用<mark>imgaug</mark>库进行数据增强时，或者需要对<mark>锚框重聚类分析</mark>，包括但不限于<mark>kmeans聚类</mark>、<mark>kmeans++聚类</mark>、<mark>kmeans聚类融合遗传算法</mark>等聚类方法时，这个时候就需要使用到我们XML格式的文件了，但是有的小伙伴没有保存此类文件，仅有TXT文件时，我们可以利用TXT文件转为XML文件。</p> 
<h3><a id="_481"></a>转换步骤🌙</h3> 
<pre><code class="prism language-c">待更新<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a50d4313d24b339c620c131860971eba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一百五十二、Kettle——Kettle9.3.0本地连接Hive3.1.2(踩坑，亲测有效，附截图)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b649e8d728f0ebd04ad23109ba4f1ea5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">纯前端--原生js将html页面变成pdf文件（html2canvas&#43;jsPDF）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>