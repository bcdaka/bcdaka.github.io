<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【lesson8】云备份服务端完整版代码 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1afe7a2f3cf91981f0c7244ef5ccd350/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【lesson8】云备份服务端完整版代码">
  <meta property="og:description" content="文章目录 util.hppconfig.hpphot.hppdata.hppserver.hppserver.ccMakefilecloud.conf util.hpp #pragma once #include &lt;iostream&gt; #include &lt;fstream&gt; #include &lt;string&gt; #include &lt;vector&gt; #include &lt;sys/stat.h&gt; #include &lt;unistd.h&gt; #include &lt;cstring&gt; #include &lt;cstdint&gt; #include &lt;experimental/filesystem&gt; #include &lt;jsoncpp/json/json.h&gt; #include &lt;memory&gt; #include &#34;bundle.h&#34; namespace cloud { namespace fs = std::experimental::filesystem; class fileUtil { public: fileUtil(std::string filename) :_filename(filename) {} bool Remove() { if(exists() == false) { return true; } remove(_filename.c_str()); return true; } size_t fileSize() { struct stat st; int ret = stat(_filename.c_str(), &amp;st); if(ret == -1) { std::cout &lt;&lt; strerror(errno) &lt;&lt; std::endl; return 0; } return st.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-11T23:00:54+08:00">
    <meta property="article:modified_time" content="2024-06-11T23:00:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【lesson8】云备份服务端完整版代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#utilhpp_1" rel="nofollow">util.hpp</a></li><li><a href="#confighpp_263" rel="nofollow">config.hpp</a></li><li><a href="#hothpp_372" rel="nofollow">hot.hpp</a></li><li><a href="#datahpp_457" rel="nofollow">data.hpp</a></li><li><a href="#serverhpp_663" rel="nofollow">server.hpp</a></li><li><a href="#servercc_816" rel="nofollow">server.cc</a></li><li><a href="#Makefile_997" rel="nofollow">Makefile</a></li><li><a href="#cloudconf_1004" rel="nofollow">cloud.conf</a></li></ul> 
</div> 
<p></p> 
<h2><a id="utilhpp_1"></a>util.hpp</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdint&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;experimental/filesystem&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;jsoncpp/json/json.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;memory&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bundle.h"</span></span>



<span class="token keyword">namespace</span> cloud
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">namespace</span> fs <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span>experimental<span class="token double-colon punctuation">::</span>filesystem<span class="token punctuation">;</span>
    <span class="token keyword">class</span> <span class="token class-name">fileUtil</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">fileUtil</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string filename<span class="token punctuation">)</span>
        <span class="token operator">:</span><span class="token function">_filename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        
        <span class="token keyword">bool</span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">remove</span><span class="token punctuation">(</span>_filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        size_t <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>_filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> st<span class="token punctuation">.</span>st_size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        time_t <span class="token function">lastModifyTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>_filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> st<span class="token punctuation">.</span>st_mtime<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        time_t <span class="token function">lastAccessTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>_filename<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> st<span class="token punctuation">.</span>st_atime<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        std<span class="token double-colon punctuation">::</span>string <span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            size_t pos <span class="token operator">=</span> _filename<span class="token punctuation">.</span><span class="token function">find_last_of</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pos <span class="token operator">==</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>npos<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> _filename<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> _filename<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">bool</span> <span class="token function">setContent</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>body<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>ofstream ofs<span class="token punctuation">;</span>

            ofs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>_filename<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"setContent open failed\n"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            ofs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> body<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"setContent write failed\n"</span><span class="token punctuation">;</span>
                ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">bool</span> <span class="token function">getPosLen</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string <span class="token operator">*</span>body<span class="token punctuation">,</span> size_t pos<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>ifstream ifs<span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> len <span class="token operator">&gt;</span> <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"getPosLen failed\n"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            ifs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>_filename<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ifs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"getPosLen open failed\n"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            body<span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span>len <span class="token operator">-</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ifs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">*</span>body<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ifs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"getPosLen read failed\n"</span><span class="token punctuation">;</span>
                ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            ifs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">bool</span> <span class="token function">getContent</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string <span class="token operator">*</span>body<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            size_t n <span class="token operator">=</span> <span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token function">getPosLen</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        

        <span class="token keyword">bool</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> fs<span class="token double-colon punctuation">::</span><span class="token function">exists</span><span class="token punctuation">(</span>_filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">createDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            
            <span class="token keyword">return</span> fs<span class="token double-colon punctuation">::</span><span class="token function">create_directories</span><span class="token punctuation">(</span>_filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">getDirectory</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> <span class="token operator">*</span>arry<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> fs<span class="token double-colon punctuation">::</span>directory_entry<span class="token operator">&amp;</span> entry <span class="token operator">:</span> fs<span class="token double-colon punctuation">::</span>directory_iterator<span class="token punctuation">{<!-- --></span>_filename<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>fs<span class="token double-colon punctuation">::</span><span class="token function">is_directory</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                arry<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>fs<span class="token double-colon punctuation">::</span><span class="token function">path</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">relative_path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">bool</span> <span class="token function">compress</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>packname<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
           
            std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span>
            <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string buffer <span class="token operator">=</span> bundle<span class="token double-colon punctuation">::</span><span class="token function">pack</span><span class="token punctuation">(</span>bundle<span class="token double-colon punctuation">::</span>LZIP<span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>

            std<span class="token double-colon punctuation">::</span>ofstream ofs<span class="token punctuation">;</span>
            ofs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>packname<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"compress open failed\n"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ofs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"compress write failed\n"</span><span class="token punctuation">;</span>
                ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">bool</span> <span class="token function">uncompress</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>filename<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span>
            <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string buffer <span class="token operator">=</span> bundle<span class="token double-colon punctuation">::</span><span class="token function">unpack</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>

            std<span class="token double-colon punctuation">::</span>ofstream ofs<span class="token punctuation">;</span>
            ofs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>ios<span class="token double-colon punctuation">::</span>binary<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"uncompress open failed\n"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ofs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ofs<span class="token punctuation">.</span><span class="token function">good</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"uncompress write failed\n"</span><span class="token punctuation">;</span>
                ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ofs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">private</span><span class="token operator">:</span>
        std<span class="token double-colon punctuation">::</span>string _filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">JsonUtil</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">Serialize</span><span class="token punctuation">(</span><span class="token keyword">const</span> Json<span class="token double-colon punctuation">::</span>Value <span class="token operator">&amp;</span>root<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">*</span>str<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Json<span class="token double-colon punctuation">::</span>StreamWriterBuilder swb<span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Json<span class="token double-colon punctuation">::</span>StreamWriter<span class="token operator">&gt;</span> <span class="token function">sw</span><span class="token punctuation">(</span>swb<span class="token punctuation">.</span><span class="token function">newStreamWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">;</span>
            <span class="token keyword">int</span> ret <span class="token operator">=</span> sw<span class="token operator">-&gt;</span><span class="token function">write</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ss<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Serialize failed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token operator">*</span>str <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">UnSerialize</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> Json<span class="token double-colon punctuation">::</span>Value <span class="token operator">*</span>root<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Json<span class="token double-colon punctuation">::</span>CharReaderBuilder crb<span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Json<span class="token double-colon punctuation">::</span>CharReader<span class="token operator">&gt;</span> <span class="token function">cr</span><span class="token punctuation">(</span>crb<span class="token punctuation">.</span><span class="token function">newCharReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            std<span class="token double-colon punctuation">::</span>string errs<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> ret <span class="token operator">=</span> cr<span class="token operator">-&gt;</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> root<span class="token punctuation">,</span> <span class="token operator">&amp;</span>errs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"UnSerialize failed "</span> <span class="token operator">&lt;&lt;</span> errs <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="confighpp_263"></a>config.hpp</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;mutex&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"util.hpp"</span></span>
<span class="token keyword">namespace</span> cloud
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CONFIG_FILE</span> <span class="token string">"./cloud.conf"</span></span>
    <span class="token keyword">class</span> <span class="token class-name">Config</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">ReadConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">ReadConfigFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>CONFIG_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span> 
            <span class="token keyword">bool</span> ret <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ReadConfigFile getContent faile"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span>
            ret <span class="token operator">=</span> cloud<span class="token double-colon punctuation">::</span><span class="token class-name">JsonUtil</span><span class="token double-colon punctuation">::</span><span class="token function">UnSerialize</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ReadConfigFile UnSerialize faile"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            _hot_time <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"hot_time"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server_port <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"server_port"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server_ip <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"server_ip"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _download_prefix <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"download_prefix"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _packfile_suffix <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"packfile_suffix"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _pack_dir <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"pack_dir"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _back_dir <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"back_dir"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _backup_file <span class="token operator">=</span> root<span class="token punctuation">[</span><span class="token string">"backup_file"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">static</span> Config<span class="token operator">*</span> <span class="token function">getIstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>_instance <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                _mtx<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>_instance <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                _mtx<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">return</span> _instance<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> <span class="token function">getHotTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _hot_time<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> <span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _server_port<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getServerIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _server_ip<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getDownloadPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _download_prefix<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getPackfileSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _packfile_suffix<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getPackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _pack_dir<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getBackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _back_dir<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        std<span class="token double-colon punctuation">::</span>string <span class="token function">getBackupFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> _backup_file<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">static</span> Config<span class="token operator">*</span> _instance<span class="token punctuation">;</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>mutex _mtx<span class="token punctuation">;</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> _hot_time<span class="token punctuation">;</span>
        <span class="token keyword">int</span> _server_port<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _server_ip<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _download_prefix<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _packfile_suffix<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _pack_dir<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _back_dir<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _backup_file<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Config<span class="token operator">*</span> Config<span class="token double-colon punctuation">::</span>_instance <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>mutex Config<span class="token double-colon punctuation">::</span>_mtx<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token comment">// namespace cloud</span>
</code></pre> 
<h2><a id="hothpp_372"></a>hot.hpp</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdio&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"data.hpp"</span></span>
<span class="token keyword">extern</span> cloud<span class="token double-colon punctuation">::</span>dataManager <span class="token operator">*</span>_data<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> cloud
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> <span class="token class-name">HotManager</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token comment">//非热点文件返回否, 热点文件返回真</span>
        <span class="token keyword">bool</span> <span class="token function">hotJuge</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            time_t last_atime <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">lastAccessTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            time_t cur_time <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>cur_time <span class="token operator">-</span> last_atime <span class="token operator">&gt;</span> _hot_time<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">HotManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Config<span class="token operator">*</span> f <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token double-colon punctuation">::</span><span class="token function">getIstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _back_dir <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getBackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _pack_dir <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getPackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _packfile_suffix <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getPackfileSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _hot_time <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getHotTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            fileUtil <span class="token function">fu1</span><span class="token punctuation">(</span>_back_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileUtil <span class="token function">fu2</span><span class="token punctuation">(</span>_pack_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fu1<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fu2<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">runMoudle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//std::cout &lt;&lt; -1 &lt;&lt; std::endl;</span>
                fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>_back_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

                std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> arry<span class="token punctuation">;</span>
                fu<span class="token punctuation">.</span><span class="token function">getDirectory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arry<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> arry<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">hotJuge</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">continue</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    BackupInfo info<span class="token punctuation">;</span>
                    <span class="token keyword">bool</span> ret <span class="token operator">=</span> _data<span class="token operator">-&gt;</span><span class="token function">getBifoByRealPath</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token operator">&amp;</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"runMoudle faile"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                        info<span class="token punctuation">.</span><span class="token function">NewBackupInfo</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fu<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>pack_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fu<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    info<span class="token punctuation">.</span>pack_flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    _data<span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
      
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        std<span class="token double-colon punctuation">::</span>string _back_dir<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _pack_dir<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _packfile_suffix<span class="token punctuation">;</span>
        <span class="token keyword">int</span> _hot_time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="datahpp_457"></a>data.hpp</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unordered_map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"util.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"config.hpp"</span></span>

<span class="token keyword">namespace</span> cloud
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token class-name">BackupInfo</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">bool</span> pack_flag<span class="token punctuation">;</span>
        size_t file_size<span class="token punctuation">;</span>
        time_t modify_time<span class="token punctuation">;</span>
        time_t access_time<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string real_path<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string pack_path<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string url<span class="token punctuation">;</span>

        <span class="token keyword">bool</span> <span class="token function">NewBackupInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filepath<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//std::cout &lt;&lt; filepath &lt;&lt; std::endl;</span>
            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>fu<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"NewBackupInfo fail"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            pack_flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">//std::cout &lt;&lt; fu.fileSize() &lt;&lt; std::endl;</span>
            file_size <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">fileSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            modify_time <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">lastModifyTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            access_time <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">lastAccessTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            real_path <span class="token operator">=</span> filepath<span class="token punctuation">;</span>

            Config<span class="token operator">*</span> f <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token double-colon punctuation">::</span><span class="token function">getIstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string packdir <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getPackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string packfile_suffix <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getPackfileSuffix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pack_path <span class="token operator">=</span> packdir <span class="token operator">+</span> fu<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> packfile_suffix<span class="token punctuation">;</span>

            std<span class="token double-colon punctuation">::</span>string download_prefix <span class="token operator">=</span> f<span class="token operator">-&gt;</span><span class="token function">getDownloadPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            url <span class="token operator">=</span> download_prefix <span class="token operator">+</span> fu<span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">dataManager</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">dataManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _backup_file <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token double-colon punctuation">::</span><span class="token function">getIstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getBackupFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">pthread_rwlock_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">initLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">initLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//初始化程序运行时从文件读取数据</span>
        <span class="token punctuation">{<!-- --></span>
            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>_backup_file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>fu<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> ret <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"InitLoad getContent failed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            

            Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span>
            ret <span class="token operator">=</span> <span class="token class-name">JsonUtil</span><span class="token double-colon punctuation">::</span><span class="token function">UnSerialize</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token operator">&amp;</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"InitLoad getContent failed"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> root<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                BackupInfo info<span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>pack_flag <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"pack_flag"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>file_size <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"file_size"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>modify_time <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"modify_time"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>access_time <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"access_time"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>real_path <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"real_path"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>pack_path <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"pack_path"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>url <span class="token operator">=</span> root<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//_table[info.url] = info;</span>
                <span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//每次有信息改变则需要持久化存储一次</span>
        <span class="token punctuation">{<!-- --></span>
            Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> _table<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Json<span class="token double-colon punctuation">::</span>Value tmp<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"pack_flag"</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>pack_flag<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"file_size"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Json<span class="token double-colon punctuation">::</span>Int64<span class="token punctuation">)</span>e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>file_size<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"modify_time"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Json<span class="token double-colon punctuation">::</span>Int64<span class="token punctuation">)</span>e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>modify_time<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"access_time"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Json<span class="token double-colon punctuation">::</span>Int64<span class="token punctuation">)</span>e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>access_time<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"real_path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>real_path<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"pack_path"</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>pack_path<span class="token punctuation">;</span>
                tmp<span class="token punctuation">[</span><span class="token string">"url"</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>url<span class="token punctuation">;</span>

                root<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            std<span class="token double-colon punctuation">::</span>string body<span class="token punctuation">;</span>
            <span class="token keyword">bool</span> ret <span class="token operator">=</span> <span class="token class-name">JsonUtil</span><span class="token double-colon punctuation">::</span><span class="token function">Serialize</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Storage Serialize faile"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>_backup_file<span class="token punctuation">)</span><span class="token punctuation">;</span>
            ret <span class="token operator">=</span> fu<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Storage setContent faile"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> BackupInfo<span class="token operator">&amp;</span> Info<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _table<span class="token punctuation">[</span>Info<span class="token punctuation">.</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> Info<span class="token punctuation">;</span>
            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">const</span> BackupInfo<span class="token operator">&amp;</span> Info<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _table<span class="token punctuation">[</span>Info<span class="token punctuation">.</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> Info<span class="token punctuation">;</span>
            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">getBifoByUrl</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> url<span class="token punctuation">,</span> BackupInfo<span class="token operator">*</span> Info<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//问题这个应该是读者模式锁还是写者模式锁呢?</span>
            <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">auto</span> ret <span class="token operator">=</span> _table<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> _table<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token operator">*</span>Info <span class="token operator">=</span> ret<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">getBifoByRealPath</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> realPath<span class="token punctuation">,</span> BackupInfo<span class="token operator">*</span> Info<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> _table<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>second<span class="token punctuation">.</span>real_path <span class="token operator">==</span> realPath<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token operator">*</span>Info <span class="token operator">=</span> e<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
                    <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">getAll</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>BackupInfo<span class="token operator">&gt;</span> <span class="token operator">*</span>arry<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">pthread_rwlock_wrlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> _table<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                arry<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">pthread_rwlock_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">~</span><span class="token function">dataManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">pthread_rwlock_destroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_rwlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        std<span class="token double-colon punctuation">::</span>string _backup_file<span class="token punctuation">;</span>
        pthread_rwlock_t _rwlock<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>unordered_map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> BackupInfo<span class="token operator">&gt;</span> _table<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="serverhpp_663"></a>server.hpp</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"data.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"httplib.h"</span></span>

<span class="token keyword">extern</span> cloud<span class="token double-colon punctuation">::</span>dataManager <span class="token operator">*</span>_data<span class="token punctuation">;</span>
<span class="token keyword">namespace</span> cloud
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> <span class="token class-name">serevr</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">upLoad</span><span class="token punctuation">(</span><span class="token keyword">const</span> httplib<span class="token double-colon punctuation">::</span>Request<span class="token operator">&amp;</span> rq<span class="token punctuation">,</span> <span class="token keyword">const</span> httplib<span class="token double-colon punctuation">::</span>Response<span class="token operator">&amp;</span> rp<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">bool</span> ret <span class="token operator">=</span> rq<span class="token punctuation">.</span><span class="token function">has_file</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> file <span class="token operator">=</span> rq<span class="token punctuation">.</span><span class="token function">get_file_value</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string real_path <span class="token operator">=</span> _back_dir <span class="token operator">+</span> <span class="token function">fileUtil</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>real_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fu<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

            BackupInfo info<span class="token punctuation">;</span>
            info<span class="token punctuation">.</span><span class="token function">NewBackupInfo</span><span class="token punctuation">(</span>real_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _data<span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">timeToString</span><span class="token punctuation">(</span>time_t t<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">ctime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">listShow</span><span class="token punctuation">(</span><span class="token keyword">const</span> httplib<span class="token double-colon punctuation">::</span>Request<span class="token operator">&amp;</span> rq<span class="token punctuation">,</span> httplib<span class="token double-colon punctuation">::</span>Response<span class="token operator">&amp;</span> rp<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>BackupInfo<span class="token operator">&gt;</span> arry<span class="token punctuation">;</span>
            _data<span class="token operator">-&gt;</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>stringstream ss<span class="token punctuation">;</span>
            ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Download&lt;/title&gt;&lt;/head&gt;"</span><span class="token punctuation">;</span>
            ss <span class="token operator">&lt;&lt;</span> <span class="token string">" &lt;body&gt;&lt;h1&gt;Download&lt;/h1&gt;&lt;table&gt;"</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> arry<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;tr&gt;"</span><span class="token punctuation">;</span>

                std<span class="token double-colon punctuation">::</span>string filename <span class="token operator">=</span> <span class="token function">fileUtil</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>real_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;td&gt;&lt;a href='"</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span>url <span class="token operator">&lt;&lt;</span> <span class="token string">"'&gt;"</span> <span class="token operator">&lt;&lt;</span> filename <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;/a&gt;&lt;/td&gt;"</span><span class="token punctuation">;</span>

                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;td align='right'&gt;"</span><span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> <span class="token function">timeToString</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>modify_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;/td&gt;"</span><span class="token punctuation">;</span>

                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;td align='right'&gt;"</span><span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span>file_size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"K"</span><span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;/td&gt;"</span><span class="token punctuation">;</span>

                ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;/tr&gt;"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            ss <span class="token operator">&lt;&lt;</span> <span class="token string">"&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span>body <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span><span class="token function">set_header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">getETagInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> BackupInfo<span class="token operator">&amp;</span> info<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>string etag<span class="token punctuation">;</span>
            etag <span class="token operator">+=</span> <span class="token function">fileUtil</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>real_path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            etag <span class="token operator">+=</span> <span class="token string">"-"</span><span class="token punctuation">;</span>
            etag <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>file_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            etag <span class="token operator">+=</span> <span class="token string">"-"</span><span class="token punctuation">;</span>
            etag <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>modify_time<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> etag<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">downLoad</span><span class="token punctuation">(</span><span class="token keyword">const</span> httplib<span class="token double-colon punctuation">::</span>Request<span class="token operator">&amp;</span> rq<span class="token punctuation">,</span> httplib<span class="token double-colon punctuation">::</span>Response<span class="token operator">&amp;</span> rp<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>string url <span class="token operator">=</span> rq<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
            <span class="token comment">//std::cout &lt;&lt; url &lt;&lt; std::endl;</span>
            BackupInfo info<span class="token punctuation">;</span>
            _data<span class="token operator">-&gt;</span><span class="token function">getBifoByUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token operator">&amp;</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//std::cout &lt;&lt; info.real_path &lt;&lt; std::endl;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>pack_flag <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//解压文件</span>
                fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>pack_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
                fu<span class="token punctuation">.</span><span class="token function">uncompress</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>real_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">//删除压缩文件, 并修改BackupInfo信息</span>
                fu<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info<span class="token punctuation">.</span>pack_flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                _data<span class="token operator">-&gt;</span><span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// if(rq.has_header("If-Range"))</span>
            <span class="token comment">//     std::cout &lt;&lt; "hello" &lt;&lt; std::endl;</span>
            <span class="token comment">// else</span>
            <span class="token comment">//     std::cout &lt;&lt; "no" &lt;&lt; std::endl;</span>
            <span class="token comment">// for(auto&amp; e : rp.headers)</span>
            <span class="token comment">// {<!-- --></span>
            <span class="token comment">//     std::cout &lt;&lt; e.second &lt;&lt; std::endl;</span>
            <span class="token comment">// }</span>

            fileUtil <span class="token function">fu</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>real_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            fu<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rp<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span><span class="token function">set_header</span><span class="token punctuation">(</span><span class="token string">"Accept-Ranges"</span><span class="token punctuation">,</span> <span class="token string">"bytes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span><span class="token function">set_header</span><span class="token punctuation">(</span><span class="token string">"ETag"</span><span class="token punctuation">,</span> <span class="token function">getETagInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rp<span class="token punctuation">.</span><span class="token function">set_header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//rp.status = 200;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>rq<span class="token punctuation">.</span><span class="token function">has_header</span><span class="token punctuation">(</span><span class="token string">"If-Range"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> rq<span class="token punctuation">.</span><span class="token function">get_header_value</span><span class="token punctuation">(</span><span class="token string">"If-Range"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">getETagInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                rp<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">206</span><span class="token punctuation">;</span>
                <span class="token comment">//std::cout &lt;&lt; rp.status &lt;&lt; std::endl;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                rp<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token function">serevr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            Config<span class="token operator">*</span> cnf <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token double-colon punctuation">::</span><span class="token function">getIstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server_port <span class="token operator">=</span> cnf<span class="token operator">-&gt;</span><span class="token function">getServerPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server_ip <span class="token operator">=</span> cnf<span class="token operator">-&gt;</span><span class="token function">getServerIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _download_prefix <span class="token operator">=</span> cnf<span class="token operator">-&gt;</span><span class="token function">getDownloadPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _back_dir <span class="token operator">=</span> cnf<span class="token operator">-&gt;</span><span class="token function">getBackDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">bool</span> <span class="token function">RunModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            _server<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">,</span>upLoad<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"/listshow"</span><span class="token punctuation">,</span> listShow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> listShow<span class="token punctuation">)</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string url <span class="token operator">=</span> _download_prefix <span class="token operator">+</span> <span class="token string">"(.*)"</span><span class="token punctuation">;</span>
            _server<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>downLoad<span class="token punctuation">)</span><span class="token punctuation">;</span>
            _server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> _server_port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
        <span class="token keyword">int</span> _server_port<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _server_ip<span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span>string _download_prefix<span class="token punctuation">;</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string _back_dir<span class="token punctuation">;</span>
        httplib<span class="token double-colon punctuation">::</span>Server _server<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string serevr<span class="token double-colon punctuation">::</span>_back_dir<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="servercc_816"></a>server.cc</h2> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"util.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"config.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"data.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"hot.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"server.hpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;thread&gt;</span></span>

cloud<span class="token double-colon punctuation">::</span>dataManager <span class="token operator">*</span>_data<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">server</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cloud<span class="token double-colon punctuation">::</span>serevr s<span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">RunModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">hot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cloud<span class="token double-colon punctuation">::</span>HotManager h<span class="token punctuation">;</span>
    h<span class="token punctuation">.</span><span class="token function">runMoudle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// if(argc != 2)</span>
    <span class="token comment">// {<!-- --></span>
    <span class="token comment">//     std::cout &lt;&lt; argv[0] &lt;&lt; " filepath newfilename" &lt;&lt; std::endl;</span>
    <span class="token comment">//     exit(1);</span>
    <span class="token comment">// }</span>

    <span class="token comment">// std::string name = argv[1];</span>
    <span class="token comment">// cloud::fileUtil f(name);</span>
    <span class="token comment">// std::cout &lt;&lt; f.fileSize() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.lastModifyTime() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.lastAccessTime() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.fileName() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::string buffer;</span>
    <span class="token comment">// f.getContent(&amp;buffer);</span>

    <span class="token comment">// name = argv[2];</span>
    <span class="token comment">// cloud::fileUtil f2(name);</span>
    <span class="token comment">// f2.setContent(buffer);</span>

    <span class="token comment">// std::string name = argv[1];</span>
    <span class="token comment">// cloud::fileUtil f(name);</span>
    <span class="token comment">// f.compress(name += ".lz");</span>
    <span class="token comment">// f.uncompress(name += ".backup");</span>

    <span class="token comment">// cloud::fileUtil f(name);</span>
    <span class="token comment">// f.createDirectory();</span>
    <span class="token comment">// std::vector&lt;std::string&gt; arry;</span>
    <span class="token comment">// f.getDirectory(&amp;arry);</span>
    <span class="token comment">// for(auto&amp; e : arry)</span>
    <span class="token comment">// {<!-- --></span>
    <span class="token comment">//     std::cout &lt;&lt; e &lt;&lt; std::endl;</span>
    <span class="token comment">// }</span>

    <span class="token comment">// const char* name = "xiaolion";</span>
    <span class="token comment">// int age = 18;</span>
    <span class="token comment">// int score[] = {100, 98, 89};</span>

    <span class="token comment">// Json::Value root;</span>
    <span class="token comment">// root["name"] = name;</span>
    <span class="token comment">// root["age"] = age;</span>
    <span class="token comment">// root["socre"].append(score[0]);</span>
    <span class="token comment">// root["socre"].append(score[1]);</span>
    <span class="token comment">// root["socre"].append(score[2]);</span>

    <span class="token comment">// std::string str;</span>
    <span class="token comment">// cloud::JsonUtil::Serialize(root, &amp;str);</span>
    <span class="token comment">// std::cout &lt;&lt; str &lt;&lt; std::endl;</span>

    <span class="token comment">// Json::Value val;</span>
    <span class="token comment">// cloud::JsonUtil::UnSerialize(str, &amp;val);</span>
    <span class="token comment">// std::cout &lt;&lt; val["name"].asString() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; val["age"].asInt() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; val["socre"][0].asInt() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; val["socre"][1].asInt() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; val["socre"][2].asInt() &lt;&lt; std::endl;</span>

    <span class="token comment">// cloud::Config* f = cloud::Config::getIstance();</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getHotTime() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getServerPort() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getServerIp() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getDownloadPrefix() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getPackfileSuffix() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getPackDir() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getBackDir() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f-&gt;getBackupFile() &lt;&lt; std::endl;</span>

    <span class="token comment">// cloud::BackupInfo f;</span>
    <span class="token comment">// f.NewBackupInfo(argv[1]);</span>
    <span class="token comment">// cloud::fileUtil f1(argv[1]);</span>
    <span class="token comment">// std::cout &lt;&lt; f1.fileSize() &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; argv[1] &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.pack_flag &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.file_size &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.modify_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.access_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.real_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.pack_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; f.url &lt;&lt; std::endl;</span>
    <span class="token comment">// cloud::dataManager d;</span>
    <span class="token comment">// d.insert(f);</span>
    <span class="token comment">// f.pack_flag = true;</span>
    <span class="token comment">// d.update(f);</span>

    <span class="token comment">// cloud::BackupInfo tmp;</span>
    <span class="token comment">// d.getBifoByRealPath(argv[1], &amp;tmp);</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.pack_flag &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.file_size &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.modify_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.access_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.real_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.pack_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp.url &lt;&lt; std::endl;</span>

    <span class="token comment">// cloud::BackupInfo tmp2;</span>
    <span class="token comment">// d.getBifoByUrl(f.url, &amp;tmp2);</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.pack_flag &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.file_size &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.modify_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.access_time &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.real_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.pack_path &lt;&lt; std::endl;</span>
    <span class="token comment">// std::cout &lt;&lt; tmp2.url &lt;&lt; std::endl;</span>

    <span class="token comment">// std::vector&lt;cloud::BackupInfo&gt; arry;</span>
    <span class="token comment">// d.getAll(&amp;arry);</span>
    <span class="token comment">// for(auto&amp; e : arry)</span>
    <span class="token comment">// {<!-- --></span>
    <span class="token comment">//     std::cout &lt;&lt; e.pack_flag &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.file_size &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.modify_time &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.access_time &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.real_path &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.pack_path &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.url &lt;&lt; std::endl;</span>
    <span class="token comment">// }</span>

    <span class="token comment">// cloud::BackupInfo f;</span>
    <span class="token comment">// f.NewBackupInfo(argv[1]);</span>
    <span class="token comment">// cloud::dataManager d;</span>
    <span class="token comment">// d.insert(f);</span>

    <span class="token comment">// cloud::dataManager d;</span>
    <span class="token comment">// std::vector&lt;cloud::BackupInfo&gt; arry;</span>
    <span class="token comment">// d.getAll(&amp;arry);</span>
    <span class="token comment">// for(auto&amp; e : arry)</span>
    <span class="token comment">// {<!-- --></span>
    <span class="token comment">//     std::cout &lt;&lt; e.pack_flag &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.file_size &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.modify_time &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.access_time &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.real_path &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.pack_path &lt;&lt; std::endl;</span>
    <span class="token comment">//     std::cout &lt;&lt; e.url &lt;&lt; std::endl;</span>
    <span class="token comment">// }</span>

    <span class="token comment">//_data = new cloud::dataManager();</span>
    <span class="token comment">// cloud::HotManager ht;</span>
    <span class="token comment">// ht.runMoudle();</span>
    <span class="token comment">// cloud::serevr srv;</span>
    <span class="token comment">// srv.RunModule();</span>

    <span class="token comment">// httplib::Server _server;</span>
    <span class="token comment">// _server.Post("/upload", upLoad);</span>
    <span class="token comment">// _server.Get("/listshow", listShow);</span>
    <span class="token comment">// _server.Get("/", listShow);</span>
    <span class="token comment">// _server.Get("/", downLoad);</span>
    <span class="token comment">// _server.listen("", 8080);</span>

    _data <span class="token operator">=</span> <span class="token keyword">new</span> cloud<span class="token double-colon punctuation">::</span><span class="token function">dataManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">thread_hot</span><span class="token punctuation">(</span>hot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>thread <span class="token function">thread_server</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>

    thread_hot<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread_server<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Makefile_997"></a>Makefile</h2> 
<pre><code class="prism language-cpp"><span class="token punctuation">.</span>PHONY<span class="token operator">:</span>util
cloudServer<span class="token operator">:</span>cloudServer<span class="token punctuation">.</span>cc
	g<span class="token operator">++</span> <span class="token operator">-</span>o $@ $<span class="token operator">^</span> <span class="token operator">-</span>L<span class="token punctuation">.</span><span class="token operator">/</span>lib <span class="token operator">-</span>lpthread <span class="token operator">-</span>lstdc<span class="token operator">++</span>fs <span class="token operator">-</span>ljsoncpp <span class="token operator">-</span>lbundle
</code></pre> 
<h2><a id="cloudconf_1004"></a>cloud.conf</h2> 
<pre><code class="prism language-cpp"><span class="token punctuation">{<!-- --></span>
    <span class="token string">"hot_time"</span> <span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token string">"server_port"</span> <span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token string">"server_ip"</span> <span class="token operator">:</span> <span class="token string">"-.-.-.-"</span><span class="token punctuation">,</span>
    <span class="token string">"download_prefix"</span> <span class="token operator">:</span> <span class="token string">"/download/"</span><span class="token punctuation">,</span>
    <span class="token string">"packfile_suffix"</span> <span class="token operator">:</span> <span class="token string">".lz"</span><span class="token punctuation">,</span>
    <span class="token string">"pack_dir"</span> <span class="token operator">:</span> <span class="token string">"./packdir/"</span><span class="token punctuation">,</span>
    <span class="token string">"back_dir"</span> <span class="token operator">:</span> <span class="token string">"./backdir/"</span><span class="token punctuation">,</span>
    <span class="token string">"backup_file"</span> <span class="token operator">:</span> <span class="token string">"./cloud.dat"</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7cac5b9f3658a2ca1e2b97bd0fe41e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在 ASP.NET Core Web Api 项目中应用 NLog 写日志？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d97ca0de8a88e04683946cdc93c97858/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习300问】112、什么是特征点检测？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>