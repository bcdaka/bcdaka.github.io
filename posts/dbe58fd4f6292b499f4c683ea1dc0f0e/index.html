<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【一起学Rust | 框架篇 | Tauri2.0框架】rust和前端的相互调用（前端调用rust） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/dbe58fd4f6292b499f4c683ea1dc0f0e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【一起学Rust | 框架篇 | Tauri2.0框架】rust和前端的相互调用（前端调用rust）">
  <meta property="og:description" content="文章目录 前言1. 前端调用rust（command）1. 在后端定义一个`command`2. 注册`command`3. 前端调用`command` 2. 前端调用rust（event）4. command完整实例 前言 本期将继续接着上一期，继续探索tauri中rust和前端的相互调用，上一期我们介绍了rust调用前端，这一期我们继续探索前端调用rust。
首先还是回忆一下上周tauri的前后端通信示意图
从该图片我们可以清晰的看出来，tauri的前端和rust后端通信是通过事件机制来实现的，在上期中，我介绍了事件机制的基础，以及如何通过rust的工具来调用前端的方法，也就是触发前端监听的事件。
这张图是双向的，也就是说前端也可以触发rust监听的事件，这样前端也可以调用rust的方法，这也是本期的主要内容。
除此以外，tauri官方推荐的前端调用rust后端的主要方法是通过command来调用，因此，如果你要做的东西比较简单，那么更建议使用command来调用，因为command的调用方式更简单，更符合前端开发者的习惯，而且选择合适的使用场景的能力对于一个开发人员来说也是非常重要的。
从图上可以看出，tauri的command其实与fetch api是非常相似的，都是请求、响应的模式，但其实这个机制是使用json-rpc来实现的（这些都是官方写的），不过这个不需要深究，除非你是老专家。我们只需要知道怎么用的，置于原理那是后面的事情，如果tauri可以活到那个时候的话。
以上是tauri使用command来与rust后端通信的流程图。其中一些转换方法tauri已经为我们实现了，当你理解了这张图，在使用command时就会非常简单。
Because this mechanism uses a JSON-RPC like protocol under the hood to serialize requests and responses, all arguments and return data must be serializable to JSON.
注意：本文内容均可在官方文档中找到对应内容： https://v2.tauri.app/concept/inter-process-communication/
1. 前端调用rust（command） 为了更加方便的描述tauri是如何从前端调用rust的，我先写一个流程，然后以这个流程来逐步实现该功能。
在rust后端定义一个command注册command前端调用command 1. 在后端定义一个command 在rust中，command的定义非常简单，只需要在src-tauri/src/main.rs中定义一个函数，并使用tauri::command!宏来标记该函数为command即可，就像程序自带的command，greet就是这么做的（学习就是在看例子）。
#[tauri::command] fn greet(name: &amp;str) -&gt; String { format!(&#34;Hello, {}! You&#39;ve been greeted from Rust!&#34;, name) } 在这个greet的例子中，可以看到，name是需要传入的参数，然后返回一个格式化的字符串。（不写分号等于返回，不需要写return）">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-27T10:12:22+08:00">
    <meta property="article:modified_time" content="2024-08-27T10:12:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【一起学Rust | 框架篇 | Tauri2.0框架】rust和前端的相互调用（前端调用rust）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/69/14/pcjKjDlS_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#1_rustcommand_32" rel="nofollow">1. 前端调用rust（command）</a></li><li><ul><li><a href="#1_command_40" rel="nofollow">1. 在后端定义一个`command`</a></li><li><a href="#2_command_64" rel="nofollow">2. 注册`command`</a></li><li><a href="#3_command_83" rel="nofollow">3. 前端调用`command`</a></li></ul> 
   </li><li><a href="#2_rustevent_98" rel="nofollow">2. 前端调用rust（event）</a></li><li><a href="#4_command_157" rel="nofollow">4. command完整实例</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="_7"></a>前言</h3> 
<p>本期将继续接着上一期，继续探索tauri中rust和前端的相互调用，上一期我们介绍了rust调用前端，这一期我们继续探索前端调用rust。</p> 
<p>首先还是回忆一下上周tauri的前后端通信示意图</p> 
<p><img src="https://images2.imgbox.com/07/74/14yaKhPV_o.png" alt="tauri事件机制"></p> 
<p>从该图片我们可以清晰的看出来，tauri的前端和rust后端通信是通过事件机制来实现的，在上期中，我介绍了事件机制的基础，以及如何通过rust的工具来调用前端的方法，也就是触发前端监听的事件。</p> 
<p>这张图是双向的，也就是说前端也可以触发rust监听的事件，这样前端也可以调用rust的方法，这也是本期的主要内容。</p> 
<p>除此以外，tauri官方推荐的前端调用rust后端的主要方法是通过<code>command</code>来调用，因此，如果你要做的东西比较简单，那么更建议使用<code>command</code>来调用，因为<code>command</code>的调用方式更简单，更符合前端开发者的习惯，而且选择合适的使用场景的能力对于一个开发人员来说也是非常重要的。</p> 
<p><img src="https://images2.imgbox.com/da/c8/19Wl8fPp_o.png" alt="Command通信示意图"></p> 
<p>从图上可以看出，tauri的<code>command</code>其实与<code>fetch api</code>是非常相似的，都是请求、响应的模式，但其实这个机制是使用json-rpc来实现的（这些都是官方写的），不过这个不需要深究，除非你是老专家。我们只需要知道怎么用的，置于原理那是后面的事情，如果tauri可以活到那个时候的话。</p> 
<p>以上是tauri使用<code>command</code>来与rust后端通信的流程图。其中一些转换方法tauri已经为我们实现了，当你理解了这张图，在使用<code>command</code>时就会非常简单。</p> 
<blockquote> 
 <p>Because this mechanism uses a JSON-RPC like protocol under the hood to serialize requests and responses, all arguments and return data must be serializable to JSON.</p> 
</blockquote> 
<blockquote> 
 <p><strong>注意</strong>：本文内容均可在<code>官方文档</code>中找到对应内容： https://v2.tauri.app/concept/inter-process-communication/</p> 
</blockquote> 
<h3><a id="1_rustcommand_32"></a>1. 前端调用rust（command）</h3> 
<p>为了更加方便的描述tauri是如何从前端调用rust的，我先写一个流程，然后以这个流程来逐步实现该功能。</p> 
<ol><li>在rust后端定义一个<code>command</code></li><li>注册<code>command</code></li><li>前端调用<code>command</code></li></ol> 
<h4><a id="1_command_40"></a>1. 在后端定义一个<code>command</code></h4> 
<p>在rust中，<code>command</code>的定义非常简单，只需要在<code>src-tauri/src/main.rs</code>中定义一个函数，并使用<code>tauri::command!</code>宏来标记该函数为<code>command</code>即可，就像程序自带的<code>command</code>，greet就是这么做的（学习就是在看例子）。</p> 
<pre><code class="prism language-rust"><span class="token attribute attr-name">#[tauri::command]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{<!-- --></span>
    <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"Hello, {}! You've been greeted from Rust!"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个greet的例子中，可以看到，name是需要传入的参数，然后返回一个格式化的字符串。（不写分号等于返回，不需要写return）<br> 那么在这里需要注意的是参数，也就是tauri如何接受参数，根据官方文档，传入参数可以是任意类型，但是前提是这个类型必须实现<code>serde::Deserialize</code>。</p> 
<p><strong>注意</strong>：参数是可以重命名的，类似于后端开发中的dto,但是需要使用<code>#[tauri::command(rename_all = "snake_case")]</code>来标记，否则tauri会报错。这样前端就可以传入与后端参数名一样了。</p> 
<p>返回值必须是String，因为要序列化（其实<strong>可以返回任何类型</strong>，但是你的类型必须实现<code>serde::Serialize</code>，如果是传入参数，那么必须实现<code>serde::Deserialize</code>，个人建议这两个序列化和反序列化的特征全部实现，就不用考虑那么多了，如果你比较仔细，就可以在这仔细看看）。</p> 
<p>初次以外还可以返回数组buffer,可以用（tauri::ipc::Response），错误处理也可使用Result，本文章不可能做到面面俱到，读者应学会看官方文档，当然在后续文章中我应该也是会补上的。</p> 
<blockquote> 
 <p><strong>注意</strong>:</p> 
 <ol><li>其实你也可以把<code>command</code>放在<code>lib.rs</code>，拆分开这样代码才会更加条理。</li><li><code>command</code>是唯一的，不允许重复，也就是说，你得注意命名规范，避免重复。</li></ol> 
</blockquote> 
<h4><a id="2_command_64"></a>2. 注册<code>command</code></h4> 
<p>在定义完<code>command</code>之后，我们需要将<code>command</code>注册到tauri中，这样tauri才能知道我们定义了哪些<code>command</code>，前端才能调用这些<code>command</code>。</p> 
<p>在<code>src-tauri/src/main.rs</code>中，我们可以看到<code>tauri::Builder</code>的实例，我们可以在这个实例上调用<code>invoke_handler</code>方法来注册<code>command</code>。</p> 
<pre><code class="prism language-rust"><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">invoke_handler</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_handler!</span><span class="token punctuation">[</span>greet<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这是官方案例中的greet方法，我们只需要学习其使用方法就可以了，可以直接跟在greet后面（那是个数组），或者替换也没关系，就像下面这样</p> 
<pre><code class="prism language-rust"><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">invoke_handler</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_handler!</span><span class="token punctuation">[</span>greet<span class="token punctuation">,</span> another_command<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样就可以注册多个<code>command</code>了。</p> 
<h4><a id="3_command_83"></a>3. 前端调用<code>command</code></h4> 
<p>在tauri 2.0中，tauri导出了invoke方法，因此我们导入该方法以后调用即可。</p> 
<pre><code class="prism language-ts"><span class="token comment">// 导入 invoke 方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> invoke <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tauri-apps/api/core'</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'my_custom_command'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用 command</span>
</code></pre> 
<blockquote> 
 <p><strong>注意</strong>：tauri官方推荐使用异步command,但是经我自己测试是有问题的，异步command执行不了异步方法（笑死）。</p> 
</blockquote> 
<h3><a id="2_rustevent_98"></a>2. 前端调用rust（event）</h3> 
<p>使用事件来进行通信与上期内容是差不多的。在前端中，tauri导出了<code>emit</code>方法，我们导入这个方法就可以触发rust中的监听器。</p> 
<pre><code class="prism language-ts"><span class="token comment">// 导入 emit 方法</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> emit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tauri-apps/api/event'</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'my_custom_event'</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//触发事件</span>
</code></pre> 
<p>其中，<code>payload</code>是传递给rust的参数，是个对象。</p> 
<p>然后在rust中监听这个事件</p> 
<pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Listener</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[cfg_attr(mobile, tauri::mobile_entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>app<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{<!-- --></span>
      app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"my_custom_event"</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>event<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">DownloadStarted</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"downloading {}"</span><span class="token punctuation">,</span> payload<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_context!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"error while running tauri application"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>注意</strong>:你甚至可以用前端监听事件，触发事件，简直非常好用。</p> 
</blockquote> 
<p>发挥你的想象力，如果你想要监听指定webview的事件，那么也是可以实现的</p> 
<pre><code class="prism language-rust"><span class="token keyword">use</span> <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token punctuation">{<!-- --></span><span class="token class-name">Listener</span><span class="token punctuation">,</span> <span class="token class-name">Manager</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[cfg_attr(mobile, tauri::mobile_entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>app<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> webview <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">get_webview_window</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      webview<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"logged-in"</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>event<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> session_token <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token comment">// save token..</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_context!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"error while running tauri application"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>官方文档内容非常多，如果看完这些你还存在问题，那么请看官方文档，或者者在下方留言。</p> 
</blockquote> 
<h3><a id="4_command_157"></a>4. command完整实例</h3> 
<p>在rust中定义command</p> 
<pre><code class="prism language-rust"><span class="token keyword">struct</span> <span class="token type-definition class-name">Database</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(serde::Serialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">CustomResponse</span> <span class="token punctuation">{<!-- --></span>
  message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  other_val<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">some_other_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"response"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tauri::command]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">my_custom_command</span><span class="token punctuation">(</span>
  window<span class="token punctuation">:</span> <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Window</span><span class="token punctuation">,</span>
  number<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
  database<span class="token punctuation">:</span> <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">State</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token punctuation">,</span> <span class="token class-name">Database</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">CustomResponse</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Called from {}"</span><span class="token punctuation">,</span> window<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">some_other_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=</span> result <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">CustomResponse</span> <span class="token punctuation">{<!-- --></span>
      message<span class="token punctuation">,</span>
      other_val<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token operator">+</span> number<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"No result"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg_attr(mobile, tauri::mobile_entry_point)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">manage</span><span class="token punctuation">(</span><span class="token class-name">Database</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">invoke_handler</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_handler!</span><span class="token punctuation">[</span>my_custom_command<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token namespace">tauri<span class="token punctuation">::</span></span><span class="token macro property">generate_context!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"error while running tauri application"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后在前端中调用</p> 
<pre><code class="prism language-ts"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> invoke <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tauri-apps/api/core'</span><span class="token punctuation">;</span>

<span class="token comment">// Invocation from JavaScript</span>
<span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'my_custom_command'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token builtin">number</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Message: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>res<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Other Val: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>res<span class="token punctuation">.</span>other_val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e7e6b420fe42b666c52433f1892d52e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何使用GPT画出带中文的图和表？-已解决GPT画图表出现乱码的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50bc23a7daf3f66c501f479eb41e5de5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ssm基于微信小程序的食堂窗口自助点餐系统源码调试讲解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>