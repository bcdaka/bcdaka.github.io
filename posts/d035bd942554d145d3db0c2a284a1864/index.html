<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 高德地图API（新版） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d035bd942554d145d3db0c2a284a1864/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android 高德地图API（新版）">
  <meta property="og:description" content="新版高德地图 前言正文一、创建应用① 获取PackageName② 获取调试版安全码SHA1③ 获取发布版安全码SHA1 二、配置项目① 导入SDK② 配置AndroidManifest.xml 三、获取当前定位信息① ViewBinding使用和导包② 隐私合规设置③ 权限请求④ 初始化定位⑤ 获取定位信息 四、显示地图五、显示当前定位地图六、地图设置① 修改定位图标样式② 设置缩放等级③ 开启室内地图④ 地图控件设置 七、获取POI数据八、地图点击长按事件① 逆地理编码② 地理编码③ 添加标点Marker④ 删除标点Marker⑤ 绘制动画效果Marker⑥ Marker的点击和拖拽事件⑦ 绘制 InfoWindow⑧ InfoWindow的点击事件⑨ 改变地图中心点 九、出行路线规划① 准备工作② 步行路线规划③ 骑行路线规划④ 驾车路线规划⑤ 公交路线规划 十、出行路线详情① 准备工作② 步行路线详情③ 骑行路线详情④ 驾车路线详情⑤ 公交路线详情⑥ 手动输入目的地和出发地 十一、源码 前言 2020年的时候我写了关于高德地图的使用，在当时你按照文章是没有问题，然而现在到了2024年了，这几年高德的SDK发生了变化，Android Studio发生了变化，不变的是什么呢？就是学校的老师还是让一个没接触过Android的学生去完成相关的功能，定位地图之类的，然后不会怎么办呢？就搜索到我的文章了，一操作发现不对，几百个人问同样的问题，我是真的回答累了，因此我打算重新写一遍，根据最新的内容来写，从内容上和之前的文章大概相同，下面进入正文。
正文 在此之前呢，默认都没有账号，因此需要先注册一个账号才行，点击高德开放平台进入主页面。
完成账号的注册，注册的类型如果没有公司就选择个人开发者，注册完成之后登录，登录之后就创建应用。
一、创建应用 点击 控制台 → 应用管理 → 我的应用
然后点击右上角 创建新应用 按钮，会出现弹窗，输入内容。
点击创建按钮。完成之后我们需要添加Key。
点击 添加Key，出现弹窗，弹窗中需要我们配置Android工程中的内容，弹窗如下图所示：
你可以和我写的一样，这里选择Android平台，还有3个输入框需要我们填写值，其中有红色 * 号的是必填项，也就是说，这个调试版安全码SHA1我们可以不填，但是我还是会说明该怎么获取。这个网页先保留好，先别关了。
① 发布版安全码SHA1就是你的应用发布正式版本时的安全码，常规是使用jks秘钥来生成release包。② 调试版安全码SHA1就是你的应用通过usb直接运行在手机或者虚拟机时的安全码，同一个项目在不同的电脑上运行，这个安全码各不相同。③ PackageName 就是你的应用包名。 ① 获取PackageName 要获取PackageName 就需要创建一个Android 项目，而这个项目创建也有很多细节可以说明，先看看我的Android Studio版本：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-17T18:26:57+08:00">
    <meta property="article:modified_time" content="2024-06-17T18:26:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 高德地图API（新版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>新版高德地图</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#_4" rel="nofollow">正文</a></li><li><ul><li><a href="#_16" rel="nofollow">一、创建应用</a></li><li><ul><li><a href="#_PackageName_40" rel="nofollow">① 获取PackageName</a></li><li><a href="#_SHA1_65" rel="nofollow">② 获取调试版安全码SHA1</a></li><li><a href="#_SHA1_96" rel="nofollow">③ 获取发布版安全码SHA1</a></li></ul> 
   </li><li><a href="#_161" rel="nofollow">二、配置项目</a></li><li><ul><li><a href="#_SDK_182" rel="nofollow">① 导入SDK</a></li><li><a href="#_AndroidManifestxml_241" rel="nofollow">② 配置AndroidManifest.xml</a></li></ul> 
   </li><li><a href="#_291" rel="nofollow">三、获取当前定位信息</a></li><li><ul><li><a href="#_ViewBinding_296" rel="nofollow">① ViewBinding使用和导包</a></li><li><a href="#__312" rel="nofollow">② 隐私合规设置</a></li><li><a href="#__351" rel="nofollow">③ 权限请求</a></li><li><a href="#__410" rel="nofollow">④ 初始化定位</a></li><li><a href="#__504" rel="nofollow">⑤ 获取定位信息</a></li></ul> 
   </li><li><a href="#_568" rel="nofollow">四、显示地图</a></li><li><a href="#_646" rel="nofollow">五、显示当前定位地图</a></li><li><a href="#_735" rel="nofollow">六、地图设置</a></li><li><ul><li><a href="#__737" rel="nofollow">① 修改定位图标样式</a></li><li><a href="#__758" rel="nofollow">② 设置缩放等级</a></li><li><a href="#__775" rel="nofollow">③ 开启室内地图</a></li><li><a href="#__786" rel="nofollow">④ 地图控件设置</a></li></ul> 
   </li><li><a href="#POI_805" rel="nofollow">七、获取POI数据</a></li><li><a href="#_935" rel="nofollow">八、地图点击长按事件</a></li><li><ul><li><a href="#__983" rel="nofollow">① 逆地理编码</a></li><li><a href="#__1095" rel="nofollow">② 地理编码</a></li><li><a href="#_Marker_1234" rel="nofollow">③ 添加标点Marker</a></li><li><a href="#_Marker_1252" rel="nofollow">④ 删除标点Marker</a></li><li><a href="#_Marker_1350" rel="nofollow">⑤ 绘制动画效果Marker</a></li><li><a href="#_Marker_1386" rel="nofollow">⑥ Marker的点击和拖拽事件</a></li><li><a href="#__InfoWindow_1436" rel="nofollow">⑦ 绘制 InfoWindow</a></li><li><a href="#_InfoWindow_1652" rel="nofollow">⑧ InfoWindow的点击事件</a></li><li><a href="#__1682" rel="nofollow">⑨ 改变地图中心点</a></li></ul> 
   </li><li><a href="#_1714" rel="nofollow">九、出行路线规划</a></li><li><ul><li><a href="#__1718" rel="nofollow">① 准备工作</a></li><li><a href="#__2008" rel="nofollow">② 步行路线规划</a></li><li><a href="#__2749" rel="nofollow">③ 骑行路线规划</a></li><li><a href="#__3049" rel="nofollow">④ 驾车路线规划</a></li><li><a href="#__3454" rel="nofollow">⑤ 公交路线规划</a></li></ul> 
   </li><li><a href="#_4045" rel="nofollow">十、出行路线详情</a></li><li><ul><li><a href="#__4051" rel="nofollow">① 准备工作</a></li><li><a href="#__4190" rel="nofollow">② 步行路线详情</a></li><li><a href="#__4521" rel="nofollow">③ 骑行路线详情</a></li><li><a href="#__4641" rel="nofollow">④ 驾车路线详情</a></li><li><a href="#__4796" rel="nofollow">⑤ 公交路线详情</a></li><li><a href="#__5201" rel="nofollow">⑥ 手动输入目的地和出发地</a></li></ul> 
   </li><li><a href="#_5534" rel="nofollow">十一、源码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<p>  2020年的时候我写了关于高德地图的使用，在当时你按照文章是没有问题，然而现在到了2024年了，这几年高德的SDK发生了变化，Android Studio发生了变化，不变的是什么呢？就是学校的老师还是让一个没接触过Android的学生去完成相关的功能，定位地图之类的，然后不会怎么办呢？就搜索到我的文章了，一操作发现不对，几百个人问同样的问题，我是真的回答累了，因此我打算重新写一遍，根据最新的内容来写，从内容上和之前的文章大概相同，下面进入正文。</p> 
<h2><a id="_4"></a>正文</h2> 
<p>  在此之前呢，默认都没有账号，因此需要先注册一个账号才行，点击<a href="https://lbs.amap.com/" rel="nofollow">高德开放平台</a>进入主页面。</p> 
<p><img src="https://images2.imgbox.com/3b/c1/iTYv9pI6_o.png" alt="在这里插入图片描述"></p> 
<p>完成账号的注册，注册的类型如果没有公司就选择个人开发者，注册完成之后登录，登录之后就创建应用。</p> 
<h3><a id="_16"></a>一、创建应用</h3> 
<p>点击 <code>控制台</code> → <code>应用管理</code> → <code>我的应用</code></p> 
<p><img src="https://images2.imgbox.com/be/98/OskTYCWH_o.png" alt="在这里插入图片描述"></p> 
<p>然后点击右上角 <code>创建新应用</code> 按钮，会出现弹窗，输入内容。</p> 
<p><img src="https://images2.imgbox.com/b1/80/g9qeuLFy_o.png" alt="在这里插入图片描述"></p> 
<p>点击<code>创建</code>按钮。完成之后我们需要添加Key。</p> 
<p><img src="https://images2.imgbox.com/3a/4f/iXu8FPcg_o.png" alt="在这里插入图片描述"></p> 
<p>点击 <code>添加Key</code>，出现弹窗，弹窗中需要我们配置Android工程中的内容，弹窗如下图所示：</p> 
<p><img src="https://images2.imgbox.com/5d/f8/GmDozilp_o.png" alt="在这里插入图片描述"></p> 
<p>  你可以和我写的一样，这里选择<code>Android平台</code>，还有3个输入框需要我们填写值，其中有红色 * 号的是必填项，也就是说，这个调试版安全码SHA1我们可以不填，但是我还是会说明该怎么获取。这个网页先保留好，先别关了。</p> 
<ul><li>① 发布版安全码SHA1就是你的应用发布正式版本时的安全码，常规是使用jks秘钥来生成release包。</li><li>② 调试版安全码SHA1就是你的应用通过usb直接运行在手机或者虚拟机时的安全码，同一个项目在不同的电脑上运行，这个安全码各不相同。</li><li>③ PackageName 就是你的应用包名。</li></ul> 
<h4><a id="_PackageName_40"></a>① 获取PackageName</h4> 
<p>要获取PackageName 就需要创建一个Android 项目，而这个项目创建也有很多细节可以说明，先看看我的Android Studio版本：</p> 
<p><img src="https://images2.imgbox.com/c3/e8/4VKOsLad_o.png" alt="在这里插入图片描述"></p> 
<p>  这个版本是属于比较新的，如果你还使用的老版本，那么参考老版本的文章，下面我们创建工程，这里要选择<code>Empty Views Activity</code>，别选错了。</p> 
<p><img src="https://images2.imgbox.com/16/dd/b50MxJlR_o.png" alt="在这里插入图片描述"></p> 
<p>  点击<code>Next</code>，然后我们需要注意的地方就来了，首先是<code>Package name</code>也就是我们需要填到网页里的内容，也是项目的包名，然后项目的编程语言我们选择了<code>Java</code>，因为相比于不会Java的来说，不会Kotlin的更多，最后一点，就是配置文件所使用的语言，这里我使用了Groovy，默认是Kotlin。目前很多的SDK配置还是基于Groovy的，如果你使用了Kotlin，那么可能就会出现一些问题，这些问题我同样回答的烦了。</p> 
<p><img src="https://images2.imgbox.com/3e/f1/Q7lC0qW9_o.png" alt="在这里插入图片描述"></p> 
<p>请对照我上面的配置去设置你的项目，包名你可以自行更改为自己习惯的，改好之后点击<code>Finish</code>，完成项目创建，与此同时我们将包名复制进行，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/b4/68/BZuOONf8_o.png" alt="在这里插入图片描述"></p> 
<p>  现在我们还差两个值需要填写，等项目创建完成之后我们就来获取。创建成功之后我们运行在真机上，什么是真机，就是Android手机，不要使用AS的虚拟机或者其他第三方虚拟机，为什么呢？因为你在使用SDK的时候会出现问题。没有真机的自己想办法，不要再问我虚拟机出现问题怎么办了。</p> 
<p><img src="https://images2.imgbox.com/a7/70/5WGd0pfQ_o.png" alt="在这里插入图片描述"><br> OK ，真机上运行成功，我使用的是荣耀V40，Android 12的系统版本。下面我们来获取<code>调试版安全码SHA1</code>。</p> 
<h4><a id="_SHA1_65"></a>② 获取调试版安全码SHA1</h4> 
<p>Windows电脑，使用快捷键<code>Win + R</code> ，输入<code>cmd</code>，进入命令窗口。</p> 
<p>输入cd .android</p> 
<pre><code>cd .android
</code></pre> 
<p>先切换到.android目录下，然后输入如下指令：</p> 
<pre><code>keytool -list -v -keystore debug.keystore
</code></pre> 
<p>然后回车，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/80/15/JHtvtDnF_o.png" alt="在这里插入图片描述"></p> 
<p>  这里提示了keytool不是内部或外部命令，这说明我们没有配置JDK，下面我们配置一下，参考：<a href="https://llw-study.blog.csdn.net/article/details/105071088?spm=1001.2014.3001.5502" rel="nofollow">JDK 安装与环境变量配置</a>，配置之后我们重新走一下这个流程，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/08/9b/0oeVWEyl_o.png" alt="在这里插入图片描述"></p> 
<p>这里的密钥库口令是：<code>android</code></p> 
<p>  输入的时候看不到内容，输入完成之后回车就可以了，如果你发现不是这样的话，就先运行一下项目，运行成功之后再尝试这一步。这里我们就拿到了<code>调试版安全码SHA1</code>，这里需要注意一点，<code>调试版安全码SHA1</code>会跟随电脑环境改变而改变，同一个项目在不同电脑上编译之后<code>调试版安全码SHA1</code>也会有变化，现在我们复制到那个网页里。</p> 
<p><img src="https://images2.imgbox.com/ca/1b/zg4CEdaP_o.png" alt="在这里插入图片描述"></p> 
<p>现在就只有一个<code>发布版安全码SHA1</code>需要获取了。</p> 
<h4><a id="_SHA1_96"></a>③ 获取发布版安全码SHA1</h4> 
<p>  这个稍微有一些麻烦，因此需要先创建一个jks文件才行，首先我们点击这个菜单按钮。</p> 
<p><img src="https://images2.imgbox.com/66/17/RtcHUY0n_o.png" alt="在这里插入图片描述"></p> 
<p>然后点击<code>Build</code> 选择点击<code>Generate Signed Bundle / APK…</code></p> 
<p><img src="https://images2.imgbox.com/b0/cb/E11ljWBy_o.png" alt="在这里插入图片描述"></p> 
<p>  这时候会出现一个弹窗，我们选择<code>APK</code>，<code>Android App Bundle</code> 打包的是aab格式，这种格式的包用于上传Google应用商店，国内都是apk格式。</p> 
<p><img src="https://images2.imgbox.com/22/68/Cb7oMvw7_o.png" alt="在这里插入图片描述"></p> 
<p>点击<code>Next</code>。</p> 
<p><img src="https://images2.imgbox.com/b5/d7/ulHOxndE_o.png" alt="在这里插入图片描述"></p> 
<p>在生成apk时需要一个jks文件，这里我们选择<code>Create new...</code>，创建一个新的<code>jks</code>文件。</p> 
<p><img src="https://images2.imgbox.com/37/72/OwaImRcH_o.png" alt="在这里插入图片描述"></p> 
<p>首先指明生成的jks文件的路径，点击这个文件夹图标。</p> 
<p><img src="https://images2.imgbox.com/78/c4/YdiF2JOB_o.png" alt="在这里插入图片描述"></p> 
<p>  这里我选择将jks就生成在项目的根目录下，点击OK，然后我们输入一些其他的信息，实际上你只要输入商量密码和别名密码就可以了，但是还是都填好比较好。Confirm就是再输入一次密码，这里建议你把商店密码和别名密码设置成一样的。</p> 
<p><img src="https://images2.imgbox.com/21/1f/qzCfbucu_o.png" alt="在这里插入图片描述"></p> 
<p>点击OK，然后选择<code>Remember passwords</code>。</p> 
<p><img src="https://images2.imgbox.com/6d/04/efZvm8K8_o.png" alt="在这里插入图片描述"></p> 
<p>然后点击<code>Next</code>，然后选择<code>release</code>。</p> 
<p><img src="https://images2.imgbox.com/cf/c0/ZpqohXqN_o.png" alt="在这里插入图片描述"></p> 
<p>点击<code>Create</code>，当你看到右下角出现如下弹窗。</p> 
<p><img src="https://images2.imgbox.com/7a/04/APN29DD0_o.png" alt="在这里插入图片描述"></p> 
<p>则说明这个Apk生成成功了，下面我们就可以来<code>获取发布版安全码SHA1</code>，还是之前那个窗口，我们输入：</p> 
<pre><code>keytool -list -v -keystore D:\Android\NewGaodeMapDemo\map.jks
</code></pre> 
<p>这里需要注意地址是我项目的地址，你需要按照自己实际的地址填。</p> 
<p><img src="https://images2.imgbox.com/c6/25/mvEbPu6L_o.png" alt="在这里插入图片描述"></p> 
<p>密钥口令，就是你刚才设置的jks密码，然后我们复制这个SHA1到那个网页里面。</p> 
<p><img src="https://images2.imgbox.com/a9/81/OZ0Eywju_o.png" alt="在这里插入图片描述"></p> 
<p>现在需要的内容都有了，点击提交。</p> 
<p><img src="https://images2.imgbox.com/f4/69/FZzEpI55_o.png" alt="在这里插入图片描述"></p> 
<p>这里的Key我们需要到Android工程的AndroidManifest.xml中去配置，你需要使用自己的。到了这一步我们初期的应用创建就完成了，为自己点个赞吧，虽然这挺容易的。</p> 
<h3><a id="_161"></a>二、配置项目</h3> 
<p>这里我们需要用到<code>高德的SDK</code>，点击 <code>文档与支持</code> → <code>Android 地图SDK</code>。</p> 
<p><img src="https://images2.imgbox.com/48/2b/4HYCXBO6_o.png" alt="在这里插入图片描述"></p> 
<p>点击<code>相关下载</code>，然后向下滑动。</p> 
<p><img src="https://images2.imgbox.com/df/b4/GB05vZFh_o.png" alt="在这里插入图片描述"></p> 
<p>这里我们选择 <code>3D地图合包</code>，可以看到里面包含了，3D地图SDK、搜索SDK和定位SDK，点击下载。</p> 
<p><img src="https://images2.imgbox.com/e1/de/qqaff8J1_o.png" alt="在这里插入图片描述"></p> 
<p>下载之后解压，看到有一个Jar包和两个架构文件夹，里面都是so库。</p> 
<p><img src="https://images2.imgbox.com/18/51/X8uf3niS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_SDK_182"></a>① 导入SDK</h4> 
<p>  下面我们需要将她复制到Android项目的libs目录下，下面我们创建这个目录。这里默认是Android工程模式，我们先切换成Project工程模式，然后鼠标右键点击<code>app</code> → <code>New</code> → <code>Directory</code>。</p> 
<p><img src="https://images2.imgbox.com/0a/39/xJxG37jj_o.png" alt="在这里插入图片描述"></p> 
<p>出现弹窗输入<code>libs</code>，然后回车。</p> 
<p><img src="https://images2.imgbox.com/28/0e/w2n9JTX4_o.png" alt="在这里插入图片描述"></p> 
<p>然后将解压包里的4个文件都复制进来，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/0c/6a/SRwZ3OiS_o.png" alt="在这里插入图片描述"></p> 
<p>只不过现在这个包现在还没有用起来，我们需要配置一下，在app模块下的build.gradle中添加如下代码：</p> 
<pre><code class="prism language-groovy">		ndk <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//设置支持的SO库架构（开发者可以根据需要，选择一个或多个平台的so）</span>
            abiFilters <span class="token interpolation-string"><span class="token string">"armeabi"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"armeabi-v7a"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"arm64-v8a"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"x86"</span></span><span class="token punctuation">,</span><span class="token interpolation-string"><span class="token string">"x86_64"</span></span>
        <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-groovy">		sourceSets <span class="token punctuation">{<!-- --></span>
	        main <span class="token punctuation">{<!-- --></span>
	            jniLibs<span class="token punctuation">.</span>srcDirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'libs'</span><span class="token punctuation">]</span>
	        <span class="token punctuation">}</span>
	        debug<span class="token punctuation">.</span><span class="token function">setRoot</span><span class="token punctuation">(</span><span class="token string">'build-types/debug'</span><span class="token punctuation">)</span>
	        release<span class="token punctuation">.</span><span class="token function">setRoot</span><span class="token punctuation">(</span><span class="token string">'build-types/release'</span><span class="token punctuation">)</span>
    	<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-groovy">	buildFeatures <span class="token punctuation">{<!-- --></span>
        viewBinding <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-groovy">	implementation <span class="token function">fileTree</span><span class="token punctuation">(</span>dir<span class="token punctuation">:</span> <span class="token string">'libs'</span><span class="token punctuation">,</span> include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'*.jar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/23/2f/IwtBEYHb_o.png" alt="在这里插入图片描述"></p> 
<p>  这里我除了添加配置代码，还配置了打开ViewBinding，记得点击<code>Sync Now</code>进行同步，同步完成之后就会发现Jar包前面就一个箭头，我们可以打开这个包，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/4c/00/UwLdmZWr_o.png" alt="在这里插入图片描述"></p> 
<p>这说明我们导入的SDK可以使用了。</p> 
<h4><a id="_AndroidManifestxml_241"></a>② 配置AndroidManifest.xml</h4> 
<p>打开AndroidManifest.xml，首先在application标签下添加定位服务，添加代码如下：</p> 
<pre><code class="prism language-xml">		<span class="token comment">&lt;!--高德定位服务--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amap.api.location.APSService<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--高德的Key  value里面的值请使用自己的Key--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.amap.api.v2.apikey<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/81/d8/YsGiuJwp_o.png" alt="在这里插入图片描述"></p> 
<p>这里的value里面的值你就填写自己高德平台所创建的Key，我在前面提到过，这里不能错，请注意，下面我们添加权限。代码如下：</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--用于进行网络定位--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_COARSE_LOCATION<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于访问GPS定位--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_FINE_LOCATION<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_NETWORK_STATE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_WIFI_STATE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.CHANGE_WIFI_STATE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于访问网络，网络定位需要上网--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.INTERNET<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于写入缓存数据到扩展存储卡--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--用于申请调用A-GPS模块--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_LOCATION_EXTRA_COMMANDS<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--如果设置了target &gt;= 28 如果需要启动后台定位则必须声明这个权限--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.FOREGROUND_SERVICE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--如果您的应用需要后台定位权限，且有可能运行在Android Q设备上,并且设置了target&gt;28，必须增加这个权限声明--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.ACCESS_BACKGROUND_LOCATION<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!--允许写设备缓存，用于问题排查--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_SETTINGS<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ProtectedPermissions<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/ad/48/LAUaqu6f_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_291"></a>三、获取当前定位信息</h3> 
<p>  获取定位信息之前我们需要先动态请求位置权限。</p> 
<h4><a id="_ViewBinding_296"></a>① ViewBinding使用和导包</h4> 
<p>在此之前我们先了解一下ViewBinding的使用和导包，为什么我要说这个，因为确实别问我为什么报错的时候，我一看没有导包，那时候我的内心是相当复杂的，如果你是从事这个行业的你就会懂我的心情。</p> 
<p><img src="https://images2.imgbox.com/55/dd/hBybfFRz_o.png" alt="在这里插入图片描述"></p> 
<p>  可以看到ActivityMainBinding是爆红的，这是因为使用了ViewBinding才有这个文件的生成，如果你想了解ViewBinding可以单独去了解。注意上面的一个小弹窗，有一个快捷键，Alt + Enter，使用之后就导了文件的包进来，就可以使用这个类了。</p> 
<p><img src="https://images2.imgbox.com/c2/c2/hUNVgT3a_o.png" alt="在这里插入图片描述"></p> 
<p>  现在看到就不爆红了，后面你遇到这个情况的时候就知道怎么做了，为什么呢？因为很多人代码都不是一行行敲的，都是复制粘贴的，所以并不会自动导包，使用的方式如下图所示：</p> 
<p><img src="https://images2.imgbox.com/c1/cd/YygULLQ0_o.png" alt="在这里插入图片描述"></p> 
<p>  参考来就行了，汲取之前那篇文章的经验，我尽量每一行代码写在什么地方都截图，避免你不知道代码应该添加在哪里，又来问我怎么报错了。</p> 
<h4><a id="__312"></a>② 隐私合规设置</h4> 
<p>  随着工信部推行加强个人信息隐私的保护政策，各大SDK都需要相应增加一个API接口，确保用户是在知道会采集信息的情况下使用某一个功能，所以我们在使用高德的定位、地图、搜索功能时，需要先同意隐私政策，不通过则无法使用，一般是通过App启动之后出现一个弹窗，弹窗中你告知用户那些信息被采集，用到了那些SDK，作用是什么。并且要有隐私政策的链接地址，很麻烦。这里我们就简单一些，鼠标右键<code>com.llw.newmapdemo</code>包，然后选择<code>New</code> → <code>Java Class</code>。</p> 
<p><img src="https://images2.imgbox.com/7b/d5/ATVxT79d_o.png" alt="在这里插入图片描述"></p> 
<p>在出现的弹窗中输入App，然后回车。</p> 
<p><img src="https://images2.imgbox.com/67/e5/lNSi8TPu_o.png" alt="在这里插入图片描述"></p> 
<p>里面的代码如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span>  <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Context</span> mContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// 定位隐私政策同意</span>
        <span class="token class-name">AMapLocationClient</span><span class="token punctuation">.</span><span class="token function">updatePrivacyShow</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AMapLocationClient</span><span class="token punctuation">.</span><span class="token function">updatePrivacyAgree</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 地图隐私政策同意</span>
        <span class="token class-name">MapsInitializer</span><span class="token punctuation">.</span><span class="token function">updatePrivacyShow</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MapsInitializer</span><span class="token punctuation">.</span><span class="token function">updatePrivacyAgree</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 搜索隐私政策同意</span>
        <span class="token class-name">ServiceSettings</span><span class="token punctuation">.</span><span class="token function">updatePrivacyShow</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ServiceSettings</span><span class="token punctuation">.</span><span class="token function">updatePrivacyAgree</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  记得导包，后面我就不重复提醒，不要又来问我为什么没有这个<code>AMapLocationClient</code>和<code>ServiceSettings</code>，这里我们还需要将<code>App</code>配置到<code>AndroidManifest.xml</code>中的<code>application</code>标签里，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/86/62/wMJhx7zb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__351"></a>③ 权限请求</h4> 
<p>这里我们使用Android 原生的方式来请求动态权限，首先在<code>MainActivity</code>中添加如下代码：</p> 
<pre><code class="prism language-java">    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">"MainActivity"</span><span class="token punctuation">;</span>
    <span class="token comment">// 请求权限意图</span>
    <span class="token keyword">private</span> <span class="token class-name">ActivityResultLauncher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> requestPermission<span class="token punctuation">;</span>
</code></pre> 
<p>然后再onCreate()方法中添加如下代码：</p> 
<pre><code class="prism language-java">        requestPermission <span class="token operator">=</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ActivityResultContracts<span class="token punctuation">.</span>RequestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 权限申请结果</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"权限申请结果: "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>两处代码添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/43/04/PHOdf0Xx_o.png" alt="在这里插入图片描述"><br>   在权限申请结果处，我们打印了值，True就是授予了权限，False就是拒绝了权限，下面我们需要判断一下是否有权限，没有则请求权限，有则进入下一步。</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 检查是否已经获取到定位权限</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">ACCESS_FINE_LOCATION</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 获取到权限</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"onResume: 已获取到权限"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 请求定位权限</span>
            requestPermission<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">ACCESS_FINE_LOCATION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这里添加了一个<code>onResume()</code>方法，它属于Activity的生命周期之一，通过注释你应该明白这个代码是什么意思。添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/60/ee/J7U64pmz_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们运行一下看看。<br> <img src="https://images2.imgbox.com/39/60/T9M12OxZ_o.jpg" alt="在这里插入图片描述" width="300" height="600"><br>   在运行之后就会请求权限，点击<code>仅使用期间允许</code>，然后就可以看到权限通过了，如果你希望更明显一些，可以使用Toast，在MainActivity中添加一个方法。</p> 
<pre><code class="prism language-java">    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> llw<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> llw<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>再看看使用的地方，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/2d/1f/vHMnfmI1_o.png" alt="在这里插入图片描述"></p> 
<p>这里就是换成更明显的Toast。</p> 
<h4><a id="__410"></a>④ 初始化定位</h4> 
<p>  在获取到权限之后我们就需要进行定位了，在定位之前我们首先要初始化定位，首先声明一个变量，代码如下：</p> 
<pre><code class="prism language-java">    <span class="token comment">//声明AMapLocationClient类对象</span>
    <span class="token keyword">public</span> <span class="token class-name">AMapLocationClient</span> mLocationClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后写一个方法去进行初始化，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 初始化定位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//初始化定位</span>
            mLocationClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMapLocationClient</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置定位回调监听</span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>最后我们需要在<code>onCreate()</code>方法中进行调用，以上代码及调用的地方如下图所示：</p> 
<p><img src="https://images2.imgbox.com/71/32/fcXuPyI8_o.png" alt="在这里插入图片描述"></p> 
<p>  在<code>initLocation()</code>方法中设置了回调监听，这里用的是this，这表示在当前类，而下面有红线，说明我们没有实现里面的方法，鼠标点击这个this，然后使用快捷键<code>Alt + Enter</code>，会出现一个提示弹窗。</p> 
<p><img src="https://images2.imgbox.com/43/5b/QuMj3uvd_o.png" alt="在这里插入图片描述"></p> 
<p>这里选择我标注的这一项进行回车，会再出现一个弹窗。</p> 
<p><img src="https://images2.imgbox.com/4f/6e/K7Mq1zqE_o.png" alt="在这里插入图片描述"></p> 
<p>这里什么都不用改，点击OK即可，然后我们看看当前的MainActivity有什么变化。</p> 
<p><img src="https://images2.imgbox.com/78/3b/zxLXoRHh_o.png" alt="在这里插入图片描述"></p> 
<p>我们实现了<code>AMapLocationListener</code>接口，重写了里面<code>onLocationChanged()</code>方法，同时this也没有红线了，此时代码是正常的。但是我们的定位配置还没有完成，再声明一个变量：</p> 
<pre><code class="prism language-java">    <span class="token comment">//声明AMapLocationClientOption对象</span>
    <span class="token keyword">public</span> <span class="token class-name">AMapLocationClientOption</span> mLocationOption <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后在<code>initLocation()</code>方法中进行配置，代码如下所示：</p> 
<pre><code class="prism language-java">			<span class="token comment">//初始化AMapLocationClientOption对象</span>
            mLocationOption <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMapLocationClientOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置定位模式为AMapLocationMode.Hight_Accuracy，高精度模式。</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setLocationMode</span><span class="token punctuation">(</span><span class="token class-name">AMapLocationClientOption<span class="token punctuation">.</span>AMapLocationMode<span class="token punctuation">.</span>Hight_Accuracy</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取最近3s内精度最高的一次定位结果</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setOnceLocationLatest</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置是否返回地址信息（默认返回地址信息）</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setNeedAddress</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置定位超时时间，单位是毫秒</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setHttpTimeOut</span><span class="token punctuation">(</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//给定位客户端对象设置定位参数</span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationOption</span><span class="token punctuation">(</span>mLocationOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/61/52/i7tx7qlO_o.png" alt="在这里插入图片描述"></p> 
<p>下一步我们写开始和停止定位的方法，在<code>MainActivity</code>中增加如下代码：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 开始定位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mLocationClient<span class="token punctuation">.</span><span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 停止定位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mLocationClient<span class="token punctuation">.</span><span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下所示：</p> 
<p><img src="https://images2.imgbox.com/b0/b4/8TjkiRVo_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__504"></a>⑤ 获取定位信息</h4> 
<p>  然后就是这两个方法的调用位置了，首先看开始定位，首先我们在获取权限之后就要开始定位，增加代码如下图所示：</p> 
<p><img src="https://images2.imgbox.com/7b/c7/bE8vuhVa_o.png" alt="在这里插入图片描述"></p> 
<p>  至于停止定位的使用，我们需要在拿到定位结果之后，同时我们需要将定位结果显示在页面，那么我们先修改一下<code>activity_main.xml</code>中的代码，为<code>TextView</code>控件增加一个为<code>tv_address</code>的<code>id</code>，代码如下所示：</p> 
<p><img src="https://images2.imgbox.com/ef/34/K7nGgleP_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们再回到MainActivity中，修改<code>onLocationChanged()</code>方法中的代码，如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 定位回调结果
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLocationChanged</span><span class="token punctuation">(</span><span class="token class-name">AMapLocation</span> aMapLocation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"定位失败，aMapLocation 为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取定位结果</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 定位成功</span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"定位成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            aMapLocation.getLocationType();//获取当前定位结果来源，如网络定位结果，详见定位类型表</span>
<span class="token comment">//            aMapLocation.getLatitude();//获取纬度</span>
<span class="token comment">//            aMapLocation.getLongitude();//获取经度</span>
<span class="token comment">//            aMapLocation.getAccuracy();//获取精度信息</span>
<span class="token comment">//            aMapLocation.getAddress();//详细地址，如果option中设置isNeedAddress为false，则没有此结果，网络定位结果中会有地址信息，GPS定位不返回地址信息。</span>
<span class="token comment">//            aMapLocation.getCountry();//国家信息</span>
<span class="token comment">//            aMapLocation.getProvince();//省信息</span>
<span class="token comment">//            aMapLocation.getCity();//城市信息</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getDistrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//城区信息</span>
<span class="token comment">//            aMapLocation.getStreet();//街道信息</span>
<span class="token comment">//            aMapLocation.getStreetNum();//街道门牌号信息</span>
<span class="token comment">//            aMapLocation.getCityCode();//城市编码</span>
<span class="token comment">//            aMapLocation.getAdCode();//地区编码</span>
<span class="token comment">//            aMapLocation.getAoiName();//获取当前定位点的AOI信息</span>
<span class="token comment">//            aMapLocation.getBuildingId();//获取当前室内定位的建筑物Id</span>
<span class="token comment">//            aMapLocation.getFloor();//获取当前室内定位的楼层</span>
<span class="token comment">//            aMapLocation.getGpsAccuracyStatus();//获取GPS的当前状态</span>

            binding<span class="token punctuation">.</span>tvAddress<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 停止定位</span>
            <span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 定位失败</span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"定位失败，错误："</span> <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span><span class="token string">"location Error, ErrCode:"</span>
                    <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", errInfo:"</span>
                    <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  这里我只在页面上显示了所在的城区信息，其他的信息我先注释了，你可以根据自己的需求拿相应的数据进行显示，下面我们就可以开始运行了。</p> 
<p><img src="https://images2.imgbox.com/49/4a/5UwlZn9k_o.gif" alt="在这里插入图片描述"></p> 
<p>  无论你是第一次进来时获取权限还是后面已经拿到权限再进来都是会获取定位信息，需要注意的是使用真机，同时需要联网。</p> 
<h3><a id="_568"></a>四、显示地图</h3> 
<p>现在我们开始显示地图，首先我们需要修改一下<code>activity_main.xml</code>中的代码：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.amap.api.maps.MapView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/map_view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>  这里主要的改动就是去掉TextView，然后使用了MapView，因为根布局使用的约束布局，如果不了解的话尽量代码跟我一样，避免不必要的错误出现。</p> 
<p><img src="https://images2.imgbox.com/91/f5/yJR5FL0n_o.png" alt="在这里插入图片描述"></p> 
<p>好了，下面我们回到<code>MainActivity</code>中，首先我们删除掉<code>onLocationChanged()</code>方法中之前显示定位结果在TextView上的一行代码，删除后如下图所示：</p> 
<p><img src="https://images2.imgbox.com/61/e4/PIlJp8xW_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们需要去配置MapView，将MapView和Activity的声明周期绑定起来，首先是<code>onCreate()</code>，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/ff/16/YWeFf0Yv_o.png" alt="在这里插入图片描述"></p> 
<p>然后是<code>onResume()</code></p> 
<p><img src="https://images2.imgbox.com/34/5a/mXS4VZta_o.png" alt="在这里插入图片描述"></p> 
<p>之后是<code>onPause()、onSaveInstanceState()和onDestroy()</code>，这三个方法当前没有所以我们需要增加，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定生命周期 onPause</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定生命周期 onSaveInstanceState</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绑定生命周期 onDestroy</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下图所示：<br> <img src="https://images2.imgbox.com/0d/ed/NcXC0xaV_o.png" alt="在这里插入图片描述"></p> 
<p>好了，下面我们运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/46/af/rwSpkj7I_o.jpg" alt="在这里插入图片描述" width="300" height="600"></p> 
<p>  地图是显示出来了，但是很明显，不是我当前的位置，那么如果我想显示当前的位置呢？比如我在广东省深圳市南山区，我要定位到我这里。</p> 
<h3><a id="_646"></a>五、显示当前定位地图</h3> 
<p>要显示当前定位地图，首先我们需要将位置在地图上进行设置，从而使地图中心点移动到我们所在的位置，首先我们声明两个变量。</p> 
<pre><code class="prism language-java">    <span class="token comment">// 声明地图控制器</span>
    <span class="token keyword">private</span> <span class="token class-name">AMap</span> aMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// 声明地图定位监听</span>
    <span class="token keyword">private</span> <span class="token class-name">LocationSource<span class="token punctuation">.</span>OnLocationChangedListener</span> mListener <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/3a/93/pPbZMdk3_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们新增一个方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 初始化地图
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aMap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            aMap <span class="token operator">=</span> binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置定位监听</span>
            aMap<span class="token punctuation">.</span><span class="token function">setLocationSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置为true表示启动显示定位蓝点，false表示隐藏定位蓝点并不进行定位，默认是false。</span>
            aMap<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这里的this同样会有红线，我们依然使用之前的方式去实现接口，会有两个方法，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/3c/e0/2ETn1Wzj_o.png" alt="在这里插入图片描述"></p> 
<p>实现那两个方法之后，我们修改里面的代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 激活定位
     * @param onLocationChangedListener
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">activate</span><span class="token punctuation">(</span><span class="token class-name">OnLocationChangedListener</span> onLocationChangedListener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mListener <span class="token operator">=</span> onLocationChangedListener<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 禁用
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mListener <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mLocationClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>两个方法，激活和禁止，在地图上激活定位后，我们开始定位，在定位的回调中，我们需要显示地图定位结果<code>onLocationChanged()</code>方法中增加如下代码：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 显示地图定位结果</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mListener<span class="token punctuation">.</span><span class="token function">onLocationChanged</span><span class="token punctuation">(</span>aMapLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/42/I9ijG3Mn_o.png" alt="在这里插入图片描述"></p> 
<p>两个方法的位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/1d/38/pkgOBbuj_o.png" alt="在这里插入图片描述"></p> 
<p>最后我们要做的就是在<code>onCreate()</code>方法中调用<code>initMap()</code>方法，使我们的配置生效，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/17/4f/1GzVeSSj_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们运行一下看看效果：</p> 
<p><img src="https://images2.imgbox.com/9e/26/1leGOr7E_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_735"></a>六、地图设置</h3> 
<h4><a id="__737"></a>① 修改定位图标样式</h4> 
<p>我们可以直接在<code>initMap()</code>方法中完成，增加如下代码：</p> 
<pre><code class="prism language-java">			<span class="token comment">// 创建定位蓝点的样式</span>
            <span class="token class-name">MyLocationStyle</span> myLocationStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyLocationStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 自定义定位蓝点图标</span>
            myLocationStyle<span class="token punctuation">.</span><span class="token function">myLocationIcon</span><span class="token punctuation">(</span><span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>gps_point<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 自定义精度范围的圆形边框颜色  都为0则透明</span>
            myLocationStyle<span class="token punctuation">.</span><span class="token function">strokeColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">argb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 自定义精度范围的圆形边框宽度  0 无宽度</span>
            myLocationStyle<span class="token punctuation">.</span><span class="token function">strokeWidth</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置圆形的填充颜色  都为0则透明</span>
            myLocationStyle<span class="token punctuation">.</span><span class="token function">radiusFillColor</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">argb</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置定位蓝点的样式</span>
            aMap<span class="token punctuation">.</span><span class="token function">setMyLocationStyle</span><span class="token punctuation">(</span>myLocationStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里如果你没有这个图标，不修改自定义图标，或者去我的代码中获取这个<code>R.drawable.gps_point</code>图标。</p> 
<h4><a id="__758"></a>② 设置缩放等级</h4> 
<pre><code class="prism language-java">			<span class="token comment">//设置最小缩放等级为12 ，缩放级别范围为[3, 20]</span>
            aMap<span class="token punctuation">.</span><span class="token function">setMinZoomLevel</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>最终设置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/1a/ba/Uu8vdC91_o.png" alt="在这里插入图片描述"></p> 
<p>下面运行一下：</p> 
<p><img src="https://images2.imgbox.com/a3/3a/Lubgqms8_o.jpg" alt="在这里插入图片描述" width="300" height="600"></p> 
<h4><a id="__775"></a>③ 开启室内地图</h4> 
<pre><code class="prism language-java">			<span class="token comment">// 开启室内地图</span>
            aMap<span class="token punctuation">.</span><span class="token function">showIndoorMap</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里你就在initMap()中添加即可，然后加载地图出来后，不断放大，直到你看到3D的建筑，添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/9a/2d/1VkbTPZ4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__786"></a>④ 地图控件设置</h4> 
<pre><code class="prism language-java">            <span class="token comment">// 地图控件设置</span>
            <span class="token class-name">UiSettings</span> uiSettings <span class="token operator">=</span> aMap<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 隐藏缩放按钮</span>
            uiSettings<span class="token punctuation">.</span><span class="token function">setZoomControlsEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 显示比例尺，默认不显示</span>
            uiSettings<span class="token punctuation">.</span><span class="token function">setScaleControlsEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/e6/f4/OenIImaC_o.png" alt="在这里插入图片描述"></p> 
<p>运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/b0/f8/qavYqSqK_o.jpg" alt="在这里插入图片描述" width="300" height="600"></p> 
<h3><a id="POI_805"></a>七、获取POI数据</h3> 
<p>  <code>POI (Point of Interest，兴趣点)</code>。在地图表达中，一个 POI 可代表一栋大厦、一家商铺、一处景点等等。通过POI搜索，完成找餐馆、找景点、找厕所等等的功能，首先我们修改一下<code>activity_main.xml</code>中的代码：</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--浮动按钮--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clickable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>focusable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_favorite_red<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>hoveredFocusedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>pressedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/54/a4/pqHJNE5s_o.png" alt="在这里插入图片描述"></p> 
<p>然后回到<code>MainActivity</code>中，我们声明变量，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">//POI查询对象</span>
    <span class="token keyword">private</span> <span class="token class-name">PoiSearch<span class="token punctuation">.</span>Query</span> query<span class="token punctuation">;</span>
    <span class="token comment">//POI搜索对象</span>
    <span class="token keyword">private</span> <span class="token class-name">PoiSearch</span> poiSearch<span class="token punctuation">;</span>
    <span class="token comment">//城市码</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> cityCode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/a2/cc/cHsZuUlR_o.png" alt="在这里插入图片描述"><br> 然后在<code>onLocationChanged()</code>方法中显示这个浮动按钮，添加代码如下：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 显示浮动按钮</span>
            binding<span class="token punctuation">.</span>fabPoi<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 城市编码赋值</span>
            cityCode <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getCityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/f5/d7/dE3Ci9Ea_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们添加一个<code>initView()</code>方法，处理点击浮动按钮事件，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 初始化控件
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Poi搜索按钮点击事件</span>
        binding<span class="token punctuation">.</span>fabPoi<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//构造query对象</span>
            query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoiSearch<span class="token punctuation">.</span>Query</span><span class="token punctuation">(</span><span class="token string">"购物"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> cityCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置每页最多返回多少条poiItem</span>
            query<span class="token punctuation">.</span><span class="token function">setPageSize</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//设置查询页码</span>
            query<span class="token punctuation">.</span><span class="token function">setPageNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//构造 PoiSearch 对象</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                poiSearch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PoiSearch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置搜索回调监听</span>
                poiSearch<span class="token punctuation">.</span><span class="token function">setOnPoiSearchListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//发起搜索附近POI异步请求</span>
                poiSearch<span class="token punctuation">.</span><span class="token function">searchPOIAsyn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AMapException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这里同样<code>this</code>会报错，实现接口，出现弹窗如下所示：</p> 
<p><img src="https://images2.imgbox.com/64/b2/JqyZ4fTx_o.png" alt="在这里插入图片描述"></p> 
<p>现在代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * POI搜索返回
     *
     * @param poiResult POI所有数据
     * @param i
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPoiSearched</span><span class="token punctuation">(</span><span class="token class-name">PoiResult</span> poiResult<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//解析result获取POI信息</span>

        <span class="token comment">//获取POI组数列表</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PoiItem</span><span class="token punctuation">&gt;</span></span> poiItems <span class="token operator">=</span> poiResult<span class="token punctuation">.</span><span class="token function">getPois</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PoiItem</span> poiItem <span class="token operator">:</span> poiItems<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"MainActivity"</span><span class="token punctuation">,</span> <span class="token string">" Title："</span> <span class="token operator">+</span> poiItem<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" Snippet："</span> <span class="token operator">+</span> poiItem<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * POI中的项目搜索返回
     *
     * @param poiItem 获取POI item
     * @param i
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPoiItemSearched</span><span class="token punctuation">(</span><span class="token class-name">PoiItem</span> poiItem<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/28/99/O8zYGwhi_o.png" alt="在这里插入图片描述"><br> 最后在<code>onCreate()</code>方法中调用<code>initView()</code>。</p> 
<p><img src="https://images2.imgbox.com/f8/57/qWegIcB5_o.png" alt="在这里插入图片描述"></p> 
<p>下面运行一下，然后点击页面右下角的浮动按钮，查看控制台，你会看到有打印，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/19/ec/3gIQ82aH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_935"></a>八、地图点击长按事件</h3> 
<p>  实际开发中都会对地图的点击和长按做处理，比如点击某一个地方获取经纬度，下面来操作一下吧，首先我们在<code>initMap()</code>方法中添加如下代码：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 设置地图点击事件</span>
            aMap<span class="token punctuation">.</span><span class="token function">setOnMapClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置地图长按事件</span>
            aMap<span class="token punctuation">.</span><span class="token function">setOnMapLongClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：<br> <img src="https://images2.imgbox.com/21/01/h3Udgqir_o.png" alt="在这里插入图片描述"></p> 
<p>然后实现接口的点击和长按的回调，在MainActivity中添加代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 地图点击事件
     * @param latLng
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapClick</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"点击了地图，经度："</span><span class="token operator">+</span>latLng<span class="token punctuation">.</span>longitude<span class="token operator">+</span><span class="token string">"，纬度："</span><span class="token operator">+</span>latLng<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 地图长按事件
     * @param latLng
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapLongClick</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"长按了地图，经度："</span><span class="token operator">+</span>latLng<span class="token punctuation">.</span>longitude<span class="token operator">+</span><span class="token string">"，纬度："</span><span class="token operator">+</span>latLng<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>注意一下，MainActivity实现这两个接口</p> 
<p><img src="https://images2.imgbox.com/c8/b5/bCNDHBPp_o.png" alt="在这里插入图片描述"></p> 
<p>看看运行效果：</p> 
<p><img src="https://images2.imgbox.com/62/3d/D4Ruk1Gd_o.gif" alt="在这里插入图片描述"></p> 
<p>  可看到成功获取到了经纬度，但是这就够了吗？用户又看不懂，那么怎么样让用户知道自己点击的是那里呢？那就是要把经纬度进行一次转换，转换成实际的地址描述。在高德中这种坐标转地址称之为逆地理编码。</p> 
<h4><a id="__983"></a>① 逆地理编码</h4> 
<p>  上面已经说过了，逆地理编码就是将坐标转为地址，坐标刚才已经拿到了，就是经纬度，下面来转换一下吧，首先在MainActivity中创建两个对象。</p> 
<pre><code class="prism language-java">    <span class="token comment">//地理编码搜索</span>
    <span class="token keyword">private</span> <span class="token class-name">GeocodeSearch</span> geocodeSearch<span class="token punctuation">;</span>
    <span class="token comment">//解析成功标识码</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PARSE_SUCCESS_CODE</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下所示：</p> 
<p><img src="https://images2.imgbox.com/fd/b8/PGtNAHAv_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们写一个<code>initSearch()</code>方法，在<code>onCreate()</code>调用，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 初始化搜索
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 构造 GeocodeSearch 对象</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            geocodeSearch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeSearch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置监听</span>
            geocodeSearch<span class="token punctuation">.</span><span class="token function">setOnGeocodeSearchListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AMapException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/94/df/83WVu8Ct_o.png" alt="在这里插入图片描述"></p> 
<p>这里同样需要实现监听，会出现弹窗</p> 
<p><img src="https://images2.imgbox.com/5a/94/VonKLXlQ_o.png" alt="在这里插入图片描述"></p> 
<p>实现代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 坐标转地址
     * @param regeocodeResult
     * @param rCode
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRegeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">RegeocodeResult</span> regeocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 地址转坐标
     * @param geocodeResult
     * @param rCode
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">GeocodeResult</span> geocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>
</code></pre> 
<p>  一个是地址转坐标，一个是坐标转地址。当前我们需要将坐标转地址，所以目前重点关注这个onRegeocodeSearched方法。</p> 
<p>  既然是坐标转地址，那么肯定要先拿到坐标，刚才的地图点击的监听中我们已经拿到了坐标，于是你就可以写出这样的一个方法：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 通过经纬度获取地址
     * @param latLng
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">latLonToAddress</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//位置点  通过经纬度进行构建</span>
        <span class="token class-name">LatLonPoint</span> latLonPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LatLonPoint</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//逆编码查询  第一个参数表示一个Latlng，第二参数表示范围多少米，第三个参数表示是火系坐标系还是GPS原生坐标系</span>
        <span class="token class-name">RegeocodeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegeocodeQuery</span><span class="token punctuation">(</span>latLonPoint<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token class-name">GeocodeSearch</span><span class="token punctuation">.</span><span class="token constant">AMAP</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//异步获取地址信息</span>
        geocodeSearch<span class="token punctuation">.</span><span class="token function">getFromLocationAsyn</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这个方法我们可以在地图点击和长按的时候调用，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/91/e8/C0AClJus_o.png" alt="在这里插入图片描述"></p> 
<p>  通过经纬度构建LatLonPoint对象，然后构建RegeocodeQuery时，传入，并且输入另外两个参数，范围和坐标系。最后通过geocodeSearch发起一个异步的地址获取请求，下面修改一下<code>onRegeocodeSearched()</code>方法。</p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRegeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">RegeocodeResult</span> regeocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//解析result获取地址描述信息</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rCode <span class="token operator">==</span> <span class="token constant">PARSE_SUCCESS_CODE</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RegeocodeAddress</span> regeocodeAddress <span class="token operator">=</span> regeocodeResult<span class="token punctuation">.</span><span class="token function">getRegeocodeAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//显示解析后的地址</span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"地址："</span><span class="token operator">+</span>regeocodeAddress<span class="token punctuation">.</span><span class="token function">getFormatAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"获取地址失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这就可以了，下面运行一下看看。</p> 
<p><img src="https://images2.imgbox.com/1c/3a/bEyNnpLF_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__1095"></a>② 地理编码</h4> 
<p>  上面说了逆地理编码，下面来说说地理编码，地理编码就是地址转坐标，那么它的使用场景是怎么样的呢？比如说你到一个景点去游玩，不知道路线只知道景点名，那么这个时候通常你会在导航软件中输入这个景点名，然后搜索出前往的路线及搭乘的交通工具。此时，导航软件会将你输入的地址转成经纬度坐标，然后通过你当前的所在地坐标计算距离，获取两点之间的交通情况，然后规划路线，是不是脑瓜子嗡嗡的，怎么导航还有这么多门道吗?其实我说的还算简单了，里面的步骤还会有很多的细化过程，好了，当前的重点不是这个地理编码吗？下面我也模仿一下，通过输入框输入地址，然后得出它的经纬度坐标。下面修改一下<code>activity_main.xml</code>中的代码，如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.MaterialToolbar</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/white<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_address<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/et_bg<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>hint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入地址<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>imeOptions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>actionSearch<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>paddingStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.google.android.material.appbar.MaterialToolbar</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.amap.api.maps.MapView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/map_view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--浮动按钮--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_margin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>20dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clickable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>focusable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_favorite_red<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>hoveredFocusedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>pressedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这里你就直接复制粘贴就好了，这里有一个输入框背景<code>et_bg</code>，在drawable下创建<code>et_bg.xml</code>，代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>shape</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>corners</span> <span class="token attr-name"><span class="token namespace">android:</span>radius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>solid</span> <span class="token attr-name"><span class="token namespace">android:</span>color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#E4E4E4<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>shape</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>好了，现在就不报错了，下面我们回到<code>MainActivity</code>中，首先声明一个变量</p> 
<pre><code class="prism language-java">    <span class="token comment">//城市</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
</code></pre> 
<p>在定位回调中我们需要对这个变量进行赋值，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/10/e6/To0EwmBn_o.png" alt="在这里插入图片描述"></p> 
<p>输入框输入地址，我们通过点击输入框弹出输入法，因为涉及到输入法的点击事件，我们就在<code>initView()</code>方法中增加如下代码：</p> 
<pre><code class="prism language-java">        <span class="token comment">// 键盘按键监听</span>
        binding<span class="token punctuation">.</span>etAddress<span class="token punctuation">.</span><span class="token function">setOnKeyListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_ENTER</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//获取输入框的值</span>
                <span class="token class-name">String</span> address <span class="token operator">=</span> binding<span class="token punctuation">.</span>etAddress<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"请输入地址"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">InputMethodManager</span> imm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">InputMethodManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">INPUT_METHOD_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//隐藏软键盘</span>
                    imm<span class="token punctuation">.</span><span class="token function">hideSoftInputFromWindow</span><span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWindowToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// name表示地址，第二个参数表示查询城市，中文或者中文全拼，citycode、adcode</span>
                    <span class="token class-name">GeocodeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeQuery</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    geocodeSearch<span class="token punctuation">.</span><span class="token function">getFromLocationNameAsyn</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/e9/e2/HsjQmgJ0_o.png" alt="在这里插入图片描述"><br> 下面进入到<code>onGeocodeSearched()</code>方法，在这个方法中进行解析后的坐标显示代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">GeocodeResult</span> geocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rCode <span class="token operator">!=</span> <span class="token constant">PARSE_SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"获取坐标失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GeocodeAddress</span><span class="token punctuation">&gt;</span></span> geocodeAddressList <span class="token operator">=</span> geocodeResult<span class="token punctuation">.</span><span class="token function">getGeocodeAddressList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>geocodeAddressList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>geocodeAddressList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">LatLonPoint</span> latLonPoint <span class="token operator">=</span> geocodeAddressList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//显示解析后的坐标</span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"坐标："</span> <span class="token operator">+</span> latLonPoint<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，"</span> <span class="token operator">+</span> latLonPoint<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  通过返回值获取编码地址列表，判断不为空并且大于0则取第一条数据，然后获取经纬度的值显示出来。运行效果图如下所示：</p> 
<p><img src="https://images2.imgbox.com/c1/0d/vymyeuxV_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_Marker_1234"></a>③ 添加标点Marker</h4> 
<p>  通常使用地图是会对地图进行标注，添加标点。刚才通过点击地图获取到了经纬度，那么同样可以根据这个经纬度在地图上绘制标点。</p> 
<p>那么其实也很简单，下面在onMapClick方法中添加如下代码：</p> 
<pre><code class="prism language-java">	aMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>latLng<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token string">"DefaultMarker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/d2/30/jcNq2elo_o.png" alt="在这里插入图片描述"></p> 
<p>运行效果如下图所示：</p> 
<p><img src="https://images2.imgbox.com/81/98/VV5VQWQs_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_Marker_1252"></a>④ 删除标点Marker</h4> 
<p>  那么我们怎么去删除标点Marker呢，我们可以在页面上再增加一个浮动按钮，默认隐藏，当添加标点之后我们显示出按钮，点击该按钮之后就清除地图上的所有添加的标点，同时隐藏这个按钮。针对这个需求，首先我们修改activity_main.xml中代码，添加一个按钮，代码如下所示：</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--浮动按钮 清空marker--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_clear_marker<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_above</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clickable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_clear<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>invisible<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>hoveredFocusedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>pressedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/b7/61/vGErAwU6_o.png" alt="在这里插入图片描述"></p> 
<p>这是使用的图标<code>ic_clear.xml</code>代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fillColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#323233<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pathData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M279.8,206.6a57.6,57.6 0,1 1,57.6 57.3,56.9 56.9,0 0,1 -57.6,-57.3zM572.5,954.6c0,1 -1.9,1.9 -2.9,1.9l-97.6,-58.3a3.6,3.6 0,0 1,-1 -2.9c8.8,-19.4 97.6,-203 87.8,-193.3a1243,1243 0,0 0,-116.1 139.9l-26.3,35.9s-102.4,-69 -134.7,-111.7c0,-1 -1,-1 0,-1.9 20.5,-25.3 129.8,-166.1 129.8,-166.1l-184.4,110.7h-2.9c-8.8,-9.7 -70.3,-77.7 -88.8,-109.8v-1.9c17.6,-14.6 117.1,-98.1 117.1,-98.1l-140.5,49.5a3.6,3.6 0,0 1,-2.9 -1l-51.7,-97.1a1.9,1.9 0,0 1,1 -2.9c24.4,-4.8 230.3,-47.6 330.8,-116.6 2.5,-1.7 5.8,-1.3 7.8,1l287.9,286.5c2.3,2 2.7,5.3 1,7.8a894.9,894.9 0,0 0,-113.2 328.3l0,0.1zM771.6,839a72.2,72.2 0,1 1,-72.2 -71.9,71.9 71.9,0 0,1 72.2,71.9zM827.2,802a38.9,38.9 0,1 1,38.9 -38.7,39.1 39.1,0 0,1 -39,38.9l0.1,-0.1zM947.2,171.6L765.7,353.3c0,2.9 -1,3.9 -1,6.8 41,69.9 40,150.6 -19.5,212.7a4.7,4.7 0,0 1,-6.8 0L450.6,285.3a4.7,4.7 0,0 1,0 -6.8c62.4,-59.2 143.4,-59.2 213.7,-19.4 2.3,0.1 4.6,-0.2 6.8,-1l182.5,-180.6a66.4,66.4 0,1 1,93.7 94.2z<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vector</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>下面我们回到MainActivity中，为了方便清除地图上添加的标点，我们在添加的时候就将标点进行存储，放到一个列表中，声明一个变量，如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">//标点列表</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">&gt;</span></span> markerList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/04/30/mJD5mUUk_o.png" alt="在这里插入图片描述"></p> 
<p>然后写一个添加地图标点和移除地图标点的方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 添加地图标点
     *
     * @param latLng
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//显示浮动按钮</span>
        binding<span class="token punctuation">.</span>fabClearMarker<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加标点</span>
        <span class="token class-name">Marker</span> marker <span class="token operator">=</span> aMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>latLng<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token string">"DefaultMarker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        markerList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 清空地图Marker
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clearAllMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>markerList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>markerList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Marker</span> markerItem <span class="token operator">:</span> markerList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                markerItem<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        binding<span class="token punctuation">.</span>fabClearMarker<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后在<code>onMapClick()</code>方法中调用，如下图所示：<br> <img src="https://images2.imgbox.com/02/82/H0e0uWB4_o.png" alt="在这里插入图片描述"></p> 
<p>最后我们在<code>initView()</code>方法设置清除标点按钮点击事件，代码如下所示：</p> 
<pre><code class="prism language-java">        <span class="token comment">// 清除标点按钮点击事件</span>
        binding<span class="token punctuation">.</span>fabClearMarker<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token function">clearAllMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/80/3d/qZPhDn5B_o.png" alt="在这里插入图片描述"></p> 
<p>下面运行一下看看</p> 
<p><img src="https://images2.imgbox.com/af/ae/6MC0QXVt_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_Marker_1350"></a>⑤ 绘制动画效果Marker</h4> 
<p>在<code>addMarker()</code>方法中，添加如下代码：</p> 
<pre><code class="prism language-java">		<span class="token comment">//设置标点的绘制动画效果</span>
        <span class="token class-name">Animation</span> animation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RotateAnimation</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span><span class="token function">getRotateAngle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>marker<span class="token punctuation">.</span><span class="token function">getRotateAngle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> duration <span class="token operator">=</span> <span class="token number">1000L</span><span class="token punctuation">;</span>
        animation<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        animation<span class="token punctuation">.</span><span class="token function">setInterpolator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearInterpolator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        marker<span class="token punctuation">.</span><span class="token function">setAnimation</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        marker<span class="token punctuation">.</span><span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>这里对于动画类的导包要注意一些，这个包是在高德的SDK中的，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/cd/28/lXYauNN3_o.png" alt="在这里插入图片描述"><br> 上述代码添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/08/6a/8AyaEi8q_o.png" alt="在这里插入图片描述"></p> 
<p>这段代码的意思就是配置一个旋转动画，然后设置旋转的角度和旋转所需要的时间，之后设置给marker。就可以，下面来看看效果吧。</p> 
<p><img src="https://images2.imgbox.com/3e/7b/1QtYGl7a_o.gif" alt="在这里插入图片描述"><br> 这个动画是逆时针的，可以自己根据需要的效果进行更改。</p> 
<p>当然可能这一个动画并不能满足你的需求，SDK中还提供了其他的，比如缩放动画、位移动画、透明度动画、渐变动画。它们都继承自Animation。</p> 
<p><img src="https://images2.imgbox.com/de/5a/AFFD1Lsv_o.png" alt="在这里插入图片描述"></p> 
<p>可以根据里面的参数进行配置然后达到你要的效果，那么就Marker的绘制动画效果就说到这，如果你有需要我用代码说明其他动画的需求，可以评论一下，我根据你的需求加上去。</p> 
<h4><a id="_Marker_1386"></a>⑥ Marker的点击和拖拽事件</h4> 
<p>Marker的点击和拖拽事件同样是在地图上设置，我们在initMap()方法中，增加如下所示代码：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 设置地图标点点击事件</span>
            aMap<span class="token punctuation">.</span><span class="token function">setOnMarkerClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置地图标点拖拽事件</span>
            aMap<span class="token punctuation">.</span><span class="token function">setOnMarkerDragListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/6b/f0/uG60olL7_o.png" alt="在这里插入图片描述"></p> 
<p>然后我们实现相应的接口方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onMarkerClick</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"点击了标点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMarkerDragStart</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"开始拖拽"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMarkerDrag</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"拖拽中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMarkerDragEnd</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"拖拽完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>要使标点可以拖拽，需要修改marker的可拖动属性，默认为false，在<code>addMarker()</code>方法中添加一个属性，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/42/1e/nlkH8trA_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/11/39/k15WhRYx_o.gif" alt="在这里插入图片描述"></p> 
<p>这个标点的点击和拖拽，建议你不要加上动画，就默认的标点，好操作一些。</p> 
<h4><a id="__InfoWindow_1436"></a>⑦ 绘制 InfoWindow</h4> 
<p>  标点也是可以携带一些信息的，而这个信息可以由InfoWindow（信息窗体）展示处理出来。首先应该显示出来这个infoWindow，上面我们写了这个Marker的点击事件，那么可以在点击的时候显示<code>InfoWindow</code>，再点击就显示。先在<code>addMarker()</code>方法中设置InfoWindow中的信息，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/64/25/Dq8LUpgS_o.png" alt="在这里插入图片描述"><br>   然后在<code>onMarkerClick()</code>方法中，通过<code>marker.isInfoWindowShown()</code>判断当前Marker的InfoWindow是否显示，之后通过<code>showInfoWindow()</code>显示，<code>hideInfoWindow()</code>隐藏，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onMarkerClick</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>marker<span class="token punctuation">.</span><span class="token function">isInfoWindowShown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 显示</span>
            marker<span class="token punctuation">.</span><span class="token function">showInfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 隐藏</span>
            marker<span class="token punctuation">.</span><span class="token function">hideInfoWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/c7/99/2NdvgIZQ_o.gif" alt="在这里插入图片描述"></p> 
<p>  刚才是使用了自带的样式，其实InfoWindow是可以自己定义样式的，首先添加两个图片。<br> <img src="https://images2.imgbox.com/d7/09/0uxmetLC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c8/a7/SW2Mqw5K_o.png" alt="在这里插入图片描述"></p> 
<p>建议在我的源码里面复制，直接在博客中保存图片会有问题，下面在layout下创建两个xml。</p> 
<p><code>custom_info_contents.xml</code></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/badge<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>adjustViewBounds</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ImageView</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/title<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>ellipsize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>end<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ff000000<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bold<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/snippet<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>ellipsize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>end<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ff7f7f7f<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p><code>custom_info_window.xml</code></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@mipmap/custom_info_bubble<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/badge<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ImageView</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/title<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>ellipsize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>end<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ff000000<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textStyle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bold<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/snippet<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>ellipsize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>end<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#ff7f7f7f<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>下面回到<code>MainActivity</code>中，在initMap添加InfoWindow适配器监听。代码如下所示：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 设置InfoWindowAdapter监听</span>
            aMap<span class="token punctuation">.</span><span class="token function">setInfoWindowAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/ef/7c/iDeh3Yxk_o.png" alt="在这里插入图片描述"></p> 
<p>然后实现AMap.InfoWindowAdapter的接口，里面两个方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 修改内容
     *
     * @param marker
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoContents</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">View</span> infoContent <span class="token operator">=</span> <span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_info_contents<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">render</span><span class="token punctuation">(</span>marker<span class="token punctuation">,</span> infoContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> infoContent<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 修改背景
     *
     * @param marker
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">getInfoWindow</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">View</span> infoWindow <span class="token operator">=</span> <span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>custom_info_window<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">render</span><span class="token punctuation">(</span>marker<span class="token punctuation">,</span> infoWindow<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> infoWindow<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 渲染
     *
     * @param marker
     * @param view
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">,</span> <span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ImageView</span><span class="token punctuation">)</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>badge<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>mipmap<span class="token punctuation">.</span>ic_yuan<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//修改InfoWindow标题内容样式</span>
        <span class="token class-name">String</span> title <span class="token operator">=</span> marker<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> titleUi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>title <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">SpannableString</span> titleText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpannableString</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
            titleText<span class="token punctuation">.</span><span class="token function">setSpan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ForegroundColorSpan</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    titleText<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            titleUi<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            titleUi<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>titleText<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            titleUi<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//修改InfoWindow片段内容样式</span>
        <span class="token class-name">String</span> snippet <span class="token operator">=</span> marker<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> snippetUi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> view<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>snippet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>snippet <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">SpannableString</span> snippetText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpannableString</span><span class="token punctuation">(</span>snippet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snippetText<span class="token punctuation">.</span><span class="token function">setSpan</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ForegroundColorSpan</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">GREEN</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                    snippetText<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            snippetUi<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            snippetUi<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>snippetText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            snippetUi<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/7e/56/9sa48Z3H_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以在添加标点的时候就直接显示<code>InfoWindow</code>，</p> 
<p><img src="https://images2.imgbox.com/05/b2/tSph7jNb_o.png" alt="在这里插入图片描述"></p> 
<p>下面运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/64/54/B8rtfbxq_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="_InfoWindow_1652"></a>⑧ InfoWindow的点击事件</h4> 
<p>在<code>initMap()</code>方法中添加如下代码：</p> 
<pre><code class="prism language-java">            <span class="token comment">// 设置InfoWindow点击事件</span>
            aMap<span class="token punctuation">.</span><span class="token function">setOnInfoWindowClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：<br> <img src="https://images2.imgbox.com/f4/fe/bLaE0ybR_o.png" alt="在这里插入图片描述"></p> 
<p>实现接口，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * InfoWindow点击事件
     *
     * @param marker
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInfoWindowClick</span><span class="token punctuation">(</span><span class="token class-name">Marker</span> marker<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"弹窗内容：标题："</span> <span class="token operator">+</span> marker<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n内容："</span> <span class="token operator">+</span> marker<span class="token punctuation">.</span><span class="token function">getSnippet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>运行一下：</p> 
<p><img src="https://images2.imgbox.com/1a/18/NASFdUqo_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__1682"></a>⑨ 改变地图中心点</h4> 
<p>  我们在实际使用中通常会有这样的操作，希望点击一下就可以移动到所在地，这其实是比较容易做到的，回顾我们现在是一进入地图就会定位到当前所在地，而当我点击地图上其他位置时，会增加一个标点，而我们要做的就是把这个标点作为地图中心，然后移动地图位置即可。</p> 
<p>  现在思路已经有了，很简单下面来写代码，代码也是很简单的，首先新增一个<code>updateMapCenter()</code>方法，里面传递一个LatLng对象作为入参。方法如下：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 改变地图中心位置
     * @param latLng 位置
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateMapCenter</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// CameraPosition 第一个参数： 目标位置的屏幕中心点经纬度坐标。</span>
        <span class="token comment">// CameraPosition 第二个参数： 目标可视区域的缩放级别</span>
        <span class="token comment">// CameraPosition 第三个参数： 目标可视区域的倾斜度，以角度为单位。</span>
        <span class="token comment">// CameraPosition 第四个参数： 可视区域指向的方向，以角度为单位，从正北向顺时针方向计算，从0度到360度</span>
        <span class="token class-name">CameraPosition</span> cameraPosition <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CameraPosition</span><span class="token punctuation">(</span>latLng<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//位置变更</span>
        <span class="token class-name">CameraUpdate</span> cameraUpdate <span class="token operator">=</span> <span class="token class-name">CameraUpdateFactory</span><span class="token punctuation">.</span><span class="token function">newCameraPosition</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//改变位置（使用动画）</span>
        aMap<span class="token punctuation">.</span><span class="token function">animateCamera</span><span class="token punctuation">(</span>cameraUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  先通过CameraPosition配置一个中心位置对象，对象需要四个参数，在注释中已经说明了，然后通过CameraUpdate配置一个位置改变对象，传入刚才的cameraPosition。最后就是在地图上改变位置了。通过aMap.moveCamera()。这个方法比较简单，但别忘记了去调用，在onMapClick调用即可。</p> 
<p><img src="https://images2.imgbox.com/b8/f2/pgmXvRez_o.png" alt="在这里插入图片描述"></p> 
<p>那么下面运行一下看看：</p> 
<p><img src="https://images2.imgbox.com/6a/e9/ut188nOJ_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_1714"></a>九、出行路线规划</h3> 
<p>  首先要搞清楚什么是路线规划，比如有两个地点，A和B。从A到B有多种方路线和交通工具可以选择，这就是路线规划。那么平时常见的路线规划有哪些呢？步行、驾车、公交地铁等。这也是导航中使用最多的，那么下面先来说说这个步行出行路线规划，以下简称步行。</p> 
<h4><a id="__1718"></a>① 准备工作</h4> 
<p>  这个路线规划我是打算单独放在一个Activity中，这样看起来会更加的清晰，因为我在MainActivity中已经写了很多的其他的功能的业务代码了，再加进去看起来好像就不是很容易去理解。也避免一个Activity打天下的尴尬局面。右键点击这个包名，然后<code>New</code> → <code>Activity</code> → <code>Empty Views Activity</code></p> 
<p><img src="https://images2.imgbox.com/f2/dc/rCygjZEq_o.png" alt="在这里插入图片描述"><br> 然后命名为<code>RouteActivity</code>，点击Finish完成Activity的创建。<br> <img src="https://images2.imgbox.com/d2/46/ORJYZ1Ut_o.png" alt="在这里插入图片描述"></p> 
<p>  创建好之后先做好准备工作，我先说说需要做好什么样的准备。一进入RouteActivity之后就要定位到当前所在地，这在前面我已经说过了，因此下面这一部分的代码我就不做讲解，如果你不理解是为什么，那么请从头看起。</p> 
<p>首先修改<code>activity_route.xml</code>，代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.RouteActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--地图--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.amap.api.maps.MapView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/map_view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>然后修改一下<code>RouteActivity</code>的代码，代码如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>activity<span class="token punctuation">.</span></span><span class="token class-name">EdgeToEdge</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>core<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Insets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>core<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewCompat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>core<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">WindowInsetsCompat</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">AMapLocation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">AMapLocationClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">AMapLocationClientOption</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">AMapLocationListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">LocationSource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">UiSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptorFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MyLocationStyle</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span></span><span class="token class-name">ActivityRouteBinding</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span>
        <span class="token class-name">AMapLocationListener</span><span class="token punctuation">,</span> <span class="token class-name">LocationSource</span> <span class="token punctuation">{<!-- --></span>


    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TAG</span> <span class="token operator">=</span> <span class="token string">"RouteActivity"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ActivityRouteBinding</span> binding<span class="token punctuation">;</span>
    <span class="token comment">//地图控制器</span>
    <span class="token keyword">private</span> <span class="token class-name">AMap</span> aMap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明AMapLocationClient类对象</span>
    <span class="token keyword">public</span> <span class="token class-name">AMapLocationClient</span> mLocationClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明AMapLocationClientOption对象</span>
    <span class="token keyword">public</span> <span class="token class-name">AMapLocationClientOption</span> mLocationOption <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//位置更改监听</span>
    <span class="token keyword">private</span> <span class="token class-name">LocationSource<span class="token punctuation">.</span>OnLocationChangedListener</span> mListener<span class="token punctuation">;</span>
    <span class="token comment">//定义一个UiSettings对象</span>
    <span class="token keyword">private</span> <span class="token class-name">UiSettings</span> mUiSettings<span class="token punctuation">;</span>
    <span class="token comment">//定位样式</span>
    <span class="token keyword">private</span> <span class="token class-name">MyLocationStyle</span> myLocationStyle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyLocationStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EdgeToEdge</span><span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding <span class="token operator">=</span> <span class="token class-name">ActivityRouteBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ViewCompat</span><span class="token punctuation">.</span><span class="token function">setOnApplyWindowInsetsListener</span><span class="token punctuation">(</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> insets<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Insets</span> systemBars <span class="token operator">=</span> insets<span class="token punctuation">.</span><span class="token function">getInsets</span><span class="token punctuation">(</span><span class="token class-name">WindowInsetsCompat<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token function">systemBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            v<span class="token punctuation">.</span><span class="token function">setPadding</span><span class="token punctuation">(</span>systemBars<span class="token punctuation">.</span>left<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>top<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>right<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> insets<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//初始化定位</span>
        <span class="token function">initLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化地图</span>
        <span class="token function">initMap</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//启动定位</span>
        mLocationClient<span class="token punctuation">.</span><span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化定位
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//初始化定位</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMapLocationClient</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMapLocationClientOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setLocationMode</span><span class="token punctuation">(</span><span class="token class-name">AMapLocationClientOption<span class="token punctuation">.</span>AMapLocationMode<span class="token punctuation">.</span>Hight_Accuracy</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setOnceLocationLatest</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setNeedAddress</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setHttpTimeOut</span><span class="token punctuation">(</span><span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationOption<span class="token punctuation">.</span><span class="token function">setLocationCacheEnable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">setLocationOption</span><span class="token punctuation">(</span>mLocationOption<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化地图
     *
     * @param savedInstanceState
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initMap</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化地图控制器对象</span>
        aMap <span class="token operator">=</span> binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置最小缩放等级为12 ，缩放级别范围为[3, 20]</span>
        aMap<span class="token punctuation">.</span><span class="token function">setMinZoomLevel</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//开启室内地图</span>
        aMap<span class="token punctuation">.</span><span class="token function">showIndoorMap</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//实例化UiSettings类对象</span>
        mUiSettings <span class="token operator">=</span> aMap<span class="token punctuation">.</span><span class="token function">getUiSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//隐藏缩放按钮 默认显示</span>
        mUiSettings<span class="token punctuation">.</span><span class="token function">setZoomControlsEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//显示比例尺 默认不显示</span>
        mUiSettings<span class="token punctuation">.</span><span class="token function">setScaleControlsEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 自定义定位蓝点图标</span>
        myLocationStyle<span class="token punctuation">.</span><span class="token function">myLocationIcon</span><span class="token punctuation">(</span><span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>gps_point<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置定位蓝点的Style</span>
        aMap<span class="token punctuation">.</span><span class="token function">setMyLocationStyle</span><span class="token punctuation">(</span>myLocationStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置定位监听</span>
        aMap<span class="token punctuation">.</span><span class="token function">setLocationSource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置为true表示显示定位层并可触发定位，false表示隐藏定位层并不可触发定位，默认是false</span>
        aMap<span class="token punctuation">.</span><span class="token function">setMyLocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLocationChanged</span><span class="token punctuation">(</span><span class="token class-name">AMapLocation</span> aMapLocation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//地址</span>
                <span class="token class-name">String</span> address <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//获取纬度</span>
                <span class="token keyword">double</span> latitude <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//获取经度</span>
                <span class="token keyword">double</span> longitude <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//停止定位后，本地定位服务并不会被销毁</span>
                mLocationClient<span class="token punctuation">.</span><span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//显示地图定位结果</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 显示系统图标</span>
                    mListener<span class="token punctuation">.</span><span class="token function">onLocationChanged</span><span class="token punctuation">(</span>aMapLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//定位失败时，可通过ErrCode（错误码）信息来确定失败的原因，errInfo是错误信息，详见错误码表。</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"AmapError"</span><span class="token punctuation">,</span> <span class="token string">"location Error, ErrCode:"</span>
                        <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", errInfo:"</span>
                        <span class="token operator">+</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getErrorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">activate</span><span class="token punctuation">(</span><span class="token class-name">LocationSource<span class="token punctuation">.</span>OnLocationChangedListener</span> onLocationChangedListener<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mListener <span class="token operator">=</span> onLocationChangedListener<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">startLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//启动定位</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deactivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mListener <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">stopLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mLocationClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//销毁定位客户端，同时销毁本地定位服务。</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mLocationClient <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mLocationClient<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        binding<span class="token punctuation">.</span>mapView<span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> llw<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> llw<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后我们需要从MainActivity中进入RouteActivity，因此修改一下<code>activity_main.xml</code>，添加一个浮动按钮，代码如下所示：</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--浮动按钮 跳转路线Activity--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.floatingactionbutton.FloatingActionButton</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_route<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clickable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_route<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>backgroundTint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>backgroundTintMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>fabSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mini<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>hoveredFocusedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/fab_poi<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>pressedTranslationZ</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/bd/66/3KFUoXHz_o.png" alt="在这里插入图片描述"></p> 
<p>这个图标<code>ic_route.xml</code>的代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1024<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fillColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#333333<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pathData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M870.4,0a153.6,153.6 0,0 0,-153.6 153.6c0,133.6 153.6,307.2 153.6,307.2s153.6,-173.6 153.6,-307.2a153.6,153.6 0,0 0,-153.6 -153.6zM870.4,230.4A76.8,76.8 0,1 1,947.2 153.6,76.8 76.8,0 0,1 870.4,230.4zM256,256a256,256 0,0 0,-256 256c0,222.7 256,512 256,512s256,-289.3 256,-512a256,256 0,0 0,-256 -256zM256,640A128,128 0,1 1,384 512,128 128,0 0,1 256,640zM669.2,538.6a204.8,204.8 0,0 0,-13.3 81.4v14.8h51.2v-13.3a159.2,159.2 0,0 1,9.2 -61.4,129 129,0 0,1 5.6,-11.8l-45.1,-24.6q-4.1,6.7 -7.7,14.8zM713.7,475.6l34.3,37.9a174.1,174.1 0,0 1,79.4 -38.9l-11.3,-51.2a224.8,224.8 0,0 0,-102.4 52.2zM319.5,972.8l4.6,51.2c36.9,-3.1 71.7,-7.7 102.4,-12.8l-8.7,-51.2c-29.2,5.6 -63,9.7 -98.3,12.8zM606.7,892.9l-6.7,5.1 30.7,41 9.2,-7.2a194.6,194.6 0,0 0,59.9 -86l-48.6,-16.9a141.8,141.8 0,0 1,-44.5 64zM468,950.8l11.3,51.2a530.9,530.9 0,0 0,102.4 -33.3l-21,-47.1a487.4,487.4 0,0 1,-92.7 29.2zM658.9,687.1c0,20.5 3.1,41.5 3.1,62.5v35.3l51.2,5.1a403.5,403.5 0,0 0,0 -40.4c0,-22 0,-44.5 -3.1,-66z<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vector</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<p>在initView()方法中，添加如下代码：</p> 
<pre><code class="prism language-java">        <span class="token comment">// 路线按钮点击事件</span>
        binding<span class="token punctuation">.</span>fabRoute<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">RouteActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/4f/ce/laYsqKb2_o.png" alt="在这里插入图片描述">下面运行一下：</p> 
<p><img src="https://images2.imgbox.com/f4/2c/EKeMIPzO_o.gif" alt="在这里插入图片描述"></p> 
<p>那么现在准备工作就做完了。下面正式进入到路线规划的代码编写。</p> 
<h4><a id="__2008"></a>② 步行路线规划</h4> 
<p>  路线规划首先需要两个点，起点和终点。起点其实已经有了，那就是我们当前所在地，至于终点可以由用户来控制，比如我在当前所在位置，然后点击了地图上某一个地方，把这个地方作为终点，这样一想也是可行的。那么按照这个思路来写一下代码。首先我先在<code>RouteActivity</code>创建两个对象。</p> 
<pre><code class="prism language-java">	<span class="token comment">//起点</span>
    <span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> mStartPoint<span class="token punctuation">;</span>
    <span class="token comment">//终点</span>
    <span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> mEndPoint<span class="token punctuation">;</span>
</code></pre> 
<p>  这里面会用到一些帮助方法，因此可以放到一个类里面进行管理，作为一个工具类。而工具类应该放到一个工具包下管理，在<code>com.llw.newmapdemo</code>下新建一个<code>utils</code>包，然后在这个包下新增<code>ChString</code>类，这个类是高德示例Demo里面的，我就直接拿过来了，代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChString</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Kilometer</span> <span class="token operator">=</span> <span class="token string">"\u516c\u91cc"</span><span class="token punctuation">;</span><span class="token comment">// "公里";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Meter</span> <span class="token operator">=</span> <span class="token string">"\u7c73"</span><span class="token punctuation">;</span><span class="token comment">// "米";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">ByFoot</span> <span class="token operator">=</span> <span class="token string">"\u6b65\u884c"</span><span class="token punctuation">;</span><span class="token comment">// "步行";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">To</span> <span class="token operator">=</span> <span class="token string">"\u53bb\u5f80"</span><span class="token punctuation">;</span><span class="token comment">// "去往";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Station</span> <span class="token operator">=</span> <span class="token string">"\u8f66\u7ad9"</span><span class="token punctuation">;</span><span class="token comment">// "车站";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">TargetPlace</span> <span class="token operator">=</span> <span class="token string">"\u76ee\u7684\u5730"</span><span class="token punctuation">;</span><span class="token comment">// "目的地";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">StartPlace</span> <span class="token operator">=</span> <span class="token string">"\u51fa\u53d1\u5730"</span><span class="token punctuation">;</span><span class="token comment">// "出发地";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">About</span> <span class="token operator">=</span> <span class="token string">"\u5927\u7ea6"</span><span class="token punctuation">;</span><span class="token comment">// "大约";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Direction</span> <span class="token operator">=</span> <span class="token string">"\u65b9\u5411"</span><span class="token punctuation">;</span><span class="token comment">// "方向";</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">GetOn</span> <span class="token operator">=</span> <span class="token string">"\u4e0a\u8f66"</span><span class="token punctuation">;</span><span class="token comment">// "上车";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">GetOff</span> <span class="token operator">=</span> <span class="token string">"\u4e0b\u8f66"</span><span class="token punctuation">;</span><span class="token comment">// "下车";</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Zhan</span> <span class="token operator">=</span> <span class="token string">"\u7ad9"</span><span class="token punctuation">;</span><span class="token comment">// "站";</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> cross <span class="token operator">=</span> <span class="token string">"\u4ea4\u53c9\u8def\u53e3"</span><span class="token punctuation">;</span> <span class="token comment">// 交叉路口</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">"\u7c7b\u522b"</span><span class="token punctuation">;</span> <span class="token comment">// 类别</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> address <span class="token operator">=</span> <span class="token string">"\u5730\u5740"</span><span class="token punctuation">;</span> <span class="token comment">// 地址</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">PrevStep</span> <span class="token operator">=</span> <span class="token string">"\u4e0a\u4e00\u6b65"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">NextStep</span> <span class="token operator">=</span> <span class="token string">"\u4e0b\u4e00\u6b65"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Gong</span> <span class="token operator">=</span> <span class="token string">"\u516c\u4ea4"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">ByBus</span> <span class="token operator">=</span> <span class="token string">"\u4e58\u8f66"</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token class-name">Arrive</span> <span class="token operator">=</span> <span class="token string">"\u5230\u8FBE"</span><span class="token punctuation">;</span><span class="token comment">// 到达</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>  再在这个包下新增一个<code>MapUtil</code>类，来源于高德示例Demo，我只拿了目前用得到的方法，代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">DecimalFormat</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 地图帮助类
 * @author llw
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MapUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 把LatLng对象转化为LatLonPoint对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LatLonPoint</span> <span class="token function">convertToLatLonPoint</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLonPoint</span><span class="token punctuation">(</span>latLng<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> latLng<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 把LatLonPoint对象转化为LatLon对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LatLng</span> <span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> latLonPoint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>latLonPoint<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> latLonPoint<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFriendlyTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> second<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>second <span class="token operator">&gt;</span> <span class="token number">3600</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> hour <span class="token operator">=</span> second <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> miniate <span class="token operator">=</span> <span class="token punctuation">(</span>second <span class="token operator">%</span> <span class="token number">3600</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> hour <span class="token operator">+</span> <span class="token string">"小时"</span> <span class="token operator">+</span> miniate <span class="token operator">+</span> <span class="token string">"分钟"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>second <span class="token operator">&gt;=</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> miniate <span class="token operator">=</span> second <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> miniate <span class="token operator">+</span> <span class="token string">"分钟"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> second <span class="token operator">+</span> <span class="token string">"秒"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getFriendlyLength</span><span class="token punctuation">(</span><span class="token keyword">int</span> lenMeter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lenMeter <span class="token operator">&gt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token comment">// 10 km</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> dis <span class="token operator">=</span> lenMeter <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> dis <span class="token operator">+</span> <span class="token class-name">ChString<span class="token punctuation">.</span>Kilometer</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>lenMeter <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> dis <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> lenMeter <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
            <span class="token class-name">DecimalFormat</span> fnum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"##0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> dstr <span class="token operator">=</span> fnum<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> dstr <span class="token operator">+</span> <span class="token class-name">ChString<span class="token punctuation">.</span>Kilometer</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>lenMeter <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> dis <span class="token operator">=</span> lenMeter <span class="token operator">/</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> dis <span class="token operator">+</span> <span class="token class-name">ChString<span class="token punctuation">.</span>Meter</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> dis <span class="token operator">=</span> lenMeter <span class="token operator">/</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            dis <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> dis <span class="token operator">+</span> <span class="token class-name">ChString<span class="token punctuation">.</span>Meter</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>下面回到<code>RouteActivity</code>中，首先对起点进行赋值</p> 
<pre><code class="prism language-java">	<span class="token comment">//设置起点</span>
    mStartPoint <span class="token operator">=</span> <span class="token function">convertToLatLonPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/22/fe/wd9tMNX0_o.png" alt="在这里插入图片描述"></p> 
<p>  通过经纬度，构建LatLng对象，然后将LatLng转为LatLonPoint。最后赋值给起点mStartPoint。</p> 
<p>  那么下面就是终点了。刚才说到终点通过点击地图时产生，那么既然要点击地图，自然要使当前RouteActivity实现AMap.OnMapClickListener接口。然后在initMap中，进行监听。</p> 
<pre><code class="prism language-java">		<span class="token comment">//地图点击监听</span>
        aMap<span class="token punctuation">.</span><span class="token function">setOnMapClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/fd/QlEJrymG_o.png" alt="在这里插入图片描述"></p> 
<p>  之后重写<code>onMapClick()</code>方法，然后将获取到的LatLng对象转为LatLonPoint，最后赋值给终点mEndPoint。</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 点击地图
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMapClick</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//终点</span>
        mEndPoint <span class="token operator">=</span> <span class="token function">convertToLatLonPoint</span><span class="token punctuation">(</span>latLng<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  这样我们就拿到了起点和终点，下面就要去搜索路线了，搜索路线需要一个RouteSearch对象，在RouteActivity中创建。</p> 
<pre><code class="prism language-java">	<span class="token comment">//路线搜索对象</span>
    <span class="token keyword">private</span> <span class="token class-name">RouteSearch</span> routeSearch<span class="token punctuation">;</span>
</code></pre> 
<p>  然后RouteActivity实现RouteSearch.OnRouteSearchListener接口，新增一个initRoute方法。在这个方法里面初始化，然后设置路线搜索监听，方法代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 初始化路线
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            routeSearch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AMapException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        routeSearch<span class="token punctuation">.</span><span class="token function">setRouteSearchListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>记得在<code>onCreate()</code>方法中调用，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/cd/35/vlEiuIWa_o.png" alt="在这里插入图片描述"></p> 
<p>之后需要重写四个方法，如下所示：</p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBusRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">BusRouteResult</span> busRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDriveRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">DriveRouteResult</span> driveRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 步行规划路径结果
     *
     * @param walkRouteResult 结果
     * @param code            结果码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onWalkRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">WalkRouteResult</span> walkRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRideRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">RideRouteResult</span> rideRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>
</code></pre> 
<p>  其中<code>onWalkRouteSearched()</code>方法我标注了是步行搜索返回的结果。那么现在先不管这个结果，因为我们需要先去发起路线搜索的请求之后，才会有结果，这里新增一个<code>startRouteSearch()</code>方法，代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 开始路线搜索
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startRouteSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//在地图上添加起点Marker</span>
        aMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>mStartPoint<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//在地图上添加终点Marker</span>
        aMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>mEndPoint<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//搜索路线 构建路径的起终点</span>
        <span class="token keyword">final</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>FromAndTo</span> fromAndTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>FromAndTo</span><span class="token punctuation">(</span>
                mStartPoint<span class="token punctuation">,</span> mEndPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构建步行路线搜索对象</span>
        <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkRouteQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkDefault</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 异步路径规划步行模式查询</span>
        routeSearch<span class="token punctuation">.</span><span class="token function">calculateWalkRouteAsyn</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  前面两句代码就是给起点和终点各增加一个标注，这里有两个图标，你应该没有，我这里贴一下：</p> 
<p><img src="https://images2.imgbox.com/7e/fe/CFLfAuvO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/52/7b/JK2vbnPm_o.png" alt="在这里插入图片描述"><br>   最好去我的源码里面去拿。然后代码继续往下看就是通过起点和终点构建路径的起终点对象fromAndTo，再通过这个对象去构建步行路线搜索对象，最后通过routeSearch对象发起搜索请求。到此为止请求就写完了。我们在onMapClick中去调用它。</p> 
<p><img src="https://images2.imgbox.com/77/0a/rCcP9nW1_o.png" alt="在这里插入图片描述"></p> 
<p>  下面就该去处理搜索路线的返回了。返回后最重要的是对这个路线进行绘制，从哪里到哪里，绘制在地图上，之前高德的SDK中这一部分是不开放的，不过在地图SDK V4.1.3版本开始，就已经是开源的了，只不过你要到高德示例Demo中去寻找，为了减少你的工作量，我已经提前找好了，并且只拿我需要的。下面在<code>com.llw.newmapdemo</code>下新增一个<code>overlay</code>包，这个包下新增三个类。</p> 
<p><strong>AMapServicesUtil.java</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 地图服务工具类
 */</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Bitmap</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AMapServicesUtil</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">BUFFER_SIZE</span> <span class="token operator">=</span> <span class="token number">2048</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">inputStreamToByte</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>

		<span class="token class-name">ByteArrayOutputStream</span> outStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token constant">BUFFER_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>count <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">BUFFER_SIZE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			outStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> outStream<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LatLonPoint</span> <span class="token function">convertToLatLonPoint</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latlon<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLonPoint</span><span class="token punctuation">(</span>latlon<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> latlon<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LatLng</span> <span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> latLonPoint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>latLonPoint<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> latLonPoint<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertArrList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> lineShapes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> point <span class="token operator">:</span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">LatLng</span> latLngTemp <span class="token operator">=</span> <span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
			lineShapes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latLngTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> lineShapes<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Bitmap</span> <span class="token function">zoomBitmap</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">,</span> <span class="token keyword">float</span> res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>bitmap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">int</span> width<span class="token punctuation">,</span> height<span class="token punctuation">;</span>
		width <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
		height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>bitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Bitmap</span> newbmp <span class="token operator">=</span> <span class="token class-name">Bitmap</span><span class="token punctuation">.</span><span class="token function">createScaledBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> newbmp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p><strong>RouteOverlay.java</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Bitmap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Color</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">CameraUpdateFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptorFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLngBounds</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Marker</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MarkerOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Polyline</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolylineOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 路线图层叠加
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteOverlay</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">&gt;</span></span> stationMarkers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Polyline</span><span class="token punctuation">&gt;</span></span> allPolyLines <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Polyline</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">Marker</span> startMarker<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">Marker</span> endMarker<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">LatLng</span> startPoint<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">LatLng</span> endPoint<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token class-name">AMap</span> mAMap<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">Bitmap</span> startBit<span class="token punctuation">,</span> endBit<span class="token punctuation">,</span> busBit<span class="token punctuation">,</span> walkBit<span class="token punctuation">,</span> driveBit<span class="token punctuation">;</span>
	<span class="token keyword">protected</span> <span class="token keyword">boolean</span> nodeIconVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">RouteOverlay</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 去掉BusRouteOverlay上所有的Marker。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>startMarker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			startMarker<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>endMarker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			endMarker<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Marker</span> marker <span class="token operator">:</span> stationMarkers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			marker<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Polyline</span> line <span class="token operator">:</span> allPolyLines<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			line<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">destroyBit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">destroyBit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>startBit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			startBit<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			startBit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>endBit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			endBit<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			endBit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>busBit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			busBit<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			busBit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>walkBit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			walkBit<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			walkBit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>driveBit <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			driveBit<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			driveBit <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 给起点Marker设置图标，并返回更换图标的图片。如不用默认图片，需要重写此方法。
	 * @return 更换的Marker图片。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">protected</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getStartBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 给终点Marker设置图标，并返回更换图标的图片。如不用默认图片，需要重写此方法。
	 * @return 更换的Marker图片。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">protected</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getEndBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 给公交Marker设置图标，并返回更换图标的图片。如不用默认图片，需要重写此方法。
	 * @return 更换的Marker图片。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">protected</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getBusBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 给步行Marker设置图标，并返回更换图标的图片。如不用默认图片，需要重写此方法。
	 * @return 更换的Marker图片。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">protected</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getWalkBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_man<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getDriveBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_car<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addStartAndEndMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		startMarker <span class="token operator">=</span> mAMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getStartBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u8D77\u70B9"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// startMarker.showInfoWindow();</span>

		endMarker <span class="token operator">=</span> mAMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>endPoint<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getEndBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u7EC8\u70B9"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// mAMap.moveCamera(CameraUpdateFactory.newLatLngZoom(startPoint,</span>
		<span class="token comment">// getShowRouteZoom()));</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 移动镜头到当前的视角。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">zoomToSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>startPoint <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mAMap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">LatLngBounds</span> bounds <span class="token operator">=</span> <span class="token function">getLatLngBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mAMap<span class="token punctuation">.</span><span class="token function">animateCamera</span><span class="token punctuation">(</span><span class="token class-name">CameraUpdateFactory</span>
						<span class="token punctuation">.</span><span class="token function">newLatLngBounds</span><span class="token punctuation">(</span>bounds<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token class-name">LatLngBounds</span> <span class="token function">getLatLngBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLngBounds<span class="token punctuation">.</span>Builder</span> b <span class="token operator">=</span> <span class="token class-name">LatLngBounds</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		b<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		b<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>endPoint<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> endPoint<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 路段节点图标控制显示接口。
	 * @param visible true为显示节点图标，false为不显示。
	 * @since V2.3.1
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setNodeIconVisibility</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> visible<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			nodeIconVisible <span class="token operator">=</span> visible<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stationMarkers <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stationMarkers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stationMarkers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>stationMarkers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token class-name">MarkerOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>options <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">Marker</span> marker <span class="token operator">=</span> mAMap<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>marker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			stationMarkers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token class-name">PolylineOptions</span> options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>options <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">Polyline</span> polyline <span class="token operator">=</span> mAMap<span class="token punctuation">.</span><span class="token function">addPolyline</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>polyline <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			allPolyLines<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>polyline<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">protected</span> <span class="token keyword">float</span> <span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token number">18f</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getWalkColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#6db74d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 自定义路线颜色。
	 * return 自定义路线颜色。
	 * @since V2.2.1
	 */</span>
	<span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getBusColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#537edc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#537edc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// protected int getShowRouteZoom() {<!-- --></span>
	<span class="token comment">// return 15;</span>
	<span class="token comment">// }</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>WalkRouteOverlay.java</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MarkerOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolylineOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">WalkPath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">WalkStep</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 步行路线图层类。在高德地图API里，如果要显示步行路线规划，可以用此类来创建步行路线图层。如不满足需求，也可以自己创建自定义的步行路线图层。
 * @since V2.1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WalkRouteOverlay</span> <span class="token keyword">extends</span> <span class="token class-name">RouteOverlay</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">PolylineOptions</span> mPolylineOptions<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">BitmapDescriptor</span> walkStationDescriptor<span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">WalkPath</span> walkPath<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 通过此构造函数创建步行路线图层。
	 * @param context 当前activity。
	 * @param amap 地图对象。
	 * @param path 步行路线规划的一个方案。详见搜索服务模块的路径查询包（com.amap.api.services.route）中的类 &lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/route/WalkStep.html" title="com.amap.api.services.route中的类"&gt;WalkStep&lt;/a&gt;&lt;/strong&gt;。
	 * @param start 起点。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类&lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @param end 终点。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类&lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">WalkRouteOverlay</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AMap</span> amap<span class="token punctuation">,</span> <span class="token class-name">WalkPath</span> path<span class="token punctuation">,</span>
			<span class="token class-name">LatLonPoint</span> start<span class="token punctuation">,</span> <span class="token class-name">LatLonPoint</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mAMap <span class="token operator">=</span> amap<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>walkPath <span class="token operator">=</span> path<span class="token punctuation">;</span>
		startPoint <span class="token operator">=</span> <span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
		endPoint <span class="token operator">=</span> <span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 添加步行路线到地图中。
	 * @since V2.1.0
	 */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> walkPaths <span class="token operator">=</span> walkPath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> walkPaths<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">WalkStep</span> walkStep <span class="token operator">=</span> walkPaths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">LatLng</span> latLng <span class="token operator">=</span> <span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>walkStep
                        <span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
				<span class="token function">addWalkStationMarkers</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">,</span> latLng<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addWalkPolyLines</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
               
            <span class="token punctuation">}</span>
            <span class="token function">addStartAndEndMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	
	<span class="token comment">/**
	 * 检查这一步的最后一点和下一步的起始点之间是否存在空隙
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkDistanceToNextStep</span><span class="token punctuation">(</span><span class="token class-name">WalkStep</span> walkStep<span class="token punctuation">,</span>
			<span class="token class-name">WalkStep</span> walkStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> lastPoint <span class="token operator">=</span> <span class="token function">getLastWalkPoint</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> nextFirstPoint <span class="token operator">=</span> <span class="token function">getFirstWalkPoint</span><span class="token punctuation">(</span>walkStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>lastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>nextFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLine</span><span class="token punctuation">(</span>lastPoint<span class="token punctuation">,</span> nextFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param walkStep
	 * @return
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getLastWalkPoint</span><span class="token punctuation">(</span><span class="token class-name">WalkStep</span> walkStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param walkStep
	 * @return
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getFirstWalkPoint</span><span class="token punctuation">(</span><span class="token class-name">WalkStep</span> walkStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyLine</span><span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> pointFrom<span class="token punctuation">,</span> <span class="token class-name">LatLonPoint</span> pointTo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">addWalkPolyLine</span><span class="token punctuation">(</span><span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>pointFrom<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>pointTo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyLine</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLngFrom<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> latLngTo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mPolylineOptions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latLngFrom<span class="token punctuation">,</span> latLngTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param walkStep
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyLines</span><span class="token punctuation">(</span><span class="token class-name">WalkStep</span> walkStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mPolylineOptions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">AMapServicesUtil</span><span class="token punctuation">.</span><span class="token function">convertArrList</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param walkStep
     * @param position
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkStationMarkers</span><span class="token punctuation">(</span><span class="token class-name">WalkStep</span> walkStep<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u65B9\u5411:"</span> <span class="token operator">+</span> walkStep<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">"\n\u9053\u8DEF:"</span> <span class="token operator">+</span> walkStep<span class="token punctuation">.</span><span class="token function">getRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span>walkStationDescriptor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化线段属性
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>walkStationDescriptor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            walkStationDescriptor <span class="token operator">=</span> <span class="token function">getWalkBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptions<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getWalkColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">addPolyLine</span><span class="token punctuation">(</span>mPolylineOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>这里面有一些图标你应该没有，我贴一下：</p> 
<p><img src="https://images2.imgbox.com/be/89/mVFmP6Py_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5a/a9/r1vhHJG6_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/7a/a3/MxC7RfwR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/24/73/rMAP29DX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e5/0c/GWbHKp4F_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/a7/gKoDMBNQ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6b/a2/ApdGLB98_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/5a/hADEKrln_o.png" alt="在这里插入图片描述"><br> 最好去我的源码里去拿，因为这样你就不用手动去命名了。</p> 
<p>  下面你的这三个类应该是不会报错了，OK，回到RouteActivity中，修改onWalkRouteSearched方法，代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 步行规划路径结果
     *
     * @param walkRouteResult 结果
     * @param code            结果码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onWalkRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">WalkRouteResult</span> walkRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        aMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清理地图上的所有覆盖物</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token class-name">AMapException</span><span class="token punctuation">.</span><span class="token constant">CODE_AMAP_SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"错误码；"</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>walkRouteResult <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> walkRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>walkRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">WalkPath</span> walkPath <span class="token operator">=</span> walkRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>walkPath <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//绘制路线</span>
        <span class="token class-name">WalkRouteOverlay</span> walkRouteOverlay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WalkRouteOverlay</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">,</span> aMap<span class="token punctuation">,</span> walkPath<span class="token punctuation">,</span>
                walkRouteResult<span class="token punctuation">.</span><span class="token function">getStartPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                walkRouteResult<span class="token punctuation">.</span><span class="token function">getTargetPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        walkRouteOverlay<span class="token punctuation">.</span><span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        walkRouteOverlay<span class="token punctuation">.</span><span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        walkRouteOverlay<span class="token punctuation">.</span><span class="token function">zoomToSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> dis <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> walkPath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dur <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> walkPath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> des <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> des<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  返回结果时，先清空地图，然后判断是否搜索成功，否的话调用showMsg方法提示一下，然后判断返回值是否为空，之后判断返回的路径是否大于0，大于的话则就可以开始绘制路线了，绘制完之后清空原来的，然后添加新的图层到地图上，然后进行缩放，之后就是一些其他信息的打印了。写了这么久代码了，也该运行一下了。</p> 
<p><img src="https://images2.imgbox.com/fa/74/haC0PKiP_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__2749"></a>③ 骑行路线规划</h4> 
<p>  骑行其实和步行差不多，只是路线限制时图层不同而已，其他的都类似，写起来也是比较简单的，不过我们的布局要做一下改变，假如我把骑行也就入到<code>RouteActivity</code>中，那么在一个地图上就有两种出行方式了，因此需要方便用户来切换不同的方式才行。因此我们打开<code>activity_route.xml</code><br> ，修改后的代码如下：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.RouteActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>出行方式：<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16sp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/spinner<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Spinner</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/spinner<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!--地图--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.amap.api.maps.MapView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/map_view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/spinner<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>  一目了然，很简单的布局代码，首先将外部布局修改为相对布局，然后添加一个TextView，里面添加一个下来选择控件，用于切换不同的出行方式，然后修改一下地图控件，使它置于刚才所添加的顶部布局的下方。</p> 
<p>布局修改好了，进入到<code>RouteActivity</code>中，先创建三个成员变量，如下所示：</p> 
<pre><code class="prism language-java">	<span class="token comment">//出行方式数组</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> travelModeArray <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"步行出行"</span><span class="token punctuation">,</span> <span class="token string">"骑行出行"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//出行方式值</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token constant">TRAVEL_MODE</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//数组适配器</span>
    <span class="token keyword">private</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arrayAdapter<span class="token punctuation">;</span>
</code></pre> 
<p>  这里我们就指定了出现方式的种类，目前三种，后面些其他方式可以再加，然后就是方式值，当我们点击下拉框选择类型之后，通过位置赋值给这个TRAVEL_MODE 变量，然后我们在路线规划的方法中去根据这个值进行不同的路线搜索即可。最后一个是用来配置下拉框数据的。</p> 
<p>下面新建一个initTravelMode方法用于初始化出行方式的数据，代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 初始化出行方式
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initTravelMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Spinner</span> spinner <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>spinner<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//将可选内容与ArrayAdapter连接起来</span>
        arrayAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayAdapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_spinner_item<span class="token punctuation">,</span> travelModeArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置下拉列表的风格</span>
        arrayAdapter<span class="token punctuation">.</span><span class="token function">setDropDownViewResource</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>simple_spinner_dropdown_item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将adapter 添加到spinner中</span>
        spinner<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>arrayAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加事件Spinner事件监听</span>
        spinner<span class="token punctuation">.</span><span class="token function">setOnItemSelectedListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AdapterView<span class="token punctuation">.</span>OnItemSelectedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onItemSelected</span><span class="token punctuation">(</span><span class="token class-name">AdapterView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">,</span> <span class="token class-name">View</span> view<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token constant">TRAVEL_MODE</span> <span class="token operator">=</span> position<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNothingSelected</span><span class="token punctuation">(</span><span class="token class-name">AdapterView</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> parent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后别忘了在<code>onCreate()</code>方法中调用。</p> 
<p><img src="https://images2.imgbox.com/bd/fe/6omGuNKS_o.png" alt="在这里插入图片描述"></p> 
<p>然后在<code>startRouteSearch()</code>方法中，进行出行方式的判断，代码如下：</p> 
<pre><code class="prism language-java">		<span class="token comment">//出行方式判断</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token constant">TRAVEL_MODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>步行
                <span class="token comment">//构建步行路线搜索对象</span>
                <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkRouteQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkDefault</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 异步路径规划步行模式查询</span>
                routeSearch<span class="token punctuation">.</span><span class="token function">calculateWalkRouteAsyn</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>骑行
                <span class="token comment">//构建骑行路线搜索对象</span>
                <span class="token class-name">RouteSearch<span class="token punctuation">.</span>RideRouteQuery</span> rideQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>RideRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkDefault</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//骑行规划路径计算</span>
                routeSearch<span class="token punctuation">.</span><span class="token function">calculateRideRouteAsyn</span><span class="token punctuation">(</span>rideQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/67/e1/Xo5AspRe_o.png" alt="在这里插入图片描述"></p> 
<p>  然后就是回调了，之前我们写了步行的回调，下面就是骑行的回调，因此有一些东西需要加进来才行，下面先做这一步操作，首先是修改原来的<code>MapUtil</code>工具类，在里面新增一个方法，代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 把集合体的LatLonPoint转化为集合体的LatLng
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> <span class="token function">convertArrList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> lineShapes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> point <span class="token operator">:</span> shapes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">LatLng</span> latLngTemp <span class="token operator">=</span> <span class="token function">convertToLatLng</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
            lineShapes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latLngTemp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> lineShapes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  然后在overlay包下，新增一个RideRouteOverlay类，用于在地图上绘制骑行的图层，里面的代码如下：（这个代码是源码里面有的）</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptorFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MarkerOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolylineOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RidePath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RideStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 骑行路线图层类。在高德地图API里，如果要显示步行路线规划，可以用此类来创建骑行路线图层。如不满足需求，也可以自己创建自定义的骑行路线图层。
 * @since V3.5.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RideRouteOverlay</span> <span class="token keyword">extends</span> <span class="token class-name">RouteOverlay</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">PolylineOptions</span> mPolylineOptions<span class="token punctuation">;</span>
	
	<span class="token keyword">private</span> <span class="token class-name">BitmapDescriptor</span> walkStationDescriptor<span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">RidePath</span> ridePath<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 通过此构造函数创建骑行路线图层。
	 * @param context 当前activity。
	 * @param amap 地图对象。
	 * @param path 骑行路线规划的一个方案。详见搜索服务模块的路径查询包（com.amap.api.services.route）中的类 &lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/route/WalkStep.html" title="com.amap.api.services.route中的类"&gt;WalkStep&lt;/a&gt;&lt;/strong&gt;。
	 * @param start 起点。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类&lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @param end 终点。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类&lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @since V3.5.0
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">RideRouteOverlay</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AMap</span> amap<span class="token punctuation">,</span> <span class="token class-name">RidePath</span> path<span class="token punctuation">,</span>
                            <span class="token class-name">LatLonPoint</span> start<span class="token punctuation">,</span> <span class="token class-name">LatLonPoint</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mAMap <span class="token operator">=</span> amap<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>ridePath <span class="token operator">=</span> path<span class="token punctuation">;</span>
		startPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
		endPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 添加骑行路线到地图中。
	 * @since V3.5.0
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RideStep</span><span class="token punctuation">&gt;</span></span> ridePaths <span class="token operator">=</span> ridePath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ridePaths<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">RideStep</span> rideStep <span class="token operator">=</span> ridePaths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">LatLng</span> latLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>rideStep
						<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				<span class="token function">addRideStationMarkers</span><span class="token punctuation">(</span>rideStep<span class="token punctuation">,</span> latLng<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">addRidePolyLines</span><span class="token punctuation">(</span>rideStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token function">addStartAndEndMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>


	<span class="token comment">/**
	 * @param rideStep
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRidePolyLines</span><span class="token punctuation">(</span><span class="token class-name">RideStep</span> rideStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		mPolylineOptions<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertArrList</span><span class="token punctuation">(</span>rideStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * @param rideStep
	 * @param position
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRideStationMarkers</span><span class="token punctuation">(</span><span class="token class-name">RideStep</span> rideStep<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u65B9\u5411:"</span> <span class="token operator">+</span> rideStep<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token operator">+</span> <span class="token string">"\n\u9053\u8DEF:"</span> <span class="token operator">+</span> rideStep<span class="token punctuation">.</span><span class="token function">getRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>rideStep<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span>walkStationDescriptor<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	 <span class="token comment">/**
     * 初始化线段属性
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	
    	<span class="token keyword">if</span><span class="token punctuation">(</span>walkStationDescriptor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    		walkStationDescriptor <span class="token operator">=</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_ride<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptions<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token function">addPolyLine</span><span class="token punctuation">(</span>mPolylineOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>  下面回到<code>RouteActivity</code>中，找到<code>onRideRouteSearched()</code>方法，这是骑行的搜索路线回调方法，修改代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 骑行规划路径结果
     *
     * @param rideRouteResult 结果
     * @param code            结果码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRideRouteSearched</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RideRouteResult</span> rideRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        aMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清理地图上的所有覆盖物</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token class-name">AMapException</span><span class="token punctuation">.</span><span class="token constant">CODE_AMAP_SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"错误码；"</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rideRouteResult <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> rideRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rideRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">RidePath</span> ridePath <span class="token operator">=</span> rideRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ridePath <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">RideRouteOverlay</span> rideRouteOverlay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RideRouteOverlay</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">,</span> aMap<span class="token punctuation">,</span> ridePath<span class="token punctuation">,</span>
                rideRouteResult<span class="token punctuation">.</span><span class="token function">getStartPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                rideRouteResult<span class="token punctuation">.</span><span class="token function">getTargetPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rideRouteOverlay<span class="token punctuation">.</span><span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rideRouteOverlay<span class="token punctuation">.</span><span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rideRouteOverlay<span class="token punctuation">.</span><span class="token function">zoomToSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> dis <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ridePath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dur <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ridePath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> des <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> des<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>  很熟悉的代码吧，和步行的基本没有什么两样，只是里面使用的值不同而已。那么到这里你的代码就写完了，我们来运行一下吧。</p> 
<p><img src="https://images2.imgbox.com/89/dd/euHUnW3Q_o.gif" alt="在这里插入图片描述"><br> 这样就完成了骑行的路线规划了。</p> 
<h4><a id="__3049"></a>④ 驾车路线规划</h4> 
<p>  现在来写这个驾车路线规划，步骤还是和前面的差不多，这回你都不用改布局了，在<code>RouteActivity</code>中修改<code>travelModeArray</code>的变量值，</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> travelModeArray <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"步行出行"</span><span class="token punctuation">,</span> <span class="token string">"骑行出行"</span><span class="token punctuation">,</span> <span class="token string">"驾车出行"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>如下所示。</p> 
<p><img src="https://images2.imgbox.com/5b/69/HUex9oWp_o.png" alt="在这里插入图片描述"></p> 
<p>然后找到<code>startRouteSearch()</code>方法，加一个驾车的条件分支</p> 
<pre><code class="prism language-java">			<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>驾车
                <span class="token comment">//构建驾车路线搜索对象  剩余三个参数分别是：途经点、避让区域、避让道路</span>
                <span class="token class-name">RouteSearch<span class="token punctuation">.</span>DriveRouteQuery</span> driveQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>DriveRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>WalkDefault</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//驾车规划路径计算</span>
                routeSearch<span class="token punctuation">.</span><span class="token function">calculateDriveRouteAsyn</span><span class="token punctuation">(</span>driveQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/76/de/ANGkQIaV_o.png" alt="在这里插入图片描述"></p> 
<p>  然后同样要有一个图层。在<code>overlay</code>包下新增<code>DrivingRouteOverlay</code>类，用于在地图上绘制驾车路线图层，代码如下：（SDK中代码）</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">Color</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptorFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLngBounds</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">Marker</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MarkerOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolylineOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">DrivePath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">DriveStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">TMC</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>


<span class="token comment">/**
 * 驾车路线图层类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DrivingRouteOverlay</span> <span class="token keyword">extends</span> <span class="token class-name">RouteOverlay</span><span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">DrivePath</span> drivePath<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> throughPointList<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">&gt;</span></span> throughPointMarkerList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Marker</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> throughPointMarkerVisible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>TMC<span class="token punctuation">&gt;</span></span> tmcs<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PolylineOptions</span> mPolylineOptions<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">PolylineOptions</span> mPolylineOptionscolor<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isColorfulline <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> mWidth <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> mLatLngsOfPath<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setIsColorfulline</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> iscolorfulline<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>isColorfulline <span class="token operator">=</span> iscolorfulline<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
     * 根据给定的参数，构造一个导航路线图层类对象。
     *
     * @param amap      地图对象。
     * @param path 导航路线规划方案。
     * @param context   当前的activity对象。
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DrivingRouteOverlay</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AMap</span> amap<span class="token punctuation">,</span> <span class="token class-name">DrivePath</span> path<span class="token punctuation">,</span>
                               <span class="token class-name">LatLonPoint</span> start<span class="token punctuation">,</span> <span class="token class-name">LatLonPoint</span> end<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> throughPointList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	mContext <span class="token operator">=</span> context<span class="token punctuation">;</span> 
        mAMap <span class="token operator">=</span> amap<span class="token punctuation">;</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>drivePath <span class="token operator">=</span> path<span class="token punctuation">;</span>
        startPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        endPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList <span class="token operator">=</span> throughPointList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置路线宽度
     *
     * @param mWidth 路线宽度，取值范围：大于0
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRouteWidth</span><span class="token punctuation">(</span><span class="token keyword">float</span> mWidth<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mWidth <span class="token operator">=</span> mWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加驾车路线添加到地图上显示。
     */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mAMap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mWidth <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> drivePath <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mLatLngsOfPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tmcs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>TMC<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DriveStep</span><span class="token punctuation">&gt;</span></span> drivePaths <span class="token operator">=</span> drivePath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DriveStep</span> step <span class="token operator">:</span> drivePaths<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> latlonPoints <span class="token operator">=</span> step<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>TMC<span class="token punctuation">&gt;</span></span> tmclist <span class="token operator">=</span> step<span class="token punctuation">.</span><span class="token function">getTMCs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tmcs<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>tmclist<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addDrivingStationMarkers</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> <span class="token function">convertToLatLng</span><span class="token punctuation">(</span>latlonPoints<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> latlonpoint <span class="token operator">:</span> latlonPoints<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                	mPolylineOptions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>latlonpoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                	mLatLngsOfPath<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>latlonpoint<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>startMarker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                startMarker<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                startMarker <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>endMarker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                endMarker<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                endMarker <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">addStartAndEndMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">addThroughPointMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isColorfulline <span class="token operator">&amp;&amp;</span> tmcs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            	<span class="token function">colorWayUpdate</span><span class="token punctuation">(</span>tmcs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            	<span class="token function">showcolorPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>            
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

	<span class="token comment">/**
     * 初始化线段属性
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initPolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        mPolylineOptions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptions<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">addPolyLine</span><span class="token punctuation">(</span>mPolylineOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">showcolorPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token function">addPolyLine</span><span class="token punctuation">(</span>mPolylineOptionscolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>

    <span class="token comment">/**
     * 根据不同的路段拥堵情况展示不同的颜色
     *
     * @param tmcSection
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">colorWayUpdate</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>TMC<span class="token punctuation">&gt;</span></span> tmcSection<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAMap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tmcSection <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> tmcSection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">TMC</span> segmentTrafficStatus<span class="token punctuation">;</span>
        mPolylineOptionscolor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        mPolylineOptionscolor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptionscolor<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> colorList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptionscolor<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>tmcSection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        colorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> tmcSection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        	segmentTrafficStatus <span class="token operator">=</span> tmcSection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token keyword">int</span> color <span class="token operator">=</span> <span class="token function">getcolor</span><span class="token punctuation">(</span>segmentTrafficStatus<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> mployline <span class="token operator">=</span> segmentTrafficStatus<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> mployline<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				mPolylineOptionscolor<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>mployline<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				colorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
        colorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPolylineOptionscolor<span class="token punctuation">.</span><span class="token function">colorValues</span><span class="token punctuation">(</span>colorList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">getcolor</span><span class="token punctuation">(</span><span class="token class-name">String</span> status<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    	<span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"畅通"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    		<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">GREEN</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"缓行"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			 <span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">YELLOW</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"拥堵"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token constant">RED</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"严重拥堵"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#990033"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#537edc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>	
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">LatLng</span> <span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> point<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>point<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * @param driveStep
     * @param latLng
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addDrivingStationMarkers</span><span class="token punctuation">(</span><span class="token class-name">DriveStep</span> driveStep<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> latLng<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>latLng<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u65B9\u5411:"</span> <span class="token operator">+</span> driveStep<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">"\n\u9053\u8DEF:"</span> <span class="token operator">+</span> driveStep<span class="token punctuation">.</span><span class="token function">getRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>driveStep<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getDriveBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">LatLngBounds</span> <span class="token function">getLatLngBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LatLngBounds<span class="token punctuation">.</span>Builder</span> b <span class="token operator">=</span> <span class="token class-name">LatLngBounds</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        b<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>startPoint<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> startPoint<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        b<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>endPoint<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> endPoint<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                b<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setThroughPointIconVisibility</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> visible<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            throughPointMarkerVisible <span class="token operator">=</span> visible<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList <span class="token operator">!=</span> <span class="token keyword">null</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addThroughPointMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">LatLonPoint</span> latLonPoint <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                latLonPoint <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>latLonPoint <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    throughPointMarkerList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>mAMap
                            <span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>
                                            <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span>latLonPoint
                                                    <span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> latLonPoint
                                                    <span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>throughPointMarkerVisible<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getThroughPointBitDes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"\u9014\u7ECF\u70B9"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token class-name">BitmapDescriptor</span> <span class="token function">getThroughPointBitDes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">return</span> <span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token function">fromResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>amap_through<span class="token punctuation">)</span><span class="token punctuation">;</span>
       
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取两点间距离
     *
     * @param start
     * @param end
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calculateDistance</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> start<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> x1 <span class="token operator">=</span> start<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>
        <span class="token keyword">double</span> y1 <span class="token operator">=</span> start<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
        <span class="token keyword">double</span> x2 <span class="token operator">=</span> end<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>
        <span class="token keyword">double</span> y2 <span class="token operator">=</span> end<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">calculateDistance</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">calculateDistance</span><span class="token punctuation">(</span><span class="token keyword">double</span> x1<span class="token punctuation">,</span> <span class="token keyword">double</span> y1<span class="token punctuation">,</span> <span class="token keyword">double</span> x2<span class="token punctuation">,</span> <span class="token keyword">double</span> y2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token class-name">NF_pi</span> <span class="token operator">=</span> <span class="token number">0.01745329251994329</span><span class="token punctuation">;</span> <span class="token comment">// 弧度 PI/180</span>
        x1 <span class="token operator">*=</span> <span class="token class-name">NF_pi</span><span class="token punctuation">;</span>
        y1 <span class="token operator">*=</span> <span class="token class-name">NF_pi</span><span class="token punctuation">;</span>
        x2 <span class="token operator">*=</span> <span class="token class-name">NF_pi</span><span class="token punctuation">;</span>
        y2 <span class="token operator">*=</span> <span class="token class-name">NF_pi</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> sinx1 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> siny1 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> cosx1 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> cosy1 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> sinx2 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> siny2 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> cosx2 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>x2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> cosy2 <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> v1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> cosy1 <span class="token operator">*</span> cosx1 <span class="token operator">-</span> cosy2 <span class="token operator">*</span> cosx2<span class="token punctuation">;</span>
        v1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cosy1 <span class="token operator">*</span> sinx1 <span class="token operator">-</span> cosy2 <span class="token operator">*</span> sinx2<span class="token punctuation">;</span>
        v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> siny1 <span class="token operator">-</span> siny2<span class="token punctuation">;</span>
        <span class="token keyword">double</span> dist <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> v1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> v1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">asin</span><span class="token punctuation">(</span>dist <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">12742001.5798544</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//获取指定两点之间固定距离点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LatLng</span> <span class="token function">getPointForDis</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> sPt<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> ePt<span class="token punctuation">,</span> <span class="token keyword">double</span> dis<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">double</span> lSegLength <span class="token operator">=</span> <span class="token function">calculateDistance</span><span class="token punctuation">(</span>sPt<span class="token punctuation">,</span> ePt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> preResult <span class="token operator">=</span> dis <span class="token operator">/</span> lSegLength<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LatLng</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ePt<span class="token punctuation">.</span>latitude <span class="token operator">-</span> sPt<span class="token punctuation">.</span>latitude<span class="token punctuation">)</span> <span class="token operator">*</span> preResult <span class="token operator">+</span> sPt<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> <span class="token punctuation">(</span>ePt<span class="token punctuation">.</span>longitude <span class="token operator">-</span> sPt<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span> <span class="token operator">*</span> preResult <span class="token operator">+</span> sPt<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 去掉DriveLineOverlay上的线段和标记。
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList <span class="token operator">!=</span> <span class="token keyword">null</span>
                    <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>throughPointMarkerList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  然后回到<code>RouteActivity</code>中，找到<code>onDriveRouteSearched</code>方法，里面的代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 驾车规划路径结果
     *
     * @param driveRouteResult 结果
     * @param code            结果码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDriveRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">DriveRouteResult</span> driveRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        aMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清理地图上的所有覆盖物</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token class-name">AMapException</span><span class="token punctuation">.</span><span class="token constant">CODE_AMAP_SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"错误码；"</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>driveRouteResult <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> driveRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>driveRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">DrivePath</span> drivePath <span class="token operator">=</span> driveRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>drivePath <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 绘制路线</span>
        <span class="token class-name">DrivingRouteOverlay</span> drivingRouteOverlay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DrivingRouteOverlay</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">,</span> aMap<span class="token punctuation">,</span> drivePath<span class="token punctuation">,</span>
                driveRouteResult<span class="token punctuation">.</span><span class="token function">getStartPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                driveRouteResult<span class="token punctuation">.</span><span class="token function">getTargetPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        drivingRouteOverlay<span class="token punctuation">.</span><span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        drivingRouteOverlay<span class="token punctuation">.</span><span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        drivingRouteOverlay<span class="token punctuation">.</span><span class="token function">zoomToSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> dis <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> drivePath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dur <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> drivePath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> des <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> des<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>下面运行一下：</p> 
<p><img src="https://images2.imgbox.com/44/9c/37vGAGwK_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__3454"></a>⑤ 公交路线规划</h4> 
<p>  还有一个公交路线规划，公交的规划其实还包括了步行，不过步行是一点点。打开<code>RouteActivity</code>，修改<code>travelModeArray</code>里面的值，增加一个出行方式。</p> 
<p><img src="https://images2.imgbox.com/a4/c8/lvT8wPRz_o.png" alt="在这里插入图片描述"></p> 
<p>然后找到<code>startRouteSearch()</code>方法，增加如下case：</p> 
<pre><code class="prism language-java">			<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>公交
                <span class="token comment">//构建驾车路线搜索对象 第三个参数表示公交查询城市区号，第四个参数表示是否计算夜班车，0表示不计算,1表示计算</span>
                <span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusRouteQuery</span> busQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusLeaseWalk</span><span class="token punctuation">,</span> <span class="token string">"0755"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//公交规划路径计算</span>
                routeSearch<span class="token punctuation">.</span><span class="token function">calculateBusRouteAsyn</span><span class="token punctuation">(</span>busQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre> 
<p>  这里注意一点，那就是城市的区号，这里我填的是0755，表示深圳。你可以通过<a href="https://www.matools.com/postcode" rel="nofollow">城市区号查询</a>去查看你所在地的城市区号，当然如果你不想去查询也可以，你可以直接用中文来解决，比如把0755改成深圳，也是可以的。如果你觉得这样也比较麻烦的话，那么你可以定义一个成员变量。</p> 
<pre><code class="prism language-java">	<span class="token comment">//城市</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
</code></pre> 
<p>然后在<code>onLocationChanged()</code>中赋值。</p> 
<pre><code class="prism language-java">	city <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/c3/a7/0HaIg3tf_o.png" alt="在这里插入图片描述"></p> 
<p>最后在替换，这样的话就会以你当前所在城市为准。</p> 
<pre><code class="prism language-java">	<span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusRouteQuery</span> busQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusRouteQuery</span><span class="token punctuation">(</span>fromAndTo<span class="token punctuation">,</span> <span class="token class-name">RouteSearch<span class="token punctuation">.</span>BusLeaseWalk</span><span class="token punctuation">,</span> city<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如下图所示：<br> <img src="https://images2.imgbox.com/8b/01/WElB2VYN_o.png" alt="在这里插入图片描述"></p> 
<p>那么下面同样要绘制公交的图层，在<code>overlay</code>包下新建一个<code>BusRouteOverlay</code>类，代码如下：（来源于SDK）</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>overlay</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span></span><span class="token class-name">AMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">LatLng</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MarkerOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolylineOptions</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>busline<span class="token punctuation">.</span></span><span class="token class-name">BusStationItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">LatLonPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">BusPath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">BusStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">Doorway</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RailwayStationItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RouteBusLineItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RouteBusWalkItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RouteRailwayItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">TaxiItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">WalkStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 公交路线图层类。在高德地图API里，如果需要显示公交路线，可以用此类来创建公交路线图层。如不满足需求，也可以自己创建自定义的公交路线图层。
 * @since V2.1.0
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusRouteOverlay</span> <span class="token keyword">extends</span> <span class="token class-name">RouteOverlay</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token class-name">BusPath</span> busPath<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">LatLng</span> latLng<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 通过此构造函数创建公交路线图层。
	 * @param context 当前activity。
	 * @param amap 地图对象。
	 * @param path 公交路径规划的一个路段。详见搜索服务模块的路径查询包（com.amap.api.services.route）中的类&lt;strong&gt; &lt;a href="../../../../../../Search/com/amap/api/services/route/BusPath.html" title="com.amap.api.services.route中的类"&gt;BusPath&lt;/a&gt;&lt;/strong&gt;。
	 * @param start 起点坐标。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类 &lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @param end 终点坐标。详见搜索服务模块的核心基础包（com.amap.api.services.core）中的类 &lt;strong&gt;&lt;a href="../../../../../../Search/com/amap/api/services/core/LatLonPoint.html" title="com.amap.api.services.core中的类"&gt;LatLonPoint&lt;/a&gt;&lt;/strong&gt;。
	 * @since V2.1.0
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">BusRouteOverlay</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AMap</span> amap<span class="token punctuation">,</span> <span class="token class-name">BusPath</span> path<span class="token punctuation">,</span>
                           <span class="token class-name">LatLonPoint</span> start<span class="token punctuation">,</span> <span class="token class-name">LatLonPoint</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>busPath <span class="token operator">=</span> path<span class="token punctuation">;</span>
		startPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
		endPoint <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mAMap <span class="token operator">=</span> amap<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 添加公交路线到地图上。
	 * @since V2.1.0
	 */</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">/**
		 * 绘制节点和线&lt;br&gt;
		 * 细节情况较多&lt;br&gt;
		 * 两个step之间，用step和step1区分&lt;br&gt;
		 * 1.一个step内可能有步行和公交，然后有可能他们之间连接有断开&lt;br&gt;
		 * 2.step的公交和step1的步行，有可能连接有断开&lt;br&gt;
		 * 3.step和step1之间是公交换乘，且没有步行，需要把step的终点和step1的起点连起来&lt;br&gt;
		 * 4.公交最后一站和终点间有步行，加入步行线路，还会有一些步行marker&lt;br&gt;
		 * 5.公交最后一站和终点间无步行，之间连起来&lt;br&gt;
		 */</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BusStep</span><span class="token punctuation">&gt;</span></span> busSteps <span class="token operator">=</span> busPath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> busSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">BusStep</span> busStep <span class="token operator">=</span> busSteps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> busSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token class-name">BusStep</span> busStep1 <span class="token operator">=</span> busSteps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取得当前下一个BusStep对象</span>
					<span class="token comment">// 假如步行和公交之间连接有断开，就把步行最后一个经纬度点和公交第一个经纬度点连接起来，避免断线问题</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkWalkToBusline</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// 假如公交和步行之间连接有断开，就把上一公交经纬度点和下一步行第一个经纬度点连接起来，避免断线问题</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> 
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkBusLineToNextWalk</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 假如两个公交换乘中间没有步行，就把上一公交经纬度点和下一步公交第一个经纬度点连接起来，避免断线问题</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkBusEndToNextBusStart</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 和上面的很类似</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkBusToNextBusNoWalk</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> busStep1<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkBusLineToNextRailway</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
							busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
							busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkRailwayToNextWalk</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					
					<span class="token keyword">if</span> <span class="token punctuation">(</span> busStep1<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
							busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">checkRailwayToNextRailway</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> 
						busStep1<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
						<span class="token function">checkRailwayToNextTaxi</span><span class="token punctuation">(</span>busStep<span class="token punctuation">,</span> busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					

				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span>
						<span class="token operator">&amp;&amp;</span> busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">addWalkSteps</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> busStep<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span>latLng<span class="token punctuation">,</span> endPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token class-name">RouteBusLineItem</span> routeBusLineItem <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">addBusLineSteps</span><span class="token punctuation">(</span>routeBusLineItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">addBusStationMarkers</span><span class="token punctuation">(</span>routeBusLineItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> busSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> endPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">addRailwayStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">addRailwayMarkers</span><span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> busSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> endPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">addTaxiStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">addTaxiMarkers</span><span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token function">addStartAndEndMarker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>



	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkRailwayToNextTaxi</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> railwayLastPoint <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> taxiFirstPoint <span class="token operator">=</span> busStep1<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>railwayLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>taxiFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>railwayLastPoint<span class="token punctuation">,</span> taxiFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkRailwayToNextRailway</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> railwayLastPoint <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> railwayFirstPoint <span class="token operator">=</span> busStep1<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>railwayLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>railwayFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>railwayLastPoint<span class="token punctuation">,</span> railwayFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkBusLineToNextRailway</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> busLastPoint <span class="token operator">=</span> <span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> railwayFirstPoint <span class="token operator">=</span> busStep1<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>busLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>railwayFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>busLastPoint<span class="token punctuation">,</span> railwayFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkRailwayToNextWalk</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> railwayLastPoint <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> walkFirstPoint <span class="token operator">=</span> <span class="token function">getFirstWalkPoint</span><span class="token punctuation">(</span>busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>railwayLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>walkFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>railwayLastPoint<span class="token punctuation">,</span> walkFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRailwayStep</span><span class="token punctuation">(</span><span class="token class-name">RouteRailwayItem</span> railway<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> railwaylistpoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RailwayStationItem</span><span class="token punctuation">&gt;</span></span> railwayStationItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RailwayStationItem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		railwayStationItems<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>railway<span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		railwayStationItems<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>railway<span class="token punctuation">.</span><span class="token function">getViastops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		railwayStationItems<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>railway<span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> railwayStationItems<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			railwaylistpoint<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>railwayStationItems<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">addRailwayPolyline</span><span class="token punctuation">(</span>railwaylistpoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addTaxiStep</span><span class="token punctuation">(</span><span class="token class-name">TaxiItem</span> taxi<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getBusColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>taxi<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>taxi<span class="token punctuation">.</span><span class="token function">getDestination</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param busStep
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkSteps</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">RouteBusWalkItem</span> routeBusWalkItem <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> walkSteps <span class="token operator">=</span> routeBusWalkItem<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> walkSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">WalkStep</span> walkStep <span class="token operator">=</span> walkSteps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">LatLng</span> latLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>walkStep
						<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">String</span> road <span class="token operator">=</span> walkStep<span class="token punctuation">.</span><span class="token function">getRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 道路名字</span>
				<span class="token class-name">String</span> instruction <span class="token operator">=</span> <span class="token function">getWalkSnippet</span><span class="token punctuation">(</span>walkSteps<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 步行导航信息</span>
				<span class="token function">addWalkStationMarkers</span><span class="token punctuation">(</span>latLng<span class="token punctuation">,</span> road<span class="token punctuation">,</span> instruction<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> listWalkPolyline <span class="token operator">=</span> <span class="token class-name">MapUtil</span>
					<span class="token punctuation">.</span><span class="token function">convertArrList</span><span class="token punctuation">(</span>walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>latLng <span class="token operator">=</span> listWalkPolyline<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>listWalkPolyline<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span>listWalkPolyline<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 假如步行前一段的终点和下的起点有断开，断画直线连接起来，避免断线问题</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> walkSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token class-name">LatLng</span> lastLatLng <span class="token operator">=</span> listWalkPolyline<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>listWalkPolyline
						<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">LatLng</span> firstlatLatLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span>
						<span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>walkSteps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
								<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>lastLatLng<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>firstlatLatLng<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span>lastLatLng<span class="token punctuation">,</span> firstlatLatLng<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 添加一系列的bus PolyLine
	 *
	 * @param routeBusLineItem
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addBusLineSteps</span><span class="token punctuation">(</span><span class="token class-name">RouteBusLineItem</span> routeBusLineItem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">addBusLineSteps</span><span class="token punctuation">(</span>routeBusLineItem<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addBusLineSteps</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> listPoints<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>listPoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getBusColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertArrList</span><span class="token punctuation">(</span>listPoints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param latLng
	 *            marker
	 * @param title
	 * @param snippet
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkStationMarkers</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLng<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span>
                                       <span class="token class-name">String</span> snippet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>latLng<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>snippet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getWalkBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param routeBusLineItem
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addBusStationMarkers</span><span class="token punctuation">(</span><span class="token class-name">RouteBusLineItem</span> routeBusLineItem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">BusStationItem</span> startBusStation <span class="token operator">=</span> routeBusLineItem
				<span class="token punctuation">.</span><span class="token function">getDepartureBusStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLng</span> position <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>startBusStation
				<span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> title <span class="token operator">=</span> routeBusLineItem<span class="token punctuation">.</span><span class="token function">getBusLineName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> snippet <span class="token operator">=</span> <span class="token function">getBusSnippet</span><span class="token punctuation">(</span>routeBusLineItem<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>snippet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getBusBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addTaxiMarkers</span><span class="token punctuation">(</span><span class="token class-name">TaxiItem</span> taxiItem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		
		<span class="token class-name">LatLng</span> position <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>taxiItem
				<span class="token punctuation">.</span><span class="token function">getOrigin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> title <span class="token operator">=</span> taxiItem<span class="token punctuation">.</span><span class="token function">getmSname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"打车"</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> snippet <span class="token operator">=</span> <span class="token string">"到终点"</span><span class="token punctuation">;</span>

		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span>snippet<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getDriveBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRailwayMarkers</span><span class="token punctuation">(</span><span class="token class-name">RouteRailwayItem</span> railway<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLng</span> <span class="token class-name">Departureposition</span> <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>railway
				<span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> <span class="token class-name">Departuretitle</span> <span class="token operator">=</span> railway<span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"上车"</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> <span class="token class-name">Departuresnippet</span> <span class="token operator">=</span> railway<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token class-name">Departureposition</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token class-name">Departuretitle</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token class-name">Departuresnippet</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getBusBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		
		<span class="token class-name">LatLng</span> <span class="token class-name">Arrivalposition</span> <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>railway
				<span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> <span class="token class-name">Arrivaltitle</span> <span class="token operator">=</span> railway<span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"下车"</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> <span class="token class-name">Arrivalsnippet</span> <span class="token operator">=</span> railway<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">addStationMarker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MarkerOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">position</span><span class="token punctuation">(</span><span class="token class-name">Arrivalposition</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token class-name">Arrivaltitle</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">snippet</span><span class="token punctuation">(</span><span class="token class-name">Arrivalsnippet</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">anchor</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">visible</span><span class="token punctuation">(</span>nodeIconVisible<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">icon</span><span class="token punctuation">(</span><span class="token function">getBusBitmapDescriptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 如果换乘没有步行 检查bus最后一点和下一个step的bus起点是否一致
	 *
	 * @param busStep
	 * @param busStep1
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkBusToNextBusNoWalk</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLng</span> endbusLatLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span>
				<span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLng</span> startbusLatLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span>
				<span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span><span class="token function">getFirstBuslinePoint</span><span class="token punctuation">(</span>busStep1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>startbusLatLng<span class="token punctuation">.</span>latitude <span class="token operator">-</span> endbusLatLng<span class="token punctuation">.</span>latitude <span class="token operator">&gt;</span> <span class="token number">0.0001</span>
				<span class="token operator">||</span> startbusLatLng<span class="token punctuation">.</span>longitude <span class="token operator">-</span> endbusLatLng<span class="token punctuation">.</span>longitude <span class="token operator">&gt;</span> <span class="token number">0.0001</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">drawLineArrow</span><span class="token punctuation">(</span>endbusLatLng<span class="token punctuation">,</span> startbusLatLng<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 断线用带箭头的直线连?</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 *
	 * checkBusToNextBusNoWalk 和这个类似
	 *
	 * @param busStep
	 * @param busStep1
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkBusEndToNextBusStart</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> busLastPoint <span class="token operator">=</span> <span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLng</span> endbusLatLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>busLastPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> busFirstPoint <span class="token operator">=</span> <span class="token function">getFirstBuslinePoint</span><span class="token punctuation">(</span>busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLng</span> startbusLatLng <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>busFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>endbusLatLng<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>startbusLatLng<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">drawLineArrow</span><span class="token punctuation">(</span>endbusLatLng<span class="token punctuation">,</span> startbusLatLng<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 检查bus最后一步和下一各step的步行起点是否一致
	 *
	 * @param busStep
	 * @param busStep1
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkBusLineToNextWalk</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">,</span> <span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> busLastPoint <span class="token operator">=</span> <span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> walkFirstPoint <span class="token operator">=</span> <span class="token function">getFirstWalkPoint</span><span class="token punctuation">(</span>busStep1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>busLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>walkFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>busLastPoint<span class="token punctuation">,</span> walkFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 检查 步行最后一点 和 bus的起点 是否一致
	 *
	 * @param busStep
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkWalkToBusline</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLonPoint</span> walkLastPoint <span class="token operator">=</span> <span class="token function">getLastWalkPoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLonPoint</span> buslineFirstPoint <span class="token operator">=</span> <span class="token function">getFirstBuslinePoint</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>walkLastPoint<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>buslineFirstPoint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span>walkLastPoint<span class="token punctuation">,</span> buslineFirstPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param busStep1
	 * @return
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getFirstWalkPoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> busStep1<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 *
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyLineByLatLonPoints</span><span class="token punctuation">(</span><span class="token class-name">LatLonPoint</span> pointFrom<span class="token punctuation">,</span>
                                               <span class="token class-name">LatLonPoint</span> pointTo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">LatLng</span> latLngFrom <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>pointFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LatLng</span> latLngTo <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">convertToLatLng</span><span class="token punctuation">(</span>pointTo<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">addWalkPolyline</span><span class="token punctuation">(</span>latLngFrom<span class="token punctuation">,</span> latLngTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param latLngFrom
	 * @param latLngTo
	 * @return
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyline</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLngFrom<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> latLngTo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latLngFrom<span class="token punctuation">,</span> latLngTo<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getWalkColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDottedLine</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param listWalkPolyline
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addWalkPolyline</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> listWalkPolyline<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>listWalkPolyline<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getWalkColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDottedLine</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRailwayPolyline</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLng</span><span class="token punctuation">&gt;</span></span> listPolyline<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>listPolyline<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getDriveColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	
	<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getWalkSnippet</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> walkSteps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> disNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WalkStep</span> step <span class="token operator">:</span> walkSteps<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			disNum <span class="token operator">+=</span> step<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token string">"\u6B65\u884C"</span> <span class="token operator">+</span> disNum <span class="token operator">+</span> <span class="token string">"\u7C73"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">drawLineArrow</span><span class="token punctuation">(</span><span class="token class-name">LatLng</span> latLngFrom<span class="token punctuation">,</span> <span class="token class-name">LatLng</span> latLngTo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token function">addPolyLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PolylineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>latLngFrom<span class="token punctuation">,</span> latLngTo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token function">getBusColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token function">getRouteWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 绘制直线</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getBusSnippet</span><span class="token punctuation">(</span><span class="token class-name">RouteBusLineItem</span> routeBusLineItem<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"("</span>
				<span class="token operator">+</span> routeBusLineItem<span class="token punctuation">.</span><span class="token function">getDepartureBusStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBusStationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">"--&gt;"</span>
				<span class="token operator">+</span> routeBusLineItem<span class="token punctuation">.</span><span class="token function">getArrivalBusStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBusStationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">") \u7ECF\u8FC7"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>routeBusLineItem<span class="token punctuation">.</span><span class="token function">getPassStationNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">"\u7AD9"</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param busStep
	 * @return
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getLastWalkPoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> walkSteps <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">WalkStep</span> walkStep <span class="token operator">=</span> walkSteps<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>walkSteps<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> lonPoints <span class="token operator">=</span> walkStep<span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> lonPoints<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>lonPoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getExitPoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Doorway</span> doorway <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>doorway <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> doorway<span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getLastBuslinePoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LatLonPoint</span><span class="token punctuation">&gt;</span></span> lonPoints <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> lonPoints<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>lonPoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getEntrancePoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Doorway</span> doorway <span class="token operator">=</span> busStep<span class="token punctuation">.</span><span class="token function">getEntrance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>doorway <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> doorway<span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">LatLonPoint</span> <span class="token function">getFirstBuslinePoint</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPolyline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>最后回到<code>RouteActivity</code>，修改onBusRouteSearched()方法中的代码，如下所示：</p> 
<pre><code class="prism language-java">	 <span class="token comment">/**
     * 公交规划路径结果
     *
     * @param busRouteResult 结果
     * @param code           结果码
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBusRouteSearched</span><span class="token punctuation">(</span><span class="token class-name">BusRouteResult</span> busRouteResult<span class="token punctuation">,</span> <span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        aMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 清理地图上的所有覆盖物</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!=</span> <span class="token class-name">AMapException</span><span class="token punctuation">.</span><span class="token constant">CODE_AMAP_SUCCESS</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"错误码；"</span> <span class="token operator">+</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>busRouteResult <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> busRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>busRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"对不起，没有搜索到相关数据！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">final</span> <span class="token class-name">BusPath</span> busPath <span class="token operator">=</span> busRouteResult<span class="token punctuation">.</span><span class="token function">getPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>busPath <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 绘制路线</span>
        <span class="token class-name">BusRouteOverlay</span> busRouteOverlay <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BusRouteOverlay</span><span class="token punctuation">(</span>
                <span class="token keyword">this</span><span class="token punctuation">,</span> aMap<span class="token punctuation">,</span> busPath<span class="token punctuation">,</span>
                busRouteResult<span class="token punctuation">.</span><span class="token function">getStartPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                busRouteResult<span class="token punctuation">.</span><span class="token function">getTargetPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        busRouteOverlay<span class="token punctuation">.</span><span class="token function">removeFromMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        busRouteOverlay<span class="token punctuation">.</span><span class="token function">addToMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        busRouteOverlay<span class="token punctuation">.</span><span class="token function">zoomToSpan</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> dis <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> busPath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dur <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> busPath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> des <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span>dis<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> des<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后来看看运行的效果。</p> 
<p><img src="https://images2.imgbox.com/0a/4b/w4HVS3NR_o.gif" alt="在这里插入图片描述"><br> 公交路线规划就写完了，下面我们就可以去写详情了。</p> 
<h3><a id="_4045"></a>十、出行路线详情</h3> 
<p>  考虑页面展示的问题，我们需要创建一个RouteDetailActivity来展示页路线详情，试想一下，在路线页面得到路线规划之后，点击详情进入详情页面，就可以看到具体的详细出行规划了。</p> 
<p><img src="https://images2.imgbox.com/af/f7/XKl0bYZq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__4051"></a>① 准备工作</h4> 
<p>下面我们首先修改<code>activity_route_detail.xml</code>中的代码，如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#efefef<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.RouteDetailActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.google.android.material.appbar.MaterialToolbar</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/actionBarSize<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/white<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>navigationIcon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_black_back<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>titleCentered</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_time<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#333333<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16sp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#e0e0e0<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.recyclerview.widget.RecyclerView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/rv_route_detail<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>cacheColorHint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#00000000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>divider</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#00000000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fadingEdge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>none<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fadingEdgeLength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>footerDividersEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>headerDividersEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>listSelector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#00000000<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这里面有一个返回图标<code>ic_black_back.xml</code>，代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>autoMirrored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>tint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000000<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fillColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pathData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M16.62,2.99c-0.49,-0.49 -1.28,-0.49 -1.77,0L6.54,11.3c-0.39,0.39 -0.39,1.02 0,1.41l8.31,8.31c0.49,0.49 1.28,0.49 1.77,0s0.49,-1.28 0,-1.77L9.38,12l7.25,-7.25c0.48,-0.48 0.48,-1.28 -0.01,-1.76z<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vector</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>  下面我们就该去写跳转的动作了，首先要做的是在路线规划页面显示出简单路线详情内容，比如距离和时间，让我们首先修改<code>activity_route.xml</code>中的代码，如下所示：</p> 
<pre><code class="prism language-xml">    <span class="token comment">&lt;!--地图路线规划详情布局--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span>
    	<span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/lay_bottom<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@color/white<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_time<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>距离和时间<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#333333<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16sp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_detail<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>drawableEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_blue_open<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>drawablePadding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>详情<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#4c90f9<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_time<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_time<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/a2/83/1MH2F1YI_o.png" alt="在这里插入图片描述"></p> 
<p>这里有一个<code>ic_blue_open.xml</code>图标，代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vector</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>18dp<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>autoMirrored</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>tint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#4C90F9<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>viewportHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fillColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pathData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>M7.38,21.01c0.49,0.49 1.28,0.49 1.77,0l8.31,-8.31c0.39,-0.39 0.39,-1.02 0,-1.41L9.15,2.98c-0.49,-0.49 -1.28,-0.49 -1.77,0s-0.49,1.28 0,1.77L14.62,12l-7.25,7.25c-0.48,0.48 -0.48,1.28 0.01,1.76z<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vector</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="__4190"></a>② 步行路线详情</h4> 
<p>  下面要显示步行花费的时间，回到<code>RouteActivity</code>，找到<code>onWalkRouteSearched()</code>方法，在里面增加如下代码：</p> 
<pre><code class="prism language-java">        <span class="token comment">//显示步行花费时间</span>
        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>des<span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>layBottom<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//跳转到路线详情页面</span>
        binding<span class="token punctuation">.</span>tvDetail<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">RouteActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token class-name">RouteDetailActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">,</span> walkPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/9f/e0/PNe7uAnb_o.png" alt="在这里插入图片描述"><br> 这里在点击的时候通过跳转页面传递数据到路线详情页面里，下面我们就进入<code>RouteDetailActivity</code>，首先进行初始化，代码如下所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteDetailActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">ActivityRouteDetailBinding</span> binding<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EdgeToEdge</span><span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding <span class="token operator">=</span> <span class="token class-name">ActivityRouteDetailBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token function">getLayoutInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ViewCompat</span><span class="token punctuation">.</span><span class="token function">setOnApplyWindowInsetsListener</span><span class="token punctuation">(</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span> insets<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Insets</span> systemBars <span class="token operator">=</span> insets<span class="token punctuation">.</span><span class="token function">getInsets</span><span class="token punctuation">(</span><span class="token class-name">WindowInsetsCompat<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span><span class="token function">systemBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            v<span class="token punctuation">.</span><span class="token function">setPadding</span><span class="token punctuation">(</span>systemBars<span class="token punctuation">.</span>left<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>top<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>right<span class="token punctuation">,</span> systemBars<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> insets<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化视图
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        binding<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span><span class="token function">setNavigationOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>步行

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>骑行

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>驾车

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>公交

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  从代码上来看比较的简单，下面我们要做的就是显示传递过来的数据了，因为数据比较多，所以我们采用列表显示出来。页面布局已经写好了，下面要写就是列表Item布局和适配器了。首先我们写Item布局，在<code>layout</code>下创建<code>item_segment.xml</code>，代码如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#FFF<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_seg_split_line<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#e0e0e0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_route_direction<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>11dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>11dp<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_dir_icon<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>22dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/dir_start<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_dir_icon_up<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_above</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/bus_dir_icon<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerHorizontal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#b6b6b6<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_dir_icon_down<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/bus_dir_icon<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerHorizontal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#b6b6b6<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_item<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>44dp<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RelativeLayout</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/stationinfo<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>
                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_expand_image<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>25dp<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_alignParentRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_marginEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6dp<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_marginRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6dp<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>clickable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>scaleType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>centerInside<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/down<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_station_num<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_toLeftOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/bus_expand_image<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>layout_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/bus_expand_image<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#4c90f9<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12sp<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TextView</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/bus_line_name<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_centerVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginLeft</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginRight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_marginEnd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>70dp<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#333333<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>出发<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/expand_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@id/bus_item<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RelativeLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>图标可以去我的源码中获取，下面我们在<code>MapUtil</code>中添加<code>getWalkActionID()</code>方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getWalkActionID</span><span class="token punctuation">(</span><span class="token class-name">String</span> actionName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actionName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir13<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"左转"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"右转"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向左前方"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"靠左"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"向左前方"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir6<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向右前方"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"靠右"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"向右前方"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir5<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向左后方"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"向左后方"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir7<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向右后方"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"向右后方"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir8<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"直行"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir3<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"通过人行横道"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir9<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"通过过街天桥"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir11<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"通过地下通道"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir10<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir13<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后在<code>com.llw.newmapdemo</code>下新建一个<code>adapter</code>包，用于放置所有的适配器，在这个包下新建一个<code>WalkSegmentListAdapter</code>类，里面的代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>adapter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NonNull</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">RecyclerView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">WalkStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span></span><span class="token class-name">ItemSegmentBinding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 步行段列表适配器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WalkSegmentListAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>Adapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkSegmentListAdapter<span class="token punctuation">.</span>ViewHolder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> mItemList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">WalkSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WalkStep</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mItemList <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> viewType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">WalkStep</span> item <span class="token operator">=</span> mItemList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"出发"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"到达终点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> actionName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> resID <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getWalkActionID</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>resID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mItemList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mItemList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ViewHolder</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>ViewHolder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ItemSegmentBinding</span> binding<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span> itemView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>itemView<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>binding <span class="token operator">=</span> itemView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后在RouteDetailActivity中增加如下方法，再调用。</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 步行详情
     * @param intent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">walkDetail</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        binding<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"步行路线规划"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WalkPath</span> walkPath <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dur <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> walkPath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dis <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> walkPath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dur <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> dis <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>rvRouteDetail<span class="token punctuation">.</span><span class="token function">setLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>rvRouteDetail<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WalkSegmentListAdapter</span><span class="token punctuation">(</span>walkPath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>如下图所示</p> 
<p><img src="https://images2.imgbox.com/a5/62/T1PTNRyi_o.png" alt="在这里插入图片描述"><br> 下面运行一下</p> 
<p><img src="https://images2.imgbox.com/d1/22/9yzQ93yY_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__4521"></a>③ 骑行路线详情</h4> 
<p>在<code>RouteActivity</code>中找到<code>onRideRouteSearched()</code>方法，方法里面添加如下代码：</p> 
<pre><code class="prism language-java">        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>des<span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>layBottom<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>tvDetail<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">RouteActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token class-name">RouteDetailActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">,</span> ridePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/77/6c/ZG4ExTvL_o.png" alt="在这里插入图片描述"></p> 
<p>然后在<code>adapter</code>包下新增一个<code>RideSegmentListAdapter</code>类，里面的代码如下;</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>adapter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NonNull</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">RecyclerView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RideStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">WalkStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span></span><span class="token class-name">ItemSegmentBinding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 骑行段列表适配器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RideSegmentListAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>Adapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RideSegmentListAdapter<span class="token punctuation">.</span>ViewHolder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RideStep</span><span class="token punctuation">&gt;</span></span> mItemList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RideSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RideStep</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mItemList <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> viewType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RideStep</span> item <span class="token operator">=</span> mItemList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"出发"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"到达终点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> actionName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> resID <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getWalkActionID</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>resID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mItemList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mItemList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ViewHolder</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>ViewHolder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ItemSegmentBinding</span> binding<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span> itemView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>itemView<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>binding <span class="token operator">=</span> itemView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面再进入到<code>RouteDetailActivity</code>，新增如下方法：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 骑行详情
     * @param intent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rideDetail</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        binding<span class="token punctuation">.</span>toolbar<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"骑行路线规划"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RidePath</span> ridePath <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dur <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ridePath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dis <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ridePath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dur <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> dis <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>rvRouteDetail<span class="token punctuation">.</span><span class="token function">setLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>rvRouteDetail<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RideSegmentListAdapter</span><span class="token punctuation">(</span>ridePath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后在<code>initView()</code>中调用。</p> 
<p><img src="https://images2.imgbox.com/f6/bd/qoqA0EV4_o.png" alt="在这里插入图片描述"></p> 
<p>然后你就可以运行了。</p> 
<p><img src="https://images2.imgbox.com/8f/59/7tofEhRf_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__4641"></a>④ 驾车路线详情</h4> 
<p>在<code>RouteActivity</code>中找到<code>onDriveRouteSearched()</code>方法，方法里面添加如下代码：</p> 
<pre><code class="prism language-java">        <span class="token comment">//显示驾车花费时间</span>
        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>des<span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>layBottom<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//跳转到路线详情页面</span>
        binding<span class="token punctuation">.</span>tvDetail<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">RouteActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token class-name">RouteDetailActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">,</span> drivePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2a/59/quVHlWoJ_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们在<code>MapUtil</code>中添加<code>getDriveActionID()</code>方法，代码如下所示：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getDriveActionID</span><span class="token punctuation">(</span><span class="token class-name">String</span> actionName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actionName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> actionName<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir3<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"左转"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"右转"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向左前方行驶"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"靠左"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir6<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向右前方行驶"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"靠右"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir5<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向左后方行驶"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"左转调头"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir7<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"向右后方行驶"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir8<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"直行"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir3<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"减速行驶"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir4<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir3<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后在<code>adapter</code>包下新增一个<code>DriveSegmentListAdapter</code>类，里面的代码如下;</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>adapter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NonNull</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">RecyclerView</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">DriveStep</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span></span><span class="token class-name">ItemSegmentBinding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">MapUtil</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 驾车段列表适配器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DriveSegmentListAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>Adapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DriveSegmentListAdapter<span class="token punctuation">.</span>ViewHolder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DriveStep</span><span class="token punctuation">&gt;</span></span> mItemList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DriveSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DriveStep</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mItemList <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> viewType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DriveStep</span> item <span class="token operator">=</span> mItemList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"出发"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"到达终点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> actionName <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> resID <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getDriveActionID</span><span class="token punctuation">(</span>actionName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span>resID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getInstruction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mItemList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mItemList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ViewHolder</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>ViewHolder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ItemSegmentBinding</span> binding<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span> itemView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>itemView<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>binding <span class="token operator">=</span> itemView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>适配器没有问题了，下面进入到<code>RouteDetailActivity</code>，新增如下方法：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 驾车详情
     * @param intent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">driveDetail</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tvTitle<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"驾车路线规划"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DrivePath</span> drivePath <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dur <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> drivePath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dis <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> drivePath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dur <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> dis <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rv<span class="token punctuation">.</span><span class="token function">setLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rv<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DriveSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_segment<span class="token punctuation">,</span> drivePath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后在initView中调用。</p> 
<p><img src="https://images2.imgbox.com/35/40/dbfiYGZe_o.png" alt="在这里插入图片描述"></p> 
<p>然后运行一下：</p> 
<p><img src="https://images2.imgbox.com/f9/ca/56DDj1x5_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__4796"></a>⑤ 公交路线详情</h4> 
<p>  最后这个公交路线详情是最麻烦的，前面三个其实都还蛮简单的，同样在<code>RouteActivity</code>中找到<code>onBusRouteSearched()</code>方法，然后在里面添加如下代码：</p> 
<pre><code class="prism language-java">        <span class="token comment">//显示公交花费时间</span>
        binding<span class="token punctuation">.</span>tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>des<span class="token punctuation">)</span><span class="token punctuation">;</span>
        binding<span class="token punctuation">.</span>layBottom<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//跳转到路线详情页面</span>
        binding<span class="token punctuation">.</span>tvDetail<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">RouteActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span>
                    <span class="token class-name">RouteDetailActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">,</span> busPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/16/34/2WEy4nu1_o.png" alt="在这里插入图片描述"></p> 
<p>  下面这个适配器的代码就比较多了，为什么呢？因为公交的话它还有这个公交车的信息，比如你是要做几路车，然后经过几个站，之后再转几路车，最后到达终点。因此先增加一个站点的布局，在<code>layout</code>下创建一个<code>item_segment_ex.xml</code>文件，里面的代码如下：</p> 
<pre><code class="prism language-css">&lt;?xml version=<span class="token string">"1.0"</span> encoding=<span class="token string">"utf-8"</span>?&gt;
&lt;LinearLayout <span class="token property">xmlns</span><span class="token punctuation">:</span>android=<span class="token string">"http://schemas.android.com/apk/res/android"</span>
    <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"match_parent"</span>
    <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"match_parent"</span>
    <span class="token property">android</span><span class="token punctuation">:</span>orientation=<span class="token string">"horizontal"</span> &gt;

    &lt;RelativeLayout
        <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"wrap_content"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"27dp"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_marginLeft=<span class="token string">"15.5dp"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_marginStart=<span class="token string">"15.5dp"</span> &gt;

        &lt;ImageView
            <span class="token property">android</span><span class="token punctuation">:</span>id=<span class="token string">"@+id/bus_dir_icon"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"13dp"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"13dp"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_centerVertical=<span class="token string">"true"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>src=<span class="token string">"@drawable/dir_station"</span> /&gt;

        &lt;ImageView
            <span class="token property">android</span><span class="token punctuation">:</span>id=<span class="token string">"@+id/bus_dir_icon_up"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"2dp"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"match_parent"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_above=<span class="token string">"@id/bus_dir_icon"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_centerHorizontal=<span class="token string">"true"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>background=<span class="token string">"#b6b6b6"</span> /&gt;

        &lt;ImageView
            <span class="token property">android</span><span class="token punctuation">:</span>id=<span class="token string">"@+id/bus_dir_icon_down"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"2dp"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"match_parent"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_below=<span class="token string">"@id/bus_dir_icon"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>layout_centerHorizontal=<span class="token string">"true"</span>
            <span class="token property">android</span><span class="token punctuation">:</span>background=<span class="token string">"#b6b6b6"</span> /&gt;
    &lt;/RelativeLayout&gt;

    &lt;TextView
        <span class="token property">android</span><span class="token punctuation">:</span>id=<span class="token string">"@+id/bus_line_station_name"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_width=<span class="token string">"wrap_content"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_height=<span class="token string">"wrap_content"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_gravity=<span class="token string">"center_vertical"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>gravity=<span class="token string">"center_vertical"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_marginLeft=<span class="token string">"20dp"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>layout_marginStart=<span class="token string">"20dp"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>textColor=<span class="token string">"#999999"</span>
        <span class="token property">android</span><span class="token punctuation">:</span>textSize=<span class="token string">"13sp"</span> /&gt;
&lt;/LinearLayout&gt;
</code></pre> 
<p>  这里还需要对原来的BusStep进行一次封装，而不是直接使用这个BusStep，在<code>utils</code>包下新增一个<code>SchemeBusStep</code>类，代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">BusStep</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SchemeBusStep</span> <span class="token keyword">extends</span> <span class="token class-name">BusStep</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isWalk <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isBus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> israilway <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> istaxi <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isStart <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> isEnd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> arrowExpend <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span><span class="token class-name">BusStep</span> step<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>step <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setBusLine</span><span class="token punctuation">(</span>step<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setWalk</span><span class="token punctuation">(</span>step<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRailway</span><span class="token punctuation">(</span>step<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTaxi</span><span class="token punctuation">(</span>step<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isArrowExpend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> arrowExpend<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArrowExpend</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> arrowExpend<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>arrowExpend <span class="token operator">=</span> arrowExpend<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> isWalk<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setWalk</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isWalk<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>isWalk <span class="token operator">=</span> isWalk<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> isBus<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBus</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isBus<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>isBus <span class="token operator">=</span> isBus<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> isStart<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStart</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isStart<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>isStart <span class="token operator">=</span> isStart<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> isEnd<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnd</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> isEnd<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>isEnd <span class="token operator">=</span> isEnd<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> israilway<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> istaxi<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRailway</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> israilway<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>israilway <span class="token operator">=</span> israilway<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTaxi</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> istaxi<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>istaxi <span class="token operator">=</span> istaxi<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>

</code></pre> 
<p>  这个里面主要就是对数据的控制，使你在适配器中可以更好处理显示的效果。下面来写这个适配器，在<code>adapter</code>包下新建一个<code>BusSegmentListAdapter</code>类，代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>adapter</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">BitmapDescriptorFactory</span><span class="token punctuation">.</span><span class="token static">getContext</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">LinearLayout</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">TextView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NonNull</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>recyclerview<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">RecyclerView</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>busline<span class="token punctuation">.</span></span><span class="token class-name">BusStationItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>amap<span class="token punctuation">.</span>api<span class="token punctuation">.</span>services<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">RailwayStationItem</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span></span><span class="token class-name">R</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>databinding<span class="token punctuation">.</span></span><span class="token class-name">ItemSegmentBinding</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>llw<span class="token punctuation">.</span>newmapdemo<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">SchemeBusStep</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 公交段列表适配器
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusSegmentListAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>Adapter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BusSegmentListAdapter<span class="token punctuation">.</span>ViewHolder</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SchemeBusStep</span><span class="token punctuation">&gt;</span></span> mItemList<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BusSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SchemeBusStep</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mItemList <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span> <span class="token function">onCreateViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewGroup</span> parent<span class="token punctuation">,</span> <span class="token keyword">int</span> viewType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parent<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBindViewHolder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">ViewHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SchemeBusStep</span> item <span class="token operator">=</span> mItemList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"出发"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busSegSplitLine<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"到达终点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">INVISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir13<span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"步行"</span>
                        <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> item<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"米"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">GONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">GONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getBusLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir14<span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBusLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBusLineName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum
                        <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBusLines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPassStationNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"站"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir16<span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum
                        <span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getViastops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"站"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIcon<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>dir14<span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconUp<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busDirIconDown<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">VISIBLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busLineName<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"打车到终点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busStationNum<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">GONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token constant">GONE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busItem<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//公交</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">isArrowExpend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span><span class="token function">setArrowExpend</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">addBusStation</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDepartureBusStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BusStationItem</span> station <span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">getPassStations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">addBusStation</span><span class="token punctuation">(</span>station<span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">addBusStation</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalBusStation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span><span class="token function">setArrowExpend</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>down<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">.</span><span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">isRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//火车</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span><span class="token function">isArrowExpend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span><span class="token function">setArrowExpend</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>up<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">addRailwayStation</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeparturestop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RailwayStationItem</span> station <span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getViastops</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">addRailwayStation</span><span class="token punctuation">(</span>station<span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">addRailwayStation</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getArrivalstop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    item<span class="token punctuation">.</span><span class="token function">setArrowExpend</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>busExpandImage<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>down<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    holder<span class="token punctuation">.</span>binding<span class="token punctuation">.</span>expandContent<span class="token punctuation">.</span><span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加公交车站
     * @param station
     * @param expandContent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addBusStation</span><span class="token punctuation">(</span><span class="token class-name">BusStationItem</span> station<span class="token punctuation">,</span> <span class="token class-name">LinearLayout</span> expandContent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LinearLayout</span> ll <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LinearLayout</span><span class="token punctuation">)</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_segment_ex<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> tv <span class="token operator">=</span> ll<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>bus_line_station_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tv<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>station<span class="token punctuation">.</span><span class="token function">getBusStationName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expandContent<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加火车站
     * @param station
     * @param expandContent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addRailwayStation</span><span class="token punctuation">(</span><span class="token class-name">RailwayStationItem</span> station<span class="token punctuation">,</span> <span class="token class-name">LinearLayout</span> expandContent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LinearLayout</span> ll <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LinearLayout</span><span class="token punctuation">)</span> <span class="token class-name">View</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_segment_ex<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TextView</span> tv <span class="token operator">=</span> ll
                <span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>bus_line_station_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tv<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>station<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token function">getRailwayTime</span><span class="token punctuation">(</span>station<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expandContent<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取铁路时间
     * @param time
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getRailwayTime</span><span class="token punctuation">(</span><span class="token class-name">String</span> time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> time<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getItemCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> mItemList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mItemList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> mItemList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ViewHolder</span> <span class="token keyword">extends</span> <span class="token class-name">RecyclerView<span class="token punctuation">.</span>ViewHolder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ItemSegmentBinding</span> binding<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token class-name">ItemSegmentBinding</span> itemView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>itemView<span class="token punctuation">.</span><span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>binding <span class="token operator">=</span> itemView<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>  里面也是比较简单的代码，不清楚的话和我说一声，我再给你解释一下，那么下面进入<code>RouteDetailActivity</code>，先增加一个<code>getBusSteps</code>方法，对BusStep数据进行组装。</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 公交方案数据组装
     * @param list
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SchemeBusStep</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBusSteps</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BusStep</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SchemeBusStep</span><span class="token punctuation">&gt;</span></span> busStepList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SchemeBusStep</span> start <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        start<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BusStep</span> busStep <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> busStep<span class="token punctuation">.</span><span class="token function">getWalk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">SchemeBusStep</span> walk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                walk<span class="token punctuation">.</span><span class="token function">setWalk</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>walk<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getBusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">SchemeBusStep</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                bus<span class="token punctuation">.</span><span class="token function">setBus</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getRailway</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">SchemeBusStep</span> railway <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                railway<span class="token punctuation">.</span><span class="token function">setRailway</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>railway<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>busStep<span class="token punctuation">.</span><span class="token function">getTaxi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">SchemeBusStep</span> taxi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span>busStep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                taxi<span class="token punctuation">.</span><span class="token function">setTaxi</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>taxi<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">SchemeBusStep</span> end <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SchemeBusStep</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        end<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        busStepList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> busStepList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后添加一个busDetail方法，里面的代码如下：</p> 
<pre><code class="prism language-java">	<span class="token comment">/**
     * 公交详情
     * @param intent
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">busDetail</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tvTitle<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"公交路线规划"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BusPath</span> busPath <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dur <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyTime</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> busPath<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dis <span class="token operator">=</span> <span class="token class-name">MapUtil</span><span class="token punctuation">.</span><span class="token function">getFriendlyLength</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> busPath<span class="token punctuation">.</span><span class="token function">getDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tvTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>dur <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span> dis <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rv<span class="token punctuation">.</span><span class="token function">setLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinearLayoutManager</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rv<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BusSegmentListAdapter</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>item_segment<span class="token punctuation">,</span> <span class="token function">getBusSteps</span><span class="token punctuation">(</span>busPath<span class="token punctuation">.</span><span class="token function">getSteps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>最后在<code>initView()</code>中调用。</p> 
<p><img src="https://images2.imgbox.com/f5/a7/FpCZQ0d0_o.png" alt="在这里插入图片描述"></p> 
<p>然后运行一下：</p> 
<p><img src="https://images2.imgbox.com/de/ba/lO7VTF9U_o.gif" alt="在这里插入图片描述"></p> 
<h4><a id="__5201"></a>⑥ 手动输入目的地和出发地</h4> 
<p>  在实际使用中，通常都是定位到当前所在地，然后用户再输入一个目的地，以此来计算这个两点之间的路线规划，手动点地图这种方式并不常用，因为你很难点到足够精确的位置，其次就是你要在地图上寻找这个地方所在，这样用户花费的时间就会更多，因此日常使用都是手动输入，输入方式有多种，常规的键盘输入、声音输入、扫码输入等。下面我们使用键盘输入。</p> 
<p>这里就需要修改<code>activity_route.xml</code>布局了，添加如下代码：</p> 
<pre><code class="prism language-xml">	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_start<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>当前所在地<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/spinner<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_start_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_start<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@null<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12sp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_start<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_start<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_start_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_start_address<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_end<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_start_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingStart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>前往目的地<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/view<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_end_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_start_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_toRightOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_end<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@null<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>hint</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>请输入目的地<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>imeOptions</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>actionSearch<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>singleLine</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14sp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_end<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/tv_start<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/view2<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_below</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_end_address<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/et_end_address<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>添加位置如下图所示：<br> <img src="https://images2.imgbox.com/8c/ff/uCNIqzAr_o.png" alt="在这里插入图片描述"></p> 
<p>然后进入到<code>RouteActivity</code>，创建变量。</p> 
<p>然后在<code>initTravelMode()</code>方法中目的地输入框添加一个软键盘按键监听。</p> 
<pre><code class="prism language-java">        <span class="token comment">//键盘按键监听</span>
        binding<span class="token punctuation">.</span>etEndAddress<span class="token punctuation">.</span><span class="token function">setOnKeyListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_ENTER</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//获取输入框的值</span>
                <span class="token class-name">String</span> endAddress <span class="token operator">=</span> binding<span class="token punctuation">.</span>etEndAddress<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>endAddress<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"请输入要前往的目的地"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">InputMethodManager</span> imm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">InputMethodManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">INPUT_METHOD_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//隐藏软键盘</span>
                imm<span class="token punctuation">.</span><span class="token function">hideSoftInputFromWindow</span><span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWindowToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//通过输入的目的地转为经纬度，然后进行地图上添加标点，最后计算出行路线规划</span>
                
                
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/a3/b0/NHb4wceS_o.png" alt="在这里插入图片描述"></p> 
<p>这里的当前地我还是使用定位所在地，在<code>onLocationChanged()</code>方法中增加如下代码。</p> 
<pre><code class="prism language-java">				<span class="token comment">//设置当前所在地</span>
                etStartAddress<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
                etStartAddress<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//禁用输入</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/81/75/CQNzEmco_o.png" alt="在这里插入图片描述"></p> 
<p>现在还差一个地址转换的处理，通过地理编码就可以把地址转化成坐标。在RouteActivity中声明变量，代码如下所示：</p> 
<pre><code class="prism language-java">	<span class="token comment">//地理编码搜索</span>
    <span class="token keyword">private</span> <span class="token class-name">GeocodeSearch</span> geocodeSearch<span class="token punctuation">;</span>
    <span class="token comment">//解析成功标识码</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">PARSE_SUCCESS_CODE</span> <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后在<code>initMap()</code>方法中</p> 
<pre><code class="prism language-java">        <span class="token comment">//构造 GeocodeSearch 对象</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            geocodeSearch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeSearch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AMapException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//设置监听</span>
        geocodeSearch<span class="token punctuation">.</span><span class="token function">setOnGeocodeSearchListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示：</p> 
<p><img src="https://images2.imgbox.com/7e/a8/UgvQ6XKD_o.png" alt="在这里插入图片描述"></p> 
<p>同样Activity依然需要实现GeocodeSearch.OnGeocodeSearchListener。</p> 
<p><img src="https://images2.imgbox.com/dd/0d/28BgQNdj_o.png" alt="在这里插入图片描述"></p> 
<p>然后重写如下方法：</p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRegeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">RegeocodeResult</span> regeocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 地址转坐标
     *
     * @param geocodeResult
     * @param rCode
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">GeocodeResult</span> geocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rCode <span class="token operator">!=</span> <span class="token constant">PARSE_SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"获取坐标失败，错误码："</span> <span class="token operator">+</span> rCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GeocodeAddress</span><span class="token punctuation">&gt;</span></span> geocodeAddressList <span class="token operator">=</span> geocodeResult<span class="token punctuation">.</span><span class="token function">getGeocodeAddressList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>geocodeAddressList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>geocodeAddressList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//终点</span>
            mEndPoint <span class="token operator">=</span> geocodeAddressList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//开始路线搜索</span>
            <span class="token function">startRouteSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>  在<code>onGeocodeSearched()</code>方法中通过坐标确定终点，然后进行路线规划，最后一步就是在输入框的键盘按键监听触发这个地理编码搜索。</p> 
<pre><code class="prism language-java">				<span class="token comment">// name表示地址，第二个参数表示查询城市，中文或者中文全拼，citycode、adcode</span>
                <span class="token class-name">GeocodeQuery</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeQuery</span><span class="token punctuation">(</span>endAddress<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
                geocodeSearch<span class="token punctuation">.</span><span class="token function">getFromLocationNameAsyn</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/92/45/qYVb8Tf4_o.png" alt="在这里插入图片描述"></p> 
<p>这样就OK了,运行一下。</p> 
<p><img src="https://images2.imgbox.com/f9/cd/cRb2qxgR_o.gif" alt="在这里插入图片描述"></p> 
<p>  现在这个当前所在地是通过定位获取的，那么怎么样改成可以手动输入的呢？其实很简单，一开始我写这个页面时，因为是通过定位获取到这个所在地的地址信息然后设置到控件上，所以控件的字体我做了一些调整，如果说要想设置为可输入的话，那么两个输入框的字体应该一致才行，下面先更改这一个，打开<code>activity_route.xml</code>。</p> 
<p><img src="https://images2.imgbox.com/7f/85/qFXvXXGW_o.png" alt="在这里插入图片描述"></p> 
<p>  在<code>RouteActivity</code>中定义变量<code>locationAddress</code>，表明这是一个通过定位获得的地址。</p> 
<pre><code class="prism language-java">	<span class="token comment">//定位地址</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> locationAddress<span class="token punctuation">;</span>
</code></pre> 
<p>然后我们修改<code>onLocationChanged()</code>，代码如下所示：</p> 
<pre><code class="prism language-java">                <span class="token comment">//地址</span>
                locationAddress <span class="token operator">=</span> aMapLocation<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//设置当前所在地</span>
                binding<span class="token punctuation">.</span>etStartAddress<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>locationAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//binding.etStartAddress.setEnabled(false);//禁用输入</span>
</code></pre> 
<p>添加位置如下图所示</p> 
<p><img src="https://images2.imgbox.com/90/a5/3Wb3KJp9_o.png" alt="在这里插入图片描述"></p> 
<p>  对于路线的规划是在输入完目的地之后，点击软键盘上的搜索按钮之后执行的。还记得之前的目的地输入后，有一个地址转坐标的操作，在这里进行了目的地的构建，然后才是路线的规划。</p> 
<p><img src="https://images2.imgbox.com/ff/1a/Hy7vXHfG_o.png" alt="在这里插入图片描述"></p> 
<p>  那么你现在的出发地也是手动输入的话，那就同样要转换成坐标，然后去构建这个出发地，也就是起点左标，而解析只有一个返回，那么你就需要区分这个解析是起点还是终点了。然后来看这一块的代码，这里就是对这个目的地输入框进行了检查，这是之前的代码，现在这一块的代码就要做更改了。</p> 
<p><img src="https://images2.imgbox.com/04/7c/GeziPwzv_o.png" alt="在这里插入图片描述"></p> 
<p>首先定义变量。</p> 
<pre><code class="prism language-java">	<span class="token comment">//起点地址转坐标标识   1</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> tag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后设置起点这个输入框的软键盘搜索按键监听，而因为有两个输入框都需要进行监听，因此通过类来实现。修改<code>initTravelMode()</code>方法中的代码。</p> 
<pre><code class="prism language-java">        <span class="token comment">//起点 键盘按键监听</span>
        binding<span class="token punctuation">.</span>etStartAddress<span class="token punctuation">.</span><span class="token function">setOnKeyListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//终点 键盘按键监听</span>
        binding<span class="token punctuation">.</span>etEndAddress<span class="token punctuation">.</span><span class="token function">setOnKeyListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如下图所示</p> 
<p><img src="https://images2.imgbox.com/6c/d6/QexArEr6_o.png" alt="在这里插入图片描述"></p> 
<p>会实现一个<code>onKey()</code>方法。代码如下所示：</p> 
<pre><code class="prism language-java">	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKey</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">KEYCODE_ENTER</span> <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span><span class="token constant">ACTION_UP</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取输入框的值 出发地（起点）</span>
            <span class="token class-name">String</span> startAddress <span class="token operator">=</span> etStartAddress<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取输入框的值 目的地（终点）</span>
            <span class="token class-name">String</span> endAddress <span class="token operator">=</span> etEndAddress<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//判断出发地是否有值  不管这个值是定位还是手动输入</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>startAddress<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"请输入当前的出发地"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//判断目的地是否有值</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>endAddress<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"请输入要前往的目的地"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//当出发地输入框有值的时候，判断这个值是否是定位的地址，是则说明你没有更改过，则不需要进行地址转坐标，不是则需要转换。</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locationAddress<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>startAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                tag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">GeocodeQuery</span> startQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeQuery</span><span class="token punctuation">(</span>startAddress<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
                geocodeSearch<span class="token punctuation">.</span><span class="token function">getFromLocationNameAsyn</span><span class="token punctuation">(</span>startQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                tag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">InputMethodManager</span> imm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">InputMethodManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">INPUT_METHOD_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//隐藏软键盘</span>
            imm<span class="token punctuation">.</span><span class="token function">hideSoftInputFromWindow</span><span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWindowToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//通过输入的目的地转为经纬度，然后进行地图上添加标点，最后计算出行路线规划</span>

            <span class="token comment">// name表示地址，第二个参数表示查询城市，中文或者中文全拼，citycode、adcode</span>
            <span class="token class-name">GeocodeQuery</span> endQuery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeocodeQuery</span><span class="token punctuation">(</span>endAddress<span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
            geocodeSearch<span class="token punctuation">.</span><span class="token function">getFromLocationNameAsyn</span><span class="token punctuation">(</span>endQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>然后再去修改<code>onGeocodeSearched()</code>方法的代码：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGeocodeSearched</span><span class="token punctuation">(</span><span class="token class-name">GeocodeResult</span> geocodeResult<span class="token punctuation">,</span> <span class="token keyword">int</span> rCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rCode <span class="token operator">!=</span> <span class="token constant">PARSE_SUCCESS_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token string">"获取坐标失败，错误码："</span> <span class="token operator">+</span> rCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GeocodeAddress</span><span class="token punctuation">&gt;</span></span> geocodeAddressList <span class="token operator">=</span> geocodeResult<span class="token punctuation">.</span><span class="token function">getGeocodeAddressList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>geocodeAddressList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>geocodeAddressList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//判断是不是起点的搜索</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//起点</span>
                mStartPoint <span class="token operator">=</span> geocodeAddressList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//终点</span>
                mEndPoint <span class="token operator">=</span> geocodeAddressList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLatLonPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mStartPoint <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mEndPoint <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//开始路线搜索</span>
                <span class="token function">startRouteSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>下面就可以运行了。</p> 
<p><img src="https://images2.imgbox.com/dd/76/Z3Ykk7Z5_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_5534"></a>十一、源码</h3> 
<p>如果对你有所帮助的话，不妨欢迎Star和Fork。</p> 
<p>源码地址：<a href="https://github.com/lilongweidev/NewGaodeMapDemo">NewGaodeMapDemo</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c9e6597c6ec422cd9ae8f22a1b93dce5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kafka小白：从下载到运行简单示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b67db2eaa7f246ab92525a8c1dcb8d00/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构之B树</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>