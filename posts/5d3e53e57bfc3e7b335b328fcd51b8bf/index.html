<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>elasticsearch SQL：在Elasticsearch中启用和使用SQL功能 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5d3e53e57bfc3e7b335b328fcd51b8bf/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="elasticsearch SQL：在Elasticsearch中启用和使用SQL功能">
  <meta property="og:description" content="❃博主首页 ： 「码到三十五」 ，同名公众号 :「码到三十五」，wx号 : 「liwu0213」 ☠博主专栏 ： &lt;mysql高手&gt; &lt;elasticsearch高手&gt; &lt;源码解读&gt; &lt;java核心&gt; &lt;面试攻关&gt; ♝博主的话 ： 搬的每块砖，皆为峰峦之基；公众号搜索「码到三十五」关注这个爱发技术干货的coder，一起筑基 目录 一、基本概念二、主要功能和优势Elasticsearch SQL特点 三、启用和使用SQL功能四、Elasticsearch SQL的使用4.1 语法4.2 sql查询4.3 将SQL转换为DSL4.4 全文检索MATCH函数QUERY() 4.5 分组统计4.6 DESCRIBE4.7 SHOW TABLES4.8 查询支持的函数 五、适用场景及潜在限制 一、基本概念 Elasticsearch是一个基于Lucene的开源、分布式、RESTful搜索引擎。它提供了全文搜索、结构化搜索、分析以及分布式索引等功能。Elasticsearch SQL是Elasticsearch的扩展功能，允许用户使用SQL语法查询Elasticsearch数据。通过SQL接口，开发者可以利用熟悉的SQL语言，编写更直观、更易懂的查询，并且避免对大量复杂的原生REST请求的编写。
二、主要功能和优势 易用性：使用熟悉的SQL语法，降低了学习成本。灵活性：支持复杂的查询和聚合操作。性能：Elasticsearch本身的分布式架构和高效查询引擎保证了查询性能。集成性：通过JDBC驱动，可以与各种SQL工具和应用程序集成。 Elasticsearch SQL特点 1. 本地集成
Elasticsearch SQL是专门为Elasticsearch构建的。每个SQL查询都根据底层存储对相关节点有效执行。
2. 没有额外的要求
不依赖其他的硬件、进程、运行时库，Elasticsearch SQL可以直接运行在Elasticsearch集群上
3. 轻量且高效
像SQL那样简洁、高效地完成查询
三、启用和使用SQL功能 要在Elasticsearch中启用和使用SQL功能，你需要安装X-Pack插件。X-Pack插件包含了许多扩展功能，包括SQL接口。安装完成后，需要在Elasticsearch配置文件中启用X-Pack插件，并重启Elasticsearch服务。
# 安装X-Pack插件 ./bin/elasticsearch-plugin install x-pack # 启用X-Pack插件 # 在elasticsearch.yml配置文件中添加以下配置 xpack.sql.enabled: true 在启用SQL功能后，你可以通过REST API、命令行工具或JDBC驱动来执行SQL查询。Elasticsearch SQL的语法与标准的SQL语法非常相似，支持SELECT、FROM、WHERE、GROUP BY、HAVING、ORDER BY等常见SQL语句。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-09T20:12:07+08:00">
    <meta property="article:modified_time" content="2024-07-09T20:12:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">elasticsearch SQL：在Elasticsearch中启用和使用SQL功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div> 
 <font color="#c09008" size="3"><strong> ❃博主首页 ：</strong></font> 
 <a href="https://blog.csdn.net/qq_26664043"><font size="3"> 「码到三十五」</font></a> 
 <font color="#555bbbb" size="3"> ，同名公众号 :「码到三十五」，wx号 : 「liwu0213」 </font> 
 <br> 
 <font color="#c09008" size="3"><strong>☠博主专栏 ：</strong></font> 
 <a href="https://blog.csdn.net/qq_26664043/category_12712562.html" size="6"><font color="#555bbbb" size="3"> &lt;mysql高手&gt; </font></a> 
 <a href="https://blog.csdn.net/qq_26664043/category_12712557.html" size="6"><font color="#555bbbb" size="3"> &lt;elasticsearch高手&gt; </font></a> 
 <a href="https://blog.csdn.net/qq_26664043/category_12376895.html" size="6"><font color="#555bbbb" size="3"> &lt;源码解读&gt; </font></a> 
 <a href="https://blog.csdn.net/qq_26664043/category_12587226.html" size="6"><font color="#555bbbb" size="3"> &lt;java核心&gt; </font></a> 
 <a href="https://blog.csdn.net/qq_26664043/category_12588169.html" size="6"><font color="#555bbbb" size="3"> &lt;面试攻关&gt; </font></a> 
 <br> 
 <font color="#c09008" size="3"><strong>♝博主的话 ：</strong></font> 
 <font color="#555bbbb" size="3">搬的每块砖，皆为峰峦之基；公众号搜索「码到三十五」关注这个爱发技术干货的coder，一起筑基 </font> 
</div> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_19" rel="nofollow">一、基本概念</a></li><li><a href="#_24" rel="nofollow">二、主要功能和优势</a></li><li><ul><li><a href="#Elasticsearch_SQL_30" rel="nofollow">Elasticsearch SQL特点</a></li></ul> 
    </li><li><a href="#SQL_37" rel="nofollow">三、启用和使用SQL功能</a></li><li><a href="#Elasticsearch_SQL_52" rel="nofollow">四、Elasticsearch SQL的使用</a></li><li><ul><li><a href="#41__53" rel="nofollow">4.1 语法</a></li><li><a href="#42_sql_67" rel="nofollow">4.2 sql查询</a></li><li><a href="#43_SQLDSL_78" rel="nofollow">4.3 将SQL转换为DSL</a></li><li><a href="#44___121" rel="nofollow">4.4 全文检索</a></li><li><ul><li><a href="#MATCH_123" rel="nofollow">MATCH函数</a></li><li><a href="#QUERY_143" rel="nofollow">QUERY()</a></li></ul> 
     </li><li><a href="#45__154" rel="nofollow">4.5 分组统计</a></li><li><a href="#46_DESCRIBE_188" rel="nofollow">4.6 DESCRIBE</a></li><li><a href="#47_SHOW_TABLES_199" rel="nofollow">4.7 SHOW TABLES</a></li><li><a href="#48__209" rel="nofollow">4.8 查询支持的函数</a></li></ul> 
    </li><li><a href="#_220" rel="nofollow">五、适用场景及潜在限制</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_19"></a>一、基本概念</h4> 
<p>Elasticsearch是一个基于Lucene的开源、分布式、RESTful搜索引擎。它提供了全文搜索、结构化搜索、分析以及分布式索引等功能。Elasticsearch SQL是Elasticsearch的扩展功能，允许用户使用SQL语法查询Elasticsearch数据。通过SQL接口，开发者可以利用熟悉的SQL语言，编写更直观、更易懂的查询，并且避免对大量复杂的原生REST请求的编写。</p> 
<p><img src="https://images2.imgbox.com/09/8f/mcCktVqf_o.jpg" alt="在这里插入图片描述"></p> 
<h4><a id="_24"></a>二、主要功能和优势</h4> 
<ol><li><strong>易用性</strong>：使用熟悉的SQL语法，降低了学习成本。</li><li><strong>灵活性</strong>：支持复杂的查询和聚合操作。</li><li><strong>性能</strong>：Elasticsearch本身的分布式架构和高效查询引擎保证了查询性能。</li><li><strong>集成性</strong>：通过JDBC驱动，可以与各种SQL工具和应用程序集成。</li></ol> 
<h5><a id="Elasticsearch_SQL_30"></a>Elasticsearch SQL特点</h5> 
<p><strong>1. 本地集成</strong><br> Elasticsearch SQL是专门为Elasticsearch构建的。每个SQL查询都根据底层存储对相关节点有效执行。<br> <strong>2. 没有额外的要求</strong><br> 不依赖其他的硬件、进程、运行时库，Elasticsearch SQL可以直接运行在Elasticsearch集群上<br> <strong>3. 轻量且高效</strong><br> 像SQL那样简洁、高效地完成查询</p> 
<h4><a id="SQL_37"></a>三、启用和使用SQL功能</h4> 
<p>要在Elasticsearch中启用和使用SQL功能，你需要安装X-Pack插件。X-Pack插件包含了许多扩展功能，包括SQL接口。安装完成后，需要在Elasticsearch配置文件中启用X-Pack插件，并重启Elasticsearch服务。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 安装X-Pack插件</span>
./bin/elasticsearch-plugin <span class="token function">install</span> x-pack

<span class="token comment"># 启用X-Pack插件</span>
<span class="token comment"># 在elasticsearch.yml配置文件中添加以下配置</span>
xpack.sql.enabled: <span class="token boolean">true</span>
</code></pre> 
<p>在启用SQL功能后，你可以通过REST API、命令行工具或JDBC驱动来执行SQL查询。Elasticsearch SQL的语法与标准的SQL语法非常相似，支持SELECT、FROM、WHERE、GROUP BY、HAVING、ORDER BY等常见SQL语句。</p> 
<h4><a id="Elasticsearch_SQL_52"></a>四、Elasticsearch SQL的使用</h4> 
<h5><a id="41__53"></a>4.1 语法</h5> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> select_expr <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">FROM</span> table_name <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">WHERE</span> condition <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> grouping_element <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">HAVING</span> condition<span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> expression <span class="token punctuation">[</span> <span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span> <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">LIMIT</span> <span class="token punctuation">[</span> count <span class="token punctuation">]</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">PIVOT</span> <span class="token punctuation">(</span> aggregation_expr <span class="token keyword">FOR</span> <span class="token keyword">column</span> <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token keyword">value</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">AS</span> <span class="token punctuation">]</span> alias <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/38/e3/DjPBUPJ3_o.png" alt="在这里插入图片描述"><br> 目前FROM只支持单表</p> 
<h5><a id="42_sql_67"></a>4.2 sql查询</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 使用curl命令查询</span>
<span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">"localhost:9200/_sql?format=txt"</span> <span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> -d<span class="token string">'
{
  "query": "SELECT * FROM indexName WHERE age &gt; 30"
}'</span>
</code></pre> 
<p>format=txt 是指查询返回结果的数据格式</p> 
<p><img src="https://images2.imgbox.com/8a/4a/AqSwoKzI_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="43_SQLDSL_78"></a>4.3 将SQL转换为DSL</h5> 
<pre><code class="prism language-sql">GET <span class="token operator">/</span>_sql<span class="token operator">/</span>translate
{
<span class="token string">"query"</span>:<span class="token string">"SELECT * FROM es_order limit 1"</span>
}
</code></pre> 
<p>结果如下：</p> 
<pre><code class="prism language-sql">{
  <span class="token string">"size"</span> : <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">"_source"</span> : {
    <span class="token string">"includes"</span> : <span class="token punctuation">[</span>
      <span class="token string">"id"</span><span class="token punctuation">,</span>
      <span class="token string">"orderNo"</span><span class="token punctuation">,</span>
      <span class="token string">"orderTime"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"excludes"</span> : <span class="token punctuation">[</span> <span class="token punctuation">]</span>
  }<span class="token punctuation">,</span>
  <span class="token string">"docvalue_fields"</span> : <span class="token punctuation">[</span>
    {
      <span class="token string">"field"</span> : <span class="token string">"id"</span>
    }<span class="token punctuation">,</span>
    {
      <span class="token string">"field"</span> : <span class="token string">"orderNo"</span>
    }<span class="token punctuation">,</span>
    {
      <span class="token string">"field"</span> : <span class="token string">"orderTime"</span>
    }
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"sort"</span> : <span class="token punctuation">[</span>
    {
      <span class="token string">"_doc"</span> : {
        <span class="token string">"order"</span> : <span class="token string">"asc"</span>
      }
    }
  <span class="token punctuation">]</span>
}
</code></pre> 
<h5><a id="44___121"></a>4.4 全文检索</h5> 
<p>当使用MATCH或QUERY函数时，会启用全文搜索功能，SCORE函数可以用来统计搜索评分。</p> 
<h6><a id="MATCH_123"></a>MATCH函数</h6> 
<pre><code class="prism language-sql"><span class="token keyword">MATCH</span><span class="token punctuation">(</span>
    field_exp<span class="token punctuation">,</span>   
    constant_exp 
    <span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span> 
field_exp：匹配字段
constant_exp：匹配常量表达式
</code></pre> 
<p>用法:</p> 
<pre><code class="prism language-sql">GET <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
<span class="token string">"query"</span>:<span class="token string">"select * from es_order where MATCH(address, '武汉') or MATCH(productType, '手机') limit 10"</span>
}
</code></pre> 
<h6><a id="QUERY_143"></a>QUERY()</h6> 
<p>使用QUERY函数查询address中包含Street的记录。</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
<span class="token string">"query"</span>:<span class="token string">"select id,orderNo,name,address,SCORE()  from es_order where QUERY('address: 武汉') limit 10"</span>
}
</code></pre> 
<h5><a id="45__154"></a>4.5 分组统计</h5> 
<pre><code class="prism language-sql">GET <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
<span class="token string">"query"</span>:<span class="token string">"select city, count(*) as age_cnt from es_order group by city"</span>
}
</code></pre> 
<p>这种方式要更加直观、简洁。</p> 
<p><strong>HAVING</strong><br> 我们可以使用HAVING语句对分组数据进行二次筛选，比如筛选分组记录数量大于1000的信息，查询语句如下。</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
 <span class="token string">"query"</span>:<span class="token string">"select city, count(*) as age_cnt from es_order group by city having count(*) &gt; 1000"</span>
}
</code></pre> 
<p><strong>ORDER BY</strong><br> 使用ORDER BY语句对数据进行排序，比如按照统计字段从高到低排序，查询语句如下。</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
 <span class="token string">"query"</span>:<span class="token string">"select city, count(*) cc as age_cnt from es_order group by city having count(*) &gt; 1000 order by cc "</span>
}
</code></pre> 
<p>注意: 目前Elasticsearch SQL还存在一些限制。例如：不支持JOIN、不支持较复杂的子查询。所以，有一些相对复杂一些的功能，还得借助于DSL方式来实现</p> 
<h5><a id="46_DESCRIBE_188"></a>4.6 DESCRIBE</h5> 
<p>使用DESCRIBE语句查看索引中有哪些字段，比如查看es_order索引的字段，查询语句如下。</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
  <span class="token string">"query"</span>: <span class="token string">"DESCRIBE es_order"</span>
}
</code></pre> 
<h5><a id="47_SHOW_TABLES_199"></a>4.7 SHOW TABLES</h5> 
<p>使用SHOW TABLES查看所有的索引</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
  <span class="token string">"query"</span>: <span class="token string">"SHOW TABLES"</span>
}
</code></pre> 
<h5><a id="48__209"></a>4.8 查询支持的函数</h5> 
<p>使用SQL查询ES中的数据，不仅可以使用一些SQL中的函数，还可以使用一些ES中特有的函数。SHOW FUNCTIONS语句查看所有支持的函数，比如搜索所有带有DATE字段的函数可以使用如下语句。</p> 
<pre><code class="prism language-sql">POST <span class="token operator">/</span>_sql?format<span class="token operator">=</span>txt
{
  <span class="token string">"query"</span>: <span class="token string">"SHOW FUNCTIONS LIKE '%DATE%'"</span>
}
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/f4/iMbG0rV5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_220"></a>五、适用场景及潜在限制</h4> 
<p>Elasticsearch SQL适用于需要对大量数据进行复杂查询的场景，如数据分析、报表生成、数据探索等。然而，由于SQL查询的复杂性，它可能不适用于所有场景。例如，对于需要高并发、低延迟的场景，原生REST查询可能更合适。</p> 
<p>此外，虽然Elasticsearch SQL提供了SQL接口，但它并不是完全兼容SQL。例如，它不支持所有的SQL函数和特性。因此，在使用Elasticsearch SQL时，需要了解它的限制，并根据实际情况选择使用。</p> 
<blockquote> 
 <p>总结来说，Elasticsearch SQL提供了一种直观、易用的方式查询Elasticsearch数据。它允许开发者利用熟悉的SQL语言，编写更直观、更易懂的查询，并避免对大量复杂的原生REST请求的编写。然而，它的适用场景和性能特点需要在实际使用中仔细考虑。</p> 
</blockquote> 
<hr> 
<center> 
 <font color="#c65a6c" size="4"> 关注公众号获取更多技术干货 ! </font> 
</center> 
<p><img src="https://images2.imgbox.com/e0/51/TTwy8NTd_o.gif" alt=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b73edc032649d6a610f183629872b423/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据挖掘——matplotlib</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/145d46c394b56b871cc7cd01e1cdc517/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java客户端调用SOAP方式的WebService服务实现方式分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>