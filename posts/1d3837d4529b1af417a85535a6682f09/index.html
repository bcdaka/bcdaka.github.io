<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python测试框架之Pytest - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1d3837d4529b1af417a85535a6682f09/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python测试框架之Pytest">
  <meta property="og:description" content="初识Pytest Pytest1.Pytest的特点：2.Pytest的基本使用规则3.pytest安装1）使用编译器安装2）使用命令安装 4.pytest规则 Pytest Pytest是python的一个第三方单元测试库，它的目的是让单元测试变得容易，并且也能扩展到支持应用层面复杂的功能测试。
1.Pytest的特点： 1.支持用简单的assert语句实现丰富的断言，无需复杂的self.assert函数
# 相等性断言 assert a == b # 真值断言 当expression值为真时通过 assert expression # 包含断言 assert item in iterable assert item not in iterable # 近似值断言（需要导入pytest.approx） assert a == approx(b) # 异常断言（需要使用到pytest.raises） with pytest.raises(ValueError) as excinfo: func_that_raises() assert str(excinfo.value) == &#34;错误信息&#34; 2.自动识别测试模块以及测试函数
测试文件识别 1.pytest会以命名规则来查找对应测试模块源文件，查找文件的格式为前置test_和后置_test，不符合条件的会被忽略。
2.使用递归查找符合这个规范的文件。
测试函数识别 1.在测试源文件中会将所有test开头的函数或者方法会被认定为测试函数或者测试方法，pytest会执行这些方法，不符合条件的会被忽略。
2.pytest也支持类和方法编写测试，但测试方法同样需要遵循以test开头的命名规则。
自定义规则 1.在pytest.ini中可以修改默认测试发现规则，可以指定不同的测试文件命名规则或者测试函数命名规则。
插件优化 1.开发者可以下载第三方插件来添加新的测试规则以及优化现有的规则。
3.模块化用于管理各种测试资源
pytest管理测试志愿使用的是Fixture机制，它提供了一个为测试用例提供了一个设置资源的机制，使得测试环境、测试数据变得更加模块化和灵活。
4.对unittest完全兼容，对nose基本兼容
对于unittest，pytest可以自动识别并执行unittest风格的测试用例，包括使用unittest编写的测试方法，测试类。这相当于你在unittest中写的自动化测试方法可以容易的进行迁移到pytest中，而不需要大量修改。nose是一个比较老的python框架，但pytest也保持对该框架的兼容，对于大多数的nose测试用例，pytest可以保持基本支持。 5.支持python3和pypy3
现在python3已经成为python的一个主要版本，也是推荐的主流版本，开发者可以使用pytest在python3上进行使用，利用更多python3的特性，提升测试效率。pypy3是一个流行的python解释器，使用即时编译来提高python程序的运行效率，与标准的解释器相比，这个pypy3更加能够提升程序的执行效率，尤其是在处理大量计算或者循环时。 6.丰富的插件生态，社区生态繁荣，维护效率高，可扩展性强
pytest有非常庞大的社区交流地，当开发时遇到困难可以获得及时的解决。使用pytest进行扩展时，因为大量的插件生态而使得开发者可以快速找到自己需要的工具。
2.Pytest的基本使用规则 用例编写规则
1）测试文件名必须以test_或者_test结尾。
​ 如‘test_ab.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-24T11:19:40+08:00">
    <meta property="article:modified_time" content="2024-08-24T11:19:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python测试框架之Pytest</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>初识Pytest</h4> 
 <ul><li><a href="#Pytest_2" rel="nofollow">Pytest</a></li><li><ul><li><a href="#1Pytest_6" rel="nofollow">1.Pytest的特点：</a></li><li><a href="#2Pytest_66" rel="nofollow">2.Pytest的基本使用规则</a></li><li><a href="#3pytest_102" rel="nofollow">3.pytest安装</a></li><li><ul><li><a href="#1_104" rel="nofollow">1）使用编译器安装</a></li><li><a href="#2_123" rel="nofollow">2）使用命令安装</a></li></ul> 
   </li><li><a href="#4pytest_141" rel="nofollow">4.pytest规则</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Pytest_2"></a>Pytest</h2> 
<p>Pytest是python的一个第三方单元测试库，它的目的是让单元测试变得容易，并且也能扩展到支持应用层面复杂的功能测试。</p> 
<h3><a id="1Pytest_6"></a>1.Pytest的特点：</h3> 
<p>1.支持用简单的assert语句实现丰富的断言，无需复杂的<code>self.assert</code>函数</p> 
<pre><code class="prism language-python"><span class="token comment"># 相等性断言</span>
<span class="token keyword">assert</span> a <span class="token operator">==</span> b
<span class="token comment"># 真值断言 当expression值为真时通过</span>
<span class="token keyword">assert</span> expression
<span class="token comment"># 包含断言</span>
<span class="token keyword">assert</span> item <span class="token keyword">in</span> iterable
<span class="token keyword">assert</span> item <span class="token keyword">not</span> <span class="token keyword">in</span> iterable
<span class="token comment"># 近似值断言（需要导入pytest.approx）</span>
<span class="token keyword">assert</span> a <span class="token operator">==</span> approx<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token comment"># 异常断言（需要使用到pytest.raises）</span>
<span class="token keyword">with</span> pytest<span class="token punctuation">.</span>raises<span class="token punctuation">(</span>ValueError<span class="token punctuation">)</span> <span class="token keyword">as</span> excinfo<span class="token punctuation">:</span>
    func_that_raises<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token builtin">str</span><span class="token punctuation">(</span>excinfo<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"错误信息"</span>
</code></pre> 
<p>2.自动识别测试模块以及测试函数</p> 
<blockquote> 
 <ul><li><strong>测试文件识别</strong></li></ul> 
 <p>1.pytest会以命名规则来查找对应测试模块源文件，查找文件的格式为<code>前置test_</code>和<code>后置_test</code>，不符合条件的会被忽略。</p> 
 <p>2.使用递归查找符合这个规范的文件。</p> 
 <ul><li><strong>测试函数识别</strong></li></ul> 
 <p>1.在测试源文件中会将所有<code>test</code>开头的函数或者方法会被认定为测试函数或者测试方法，pytest会执行这些方法，不符合条件的会被忽略。</p> 
 <p>2.pytest也支持类和方法编写测试，但测试方法同样需要遵循以<code>test</code>开头的命名规则。</p> 
 <ul><li><strong>自定义规则</strong></li></ul> 
 <p>1.在<code>pytest.ini</code>中可以修改默认测试发现规则，可以指定不同的测试文件命名规则或者测试函数命名规则。</p> 
 <ul><li>插件优化</li></ul> 
 <p>1.开发者可以下载第三方插件来添加新的测试规则以及优化现有的规则。</p> 
</blockquote> 
<p>3.模块化用于管理各种测试资源</p> 
<blockquote> 
 <p>pytest管理测试志愿使用的是<code>Fixture</code>机制，它提供了一个为测试用例提供了一个设置资源的机制，使得测试环境、测试数据变得更加模块化和灵活。</p> 
</blockquote> 
<p>4.对unittest完全兼容，对nose基本兼容</p> 
<blockquote> 
 <ul><li>对于unittest，pytest可以自动识别并执行unittest风格的测试用例，包括使用unittest编写的测试方法，测试类。这相当于你在unittest中写的自动化测试方法可以容易的进行迁移到pytest中，而不需要大量修改。</li><li>nose是一个比较老的python框架，但pytest也保持对该框架的兼容，对于大多数的nose测试用例，pytest可以保持基本支持。</li></ul> 
</blockquote> 
<p>5.支持python3和pypy3</p> 
<blockquote> 
 <ul><li>现在python3已经成为python的一个主要版本，也是推荐的主流版本，开发者可以使用pytest在python3上进行使用，利用更多python3的特性，提升测试效率。</li><li>pypy3是一个流行的python解释器，使用即时编译来提高python程序的运行效率，与标准的解释器相比，这个pypy3更加能够提升程序的执行效率，尤其是在处理大量计算或者循环时。</li></ul> 
</blockquote> 
<p>6.丰富的插件生态，社区生态繁荣，维护效率高，可扩展性强</p> 
<blockquote> 
 <p>pytest有非常庞大的社区交流地，当开发时遇到困难可以获得及时的解决。使用pytest进行扩展时，因为大量的插件生态而使得开发者可以快速找到自己需要的工具。</p> 
</blockquote> 
<h3><a id="2Pytest_66"></a>2.Pytest的基本使用规则</h3> 
<p>用例编写规则</p> 
<blockquote> 
 <p>1）测试文件名必须以<code>test_</code>或者<code>_test</code>结尾。</p> 
 <p>​ 如‘test_ab.py’</p> 
 <p>2）测试方法必须以<code>test_</code>开头</p> 
 <p>​ 如‘test_add’</p> 
 <p>3）测试类必须以<code>Test</code>开头</p> 
 <p>​ 如‘TestAdd’</p> 
</blockquote> 
<p>用例分类执行</p> 
<blockquote> 
 <p>通过<code>@pytest.mark</code>来标记类和方法，<code>pytest.main</code>加入参数<code>-m</code>可以只运行标记的类和方法。</p> 
</blockquote> 
<p>用例的使用</p> 
<blockquote> 
 <p>pytest中<code>fixture</code>可以任意自定义方法参数，只需要加上<code>@pytest.fixtrue()</code>这个装饰器，那么被装饰的方法就可以进行使用</p> 
</blockquote> 
<p>参数化</p> 
<blockquote> 
 <p>添加<code>@pytest.mark.parametrize</code>装饰器</p> 
</blockquote> 
<p>报告问题</p> 
<blockquote> 
 <p>使用<code>pytest-HTML、allure</code>插件</p> 
</blockquote> 
<p>失败重跑</p> 
<blockquote> 
 <p>支持失败重跑，使用<code>pytest_rerunfailures</code>插件</p> 
</blockquote> 
<h3><a id="3pytest_102"></a>3.pytest安装</h3> 
<h4><a id="1_104"></a>1）使用编译器安装</h4> 
<p>如果你安装了python编译器如：PyCharm<br> 可以使用如下方法进行安装pytest</p> 
<p><img src="https://images2.imgbox.com/d2/a8/bSqZ0e2r_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/79/75/jU23lgOp_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c7/7e/NPJ4hoaZ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/46/1c/0FJkD7zJ_o.png" alt="在这里插入图片描述"></p> 
<p>可以看见项目中添加了该插件。</p> 
<h4><a id="2_123"></a>2）使用命令安装</h4> 
<pre><code class="prism language-python">pip install pytest
</code></pre> 
<p>打开cmd</p> 
<p><img src="https://images2.imgbox.com/ba/be/0aueUchr_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c4/c1/QI0QpGIV_o.png" alt="在这里插入图片描述"></p> 
<p>如果还是不清楚可以查看官网地址</p> 
<p>[pytest]:<a href="https://docs.pytest.org/en/stable/getting-started.html" rel="nofollow">快速入门 - pytest documentation</a></p> 
<h3><a id="4pytest_141"></a>4.pytest规则</h3> 
<p>pytest寻找测试用例</p> 
<p>1）在当前目录及其子目录中运行格式为<code>test_*.py</code>或者<code>*_test.py</code>文件</p> 
<p>2）在当前文件中以<code>Test</code>为开头的类</p> 
<p>[官方规则]:<a href="https://docs.pytest.org/en/stable/explanation/goodpractices.html#conventions-for-python-test-discovery" rel="nofollow">良好的集成实践 - pytest documentation</a></p> 
<blockquote> 
 <p><code>pytest</code>实现以下标准测试发现：</p> 
 <ul><li>如果未指定任何参数，则集合从<a href="https://docs.pytest.org/en/stable/reference/reference.html#confval-testpaths" rel="nofollow"><code>testpaths</code></a>（如果已配置）或当前目录开始。或者，命令行参数 可用于目录、文件名或节点 ID 的任意组合。</li><li>递归到目录中，除非它们匹配<a href="https://docs.pytest.org/en/stable/reference/reference.html#confval-norecursedirs" rel="nofollow"><code>norecursedirs</code></a>。</li><li>在这些目录中，搜索<code>test_*</code> or<code>*_test.py</code> 文件，按其<a href="https://docs.pytest.org/en/stable/explanation/goodpractices.html#test-package-name" rel="nofollow">测试包名称</a>导入。</li><li>从这些文件中，收集测试项： 
   <ul><li><code>test</code>在类之外带前缀的测试函数或方法。</li><li><code>test</code>带前缀的测试类中的测试函数或方法（无方法）。用 和 装饰的方法也被考虑在内。<code>Test``__init__``@staticmethod``@classmethods</code></li></ul> </li></ul> 
 <p>有关如何自定义测试发现的示例<a href="https://docs.pytest.org/en/stable/example/pythoncollection.html" rel="nofollow">：更改标准 （Python） 测试发现</a>。</p> 
 <p>在 Python 模块中，还可以使用标准 unittest 发现测试<a href="https://docs.pytest.org/en/stable/how-to/unittest.html#unittest-testcase" rel="nofollow">。TestCase</a> 子类化技术。</p> 
</blockquote> 
<p>运行一个简单的测试，来测试是否可以正常使用</p> 
<pre><code class="prism language-python"><span class="token comment"># test_login.py</span>

<span class="token keyword">def</span> <span class="token function">test_simple_addition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">2</span>


<span class="token keyword">def</span> <span class="token function">test_another_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">2</span>
    y <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">assert</span> x <span class="token operator">+</span> y <span class="token operator">==</span> <span class="token number">5</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/90/19/Sbp49cmk_o.png" alt="**在这里插入图片描述**"></p> 
<p>需要注意的是<strong>通常你不能直接像运行普通Python脚本那样运行由pytest编写的测试文件</strong>。虽然这些测试文件本质上是Python代码，但它们是为了与pytest测试框架一起工作而设计的，<strong>并且依赖于pytest提供的各种功能和特性来执行测试、收集测试结果和报告错误</strong>。<br> (img-yeOXVJzm-1724469066657)]</p> 
<p>需要注意的是<strong>通常你不能直接像运行普通Python脚本那样运行由pytest编写的测试文件</strong>。虽然这些测试文件本质上是Python代码，但它们是为了与pytest测试框架一起工作而设计的，<strong>并且依赖于pytest提供的各种功能和特性来执行测试、收集测试结果和报告错误</strong>。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39986c9a6d593978dacf252ff93c24b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis-Plus中的MetaObjectHandler</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/426a4ce9e48d25f5c69d17b346f422d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">浅谈Kafka（三）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>