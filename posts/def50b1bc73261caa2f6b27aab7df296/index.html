<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hadoop之Ha高可用搭建教程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/def50b1bc73261caa2f6b27aab7df296/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Hadoop之Ha高可用搭建教程">
  <meta property="og:description" content="目录 前言一、Hadoop集群HA高可用概述二、集群规模三、配置zookeeper集群1.解压zookeeper安装包2.设置环境变量3.配置zoo.cfg配置文件4.分发到其他节点5.修改myid 配置文件6.启动并查看zookeeper状态 四、配置HA高可用1.解压hadoop安装包2.添加环境变量3.修改配置文件4.分发配置文件5.1启动JournalNode5.2安装自动转移机制包6.1初始化namenode6.2格式化zookeeper7.1启动集群7.2查看进程最终实现效果 五、常见问题六、故障转移检测七、HA启动脚本七、总结 前言 随着大数据技术的不断发展，Hadoop作为开源的大数据处理框架，已经广泛应用于各种场景中。然而，在大型生产环境中，Hadoop集群的稳定性和可用性显得尤为重要。为了保障Hadoop集群的高可用性（HA），我们需要采用一系列的技术和策略。本文将重点介绍Hadoop集群的HA高可用方案。
一、Hadoop集群HA高可用概述 Hadoop集群的HA高可用主要指的是在集群中的关键组件出现故障时，能够自动切换到其他节点继续提供服务，从而确保整个集群的稳定运行。
二、集群规模 Hadoop HA高可用集群规划 - 三节点（master, slave1, slave2）
组件masterslave1slave2描述HadoopNameNode主节点备节点无主备部署，共享存储同步元数据SecondaryNameNode主节点无无辅助NameNode，定期合并fsimage和edits logResourceManager主节点备节点无主备部署，实现资源管理和任务调度DataNode有有有存储实际数据，参与数据块的读写操作NodeManager有有有负责管理容器生命周期，与ResourceManager通信 三、配置zookeeper集群 1.解压zookeeper安装包 tar -zxvf zookeeper-3.4.6.tar.gz -C /usr/local/src 2.设置环境变量 位置：vi /.bash_profile
添加环境变量
export ZK_HOME=/usr/local/src/zookeeper export PATH=$PATH:$ZK_HOME/bin 3.配置zoo.cfg配置文件 先创建存放ZK的数据文件和配置文件的zkdata目录mkdir zkdata
配置zoo.cfg文件，在文件中添加下面内容
dataDir=/usr/local/src/zookeeper/zkdata server.1=master:2888:3888 server.2=slave1:2888:3888 server.3=slave2:2888:3888 4.分发到其他节点 scp -r zookeeper/ root@slave2:/usr/local/src 5.修改myid 配置文件 在zkdata目录中创建myid并修改
echo 1&gt;myid (master) echo 2&gt;myid	(slave1) echo 3&gt;myid (slave2) —master
—slave1
—slave2
6.启动并查看zookeeper状态 位置：cd /usr/local/src/zookeeper/bin
启动：./zkServer.sh start
状态：./zkServer.sh status
----master">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-29T18:13:45+08:00">
    <meta property="article:modified_time" content="2024-03-29T18:13:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hadoop之Ha高可用搭建教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#HadoopHA_5" rel="nofollow">一、Hadoop集群HA高可用概述</a></li><li><a href="#_8" rel="nofollow">二、集群规模</a></li><li><a href="#zookeeper_20" rel="nofollow">三、配置zookeeper集群</a></li><li><ul><li><a href="#1zookeeper_21" rel="nofollow">1.解压zookeeper安装包</a></li><li><a href="#2_27" rel="nofollow">2.设置环境变量</a></li><li><a href="#3zoocfg_36" rel="nofollow">3.配置zoo.cfg配置文件</a></li><li><a href="#4_47" rel="nofollow">4.分发到其他节点</a></li><li><a href="#5myid__52" rel="nofollow">5.修改myid 配置文件</a></li><li><a href="#6zookeeper_72" rel="nofollow">6.启动并查看zookeeper状态</a></li></ul> 
  </li><li><a href="#HA_88" rel="nofollow">四、配置HA高可用</a></li><li><ul><li><a href="#1hadoop_90" rel="nofollow">1.解压hadoop安装包</a></li><li><a href="#2_95" rel="nofollow">2.添加环境变量</a></li><li><a href="#3_103" rel="nofollow">3.修改配置文件</a></li><li><a href="#4_236" rel="nofollow">4.分发配置文件</a></li><li><a href="#51JournalNode_242" rel="nofollow">5.1启动JournalNode</a></li><li><a href="#52_248" rel="nofollow">5.2安装自动转移机制包</a></li><li><a href="#61namenode_258" rel="nofollow">6.1初始化namenode</a></li><li><a href="#62zookeeper_267" rel="nofollow">6.2格式化zookeeper</a></li><li><a href="#71_274" rel="nofollow">7.1启动集群</a></li><li><a href="#72_296" rel="nofollow">7.2查看进程</a></li><li><a href="#_298" rel="nofollow">最终实现效果</a></li></ul> 
  </li><li><a href="#_302" rel="nofollow">五、常见问题</a></li><li><a href="#_309" rel="nofollow">六、故障转移检测</a></li><li><a href="#HA_321" rel="nofollow">七、HA启动脚本</a></li><li><a href="#_365" rel="nofollow">七、总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>随着大数据技术的不断发展，Hadoop作为开源的大数据处理框架，已经广泛应用于各种场景中。然而，在大型生产环境中，Hadoop集群的稳定性和可用性显得尤为重要。为了保障Hadoop集群的高可用性（HA），我们需要采用一系列的技术和策略。本文将重点介绍Hadoop集群的HA高可用方案。</p> 
<h2><a id="HadoopHA_5"></a>一、Hadoop集群HA高可用概述</h2> 
<p>Hadoop集群的HA高可用主要指的是在集群中的关键组件出现故障时，能够自动切换到其他节点继续提供服务，从而确保整个集群的稳定运行。</p> 
<h2><a id="_8"></a>二、集群规模</h2> 
<p>Hadoop HA高可用集群规划 - 三节点（master, slave1, slave2）</p> 
<table><thead><tr><th>组件</th><th>master</th><th>slave1</th><th>slave2</th><th>描述</th></tr></thead><tbody><tr><td>Hadoop</td><td></td><td></td><td></td><td></td></tr><tr><td>NameNode</td><td>主节点</td><td>备节点</td><td>无</td><td>主备部署，共享存储同步元数据</td></tr><tr><td>SecondaryNameNode</td><td>主节点</td><td>无</td><td>无</td><td>辅助NameNode，定期合并fsimage和edits log</td></tr><tr><td>ResourceManager</td><td>主节点</td><td>备节点</td><td>无</td><td>主备部署，实现资源管理和任务调度</td></tr><tr><td>DataNode</td><td>有</td><td>有</td><td>有</td><td>存储实际数据，参与数据块的读写操作</td></tr><tr><td>NodeManager</td><td>有</td><td>有</td><td>有</td><td>负责管理容器生命周期，与ResourceManager通信</td></tr></tbody></table> 
<h2><a id="zookeeper_20"></a>三、配置zookeeper集群</h2> 
<h3><a id="1zookeeper_21"></a>1.解压zookeeper安装包</h3> 
<pre><code class="prism language-dart">tar <span class="token operator">-</span>zxvf zookeeper<span class="token operator">-</span><span class="token number">3.4</span><span class="token number">.6</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token class-name">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src
</code></pre> 
<h3><a id="2_27"></a>2.设置环境变量</h3> 
<p>位置：vi /.bash_profile</p> 
<p>添加环境变量</p> 
<pre><code class="prism language-dart"><span class="token keyword">export</span> ZK_HOME<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>zookeeper
<span class="token keyword">export</span> PATH<span class="token operator">=</span>$PATH<span class="token punctuation">:</span>$ZK_HOME<span class="token operator">/</span>bin
</code></pre> 
<h3><a id="3zoocfg_36"></a>3.配置zoo.cfg配置文件</h3> 
<p>先创建存放ZK的数据文件和配置文件的zkdata目录<code>mkdir zkdata</code><br> 配置zoo.cfg文件，在文件中添加下面内容</p> 
<pre><code class="prism language-dart">dataDir<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>zookeeper<span class="token operator">/</span>zkdata
server<span class="token punctuation">.</span><span class="token number">1</span><span class="token operator">=</span>master<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
server<span class="token punctuation">.</span><span class="token number">2</span><span class="token operator">=</span>slave1<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
server<span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">=</span>slave2<span class="token punctuation">:</span><span class="token number">2888</span><span class="token punctuation">:</span><span class="token number">3888</span>
</code></pre> 
<h3><a id="4_47"></a>4.分发到其他节点</h3> 
<pre><code class="prism language-dart">scp <span class="token operator">-</span>r zookeeper<span class="token operator">/</span> root<span class="token metadata function">@slave2</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src
</code></pre> 
<h3><a id="5myid__52"></a>5.修改myid 配置文件</h3> 
<p>在zkdata目录中创建myid并修改</p> 
<pre><code class="prism language-dart">echo <span class="token number">1</span><span class="token operator">&gt;</span>myid <span class="token punctuation">(</span>master<span class="token punctuation">)</span>
echo <span class="token number">2</span><span class="token operator">&gt;</span>myid	<span class="token punctuation">(</span>slave1<span class="token punctuation">)</span>
echo <span class="token number">3</span><span class="token operator">&gt;</span>myid <span class="token punctuation">(</span>slave2<span class="token punctuation">)</span>
</code></pre> 
<p>—master<br> <img src="https://images2.imgbox.com/40/32/JxDXGoZk_o.png" alt="在这里插入图片描述"></p> 
<p>—slave1<br> <img src="https://images2.imgbox.com/9b/fc/52vPAo4y_o.png" alt="在这里插入图片描述"></p> 
<p>—slave2<br> <img src="https://images2.imgbox.com/d5/98/DvEPG1Y1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6zookeeper_72"></a>6.启动并查看zookeeper状态</h3> 
<p>位置：<code>cd /usr/local/src/zookeeper/bin</code><br> 启动：<code>./zkServer.sh start</code><br> 状态：<code>./zkServer.sh status</code></p> 
<p>----master<br> <img src="https://images2.imgbox.com/da/0d/6doLEXZw_o.png" alt="在这里插入图片描述"></p> 
<p>----Slave1<br> <img src="https://images2.imgbox.com/f4/29/JCbFZEDJ_o.png" alt="在这里插入图片描述"></p> 
<p>----Slave2<br> <img src="https://images2.imgbox.com/ff/54/n35Qubjv_o.png" alt="在这里插入图片描述"><br> zookeeper配置完成！</p> 
<h2><a id="HA_88"></a>四、配置HA高可用</h2> 
<h3><a id="1hadoop_90"></a>1.解压hadoop安装包</h3> 
<pre><code class="prism language-dart">tar <span class="token operator">-</span>zxvf hadoop<span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.2</span><span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz <span class="token operator">-</span><span class="token class-name">C</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src 
</code></pre> 
<h3><a id="2_95"></a>2.添加环境变量</h3> 
<pre><code class="prism language-dart"><span class="token keyword">export</span> HADOOP_HOME<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>hadoop
<span class="token keyword">export</span> PATH<span class="token operator">=</span>$PATH<span class="token punctuation">:</span>$HADOOP_HOME<span class="token operator">/</span>bin
</code></pre> 
<h3><a id="3_103"></a>3.修改配置文件</h3> 
<p>位置：<code>/usr/local/src/hadoop/etc/hadoop</code><br> （1）core-site.xml</p> 
<pre><code class="prism language-dart"><span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> hdfs分布式文件系统名字<span class="token operator">/</span>地址 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>fs<span class="token punctuation">.</span>defaultFS<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>hdfs<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>mycluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>存放namenode、datanode数据的根路径 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>hadoop<span class="token punctuation">.</span>tmp<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token operator">/</span>usr<span class="token operator">/</span>loal<span class="token operator">/</span>src<span class="token operator">/</span>hadoop<span class="token operator">/</span>data<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 存放journalnode数据的地址 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>journalnode<span class="token punctuation">.</span>edits<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token operator">/</span>usr<span class="token operator">/</span>loal<span class="token operator">/</span>src<span class="token operator">/</span>hadoop<span class="token operator">/</span>data<span class="token operator">/</span>jn<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 列出运行 <span class="token class-name">ZooKeeper</span> 服务的主机端口对 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>ha<span class="token punctuation">.</span>zookeeper<span class="token punctuation">.</span>quorum<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>master<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>slave1<span class="token punctuation">:</span><span class="token number">2181</span><span class="token punctuation">,</span>slave2<span class="token punctuation">:</span><span class="token number">2181</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
</code></pre> 
<p>（2）hdfs-site.xml</p> 
<pre><code class="prism language-dart"><span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
<span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>replication<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 服务的逻辑名称<span class="token punctuation">,</span>使用mycluster替换master<span class="token punctuation">:</span><span class="token number">9000</span>作为逻辑名称 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>nameservices<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>mycluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 两个namenode的名称 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>namenodes<span class="token punctuation">.</span>mycluster<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>nn1<span class="token punctuation">,</span>nn2<span class="token punctuation">,</span>nn3<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 两个namenode的rpc通信地址 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>rpc<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>master<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>rpc<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn2<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>slave1<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>rpc<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn3<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>slave2<span class="token punctuation">:</span><span class="token number">8020</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> web访问端口 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>http<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn1<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>master<span class="token punctuation">:</span><span class="token number">9870</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>http<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn2<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>slave1<span class="token punctuation">:</span><span class="token number">9870</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>http<span class="token operator">-</span>address<span class="token punctuation">.</span>mycluster<span class="token punctuation">.</span>nn3<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>slave2<span class="token punctuation">:</span><span class="token number">9870</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>shared<span class="token punctuation">.</span>edits<span class="token punctuation">.</span>dir<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>qjournal<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>master<span class="token punctuation">:</span><span class="token number">8485</span><span class="token punctuation">;</span>slave1<span class="token punctuation">:</span><span class="token number">8485</span><span class="token punctuation">;</span>slave2<span class="token punctuation">:</span><span class="token number">8485</span><span class="token operator">/</span>mycluster<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 切换namenode代理类 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>client<span class="token punctuation">.</span>failover<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>provider<span class="token punctuation">.</span>mycluster<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hdfs<span class="token punctuation">.</span>server<span class="token punctuation">.</span>namenode<span class="token punctuation">.</span>ha<span class="token punctuation">.</span></span>ConfiguredFailoverProxyProvider</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 关闭权限检查 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span>enable<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token boolean">false</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 通过SSH连接到<span class="token class-name">Active</span> <span class="token class-name">NameNode</span>并终止进程 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>methods<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span>sshfence<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 隔离机制 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>fencing<span class="token punctuation">.</span>ssh<span class="token punctuation">.</span>private<span class="token operator">-</span>key<span class="token operator">-</span>files<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token operator">/</span>root<span class="token operator">/</span><span class="token punctuation">.</span>ssh<span class="token operator">/</span>id_rsa<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 启动自动故障转移机制 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>property<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>name<span class="token punctuation">&gt;</span></span>dfs<span class="token punctuation">.</span>ha<span class="token punctuation">.</span>automatic<span class="token operator">-</span>failover<span class="token punctuation">.</span>enabled<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>value<span class="token punctuation">&gt;</span></span><span class="token boolean">true</span><span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>

</code></pre> 
<p>(3) hadoop-env.sh</p> 
<pre><code class="prism language-dart"><span class="token keyword">export</span> JAVA_HOME<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>jdk
</code></pre> 
<p>(4) workers</p> 
<pre><code class="prism language-dart">master
slave1
salve2
</code></pre> 
<p>(5)start-dfs.sh 和 stop-dfs.sh</p> 
<p>位置：<code>/usr/local/src/hadoop/sbin</code></p> 
<pre><code class="prism language-dart">HDFS_NAMENODE_USER<span class="token operator">=</span>root
HDFS_JOURNALNODE_USER<span class="token operator">=</span>root
HDFS_ZKFC_USER<span class="token operator">=</span>root
HDFS_DATANODE_USER<span class="token operator">=</span>root
HDFS_DATANODE_SECURE_USER<span class="token operator">=</span>hdfs
HDFS_SECONDARYNAMENODE_USER<span class="token operator">=</span>root
</code></pre> 
<h3><a id="4_236"></a>4.分发配置文件</h3> 
<pre><code class="prism language-dart">scp <span class="token operator">-</span>r hdfs<span class="token operator">-</span>site<span class="token punctuation">.</span>xml root<span class="token metadata function">@slave2</span><span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>src<span class="token operator">/</span>hadoop<span class="token operator">/</span>etc<span class="token operator">/</span>hadoop
</code></pre> 
<h3><a id="51JournalNode_242"></a>5.1启动JournalNode</h3> 
<pre><code class="prism language-dart">hdfs <span class="token operator">--</span>daemon start journalnode
</code></pre> 
<h3><a id="52_248"></a>5.2安装自动转移机制包</h3> 
<pre><code class="prism language-dart">yum <span class="token operator">-</span>y install psmisc
</code></pre> 
<p>如果不安装这个程序包，自动转移故障机制无法进行 fence。<br> 其他的 Standby 状态的NameNode 不能自动切换为 Active状态。</p> 
<h3><a id="61namenode_258"></a>6.1初始化namenode</h3> 
<p>在初始化前要先启动三台节点的zookeeper，并关闭防火墙 <code>systemctl stop firewalld</code></p> 
<pre><code class="prism language-dart">hdfs namenode <span class="token operator">-</span>format
</code></pre> 
<p><img src="https://images2.imgbox.com/41/01/zQzxOJu9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="62zookeeper_267"></a>6.2格式化zookeeper</h3> 
<pre><code class="prism language-dart">hdfs zkfc <span class="token operator">-</span>formatZK
</code></pre> 
<p>判断初始化是否成功：<code>zkCli.sh</code></p> 
<p><img src="https://images2.imgbox.com/ff/ae/qjqudmjO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="71_274"></a>7.1启动集群</h3> 
<p>mater上执行：（只需执行一次）</p> 
<pre><code class="prism language-dart">hdfs <span class="token operator">--</span>daemon start namenode
</code></pre> 
<p>slave1上执行：（只需执行一次）</p> 
<pre><code class="prism language-dart">hdfs namenode <span class="token operator">-</span>bootstrapStandby
</code></pre> 
<p>在mater上启动集群：</p> 
<pre><code class="prism language-dart"><span class="token punctuation">.</span><span class="token operator">/</span>start<span class="token operator">-</span>dfs<span class="token punctuation">.</span>sh
</code></pre> 
<h3><a id="72_296"></a>7.2查看进程</h3> 
<p><img src="https://images2.imgbox.com/d8/59/wumx6Sjr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_298"></a>最终实现效果</h3> 
<p><img src="https://images2.imgbox.com/6b/47/d7vH9kNj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/47/54/8NZTy8So_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/20/3c/unpwACS5_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_302"></a>五、常见问题</h2> 
<p><strong><code>经常有小伙伴在启动完集群后发现zkfc(DFSZKFailoverController)进程没有或是启动失败的情况</code></strong></p> 
<p>解决办法：<br> 步骤一：先去关闭hadoop集群<br> 步骤二：重新格式化zookeeper（<strong>注意：在格式化时要先启动zookeeper</strong>）<br> 步骤三：重新启动hadoop集群</p> 
<h2><a id="_309"></a>六、故障转移检测</h2> 
<p>实现当杀掉第一台节点master后active状态会自动转移到第二台节点slave1或slave2上，且被杀掉的节点页面便不可访问<br> <img src="https://images2.imgbox.com/ab/ee/EMRNJL2W_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-dart">kill <span class="token operator">-</span><span class="token number">9</span> 进程号  <span class="token punctuation">(</span>这里的进程号就是namenode的进程号，如 kill <span class="token operator">-</span><span class="token number">9</span> <span class="token number">14607</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/e6/yCNFPe8b_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6f/4b/Dripse2g_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="HA_321"></a>七、HA启动脚本</h2> 
<pre><code class="prism language-dart">#<span class="token operator">!</span><span class="token operator">/</span>bin<span class="token operator">/</span>bash  
  
<span class="token keyword">if</span> <span class="token punctuation">[</span> $# <span class="token operator">-</span>lt <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then  
    echo <span class="token string-literal"><span class="token string">"No Args Input..."</span></span>  
    exit <span class="token number">1</span><span class="token punctuation">;</span>  
fi  
  
<span class="token keyword">case</span> $<span class="token number">1</span> <span class="token keyword">in</span>  
<span class="token string-literal"><span class="token string">"start"</span></span><span class="token punctuation">)</span>  
    echo <span class="token string-literal"><span class="token string">"----------启动zookeeper----------"</span></span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> master slave1 slave2<span class="token punctuation">;</span> <span class="token keyword">do</span>  
        echo <span class="token string-literal"><span class="token string">"---------- zookeeper </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string"> 启动 ------------"</span></span>  
        ssh $i <span class="token string-literal"><span class="token string">"/usr/local/src/zookeeper/bin/zkServer.sh start"</span></span> <span class="token operator">&amp;&amp;</span> echo <span class="token string-literal"><span class="token string">"Zookeeper </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string"> 启动成功"</span></span>  
    done  
    echo <span class="token string-literal"><span class="token string">"---------- 启动hdfs------------"</span></span>  
    ssh master <span class="token string-literal"><span class="token string">"/usr/local/src/hadoop/sbin/start-dfs.sh"</span></span> <span class="token operator">&amp;&amp;</span> echo <span class="token string-literal"><span class="token string">"HDFS 启动成功"</span></span>  
    echo <span class="token string-literal"><span class="token string">"---------- hadoop HA启动成功------------"</span></span>  
    <span class="token punctuation">;</span><span class="token punctuation">;</span>  
<span class="token string-literal"><span class="token string">"stop"</span></span><span class="token punctuation">)</span>  
    echo <span class="token string-literal"><span class="token string">"----------关闭hdfs----------"</span></span>  
    ssh master <span class="token string-literal"><span class="token string">"/usr/local/src/hadoop/sbin/stop-dfs.sh"</span></span> <span class="token operator">&amp;&amp;</span> echo <span class="token string-literal"><span class="token string">"HDFS 关闭成功"</span></span>  
    echo <span class="token string-literal"><span class="token string">"----------关闭zookeeper----------"</span></span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> master slave1 slave2<span class="token punctuation">;</span> <span class="token keyword">do</span>  
        echo <span class="token string-literal"><span class="token string">"---------- zookeeper </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string"> 停止 ------------"</span></span>  
        ssh $i <span class="token string-literal"><span class="token string">"/usr/local/src/zookeeper/bin/zkServer.sh stop"</span></span> <span class="token operator">&amp;&amp;</span> echo <span class="token string-literal"><span class="token string">"Zookeeper </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string"> 停止成功"</span></span>  
    done  
    echo <span class="token string-literal"><span class="token string">"---------- hadoop HA停止成功------------"</span></span>  
    <span class="token punctuation">;</span><span class="token punctuation">;</span>  
<span class="token string-literal"><span class="token string">"status"</span></span><span class="token punctuation">)</span>  
    echo <span class="token string-literal"><span class="token string">"----------检查zookeeper状态----------"</span></span>  
    <span class="token keyword">for</span> i <span class="token keyword">in</span> master slave1 slave2<span class="token punctuation">;</span> <span class="token keyword">do</span>  
        echo <span class="token string-literal"><span class="token string">"---------- zookeeper </span><span class="token interpolation"><span class="token punctuation">$</span><span class="token expression">i</span></span><span class="token string"> 状态 ------------"</span></span>  
        ssh $i <span class="token string-literal"><span class="token string">"/usr/local/src/zookeeper/bin/zkServer.sh status"</span></span>  
    done  
    <span class="token punctuation">;</span><span class="token punctuation">;</span>  
<span class="token operator">*</span><span class="token punctuation">)</span>  
    echo <span class="token string-literal"><span class="token string">"Input Args Error"</span></span>  
    <span class="token punctuation">;</span><span class="token punctuation">;</span>  
esac
</code></pre> 
<h2><a id="_365"></a>七、总结</h2> 
<p>Hadoop集群的HA高可用方案是保障集群稳定性和可用性的重要手段。通过合理配置NameNode、ResourceManager等关键组件的高可用策略，并结合共享存储、ZooKeeper等技术手段，我们可以有效地提高Hadoop集群的容错能力和服务水平。在实际应用中，我们需要根据集群的规模和业务需求来选择合适的HA高可用方案，并进行持续的监控和优化，以确保集群的稳定运行和高效处理大数据任务。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bf3c348dbaaf1259b525a866903343af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python中的deque详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1ac0f213965ec83b350ab56385b4e902/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">头歌｜HDFS实战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>