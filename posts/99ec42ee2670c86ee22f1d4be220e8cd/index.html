<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DolphinScheduler3 对 Zookeeper 兼容版本的问题解决 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/99ec42ee2670c86ee22f1d4be220e8cd/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="DolphinScheduler3 对 Zookeeper 兼容版本的问题解决">
  <meta property="og:description" content="兼容版本环境：
DolphinScheduler 3.2.0
CDH 6.3.2
Zookeeper 3.4.5
curater-client-4.2.0
curator-recipes-4.2.0
curator-famework-4.2.0
官网：
集群部署、数据源配置：
https://dolphinscheduler.apache.org/zh-cn/docs/3.2.0/guide/installation/clusterss
https://github.com/apache/dolphinscheduler/blob/3.2.0-release/docs/docs/zh/guide/howto/datasource-setting.md
其他：
1、dolphin3.0在伪集群模式下总是会报zookeeper Failed to delete registry key，我该怎么排查这个问题 · apache/dolphinscheduler · Discussion #11948 · GitHub
2、Apache DolphinScheduler 3.0.0 升级到 3.1.8 教程 - 腾讯云开发者社区-腾讯云​​​​​​
3、Jar查找，Jar下载，class文件，Maven仓库查询，Gradle引入代码 -时代Java
注意：无论standalone还是集群模式搭建过程中，涉及修改配置都需要执行
# Mysql元数据初始化 bash tools/bin/upgrade-schema.sh 以及
# 集群启动初始化，ust006 scp免密安装分发到其他节点 bash ./bin/install.sh 另外，部署时，保持查看dolphinscheduler集群状态、worker-server的日志
bash ./bin/status-all.sh tail -f logs/dolphinscheduler-worker.log 再次启动后，若出现问题：
[ERROR] 2020-12-10 15:35:03.650 org.apache.dolphinscheduler.remote.NettyRemotingServer:[167] - NettyRemotingServer bind fail bind(..) failed: 地址已在使用, exit io.netty.channel.unix.Errors$NativeIoException: bind(.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-12T16:13:58+08:00">
    <meta property="article:modified_time" content="2023-12-12T16:13:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DolphinScheduler3 对 Zookeeper 兼容版本的问题解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>兼容版本环境：</p> 
<p>DolphinScheduler 3.2.0</p> 
<p>CDH 6.3.2</p> 
<p>Zookeeper 3.4.5</p> 
<p>curater-client-4.2.0</p> 
<p>curator-recipes-4.2.0</p> 
<p>curator-famework-4.2.0</p> 
<p></p> 
<p>官网：</p> 
<p>集群部署、数据源配置：</p> 
<p><a href="https://dolphinscheduler.apache.org/zh-cn/docs/3.2.0/guide/installation/cluster" rel="nofollow" title="https://dolphinscheduler.apache.org/zh-cn/docs/3.2.0/guide/installation/clusterss">https://dolphinscheduler.apache.org/zh-cn/docs/3.2.0/guide/installation/clusterss</a></p> 
<p><a href="https://github.com/apache/dolphinscheduler/blob/3.2.0-release/docs/docs/zh/guide/howto/datasource-setting.md" title="https://github.com/apache/dolphinscheduler/blob/3.2.0-release/docs/docs/zh/guide/howto/datasource-setting.md">https://github.com/apache/dolphinscheduler/blob/3.2.0-release/docs/docs/zh/guide/howto/datasource-setting.md</a></p> 
<p>其他：</p> 
<p>1、<a href="https://github.com/apache/dolphinscheduler/discussions/11948" title="dolphin3.0在伪集群模式下总是会报zookeeper  Failed to delete registry key，我该怎么排查这个问题 · apache/dolphinscheduler · Discussion #11948 · GitHub">dolphin3.0在伪集群模式下总是会报zookeeper Failed to delete registry key，我该怎么排查这个问题 · apache/dolphinscheduler · Discussion #11948 · GitHub</a><br> 2、<a href="https://cloud.tencent.com/developer/news/1251062" rel="nofollow" title="Apache DolphinScheduler 3.0.0 升级到 3.1.8 教程 - 腾讯云开发者社区-腾讯云​​​​​​">Apache DolphinScheduler 3.0.0 升级到 3.1.8 教程 - 腾讯云开发者社区-腾讯云​​​​​​</a></p> 
<p>3、<a href="https://nowjava.com/jar/" rel="nofollow" title="Jar查找，Jar下载，class文件，Maven仓库查询，Gradle引入代码 -时代Java">Jar查找，Jar下载，class文件，Maven仓库查询，Gradle引入代码 -时代Java</a><br>  </p> 
<p><img alt="" height="316" src="https://images2.imgbox.com/4b/96/GwkbIfMC_o.png" width="1043"><img alt="" height="1200" src="https://images2.imgbox.com/c3/b4/zOt84EvG_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<p>注意：无论standalone还是集群模式搭建过程中，涉及修改配置都需要执行</p> 
<pre><code class="language-bash"># Mysql元数据初始化
bash tools/bin/upgrade-schema.sh</code></pre> 
<p>以及</p> 
<pre><code class="language-bash"># 集群启动初始化，ust006 scp免密安装分发到其他节点
bash ./bin/install.sh</code></pre> 
<p>另外，部署时，保持查看dolphinscheduler集群状态、worker-server的日志</p> 
<pre><code>bash ./bin/status-all.sh

tail -f logs/dolphinscheduler-worker.log</code></pre> 
<p><br> 再次启动后，若出现问题：</p> 
<pre><code class="language-bash">[ERROR] 2020-12-10 15:35:03.650 org.apache.dolphinscheduler.remote.NettyRemotingServer:[167] - NettyRemotingServer bind fail bind(..) failed: 地址已在使用, exit
io.netty.channel.unix.Errors$NativeIoException: bind(..) failed: 地址已在使用</code></pre> 
<p>说明Zookeeper在启动时，stop状态的worker-server节点的zookeeper注册端口1234已被占用，kill掉即可</p> 
<pre><code class="language-bash">netstat -alnp | grep 50010

kill -9 进程ID</code></pre> 
<p><a href="https://blog.csdn.net/qq_43437122/article/details/104896681" title="java.net.BindException: 地址已在使用 (Bind failed)（HadoopDataNode无法启动）-CSDN博客">java.net.BindException: 地址已在使用 (Bind failed)（HadoopDataNode无法启动）-CSDN博客</a><img alt="" height="809" src="https://images2.imgbox.com/b7/70/Rbjb0MqH_o.png" width="1033"></p> 
<p><a href="https://github.com/apache/dolphinscheduler/issues/4199" title="[Question]When I run spark on Yarn job, unread the log. · Issue #4199 · apache/dolphinscheduler · GitHub">[Question]When I run spark on Yarn job, unread the log. · Issue #4199 · apache/dolphinscheduler · GitHub</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/8e/ad/R2sbk3Jl_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<pre><code class="language-bash">集群模式
[xxx@uat006 env]$ cat dolphinscheduler_env.sh
#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#


# Never put sensitive config such as database password here in your production environment,
# this file will be sourced everytime a new task is executed.

# applicationId auto collection related configuration, the following configurations are unnecessary if setting appId.collect=log
#export HADOOP_CLASSPATH=`hadoop classpath`:${DOLPHINSCHEDULER_HOME}/tools/libs/*
#export SPARK_DIST_CLASSPATH=$HADOOP_CLASSPATH:$SPARK_DIST_CLASS_PATH
#export HADOOP_CLIENT_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$HADOOP_CLIENT_OPTS
#export SPARK_SUBMIT_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$SPARK_SUBMIT_OPTS
#export FLINK_ENV_JAVA_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$FLINK_ENV_JAVA_OPTS

# JAVA_HOME, will use it to start DolphinScheduler server
export JAVA_HOME=/usr/java/jdk1.8.0_181

# Database related configuration, set database type, username and password
export DATABASE=mysql
export SPRING_PROFILES_ACTIVE=${DATABASE}
export SPRING_DATASOURCE_URL="jdbc:mysql://uat001:3306/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false"
export SPRING_DATASOURCE_USERNAME=dolphinscheduler
export SPRING_DATASOURCE_PASSWORD=123456

# DolphinScheduler server related configuration
export SPRING_CACHE_TYPE=${SPRING_CACHE_TYPE:-none}
export SPRING_JACKSON_TIME_ZONE=${SPRING_JACKSON_TIME_ZONE:-UTC}
export MASTER_FETCH_COMMAND_NUM=${MASTER_FETCH_COMMAND_NUM:-10}

# Registry center configuration, determines the type and link of the registry center
export REGISTRY_TYPE=${REGISTRY_TYPE:-zookeeper}
export REGISTRY_ZOOKEEPER_CONNECT_STRING=${REGISTRY_ZOOKEEPER_CONNECT_STRING:-172.11.111.xx0:2181,172.11.111.xx1:2181,172.11.111.xx2:2181,172.11.111.xx3:2181,172.11.111.xx4:2181}

# Tasks related configurations, need to change the configuration if you use the related tasks.
export HADOOP_HOME=${HADOOP_HOME:-/opt/soft/hadoop}
export HADOOP_CONF_DIR=${HADOOP_CONF_DIR:-/opt/soft/hadoop/etc/hadoop}
export SPARK_HOME=${SPARK_HOME:-/opt/soft/spark}
export PYTHON_LAUNCHER=${PYTHON_LAUNCHER:-/opt/soft/python}
export HIVE_HOME=${HIVE_HOME:-/opt/soft/hive}
export FLINK_HOME=${FLINK_HOME:-/opt/soft/flink}
export DATAX_LAUNCHER=${DATAX_LAUNCHER:-/opt/soft/datax/bin/python3}

export PATH=$HADOOP_HOME/bin:$SPARK_HOME/bin:$PYTHON_LAUNCHER:$JAVA_HOME/bin:$HIVE_HOME/bin:$FLINK_HOME/bin:$DATAX_LAUNCHER:$PATH




单机模式
[xxx@uat006 env]$ cat dolphinscheduler_env.sh.baktand 
#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#


# Never put sensitive config such as database password here in your production environment,
# this file will be sourced everytime a new task is executed.

# applicationId auto collection related configuration, the following configurations are unnecessary if setting appId.collect=log
#export HADOOP_CLASSPATH=`hadoop classpath`:${DOLPHINSCHEDULER_HOME}/tools/libs/*
#export SPARK_DIST_CLASSPATH=$HADOOP_CLASSPATH:$SPARK_DIST_CLASS_PATH
#export HADOOP_CLIENT_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$HADOOP_CLIENT_OPTS
#export SPARK_SUBMIT_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$SPARK_SUBMIT_OPTS
#export FLINK_ENV_JAVA_OPTS="-javaagent:${DOLPHINSCHEDULER_HOME}/tools/libs/aspectjweaver-1.9.7.jar":$FLINK_ENV_JAVA_OPTS

export DATABASE=mysql
export SPRING_PROFILES_ACTIVE=${DATABASE}
export SPRING_DATASOURCE_URL="jdbc:mysql://uat001/dolphinscheduler?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false"
export SPRING_DATASOURCE_USERNAME=root
export SPRING_DATASOURCE_PASSWORD=123456




[xxx@uat006 env]$ cat install_env.sh 
#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# ---------------------------------------------------------
# INSTALL MACHINE
# ---------------------------------------------------------
# A comma separated list of machine hostname or IP would be installed DolphinScheduler,
# including master, worker, api, alert. If you want to deploy in pseudo-distributed
# mode, just write a pseudo-distributed hostname
# Example for hostnames: ips="ds1,ds2,ds3,ds4,ds5", Example for IPs: ips="192.168.8.1,192.168.8.2,192.168.8.3,192.168.8.4,192.168.8.5"
ips=${ips:-"uat001,uat002,uat003,uat004,uat005,uat006"}

# Port of SSH protocol, default value is 22. For now we only support same port in all `ips` machine
# modify it if you use different ssh port
sshPort=${sshPort:-"22"}

# A comma separated list of machine hostname or IP would be installed Master server, it
# must be a subset of configuration `ips`.
# Example for hostnames: masters="ds1,ds2", Example for IPs: masters="192.168.8.1,192.168.8.2"
masters=${masters:-"uat001,uat002"}

# A comma separated list of machine &lt;hostname&gt;:&lt;workerGroup&gt; or &lt;IP&gt;:&lt;workerGroup&gt;.All hostname or IP must be a
# subset of configuration `ips`, And workerGroup have default value as `default`, but we recommend you declare behind the hosts
# Example for hostnames: workers="ds1:default,ds2:default,ds3:default", Example for IPs: workers="192.168.8.1:default,192.168.8.2:default,192.168.8.3:default"
workers=${workers:-"uat003:default,uat004:default,uat005:default,uat006:default"}

# A comma separated list of machine hostname or IP would be installed Alert server, it
# must be a subset of configuration `ips`.
# Example for hostname: alertServer="ds3", Example for IP: alertServer="192.168.8.3"
alertServer=${alertServer:-"uat002"}

# A comma separated list of machine hostname or IP would be installed API server, it
# must be a subset of configuration `ips`.
# Example for hostname: apiServers="ds1", Example for IP: apiServers="192.168.8.1"
apiServers=${apiServers:-"uat001"}

# The directory to install DolphinScheduler for all machine we config above. It will automatically be created by `install.sh` script if not exists.
# Do not set this configuration same as the current path (pwd). Do not add quotes to it if you using related path.
installPath=${installPath:-"~/dolphinscheduler"}

# The user to deploy DolphinScheduler for all machine we config above. For now user must create by yourself before running `install.sh`
# script. The user needs to have sudo privileges and permissions to operate hdfs. If hdfs is enabled than the root directory needs
# to be created by this user
deployUser=${deployUser:-"xxx"}

# The root of zookeeper, for now DolphinScheduler default registry server is zookeeper.
# It will delete ${zkRoot} in the zookeeper when you run install.sh, so please keep it same as registry.zookeeper.namespace in yml files.
# Similarly, if you want to modify the value, please modify registry.zookeeper.namespace in yml files as well.
zkRoot=${zkRoot:-"/dolphinscheduler"}
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ee271a3fdbaf82acfbc1d97222a02a8f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTML &#43; JavaScript 实现网页录制音频与下载</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fd2fb4ab62628727d19d85778ebfcc15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL8详细安装教程及环境变量配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>