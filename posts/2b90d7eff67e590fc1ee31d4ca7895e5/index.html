<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Go语言】Gin 框架教程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2b90d7eff67e590fc1ee31d4ca7895e5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Go语言】Gin 框架教程">
  <meta property="og:description" content="Gin 框架教程 1.第一个 Gin 程序 1.1 Gin 安装 # 执行执行如下操作即可，安装Gin前需要安装Go环境 go get -u -v github.com/gin-gonic/gin # -v：打印出被构建的代码包的名字 # -u：已存在相关的代码包，强行更新代码包及其依赖包 1.2 Gin 项目创建 在一个空文件夹里新建文件 main.go，参考如下代码编写一个 Gin 程序。
// blog.euansu.cn // main.go package main import &#34;github.com/gin-gonic/gin&#34; func main() { r := gin.Default() r.GET(&#34;/&#34;, func(c *gin.Context) { c.String(200, &#34;Hello, EuanSu&#34;) }) r.Run() // listen and serve on 0.0.0.0:8080 } 运行 main.go 程序，如下图所示。
go run main.go 代码说明：
首先，r := gin.Default()这里生成了一个 Gin 引擎实例，用于处理 HTTP 请求，也即 WSGI 应用程序，这个实例会预先加载一些默认的中间件。r.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-16T15:37:05+08:00">
    <meta property="article:modified_time" content="2024-06-16T15:37:05+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Go语言】Gin 框架教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Gin__0"></a>Gin 框架教程</h2> 
<h3><a id="1_Gin__2"></a>1.第一个 Gin 程序</h3> 
<h4><a id="11_Gin__4"></a>1.1 Gin 安装</h4> 
<pre><code class="prism language-shell"><span class="token comment"># 执行执行如下操作即可，安装Gin前需要安装Go环境</span>
go get <span class="token parameter variable">-u</span> <span class="token parameter variable">-v</span> github.com/gin-gonic/gin
<span class="token comment"># -v：打印出被构建的代码包的名字</span>
<span class="token comment"># -u：已存在相关的代码包，强行更新代码包及其依赖包</span>
</code></pre> 
<h4><a id="12_Gin__13"></a>1.2 Gin 项目创建</h4> 
<p>在一个空文件夹里新建文件 <code>main.go</code>，参考如下代码编写一个 <code>Gin</code> 程序。</p> 
<pre><code class="prism language-go"><span class="token comment">// blog.euansu.cn</span>
<span class="token comment">// main.go</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"github.com/gin-gonic/gin"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"Hello, EuanSu"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行 <code>main.go</code> 程序，如下图所示。</p> 
<pre><code class="prism language-shell">go run main.go
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/30/xPrN4pw6_o.png" alt="在这里插入图片描述"></p> 
<p>代码说明：</p> 
<ol><li>首先，<code>r := gin.Default()</code>这里生成了一个 <code>Gin</code> 引擎实例，用于处理 <code>HTTP</code> 请求，也即 <code>WSGI</code> 应用程序，这个实例会预先加载一些默认的中间件。</li><li><code>r.GET("/", ...)</code> 则是声明了一个路由，以及路由对应的函数方法。</li><li><code>r.Run()</code> 函数则是运行应用程序，默认的监听端口是 <code>8080</code>，也可以传入参数设置应用程序运行端口，例如 <code>r.Run(":8888")</code>，即应用运行在 <code>8888</code> 端口。</li></ol> 
<h4><a id="13__47"></a>1.3 网站图标设置</h4> 
<p>这里使用一个 <code>Gin</code> 的中间件 <code>github.com/thinkerou/favicon</code>，使用同 <code>gin</code> 框架，首先是安装 <code>github.com/thinkerou/favicon</code> 库。</p> 
<pre><code class="prism language-shell">go get github.com/thinkerou/favicon
</code></pre> 
<p>接下来，则是使用该中间件，代码如下所示：</p> 
<pre><code class="prism language-go"><span class="token comment">// blog.euansu.cn</span>
<span class="token comment">// main.go</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/thinkerou/favicon"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个服务</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 使用中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>favicon<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"./static/favicon.ico"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 路由函数</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"Hello, EuanSu"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>项目运行后，就能够在浏览器中看到 <code>favicon.ico</code> 网站图标。</p> 
<p><img src="https://images2.imgbox.com/f8/a8/YqHQP6lK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2Gin__86"></a>2.Gin 中的路由</h3> 
<h4><a id="21__88"></a>2.1 路由语法</h4> 
<pre><code class="prism language-go">$router<span class="token punctuation">.</span>$<span class="token function">method</span><span class="token punctuation">(</span><span class="token string">"$router"</span><span class="token punctuation">,</span> $handlerFunction<span class="token punctuation">)</span>
# router，Gin 引擎实例
# method，http路由方法，可选参数为：GET、POST、PUT、PATCH、DELETE、OPTIONS、HEAD以及能够处理任意类型的HTTP请求的Any和处理指定类型的HTTP请求的Match
# handlerFunction，路由函数，处理路由响应
</code></pre> 
<p>示例如下：</p> 
<pre><code class="prism language-go">router<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 获取资源</span>
router<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 创建资源	</span>
router<span class="token punctuation">.</span><span class="token function">PUT</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 更新资源</span>
router<span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 							<span class="token comment">// 删除资源</span>
router<span class="token punctuation">.</span><span class="token function">PATCH</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 更新部分资源</span>
router<span class="token punctuation">.</span><span class="token function">OPTIONS</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 							<span class="token comment">// 获取服务器支持的 HTTP 方法</span>
router<span class="token punctuation">.</span><span class="token function">HEAD</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 获取资源的头部信息</span>
router<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 								<span class="token comment">// 处理任意类型的 HTTP 请求</span>
router<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">"/path"</span><span class="token punctuation">,</span> handlerFunction<span class="token punctuation">)</span> 	<span class="token comment">// 处理指定类型的 HTTP 请求</span>
</code></pre> 
<h4><a id="22__111"></a>2.2 请求参数的处理</h4> 
<h5><a id="221__113"></a>2.2.1 路由参数解析</h5> 
<p>参数包含在路由中，如 <code>/user/:name</code>，通过调用不同的 <code>路由参数</code> 传入不同的 <code>name</code>，如下所示：</p> 
<pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/user/:name"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    name <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"%s, Welcome to your clicl."</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/64/rxUNskmO_o.png" alt="在这里插入图片描述"></p> 
<p>这里需要注意下，如果新增了路由，需要重启 <code>Gin</code> 程序，重启之后，再次访问路由地址，就能够正常解析路由参数了。</p> 
<p><img src="https://images2.imgbox.com/ce/ee/USYCvx3T_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="222_Query__130"></a>2.2.2 Query 参数解析</h5> 
<p><code>Query 参数</code> 与上文的路由参数一样，参数都是路由的一部分，不同的是 <code>Query 参数</code> 是键值对的形式，查询参数通常位于URL的问号（<code>?</code>）之后，以键值对的形式出现，并且多个参数之间用与号（<code>&amp;</code>）分隔。</p> 
<pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    name <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"%s, Thank you for your click."</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/76/b1/ckcJmgYV_o.png" alt="在这里插入图片描述"></p> 
<p>也可以直接使用 <code>URL</code> 通过浏览器请求该接口。</p> 
<p><img src="https://images2.imgbox.com/46/e3/ojvNCxjr_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="223_POST_form_147"></a>2.2.3 POST 参数解析（form表单）</h5> 
<p>这里使用一个表单参数进行举例，如下所示，输入分数转化为及格、不及格的判断，代码如下所示。</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"strconv"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">evaluateScore</span><span class="token punctuation">(</span>score <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> score <span class="token operator">&gt;=</span> <span class="token number">90</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"优秀"</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> score <span class="token operator">&gt;=</span> <span class="token number">60</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"及格"</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"不及格"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// POST参数解析</span>
	<span class="token comment">// POST</span>
	r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
        <span class="token comment">// DefaultPostForm，只支持string类型，因此需要进行类型的转换</span>
		scoreStr <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">DefaultPostForm</span><span class="token punctuation">(</span><span class="token string">"score"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
		score<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>scoreStr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 处理错误情况，例如当输入的值不是整数时</span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"Invalid score"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		result <span class="token operator">:=</span> <span class="token function">evaluateScore</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"username"</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">"score"</span><span class="token punctuation">:</span> score<span class="token punctuation">,</span> <span class="token string">"evaluation"</span><span class="token punctuation">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>
r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/form"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    username <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">PostForm</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span>
    password <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">DefaultPostForm</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">"000000"</span><span class="token punctuation">)</span> <span class="token comment">// 可设置默认值</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"%s, Thank you for your login."</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>请求后端的接口，返回如下。</p> 
<p><img src="https://images2.imgbox.com/e1/57/ybY59EBc_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="224_POST_json_203"></a>2.2.4 POST 参数解析（json）</h5> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"net/http"</span>
	<span class="token string">"strconv"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">evaluateScore</span><span class="token punctuation">(</span>score <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> score <span class="token operator">&gt;=</span> <span class="token number">90</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"优秀"</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> score <span class="token operator">&gt;=</span> <span class="token number">60</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"及格"</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token string">"不及格"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义结构体，与JSON数据匹配</span>
<span class="token keyword">type</span> Person <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Username <span class="token builtin">string</span> <span class="token string">`json:"username"`</span>
	Score    <span class="token builtin">int</span>    <span class="token string">`json:"score"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 处理POST请求，接收JSON参数</span>
	r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/json"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">var</span> person Person

		<span class="token comment">// 绑定JSON到结构体</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token punctuation">}</span>

		result <span class="token operator">:=</span> <span class="token function">evaluateScore</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>Score<span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"username"</span><span class="token punctuation">:</span> person<span class="token punctuation">.</span>Username<span class="token punctuation">,</span> <span class="token string">"score"</span><span class="token punctuation">:</span> person<span class="token punctuation">.</span>Score<span class="token punctuation">,</span> <span class="token string">"evaluation"</span><span class="token punctuation">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>请求后端的接口，返回如下。</p> 
<p><img src="https://images2.imgbox.com/cd/b6/bdRfJ7SY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="23__256"></a>2.3 路由处理</h4> 
<h5><a id="231__258"></a>2.3.1 重定向</h5> 
<pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/redirect"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">Redirect</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusMovedPermanently<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>如下所示，当后端收到 <code>/redirect</code> 路由的请求，会重定向至 <code>/</code>。</p> 
<p><img src="https://images2.imgbox.com/d4/f8/27wXrgRB_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="232__270"></a>2.3.2 分组路由</h5> 
<p>分组路由主要是为了处理路由前缀一致的情况，例如有一组路由前缀都是 <code>/api/v1</code> 开头，通过分组路由就能够简化路由的定义，也可以更好的实现路由的权限控制，例如将需要登录的路由放到同一分组中。代码示例如下：</p> 
<pre><code class="prism language-go"><span class="token comment">// 默认的路由方法</span>
defaultHandler <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span>
        <span class="token string">"path"</span><span class="token punctuation">:</span> c<span class="token punctuation">.</span><span class="token function">FullPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// group: v1</span>
v1 <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"/v1"</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    v1<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/posts"</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span>
    v1<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/series"</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// group: v2</span>
v2 <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">"/v2"</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    v2<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/posts"</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span>
    v2<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/series"</span><span class="token punctuation">,</span> defaultHandler<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>请求不同的路由地址，均能够得到正常的响应。</p> 
<p><img src="https://images2.imgbox.com/81/20/5fAQVHAK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e3/e8/36Jo73hD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3RESTful_API_302"></a>3.RESTful API</h3> 
<p><code>RESTful API</code> 具体概念可以查看 <code>https://blog.euansu.cn/post/djangorestframework/</code> 这篇文章中关于 <code>RESTful API</code> 的相关介绍 。</p> 
<p>使用 <code>Go</code> 语言能够快速的实现 <code>RESTful API</code>，实现如下：</p> 
<pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"get user"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"post user"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">PUT</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"put user"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"delete user"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用 <code>Apifox</code> 等接口测试工具测试，应用程序能够根据使用的 <code>HTTP</code> 请求方式的不同而使用不同的函数进行处理。</p> 
<ul><li> <p><code>GET</code> 请求</p> <p><img src="https://images2.imgbox.com/47/94/NIfcRW5O_o.png" alt="在这里插入图片描述"></p> </li><li> <p><code>POST</code> 请求</p> <p><img src="https://images2.imgbox.com/4d/bd/ENBG1cXu_o.png" alt="在这里插入图片描述"></p> </li><li> <p><code>PUT</code> 请求</p> <p><img src="https://images2.imgbox.com/54/44/XmMiAGbL_o.png" alt="在这里插入图片描述"></p> </li><li> <p><code>DELETE</code> 请求</p> <p><img src="https://images2.imgbox.com/bf/58/zt5dwPuz_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<p>如上测试所示，<code>Gin</code> 框架能够快速、简洁的实现 <code>RESTful API</code>。</p> 
<h3><a id="4_345"></a>4.响应页面</h3> 
<p>可以通过以下方式，先加载静态页面到 <code>Gin</code> 应用程序中。</p> 
<pre><code class="prism language-go"><span class="token comment">// 加载静态页面</span>
r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/*"</span><span class="token punctuation">)</span>
<span class="token comment">// 加载指定的静态页面（不推荐）</span>
r<span class="token punctuation">.</span><span class="token function">LoadHTMLFiles</span><span class="token punctuation">(</span><span class="token string">"templates/index.html"</span><span class="token punctuation">)</span>
</code></pre> 
<p>路由函数</p> 
<pre><code class="prism language-go">r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>打开浏览器，访问 <code>Gin</code> 的 <code>/</code> 路由，显示如下。</p> 
<p><img src="https://images2.imgbox.com/f8/65/kWo31Gdl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_368"></a>5.中间件</h3> 
<p>首先是在项目中，声明一个中间件方法 <code>myHandler()</code>，如下是 <code>myHandler()</code> 的代码方法。</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">myHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 设置中间件的值</span>
		c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"usersession"</span><span class="token punctuation">,</span> <span class="token string">"xxx"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">==</span> <span class="token string">"/"</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 阻止</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"阻止"</span><span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 放行</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"放行"</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 <code>Gin</code> 应用程序中使用这个中间件。</p> 
<pre><code class="prism language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个服务</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 使用中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">myHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token operator">...</span>
    
	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>实际测试效果如下：</p> 
<ul><li> <p>请求 <code>/</code> 路由，后端返回为空。</p> <p><img src="https://images2.imgbox.com/b4/69/B6RU1da9_o.png" alt="在这里插入图片描述"></p> </li><li> <p>请求其他的路由，则不受影响，就如我们在中间件方法所写的判断一样，仅仅只是拦截了 <code>/</code> 的路由请求。</p> <p><img src="https://images2.imgbox.com/d4/06/CeV94sFx_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h3><a id="6_413"></a>6.数据库</h3> 
<p><code>Gin</code> 项目中使用数据库，涉及以下操作：</p> 
<ol><li>安装数据库驱动和 <code>ORM</code> 库，安详需要使用的数据库驱动和 <code>ORM</code> 库，常见的 <code>ORM</code> 库是 <code>GORM</code>，支持 <code>MySQL</code>、<code>PostgreSQL</code>和 <code>SQLite</code> 等数据库。</li><li>配置数据库的连接信息，需要在 <code>Gin</code> 项目配置中配置数据库连接，通常是 <code>main.go</code> 或者单独的配置文件。</li><li>初始化数据库，在项目启动的时候，进行数据库连接的初始化。</li><li>项目中使用数据库， 在路由关联的函数中使用数据进行增删改查的操作。</li></ol> 
<h4><a id="61__ORM__422"></a>6.1 安装数据库驱动和 ORM 库</h4> 
<pre><code class="prism language-shell">go get <span class="token parameter variable">-u</span> gorm.io/gorm
go get <span class="token parameter variable">-u</span> gorm.io/driver/mysql
</code></pre> 
<h4><a id="62__429"></a>6.2 配置数据库的连接信息</h4> 
<p>在 <code>main.go</code> 文件中配置数据库的连接信息。</p> 
<pre><code class="prism language-go"><span class="token comment">// 数据库连接信息</span>
dsn <span class="token operator">:=</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
<span class="token keyword">var</span> err <span class="token builtin">error</span>

<span class="token comment">// 连接数据库</span>
db<span class="token punctuation">,</span> err <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"无法连接数据库: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="63__445"></a>6.3 数据库初始化</h4> 
<p>使用 <code>gorm</code> 库，定义数据库模型，在 <code>main.go</code> 文件中添加 <code>AutoMigrate</code> 方法，进行数据库的迁移操作。</p> 
<pre><code class="prism language-go"><span class="token comment">// 定义一个全局的数据库连接变量</span>
<span class="token keyword">var</span> db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB

<span class="token comment">// User 定义数据库模型</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	ID       <span class="token builtin">uint</span>   <span class="token string">`json:"id" gorm:"primaryKey"`</span>
	Username <span class="token builtin">string</span> <span class="token string">`json:"username"`</span>
	Email    <span class="token builtin">string</span> <span class="token string">`json:"email"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个服务</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 使用中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>favicon<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"./static/favicon.ico"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">myHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 加载静态页面</span>
	r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/*"</span><span class="token punctuation">)</span>
	<span class="token comment">// 数据库连接信息</span>
	dsn <span class="token operator">:=</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>

	<span class="token comment">// 连接数据库</span>
	db<span class="token punctuation">,</span> err <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"无法连接数据库: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 自动迁移数据库</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>项目启动如下，项目启动后，执行 <code>AutoMigrate</code> 方法。</p> 
<p><img src="https://images2.imgbox.com/a2/04/RtXhehz7_o.png" alt="在这里插入图片描述"></p> 
<p>连接配置的数据库，发现 <code>AutoMigrate</code> 初始化生成的表，数据库迁移操作成功。</p> 
<p><img src="https://images2.imgbox.com/98/ac/DcdQuCcd_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="64__494"></a>6.4 数据库使用</h4> 
<p>如下是获取用户列表和创建用户的两个函数方法。</p> 
<pre><code class="prism language-go"><span class="token comment">// 获取用户列表的处理函数</span>
<span class="token keyword">func</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	<span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建用户的处理函数</span>
<span class="token keyword">func</span> <span class="token function">createUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> user User
	<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	<span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 <code>main.go</code> 中添加路由函数，如下所示：</p> 
<pre><code class="prism language-go"><span class="token comment">// 定义路由和处理函数</span>
r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> getUsers<span class="token punctuation">)</span>
r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> createUser<span class="token punctuation">)</span>
</code></pre> 
<p>进行路由请求，如下所示：</p> 
<ul><li> <p><code>POST</code> 请求进行用户的创建。</p> <p><img src="https://images2.imgbox.com/ff/d3/P3u5einI_o.png" alt="在这里插入图片描述"></p> </li><li> <p><code>GET</code> 请求获取用户信息。</p> <p><img src="https://images2.imgbox.com/a8/98/cTjSVp4m_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<p>数据库操作的完整代码为:</p> 
<pre><code class="prism language-go"><span class="token comment">// blog.euansu.cn</span>
<span class="token comment">// main.go</span>
<span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"github.com/gin-gonic/gin"</span>
	<span class="token string">"github.com/thinkerou/favicon"</span>
	<span class="token string">"gorm.io/driver/mysql"</span>
	<span class="token string">"gorm.io/gorm"</span>
	<span class="token string">"log"</span>
	<span class="token string">"net/http"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">myHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> gin<span class="token punctuation">.</span>HandlerFunc <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 设置中间件的值</span>
		c<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">"usersession"</span><span class="token punctuation">,</span> <span class="token string">"xxx"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> c<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>URL<span class="token punctuation">.</span>Path <span class="token operator">==</span> <span class="token string">"/"</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 阻止</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"阻止"</span><span class="token punctuation">)</span>
			c<span class="token punctuation">.</span><span class="token function">Abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 放行</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"放行"</span><span class="token punctuation">)</span>
		c<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个全局的数据库连接变量</span>
<span class="token keyword">var</span> db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB

<span class="token comment">// User 定义数据库模型</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	ID       <span class="token builtin">uint</span>   <span class="token string">`json:"id" gorm:"primaryKey"`</span>
	Username <span class="token builtin">string</span> <span class="token string">`json:"username"`</span>
	Email    <span class="token builtin">string</span> <span class="token string">`json:"email"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建一个服务</span>
	r <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 使用中间件</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>favicon<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">"./static/favicon.ico"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token function">myHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// 加载静态页面</span>
	r<span class="token punctuation">.</span><span class="token function">LoadHTMLGlob</span><span class="token punctuation">(</span><span class="token string">"templates/*"</span><span class="token punctuation">)</span>
	<span class="token comment">// 数据库连接信息</span>
	dsn <span class="token operator">:=</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
	<span class="token keyword">var</span> err <span class="token builtin">error</span>

	<span class="token comment">// 连接数据库</span>
	db<span class="token punctuation">,</span> err <span class="token operator">=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>dsn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"无法连接数据库: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 自动迁移数据库</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token comment">// 定义路由和处理函数</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> getUsers<span class="token punctuation">)</span>
	r<span class="token punctuation">.</span><span class="token function">POST</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">,</span> createUser<span class="token punctuation">)</span>

	<span class="token comment">// 路由函数</span>
	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//c.String(200, "Hello, EuanSu")</span>
		c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"/"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/home"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//c.String(200, "Hello, EuanSu")</span>
		c<span class="token punctuation">.</span><span class="token function">HTML</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span> <span class="token string">"path"</span><span class="token punctuation">:</span> <span class="token string">"/home"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	r<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// listen and serve on 0.0.0.0:8080</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	<span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">createUser</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> user User
	<span class="token keyword">if</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ShouldBindJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusBadRequest<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	<span class="token keyword">if</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusInternalServerError<span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>StatusOK<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7_650"></a>7.相关链接</h3> 
<p>[1] Go Gin 简明教程 https://geektutu.com/post/quick-go-gin.html</p> 
<p>[2] 【【狂神说】Gin框架一小时上手 | 快速转型GoWeb开发 | Go语言零基础教程】 https://www.bilibili.com/video/BV1Rd4y1C7A1/?share_source=copy_web&amp;vd_source=5fdcc6213ac2d30f16a78fe5d6e8df4d</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1e7f5fce1d587a9ee197a25f67d78d92/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信 小程序应用，页面，组件的生命周期</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6e5d0b8398eb7134b752d69116c2b69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI 定位！GeoSpyAI上传一张图片分析具体位置 不可思议! ! !</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>