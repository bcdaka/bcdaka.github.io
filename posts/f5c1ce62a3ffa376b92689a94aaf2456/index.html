<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何使用 Python 通过代码创建图表 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f5c1ce62a3ffa376b92689a94aaf2456/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="如何使用 Python 通过代码创建图表">
  <meta property="og:description" content="简介 Diagram as Code 工具允许您创建基础架构的架构图。您可以重复使用代码、测试、集成和自动化绘制图表的过程，这将使您能够将文档视为代码，并构建用于映射基础架构的流水线。您可以使用 diagrams 脚本与许多云提供商和自定义基础架构。
在本教程中，您将使用 Python 创建一个基本的图表，并将其上传到对象存储桶。完成后，您将了解 diagrams 脚本的工作原理，从而能够创建新的集成。
步骤 1 — 安装 Graphviz 在这一步中，您将安装 Graphviz 工具。Graphviz 是 diagrams 模块的引擎，它生成图表本身。
首先，更新服务器的软件包：
sudo apt update 然后，使用以下命令安装 Graphviz：
sudo apt install -y graphviz -y 选项会自动回答安装过程中的任何额外提示。您也可以下载其他发行版的 Graphviz。
安装完成后，您将拥有安装的 Graphviz。
因为您将在本教程后面使用 Pip3 安装 Python 依赖项，您可以检查您是否有正确的版本：
pip3 --version 您应该会看到类似以下的内容：
pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8) 在这一步中，您更新了服务器，安装了 Graphviz，并检查了 Pip 的版本。接下来，您将构建 diagrams 脚本。
步骤 2 — 构建 Python 脚本 在这一步中，您将在 Python 中编写一个示例图表脚本。
首先，创建一个工作文件夹：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-15T08:00:00+08:00">
    <meta property="article:modified_time" content="2024-02-15T08:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何使用 Python 通过代码创建图表</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_5"></a>简介</h4> 
<p>Diagram as Code 工具允许您创建基础架构的架构图。您可以重复使用代码、测试、集成和自动化绘制图表的过程，这将使您能够将文档视为代码，并构建用于映射基础架构的流水线。您可以使用 <code>diagrams</code> 脚本与许多云提供商和自定义基础架构。</p> 
<p>在本教程中，您将使用 Python 创建一个基本的图表，并将其上传到对象存储桶。完成后，您将了解 <code>diagrams</code> 脚本的工作原理，从而能够创建新的集成。</p> 
<h3><a id="_1_mdash__Graphviz_11"></a>步骤 1 — 安装 Graphviz</h3> 
<p>在这一步中，您将安装 Graphviz 工具。Graphviz 是 <code>diagrams</code> 模块的引擎，它生成图表本身。</p> 
<p>首先，更新服务器的软件包：</p> 
<pre><code class="prism language-command">sudo apt update
</code></pre> 
<p>然后，使用以下命令安装 Graphviz：</p> 
<pre><code class="prism language-command">sudo apt install -y graphviz
</code></pre> 
<p><code>-y</code> 选项会自动回答安装过程中的任何额外提示。您也可以下载其他发行版的 Graphviz。</p> 
<p>安装完成后，您将拥有安装的 Graphviz。</p> 
<p>因为您将在本教程后面使用 Pip3 安装 Python 依赖项，您可以检查您是否有正确的版本：</p> 
<pre><code class="prism language-command">pip3 --version
</code></pre> 
<p>您应该会看到类似以下的内容：</p> 
<pre><code>pip 20.0.2 from /usr/lib/python3/dist-packages/pip (python 3.8)
</code></pre> 
<p>在这一步中，您更新了服务器，安装了 Graphviz，并检查了 Pip 的版本。接下来，您将构建 <code>diagrams</code> 脚本。</p> 
<h3><a id="_2_mdash__Python__41"></a>步骤 2 — 构建 Python 脚本</h3> 
<p>在这一步中，您将在 Python 中编写一个示例图表脚本。</p> 
<p>首先，创建一个工作文件夹：</p> 
<pre><code class="prism language-command">mkdir ~/my-diagram
</code></pre> 
<p>创建项目文件夹后，使用以下命令进入该文件夹：</p> 
<pre><code class="prism language-command">cd ~/my-diagram
</code></pre> 
<p>然后，创建一个 <code>requirements.txt</code> 文件以跟踪项目依赖项：</p> 
<pre><code class="prism language-command">echo -e "diagrams==0.21.1\ngraphviz==0.16" | tee requirements.txt
</code></pre> 
<p>此命令有两个关键字：<code>echo</code> 将打印字符串，<code>-e</code> 选项将使用 <code>\n</code> 插入来解析新行，以创建一个格式良好的 requirements 文件。</p> 
<p><code>|</code> 符号表示将 echo 语句的结果传递给管道。<code>tee</code> 命令接受管道输入，并根据列出的参数创建一个新文件：在本例中，是 <code>requirements.txt</code>。</p> 
<p>Python 中的 <code>requirements.txt</code> 文件提供了运行脚本所需的模块列表。目前，该项目有两个依赖项。<br> 创建文件后，您将看到以下输出：</p> 
<pre><code>diagrams=0.21.1
graphviz=0.16
</code></pre> 
<p>此显示指示了两个工具的版本号。</p> 
<p>现在，您将编写 Python 脚本以创建图表图像。</p> 
<p>确保您仍在创建的目录中：</p> 
<pre><code class="prism language-command">cd ~/my-diagram
</code></pre> 
<p>接下来，使用 <code>nano</code> 或您喜欢的文本编辑器打开一个新文件：</p> 
<pre><code class="prism language-command">nano my-diagram.py
</code></pre> 
<p>添加以下代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> diagrams <span class="token keyword">import</span> Diagram<span class="token punctuation">,</span> Cluster<span class="token punctuation">,</span> Edge
</code></pre> 
<p>此行将导入创建通用图表元素所需的图表部件。</p> 
<p>接下来，您必须导入绘制您将构建的 DigitalOcean 基础架构所需的内容。在本示例中，您将创建一个图表，显示两个 Droplets 连接到一个数据库，并且所有主机都将日志发送到一个 Logstash 实例。</p> 
<p>添加以下行以导入 Droplet、DbaasPrimary 和 Logstash 图标：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>digitalocean<span class="token punctuation">.</span>compute <span class="token keyword">import</span> Droplet
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>digitalocean<span class="token punctuation">.</span>database <span class="token keyword">import</span> DbaasPrimary
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>elasticsearch <span class="token keyword">import</span> Logstash
</code></pre> 
<p>这些行导入了本教程所需的图标。您可以在 Mingrammer 文档中找到所有可用的 DigitalOcean 图标。</p> 
<p>导入图标后，您可以开始构建图表。此代码部分将创建一个名为 <code>My Diagram: Droplets</code> 的图表：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">with</span> Diagram<span class="token punctuation">(</span><span class="token string">"My Diagram: Droplets"</span><span class="token punctuation">,</span> show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">"my-diagram"</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">"LR"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<p><code>show</code> 参数可以在创建时打开它，但由于您正在使用 Linux 主机，它已设置为 <code>False</code>。生成的文件将被命名为分配给 <code>filename</code> 的任何字符串。<code>direction</code> 是您希望图表打印的方向。<code>direction</code> 的支持值为 <code>TB</code>（从上到下）和 <code>LR</code>（从左到右）。选择 <code>direction</code> 可以使图表更易于阅读。对于此图表，您将使用 <code>LR</code>。</p> 
<p>最后，将图标添加到图表中：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">with</span> Diagram<span class="token punctuation">(</span><span class="token string">"My Diagram: Droplets"</span><span class="token punctuation">,</span> show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">"my-diagram"</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">"LR"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Cluster<span class="token punctuation">(</span><span class="token string">"DigitalOcean"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        droplet1 <span class="token operator">=</span> Droplet<span class="token punctuation">(</span><span class="token string">"My first Droplet"</span><span class="token punctuation">)</span>
        droplet2 <span class="token operator">=</span> Droplet<span class="token punctuation">(</span><span class="token string">"My second Droplet"</span><span class="token punctuation">)</span>

    db <span class="token operator">=</span> DbaasPrimary<span class="token punctuation">(</span><span class="token string">"My database"</span><span class="token punctuation">)</span>

    logstash <span class="token operator">=</span> Logstash<span class="token punctuation">(</span><span class="token string">"Logstash service"</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>Cluster</code> 在图表中为您的 Droplets 创建一个框，显示它们在名为 <code>DigitalOcean</code> 的空间中。<code>Droplet</code>、<code>DbaasPrimary</code> 和 <code>Logstash</code> 将创建以字符串提供的图标名称。</p> 
<p>接下来，您将通过添加以下行来在图表中的各个项目之间创建依赖关系：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> db <span class="token operator">&gt;&gt;</span> <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">]</span>
    <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">,</span> db<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> Edge<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">"firebrick"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> logstash
</code></pre> 
<p>您将您的 Droplets 连接到上面创建的 DbaasPrimary 数据库，既读又写。然后，您添加了一个颜色为 <code>firebrick</code> 的虚线，以指示从 Droplets 和主数据库到 Logstash 的连接。</p> 
<p>您的最终 <code>my-diagram.py</code> 文件将如下所示：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> diagrams <span class="token keyword">import</span> Diagram<span class="token punctuation">,</span> Cluster<span class="token punctuation">,</span> Edge
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>digitalocean<span class="token punctuation">.</span>compute <span class="token keyword">import</span> Droplet
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>digitalocean<span class="token punctuation">.</span>database <span class="token keyword">import</span> DbaasPrimary
<span class="token keyword">from</span> diagrams<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>elasticsearch <span class="token keyword">import</span> Logstash

<span class="token keyword">with</span> Diagram<span class="token punctuation">(</span><span class="token string">"My Diagram: Droplets"</span><span class="token punctuation">,</span> show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> filename<span class="token operator">=</span><span class="token string">"my-diagram"</span><span class="token punctuation">,</span> direction<span class="token operator">=</span><span class="token string">"LR"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Cluster<span class="token punctuation">(</span><span class="token string">"DigitalOcean"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        droplet1 <span class="token operator">=</span> Droplet<span class="token punctuation">(</span><span class="token string">"My first droplet"</span><span class="token punctuation">)</span>
        droplet2 <span class="token operator">=</span> Droplet<span class="token punctuation">(</span><span class="token string">"My second droplet"</span><span class="token punctuation">)</span>

    db <span class="token operator">=</span> DbaasPrimary<span class="token punctuation">(</span><span class="token string">"My database"</span><span class="token punctuation">)</span>
    
    logstash <span class="token operator">=</span> Logstash<span class="token punctuation">(</span><span class="token string">"Logstash service"</span><span class="token punctuation">)</span>
    
    <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> db <span class="token operator">&gt;&gt;</span> <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">]</span>
    <span class="token punctuation">[</span>droplet1<span class="token punctuation">,</span> droplet2<span class="token punctuation">,</span> db<span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> Edge<span class="token punctuation">(</span>color<span class="token operator">=</span><span class="token string">"firebrick"</span><span class="token punctuation">,</span> style<span class="token operator">=</span><span class="token string">"dashed"</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> logstash
</code></pre> 
<p>保存并关闭文件。</p> 
<p>现在，您在同一个文件夹中有一个名为 <code>my-diagram.py</code> 和一个名为 <code>requirements.txt</code> 的文件。</p> 
<p>有了这两个文件，您可以安装所需的模块并创建图表。</p> 
<h3><a id="_3_mdash__162"></a>步骤 3 — 创建图表</h3> 
<p>完成编写 Python 脚本后，您可以运行它以创建图表。</p> 
<p>首先使用 Pip 安装所需的库：</p> 
<pre><code class="prism language-command">pip3 install -r requirements.txt
</code></pre> 
<p>您将看到以下输出：</p> 
<pre><code>Collecting diagrams==0.21.1
  Using cached diagrams-0.21.1-py3-none-any.whl (23.8 MB)
Collecting graphviz==0.16
  Using cached graphviz-0.16-py2.py3-none-any.whl (19 kB)
Requirement already satisfied: jinja2&lt;4.0,&gt;=2.10 in /usr/lib/python3/dist-packages (from diagrams==0.21.1-&gt;-r requirements.txt (line 1)) (2.10.1)
Installing collected packages: graphviz, diagrams
Successfully installed diagrams-0.21.1 graphviz-0.16
</code></pre> 
<p>安装完成所需的库后，运行 Python 脚本：</p> 
<pre><code class="prism language-command">python3 my-diagram.py
</code></pre> 
<p>此脚本将生成一个名为 <code>my-diagram.png</code> 的图表，如下所示：</p> 
<p>!The Droplets and Database diagram</p> 
<p>有关不同类型图标和使用此模块的其他方法的更多信息，请参阅 Mingrammer 文档。</p> 
<p>在这一步中，您已创建了图表。接下来，您将把它添加到对象存储中，以便可以访问 <code>.png</code> 文件。</p> 
<h3><a id="_4_mdash__195"></a>步骤 4 — 将图表上传到对象存储</h3> 
<p>为了能够从不同位置查看您的图表，现在将图表上传到对象存储。在本教程中，您将使用 DigitalOcean Spaces 存储桶。</p> 
<p>在先决条件中，您已设置了一个 Spaces 存储桶并创建了一组访问密钥。</p> 
<p>接下来，安装 <code>s3cmd</code>，这是一个用于通过 CLI 与 s3 风格 API 进行交互的工具：</p> 
<pre><code class="prism language-command">sudo apt install -y s3cmd
</code></pre> 
<p>安装完成后，配置 <code>s3cmd</code>：</p> 
<pre><code class="prism language-command">s3cmd --configure
</code></pre> 
<p>现在，您将使用 API 凭据和其他首选项设置配置。下面的每个提示将作为自己的行加载，因此请使用您的信息和选择更新下面的突出显示部分：</p> 
<pre><code>HTTP 代理服务器名称：

新设置：
访问密钥：your-access-key
密钥：your-secret-key
默认区域：EU
S3 端点：ams3.digitaloceanspaces.com
用于访问存储桶的 DNS 样式主机名+端口模板：%(bucket)s.ams3.digitaloceanspaces.com
加密密码：your-encryption-password
GPG 程序路径：/usr/bin/gpg
使用 HTTPS 协议：True
HTTP 代理服务器名称：
HTTP 代理服务器端口：0
</code></pre> 
<p><code>S3 端点</code> 需要与 Spaces 设置中提供的端点匹配，并且 <code>DNS 样式</code> 需以类似格式的方式设置。上面的示例使用 <code>ams3</code>，因为此 Spaces 存储桶托管在阿姆斯特丹数据中心 3 上。请相应更新您的设置。</p> 
<p>设置完首选项后，选择 <code>Y</code> 来测试凭据：</p> 
<pre><code>使用提供的凭据测试访问权限？[Y/n] Y
</code></pre> 
<p>测试将运行。如果失败，您可以提供新的凭据进行配置并重试。一旦成功，您将看到以下显示：</p> 
<pre><code>请稍候，尝试列出所有存储桶...
成功。您的访问密钥和密钥工作正常 :-)

现在验证加密是否有效...
成功。加密和解密工作正常 :-)
</code></pre> 
<p>现在，您可以通过运行 <code>s3cmd</code> 命令上传文件：</p> 
<pre><code class="prism language-command">s3cmd put my-diagram.png s3://your_space_name/my-diagram.png
</code></pre> 
<p>上传完成后，您将看到以下显示：</p> 
<pre><code>upload: 'my-diagram.png' -&gt; 's3://your-space-name/my-diagram.png'  [1 of 1]
 43672 of 43672   100% in    0s  1516.98 kB/s  done
</code></pre> 
<p>如果您的存储桶是公开访问的，或者您已将图表设置为公开，您可以访问 <code>https://your-space-name.ams3.digitaloceanspaces.com/my-diagram.png</code> 查看您的图表。请确保使用您的存储桶名称和其数据中心更新 URL。</p> 
<p>如果您的存储桶不是公开访问的，您可以更改文件权限使其公开，或者您可以从存储桶下载图像到本地计算机。</p> 
<p>如果您不需要保留在本教程中创建的服务器和对象存储，您可以按照文档中有关删除 Droplets 和销毁 Spaces 的说明进行操作。</p> 
<h3><a id="_261"></a>结论</h3> 
<p>您已使用 Python 创建了一个图表，您可以根据需要修改它以满足您未来的图表创建需求。您将不再需要手动拖动框来创建图表。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a67d9e97bd48f653096a1c84b1fb6fa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">文心一言4.0 VS ChatGPT4.0哪家强？！每月60块的文心一言4.0值得开吗？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f1d342d484bf77685486617da43f0d2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript中的querySelector()方法是什么，它是如何工作的？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>