<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡16ï¼šä¼˜åŒ–å†³ç­–æµç¨‹ï¼šAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­PlanningåŠŸèƒ½å®è·µ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/183b2166bd7e44146288e51d98796b05/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡16ï¼šä¼˜åŒ–å†³ç­–æµç¨‹ï¼šAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­PlanningåŠŸèƒ½å®è·µ">
  <meta property="og:description" content="ç³»åˆ—ç¯‡ç« ğŸ’¥ AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡15ï¼š Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¹‹æ•´åˆå°è£…Toolså’ŒMemoryåŠŸèƒ½ä»£ç 
ç›®å½• ç³»åˆ—ç¯‡ç« ğŸ’¥ä¸€ã€å‰è¨€äºŒã€äººç±»æ„å›¾æŒ–æ˜ä¸‰ã€å¢åŠ Few-SHOTå’ŒCOTæ€ç»´é“¾èƒ½åŠ›1ã€å¢åŠ few-shotæç¤ºè¯2ã€æ·»åŠ æ€ç»´é“¾æ¨¡ç‰ˆ å››ã€å¤§æ¨¡å‹é¦–æ¬¡äº¤äº’é€»è¾‘å°è£…1ã€åŸºæœ¬é—®ç­”æ•ˆæœæµ‹è¯•2ã€function callåŠŸèƒ½æµ‹è¯•3ã€ä¸“å®¶æ¨¡å¼æµ‹è¯•4ã€å¼€å‘è€…æ¨¡å¼æµ‹è¯•5ã€ä¸“å®¶æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯•6ã€å¼€å‘è€…æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯• äº”ã€function callæ‰§è¡Œç»“æœæ¶ˆæ¯å°è£…å…­ã€å®Œæˆç”¨æˆ·ä¸€æ¬¡çš„å®Œæ•´äº¤äº’1ã€ä¸€æ¬¡å®Œæ•´äº¤äº’å‡½æ•°2ã€å¤–å±‚è°ƒç”¨å‡½æ•°3ã€å“åº”ç»“æœæ£€æŸ¥å‡½æ•°4ã€æ–‡æœ¬å†…å®¹æ£€æŸ¥å‡½æ•°5ã€æ™®é€šè°ƒç”¨æµ‹è¯•6ã€å¯¹æ¯”å¼€å‘è€…æ¨¡å¼7ã€å¸¦æœ‰Function Callingè°ƒç”¨8ã€å¤æ‚é—®é¢˜æ‹†è§£9ã€æµ‹è¯•å¯¹æ¯”æœ‰ä»£ç è°ƒç”¨çš„Function Calling10ã€æµ‹è¯•å¼€å‘è€…æ¨¡å¼(ä¸æ¶‰åŠä»£ç æ‰§è¡Œ)11ã€æµ‹è¯•ä¸“å®¶æ¨¡å¼12ã€Agentå¯¹è¯å°è£…è°ƒç”¨ ä¸ƒã€ç»“è¯­ ä¸€ã€å‰è¨€ åœ¨å‰é¢ç¯‡ç« ä¸­æˆ‘ä»¬å®ç°äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­çš„Toolså’ŒMemoryä¸¤å¤§å—ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬å°†å®ç°Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­æœ€æ ¸å¿ƒçš„æ¨¡å—Planï¼Œå‘æ˜æ¢ç´¢äººç±»æ„å›¾ï¼Œä¼˜åŒ–æ•´ä¸ªå†³ç­–æµç¨‹ã€‚
äºŒã€äººç±»æ„å›¾æŒ–æ˜ msg_error_test = MessageManager(system_content_list=[data_dictionary], question=&#34;åˆ†æiqueryæ•°æ®åº“ä¸­çš„è¿™å››å¼ è¡¨ï¼Œå¸®æˆ‘æ¢³ç†ä¸€ä¸ªæ•°æ®åˆ†æçš„åŸºæœ¬æ€è·¯&#34;) second_response = client.chat.completions.create( model=&#39;gpt-3.5-turbo&#39;, messages=msg_error_test.messages, tools=af.functions, tool_choice=&#34;auto&#34; ) second_response è¾“å‡ºï¼š
ChatCompletion(id=&#39;chatcmpl-rtFBgtNzSwoMmJONpYdGjHIWTLmXE&#39;, choices=[Choice(finish_reason=&#39;tool_calls&#39;, index=0, logprobs=None, message=ChatCompletionMessage(content=&#39;&#39;, role=&#39;assistant&#39;, function_call=None, tool_calls=[ChatCompletionMessageToolCall(id=&#39;call_nu8zFoKl61VDF6yaCnWFRhpY&#39;, function=Function(arguments=&#39;{&#34;g&#34;: &#34;test&#34;, &#34;sql_query&#34;: &#34;DESC user_demographics;&#34;}&#39;, name=&#39;sql_inter&#39;), type=&#39;function&#39;), ChatCompletionMessageToolCall(id=&#39;call_RaTHPfo93K3DWByG9n4gW7w1&#39;, function=Function(arguments=&#39;{&#34;g&#34;: &#34;test&#34;, &#34;sql_query&#34;: &#34;DESC user_services;&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-10T20:04:17+08:00">
    <meta property="article:modified_time" content="2024-06-10T20:04:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡16ï¼šä¼˜åŒ–å†³ç­–æµç¨‹ï¼šAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­PlanningåŠŸèƒ½å®è·µ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>ç³»åˆ—ç¯‡ç« ğŸ’¥</h2> 
<p><a href="https://xundaomalu.blog.csdn.net/article/details/139169884" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139190028" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139186663" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139193382" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139194151" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139205615" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216544" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216752" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139372376" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139391333?spm=1001.2014.3001.5502" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139399366" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139428677" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡15ï¼š Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¹‹æ•´åˆå°è£…Toolså’ŒMemoryåŠŸèƒ½ä»£ç </a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#_1" rel="nofollow">ç³»åˆ—ç¯‡ç« ğŸ’¥</a></li><li><a href="#_23" rel="nofollow">ä¸€ã€å‰è¨€</a></li><li><a href="#_25" rel="nofollow">äºŒã€äººç±»æ„å›¾æŒ–æ˜</a></li><li><a href="#FewSHOTCOT_106" rel="nofollow">ä¸‰ã€å¢åŠ Few-SHOTå’ŒCOTæ€ç»´é“¾èƒ½åŠ›</a></li><li><ul><li><a href="#1fewshot_107" rel="nofollow">1ã€å¢åŠ few-shotæç¤ºè¯</a></li><li><a href="#2_211" rel="nofollow">2ã€æ·»åŠ æ€ç»´é“¾æ¨¡ç‰ˆ</a></li></ul> 
  </li><li><a href="#_306" rel="nofollow">å››ã€å¤§æ¨¡å‹é¦–æ¬¡äº¤äº’é€»è¾‘å°è£…</a></li><li><ul><li><a href="#1_436" rel="nofollow">1ã€åŸºæœ¬é—®ç­”æ•ˆæœæµ‹è¯•</a></li><li><a href="#2function_call_451" rel="nofollow">2ã€function callåŠŸèƒ½æµ‹è¯•</a></li><li><a href="#3_469" rel="nofollow">3ã€ä¸“å®¶æ¨¡å¼æµ‹è¯•</a></li><li><a href="#4_485" rel="nofollow">4ã€å¼€å‘è€…æ¨¡å¼æµ‹è¯•</a></li><li><a href="#5_500" rel="nofollow">5ã€ä¸“å®¶æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯•</a></li><li><a href="#6_513" rel="nofollow">6ã€å¼€å‘è€…æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯•</a></li></ul> 
  </li><li><a href="#function_call_528" rel="nofollow">äº”ã€function callæ‰§è¡Œç»“æœæ¶ˆæ¯å°è£…</a></li><li><a href="#_595" rel="nofollow">å…­ã€å®Œæˆç”¨æˆ·ä¸€æ¬¡çš„å®Œæ•´äº¤äº’</a></li><li><ul><li><a href="#1_596" rel="nofollow">1ã€ä¸€æ¬¡å®Œæ•´äº¤äº’å‡½æ•°</a></li><li><a href="#2_700" rel="nofollow">2ã€å¤–å±‚è°ƒç”¨å‡½æ•°</a></li><li><a href="#3_823" rel="nofollow">3ã€å“åº”ç»“æœæ£€æŸ¥å‡½æ•°</a></li><li><a href="#4_925" rel="nofollow">4ã€æ–‡æœ¬å†…å®¹æ£€æŸ¥å‡½æ•°</a></li><li><a href="#5_1053" rel="nofollow">5ã€æ™®é€šè°ƒç”¨æµ‹è¯•</a></li><li><a href="#6_1066" rel="nofollow">6ã€å¯¹æ¯”å¼€å‘è€…æ¨¡å¼</a></li><li><a href="#7Function_Calling_1079" rel="nofollow">7ã€å¸¦æœ‰Function Callingè°ƒç”¨</a></li><li><a href="#8_1092" rel="nofollow">8ã€å¤æ‚é—®é¢˜æ‹†è§£</a></li><li><a href="#9Function_Calling_1104" rel="nofollow">9ã€æµ‹è¯•å¯¹æ¯”æœ‰ä»£ç è°ƒç”¨çš„Function Calling</a></li><li><a href="#10_1116" rel="nofollow">10ã€æµ‹è¯•å¼€å‘è€…æ¨¡å¼(ä¸æ¶‰åŠä»£ç æ‰§è¡Œ)</a></li><li><a href="#11_1129" rel="nofollow">11ã€æµ‹è¯•ä¸“å®¶æ¨¡å¼</a></li><li><a href="#12Agent_1141" rel="nofollow">12ã€Agentå¯¹è¯å°è£…è°ƒç”¨</a></li></ul> 
  </li><li><a href="#_1275" rel="nofollow">ä¸ƒã€ç»“è¯­</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_23"></a>ä¸€ã€å‰è¨€</h2> 
<p>åœ¨å‰é¢ç¯‡ç« ä¸­æˆ‘ä»¬å®ç°äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­çš„Toolså’ŒMemoryä¸¤å¤§å—ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬å°†å®ç°Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ä¸­æœ€æ ¸å¿ƒçš„æ¨¡å—Planï¼Œå‘æ˜æ¢ç´¢äººç±»æ„å›¾ï¼Œä¼˜åŒ–æ•´ä¸ªå†³ç­–æµç¨‹ã€‚</p> 
<h2><a id="_25"></a>äºŒã€äººç±»æ„å›¾æŒ–æ˜</h2> 
<pre><code class="prism language-python">msg_error_test <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"åˆ†æiqueryæ•°æ®åº“ä¸­çš„è¿™å››å¼ è¡¨ï¼Œå¸®æˆ‘æ¢³ç†ä¸€ä¸ªæ•°æ®åˆ†æçš„åŸºæœ¬æ€è·¯"</span><span class="token punctuation">)</span>

second_response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>msg_error_test<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> 
                        tools<span class="token operator">=</span>af<span class="token punctuation">.</span>functions<span class="token punctuation">,</span> 
                        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span>
                        <span class="token punctuation">)</span> 
second_response
</code></pre> 
<p>è¾“å‡ºï¼š</p> 
<pre><code class="prism language-python">ChatCompletion<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'chatcmpl-rtFBgtNzSwoMmJONpYdGjHIWTLmXE'</span><span class="token punctuation">,</span> choices<span class="token operator">=</span><span class="token punctuation">[</span>Choice<span class="token punctuation">(</span>finish_reason<span class="token operator">=</span><span class="token string">'tool_calls'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> logprobs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> message<span class="token operator">=</span>ChatCompletionMessage<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> role<span class="token operator">=</span><span class="token string">'assistant'</span><span class="token punctuation">,</span> function_call<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> tool_calls<span class="token operator">=</span><span class="token punctuation">[</span>ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_nu8zFoKl61VDF6yaCnWFRhpY'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"g": "test", "sql_query": "DESC user_demographics;"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sql_inter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_RaTHPfo93K3DWByG9n4gW7w1'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"g": "test", "sql_query": "DESC user_services;"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sql_inter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_8lpOxl8fp7HZzurhQMbrBT4u'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"g": "test", "sql_query": "DESC user_payments;"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sql_inter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChatCompletionMessageToolCall<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'call_L1KekwoNcrc2oELyiAWPjnbR'</span><span class="token punctuation">,</span> function<span class="token operator">=</span>Function<span class="token punctuation">(</span>arguments<span class="token operator">=</span><span class="token string">'{"g": "test", "sql_query": "DESC user_churn;"}'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sql_inter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> created<span class="token operator">=</span><span class="token number">1710948365</span><span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token operator">=</span><span class="token string">'chat.completion'</span><span class="token punctuation">,</span> system_fingerprint<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> usage<span class="token operator">=</span>CompletionUsage<span class="token punctuation">(</span>completion_tokens<span class="token operator">=</span><span class="token number">105</span><span class="token punctuation">,</span> prompt_tokens<span class="token operator">=</span><span class="token number">1948</span><span class="token punctuation">,</span> total_tokens<span class="token operator">=</span><span class="token number">2053</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¼‚å¸¸åˆ†ææ•è·å¤„ç†</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> openai <span class="token keyword">import</span>  APIConnectionError<span class="token punctuation">,</span>AuthenticationError
<span class="token comment">#%%</span>
messages <span class="token operator">=</span> msg_error_test<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                            model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span>
                            messages<span class="token operator">=</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> 
                            tools<span class="token operator">=</span>af<span class="token punctuation">.</span>functions<span class="token punctuation">,</span> 
                            tool_choice<span class="token operator">=</span>af<span class="token punctuation">.</span>function_call
                            <span class="token punctuation">)</span> 
<span class="token comment">#1. é—®çš„é—®é¢˜æ¯”è¾ƒæ³›</span>
<span class="token comment">#2. keyä¸ç¨³å®š</span>
<span class="token comment">#3. tokenä¸å¤Ÿ</span>
<span class="token comment">#4. ä½ç‰ˆæœ¬çš„å¤§æ¨¡å‹</span>
<span class="token comment">#5. å¤§å®¶ä¹Ÿå¯ä»¥æ”¶é›†è‡ªå·±å¹³æ—¶å¼€å‘é‡åˆ°çš„æŠ¥é”™ï¼ˆä¸åŒç‰ˆæœ¬çš„openaiæŠ¥é”™è¿˜ä¸ä¸€æ ·ï¼‰</span>
<span class="token keyword">except</span> AuthenticationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token comment"># APIConnectionErroré»˜è®¤æ˜¯ç”¨æˆ·éœ€æ±‚ä¸æ¸…å¯¼è‡´æ— æ³•è¿”å›ç»“æœ</span>
    msg_temp <span class="token operator">=</span> messages<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># è·å–ç”¨æˆ·é—®é¢˜</span>
    question <span class="token operator">=</span> msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
    <span class="token comment"># æé†’ç”¨æˆ·ä¿®æ”¹æé—®çš„æç¤ºæ¨¡æ¿</span>
    new_prompt <span class="token operator">=</span> "ä»¥ä¸‹æ˜¯ç”¨æˆ·æé—®ï¼š<span class="token operator">%</span>sã€‚è¯¥é—®é¢˜æœ‰äº›å¤æ‚ï¼Œä¸”ç”¨æˆ·æ„å›¾å¹¶ä¸æ¸…æ™°ã€‚\
                è¯·ç¼–å†™ä¸€æ®µè¯ï¼Œæ¥å¼•å¯¼ç”¨æˆ·é‡æ–°æé—®ã€‚" <span class="token operator">%</span> question
    <span class="token comment"># ä¿®æ”¹msg_tempå¹¶é‡æ–°æé—®</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_prompt
        <span class="token comment"># ä¿®æ”¹ç”¨æˆ·é—®é¢˜å¹¶ç›´æ¥æé—®</span>
        
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> 
                        tools<span class="token operator">=</span>af<span class="token punctuation">.</span>functions<span class="token punctuation">,</span> 
                        tool_choice<span class="token operator">=</span>af<span class="token punctuation">.</span>function_call
                        <span class="token punctuation">)</span>
        
                    
        <span class="token comment"># æ‰“å°gptè¿”å›çš„æç¤ºä¿®æ”¹åŸé—®é¢˜çš„æè¿°è¯­å¥</span>
        display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>     
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"è¯·é‡æ–°è¾“å…¥é—®é¢˜ï¼Œè¾“å…¥â€œé€€å‡ºâ€å¯ä»¥é€€å‡ºå½“å‰å¯¹è¯"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">!=</span> <span class="token string">"é€€å‡º"</span><span class="token punctuation">:</span>
            messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_input
            response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                            model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span>
                            messages<span class="token operator">=</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> 
                            tools<span class="token operator">=</span>af<span class="token punctuation">.</span>functions<span class="token punctuation">,</span> 
                            tool_choice<span class="token operator">=</span>af<span class="token punctuation">.</span>function_call
                            <span class="token punctuation">)</span> 

                        
    <span class="token comment"># è‹¥åœ¨æç¤ºç”¨æˆ·ä¿®æ”¹åŸé—®é¢˜æ—¶é‡åˆ°é“¾æ¥é”™è¯¯ï¼Œåˆ™ç›´æ¥æš‚åœ1åˆ†é’Ÿåç»§ç»­æ‰§è¡ŒWhileå¾ªç¯</span>
    <span class="token keyword">except</span> AuthenticationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å½“å‰é‡åˆ°äº†ä¸€ä¸ªé“¾æ¥é—®é¢˜: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ç”±äºLimit Rateé™åˆ¶ï¼Œå³å°†ç­‰å¾…1åˆ†é’Ÿåç»§ç»­è¿è¡Œ..."</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>  <span class="token comment"># ç­‰å¾…1åˆ†é’Ÿ</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²ç­‰å¾…60ç§’ï¼Œå³å°†å¼€å§‹é‡æ–°è°ƒç”¨æ¨¡å‹å¹¶è¿›è¡Œå›ç­”..."</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="FewSHOTCOT_106"></a>ä¸‰ã€å¢åŠ Few-SHOTå’ŒCOTæ€ç»´é“¾èƒ½åŠ›</h2> 
<h3><a id="1fewshot_107"></a>1ã€å¢åŠ few-shotæç¤ºè¯</h3> 
<p>ç»™few-shotä¾‹å­ï¼Œé‡åˆ°å¤æ‚é—®é¢˜ï¼Œè¿›è¡Œæ­¥éª¤æ‹†è§£ï¼› ä¸»è¦æç¤ºå¤§æ¨¡å‹å¤æ‚é—®é¢˜å¤„ç†èƒ½åŠ›</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">add_task_decomposition_prompt</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token triple-quoted-string string">"""
    å½“å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä»»ä½•é—®é¢˜é¦–æ¬¡å°è¯•ä½œç­”æ—¶éƒ½ä¼šè°ƒç”¨æœ¬å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ä»»åŠ¡æ‹†è§£Few-shotçš„æ–°çš„messageã€‚
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒChatMessagesç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤å€¼ä¸ºNoneï¼Œè¡¨ç¤ºä¸å­˜åœ¨å¤–éƒ¨å‡½æ•°ã€‚
    :return: task_decomp_few_shotï¼Œä¸€ä¸ªåŒ…å«ä»»åŠ¡æ‹†è§£Few-shotæç¤ºç¤ºä¾‹çš„message
    """</span>
    
    <span class="token comment"># ä»»åŠ¡æ‹†è§£Few-shot</span>
    <span class="token comment"># ç¬¬ä¸€ä¸ªæç¤ºç¤ºä¾‹</span>
    user_question1 <span class="token operator">=</span> <span class="token string">'è¯·é—®ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ'</span>
    user_message1_content <span class="token operator">=</span> "ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œ<span class="token operator">%</span>sâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ\
    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚" <span class="token operator">%</span> user_question1
    assistant_message1_content <span class="token operator">=</span> 'æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„å½¢å¼ï¼Œå®ƒå…è®¸è®¡ç®—æœºè‡ªä¸»å­¦ä¹ å’Œæ”¹è¿›ï¼Œè€Œä¸éœ€è¦è¢«æ˜ç¡®ç¼–ç¨‹ã€‚\
    åœ¨æœºå™¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—æœºå‘ç°å¦‚ä½•æ‰§è¡Œä»»åŠ¡ï¼Œä¸»è¦æ˜¯é€šè¿‡å­¦ä¹ æ•°æ®æ¨¡å¼å’Œä½¿æ•°æ®é©±åŠ¨å†³ç­–ã€‚è¿™å¯èƒ½æ¶‰åŠåœ¨å¤§é‡æ•°æ®ä¸­å¯»æ‰¾å’Œè¯†åˆ«æ¨¡å¼ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œé¢„æµ‹ï¼Œæˆ–è€…é€šè¿‡åå¤æ‰§è¡Œå’Œè°ƒæ•´æ¥ä¼˜åŒ–ç‰¹å®šä»»åŠ¡çš„æ€§èƒ½ã€‚ã€‚\
    æœºå™¨å­¦ä¹ å¯ä»¥åˆ†ä¸ºç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ ç­‰ç±»å‹ã€‚ã€‚\
    æœºå™¨å­¦ä¹ åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰åº”ç”¨ï¼ŒåŒ…æ‹¬è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰ã€æ¨èç³»ç»Ÿã€åŒ»ç–—è¯Šæ–­ã€é‡‘èå¸‚åœºé¢„æµ‹ç­‰ç­‰ã€‚'

    <span class="token comment"># ç¬¬äºŒä¸ªæç¤ºç¤ºä¾‹</span>
    user_question2 <span class="token operator">=</span> <span class="token string">'è¯·å¸®æˆ‘ä»‹ç»ä¸‹OpenAIã€‚'</span>
    user_message2_content <span class="token operator">=</span> "ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œ<span class="token operator">%</span>sâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ\
    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚" <span class="token operator">%</span> user_question2
    assistant_message2_content <span class="token operator">=</span> 'OpenAIæ˜¯ä¸€å®¶å¼€å‘å’Œåº”ç”¨å‹å¥½äººå·¥æ™ºèƒ½çš„å…¬å¸ï¼Œ\
    å®ƒçš„ç›®æ ‡æ˜¯ç¡®ä¿äººå·¥é€šç”¨æ™ºèƒ½ï¼ˆAGIï¼‰å¯¹æ‰€æœ‰äººéƒ½æœ‰ç›Šï¼Œä»¥åŠéšç€AGIéƒ¨ç½²ï¼Œå°½å¯èƒ½å¤šçš„äººéƒ½èƒ½å—ç›Šã€‚\
    OpenAIè‡´åŠ›åœ¨å•†ä¸šåˆ©ç›Šå’Œäººç±»ç¦ç¥‰ä¹‹é—´åšå‡ºæ­£ç¡®çš„å¹³è¡¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€å®¶äººé“ä¸»ä¹‰å…¬å¸ã€‚\
    OpenAIå¼€å‘äº†è¯¸å¦‚GPT<span class="token operator">-</span><span class="token number">3</span>è¿™æ ·çš„å…ˆè¿›æ¨¡å‹ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ç­‰è¯¸å¤šé¢†åŸŸè¡¨ç°å‡ºè‰²ã€‚'

    <span class="token comment"># ç¬¬ä¸‰ä¸ªæç¤ºç¤ºä¾‹</span>
    user_question3 <span class="token operator">=</span> <span class="token string">'å›´ç»•æ•°æ®åº“ä¸­çš„user_paymentsè¡¨ï¼Œæˆ‘æƒ³è¦æ£€æŸ¥è¯¥è¡¨æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼'</span>
    user_message3_content <span class="token operator">=</span> "ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œ<span class="token operator">%</span>sâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ\
    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚" <span class="token operator">%</span> user_question3
    assistant_message3_content <span class="token operator">=</span> 'ä¸ºäº†æ£€æŸ¥user_paymentsæ•°æ®é›†æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š\
    \n\næ­¥éª¤<span class="token number">1</span>ï¼šä½¿ç”¨`extract_data`å‡½æ•°å°†user_paymentsæ•°æ®è¡¨è¯»å–åˆ°å½“å‰çš„Pythonç¯å¢ƒä¸­ã€‚\
    \n\næ­¥éª¤<span class="token number">2</span>ï¼šä½¿ç”¨`python_inter`å‡½æ•°æ‰§è¡ŒPythonä»£ç æ£€æŸ¥æ•°æ®é›†çš„ç¼ºå¤±å€¼ã€‚'

    <span class="token comment"># ç¬¬å››ä¸ªæç¤ºç¤ºä¾‹</span>
    user_question4 <span class="token operator">=</span>  <span class="token string">'æˆ‘æƒ³å¯»æ‰¾åˆé€‚çš„ç¼ºå¤±å€¼å¡«è¡¥æ–¹æ³•ï¼Œæ¥å¡«è¡¥user_paymentsæ•°æ®é›†ä¸­çš„ç¼ºå¤±å€¼ã€‚'</span>
    user_message4_content <span class="token operator">=</span> "ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œ<span class="token operator">%</span>sâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ\
    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚" <span class="token operator">%</span> user_question4
    assistant_message4_content <span class="token operator">=</span> 'ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„ç¼ºå¤±å€¼å¡«å……æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰æ­¥ï¼š\
    \n\næ­¥éª¤<span class="token number">1</span>ï¼šåˆ†æuser_paymentsæ•°æ®é›†ä¸­çš„ç¼ºå¤±å€¼æƒ…å†µã€‚é€šè¿‡æŸ¥çœ‹å„å­—æ®µçš„ç¼ºå¤±ç‡å’Œè§‚å¯Ÿç¼ºå¤±å€¼åˆ†å¸ƒï¼Œäº†è§£å…¶ç¼ºå¤±å¹…åº¦å’Œæ¨¡å¼ã€‚\
    \n\næ­¥éª¤<span class="token number">2</span>ï¼šç¡®å®šå€¼å¡«è¡¥ç­–ç•¥ã€‚åŸºäºè§‚å¯Ÿç»“æœå’Œç‰¹å®šå­—æ®µçš„æ€§è´¨ç¡®å®šæ°å½“çš„å¡«è¡¥ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨ä¼—æ•°ã€ä¸­ä½æ•°ã€å‡å€¼æˆ–å»ºç«‹æ¨¡å‹è¿›è¡Œå¡«è¡¥ç­‰ã€‚\
    \n\næ­¥éª¤<span class="token number">3</span>ï¼šè¿›è¡Œç¼ºå¤±å€¼å¡«è¡¥ã€‚æ ¹æ®ç¡®å®šçš„å¡«è¡¥ç­–ç•¥ï¼Œæ‰§è¡Œå¡«è¡¥æ“ä½œï¼Œç„¶åéªŒè¯å¡«è¡¥æ•ˆæœã€‚'
    
    <span class="token comment"># åœ¨ä¿ç•™åŸå§‹é—®é¢˜çš„æƒ…å†µä¸‹åŠ å…¥Few-shot</span>
    task_decomp_few_shot <span class="token operator">=</span> messages<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span>manual<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_message1_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> assistant_message1_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_message2_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> assistant_message2_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_message3_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> assistant_message3_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_message4_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> assistant_message4_content<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    user_question <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>

    new_question <span class="token operator">=</span> "ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œ<span class="token operator">%</span>sâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ\
    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚" <span class="token operator">%</span> user_question
    question_message <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    question_message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_question
    task_decomp_few_shot<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>question_message<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> task_decomp_few_shot
</code></pre> 
<pre><code class="prism language-python">msg1 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsæ•°æ®è¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿ"</span><span class="token punctuation">)</span>
msg2<span class="token operator">=</span> msg1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
msg1_get_decomposition <span class="token operator">=</span> add_task_decomposition_prompt<span class="token punctuation">(</span>messages<span class="token operator">=</span>msg1<span class="token punctuation">)</span>
msg1_get_decomposition<span class="token punctuation">.</span>history_messages
</code></pre> 
<p>è¾“å‡º</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œè¯·ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'assistant'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„å½¢å¼ï¼Œå®ƒå…è®¸è®¡ç®—æœºè‡ªä¸»å­¦ä¹ å’Œæ”¹è¿›ï¼Œè€Œä¸éœ€è¦è¢«æ˜ç¡®ç¼–ç¨‹ã€‚    åœ¨æœºå™¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—æœºå‘ç°å¦‚ä½•æ‰§è¡Œä»»åŠ¡ï¼Œä¸»è¦æ˜¯é€šè¿‡å­¦ä¹ æ•°æ®æ¨¡å¼å’Œä½¿æ•°æ®é©±åŠ¨å†³ç­–ã€‚è¿™å¯èƒ½æ¶‰åŠåœ¨å¤§é‡æ•°æ®ä¸­å¯»æ‰¾å’Œè¯†åˆ«æ¨¡å¼ï¼Œç„¶åæ ¹æ®è¿™äº›ä¿¡æ¯è¿›è¡Œé¢„æµ‹ï¼Œæˆ–è€…é€šè¿‡åå¤æ‰§è¡Œå’Œè°ƒæ•´æ¥ä¼˜åŒ–ç‰¹å®šä»»åŠ¡çš„æ€§èƒ½ã€‚ã€‚    æœºå™¨å­¦ä¹ å¯ä»¥åˆ†ä¸ºç›‘ç£å­¦ä¹ ã€æ— ç›‘ç£å­¦ä¹ å’Œå¼ºåŒ–å­¦ä¹ ç­‰ç±»å‹ã€‚ã€‚    æœºå™¨å­¦ä¹ åœ¨è®¸å¤šé¢†åŸŸéƒ½æœ‰åº”ç”¨ï¼ŒåŒ…æ‹¬è‡ªç„¶è¯­è¨€å¤„ç†ã€è®¡ç®—æœºè§†è§‰ã€æ¨èç³»ç»Ÿã€åŒ»ç–—è¯Šæ–­ã€é‡‘èå¸‚åœºé¢„æµ‹ç­‰ç­‰ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œè¯·å¸®æˆ‘ä»‹ç»ä¸‹OpenAIã€‚â€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'assistant'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'OpenAIæ˜¯ä¸€å®¶å¼€å‘å’Œåº”ç”¨å‹å¥½äººå·¥æ™ºèƒ½çš„å…¬å¸ï¼Œ    å®ƒçš„ç›®æ ‡æ˜¯ç¡®ä¿äººå·¥é€šç”¨æ™ºèƒ½ï¼ˆAGIï¼‰å¯¹æ‰€æœ‰äººéƒ½æœ‰ç›Šï¼Œä»¥åŠéšç€AGIéƒ¨ç½²ï¼Œå°½å¯èƒ½å¤šçš„äººéƒ½èƒ½å—ç›Šã€‚    OpenAIè‡´åŠ›åœ¨å•†ä¸šåˆ©ç›Šå’Œäººç±»ç¦ç¥‰ä¹‹é—´åšå‡ºæ­£ç¡®çš„å¹³è¡¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€å®¶äººé“ä¸»ä¹‰å…¬å¸ã€‚    OpenAIå¼€å‘äº†è¯¸å¦‚GPT-3è¿™æ ·çš„å…ˆè¿›æ¨¡å‹ï¼Œåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ç­‰è¯¸å¤šé¢†åŸŸè¡¨ç°å‡ºè‰²ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œå›´ç»•æ•°æ®åº“ä¸­çš„user_paymentsè¡¨ï¼Œæˆ‘æƒ³è¦æ£€æŸ¥è¯¥è¡¨æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼â€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'assistant'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ä¸ºäº†æ£€æŸ¥user_paymentsæ•°æ®é›†æ˜¯å¦å­˜åœ¨ç¼ºå¤±å€¼ï¼Œæˆ‘ä»¬å°†æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š    \n\næ­¥éª¤1ï¼šä½¿ç”¨`extract_data`å‡½æ•°å°†user_paymentsæ•°æ®è¡¨è¯»å–åˆ°å½“å‰çš„Pythonç¯å¢ƒä¸­ã€‚    \n\næ­¥éª¤2ï¼šä½¿ç”¨`python_inter`å‡½æ•°æ‰§è¡ŒPythonä»£ç æ£€æŸ¥æ•°æ®é›†çš„ç¼ºå¤±å€¼ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œæˆ‘æƒ³å¯»æ‰¾åˆé€‚çš„ç¼ºå¤±å€¼å¡«è¡¥æ–¹æ³•ï¼Œæ¥å¡«è¡¥user_paymentsæ•°æ®é›†ä¸­çš„ç¼ºå¤±å€¼ã€‚â€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'assistant'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ä¸ºäº†æ‰¾åˆ°åˆé€‚çš„ç¼ºå¤±å€¼å¡«å……æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹ä¸‰æ­¥ï¼š    \n\næ­¥éª¤1ï¼šåˆ†æuser_paymentsæ•°æ®é›†ä¸­çš„ç¼ºå¤±å€¼æƒ…å†µã€‚é€šè¿‡æŸ¥çœ‹å„å­—æ®µçš„ç¼ºå¤±ç‡å’Œè§‚å¯Ÿç¼ºå¤±å€¼åˆ†å¸ƒï¼Œäº†è§£å…¶ç¼ºå¤±å¹…åº¦å’Œæ¨¡å¼ã€‚    \n\næ­¥éª¤2ï¼šç¡®å®šå€¼å¡«è¡¥ç­–ç•¥ã€‚åŸºäºè§‚å¯Ÿç»“æœå’Œç‰¹å®šå­—æ®µçš„æ€§è´¨ç¡®å®šæ°å½“çš„å¡«è¡¥ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨ä¼—æ•°ã€ä¸­ä½æ•°ã€å‡å€¼æˆ–å»ºç«‹æ¨¡å‹è¿›è¡Œå¡«è¡¥ç­‰ã€‚    \n\næ­¥éª¤3ï¼šè¿›è¡Œç¼ºå¤±å€¼å¡«è¡¥ã€‚æ ¹æ®ç¡®å®šçš„å¡«è¡¥ç­–ç•¥ï¼Œæ‰§è¡Œå¡«è¡¥æ“ä½œï¼Œç„¶åéªŒè¯å¡«è¡¥æ•ˆæœã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'role'</span><span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
  <span class="token string">'content'</span><span class="token punctuation">:</span> <span class="token string">'ç°æœ‰ç”¨æˆ·é—®é¢˜å¦‚ä¸‹ï¼šâ€œè¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsæ•°æ®è¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿâ€ã€‚ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæ€»å…±éœ€è¦åˆ†å‡ æ­¥æ¥æ‰§è¡Œå‘¢ï¼Ÿ    è‹¥æ— éœ€æ‹†åˆ†æ‰§è¡Œæ­¥éª¤ï¼Œè¯·ç›´æ¥å›ç­”åŸå§‹é—®é¢˜ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="2_211"></a>2ã€æ·»åŠ æ€ç»´é“¾æ¨¡ç‰ˆ</h3> 
<p>å¼€å‘è€…æ¨¡å¼ä¸‹ï¼Œè®©æç¤ºè¯å¢åŠ æ€ç»´é“¾</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">modify_prompt</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'add'</span><span class="token punctuation">,</span> enable_md_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> enable_COT<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    å½“å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè®©ç”¨æˆ·é€‰æ‹©æ˜¯å¦æ·»åŠ COTæç¤ºæ¨¡æ¿æˆ–å…¶ä»–æç¤ºæ¨¡æ¿ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªç»è¿‡ä¿®æ”¹çš„æ–°çš„messageã€‚
    :param messages: å¿…è¦å‚æ•°ï¼ŒMessageManagerç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param action: 'add' æˆ– 'remove'ï¼Œå†³å®šæ˜¯æ·»åŠ è¿˜æ˜¯ç§»é™¤æç¤º
    :param enable_md_output: æ˜¯å¦å¯ç”¨ markdown æ ¼å¼è¾“å‡º
    :param enable_COT: æ˜¯å¦å¯ç”¨ COT æç¤º
    :return: messagesï¼Œä¸€ä¸ªç»è¿‡æç¤ºè¯ä¿®æ”¹çš„message
    """</span>
    
    <span class="token comment"># æ€è€ƒé“¾æç¤ºè¯æ¨¡æ¿</span>
    cot_prompt <span class="token operator">=</span> <span class="token string">"è¯·ä¸€æ­¥æ­¥æ€è€ƒå¹¶å¾—å‡ºç»“è®ºã€‚"</span>
    
    <span class="token comment"># è¾“å‡ºmarkdownæç¤ºè¯æ¨¡æ¿</span>
    md_prompt <span class="token operator">=</span> <span class="token string">"ä»»ä½•å›ç­”éƒ½è¯·ä»¥markdownæ ¼å¼è¿›è¡Œè¾“å‡ºã€‚"</span>
    <span class="token comment"># å¦‚æœæ˜¯æ·»åŠ æç¤ºè¯</span>
    <span class="token keyword">if</span> action <span class="token operator">==</span> <span class="token string">'add'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> enable_COT<span class="token punctuation">:</span>
            <span class="token comment">## openai.types.chat.chat_completion_message.ChatCompletionMessage</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>chat_completion_message<span class="token punctuation">.</span>ChatCompletionMessage<span class="token punctuation">:</span>    
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">+=</span> cot_prompt
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">+=</span> cot_prompt
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> cot_prompt
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> cot_prompt

        <span class="token keyword">if</span> enable_md_output<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>chat_completion_message<span class="token punctuation">.</span>ChatCompletionMessage<span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">+=</span> md_prompt
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">+=</span> md_prompt
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> md_prompt
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">+=</span> md_prompt
       
    <span class="token comment"># å¦‚æœæ˜¯å°†æŒ‡å®šæç¤ºè¯åˆ é™¤</span>
    <span class="token keyword">elif</span> action <span class="token operator">==</span> <span class="token string">'remove'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> enable_md_output<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>chat_completion_message<span class="token punctuation">.</span>ChatCompletionMessage<span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>md_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>md_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>md_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>md_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> enable_COT<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">is</span> openai<span class="token punctuation">.</span>types<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>chat_completion_message<span class="token punctuation">.</span>ChatCompletionMessage<span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>cot_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>cot_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>cot_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span>cot_prompt<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> messages
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">msg2<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/36/58/GYKNck9b_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2_COT <span class="token operator">=</span> modify_prompt<span class="token punctuation">(</span>messages<span class="token operator">=</span>msg2<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'add'</span><span class="token punctuation">,</span> enable_md_output<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> enable_COT<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
msg2_COT<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/32/k0BsJXNL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2_COT<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/27/40/DUpCOc71_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2_COT<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/81/b6/UqDalhGQ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2 <span class="token operator">=</span> modify_prompt<span class="token punctuation">(</span>messages<span class="token operator">=</span>msg2_COT<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'remove'</span><span class="token punctuation">,</span> enable_md_output<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> enable_COT<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
msg2<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/6c/a4/rzr6YrIm_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2 <span class="token operator">=</span> modify_prompt<span class="token punctuation">(</span>messages<span class="token operator">=</span>msg2_COT<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'add'</span><span class="token punctuation">,</span> enable_md_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> enable_COT<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
msg2_COT<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/76/77/Cdc1sLz3_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_306"></a>å››ã€å¤§æ¨¡å‹é¦–æ¬¡äº¤äº’é€»è¾‘å°è£…</h2> 
<p>ç¬¬ä¸€æ¬¡è·ŸGPTæ¨¡å‹è¿›è¡Œäº¤äº’ï¼Œç„¶åçœ‹ä»–è¿”å›æ¥çš„ç»“æœ<br> è§£æç»“æœæœ‰ä¸¤ç§å¯èƒ½ï¼š</p> 
<ol><li>è¿”å›æ¥è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°</li><li>è¿”å›æ¥è°ƒç”¨çš„ç›´æ¥çš„ç»“æœ</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_first_response</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> 
                     messages<span class="token punctuation">,</span> 
                     available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                     is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                     is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token triple-quoted-string string">"""
    è´Ÿè´£è°ƒç”¨Chatæ¨¡å‹å¹¶è·å¾—æ¨¡å‹å›ç­”å‡½æ•°ï¼Œå¹¶ä¸”å½“åœ¨è°ƒç”¨GPTæ¨¡å‹æ—¶é‡åˆ°Rate limitæ—¶å¯ä»¥é€‰æ‹©æš‚æ—¶ä¼‘çœ 1åˆ†é’Ÿåå†è¿è¡Œã€‚\
    åŒæ—¶å¯¹äºæ„å›¾ä¸æ¸…çš„é—®é¢˜ï¼Œä¼šæç¤ºç”¨æˆ·ä¿®æ”¹è¾“å…¥çš„promptï¼Œä»¥è·å¾—æ›´å¥½çš„æ¨¡å‹è¿è¡Œç»“æœã€‚
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒMessageManagerç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºæ²¡æœ‰å¤–éƒ¨å‡½æ•°
    :param is_developer_mode: è¡¨ç¤ºæ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æç¤ºè¯æ¨¡æ¿ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»£ç å‰ã€ä»¥åŠè¿”å›ç»“æœä¹‹åè¯¢é—®ç”¨æˆ·æ„è§ï¼Œå¹¶ä¼šæ ¹æ®ç”¨æˆ·æ„è§è¿›è¡Œä¿®æ”¹ã€‚
    :param is_expert_mode: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œä»£ç debugæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œdeep debugã€‚
    :return: è¿”å›æ¨¡å‹è¿”å›çš„response message
    """</span>
    
    <span class="token comment"># å¦‚æœå¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œåˆ™è¿›è¡Œæç¤ºè¯ä¿®æ”¹ï¼Œé¦–æ¬¡è¿è¡Œæ˜¯å¢åŠ æç¤ºè¯</span>
    <span class="token keyword">if</span> is_developer_mode<span class="token punctuation">:</span>
        messages <span class="token operator">=</span> modify_prompt<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'add'</span><span class="token punctuation">)</span>
        
    <span class="token comment"># å¦‚æœæ˜¯ä¸“å®¶æ¨¡å¼ï¼Œåˆ™å¢åŠ å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹</span>
    <span class="token keyword">if</span> is_expert_mode<span class="token punctuation">:</span>
        messages <span class="token operator">=</span> add_task_decomposition_prompt<span class="token punctuation">(</span>messages<span class="token punctuation">)</span>

    <span class="token comment"># è€ƒè™‘åˆ°å¯èƒ½å­˜åœ¨é€šä¿¡æŠ¥é”™é—®é¢˜ï¼Œå› æ­¤å¾ªç¯è°ƒç”¨Chatæ¨¡å‹è¿›è¡Œæ‰§è¡Œ</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># è‹¥ä¸å­˜åœ¨å¤–éƒ¨å‡½æ•°</span>
            <span class="token keyword">if</span> available_functions <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                    model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                    messages<span class="token operator">=</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">)</span>   
                
            <span class="token comment"># è‹¥å­˜åœ¨å¤–éƒ¨å‡½æ•°ï¼Œæ­¤æ—¶functionså’Œfunction_callå‚æ•°ä¿¡æ¯éƒ½ä»AvailableFunctionså¯¹è±¡ä¸­è·å–</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment">#print("è¿™å„¿æˆ‘ä¹Ÿæµ‹è¯•ä¸€ä¸‹,è°ƒç”¨cleintä¹‹å‰çš„messagesé•¿ä»€ä¹ˆæ ·----")</span>
                <span class="token comment">#print(messages.messages)</span>
                response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                    model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                    messages<span class="token operator">=</span>messages<span class="token punctuation">.</span>messages<span class="token punctuation">,</span> 
                    tools<span class="token operator">=</span>available_functions<span class="token punctuation">.</span>functions<span class="token punctuation">,</span> 
                    tool_choice<span class="token operator">=</span>available_functions<span class="token punctuation">.</span>function_call
                    <span class="token punctuation">)</span>   
            <span class="token keyword">break</span>  <span class="token comment"># å¦‚æœæˆåŠŸè·å–å“åº”ï¼Œé€€å‡ºå¾ªç¯</span>
            
        <span class="token keyword">except</span> AuthenticationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token comment"># APIConnectionErroré»˜è®¤æ˜¯ç”¨æˆ·éœ€æ±‚ä¸æ¸…å¯¼è‡´æ— æ³•è¿”å›ç»“æœ</span>
            <span class="token comment"># è‹¥å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œæ­¤æ—¶æç¤ºç”¨æˆ·é‡æ–°è¾“å…¥éœ€æ±‚</span>
            <span class="token keyword">if</span> is_expert_mode<span class="token punctuation">:</span>
                <span class="token comment"># åˆ›å»ºä¸´æ—¶æ¶ˆæ¯åˆ—è¡¨</span>
                msg_temp <span class="token operator">=</span> messages<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># è·å–ç”¨æˆ·é—®é¢˜</span>
                question <span class="token operator">=</span> msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
                <span class="token comment"># æé†’ç”¨æˆ·ä¿®æ”¹æé—®çš„æç¤ºæ¨¡æ¿</span>
                new_prompt <span class="token operator">=</span> "ä»¥ä¸‹æ˜¯ç”¨æˆ·æé—®ï¼š<span class="token operator">%</span>sã€‚è¯¥é—®é¢˜æœ‰äº›å¤æ‚ï¼Œä¸”ç”¨æˆ·æ„å›¾å¹¶ä¸æ¸…æ™°ã€‚\
                è¯·ç¼–å†™ä¸€æ®µè¯ï¼Œæ¥å¼•å¯¼ç”¨æˆ·é‡æ–°æé—®ã€‚" <span class="token operator">%</span> question
                <span class="token comment"># ä¿®æ”¹msg_tempå¹¶é‡æ–°æé—®</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_prompt
                    <span class="token comment"># ä¿®æ”¹ç”¨æˆ·é—®é¢˜å¹¶ç›´æ¥æé—®</span>
                    response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>msg_temp<span class="token punctuation">.</span>messages<span class="token punctuation">)</span>
                    
                    <span class="token comment"># æ‰“å°gptè¿”å›çš„æç¤ºä¿®æ”¹åŸé—®é¢˜çš„æè¿°è¯­å¥</span>
                    display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment"># å¼•å¯¼ç”¨æˆ·é‡æ–°è¾“å…¥é—®é¢˜æˆ–è€…é€€å‡º</span>
                    user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"è¯·é‡æ–°è¾“å…¥é—®é¢˜ï¼Œè¾“å…¥â€œé€€å‡ºâ€å¯ä»¥é€€å‡ºå½“å‰å¯¹è¯"</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">"é€€å‡º"</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å½“å‰æ¨¡å‹æ— æ³•è¿”å›ç»“æœï¼Œå·²ç»é€€å‡º"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">None</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token comment"># ä¿®æ”¹åŸå§‹é—®é¢˜</span>
                        messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_input
                        
                        <span class="token comment"># å†æ¬¡è¿›è¡Œæé—®</span>
                        response_message <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                                            messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                                            available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                                            is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                                            is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">)</span>
                        
                        <span class="token keyword">return</span> response_message
                <span class="token comment"># è‹¥åœ¨æç¤ºç”¨æˆ·ä¿®æ”¹åŸé—®é¢˜æ—¶é‡åˆ°é“¾æ¥é”™è¯¯ï¼Œåˆ™ç›´æ¥æš‚åœ1åˆ†é’Ÿåç»§ç»­æ‰§è¡ŒWhileå¾ªç¯</span>
                <span class="token keyword">except</span> AuthenticationError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å½“å‰é‡åˆ°äº†ä¸€ä¸ªé“¾æ¥é—®é¢˜: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ç”±äºLimit Rateé™åˆ¶ï¼Œå³å°†ç­‰å¾…1åˆ†é’Ÿåç»§ç»­è¿è¡Œ..."</span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>  <span class="token comment"># ç­‰å¾…1åˆ†é’Ÿ</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²ç­‰å¾…60ç§’ï¼Œå³å°†å¼€å§‹é‡æ–°è°ƒç”¨æ¨¡å‹å¹¶è¿›è¡Œå›ç­”..."</span><span class="token punctuation">)</span>
            
            <span class="token comment"># è‹¥æœªå¼€å¯å¢å¼ºæ¨¡å¼       </span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>        
                <span class="token comment"># æ‰“å°é”™è¯¯çš„æ ¸å¿ƒä¿¡æ¯</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å½“å‰é‡åˆ°äº†ä¸€ä¸ªé“¾æ¥é—®é¢˜: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token comment"># å¦‚æœæ˜¯å¼€å‘è€…æ¨¡å¼</span>
                <span class="token keyword">if</span> is_developer_mode<span class="token punctuation">:</span>
                    <span class="token comment"># é€‰æ‹©ç­‰å¾…ã€æ›´æ”¹æ¨¡å‹æˆ–è€…ç›´æ¥æŠ¥é”™é€€å‡º</span>
                    user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"è¯·é€‰æ‹©ç­‰å¾…1åˆ†é’Ÿï¼ˆ1ï¼‰ï¼Œæˆ–è€…æ›´æ¢æ¨¡å‹ï¼ˆ2ï¼‰ï¼Œæˆ–è€…æŠ¥é”™é€€å‡ºï¼ˆ3ï¼‰"</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œå°†ç­‰å¾…1åˆ†é’Ÿåç»§ç»­è¿è¡Œ..."</span><span class="token punctuation">)</span>
                        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>  <span class="token comment"># ç­‰å¾…1åˆ†é’Ÿ</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²ç­‰å¾…60ç§’ï¼Œå³å°†å¼€å§‹æ–°çš„ä¸€è½®é—®ç­”..."</span><span class="token punctuation">)</span>
                    <span class="token keyword">elif</span> user_input <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
                        model <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œè¯·è¾“å‡ºæ–°æ¨¡å‹åç§°"</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">raise</span> e  <span class="token comment"># å¦‚æœç”¨æˆ·é€‰æ‹©é€€å‡ºï¼Œæ¢å¤æç¤ºå¹¶æŠ›å‡ºå¼‚å¸¸</span>
                <span class="token comment"># å¦‚æœä¸æ˜¯å¼€å‘è€…æ¨¡å¼</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ç”±äºLimit Rateé™åˆ¶ï¼Œå³å°†ç­‰å¾…1åˆ†é’Ÿåç»§ç»­è¿è¡Œ..."</span><span class="token punctuation">)</span>
                    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>  <span class="token comment"># ç­‰å¾…1åˆ†é’Ÿ</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²ç­‰å¾…60ç§’ï¼Œå³å°†å¼€å§‹é‡æ–°è°ƒç”¨æ¨¡å‹å¹¶è¿›è¡Œå›ç­”..."</span><span class="token punctuation">)</span>

    <span class="token comment"># è¿˜åŸåŸå§‹çš„messageå¯¹è±¡</span>
    <span class="token keyword">if</span> is_developer_mode<span class="token punctuation">:</span>
        messages <span class="token operator">=</span> modify_prompt<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'remove'</span><span class="token punctuation">)</span>
        
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<h3><a id="1_436"></a>1ã€åŸºæœ¬é—®ç­”æ•ˆæœæµ‹è¯•</h3> 
<pre><code class="prism language-python">msg1 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘ç®€å•ä»‹ç»ä¸‹iqueryæ•°æ®åº“ä¸­çš„è¿™å››å¼ è¡¨"</span><span class="token punctuation">)</span>
msg1_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg1<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
msg1_response
</code></pre> 
<p>è¾“å‡º<br> <img src="https://images2.imgbox.com/28/33/jxsA4DOP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="2function_call_451"></a>2ã€function callåŠŸèƒ½æµ‹è¯•</h3> 
<pre><code class="prism language-python">msg2 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsæ•°æ®è¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ã€‚"</span><span class="token punctuation">)</span>
af<span class="token punctuation">.</span>functions
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/79/gwtrSoFp_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-python">msg2_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg2<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
msg2_response
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/2d/Dm7J8XAe_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3_469"></a>3ã€ä¸“å®¶æ¨¡å¼æµ‹è¯•</h3> 
<pre><code class="prism language-python">msg3 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsæ•°æ®è¡¨ä¸­ç¼ºå¤±å€¼æƒ…å†µã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
msg3_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg3<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
msg3_response
</code></pre> 
<p><img src="https://images2.imgbox.com/24/f9/ShxqtGyt_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4_485"></a>4ã€å¼€å‘è€…æ¨¡å¼æµ‹è¯•</h3> 
<pre><code class="prism language-python">msg4 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥çœ‹iqueryæ•°æ®åº“ä¸­user_demographicsæ•°æ®è¡¨ä¸­ç¼ºå¤±å€¼æƒ…å†µã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
msg4_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg4<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
msg4_response
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/1f/2mf16kBo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="5_500"></a>5ã€ä¸“å®¶æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯•</h3> 
<pre><code class="prism language-python">msg5 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"åˆ†æiqueryæ•°æ®åº“ä¸­çš„è¿™å››å¼ è¡¨ï¼Œå¸®æˆ‘æ¢³ç†ä¸€ä¸ªæ•°æ®åˆ†æçš„åŸºæœ¬æ€è·¯"</span><span class="token punctuation">)</span>
msg5_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg5<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
msg5_response
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/e3/YCmw5Smv_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="6_513"></a>6ã€å¼€å‘è€…æ¨¡å¼ä¸‹ä¸‹ç”¨æˆ·æ„å›¾æ¢ç©¶èƒ½åŠ›æµ‹è¯•</h3> 
<p>å¼€å‘è€…æ¨¡å‹æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥è®©ç”¨æˆ·é€‰æ‹©ï¼Œå¯ä»¥é€‰æ‹©ç­‰1åˆ†é’Ÿï¼Œä¹Ÿå¯ä»¥é€‰æ‹©é€€å‡º</p> 
<pre><code class="prism language-python">msg6 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"åˆ†æiqueryæ•°æ®åº“ä¸­çš„è¿™å››å¼ è¡¨ï¼Œå¸®æˆ‘æ¢³ç†ä¸€ä¸ªæ•°æ®åˆ†æçš„åŸºæœ¬æ€è·¯"</span><span class="token punctuation">)</span>
msg6_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg6<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span>
                                 is_developer_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                 is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
msg6_response
</code></pre> 
<p><img src="https://images2.imgbox.com/4e/9a/AnCD60aq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="function_call_528"></a>äº”ã€function callæ‰§è¡Œç»“æœæ¶ˆæ¯å°è£…</h2> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">function_to_call</span><span class="token punctuation">(</span>available_functions<span class="token punctuation">,</span> function_call_message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    æ ¹æ®ä¸€æ¡å‡½æ•°è°ƒç”¨æ¶ˆæ¯function_call_messageï¼Œè¿”å›ä¸€æ¡å‡½æ•°è¿è¡Œç»“æœæ¶ˆæ¯function_response_messagesã€‚
    :param available_functions: å¿…è¦å‚æ•°ï¼Œè¦æ±‚è¾“å…¥ä¸€ä¸ªAvailableFunctionså¯¹è±¡ï¼Œä»¥è¯´æ˜å½“å‰å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µ
    :param function_call_message: å¿…è¦å‚æ•°ï¼Œè¦æ±‚è¾“å…¥ä¸€æ¡å¤–éƒ¨å‡½æ•°è°ƒç”¨çš„message
    :return: function_response_messagesï¼Œè¾“å‡ºåˆå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœæ‰€ç»„æˆçš„message
    """</span>
    
    <span class="token comment"># è·å–è°ƒç”¨å¤–éƒ¨å‡½æ•°çš„å‡½æ•°åç§°</span>
    tool_call <span class="token operator">=</span> function_call_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    function_name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
    
    <span class="token comment"># æ ¹æ®å‡½æ•°åç§°è·å–å¯¹åº”çš„å¤–éƒ¨å‡½æ•°å¯¹è±¡</span>
    fuction_to_call <span class="token operator">=</span> available_functions<span class="token punctuation">.</span>functions_dic<span class="token punctuation">[</span>function_name<span class="token punctuation">]</span>
    
    <span class="token comment"># æå–function_call_messageä¸­è°ƒç”¨å¤–éƒ¨å‡½æ•°çš„å‡½æ•°å‚æ•°</span>
    <span class="token comment"># å³å¤§æ¨¡å‹ç¼–å†™çš„SQLæˆ–è€…Pythonä»£ç </span>
    function_args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
    
    <span class="token comment"># å°†å‚æ•°å¸¦å…¥åˆ°å¤–éƒ¨å‡½æ•°ä¸­å¹¶è¿è¡Œ</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># å°†å½“å‰æ“ä½œç©ºé—´ä¸­çš„å…¨å±€å˜é‡æ·»åŠ åˆ°å¤–éƒ¨å‡½æ•°ä¸­</span>
        function_args<span class="token punctuation">[</span><span class="token string">'g'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># è¿è¡Œå¤–éƒ¨å‡½æ•°</span>
        function_response <span class="token operator">=</span> fuction_to_call<span class="token punctuation">(</span><span class="token operator">**</span>function_args<span class="token punctuation">)</span>
      
    <span class="token comment"># è‹¥å¤–éƒ¨å‡½æ•°è¿è¡ŒæŠ¥é”™ï¼Œåˆ™æå–æŠ¥é”™ä¿¡æ¯</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        function_response <span class="token operator">=</span> <span class="token string">"å‡½æ•°è¿è¡ŒæŠ¥é”™å¦‚ä¸‹:"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        
    <span class="token comment"># åˆ›å»ºfunction_response_messages</span>
    <span class="token comment"># è¯¥messageåŒ…å«å¤–éƒ¨å‡½æ•°é¡ºåˆ©è¿è¡Œæˆ–æŠ¥é”™ä¿¡æ¯</span>
    
    function_response_messages <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"tool_call_id"</span><span class="token punctuation">:</span> tool_call<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"tool"</span><span class="token punctuation">,</span>
        <span class="token string">"name"</span><span class="token punctuation">:</span> function_name<span class="token punctuation">,</span>
        <span class="token string">"content"</span><span class="token punctuation">:</span> function_response<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> function_response_messages
</code></pre> 
<p>ç»“æœæŸ¥çœ‹</p> 
<pre><code class="prism language-python">msg <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsæ•°æ®è¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
msg_response <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                 messages<span class="token operator">=</span>msg<span class="token punctuation">,</span> 
                                 available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
msg_response
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/d2/ST2Pt4oQ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å°è£…å‡½æ•°è°ƒç”¨æµ‹è¯•</p> 
<pre><code class="prism language-python">function_response_messages <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span>available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span> function_call_message<span class="token operator">=</span>msg_response<span class="token punctuation">)</span>
function_response_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/0c/w0io8iJN_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_595"></a>å…­ã€å®Œæˆç”¨æˆ·ä¸€æ¬¡çš„å®Œæ•´äº¤äº’</h2> 
<h3><a id="1_596"></a>1ã€ä¸€æ¬¡å®Œæ•´äº¤äº’å‡½æ•°</h3> 
<p>è´Ÿè´£å®Œæ•´æ‰§è¡Œä¸€æ¬¡å¯¹è¯çš„æœ€é«˜å±‚å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ¬¡å¯¹è¯ä¸­å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨å¤§æ¨¡å‹ï¼Œè€Œæœ¬å‡½æ•°åˆ™æ˜¯å®Œæˆä¸€æ¬¡å¯¹è¯çš„ä¸»å‡½æ•°ã€‚è¦æ±‚è¾“å…¥çš„messagesä¸­æœ€åä¸€æ¡æ¶ˆæ¯å¿…é¡»æ˜¯èƒ½æ­£å¸¸å‘èµ·å¯¹è¯çš„æ¶ˆæ¯ã€‚è¯¥å‡½æ•°é€šè¿‡è°ƒç”¨get_gpt_responseæ¥è·å–æ¨¡å‹è¾“å‡ºç»“æœï¼Œå¹¶ä¸”ä¼šæ ¹æ®è¿”å›ç»“æœçš„ä¸åŒï¼Œä¾‹å¦‚æ˜¯æ–‡æœ¬ç»“æœè¿˜æ˜¯ä»£ç ç»“æœï¼Œçµæ´»è°ƒç”¨ä¸åŒå‡½æ•°å¯¹æ¨¡å‹è¾“å‡ºç»“æœè¿›è¡Œåå¤„ç†ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">one_chat_response</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> 
                      messages<span class="token punctuation">,</span> 
                      available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                      is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                      is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                      delete_some_messages<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                      is_task_decomposition<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token triple-quoted-string string">"""
    è´Ÿè´£å®Œæ•´æ‰§è¡Œä¸€æ¬¡å¯¹è¯çš„æœ€é«˜å±‚å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ¬¡å¯¹è¯ä¸­å¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨å¤§æ¨¡å‹ï¼Œè€Œæœ¬å‡½æ•°åˆ™æ˜¯å®Œæˆä¸€æ¬¡å¯¹è¯çš„ä¸»å‡½æ•°ã€‚\
    è¦æ±‚è¾“å…¥çš„messagesä¸­æœ€åä¸€æ¡æ¶ˆæ¯å¿…é¡»æ˜¯èƒ½æ­£å¸¸å‘èµ·å¯¹è¯çš„æ¶ˆæ¯ã€‚\
    è¯¥å‡½æ•°é€šè¿‡è°ƒç”¨get_gpt_responseæ¥è·å–æ¨¡å‹è¾“å‡ºç»“æœï¼Œå¹¶ä¸”ä¼šæ ¹æ®è¿”å›ç»“æœçš„ä¸åŒï¼Œä¾‹å¦‚æ˜¯æ–‡æœ¬ç»“æœè¿˜æ˜¯ä»£ç ç»“æœï¼Œ\
    çµæ´»è°ƒç”¨ä¸åŒå‡½æ•°å¯¹æ¨¡å‹è¾“å‡ºç»“æœè¿›è¡Œåå¤„ç†ã€‚\
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒChatMessagesç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºæ²¡æœ‰å¤–éƒ¨å‡½æ•°
    :param is_developer_mode: è¡¨ç¤ºæ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æç¤ºè¯æ¨¡æ¿ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»£ç å‰ã€ä»¥åŠè¿”å›ç»“æœä¹‹åè¯¢é—®ç”¨æˆ·æ„è§ï¼Œå¹¶ä¼šæ ¹æ®ç”¨æˆ·æ„è§è¿›è¡Œä¿®æ”¹ã€‚
    :param is_expert_mode: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œä»£ç debugæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œdeep debugã€‚
    :param delete_some_messages: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºåœ¨æ‹¼æ¥messagesæ—¶æ˜¯å¦åˆ é™¤ä¸­é—´è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸ºFasleã€‚
    :param is_task_decomposition: å¯é€‰å‚æ•°ï¼Œæ˜¯å¦æ˜¯å½“å‰æ‰§è¡Œä»»åŠ¡æ˜¯å¦æ˜¯å®¡æŸ¥ä»»åŠ¡æ‹†è§£ç»“æœï¼Œé»˜è®¤ä¸ºFalseã€‚
    :return: æ‹¼æ¥æœ¬æ¬¡é—®ç­”æœ€ç»ˆç»“æœçš„messages
    """</span>
    
    <span class="token comment"># å½“ä¸”ä»…å½“å›´ç»•å¤æ‚ä»»åŠ¡æ‹†è§£ç»“æœè¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ‰ä¼šå‡ºç°is_task_decomposition=Trueçš„æƒ…å†µ</span>
    <span class="token comment"># å½“is_task_decomposition=Trueæ—¶ï¼Œä¸å†é‡æ–°åˆ›å»ºresponse_message</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> is_task_decomposition<span class="token punctuation">:</span>
        <span class="token comment"># å…ˆè·å–å•æ¬¡å¤§æ¨¡å‹è°ƒç”¨ç»“æœ</span>
        <span class="token comment"># æ­¤æ—¶response_messageæ˜¯å¤§æ¨¡å‹è°ƒç”¨è¿”å›çš„message</span>
        response_message <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                            messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                            available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                            is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                            is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">)</span>
    
    <span class="token comment"># å¤æ‚æ¡ä»¶åˆ¤æ–­ï¼Œè‹¥is_task_decomposition = Trueï¼Œ</span>
    <span class="token comment"># æˆ–è€…æ˜¯ä¸“å®¶æ¨¡å¼ä¸”æ˜¯æ‰§è¡Œfunction responseä»»åŠ¡æ—¶</span>
    <span class="token comment"># ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“is_task_decomposition = Trueæ—¶ï¼Œå¹¶ä¸å­˜åœ¨response_messageå¯¹è±¡ï¼‰</span>
    <span class="token keyword">if</span> is_task_decomposition <span class="token keyword">or</span> <span class="token punctuation">(</span>is_expert_mode <span class="token keyword">and</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># å°†is_task_decompositionä¿®æ”¹ä¸ºTrueï¼Œè¡¨ç¤ºå½“å‰æ‰§è¡Œä»»åŠ¡ä¸ºå¤æ‚ä»»åŠ¡æ‹†è§£</span>
        <span class="token comment">#print("&gt;&gt;è¿™å„¿")</span>
        is_task_decomposition <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token comment"># åœ¨æ‹†è§£ä»»åŠ¡æ—¶ï¼Œå°†å¢åŠ äº†ä»»åŠ¡æ‹†è§£çš„few-shot-messageå‘½åä¸ºtext_response_messages</span>
        task_decomp_few_shot <span class="token operator">=</span> add_task_decomposition_prompt<span class="token punctuation">(</span>messages<span class="token punctuation">)</span>
        <span class="token comment"># print("æ­£åœ¨è¿›è¡Œä»»åŠ¡åˆ†è§£ï¼Œè¯·ç¨å...")</span>
        <span class="token comment"># åŒæ—¶æ›´æ–°response_messageï¼Œæ­¤æ—¶response_messageå°±æ˜¯ä»»åŠ¡æ‹†è§£ä¹‹åçš„response</span>
        response_message <span class="token operator">=</span> get_first_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                            messages<span class="token operator">=</span>task_decomp_few_shot<span class="token punctuation">,</span> 
                                            available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                            is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                            is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">)</span>
        <span class="token comment"># è‹¥æ‹†åˆ†ä»»åŠ¡çš„æç¤ºæ— æ•ˆï¼Œæ­¤æ—¶response_messageæœ‰å¯èƒ½ä¼šå†æ¬¡åˆ›å»ºä¸€ä¸ªfunction call message</span>
        <span class="token keyword">if</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å½“å‰ä»»åŠ¡æ— éœ€æ‹†è§£ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œã€‚"</span><span class="token punctuation">)</span>

    <span class="token comment"># è‹¥æœ¬æ¬¡è°ƒç”¨æ˜¯ç”±ä¿®æ”¹å¯¹è¯éœ€æ±‚äº§ç”Ÿï¼Œåˆ™æŒ‰ç…§å‚æ•°è®¾ç½®åˆ é™¤åŸå§‹messageä¸­çš„è‹¥å¹²æ¡æ¶ˆæ¯</span>
    <span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ é™¤ä¸­é—´è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œå¿…é¡»åœ¨åˆ›å»ºå®Œæ–°çš„response_messageä¹‹åå†æ‰§è¡Œ</span>
    <span class="token keyword">if</span> delete_some_messages<span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>delete_some_messages<span class="token punctuation">)</span><span class="token punctuation">:</span>
            messages<span class="token punctuation">.</span>messages_pop<span class="token punctuation">(</span>manual<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># æ³¨æ„ï¼Œæ‰§è¡Œåˆ°æ­¤å¤„æ—¶ï¼Œä¸€å®šä¼šæœ‰ä¸€ä¸ªresponse_message</span>
    <span class="token comment"># æ¥ä¸‹æ¥åˆ†response_messageä¸åŒç±»å‹ï¼Œæ‰§è¡Œä¸åŒæµç¨‹</span>
    <span class="token comment"># è‹¥æ˜¯æ–‡æœ¬å“åº”ç±»ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ™®é€šæ–‡æœ¬å“åº”å’Œå’Œå¤æ‚ä»»åŠ¡æ‹†è§£å®¡æŸ¥ä¸¤ç§æƒ…å†µï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒä»£ç ï¼‰</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
        <span class="token comment"># å°†messageä¿å­˜ä¸ºtext_answer_message</span>
        text_answer_message <span class="token operator">=</span> response_message 
        <span class="token comment"># å¹¶å¸¦å…¥is_text_response_validå¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œå®¡æŸ¥</span>
        messages <span class="token operator">=</span> handle_text_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                          messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                          text_answer_message<span class="token operator">=</span>text_answer_message<span class="token punctuation">,</span>
                                          available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                          is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                          is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                          delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">,</span>
                                          is_task_decomposition<span class="token operator">=</span>is_task_decomposition<span class="token punctuation">)</span>
    
    
    
    <span class="token comment"># è‹¥æ˜¯function responseä»»åŠ¡</span>
    <span class="token keyword">elif</span> response_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">:</span>
        <span class="token comment"># åˆ›å»ºè°ƒç”¨å¤–éƒ¨å‡½æ•°çš„function_call_message</span>
        <span class="token comment"># åœ¨å½“å‰Agentä¸­ï¼Œfunction_call_messageæ˜¯ä¸€ä¸ªåŒ…å«SQLä»£ç æˆ–è€…Pythonä»£ç çš„JSONå¯¹è±¡</span>
        function_call_message <span class="token operator">=</span> response_message 
        <span class="token comment"># å°†function_call_messageå¸¦å…¥ä»£ç å®¡æŸ¥å’Œè¿è¡Œå‡½æ•°is_code_response_valid</span>
        <span class="token comment"># å¹¶æœ€ç»ˆè·å¾—å¤–éƒ¨å‡½æ•°è¿è¡Œä¹‹åçš„é—®ç­”ç»“æœ</span>
        messages <span class="token operator">=</span> handle_code_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                          messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                          function_call_message<span class="token operator">=</span>function_call_message<span class="token punctuation">,</span>
                                          available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                          is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                          is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                          delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> messages    
</code></pre> 
<h3><a id="2_700"></a>2ã€å¤–å±‚è°ƒç”¨å‡½æ•°</h3> 
<p>è´Ÿè´£å®Œæ•´æ‰§è¡Œä¸€æ¬¡å¤–éƒ¨å‡½æ•°è°ƒç”¨çš„æœ€é«˜å±‚å‡½æ•°ï¼Œè¦æ±‚è¾“å…¥çš„msgæœ€åä¸€æ¡æ¶ˆæ¯å¿…é¡»æ˜¯åŒ…å«function callçš„æ¶ˆæ¯ã€‚<br> å‡½æ•°çš„æœ€ç»ˆä»»åŠ¡æ˜¯å°†function callçš„æ¶ˆæ¯ä¸­çš„ä»£ç å¸¦å…¥å¤–éƒ¨å‡½æ•°å¹¶å®Œæˆä»£ç è¿è¡Œï¼Œå¹¶ä¸”æ”¯æŒäº¤äº’å¼ä»£ç ç¼–å†™æˆ–è‡ªåŠ¨ä»£ç ç¼–å†™è¿è¡Œä¸åŒæ¨¡å¼ã€‚å½“å‡½æ•°è¿è¡Œå¾—åˆ°ä¸€æ¡åŒ…å«å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœçš„function messageä¹‹åï¼Œä¼šç»§ç»­å°†å…¶å¸¦å…¥check_get_final_function_responseå‡½æ•°ï¼Œæœ€ç»ˆå°†function messageè½¬åŒ–ä¸ºassistant messageï¼Œå¹¶å®Œæˆæœ¬æ¬¡å¯¹è¯ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># åˆ¤æ–­ä»£ç è¾“å‡ºç»“æœæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œè¾“å…¥function call messageï¼Œè¾“å‡ºfunction response message</span>
<span class="token keyword">def</span> <span class="token function">handle_code_response</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> 
                           messages<span class="token punctuation">,</span> 
                           function_call_message<span class="token punctuation">,</span>
                           available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                           is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                           is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                           delete_some_messages<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    
    <span class="token triple-quoted-string string">"""
    è´Ÿè´£å®Œæ•´æ‰§è¡Œä¸€æ¬¡å¤–éƒ¨å‡½æ•°è°ƒç”¨çš„æœ€é«˜å±‚å‡½æ•°ï¼Œè¦æ±‚è¾“å…¥çš„msgæœ€åä¸€æ¡æ¶ˆæ¯å¿…é¡»æ˜¯åŒ…å«function callçš„æ¶ˆæ¯ã€‚\
    å‡½æ•°çš„æœ€ç»ˆä»»åŠ¡æ˜¯å°†function callçš„æ¶ˆæ¯ä¸­çš„ä»£ç å¸¦å…¥å¤–éƒ¨å‡½æ•°å¹¶å®Œæˆä»£ç è¿è¡Œï¼Œå¹¶ä¸”æ”¯æŒäº¤äº’å¼ä»£ç ç¼–å†™æˆ–è‡ªåŠ¨ä»£ç ç¼–å†™è¿è¡Œä¸åŒæ¨¡å¼ã€‚\
    å½“å‡½æ•°è¿è¡Œå¾—åˆ°ä¸€æ¡åŒ…å«å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœçš„function messageä¹‹åï¼Œä¼šç»§ç»­å°†å…¶å¸¦å…¥check_get_final_function_responseå‡½æ•°ï¼Œ\
    ç”¨äºæœ€ç»ˆå°†function messageè½¬åŒ–ä¸ºassistant messageï¼Œå¹¶å®Œæˆæœ¬æ¬¡å¯¹è¯ã€‚
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒChatMessagesç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param function_call_message: å¿…è¦å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºä¸Šå±‚å‡½æ•°åˆ›å»ºçš„ä¸€æ¡åŒ…å«function callæ¶ˆæ¯çš„message
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºæ²¡æœ‰å¤–éƒ¨å‡½æ•°
    :param is_developer_mode: è¡¨ç¤ºæ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æç¤ºè¯æ¨¡æ¿ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»£ç å‰ã€ä»¥åŠè¿”å›ç»“æœä¹‹åè¯¢é—®ç”¨æˆ·æ„è§ï¼Œå¹¶ä¼šæ ¹æ®ç”¨æˆ·æ„è§è¿›è¡Œä¿®æ”¹ã€‚
    :param is_expert_mode: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œä»£ç debugæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œdeep debugã€‚
    :param delete_some_messages: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºåœ¨æ‹¼æ¥messagesæ—¶æ˜¯å¦åˆ é™¤ä¸­é—´è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸ºFasleã€‚
    :return: messageï¼Œæ‹¼æ¥äº†æœ€æ–°å¤§æ¨¡å‹å›ç­”ç»“æœçš„message
    """</span>
    
    <span class="token comment"># ä¸ºæ‰“å°ä»£ç å’Œä¿®æ”¹ä»£ç ï¼ˆå¢åŠ åˆ›å»ºå›¾åƒå¯¹å®¶éƒ¨åˆ†ä»£ç ï¼‰åšå‡†å¤‡</span>
    <span class="token comment"># åˆ›å»ºå­—ç¬¦ä¸²ç±»å‹jsonæ ¼å¼çš„messageå¯¹è±¡</span>
    code_json_str <span class="token operator">=</span> function_call_message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments
    <span class="token comment"># print("========è¿™å„¿å¯èƒ½æœ‰é—®é¢˜======")</span>
    <span class="token comment"># print(function_call_message)</span>
    <span class="token comment"># print(function_call_message.tool_calls[0].function.arguments)</span>
    <span class="token comment"># å°†jsonè½¬åŒ–ä¸ºå­—å…¸</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        code_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>code_json_str<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"jsonå­—ç¬¦è§£æé”™è¯¯ï¼Œæ­£åœ¨é‡æ–°åˆ›å»ºä»£ç ..."</span><span class="token punctuation">)</span>
        <span class="token comment"># é€’å½’è°ƒç”¨ä¸Šå±‚å‡½æ•°get_chat_responseï¼Œå¹¶è¿”å›æœ€ç»ˆmessageç»“æœ</span>
        <span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸Šå±‚å‡½æ•°å†æ¬¡åˆ›å»ºäº†function_call_message</span>
        <span class="token comment"># åˆ™ä¼šå†æ¬¡è°ƒç”¨is_code_response_validï¼Œè€Œæ— éœ€åœ¨å½“å‰å‡½æ•°ä¸­å†æ¬¡æ‰§è¡Œ</span>
        messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                     messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                     available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                     is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                     is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                     delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> messages
        
    <span class="token comment"># è‹¥é¡ºåˆ©å°†jsonè½¬åŒ–ä¸ºå­—å…¸ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä»¥ä¸‹ä»£ç </span>
    <span class="token comment"># åˆ›å»ºconvert_to_markdownå†…éƒ¨å‡½æ•°ï¼Œç”¨äºè¾…åŠ©æ‰“å°ä»£ç ç»“æœ</span>
    <span class="token keyword">def</span> <span class="token function">convert_to_markdown</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> language<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"```</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>language<span class="token punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">\n```"</span></span>

    <span class="token comment"># æå–ä»£ç éƒ¨åˆ†å‚æ•°</span>
    <span class="token comment"># å¦‚æœæ˜¯SQLï¼Œåˆ™æŒ‰ç…§Markdownä¸­SQLæ ¼å¼æ‰“å°ä»£ç </span>
    <span class="token keyword">if</span> code_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sql_query'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        code <span class="token operator">=</span> code_dict<span class="token punctuation">[</span><span class="token string">'sql_query'</span><span class="token punctuation">]</span> 
        markdown_code <span class="token operator">=</span> convert_to_markdown<span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">'sql'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å³å°†æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š"</span><span class="token punctuation">)</span>
        
    <span class="token comment"># å¦‚æœæ˜¯Pythonï¼Œåˆ™æŒ‰ç…§Markdownä¸­Pythonæ ¼å¼æ‰“å°ä»£ç </span>
    <span class="token keyword">elif</span> code_dict<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'py_code'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        code <span class="token operator">=</span> code_dict<span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">]</span>
        markdown_code <span class="token operator">=</span> convert_to_markdown<span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å³å°†æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š"</span><span class="token punctuation">)</span>
        
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        markdown_code <span class="token operator">=</span> code_dict
        
    display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>markdown_code<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
      
    <span class="token comment"># è‹¥æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œåˆ™æç¤ºç”¨æˆ·å…ˆå¯¹ä»£ç è¿›è¡Œå®¡æŸ¥ç„¶åå†è¿è¡Œ</span>
    <span class="token keyword">if</span> is_developer_mode<span class="token punctuation">:</span>         
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"æ˜¯ç›´æ¥è¿è¡Œä»£ç ï¼ˆ1ï¼‰ï¼Œè¿˜æ˜¯åé¦ˆä¿®æ”¹æ„è§ï¼Œå¹¶è®©æ¨¡å‹å¯¹ä»£ç è¿›è¡Œä¿®æ”¹åå†è¿è¡Œï¼ˆ2ï¼‰"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œæ­£åœ¨è¿è¡Œä»£ç ï¼Œè¯·ç¨å..."</span><span class="token punctuation">)</span>
                
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            modify_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œè¯·è¾“å…¥ä¿®æ”¹æ„è§ï¼š"</span><span class="token punctuation">)</span>
            <span class="token comment"># è®°å½•æ¨¡å‹å½“å‰åˆ›å»ºçš„ä»£ç </span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>function_call_message<span class="token punctuation">)</span>
            <span class="token comment"># è®°å½•ä¿®æ”¹æ„è§</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> modify_input<span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token comment"># è°ƒç”¨get_chat_responseå‡½æ•°å¹¶é‡æ–°è·å–å›ç­”ç»“æœ</span>
            <span class="token comment"># éœ€è¦æ³¨æ„ï¼Œæ­¤æ—¶éœ€è¦è®¾ç½®delete_some_messages=2ï¼Œåˆ é™¤ä¸­é—´å¯¹è¯ç»“æœä»¥èŠ‚çœtoken</span>
            messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                         messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                         available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                         is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                         is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                         delete_some_messages<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            
            <span class="token keyword">return</span> messages
                
    <span class="token comment"># è‹¥ä¸æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œæˆ–è€…å¼€å‘è€…æ¨¡å¼ä¸‹user_input == '1'</span>
    <span class="token comment"># åˆ™è°ƒç”¨function_to_callå‡½æ•°ï¼Œå¹¶è·å–æœ€ç»ˆå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœ</span>
    <span class="token comment"># åœ¨å½“å‰Agentä¸­ï¼Œå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœå°±æ˜¯SQLæˆ–è€…Pythonè¿è¡Œç»“æœï¼Œæˆ–ä»£ç è¿è¡ŒæŠ¥é”™ç»“æœ</span>
    function_response_message <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span>available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span> 
                                                 function_call_message<span class="token operator">=</span>function_call_message<span class="token punctuation">)</span>  
    
    <span class="token comment"># å°†function_response_messageå¸¦å…¥check_get_final_function_responseè¿›è¡Œå®¡æŸ¥</span>
    messages <span class="token operator">=</span> check_function_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                                 messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                                 function_call_message<span class="token operator">=</span>function_call_message<span class="token punctuation">,</span>
                                                 function_response_message<span class="token operator">=</span>function_response_message<span class="token punctuation">,</span>
                                                 available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                                 is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                                 is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                                 delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> messages
</code></pre> 
<h3><a id="3_823"></a>3ã€å“åº”ç»“æœæ£€æŸ¥å‡½æ•°</h3> 
<p>è´Ÿè´£æ‰§è¡Œå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœå®¡æŸ¥å·¥ä½œã€‚è‹¥å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœæ¶ˆæ¯function_response_messageå¹¶ä¸å­˜åœ¨æŠ¥é”™ä¿¡æ¯ï¼Œåˆ™å°†å…¶æ‹¼æ¥å…¥messageä¸­ï¼Œå¹¶å°†å…¶å¸¦å…¥get_chat_responseå‡½æ•°å¹¶è·å–ä¸‹ä¸€è½®å¯¹è¯ç»“æœã€‚è€Œå¦‚æœfunction_response_messageä¸­å­˜åœ¨æŠ¥é”™ä¿¡æ¯ï¼Œåˆ™å¼€å¯è‡ªåŠ¨debugæ¨¡å¼ã€‚æœ¬å‡½æ•°å°†å€ŸåŠ©ç±»ä¼¼Autogençš„æ¨¡å¼ï¼Œå¤åˆ¶å¤šä¸ªAgentï¼Œå¹¶é€šè¿‡å½¼æ­¤å¯¹è¯çš„æ–¹å¼æ¥å®Œæˆdebugã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># åˆ¤æ–­ä»£ç è¾“å‡ºç»“æœæ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œè¾“å…¥function response messageï¼Œè¾“å‡ºåŸºäºå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœçš„message</span>
<span class="token keyword">def</span> <span class="token function">check_function_response</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> 
                            messages<span class="token punctuation">,</span> 
                            function_call_message<span class="token punctuation">,</span>
                            function_response_message<span class="token punctuation">,</span>
                            available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                            is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                            delete_some_messages<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token triple-quoted-string string">"""
    è´Ÿè´£æ‰§è¡Œå¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœå®¡æŸ¥å·¥ä½œã€‚è‹¥å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœæ¶ˆæ¯function_response_messageå¹¶ä¸å­˜åœ¨æŠ¥é”™ä¿¡æ¯ï¼Œ\
    åˆ™å°†å…¶æ‹¼æ¥å…¥messageä¸­ï¼Œå¹¶å°†å…¶å¸¦å…¥get_chat_responseå‡½æ•°å¹¶è·å–ä¸‹ä¸€è½®å¯¹è¯ç»“æœã€‚è€Œå¦‚æœfunction_response_messageä¸­å­˜åœ¨æŠ¥é”™ä¿¡æ¯ï¼Œ\
    åˆ™å¼€å¯è‡ªåŠ¨debugæ¨¡å¼ã€‚æœ¬å‡½æ•°å°†å€ŸåŠ©ç±»ä¼¼Autogençš„æ¨¡å¼ï¼Œå¤åˆ¶å¤šä¸ªAgentï¼Œå¹¶é€šè¿‡å½¼æ­¤å¯¹è¯çš„æ–¹å¼æ¥å®Œæˆdebugã€‚
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒChatMessagesç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param function_call_message: å¿…è¦å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºä¸Šå±‚å‡½æ•°åˆ›å»ºçš„ä¸€æ¡åŒ…å«function callæ¶ˆæ¯çš„message
    :param function_response_message: å¿…è¦å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºä¸Šå±‚å‡½æ•°åˆ›å»ºçš„ä¸€æ¡åŒ…å«å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœçš„message
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºæ²¡æœ‰å¤–éƒ¨å‡½æ•°
    :param is_developer_mode: è¡¨ç¤ºæ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æç¤ºè¯æ¨¡æ¿ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»£ç å‰ã€ä»¥åŠè¿”å›ç»“æœä¹‹åè¯¢é—®ç”¨æˆ·æ„è§ï¼Œå¹¶ä¼šæ ¹æ®ç”¨æˆ·æ„è§è¿›è¡Œä¿®æ”¹ã€‚
    :param is_expert_mode: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œä»£ç debugæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œdeep debugã€‚
    :param delete_some_messages: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºåœ¨æ‹¼æ¥messagesæ—¶æ˜¯å¦åˆ é™¤ä¸­é—´è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸ºFasleã€‚
    :return: messageï¼Œæ‹¼æ¥äº†æœ€æ–°å¤§æ¨¡å‹å›ç­”ç»“æœçš„message
    """</span>    
    
    <span class="token comment"># è·å–å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœå†…å®¹</span>
    fun_res_content <span class="token operator">=</span> function_response_message<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
    
    <span class="token comment"># è‹¥function_responseä¸­åŒ…å«é”™è¯¯</span>
    <span class="token keyword">if</span> <span class="token string">"æŠ¥é”™"</span> <span class="token keyword">in</span> fun_res_content<span class="token punctuation">:</span>
        <span class="token comment"># æ‰“å°æŠ¥é”™ä¿¡æ¯</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>fun_res_content<span class="token punctuation">)</span>
        
        <span class="token comment"># æ ¹æ®æ˜¯å¦æ˜¯å¢å¼ºæ¨¡å¼ï¼Œé€‰æ‹©æ‰§è¡Œé«˜æ•ˆdebugæˆ–æ·±åº¦debug</span>
        <span class="token comment"># é«˜æ•ˆdebugå’Œæ·±åº¦debugåŒºåˆ«åªåœ¨äºæç¤ºå†…å®¹å’Œæç¤ºæµç¨‹çš„ä¸åŒ</span>
        <span class="token comment"># é«˜æ•ˆdebugåªåŒ…å«ä¸€æ¡æç¤ºï¼Œåªè°ƒç”¨ä¸€æ¬¡å¤§æ¨¡å‹å³å¯å®Œæˆè‡ªåŠ¨debugå·¥ä½œ</span>
        <span class="token comment"># è€Œæ·±åº¦debugåˆ™åŒ…å«ä¸‰æ¬¡æç¤ºï¼Œéœ€è¦è°ƒç”¨ä¸‰æ¬¡å¤§æ¨¡å‹è¿›è¡Œæ·±åº¦æ€»ç»“å¹¶å®Œæˆdebugå·¥ä½œ</span>
        <span class="token comment"># å…ˆåˆ›å»ºä¸åŒæ¨¡å¼bubugçš„ä¸åŒæç¤ºè¯</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> is_expert_mode<span class="token punctuation">:</span>
            <span class="token comment"># æ‰§è¡Œé«˜æ•ˆdebug</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span><span class="token string">"**å³å°†æ‰§è¡Œé«˜æ•ˆdebugï¼Œæ­£åœ¨å®ä¾‹åŒ–Efficient Debug Agent...**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            debug_prompt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ä½ ç¼–å†™çš„ä»£ç æŠ¥é”™äº†ï¼Œè¯·æ ¹æ®æŠ¥é”™ä¿¡æ¯ä¿®æ”¹ä»£ç å¹¶é‡æ–°æ‰§è¡Œã€‚'</span><span class="token punctuation">]</span>
            
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># æ‰§è¡Œæ·±åº¦debug</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span><span class="token string">"**å³å°†æ‰§è¡Œæ·±åº¦debugï¼Œè¯¥debugè¿‡ç¨‹å°†è‡ªåŠ¨æ‰§è¡Œå¤šè½®å¯¹è¯ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚æ­£åœ¨å®ä¾‹åŒ–Deep Debug Agent...**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span><span class="token string">"**æ­£åœ¨å®ä¾‹åŒ–deep debug Agent...**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            debug_prompt_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"ä¹‹å‰æ‰§è¡Œçš„ä»£ç æŠ¥é”™äº†ï¼Œä½ è§‰å¾—ä»£ç å“ªé‡Œç¼–å†™é”™äº†ï¼Ÿ"</span><span class="token punctuation">,</span> 
                                 <span class="token string">"å¥½çš„ã€‚é‚£ä¹ˆæ ¹æ®ä½ çš„åˆ†æï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé”™è¯¯ï¼Œä»ç†è®ºä¸Šæ¥è¯´ï¼Œåº”è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ"</span><span class="token punctuation">,</span> 
                                 <span class="token string">"éå¸¸å¥½ï¼Œæ¥ä¸‹æ¥è¯·æŒ‰ç…§ä½ çš„é€»è¾‘ç¼–å†™ç›¸åº”ä»£ç å¹¶è¿è¡Œã€‚"</span><span class="token punctuation">]</span>
        
        <span class="token comment"># å¤åˆ¶msgï¼Œç›¸å½“äºåˆ›å»ºä¸€ä¸ªæ–°çš„Agentè¿›è¡Œdebug</span>
        <span class="token comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶msgæœ€åä¸€æ¡æ¶ˆæ¯æ˜¯user messageï¼Œè€Œä¸æ˜¯ä»»ä½•å‡½æ•°è°ƒç”¨ç›¸å…³message</span>
        msg_debug <span class="token operator">=</span> messages<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>        
        <span class="token comment"># è¿½åŠ function_call_message</span>
        <span class="token comment"># å½“å‰function_call_messageä¸­åŒ…å«ç¼–é”™çš„ä»£ç </span>
        msg_debug<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>function_call_message<span class="token punctuation">)</span>
        <span class="token comment"># è¿½åŠ function_response_message</span>
        <span class="token comment"># å½“å‰function_response_messageåŒ…å«é”™è¯¯ä»£ç çš„è¿è¡ŒæŠ¥é”™ä¿¡æ¯</span>
        msg_debug<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>function_response_message<span class="token punctuation">)</span>        
        
        <span class="token comment"># ä¾æ¬¡è¾“å…¥debugçš„promptï¼Œæ¥å¼•å¯¼å¤§æ¨¡å‹å®Œæˆdebug</span>
        <span class="token keyword">for</span> debug_prompt <span class="token keyword">in</span> debug_prompt_list<span class="token punctuation">:</span>
            msg_debug<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> debug_prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span><span class="token string">"**From Debug iQuery Agent:**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>debug_prompt<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># å†æ¬¡è°ƒç”¨get_chat_responseï¼Œåœ¨å½“å‰debugçš„promptä¸‹ï¼Œget_chat_responseä¼šè¿”å›ä¿®æ”¹æ„è§æˆ–ä¿®æ”¹ä¹‹åçš„ä»£ç </span>
            <span class="token comment"># æ‰“å°æç¤ºä¿¡æ¯</span>
            display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span><span class="token string">"**From iQuery Agent:**"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            msg_debug <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                          messages<span class="token operator">=</span>msg_debug<span class="token punctuation">,</span> 
                                          available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                          is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                          is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                                          delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">)</span>
        
        messages <span class="token operator">=</span> msg_debug<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>     
                 
    <span class="token comment"># è‹¥function messageä¸åŒ…å«æŠ¥é”™ä¿¡æ¯    </span>
    <span class="token comment"># éœ€è¦å°†function messageä¼ é€’ç»™æ¨¡å‹</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¤–éƒ¨å‡½æ•°å·²æ‰§è¡Œå®Œæ¯•ï¼Œæ­£åœ¨è§£æè¿è¡Œç»“æœ..."</span><span class="token punctuation">)</span>
        messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>function_call_message<span class="token punctuation">)</span>
        messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>function_response_message<span class="token punctuation">)</span>
        messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                     messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                     available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                     is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                     is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                     delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">)</span>
        
    <span class="token keyword">return</span> messages
</code></pre> 
<h3><a id="4_925"></a>4ã€æ–‡æœ¬å†…å®¹æ£€æŸ¥å‡½æ•°</h3> 
<p>è´Ÿè´£æ‰§è¡Œæ–‡æœ¬å†…å®¹åˆ›å»ºå®¡æŸ¥å·¥ä½œã€‚è¿è¡Œæ¨¡å¼å¯åˆ†ä¸ºå¿«é€Ÿæ¨¡å¼å’Œäººå·¥å®¡æŸ¥æ¨¡å¼ã€‚åœ¨å¿«é€Ÿæ¨¡å¼ä¸‹ï¼Œæ¨¡å‹å°†è¿…é€Ÿåˆ›å»ºæ–‡æœ¬å¹¶ä¿å­˜è‡³msgå¯¹è±¡ä¸­ï¼Œè€Œå¦‚æœæ˜¯äººå·¥å®¡æŸ¥æ¨¡å¼ï¼Œåˆ™éœ€è¦å…ˆç»è¿‡äººå·¥ç¡®è®¤ï¼Œå‡½æ•°æ‰ä¼šä¿å­˜å¤§æ¨¡å‹åˆ›å»ºçš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è®©æ¨¡å‹æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ä¿®æ”¹æ„è§é‡æ–°ä¿®æ”¹æ–‡æœ¬</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">handle_text_response</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> 
                           messages<span class="token punctuation">,</span> 
                           text_answer_message<span class="token punctuation">,</span>
                           available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                           is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                           is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
                           delete_some_messages<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                           is_task_decomposition<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token triple-quoted-string string">"""
    è´Ÿè´£æ‰§è¡Œæ–‡æœ¬å†…å®¹åˆ›å»ºå®¡æŸ¥å·¥ä½œã€‚è¿è¡Œæ¨¡å¼å¯åˆ†ä¸ºå¿«é€Ÿæ¨¡å¼å’Œäººå·¥å®¡æŸ¥æ¨¡å¼ã€‚åœ¨å¿«é€Ÿæ¨¡å¼ä¸‹ï¼Œæ¨¡å‹å°†è¿…é€Ÿåˆ›å»ºæ–‡æœ¬å¹¶ä¿å­˜è‡³msgå¯¹è±¡ä¸­ï¼Œ\
    è€Œå¦‚æœæ˜¯äººå·¥å®¡æŸ¥æ¨¡å¼ï¼Œåˆ™éœ€è¦å…ˆç»è¿‡äººå·¥ç¡®è®¤ï¼Œå‡½æ•°æ‰ä¼šä¿å­˜å¤§æ¨¡å‹åˆ›å»ºçš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶ä¸”åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ\
    ä¹Ÿå¯ä»¥é€‰æ‹©è®©æ¨¡å‹æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ä¿®æ”¹æ„è§é‡æ–°ä¿®æ”¹æ–‡æœ¬ã€‚
    :param model: å¿…è¦å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨çš„å¤§æ¨¡å‹åç§°
    :param messages: å¿…è¦å‚æ•°ï¼ŒChatMessagesç±»å‹å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨å¯¹è¯æ¶ˆæ¯
    :param text_answer_message: å¿…è¦å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºä¸Šå±‚å‡½æ•°åˆ›å»ºçš„ä¸€æ¡åŒ…å«æ–‡æœ¬å†…å®¹çš„message
    :param available_functions: å¯é€‰å‚æ•°ï¼ŒAvailableFunctionsç±»å‹å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå¼€å¯å¯¹è¯æ—¶å¤–éƒ¨å‡½æ•°åŸºæœ¬æƒ…å†µã€‚\
    é»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºæ²¡æœ‰å¤–éƒ¨å‡½æ•°
    :param is_developer_mode: è¡¨ç¤ºæ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¼€å‘è€…æ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ æç¤ºè¯æ¨¡æ¿ï¼Œå¹¶ä¸”ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œä»£ç å‰ã€ä»¥åŠè¿”å›ç»“æœä¹‹åè¯¢é—®ç”¨æˆ·æ„è§ï¼Œå¹¶ä¼šæ ¹æ®ç”¨æˆ·æ„è§è¿›è¡Œä¿®æ”¹ã€‚
    :param is_expert_mode: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œé»˜è®¤ä¸ºFalseã€‚\
    å¼€å¯å¢å¼ºæ¨¡å¼æ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œä»£ç debugæ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œdeep debugã€‚
    :param delete_some_messages: å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºåœ¨æ‹¼æ¥messagesæ—¶æ˜¯å¦åˆ é™¤ä¸­é—´è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œé»˜è®¤ä¸ºFasleã€‚
    :param is_task_decomposition: å¯é€‰å‚æ•°ï¼Œæ˜¯å¦æ˜¯å½“å‰æ‰§è¡Œä»»åŠ¡æ˜¯å¦æ˜¯å®¡æŸ¥ä»»åŠ¡æ‹†è§£ç»“æœï¼Œé»˜è®¤ä¸ºFalseã€‚
    :return: messageï¼Œæ‹¼æ¥äº†æœ€æ–°å¤§æ¨¡å‹å›ç­”ç»“æœçš„message
    """</span>    
    
    <span class="token comment"># ä»text_answer_messageä¸­è·å–æ¨¡å‹å›ç­”ç»“æœå¹¶æ‰“å°</span>
    answer_content <span class="token operator">=</span> text_answer_message<span class="token punctuation">.</span>content
    <span class="token comment"># print("çœ‹çœ‹è¿™ä¸ªå€¼is_task_decomposition")</span>
    <span class="token comment"># print(is_task_decomposition)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ¨¡å‹å›ç­”ï¼š\n"</span><span class="token punctuation">)</span>
    display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>answer_content<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># åˆ›å»ºæŒ‡ç¤ºå˜é‡user_inputï¼Œç”¨äºè®°å½•ç”¨æˆ·ä¿®æ”¹æ„è§ï¼Œé»˜è®¤ä¸ºNone</span>
    user_input <span class="token operator">=</span> <span class="token boolean">None</span>
    
    <span class="token comment"># è‹¥æ˜¯å¼€å‘è€…æ¨¡å¼ï¼Œæˆ–è€…æ˜¯å¢å¼ºæ¨¡å¼ä¸‹ä»»åŠ¡æ‹†è§£ç»“æœï¼Œåˆ™å¼•å¯¼ç”¨æˆ·å¯¹å…¶è¿›è¡Œå®¡æŸ¥</span>
    <span class="token comment"># è‹¥æ˜¯å¼€å‘è€…æ¨¡å¼è€Œéä»»åŠ¡æ‹†è§£</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> is_task_decomposition <span class="token keyword">and</span> is_developer_mode<span class="token punctuation">:</span>
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span>"è¯·é—®æ˜¯å¦è®°å½•å›ç­”ç»“æœï¼ˆ<span class="token number">1</span>ï¼‰ï¼Œ\
        æˆ–è€…å¯¹å½“å‰ç»“æœæå‡ºä¿®æ”¹æ„è§ï¼ˆ<span class="token number">2</span>ï¼‰ï¼Œ\
        æˆ–è€…é‡æ–°è¿›è¡Œæé—®ï¼ˆ<span class="token number">3</span>ï¼‰ï¼Œ\
        æˆ–è€…ç›´æ¥é€€å‡ºå¯¹è¯ï¼ˆ<span class="token number">4</span>ï¼‰"<span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token comment"># è‹¥è®°å½•å›ç­”ç»“æœï¼Œåˆ™å°†å…¶æ·»åŠ å…¥msgå¯¹è±¡ä¸­</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>text_answer_message<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æœ¬æ¬¡å¯¹è¯ç»“æœå·²ä¿å­˜"</span><span class="token punctuation">)</span>
    
    <span class="token comment">## æ·»åŠ äº†ä¸€ä¸ªé€»è¾‘ï¼Œå¦‚æœæ˜¯ä»»åŠ¡æ‹†è§£ï¼Œæˆ–è€…æ˜¯ä¸“å®¶æ¨¡å¼ï¼ˆä¸“å®¶æ¨¡å¼é‡Œéƒ½æœ‰ä»»åŠ¡æ‹†è§£ï¼‰</span>
    <span class="token comment"># è‹¥æ˜¯ä»»åŠ¡æ‹†è§£</span>
    <span class="token keyword">elif</span> is_task_decomposition <span class="token keyword">or</span> is_expert_mode<span class="token punctuation">:</span>
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span>"è¯·é—®æ˜¯å¦æŒ‰ç…§è¯¥æµç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆ<span class="token number">1</span>ï¼‰ï¼Œ\
        æˆ–è€…å¯¹å½“å‰æ‰§è¡Œæµç¨‹æå‡ºä¿®æ”¹æ„è§ï¼ˆ<span class="token number">2</span>ï¼‰ï¼Œ\
        æˆ–è€…é‡æ–°è¿›è¡Œæé—®ï¼ˆ<span class="token number">3</span>ï¼‰ï¼Œ\
        æˆ–è€…ç›´æ¥é€€å‡ºå¯¹è¯ï¼ˆ<span class="token number">4</span>ï¼‰"<span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token comment"># ä»»åŠ¡æ‹†è§£ä¸­ï¼Œå¦‚æœé€‰æ‹©æ‰§è¡Œè¯¥æµç¨‹</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>text_answer_message<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œå³å°†é€æ­¥æ‰§è¡Œä¸Šè¿°æµç¨‹"</span><span class="token punctuation">)</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"éå¸¸å¥½ï¼Œè¯·æŒ‰ç…§è¯¥æµç¨‹é€æ­¥æ‰§è¡Œã€‚"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            is_task_decomposition <span class="token operator">=</span> <span class="token boolean">False</span>
            is_expert_mode <span class="token operator">=</span> <span class="token boolean">False</span>
            messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                         messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                         available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                         is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                         is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                         delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">,</span> 
                                         is_task_decomposition<span class="token operator">=</span>is_task_decomposition<span class="token punctuation">)</span>
            
       
    <span class="token keyword">if</span> user_input <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">elif</span> user_input <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
            new_user_content <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œè¾“å…¥å¯¹æ¨¡å‹ç»“æœçš„ä¿®æ”¹æ„è§ï¼š"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œæ­£åœ¨è¿›è¡Œä¿®æ”¹ã€‚"</span><span class="token punctuation">)</span>
            <span class="token comment"># åœ¨messagesä¸­æš‚æ—¶è®°å½•ä¸Šä¸€è½®å›ç­”çš„å†…å®¹</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>text_answer_message<span class="token punctuation">)</span>
            <span class="token comment"># è®°å½•ç”¨æˆ·æå‡ºçš„ä¿®æ”¹æ„è§</span>
            messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> new_user_content<span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token comment"># å†æ¬¡è°ƒç”¨ä¸»å‡½æ•°è¿›è¡Œå›ç­”ï¼Œä¸ºäº†èŠ‚çœtokenï¼Œå¯ä»¥åˆ é™¤ç”¨æˆ·ä¿®æ”¹æ„è§å’Œç¬¬ä¸€ç‰ˆæ¨¡å‹å›ç­”ç»“æœ</span>
            <span class="token comment"># å› æ­¤è¿™é‡Œå¯ä»¥è®¾ç½®delete_some_messages=2</span>
            <span class="token comment"># æ­¤å¤–ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®is_task_decomposition=is_task_decomposition</span>
            <span class="token comment"># å½“éœ€è¦ä¿®æ”¹å¤æ‚ä»»åŠ¡æ‹†è§£ç»“æœæ—¶ï¼Œä¼šè‡ªåŠ¨å¸¦å…¥is_task_decomposition=True</span>
            messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                         messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                         available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                         is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                         is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                         delete_some_messages<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> 
                                         is_task_decomposition<span class="token operator">=</span>is_task_decomposition<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> user_input <span class="token operator">==</span> <span class="token string">'3'</span><span class="token punctuation">:</span>
            new_user_content <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œè¯·é‡æ–°æå‡ºé—®é¢˜ï¼š"</span><span class="token punctuation">)</span>
            <span class="token comment"># ä¿®æ”¹é—®é¢˜</span>
            messages<span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> new_user_content
            <span class="token comment"># å†æ¬¡è°ƒç”¨ä¸»å‡½æ•°è¿›è¡Œå›ç­”</span>
            messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                         messages<span class="token operator">=</span>messages<span class="token punctuation">,</span> 
                                         available_functions<span class="token operator">=</span>available_functions<span class="token punctuation">,</span>
                                         is_developer_mode<span class="token operator">=</span>is_developer_mode<span class="token punctuation">,</span>
                                         is_expert_mode<span class="token operator">=</span>is_expert_mode<span class="token punctuation">,</span> 
                                         delete_some_messages<span class="token operator">=</span>delete_some_messages<span class="token punctuation">,</span> 
                                         is_task_decomposition<span class="token operator">=</span>is_task_decomposition<span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œå·²é€€å‡ºå½“å‰å¯¹è¯"</span><span class="token punctuation">)</span>
        
    <span class="token comment"># è‹¥ä¸æ˜¯å¼€å‘è€…æ¨¡å¼</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># è®°å½•è¿”å›æ¶ˆæ¯</span>
        messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>text_answer_message<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> messages
</code></pre> 
<pre><code class="prism language-python">data_dictionary
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/c5/XHrcGLGL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="5_1053"></a>5ã€æ™®é€šè°ƒç”¨æµ‹è¯•</h3> 
<pre><code class="prism language-python">mm1 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘ç®€å•ä»‹ç»iqueryæ•°æ®åº“åŸºæœ¬æƒ…å†µã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#è°ƒç”¨</span>
mm_response1 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm1<span class="token punctuation">)</span>
<span class="token comment">#è¾“å‡ºå“åº”æ¶ˆæ¯</span>
mm_response1<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/74/a1/auyUJQV0_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="6_1066"></a>6ã€å¯¹æ¯”å¼€å‘è€…æ¨¡å¼</h3> 
<pre><code class="prism language-python">mm2 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘ç®€å•ä»‹ç»iqueryæ•°æ®åº“åŸºæœ¬æƒ…å†µã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response2 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm2<span class="token punctuation">,</span> 
                                  is_developer_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response2<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/fa/reNch9jA_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="7Function_Calling_1079"></a>7ã€å¸¦æœ‰Function Callingè°ƒç”¨</h3> 
<pre><code class="prism language-python">mm3 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘ç»Ÿè®¡user_demographicsæ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿ"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response3 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm3<span class="token punctuation">,</span> 
                                  available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
mm_response3<span class="token punctuation">.</span>history_messages
</code></pre> 
<p><img src="https://images2.imgbox.com/92/13/xYi2pN9B_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="8_1092"></a>8ã€å¤æ‚é—®é¢˜æ‹†è§£</h3> 
<pre><code class="prism language-python">mm4 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘æŸ¥è¯¢iqueryæ•°æ®åº“ä¸­å››å¼ è¡¨æ•°æ®é‡æ˜¯å¦ä¸€è‡´ã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response4 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo-16k'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm4<span class="token punctuation">,</span> 
                                  available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/08/a0/Sl882tk4_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="9Function_Calling_1104"></a>9ã€æµ‹è¯•å¯¹æ¯”æœ‰ä»£ç è°ƒç”¨çš„Function Calling</h3> 
<pre><code class="prism language-python">mm6 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘å°†user_servicesæ•°æ®è¡¨è¯»å–åˆ°Pythonç¯å¢ƒä¸­ï¼Œå¹¶è¿›è¡Œç¼ºå¤±å€¼æŸ¥æ‰¾ã€‚"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response6 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm6<span class="token punctuation">,</span> 
                                  available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/23/fdKndx43_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="10_1116"></a>10ã€æµ‹è¯•å¼€å‘è€…æ¨¡å¼(ä¸æ¶‰åŠä»£ç æ‰§è¡Œ)</h3> 
<pre><code class="prism language-python">mm8 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"ç»™æˆ‘ä»‹ç»ä¸€ä¸‹iqueryæ•°æ®åº“"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response8 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo-16k'</span><span class="token punctuation">,</span> 
                                  messages<span class="token operator">=</span>mm8<span class="token punctuation">,</span> 
                                  available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span> 
                                  is_developer_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/e4/qwI1O7eA_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="11_1129"></a>11ã€æµ‹è¯•ä¸“å®¶æ¨¡å¼</h3> 
<pre><code class="prism language-python">mm9 <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token string">"è¯·å¸®æˆ‘åˆ°æ•°æ®åº“ä¸­æŸ¥è¯¢user_demographicsè¡¨ï¼Œå¹¶ç”¨å¯è§†åŒ–çš„æ–¹æ³•åˆ†æå…¶ä¸­genderå­—æ®µçš„å–å€¼åˆ†å¸ƒã€‚å¹¶ç»™å‡ºç»“æœ"</span><span class="token punctuation">)</span>
<span class="token comment">#%%</span>
mm_response9 <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo-16k'</span><span class="token punctuation">,</span> 
                                   messages<span class="token operator">=</span>mm9<span class="token punctuation">,</span> 
                                   available_functions<span class="token operator">=</span>af<span class="token punctuation">,</span> 
                                   is_expert_mode<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/85/32/nrFUQMQw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="12Agent_1141"></a>12ã€Agentå¯¹è¯å°è£…è°ƒç”¨</h3> 
<pre><code class="prism language-python"><span class="token comment"># from memory.MessageManager import MessageManager</span>
<span class="token comment"># from planning.Planning import *</span>

<span class="token keyword">class</span> <span class="token class-name">iQueryAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                 api_key<span class="token punctuation">,</span>
                 model<span class="token operator">=</span><span class="token string">'gpt-3.5-turbo-16k'</span><span class="token punctuation">,</span>
                 system_content_list<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                 project<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 messages<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 available_functions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                 is_expert_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                 is_developer_mode<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        åˆå§‹å‚æ•°è§£é‡Šï¼š
        api_keyï¼šå¿…é€‰å‚æ•°ï¼Œè¡¨ç¤ºè°ƒç”¨OpenAIæ¨¡å‹æ‰€å¿…é¡»çš„å­—ç¬¦ä¸²å¯†é’¥ï¼Œæ²¡æœ‰é»˜è®¤å–å€¼ï¼Œéœ€è¦ç”¨æˆ·æå‰è®¾ç½®æ‰å¯ä½¿ç”¨MateGenï¼›
        modelï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰é€‰æ‹©çš„Chatæ¨¡å‹ç±»å‹ï¼Œé»˜è®¤ä¸ºgpt-3.5-turbo-16kï¼Œå…·ä½“å½“å‰OpenAIè´¦æˆ·å¯ä»¥è°ƒç”¨å“ªäº›æ¨¡å‹ï¼Œå¯ä»¥å‚è€ƒå®˜ç½‘Limité“¾æ¥ï¼šhttps://platform.openai.com/account/limits ï¼›
        system_content_listï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¾“å…¥çš„ç³»ç»Ÿæ¶ˆæ¯æˆ–è€…å¤–éƒ¨æ–‡æ¡£ï¼Œé»˜è®¤ä¸ºç©ºåˆ—è¡¨ï¼Œè¡¨ç¤ºä¸è¾“å…¥å¤–éƒ¨æ–‡æ¡£ï¼›
        projectï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯æ‰€å½’å±çš„é¡¹ç›®åç§°ï¼Œéœ€è¦è¾“å…¥CloudFileç±»å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºå½“å‰å¯¹è¯çš„æœ¬åœ°å­˜å‚¨æ–¹æ³•ï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºä¸è¿›è¡Œæœ¬åœ°ä¿å­˜ï¼›
        messagesï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯æ‰€ç»§æ‰¿çš„Messagesï¼Œéœ€è¦æ˜¯MessageManagerå¯¹è±¡ã€æˆ–è€…æ˜¯å­—å…¸æ‰€æ„æˆçš„listï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºä¸ç»§æ‰¿Messagesï¼›
        available_functionsï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯çš„å¤–éƒ¨å·¥å…·ï¼Œéœ€è¦æ˜¯AvailableFunctionå¯¹è±¡ï¼Œé»˜è®¤ä¸ºNoneï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯æ²¡æœ‰å¤–éƒ¨å‡½æ•°ï¼›
        is_expert_modeï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯æ˜¯å¦å¼€å¯ä¸“å®¶æ¨¡å¼ï¼Œä¸“å®¶æ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨å¼€å¯å¤æ‚ä»»åŠ¡æ‹†è§£æµç¨‹ä»¥åŠæ·±åº¦debugåŠŸèƒ½ï¼Œä¼šéœ€è¦è€—è´¹æ›´å¤šçš„è®¡ç®—æ—¶é—´å’Œé‡‘é¢ï¼Œä¸è¿‡ä¼šæ¢æ¥Agentæ•´ä½“æ€§èƒ½æå‡ï¼Œé»˜è®¤ä¸ºFalseï¼›
        is_developer_modeï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å‰å¯¹è¯æ˜¯å¦å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼Œåœ¨å¼€å‘è€…æ¨¡å¼ä¸‹ï¼Œæ¨¡å‹ä¼šå…ˆå’Œç”¨æˆ·ç¡®è®¤æ–‡æœ¬æˆ–è€…ä»£ç æ˜¯å¦æ­£ç¡®ï¼Œå†é€‰æ‹©æ˜¯å¦è¿›è¡Œä¿å­˜æˆ–è€…æ‰§è¡Œï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´å€ŸåŠ©å¼€å‘è€…æ¨¡å¼å¯ä»¥æå¤§ç¨‹åº¦æå‡æ¨¡å‹å¯ç”¨æ€§ï¼Œä½†å¹¶ä¸æ¨èæ–°äººä½¿ç”¨ï¼Œé»˜è®¤ä¸ºFalseï¼›
        """</span>

        self<span class="token punctuation">.</span>api_key <span class="token operator">=</span> api_key
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model
        self<span class="token punctuation">.</span>project <span class="token operator">=</span> project
        self<span class="token punctuation">.</span>system_content_list <span class="token operator">=</span> system_content_list
        tokens_thr <span class="token operator">=</span> <span class="token boolean">None</span>

        <span class="token comment"># è®¡ç®—tokens_thr</span>
        <span class="token keyword">if</span> <span class="token string">'1106'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
            tokens_thr <span class="token operator">=</span> <span class="token number">110000</span>
        <span class="token keyword">elif</span> <span class="token string">'16k'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
            tokens_thr <span class="token operator">=</span> <span class="token number">12000</span>
        <span class="token keyword">elif</span> <span class="token string">'gpt-4-0613'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
            tokens_thr <span class="token operator">=</span> <span class="token number">7000</span>
        <span class="token keyword">elif</span> <span class="token string">'gpt-4-turbo-preview'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
            tokens_thr <span class="token operator">=</span> <span class="token number">110000</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tokens_thr <span class="token operator">=</span> <span class="token number">3000</span>

        self<span class="token punctuation">.</span>tokens_thr <span class="token operator">=</span> tokens_thr

        <span class="token comment"># åˆ›å»ºself.messageså±æ€§</span>
        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span>system_content_list<span class="token punctuation">,</span>
                                     tokens_thr<span class="token operator">=</span>tokens_thr<span class="token punctuation">)</span>

        <span class="token comment"># è‹¥åˆå§‹å‚æ•°messagesä¸ä¸ºNoneï¼Œåˆ™å°†å…¶åŠ å…¥self.messagesä¸­</span>
        <span class="token keyword">if</span> messages <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span>messages<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>available_functions <span class="token operator">=</span> available_functions
        self<span class="token punctuation">.</span>is_expert_mode <span class="token operator">=</span> is_expert_mode
        self<span class="token punctuation">.</span>is_developer_mode <span class="token operator">=</span> is_developer_mode
        
        title<span class="token operator">=</span><span class="token string">"ã€===================æ¬¢è¿ä½¿ç”¨iQuery Agent æ™ºèƒ½æ•°æ®åˆ†æå¹³å°================================ã€‘"</span>
        display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">chat</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> question<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        iQueryAgentç±»ä¸»æ–¹æ³•ï¼Œæ”¯æŒå•æ¬¡å¯¹è¯å’Œå¤šè½®å¯¹è¯ä¸¤ç§æ¨¡å¼ï¼Œå½“ç”¨æˆ·æ²¡æœ‰è¾“å…¥questionæ—¶å¼€å¯å¤šè½®å¯¹è¯ï¼Œåä¹‹åˆ™å¼€å¯å•è½®å¯¹è¯ã€‚\
        æ— è®ºå¼€å¯å•è®ºå¯¹è¯æˆ–å¤šè½®å¯¹è¯ï¼Œå¯¹è¯ç»“æœå°†ä¼šä¿å­˜åœ¨self.messagesä¸­ï¼Œä¾¿äºä¸‹æ¬¡è°ƒç”¨
        """</span>
       
        head_str <span class="token operator">=</span> <span class="token string">"â–Œ Model set to %s"</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>model
        display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>head_str<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> question <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
                                              messages<span class="token operator">=</span>self<span class="token punctuation">.</span>messages<span class="token punctuation">,</span>
                                              available_functions<span class="token operator">=</span>self<span class="token punctuation">.</span>available_functions<span class="token punctuation">,</span>
                                              is_developer_mode<span class="token operator">=</span>self<span class="token punctuation">.</span>is_developer_mode<span class="token punctuation">,</span>
                                              is_expert_mode<span class="token operator">=</span>self<span class="token punctuation">.</span>is_expert_mode<span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>messages <span class="token operator">=</span> one_chat_response<span class="token punctuation">(</span>model<span class="token operator">=</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
                                                  messages<span class="token operator">=</span>self<span class="token punctuation">.</span>messages<span class="token punctuation">,</span>
                                                  available_functions<span class="token operator">=</span>self<span class="token punctuation">.</span>available_functions<span class="token punctuation">,</span>
                                                  is_developer_mode<span class="token operator">=</span>self<span class="token punctuation">.</span>is_developer_mode<span class="token punctuation">,</span>
                                                  is_expert_mode<span class="token operator">=</span>self<span class="token punctuation">.</span>is_expert_mode<span class="token punctuation">)</span>

                user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯): "</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">"é€€å‡º"</span><span class="token punctuation">:</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>messages_append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_input<span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        é‡ç½®å½“å‰iQuery Agentå¯¹è±¡çš„messages
        """</span>
        self<span class="token punctuation">.</span>messages <span class="token operator">=</span> MessageManager<span class="token punctuation">(</span>system_content_list<span class="token operator">=</span>self<span class="token punctuation">.</span>system_content_list<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">upload_messages</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        å°†å½“å‰messagesä¸Šä¼ è‡³projecté¡¹ç›®ä¸­
        """</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>project <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"éœ€è¦å…ˆè¾“å…¥projectå‚æ•°ï¼ˆéœ€è¦æ˜¯ä¸€ä¸ªCloudFileå¯¹è±¡ï¼‰ï¼Œæ‰å¯ä¸Šä¼ messages"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>project<span class="token punctuation">.</span>append_doc_content<span class="token punctuation">(</span>content<span class="token operator">=</span>self<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>history_messages<span class="token punctuation">)</span>
<span class="token comment">#iquery = iQueryAgent(api_key="",model="gpt-3.5-turbo-16k")</span>
<span class="token comment">#iquery.chat('è¯·å¸®æˆ‘ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ')</span>
<span class="token comment">#iquery.chat("è¯·é—®ä½ ä¸Šæ¬¡å›ç­”çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ")</span>
</code></pre> 
<p>å¯¹è¯æµ‹è¯•</p> 
<pre><code class="prism language-python">iquery <span class="token operator">=</span> iQueryAgent<span class="token punctuation">(</span>api_key<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-16k"</span><span class="token punctuation">,</span> 
                       available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
iquery<span class="token punctuation">.</span>chat<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/a0/Y1gwdtHK_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å¯¹è¯æµ‹è¯•</p> 
<pre><code class="prism language-python">iquery <span class="token operator">=</span> iQueryAgent<span class="token punctuation">(</span>api_key<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-16k"</span><span class="token punctuation">,</span> 
                     system_content_list<span class="token operator">=</span><span class="token punctuation">[</span>data_dictionary<span class="token punctuation">]</span><span class="token punctuation">,</span>
                       available_functions<span class="token operator">=</span>af<span class="token punctuation">)</span>
iquery<span class="token punctuation">.</span>chat<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/34/37/qDMyzh3A_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_1275"></a>ä¸ƒã€ç»“è¯­</h2> 
<p>æˆªè‡³ç›®å‰ï¼ŒAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„å¼€å‘å·¥ä½œå·²æ¥è¿‘å°¾å£°ã€‚ä»æœ€åˆçš„å¼€æºè°ƒç ”ï¼Œåˆ°æ¶æ„è®¾è®¡åˆ†æï¼Œå†åˆ°ä»£ç çš„å…·ä½“è½åœ°å®æ–½ï¼Œæ•´ä¸ªå¼€å‘è¿‡ç¨‹å·²ç»åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡æ˜¯å°†å·²æœ‰çš„æˆæœæ•´åˆåˆ°å¹³å°çš„å„ä¸ªåŠŸèƒ½æ¨¡å—ä¸­ï¼Œç¡®ä¿å¹³å°çš„å®Œæ•´æ€§å’Œç¨³å®šæ€§ã€‚</p> 
<p><img src="https://images2.imgbox.com/d7/b1/daSgUmRS_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ¯ğŸ”–æ›´å¤šä¸“æ ç³»åˆ—æ–‡ç« ï¼š<a href="https://blog.csdn.net/xiaobing259/category_12628007.html?spm=1001.2014.3001.5482"><strong>AIGC-AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯</strong></a></p> 
<blockquote> 
 <p>ğŸ˜ <strong>ä½œè€…ä»‹ç»</strong>ï¼šæˆ‘æ˜¯å¯»é“AIå°å…µï¼Œèµ„æ·±ç¨‹åºè€çŒ¿ï¼Œä»ä¸š10å¹´+ã€äº’è”ç½‘ç³»ç»Ÿæ¶æ„å¸ˆï¼Œç›®å‰ä¸“æ³¨äºAIGCçš„æ¢ç´¢ã€‚<br> ğŸ“– <strong>æŠ€æœ¯äº¤æµ</strong>ï¼šå»ºç«‹æœ‰æŠ€æœ¯äº¤æµç¾¤ï¼Œå¯ä»¥æ‰«ç ğŸ‘‡ åŠ å…¥ç¤¾ç¾¤ï¼Œ500æœ¬å„ç±»ç¼–ç¨‹ä¹¦ç±ã€AIæ•™ç¨‹ã€AIå·¥å…·ç­‰ä½ é¢†å–ï¼<br> <strong>å¦‚æœæ–‡ç« å†…å®¹å¯¹æ‚¨æœ‰æ‰€è§¦åŠ¨ï¼Œåˆ«å¿˜äº†<font color="red"><strong>ç‚¹èµã€â­å…³æ³¨ï¼Œæ”¶è—</strong></font>ï¼åŠ å…¥æˆ‘ï¼Œè®©æˆ‘ä»¬æºæ‰‹åŒè¡ŒAIçš„æ¢ç´¢ä¹‹æ—…ï¼Œä¸€èµ·å¼€å¯æ™ºèƒ½æ—¶ä»£çš„å¤§é—¨ï¼</strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f37861452f19d8910acd3e1f7c57777/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å‡½æ•°é€’å½’ï¼ˆCè¯­è¨€ï¼‰ï¼ˆè¯¦ç»†è¿‡ç¨‹ï¼ï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d4c6b4cda047a5dd220f1a0216e035c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€C&#43;&#43;è¿›é˜¶ã€‘æ·±å…¥STLä¹‹ æ ˆä¸é˜Ÿåˆ—ï¼šæ•°æ®ç»“æ„æ¢ç´¢ä¹‹æ—…</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>