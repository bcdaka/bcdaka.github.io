<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis 源码解析：动态 SQL 生成的基本原理 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/088de920181c2790ced8f53e0b96ae08/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MyBatis 源码解析：动态 SQL 生成的基本原理">
  <meta property="og:description" content="摘要 MyBatis 提供了灵活的动态 SQL 功能，使得开发者可以根据业务需求在运行时生成不同的 SQL 语句。动态 SQL 是 MyBatis 最具特色的功能之一，它允许我们通过条件拼接来生成复杂的查询语句。本文将通过自定义实现一个简化的动态 SQL 生成器，解析其工作原理，并结合 MyBatis 的源码进行深入讲解。
前言 传统的 SQL 查询往往需要开发者根据不同的业务逻辑手动拼接 SQL 语句，而这种方式不仅容易出错，也不够灵活。MyBatis 通过动态 SQL 标签（如 &lt;if&gt;、&lt;choose&gt;、&lt;foreach&gt; 等）提供了更灵活的查询方式，允许我们在运行时根据不同条件生成 SQL 语句。本文将通过自定义实现一个简化的动态 SQL 生成器，深入解析其工作原理，并结合 MyBatis 的源码进行详细分析。
自定义实现：动态 SQL 生成器 目标与功能 我们将实现一个简化版的动态 SQL 生成器，支持以下核心功能：
条件判断：根据输入条件动态拼接 SQL 语句。组合条件：支持 AND 和 OR 等逻辑条件的组合。参数绑定：支持 SQL 语句中的参数占位符并绑定实际参数。动态拼接：通过链式调用轻松构建复杂 SQL 语句。 实现过程 为了实现一个灵活的动态 SQL 生成器，我们将从以下几个步骤开始：
SQL 语句构建：使用 StringBuilder 构建 SQL 语句片段，并根据不同条件判断是否拼接。参数绑定：通过占位符 ? 来处理 SQL 语句中的参数，并动态绑定参数。条件判断和组合：实现 if 和 where 条件的判断，确保生成的 SQL 语句语法正确。返回生成的 SQL 语句和参数：提供方法返回生成的 SQL 语句和绑定参数列表，供数据库执行使用。 1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-08T22:46:30+08:00">
    <meta property="article:modified_time" content="2024-09-08T22:46:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis 源码解析：动态 SQL 生成的基本原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a><strong>摘要</strong></h3> 
<p>MyBatis 提供了灵活的动态 SQL 功能，使得开发者可以根据业务需求在运行时生成不同的 SQL 语句。动态 SQL 是 MyBatis 最具特色的功能之一，它允许我们通过条件拼接来生成复杂的查询语句。本文将通过自定义实现一个简化的动态 SQL 生成器，解析其工作原理，并结合 MyBatis 的源码进行深入讲解。</p> 
<hr> 
<h3><a id="_6"></a><strong>前言</strong></h3> 
<p>传统的 SQL 查询往往需要开发者根据不同的业务逻辑手动拼接 SQL 语句，而这种方式不仅容易出错，也不够灵活。MyBatis 通过动态 SQL 标签（如 <code>&lt;if&gt;</code>、<code>&lt;choose&gt;</code>、<code>&lt;foreach&gt;</code> 等）提供了更灵活的查询方式，允许我们在运行时根据不同条件生成 SQL 语句。本文将通过自定义实现一个简化的动态 SQL 生成器，深入解析其工作原理，并结合 MyBatis 的源码进行详细分析。</p> 
<hr> 
<h3><a id="_SQL__12"></a><strong>自定义实现：动态 SQL 生成器</strong></h3> 
<h4><a id="_14"></a><strong>目标与功能</strong></h4> 
<p>我们将实现一个简化版的动态 SQL 生成器，支持以下核心功能：</p> 
<ol><li><strong>条件判断</strong>：根据输入条件动态拼接 SQL 语句。</li><li><strong>组合条件</strong>：支持 <code>AND</code> 和 <code>OR</code> 等逻辑条件的组合。</li><li><strong>参数绑定</strong>：支持 SQL 语句中的参数占位符并绑定实际参数。</li><li><strong>动态拼接</strong>：通过链式调用轻松构建复杂 SQL 语句。</li></ol> 
<h4><a id="_23"></a><strong>实现过程</strong></h4> 
<p>为了实现一个灵活的动态 SQL 生成器，我们将从以下几个步骤开始：</p> 
<ol><li><strong>SQL 语句构建</strong>：使用 <code>StringBuilder</code> 构建 SQL 语句片段，并根据不同条件判断是否拼接。</li><li><strong>参数绑定</strong>：通过占位符 <code>?</code> 来处理 SQL 语句中的参数，并动态绑定参数。</li><li><strong>条件判断和组合</strong>：实现 <code>if</code> 和 <code>where</code> 条件的判断，确保生成的 SQL 语句语法正确。</li><li><strong>返回生成的 SQL 语句和参数</strong>：提供方法返回生成的 SQL 语句和绑定参数列表，供数据库执行使用。</li></ol> 
<h5><a id="1__DynamicSqlGenerator__32"></a><strong>1. 定义 DynamicSqlGenerator 类</strong></h5> 
<p>首先，我们定义一个 <code>DynamicSqlGenerator</code> 类来生成动态 SQL 语句。这个类将负责根据输入条件动态拼接 SQL 片段，并生成最终的 SQL 语句。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * DynamicSqlGenerator 负责生成动态 SQL 查询语句。
 * 它通过根据传入的条件拼接 SQL 片段，并支持绑定参数。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringBuilder</span> sql <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 用于构建 SQL 语句</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> parameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 存储 SQL 语句绑定的参数</span>

    <span class="token comment">/**
     * 指定要查询的列。
     * @param columns 查询的列名
     * @return 当前对象，支持链式调用
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token class-name">String</span> columns<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"SELECT "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>columns<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" FROM "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 指定要查询的表。
     * @param tableName 查询的表名
     * @return 当前对象，支持链式调用
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token class-name">String</span> tableName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加 WHERE 条件的起点。
     * @return 当前对象，支持链式调用
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" WHERE 1=1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 保证 WHERE 后有 1=1 以确保拼接正确</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加 AND 条件。
     * @param condition 条件表达式
     * @param value 参数值
     * @return 当前对象，支持链式调用
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">String</span> condition<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 只有当参数不为空时才拼接条件</span>
            sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" AND "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            parameters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将参数添加到参数列表</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 添加 OR 条件。
     * @param condition 条件表达式
     * @param value 参数值
     * @return 当前对象，支持链式调用
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DynamicSqlGenerator</span> <span class="token function">or</span><span class="token punctuation">(</span><span class="token class-name">String</span> condition<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 只有当参数不为空时才拼接条件</span>
            sql<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" OR "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            parameters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将参数添加到参数列表</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取最终生成的 SQL 语句。
     * @return 生成的 SQL 语句
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sql<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 返回拼接完成的 SQL 语句</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取 SQL 语句绑定的参数列表。
     * @return 参数列表
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> parameters<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong>核心功能</strong>： 
  <ul><li><code>select</code>：用于选择查询的列。</li><li><code>from</code>：指定要查询的表。</li><li><code>where</code>：用于引入 <code>WHERE</code> 条件，默认 <code>1=1</code> 使得后续条件拼接更加灵活。</li><li><code>and</code> / <code>or</code>：动态拼接 <code>AND</code> 或 <code>OR</code> 条件，同时将实际参数值绑定到参数列表中。</li><li><code>getSql</code>：返回最终生成的 SQL 语句。</li><li><code>getParameters</code>：返回绑定的参数列表。</li></ul> </li></ul> 
<h5><a id="2__DynamicSqlGenerator_131"></a><strong>2. 测试 DynamicSqlGenerator</strong></h5> 
<p>通过下面的代码来测试 <code>DynamicSqlGenerator</code> 的功能，验证 SQL 语句的生成与参数绑定是否正确。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicSqlTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建 SQL 生成器</span>
        <span class="token class-name">DynamicSqlGenerator</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicSqlGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 构建 SQL 查询，支持根据条件动态生成</span>
        generator<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"users"</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">"name = ?"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">)</span>  <span class="token comment">// 只有当 name 非空时才拼接条件</span>
                 <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token string">"age &gt; ?"</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>        <span class="token comment">// 只有当 age 大于 25 时才拼接条件</span>
                 <span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span><span class="token string">"status = ?"</span><span class="token punctuation">,</span> <span class="token string">"active"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印生成的 SQL 语句</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Generated SQL: "</span> <span class="token operator">+</span> generator<span class="token punctuation">.</span><span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印参数</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Parameters: "</span> <span class="token operator">+</span> generator<span class="token punctuation">.</span><span class="token function">getParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>输出结果</strong>：</p> 
<pre><code>Generated SQL: SELECT * FROM users WHERE 1=1 AND name = ? AND age &gt; ? OR status = ?
Parameters: [Alice, 25, active]
</code></pre> 
<ul><li><strong>SQL 语句生成</strong>：程序根据输入条件生成了动态 SQL 语句。</li><li><strong>参数绑定</strong>：程序生成了 SQL 语句的同时，也返回了绑定的实际参数列表，供执行时使用。</li></ul> 
<h5><a id="3__167"></a><strong>3. 扩展功能</strong></h5> 
<p>为了增强 SQL 生成器的实用性，我们可以进一步扩展功能：</p> 
<ol><li><strong><code>&lt;choose&gt;</code> 实现</strong>：根据多个条件选择其中一个拼接 SQL。</li><li><strong><code>&lt;foreach&gt;</code> 实现</strong>：支持批量拼接，比如处理 <code>IN</code> 条件。</li></ol> 
<p>这些扩展功能可以帮助我们进一步实现更复杂的动态 SQL 需求。</p> 
<h4><a id="_175"></a><strong>自定义实现类图</strong></h4> 
<div class="mermaid"> 
 <svg id="mermaid-svg-Krg4Hdq7PETykBv4" width="293.0833435058594" xmlns="http://www.w3.org/2000/svg" height="351.0694885253906" viewbox="0 0 293.0833435058594 351.0694885253906" class="mermaid-svg"> 
  <style>#mermaid-svg-Krg4Hdq7PETykBv4 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-Krg4Hdq7PETykBv4 .error-icon{fill:#552222;}#mermaid-svg-Krg4Hdq7PETykBv4 .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-Krg4Hdq7PETykBv4 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-Krg4Hdq7PETykBv4 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-Krg4Hdq7PETykBv4 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-Krg4Hdq7PETykBv4 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-Krg4Hdq7PETykBv4 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-Krg4Hdq7PETykBv4 .marker{fill:#333333;stroke:#333333;}#mermaid-svg-Krg4Hdq7PETykBv4 .marker.cross{stroke:#333333;}#mermaid-svg-Krg4Hdq7PETykBv4 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-Krg4Hdq7PETykBv4 g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-svg-Krg4Hdq7PETykBv4 g.classGroup text .title{font-weight:bolder;}#mermaid-svg-Krg4Hdq7PETykBv4 .nodeLabel,#mermaid-svg-Krg4Hdq7PETykBv4 .edgeLabel{color:#131300;}#mermaid-svg-Krg4Hdq7PETykBv4 .edgeLabel .label rect{fill:#ECECFF;}#mermaid-svg-Krg4Hdq7PETykBv4 .label text{fill:#131300;}#mermaid-svg-Krg4Hdq7PETykBv4 .edgeLabel .label span{background:#ECECFF;}#mermaid-svg-Krg4Hdq7PETykBv4 .classTitle{font-weight:bolder;}#mermaid-svg-Krg4Hdq7PETykBv4 .node rect,#mermaid-svg-Krg4Hdq7PETykBv4 .node circle,#mermaid-svg-Krg4Hdq7PETykBv4 .node ellipse,#mermaid-svg-Krg4Hdq7PETykBv4 .node polygon,#mermaid-svg-Krg4Hdq7PETykBv4 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-Krg4Hdq7PETykBv4 .divider{stroke:#9370DB;stroke:1;}#mermaid-svg-Krg4Hdq7PETykBv4 g.clickable{cursor:pointer;}#mermaid-svg-Krg4Hdq7PETykBv4 g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-svg-Krg4Hdq7PETykBv4 g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-svg-Krg4Hdq7PETykBv4 .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-svg-Krg4Hdq7PETykBv4 .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-svg-Krg4Hdq7PETykBv4 .dashed-line{stroke-dasharray:3;}#mermaid-svg-Krg4Hdq7PETykBv4 #compositionStart,#mermaid-svg-Krg4Hdq7PETykBv4 .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #compositionEnd,#mermaid-svg-Krg4Hdq7PETykBv4 .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #dependencyStart,#mermaid-svg-Krg4Hdq7PETykBv4 .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #dependencyStart,#mermaid-svg-Krg4Hdq7PETykBv4 .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #extensionStart,#mermaid-svg-Krg4Hdq7PETykBv4 .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #extensionEnd,#mermaid-svg-Krg4Hdq7PETykBv4 .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #aggregationStart,#mermaid-svg-Krg4Hdq7PETykBv4 .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 #aggregationEnd,#mermaid-svg-Krg4Hdq7PETykBv4 .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-svg-Krg4Hdq7PETykBv4 .edgeTerminals{font-size:11px;}#mermaid-svg-Krg4Hdq7PETykBv4 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <defs> 
    <marker id="classDiagram-aggregationStart" class="marker aggregation classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-aggregationEnd" class="marker aggregation classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-extensionStart" class="marker extension classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 1,7 L18,13 V 1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-extensionEnd" class="marker extension classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 1,1 V 13 L18,7 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-compositionStart" class="marker composition classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-compositionEnd" class="marker composition classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-dependencyStart" class="marker dependency classDiagram" refx="0" refy="7" markerwidth="190" markerheight="240" orient="auto"> 
     <path d="M 5,7 L9,13 L1,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <defs> 
    <marker id="classDiagram-dependencyEnd" class="marker dependency classDiagram" refx="19" refy="7" markerwidth="20" markerheight="28" orient="auto"> 
     <path d="M 18,7 L9,13 L14,7 L9,1 Z"></path> 
    </marker> 
   </defs> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"></g> 
    <g class="edgeLabels"></g> 
    <g class="nodes"> 
     <g class="node default" id="classid-DynamicSqlGenerator-5" transform="translate(146.5416717529297, 175.5347442626953)"> 
      <rect class="outer title-state" x="-138.5416717529297" y="-167.53474235534668" width="277.0833435058594" height="335.06948471069336"></rect> 
      <line class="divider" x1="-138.5416717529297" x2="138.5416717529297" y1="-129.52779388427734" y2="-129.52779388427734"></line> 
      <line class="divider" x1="-138.5416717529297" x2="138.5416717529297" y1="-53.51389694213867" y2="-53.51389694213867"></line> 
      <g class="label"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel"></span> 
        </div> 
       </foreignobject> 
       <foreignobject class="classTitle" width="161.42361450195312" height="26.006948471069336" transform="translate( -80.71180725097656, -160.03474235534668)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">DynamicSqlGenerator</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="128.15972900390625" height="26.006948471069336" transform="translate( -131.0416717529297, -118.02779388427734)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">- StringBuilder sql</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="122.72570037841797" height="26.006948471069336" transform="translate( -131.0416717529297, -88.02084541320801)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">- List parameters</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="167.95140075683594" height="26.006948471069336" transform="translate( -131.0416717529297, -46.01389694213867)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+select(String columns)</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="178.29861450195312" height="26.006948471069336" transform="translate( -131.0416717529297, -16.006948471069336)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+from(String tableName)</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="64.46180725097656" height="26.006948471069336" transform="translate( -131.0416717529297, 14)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+where()</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="262.0833435058594" height="26.006948471069336" transform="translate( -131.0416717529297, 44.006948471069336)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+and(String condition, Object value)</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="250.83334350585938" height="26.006948471069336" transform="translate( -131.0416717529297, 74.01389694213867)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+or(String condition, Object value)</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="64.58333587646484" height="26.006948471069336" transform="translate( -131.0416717529297, 104.02084541320801)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+getSql()</span> 
        </div> 
       </foreignobject> 
       <foreignobject width="124.21875762939453" height="26.006948471069336" transform="translate( -131.0416717529297, 134.02779388427734)"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">+getParameters()</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h4><a id="_192"></a><strong>代码解析流程图</strong></h4> 
<div class="mermaid"> 
 <svg id="mermaid-svg-JfF9cZQsepBWqWVV" width="292.10247802734375" xmlns="http://www.w3.org/2000/svg" height="811.0695190429688" viewbox="0 0 292.10247802734375 811.0695190429688" class="mermaid-svg"> 
  <style>#mermaid-svg-JfF9cZQsepBWqWVV {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .error-icon{fill:#552222;}#mermaid-svg-JfF9cZQsepBWqWVV .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-JfF9cZQsepBWqWVV .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-JfF9cZQsepBWqWVV .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-JfF9cZQsepBWqWVV .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-JfF9cZQsepBWqWVV .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-JfF9cZQsepBWqWVV .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-JfF9cZQsepBWqWVV .marker{fill:#333333;stroke:#333333;}#mermaid-svg-JfF9cZQsepBWqWVV .marker.cross{stroke:#333333;}#mermaid-svg-JfF9cZQsepBWqWVV svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-JfF9cZQsepBWqWVV .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .cluster-label text{fill:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .cluster-label span{color:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .label text,#mermaid-svg-JfF9cZQsepBWqWVV span{fill:#333;color:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .node rect,#mermaid-svg-JfF9cZQsepBWqWVV .node circle,#mermaid-svg-JfF9cZQsepBWqWVV .node ellipse,#mermaid-svg-JfF9cZQsepBWqWVV .node polygon,#mermaid-svg-JfF9cZQsepBWqWVV .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-JfF9cZQsepBWqWVV .node .label{text-align:center;}#mermaid-svg-JfF9cZQsepBWqWVV .node.clickable{cursor:pointer;}#mermaid-svg-JfF9cZQsepBWqWVV .arrowheadPath{fill:#333333;}#mermaid-svg-JfF9cZQsepBWqWVV .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-JfF9cZQsepBWqWVV .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-JfF9cZQsepBWqWVV .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-JfF9cZQsepBWqWVV .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-JfF9cZQsepBWqWVV .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-JfF9cZQsepBWqWVV .cluster text{fill:#333;}#mermaid-svg-JfF9cZQsepBWqWVV .cluster span{color:#333;}#mermaid-svg-JfF9cZQsepBWqWVV div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-JfF9cZQsepBWqWVV :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, -0.0000019073486328125)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2; stroke-dasharray: 1, 0;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M162.7005271911621,49.00695037841797L162.7005271911621,53.17361704508463C162.7005271911621,57.340283711751304,162.7005271911621,65.67361704508464,162.7005271911621,74.00695037841797C162.7005271911621,82.3402837117513,162.7005271911621,90.67361704508464,162.7005271911621,94.8402837117513L162.7005271911621,99.00695037841797" id="L-A-B-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M162.7005271911621,140.01390075683594L162.7005271911621,144.1805674235026C162.7005271911621,148.34723409016928,162.7005271911621,156.6805674235026,162.7005271911621,165.01390075683594C162.7005271911621,173.34723409016928,162.7005271911621,181.6805674235026,162.7005271911621,185.84723409016928L162.7005271911621,190.01390075683594" id="L-B-C-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M162.7005271911621,231.0208511352539L162.7005271911621,235.18751780192056C162.7005271911621,239.35418446858725,162.7005271911621,247.68751780192056,162.7005271911621,256.0208511352539C162.7005271911621,264.3541844685872,162.7005271911621,272.6875178019206,162.7005271911621,276.8541844685872L162.7005271911621,281.0208511352539" id="L-C-D-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-C LE-D" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M162.7005271911621,322.0278015136719L162.7005271911621,326.19446818033856C162.7005271911621,330.3611348470052,162.7005271911621,338.69446818033856,162.7005271911621,347.0278015136719C162.7005271911621,355.3611348470052,162.7005271911621,363.69446818033856,162.7005271911621,367.8611348470052L162.7005271911621,372.0278015136719" id="L-D-E-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M134.17362374485984,413.03475189208984L125.36112220437538,419.36866426467896C116.54862066389093,425.70257663726807,98.92361758292202,438.3704013824463,90.11111604243757,451.0382261276245C81.29861450195312,463.70605087280273,81.29861450195312,476.37387561798096,81.29861450195312,482.70778799057007L81.29861450195312,489.0417003631592" id="L-E-F-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M191.22743063746438,413.03475189208984L200.03993217794883,419.36866426467896C208.8524337184333,425.70257663726807,226.4774367994022,438.3704013824463,235.28993833988662,451.0382261276245C244.1024398803711,463.70605087280273,244.1024398803711,476.37387561798096,244.1024398803711,482.70778799057007L244.1024398803711,489.0417003631592" id="L-E-G-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-G" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M81.29861450195312,530.0486507415771L81.29861450195312,534.2153174082438C81.29861450195312,538.3819840749105,81.29861450195312,546.7153174082438,88.75243280472468,555.0486507415771C96.20625110749624,563.3819840749105,111.11388771303935,571.7153174082438,118.56770601581091,575.8819840749105L126.02152431858248,580.0486507415771" id="L-F-H-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-H" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M244.1024398803711,530.0486507415771L244.1024398803711,534.2153174082438C244.1024398803711,538.3819840749105,244.1024398803711,546.7153174082438,236.64862157759953,555.0486507415771C229.194803274828,563.3819840749105,214.28716666928486,571.7153174082438,206.8333483665133,575.8819840749105L199.37953006374175,580.0486507415771" id="L-G-H-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M162.7005271911621,621.0556011199951L162.7005271911621,625.2222677866617C162.7005271911621,629.3889344533285,162.7005271911621,637.7222677866617,162.7005271911621,646.0556011199951C162.7005271911621,654.3889344533285,162.7005271911621,662.7222677866617,162.7005271911621,666.8889344533285L162.7005271911621,671.0556011199951" id="L-H-I-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-I" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M162.7005271911621,712.0625514984131L162.7005271911621,716.2292181650797C162.7005271911621,720.3958848317465,162.7005271911621,728.7292181650797,162.7005271911621,737.0625514984131C162.7005271911621,745.3958848317465,162.7005271911621,753.7292181650797,162.7005271911621,757.8958848317465L162.7005271911621,762.0625514984131" id="L-I-J-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-J" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(81.29861450195312, 451.0382261276245)"> 
      <g class="label" transform="translate(-32.005210876464844, -13.003474235534668)"> 
       <foreignobject width="64.01042175292969" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">满足条件</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(244.1024398803711, 451.0382261276245)"> 
      <g class="label" transform="translate(-40, -13.003474235534668)"> 
       <foreignobject width="80" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">不满足条件</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-A-226" transform="translate(162.7005271911621, 28.503475189208984)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.50694465637207" y="-20.503474235534668" width="47.01388931274414" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-16.00694465637207, -13.003474235534668)"> 
       <foreignobject width="32.01388931274414" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">开始</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-B-227" transform="translate(162.7005271911621, 119.51042556762695)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-84.96527862548828" y="-20.503474235534668" width="169.93055725097656" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-77.46527862548828, -13.003474235534668)"> 
       <foreignobject width="154.93055725097656" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">调用select指定查询列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-C-229" transform="translate(162.7005271911621, 210.51737594604492)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-72.5" y="-20.503474235534668" width="145" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-65, -13.003474235534668)"> 
       <foreignobject width="130" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">调用from指定表名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-D-231" transform="translate(162.7005271911621, 301.5243263244629)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-77.66493225097656" y="-20.503474235534668" width="155.32986450195312" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-70.16493225097656, -13.003474235534668)"> 
       <foreignobject width="140.32986450195312" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">调用where添加条件</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-E-233" transform="translate(162.7005271911621, 392.53127670288086)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.505210876464844" y="-20.503474235534668" width="79.01042175292969" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-32.005210876464844, -13.003474235534668)"> 
       <foreignobject width="64.01042175292969" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">条件判断</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-F-235" transform="translate(81.29861450195312, 509.54517555236816)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-73.29861450195312" y="-20.503474235534668" width="146.59722900390625" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-65.79861450195312, -13.003474235534668)"> 
       <foreignobject width="131.59722900390625" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">拼接 AND/OR 语句</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-G-237" transform="translate(244.1024398803711, 509.54517555236816)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.505210876464844" y="-20.503474235534668" width="79.01042175292969" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-32.005210876464844, -13.003474235534668)"> 
       <foreignobject width="64.01042175292969" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">跳过拼接</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-H-239" transform="translate(162.7005271911621, 600.5521259307861)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.505210876464844" y="-20.503474235534668" width="79.01042175292969" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-32.005210876464844, -13.003474235534668)"> 
       <foreignobject width="64.01042175292969" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">拼接完成</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-I-243" transform="translate(162.7005271911621, 691.5590763092041)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-97.33507537841797" y="-20.503474235534668" width="194.67015075683594" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-89.83507537841797, -13.003474235534668)"> 
       <foreignobject width="179.67015075683594" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">返回最终 SQL 语句和参数</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-J-245" transform="translate(162.7005271911621, 782.5660266876221)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.50694465637207" y="-20.503474235534668" width="47.01388931274414" height="41.006948471069336"></rect> 
      <g class="label" style="" transform="translate(-16.00694465637207, -13.003474235534668)"> 
       <foreignobject width="32.01388931274414" height="26.006948471069336"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">结束</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<hr> 
<h3><a id="MyBatis__SQL__210"></a><strong>源码解析：MyBatis 中的动态 SQL 生成原理</strong></h3> 
<p>MyBatis 提供了一些节点类（如 <code>IfSqlNode</code>、<code>ChooseSqlNode</code>）来解析这些标签。每个 <code>SqlNode</code> 实现都通过反射或者表达式计算，决定是否拼接 SQL 语句。下面我们详细分析 MyBatis 中的动态 SQL 生成流程。</p> 
<h4><a id="1_SqlNode__214"></a><strong>1. SqlNode 的作用</strong></h4> 
<p><code>SqlNode</code> 是 MyBatis 中用于动态生成 SQL 片段的基础接口，它为不同的 SQL 节点提供了统一的处理方式。<code>SqlNode</code> 定义了 <code>apply</code> 方法，该方法用于将当前 SQL 节点的内容应用到动态 SQL 上下文中。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SqlNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">DynamicContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong><code>apply</code> 方法</strong>：在每个 <code>SqlNode</code> 中，该方法负责将 SQL 节点应用到动态上下文中，并返回是否成功应用。</li></ul> 
<h4><a id="2_IfSqlNode__226"></a><strong>2. IfSqlNode 的实现</strong></h4> 
<p><code>IfSqlNode</code> 是 MyBatis 中处理 <code>&lt;if&gt;</code> 标签的实现类。它的作用是根据表达式的结果决定是否将该节点的内容拼接到最终 SQL 语句中。MyBatis 中通过 <code>ExpressionEvaluator</code> 来判断条件是否满足。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfSqlNode</span> <span class="token keyword">implements</span> <span class="token class-name">SqlNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExpressionEvaluator</span> evaluator<span class="token punctuation">;</span>  <span class="token comment">// 表达式计算器</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> test<span class="token punctuation">;</span>  <span class="token comment">// 条件表达式</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlNode</span> contents<span class="token punctuation">;</span>  <span class="token comment">// 需要执行的 SQL 节点</span>

    <span class="token keyword">public</span> <span class="token class-name">IfSqlNode</span><span class="token punctuation">(</span><span class="token class-name">SqlNode</span> contents<span class="token punctuation">,</span> <span class="token class-name">String</span> test<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>evaluator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpressionEvaluator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>test <span class="token operator">=</span> test<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>contents <span class="token operator">=</span> contents<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">DynamicContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 通过 evaluator 来判断条件表达式是否为 true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>evaluator<span class="token punctuation">.</span><span class="token function">evaluateBoolean</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            contents<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 条件满足时，应用内容节点</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong><code>apply</code> 方法</strong>：通过 <code>ExpressionEvaluator</code> 计算 <code>test</code> 表达式的结果，决定是否拼接该 SQL 片段。</li><li><strong><code>evaluator.evaluateBoolean</code></strong>：使用反射和 OGNL 表达式计算条件的真假。</li></ul> 
<h4><a id="3_DynamicContext__257"></a><strong>3. DynamicContext 的作用</strong></h4> 
<p><code>DynamicContext</code> 是 MyBatis 中用于存储和管理 SQL 片段的核心类。它在动态 SQL 生成的过程中负责记录 SQL 语句的构建过程以及 SQL 语句中需要绑定的参数。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicContext</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> bindings<span class="token punctuation">;</span>  <span class="token comment">// 绑定参数</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringBuilder</span> sqlBuilder<span class="token punctuation">;</span>  <span class="token comment">// 用于构建 SQL 语句</span>

    <span class="token keyword">public</span> <span class="token class-name">DynamicContext</span><span class="token punctuation">(</span><span class="token class-name">Object</span> parameterObject<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bindings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sqlBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>bindings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"_parameter"</span><span class="token punctuation">,</span> parameterObject<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将参数存入上下文</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">appendSql</span><span class="token punctuation">(</span><span class="token class-name">String</span> sql<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sqlBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sqlBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bindings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong><code>appendSql</code> 方法</strong>：拼接 SQL 片段到 <code>sqlBuilder</code> 中。</li><li><strong><code>getSql</code> 方法</strong>：返回最终生成的 SQL 语句。</li><li><strong><code>getBindings</code> 方法</strong>：获取上下文中存储的参数，用于绑定到 SQL 语句。</li></ul> 
<h4><a id="4_ChooseSqlNode__290"></a><strong>4. ChooseSqlNode 的实现</strong></h4> 
<p><code>ChooseSqlNode</code> 类用于实现 <code>&lt;choose&gt;</code> 标签，它类似于 Java 中的 <code>switch-case</code> 结构。<code>ChooseSqlNode</code> 通过一组 <code>when</code> 节点来选择最先满足条件的 SQL 片段。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChooseSqlNode</span> <span class="token keyword">implements</span> <span class="token class-name">SqlNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> whenSqlNodes<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">SqlNode</span> otherwiseSqlNode<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ChooseSqlNode</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SqlNode</span><span class="token punctuation">&gt;</span></span> whenSqlNodes<span class="token punctuation">,</span> <span class="token class-name">SqlNode</span> otherwiseSqlNode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>whenSqlNodes <span class="token operator">=</span> whenSqlNodes<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>otherwiseSqlNode <span class="token operator">=</span> otherwiseSqlNode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">DynamicContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SqlNode</span> sqlNode <span class="token operator">:</span> whenSqlNodes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sqlNode<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 如果找到第一个满足条件的 when 节点，应用并返回</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>otherwiseSqlNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            otherwiseSqlNode<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果没有 when 节点满足条件，则应用 otherwise 节点</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><strong><code>apply</code> 方法</strong>：循环遍历 <code>whenSqlNodes</code>，应用第一个满足条件的 <code>when</code> 节点，如果没有节点满足条件，则应用 <code>otherwise</code> 节点。</li></ul> 
<hr> 
<h3><a id="_323"></a><strong>总结与互动</strong></h3> 
<p>通过本文，我们详细探讨了 MyBatis 中动态 SQL 的生成原理，并通过自定义实现了一个简化版的动态 SQL 生成器。动态 SQL 是 MyBatis 中最灵活和强大的功能之一，能够根据运行时的条件动态生成 SQL 语句，极大地提升了 SQL 查询的灵活性和可维护性。</p> 
<p><strong>如果你觉得这篇文章对你有帮助，请点赞、收藏并关注本专栏！同时欢迎在评论区留言，分享你的见解和疑问，我们将一起深入探讨！</strong></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0c7a1f29e96c7ce57f20fcfc72339ac9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何选择SDR无线图传方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/80fb91f9203488301b6958a2c2487b77/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">项目进度一</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>