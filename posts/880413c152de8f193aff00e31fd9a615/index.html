<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>拒绝低质量！一个技巧，搞定Stable Diffusion高清图片生成 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/880413c152de8f193aff00e31fd9a615/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="拒绝低质量！一个技巧，搞定Stable Diffusion高清图片生成">
  <meta property="og:description" content="生成高清图片看起来是一件很简单的事情，似乎我们只要给AI设定一个足够高的分辨率，要求就能够达到。
但实际的操作，比我们设想复杂一些。会涉及到一些技术的问题，需要了解背后的逻辑，然后按照用AI绘图的逻辑来解决。
1. Mj与SD在生成高清图片上的差别 首先我们来看一下Mj和SD在生成高清图片上的一些差别。
Mj：默认生成的图像，单张图就是1024x1024，单张图就是1M像素的图片。Mj本身不提供更大分辨率放大的功能。 Mj：默认生成4张1024x1024子图
SD：基础模型默认生成的图片都是512x512，画面幅度明显偏小。但是提供了更高清图片的增强功能。 SD:默认512x512，子图数量可设置
SD:图片效果
512x512的像素，在我们日常使用中，属于非常低清晰度的画面、完全无法展示出清晰的细节，发朋友圈都不够用，更不用说业务上使用。因此图片的放大增强，是非常必要的操作。
2、SD中直接设置高分辨率的绘图问题 在SD中直接设置高分辨率的绘图会出现一系列的问题。这是一个SD特有的问题，其实关键的原因就在于它默认的模型是适配于512x512的图片大小的，按照这样的一个尺寸来训练的。
那在这种情况下我们直接要求它生成一个1024x1024，甚至2048x2048的图像，一方面会带来一个非常大的GPU计算资源的压力，另外一方面由于画面设置的过大，对原来的模型来说，它可能会认为你这个画面对应的是多张图片，它会拥有类似于拼接或者生成多个物体的方式来进行绘制。
具体来看，绘制的图片出现了严重的缺陷：
图2：一只猫双尾巴，一只猫没身体只露头
图3：两只猫（绘图要求是a cat）
图4：双头猫
要解决这个问题，我们就需要用到一个关键技巧——高清修复。
3. 高清修复功能：小图定轮廓，大图出高清 设置方式 高清修复（Highres-fix）——这个技术看起来是比较复杂，但是其实逻辑很简单。
在它绘制的过程中，实际上分了两步:
第一步，按照一个小图来绘制，比如512x512。
第二步，将小图按照一定的倍数放大成一个大图，比如说我们将放大倍数设置为2，它就可以将512的图放大到1024。（设置方式也可以是直接指定尺寸）
值得注意的是，【放大】的过程，实际上是【重绘】的操作，但是在这个过程中，它会尽可能的遵循原来图像画面，然后通过重绘的技术，将在更大的像素上，把我们画制出更加清晰的细节。
基本的设定非常简单：
高清修复：需要开启√
重绘幅度：也就是参考小图画面的程度，经验值03~0.7之间是较为稳妥的参数
放大倍率：取决于最终想要的输出质量，比如，从512到1024对应的放大比例是2。经验：最终出图尺寸，避免超过2k x 2，放大幅度过大，画面可能出现变形。
SD文生图：高清修复
关于放大算法，这一块其实我们可以不用投入太多的精力，因为我看了很多网上教程，不动设置哪一种，基本上都可以得到一个比较好的结果，按系统的默认设置即可。
放大算法选项
3. 实操效果 2倍放大 看整体，放大后的图像，猫脖子处毛发有明显变化。
看局部，放大后的图片，猫脸细节纹理明显更加细腻：
3倍放大 看整体：3倍放大后，图像有一些明显的变异，猫鼻子、耳朵、眼睛变红，整体脸型变得突出。
看细节：大图上，猫眼的细节神态非常清晰，炯炯有神。
4倍放大 计算资源受限，GPU爆显存：
报错的含义是：OutOfMemoryError：CUDA内存不足。尝试分配4.00 GiB（GPU 0；总容量15.74 GiB；已分配10.21 GiB；剩余3.91 GiB；PyTorch总共保留了10.22 GiB）如果保留的内存远大于分配的内存，请尝试设置max_split_size_mb以避免碎片化。
工作流小结 从爆显存的例子可以看出，AI绘图对计算资源消耗很大，即使硬件可以承担，更大的画面要求也意味着更长等待时间。
比较高效的工作流思路是：
第一步：用小图快速迭代
先用小图（512x512）开始绘制，快速迭代多个版本，在生成的系列图中，找到画面布置符合要求的。这是一个海选的过程。
设置批次数量，可以一次生成大量的底图，供筛选:4x4，就是一次输出16个效果。
第二步：放大生成高清
文章使用的AI绘画SD整合包、各种模型插件、提示词、AI人工智能学习资料都已经打包好放在网盘中了，有需要的小伙伴文末扫码自行获取。
写在最后 AIGC技术的未来发展前景广阔，随着人工智能技术的不断发展，AIGC技术也将不断提高。未来，AIGC技术将在游戏和计算领域得到更广泛的应用，使游戏和计算系统具有更高效、更智能、更灵活的特性。同时，AIGC技术也将与人工智能技术紧密结合，在更多的领域得到广泛应用，对程序员来说影响至关重要。未来，AIGC技术将继续得到提高，同时也将与人工智能技术紧密结合，在更多的领域得到广泛应用。
感兴趣的小伙伴，赠送全套AIGC学习资料和安装工具，包含AI绘画、AI人工智能等前沿科技教程，模型插件，具体看下方。
一、AIGC所有方向的学习路线
AIGC所有方向的技术点做的整理，形成各个领域的知识点汇总，它的用处就在于，你可以按照下面的知识点去找对应的学习资源，保证自己学得较为全面。
二、AIGC必备工具
工具都帮大家整理好了，安装就可直接上手！">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-16T10:23:15+08:00">
    <meta property="article:modified_time" content="2024-04-16T10:23:15+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">拒绝低质量！一个技巧，搞定Stable Diffusion高清图片生成</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>生成高清图片看起来是一件很简单的事情，似乎我们只要给AI设定一个足够高的分辨率，要求就能够达到。</p> 
<p>但实际的操作，比我们设想复杂一些。会涉及到一些技术的问题，需要了解背后的逻辑，然后按照用AI绘图的逻辑来解决。</p> 
<h3><a id="1_MjSD_4"></a>1. Mj与SD在生成高清图片上的差别</h3> 
<p>首先我们来看一下Mj和SD在生成高清图片上的一些差别。</p> 
<ul><li>Mj：默认生成的图像，单张图就是1024x1024，单张图就是1M像素的图片。Mj本身不提供更大分辨率放大的功能。</li></ul> 
<p><img src="https://images2.imgbox.com/74/9b/sDqHWtTH_o.png" alt=""></p> 
<p>Mj：默认生成4张1024x1024子图</p> 
<ul><li>SD：基础模型默认生成的图片都是512x512，画面幅度明显偏小。但是提供了更高清图片的增强功能。</li></ul> 
<p><img src="https://images2.imgbox.com/1d/18/fM5LQa5j_o.png" alt=""></p> 
<p>SD:默认512x512，子图数量可设置</p> 
<p><img src="https://images2.imgbox.com/73/98/k6MP5K3k_o.png" alt=""></p> 
<p>SD:图片效果</p> 
<p>512x512的像素，在我们日常使用中，属于非常低清晰度的画面、完全无法展示出清晰的细节，发朋友圈都不够用，更不用说业务上使用。因此图片的放大增强，是非常必要的操作。</p> 
<h3><a id="2SD_29"></a>2、SD中直接设置高分辨率的绘图问题</h3> 
<p>在SD中直接设置高分辨率的绘图会出现一系列的问题。这是一个SD特有的问题，其实关键的原因就在于它<strong>默认的模型是适配于512x512</strong>的图片大小的，按照这样的一个尺寸来训练的。</p> 
<p>那在这种情况下我们直接要求它生成一个1024x1024，甚至2048x2048的图像，一方面会带来一个非常大的<strong>GPU计算资源的压力</strong>，另外一方面由于画面设置的过大，对原来的模型来说，它可能会认为你这个画面对应的是<strong>多张图片</strong>，它会拥有类似于拼接或者生成多个物体的方式来进行绘制。</p> 
<p><img src="https://images2.imgbox.com/a7/8a/sGSCCjkI_o.png" alt=""></p> 
<p>具体来看，绘制的图片出现了严重的缺陷：</p> 
<ul><li> <p>图2：一只猫双尾巴，一只猫没身体只露头</p> </li><li> <p>图3：两只猫（绘图要求是<code>a cat</code>）</p> </li><li> <p>图4：双头猫</p> </li></ul> 
<p><img src="https://images2.imgbox.com/4c/e6/lQmoGqRo_o.jpg" alt=""></p> 
<p>要解决这个问题，我们就需要用到一个关键技巧——<strong>高清修复</strong>。</p> 
<h3><a id="3__51"></a>3. 高清修复功能：小图定轮廓，大图出高清</h3> 
<h4><a id="_54"></a>设置方式</h4> 
<p><strong>高清修复（Highres-fix）</strong>——这个技术看起来是比较复杂，但是其实逻辑很简单。</p> 
<p>在它绘制的过程中，实际上分了两步:</p> 
<ul><li> <p>第一步，按照一个小图来绘制，比如512x512。</p> </li><li> <p>第二步，将小图按照一定的倍数放大成一个大图，比如说我们将放大倍数设置为<strong>2</strong>，它就可以将512的图放大到1024。（设置方式也可以是直接指定尺寸）</p> </li></ul> 
<p>值得注意的是，【放大】的过程，实际上是【重绘】的操作，但是在这个过程中，它会尽可能的遵循原来图像画面，然后通过重绘的技术，将在更大的像素上，把我们画制出更加清晰的细节。</p> 
<p>基本的设定非常简单：</p> 
<ul><li> <p><strong>高清修复</strong>：需要开启√</p> </li><li> <p><strong>重绘幅度</strong>：也就是参考<strong>小图</strong>画面的程度，经验值03~0.7之间是较为稳妥的参数</p> </li><li> <p><strong>放大倍率</strong>：取决于最终想要的输出质量，比如，从512到1024对应的放大比例是2。经验：最终出图尺寸，避免超过2k x 2，放大幅度过大，画面可能出现变形。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/1f/46/c2o6KGe3_o.png" alt=""></p> 
<p>SD文生图：高清修复</p> 
<p>关于<strong>放大算法</strong>，这一块其实我们可以不用投入太多的精力，因为我看了很多网上教程，不动设置哪一种，基本上都可以得到一个比较好的结果，<strong>按系统的默认设置</strong>即可。</p> 
<p><img src="https://images2.imgbox.com/b5/28/JJ81U0CI_o.png" alt=""></p> 
<p>放大算法选项</p> 
<h3><a id="3__86"></a>3. 实操效果</h3> 
<h4><a id="2_89"></a>2倍放大</h4> 
<p><img src="https://images2.imgbox.com/cd/8e/XawG623i_o.png" alt=""></p> 
<p>看整体，放大后的图像，猫脖子处毛发有明显变化。</p> 
<p><img src="https://images2.imgbox.com/d3/71/O5cK1qks_o.png" alt=""></p> 
<p>看局部，放大后的图片，猫脸细节纹理明显更加细腻：</p> 
<p><img src="https://images2.imgbox.com/5a/5d/r2NYMFTR_o.png" alt=""></p> 
<h4><a id="3_101"></a>3倍放大</h4> 
<p>看整体：3倍放大后，图像有一些明显的变异，猫鼻子、耳朵、眼睛变红，整体脸型变得突出。</p> 
<p><img src="https://images2.imgbox.com/6b/6a/ySI0RFJJ_o.png" alt=""></p> 
<p>看细节：大图上，猫眼的细节神态非常清晰，炯炯有神。</p> 
<p><img src="https://images2.imgbox.com/99/03/x23PmTZ1_o.png" alt=""></p> 
<h4><a id="4_111"></a>4倍放大</h4> 
<p>计算资源受限，GPU爆显存：</p> 
<p><img src="https://images2.imgbox.com/04/75/9tfJOJp9_o.png" alt=""></p> 
<p>报错的含义是：OutOfMemoryError：CUDA内存不足。尝试分配4.00 GiB（GPU 0；总容量15.74 GiB；已分配10.21 GiB；剩余3.91 GiB；PyTorch总共保留了10.22 GiB）如果保留的内存远大于分配的内存，请尝试设置max_split_size_mb以避免碎片化。</p> 
<h4><a id="_119"></a>工作流小结</h4> 
<p>从<strong>爆显存</strong>的例子可以看出，AI绘图对计算资源消耗很大，即使硬件可以承担，更大的画面要求也意味着更长等待时间。</p> 
<p>比较高效的工作流思路是：</p> 
<p><strong>第一步：用小图快速迭代</strong></p> 
<p>先用小图（512x512）开始绘制，快速迭代多个版本，在生成的系列图中，找到画面布置符合要求的。这是一个海选的过程。</p> 
<p>设置批次数量，可以一次生成大量的底图，供筛选:4x4，就是一次输出16个效果。</p> 
<p><img src="https://images2.imgbox.com/25/61/mW9qLxrx_o.png" alt=""></p> 
<p><strong>第二步：放大生成高清</strong></p> 
<p>文章使用的AI绘画SD整合包、各种模型插件、提示词、AI人工智能学习资料都已经打包好放在网盘中了，有需要的小伙伴文末扫码自行获取。</p> 
<h3><a id="_138"></a>写在最后</h3> 
<p>AIGC技术的未来发展前景广阔，随着人工智能技术的不断发展，AIGC技术也将不断提高。未来，AIGC技术将在游戏和计算领域得到更广泛的应用，使游戏和计算系统具有更高效、更智能、更灵活的特性。同时，AIGC技术也将与人工智能技术紧密结合，在更多的领域得到广泛应用，对程序员来说影响至关重要。未来，AIGC技术将继续得到提高，同时也将与人工智能技术紧密结合，在更多的领域得到广泛应用。</p> 
<p><font face="幼圆" size="4" color="red">感兴趣的小伙伴，赠送全套AIGC学习资料和安装工具，包含AI绘画、AI人工智能等前沿科技教程，模型插件，具体看下方。<br> </font><br> <img src="https://images2.imgbox.com/03/e9/CyqzIDdG_o.jpg"></p> 
<p><strong>一、AIGC所有方向的学习路线</strong></p> 
<p>AIGC所有方向的技术点做的整理，形成各个领域的知识点汇总，它的用处就在于，你可以按照下面的知识点去找对应的学习资源，保证自己学得较为全面。</p> 
<p><img src="https://images2.imgbox.com/b5/5e/zS3j6WKj_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f9/f7/PIhhD22y_o.png" alt="在这里插入图片描述"></p> 
<p><strong>二、AIGC必备工具</strong></p> 
<p>工具都帮大家整理好了，安装就可直接上手！<br> <img src="https://images2.imgbox.com/f3/e2/TwfFZ2ev_o.png" alt="在这里插入图片描述"></p> 
<p><strong>三、最新AIGC学习笔记</strong></p> 
<p>当我学到一定基础，有自己的理解能力的时候，会去阅读一些前辈整理的书籍或者手写的笔记资料，这些笔记详细记载了他们对一些技术点的理解，这些理解是比较独到，可以学到不一样的思路。<br> <img src="https://images2.imgbox.com/ec/f8/7TSZcfbf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/40/2a/5HX8J3km_o.png" alt="在这里插入图片描述"></p> 
<p><strong>四、AIGC视频教程合集</strong></p> 
<p>观看全面零基础学习视频，看视频学习是最快捷也是最有效果的方式，跟着视频中老师的思路，从基础到深入，还是很容易入门的。</p> 
<p><img src="https://images2.imgbox.com/af/a5/A0OdhF7W_o.png" alt="在这里插入图片描述"></p> 
<p><strong>五、实战案例</strong></p> 
<p>纸上得来终觉浅，要学会跟着视频一起敲，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。<br> <img src="https://images2.imgbox.com/3e/8b/Ca9kjU4n_o.png" alt="在这里插入图片描述"></p> 
<img src="https://images2.imgbox.com/51/b7/k1S1Ck6o_o.jpg"> 若有侵权，请联系删除
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9487d7a062315af71b0f86020f5ffd4d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用stable diffusion做服装设计-线稿图上色</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6b4d7addad713b78009591e5264cfb32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">k-means聚类算法的MATLAB实现及可视化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>