<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python读取.nc数据并提取指定时间、经纬度维度对应的变量数值 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6de9ae25dd1406360f7e7a63a12ee338/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python读取.nc数据并提取指定时间、经纬度维度对应的变量数值">
  <meta property="og:description" content="本文介绍基于Python语言的netCDF4库，读取.nc格式的数据文件，并提取指定维（时间、经度与纬度）下的变量数据的方法。
我们之前介绍过.nc格式的数据，其是NetCDF（Network Common Data Form）文件的扩展名，是一种常用的科学数据存储格式，多用于存储科学和工程领域的大型数据集。同时，在我们之前的文章Python批量读取大量nc格式文件并导出全部时间信息（https://blog.csdn.net/zhebushibiaoshifu/article/details/135331417）中，就介绍过基于netCDF4库，对一个文件夹下大量.nc格式数据文件的某一维的信息加以提取的方法。而在本文中，我们则是同样基于netCDF4库，读取.nc文件，并提取指定维（Dimensions，也就相当于是自变量）下的变量（Variables，也就相当于是因变量）的具体数值。
首先，我们需要配置一下netCDF4库，具体配置方法大家可以参考文章Anaconda下Python中h5py与netCDF4模块下载与安装方法（https://blog.csdn.net/zhebushibiaoshifu/article/details/120553597）。
随后，本文所需代码如下。
# -*- coding: utf-8 -*- &#34;&#34;&#34; Created on Thu Feb 22 21:41:52 2024 @author: fkxxgis &#34;&#34;&#34; import netCDF4 as nc nc_path = r&#34;F:\Data_Reflectance_Rec\soil_1\2020_01.nc&#34; nc_data = nc.Dataset(nc_path) print(nc_data) time_value = nc_data.variables[&#34;time&#34;][:] longitude_value = nc_data.variables[&#34;lon&#34;][:] latitude_value = nc_data.variables[&#34;lat&#34;][:] # 第一种需求 time_need = 0 nc_value_1 = nc_data.variables[&#34;swvl1&#34;][time_need, : , : ] # 第二种需求 longitude_need = 106.467 latitude_need = 36.817 longitude_nc = (abs(longitude_value - longitude_need)).argmin() latitude_nc = (abs(latitude_value - latitude_need)).">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-23T22:05:39+08:00">
    <meta property="article:modified_time" content="2024-02-23T22:05:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python读取.nc数据并提取指定时间、经纬度维度对应的变量数值</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  本文介绍基于<strong>Python</strong>语言的<code>netCDF4</code>库，读取<code>.nc</code>格式的数据文件，并提取指定维（时间、经度与纬度）下的变量数据的方法。</p> 
<p>  我们之前介绍过<code>.nc</code>格式的数据，其是<code>NetCDF</code>（Network Common Data Form）文件的扩展名，是一种常用的科学数据存储格式，多用于存储科学和工程领域的大型数据集。同时，在我们之前的文章<a href="https://blog.csdn.net/zhebushibiaoshifu/article/details/135331417">Python批量读取大量nc格式文件并导出全部时间信息</a>（https://blog.csdn.net/zhebushibiaoshifu/article/details/135331417）中，就介绍过基于<code>netCDF4</code>库，对一个文件夹下大量<code>.nc</code>格式数据文件的<strong>某一维</strong>的信息加以提取的方法。而在本文中，我们则是同样基于<code>netCDF4</code>库，读取<code>.nc</code>文件，并提取指定<strong>维</strong>（<strong>Dimensions</strong>，也就相当于是<strong>自变量</strong>）下的<strong>变量</strong>（<strong>Variables</strong>，也就相当于是<strong>因变量</strong>）的具体数值。</p> 
<p>  首先，我们需要配置一下<code>netCDF4</code>库，具体配置方法大家可以参考文章<a href="https://blog.csdn.net/zhebushibiaoshifu/article/details/120553597">Anaconda下Python中h5py与netCDF4模块下载与安装方法</a>（https://blog.csdn.net/zhebushibiaoshifu/article/details/120553597）。</p> 
<p>  随后，本文所需代码如下。</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Created on Thu Feb 22 21:41:52 2024

@author: fkxxgis
"""</span>

<span class="token keyword">import</span> netCDF4 <span class="token keyword">as</span> nc

nc_path <span class="token operator">=</span> <span class="token string">r"F:\Data_Reflectance_Rec\soil_1\2020_01.nc"</span>
nc_data <span class="token operator">=</span> nc<span class="token punctuation">.</span>Dataset<span class="token punctuation">(</span>nc_path<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>nc_data<span class="token punctuation">)</span>
time_value <span class="token operator">=</span> nc_data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">"time"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
longitude_value <span class="token operator">=</span> nc_data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">"lon"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
latitude_value <span class="token operator">=</span> nc_data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">"lat"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment"># 第一种需求</span>
time_need <span class="token operator">=</span> <span class="token number">0</span>
nc_value_1 <span class="token operator">=</span> nc_data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">"swvl1"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>time_need<span class="token punctuation">,</span> <span class="token punctuation">:</span> <span class="token punctuation">,</span> <span class="token punctuation">:</span> <span class="token punctuation">]</span>

<span class="token comment"># 第二种需求</span>
longitude_need <span class="token operator">=</span> <span class="token number">106.467</span>
latitude_need <span class="token operator">=</span> <span class="token number">36.817</span>
longitude_nc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>longitude_value <span class="token operator">-</span> longitude_need<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmin<span class="token punctuation">(</span><span class="token punctuation">)</span>
latitude_nc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span>latitude_value <span class="token operator">-</span> latitude_need<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argmin<span class="token punctuation">(</span><span class="token punctuation">)</span>
nc_value_2 <span class="token operator">=</span> nc_data<span class="token punctuation">.</span>variables<span class="token punctuation">[</span><span class="token string">"swvl1"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>time_need<span class="token punctuation">,</span> latitude_nc<span class="token punctuation">,</span> longitude_nc<span class="token punctuation">]</span>
</code></pre> 
<p>  其中，我们首先导入<code>netCDF4</code>库，并指定要读取的<code>.nc</code>格式数据文件的路径<code>nc_path</code>；随后，使用<code>nc.Dataset()</code>打开这一文件，并将返回的<code>Dataset</code>对象存储在<code>nc_data</code>变量中；紧接着，通过<code>print()</code>打印<code>nc_data</code>，这将显示要读取的<code>.nc</code>格式数据文件的基本信息，如变量、维、属性等——这里具体打印出来的情况如下图所示。</p> 
<p><img src="https://images2.imgbox.com/72/b9/nLjprvua_o.png" alt="" width="600"></p> 
<p>  其中，在上图我们需要重点关注紫色框内的内容。首先，在<code>dimensions</code>中，我们可以看到所有的<strong>维</strong>；我这里的<code>.nc</code>格式数据是一个表示气象的数据，所以文件中的<strong>维</strong>依次就是时间、纬度与经度；随后，在<code>variables</code>中，我们可以看到所有的数据变量（这里的数据变量是包含了维、变量与其他参数）——其中我们重点观察数据中的<strong>因变量</strong>（也就是上图中的<code>swvl1</code>），需要留意一下其后<strong>不同维</strong>的<strong>排序顺序</strong>，在后面我们按照<strong>维</strong>提取<strong>变量</strong>数据的时候会用到。</p> 
<p>  回到前述代码的介绍中。通过前面<code>print()</code>打印出来的<code>nc_data</code>信息，我们知道了这个<code>.nc</code>数据的<strong>维</strong>，此时我们可以将这几个<strong>维</strong>也打印出来看看。例如，<code>time_value = nc_data.variables["time"][:]</code>就表示将<strong>时间</strong>这个<strong>维</strong>打印出来，相当于获取了全部的时间节点。</p> 
<p>  再接下来，我们即可开始按照<strong>维</strong>来提取<strong>变量</strong>。为了方便，我们就以这个<code>.nc</code>文件的<strong>时间维</strong>中的第一个节点对应的数据（也就是第一景数据）为例来介绍；因此，我们先将<code>time_need</code>设置为<code>0</code>，表示读取第一个时间节点的数据。在这里，我们给出了<code>2</code>种按照<strong>维</strong>来提取<strong>变量</strong>的需求。</p> 
<p>  首先，是第一种需求，也就是<code>time_need = 0</code>这一行代码的下一行。<code>nc_data.variables["swvl1"]</code>表示这个<code>.nc</code>文件中读取名为<code>swvl1</code>的变量的值，而后面的<code>[time_need, :, :]</code>表示选择指定时间<strong>维</strong>下的所有经度和纬度位置的值。这些值将被存储在<code>nc_value_1</code>变量中，也就是说这个<code>nc_value_1</code>变量相当于就是当前这个<code>.nc</code>文件的第一景数据（时间节点排在第一位的数据）。</p> 
<p>  其次，是第二种需求。前面我们提取了指定时间维下的所有经度和纬度位置的值，那么现在就更进一步，提取指定时间维度、经度维度以及纬度维度的数据（相当于就是从前面的<strong>一景数据</strong>变成了<strong>一个像元的数据</strong>）。首先，我们指定一个处于<code>.nc</code>文件<strong>成像范围内</strong>的目标经度<code>longitude_need</code>和目标纬度<code>latitude_need</code>，并使用<code>argmin()</code>函数找到目标经、纬度值与文件中经度、纬度的<strong>维</strong>数据值最接近的索引值——即<code>longitude_nc</code>和<code>latitude_nc</code>。最后，即可使用<code>nc_data.variables["swvl1"][time_need, latitude_nc, longitude_nc]</code>来获取特定时间、经度和纬度位置的值，并将结果存储在<code>nc_value_2</code>变量中。</p> 
<p>  这里提一句——为什么需要用<code>argmin()</code>函数呢？这个是因为，我们在实际情况中，需要提取指定空间位置的像素时，这个位置的经、纬度数据肯定是随机的；而通过<code>argmin()</code>函数，就可以找到<code>.nc</code>文件里面经度、纬度所对应的<strong>维</strong>中，与我们实际需要的经、纬度<strong>最接近的那个数值</strong>所对应的<strong>维的下标</strong>。例如，上述代码中，我们希望提取实际经度为<code>106.467</code>位置处的数据；而我这里这个<code>.nc</code>文件，其维中的经度的分辨率是<code>0.1</code>，那它自然没有办法非常精确地确定<code>106.467</code>的位置；所以需要通过<code>argmin()</code>函数，找到与<code>106.467</code>最接近的数据<code>106.5</code>，并进一步确定出这个<code>106.5</code>所在的经度<strong>维</strong>的下标，那么就可以提取出指定的<strong>变量</strong>了。</p> 
<p>  如下图所示，我们通过上述第二种需求，提取出来了目标时间、经度与纬度维下的一个像素。</p> 
<p><img src="https://images2.imgbox.com/68/8d/c3JRUpPD_o.png" alt="" width="270"></p> 
<p>  那么这个像素值对不对呢？我们可以在<strong>ArcGIS</strong>中打开这个<code>.nc</code>文件的第一景数据，找到代码中目标经、纬度（也就是<code>longitude_need</code>和<code>latitude_need</code>所指向的数据）所对应的像元，并查看其像素值；如下图所示。</p> 
<p><img src="https://images2.imgbox.com/83/7e/CYufysJP_o.png" alt="" width="590"></p> 
<p>  可以看到，上图在<strong>ArcGIS</strong>提取出来的像素值，与上上图在<strong>Python</strong>中提取出来的像素值一致，说明我们的代码无误。</p> 
<p>  至此，大功告成。</p> 
<p>欢迎关注：疯狂学习GIS</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de4a35aa0015f3e15e9e7431a3165cc3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一次性搞懂什么是AIGC！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4bdb8bfc43c99bc3659cbe3b3af9739e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【光学】基于Matlab实现涡旋光场的相位调制 初始化全息图矩阵 水平和垂直像素的数目</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>