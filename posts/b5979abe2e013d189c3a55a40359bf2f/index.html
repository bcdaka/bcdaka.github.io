<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何基于 Python 快速搭建 QQ 开放平台 QQ 群官方机器人详细教程（更新中） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b5979abe2e013d189c3a55a40359bf2f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="如何基于 Python 快速搭建 QQ 开放平台 QQ 群官方机器人详细教程（更新中）">
  <meta property="og:description" content="注册 QQ 开放平台账号 账号注册
QQ 机器人：一个机器人可以被添加到 群聊/频道 内对话，QQ 用户也可以直接跟机器人 单独对话。
开发者账号主体要求
单聊对话：【定向邀请】 群聊场景：仅支持企业主体【个人主体暂不支持】 频道场景：企业主体与个人主体均可申请 注册地址：QQ 开放平台(opens new window)
注册创建机器人：获得的开发机器人接入票据 AppID AppSecret Token
创建机器人：https://q.qq.com/#/app/create-bot
开发设置：https://q.qq.com/qqbot/#/developer/developer-setting
查询官方文档 新版机器人官方文档：https://bot.q.qq.com/wiki/develop/api-v2/
GitHub 地址
安装 qq-botpy 环境 更新包的话需要添加 --upgrade 兼容版本：python3.8&#43;
pip install qq-botpy 使用
需要使用的地方import botpy
import botpy 兼容提示
原机器人的老版本qq-bot仍然可以使用，但新接口的支持上会逐渐暂停，此次升级不会影响线上使用的机器人。
基础案例演示 通过继承实现bot.Client, 实现自己的机器人Client
实现机器人相关事件的处理方法,如 on_at_message_create， 详细的事件监听列表，请参考 事件监听.md
定义机器人被@的后自动回复
import botpy from botpy.message import Message class MyClient(botpy.Client): async def on_at_message_create(self, message: Message): await message.reply(content=f&#34;机器人{self.robot.name}收到你的@消息了: {message.content}&#34;) 注意：每个事件会下发具体的数据对象，如message相关事件是message.Message的对象 (部分事件透传了后台数据，暂未实现对象缓存)">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-14T00:48:51+08:00">
    <meta property="article:modified_time" content="2024-06-14T00:48:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何基于 Python 快速搭建 QQ 开放平台 QQ 群官方机器人详细教程（更新中）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_QQ__0"></a>注册 QQ 开放平台账号</h3> 
<p><strong>账号注册</strong></p> 
<p>QQ 机器人：一个机器人可以被添加到 群聊/频道 内对话，QQ 用户也可以直接跟机器人 单独对话。</p> 
<p><strong>开发者账号主体要求</strong></p> 
<pre><code class="prism language-python">单聊对话：【定向邀请】
群聊场景：仅支持企业主体【个人主体暂不支持】
频道场景：企业主体与个人主体均可申请
</code></pre> 
<p>注册地址：QQ 开放平台(opens new window)</p> 
<p>注册创建机器人：获得的开发机器人接入票据 AppID AppSecret Token</p> 
<p><strong>创建机器人：<a href="https://q.qq.com/#/app/create-bot" rel="nofollow">https://q.qq.com/#/app/create-bot</a></strong></p> 
<p><img src="https://images2.imgbox.com/2b/ac/viQ2jQhb_o.png" alt="在这里插入图片描述"></p> 
<p><strong>开发设置：<a href="https://q.qq.com/qqbot/#/developer/developer-setting" rel="nofollow">https://q.qq.com/qqbot/#/developer/developer-setting</a></strong></p> 
<p><img src="https://images2.imgbox.com/1f/da/w8KnEv2Y_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_29"></a>查询官方文档</h3> 
<p><strong>新版机器人官方文档：<a href="https://bot.q.qq.com/wiki/develop/api-v2/" rel="nofollow">https://bot.q.qq.com/wiki/develop/api-v2/</a></strong></p> 
<p><strong>GitHub 地址</strong></p> 
<p><img src="https://images2.imgbox.com/a2/bc/1n0GVPfc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_qqbotpy__35"></a>安装 qq-botpy 环境</h3> 
<p>更新包的话需要添加 --upgrade 兼容版本：python3.8+</p> 
<pre><code class="prism language-python">pip install qq<span class="token operator">-</span>botpy
</code></pre> 
<p><strong>使用</strong></p> 
<p>需要使用的地方import botpy</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> botpy
</code></pre> 
<p><strong>兼容提示</strong></p> 
<p>原机器人的老版本qq-bot仍然可以使用，但新接口的支持上会逐渐暂停，此次升级不会影响线上使用的机器人。</p> 
<h3><a id="_54"></a>基础案例演示</h3> 
<p>通过继承实现bot.Client, 实现自己的机器人Client</p> 
<p>实现机器人相关事件的处理方法,如 on_at_message_create， 详细的事件监听列表，请参考 事件监听.md</p> 
<p><strong>定义机器人被@的后自动回复</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> botpy
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>message <span class="token keyword">import</span> Message

<span class="token keyword">class</span> <span class="token class-name">MyClient</span><span class="token punctuation">(</span>botpy<span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_at_message_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> Message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> message<span class="token punctuation">.</span>reply<span class="token punctuation">(</span>content<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"机器人</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>robot<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">收到你的@消息了: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">.</span>content<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>注意：每个事件会下发具体的数据对象，如<code>message</code>相关事件是<code>message.Message</code>的对象 (部分事件透传了后台数据，暂未实现对象缓存)</p> 
<p><strong>设置机器人需要监听的事件通道并启动client</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> botpy
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>message <span class="token keyword">import</span> Message

<span class="token keyword">class</span> <span class="token class-name">MyClient</span><span class="token punctuation">(</span>botpy<span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_at_message_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> Message<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">await</span> self<span class="token punctuation">.</span>api<span class="token punctuation">.</span>post_message<span class="token punctuation">(</span>channel_id<span class="token operator">=</span>message<span class="token punctuation">.</span>channel_id<span class="token punctuation">,</span> content<span class="token operator">=</span><span class="token string">"content"</span><span class="token punctuation">)</span>

intents <span class="token operator">=</span> botpy<span class="token punctuation">.</span>Intents<span class="token punctuation">(</span>public_guild_messages<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> 
client <span class="token operator">=</span> MyClient<span class="token punctuation">(</span>intents<span class="token operator">=</span>intents<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>run<span class="token punctuation">(</span>appid<span class="token operator">=</span><span class="token string">"12345"</span><span class="token punctuation">,</span> token<span class="token operator">=</span><span class="token string">"xxxx"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>其他案例</strong></p> 
<p>examples 目录下存放示例机器人 具体使用可参考 Readme.md：<a href="https://github.com/tencent-connect/botpy/blob/master/examples/README.md">https://github.com/tencent-connect/botpy/blob/master/examples/README.md</a></p> 
<pre><code>examples/
.
├── README.md
├── config.example.yaml          # 示例配置文件（需要修改为config.yaml）
├── demo_announce.py             # 机器人公告API使用示例
├── demo_api_permission.py       # 机器人授权查询API使用示例
├── demo_at_reply.py             # 机器人at被动回复async示例
├── demo_at_reply_ark.py         # 机器人at被动回复ark消息示例
├── demo_at_reply_embed.py       # 机器人at被动回复embed消息示例
├── demo_at_reply_command.py     # 机器人at被动使用Command指令装饰器回复消息示例
├── demo_at_reply_file_data.py   # 机器人at被动回复本地图片消息示例
├── demo_at_reply_keyboard.py    # 机器人at被动回复md带内嵌键盘的示例
├── demo_at_reply_markdown.py    # 机器人at被动回复md消息示例
├── demo_at_reply_reference.py   # 机器人at被动回复消息引用示例
├── demo_dms_reply.py            # 机器人私信被动回复示例
├── demo_get_reaction_users.py   # 机器人获取表情表态成员列表示例
├── demo_guild_member_event.py   # 机器人频道成员变化事件示例
├── demo_interaction.py          # 机器人互动事件示例（未启用）
├── demo_pins_message.py         # 机器人消息置顶示例
├── demo_recall.py               # 机器人消息撤回示例
├── demo_schedule.py             # 机器人日程相关示例
</code></pre> 
<h3><a id="_IP__113"></a>配置 IP 白名单</h3> 
<p>部分之前就注册的机器人可能不需要进行配置，但是新注册的机器人在进行腾讯开放平台的提审之前，需要进行 IP 白名单的配置。</p> 
<blockquote> 
 <p>注意：只有白名单内的IP可以在沙箱环境外成功调用openAPI接口，机器人上线提审前IP白名单不可为空。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/54/21/rJUBfNfP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_Sandbox_QQ__119"></a>配置 Sandbox QQ 群</h3> 
<p>在QQ群配置</p> 
<p>如需开发在QQ群使用的机器人功能请完成此项配置</p> 
<p><img src="https://images2.imgbox.com/5b/e6/GHMvcpM9_o.png" alt="在这里插入图片描述"><br> 管理员QQ在沙箱群需为群主/管理员，且群成员数不大于20人。建议沙箱群包含「测试」相关字眼，且群头像与其他群区分开。配置完成后，群主可从沙箱群“设置-群机器人”打开机器人列表页添加测试机器人进行开发调试。</p> 
<h3><a id="OpenAi__127"></a>案例：OpenAi 问答</h3> 
<p><strong>常用镜像源</strong></p> 
<pre><code class="prism language-python">清华：https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
阿里云：http<span class="token punctuation">:</span><span class="token operator">//</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com<span class="token operator">/</span>pypi<span class="token operator">/</span>simple<span class="token operator">/</span>
中国科技大学 https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>mirrors<span class="token punctuation">.</span>ustc<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple<span class="token operator">/</span>
华中理工大学：http<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>hustunique<span class="token punctuation">.</span>com<span class="token operator">/</span>
山东理工大学：http<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>sdutlinux<span class="token punctuation">.</span>org<span class="token operator">/</span>
豆瓣：http<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>douban<span class="token punctuation">.</span>com<span class="token operator">/</span>simple<span class="token operator">/</span>
</code></pre> 
<p><strong>配置镜像源</strong></p> 
<pre><code class="prism language-python">pip config <span class="token builtin">set</span> <span class="token keyword">global</span><span class="token punctuation">.</span>index<span class="token operator">-</span>url https<span class="token punctuation">:</span><span class="token operator">//</span>pypi<span class="token punctuation">.</span>tuna<span class="token punctuation">.</span>tsinghua<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>cn<span class="token operator">/</span>simple
Writing to C<span class="token punctuation">:</span>\Users\Administrator\AppData\Roaming\pip\pip<span class="token punctuation">.</span>ini
</code></pre> 
<p>然后我们把这个 <code>C:\Users\Administrator\AppData\Roaming\pip\pip.ini</code> 路径添加到系统环境变量就好了（怎么添加环境变量？跟给 pip 添加环境变量一样操作，只是路径不一样）</p> 
<p><strong>安装 openai 库</strong></p> 
<pre><code class="prism language-python">pip install openai<span class="token operator">==</span><span class="token number">1.33</span><span class="token number">.0</span> <span class="token operator">-</span>i 镜像源
</code></pre> 
<p><strong>项目结构</strong></p> 
<pre><code class="prism language-python">bot<span class="token punctuation">.</span>py      					机器人主函数
plugins<span class="token operator">/</span>chat_api<span class="token punctuation">.</span>py 		    调用查询 OpenAi 接口插件
config<span class="token punctuation">.</span>yaml						机器人基本信息
<span class="token punctuation">.</span>env 					        OpenAi token 和 中转路径配置
</code></pre> 
<p><strong>配置 Token 和 中转地址</strong></p> 
<p>在项目同级目录创建 .env 文件</p> 
<pre><code class="prism language-python">OPENAI_API_KEY<span class="token operator">=</span>sk<span class="token operator">-</span>······
OPENAI_BASE_URL<span class="token operator">=</span>https<span class="token punctuation">:</span><span class="token operator">//</span>api<span class="token punctuation">.</span>······
</code></pre> 
<p><strong><code>./plugins/chat_api.py</code> 调用查询 OpenAi 接口</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">import</span> dotenv
dotenv<span class="token punctuation">.</span>load_dotenv<span class="token punctuation">(</span><span class="token string">".env"</span><span class="token punctuation">)</span>

client <span class="token operator">=</span> OpenAI<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">chat_answer</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"You are a helpful assistant."</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> text<span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
</code></pre> 
<p><strong>查询 openai <code>bot.py</code> 源码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os

<span class="token keyword">import</span> botpy
<span class="token keyword">from</span> botpy <span class="token keyword">import</span> logging
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>cog_yaml <span class="token keyword">import</span> read
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>message <span class="token keyword">import</span> GroupMessage
<span class="token keyword">from</span> plugins <span class="token keyword">import</span> chat_api

test_config <span class="token operator">=</span> read<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"config.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_log <span class="token operator">=</span> logging<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MyClient</span><span class="token punctuation">(</span>botpy<span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot 「</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>robot<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">」 on_ready!"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_group_at_message_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> GroupMessage<span class="token punctuation">)</span><span class="token punctuation">:</span>
        openid <span class="token operator">=</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>member_openid
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>openid<span class="token punctuation">}</span></span><span class="token string"> on_ready!"</span></span><span class="token punctuation">)</span>
        msg <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

        result <span class="token operator">=</span> chat_api<span class="token punctuation">.</span>chat_answer<span class="token punctuation">(</span>text<span class="token operator">=</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">await</span> message<span class="token punctuation">.</span>_api<span class="token punctuation">.</span>post_group_message<span class="token punctuation">(</span>
            group_openid<span class="token operator">=</span>message<span class="token punctuation">.</span>group_openid<span class="token punctuation">,</span>
            msg_type<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
            msg_id<span class="token operator">=</span>message<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
            content<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    intents <span class="token operator">=</span> botpy<span class="token punctuation">.</span>Intents<span class="token punctuation">(</span>public_messages<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    client <span class="token operator">=</span> MyClient<span class="token punctuation">(</span>intents<span class="token operator">=</span>intents<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span>appid<span class="token operator">=</span>test_config<span class="token punctuation">[</span><span class="token string">"appid"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> secret<span class="token operator">=</span>test_config<span class="token punctuation">[</span><span class="token string">"secret"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行效果</strong></p> 
<p><img src="https://images2.imgbox.com/2c/4c/BAntwDZK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_232"></a>案例：查询天气信息</h3> 
<p><strong>项目结构</strong></p> 
<pre><code class="prism language-python">bot<span class="token punctuation">.</span>py      					机器人主函数
plugins<span class="token operator">/</span>weather_api<span class="token punctuation">.</span>py 		    调用查询天气接口插件
config<span class="token punctuation">.</span>yaml						机器人基本信息
</code></pre> 
<p><strong><code>./plugins/weather_api.py</code> 调用查询天气接口</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests


<span class="token keyword">def</span> <span class="token function">get_weather</span><span class="token punctuation">(</span>city_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置请求的URL和参数</span>
    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://apis.juhe.cn/simpleWeather/query?key=50a3bd415158e186903d6e6994157589&amp;city=</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>city_name<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    <span class="token comment"># 发送GET请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token comment"># 检查请求是否成功</span>
    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token comment"># 解析返回的JSON数据</span>
        data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 检查是否查询成功</span>
        <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">'reason'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'查询成功!'</span><span class="token punctuation">:</span>
            <span class="token comment"># 返回天气数据</span>
            <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token string">'result'</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"查询失败: "</span> <span class="token operator">+</span> data<span class="token punctuation">[</span><span class="token string">'reason'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"error"</span><span class="token punctuation">:</span> <span class="token string">"请求失败，状态码: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token punctuation">}</span>


<span class="token comment"># 调用函数并处理返回的天气数据</span>
<span class="token keyword">def</span> <span class="token function">format_weather</span><span class="token punctuation">(</span>city_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 假设这里你已经有了城市的URL编码，这里用'%E9%87%8D%E5%BA%86'作为示例</span>
    city_encoded <span class="token operator">=</span> city_name  <span class="token comment"># 重庆的URL编码</span>
    weather_data <span class="token operator">=</span> get_weather<span class="token punctuation">(</span>city_encoded<span class="token punctuation">)</span>

    <span class="token comment"># 检查是否返回了错误</span>
    <span class="token keyword">if</span> <span class="token string">'error'</span> <span class="token keyword">in</span> weather_data<span class="token punctuation">:</span>
        <span class="token keyword">return</span> weather_data<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># 实时天气</span>
        realtime_weather <span class="token operator">=</span> weather_data<span class="token punctuation">[</span><span class="token string">'realtime'</span><span class="token punctuation">]</span>
        result <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"实时天气:"</span></span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span>  <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'info'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, 温度: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">℃, 湿度: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'humidity'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">%, 风向: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'direct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, 风力: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">级, AQI: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>realtime_weather<span class="token punctuation">[</span><span class="token string">'aqi'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token comment"># 未来几天的天气</span>
        result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string">"未来几天的天气:"</span>
        <span class="token keyword">for</span> day <span class="token keyword">in</span> weather_data<span class="token punctuation">[</span><span class="token string">'future'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> result <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> <span class="token string-interpolation"><span class="token string">f"日期: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>day<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, 天气: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>day<span class="token punctuation">[</span><span class="token string">'weather'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, 温度: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>day<span class="token punctuation">[</span><span class="token string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, 风向: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>day<span class="token punctuation">[</span><span class="token string">'direct'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token keyword">return</span> result
</code></pre> 
<p><strong>查询天气信息 <code>bot.py</code> 源码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os

<span class="token keyword">import</span> botpy
<span class="token keyword">from</span> botpy <span class="token keyword">import</span> logging
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>cog_yaml <span class="token keyword">import</span> read
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>message <span class="token keyword">import</span> GroupMessage
<span class="token keyword">from</span> plugins <span class="token keyword">import</span> weather_api

config <span class="token operator">=</span> read<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"config.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_log <span class="token operator">=</span> logging<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MyClient</span><span class="token punctuation">(</span>botpy<span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot 「</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>robot<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">」 on_ready!"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_group_at_message_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> GroupMessage<span class="token punctuation">)</span><span class="token punctuation">:</span>
        openid <span class="token operator">=</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>member_openid
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>openid<span class="token punctuation">}</span></span><span class="token string"> on_ready!"</span></span><span class="token punctuation">)</span>
        msg <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> msg<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"/天气"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            city_name <span class="token operator">=</span> msg<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"/天气"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> weather_api<span class="token punctuation">.</span>format_weather<span class="token punctuation">(</span>city_name<span class="token punctuation">)</span>
            <span class="token keyword">await</span> message<span class="token punctuation">.</span>_api<span class="token punctuation">.</span>post_group_message<span class="token punctuation">(</span>
                group_openid<span class="token operator">=</span>message<span class="token punctuation">.</span>group_openid<span class="token punctuation">,</span>
                msg_type<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                msg_id<span class="token operator">=</span>message<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    intents <span class="token operator">=</span> botpy<span class="token punctuation">.</span>Intents<span class="token punctuation">(</span>public_messages<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    client <span class="token operator">=</span> MyClient<span class="token punctuation">(</span>intents<span class="token operator">=</span>intents<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span>appid<span class="token operator">=</span>config<span class="token punctuation">[</span><span class="token string">"appid"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> secret<span class="token operator">=</span>config<span class="token punctuation">[</span><span class="token string">"secret"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行结果预览</strong></p> 
<p><img src="https://images2.imgbox.com/8e/47/TZ1ixrBI_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_328"></a>案例：配置关键词回复</h3> 
<p><strong>项目结构</strong></p> 
<pre><code class="prism language-python">bot<span class="token punctuation">.</span>py      					机器人主函数
plugins<span class="token operator">/</span>match_question<span class="token punctuation">.</span>py 		查询本地 excel 问答表插件
config<span class="token punctuation">.</span>yaml						机器人基本信息
关键词<span class="token punctuation">.</span>xlsx						关键词问答表
</code></pre> 
<p><img src="https://images2.imgbox.com/59/db/Qxg6PR7y_o.png" alt="在这里插入图片描述"></p> 
<p><strong><code>./plugins/match_question.py</code> 查询本地 excel 问答表</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> openpyxl <span class="token keyword">import</span> load_workbook

<span class="token comment"># 加载工作簿</span>
wb <span class="token operator">=</span> load_workbook<span class="token punctuation">(</span><span class="token string">'关键词.xlsx'</span><span class="token punctuation">)</span>
<span class="token comment"># 选择活动工作表，或者通过名称或索引选择其他工作表</span>
sheet <span class="token operator">=</span> wb<span class="token punctuation">.</span>active  <span class="token comment"># 或者 wb['Sheet1'] 或 wb.worksheets[0]</span>
question_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 遍历行和列（从第二行开始，假设第一行是标题）</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> sheet<span class="token punctuation">.</span>iter_rows<span class="token punctuation">(</span>min_row<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> values_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 添加 values_only=True 以只获取单元格的值</span>
    question <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"question"</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment"># 确保如果单元格为空，则使用空字符串</span>
        <span class="token string">"answer"</span><span class="token punctuation">:</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">else</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    question_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>question<span class="token punctuation">)</span>  <span class="token comment"># 添加创建的字典到列表中，而不是原始的 row</span>


<span class="token keyword">def</span> <span class="token function">match</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    匹配关键词
    :param word:
    :return:
    """</span>
    <span class="token keyword">for</span> question <span class="token keyword">in</span> question_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> word <span class="token keyword">in</span> question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> question<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> question <span class="token keyword">in</span> question_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> word <span class="token operator">==</span> question<span class="token punctuation">[</span><span class="token string">'question'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> question<span class="token punctuation">[</span><span class="token string">'answer'</span><span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token string">""</span>
</code></pre> 
<p><strong><code>bot.py</code> 源码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os

<span class="token keyword">import</span> botpy
<span class="token keyword">from</span> botpy <span class="token keyword">import</span> logging
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>cog_yaml <span class="token keyword">import</span> read
<span class="token keyword">from</span> botpy<span class="token punctuation">.</span>message <span class="token keyword">import</span> GroupMessage
<span class="token keyword">from</span> plugins <span class="token keyword">import</span> match_question

test_config <span class="token operator">=</span> read<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"config.yaml"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_log <span class="token operator">=</span> logging<span class="token punctuation">.</span>get_logger<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">MyClient</span><span class="token punctuation">(</span>botpy<span class="token punctuation">.</span>Client<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_ready</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot 「</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>robot<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">」 on_ready!"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">on_group_at_message_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">:</span> GroupMessage<span class="token punctuation">)</span><span class="token punctuation">:</span>
        openid <span class="token operator">=</span> message<span class="token punctuation">.</span>author<span class="token punctuation">.</span>member_openid
        _log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"robot </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>openid<span class="token punctuation">}</span></span><span class="token string"> on_ready!"</span></span><span class="token punctuation">)</span>
        msg <span class="token operator">=</span> message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> match_question<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
            result <span class="token operator">=</span> match_question<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token keyword">await</span> message<span class="token punctuation">.</span>_api<span class="token punctuation">.</span>post_group_message<span class="token punctuation">(</span>
                group_openid<span class="token operator">=</span>message<span class="token punctuation">.</span>group_openid<span class="token punctuation">,</span>
                msg_type<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                msg_id<span class="token operator">=</span>message<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                content<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>result<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    intents <span class="token operator">=</span> botpy<span class="token punctuation">.</span>Intents<span class="token punctuation">(</span>public_messages<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    client <span class="token operator">=</span> MyClient<span class="token punctuation">(</span>intents<span class="token operator">=</span>intents<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>run<span class="token punctuation">(</span>appid<span class="token operator">=</span>test_config<span class="token punctuation">[</span><span class="token string">"appid"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> secret<span class="token operator">=</span>test_config<span class="token punctuation">[</span><span class="token string">"secret"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行效果</strong></p> 
<p><img src="https://images2.imgbox.com/4d/8d/Ocf9PrTU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="requirementstxt__419"></a>requirements.txt 依赖</h3> 
<p>进入项目路径执行如下 cmd 命令，然后在当前目录是可以看到生成“requirements.txt”文件，可以打开看看，会发现有很多个包信息，其实这里是把你当前 python 环境的所有包的相关信息导出来了。</p> 
<p>pip freeze 是一个常用的 pip 命令，用于列出当前 Python 环境中已安装的所有包及其版本号。这个命令的输出通常被用于生成requirements.txt文件，该文件包含了项目运行所需的所有依赖项及其版本信息。这样，其他开发者或系统可以轻松地安装与项目兼容的依赖项版本。</p> 
<pre><code class="prism language-python">pip freeze <span class="token operator">&gt;</span> requirements<span class="token punctuation">.</span>txt
</code></pre> 
<p>如果我们只需导出当前项目所需的依赖包，我可以采用另外一种方式（只导出项目的依赖包）。</p> 
<p>pipreqs 是一个用于自动生成 Python 项目的依赖需求文件（requirements.txt）的工具。它可以根据项目中的import语句分析出项目所需的依赖包，并生成一个清单文件，方便其他人在不同环境中安装该项目所需的所有依赖包。</p> 
<pre><code class="prism language-python">pip install pipreqs

pipreqs <span class="token punctuation">.</span><span class="token operator">/</span>
</code></pre> 
<p><strong>本地演示</strong></p> 
<pre><code>pipreqs --force ./
INFO: Not scanning for jupyter notebooks.
WARNING: Import named "openai" not found locally. Trying to resolve it at the PyPI server.
WARNING: Import named "openai" was resolved to "openai:1.34.0" package (https://pypi.org/project/openai/).
Please, verify manually the final list of requirements.txt to avoid possible dependency confusions.
WARNING: Import named "python-dotenv" not found locally. Trying to resolve it at the PyPI server.
WARNING: Import named "python-dotenv" was resolved to "python-dotenv:1.0.1" package (https://pypi.org/project/python-dotenv/).
Please, verify manually the final list of requirements.txt to avoid possible dependency confusions.
WARNING: Import named "Requests" not found locally. Trying to resolve it at the PyPI server.
WARNING: Import named "Requests" was resolved to "requests:2.32.3" package (https://pypi.org/project/requests/).
Please, verify manually the final list of requirements.txt to avoid possible dependency confusions.
INFO: Successfully saved requirements file in ./requirements.txt
</code></pre> 
<blockquote> 
 <p>注意：如果已经有 <code>requirements.txt</code>，需要使用 <code>pipreqs --force ./</code> 稍等一会就可以导出成功。</p> 
</blockquote> 
<h3><a id="Ubantu__455"></a>Ubantu 服务器部署</h3> 
<p><strong>ubantu 安装 python 环境</strong></p> 
<p>首先，确保你的Ubuntu系统已更新到最新版本。然后，你可以通过以下步骤安装 Python 3（推荐安装 Python 3.x 版本，因为 Python 2.x 已经停止维护）在终端中输入以下命令并输入你的密码来更新软件包列表：</p> 
<pre><code class="prism language-python">sudo apt update
</code></pre> 
<p>安装Python 3：在终端中输入以下命令并按下 Enter 键来安装Python 3：</p> 
<pre><code class="prism language-python">sudo apt install python3
</code></pre> 
<p>安装过程中，系统会提示你确认安装，输入Y并按下Enter键开始安装过程。验证Python安装：安装完成后，你可以通过输入以下命令来验证Python是否已成功安装：</p> 
<pre><code class="prism language-python">python3 <span class="token operator">-</span><span class="token operator">-</span>version
</code></pre> 
<blockquote> 
 <p>提示：如果成功安装，系统将显示已安装的Python版本号。</p> 
</blockquote> 
<p>在 Ubuntu 系统上安装 Python 环境，通常包括安装 Python 本身以及可能需要的 Python 包管理工具 pip，还可以进一步设置 Python 的虚拟环境。</p> 
<pre><code>root@ser542134727854:/home/guild-bot-server# pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

Command 'pip3' not found, but can be installed with:

apt install python3-pip
</code></pre> 
<p><strong>安装依赖环境</strong></p> 
<pre><code>pip install -r requirements.txt -i -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p><strong>运行 bot.py 程序</strong></p> 
<pre><code>nohup python3 bot.py &amp;
</code></pre> 
<p><img src="https://images2.imgbox.com/1c/5a/aG9FANnh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Centos__499"></a>Centos 服务器部署</h3> 
<p><strong>选择要安装python的目录，获取下载最新python的安装压缩包：</strong></p> 
<pre><code class="prism language-python">cd <span class="token operator">/</span>home<span class="token operator">/</span>python

wget https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>python<span class="token punctuation">.</span>org<span class="token operator">/</span>ftp<span class="token operator">/</span>python<span class="token operator">/</span><span class="token number">3.10</span><span class="token number">.2</span><span class="token operator">/</span>Python<span class="token operator">-</span><span class="token number">3.10</span><span class="token number">.2</span><span class="token punctuation">.</span>tgz
</code></pre> 
<p><strong>下载完成后解压缩：</strong><br> <img src="https://images2.imgbox.com/98/e8/zlKwkz5R_o.png" alt="在这里插入图片描述"><br> 说明：tar是Linux系统的解压命令，这句话是把文件解压到文件所在的文件夹。如果是土星话操作界面可以向在WIN上一样解压文件。同样也可以像在win上一样下载Python源文件放置在指定文件夹。</p> 
<pre><code class="prism language-python">tar <span class="token operator">-</span>zxvf Python<span class="token operator">-</span><span class="token number">3.10</span><span class="token number">.2</span><span class="token punctuation">.</span>tgz
</code></pre> 
<p><strong>进入解压缩后的目录，安装配置：</strong></p> 
<pre><code class="prism language-python">cd Python<span class="token operator">-</span><span class="token number">3.10</span><span class="token number">.2</span><span class="token operator">/</span>
<span class="token punctuation">.</span><span class="token operator">/</span>configure 
</code></pre> 
<p>执行 ./configure 时，如果报错：configure: error: no acceptable C compiler found in $PATH</p> 
<p>说明没有安装合适的编译器。这时，需要安装/升级 gcc 及其它依赖包。</p> 
<pre><code class="prism language-python">sudo apt<span class="token operator">-</span>get install make gcc gcc<span class="token operator">-</span>c<span class="token operator">+</span><span class="token operator">+</span> 
</code></pre> 
<p><strong>安装编译Python3源文件所需的编译环境</strong></p> 
<pre><code class="prism language-python">$ yum install <span class="token operator">-</span>y gcc  
$ yum install <span class="token operator">-</span>y zlib<span class="token operator">*</span>
$ yum <span class="token operator">-</span>y install zlib<span class="token operator">-</span>devel bzip2<span class="token operator">-</span>devel openssl<span class="token operator">-</span>devel ncurses<span class="token operator">-</span>devel sqlite<span class="token operator">-</span>devel readline<span class="token operator">-</span>devel tk<span class="token operator">-</span>devel gdbm<span class="token operator">-</span>devel db4<span class="token operator">-</span>devel libpcap<span class="token operator">-</span>devel xz<span class="token operator">-</span>devel  
</code></pre> 
<p>说明：这里功能很简单，要说的是yum命令。虽然linux也可以像win上一样在指定的软件的官网下载软件，但是有一些常用且公用的软件会被放置在特定的远程仓库里面，可以通过使用yum命令来安装。而且yum命令还可以主动帮用户解决软件的依赖问题。所以想要学好linux的话了解一下yum也是必须的。此外还有anaconda也是类似的软件。</p> 
<p><strong>进入Python3 源文件文件夹</strong></p> 
<pre><code class="prism language-python">cd Python<span class="token operator">-</span><span class="token number">3.10</span><span class="token number">.2</span><span class="token operator">/</span>  
</code></pre> 
<p><strong>指定安装python的目录</strong>：说明：不要忘记最前面的“.”，如下所示：<code>/usr/local/python3</code>就是安装的目录</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token operator">/</span>configure <span class="token operator">-</span><span class="token operator">-</span>prefix<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3 <span class="token operator">-</span><span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>ssl  
</code></pre> 
<p><strong>编译源文件，正式安装</strong></p> 
<pre><code class="prism language-python">make
make install
</code></pre> 
<p><strong>建立软连接（配置环境变量）</strong></p> 
<pre><code class="prism language-python">$ ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python3 <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python3 
$ ln <span class="token operator">-</span>s <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>python3<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>pip3 <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>pip3 
</code></pre> 
<blockquote> 
 <p>在执行ln -s /usr/python/bin/python3(python 安装目录) /usr/bin/python<br> 的时候有可能会报错</p> 
</blockquote> 
<p>报错信息如下：</p> 
<pre><code class="prism language-python">ln<span class="token punctuation">:</span> failed to create symbolic link <span class="token string">'/usr/bin/python'</span><span class="token punctuation">:</span> File exists
</code></pre> 
<p>解决方法：ln -sf 加一个 f 即可</p> 
<pre><code class="prism language-python">ln <span class="token operator">-</span>sf   <span class="token operator">/</span>usr<span class="token operator">/</span>python<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python3<span class="token punctuation">(</span>python 安装目录<span class="token punctuation">)</span>  <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>python
</code></pre> 
<p>建立软连接说明：</p> 
<p>很多教程都有最后一步，但是很少有网站会告诉你为什么会有最后一步。所谓软连接就相当于win下的快捷方式。</p> 
<p>你可以通过快捷方式打开你想要使用的软件。但是为什么要把快捷方式放在/usr/bin/呢。这就涉及到环境变量的问题了，你当然可以不使用最后的软连接而直接把/usr/local/python3/bin加到环境变量里面，那随你喜好。</p> 
<p>但是在这里/usr/bin/是默认已经在环境变量里面的，把快捷方式放到这个文件夹相当于间接的把该Python3加入环境变量，这样你才可以直接在终端输入“python3”打开Python。</p> 
<p><strong>运行 bot.py 程序</strong></p> 
<pre><code>nohup python3 bot.py &amp;
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/99920cbc009129251dc0df6ed3768f29/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言详解（动态内存管理）2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/693faff87cfbb062e0462cc1298f5969/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在VSCode中使用Vim</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>