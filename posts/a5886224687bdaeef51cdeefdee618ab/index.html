<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>电子科技大学-数据库系统-期末汇总-完全体（概念&#43;图片&#43;习题&#43;代码） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a5886224687bdaeef51cdeefdee618ab/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="电子科技大学-数据库系统-期末汇总-完全体（概念&#43;图片&#43;习题&#43;代码）">
  <meta property="og:description" content="写在前面 从2023年开始，学院对各课程考核题型形式提出了统一要求，取消单选题、判断题的测试形式，更多采用综合考核能力的题型形式。
所用教材：数据库系统原理
本篇博客主要记录的是老师PPT上的重点。个人复习使用，仅供参考。由于某些老师后来给画了重点，就又删减了少许。
对于电子科大的朋友，如果你们任课老师给了复习要点，跟着复习要点有针对性的复习就行。
完整MARKDOWN文件
一、数据库及其系统概念 了解数据库、数据库管理系统、数据库系统等基本概念理解数据模型与数据库类型关系熟悉数据库系统组成及其各部分作用 数据库：按特定数据模型组织存储管理数据的文件集合
特点
数据不重复支持并发数据结构独立于应用程序数据的增删改查由数据库系统管理软件管理 数据模型：事物对象数据特征结构的形式化表示，包括数据结构、数据操作、数据约束
数据结构：对象静态特征
数据操作：对象动态特征
数据约束：数据结构中数据之间的联系制约关系，数据动态变化的规则
数据模型-关系数据模型：采用“二维表”结构组织、存储和管理数据，并以关联列实现表之间的联系。
数据库系统（DS）
数据库应用程序：在DBMS支持下对数据库中数据进行访问处理
关系数据库数据内容：用户表（用户数据），系统表（元数据、索引数据、运行数据）
关系数据库对象组织：
用户表：存储用户的应用数据系统表：存储数据库系统自身数据视图：通过虚拟表实现数据查询处理索引：通过目录数据结构支持快速的数据查询约束：对关系表及其数据施加规则存储过程：在数据库内部实现特定功能程序的数据处理触发器：在数据库内部实现数据操作事件触发自动执行的过程程序 二、关系模型 2.1 关系相关概念 键：关系中可以唯一标识元组的属性列，其他的为非键列
候选键：多个列都可以作为键时，它们每一个均为候选键
主键：候选键中最具代表性的，唯一
复合键：关系中必须用多列才能唯一标识元组时，为复合主键
代理键：DBMS自动生成的数字序列主键，可替代复合主键
外键：关系中的关键字为另一个关系的主键，此时称该关系为另一个关系的从表
关系模式：关系名（主键属性，属性2，…，属性x）
2.2 关系模型原理 数据模型-关系模型：基于二维表结构存储数据实体及实体间联系
关系模型数据操作
集合：选择（select）、投影（project）、连接（join）、交（intersection）、并（union）、差（difference）
元组：行插入（Insert）、 修改（Update）、删除（Delete）
交并差：关系R与关系S需有相同属性组成（简单不赘述）
笛卡尔积×：R的属性列&#43;S的属性列=新表属性列，元组进行排列组合
选择：σF®：在关系R中选出满足条件F的元组形成新的关系。(F：条件表达式)；对应where子句
投影：πA（R）：在R中选出若干属性列组成一个新关系。(A:属性组)；对应select子句
连接：从两个关系的笛卡尔积中选取属性间满足条件AθB的元组组成新的关系
条件连接
等值连接-条件连接的特例：选取指定属性列的值相等的行，可以选择多个条件
SELECT 列表 FROM 表1 JOIN 表2 ON 表1.列 = 表2.列; 自然连接-等值连接的特例：根据两个表中的所有相同属性列进行连接，连接后多个的相同属性列只保留一个
SELECT 列表 FROM 表1 NATURAL JOIN 表2; 外连接-自然连接的特例：自然连接只有相同属性列的值相同才返回，外连接中若有一方的行的共同属性列没有找到与之匹配的行，则也保留该行，以NULL填充。左外连接、右外连接、全外连接
除（了解；t代表元组、XY代表属性）
关系模型完整性约束：实体完整性约束（主键非空且不唯一）、参照完整性约束（主从表的外键主键一致）、用户自定义完整性约束
三、SQL语句 3.1 sql概述 数据定义语言（DDL）：创建修改删除数据库对象；create/drop/alter database/table/index">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-26T15:32:48+08:00">
    <meta property="article:modified_time" content="2024-02-26T15:32:48+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">电子科技大学-数据库系统-期末汇总-完全体（概念&#43;图片&#43;习题&#43;代码）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>写在前面</h3> 
<p>从2023年开始，学院对各课程考核题型形式提出了统一要求，取消单选题、判断题的测试形式，更多采用综合考核能力的题型形式。</p> 
<p>所用教材：数据库系统原理<br> 本篇博客主要记录的是老师PPT上的重点。个人复习使用，仅供参考。由于某些老师后来给画了重点，就又删减了少许。<br> 对于电子科大的朋友，如果你们任课老师给了复习要点，跟着复习要点有针对性的复习就行。</p> 
<p><a href="https://download.csdn.net/download/qq_63865335/87865886">完整MARKDOWN文件</a></p> 
<h3><a id="_11"></a>一、数据库及其系统概念</h3> 
<blockquote> 
 <ul><li>了解数据库、数据库管理系统、数据库系统等基本概念</li><li>理解数据模型与数据库类型关系</li><li>熟悉数据库系统组成及其各部分作用</li></ul> 
</blockquote> 
<p>数据库：按特定数据模型组织存储管理数据的文件集合</p> 
<p>特点</p> 
<ul><li>数据不重复</li><li>支持并发</li><li>数据结构独立于应用程序</li><li>数据的增删改查由数据库系统管理软件管理</li></ul> 
<p>数据模型：事物对象数据特征结构的形式化表示，包括数据结构、数据操作、数据约束</p> 
<p>数据结构：对象静态特征</p> 
<p>数据操作：对象动态特征</p> 
<p>数据约束：数据结构中数据之间的联系制约关系，数据动态变化的规则</p> 
<p>数据模型-关系数据模型：采用“二维表”结构组织、存储和管理数据，并以关联列实现表之间的联系。<br> <img src="https://images2.imgbox.com/6a/33/pJv91q6t_o.png" alt="在这里插入图片描述"></p> 
<p>数据库系统（DS）</p> 
<p>数据库应用程序：在DBMS支持下对数据库中数据进行访问处理</p> 
<p>关系数据库数据内容：用户表（用户数据），系统表（元数据、索引数据、运行数据）</p> 
<p>关系数据库对象组织：</p> 
<ul><li>用户表：存储用户的应用数据</li><li>系统表：存储数据库系统自身数据</li><li>视图：通过虚拟表实现数据查询处理</li><li>索引：通过目录数据结构支持快速的数据查询</li><li>约束：对关系表及其数据施加规则</li><li>存储过程：在数据库内部实现特定功能程序的数据处理</li><li>触发器：在数据库内部实现数据操作事件触发自动执行的过程程序</li></ul> 
<h3><a id="_53"></a>二、关系模型</h3> 
<h4><a id="21__55"></a>2.1 关系相关概念</h4> 
<p>键：关系中可以唯一标识元组的属性列，其他的为非键列</p> 
<p>候选键：多个列都可以作为键时，它们每一个均为候选键</p> 
<p>主键：候选键中最具代表性的，唯一</p> 
<p>复合键：关系中必须用多列才能唯一标识元组时，为复合主键</p> 
<p>代理键：DBMS自动生成的数字序列主键，可替代复合主键</p> 
<p>外键：关系中的关键字为另一个关系的主键，此时称该关系为另一个关系的从表</p> 
<p>关系模式：关系名（<u>主键属性</u>，属性2，…，属性x）</p> 
<h4><a id="22__71"></a>2.2 关系模型原理</h4> 
<p>数据模型-关系模型：基于二维表结构存储数据实体及实体间联系</p> 
<p>关系模型数据操作</p> 
<p>集合：选择（select）、投影（project）、连接（join）、交（intersection）、并（union）、差（difference）</p> 
<p>元组：行插入（Insert）、 修改（Update）、删除（Delete）</p> 
<p>交并差：关系R与关系S需有相同属性组成（简单不赘述）</p> 
<p>笛卡尔积×：R的属性列+S的属性列=新表属性列，元组进行排列组合</p> 
<p>选择：σF®：在关系R中选出满足条件F的元组形成新的关系。(F：条件表达式)；对应where子句</p> 
<p>投影：πA（R）：在R中选出若干属性列组成一个新关系。(A:属性组)；对应select子句</p> 
<p>连接：从两个关系的笛卡尔积中选取属性间满足条件AθB的元组组成新的关系</p> 
<p>条件连接</p> 
<p><img src="https://images2.imgbox.com/65/d3/ttlt79s7_o.png" alt="img"></p> 
<p>等值连接-条件连接的特例：选取指定属性列的值相等的行，可以选择多个条件</p> 
<p><img src="https://images2.imgbox.com/f8/11/kZTqPRkv_o.png" alt="img"></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 列表
<span class="token keyword">FROM</span> 表<span class="token number">1</span>
<span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 表<span class="token number">1.</span>列 <span class="token operator">=</span> 表<span class="token number">2.</span>列<span class="token punctuation">;</span>
</code></pre> 
<p>自然连接-等值连接的特例：根据两个表中的所有相同属性列进行连接，连接后多个的相同属性列只保留一个</p> 
<p><img src="https://images2.imgbox.com/79/22/4KRfa7sq_o.png" alt="img"></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 列表
<span class="token keyword">FROM</span> 表<span class="token number">1</span>
<span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p>外连接-自然连接的特例：自然连接只有相同属性列的值相同才返回，外连接中若有一方的行的共同属性列没有找到与之匹配的行，则也保留该行，以NULL填充。左外连接、右外连接、全外连接</p> 
<p>除（了解；t代表元组、XY代表属性）</p> 
<p><img src="https://images2.imgbox.com/0c/d3/eJPq0Mtk_o.png" alt="img"></p> 
<p>关系模型完整性约束：实体完整性约束（主键非空且不唯一）、参照完整性约束（主从表的外键主键一致）、用户自定义完整性约束</p> 
<h3><a id="SQL_123"></a>三、SQL语句</h3> 
<h4><a id="31_sql_125"></a>3.1 sql概述</h4> 
<p>数据定义语言（DDL）：创建修改删除数据库对象；create/drop/alter database/table/index</p> 
<p>数据操纵语言（DML）：增删改数据；insert/update/delete</p> 
<p>数据查询语言（DQL）：数据查询；</p> 
<p>数据控制语言（DCL）：数据库对象访问控制；grant/deny/revoke</p> 
<p>事物处理语言（TPL）：事物处理；begin transaction/commit/rollback</p> 
<p>游标控制语言（CCL）：游标操作；declare cursor/fetch into/close cursor</p> 
<h4><a id="32__139"></a>3.2 数据定义语句</h4> 
<h5><a id="_141"></a>数据库</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> CourseDB<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> CourseDB <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> CourseManageDB<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> CourseManageDB；
</code></pre> 
<h5><a id="_151"></a>数据库表</h5> 
<p>格式：列名+数据类型+列完整性约束</p> 
<p>列完整行约束</p> 
<p>PRIMARY KEY——单列主键</p> 
<p>NOT NULL——非空值</p> 
<p>NULL——空值</p> 
<p>UNIQUE——值唯一</p> 
<p>CHECK——有效性检查</p> 
<p>DEFAULT——缺省值</p> 
<p>表约束：可定义复合主键、代理键、外键，可以命名约束</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  Student
<span class="token punctuation">(</span>StudentID      <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>    <span class="token keyword">PRIMARY</span>  <span class="token keyword">KEY</span><span class="token punctuation">,</span>
 StudentName    <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>	<span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span>
 StudentGender  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>     <span class="token boolean">NULL</span>     <span class="token keyword">CHECK</span><span class="token punctuation">(</span>StudentGender <span class="token operator">IN</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 BirthDay       <span class="token keyword">date</span>        <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 Major          <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>     <span class="token keyword">DEFAULT</span> <span class="token string">'本科生'</span><span class="token punctuation">,</span>
 StudentPhone	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>    <span class="token boolean">NULL</span>
 <span class="token comment">--或者</span>
 <span class="token keyword">CONSTRAINT</span> Student_PK <span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>StudentID<span class="token punctuation">,</span>StudentName<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">ADD</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span><span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">RENAME</span> <span class="token keyword">TO</span><span class="token operator">&lt;&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">RENAME</span> <span class="token operator">&lt;&gt;</span> <span class="token keyword">TO</span> <span class="token operator">&lt;&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> STUDENT <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span><span class="token operator">&lt;&gt;</span> <span class="token keyword">TYPE</span><span class="token operator">&lt;&gt;</span><span class="token punctuation">;</span>
 
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token operator">&lt;&gt;</span><span class="token punctuation">;</span>
</code></pre> 
<p>表约束定义代理键：有时为了方便数据处理，可以使用代理键去替代复合主键</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  <span class="token keyword">Plan</span>
<span class="token punctuation">(</span> CoursePlanID	<span class="token keyword">serial</span>		    <span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  CourseID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  TeacherID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  CourseRoom  	<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  CourseTime  	<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Note  		<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span>	CoursePlan_PK	<span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>


</code></pre> 
<p>表约束定义外键</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span>  <span class="token keyword">TABLE</span>  Register
<span class="token punctuation">(</span> CourseRegID  	<span class="token keyword">serial</span>	    <span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  CoursePlanID  <span class="token keyword">Int</span>  		<span class="token operator">NOT</span>  <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  StudentID  	<span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Note  		<span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span>	CourseRegID_PK	<span class="token keyword">PRIMARY</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CourseRegID<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span>	CoursePlanID_FK	<span class="token keyword">FOREIGN</span> <span class="token keyword">Key</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span>
	<span class="token keyword">REFERENCES</span>  <span class="token keyword">Plan</span><span class="token punctuation">(</span>CoursePlanID<span class="token punctuation">)</span>
    <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">,</span>
  <span class="token keyword">CONSTRAINT</span>	StudentID_FK	<span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>StudentID<span class="token punctuation">)</span>
	<span class="token keyword">REFERENCES</span>  Student<span class="token punctuation">(</span>StudentID<span class="token punctuation">)</span>
    <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h5><a id="_230"></a>数据库索引</h5> 
<p>索引（index）：将关系表按照指定列的取值顺序组织元组数据的数据结构，加快查询，占用额外存储空间、开销较大</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> Birthday_Idx <span class="token keyword">ON</span>  STUDENT<span class="token punctuation">(</span>Birthday<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">INDEX</span> Birthday_Idx <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> Bday_Idx<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> bday_idx<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="33__242"></a>3.3 数据操纵语句</h4> 
<h5><a id="_244"></a>数据插入</h5> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2017220101105'</span><span class="token punctuation">,</span><span class="token string">'柳因'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'1999-04-23'</span><span class="token punctuation">,</span><span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token string">'liuyin@163.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_250"></a>数据修改</h5> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span>  Student
<span class="token keyword">SET</span>  Email<span class="token operator">=</span><span class="token string">'zhaodong@163.com'</span>
<span class="token keyword">WHERE</span>   StudentName<span class="token operator">=</span><span class="token string">'赵东'</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_258"></a>数据删除</h5> 
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> 
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">WHERE</span>   StudentName<span class="token operator">=</span><span class="token string">'张亮'</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="34__266"></a>3.4 数据查询语句</h4> 
<h5><a id="_268"></a>单表查询</h5> 
<pre><code class="prism language-sql"><span class="token comment">-- 通用结构</span>
<span class="token keyword">SELECT</span>  <span class="token punctuation">[</span><span class="token keyword">ALL</span><span class="token operator">|</span><span class="token keyword">DISTINCT</span><span class="token punctuation">]</span>  <span class="token operator">&lt;</span>目标列<span class="token operator">&gt;</span><span class="token punctuation">[</span>，<span class="token operator">&lt;</span>目标列<span class="token operator">&gt;</span>…<span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">INTO</span> <span class="token operator">&lt;</span>新表<span class="token operator">&gt;</span> <span class="token punctuation">]</span>
<span class="token keyword">FROM</span>  <span class="token operator">&lt;</span>表名<span class="token operator">|</span>视图名<span class="token operator">&gt;</span><span class="token punctuation">[</span>，<span class="token operator">&lt;</span>表名<span class="token operator">|</span>视图名<span class="token operator">&gt;</span>…<span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">WHERE</span>  <span class="token operator">&lt;</span>条件表达式<span class="token operator">&gt;</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>  <span class="token operator">&lt;</span>列名<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span> <span class="token operator">&lt;</span>条件表达式<span class="token operator">&gt;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>  <span class="token operator">&lt;</span>列名<span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">-- BETWEEN AND 限制列值范围</span>
<span class="token keyword">SELECT</span>  <span class="token operator">*</span>
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">WHERE</span> BirthDay <span class="token operator">BETWEEN</span> ‘<span class="token number">2000</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span>’ <span class="token operator">AND</span> ‘<span class="token number">2000</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">30</span>’<span class="token punctuation">;</span>

<span class="token comment">-- LIKE 通配符'_'代表一个字符'%'代表一个或多个字符 </span>
<span class="token keyword">SELECT</span>  <span class="token operator">*</span>
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">WHERE</span>  Email  <span class="token operator">LIKE</span>  ’<span class="token operator">%</span><span class="token variable">@163.com</span>’<span class="token punctuation">;</span>

<span class="token comment">-- AND\OR\NOT 逻辑运算符</span>
<span class="token keyword">SELECT</span>  StudentID<span class="token punctuation">,</span> StudentName<span class="token punctuation">,</span> StudentGender<span class="token punctuation">,</span> Major
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">WHERE</span>  Major<span class="token operator">=</span>’软件工程’  <span class="token operator">AND</span>  StudentGender<span class="token operator">=</span>’男’<span class="token punctuation">;</span>

<span class="token comment">-- IN 限定范围</span>
<span class="token keyword">SELECT</span>  StudentID<span class="token punctuation">,</span> StudentName<span class="token punctuation">,</span> StudentGender<span class="token punctuation">,</span> Major
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">WHERE</span>  Major <span class="token operator">IN</span>  <span class="token punctuation">(</span><span class="token string">'计算机应用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- ORDER BY &lt;&gt; ASC/DESC 默认升序ASC</span>
<span class="token comment">-- 多个列排序时，写在前面排序的基础上满足后面的</span>
<span class="token keyword">SELECT</span>  <span class="token operator">*</span>
<span class="token keyword">FROM</span>  STUDENT
<span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  Birthday <span class="token keyword">DESC</span> <span class="token punctuation">,</span>  StudentName  <span class="token keyword">ASC</span><span class="token punctuation">;</span>

<span class="token comment">-- 内置函数</span>
<span class="token keyword">SELECT</span>  COUNT（<span class="token operator">*</span>） <span class="token keyword">AS</span>  学生人数
<span class="token keyword">FROM</span>  Student<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span>  Min（Birthday） <span class="token keyword">AS</span> 最大年龄，Max（Birthday） <span class="token keyword">AS</span> 最小年龄
<span class="token keyword">FROM</span>  Student<span class="token punctuation">;</span>

<span class="token comment">-- GROUP BY &lt;&gt; HAVING </span>
<span class="token comment">-- 专业统计STUDENT表中男生人数，但限定只显示人数大于2的人数</span>
<span class="token keyword">SELECT</span>  Major  <span class="token keyword">AS</span> 专业<span class="token punctuation">,</span>  COUNT（StudentID） <span class="token keyword">AS</span> 学生人数
<span class="token keyword">FROM</span>  Student
<span class="token keyword">WHERE</span>  StudentGender<span class="token operator">=</span>’男’
<span class="token keyword">GROUP</span>  <span class="token keyword">BY</span>  Major
<span class="token keyword">HAVING</span>  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_320"></a>多表关联查询</h5> 
<p>子查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>  TeacherID<span class="token punctuation">,</span> TeacherName<span class="token punctuation">,</span> TeacherTitle
<span class="token keyword">FROM</span>  Teacher
<span class="token keyword">WHERE</span>  CollegeID  <span class="token operator">IN</span>
        <span class="token punctuation">(</span><span class="token keyword">SELECT</span>  CollegeID  
     <span class="token keyword">FROM</span>  College
     <span class="token keyword">WHERE</span>  CollegeName<span class="token operator">=</span><span class="token string">'计算机学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>连接查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>  B<span class="token punctuation">.</span>CollegeName <span class="token keyword">AS</span> 学院名称<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherID  <span class="token keyword">AS</span> 编号<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherName  <span class="token keyword">AS</span> 姓名<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherGender  <span class="token keyword">AS</span> 性别<span class="token punctuation">,</span>  A<span class="token punctuation">.</span> TeacherTitle  <span class="token keyword">AS</span> 职称
<span class="token keyword">FROM</span>  Teacher  <span class="token keyword">AS</span>  A，College  <span class="token keyword">AS</span>  B
<span class="token keyword">WHERE</span>  A<span class="token punctuation">.</span>CollegeID<span class="token operator">=</span>B<span class="token punctuation">.</span>CollegeID 
<span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  B<span class="token punctuation">.</span>CollegeName<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherID<span class="token punctuation">;</span>

<span class="token comment">-- JOIN ON 内连接</span>
<span class="token keyword">SELECT</span>  B<span class="token punctuation">.</span>CollegeName <span class="token keyword">AS</span> 学院名称<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherID  <span class="token keyword">AS</span> 编号<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherName  <span class="token keyword">AS</span> 姓名<span class="token punctuation">,</span>  A<span class="token punctuation">.</span>TeacherGender  <span class="token keyword">AS</span> 性别<span class="token punctuation">,</span>  A<span class="token punctuation">.</span> TeacherTitle  <span class="token keyword">AS</span> 职称
<span class="token keyword">FROM</span>  TEACHER  <span class="token keyword">AS</span>  A  <span class="token keyword">JOIN</span>  COLLEGE  <span class="token keyword">AS</span>  B
<span class="token keyword">ON</span>  A<span class="token punctuation">.</span>CollegeID<span class="token operator">=</span>B<span class="token punctuation">.</span>CollegeID 
<span class="token keyword">ORDER</span>  <span class="token keyword">BY</span>  B<span class="token punctuation">.</span>CollegeName<span class="token punctuation">,</span> A<span class="token punctuation">.</span>TeacherID<span class="token punctuation">;</span>

<span class="token comment">-- LEFT JOIN/RIGHT JOIN/FULL JOIN 外连接</span>
<span class="token keyword">SELECT</span> C<span class="token punctuation">.</span>CourseName <span class="token keyword">AS</span> 课程名称<span class="token punctuation">,</span> T<span class="token punctuation">.</span>TeacherName <span class="token keyword">AS</span> 教师<span class="token punctuation">,</span> 
<span class="token function">COUNT</span>  <span class="token punctuation">(</span>R<span class="token punctuation">.</span>CoursePlanID<span class="token punctuation">)</span>  <span class="token keyword">AS</span> 选课人数
<span class="token keyword">FROM</span>  COURSE  <span class="token keyword">AS</span>  C  <span class="token keyword">JOIN</span>  <span class="token keyword">PLAN</span>  <span class="token keyword">AS</span>  P  
<span class="token keyword">ON</span>  C<span class="token punctuation">.</span>CourseID<span class="token operator">=</span>P<span class="token punctuation">.</span>CourseID 
<span class="token keyword">JOIN</span>  TEACHER  <span class="token keyword">AS</span>  T  <span class="token keyword">ON</span>  P<span class="token punctuation">.</span>TeacherID<span class="token operator">=</span>T<span class="token punctuation">.</span>TeacherID
<span class="token keyword">LEFT</span>  <span class="token keyword">JOIN</span>  REGISTER  <span class="token keyword">AS</span>  R  <span class="token keyword">ON</span>  P<span class="token punctuation">.</span>CoursePlanID<span class="token operator">=</span>R<span class="token punctuation">.</span>CoursePlanID
<span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> C<span class="token punctuation">.</span>CourseName<span class="token punctuation">,</span> T<span class="token punctuation">.</span>TeacherName<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_358"></a>四、数据库设计</h3> 
<h4><a id="41__360"></a>4.1 概述</h4> 
<h5><a id="_362"></a>数据库开发过程</h5> 
<p><img src="https://images2.imgbox.com/94/68/7R0M2FnO_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_366"></a>数据库结构模型设计-数据库结构模型</h5> 
<table><thead><tr><th>概念数据模型 Conceptual Data Model (CDM)</th><th align="left">从用户角度所建模的系统数据对象及其关系，它帮助用户分析信息系统的数据结构关系。</th></tr></thead><tbody><tr><td>逻辑数据模型 Logic Data Mode(LDM)</td><td align="left">从系统分析员角度所建模的系统数据对象逻辑结构关系，它帮助开发人员分析信息系统的逻辑数据结构。</td></tr><tr><td>物理数据模型 Physical Data Model (PDM)</td><td align="left">从系统设计人员角度所建模的系统数据物理存储及结构关系，它针对设计者具体定义信息系统的数据库表结构。</td></tr></tbody></table> 
<h4><a id="42_ER_373"></a>4.2 E-R模型方法</h4> 
<blockquote> 
 <p>“实体-联系模型”（Entity-Relationship Model）的简称。它是一种描述现实世界<strong>概念数据模型</strong>、<strong>逻辑数据模型</strong>的有效方法，基本元素有实体、属性、标识符和联系</p> 
</blockquote> 
<p>联系度数：联系中关联的实体数目</p> 
<p>二元联系-基数：实体的实例与另一实体实例存在的数量对应关系，1/n，表示最大基数</p> 
<p>实体参与关系：可选/强制，表示最小基数</p> 
<p><img src="https://images2.imgbox.com/a8/0c/Zy0ZjXa6_o.png" alt="在这里插入图片描述"></p> 
<p>实体继承联系：表示实体的相似性，有公共属性的是父实体，有特殊性的是子实体</p> 
<p><img src="https://images2.imgbox.com/03/8b/nKFuYepo_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ee/d7/wwAVZblV_o.png" alt="在这里插入图片描述"></p> 
<p>强弱实体联系：弱实体的存在必须以强实体的存在为前提，这是一个相对的概念</p> 
<p><img src="https://images2.imgbox.com/c3/30/DayVcApq_o.png" alt="在这里插入图片描述"></p> 
<p>扩展建模实例</p> 
<p><img src="https://images2.imgbox.com/79/d8/QWUhbYWn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="43__403"></a>4.3 数据库建模设计</h4> 
<h5><a id="_405"></a>概念数据模型</h5> 
<p>概念数据模型设计一般是采用E-R模型方法进行建模设计</p> 
<h5><a id="CDMLDMPDM_408"></a>CDM/LDM/PDM模型转换设计</h5> 
<p>当使用关系数据库时，物理数据模型（PDM）即为关系模型。CDM/LDM到PDM的转换其实就是E-R模型到关系模型的转换。</p> 
<p><img src="https://images2.imgbox.com/b7/82/zq7zucP1_o.png" alt="在这里插入图片描述"></p> 
<p>CDM/LDM转换</p> 
<ol><li>LDM将CDM的多对多实体联系转化为易于关系数据库实现的一对多实体联系</li><li>LDm将CDM中的标识符依赖实体进一步细化，并区分主键标识符&lt; pi &gt;和外键标识符&lt; fi &gt;，以便数据模型规范化处理</li></ol> 
<p>E-R模型到关系模型转换原理：</p> 
<ol><li>将每一个实体转换成一个关系表，实体属性转换为关系表的列，实体标识符转换为关系表的主键或外键。</li><li>将实体之间的联系转化为关系表之间的参照完整性约束。</li></ol> 
<p>弱实体转换为关系表</p> 
<p><img src="https://images2.imgbox.com/8d/79/rTSxMKO7_o.png" alt="在这里插入图片描述"></p> 
<p>实体联系转换</p> 
<p><img src="https://images2.imgbox.com/a1/66/H6gtMg0I_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/2f/8mYZTLkU_o.png" alt="在这里插入图片描述"></p> 
<p>实体继承联系转换</p> 
<p>将父表中的主键放置到子表中，既做主键又做外键。</p> 
<p>实体递归联系转换</p> 
<p><img src="https://images2.imgbox.com/9d/5d/RU4mOooI_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="44__444"></a>4.4 数据库规范化设计</h4> 
<p>通常在LDM时期进行规范化设计完善，减少冗余数据，设计合理依赖约束关系，降低维护数据完整性一致性的工作量，访问更高效</p> 
<p>问题：一个表中存在多个主题的数据，且大量重复出现</p> 
<h5><a id="_450"></a>函数依赖理论</h5> 
<blockquote> 
 <p>在关系模式R（U）中， U 为关系R的属性集合，X和Y为属性U的子集。设t，s是关系R中的任意两个元组，如果t[X] = s[X]，则t[Y] = s[Y]。那么称Y函数依赖于X，表示为X→Y。此时函数依赖的左部称为决定因子，右部称为依赖函数。决定因子和依赖函数都是属性的集合。函数依赖反映属性或属性组之间相互依存、互相制约的关系，即关系表中属性之间的依赖关系。</p> 
</blockquote> 
<p>完全函数依赖</p> 
<blockquote> 
 <p>设X、Y是某关系的不同属性集，如X→Y，且不存在X中的子集 X’使X’→Y，则Y称完全函数依赖，否则称Y部分函数依赖。</p> 
</blockquote> 
<p>对于关系R（<u>X</u>, <u>Y</u>, N, O, P），其中（X，Y）为复合主键，若其它属性N,O,P都完整依赖于该复合主键，则称关系R为完全函数依赖。反之，其它属性N,O,P仅依赖于X，或仅依赖于Y，则称R为部分函数依赖。</p> 
<p>函数传递依赖</p> 
<p>对于关系R（<u>X</u>, N, O, P），其中X为主键，若属性N依赖于X，而X不依赖于N，属性O依赖于N。则属性O函数传递依赖于X。</p> 
<p>多值函数依赖</p> 
<p>对于教学关系R（课程, 教师, 课程参考书），一门课程可以有多个任课教师，也可以有多本参考书；每个任课教师可以任意选择他的参考书。该关系存在多值函数依赖。</p> 
<h5><a id="_468"></a>关系规范化范式</h5> 
<p>1NF：关系表中的属性不可再细分，否则该表不是关系表</p> 
<p>2NF：1NF基础上，消除关系中的属性部分函数依赖</p> 
<blockquote> 
 <p>有一个关系（<u>A</u>,<u>B</u>,N,O,P）,其复合主键为（A,B）,那么N,O,P这三个非键属性都不存在只依赖A或只依赖B情况，则该关系满足第2范式,反之,不满足第2范式。</p> 
</blockquote> 
<p>3NF：2NF基础上，切断属性传递函数依赖</p> 
<blockquote> 
 <p>若有一个关系（A,N,O,P）,主键为（A）,那么非键属性N,O或P都不能由单个的N,O或P或它们的组合所确定。该关系满足第3范式。</p> 
</blockquote> 
<p>BCNF：所有函数依赖的决定因子都是候选键</p> 
<p>4NF：BCNF基础上，消除了多值函数依赖</p> 
<h5><a id="_485"></a>逆规范化处理</h5> 
<p>规范化过高也会导致数据库性能降低，因此要适当降低规范化范式约束，允许适当的数据冗余性，以获取数据访问性能。可以通过增加冗余列或派生列，多个表合并为一个表进行处理。</p> 
<h3><a id="_489"></a>五、数据库管理</h3> 
<h4><a id="51__491"></a>5.1 概述</h4> 
<p>包括性能索引查询并发管理、角色用户对象权限管理、安全备份恢复等。</p> 
<p>pgadmin4-Postgresql的数据库管理工具</p> 
<h4><a id="52__497"></a>5.2 事务管理</h4> 
<p>防止业务处理单元的一组操作中某一步出现错误导致混乱，事务是DBMS执行的最小任务单元、故障恢复单元、并发控制任务单元</p> 
<p>生命周期状态变迁图</p> 
<p><img src="https://images2.imgbox.com/2c/a6/e0Ocgtls_o.png" alt="在这里插入图片描述"></p> 
<p>事务ACID特性</p> 
<ul><li>原子性（Atomicity）：事务所有操作在数据库中要么全部执行，要么全部不执行。</li><li>一致性（Consistency）：事务多次执行，其结果应一致。</li><li>隔离性（Isolation）：事务与事务之间隔离，并发执行透明。</li><li>持续性（Durability ）：事务完成后，数据改变必须是永久的。</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'004'</span><span class="token punctuation">,</span> <span class="token string">'外语学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'005'</span><span class="token punctuation">,</span> <span class="token string">'数学学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span>  <span class="token keyword">INTO</span> college<span class="token punctuation">(</span> collegeID<span class="token punctuation">,</span> collegename<span class="token punctuation">)</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'006'</span><span class="token punctuation">,</span> <span class="token string">'临床医学院'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="53__521"></a>5.3 并发控制</h4> 
<h5><a id="_523"></a>事务调度</h5> 
<p>多个事务在DBMS同时运行可能对共享数据同时访问，需要加以约束控制按照恰当顺序访问，否则导致数据不一致和死锁。在DBMS中，为使并发事务调度实现的处理结果与串行化调度处理结果一致，事务管理器将并发执行事务的SQL数据操作请求提交给并发控制调度器。由并发控制调度器将各个事务的SQL数据操作请求按照一定顺序进行调度执行，并完成对数据库缓冲区的读写操作。</p> 
<h6><a id="_527"></a>数据不一致问题</h6> 
<p>丢失更新</p> 
<p>T1、T2两个事务并发执行，它们均对数据库共享数据A进行了非锁定资源的读写操作。当事务T1和T2均读入该共享数据A并修改，T2提交的结果破坏了T1提交的结果，导致T1的修改被丢失。</p> 
<p>不可重复读</p> 
<p><img src="https://images2.imgbox.com/15/5c/2R6EmjjL_o.png" alt="在这里插入图片描述"></p> 
<p>幻象读</p> 
<p>事务T1按一定条件从数据库中读取某些数据记录后，事务T2在其中插入了一些记录，当T1再次按相同条件读取数据时，发现多了一些记录。称为幻象读取。与不可重复读类似。</p> 
<p>脏数据读取</p> 
<p><img src="https://images2.imgbox.com/f3/7a/gSf2MyNb_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_545"></a>锁机制</h5> 
<p>事务对共享数据加锁访问，锁的粒度由数据库到表页面行</p> 
<ul><li>排它锁定(Lock-X)——锁定后，不允许其它事务对共享数据再加锁</li><li>共享锁定(Lock-S)——锁定后，只允许其它事务对共享数据添加读取锁</li></ul> 
<p>锁的相容性：排他锁与其他锁均不相容，共享锁之间相容</p> 
<h6><a id="_554"></a>加锁协议</h6> 
<p>一级加锁协议：对共享数据修改时执行排它锁定指令，直到该事务处理完成才解锁。只能避免丢失更新问题。</p> 
<p>二级加锁协议：一级协议基础上，对共享数据读操作进行共享锁定指令，读完数据立刻释放共享锁。避免丢失更新问题，脏读。</p> 
<p>三级加锁协议：一级协议基础之上，对共享数据读操作进行共享锁定指令，直到事务处理结束才释放。避免丢失更新、脏读、不可重复读问题。</p> 
<h6><a id="_562"></a>两阶段锁定协议</h6> 
<p>二阶段锁定协议可以保证可串行化调度</p> 
<p>每个事务必须分两个阶段提出加锁和解锁申请:</p> 
<ul><li>增长阶段，事务只能获得锁，但不能释放锁。</li><li>缩减阶段，事务只能释放锁，但不能获得新锁。</li></ul> 
<h5><a id="_570"></a>死锁</h5> 
<p>事务同时锁定两个及以上资源可能出现彼此不能继续执行的状态</p> 
<p><img src="https://images2.imgbox.com/bf/35/70VrzAdQ_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_577"></a>事务隔离</h5> 
<p><img src="https://images2.imgbox.com/d2/0b/kKnHhVoP_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XxU29kQK-1685608431258)(C:\Users\11407\AppData\Roaming\Typora\typora-user-images\image-20230531120520781.png)]"></p> 
<h4><a id="54__582"></a>5.4 安全管理</h4> 
<h5><a id="_584"></a>存取安全模型</h5> 
<p><img src="https://images2.imgbox.com/47/3f/Ly2A36io_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_588"></a>系统安全模型</h5> 
<p><img src="https://images2.imgbox.com/27/6b/5PogGpR1_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_593"></a>用户管理</h5> 
<p>在DBMS中对每个用户进行管理</p> 
<pre><code class="prism language-sql"><span class="token comment">--创建用户</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span> <span class="token keyword">WITH</span>
 LOGIN
 INHERIT
 NOSUPERUSER
 NOCREATEDB
 NOCREATEROLE
 NOREPLICATION
 CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span>
 PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span>
 
<span class="token comment">--修改用户</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span>
  CONNECTION <span class="token keyword">LIMIT</span> <span class="token number">10</span>
  PASSWORD <span class="token string">'GRES123'</span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span>  <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>              	<span class="token comment">--修改用户的属性</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span>  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>新用户名<span class="token operator">&gt;</span><span class="token punctuation">;</span>                          <span class="token comment">--修改用户的名称</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span>  <span class="token keyword">SET</span> <span class="token operator">&lt;</span>参数项<span class="token operator">&gt;</span> { <span class="token keyword">TO</span> <span class="token operator">|</span> <span class="token operator">=</span> } { <span class="token keyword">value</span> <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> }<span class="token punctuation">;</span>  <span class="token comment">--修改用户的参数值  </span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span>  <span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span>  RESET <span class="token operator">&lt;</span>参数项<span class="token operator">&gt;</span><span class="token punctuation">;</span>			                      <span class="token comment">--重置用户参数值</span>

<span class="token comment">--删除用户</span>
<span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">"USERA"</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="_622"></a>权限管理</h5> 
<p>DBA对用户进行数据库系统/数据库对象访问操作/数据库对象定义操作的授予/收回/拒绝权限</p> 
<pre><code class="prism language-sql"><span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Department  <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Employee    <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Project     <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span>  <span class="token keyword">ON</span>  Assignment  <span class="token keyword">TO</span>  userA<span class="token punctuation">;</span>

<span class="token keyword">GRANT</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">&gt;</span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">&gt;</span>  <span class="token keyword">TO</span> {数据库用户名<span class="token operator">|</span>用户角色名}；
<span class="token keyword">REVOKE</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">&gt;</span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">&gt;</span>  <span class="token keyword">FROM</span> {数据库用户名<span class="token operator">|</span>用户角色名}；
<span class="token keyword">DENY</span>  <span class="token operator">&lt;</span>权限名<span class="token operator">&gt;</span> <span class="token keyword">ON</span>  <span class="token operator">&lt;</span>对象名<span class="token operator">&gt;</span> <span class="token keyword">TO</span> {数据库用户名<span class="token operator">|</span>用户角色名}；
</code></pre> 
<h5><a id="_637"></a>角色管理</h5> 
<p>将一组相同权限的用户定义为角色</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> 	               <span class="token comment">--创建角色</span>
<span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span>  <span class="token punctuation">[</span> <span class="token punctuation">[</span> <span class="token keyword">WITH</span> <span class="token punctuation">]</span> <span class="token keyword">option</span> <span class="token punctuation">[</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> 	               <span class="token comment">--修改角色属性</span>
<span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span>  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> <span class="token operator">&lt;</span>新角色名<span class="token operator">&gt;</span><span class="token punctuation">;</span> 		                    <span class="token comment">--修改角色名称 </span>
<span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span>  <span class="token keyword">SET</span> <span class="token operator">&lt;</span>参数项<span class="token operator">&gt;</span> { <span class="token keyword">TO</span> <span class="token operator">|</span> <span class="token operator">=</span> } { <span class="token keyword">value</span> <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> }<span class="token punctuation">;</span>	 <span class="token comment">--修改角色参数值</span>
<span class="token keyword">ALTER</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span>  RESET <span class="token operator">&lt;</span>参数项<span class="token operator">&gt;</span><span class="token punctuation">;</span>	                    		 <span class="token comment">--复位角色参数值</span>
<span class="token keyword">DROP</span>  ROLE  <span class="token operator">&lt;</span>角色名<span class="token operator">&gt;</span><span class="token punctuation">;</span>					                           	   <span class="token comment">--删除指定角色</span>

<span class="token keyword">CREATE</span>  ROLE  <span class="token string">"Role_Manager"</span>  <span class="token keyword">WITH</span>
 LOGIN
 NOSUPERUSER
 NOCREATEDB
 NOCREATEROLE
 INHERIT
 NOREPLICATION
 CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Department  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Employee  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Project  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span>  <span class="token keyword">SELECT</span><span class="token punctuation">,</span><span class="token keyword">INSERT</span><span class="token punctuation">,</span><span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span>  <span class="token keyword">ON</span>  Assignment  <span class="token keyword">TO</span>  <span class="token string">"Role_Manager"</span><span class="token punctuation">;</span>
</code></pre> 
<p>为用户赋予角色</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span>  <span class="token string">"StudentUser"</span>  <span class="token keyword">WITH</span>
  LOGIN
  CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token operator">IN</span> ROLE <span class="token string">"R_Student"</span>
  PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span>  <span class="token string">"TeacherUser"</span>  <span class="token keyword">WITH</span>
  LOGIN
  CONNECTION <span class="token keyword">LIMIT</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token operator">IN</span> ROLE <span class="token string">"R_Teacher"</span>
  PASSWORD <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="55__679"></a>5.5 数据库备份与恢复</h4> 
<p>数据库备份：对数据和状态（日志）进行副本复制</p> 
<p>数据库恢复：从备份副本将数据库从错误状态恢复到某一正确状态</p> 
<p>备份SAMPLE数据库到一个G磁盘的根目录文件Sample.bak中。</p> 
<pre><code class="prism language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> SAMPLE   
<span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> ‘G:\Sample<span class="token punctuation">.</span>bak'<span class="token punctuation">;</span> 
</code></pre> 
<p>从存储备份文件中恢复SAMPLE数据库。</p> 
<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> SAMPLE
<span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> ‘G:\Sample<span class="token punctuation">.</span>bak'<span class="token punctuation">;</span> 
</code></pre> 
<p>也可利用事务日志前滚或回滚方式进行数据库恢复</p> 
<h3><a id="_701"></a>六、数据库应用编程</h3> 
<h4><a id="61_ODBC_703"></a>6.1 数据库连接技术ODBC</h4> 
<p>传统应用开发通常选用特定DBMS管理系统，Microsoft推出开放式数据库互连（Open DataBase Connectivity，简写为ODBC）技术。ODBC实现了应用程序对多种不同DBMS的数据库的访问，实现了数据库连接方式的变革。 ODBC使APP利用相同源码访问不同数据库系统。</p> 
<p>ODBC层次结构</p> 
<p><img src="https://images2.imgbox.com/97/aa/GsiDXG7N_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="62_JDBC_713"></a>6.2 数据库连接技术（JDBC）</h4> 
<p><strong>JDBC</strong>（Java DataBase Connectivity，Java数据库连接）技术的简称 ，是一种用于执行SQL语句的Java API。它由一组用Java编程语言编写的类和接口组成。这个API由<strong>java.sql.*包中</strong>的一些类和接口组成，它为数据库开发人员提供了一个标准的API，使他们能够用纯Java API 来编写数据库应用程序。使用JDBC访问数据库需要相应数据库的JDBC驱动程序</p> 
<pre><code class="prism language-java"><span class="token comment">// 加载驱动</span>
<span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"org.postgresql.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 建立连接</span>
<span class="token class-name">String</span> <span class="token class-name">UrL</span> <span class="token operator">=</span> <span class="token string">"jdbc:postgresql://localhost:5432/testdb"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"myuser"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"sa"</span><span class="token punctuation">;</span>
<span class="token class-name">Connection</span> conn <span class="token operator">=</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 创建Statement对象</span>
<span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行sql语句</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"INSERT INTO public.student (sid, sname, gender, birthday, major, phone)"</span> <span class="token operator">+</span> <span class="token string">" VALUES ('2017001', '张山', '男', '1998-10-10','软件工程','13602810001')"</span><span class="token punctuation">;</span>
stmt<span class="token punctuation">.</span><span class="token function">executeUpdate</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>创建了Statement对象 ,就可以向Statement对象发送SQL语句。主要掌握两种执行SQL语句的方法：executeQuery()、executeUpdate()</p> 
<ol><li>executeQuery()：返回语句执行后的单个结果集的，所以通常用于select语句</li><li>executeUpdate()返回值是一个整数，指示受影响的行数（可以用于update、insert、delete语句）</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// 保存结果集</span>
<span class="token class-name">Statement</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT id, name, age FROM company"</span><span class="token punctuation">;</span>
<span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 关闭连接</span>
rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="63__752"></a>6.3 数据库存储过程</h4> 
<p>存储过程，一种数据库对象，由一组能完成特定功能的SQL语句集构成，编译后存储在数据库服务端接受调用。能够减少网络通信量加快执行速度，不过开发调试复杂可移植性差。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token punctuation">]</span> <span class="token keyword">FUNCTION</span><span class="token operator">/</span><span class="token keyword">PROCEDURE</span>  name
    <span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> argmode <span class="token punctuation">]</span> <span class="token punctuation">[</span> argname <span class="token punctuation">]</span> argtype <span class="token punctuation">[</span> { <span class="token keyword">DEFAULT</span> <span class="token operator">|</span> <span class="token operator">=</span> } default_expr <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">[</span> <span class="token keyword">RETURNS</span> retype <span class="token operator">|</span> <span class="token keyword">RETURNS</span> <span class="token keyword">TABLE</span> <span class="token punctuation">(</span> column_name  column_type <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">]</span>
<span class="token keyword">AS</span> $$         <span class="token comment">//$$用于声明存储过程的实际代码的开始</span>
<span class="token keyword">DECLARE</span>
        <span class="token comment">-- 声明段</span>
<span class="token keyword">BEGIN</span>
        <span class="token comment">--函数体语句</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
$$ <span class="token keyword">LANGUAGE</span> lang_name<span class="token punctuation">;</span>  <span class="token comment">//$$ 表明代码的结束, LANGUAGE后面指明所用的编程语言</span>

<span class="token comment">-- 创建一个名为countRecords()的存储过程统计STUDENT表的记录数。</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> countRecords <span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">RETURNS</span> <span class="token keyword">integer</span> <span class="token keyword">AS</span> $count$  
<span class="token keyword">declare</span>  
    count <span class="token keyword">integer</span><span class="token punctuation">;</span>  
<span class="token keyword">BEGIN</span>  
   <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> count <span class="token keyword">FROM</span> STUDENT<span class="token punctuation">;</span>  
   <span class="token keyword">RETURN</span> count<span class="token punctuation">;</span>  
<span class="token keyword">END</span><span class="token punctuation">;</span>  
$count$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span>

<span class="token comment">-- 执行存储过程</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> countRecords<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 存储过程调用其他存储过程:select  into 自定义变量  from 存储过程名（参数）；</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> testExec<span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token keyword">returns</span> <span class="token keyword">integer</span> <span class="token keyword">AS</span> $$ 
<span class="token keyword">declare</span>
   rec <span class="token keyword">integer</span><span class="token punctuation">;</span>  
<span class="token keyword">BEGIN</span>  
   <span class="token keyword">select</span>  <span class="token keyword">into</span> rec countRecords<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token comment">//如果不关心countRecords()的返回值，则可用 PERFORM countRecords() 代替; </span>
   <span class="token keyword">return</span>  rec<span class="token punctuation">;</span>  
<span class="token keyword">END</span><span class="token punctuation">;</span>  
$$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span>

<span class="token comment">-- 删除存储过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token punctuation">[</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">]</span> name <span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span> argmode <span class="token punctuation">]</span> <span class="token punctuation">[</span> argname <span class="token punctuation">]</span> argtype <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">RESTRICT</span> <span class="token punctuation">]</span>

<span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> testExec<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<h4><a id="64__802"></a>6.4 数据库触发器</h4> 
<p>触发器是一个定义在表或视图上的特殊类型的存储过程（不传递接受参数）、一个特殊的事务单位，由操作事件触发自动执行，可以实现比约束更复杂的数据完整性，用于加强数据完整性约束和业务规则</p> 
<p>语句级触发器只执行一次（默认触发器）；行级触发器每有数据变化一行就执行一次</p> 
<p>INSTEAD OF触发器：事件发生时只执行触发器不执行原本的sql语句，一个表或视图只能有一个INSTEAD OF触发器</p> 
<h5><a id="_811"></a>触发器相关特殊变量</h5> 
<p>NEW：RECORD类型，对于行级触发器其存有INSERT或UPDATE操作产生的新数据行。对于语句级触发器其值为NULL</p> 
<p>OLD：RECORD类型，对于行级触发器其存有DELETE或UPDATE操作修改或删除的旧数据行。对于语句级触发器其值为NULL</p> 
<p>TG_OP:text类型，值为INSERT/UPDATE/DELETE，说明引发触发器的操作</p> 
<p>创建触发器步骤：</p> 
<ol><li>检查所依附的表或视图是否存在</li><li>创建触发器执行的触发器函数，返回类型为TRIGGER</li><li>创建触发器</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span>  <span class="token keyword">TRIGGER</span>  触发器名   
    { BEFORE <span class="token operator">|</span> <span class="token keyword">AFTER</span> <span class="token operator">|</span> INSTEAD <span class="token keyword">OF</span> }
     <span class="token keyword">ON</span> 表名
     <span class="token punctuation">[</span> <span class="token keyword">FOR</span> <span class="token punctuation">[</span> EACH <span class="token punctuation">]</span> { <span class="token keyword">ROW</span> <span class="token operator">|</span> STATEMENT } <span class="token punctuation">]</span>
     <span class="token keyword">EXECUTE</span> <span class="token keyword">PROCEDURE</span> 存储过程名 <span class="token punctuation">(</span> 参数列表 <span class="token punctuation">)</span>
</code></pre> 
<p>实例 为了防止非法修改stu_score表的课程成绩，创建audit_score表记录stu_score表的成绩变化</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> stu_score
<span class="token punctuation">(</span> 
    sid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    cid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    score <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">CONSTRAINT</span> stu_score_pkey <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>sid<span class="token punctuation">,</span> cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> audit_score
<span class="token punctuation">(</span>    username <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>  <span class="token comment">--用户名</span>
    sid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    cid <span class="token keyword">character</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
    updatetime <span class="token keyword">text</span> <span class="token punctuation">,</span>            <span class="token comment">--修改的时间</span>
    oldscore <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">--修改前的成绩</span>
    newscore <span class="token keyword">numeric</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">--修改后的成绩</span>
<span class="token punctuation">)</span>
<span class="token comment">-- 创建函数</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">FUNCTION</span> score_audit <span class="token keyword">RETURNS</span> <span class="token keyword">TRIGGER</span> 
<span class="token keyword">AS</span> $score_sudits$
<span class="token keyword">BEGIN</span>
	<span class="token keyword">IF</span> <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'DELETE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span>OLD<span class="token punctuation">.</span>score <span class="token punctuation">;</span>
		<span class="token keyword">RETURN</span> OLD<span class="token punctuation">;</span>
	ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'UPDATE'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score
		<span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>old<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>old<span class="token punctuation">.</span>cid<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>OLD<span class="token punctuation">.</span>score<span class="token punctuation">,</span>new<span class="token punctuation">.</span>score
		<span class="token keyword">WHERE</span> old<span class="token punctuation">.</span>sid<span class="token operator">=</span>new<span class="token punctuation">.</span>sid <span class="token operator">and</span> old<span class="token punctuation">.</span>cid<span class="token operator">=</span>new<span class="token punctuation">.</span>cid<span class="token punctuation">;</span>
		<span class="token keyword">RETURN</span> NEW
	ELSIF <span class="token punctuation">(</span>TG_OP <span class="token operator">=</span> <span class="token string">'INSERT'</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> audit_score <span class="token keyword">SELECT</span> <span class="token keyword">user</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>sid<span class="token punctuation">,</span>new<span class="token punctuation">.</span>cid<span class="token punctuation">,</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span>new<span class="token punctuation">.</span>score<span class="token punctuation">;</span>
		<span class="token keyword">RETURN</span> NEW<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	<span class="token keyword">RETURN</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
$score_audits$ <span class="token keyword">LANGUAGE</span> plpgsql<span class="token punctuation">;</span>
<span class="token comment">-- 创建触发器</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> score_audit_triger
<span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token operator">OR</span> <span class="token keyword">UPDATE</span> <span class="token operator">OR</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> stu_score
<span class="token keyword">FOR EACH ROW</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">PROCEDURE</span> score_audit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 修改触发器</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TRIGGER</span> score_audit_trigger <span class="token keyword">ON</span> stu_score  <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> score_audit_trig<span class="token punctuation">;</span>
<span class="token comment">-- 删除触发器</span>
<span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token punctuation">[</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">]</span> name <span class="token keyword">ON</span> table_name <span class="token punctuation">[</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">RESTRICT</span> <span class="token punctuation">]</span>

<span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> score_audit_trig <span class="token keyword">ON</span> stu_score <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="65__883"></a>6.5 数据库游标</h4> 
<p>游标是一种存放了查询数据库表返回的数据记录的临时的数据库对象，包含查询结果和指针，提供了处理结果集中每一条记录的机制，它总是与一条查询SQL语句相关联</p> 
<p>声明游标</p> 
<p><img src="https://images2.imgbox.com/a2/df/y5nFVIa4_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token comment">-- 声明游标</span>
curStudent <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>
curStudentOne <span class="token keyword">CURSOR</span> <span class="token punctuation">(</span><span class="token keyword">key</span> <span class="token keyword">integer</span><span class="token punctuation">)</span><span class="token number">7</span>y <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student <span class="token keyword">WHERE</span> SID <span class="token operator">=</span> <span class="token keyword">key</span><span class="token punctuation">;</span>

</code></pre> 
<p>打开游标</p> 
<p><img src="https://images2.imgbox.com/db/79/ZuPfQV1X_o.png" alt="在这里插入图片描述"></p> 
<p>使用游标<br> <img src="https://images2.imgbox.com/df/47/Wq1JS8tS_o.png" alt="在这里插入图片描述"></p> 
<p>关闭游标<br> <img src="https://images2.imgbox.com/dd/80/K0TkPlz4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="66_sql_910"></a>6.6 嵌入式sql编程</h4> 
<p>sql与宿主语言，混合编程</p> 
<h3><a id="NoSQL_914"></a>七、NoSQL数据库技术</h3> 
<h4><a id="CAP_916"></a>CAP理论</h4> 
<p>在分布式的环境下设计和部署系统时，有3个核心的需求：CAP对应一致性（Consistency），可用性（Availability）和分区容忍性（Partition Tolerance）</p> 
<p>CAP理论的核心：</p> 
<p>一个分布式系统不可能同时很好的满足一致性、可用性和分区容错性这三个需求，最多只能同时较好的满足两个。</p> 
<ul><li>CA - 单点集群，满足一致性，可用性的系统，</li><li>CP - 满足一致性，分区容忍性的系统，</li><li>AP - 满足可用性，分区容忍性的系统，</li></ul> 
<p>CAP目的：</p> 
<ul><li>CAP是为了探索不同应用的一致性C与可用性A之间的平衡，</li><li>在网络或其他原因，通过牺牲一定的一致性C来获得更好的性能与扩展性</li><li>在有分隔发生，选择可用性A，集中关注分隔的恢复，需要分隔前、中、后期的处理策略， 及合适的补偿处理机制。</li><li>选择什么样的方式： 放弃Ｐ？放弃Ａ？放弃Ｃ？BASE</li></ul> 
<h4><a id="BASE_935"></a>BASE</h4> 
<ul><li>Basically Available --基本可用；系统能够基本运行，一直提供服务。</li><li>Soft-state --软状态/柔性事务。“Soft state” 可以理解为"无连接"的, 而 “Hard state” 是"面向连接"的；系统不要求一直保持强一致状态。</li><li>Eventual Consistency --最终一致性 系统在某个时刻达到最终一致性。</li><li>BASE定义为CAP中AP的衍生，在分布式环境下， BASE是数据的属性，BASE强调基本的可用性，按照功能划分数据库</li></ul> 
<p>base特点</p> 
<ul><li>ACID是事物的特征， A（原子性）C（一致性）I（隔离性）D（持久性），ACID的特点是强一致性、隔离性、采用悲观保守方法、难以变化；</li><li>BASE的特点是弱一致性、可用性优先、采用乐观方法、适应变化并且简单快捷。</li><li>对数据不断增长的系统， 大数据环境下系统的可用性及分隔容忍性的要求要高于强一致性，很难满足事务要求的ACID特性。</li></ul> 
<h4><a id="_948"></a>最终一致性</h4> 
<ul><li>强一致性： 要求无论更新操作实在哪一个副本执行，之后所有的读操作都要能获得最新的数据。</li><li>弱一致性：用户读到某一操作对系统特定数据的更新需要一段时间，称这段时间为“不一致性窗口”。</li><li>最终一致性： 弱一致性的一种特例，保证用户最终能够读取到某操作对系统特定数据的更新。</li></ul> 
<h4><a id="_954"></a>存储模型</h4> 
<ul><li>列存储数据库，将同一列的数据存储在一起，可以存储结构化和半结构化数据</li><li>键值存储数据库，存储的数据是有键（key）和值（value）两部分组成，通过key快速查询到其value，value的格式可以根据具体应用来确定</li><li>文档存储数据库，存储的内容是文档型的，可以用格式化文件（类似json、XML等）的格式存储</li><li>图存储数据库，数据以有向加权图方式进行存储</li></ul> 
<table><thead><tr><th><strong>分类</strong></th><th><strong>Examples****举例</strong></th><th><strong>典型应用场景</strong></th><th><strong>数据模型</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td>键值 （key-value）</td><td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td><td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等</td><td>Key 指向 Value 的键值对，通常用hash table来实现</td><td>查找速度快</td><td>数据无结构化，通常只被当作字符串或者二进制数据</td></tr><tr><td>列存储数据库</td><td>Cassandra, HBase, Riak</td><td>分布式的文件系统</td><td>以列簇式存储，将同一列数据存在一起</td><td>查找速度快，可扩展性强，更容易进行分布式扩展</td><td>功能相对局限</td></tr><tr><td>文档型数据库</td><td>CouchDB, MongoDb</td><td>与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容</td><td>Key-Value对应的键值对，Value为结构化数据</td><td>数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td><td>查询性能不高，而且缺乏统一的查询语法。</td></tr><tr><td>图形(Graph)数据库</td><td>Neo4J, InfoGrid, Infinite Graph</td><td>社交网络，推荐系统等。专注于构建关系图谱</td><td>图结构</td><td>利用图结构相关算法。比如最短路径寻址，N度关系查找等</td><td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案</td></tr><tr><td>-----</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>键值 （key-value）</td><td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td><td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等</td><td>Key 指向 Value 的键值对，通常用hash table来实现</td><td>查找速度快</td><td>数据无结构化，通常只被当作字符串或者二进制数据</td></tr><tr><td>列存储数据库</td><td>Cassandra, HBase, Riak</td><td>分布式的文件系统</td><td>以列簇式存储，将同一列数据存在一起</td><td>查找速度快，可扩展性强，更容易进行分布式扩展</td><td>功能相对局限</td></tr><tr><td>文档型数据库</td><td>CouchDB, MongoDb</td><td>与Key-Value类似，Value是结构化的，不同的是数据库能够了解Value的内容</td><td>Key-Value对应的键值对，Value为结构化数据</td><td>数据结构要求不严格，表结构可变，不需要像关系型数据库一样需要预先定义表结构</td><td>查询性能不高，而且缺乏统一的查询语法。</td></tr><tr><td>图形(Graph)数据库</td><td>Neo4J, InfoGrid, Infinite Graph</td><td>社交网络，推荐系统等。专注于构建关系图谱</td><td>图结构</td><td>利用图结构相关算法。比如最短路径寻址，N度关系查找等</td><td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/55259f44fcac7f77a326631046ebd718/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CTFHub技能树web之XSS</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6dc004a48766355579965344dd8401ab/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通过 Java 中 5 种流行的方法提取电子邮件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>