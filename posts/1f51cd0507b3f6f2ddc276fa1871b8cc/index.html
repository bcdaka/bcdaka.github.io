<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>助力工业物联网，工业大数据之服务域：Shell调度测试【三十三】_shell调度系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1f51cd0507b3f6f2ddc276fa1871b8cc/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="助力工业物联网，工业大数据之服务域：Shell调度测试【三十三】_shell调度系统">
  <meta property="og:description" content="既有适合小白学习的零基础资料，也有适合3年以上经验的小伙伴深入学习提升的进阶课程，涵盖了95%以上软件测试知识点，真正体系化！
由于文件比较多，这里只是将部分目录截图出来，全套包含大厂面经、学习笔记、源码讲义、实战项目、大纲路线、讲解视频，并且后续会持续更新
需要这份系统化的资料的朋友，可以戳这里获取
end_task4 = BashOperator( task_id=&#39;end\_task&#39;, bash_command=&#39;echo &#34;end task&#34;&#39;, dag=dag, ) say_hello_task &gt;&gt; [print_date_format_task2,print_date_format_task3] &gt;&gt; end_task4 ``` &#43; **提交** ``` python second_bash_operator.py ``` &#43; **查看** ![image-20211005131800085](https://img-blog.csdnimg.cn/img_convert/9fabfc124be52e0e364d495bddb90df4.png) 小结
实现AirFlow的依赖调度测试 知识点09：Python调度测试 目标：实现Python代码的调度测试
实施
需求：调度Python代码Task的运行
代码
创建 cd /root/airflow/dags vim python_etl_airflow.py 开发 # import package from airflow import DAG from airflow.operators.python import PythonOperator from airflow.utils.dates import days_ago import json # define args default_args = { &#39;owner&#39;: &#39;airflow&#39;, } # define the dag with DAG( &#39;python\_etl\_dag&#39;, default_args=default_args, description=&#39;DATA ETL DAG&#39;, schedule_interval=None, start_date=days_ago(2), tags=[&#39;itcast&#39;], ) as dag: # function1 def extract(\*\*kwargs): ti = kwargs[&#39;ti&#39;] data_string = &#39;{&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-10T10:41:13+08:00">
    <meta property="article:modified_time" content="2024-05-10T10:41:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">助力工业物联网，工业大数据之服务域：Shell调度测试【三十三】_shell调度系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/08/92/2aRb1xjU_o.png" alt="img"><br> <img src="https://images2.imgbox.com/8b/85/qEsN9GVp_o.png" alt="img"><br> <img src="https://images2.imgbox.com/70/6b/bc1OFkuV_o.png" alt="img"></p> 
<p><strong>既有适合小白学习的零基础资料，也有适合3年以上经验的小伙伴深入学习提升的进阶课程，涵盖了95%以上软件测试知识点，真正体系化！</strong></p> 
<p><strong>由于文件比较多，这里只是将部分目录截图出来，全套包含大厂面经、学习笔记、源码讲义、实战项目、大纲路线、讲解视频，并且后续会持续更新</strong></p> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以戳这里获取</a></strong></p> 
<pre><code>	end_task4 = BashOperator(
	    task_id='end\_task',
	    bash_command='echo "end task"',
	    dag=dag,
	)
	
	say_hello_task &gt;&gt; [print_date_format_task2,print_date_format_task3] &gt;&gt; end_task4
	
	```
+ **提交**

 
```
python second_bash_operator.py 

```
+ **查看**

 ![image-20211005131800085](https://img-blog.csdnimg.cn/img_convert/9fabfc124be52e0e364d495bddb90df4.png)
</code></pre> 
<ul><li> <p><strong>小结</strong></p> 
  <ul><li>实现AirFlow的依赖调度测试</li></ul> </li></ul> 
<h4><a id="09Python_37"></a>知识点09：Python调度测试</h4> 
<ul><li> <p><strong>目标</strong>：<strong>实现Python代码的调度测试</strong></p> </li><li> <p><strong>实施</strong></p> 
  <ul><li> <p><strong>需求</strong>：调度Python代码Task的运行</p> </li><li> <p><strong>代码</strong></p> 
    <ul><li>创建</li></ul> <pre><code>cd /root/airflow/dags
vim python_etl_airflow.py

</code></pre> 
    <ul><li>开发</li></ul> <pre><code># import package
from airflow import DAG
from airflow.operators.python import PythonOperator
from airflow.utils.dates import days_ago
import json

# define args
default_args = {
    'owner': 'airflow',
}

# define the dag
with DAG(
    'python\_etl\_dag',
    default_args=default_args,
    description='DATA ETL DAG',
    schedule_interval=None,
    start_date=days_ago(2),
    tags=['itcast'],
) as dag:
    # function1
    def extract(\*\*kwargs):
        ti = kwargs['ti']
        data_string = '{"1001": 301.27, "1002": 433.21, "1003": 502.22, "1004": 606.65, "1005": 777.03}'
        ti.xcom_push('order\_data', data_string)
        
    # function2
    def transform(\*\*kwargs):
        ti = kwargs['ti']
        extract_data_string = ti.xcom_pull(task_ids='extract', key='order\_data')
        order_data = json.loads(extract_data_string)
        total_order_value = 0
        for value in order_data.values():
            total_order_value += value
        total_value = {"total\_order\_value": total_order_value}
        total_value_json_string = json.dumps(total_value)
        ti.xcom_push('total\_order\_value', total_value_json_string)
        
    # function3
    def load(\*\*kwargs):
        ti = kwargs['ti']
        total_value_string = ti.xcom_pull(task_ids='transform', key='total\_order\_value')
        total_order_value = json.loads(total_value_string)
        print(total_order_value)
        
    # task1
    extract_task = PythonOperator(
        task_id='extract',
        python_callable=extract,
    )
    extract_task.doc_md = """\
#### Extract task
A simple Extract task to get data ready for the rest of the data pipeline.
In this case, getting data is simulated by reading from a hardcoded JSON string.
This data is then put into xcom, so that it can be processed by the next task.
"""
	# task2
    transform_task = PythonOperator(
        task_id='transform',
        python_callable=transform,
    )
    transform_task.doc_md = """\
#### Transform task
A simple Transform task which takes in the collection of order data from xcom
and computes the total order value.
This computed value is then put into xcom, so that it can be processed by the next task.
"""
	# task3
    load_task = PythonOperator(
        task_id='load',
        python_callable=load,
    )
    load_task.doc_md = """\
#### Load task
A simple Load task which takes in the result of the Transform task, by reading it
from xcom and instead of saving it to end user review, just prints it out.
"""

# run
extract_task &gt;&gt; transform_task &gt;&gt; load_task

</code></pre> </li><li> <p><strong>提交</strong></p> </li></ul> <pre><code>python python_etl_airflow.py

</code></pre> 
  <ul><li><strong>查看</strong></li></ul> <p><img src="https://images2.imgbox.com/f6/56/9ffpctkB_o.png" alt="image-20211005150051298"></p> </li><li> <p><strong>小结</strong></p> 
  <ul><li>实现Python代码的调度测试</li></ul> </li></ul> 
<h4><a id="10OracleMySQL_158"></a>知识点10：Oracle与MySQL调度方法</h4> 
<ul><li> <p><strong>目标</strong>：了解Oracle与MySQL的调度方法</p> </li><li> <p><strong>实施</strong></p> 
  <ul><li> <p><strong>Oracle调度</strong>：参考《oracle任务调度详细操作文档.md》</p> 
    <ul><li>step1：本地安装Oracle客户端</li><li>step2：安装AirFlow集成Oracle库</li><li>step3：创建Oracle连接</li><li>step4：开发测试</li></ul> <pre><code>query_oracle_task = OracleOperator(
    task_id = 'oracle\_operator\_task',
    sql = 'select \* from ciss4.ciss\_base\_areas',
    oracle_conn_id = 'oracle-airflow-connection',
    autocommit = True,
    dag=dag
)

</code></pre> </li><li> <p><strong>MySQL调度</strong>：《MySQL任务调度详细操作文档.md》</p> 
    <ul><li> <p>step1：本地安装MySQL客户端</p> </li><li> <p>step2：安装AirFlow集成MySQL库</p> </li><li> <p>step3：创建MySQL连接</p> </li><li> <p>step4：开发测试</p> 
      <ul><li>方式一：指定SQL语句</li></ul> <pre><code>query_table_mysql_task = MySqlOperator(
    task_id='query\_table\_mysql', 
    mysql_conn_id='mysql\_airflow\_connection', 
    sql=r"""select \* from test.test\_airflow\_mysql\_task;""",
    dag=dag
)

</code></pre> <pre><code>  + 方式二：指定SQL文件
  
   
  ```
  query_table_mysql_task = MySqlOperator(
      task_id='query\_table\_mysql\_second', 
      mysql_conn_id='mysql-airflow-connection', 
      sql='test\_airflow\_mysql\_task.sql',
      dag=dag
  )
  
  ```
</code></pre> 
      <ul><li>方式三：指定变量</li></ul> <pre><code>insert_sql = r"""
INSERT INTO `test`.`test\_airflow\_mysql\_task`(`task\_name`) VALUES ( 'test airflow mysql task3');
INSERT INTO `test`.`test\_airflow\_mysql\_task`(`task\_name`) VALUES ( 'test airflow mysql task4');
INSERT INTO `test`.`test\_airflow\_mysql\_task`(`task\_name`) VALUES ( 'test airflow mysql task5');
"""

insert_table_mysql_task = MySqlOperator(
    task_id='mysql\_operator\_insert\_task', 
    mysql_conn_id='mysql-airflow-connection', 
    sql=insert_sql,
    dag=dag
)

</code></pre> </li></ul> </li></ul> </li></ul> 
<p>​</p> 
<ul><li> <p><strong>小结</strong></p> 
  <ul><li>了解Oracle与MySQL的调度方法</li></ul> </li></ul> 
<h4><a id="11_247"></a>知识点11：大数据组件调度方法</h4> 
<ul><li> <p><strong>目标</strong>：了解大数据组件调度方法</p> </li><li> <p><strong>实施</strong></p> 
  <ul><li> <p><strong>AirFlow支持的类型</strong></p> 
    <ul><li>HiveOperator</li><li>PrestoOperator</li><li>SparkSqlOperator</li></ul> </li><li> <p><strong>需求</strong>：Sqoop、MR、Hive、Spark、Flink</p> </li><li> <p><strong>解决</strong>：统一使用BashOperator或者PythonOperator，将对应程序封装在脚本中</p> 
    <ul><li>Sqoop</li></ul> <pre><code>run_sqoop_task = BashOperator(
    task_id='sqoop\_task',
    bash_command='sqoop --options-file xxxx.sqoop',
    dag=dag,
)

</code></pre> 
    <ul><li>Hive</li></ul> <pre><code>run_hive_task = BashOperator(
    task_id='hive\_task',
    bash_command='hive -f xxxx.sql',
    dag=dag,
)

</code></pre> 
    <ul><li>Spark</li></ul> <pre><code>run_spark_task = BashOperator(
    task_id='spark\_task',
    bash_command='spark-sql -f xxxx.sql',
    dag=dag,
)

</code></pre> 
    <ul><li>Flink</li></ul> <pre><code>run_flink_task = BashOperator(
    task_id='flink\_task',
    bash_command='flink run /opt/flink-1.12.2/examples/batch/WordCount.jar',
    dag=dag,
)



</code></pre> </li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/65/8c/YhIfQlEI_o.png" alt="img"><br> <img src="https://images2.imgbox.com/b0/bb/2fhiMScQ_o.png" alt="img"></p> 
<p><strong>网上学习资料一大堆，但如果学到的知识不成体系，遇到问题时只是浅尝辄止，不再深入研究，那么很难做到真正的技术提升。</strong></p> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以戳这里获取</a></strong></p> 
<p><strong>一个人可以走的很快，但一群人才能走的更远！不论你是正从事IT行业的老鸟或是对IT行业感兴趣的新人，都欢迎加入我们的的圈子（技术交流、学习资源、职场吐槽、大厂内推、面试辅导），让我们一起学习成长！</strong></p> 
<p>308850741)]<br> [外链图片转存中…(img-dRzj8Rtf-1715308850743)]</p> 
<p><strong>网上学习资料一大堆，但如果学到的知识不成体系，遇到问题时只是浅尝辄止，不再深入研究，那么很难做到真正的技术提升。</strong></p> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以戳这里获取</a></strong></p> 
<p><strong>一个人可以走的很快，但一群人才能走的更远！不论你是正从事IT行业的老鸟或是对IT行业感兴趣的新人，都欢迎加入我们的的圈子（技术交流、学习资源、职场吐槽、大厂内推、面试辅导），让我们一起学习成长！</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5d483857696a0a89239cc93f50ed58de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">手把手教你微调Stable Diffusion</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d3f7071c64f4f7e7772b7fdc589e0718/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 变量类型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>