<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>4PCS点云配准算法实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9b48b261b408d340d0cfb186a309fb53/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="4PCS点云配准算法实现">
  <meta property="og:description" content="4PCS点云配准算法的C&#43;&#43;实现如下：
#include &lt;iostream&gt; #include &lt;pcl/io/pcd_io.h&gt; #include &lt;pcl/point_types.h&gt; #include &lt;pcl/common/common.h&gt; #include &lt;pcl/common/distances.h&gt; #include &lt;pcl/common/transforms.h&gt; #include &lt;pcl/search/kdtree.h&gt; struct Points4 { pcl::PointXYZ p1; pcl::PointXYZ p2; pcl::PointXYZ p3; pcl::PointXYZ p4; }; int compute_LCP(const pcl::PointCloud&lt;pcl::PointXYZ&gt;&amp; cloud, pcl::search::KdTree&lt;pcl::PointXYZ&gt;::Ptr kdtree, float radius) { std::vector&lt;int&gt;index(1); std::vector&lt;float&gt;distance(1); int count = 0; for (size_t i = 0; i &lt; cloud.size(); i&#43;&#43;) { kdtree-&gt;nearestKSearch(cloud.points[i], 1, index, distance); if (distance[0] &lt; radius) count = count &#43; 1; } return count; } int main(int argc, char** argv) { pcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr source_cloud(new pcl::PointCloud&lt;pcl::PointXYZ&gt;); pcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr target_cloud(new pcl::PointCloud&lt;pcl::PointXYZ&gt;); pcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr pcs_cloud(new pcl::PointCloud&lt;pcl::PointXYZ&gt;); pcl::io::loadPCDFile(&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-01T22:47:45+08:00">
    <meta property="article:modified_time" content="2024-07-01T22:47:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">4PCS点云配准算法实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/8c/fe/b9zOb3lh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1a/23/05j3ReFK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/8a/69/c4hzFWBu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/81/72/oAtD1agB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ef/25/NTmxcMoP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ee/b2/xxcicvc9_o.png" alt="在这里插入图片描述"></p> 
<p>4PCS点云配准算法的C++实现如下：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/io/pcd_io.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/point_types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/common/common.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/common/distances.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/common/transforms.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pcl/search/kdtree.h&gt;</span> </span>


<span class="token keyword">struct</span> <span class="token class-name">Points4</span>
<span class="token punctuation">{<!-- --></span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ p1<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ p2<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ p3<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ p4<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">int</span> <span class="token function">compute_LCP</span><span class="token punctuation">(</span><span class="token keyword">const</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token operator">&amp;</span> cloud<span class="token punctuation">,</span> pcl<span class="token double-colon punctuation">::</span>search<span class="token double-colon punctuation">::</span>KdTree<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr kdtree<span class="token punctuation">,</span> <span class="token keyword">float</span> radius<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cloud<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		kdtree<span class="token operator">-&gt;</span><span class="token function">nearestKSearch</span><span class="token punctuation">(</span>cloud<span class="token punctuation">.</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>distance<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> radius<span class="token punctuation">)</span>
			count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">source_cloud</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">target_cloud</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">pcs_cloud</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	pcl<span class="token double-colon punctuation">::</span>io<span class="token double-colon punctuation">::</span><span class="token function">loadPCDFile</span><span class="token punctuation">(</span><span class="token string">"bunny1.pcd"</span><span class="token punctuation">,</span> <span class="token operator">*</span>source_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>io<span class="token double-colon punctuation">::</span><span class="token function">loadPCDFile</span><span class="token punctuation">(</span><span class="token string">"bunny2.pcd"</span><span class="token punctuation">,</span> <span class="token operator">*</span>target_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pcl<span class="token double-colon punctuation">::</span>PointXYZ min_pt<span class="token punctuation">,</span> max_pt<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span><span class="token function">getMinMax3D</span><span class="token punctuation">(</span><span class="token operator">*</span>source_cloud<span class="token punctuation">,</span> min_pt<span class="token punctuation">,</span> max_pt<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> d_max <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>min_pt<span class="token punctuation">,</span> max_pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//srand(time(0));</span>
	<span class="token keyword">int</span> iters <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> s_max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> ff <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> delta <span class="token operator">=</span> <span class="token number">0.0001</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> index1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> index2 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> index3 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> index4 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> iters<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> n1 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> source_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n2 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> source_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n3 <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> source_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pcl<span class="token double-colon punctuation">::</span>PointXYZ p1 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n1<span class="token punctuation">]</span><span class="token punctuation">,</span> p2 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n2<span class="token punctuation">]</span><span class="token punctuation">,</span> p3 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n3<span class="token punctuation">]</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>Vector3f <span class="token function">a</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z <span class="token operator">-</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>Vector3f <span class="token function">b</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z <span class="token operator">-</span> p3<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> s <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token operator">*</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> b<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> b<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> b<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> b<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> a<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>s <span class="token operator">&gt;</span> s_max <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n1<span class="token punctuation">]</span><span class="token punctuation">,</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> f<span class="token operator">*</span> d_max 
			<span class="token operator">&amp;&amp;</span>	pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n1<span class="token punctuation">]</span><span class="token punctuation">,</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>n3<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> f <span class="token operator">*</span> d_max<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			index1 <span class="token operator">=</span> n1<span class="token punctuation">;</span>
			index2 <span class="token operator">=</span> n2<span class="token punctuation">;</span>
			index3 <span class="token operator">=</span> n3<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>index1 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> index2 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> index3 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"find three points error!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	pcl<span class="token double-colon punctuation">::</span>PointXYZ p1 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">,</span> p2 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>index2<span class="token punctuation">]</span><span class="token punctuation">,</span> p3 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>index3<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> A <span class="token operator">=</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">float</span> B <span class="token operator">=</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> C <span class="token operator">=</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p3<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">float</span> D <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>A <span class="token operator">*</span> p1<span class="token punctuation">.</span>x <span class="token operator">+</span> B <span class="token operator">*</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> C <span class="token operator">*</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> source_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pcl<span class="token double-colon punctuation">::</span>PointXYZ p <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">float</span> d <span class="token operator">=</span> <span class="token function">fabs</span><span class="token punctuation">(</span>A <span class="token operator">*</span> p<span class="token punctuation">.</span>x <span class="token operator">+</span> B <span class="token operator">*</span> p<span class="token punctuation">.</span>y <span class="token operator">+</span> C <span class="token operator">*</span> p<span class="token punctuation">.</span>z <span class="token operator">+</span> D<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>A <span class="token operator">*</span> A <span class="token operator">+</span> B <span class="token operator">*</span> B <span class="token operator">+</span> C <span class="token operator">*</span> C<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> flag <span class="token operator">=</span> <span class="token punctuation">(</span>pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token operator">&lt;</span> f <span class="token operator">*</span> d_max <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">&lt;</span> f <span class="token operator">*</span> d_max <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p3<span class="token punctuation">)</span> <span class="token operator">&lt;</span> f <span class="token operator">*</span> d_max
			<span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token operator">&gt;</span> ff <span class="token operator">*</span> d_max <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">&gt;</span> ff <span class="token operator">*</span> d_max <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> p3<span class="token punctuation">)</span> <span class="token operator">&gt;</span> ff <span class="token operator">*</span> d_max<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">&lt;</span> delta <span class="token operator">*</span> d_max <span class="token operator">&amp;&amp;</span> flag<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			index4 <span class="token operator">=</span> i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>index4 <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"find fouth point error!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ p4 <span class="token operator">=</span> source_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>index4<span class="token punctuation">]</span><span class="token punctuation">;</span>

	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">four_points</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	four_points<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	four_points<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	four_points<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	four_points<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p4<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>io<span class="token double-colon punctuation">::</span><span class="token function">savePCDFile</span><span class="token punctuation">(</span><span class="token string">"four_points.pcd"</span><span class="token punctuation">,</span> <span class="token operator">*</span>four_points<span class="token punctuation">)</span><span class="token punctuation">;</span>

	Eigen<span class="token double-colon punctuation">::</span>VectorXf <span class="token function">line_a</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">line_b</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	line_a <span class="token operator">&lt;&lt;</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z <span class="token operator">-</span> p2<span class="token punctuation">.</span>z<span class="token punctuation">;</span>
	line_b <span class="token operator">&lt;&lt;</span> p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>z<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>x <span class="token operator">-</span> p4<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>y <span class="token operator">-</span> p4<span class="token punctuation">.</span>y<span class="token punctuation">,</span> p3<span class="token punctuation">.</span>z <span class="token operator">-</span> p4<span class="token punctuation">.</span>z<span class="token punctuation">;</span>

	Eigen<span class="token double-colon punctuation">::</span>Vector4f pt1_seg<span class="token punctuation">,</span> pt2_seg<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span><span class="token function">lineToLineSegment</span><span class="token punctuation">(</span>line_a<span class="token punctuation">,</span> line_b<span class="token punctuation">,</span> pt1_seg<span class="token punctuation">,</span> pt2_seg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointXYZ <span class="token function">p5</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pt1_seg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span> pt2_seg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pt1_seg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> pt2_seg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pt1_seg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> pt2_seg<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">float</span> d1 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//d1=|b1-b2|</span>
	<span class="token keyword">float</span> d2 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p4<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//d2=|b3-b4|</span>
	<span class="token keyword">float</span> r1 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p5<span class="token punctuation">)</span> <span class="token operator">/</span> d1<span class="token punctuation">;</span>	<span class="token comment">//r1=|b1-e| / |b1-b2|</span>
	<span class="token keyword">float</span> r2 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>p3<span class="token punctuation">,</span> p5<span class="token punctuation">)</span> <span class="token operator">/</span> d2<span class="token punctuation">;</span>	<span class="token comment">//r2=|b3-e| / |b3-b4|</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> d1 <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> d2 <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> r1 <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> r2 <span class="token operator">&lt;&lt;</span>  std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token punctuation">,</span> pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;&gt;</span> R1<span class="token punctuation">,</span> R2<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> target_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pcl<span class="token double-colon punctuation">::</span>PointXYZ pt1 <span class="token operator">=</span> target_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> target_cloud<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			pcl<span class="token double-colon punctuation">::</span>PointXYZ pt2 <span class="token operator">=</span> target_cloud<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span> <span class="token operator">&gt;</span> d1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> delta<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span> <span class="token operator">&lt;</span> d1 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> delta<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				R1<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">pair</span><span class="token generic class-name"><span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token punctuation">,</span> pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span> <span class="token operator">&gt;</span> d2 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> delta<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">euclideanDistance</span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span> <span class="token operator">&lt;</span> d2 <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> delta<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				R2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">pair</span><span class="token generic class-name"><span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token punctuation">,</span> pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>pt1<span class="token punctuation">,</span> pt2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> R1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> R2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Map1<span class="token punctuation">,</span> Map2<span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">pts1</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">pts2</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> r <span class="token operator">:</span> R1<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pcl<span class="token double-colon punctuation">::</span>PointXYZ p1<span class="token punctuation">,</span> p2<span class="token punctuation">;</span> p3<span class="token punctuation">;</span>
		p1 <span class="token operator">=</span> r<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
		p2 <span class="token operator">=</span> r<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
		p3 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">PointXYZ</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">+</span> r1 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> r1 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z <span class="token operator">+</span> r1 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Map1<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">pair</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pts1<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> r <span class="token operator">:</span> R2<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		pcl<span class="token double-colon punctuation">::</span>PointXYZ p1<span class="token punctuation">,</span> p2<span class="token punctuation">;</span> p3<span class="token punctuation">;</span>
		p1 <span class="token operator">=</span> r<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
		p2 <span class="token operator">=</span> r<span class="token punctuation">.</span>second<span class="token punctuation">;</span>
		p3 <span class="token operator">=</span> pcl<span class="token double-colon punctuation">::</span><span class="token function">PointXYZ</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">+</span> r2 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>x <span class="token operator">-</span> p1<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>y <span class="token operator">+</span> r2 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> p1<span class="token punctuation">.</span>z <span class="token operator">+</span> r2 <span class="token operator">*</span> <span class="token punctuation">(</span>p2<span class="token punctuation">.</span>z <span class="token operator">-</span> p1<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Map2<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">pair</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;&gt;</span></span></span><span class="token punctuation">(</span>r2<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pts2<span class="token operator">-&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	pcl<span class="token double-colon punctuation">::</span>search<span class="token double-colon punctuation">::</span>KdTree<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">kdtree</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>search<span class="token double-colon punctuation">::</span>KdTree<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	kdtree<span class="token operator">-&gt;</span><span class="token function">setInputCloud</span><span class="token punctuation">(</span>pts1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Points4<span class="token operator">&gt;</span> Uvec<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pts2<span class="token operator">-&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> distance<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>kdtree<span class="token operator">-&gt;</span><span class="token function">radiusSearch</span><span class="token punctuation">(</span>pts2<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.001</span> <span class="token operator">*</span> d_max<span class="token punctuation">,</span> indices<span class="token punctuation">,</span> distance<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> indice<span class="token operator">:</span> indices<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Points4 points4<span class="token punctuation">;</span>
				points4<span class="token punctuation">.</span>p1 <span class="token operator">=</span> Map1<span class="token punctuation">[</span>indice<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				points4<span class="token punctuation">.</span>p2 <span class="token operator">=</span> Map1<span class="token punctuation">[</span>indice<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				points4<span class="token punctuation">.</span>p3 <span class="token operator">=</span> Map2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				points4<span class="token punctuation">.</span>p4 <span class="token operator">=</span> Map2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>second<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				Uvec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>points4<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">//points4.p1 = Map1[indice].second[1];</span>
				<span class="token comment">//points4.p2 = Map1[indice].second[0];</span>
				<span class="token comment">//points4.p3 = Map2[i].second[0];</span>
				<span class="token comment">//points4.p4 = Map2[i].second[1];</span>
				<span class="token comment">//Uvec.push_back(points4);</span>

				<span class="token comment">//points4.p1 = Map1[indice].second[0];</span>
				<span class="token comment">//points4.p2 = Map1[indice].second[1];</span>
				<span class="token comment">//points4.p3 = Map2[i].second[1];</span>
				<span class="token comment">//points4.p4 = Map2[i].second[0];</span>
				<span class="token comment">//Uvec.push_back(points4);</span>

				<span class="token comment">//points4.p1 = Map1[indice].second[1];</span>
				<span class="token comment">//points4.p2 = Map1[indice].second[0];</span>
				<span class="token comment">//points4.p3 = Map2[i].second[1];</span>
				<span class="token comment">//points4.p4 = Map2[i].second[0];</span>
				<span class="token comment">//Uvec.push_back(points4);</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> Uvec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

	<span class="token keyword">int</span> max_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	Eigen<span class="token double-colon punctuation">::</span>Matrix4f transformation<span class="token punctuation">;</span>
	kdtree<span class="token operator">-&gt;</span><span class="token function">setInputCloud</span><span class="token punctuation">(</span>target_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Uvec<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//if (i % 1000 == 0 &amp;&amp; i&gt; 0)	</span>
		<span class="token comment">//std::cout &lt;&lt; i &lt;&lt; std::endl;</span>

		pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Ptr <span class="token function">temp</span><span class="token punctuation">(</span><span class="token keyword">new</span> pcl<span class="token double-colon punctuation">::</span>PointCloud<span class="token operator">&lt;</span>pcl<span class="token double-colon punctuation">::</span>PointXYZ<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		temp<span class="token operator">-&gt;</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		temp<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> Uvec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p1<span class="token punctuation">;</span>
		temp<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> Uvec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p2<span class="token punctuation">;</span>
		temp<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> Uvec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p3<span class="token punctuation">;</span>
		temp<span class="token operator">-&gt;</span>points<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> Uvec<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p4<span class="token punctuation">;</span>

		Eigen<span class="token double-colon punctuation">::</span>Vector4f pts1_centroid<span class="token punctuation">,</span> pts2_centroid<span class="token punctuation">;</span>
		pcl<span class="token double-colon punctuation">::</span><span class="token function">compute3DCentroid</span><span class="token punctuation">(</span><span class="token operator">*</span>four_points<span class="token punctuation">,</span> pts1_centroid<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pcl<span class="token double-colon punctuation">::</span><span class="token function">compute3DCentroid</span><span class="token punctuation">(</span><span class="token operator">*</span>temp<span class="token punctuation">,</span> pts2_centroid<span class="token punctuation">)</span><span class="token punctuation">;</span>

		Eigen<span class="token double-colon punctuation">::</span>MatrixXf pts1_cloud<span class="token punctuation">,</span> pts2_cloud<span class="token punctuation">;</span>
		pcl<span class="token double-colon punctuation">::</span><span class="token function">demeanPointCloud</span><span class="token punctuation">(</span><span class="token operator">*</span>four_points<span class="token punctuation">,</span> pts1_centroid<span class="token punctuation">,</span> pts1_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pcl<span class="token double-colon punctuation">::</span><span class="token function">demeanPointCloud</span><span class="token punctuation">(</span><span class="token operator">*</span>temp<span class="token punctuation">,</span> pts2_centroid<span class="token punctuation">,</span> pts2_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>

		Eigen<span class="token double-colon punctuation">::</span>MatrixXf W <span class="token operator">=</span> <span class="token punctuation">(</span>pts1_cloud <span class="token operator">*</span> pts2_cloud<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">topLeftCorner</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>JacobiSVD<span class="token operator">&lt;</span>Eigen<span class="token double-colon punctuation">::</span>MatrixXf<span class="token operator">&gt;</span> <span class="token function">svd</span><span class="token punctuation">(</span>W<span class="token punctuation">,</span> Eigen<span class="token double-colon punctuation">::</span>ComputeFullU <span class="token operator">|</span> Eigen<span class="token double-colon punctuation">::</span>ComputeFullV<span class="token punctuation">)</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>Matrix3f V <span class="token operator">=</span> svd<span class="token punctuation">.</span><span class="token function">matrixV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> U <span class="token operator">=</span> svd<span class="token punctuation">.</span><span class="token function">matrixU</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>U<span class="token punctuation">.</span><span class="token function">determinant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> V<span class="token punctuation">.</span><span class="token function">determinant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token operator">++</span>x<span class="token punctuation">)</span>
				<span class="token function">V</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		Eigen<span class="token double-colon punctuation">::</span>Matrix3f R <span class="token operator">=</span> V <span class="token operator">*</span> U<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>Vector3f T <span class="token operator">=</span> pts2_centroid<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span> R <span class="token operator">*</span> pts1_centroid<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Eigen<span class="token double-colon punctuation">::</span>Matrix4f H<span class="token punctuation">;</span>
		H <span class="token operator">&lt;&lt;</span> R<span class="token punctuation">,</span> T<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">//std::cout &lt;&lt; H &lt;&lt; std::endl;</span>

		pcl<span class="token double-colon punctuation">::</span><span class="token function">transformPointCloud</span><span class="token punctuation">(</span><span class="token operator">*</span>source_cloud<span class="token punctuation">,</span> <span class="token operator">*</span>pcs_cloud<span class="token punctuation">,</span> H<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">compute_LCP</span><span class="token punctuation">(</span><span class="token operator">*</span>pcs_cloud<span class="token punctuation">,</span> kdtree<span class="token punctuation">,</span> <span class="token number">0.0001</span> <span class="token operator">*</span> d_max<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> max_count<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> count <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> H <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
			max_count <span class="token operator">=</span> count<span class="token punctuation">;</span>
			transformation <span class="token operator">=</span> H<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	pcl<span class="token double-colon punctuation">::</span><span class="token function">transformPointCloud</span><span class="token punctuation">(</span><span class="token operator">*</span>source_cloud<span class="token punctuation">,</span> <span class="token operator">*</span>pcs_cloud<span class="token punctuation">,</span> transformation<span class="token punctuation">)</span><span class="token punctuation">;</span>
	pcl<span class="token double-colon punctuation">::</span>io<span class="token double-colon punctuation">::</span><span class="token function">savePCDFile</span><span class="token punctuation">(</span><span class="token string">"result.pcd"</span><span class="token punctuation">,</span> <span class="token operator">*</span>pcs_cloud<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>算法的流程基本上和原理能对得上，但是实现过程中发现该算法结果不太稳定。可能实现有些问题吧，希望有懂的大神指出来（逃~）</p> 
<p>参考：<br> <a href="https://blog.csdn.net/weixin_42755079/article/details/126638986">3D点云配准算法-4PCS（4点全等集配准算法）</a><br> <a href="https://blog.csdn.net/xinxiangwangzhi_/article/details/125362934">点云配准–4PCS原理与应用</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0ce0196c0aef1ba1ab95a222b39454f1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【LLM教程-llama】如何Fine Tuning大语言模型？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2e68a18bcd72819b45ba6c1a095d18e0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;】string基本用法（常用接口介绍）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>