<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【unity2021-2023打包安卓工程】踩坑记录 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8bf36a3cc86ea595bf3539fddf463e87/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【unity2021-2023打包安卓工程】踩坑记录">
  <meta property="og:description" content="这里写自定义目录标题 踩坑记录使用环境Unity的准备工作Windows10 SDKAndroidstudio第一个需要注意的地方第二个需要注意的地方第三个需要注意的地方第四个需要注意的地方第五个需要注意的地方第六个需要注意的 其他unity启动缓慢 更新更新一 2023.9.27 unity2021关于在Androidstudio打包aar供unity调用的问题关于unity调用aar包打包时出现的问题关于unity打包成apk出现的问题关于打包一直出现mutidex exception的问题问题描述解决方案原因 踩坑记录 踩了快一个星期的坑，希望能帮助到有需要的人
项目使用的是unity2019版本，由于很多新的插件和功能都已经不支持2019了，所以升级unity的版本
在升级版本的过程中遇到了很多的问题，因为本身基础较差，加之比较新，网上能找到的解决办法少之又少，当然也存在不希望外露保持技术神秘感的大神…
扯远了，在这里记录一下踩坑的过程以及解决办法
使用环境 Androidstudio 2022.3 - - -最好是比较新的像4.11左右或者一下的就尽量不要用了，老版本在打包的时候会弹出异常，提示某些以前在build.gradle里的关键字已经失效了，要用新的去代替
unity 2023 - - -安卓打包相关的工具
windows10 sdk 10.0.1314 - - - 后面会说是干嘛的
ndk r23b - - - 后面会上传附件
sdk 28及以上- - -后面会上传附件，也可以在as官网里下
gradle 7.6.0 - - - 这个在安卓工程里的gradle-wrapper.properties里可以修改
gradle插件 7.4.1 - - - 这个需要和gradle进行匹配，网上可以根据gradle找到对应的版本 在项目根目录下的build.gradle里
Unity的准备工作 在unityhub下载unity2023 我的是2023.1.12f
下载对应的安卓环境（同事亲测它帮我们下的安卓环境是有问题的，比如unit2023打包安卓至少是jdk11，但是它帮我们下的jdk还是8的）
下载之后选择安卓环境打开项目，然后制作你的项目
写完代码后可以现在unity打包成apk看看能不能正常打包运行
如果要打包的话，需要自己安装jdk11
然后在
上图的位置去掉勾勾，选择你安装好的jdk11的路径
后面的sdk和ndk，gradle都是一样的道理，当然你可以先用默认的打包看看有没有问题，有的话再去下载我上面说的sdk和ndk版本，然后在上图修改对应的路径
到这里应该就能正常打包了
为什么说可以先试一下官方默认给你的环境路径去打包呢，因为这个2023可能太新了，官方还没有适配还是什么的，后面可能就发现了这个问题，指不定后面的你们去打包的时候他已经适配好了呢是吧？
打包的设置
我使用的是il2cpp的打包模式，mono的还没试过,不过估计比il2cpp简单很多
记得在playersettings里确定下面两个都勾上了">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-25T18:23:24+08:00">
    <meta property="article:modified_time" content="2024-05-25T18:23:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【unity2021-2023打包安卓工程】踩坑记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>这里写自定义目录标题</h4> 
 <ul><li><a href="#_2" rel="nofollow">踩坑记录</a></li><li><ul><li><a href="#_10" rel="nofollow">使用环境</a></li><li><a href="#Unity_19" rel="nofollow">Unity的准备工作</a></li><li><a href="#Windows10_SDK_37" rel="nofollow">Windows10 SDK</a></li><li><a href="#Androidstudio_47" rel="nofollow">Androidstudio</a></li><li><ul><li><a href="#_62" rel="nofollow">第一个需要注意的地方</a></li><li><a href="#_69" rel="nofollow">第二个需要注意的地方</a></li><li><a href="#_72" rel="nofollow">第三个需要注意的地方</a></li><li><a href="#_77" rel="nofollow">第四个需要注意的地方</a></li><li><a href="#_82" rel="nofollow">第五个需要注意的地方</a></li><li><a href="#_89" rel="nofollow">第六个需要注意的</a></li></ul> 
   </li><li><a href="#_94" rel="nofollow">其他</a></li><li><ul><li><a href="#unity_95" rel="nofollow">unity启动缓慢</a></li></ul> 
   </li><li><a href="#_102" rel="nofollow">更新</a></li><li><ul><li><a href="#_2023927_103" rel="nofollow">更新一 2023.9.27</a></li></ul> 
  </li></ul> 
  </li><li><a href="#unity2021_116" rel="nofollow">unity2021</a></li><li><ul><li><a href="#Androidstudioaarunity_117" rel="nofollow">关于在Androidstudio打包aar供unity调用的问题</a></li><li><a href="#unityaar_127" rel="nofollow">关于unity调用aar包打包时出现的问题</a></li><li><a href="#unityapk_130" rel="nofollow">关于unity打包成apk出现的问题</a></li><li><a href="#mutidex_exception_150" rel="nofollow">关于打包一直出现mutidex exception的问题</a></li><li><ul><li><a href="#_151" rel="nofollow">问题描述</a></li><li><a href="#_160" rel="nofollow">解决方案</a></li><li><a href="#_162" rel="nofollow">原因</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>踩坑记录</h2> 
<blockquote> 
 <p>踩了快一个星期的坑，希望能帮助到有需要的人</p> 
</blockquote> 
<p>项目使用的是unity2019版本，由于很多新的插件和功能都已经不支持2019了，所以升级unity的版本<br> 在升级版本的过程中遇到了很多的问题，因为本身基础较差，加之比较新，网上能找到的解决办法少之又少，当然也存在不希望外露保持技术神秘感的大神…<br> 扯远了，在这里记录一下踩坑的过程以及解决办法</p> 
<h3><a id="_10"></a>使用环境</h3> 
<p>Androidstudio 2022.3 - - -最好是比较新的像4.11左右或者一下的就尽量不要用了，老版本在打包的时候会弹出异常，提示某些以前在build.gradle里的关键字已经失效了，要用新的去代替<br> unity 2023 - - -安卓打包相关的工具<br> windows10 sdk 10.0.1314 - - - 后面会说是干嘛的<br> ndk r23b - - - 后面会上传附件<br> sdk 28及以上- - -后面会上传附件，也可以在as官网里下<br> gradle 7.6.0 - - - 这个在安卓工程里的gradle-wrapper.properties里可以修改<br> gradle插件 7.4.1 - - - 这个需要和gradle进行匹配，网上可以根据gradle找到对应的版本 在项目根目录下的build.gradle里</p> 
<h3><a id="Unity_19"></a>Unity的准备工作</h3> 
<p>在unityhub下载unity2023 我的是2023.1.12f<br> 下载对应的安卓环境（同事亲测它帮我们下的安卓环境是有问题的，比如unit2023打包安卓至少是jdk11，但是它帮我们下的jdk还是8的）<br> 下载之后选择安卓环境打开项目，然后制作你的项目<br> 写完代码后可以现在unity打包成apk看看能不能正常打包运行<br> 如果要打包的话，需要自己安装jdk11<br> 然后在<br> <img src="https://images2.imgbox.com/14/89/ZCqOmwLk_o.png" alt="在这里插入图片描述"><br> 上图的位置去掉勾勾，选择你安装好的jdk11的路径<br> 后面的sdk和ndk，gradle都是一样的道理，当然你可以先用默认的打包看看有没有问题，有的话再去下载我上面说的sdk和ndk版本，然后在上图修改对应的路径<br> 到这里应该就能正常打包了<br> 为什么说可以先试一下官方默认给你的环境路径去打包呢，因为这个2023可能太新了，官方还没有适配还是什么的，后面可能就发现了这个问题，指不定后面的你们去打包的时候他已经适配好了呢是吧？<br> 打包的设置<br> 我使用的是il2cpp的打包模式，mono的还没试过,不过估计比il2cpp简单很多<br> 记得在playersettings里确定下面两个都勾上了<br> <img src="https://images2.imgbox.com/04/e1/qPxwDW1b_o.png" alt="在这里插入图片描述"><br> 然后unity的工作就基本结束了</p> 
<h3><a id="Windows10_SDK_37"></a>Windows10 SDK</h3> 
<p>在unity工程集成到Androidstudio之前还需要确保一个工具已经准备好了<br> 就是window10 SDK<br> 这个可以在vs installer里点击修改<br> <img src="https://images2.imgbox.com/f9/b5/fMxdF1wI_o.png" alt="在这里插入图片描述"></p> 
<p>然后点击<br> <img src="https://images2.imgbox.com/1a/de/MmOpdzyF_o.png" alt="在这里插入图片描述"><br> 确保你的电脑已经至少又一个Windows10 sdk了，否则在集成之后打包的过程中会出现异常<br> 具体的说就是il2cpp在打包的时候会调用c++这类比较底层的代码，而在Androidstudio中调用的时候会需要用到系统里的c++部分代码，其中的内容就是在这个Windows10 sdk里，如果你没有的话，打包的时候就会提示你error # include &lt;string.h&gt;类似的字样，导致打包失败</p> 
<h3><a id="Androidstudio_47"></a>Androidstudio</h3> 
<p>这里的部分比较复杂，我尽量剪短一点说明<br> 因为是在Androidstudio里进行整体打包的，所以这里的打包环境一定要确定是正确的（也就是说每个工具之间的版本一定要是兼容和匹配的）<br> 如果不匹配的话就会出现很多你在网上根本找不到原因和办法的异常，因为它给出的异常信息就少之又少，所以寻找解决办法就是在大海捞针<br> 每个工具之间的版本我在上面已经写了，如果你的工具版本和我的不一样，需要自己去尝试<br> 如果比我低很多的，建议你用我上面推荐的版本，因为版本太低的工具基本上是被淘汰了，其他的工具已经不支持了<br> 比如你的sdk和ndk都是比较新的，但是你的gradle还是老的版本<br> 再具体一点就是sdk是34，nkd是r23b的，但是你的gradle版本还在4.0或者附近的话，在打包的时候就会出现提示你某些xml里的属性不见了，就是因为不兼容的问题导致的<br> 所以如果你遇到了异常但是又弹尽粮绝的话，可以尝试更新工具的版本<br> 在projectsettings里设置你的sdk，ndk以及jdk<br> 然后按照官方给出的unity集成到Androidstudio的流程进行操作</p> 
<blockquote> 
 <p>https://github.com/Unity-Technologies/uaal-example/blob/master/docs/android.md</p> 
</blockquote> 
<p>把unity打包出来的安卓工程里的unitylibrary集成到Androidstudio里</p> 
<h4><a id="_62"></a>第一个需要注意的地方</h4> 
<p>官方里说的<br> <img src="https://images2.imgbox.com/e3/b5/pbtpIuf3_o.png" alt="在这里插入图片描述"><br> 在setting.gradle里添加框框里的内容的需要修改<br> 我使用的Androidstudio2022<br> 需要把框框里的内容放到项目根目录下的build.gradle里</p> 
<h4><a id="_69"></a>第二个需要注意的地方</h4> 
<p>下图框框里的路径你记得改成你的unitylibrary的路径，不要直接复制粘贴，我就是直接复制粘贴了，sync半天都没识别到unitylibrary…<br> <img src="https://images2.imgbox.com/23/d0/km8tXkZ5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_72"></a>第三个需要注意的地方</h4> 
<p>Androidstudio 2022版本好提示你包名的设置已经更换了新的规则，需要进行修改<br> 在主模板里的builder.gradle添加这个<br> <img src="https://images2.imgbox.com/da/ef/nKyH2JDe_o.png" alt="在这里插入图片描述"><br> 不能在AndroidManifest.xml里添加packagename这个字段了，否则会报异常</p> 
<h4><a id="_77"></a>第四个需要注意的地方</h4> 
<p>需要在<br> <img src="https://images2.imgbox.com/5e/c3/92n4tt8X_o.png" alt="在这里插入图片描述"><br> string.xml文件中添加上面这行代码，否则会弹出recources x00之类的异常<br> 这个是老问题了，之前的版本打包的时候也会又这个问题</p> 
<h4><a id="_82"></a>第五个需要注意的地方</h4> 
<p>在项目根目录的local.properties文件里<br> 可以指定一下你的sdk和ndk的路径<br> 不指定的话就在projectsettings里进行选择<br> Androidstudio2022已经不支持在buidl.gradle的defaultconfig里添加ndk这个关键词了<br> 直接在外面添加ndkversion就可以了<br> <img src="https://images2.imgbox.com/ae/1d/MKO9qrvT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_89"></a>第六个需要注意的</h4> 
<p>正常的普通项目，上面都解决了的话应该就可以正常打包了<br> 如果项目中用到了阿里的arouter插件<br> 在进行打包的时候会提示异常， asm 7之类的，这个问题目前还没有解决，由于时间关系只能先用回2019的旧版本<br> 试试2021的版本可不可以打包成功吧…</p> 
<h3><a id="_94"></a>其他</h3> 
<h4><a id="unity_95"></a>unity启动缓慢</h4> 
<p>（该问题已解决，可往下看）<br> 这个问题之前的版本也有，一直不知道原因，就是单纯的unity集成到Androidstudio之后，进行调用打开，需要等很长的一段时间，这个问题在更新了unity和Androidstudio之后还是会有，如果有大佬知道原因的话务必解一下小弟的困惑<br> 就先记录这么多吧，研究了快一个星期了…<br> 可能还有一点遗漏的，想起来的话会再更新的…<br> 希望可以帮助到有需要的人…</p> 
<h3><a id="_102"></a>更新</h3> 
<h4><a id="_2023927_103"></a>更新一 2023.9.27</h4> 
<p>unity2023版会出现arouter插件的兼容问题<br> 亲测unity2021版可以正常使用<br> 另外提及一下，关于unity集成到安卓项目中作为一个module，在跳转的时候出现的等待时间过长问题<br> 已经发现了解决的思路以及问题所在<br> 涉及到各方面的因素，这里就只说明解决思路<br> 我们发现，在unity自己打包出来的apk运行是不会出现等待时间过长的情况的，但是为什么集成到安卓工程之后就出现了这个问题呢，很明显是在安卓工程中我们遗漏了一些配置或者说是操作<br> 检查unityi打包出来的unitylibaray我们可以发现<br> 文件里又一个laucher的文件，这个文件就是unity自己写的类似安卓工程里的app这个主模块<br> 抱着试一试的操作我去检查了一下unity自己打包出来的和安卓原生的app主模块里配置文件的区别，发现果然是这里的问题<br> 实际说到这里已经很清楚了，后面的我就细说了。<br> 这个问题可以说困扰了我两三年之久，当然实际肯定没这么久的，毕竟中间我也很少关注这个问题以及安卓工程一些打包的知识，不过这个解决的思路我确实受益匪浅，通过比较两者的区别去找到解决问题的关键点，嘛，虽然之前也有尝试过，不过确实也是因为基础太差了，也没人引导</p> 
<h2><a id="unity2021_116"></a>unity2021</h2> 
<h3><a id="Androidstudioaarunity_117"></a>关于在Androidstudio打包aar供unity调用的问题</h3> 
<p>这里只说unity的问题<br> 如果在安卓中调用打好的aar一切正常，放在unity里打包时出现了类似</p> 
<pre><code>Android Error：AAPT: error: resource android:attr/colorError not found
</code></pre> 
<p>这样的问题，大概率是因为unity和你的Androidstudio需要的依赖的版本不一样导致的<br> 这个时候需要去查看Androidstudio里的build.gradle你所添加的插件的依赖版本和unity里的是否一致，不一致的会直接复制Androidstudio里的然后重新打包即可</p> 
<h3><a id="unityaar_127"></a>关于unity调用aar包打包时出现的问题</h3> 
<p>如果unity需要调用aar包，在打包的时候出现了关于minisdk相关的异常信息，需要比较一下unity里的minisdkversion和aar包里的sdkversion是否一致，不一致的话最好保持一致</p> 
<h3><a id="unityapk_130"></a>关于unity打包成apk出现的问题</h3> 
<p>问题如下，在assets的plugins的Android里添加了aar包，然后测试打包的时候出现了multiple dex classes之类的字样的异常<br> 在未添加新的aar包之前，直接进行打包是正常的<br> 我的解决思路是</p> 
<ol><li>在网上看了可能是library缓存的问题，于是删掉了然后重新打开unity进行打包，无效</li><li>可能是添加了新的aar包的问题，所以我试着删掉了aar包，重新打包，无效</li><li>而且在第二个的操作之后，即使我想按照原来的项目代码去打包原来的apk也一直在报这个错</li><li>在lunch gradle 里添加了如下代码<br> <img src="https://images2.imgbox.com/4f/b0/FbaUfl57_o.png" alt="在这里插入图片描述"> 无效</li><li>我试着先不打包apk，打包成安卓工程然后导入到as里面，然后再进行打包，发现是OK的，所以问题就出在unity的laugh gradle里面</li><li>可能是gradle和jdk和sdk和ndk之间版本不同的导致的，我把unity里的gradle，ndk和sdk个版本都跟Androidstudio里的保持了一致，还是无法进行正常打包，推测可能是jdk的版本问题，但是unity2021只支持jdk8，因此只能另寻他法，无效</li><li>由于打包的方式是mono，所以关于打包build出来的信息都在<br> <img src="https://images2.imgbox.com/12/49/aJNPjMEK_o.png" alt="在这里插入图片描述"><br> 这里面，这里就是问题所在了，这个build出来的信息和Androidstudio里的build一样的， 如果有新的内容加进来，然后又删掉了，build里偶尔是会出现内容没有清理完全的情况的，因此要删掉这个文件里的下面两个文件夹里的build<br> <img src="https://images2.imgbox.com/96/a4/9h5pmJmF_o.png" alt="在这里插入图片描述"></li></ol> 
<p>最后是lancher和unitylibaray两个的build 都删掉比较保险，反正build会在你打包的时候自动重新生成的，所以可以放心删除</p> 
<h3><a id="mutidex_exception_150"></a>关于打包一直出现mutidex exception的问题</h3> 
<h4><a id="_151"></a>问题描述</h4> 
<p>在进行打包的时候，可能不同的插件/库之间会出现使用相同的包依赖的情况,需要找到并且去掉其中一个,或者使用· <code>multiDexEnabled true</code>+<code> implementation 'com.android.support:multidex:2.0.1'</code>两行代码进行兼容<br> 但是我在保证没有相同包依赖的情况下打包还是出现了该问题<br> 并且该问题和网上其他的人出现的异常都不太一样<br> 之前因为时间问题，在unity安卓使用il2cpp export出安卓工程是没问题的，而我们的项目最终是在andriodstudio导包的，因此一直没有去找原因<br> 最近因为项目需要更换了电脑<br> 第一次打包是正常的，今天进行打包又出现了这个问题<br> 耗费了一整天的时间才找到问题的关键</p> 
<h4><a id="_160"></a>解决方案</h4> 
<p><code>修改包名</code>即可,如果不行可能是缓存的问题,因此找到library删掉里面的bee文件,重新启动unity即可</p> 
<h4><a id="_162"></a>原因</h4> 
<p>项目在不同的unity版本之间都试过了，而包名没有修改，因此在缓存中一直存在相同的dex文件，在打包的时候，manifest.xml中的packagename导致了重复，因此出现了这个异常，所以只需要修改包名之后打包即可解决问题|~</p> 
<p>·</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6283d475e9ea79ef19182042a92e5cd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在 Python 中将语音转换为文本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b75110b67a3f02bf7ae292b3f48fd4ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深度学习之父 Hinton 万字访谈录：中美 AI 竞赛没有退路可言（GPT-4o总结版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>