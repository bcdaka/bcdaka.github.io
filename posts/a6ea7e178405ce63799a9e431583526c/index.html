<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用腾讯云语音合成（TTS）批量生成英语绘本的朗读音频 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a6ea7e178405ce63799a9e431583526c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="用腾讯云语音合成（TTS）批量生成英语绘本的朗读音频">
  <meta property="og:description" content="孩子进行英语启蒙，需要看很多英语绘本，而且要听配套的音频来练听力。但有些英语绘本是没有对应音频的，下面简单几步，就可以将任意英语绘本制作出对应的英语朗读音频。
先到电子书资源网站搜索这个绘本名称，如果有电子书，可以直接下载，最好是pdf格式的；
如果没有电子书，但是有实体书，比如从图书馆借的绘本，可以用手机拍照做成PDF文件。
绘本每一页拍照后，按照页码顺序选择，然后点击：更多——打印或生成PDF
点击右上角，选择：另存为PDF
选择一个文件夹，保存，然后将这个PDF文件传输到电脑。
得到绘本的PDF文件后，然后申请一个腾讯云的账号，新用户可以领取一个语音合成的免费资源包，内含800万调用字符，有效期为3个月。语音合成（Text To Speech，TTS）可以将文本转化成拟人化语音，提供多种音色选择，支持自定义音量、语速，让发音更自然、更专业、更符合场景需求。语音合成可以应用于语音导航、有声读物、机器人、语音助手、自动新闻播报等场景。
不过注意，这个语音合成-通用免费资源包不含长文本，一次最多只能支持500个英文字母的语音合成。
然后，在deepseek输入框中输入提示词：
你是一个Python编程专家，要写一个通过腾讯云的语音合成API进行批量AI英语语音合成的Python脚本，具体步骤如下：
腾讯云SecretId:XXX，SecretKey:XXX
读取文件夹“F:\aivideo”中的pdf文件，如果pdf文件是图像格式，调用Tesseract进行OCR文本识别，提取出全部的文本内容；如果不是图像格式，直接提取其全部文本内容；
对于每个pdf文件，创建一个TextToVoice基础语音合成任务（语言为英语），然后定期检查任务状态，直到任务完成或失败。完成后，将语音合成结果保存到本地文件。识别结果保存到文件夹：F:\\aivideo ，文件名为对应的pdf文件名，格式为mp3，采样率为16000 Hz
注意：
一次请求有字数限制：英文最大支持400个字母，包括标点符号在内。如果pdf文本中字母超过400个，要对文本进行拆分，然后语音合成，语音合成完成后，按顺序把语音文件合并成一个。
在保存音频文件时，需要确保传入的是字节对象而不是字符串。
如果创建任务或查询状态时发生错误，应该打印错误信息；
每一步都要输出信息到屏幕上；
输出参数
参数名称类型描述
AudioStringbase64编码的wav/mp3音频数据
示例值：UklGRlR/AABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YSx9AAD&#43;
输出示例：
{
&#34;Response&#34;: {
&#34;Audio&#34;: &#34;UklGRqRwAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YYBwAAAA......AAAAA=&#34;,
&#34;RequestId&#34;: &#34;d91f1496-0514-4281-932e-15a022b67d16&#34;,
&#34;SessionId&#34;: &#34;session-1234&#34;,
&#34;Subtitles&#34;: [
{
&#34;BeginIndex&#34;: 0,
&#34;BeginTime&#34;: 250,
&#34;EndIndex&#34;: 1,
&#34;EndTime&#34;: 430,
&#34;Phoneme&#34;: &#34;ni2&#34;,
&#34;Text&#34;: &#34;你&#34;
},
{
&#34;BeginIndex&#34;: 1,
&#34;BeginTime&#34;: 430,
&#34;EndIndex&#34;: 2,
&#34;EndTime&#34;: 670,
&#34;Phoneme&#34;: &#34;hao3&#34;,
&#34;Text&#34;: &#34;好&#34;
}
]
}
}">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-23T16:32:03+08:00">
    <meta property="article:modified_time" content="2024-06-23T16:32:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用腾讯云语音合成（TTS）批量生成英语绘本的朗读音频</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>孩子进行英语启蒙，需要看很多英语绘本，而且要听配套的音频来练听力。但有些英语绘本是没有对应音频的，下面简单几步，就可以将任意英语绘本制作出对应的英语朗读音频。</p> 
<p>先到电子书资源网站搜索这个绘本名称，如果有电子书，可以直接下载，最好是pdf格式的；</p> 
<p>如果没有电子书，但是有实体书，比如从图书馆借的绘本，可以用手机拍照做成PDF文件。</p> 
<p></p> 
<p class="img-center"><img alt="" height="467" src="https://images2.imgbox.com/5b/58/H9gQQkJp_o.png" width="720"></p> 
<p>绘本每一页拍照后，按照页码顺序选择，然后点击：更多——打印或生成PDF</p> 
<p></p> 
<p class="img-center"><img alt="" height="529" src="https://images2.imgbox.com/48/ac/QBxMID68_o.png" width="720"></p> 
<p>点击右上角，选择：另存为PDF</p> 
<p></p> 
<p class="img-center"><img alt="" height="549" src="https://images2.imgbox.com/1f/2f/ijcl5yzM_o.png" width="720"></p> 
<p>选择一个文件夹，保存，然后将这个PDF文件传输到电脑。</p> 
<p>得到绘本的PDF文件后，然后申请一个腾讯云的账号，新用户可以领取一个语音合成的免费资源包，内含800万调用字符，有效期为3个月。语音合成（Text To Speech，TTS）可以将文本转化成拟人化语音，提供多种音色选择，支持自定义音量、语速，让发音更自然、更专业、更符合场景需求。语音合成可以应用于语音导航、有声读物、机器人、语音助手、自动新闻播报等场景。</p> 
<p></p> 
<p class="img-center"><img alt="" height="341" src="https://images2.imgbox.com/df/4e/UvLiu4VR_o.png" width="720"></p> 
<p>不过注意，这个语音合成-通用免费资源包不含长文本，一次最多只能支持500个英文字母的语音合成。</p> 
<p>然后，在deepseek输入框中输入提示词：</p> 
<p>你是一个Python编程专家，要写一个通过腾讯云的语音合成API进行批量AI英语语音合成的Python脚本，具体步骤如下：</p> 
<p>腾讯云SecretId:XXX，SecretKey:XXX</p> 
<p>读取文件夹“F:\aivideo”中的pdf文件，如果pdf文件是图像格式，调用Tesseract进行OCR文本识别，提取出全部的文本内容；如果不是图像格式，直接提取其全部文本内容；</p> 
<p>对于每个pdf文件，创建一个TextToVoice基础语音合成任务（语言为英语），然后定期检查任务状态，直到任务完成或失败。完成后，将语音合成结果保存到本地文件。识别结果保存到文件夹：F:\\aivideo ，文件名为对应的pdf文件名，格式为mp3，采样率为16000 Hz</p> 
<p>注意：</p> 
<p>一次请求有字数限制：英文最大支持400个字母，包括标点符号在内。如果pdf文本中字母超过400个，要对文本进行拆分，然后语音合成，语音合成完成后，按顺序把语音文件合并成一个。</p> 
<p>在保存音频文件时，需要确保传入的是字节对象而不是字符串。</p> 
<p>如果创建任务或查询状态时发生错误，应该打印错误信息；</p> 
<p>每一步都要输出信息到屏幕上；</p> 
<p>输出参数</p> 
<p>参数名称类型描述</p> 
<p>AudioStringbase64编码的wav/mp3音频数据</p> 
<p>示例值：UklGRlR/AABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YSx9AAD+</p> 
<p>输出示例：</p> 
<p>{<!-- --></p> 
<p>"Response": {<!-- --></p> 
<p>"Audio": "UklGRqRwAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YYBwAAAA......AAAAA=",</p> 
<p>"RequestId": "d91f1496-0514-4281-932e-15a022b67d16",</p> 
<p>"SessionId": "session-1234",</p> 
<p>"Subtitles": [</p> 
<p>{<!-- --></p> 
<p>"BeginIndex": 0,</p> 
<p>"BeginTime": 250,</p> 
<p>"EndIndex": 1,</p> 
<p>"EndTime": 430,</p> 
<p>"Phoneme": "ni2",</p> 
<p>"Text": "你"</p> 
<p>},</p> 
<p>{<!-- --></p> 
<p>"BeginIndex": 1,</p> 
<p>"BeginTime": 430,</p> 
<p>"EndIndex": 2,</p> 
<p>"EndTime": 670,</p> 
<p>"Phoneme": "hao3",</p> 
<p>"Text": "好"</p> 
<p>}</p> 
<p>]</p> 
<p>}</p> 
<p>}</p> 
<p></p> 
<p class="img-center"><img alt="" height="389" src="https://images2.imgbox.com/f0/a4/SCuqqrSR_o.png" width="720"></p> 
<p>Deepseek生成的源代码：</p> 
<p>import os</p> 
<p>import time</p> 
<p>import json</p> 
<p>import base64</p> 
<p>import PyPDF2</p> 
<p>import pytesseract</p> 
<p>from pdf2image import convert_from_path</p> 
<p>from tencentcloud.common import credential</p> 
<p>from tencentcloud.common.profile.client_profile import ClientProfile</p> 
<p>from tencentcloud.common.profile.http_profile import HttpProfile</p> 
<p>from tencentcloud.common.exception.tencent_cloud_sdk_exception import TencentCloudSDKException</p> 
<p>from tencentcloud.tts.v20190823 import tts_client, models</p> 
<p>import moviepy.editor as mp</p> 
<p># 腾讯云API的SecretId和SecretKey</p> 
<p>SECRET_ID = "XXX"</p> 
<p>SECRET_KEY = "XXX"</p> 
<p># 文件夹路径</p> 
<p>PDF_FOLDER = "F:\\aivideo"</p> 
<p>def extract_text_from_pdf(pdf_path):</p> 
<p>try:</p> 
<p># 尝试使用PyPDF2读取PDF文本</p> 
<p>with open(pdf_path, 'rb') as file:</p> 
<p>reader = PyPDF2.PdfFileReader(file)</p> 
<p>text = ""</p> 
<p>for page_num in range(reader.numPages):</p> 
<p>page = reader.getPage(page_num)</p> 
<p>text += page.extract_text()</p> 
<p>return text</p> 
<p>except:</p> 
<p># 如果失败，使用pdf2image和pytesseract进行OCR</p> 
<p>images = convert_from_path(pdf_path)</p> 
<p>text = ""</p> 
<p>for image in images:</p> 
<p>text += pytesseract.image_to_string(image, lang='eng')</p> 
<p>return text</p> 
<p>def split_text(text, max_length=400):</p> 
<p>words = text.split()</p> 
<p>chunks = []</p> 
<p>current_chunk = []</p> 
<p>current_length = 0</p> 
<p>for word in words:</p> 
<p>if current_length + len(word) + 1 &gt; max_length:</p> 
<p>chunks.append(' '.join(current_chunk))</p> 
<p>current_chunk = [word]</p> 
<p>current_length = len(word)</p> 
<p>else:</p> 
<p>current_chunk.append(word)</p> 
<p>current_length += len(word) + 1</p> 
<p>if current_chunk:</p> 
<p>chunks.append(' '.join(current_chunk))</p> 
<p>return chunks</p> 
<p>def create_tts_task(client, text):</p> 
<p>try:</p> 
<p>req = models.TextToVoiceRequest()</p> 
<p>params = {<!-- --></p> 
<p>"Text": text,</p> 
<p>"SessionId": str(int(time.time())),</p> 
<p>"ModelType": 1,</p> 
<p>"VoiceType": 101001, # 英语女声</p> 
<p>"SampleRate": 16000</p> 
<p>}</p> 
<p>req.from_json_string(json.dumps(params))</p> 
<p>resp = client.TextToVoice(req)</p> 
<p>return resp.Audio</p> 
<p>except TencentCloudSDKException as err:</p> 
<p>print(f"Error creating TTS task: {err}")</p> 
<p>return None</p> 
<p>def save_audio_to_file(audio, file_path):</p> 
<p>with open(file_path, 'wb') as f:</p> 
<p>f.write(base64.b64decode(audio))</p> 
<p>print(f"Audio saved to {file_path}")</p> 
<p>def merge_audio_files(file_paths, output_path):</p> 
<p>clips = [mp.AudioFileClip(f) for f in file_paths]</p> 
<p>final_clip = mp.concatenate_audioclips(clips)</p> 
<p>final_clip.write_audiofile(output_path, codec='mp3')</p> 
<p>for f in file_paths:</p> 
<p>os.remove(f)</p> 
<p>print(f"Merged audio saved to {output_path}")</p> 
<p>def main():</p> 
<p>cred = credential.Credential(SECRET_ID, SECRET_KEY)</p> 
<p>httpProfile = HttpProfile()</p> 
<p>httpProfile.endpoint = "<a href="https://link.zhihu.com/?target=http%3A//tts.tencentcloudapi.com" rel="nofollow" title="http://tts.tencentcloudapi.com">http://tts.tencentcloudapi.com</a>"</p> 
<p>clientProfile = ClientProfile()</p> 
<p>clientProfile.httpProfile = httpProfile</p> 
<p>client = tts_client.TtsClient(cred, "ap-guangzhou", clientProfile)</p> 
<p>for filename in os.listdir(PDF_FOLDER):</p> 
<p>if filename.endswith('.pdf'):</p> 
<p>pdf_path = os.path.join(PDF_FOLDER, filename)</p> 
<p>print(f"Processing {pdf_path}")</p> 
<p>text = extract_text_from_pdf(pdf_path)</p> 
<p>if text:</p> 
<p>chunks = split_text(text)</p> 
<p>audio_files = []</p> 
<p>for i, chunk in enumerate(chunks):</p> 
<p>audio = create_tts_task(client, chunk)</p> 
<p>if audio:</p> 
<p>temp_file_path = os.path.join(PDF_FOLDER, f"temp_{i}.mp3")</p> 
<p>save_audio_to_file(audio, temp_file_path)</p> 
<p>audio_files.append(temp_file_path)</p> 
<p>if audio_files:</p> 
<p>output_file_path = os.path.join(PDF_FOLDER, os.path.splitext(filename)[0] + '.mp3')</p> 
<p>merge_audio_files(audio_files, output_file_path)</p> 
<p>else:</p> 
<p>print(f"No text extracted from {pdf_path}")</p> 
<p>if __name__ == "__main__":</p> 
<p>main()</p> 
<p></p> 
<p class="img-center"><img alt="" height="364" src="https://images2.imgbox.com/7e/1a/7x0P32Fk_o.png" width="945"></p> 
<p>程序运行成功，pdf文本完美的转换为音频文件，朗读音色很自然，和真人非常接近。</p> 
<p></p> 
<p class="img-center"><img alt="" height="361" src="https://images2.imgbox.com/0d/b6/OLfh9E54_o.png" width="720"></p> 
<p>回到腾讯云控制台，点击：语音合成资源包，可以查看刚才程序运行消耗的字符数量和剩余字符数量。</p> 
<p>可以看到，一本简单的英文绘本消耗了3712个字符，免费的语音合成资源包支持8000000个字符，大概可以转换2000本左右英文绘本。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bbc0c1c5f053484c5d592d8fd6f88da1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用Ollama&#43;OpenWebUI本地部署阿里通义千问Qwen2 AI大模型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6ea17d3c3c3dd6e69d69faa124214e33/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spark web UI 介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>