<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Sql Server】C#通过拼接代码的方式组合添加sql语句，会出现那些情况，参数化的作用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/148e19a81c2e9ed2c25c6cf7b4493f13/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Sql Server】C#通过拼接代码的方式组合添加sql语句，会出现那些情况，参数化的作用">
  <meta property="og:description" content="欢迎来到《小5讲堂》，大家好，我是全栈小5。
这是《Sql Server》系列文章，每篇文章将以博主理解的角度展开讲解，
特别是针对知识点的概念进行叙说，大部分文章将会对这些概念进行实际例子验证，以此达到加深对知识点的理解和掌握。
温馨提示：博主能力有限，理解水平有限，若有不对之处望指正！
目录 前言语句报错报错原因参数优化ADO.NET安装包链接模式参数化作用文章推荐 前言 博主写的很多博客分享，都是来源于实际开发和学习过程中遇到的一些细节问题，
因此通过文章的方式记录下来，这不仅可以边写边总结边边理解，这样也能加深印象。
本篇文章是讲，为什么要用参数化来生成sql语句？通过创建测试项目一起探索吧！
语句报错 没有进行参数化传递值，通过纯拼接方式组合的sql语句，是有可能存在一些sql语句不规范，
从而导致一些报错，比如：博主本次sql语句报错就是因为sql语句存在参数值本身还有逗号，
逗号在sql语句里又是特殊符号。
上图报错提示，在张三附近有语法错误，这个时候如果不是具体分析sql语句，但从错误提示是看不出什么原因。
在这里插入代码片 报错原因 通过调试和查看sql语句，观察可以看到，在赋值时，如果粗心大意的话，是很容易多写了一次单引号
参数优化 基于上面错误，如果赋值确实需要带上单引号进行查询，那么就需要通过参数化的方式。
添加一条记录测试，具体创建表可以在文章后面查看相关链接
declare @agent_name nvarchar(50) set @agent_name=&#39;&#39;&#39;张三&#39;&#39;&#39; insert into test_name(city_name,area_name,agent_name) values(&#39;深圳市&#39;,&#39;龙岗区&#39;,@agent_name) 从下图可以看到，使用参数化可以传递单引号值，也不会引发sql语句报错
ADO.NET 在 C# 的 ADO.NET 中，以下是一些基本的类及其主要作用：
1.SqlConnection
用于建立与 SQL Server 数据库的连接。
2.SqlCommand
用于执行 SQL 语句或存储过程，并返回受影响的行数、结果集或标量值。
3.SqlDataAdapter
用于从数据库中读取数据，并填充到 DataSet 或 DataTable 中。
可以直接执行sql语句，如果没有where条件或者参数化时
4.DataSet
本身不包含数据，但是可以包含一个或多个 DataTable ，以及它们之间的关系。
5.DataTable
表示内存中的表格，包含多个 DataRow，一行表示一条记录，包含多个列（字段）。
6.DataRow
表示 DataTable 中的一行数据，通过列名或索引访问数据。
安装包 和十年前VS开发工具相比，现在VS版本越来越智能化，会自动识别进行包的安装，非常方便和高效。
链接模式 C# ADO.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-05T14:17:06+08:00">
    <meta property="article:modified_time" content="2024-03-05T14:17:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Sql Server】C#通过拼接代码的方式组合添加sql语句，会出现那些情况，参数化的作用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>欢迎来到《小5讲堂》，大家好，我是全栈小5。<br> 这是《Sql Server》系列文章，每篇文章将以博主理解的角度展开讲解，<br> 特别是针对知识点的概念进行叙说，大部分文章将会对这些概念进行实际例子验证，以此达到加深对知识点的理解和掌握。<br> 温馨提示：博主能力有限，理解水平有限，若有不对之处望指正！</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d4/fb/HkNRsp7B_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_9" rel="nofollow">前言</a></li><li><a href="#_14" rel="nofollow">语句报错</a></li><li><a href="#_24" rel="nofollow">报错原因</a></li><li><a href="#_27" rel="nofollow">参数优化</a></li><li><a href="#ADONET_39" rel="nofollow">ADO.NET</a></li><li><a href="#_61" rel="nofollow">安装包</a></li><li><a href="#_63" rel="nofollow">链接模式</a></li><li><a href="#_79" rel="nofollow">参数化作用</a></li><li><a href="#_95" rel="nofollow">文章推荐</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_9"></a>前言</h2> 
<p>博主写的很多博客分享，都是来源于实际开发和学习过程中遇到的一些细节问题，<br> 因此通过文章的方式记录下来，这不仅可以边写边总结边边理解，这样也能加深印象。<br> 本篇文章是讲，为什么要用参数化来生成sql语句？通过创建测试项目一起探索吧！</p> 
<h2><a id="_14"></a>语句报错</h2> 
<p>没有进行参数化传递值，通过纯拼接方式组合的sql语句，是有可能存在一些sql语句不规范，<br> 从而导致一些报错，比如：博主本次sql语句报错就是因为sql语句存在参数值本身还有逗号，<br> 逗号在sql语句里又是特殊符号。<br> <img src="https://images2.imgbox.com/d5/f2/VxWAB9za_o.png" alt="在这里插入图片描述">上图报错提示，在张三附近有语法错误，这个时候如果不是具体分析sql语句，但从错误提示是看不出什么原因。</p> 
<pre><code class="prism language-csharp">在这里插入代码片
</code></pre> 
<h2><a id="_24"></a>报错原因</h2> 
<p>通过调试和查看sql语句，观察可以看到，在赋值时，如果粗心大意的话，是很容易多写了一次单引号<br> <img src="https://images2.imgbox.com/73/fe/2cwKlyIT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_27"></a>参数优化</h2> 
<p>基于上面错误，如果赋值确实需要带上单引号进行查询，那么就需要通过参数化的方式。<br> 添加一条记录测试，具体创建表可以在文章后面查看相关链接</p> 
<pre><code class="prism language-sql"><span class="token keyword">declare</span> <span class="token variable">@agent_name</span> nvarchar<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">set</span> <span class="token variable">@agent_name</span><span class="token operator">=</span><span class="token string">'''张三'''</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> test_name<span class="token punctuation">(</span>city_name<span class="token punctuation">,</span>area_name<span class="token punctuation">,</span>agent_name<span class="token punctuation">)</span>
<span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'深圳市'</span><span class="token punctuation">,</span><span class="token string">'龙岗区'</span><span class="token punctuation">,</span><span class="token variable">@agent_name</span><span class="token punctuation">)</span>
</code></pre> 
<p>从下图可以看到，使用参数化可以传递单引号值，也不会引发sql语句报错<img src="https://images2.imgbox.com/3b/6e/II24N6q6_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ADONET_39"></a>ADO.NET</h2> 
<p>在 C# 的 ADO.NET 中，以下是一些基本的类及其主要作用：</p> 
<p><strong>1.SqlConnection</strong><br> 用于建立与 SQL Server 数据库的连接。</p> 
<p><strong>2.SqlCommand</strong><br> 用于执行 SQL 语句或存储过程，并返回受影响的行数、结果集或标量值。</p> 
<p><strong>3.SqlDataAdapter</strong><br> 用于从数据库中读取数据，并填充到 DataSet 或 DataTable 中。<br> 可以直接执行sql语句，如果没有where条件或者参数化时</p> 
<p><strong>4.DataSet</strong><br> 本身不包含数据，但是可以包含一个或多个 DataTable ，以及它们之间的关系。</p> 
<p><strong>5.DataTable</strong><br> 表示内存中的表格，包含多个 DataRow，一行表示一条记录，包含多个列（字段）。</p> 
<p><strong>6.DataRow</strong><br> 表示 DataTable 中的一行数据，通过列名或索引访问数据。</p> 
<h2><a id="_61"></a>安装包</h2> 
<p>和十年前VS开发工具相比，现在VS版本越来越智能化，会自动识别进行包的安装，非常方便和高效。<img src="https://images2.imgbox.com/b8/fa/WA8HwewU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_63"></a>链接模式</h2> 
<p>C# ADO.NET 链接字符串两种模式，一个是要账号密码，一种是不需要账号密码。<br> 在 C# 中使用 ADO.NET 连接数据库时，连接字符串通常包含数据库连接所需的信息。<br> 如果采用 Windows 身份验证方式连接数据库，连接字符串通常不需要包含明确的用户名和密码，因为它会使用当前 Windows 用户的身份验证信息。这就是 “Windows 身份验证” 模式。<br> 下面是一个使用 Windows 身份验证的连接字符串示例：</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Data Source=ServerName;Initial Catalog=DatabaseName;Integrated Security=True;"</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果使用的是 SQL Server 身份验证方式连接数据库，那么连接字符串需要包含用户名和密码信息。<br> 下面是一个使用 SQL Server 身份验证的连接字符串示例：</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"Data Source=ServerName;Initial Catalog=DatabaseName;User ID=UserName;Password=Password;"</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_79"></a>参数化作用</h2> 
<p>通过上面代码分析，参数化的其中一个作用，能够规范化进行传参，避免和sql本身有重复的值。<br> 除了这个作用外，还有其他作用，比如：</p> 
<p><strong>1.预防 SQL 注入攻击</strong><br> 通过使用参数化查询，可以确保用户输入的数据不会被误解为 SQL 代码的一部分，从而有效地防止 SQL 注入攻击。因为参数化查询会将用户输入的数据作为数值或文本来处理，而不是作为可执行的 SQL 代码。</p> 
<p><strong>2.提高代码可读性和可维护性</strong><br> 使用参数化查询可以将 SQL 查询语句与参数值分离开来，使代码更清晰易懂。这样的设计有助于提高代码的可读性和可维护性，减少了混杂在一起的 SQL 代码和参数值所带来的混乱。</p> 
<p><strong>3.提高执行效率</strong><br> 数据库服务器通常会对参数化查询进行缓存和优化，因此可以提高查询的执行效率。通过将参数化查询参数化，数据库可以更好地重复使用预编译的查询计划，从而减少了解析和编译 SQL 查询语句的开销。</p> 
<p><strong>4.避免数据类型问题</strong><br> 使用参数化查询可以根据参数的数据类型来正确地将参数值传递给数据库，避免了在某些情况下需要手动对数据进行类型转换的问题。</p> 
<h2><a id="_95"></a>文章推荐</h2> 
<p><a href="https://blog.csdn.net/lmy_520/article/details/136385812">【Sql Server】Update中的From语句，以及常见更新操作方式</a></p> 
<p><a href="https://blog.csdn.net/lmy_520/article/details/136372526">【Sql server】假设有三个字段a,b,c 以a和b分组，如何查询a和b唯一，但是c不同的记录</a></p> 
<p><a href="https://blog.csdn.net/lmy_520/article/details/135869381">【Sql Server】新手一分钟看懂在已有表基础上修改字段默认值和数据类型</a></p> 
<p><a href="https://blog.csdn.net/lmy_520/article/details/133796083">【数据库】Sql Server数据迁移，处理自增字段赋值</a></p> 
<p><a href="https://blog.csdn.net/lmy_520/article/details/131271247">【数据类型】C#和Sql Server、Mysql、Oracle等常见数据库的数据类型对应关系</a></p> 
<blockquote> 
 <p>总结：温故而知新，不同阶段重温知识点，会有不一样的认识和理解，博主将巩固一遍知识点，并以实践方式和大家分享，若能有所帮助和收获，这将是博主最大的创作动力和荣幸。也期待认识更多优秀新老博主。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9efe0073de947d563bcc6f65ffbabfdd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">idealTree:ftp-server-web: sill idealTree buildDeps卡住了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/179bb5d1f09b6b28aa5cf1cf79e59b40/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android Studio开发（一） 构建项目</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>