<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>71. UE5 RPG 实现敌人召唤技能 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5580b2d5130f145a5b46f5f69a69f168/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="71. UE5 RPG 实现敌人召唤技能">
  <meta property="og:description" content="在这一篇文章中，我们要实现敌人的召唤师能够召唤自己的仆从进行作战。
要实现这个技能，我们首先创建新的敌人蓝图，用于召唤。接着，我们将实现一个召唤技能基类，在基类中实现在召唤师的周围获取到可以生成的位置点，然后在技能蓝图中在对应的位置生成敌人的Actor，并在后续对其进行优化。接下来，我们将一步步实现此功能。
创建新的敌人 我们首先创建两个新的敌人，这两个恶魔类型的敌人，用于召唤使用。
这里也不仔细讲解如何创建，我们在64. UE5 RPG 创建新的双手攻击怪物中也专门讲解了如何创建一个新的敌人，这里只说一下项目源码的改动。
由于黑色的恶魔是远程释放火球的，但是它没有武器，我们之前释放火球的都是带有武器的角色（萨满，玩家英雄）为了兼容没有武器的角色，我们又增加了一个可以通过骨骼标签和骨骼名称去获取位置的。
在角色基类里面实现它
FVector ARPGCharacter::GetCombatSocketLocationByTag_Implementation(const FGameplayTag SocketTag, const FName SocketName) const { if(SocketTag.MatchesTagExact(FRPGGameplayTags::Get().CombatSocket_Weapon)) { return Weapon-&gt;GetSocketLocation(SocketName); } return GetMesh()-&gt;GetSocketLocation(SocketName); } 然后将生成投掷物的技能接口修改掉
在敌人的技能里，蓝图修改
在玩家英雄技能里，修改蓝图
生成位置点 我们要实现召唤技能，首先创建一个新的召唤技能基类，由于它不是一个攻击性的技能，也不会造成伤害，所以，我们基于技能基类创建即可
创建一个名为RPGSummonAbility的召唤技能
在.h文件中，我们需要添加一个获取随机位置的函数，并添加一些可以自定义的配置项
UCLASS() class AURA_API URPGSummonAbility : public URPGGameplayAbility { GENERATED_BODY() public: UFUNCTION(BlueprintCallable) TArray&lt;FVector&gt; GetSpawnLocations(); UPROPERTY(EditDefaultsOnly, Category=&#34;Summoning&#34;) int32 NumMinions = 5; // 召唤的数量 UPROPERTY(EditDefaultsOnly, Category=&#34;Summoning&#34;) TArray&lt;TSubclassOf&lt;APawn&gt;&gt; MinionClasses; //召唤生成的角色类 UPROPERTY(EditDefaultsOnly, Category=&#34;Summoning&#34;) float MinSpawnDistance = 50.f; //召唤物距离召唤师最近的距离 UPROPERTY(EditDefaultsOnly, Category=&#34;Summoning&#34;) float MaxSpawnDistance = 250.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-19T10:20:08+08:00">
    <meta property="article:modified_time" content="2024-06-19T10:20:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">71. UE5 RPG 实现敌人召唤技能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在这一篇文章中，我们要实现敌人的召唤师能够召唤自己的仆从进行作战。<br> 要实现这个技能，我们首先创建新的敌人蓝图，用于召唤。接着，我们将实现一个召唤技能基类，在基类中实现在召唤师的周围获取到可以生成的位置点，然后在技能蓝图中在对应的位置生成敌人的Actor，并在后续对其进行优化。接下来，我们将一步步实现此功能。</p> 
<h2><a id="_3"></a>创建新的敌人</h2> 
<p>我们首先创建两个新的敌人，这两个恶魔类型的敌人，用于召唤使用。<br> 这里也不仔细讲解如何创建，我们在<a href="https://blog.csdn.net/qq_30100043/article/details/139453305?spm=1001.2014.3001.5501">64. UE5 RPG 创建新的双手攻击怪物</a>中也专门讲解了如何创建一个新的敌人，这里只说一下项目源码的改动。<br> <img src="https://images2.imgbox.com/d8/89/ISAkBIzj_o.png" alt="在这里插入图片描述"><br> 由于黑色的恶魔是远程释放火球的，但是它没有武器，我们之前释放火球的都是带有武器的角色（萨满，玩家英雄）为了兼容没有武器的角色，我们又增加了一个可以通过骨骼标签和骨骼名称去获取位置的。<br> <img src="https://images2.imgbox.com/7a/39/wRoUtMDq_o.png" alt="在这里插入图片描述"></p> 
<p>在角色基类里面实现它</p> 
<pre><code class="prism language-cpp">FVector <span class="token class-name">ARPGCharacter</span><span class="token double-colon punctuation">::</span><span class="token function">GetCombatSocketLocationByTag_Implementation</span><span class="token punctuation">(</span><span class="token keyword">const</span> FGameplayTag SocketTag<span class="token punctuation">,</span> <span class="token keyword">const</span> FName SocketName<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>SocketTag<span class="token punctuation">.</span><span class="token function">MatchesTagExact</span><span class="token punctuation">(</span><span class="token class-name">FRPGGameplayTags</span><span class="token double-colon punctuation">::</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>CombatSocket_Weapon<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> Weapon<span class="token operator">-&gt;</span><span class="token function">GetSocketLocation</span><span class="token punctuation">(</span>SocketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">GetMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetSocketLocation</span><span class="token punctuation">(</span>SocketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后将生成投掷物的技能接口修改掉<br> <img src="https://images2.imgbox.com/29/88/jIsM37p4_o.png" alt="在这里插入图片描述"><br> 在敌人的技能里，蓝图修改<br> <img src="https://images2.imgbox.com/96/72/fn19BTtS_o.png" alt="在这里插入图片描述"><br> 在玩家英雄技能里，修改蓝图<br> <img src="https://images2.imgbox.com/85/1a/M4DLfXyM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_29"></a>生成位置点</h2> 
<p>我们要实现召唤技能，首先创建一个新的召唤技能基类，由于它不是一个攻击性的技能，也不会造成伤害，所以，我们基于技能基类创建即可<br> <img src="https://images2.imgbox.com/ae/7c/JY3Nq8oG_o.png" alt="在这里插入图片描述"><br> 创建一个名为RPGSummonAbility的召唤技能<br> <img src="https://images2.imgbox.com/5f/7d/9ZHXtPE7_o.png" alt="在这里插入图片描述"><br> 在.h文件中，我们需要添加一个获取随机位置的函数，并添加一些可以自定义的配置项</p> 
<pre><code class="prism language-cpp"><span class="token function">UCLASS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">AURA_API</span> URPGSummonAbility <span class="token operator">:</span> <span class="token keyword">public</span> URPGGameplayAbility
<span class="token punctuation">{<!-- --></span>
	<span class="token function">GENERATED_BODY</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">public</span><span class="token operator">:</span>

	<span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintCallable<span class="token punctuation">)</span>
	TArray<span class="token operator">&lt;</span>FVector<span class="token operator">&gt;</span> <span class="token function">GetSpawnLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	int32 NumMinions <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 召唤的数量</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	TArray<span class="token operator">&lt;</span>TSubclassOf<span class="token operator">&lt;</span>APawn<span class="token operator">&gt;&gt;</span> MinionClasses<span class="token punctuation">;</span> <span class="token comment">//召唤生成的角色类</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	<span class="token keyword">float</span> MinSpawnDistance <span class="token operator">=</span> <span class="token number">50.f</span><span class="token punctuation">;</span> <span class="token comment">//召唤物距离召唤师最近的距离</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	<span class="token keyword">float</span> MaxSpawnDistance <span class="token operator">=</span> <span class="token number">250.f</span><span class="token punctuation">;</span> <span class="token comment">//召唤物距离召唤师最远的距离</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditDefaultsOnly<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	<span class="token keyword">float</span> SpawnSpread <span class="token operator">=</span> <span class="token number">90.f</span><span class="token punctuation">;</span> <span class="token comment">//召唤物在召唤师前面的角度范围</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>在cpp中，我们实现此函数，我们想让召唤物生成在召唤师的前面角度范围内，需要获取到召唤师的位置和朝向。然后，将角度范围的值进行分段</p> 
<pre><code class="prism language-cpp">	<span class="token keyword">const</span> FVector Forward <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorForwardVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的朝向</span>
	<span class="token keyword">const</span> FVector Location <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的位置</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span> DeltaSpread <span class="token operator">=</span> SpawnSpread <span class="token operator">/</span> NumMinions<span class="token punctuation">;</span> <span class="token comment">//将召唤的角度范围进行分段，在每段里面生成一个召唤物</span>
</code></pre> 
<p>然后，我们再获取到角色的最左和最右的生成角度，通过debug调试一下，查看获取到的角度是否正确</p> 
<pre><code class="prism language-cpp">	<span class="token keyword">const</span> FVector LeftOfSpread <span class="token operator">=</span> Forward<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span><span class="token operator">-</span>SpawnSpread <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到最左侧的角度</span>
	<span class="token class-name">UKismetSystemLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">DrawDebugArrow</span><span class="token punctuation">(</span><span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location<span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">4.f</span><span class="token punctuation">,</span> FLinearColor<span class="token double-colon punctuation">::</span>Red<span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">const</span> FVector RightOfSpread <span class="token operator">=</span> Forward<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span>SpawnSpread <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到最右侧的角度</span>
	<span class="token class-name">UKismetSystemLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">DrawDebugArrow</span><span class="token punctuation">(</span><span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location<span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">4.f</span><span class="token punctuation">,</span> FLinearColor<span class="token double-colon punctuation">::</span>Red<span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p>我们创建了一个技能类，写了一些代码，接下来，去UE里面测试一下，功能是否有效。<br> 打开UE创建一个蓝图，基于我们创建的召唤技能类<br> <img src="https://images2.imgbox.com/eb/11/ZCOBqhDZ_o.png" alt="在这里插入图片描述"><br> 右侧设置一下技能标签，用于技能激活<br> <img src="https://images2.imgbox.com/d5/be/MvE8U8qQ_o.png" alt="在这里插入图片描述"><br> 蓝图这里直接连一下，调用函数<br> <img src="https://images2.imgbox.com/3e/51/qOs8P59w_o.png" alt="在这里插入图片描述"><br> 在数据配置里面将技能给对应的角色设置<br> <img src="https://images2.imgbox.com/47/10/knEye8BT_o.png" alt="在这里插入图片描述"><br> 将敌人放到场景测试，查看是否能够成功绘制出debug线<br> <img src="https://images2.imgbox.com/c8/c4/2avbMevy_o.png" alt="在这里插入图片描述"><br> 接下来，查看我们是否能够获取到准确的位置，我们绘制调试球体</p> 
<pre><code class="prism language-cpp">	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MinSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MinSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后打印查看<br> <img src="https://images2.imgbox.com/c1/51/3HgdZ8wx_o.png" alt="在这里插入图片描述"><br> 接下来，我们想根据生成的个数，平均角度，然后在每个角度上面，从最远和最近的距离随机一个位置来生成角色。这里如果需要5个位置，我们其实分为四段就可以，大家可以画图测试一下。</p> 
<pre><code class="prism language-cpp">	<span class="token keyword">const</span> FVector Forward <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorForwardVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的朝向</span>
	<span class="token keyword">const</span> FVector Location <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的位置</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span> DeltaSpread <span class="token operator">=</span> SpawnSpread <span class="token operator">/</span> <span class="token punctuation">(</span>NumMinions <span class="token operator">-</span> <span class="token number">1.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将召唤的角度范围进行分段，在每段里面生成一个召唤物</span>

	<span class="token keyword">const</span> FVector LeftOfSpread <span class="token operator">=</span> Forward<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span><span class="token operator">-</span>SpawnSpread <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到最左侧的角度</span>

	TArray<span class="token operator">&lt;</span>FVector<span class="token operator">&gt;</span> SpawnLocations<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>int32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NumMinions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//遍历，在每个分段上面获取位置</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> FVector Direction <span class="token operator">=</span> LeftOfSpread<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span>DeltaSpread <span class="token operator">*</span> i<span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取当前分段的角度</span>
		FVector ChosenSpawnLocation <span class="token operator">=</span> Location <span class="token operator">+</span> Direction <span class="token operator">*</span> <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">FRandRange</span><span class="token punctuation">(</span>MinSpawnDistance<span class="token punctuation">,</span> MaxSpawnDistance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//随机位置，加上原始位置就是偏移的位置</span>
		<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChosenSpawnLocation<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Green<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SpawnLocations<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ChosenSpawnLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>接着编译去测试代码，查看效果<br> <img src="https://images2.imgbox.com/ab/cc/AiinOEZq_o.png" alt="在这里插入图片描述"><br> 接下来，我们添加上射线拾取，防止生成的角色悬空出现。</p> 
<pre><code class="prism language-cpp">TArray<span class="token operator">&lt;</span>FVector<span class="token operator">&gt;</span> <span class="token class-name">URPGSummonAbility</span><span class="token double-colon punctuation">::</span><span class="token function">GetSpawnLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> FVector Forward <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorForwardVector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的朝向</span>
	<span class="token keyword">const</span> FVector Location <span class="token operator">=</span> <span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">GetActorLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取召唤师的位置</span>
	<span class="token keyword">const</span> <span class="token keyword">float</span> DeltaSpread <span class="token operator">=</span> SpawnSpread <span class="token operator">/</span> <span class="token punctuation">(</span>NumMinions <span class="token operator">-</span> <span class="token number">1.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将召唤的角度范围进行分段，在每段里面生成一个召唤物</span>

	<span class="token keyword">const</span> FVector LeftOfSpread <span class="token operator">=</span> Forward<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span><span class="token operator">-</span>SpawnSpread <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到最左侧的角度</span>

	TArray<span class="token operator">&lt;</span>FVector<span class="token operator">&gt;</span> SpawnLocations<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>int32 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NumMinions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//遍历，在每个分段上面获取位置</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> FVector Direction <span class="token operator">=</span> LeftOfSpread<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span>DeltaSpread <span class="token operator">*</span> i<span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取当前分段的角度</span>
		FVector ChosenSpawnLocation <span class="token operator">=</span> Location <span class="token operator">+</span> Direction <span class="token operator">*</span> <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">FRandRange</span><span class="token punctuation">(</span>MinSpawnDistance<span class="token punctuation">,</span> MaxSpawnDistance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//随机位置，加上原始位置就是偏移的位置</span>

		FHitResult Hit<span class="token punctuation">;</span>
		<span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">LineTraceSingleByChannel</span><span class="token punctuation">(</span>Hit<span class="token punctuation">,</span> ChosenSpawnLocation <span class="token operator">+</span> <span class="token function">FVector</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">400.f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChosenSpawnLocation <span class="token operator">-</span> <span class="token function">FVector</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">0.f</span><span class="token punctuation">,</span> <span class="token number">400.f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ECC_Visibility<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Hit<span class="token punctuation">.</span>bBlockingHit<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			ChosenSpawnLocation <span class="token operator">=</span> Hit<span class="token punctuation">.</span>ImpactPoint<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ChosenSpawnLocation<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Green<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		SpawnLocations<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ChosenSpawnLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">const</span> FVector RightOfSpread <span class="token operator">=</span> Forward<span class="token punctuation">.</span><span class="token function">RotateAngleAxis</span><span class="token punctuation">(</span>SpawnSpread <span class="token operator">/</span> <span class="token number">2.f</span><span class="token punctuation">,</span> FVector<span class="token double-colon punctuation">::</span>UpVector<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取到最右侧的角度</span>
	
	<span class="token class-name">UKismetSystemLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">DrawDebugArrow</span><span class="token punctuation">(</span><span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location<span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">4.f</span><span class="token punctuation">,</span> FLinearColor<span class="token double-colon punctuation">::</span>Red<span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">UKismetSystemLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">DrawDebugArrow</span><span class="token punctuation">(</span><span class="token function">GetAvatarActorFromActorInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location<span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">4.f</span><span class="token punctuation">,</span> FLinearColor<span class="token double-colon punctuation">::</span>Black<span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MinSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> LeftOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MinSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">DrawDebugSphere</span><span class="token punctuation">(</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Location <span class="token operator">+</span> RightOfSpread <span class="token operator">*</span> MaxSpawnDistance<span class="token punctuation">,</span> <span class="token number">15.f</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>FColor<span class="token double-colon punctuation">::</span>Blue<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">3.f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> SpawnLocations<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b0/a9/GvLwAHW4_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_164"></a>实现技能蓝图</h2> 
<p>在技能蓝图里面，我们获取到了召唤生成的位置，后续我们要根据位置生成Actor，所以，我们将生成的位置保存下来，后续使用，并且不想一次性全部生成，一次性生成最大的问题是在一帧内创建多个资源会造成卡顿。<br> 我们将生成的点保存为变量，并生成一个下标索引<br> <img src="https://images2.imgbox.com/2c/72/b0tKOOFE_o.png" alt="在这里插入图片描述"><br> 接下来就是实现在位置生成测试盒子，查看在蓝图实现生成，这里在每个生成以后，延迟一秒继续生成。<br> <img src="https://images2.imgbox.com/12/d8/JnDo2qt5_o.png" alt="在这里插入图片描述"><br> 查看效果<br> <img src="https://images2.imgbox.com/7f/00/nUl3L2uz_o.png" alt="在这里插入图片描述"><br> 当然，我们还可以将数组内的位置点排序打乱，这样，生成时，不会只按一个方向生成<br> <img src="https://images2.imgbox.com/2c/bc/3jiecXYo_o.png" alt="在这里插入图片描述"><br> 接下来，我们继续优化，在生成Actor之前，先在生成位置创建一个粒子特效，表现出后续会出现生成的物体。我们这里使用一个序列，遍历位置数组，在地面生成粒子特效<br> <img src="https://images2.imgbox.com/4c/74/7zlYtd0x_o.png" alt="在这里插入图片描述"><br> 效果如下<br> <img src="https://images2.imgbox.com/56/80/V8R339Ax_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_179"></a>生成召唤物</h2> 
<p>接下来，我们修改debug内容，将生成的调试盒子修改成真正需要生成的内容。<br> 首先，将需要生成的内容，添加到配置项中<br> <img src="https://images2.imgbox.com/a8/d4/vRneVADt_o.png" alt="在这里插入图片描述"><br> 由于可以添加多个类，我们需要从其中随机一个类使用，在c++中添加一个新的函数，这个可以不需要引脚</p> 
<pre><code class="prism language-cpp">	<span class="token function">UFUNCTION</span><span class="token punctuation">(</span>BlueprintPure<span class="token punctuation">,</span> Category<span class="token operator">=</span><span class="token string">"Summoning"</span><span class="token punctuation">)</span>
	TSubclassOf<span class="token operator">&lt;</span>APawn<span class="token operator">&gt;</span> <span class="token function">GetRandomMinionClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取随机的召唤物类</span>
</code></pre> 
<p>在实现这里，随机一个下标即可</p> 
<pre><code class="prism language-cpp">TSubclassOf<span class="token operator">&lt;</span>APawn<span class="token operator">&gt;</span> <span class="token class-name">URPGSummonAbility</span><span class="token double-colon punctuation">::</span><span class="token function">GetRandomMinionClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> int32 Selection <span class="token operator">=</span> <span class="token class-name">FMath</span><span class="token double-colon punctuation">::</span><span class="token function">RandRange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> MinionClasses<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> MinionClasses<span class="token punctuation">[</span>Selection<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>编译，我们打开去修改蓝图，通过节点spawn Actor from Class来生成实例，由于位置处于地面，我们生成的角色都会半身陷入到地面里，这里对z轴进行一个偏移，<br> <img src="https://images2.imgbox.com/5c/f7/ya9RDzCU_o.png" alt="在这里插入图片描述"><br> 发现生成是成功了，但是都不会动<br> <img src="https://images2.imgbox.com/d3/a2/G9mlUQb3_o.png" alt="在这里插入图片描述"><br> 我们再给它增加一个节点，生成一个默认的控制器，并控制目标<br> <img src="https://images2.imgbox.com/dd/13/dI9Mluvv_o.png" alt="在这里插入图片描述"><br> 这样，我们就实现了召唤物的生成。</p> 
<h2><a id="_206"></a>添加蒙太奇动画</h2> 
<p>实现召唤技能最后一步工作还需要制作，就是召唤师还没有设置动画。<br> 创建一个蒙太奇<br> <img src="https://images2.imgbox.com/56/46/BU49o9NS_o.png" alt="在这里插入图片描述"><br> 我们在蓝图中，设置了技能的相关设置<br> <img src="https://images2.imgbox.com/62/4d/Gp7VG8Hp_o.png" alt="在这里插入图片描述"><br> 但是，召唤技能不需要设置这些内容，这里设置的是角色攻击的，我们将召唤的写死在技能里，在蒙太奇里面添加一个动画通知<br> <img src="https://images2.imgbox.com/4d/6b/wnCS3qrh_o.png" alt="在这里插入图片描述"><br> 在执行召唤之前，添加蒙太奇播放<br> <img src="https://images2.imgbox.com/59/5f/QgUVpCHQ_o.png" alt="在这里插入图片描述"><br> 为了防止出现滑步的现象，我们需要对召唤动画开启根运动，这样，蒙太奇播放时，会根据动画内的位移修改，召唤的动画没有位移，所以会固定在当前位置<br> <img src="https://images2.imgbox.com/7f/a6/verjqCsM_o.png" alt="在这里插入图片描述"><br> 接着我们在播放蒙太奇后，监听游戏事件，在监听到游戏事件后，会触发后续生成事件<br> <img src="https://images2.imgbox.com/fd/77/opN7Elus_o.png" alt="在这里插入图片描述"><br> 这里需要注意的是，如果游戏结束，但是后面生成没有完成，也会被终止掉，所以，我们触发事件到蒙太奇动画播放完成，需要留有足够生成召唤物的时间。<br> 接下来，就是查看是否能够成功播放蒙太奇和生成召唤物<br> <img src="https://images2.imgbox.com/b7/78/yWrNHtt8_o.png" alt="在这里插入图片描述"><br> 没有问题本章内容完成，后面一章，我们将实现如何限制召唤物的召唤数量，并优化一些内容。<br> 最后附上技能的蓝图节点全身照<br> <img src="https://images2.imgbox.com/65/63/zcO7KUWK_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4069b831915297d2d204a1d9d89e03c3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#结合JS 修改解决 KindEditor 弹出层问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1fd612645630ce119556850435c40b6e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何用大模型&#43;知识库打造微信群里的AI问答神器！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>