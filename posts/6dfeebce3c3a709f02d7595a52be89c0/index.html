<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用ollama和open-webui本地部署通义千问Qwen1.5-7B-Chat模型 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6dfeebce3c3a709f02d7595a52be89c0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="利用ollama和open-webui本地部署通义千问Qwen1.5-7B-Chat模型">
  <meta property="og:description" content="目录
1 安装ollama
2 安装open-webui
2.1 镜像下载
3 配置ollama的模型转换工具环境
3.1 下载ollama源码
3.2 下载ollama子模块
3.3 创建ollama虚拟环境
3.4 安装依赖
3.5 编译量化工具
7 创建ollama模型
8 运行模型
参考文献：
1 安装ollama curl -fsSL https://ollama.com/install.sh | sh 启动、关闭ollama
systemctl start ollama
systemctl stop ollama
systemctl restart ollama
systemctl status ollama
2 安装open-webui git clone https://github.com/open-webui/open-webui.git cd open-webui 这里open-webui的源码其实用不到，直接用下面的镜像就行。 2.1 镜像下载 官方没有在 docker hub 上发布镜像，而是发布在 ghcr.io，地址在 https://Github.com/open-webui/open-webui/pkgs/container/open-webui
docker pull ghcr.io/open-webui/open-webui:main 如果没有科学上网，很可能会拉不动，可以试试 docker 代理网站：https://dockerproxy.com/，但是会多几个步骤
# 如果拉不动的话加个代理 docker pull ghcr.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-23T16:45:54+08:00">
    <meta property="article:modified_time" content="2024-04-23T16:45:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用ollama和open-webui本地部署通义千问Qwen1.5-7B-Chat模型</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong> </strong></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="1%20%E5%AE%89%E8%A3%85ollama-toc" style="margin-left:0px;"><a href="#1%20%E5%AE%89%E8%A3%85ollama" rel="nofollow">1 安装ollama</a></p> 
<p id="2%20%E5%AE%89%E8%A3%85open-webui-toc" style="margin-left:0px;"><a href="#2%20%E5%AE%89%E8%A3%85open-webui" rel="nofollow">2 安装open-webui</a></p> 
<p id="2.1%20%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD-toc" style="margin-left:40px;"><a href="#2.1%20%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD" rel="nofollow">2.1 镜像下载</a></p> 
<p id="3%C2%A0%E9%85%8D%E7%BD%AEollama%E7%9A%84%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%8E%AF%E5%A2%83-toc" style="margin-left:0px;"><a href="#3%C2%A0%E9%85%8D%E7%BD%AEollama%E7%9A%84%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%8E%AF%E5%A2%83" rel="nofollow">3 配置ollama的模型转换工具环境</a></p> 
<p id="3.1%20%E4%B8%8B%E8%BD%BDollama%E6%BA%90%E7%A0%81-toc" style="margin-left:40px;"><a href="#3.1%20%E4%B8%8B%E8%BD%BDollama%E6%BA%90%E7%A0%81" rel="nofollow">3.1 下载ollama源码</a></p> 
<p id="%C2%A03.2%20%E4%B8%8B%E8%BD%BDollama%E5%AD%90%E6%A8%A1%E5%9D%97-toc" style="margin-left:40px;"><a href="#%C2%A03.2%20%E4%B8%8B%E8%BD%BDollama%E5%AD%90%E6%A8%A1%E5%9D%97" rel="nofollow"> 3.2 下载ollama子模块</a></p> 
<p id="3.3%20%E5%88%9B%E5%BB%BAollama%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#3.3%20%E5%88%9B%E5%BB%BAollama%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83" rel="nofollow">3.3 创建ollama虚拟环境</a></p> 
<p id="3.4%20%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96-toc" style="margin-left:40px;"><a href="#3.4%20%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96" rel="nofollow">3.4 安装依赖</a></p> 
<p id="3.5%20%E7%BC%96%E8%AF%91%E9%87%8F%E5%8C%96%E5%B7%A5%E5%85%B7-toc" style="margin-left:40px;"><a href="#3.5%20%E7%BC%96%E8%AF%91%E9%87%8F%E5%8C%96%E5%B7%A5%E5%85%B7" rel="nofollow">3.5 编译量化工具</a></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="4%C2%A0%E8%BD%AC%E6%8D%A2qwen%E6%A8%A1%E5%9E%8B-toc" style="margin-left:0px;"><a href="#4%C2%A0%E8%BD%AC%E6%8D%A2qwen%E6%A8%A1%E5%9E%8B" rel="nofollow">7 创建ollama模型</a></p> 
<p id="8%C2%A0%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%9E%8B-toc" style="margin-left:0px;"><a href="#8%C2%A0%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%9E%8B" rel="nofollow">8 运行模型</a></p> 
<p id="%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%EF%BC%9A" rel="nofollow">参考文献：</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1%20%E5%AE%89%E8%A3%85ollama">1 安装ollama</h2> 
<pre><code class="language-bash">curl -fsSL https://ollama.com/install.sh | sh</code></pre> 
<p>启动、关闭ollama<br> systemctl start ollama<br> systemctl stop ollama<br> systemctl restart ollama<br> systemctl status ollama</p> 
<h2 id="2%20%E5%AE%89%E8%A3%85open-webui">2 安装open-webui</h2> 
<pre><code class="language-bash">git clone https://github.com/open-webui/open-webui.git
cd open-webui</code></pre> 
<p>这里open-webui的源码其实用不到，直接用下面的镜像就行。 </p> 
<h3 id="2.1%20%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD">2.1 镜像下载</h3> 
<p>官方没有在 <code>docker hub</code> 上发布镜像，而是发布在 <code>ghcr.io</code>，地址在 https://<a href="https://www.bmabk.com/index.php/post/tag/58" rel="nofollow" title="Git">Git</a>hub.com/open-webui/open-webui/pkgs/container/open-webui</p> 
<pre><code class="language-bash">docker pull ghcr.io/open-webui/open-webui:main</code></pre> 
<p>如果没有科学上网，很可能会拉不动，可以试试 <code>docker</code> 代理网站：https://dockerproxy.com/，但是会多几个步骤</p> 
<pre><code class="language-bash"># 如果拉不动的话加个代理
docker pull ghcr.dockerproxy.com/open-webui/open-webui:main

# 重命名镜像（如果是通过代理下载的）
docker tag ghcr.dockerproxy.com/open-webui/open-webui:main ghcr.io/open-webui/open-webui:main

# 删除代理镜像（如果是通过代理下载的）
docker rmi ghcr.dockerproxy.com/open-webui/open-webui:main</code></pre> 
<p> 然后docker images可以看到镜像</p> 
<p><img alt="" height="87" src="https://images2.imgbox.com/72/51/iWYY5y65_o.png" width="1200"></p> 
<pre><code class="language-bash">docker run -d -p 3006:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui-chw --restart always ghcr.io/open-webui/open-webui:main
2c93ac3c6c911302d4d2926692a7bab64f607317938da71e53ff32798be801da
</code></pre> 
<h2 id="3%C2%A0%E9%85%8D%E7%BD%AEollama%E7%9A%84%E6%A8%A1%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%8E%AF%E5%A2%83">3 配置ollama的模型转换工具环境</h2> 
<h3 id="3.1%20%E4%B8%8B%E8%BD%BDollama%E6%BA%90%E7%A0%81">3.1 下载ollama源码</h3> 
<pre><code class="language-bash">git clone https://github.com/ollama/ollama.git
cd ollama</code></pre> 
<h3 id="%C2%A03.2%20%E4%B8%8B%E8%BD%BDollama%E5%AD%90%E6%A8%A1%E5%9D%97"> 3.2 下载ollama子模块</h3> 
<pre><code class="language-bash">git submodule init
git submodule update llm/llama.cpp</code></pre> 
<h3 id="3.3%20%E5%88%9B%E5%BB%BAollama%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83">3.3 创建ollama虚拟环境</h3> 
<pre><code class="language-bash">conda create -n ollama_chw python=3.11
conda activate ollama_chw</code></pre> 
<h3 id="3.4%20%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96">3.4 安装依赖</h3> 
<pre><code class="language-bash">pip install -r llm/llama.cpp/requirements.txt</code></pre> 
<h3 id="3.5%20%E7%BC%96%E8%AF%91%E9%87%8F%E5%8C%96%E5%B7%A5%E5%85%B7">3.5 编译量化工具</h3> 
<pre><code class="language-bash">make -C llm/llama.cpp quantize
如果编译llama.cpp的测试工具main，在llama.cpp目录执行make -j，会在当前目录生成main文件。
测试实验./main -m ./model_name</code></pre> 
<h2>4 5 6 见私人博客</h2> 
<h2 id="4%C2%A0%E8%BD%AC%E6%8D%A2qwen%E6%A8%A1%E5%9E%8B">7 创建ollama模型</h2> 
<pre><code class="language-bash">ollama create chw1.5 -f /data/chw/ollama_20240419/qwen1.5-7B/Modelfile</code></pre> 
<p>到了这一步之后，其实在open-webui上就可以看到这个模型了</p> 
<p></p> 
<h2 id="8%C2%A0%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%9E%8B">8 运行模型</h2> 
<pre><code class="language-bash">ollama run chw1.5</code></pre> 
<p>其实这个ollama run就相当于在命令行运行模型，但是我们这里是用open-webui，所以直接ollama create之后就可以用open-webui。</p> 
<p></p> 
<p></p> 
<h2 id="%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE%EF%BC%9A">参考文献：</h2> 
<p><a href="https://github.com/ollama/ollama" title="GitHub - ollama/ollama: Get up and running with Llama 3, Mistral, Gemma, and other large language models.">GitHub - ollama/ollama: Get up and running with Llama 3, Mistral, Gemma, and other large language models.</a></p> 
<p><a href="https://github.com/open-webui/open-webui" title="GitHub - open-webui/open-webui: User-friendly WebUI for LLMs (Formerly Ollama WebUI)">GitHub - open-webui/open-webui: User-friendly WebUI for LLMs (Formerly Ollama WebUI)</a></p> 
<p><a href="https://blog.csdn.net/weixin_40313940/article/details/134769706" title="llama.cpp部署通义千问Qwen-14B_通义千问gguf model-CSDN博客">llama.cpp部署通义千问Qwen-14B_通义千问gguf model-CSDN博客</a></p> 
<p><a href="https://www.bmabk.com/index.php/post/225816.html" rel="nofollow" title="适配Ollama的前端界面Open WebUI | 半码博客">适配Ollama的前端界面Open WebUI | 半码博客</a><br><a href="https://docs.openwebui.com/getting-started/" rel="nofollow" title="🚀 Getting Started | Open WebUI">🚀 Getting Started | Open WebUI</a></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9905c62c7f5a439920b8b6e85e9bf061/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flink学习（八）-Flink 集群搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a2ef95fa34b48da80d40962d6e5003da/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot使用Mybatis中兼容多数据源的databaseId（databaseIdProvider）的简单使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>