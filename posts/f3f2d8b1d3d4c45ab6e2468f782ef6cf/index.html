<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL中PIVOT函数的用法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f3f2d8b1d3d4c45ab6e2468f782ef6cf/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SQL中PIVOT函数的用法">
  <meta property="og:description" content="文章目录 前言1. SQL Server2. MySQL3. Oracle 前言 PIVOT 是 SQL Server 中的一个功能，用于将行转换为列。然而，MySQL 和 Oracle 不直接支持 PIVOT 语法。但是，你可以使用条件聚合或其他技术来模拟 PIVOT 的行为。
语法：
-- 从子查询中选择数据，子查询从源表中选择需要的数据 SELECT ... FROM ( -- 源查询，从源表中选取你希望进行PIVOT操作的列 SELECT ... FROM &lt;source_table&gt; -- 可以包含WHERE子句、GROUP BY子句等以筛选或组织数据 ) AS SourceTable -- PIVOT操作，将行数据转换为列数据 PIVOT ( -- 聚合函数，用于计算每个新列的值 aggregate_function(&lt;column_value&gt;) -- 指定要进行转换的列名 FOR &lt;column_name&gt; -- 指定转换后新列的名称列表 IN ([first_pivoted_column], [second_pivoted_column], ...) ) AS PivotTable; 以下是如何在 SQL Server、MySQL 和 Oracle 中实现类似 PIVOT 的操作的示例。
1. SQL Server 假设你有一个名为 sales 的表，其中包含 year, product, 和 amount 三个字段：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-24T17:16:13+08:00">
    <meta property="article:modified_time" content="2024-04-24T17:16:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL中PIVOT函数的用法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">前言</a></li><li><a href="#1_SQL_Server_37" rel="nofollow">1. SQL Server</a></li><li><a href="#2_MySQL_77" rel="nofollow">2. MySQL</a></li><li><a href="#3_Oracle_91" rel="nofollow">3. Oracle</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_6"></a>前言</h2> 
<p>PIVOT 是 SQL Server 中的一个功能，用于将行转换为列。然而，MySQL 和 Oracle 不直接支持 PIVOT 语法。但是，你可以使用条件聚合或其他技术来模拟 PIVOT 的行为。</p> 
<blockquote> 
 <p>语法：</p> 
</blockquote> 
<pre><code>-- 从子查询中选择数据，子查询从源表中选择需要的数据  
SELECT ...    
FROM     
   (  
      -- 源查询，从源表中选取你希望进行PIVOT操作的列  
      SELECT ...    
      FROM &lt;source_table&gt;  
      -- 可以包含WHERE子句、GROUP BY子句等以筛选或组织数据  
   ) AS SourceTable    
  
-- PIVOT操作，将行数据转换为列数据  
PIVOT    
   (  
      -- 聚合函数，用于计算每个新列的值  
      aggregate_function(&lt;column_value&gt;)    
      -- 指定要进行转换的列名  
      FOR &lt;column_name&gt;     
      -- 指定转换后新列的名称列表  
      IN ([first_pivoted_column], [second_pivoted_column], ...)  
   ) AS PivotTable;
</code></pre> 
<hr> 
<p>以下是如何在 SQL Server、MySQL 和 Oracle 中实现类似 PIVOT 的操作的示例。</p> 
<h2><a id="1_SQL_Server_37"></a>1. SQL Server</h2> 
<p>假设你有一个名为 sales 的表，其中包含 year, product, 和 amount 三个字段：</p> 
<blockquote> 
 <p>sql:</p> 
</blockquote> 
<pre><code>CREATE TABLE sales (  
    year INT,  
    product VARCHAR(50),  
    amount DECIMAL(10, 2)  
);  
  
INSERT INTO sales (year, product, amount) VALUES  
(2020, 'A', 100),  
(2020, 'B', 200),  
(2021, 'A', 150),  
(2021, 'B', 250);
</code></pre> 
<p>你可以使用 PIVOT 来转换数据：</p> 
<pre><code>SELECT *  
FROM (  
    SELECT year, product, amount  
    FROM sales  
) AS source_table  
PIVOT (  
    SUM(amount)  
    FOR product IN ([A], [B])  
) AS pivot_table;
</code></pre> 
<p>这将返回：</p> 
<table><thead><tr><th>year</th><th>A</th><th>B</th></tr></thead><tbody><tr><td>2020</td><td>100.0</td><td>200.0</td></tr><tr><td>2021</td><td>150.0</td><td>250.0</td></tr></tbody></table> 
<h2><a id="2_MySQL_77"></a>2. MySQL</h2> 
<p>在 MySQL 中，你可以使用条件聚合来模拟 PIVOT：</p> 
<pre><code>SELECT year,  
       SUM(CASE WHEN product = 'A' THEN amount ELSE 0 END) AS 'A',  
       SUM(CASE WHEN product = 'B' THEN amount ELSE 0 END) AS 'B'  
FROM sales  
GROUP BY year;
</code></pre> 
<p>这将返回与 SQL Server 相同的结果。</p> 
<h2><a id="3_Oracle_91"></a>3. Oracle</h2> 
<p>在 Oracle 中，你也可以使用条件聚合：</p> 
<pre><code>SELECT year,  
       SUM(CASE WHEN product = 'A' THEN amount ELSE 0 END) AS "A",  
       SUM(CASE WHEN product = 'B' THEN amount ELSE 0 END) AS "B"  
FROM sales  
GROUP BY year;
</code></pre> 
<p>这将返回与 SQL Server 和 MySQL 相同的结果。</p> 
<p>请注意，虽然上述查询在逻辑上模拟了 PIVOT 的行为，但它们并不是真正的 PIVOT 语法。如果你需要在多个列或动态列上进行转换，那么你可能需要构建更复杂的查询或使用存储过程来动态生成 SQL。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f2f68ece8ed46cb3e0cf54b7fc4d629/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【SQL】MySQL中的字符串处理函数：concat 函数拼接字符串，COALESCE函数处理NULL字符串</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07f6f1cd1f847c7d11bf89d66c9653b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot整合Redisson的两种方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>