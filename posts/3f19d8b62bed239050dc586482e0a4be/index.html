<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【PostgreSQL】守护城堡：PostgreSQL用户管理与安全性强化 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3f19d8b62bed239050dc586482e0a4be/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【PostgreSQL】守护城堡：PostgreSQL用户管理与安全性强化">
  <meta property="og:description" content="目录
角色与权限管理：构建安全访问控制
角色的概念
权限管理
安全最佳实践
角色的创建与属性
权限分配
角色继承与权限层次
审计与日志记录：追踪与合规
审计策略
日志配置与分析
日志配置
分析日志文件
识别潜在威胁或性能瓶颈
审计日志解读与响应
数据备份与恢复：保障数据安全的最后一道防线
备份方法
恢复策略
定期备份与自动化
角色与权限管理：构建安全访问控制 在PostgreSQL中，构建安全的访问控制体系是维护数据库安全和数据完整性的重要环节。这一过程的核心在于有效地管理和分配“角色”以及所拥有的“权限”。
角色的概念 角色的双重身份：在PostgreSQL中，角色既是用户也是权限的集合体。它可以代表单个用户，也可以是一组用户的集合（比如，一个部门的所有成员），这样就可以通过角色一次性为多个用户分配相同的权限。
用户与角色的关联：用户通过成为角色的成员来获取权限。用户可以是单个角色，也可以同时属于多个角色，从而继承这些角色的所有权限。
PUBLIC角色：PostgreSQL中有一个特殊的角色PUBLIC，代表系统中的所有用户。向PUBLIC授予的权限将自动赋予任何未明确指定角色的用户，因此应谨慎使用。
角色继承：角色之间可以形成层次结构，高级角色可以继承低级角色的权限，这有助于权限的分层管理。
权限管理 权限类型：权限包括但不限于读（SELECT）、写（INSERT、UPDATE、DELETE）、创建（CREATE）、修改（ALTER）和删除（DROP）等操作权限，以及函数执行权限、角色管理权限等。
权限授予：使用GRANT命令为角色或具体用户授予权限。可以针对整个数据库、特定表、列、函数或序列等对象进行权限分配。通过WITH GRANT OPTION子句，还可以允许接收权限的角色进一步将权限转授他人。
权限撤销：使用REVOKE命令撤销已分配的权限。需要注意的是，对象的拥有者和超级用户通常具有撤销权限的权力，但对象拥有者对自己拥有的对象的某些特殊权限（如DROP）不能被撤销。
默认权限设置：可以为数据库或模式设置默认权限，使得未来在此数据库或模式下创建的对象自动继承这些权限，有助于简化权限管理。
安全最佳实践 最小权限原则：仅给予用户完成其工作所必需的最小权限集，减少潜在的损害风险。定期审计：定期审查权限分配，确保权限符合当前的安全策略和业务需求。使用角色组：创建角色组以管理相似权限的用户，便于批量调整权限和简化管理。自动管理脚本：利用脚本自动化权限管理，减少人为错误，确保权限设置的一致性和可追溯性。保护超级用户账户：严格限制超级用户账户的使用，仅在绝对必要时才使用，以防止误操作导致的严重后果。 角色的创建与属性 创建角色并设定密码： CREATE ROLE sales_admin WITH LOGIN PASSWORD &#39;secure_password&#39;; 设置角色属性，如超时、连接限制： ALTER ROLE sales_admin VALID UNTIL &#39;2023-12-31&#39;; 权限分配 授予权限给角色，包括数据库、表、函数等： GRANT CONNECT ON DATABASE sales_db TO sales_admin; GRANT SELECT, INSERT ON ALL TABLES IN SCHEMA public TO data_analyst; 使用GRANT .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-28T10:45:00+08:00">
    <meta property="article:modified_time" content="2024-06-28T10:45:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【PostgreSQL】守护城堡：PostgreSQL用户管理与安全性强化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E8%A7%92%E8%89%B2%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-toc" style="margin-left:120px;"><a href="#%E8%A7%92%E8%89%B2%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6" rel="nofollow">角色与权限管理：构建安全访问控制</a></p> 
<p id="%E8%A7%92%E8%89%B2%E7%9A%84%E6%A6%82%E5%BF%B5-toc" style="margin-left:160px;"><a href="#%E8%A7%92%E8%89%B2%E7%9A%84%E6%A6%82%E5%BF%B5" rel="nofollow">角色的概念</a></p> 
<p id="%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86-toc" style="margin-left:160px;"><a href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86" rel="nofollow">权限管理</a></p> 
<p id="%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5-toc" style="margin-left:160px;"><a href="#%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" rel="nofollow">安全最佳实践</a></p> 
<p id="%E8%A7%92%E8%89%B2%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%B1%9E%E6%80%A7-toc" style="margin-left:160px;"><a href="#%E8%A7%92%E8%89%B2%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%B1%9E%E6%80%A7" rel="nofollow">角色的创建与属性</a></p> 
<p id="%E6%9D%83%E9%99%90%E5%88%86%E9%85%8D-toc" style="margin-left:160px;"><a href="#%E6%9D%83%E9%99%90%E5%88%86%E9%85%8D" rel="nofollow">权限分配</a></p> 
<p id="%E8%A7%92%E8%89%B2%E7%BB%A7%E6%89%BF%E4%B8%8E%E6%9D%83%E9%99%90%E5%B1%82%E6%AC%A1-toc" style="margin-left:160px;"><a href="#%E8%A7%92%E8%89%B2%E7%BB%A7%E6%89%BF%E4%B8%8E%E6%9D%83%E9%99%90%E5%B1%82%E6%AC%A1" rel="nofollow">角色继承与权限层次</a></p> 
<p id="%E5%AE%A1%E8%AE%A1%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%90%88%E8%A7%84-toc" style="margin-left:120px;"><a href="#%E5%AE%A1%E8%AE%A1%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%90%88%E8%A7%84" rel="nofollow">审计与日志记录：追踪与合规</a></p> 
<p id="%E5%AE%A1%E8%AE%A1%E7%AD%96%E7%95%A5-toc" style="margin-left:160px;"><a href="#%E5%AE%A1%E8%AE%A1%E7%AD%96%E7%95%A5" rel="nofollow">审计策略</a></p> 
<p id="%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%88%86%E6%9E%90-toc" style="margin-left:160px;"><a href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%88%86%E6%9E%90" rel="nofollow">日志配置与分析</a></p> 
<p id="%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE" rel="nofollow">日志配置</a></p> 
<p id="%E5%88%86%E6%9E%90%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E5%88%86%E6%9E%90%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6" rel="nofollow">分析日志文件</a></p> 
<p id="%E8%AF%86%E5%88%AB%E6%BD%9C%E5%9C%A8%E5%A8%81%E8%83%81%E6%88%96%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88-toc" style="margin-left:80px;"><a href="#%E8%AF%86%E5%88%AB%E6%BD%9C%E5%9C%A8%E5%A8%81%E8%83%81%E6%88%96%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88" rel="nofollow">识别潜在威胁或性能瓶颈</a></p> 
<p id="%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%93%8D%E5%BA%94-toc" style="margin-left:160px;"><a href="#%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%93%8D%E5%BA%94" rel="nofollow">审计日志解读与响应</a></p> 
<p id="%C2%A0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D%EF%BC%9A%E4%BF%9D%E9%9A%9C%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF-toc" style="margin-left:120px;"><a href="#%C2%A0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D%EF%BC%9A%E4%BF%9D%E9%9A%9C%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF" rel="nofollow"> 数据备份与恢复：保障数据安全的最后一道防线</a></p> 
<p id="%E5%A4%87%E4%BB%BD%E6%96%B9%E6%B3%95-toc" style="margin-left:160px;"><a href="#%E5%A4%87%E4%BB%BD%E6%96%B9%E6%B3%95" rel="nofollow">备份方法</a></p> 
<p id="%E6%81%A2%E5%A4%8D%E7%AD%96%E7%95%A5-toc" style="margin-left:160px;"><a href="#%E6%81%A2%E5%A4%8D%E7%AD%96%E7%95%A5" rel="nofollow">恢复策略</a></p> 
<p id="%E5%AE%9A%E6%9C%9F%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96-toc" style="margin-left:160px;"><a href="#%E5%AE%9A%E6%9C%9F%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96" rel="nofollow">定期备份与自动化</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h5 id="%E8%A7%92%E8%89%B2%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%89%E5%85%A8%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6" style="background-color:transparent;">角色与权限管理：构建安全访问控制</h5> 
<p>     在PostgreSQL中，构建安全的访问控制体系是维护数据库安全和数据完整性的重要环节。这一过程的核心在于有效地管理和分配“角色”以及所拥有的“权限”。</p> 
<h6 id="%E8%A7%92%E8%89%B2%E7%9A%84%E6%A6%82%E5%BF%B5">角色的概念</h6> 
<ol><li> <p><strong>角色的双重身份</strong>：在PostgreSQL中，角色既是用户也是权限的集合体。它可以代表单个用户，也可以是一组用户的集合（比如，一个部门的所有成员），这样就可以通过角色一次性为多个用户分配相同的权限。</p> </li><li> <p><strong>用户与角色的关联</strong>：用户通过成为角色的成员来获取权限。用户可以是单个角色，也可以同时属于多个角色，从而继承这些角色的所有权限。</p> </li><li> <p><strong>PUBLIC角色</strong>：PostgreSQL中有一个特殊的角色<code>PUBLIC</code>，代表系统中的所有用户。向<code>PUBLIC</code>授予的权限将自动赋予任何未明确指定角色的用户，因此应谨慎使用。</p> </li><li> <p><strong>角色继承</strong>：角色之间可以形成层次结构，高级角色可以继承低级角色的权限，这有助于权限的分层管理。</p> </li></ol> 
<h6 id="%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86">权限管理</h6> 
<ol><li> <p><strong>权限类型</strong>：权限包括但不限于读（SELECT）、写（INSERT、UPDATE、DELETE）、创建（CREATE）、修改（ALTER）和删除（DROP）等操作权限，以及函数执行权限、角色管理权限等。</p> </li><li> <p><strong>权限授予</strong>：使用<code>GRANT</code>命令为角色或具体用户授予权限。可以针对整个数据库、特定表、列、函数或序列等对象进行权限分配。通过<code>WITH GRANT OPTION</code>子句，还可以允许接收权限的角色进一步将权限转授他人。</p> </li><li> <p><strong>权限撤销</strong>：使用<code>REVOKE</code>命令撤销已分配的权限。需要注意的是，对象的拥有者和超级用户通常具有撤销权限的权力，但对象拥有者对自己拥有的对象的某些特殊权限（如<code>DROP</code>）不能被撤销。</p> </li><li> <p><strong>默认权限设置</strong>：可以为数据库或模式设置默认权限，使得未来在此数据库或模式下创建的对象自动继承这些权限，有助于简化权限管理。</p> </li></ol> 
<h6 id="%E5%AE%89%E5%85%A8%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">安全最佳实践</h6> 
<ul><li><strong>最小权限原则</strong>：仅给予用户完成其工作所必需的最小权限集，减少潜在的损害风险。</li><li><strong>定期审计</strong>：定期审查权限分配，确保权限符合当前的安全策略和业务需求。</li><li><strong>使用角色组</strong>：创建角色组以管理相似权限的用户，便于批量调整权限和简化管理。</li><li><strong>自动管理脚本</strong>：利用脚本自动化权限管理，减少人为错误，确保权限设置的一致性和可追溯性。</li><li><strong>保护超级用户账户</strong>：严格限制超级用户账户的使用，仅在绝对必要时才使用，以防止误操作导致的严重后果。</li></ul> 
<h6 id="%E8%A7%92%E8%89%B2%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%B1%9E%E6%80%A7">角色的创建与属性</h6> 
<ul><li>创建角色并设定密码：</li></ul> 
<pre><code class="language-sql">CREATE ROLE sales_admin WITH LOGIN PASSWORD 'secure_password';</code></pre> 
<ul><li>设置角色属性，如超时、连接限制： <pre><code class="language-sql">ALTER ROLE sales_admin VALID UNTIL '2023-12-31';</code></pre> <h6 id="%E6%9D%83%E9%99%90%E5%88%86%E9%85%8D">权限分配</h6> </li><li>授予权限给角色，包括数据库、表、函数等：</li></ul> 
<pre><code class="language-sql">GRANT CONNECT ON DATABASE sales_db TO sales_admin;
GRANT SELECT, INSERT ON ALL TABLES IN SCHEMA public TO data_analyst;</code></pre> 
<ul><li>使用<code>GRANT ... WITH GRANT OPTION</code>允许角色传递权限： <pre><code class="language-sql">GRANT UPDATE ON orders TO manager WITH GRANT OPTION;</code></pre> <h6 id="%E8%A7%92%E8%89%B2%E7%BB%A7%E6%89%BF%E4%B8%8E%E6%9D%83%E9%99%90%E5%B1%82%E6%AC%A1">角色继承与权限层次</h6> </li><li>角色可以继承其他角色的权限，形成权限层次结构： <pre><code class="language-sql">CREATE ROLE regional_manager INHERITS (manager);</code></pre> <h5 id="%E5%AE%A1%E8%AE%A1%E4%B8%8E%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%EF%BC%9A%E8%BF%BD%E8%B8%AA%E4%B8%8E%E5%90%88%E8%A7%84">审计与日志记录：追踪与合规</h5> <p>审计和日志是确保数据库安全性和合规性的关键工具，帮助监控和分析数据库活动。</p> <h6 id="%E5%AE%A1%E8%AE%A1%E7%AD%96%E7%95%A5">审计策略</h6> </li><li>配置PostgreSQL的内置审计功能或使用第三方审计插件，如<code>pgaudit</code>。 <pre><code class="language-sql">-- 配置pgaudit以记录所有DDL操作
ALTER SYSTEM SET shared_preload_libraries = 'pgaudit';
ALTER DATABASE mydb SET pgaudit.log = 'ddl';</code></pre> <h6 id="%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%88%86%E6%9E%90">日志配置与分析</h6> </li><li> <p>调整PostgreSQL的log_level，启用详细日志记录：</p> <pre><code class="language-sql">ALTER SYSTEM SET log_statement = 'all';</code></pre> </li></ul> 
<p></p> 
<h4 id="%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE">日志配置</h4> 
<ul><li><strong>log_destination</strong>: 指定日志的输出位置，可以是<code>stderr</code>、<code>csvlog</code>、<code>syslog</code>等，或它们的组合。</li><li><strong>logging_collector</strong>: 设为<code>on</code>以启用日志收集器，这对于使用<code>csvlog</code>格式特别重要。</li><li><strong>log_directory</strong>: 日志文件的存放目录。</li><li><strong>log_filename</strong>: 日志文件的基本名称格式，通常包含时间变量以生成滚动日志。</li><li><strong>log_rotation_age</strong>: 日志文件的滚动周期，基于时间（例如，一天）。</li><li><strong>log_min_messages</strong>: 控制写入日志的最低消息级别，如<code>DEBUG1</code>、<code>INFO</code>、<code>NOTICE</code>、<code>WARNING</code>、<code>ERROR</code>、<code>FATAL</code>或<code>PANIC</code>。</li><li><strong>log_statement</strong>: 记录执行的SQL语句类型，如<code>none</code>、<code>ddl</code>、<code>mod</code>或<code>all</code>，对于性能分析和安全审计非常重要。</li><li><strong>log_duration</strong>: 记录每个完成的SQL语句的执行时间，有助于性能分析。</li><li><strong>log_lock_waits</strong>: 记录长时间的锁等待事件，有助于识别并发问题。</li><li><strong>log_checkpoints</strong>: 记录检查点信息，对于监控数据库恢复进度和优化checkpoint策略有用。</li><li><strong>log_connections</strong>, <strong>log_disconnections</strong>, <strong>log_hostname</strong>: 记录客户端连接和断开的细节，有助于安全监控。</li></ul> 
<h4 id="%E5%88%86%E6%9E%90%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6">分析日志文件</h4> 
<p>一旦配置好日志，接下来就是分析这些日志来识别问题。常用的分析工具有：</p> 
<ul><li><strong>pgBadger</strong>: 这是一个快速且强大的日志分析工具，能够生成HTML报告，展示查询性能、锁等待、错误统计等。使用pgBadger，你可以快速识别慢查询、频繁的错误和锁争用情况，它是性能调优和问题排查的得力助手。</li><li><strong>手动分析</strong>: 对于简单的分析，可以直接查看日志文件，寻找错误消息、警告或特定关键词，比如<code>ERROR</code>、<code>WARNING</code>、<code>timeout</code>、<code>deadlock detected</code>等。</li><li><strong>日志管理系统</strong>: 将日志集成到日志管理系统（如ELK Stack、Splunk）中，利用这些平台的搜索和分析能力进行实时监控和趋势分析。</li></ul> 
<h4 id="%E8%AF%86%E5%88%AB%E6%BD%9C%E5%9C%A8%E5%A8%81%E8%83%81%E6%88%96%E6%80%A7%E8%83%BD%E7%93%B6%E9%A2%88">识别潜在威胁或性能瓶颈</h4> 
<ul><li><strong>安全威胁识别</strong>：关注未经授权的访问尝试、登录失败、异常的SQL活动（如大量数据删除或修改）、以及任何与安全相关的错误消息。</li><li><strong>性能瓶颈识别</strong>：通过分析慢查询（特别是那些出现在<code>log_min_duration_statement</code>设置之下）和频繁执行的查询，识别资源消耗大的操作。此外，监控锁等待和死锁可以帮助发现并发控制问题。</li><li><strong>系统健康监控</strong>：检查检查点活动、后台进程错误以及资源使用情况（如内存、磁盘I/O）的异常，以保持系统稳定。</li></ul> 
<h6 id="%E5%AE%A1%E8%AE%A1%E6%97%A5%E5%BF%97%E8%A7%A3%E8%AF%BB%E4%B8%8E%E5%93%8D%E5%BA%94">审计日志解读与响应</h6> 
<p>示例分析日志条目，识别特定活动模式，如异常登录尝试。</p> 
<pre><code class="language-sql">grep "FATAL:  password authentication failed" postgresql.log</code></pre> 
<h5 id="%C2%A0%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D%EF%BC%9A%E4%BF%9D%E9%9A%9C%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E9%81%93%E9%98%B2%E7%BA%BF"> 数据备份与恢复：保障数据安全的最后一道防线</h5> 
<p>数据备份与恢复策略是应对灾难性事件，保护数据不丢失的重要措施。</p> 
<h6 id="%E5%A4%87%E4%BB%BD%E6%96%B9%E6%B3%95">备份方法</h6> 
<ul><li> <p><strong>物理备份</strong>：使用<code>pg_basebackup</code>进行全量备份。</p> <pre><code class="language-sql">pg_basebackup -D /var/backups/pg_backup -Ft -Xs</code></pre> <p><strong>逻辑备份</strong>：使用<code>pg_dump</code>进行结构和数据的导出。</p> <pre><code class="language-sql">pg_dump -F c -b -v -f db_backup.dump dbname</code></pre> <h6 id="%E6%81%A2%E5%A4%8D%E7%AD%96%E7%95%A5">恢复策略</h6> </li><li> <p>从物理备份恢复：</p> <pre><code class="language-sql"># 停止数据库服务
systemctl stop postgresql
# 恢复数据
cp -r /var/backups/pg_backup/* /var/lib/postgresql/data/
# 重置wal文件
rm /var/lib/postgresql/data/*.history /var/lib/postgresql/data/*.backup
# 重启服务
systemctl start postgresql</code></pre> <p>从逻辑备份恢复：</p> <pre><code class="language-sql">createdb -T template0 restored_db
pg_restore -C -d restored_db db_backup.dump</code></pre> <h6 id="%E5%AE%9A%E6%9C%9F%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96">定期备份与自动化</h6> </li><li>使用cron作业或第三方工具自动化备份过程，确保定期且无人值守的备份。 <pre><code class="language-sql"># 每天凌晨2点执行备份
0 2 * * * pg_dump -U username -F c -b -v -f /path/to/backup/dbname_`date +%Y%m%d`.dump dbname</code></pre> <p></p> </li></ul> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/56aa60d24455dd490943160ea95f17d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">5000字深入讲解：企业数字化转型优先从哪个板块开始？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c8e03aaaf1a2f4ec6d61f3ca93c3edc6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于iview.viewUI实现行合并（无限制/有限制合并）【已验证可正常运行】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>