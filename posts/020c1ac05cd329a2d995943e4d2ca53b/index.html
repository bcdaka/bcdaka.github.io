<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Server 数据误删的恢复 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/020c1ac05cd329a2d995943e4d2ca53b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SQL Server 数据误删的恢复">
  <meta property="og:description" content="在日常的数据库管理中，数据的误删操作是难以避免的。为了确保数据的安全性和完整性，我们必须采取一些措施来进行数据的备份和恢复。本文将详细介绍如何在 SQL Server 中进行数据的备份和恢复操作，特别是在发生数据误删的情况下。假设我们已经开启了全量备份，并且在误操作之前有一个全量备份文件。
一、模拟误删 1. 创建表并插入测试数据 首先，我们需要创建一个名为 “Test” 的数据库，并在其中创建一个名为 “Student” 的表。该表将包含一些测试数据。
SSMS 连接本地 SQL Server。
创建新数据库 “Test”。
创建数据库 “Test”，并在该库内创建数据表 “Student”
-- 创建数据库 CREATE DATABASE Test; -- 使用 Test 数据库 USE Test; -- 创建 Student 表 CREATE TABLE Student ( id INT IDENTITY(1,1) PRIMARY KEY, name NVARCHAR(255) NOT NULL, phone NVARCHAR(50) NOT NULL, gender NVARCHAR(10) NOT NULL, created_at DATETIME DEFAULT GETDATE() ); -- 插入十条测试数据 INSERT INTO Student (name, phone, gender, created_at) VALUES (&#39;Alice&#39;, &#39;1234567890&#39;, &#39;Female&#39;, GETDATE()), (&#39;Bob&#39;, &#39;0987654321&#39;, &#39;Male&#39;, GETDATE()), (&#39;Cathy&#39;, &#39;1231231234&#39;, &#39;Female&#39;, GETDATE()), (&#39;David&#39;, &#39;3213214321&#39;, &#39;Male&#39;, GETDATE()), (&#39;Eva&#39;, &#39;5556667777&#39;, &#39;Female&#39;, GETDATE()), (&#39;Frank&#39;, &#39;8889990000&#39;, &#39;Male&#39;, GETDATE()), (&#39;Grace&#39;, &#39;2223334444&#39;, &#39;Female&#39;, GETDATE()), (&#39;Henry&#39;, &#39;4445556666&#39;, &#39;Male&#39;, GETDATE()), (&#39;Ivy&#39;, &#39;1112223333&#39;, &#39;Female&#39;, GETDATE()), (&#39;Jack&#39;, &#39;7778889999&#39;, &#39;Male&#39;, GETDATE()); 记录本次操作时间为：2024-07-23 17:30:45">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-24T12:06:09+08:00">
    <meta property="article:modified_time" content="2024-07-24T12:06:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Server 数据误删的恢复</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在日常的数据库管理中，数据的误删操作是难以避免的。为了确保数据的安全性和完整性，我们必须采取一些措施来进行数据的备份和恢复。本文将详细介绍如何在 SQL Server 中进行数据的备份和恢复操作，特别是在发生数据误删的情况下。假设我们已经开启了全量备份，并且在误操作之前有一个全量备份文件。</p> 
<hr> 
<h3><a id="_3"></a>一、模拟误删</h3> 
<h4><a id="1__5"></a>1. 创建表并插入测试数据</h4> 
<p>首先，我们需要创建一个名为 “Test” 的数据库，并在其中创建一个名为 “Student” 的表。该表将包含一些测试数据。</p> 
<p>SSMS 连接本地 SQL Server。</p> 
<p><img src="https://images2.imgbox.com/62/b4/EhXHgKke_o.png" alt="在这里插入图片描述"></p> 
<p>创建新数据库 “Test”。</p> 
<p><img src="https://images2.imgbox.com/ef/c0/vSioRke7_o.png" alt="【图002】"></p> 
<p>创建数据库 “Test”，并在该库内创建数据表 “Student”</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建数据库</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> Test<span class="token punctuation">;</span>

<span class="token comment">-- 使用 Test 数据库</span>
<span class="token keyword">USE</span> Test<span class="token punctuation">;</span>

<span class="token comment">-- 创建 Student 表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student <span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    name NVARCHAR<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    phone NVARCHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    gender NVARCHAR<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
    created_at <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 插入十条测试数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> created_at<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> <span class="token string">'1234567890'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token string">'0987654321'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Cathy'</span><span class="token punctuation">,</span> <span class="token string">'1231231234'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'David'</span><span class="token punctuation">,</span> <span class="token string">'3213214321'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Eva'</span><span class="token punctuation">,</span> <span class="token string">'5556667777'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Frank'</span><span class="token punctuation">,</span> <span class="token string">'8889990000'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Grace'</span><span class="token punctuation">,</span> <span class="token string">'2223334444'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Henry'</span><span class="token punctuation">,</span> <span class="token string">'4445556666'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Ivy'</span><span class="token punctuation">,</span> <span class="token string">'1112223333'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token string">'7778889999'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><em>记录本次操作时间为：2024-07-23 17:30:45</em></p> 
<p><img src="https://images2.imgbox.com/ad/c9/qFDp6Oda_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h4><a id="2__56"></a>2. 数据库全量备份</h4> 
<p>恢复的前提是数据库在误删前进行过一次全量备份。</p> 
<p>全量备份流程：</p> 
<p>右键 “Test” 数据库，点击备份(Back Up)，备份文件命名为 “testDB.bak”，存储在自定义目录，我存储在 “D:\testDB.bak”。</p> 
<p><img src="https://images2.imgbox.com/ad/12/zPD4ao5V_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/23/81/3fq2D8pc_o.png" alt="在这里插入图片描述"></p> 
<p>备份成功。</p> 
<p><img src="https://images2.imgbox.com/cb/88/XKZ261Hs_o.png" alt="在这里插入图片描述"></p> 
<p><em>记录本次操作时间为：2024-07-23 17:32:30</em></p> 
<hr> 
<h4><a id="3__76"></a>3. 未备份的新操作</h4> 
<p>如果我们的数据库全量备份之后没有任何操作，那这个还原是毫无难度的，草履虫也会。本篇重点讲如果全量备份之后，再有为备份的新操作该如何处理，这也符合实际应用中的场景。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 插入五条测试数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> created_at<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token string">'Lily'</span><span class="token punctuation">,</span> <span class="token string">'1114447777'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Mike'</span><span class="token punctuation">,</span> <span class="token string">'2225558888'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Nina'</span><span class="token punctuation">,</span> <span class="token string">'3336669999'</span><span class="token punctuation">,</span> <span class="token string">'Female'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Oscar'</span><span class="token punctuation">,</span> <span class="token string">'4447770000'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Paul'</span><span class="token punctuation">,</span> <span class="token string">'5558881111'</span><span class="token punctuation">,</span> <span class="token string">'Male'</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/18/ab/zbPEBo0Q_o.png" alt="在这里插入图片描述"></p> 
<p><em>记录本次操作时间为：2024-07-23 17:35:14</em></p> 
<hr> 
<h4><a id="4__96"></a>4. 模拟数据误删</h4> 
<p>为了模拟数据误删的情况，我们将进行一次全量更新操作，导致所有记录的手机号码（phone）字段丢失。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 模拟全量更新操作，导致手机号码丢失</span>
<span class="token keyword">UPDATE</span> Student
<span class="token keyword">SET</span> phone <span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/fd/FYTNZ6vc_o.png" alt="在这里插入图片描述"></p> 
<p>执行上述 SQL 脚本后，Student 表中的所有记录的 phone 字段将被更新为 NULL，模拟了数据误删的情况。</p> 
<p><img src="https://images2.imgbox.com/a3/18/0TRZf9g0_o.png" alt="在这里插入图片描述"></p> 
<p><em>记录本次操作时间为：2024-07-23 17:35:41</em></p> 
<p>这是数据维护中经常遇到的问题，因为某些原因导致 Where 条件的子项查询没有生效，导致全量更新，等同于某一列被直接删除。还有一些 Delete From / Drop Table 之类的情况，其实和这个的恢复方式一样。</p> 
<hr> 
<h3><a id="_120"></a>二、数据恢复步骤</h3> 
<h4><a id="1__121"></a>1. 备份日志</h4> 
<p>在误删发生后，我们需要备份当前的事务日志，以确保在恢复过程中不会丢失任何数据。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 备份当前的事务日志</span>
<span class="token keyword">BACKUP</span> LOG Test <span class="token keyword">TO</span> <span class="token keyword">DISK</span><span class="token operator">=</span><span class="token string">'d:\testLOG.bak'</span> <span class="token keyword">WITH</span> FORMAT
GO
</code></pre> 
<p><img src="https://images2.imgbox.com/39/50/4QIC23fm_o.png" alt="在这里插入图片描述"></p> 
<p><em>记录本次操作时间为：2024-07-23 17:37:16</em></p> 
<hr> 
<h4><a id="2__137"></a>2. 还原数据库到指定时间点</h4> 
<p>接下来，我们将还原数据库到误操作之前的状态。这个过程包括还原之前的全量备份和刚刚备份的事务日志（截至到误删前的部分）。</p> 
<p>在 SQL Server Management Studio 中，右键单击要还原的数据库（Test），选择“任务” -&gt; “还原” -&gt; “数据库”</p> 
<p>在“选项”标签中，勾选“关闭现有连接到目标数据库”，选择 之前的全量备份 和 刚刚备份的事务日志。</p> 
<p><img src="https://images2.imgbox.com/95/b9/xvP1IqOL_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1c/23/tCBmmomV_o.png" alt="在这里插入图片描述"></p> 
<p>在通用里，选择一个还原到的具体时间点。这里的时间点如果记不清了，则需要我们去尽可能推算，因为生产数据时刻在变化，尽可能恢复到误删前的前一刻的数据可以避免更多的损失。</p> 
<p><img src="https://images2.imgbox.com/1d/e3/eqcXOv0d_o.png" alt="在这里插入图片描述"></p> 
<p>这里我们的误删操作发生在：2024-07-23 17:35:41。</p> 
<p>因此，我们选择还原到这个时间的前一刻，我选择 2024-07-23 17:35:30。</p> 
<p><img src="https://images2.imgbox.com/a7/39/IH8zLdMe_o.png" alt="在这里插入图片描述"></p> 
<p>点击“确定”开始还原。</p> 
<p><img src="https://images2.imgbox.com/b2/72/mC12nm8w_o.png" alt="在这里插入图片描述"></p> 
<p>还原成功。</p> 
<hr> 
<h4><a id="3__173"></a>3. 检验恢复结果</h4> 
<p>还原完成后，我们需要验证数据是否已经被成功恢复。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 查看 Student 表中的数据</span>
<span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span>
      <span class="token punctuation">,</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      <span class="token punctuation">,</span><span class="token punctuation">[</span>phone<span class="token punctuation">]</span>
      <span class="token punctuation">,</span><span class="token punctuation">[</span>gender<span class="token punctuation">]</span>
      <span class="token punctuation">,</span><span class="token punctuation">[</span>created_at<span class="token punctuation">]</span>
  <span class="token keyword">FROM</span> <span class="token punctuation">[</span>Test<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Student<span class="token punctuation">]</span>
</code></pre> 
<p>执行上述查询语句后，我们可以看到所有记录的 phone 字段已经被恢复到误操作之前的状态。</p> 
<p><img src="https://images2.imgbox.com/27/51/B2XyuCKG_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h4><a id="4__194"></a>4. 恢复数据库可读写</h4> 
<p>从刚刚的截图上我们看到，虽然数据被恢复了，但是因为使用了日志事务，所以Test数据库变成了StandBy/ReadOnly状态。当前状态下，数据库是无法被写入的，我们需要解除这种状态。</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 切换到 master 数据库</span>
<span class="token keyword">USE</span> master<span class="token punctuation">;</span>

<span class="token comment">-- 在主服务器上移除日志传送配置</span>
<span class="token keyword">EXEC</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sp_delete_log_shipping_primary_secondary
    <span class="token variable">@primary_database</span> <span class="token operator">=</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>            <span class="token comment">-- 主数据库名称</span>
    <span class="token variable">@secondary_server</span> <span class="token operator">=</span> <span class="token string">'&lt;SecondaryServerName&gt;'</span><span class="token punctuation">,</span> <span class="token comment">-- 备用服务器名称</span>
    <span class="token variable">@secondary_database</span> <span class="token operator">=</span> <span class="token string">'Test'</span><span class="token punctuation">;</span>          <span class="token comment">-- 备用数据库名称</span>

<span class="token comment">-- 在主服务器上移除主数据库的日志传送配置</span>
<span class="token keyword">EXEC</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sp_delete_log_shipping_primary_database
    <span class="token variable">@database</span> <span class="token operator">=</span> <span class="token string">'Test'</span><span class="token punctuation">;</span>                    <span class="token comment">-- 主数据库名称</span>

<span class="token comment">-- 在备用服务器上移除日志传送配置</span>
<span class="token keyword">EXEC</span> master<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>sp_delete_log_shipping_secondary_database
    <span class="token variable">@secondary_database</span> <span class="token operator">=</span> <span class="token string">'Test'</span><span class="token punctuation">;</span>          <span class="token comment">-- 备用数据库名称</span>

<span class="token comment">-- 恢复数据库</span>
<span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> Test <span class="token keyword">WITH</span> RECOVERY<span class="token punctuation">;</span>

<span class="token comment">-- 将数据库设置为读写模式</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> Test <span class="token keyword">SET</span> READ_WRITE<span class="token punctuation">;</span>
</code></pre> 
<p>我们刷新数据库，看到数据库Test已经变为可写入的正常状态了。</p> 
<p><img src="https://images2.imgbox.com/1e/90/2HvfHijn_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="SQL_Server__230"></a>三、SQL Server 数据误删总结</h3> 
<p>通过本文的介绍，我们学习了如何在 SQL Server 中进行数据的备份和恢复操作，特别是在数据误删的情况下。数据误删是数据库管理中一个常见而严重的问题，如果没有有效的备份和恢复策略，可能会导致无法挽回的损失。</p> 
<h4><a id="1__234"></a>1. 数据备份策略</h4> 
<p>定期备份是保障数据安全的最有效手段之一。SQL Server 提供了多种备份策略，包括：</p> 
<ul><li><strong>完全备份</strong>：备份整个数据库的所有数据。这种备份方式最为全面，但也最耗时和占用空间最多。</li><li><strong>差异备份</strong>：备份自上次完全备份以来所有更改的数据。它比完全备份更快，但仍然需要上次的完全备份来恢复数据。</li><li><strong>事务日志备份</strong>：备份自上次事务日志备份以来所有更改的事务日志。它允许我们恢复到特定的时间点，非常适合用于数据误删后的恢复。</li></ul> 
<hr> 
<h4><a id="2__243"></a>2. 数据恢复操作</h4> 
<p>当数据被误删时，正确的恢复操作至关重要。通过以下步骤，我们可以有效地恢复数据：</p> 
<ol><li><strong>识别误删数据的时间点</strong>：确定数据被误删的具体时间。</li><li><strong>停止数据库的写操作</strong>：防止新的数据写入干扰恢复过程。</li><li><strong>还原最近的完全备份</strong>：<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>YourDatabase<span class="token punctuation">]</span> <span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\YourDatabase_full.bak'</span> <span class="token keyword">WITH</span> NORECOVERY<span class="token punctuation">;</span>
</code></pre> </li><li><strong>还原最近的差异备份（如果有）</strong>：<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> <span class="token punctuation">[</span>YourDatabase<span class="token punctuation">]</span> <span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\YourDatabase_diff.bak'</span> <span class="token keyword">WITH</span> NORECOVERY<span class="token punctuation">;</span>
</code></pre> </li><li><strong>还原事务日志备份，直到误删数据的时间点</strong>：<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> LOG <span class="token punctuation">[</span>YourDatabase<span class="token punctuation">]</span> <span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\YourDatabase_log.trn'</span> <span class="token keyword">WITH</span> STOPAT <span class="token operator">=</span> <span class="token string">'YYYY-MM-DDTHH:MM:SS'</span><span class="token punctuation">,</span> RECOVERY<span class="token punctuation">;</span>
</code></pre> </li></ol> 
<p>通过全量备份和事务日志备份，我们能够有效地恢复误删的数据，确保数据的完整性和安全性。希望本文对大家在日常的数据库管理工作中有所帮助。</p> 
<hr> 
<h4><a id="3__266"></a>3. 本文参考资料</h4> 
<ul><li><a href="https://docs.microsoft.com/zh-cn/sql/sql-server/sql-server-technical-documentation" rel="nofollow">SQL Server 官方文档</a></li><li><a href="https://docs.microsoft.com/zh-cn/sql/ssms/sql-server-management-studio-ssms" rel="nofollow">SQL Server Management Studio 使用手册</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8277bf67823be2838c0946f2e00dc8c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一些和颜色相关网站</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7de8ce4f2c3525d4c702f7c4687d2649/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">写作新潮流：这五款AI写作工具，让你的作品脱颖而出</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>