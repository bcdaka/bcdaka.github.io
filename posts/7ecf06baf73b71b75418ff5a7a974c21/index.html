<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据仓库系列4-什么是维度建模,它与关系型建模有什么区别 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7ecf06baf73b71b75418ff5a7a974c21/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="数据仓库系列4-什么是维度建模,它与关系型建模有什么区别">
  <meta property="og:description" content="想象一下,你正在分析一家大型零售连锁店的销售数据。突然,你意识到传统的数据库模型无法有效地回答&#34;去年黑色星期五当天,哪个地区的哪类产品销售额最高?&#34;这样的复杂问题。这就是维度建模发挥作用的时候了
目录 引言:维度建模的魔力什么是维度建模?维度建模的定义维度建模的起源 维度建模 vs 关系型建模:关键区别关系型模型示例:维度模型示例(星型模式): 维度建模的核心概念1. 事实表(Fact Table)2. 维度表(Dimension Table)3. 星型模式(Star Schema)4. 雪花模式(Snowflake Schema)5. 缓慢变化维度(Slowly Changing Dimensions, SCD)6. 退化维度(Degenerate Dimension)7. 聚集事实(Aggregate Fact) 实际案例:零售业维度模型业务需求维度模型设计1. 事实表: FactSales2. 维度表: DimDate3. 维度表: DimProduct4. 维度表: DimStore5. 维度表: DimCustomer6. 维度表: DimPromotion 模型说明示例查询 维度建模的优势维度建模的挑战实施维度建模:最佳实践结论:选择正确的建模方法 引言:维度建模的魔力 在大数据时代,企业面临着前所未有的数据分析挑战。传统的关系型数据库模型在处理复杂的多维度查询时往往力不从心。这就是维度建模横空出世的原因 —— 它为数据仓库和商业智能系统提供了一种革命性的数据组织方法。
本文将深入探讨维度建模的本质,揭示它与传统关系型建模的根本区别,并通过具体示例展示其在现实世界中的应用。无论你是数据架构师、BI开发人员,还是对数据建模感兴趣的技术爱好者,这篇文章都将为你打开一扇通往高效数据分析的大门。
什么是维度建模? 维度建模是一种专为数据仓库和商业智能(BI)系统设计的数据建模技术。它的核心思想是将复杂的业务数据组织成直观、易于理解和高效查询的结构。
维度建模的定义 维度建模是一种数据组织和访问技术,它:
将数据分为事实(度量)和维度(上下文)两类。采用星型模式或雪花模式来组织这些事实和维度。优化了面向商业用户的查询性能和易用性。
维度建模的起源 维度建模的概念最早由Ralph Kimball在20世纪90年代提出。Kimball观察到,传统的实体关系(ER)建模虽然适合事务处理系统,但在支持复杂的分析查询时表现不佳。他提出了一种新的方法,将业务过程的度量(如销售额)放在中心,周围环绕着描述这些度量的维度(如时间、产品、客户等)。
维度建模 vs 关系型建模:关键区别 要真正理解维度建模的价值,我们需要将其与传统的关系型建模进行对比。以下是几个关键区别:
设计目标
关系型建模:主要目标是减少数据冗余,确保数据一致性。维度建模:主要目标是优化查询性能和提高数据的可理解性。 数据结构
关系型建模:通常使用高度规范化的表结构。维度建模:使用非规范化或部分规范化的星型或雪花型结构。 查询复杂性
关系型建模:复杂查询可能需要多个表连接,影响性能。维度建模:简化了复杂查询,减少了表连接的需求。 数据冗余
关系型建模:尽量减少数据冗余。维度建模:允许一定程度的冗余以提高查询效率。 灵活性
关系型建模:修改模式可能比较困难。维度建模:更容易适应新的业务需求和维度。 用户友好性
关系型建模:对于业务用户来说可能较难理解。维度建模:结构直观,易于业务用户理解和使用。 为了更清晰地展示这些差异,让我们看一个具体的例子:
假设我们有一个简单的销售系统,需要记录产品销售信息。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-25T10:30:54+08:00">
    <meta property="article:modified_time" content="2024-08-25T10:30:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据仓库系列4-什么是维度建模,它与关系型建模有什么区别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/c6/59/DrKD3l5i_o.png" alt="稿定设计-2.png"><br> 想象一下,你正在分析一家大型零售连锁店的销售数据。突然,你意识到传统的数据库模型无法有效地回答"去年黑色星期五当天,哪个地区的哪类产品销售额最高?"这样的复杂问题。这就是维度建模发挥作用的时候了</p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_4" rel="nofollow">引言:维度建模的魔力</a></li><li><a href="#_10" rel="nofollow">什么是维度建模?</a></li><li><ul><li><a href="#_14" rel="nofollow">维度建模的定义</a></li><li><a href="#_22" rel="nofollow">维度建模的起源</a></li></ul> 
   </li><li><a href="#_vs__26" rel="nofollow">维度建模 vs 关系型建模:关键区别</a></li><li><ul><li><a href="#_59" rel="nofollow">关系型模型示例:</a></li><li><a href="#_91" rel="nofollow">维度模型示例(星型模式):</a></li></ul> 
   </li><li><a href="#_143" rel="nofollow">维度建模的核心概念</a></li><li><ul><li><a href="#1_Fact_Table_147" rel="nofollow">1. 事实表(Fact Table)</a></li><li><a href="#2_Dimension_Table_172" rel="nofollow">2. 维度表(Dimension Table)</a></li><li><a href="#3_Star_Schema_195" rel="nofollow">3. 星型模式(Star Schema)</a></li><li><a href="#4_Snowflake_Schema_204" rel="nofollow">4. 雪花模式(Snowflake Schema)</a></li><li><a href="#5_Slowly_Changing_Dimensions_SCD_232" rel="nofollow">5. 缓慢变化维度(Slowly Changing Dimensions, SCD)</a></li><li><a href="#6_Degenerate_Dimension_255" rel="nofollow">6. 退化维度(Degenerate Dimension)</a></li><li><a href="#7_Aggregate_Fact_273" rel="nofollow">7. 聚集事实(Aggregate Fact)</a></li></ul> 
   </li><li><a href="#_290" rel="nofollow">实际案例:零售业维度模型</a></li><li><ul><li><a href="#_295" rel="nofollow">业务需求</a></li><li><a href="#_303" rel="nofollow">维度模型设计</a></li><li><ul><li><a href="#1__FactSales_307" rel="nofollow">1. 事实表: FactSales</a></li><li><a href="#2__DimDate_331" rel="nofollow">2. 维度表: DimDate</a></li><li><a href="#3__DimProduct_366" rel="nofollow">3. 维度表: DimProduct</a></li><li><a href="#4__DimStore_387" rel="nofollow">4. 维度表: DimStore</a></li><li><a href="#5__DimCustomer_407" rel="nofollow">5. 维度表: DimCustomer</a></li><li><a href="#6__DimPromotion_429" rel="nofollow">6. 维度表: DimPromotion</a></li></ul> 
    </li><li><a href="#_445" rel="nofollow">模型说明</a></li><li><a href="#_459" rel="nofollow">示例查询</a></li></ul> 
   </li><li><a href="#_547" rel="nofollow">维度建模的优势</a></li><li><a href="#_560" rel="nofollow">维度建模的挑战</a></li><li><a href="#_573" rel="nofollow">实施维度建模:最佳实践</a></li><li><a href="#_591" rel="nofollow">结论:选择正确的建模方法</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_4"></a>引言:维度建模的魔力</h3> 
<p>在大数据时代,企业面临着前所未有的数据分析挑战。传统的关系型数据库模型在处理复杂的多维度查询时往往力不从心。这就是维度建模横空出世的原因 —— 它为数据仓库和商业智能系统提供了一种革命性的数据组织方法。<br> <img src="https://images2.imgbox.com/94/20/NYxmQZq4_o.png" alt="image.png"><br> 本文将深入探讨维度建模的本质,揭示它与传统关系型建模的根本区别,并通过具体示例展示其在现实世界中的应用。无论你是数据架构师、BI开发人员,还是对数据建模感兴趣的技术爱好者,这篇文章都将为你打开一扇通往高效数据分析的大门。</p> 
<h3><a id="_10"></a>什么是维度建模?</h3> 
<p>维度建模是一种专为数据仓库和商业智能(BI)系统设计的数据建模技术。它的核心思想是将复杂的业务数据组织成直观、易于理解和高效查询的结构。</p> 
<h4><a id="_14"></a>维度建模的定义</h4> 
<p>维度建模是一种数据组织和访问技术,它:</p> 
<ol><li>将数据分为事实(度量)和维度(上下文)两类。</li><li>采用星型模式或雪花模式来组织这些事实和维度。</li><li>优化了面向商业用户的查询性能和易用性。<br> <img src="https://images2.imgbox.com/2d/d3/d6edKR7n_o.png" alt="image.png"></li></ol> 
<h4><a id="_22"></a>维度建模的起源</h4> 
<p>维度建模的概念最早由Ralph Kimball在20世纪90年代提出。Kimball观察到,传统的实体关系(ER)建模虽然适合事务处理系统,但在支持复杂的分析查询时表现不佳。他提出了一种新的方法,将业务过程的度量(如销售额)放在中心,周围环绕着描述这些度量的维度(如时间、产品、客户等)。</p> 
<h3><a id="_vs__26"></a>维度建模 vs 关系型建模:关键区别</h3> 
<p>要真正理解维度建模的价值,我们需要将其与传统的关系型建模进行对比。以下是几个关键区别:</p> 
<ol><li> <p><strong>设计目标</strong></p> 
  <ul><li>关系型建模:主要目标是减少数据冗余,确保数据一致性。</li><li>维度建模:主要目标是优化查询性能和提高数据的可理解性。</li></ul> </li><li> <p><strong>数据结构</strong></p> 
  <ul><li>关系型建模:通常使用高度规范化的表结构。</li><li>维度建模:使用非规范化或部分规范化的星型或雪花型结构。</li></ul> </li><li> <p><strong>查询复杂性</strong></p> 
  <ul><li>关系型建模:复杂查询可能需要多个表连接,影响性能。</li><li>维度建模:简化了复杂查询,减少了表连接的需求。</li></ul> </li><li> <p><strong>数据冗余</strong></p> 
  <ul><li>关系型建模:尽量减少数据冗余。</li><li>维度建模:允许一定程度的冗余以提高查询效率。</li></ul> </li><li> <p><strong>灵活性</strong></p> 
  <ul><li>关系型建模:修改模式可能比较困难。</li><li>维度建模:更容易适应新的业务需求和维度。</li></ul> </li><li> <p><strong>用户友好性</strong></p> 
  <ul><li>关系型建模:对于业务用户来说可能较难理解。</li><li>维度建模:结构直观,易于业务用户理解和使用。</li></ul> </li></ol> 
<p><img src="https://images2.imgbox.com/56/64/Kj5YW7BV_o.png" alt="image.png"><br> 为了更清晰地展示这些差异,让我们看一个具体的例子:</p> 
<p>假设我们有一个简单的销售系统,需要记录产品销售信息。</p> 
<h4><a id="_59"></a>关系型模型示例:</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 产品表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Products <span class="token punctuation">(</span>
    ProductID <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CategoryID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    SupplierID <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 客户表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Customers <span class="token punctuation">(</span>
    CustomerID <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CustomerName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    City <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Country <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 销售表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Sales <span class="token punctuation">(</span>
    SaleID <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    SaleDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ProductID<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Products<span class="token punctuation">(</span>ProductID<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CustomerID<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Customers<span class="token punctuation">(</span>CustomerID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_91"></a>维度模型示例(星型模式):</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 日期维度</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimDate <span class="token punctuation">(</span>
    DateKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    FullDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    DayOfWeek <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">Month</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Quarter <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">Year</span> <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 产品维度</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimProduct <span class="token punctuation">(</span>
    ProductKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Category <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Supplier <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 客户维度</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimCustomer <span class="token punctuation">(</span>
    CustomerKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CustomerID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    City <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Country <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 销售事实表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> FactSales <span class="token punctuation">(</span>
    SaleKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    DateKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TotalAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimDate<span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimProduct<span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimCustomer<span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在这个例子中,我们可以看到:</p> 
<ol><li>关系型模型将数据分散在多个规范化的表中,而维度模型将相关的描述性信息合并到维度表中。</li><li>维度模型引入了一个专门的日期维度表,使得基于时间的分析更加方便。</li><li>维度模型的事实表(FactSales)包含了所有相关的度量和维度键,简化了查询。</li></ol> 
<h3><a id="_143"></a>维度建模的核心概念</h3> 
<p>要深入理解维度建模,我们需要掌握几个核心概念:</p> 
<h4><a id="1_Fact_Table_147"></a>1. 事实表(Fact Table)</h4> 
<p>事实表是维度模型的核心,它包含了业务过程的量化度量。</p> 
<p>特点:</p> 
<ul><li>通常包含数值型度量(如销售额、数量等)</li><li>包含指向各个维度表的外键</li><li>通常是模型中最大的表</li></ul> 
<p>示例:</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> FactSales <span class="token punctuation">(</span>
    SaleKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    DateKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TotalAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimDate<span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimProduct<span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimCustomer<span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_Dimension_Table_172"></a>2. 维度表(Dimension Table)</h4> 
<p>维度表提供了对事实的上下文信息。</p> 
<p>特点:</p> 
<ul><li>包含描述性属性</li><li>通常比事实表小,但列数可能更多</li><li>提供了查询的"入口点"</li></ul> 
<p>示例:</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimProduct <span class="token punctuation">(</span>
    ProductKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Category <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Supplier <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Brand <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Color <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Size <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3_Star_Schema_195"></a>3. 星型模式(Star Schema)</h4> 
<p>星型模式是最简单和最常见的维度模型结构。</p> 
<p>特点:</p> 
<ul><li>一个中心事实表</li><li>多个直接连接到事实表的维度表</li><li>维度表通常是非规范化的</li></ul> 
<h4><a id="4_Snowflake_Schema_204"></a>4. 雪花模式(Snowflake Schema)</h4> 
<p>雪花模式是星型模式的变体,其中一些维度被进一步规范化。</p> 
<p>特点:</p> 
<ul><li>维度表可能有自己的相关维度表</li><li>可以减少一些数据冗余</li><li>但可能增加查询复杂性</li></ul> 
<p>示例:</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 产品类别维度</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimProductCategory <span class="token punctuation">(</span>
    CategoryKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CategoryName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 产品维度(雪花)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimProduct <span class="token punctuation">(</span>
    ProductKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CategoryKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Supplier <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CategoryKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimProductCategory<span class="token punctuation">(</span>CategoryKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5_Slowly_Changing_Dimensions_SCD_232"></a>5. 缓慢变化维度(Slowly Changing Dimensions, SCD)</h4> 
<p>缓慢变化维度是处理维度属性随时间变化的技术。</p> 
<p>主要类型:</p> 
<ul><li>Type 1: 直接覆盖旧值</li><li>Type 2: 创建新记录</li><li>Type 3: 添加新属性</li></ul> 
<p>示例(Type 2 SCD):</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimCustomer <span class="token punctuation">(</span>
    CustomerKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CustomerID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    City <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Country <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ValidFrom <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    ValidTo <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    IsCurrent <span class="token keyword">BIT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="6_Degenerate_Dimension_255"></a>6. 退化维度(Degenerate Dimension)</h4> 
<p>退化维度是存在于事实表中的维度,它不需要单独的维度表。</p> 
<p>示例:</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> FactSales <span class="token punctuation">(</span>
    SaleKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    OrderNumber <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 退化维度</span>
    DateKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    TotalAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="7_Aggregate_Fact_273"></a>7. 聚集事实(Aggregate Fact)</h4> 
<p>聚集事实是预先计算的汇总数据,用于提高查询性能。</p> 
<p>示例:</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> FactMonthlySales <span class="token punctuation">(</span>
    MonthKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    TotalQuantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    TotalAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>MonthKey<span class="token punctuation">,</span> ProductKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>理解这些核心概念对于有效实施维度建模至关重要。它们共同构成了一个强大的框架,使得复杂的业务数据可以以一种直观和高效的方式进行组织和分析。</p> 
<h3><a id="_290"></a>实际案例:零售业维度模型</h3> 
<p>为了更好地理解维度建模在实际中的应用,让我们以一个零售业的例子来详细说明。假设我们正在为一家大型连锁超市设计数据仓库。<br> <img src="https://images2.imgbox.com/3e/0d/IFsmc1db_o.png" alt="image.png"></p> 
<h4><a id="_295"></a>业务需求</h4> 
<ol><li>分析不同产品类别的销售趋势</li><li>了解客户购买行为</li><li>评估促销活动的效果</li><li>分析不同地区和门店的表现</li><li>追踪库存水平</li></ol> 
<h4><a id="_303"></a>维度模型设计</h4> 
<p>基于这些需求,我们可以设计以下维度模型:</p> 
<h5><a id="1__FactSales_307"></a>1. 事实表: FactSales</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> FactSales <span class="token punctuation">(</span>
    SaleKey <span class="token keyword">BIGINT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    DateKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    ProductKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    StoreKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    CustomerKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    PromotionKey <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DiscountAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SalesAmount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Cost <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Profit <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimDate<span class="token punctuation">(</span>DateKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimProduct<span class="token punctuation">(</span>ProductKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>StoreKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimStore<span class="token punctuation">(</span>StoreKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimCustomer<span class="token punctuation">(</span>CustomerKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>PromotionKey<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> DimPromotion<span class="token punctuation">(</span>PromotionKey<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="2__DimDate_331"></a>2. 维度表: DimDate</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimDate <span class="token punctuation">(</span>
    DateKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    FullDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    DayOfWeek <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DayName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DayOfMonth <span class="token keyword">INT</span><span class="token punctuation">,</span>
    DayOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    WeekOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    MonthName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    MonthOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quarter <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">Year</span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    IsWeekend B<span class="token punctuation">[</span>前面的内容保持不变<span class="token punctuation">,</span>从DimDate表的创建语句继续<span class="token punctuation">]</span>

<span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span><span class="token punctuation">`</span><span class="token keyword">sql</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimDate <span class="token punctuation">(</span>
    DateKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    FullDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    DayOfWeek <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DayName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DayOfMonth <span class="token keyword">INT</span><span class="token punctuation">,</span>
    DayOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    WeekOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    MonthName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    MonthOfYear <span class="token keyword">INT</span><span class="token punctuation">,</span>
    Quarter <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">Year</span> <span class="token keyword">INT</span><span class="token punctuation">,</span>
    IsWeekend <span class="token keyword">BIT</span><span class="token punctuation">,</span>
    IsHoliday <span class="token keyword">BIT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="3__DimProduct_366"></a>3. 维度表: DimProduct</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimProduct <span class="token punctuation">(</span>
    ProductKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    ProductID <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ProductName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ProductDescription <span class="token keyword">TEXT</span><span class="token punctuation">,</span>
    ProductCategory <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ProductSubcategory <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Brand <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Color <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Size <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Weight <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    UnitCost <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    UnitPrice <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    SupplierName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    IntroductionDate <span class="token keyword">DATE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="4__DimStore_387"></a>4. 维度表: DimStore</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimStore <span class="token punctuation">(</span>
    StoreKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    StoreID <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StoreName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StoreType <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    City <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    State <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Country <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PostalCode <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ManagerName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    OpenDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    CloseDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    SquareFootage <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="5__DimCustomer_407"></a>5. 维度表: DimCustomer</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimCustomer <span class="token punctuation">(</span>
    CustomerKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    CustomerID <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    FirstName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    LastName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    FullName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Gender <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DateOfBirth <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    Email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Phone <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Address <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    City <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    State <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Country <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PostalCode <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CustomerSince <span class="token keyword">DATE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="6__DimPromotion_429"></a>6. 维度表: DimPromotion</h5> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> DimPromotion <span class="token punctuation">(</span>
    PromotionKey <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    PromotionID <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PromotionName <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PromotionType <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    DiscountPercent <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    StartDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    EndDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    MinQuantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
    MaxQuantity <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_445"></a>模型说明</h4> 
<ol><li> <p><strong>FactSales表</strong>: 这是我们的主要事实表,记录了每次销售交易的详细信息。它包含了销售数量、单价、折扣金额、销售总额、成本和利润等关键度量。每个外键(DateKey, ProductKey等)都链接到相应的维度表。</p> </li><li> <p><strong>DimDate表</strong>: 时间维度是几乎所有数据仓库中最常见的维度之一。它允许我们按照各种时间粒度(天、周、月、季度、年)进行分析。IsWeekend和IsHoliday字段有助于分析周末和假日的销售情况。</p> </li><li> <p><strong>DimProduct表</strong>: 产品维度包含了产品的所有相关属性。注意我们如何将产品类别和子类别作为属性包含在内,而不是创建单独的表。这是非规范化的一个例子,目的是简化查询。</p> </li><li> <p><strong>DimStore表</strong>: 商店维度包含了每个商店的详细信息。SquareFootage(平方英尺)属性可以用于分析每平方英尺的销售额等指标。</p> </li><li> <p><strong>DimCustomer表</strong>: 客户维度允许我们分析客户的购买行为。CustomerSince字段可用于客户忠诚度分析。</p> </li><li> <p><strong>DimPromotion表</strong>: 促销维度使我们能够评估不同促销活动的效果。</p> </li></ol> 
<h4><a id="_459"></a>示例查询</h4> 
<p>让我们看几个使用这个维度模型的查询示例:</p> 
<ol><li>按产品类别和月份统计销售额:</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 
    p<span class="token punctuation">.</span>ProductCategory<span class="token punctuation">,</span>
    d<span class="token punctuation">.</span>MonthName<span class="token punctuation">,</span>
    d<span class="token punctuation">.</span><span class="token keyword">Year</span><span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>SalesAmount<span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalSales
<span class="token keyword">FROM</span> 
    FactSales f
    <span class="token keyword">JOIN</span> DimProduct p <span class="token keyword">ON</span> f<span class="token punctuation">.</span>ProductKey <span class="token operator">=</span> p<span class="token punctuation">.</span>ProductKey
    <span class="token keyword">JOIN</span> DimDate d <span class="token keyword">ON</span> f<span class="token punctuation">.</span>DateKey <span class="token operator">=</span> d<span class="token punctuation">.</span>DateKey
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 
    p<span class="token punctuation">.</span>ProductCategory<span class="token punctuation">,</span> d<span class="token punctuation">.</span>MonthName<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token keyword">Year</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 
    d<span class="token punctuation">.</span><span class="token keyword">Year</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span>MonthOfYear<span class="token punctuation">,</span> p<span class="token punctuation">.</span>ProductCategory<span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>查找top 10的客户及其总购买金额:</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 
    <span class="token keyword">TOP</span> <span class="token number">10</span> c<span class="token punctuation">.</span>FullName<span class="token punctuation">,</span>
    c<span class="token punctuation">.</span>City<span class="token punctuation">,</span>
    c<span class="token punctuation">.</span>State<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>SalesAmount<span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalPurchase
<span class="token keyword">FROM</span> 
    FactSales f
    <span class="token keyword">JOIN</span> DimCustomer c <span class="token keyword">ON</span> f<span class="token punctuation">.</span>CustomerKey <span class="token operator">=</span> c<span class="token punctuation">.</span>CustomerKey
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 
    c<span class="token punctuation">.</span>FullName<span class="token punctuation">,</span> c<span class="token punctuation">.</span>City<span class="token punctuation">,</span> c<span class="token punctuation">.</span>State
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 
    TotalPurchase <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>分析特定促销活动的效果:</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 
    p<span class="token punctuation">.</span>PromotionName<span class="token punctuation">,</span>
    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> f<span class="token punctuation">.</span>CustomerKey<span class="token punctuation">)</span> <span class="token keyword">AS</span> UniqueCustomers<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalQuantitySold<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>SalesAmount<span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalSalesAmount<span class="token punctuation">,</span>
    <span class="token function">AVG</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>DiscountAmount<span class="token punctuation">)</span> <span class="token keyword">AS</span> AvgDiscount
<span class="token keyword">FROM</span> 
    FactSales f
    <span class="token keyword">JOIN</span> DimPromotion p <span class="token keyword">ON</span> f<span class="token punctuation">.</span>PromotionKey <span class="token operator">=</span> p<span class="token punctuation">.</span>PromotionKey
<span class="token keyword">WHERE</span> 
    p<span class="token punctuation">.</span>PromotionID <span class="token operator">=</span> <span class="token string">'PROMO2023'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 
    p<span class="token punctuation">.</span>PromotionName<span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li>计算每个商店的年度销售增长率:</li></ol> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> StoreSales <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> 
        s<span class="token punctuation">.</span>StoreID<span class="token punctuation">,</span>
        s<span class="token punctuation">.</span>StoreName<span class="token punctuation">,</span>
        d<span class="token punctuation">.</span><span class="token keyword">Year</span><span class="token punctuation">,</span>
        <span class="token function">SUM</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>SalesAmount<span class="token punctuation">)</span> <span class="token keyword">AS</span> YearlySales
    <span class="token keyword">FROM</span> 
        FactSales f
        <span class="token keyword">JOIN</span> DimStore s <span class="token keyword">ON</span> f<span class="token punctuation">.</span>StoreKey <span class="token operator">=</span> s<span class="token punctuation">.</span>StoreKey
        <span class="token keyword">JOIN</span> DimDate d <span class="token keyword">ON</span> f<span class="token punctuation">.</span>DateKey <span class="token operator">=</span> d<span class="token punctuation">.</span>DateKey
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 
        s<span class="token punctuation">.</span>StoreID<span class="token punctuation">,</span> s<span class="token punctuation">.</span>StoreName<span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token keyword">Year</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> 
    s1<span class="token punctuation">.</span>StoreID<span class="token punctuation">,</span>
    s1<span class="token punctuation">.</span>StoreName<span class="token punctuation">,</span>
    s1<span class="token punctuation">.</span><span class="token keyword">Year</span><span class="token punctuation">,</span>
    s1<span class="token punctuation">.</span>YearlySales<span class="token punctuation">,</span>
    <span class="token punctuation">(</span>s1<span class="token punctuation">.</span>YearlySales <span class="token operator">-</span> s2<span class="token punctuation">.</span>YearlySales<span class="token punctuation">)</span> <span class="token operator">/</span> s2<span class="token punctuation">.</span>YearlySales <span class="token operator">*</span> <span class="token number">100</span> <span class="token keyword">AS</span> GrowthRate
<span class="token keyword">FROM</span> 
    StoreSales s1
    <span class="token keyword">JOIN</span> StoreSales s2 <span class="token keyword">ON</span> s1<span class="token punctuation">.</span>StoreID <span class="token operator">=</span> s2<span class="token punctuation">.</span>StoreID <span class="token operator">AND</span> s1<span class="token punctuation">.</span><span class="token keyword">Year</span> <span class="token operator">=</span> s2<span class="token punctuation">.</span><span class="token keyword">Year</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 
    s1<span class="token punctuation">.</span>StoreID<span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token keyword">Year</span><span class="token punctuation">;</span>
</code></pre> 
<p>这些查询展示了维度模型的强大之处。我们可以轻松地从多个角度分析数据,而无需编写复杂的表连接。</p> 
<h3><a id="_547"></a>维度建模的优势</h3> 
<ol><li> <p><strong>查询性能</strong>: 星型模式减少了需要的表连接,从而提高了查询性能。</p> </li><li> <p><strong>易于理解</strong>: 维度模型更接近业务用户的思维方式,使得非技术用户也能轻松理解和使用。</p> </li><li> <p><strong>灵活性</strong>: 可以轻松添加新的维度或事实,以适应不断变化的业务需求。</p> </li><li> <p><strong>一致性</strong>: 维度表作为"共同语言"促进了整个组织的数据一致性。</p> </li><li> <p><strong>可扩展性</strong>: 维度模型可以从小规模开始,随着业务的增长而扩展。<br> <img src="https://images2.imgbox.com/8e/15/wcLlbSUv_o.png" alt="image.png"></p> </li></ol> 
<h3><a id="_560"></a>维度建模的挑战</h3> 
<ol><li> <p><strong>初始设计复杂性</strong>: 设计一个好的维度模型需要深入理解业务过程和需求。</p> </li><li> <p><strong>数据冗余</strong>: 非规范化可能导致一些数据冗余,增加存储需求。</p> </li><li> <p><strong>ETL过程</strong>: 将源系统数据转换为维度模型可能需要复杂的ETL(提取、转换、加载)过程。</p> </li><li> <p><strong>维护成本</strong>: 随着时间的推移,维护缓慢变化维度可能变得复杂。</p> </li><li> <p><strong>不适合所有场景</strong>: 对于某些类型的应用(如OLTP系统),维度建模可能不是最佳选择。<br> <img src="https://images2.imgbox.com/c8/60/UNzpzXN0_o.png" alt="image.png"></p> </li></ol> 
<h3><a id="_573"></a>实施维度建模:最佳实践</h3> 
<ol><li> <p><strong>从业务需求开始</strong>: 在开始建模之前,充分理解业务流程和分析需求。</p> </li><li> <p><strong>选择合适的粒度</strong>: 事实表的粒度应该足够细,以支持最详细的分析需求。</p> </li><li> <p><strong>标准化维度</strong>: 在整个企业范围内使用一致的维度定义,以促进数据集成。</p> </li><li> <p><strong>使用易懂的名称</strong>: 为维度和属性使用业务友好的名称,避免技术术语。</p> </li><li> <p><strong>考虑未来需求</strong>: 设计时要考虑到可能的未来扩展和变化。</p> </li><li> <p><strong>性能优化</strong>: 使用适当的索引、分区和聚合表来优化查询性能。</p> </li><li> <p><strong>文档化</strong>: 详细记录模型设计、业务规则和任何假设,以便未来参考。</p> </li><li> <p><strong>定期审查和调整</strong>: 随着业务的变化,定期审查和调整模型以确保其持续满足需求。<br> <img src="https://images2.imgbox.com/23/d5/CgLph3J1_o.png" alt="image.png"></p> </li></ol> 
<h3><a id="_591"></a>结论:选择正确的建模方法</h3> 
<p>维度建模为数据仓库和商业智能系统提供了一个强大的框架,能够支持复杂的分析需求,同时保持模型的简单性和易用性。然而,它并不是所有场景下的最佳选择。</p> 
<p>在选择建模方法时,需要考虑以下因素:</p> 
<ol><li> <p><strong>数据用途</strong>: 如果主要用于复杂的分析查询,维度建模可能是最佳选择。如果主要用于事务处理,关系型建模可能更合适。</p> </li><li> <p><strong>用户群体</strong>: 如果主要用户是业务分析师,维度模型的直观性会很有帮助。</p> </li><li> <p><strong>性能需求</strong>: 对于需要高性能的复杂查询,维度模型通常表现更好。</p> </li><li> <p><strong>灵活性需求</strong>: 如果业务需求经常变化,维度模型的灵活性可能更有价值。</p> </li><li> <p><strong>现有技能和工具</strong>: 考虑团队的现有技能和可用的工具支持。<br> <img src="https://images2.imgbox.com/02/a2/VvP8BoAj_o.png" alt="image.png"><br> 无论选择哪种方法,关键是要理解业务需求,并选择能够最好地支持这些需求的模型。在许多情况下,混合方法可能是最佳选择,在数据仓库中使用维度模型,而在操作系统中保留关系模型。</p> </li></ol> 
<p>维度建模不仅是一种技术,更是一种思维方式。它鼓励我们从业务视角看待数据,这往往能带来意想不到的洞察。通过掌握维度建模,我们能够更好地将原始数据转化为有价值的商业智能,为组织的决策提供有力支持。</p> 
<p>记住,没有一种放之四海而皆准的解决方案。最好的建模方法是能够满足你特定需求的方法。持续学习、实践和调整将是成功实施数据仓库项目的关键。<br> <img src="https://images2.imgbox.com/a8/7a/Zq4S3Xxr_o.png" alt="数据仓库.png"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/80214e184b5ca6f5aa091acafdfbb677/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WebLlama：基于Llama-3的网页浏览助手开发指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eeec4962ce4dc74cd1173c2d7c0594cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构之排序（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>