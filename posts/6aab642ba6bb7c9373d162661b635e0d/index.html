<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>django模型、项目、配置、模型类、数据库操作、查询、F/Q对象、字段类型、聚合函数、排序函数 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6aab642ba6bb7c9373d162661b635e0d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="django模型、项目、配置、模型类、数据库操作、查询、F/Q对象、字段类型、聚合函数、排序函数">
  <meta property="og:description" content="模型重点
模型配置数据的增删改 增:book = BookInfo() book.save() 和BookInfo.objects.create()删:book.delete() 和BookInfo.objects.get().delete()改:book.name=&#39;xxx&#39; book.save() 和 BookInfo.objects.get().update(name=xxx)数据的查询 基础查询F对象和Q对象关联查询 查询集QuerySet
MVT图解
一、项目准备 1.1创建项目与应用 django-admin startproject bookmanager python manager.py startapp book 1.2安装应用 1.3本地化 1.4模板路径 在应用同级目录下,创建templates模板文件夹
1.5项目中匹配urls 正则 : 路径只要不是admin/就算匹配成功。并包含到应用中的urls.py
1.6准备视图 1.7应用中匹配urls.py 应用中创建 urls.py 正则 : 路径中包含bookls/，就调用视图中对应的bookList函数
1.8开启服务器, 测试项目 # 进入项目文件中, 开启项目对应的服务器 python manage.py runserver # 浏览器中输入网址 http://127.0.0.1:8000/bookls/ 二、配置 在settings.py中保存了数据库的连接配置信息，Django默认初始配置使用sqlite数据库。
DATABASES = { &#39;default&#39;: { &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;, &#39;NAME&#39;: BASE_DIR / &#39;db.sqlite3&#39;, } } 在Django的工程同名子目录的__init__.py文件中添加如下语句 修改DATABASES配置信息
DATABASES = { &#39;default&#39;: { &#39;ENGINE&#39;: &#39;django.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-28T21:55:29+08:00">
    <meta property="article:modified_time" content="2024-06-28T21:55:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">django模型、项目、配置、模型类、数据库操作、查询、F/Q对象、字段类型、聚合函数、排序函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="1-创建虚拟环境">模型重点</p> 
<ul><li><strong>模型配置</strong></li><li><strong>数据的增删改</strong> 
  <ul><li>增:<code>book = BookInfo() book.save()</code> 和<code>BookInfo.objects.create()</code></li><li>删:<code>book.delete()</code> 和<code>BookInfo.objects.get().delete()</code></li><li>改:<code>book.name='xxx' book.save()</code> 和 <code>BookInfo.objects.get().update(name=xxx)</code></li></ul></li><li><strong>数据的查询</strong> 
  <ul><li>基础查询</li><li>F对象和Q对象</li><li>关联查询</li><li> <p>查询集QuerySet</p> </li></ul></li></ul> 
<p>MVT图解</p> 
<h4 style="background-color:transparent;"><img alt="" height="549" src="https://images2.imgbox.com/9d/2b/OFdl0FaX_o.png" width="1108"> 一、项目准备</h4> 
<h5>1.1创建项目与应用</h5> 
<pre><code>django-admin startproject bookmanager
python manager.py startapp book</code></pre> 
<p><img alt="" height="150" src="https://images2.imgbox.com/48/71/H5EF3U7U_o.png" width="1177"></p> 
<p><img alt="" height="490" src="https://images2.imgbox.com/0b/2a/oUB1L4NN_o.png" width="317"></p> 
<h5>1.2安装应用</h5> 
<h5><img alt="" height="603" src="https://images2.imgbox.com/18/24/Uc7QZbAg_o.png" width="1200"> 1.3本地化</h5> 
<p><img alt="" height="439" src="https://images2.imgbox.com/9b/92/uezoCn86_o.png" width="995"></p> 
<h5>1.4模板路径</h5> 
<p>在应用同级目录下,创建<code>templates</code>模板文件夹</p> 
<p><img alt="" height="596" src="https://images2.imgbox.com/a9/f9/incH3dkR_o.png" width="1200"></p> 
<p><img alt="" height="559" src="https://images2.imgbox.com/18/32/4y9PWvuj_o.png" width="1200"></p> 
<h5>1.5项目中匹配urls</h5> 
<ul><li> <p>正则 : 路径只要不是<code>admin/</code>就算匹配成功。并包含到应用中的<code>urls.py</code></p> </li></ul> 
<p><img alt="" height="633" src="https://images2.imgbox.com/5c/07/9PaLcz8u_o.png" width="1200"></p> 
<h5> 1.6准备视图</h5> 
<p><img alt="" height="596" src="https://images2.imgbox.com/9f/71/XJBPTWbY_o.png" width="1200"></p> 
<h5>1.7应用中匹配<code>urls.py</code></h5> 
<ul><li>应用中创建 <code>urls.py</code></li><li> <p>正则 : 路径中包含<code>bookls/</code>，就调用视图中对应的<code>bookList</code>函数<img alt="" height="595" src="https://images2.imgbox.com/4b/33/FVx0UorX_o.png" width="1200"></p> </li></ul> 
<h5>1.8开启服务器, 测试项目</h5> 
<pre><code class="language-python"> # 进入项目文件中, 开启项目对应的服务器
 python manage.py runserver

 # 浏览器中输入网址
 http://127.0.0.1:8000/bookls/</code></pre> 
<p><img alt="" height="346" src="https://images2.imgbox.com/cf/a9/FRnIQ0bY_o.png" width="1200"><img alt="" height="183" src="https://images2.imgbox.com/4c/5a/HRih7QRS_o.png" width="970"></p> 
<h4>二、配置</h4> 
<p>在settings.py中保存了数据库的连接配置信息，Django默认初始配置使用<strong>sqlite</strong>数据库。</p> 
<pre><code class="language-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}</code></pre> 
<h4><img alt="" height="549" src="https://images2.imgbox.com/cd/f1/AoVIuD4y_o.png" width="1200"></h4> 
<p>在Django的工程同名子目录的__init__.py文件中添加如下语句 <img alt="" height="568" src="https://images2.imgbox.com/cd/32/atU6UA7z_o.png" width="1066"></p> 
<p>修改<strong>DATABASES</strong>配置信息</p> 
<pre><code class="language-python">DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'HOST': '127.0.0.1',  # 数据库主机
        'PORT': 3306,  # 数据库端口
        'USER': 'root',  # 数据库用户名
        'PASSWORD': 'mysql',  # 数据库用户密码
        'NAME': 'book2'  # 数据库名字
    }
}
</code></pre> 
<p>在MySQL中创建数据库</p> 
<pre><code class="language-python">create database book2 charset=utf8;</code></pre> 
<p><img alt="" height="617" src="https://images2.imgbox.com/08/22/TZQx1IYy_o.png" width="1200"><img alt="" height="457" src="https://images2.imgbox.com/52/4e/8sjeNvWv_o.png" width="789"><img alt="" height="774" src="https://images2.imgbox.com/90/5f/bu2qdTTK_o.png" width="588"></p> 
<h4>三、定义模型类</h4> 
<ul><li>模型类被定义在"应用/models.py"文件中。</li><li>模型类必须继承自Model类，位于包django.db.models中。</li></ul> 
<p>接下来首先以"图书-人物"管理为例进行演示</p> 
<h5>3.1定义</h5> 
<p>在models.py 文件中定义模型类<img alt="" height="797" src="https://images2.imgbox.com/1f/2d/Jp8JKi2V_o.png" width="1200"></p> 
<pre><code class="language-python">from django.db import models

# Create your models here.
# 准备书籍列表信息的模型类
class BookInfo(models.Model):
    # 创建字段，字段类型...
    name = models.CharField(max_length=20, verbose_name='名称')
    pub_date = models.DateField(verbose_name='发布日期',null=True)
    readcount = models.IntegerField(default=0, verbose_name='阅读量')
    commentcount = models.IntegerField(default=0, verbose_name='评论量')
    is_delete = models.BooleanField(default=False, verbose_name='逻辑删除')

    class Meta:
        db_table = 'bookinfo'  # 指明数据库表名
        verbose_name = '图书'  # 在admin站点中显示的名称

    def __str__(self):
        """定义每个数据对象的显示信息"""
        return self.name

# 准备人物列表信息的模型类
class PeopleInfo(models.Model):
    GENDER_CHOICES = (
        (0, 'male'),
        (1, 'female')
    )
    name = models.CharField(max_length=20, verbose_name='名称')
    gender = models.SmallIntegerField(choices=GENDER_CHOICES, default=0, verbose_name='性别')
    description = models.CharField(max_length=200, null=True, verbose_name='描述信息')
    book = models.ForeignKey(BookInfo, on_delete=models.CASCADE, verbose_name='图书')  # 外键
    is_delete = models.BooleanField(default=False, verbose_name='逻辑删除')

    class Meta:
        db_table = 'peopleinfo'
        verbose_name = '人物信息'

    def __str__(self):
        return self.name</code></pre> 
<p><strong>1） 数据库表名</strong></p> 
<p>模型类如果未指明表名，Django默认以<strong>小写app应用名_小写模型类名</strong>为数据库表名。</p> 
<p>可通过<strong>db_table</strong>指明数据库表名。</p> 
<p><strong>2） 关于主键</strong></p> 
<p>django会为表创建自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后django不会再创建自动增长的主键列。</p> 
<p>默认创建的主键列属性为id，可以使用pk代替，pk全拼为primary key。</p> 
<p><strong>3） 属性命名限制</strong></p> 
<ul><li>不能是python的保留关键字。</li><li>不允许使用连续的下划线，这是由django的查询方式决定的。</li><li> <p>定义属性时需要指定字段类型，通过字段类型的参数指定选项，语法如下：</p> <pre><code class="language-python">属性=models.字段类型(选项)
</code></pre> </li></ul> 
<p><strong>4）字段类型</strong></p> 
<table><thead><tr><th style="text-align:center;">类型</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:center;">AutoField</td><td>自动增长的IntegerField，通常不用指定，不指定时Django会自动创建属性名为id的自动增长属性</td></tr><tr><td style="text-align:center;">BooleanField</td><td>布尔字段，值为True或False</td></tr><tr><td style="text-align:center;">NullBooleanField</td><td>支持Null、True、False三种值</td></tr><tr><td style="text-align:center;">CharField</td><td>字符串，参数max_length表示最大字符个数</td></tr><tr><td style="text-align:center;">TextField</td><td>大文本字段，一般超过4000个字符时使用</td></tr><tr><td style="text-align:center;">IntegerField</td><td>整数</td></tr><tr><td style="text-align:center;">DecimalField</td><td>十进制浮点数， 参数max_digits表示总位数， 参数decimal_places表示小数位数</td></tr><tr><td style="text-align:center;">FloatField</td><td>浮点数</td></tr><tr><td style="text-align:center;">DateField</td><td>日期， 参数auto_now表示每次保存对象时，自动设置该字段为当前时间，用于"最后一次修改"的时间戳，它总是使用当前日期，默认为False； 参数auto_now_add表示当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为False; 参数auto_now_add和auto_now是相互排斥的，组合将会发生错误</td></tr><tr><td style="text-align:center;">TimeField</td><td>时间，参数同DateField</td></tr><tr><td style="text-align:center;">DateTimeField</td><td>日期时间，参数同DateField</td></tr><tr><td style="text-align:center;">FileField</td><td>上传文件字段</td></tr><tr><td style="text-align:center;">ImageField</td><td>继承于FileField，对上传的内容进行校验，确保是有效的图片</td></tr></tbody></table> 
<p><strong>5） 选项</strong></p> 
<table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>null</td><td>如果为True，表示允许为空，默认值是False</td></tr><tr><td>blank</td><td>如果为True，则该字段允许为空白，默认值是False</td></tr><tr><td>db_column</td><td>字段的名称，如果未指定，则使用属性的名称</td></tr><tr><td>db_index</td><td>若值为True, 则在表中会为此字段创建索引，默认值是False</td></tr><tr><td>default</td><td>默认</td></tr><tr><td>primary_key</td><td>若为True，则该字段会成为模型的主键字段，默认值是False，一般作为AutoField的选项使用</td></tr><tr><td>unique</td><td>如果为True, 这个字段在表中必须有唯一值，默认值是False</td></tr></tbody></table> 
<p><strong>null是数据库范畴的概念，blank是表单验证范畴的</strong></p> 
<p><strong>6） 外键</strong></p> 
<p>在设置外键时，需要通过<strong>on_delete</strong>选项指明主表删除数据时，对于外键引用表数据如何处理，在django.db.models中包含了可选常量：</p> 
<ul><li><strong>CASCADE</strong>级联，删除主表数据时连通一起删除外键表中数据</li><li><strong>PROTECT</strong>保护，通过抛出<strong>ProtectedError</strong>异常，来阻止删除主表中被外键应用的数据</li><li><strong>SET_NULL</strong>设置为NULL，仅在该字段null=True允许为null时可用</li><li><strong>SET_DEFAULT</strong>设置为默认值，仅在该字段设置了默认值时可用</li><li><strong>SET()</strong>设置为特定值或者调用特定方法</li><li><strong>DO_NOTHING</strong>不做任何操作，如果数据库前置指明级联性，此选项会抛出<strong>IntegrityError</strong>异常</li></ul> 
<h5 id="2-迁移">3.2迁移</h5> 
<p>将模型类同步到数据库中。</p> 
<p><strong>1）生成迁移文件</strong></p> 
<pre><code>python manage.py makemigrations
</code></pre> 
<p><strong>2）同步到数据库中</strong></p> 
<pre><code>python manage.py migrate
</code></pre> 
<p><img alt="" height="723" src="https://images2.imgbox.com/7e/7c/V51wqHO7_o.png" width="1200"><img alt="" height="820" src="https://images2.imgbox.com/f2/d1/NYD9kWIx_o.png" width="1200"><img alt="" height="391" src="https://images2.imgbox.com/3a/91/Bz1rIDV9_o.png" width="983"><img alt="" height="1018" src="https://images2.imgbox.com/2d/95/ROtA0VDK_o.png" width="933"></p> 
<p><img alt="" height="593" src="https://images2.imgbox.com/61/e2/cOiZArcz_o.png" width="617"></p> 
<h5 id="3-添加测试数据">3.3添加测试数据</h5> 
<pre><code class="language-sql">insert into bookinfo(name, pub_date, readcount,commentcount, is_delete) values
('射雕英雄传', '1980-5-1', 12, 34, 0),
('天龙八部', '1986-7-24', 36, 40, 0),
('笑傲江湖', '1995-12-24', 20, 80, 0),
('雪山飞狐', '1987-11-11', 58, 24, 0);
</code></pre> 
<pre><code class="language-sql">insert into peopleinfo(name, gender, book_id, description, is_delete)  values
    ('郭靖', 1, 1, '降龙十八掌', 0),
    ('黄蓉', 0, 1, '打狗棍法', 0),
    ('黄药师', 1, 1, '弹指神通', 0),
    ('欧阳锋', 1, 1, '蛤蟆功', 0),
    ('梅超风', 0, 1, '九阴白骨爪', 0),
    ('乔峰', 1, 2, '降龙十八掌', 0),
    ('段誉', 1, 2, '六脉神剑', 0),
    ('虚竹', 1, 2, '天山六阳掌', 0),
    ('王语嫣', 0, 2, '神仙姐姐', 0),
    ('令狐冲', 1, 3, '独孤九剑', 0),
    ('任盈盈', 0, 3, '弹琴', 0),
    ('岳不群', 1, 3, '华山剑法', 0),
    ('东方不败', 0, 3, '葵花宝典', 0),
    ('胡斐', 1, 4, '胡家刀法', 0),
    ('苗若兰', 0, 4, '黄衣', 0),
    ('程灵素', 0, 4, '医术', 0),
    ('袁紫衣', 0, 4, '六合拳', 0);</code></pre> 
<h4><img alt="" height="953" src="https://images2.imgbox.com/57/76/w5ef1GVg_o.png" width="1047"><img alt="" height="609" src="https://images2.imgbox.com/4b/44/oMUFVAt5_o.png" width="844"> 四、shell工具</h4> 
<p>Django的manage工具提供了<strong>shell</strong>命令，帮助我们配置好当前工程的运行环境（如连接好数据库等），以便可以直接在终端中执行测试python语句。</p> 
<p>通过如下命令进入shell</p> 
<pre><code>python manage.py shell</code></pre> 
<h4><img alt="" height="196" src="https://images2.imgbox.com/a3/b8/juSab4sJ_o.png" width="1200"> 五、数据库操作</h4> 
<h5>5.1增加数据</h5> 
<p>增加数据有两种方法。</p> 
<p><strong>1）save</strong>：通过创建模型类对象，执行对象的save()方法保存到数据库中。</p> 
<p><img alt="" height="575" src="https://images2.imgbox.com/01/bc/A8I3uRzJ_o.png" width="1200"><img alt="" height="291" src="https://images2.imgbox.com/1d/1c/DVI9keab_o.png" width="1001"></p> 
<p><strong>2）create</strong>：通过模型类.objects.create()保存。</p> 
<p> <img alt="" height="219" src="https://images2.imgbox.com/95/5e/kbBXYxbk_o.png" width="559"><img alt="" height="378" src="https://images2.imgbox.com/73/d2/GlsZIoWf_o.png" width="1008"></p> 
<h5>5.2修改数据</h5> 
<p>修改更新有两种方法</p> 
<p><strong>1）save：修改模型类对象的属性，然后执行save()方法</strong></p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/e0/f4/5T6VimXA_o.png" width="733"><img alt="" height="316" src="https://images2.imgbox.com/da/a2/QqAZMqwl_o.png" width="970"></p> 
<p><strong>2）update：使用模型类.objects.filter().update()</strong>，会返回受影响的行数</p> 
<p><img alt="" height="62" src="https://images2.imgbox.com/81/0f/9zmwh4cj_o.png" width="899"><img alt="" height="335" src="https://images2.imgbox.com/2a/32/bX3xPsZa_o.png" width="996"></p> 
<h5>5.3删除数据</h5> 
<p>删除有两种方法</p> 
<p><strong>1）模型类对象delete</strong><img alt="" height="116" src="https://images2.imgbox.com/1c/ef/4HGYAaVz_o.png" width="726"><img alt="" height="296" src="https://images2.imgbox.com/7b/c6/pLHJ3mGM_o.png" width="933"></p> 
<p> <strong>2）模型类.objects.filter().delete()</strong><img alt="" height="66" src="https://images2.imgbox.com/4a/bb/WkA0eXfW_o.png" width="682"><img alt="" height="261" src="https://images2.imgbox.com/cc/cc/Ugh0ymGs_o.png" width="943"></p> 
<h5 style="background-color:transparent;">5.4查询数据</h5> 
<h6 id="21-基本查询" style="background-color:transparent;">1 基础条件查询</h6> 
<h6 style="background-color:transparent;">基本查询</h6> 
<ul><li><strong>get</strong>查询单一结果，如果不存在会抛出<strong>模型类.DoesNotExist</strong>异常。</li><li><strong>all</strong>查询多个结果。</li><li><strong>count</strong>查询结果数量。<img alt="" height="226" src="https://images2.imgbox.com/91/88/5T8tYbt3_o.png" width="1200"></li></ul> 
<h6 id="22-过滤查询">过滤查询</h6> 
<p>实现SQL中的where功能，包括</p> 
<ul><li><strong>filter</strong>过滤出多个结果</li><li><strong>exclude</strong>排除掉符合条件剩下的结果</li><li><strong>get</strong>过滤单一结果<img alt="" height="374" src="https://images2.imgbox.com/38/e2/kCONzsCz_o.png" width="1200"></li></ul> 
<p>对于过滤条件的使用，上述三个方法相同，故仅以<strong>filter</strong>进行讲解。</p> 
<p>过滤条件的表达语法如下：</p> 
<pre><code>属性名称__比较运算符=值

# 属性名称和比较运算符间使用两个下划线，所以属性名不能包括多个下划线</code></pre> 
<p><strong>1）相等</strong></p> 
<p><strong>exact：表示判等。</strong></p> 
<p>例：查询编号为1的图书。</p> 
<pre><code class="language-python">BookInfo.objects.filter(id__exact=1)
可简写为：
BookInfo.objects.filter(id=1)
</code></pre> 
<p> <img alt="" height="134" src="https://images2.imgbox.com/9f/b8/SmwnlfDG_o.png" width="568"></p> 
<p><strong>2）模糊查询</strong></p> 
<p><strong>contains：是否包含。</strong></p> 
<blockquote> 
 <p>说明：如果要包含%无需转义，直接写即可。</p> 
</blockquote> 
<p>例：查询书名包含'传'的图书。</p> 
<pre><code class="language-python">BookInfo.objects.filter(name__contains='传')
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;]&gt;
</code></pre> 
<p><strong>startswith、endswith：以指定值开头或结尾。</strong></p> 
<p>例：查询书名以'部'结尾的图书</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(name__endswith='部')
&lt;QuerySet [&lt;BookInfo: 天龙八部&gt;]&gt;
</code></pre> 
<blockquote> 
 <p>以上运算符都<strong>区分大小写</strong>，在这些运算符前<strong>加上i表示不区分大小写</strong>，如iexact、icontains、istartswith、iendswith.</p> 
</blockquote> 
<p><img alt="" height="151" src="https://images2.imgbox.com/22/e4/d4N2m1BF_o.png" width="612"> </p> 
<p><strong>3） 空查询</strong></p> 
<p><strong>isnull：是否为null。</strong></p> 
<p>例：查询书名为空的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(name__isnull=True)
&lt;QuerySet []&gt;
</code></pre> 
<p><img alt="" height="133" src="https://images2.imgbox.com/ff/38/B9PMnVXz_o.png" width="1200"></p> 
<p><strong>4） 范围查询</strong></p> 
<p><strong>in：是否包含在范围内。</strong></p> 
<p>例：查询编号为1或3或5的图书</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(id__in=[1,3，5])
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 笑傲江湖&gt;]&gt;
</code></pre> 
<p><img alt="" height="83" src="https://images2.imgbox.com/e4/56/w2jeHuAd_o.png" width="731"></p> 
<p><strong>5）比较查询</strong></p> 
<ul><li><strong>gt</strong>大于 (greater then)</li><li><strong>gte</strong>大于等于 (greater then equal)</li><li><strong>lt</strong>小于 (less then)</li><li><strong>lte</strong>小于等于 (less then equal)</li></ul> 
<p>例：查询编号大于3的图书</p> 
<pre><code class="language-python">BookInfo.objects.filter(id__gt=3)
</code></pre> 
<p><strong>不等于的运算符，使用exclude()过滤器。</strong></p> 
<p>例：查询编号不等于3的图书</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.exclude(id=3)
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</code></pre> 
<p><img alt="" height="282" src="https://images2.imgbox.com/68/c0/bI86ZNli_o.png" width="1200"> </p> 
<p><strong>6）日期查询</strong></p> 
<p><strong>year、month、day、week_day、hour、minute、second：对日期时间类型的属性进行运算。</strong></p> 
<p>例：查询1980年发表的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(pub_date__year=1980)
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;]&gt;
</code></pre> 
<p>例：查询1990年1月1日后发表的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(pub_date__gt='1990-1-1')
&lt;QuerySet [&lt;BookInfo: 笑傲江湖&gt;]&gt;</code></pre> 
<p><img alt="" height="129" src="https://images2.imgbox.com/c9/95/LPEPRs4u_o.png" width="658"> </p> 
<h6 style="background-color:transparent;">2 F和Q对象</h6> 
<h6 id="f对象">F对象</h6> 
<p>之前的查询都是对象的属性与常量值比较，两个属性怎么比较呢？</p> 
<p>答：使用F对象，被定义在django.db.models中。</p> 
<p>语法如下：</p> 
<pre><code>F(属性名)
</code></pre> 
<p>例：查询阅读量大于等于评论量的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; from django.db.models import F
&gt;&gt;&gt; BookInfo.objects.filter(readcount__gt=F('commentcount'))
&lt;QuerySet [&lt;BookInfo: 雪山飞狐&gt;]&gt;
</code></pre> 
<p>可以在F对象上使用算数运算。</p> 
<p>例：查询阅读量大于2倍评论量的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(readcount__gt=F('commentcount')*2)
&lt;QuerySet [&lt;BookInfo: 雪山飞狐&gt;]&gt;
</code></pre> 
<p><img alt="" height="157" src="https://images2.imgbox.com/fc/49/2dJQ95QF_o.png" width="800"></p> 
<h6 id="q对象">Q对象</h6> 
<p><strong>多个过滤器逐个调用表示逻辑与关系，同sql语句中where部分的and关键字。</strong></p> 
<p>例：查询阅读量大于20，并且编号小于3的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(readcount__gt=20,id__lt=3)
&lt;QuerySet [&lt;BookInfo: 天龙八部&gt;]&gt;

或者

&gt;&gt;&gt; BookInfo.objects.filter(readcount__gt=20).filter(id__lt=3)
&lt;QuerySet [&lt;BookInfo: 天龙八部&gt;]&gt;
</code></pre> 
<p><img alt="" height="133" src="https://images2.imgbox.com/7b/34/p6n1iomP_o.png" width="761"> <strong>如果需要实现逻辑或or的查询，需要使用Q()对象结合|运算符</strong>，Q对象被义在django.db.models中</p> 
<p>语法如下：</p> 
<pre><code>Q(属性名__运算符=值)
</code></pre> 
<p>例：查询阅读量大于20的图书，改写为Q对象如下。</p> 
<pre><code class="language-python">BookInfo.objects.filter(Q(readcount__gt=20))
</code></pre> 
<p>Q对象可以使用&amp;、|连接，&amp;表示逻辑与，|表示逻辑或。</p> 
<p>例：查询阅读量大于20，或编号小于3的图书，只能使用Q对象实现</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(Q(readcount__gt=20)|Q(id__lt=3))
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;
</code></pre> 
<p>Q对象前可以使用~操作符，表示非not。</p> 
<p>例：查询编号不等于3的图书。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.filter(~Q(id=3))
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;</code></pre> 
<p><img alt="" height="212" src="https://images2.imgbox.com/b9/17/q2c2VFij_o.png" width="964"></p> 
<h6 style="background-color:transparent;"> 3 聚合函数和排序函数</h6> 
<h6 id="23--排序">聚合函数</h6> 
<p>使用aggregate()过滤器调用聚合函数。聚合函数包括：<strong>Avg</strong>平均，<strong>Count</strong>数量，<strong>Max</strong>最大，<strong>Min</strong>最小，<strong>Sum</strong>求和，被定义在django.db.models中。</p> 
<p>例：查询图书的总阅读量。</p> 
<pre><code class="language-python">&gt;&gt;&gt; from django.db.models import Sum
&gt;&gt;&gt; BookInfo.objects.aggregate(Sum('readcount'))
{'readcount__sum': 126}
</code></pre> 
<p>注意aggregate的返回值是一个字典类型，格式如下：</p> 
<pre><code class="language-python">  {'属性名__聚合类小写':值}

  如:{'readcount__sum': 126}
</code></pre> 
<p>使用count时一般不使用aggregate()过滤器。</p> 
<p>例：查询图书总数。</p> 
<pre><code class="language-python">&gt;&gt;&gt; BookInfo.objects.count()
4</code></pre> 
<p>注意count函数的返回值是一个数字。</p> 
<h6>排序</h6> 
<p>使用<strong>order_by</strong>对结果进行排序</p> 
<pre><code class="language-python"># 默认升序
&gt;&gt;&gt; BookInfo.objects.all().order_by('readcount')
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 笑傲江湖&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;

# 降序
&gt;&gt;&gt; BookInfo.objects.all().order_by('-readcount')
&lt;QuerySet [&lt;BookInfo: 雪山飞狐&gt;, &lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 笑傲江湖&gt;, &lt;BookInfo: 射雕英雄传&gt;]&gt;</code></pre> 
<p><img alt="" height="257" src="https://images2.imgbox.com/22/b5/L3GkzyEN_o.png" width="1200"></p> 
<h6 id="关联查询" style="background-color:transparent;">4 关联查询</h6> 
<pre><code>查询书籍为1的所有人物信息
查询人物为1的书籍信息
</code></pre> 
<p>由一到多的访问语法：</p> 
<p>一对应的模型类对象.多对应的模型类名小写_set 例：</p> 
<pre><code class="language-python">&gt;&gt;&gt; book = BookInfo.objects.get(id=1)
&gt;&gt;&gt; book.peopleinfo_set.all()
&lt;QuerySet [&lt;PeopleInfo: 郭靖&gt;, &lt;PeopleInfo: 黄蓉&gt;, &lt;PeopleInfo: 黄药师&gt;, &lt;PeopleInfo: 欧阳锋&gt;, &lt;PeopleInfo: 梅超风&gt;]&gt;
</code></pre> 
<p>由多到一的访问语法:</p> 
<p>多对应的模型类对象.多对应的模型类中的关系类属性名 例：</p> 
<pre><code class="language-python">&gt;&gt;&gt; person = PeopleInfo.objects.get(id=1)
&gt;&gt;&gt; person.book
&lt;BookInfo: 射雕英雄传&gt;</code></pre> 
<p>访问一对应的模型类关联对象的id语法:</p> 
<p>多对应的模型类对象.关联类属性_id</p> 
<p>例：</p> 
<pre><code class="language-python">&gt;&gt;&gt; person = PeopleInfo.objects.get(id=1)
&gt;&gt;&gt; person.book_id
1
</code></pre> 
<p id="关联过滤查询">关联过滤查询：<strong>由多模型类条件查询一模型类数据</strong></p> 
<p>语法如下：</p> 
<pre><code>关联模型类名小写__属性名__条件运算符=值
</code></pre> 
<blockquote> 
 <p><strong>注意：如果没有"__运算符"部分，表示等于。</strong></p> 
</blockquote> 
<pre><code>查询图书，要求图书人物为"郭靖"
查询图书，要求图书中人物的描述包含"八"
</code></pre> 
<p>例：查询图书，要求图书人物为"郭靖"</p> 
<pre><code class="language-python">&gt;&gt;&gt; book = BookInfo.objects.filter(peopleinfo__name='郭靖')
&gt;&gt;&gt; book
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;]&gt;
</code></pre> 
<p>查询图书，要求图书中人物的描述包含"八"</p> 
<pre><code class="language-python">&gt;&gt;&gt; book = BookInfo.objects.filter(peopleinfo__description__contains='八')
&gt;&gt;&gt; book
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;]&gt;
</code></pre> 
<p><strong>由一模型类条件查询多模型类数据</strong>:</p> 
<p>语法如下：</p> 
<pre><code>一模型类关联属性名__一模型类属性名__条件运算符=值
</code></pre> 
<blockquote> 
 <p><strong>注意：如果没有"__运算符"部分，表示等于。</strong></p> 
</blockquote> 
<pre><code>查询书名为“天龙八部”的所有人物
查询图书阅读量大于30的所有人物
</code></pre> 
<p>例：</p> 
<p>查询书名为“天龙八部”的所有人物。</p> 
<pre><code class="language-python">&gt;&gt;&gt; people = PeopleInfo.objects.filter(book__name='天龙八部')
&gt;&gt;&gt; people
&lt;QuerySet [&lt;PeopleInfo: 乔峰&gt;, &lt;PeopleInfo: 段誉&gt;, &lt;PeopleInfo: 虚竹&gt;, &lt;PeopleInfo: 王语嫣&gt;]&gt;
</code></pre> 
<p>查询图书阅读量大于30的所有人物</p> 
<pre><code class="language-python">&gt;&gt;&gt; people = PeopleInfo.objects.filter(book__readcount__gt=30)
&gt;&gt;&gt; people
&lt;QuerySet [&lt;PeopleInfo: 乔峰&gt;, &lt;PeopleInfo: 段誉&gt;, &lt;PeopleInfo: 虚竹&gt;, &lt;PeopleInfo: 王语嫣&gt;, &lt;PeopleInfo: 胡斐&gt;, &lt;PeopleInfo: 苗若兰&gt;, &lt;PeopleInfo: 程灵素&gt;, &lt;PeopleInfo: 袁紫衣&gt;]&gt;</code></pre> 
<p><img alt="" height="563" src="https://images2.imgbox.com/b7/25/sjxyKcyX_o.png" width="1200"> </p> 
<h6 style="background-color:transparent;"> 5 查询集QuerySet</h6> 
<p id="1-概念">Django的ORM中存在查询集的概念。</p> 
<p>查询集，也称查询结果集、QuerySet，表示从数据库中获取的对象集合。</p> 
<p>当调用如下过滤器方法时，Django会返回查询集（而不是简单的列表）：</p> 
<ul><li>all()：返回所有数据。</li><li>filter()：返回满足条件的数据。</li><li>exclude()：返回满足条件之外的数据。</li><li>order_by()：对结果进行排序。</li></ul> 
<p>对查询集可以再次调用过滤器进行过滤，如</p> 
<pre><code class="language-python">&gt;&gt;&gt; books = BookInfo.objects.filter(readcount__gt=30).order_by('pub_date')
&gt;&gt;&gt; books
&lt;QuerySet [&lt;BookInfo: 天龙八部&gt;, &lt;BookInfo: 雪山飞狐&gt;]&gt;
</code></pre> 
<p>也就意味着查询集可以含有零个、一个或多个过滤器。过滤器基于所给的参数限制查询的结果。</p> 
<p><strong>从SQL的角度讲，查询集与select语句等价，过滤器像where、limit、order by子句。</strong></p> 
<p><strong>判断某一个查询集中是否有数据</strong>：</p> 
<ul><li>exists()：判断查询集中是否有数据，如果有则返回True，没有则返回False。</li></ul> 
<h6 id="2-两大特性">两大特性</h6> 
<p id="1）惰性执行">1）惰性执行</p> 
<p>创建查询集不会访问数据库，直到调用数据时，才会访问数据库，调用数据的情况包括迭代、序列化、与if合用</p> 
<p>例如，当执行如下语句时，并未进行数据库查询，只是创建了一个查询集books</p> 
<pre><code class="language-python">&gt;&gt;&gt; books = BookInfo.objects.all()</code></pre> 
<p>继续执行遍历迭代操作后，才真正的进行了数据库的查询</p> 
<pre><code class="language-python">&gt;&gt;&gt; for book in books:
...     print(book.name)
...
射雕英雄传
天龙八部
笑傲江湖
雪山飞狐</code></pre> 
<p><img alt="" height="302" src="https://images2.imgbox.com/4c/a0/AiGeU1FW_o.png" width="957"> </p> 
<p id="2）缓存">2）缓存</p> 
<p>使用同一个查询集，第一次使用时会发生数据库的查询，然后Django会把结果缓存下来，再次使用这个查询集时会使用缓存的数据，减少了数据库的查询次数。</p> 
<p><strong>情况一</strong>：如下是两个查询集，无法重用缓存，每次查询都会与数据库进行一次交互，增加了数据库的负载。</p> 
<pre><code class="language-python">&gt;&gt;&gt; from book.models import BookInfo
&gt;&gt;&gt; [book.id for book in BookInfo.objects.all()]
[1, 2, 3, 4]
&gt;&gt;&gt; [book.id for book in BookInfo.objects.all()]
[1, 2, 3, 4]</code></pre> 
<p><img alt="" height="128" src="https://images2.imgbox.com/ce/c1/7bVhCFml_o.png" width="604"> </p> 
<p><strong>情况二</strong>：经过存储后，可以重用查询集，第二次使用缓存中的数据。</p> 
<pre><code class="language-python">&gt;&gt;&gt; books=BookInfo.objects.all()
&gt;&gt;&gt; [book.id for book in books]
[1, 2, 3, 4]
&gt;&gt;&gt; [book.id for book in books]
[1, 2, 3, 4]</code></pre> 
<p><img alt="" height="141" src="https://images2.imgbox.com/98/b4/cUqOdiAM_o.png" width="416"> </p> 
<h6 id="3-限制查询集">限制查询集</h6> 
<p>可以对查询集进行取下标或切片操作，等同于sql中的limit和offset子句。</p> 
<blockquote> 
 <p>注意：不支持负数索引。</p> 
</blockquote> 
<p><strong>对查询集进行切片后返回一个新的查询集，不会立即执行查询。</strong></p> 
<p>如果获取一个对象，直接使用[0]，等同于[0:1].get()，但是如果没有数据，[0]引发IndexError异常，[0:1].get()如果没有数据引发DoesNotExist异常。</p> 
<p>示例：获取第1、2项，运行查看。</p> 
<pre><code class="language-python">&gt;&gt;&gt; books = BookInfo.objects.all()[0:2]
&gt;&gt;&gt; books
&lt;QuerySet [&lt;BookInfo: 射雕英雄传&gt;, &lt;BookInfo: 天龙八部&gt;]&gt;
</code></pre> 
<p><img alt="" height="101" src="https://images2.imgbox.com/e1/82/rFxcyb8T_o.png" width="709"></p> 
<h6 id="4分页">分页</h6> 
<p><a href="https://docs.djangoproject.com/en/1.11/topics/pagination/" rel="nofollow" title="文档">文档</a></p> 
<pre><code class="language-python">#查询数据
books = BookInfo.objects.all()
#导入分页类
from django.core.paginator import Paginator
#创建分页实例
paginator=Paginator(books,2)
#获取指定页码的数据
page_skus = paginator.page(1)
#获取分页数据
total_page=paginator.num_pages</code></pre> 
<hr> 
<p>学习导航：<a href="http://www.xqnav.top/" rel="nofollow" title="http://www.xqnav.top">http://www.xqnav.top</a> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d662d25e51ca5c95caedfe27d2ecc04b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">我在高职教STM32——GPIO入门之按键输入（2）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dc2982dd83468930e6eee6f217ac4367/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL84 -- ERROR 1524 (HY000): Plugin ‘msql_native_password‘ is not loaded.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>