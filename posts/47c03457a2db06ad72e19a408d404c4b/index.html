<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络协议五 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/47c03457a2db06ad72e19a408d404c4b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="网络协议五">
  <meta property="og:description" content="一、RPC协议 【整体都没仔细研究 无论是什么 RPC，底层都是 Socket 编程
二、结合双十一项目 【没仔细研究 VPC 1. 创建一个 VPC 并指定一个 IP 段 解释：虚拟私有云（VPC）是一个虚拟的网络环境，它与互联网隔离，并允许用户在云上安全地运行虚拟机（VM）和其他云资源。指定一个 IP 段是为了确保所有在这个 VPC 中运行的资源都有唯一的 IP 地址，不会与其他网络冲突。
举例：假设你创建了一个 VPC，并指定了一个 IP 段为10.0.0.0/16。这个 IP 段表示从10.0.0.0到10.0.255.255的所有IP地址，可以用来为你的应用程序和服务分配IP地址。
2. 每个 VPC 被分配一个 VXLAN 的 ID 解释：VXLAN（Virtual Extensible LAN）是一个网络虚拟化技术，用于在大规模数据中心内创建虚拟网络。每个 VPC 被分配一个唯一的 VXLAN ID，以确保不同的 VPC 之间的隔离，即使它们的虚拟机可能在同一台物理机上运行，它们的二层网络也是隔离的。
举例：你的 VPC 被分配了 VXLAN ID 为1001，这确保了你的 VPC 与其他用户的 VPC 是隔离的。
3. 为每个可用区分配一个 Subnet 解释：可用区（Availability Zone, AZ）是云提供商的一个物理隔离区域，用于提高服务的可用性和容灾能力。在你的 VPC 内，可以为每个可用区创建一个子网（Subnet），即在大的 IP 段里划分出两个小的 IP 段。
举例：假设你有两个可用区（AZ1 和 AZ2），你可以在你的 VPC 内创建两个子网：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-13T15:23:55+08:00">
    <meta property="article:modified_time" content="2024-06-13T15:23:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络协议五</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="RPC__0"></a>一、RPC协议 【整体都没仔细研究</h2> 
<p>无论是什么 RPC，底层都是 Socket 编程</p> 
<h2><a id="__3"></a>二、结合双十一项目 【没仔细研究</h2> 
<h3><a id="VPC_4"></a>VPC</h3> 
<h5><a id="1__VPC__IP__5"></a>1. 创建一个 VPC 并指定一个 IP 段</h5> 
<p><strong>解释</strong>：虚拟私有云（VPC）是一个虚拟的网络环境，它与互联网隔离，并允许用户在云上安全地运行虚拟机（VM）和其他云资源。指定一个 IP 段是为了确保所有在这个 VPC 中运行的资源都有唯一的 IP 地址，不会与其他网络冲突。</p> 
<p><strong>举例</strong>：假设你创建了一个 VPC，并指定了一个 IP 段为<code>10.0.0.0/16</code>。这个 IP 段表示从<code>10.0.0.0</code>到<code>10.0.255.255</code>的所有IP地址，可以用来为你的应用程序和服务分配IP地址。</p> 
<h5><a id="2__VPC__VXLAN__ID_11"></a>2. 每个 VPC 被分配一个 VXLAN 的 ID</h5> 
<p><strong>解释</strong>：VXLAN（Virtual Extensible LAN）是一个网络虚拟化技术，用于在大规模数据中心内创建虚拟网络。每个 VPC 被分配一个唯一的 VXLAN ID，以确保不同的 VPC 之间的隔离，即使它们的虚拟机可能在同一台物理机上运行，它们的二层网络也是隔离的。</p> 
<p><strong>举例</strong>：你的 VPC 被分配了 VXLAN ID 为1001，这确保了你的 VPC 与其他用户的 VPC 是隔离的。</p> 
<h5><a id="3__Subnet_17"></a>3. 为每个可用区分配一个 Subnet</h5> 
<p><strong>解释</strong>：可用区（Availability Zone, AZ）是云提供商的一个物理隔离区域，用于提高服务的可用性和容灾能力。在你的 VPC 内，可以为每个可用区创建一个子网（Subnet），即在大的 IP 段里划分出两个小的 IP 段。</p> 
<p><strong>举例</strong>：假设你有两个可用区（AZ1 和 AZ2），你可以在你的 VPC 内创建两个子网：</p> 
<ul><li>在 AZ1 创建子网<code>10.0.1.0/24</code>（即从<code>10.0.1.0</code>到<code>10.0.1.255</code>）</li><li>在 AZ2 创建子网<code>10.0.2.0/24</code>（即从<code>10.0.2.0</code>到<code>10.0.2.255</code>）</li></ul> 
<h5><a id="4__25"></a>4. 配置路由策略在两个可用区之间访问</h5> 
<p><strong>解释</strong>：由于两个子网在不同的可用区内，并且使用不同的 IP 段，可以通过配置路由策略来实现两个子网之间的通信。</p> 
<p><strong>举例</strong>：你可以配置路由表，使得在 AZ1 子网<code>10.0.1.0/24</code>中的虚拟机可以访问 AZ2 子网<code>10.0.2.0/24</code>中的虚拟机，反之亦然。路由策略可能会指定所有到<code>10.0.2.0/24</code>的流量通过一个特定的路由器或网关。</p> 
<h2><a id="_32"></a>三、题</h2> 
<h3><a id="1_ip__33"></a>1. 给网卡配置ip 的方式</h3> 
<p>配置的参数如果是 DHCP，会通过 DHCP 协议自动配置 IP 地址；如果是 Static 会通过 ip addr 命令行进行手动配置。<br> <strong>PXE本身不能直接配置网卡的IP地址</strong>，计算机启动后，通过PXE请求IP地址，DHCP服务器响应并提供IP地址及PXE引导服务器（TFTP服务器）的地址。</p> 
<h3><a id="2_VLAN_37"></a>2.哪种方式可以配置 VLAN？</h3> 
<blockquote> 
 <p>A. 通过交换机可以配置某个口的 VLAN</p> 
</blockquote> 
<blockquote> 
 <p>在物理交换机上，网络管理员可以配置VLAN。这样做可以将交换机的不同端口分配到不同的VLAN中，使这些端口连接的设备仿佛在不同的物理网络中。</p> 
</blockquote> 
<blockquote> 
 <p>B. 通过网桥的 tag</p> 
</blockquote> 
<p>在Linux系统中，<code>brctl</code>（Bridge Control）命令用于创建和管理网络桥接。虽然<code>brctl</code>本身不直接支持VLAN tagging，但可以通过结合VLAN工具（如<code>vconfig</code>或<code>ip</code>命令）来实现VLAN tagging功能。以下是一个示例，演示如何使用<code>brctl</code>和<code>ip</code>命令在Linux上配置带有VLAN tagging的桥接。</p> 
<h4><a id="LinuxVLAN_tagging_46"></a>示例：在Linux上配置带有VLAN tagging的网桥</h4> 
<p>假设你有一个物理网卡<code>eth0</code>，并且你希望创建一个包含两个VLAN（VLAN ID为10和20）的网桥<code>br0</code>。</p> 
<h5><a id="1_VLAN_50"></a>1. 创建VLAN接口</h5> 
<p>首先，使用<code>ip</code>命令为<code>eth0</code>创建VLAN接口：</p> 
<pre><code class="prism language-sh"><span class="token comment"># 为eth0创建VLAN ID 10的接口</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> eth0 name eth0.10 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">10</span>

<span class="token comment"># 为eth0创建VLAN ID 20的接口</span>
<span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> <span class="token function">link</span> eth0 name eth0.20 <span class="token builtin class-name">type</span> vlan <span class="token function">id</span> <span class="token number">20</span>
</code></pre> 
<h5><a id="2_VLAN_62"></a>2. 启动VLAN接口</h5> 
<p>启动创建的VLAN接口：</p> 
<pre><code class="prism language-sh"><span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev eth0.10 up
<span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev eth0.20 up
</code></pre> 
<h5><a id="3_VLAN_71"></a>3. 创建网桥并添加VLAN接口</h5> 
<p>使用<code>brctl</code>命令创建一个网桥<code>br0</code>，并将VLAN接口添加到这个网桥中：</p> 
<pre><code class="prism language-sh"><span class="token comment"># 创建网桥br0</span>
brctl addbr br0

<span class="token comment"># 将VLAN接口添加到网桥br0</span>
brctl addif br0 eth0.10
brctl addif br0 eth0.20
</code></pre> 
<h5><a id="4__84"></a>4. 启动网桥</h5> 
<p>最后，启动网桥<code>br0</code>：</p> 
<pre><code class="prism language-sh"><span class="token function">ip</span> <span class="token function">link</span> <span class="token builtin class-name">set</span> dev br0 up
</code></pre> 
<h4><a id="_92"></a>解释</h4> 
<ul><li><strong>创建VLAN接口</strong>：通过<code>ip link add</code>命令为物理接口<code>eth0</code>创建两个VLAN接口<code>eth0.10</code>和<code>eth0.20</code>，分别对应VLAN ID 10和20。</li><li><strong>启动VLAN接口</strong>：将新创建的VLAN接口设置为<code>up</code>状态，使其开始工作。</li><li><strong>创建网桥并添加接口</strong>：通过<code>brctl addbr</code>命令创建一个新的网桥<code>br0</code>，并将VLAN接口<code>eth0.10</code>和<code>eth0.20</code>添加到这个网桥中。</li><li><strong>启动网桥</strong>：将网桥设置为<code>up</code>状态，使其开始转发网络流量。</li></ul> 
<p>这样，网桥<code>br0</code>就会包含两个VLAN，并且能够处理VLAN ID为10和20的数据流。这个配置使得不同VLAN的数据可以通过相同的物理网卡进行隔离和管理。</p> 
<h4><a id="_101"></a>注意</h4> 
<ul><li>在现代Linux系统中，推荐使用<code>ip</code>命令代替<code>vconfig</code>，因为<code>ip</code>命令更加灵活和强大。</li><li><code>brctl</code>虽然仍然可用，但在一些情况下可能会被<code>ip</code>命令和<code>bridge</code>命令替代，这些命令提供了更丰富的功能和更好的支持。</li></ul> 
<p>通过这个示例，你可以看到如何在Linux上使用<code>brctl</code>和<code>ip</code>命令来配置VLAN tagging和网桥，从而实现对VLAN网络的管理和数据流的隔离。</p> 
<blockquote> 
 <p>在企业环境中，可能需要将财务部门、人力资源部门和IT部门的网络流量进行隔离，以确保数据安全和网络性能。通过在网桥上配置不同的VLAN tag，可以为每个部门创建独立的网络环境，同时这些部门的设备可以连接到同一个物理网络基础设施上。这样既节省了成本，又提高了网络的灵活性和管理效率。</p> 
</blockquote> 
<blockquote> 
 <p>C. 通过 vconfig 命令</p> 
</blockquote> 
<p>通过<code>vconfig</code>配置的VLAN和通过VLAN tagging配置的VLAN在用法和应用场景上有一些不同。让我们通过实例来说明两者的区别以及各自的应用场景。</p> 
<h4><a id="1_vconfigVLAN_113"></a>1. 通过vconfig配置的VLAN</h4> 
<p><strong>vconfig</strong>是一个Linux命令，用于在物理网络接口上创建VLAN虚拟接口。这种方式适用于需要在单个物理网卡上创建多个虚拟接口，每个虚拟接口对应一个不同的VLAN ID。</p> 
<h5><a id="VLAN_117"></a>项目实例：在同一个服务器上运行多个服务，并通过不同的VLAN隔离它们的流量</h5> 
<p>假设你有一台服务器，运行着多个服务（如Web服务器、数据库服务器和文件服务器）。你希望将这些服务的网络流量隔离开来，以提高安全性和管理效率。你可以使用<code>vconfig</code>在服务器的物理网卡<code>eth0</code>上创建多个VLAN接口：</p> 
<ol><li> <p><strong>创建VLAN接口</strong>：</p> <pre><code class="prism language-sh"><span class="token function">sudo</span> vconfig <span class="token function">add</span> eth0 <span class="token number">10</span>
<span class="token function">sudo</span> vconfig <span class="token function">add</span> eth0 <span class="token number">20</span>
<span class="token function">sudo</span> vconfig <span class="token function">add</span> eth0 <span class="token number">30</span>
</code></pre> </li><li> <p><strong>配置VLAN接口的IP地址</strong>：</p> <pre><code class="prism language-sh"><span class="token function">sudo</span> <span class="token function">ifconfig</span> eth0.10 <span class="token number">192.168</span>.10.1 netmask <span class="token number">255.255</span>.255.0 up
<span class="token function">sudo</span> <span class="token function">ifconfig</span> eth0.20 <span class="token number">192.168</span>.20.1 netmask <span class="token number">255.255</span>.255.0 up
<span class="token function">sudo</span> <span class="token function">ifconfig</span> eth0.30 <span class="token number">192.168</span>.30.1 netmask <span class="token number">255.255</span>.255.0 up
</code></pre> </li><li> <p><strong>连接不同的服务到不同的VLAN</strong>：</p> 
  <ul><li>Web服务器连接到<code>eth0.10</code>（VLAN 10）</li><li>数据库服务器连接到<code>eth0.20</code>（VLAN 20）</li><li>文件服务器连接到<code>eth0.30</code>（VLAN 30）</li></ul> </li></ol> 
<p>通过这种配置，你可以确保不同服务的流量通过不同的VLAN进行传输，实现了流量的隔离。</p> 
<h4><a id="2_tagVLAN_142"></a>2. 通过tag配置的VLAN</h4> 
<p>VLAN tagging通常是在网络设备（如交换机）上配置，用于标记数据包的VLAN ID，以便在跨越多个交换机或路由器时保持VLAN信息。这种方式适用于更大规模的网络环境，需要跨多个设备维护VLAN隔离。</p> 
<h5><a id="_146"></a>项目实例：在办公室网络中隔离部门的网络流量</h5> 
<p>假设你有一个办公室网络，需要为不同的部门（如HR、IT和Finance）配置独立的VLAN。你可以在办公室的核心交换机上配置VLAN tagging，以便将各个部门的网络流量隔离。</p> 
<ol><li> <p><strong>配置核心交换机</strong>：</p> 
  <ul><li> <p>在核心交换机上创建VLAN：</p> <pre><code class="prism language-sh">vlan database
vlan <span class="token number">10</span> name HR
vlan <span class="token number">20</span> name IT
vlan <span class="token number">30</span> name Finance
</code></pre> </li><li> <p>配置端口VLAN tagging：</p> <pre><code class="prism language-sh">interface gig0/1
switchport mode trunk
switchport trunk allowed vlan <span class="token number">10,20</span>,30
</code></pre> </li></ul> </li><li> <p><strong>配置接入交换机</strong>：</p> 
  <ul><li> <p>在接入交换机上配置VLAN：</p> <pre><code class="prism language-sh">vlan <span class="token number">10</span>
vlan <span class="token number">20</span>
vlan <span class="token number">30</span>
</code></pre> </li><li> <p>配置接入交换机端口，分配给不同部门：</p> <pre><code class="prism language-sh">interface gig0/2
switchport mode access
switchport access vlan <span class="token number">10</span>
interface gig0/3
switchport mode access
switchport access vlan <span class="token number">20</span>
interface gig0/4
switchport mode access
switchport access vlan <span class="token number">30</span>
</code></pre> </li></ul> </li><li> <p><strong>连接各部门设备</strong>：</p> 
  <ul><li>HR部门的设备连接到接入交换机的<code>gig0/2</code>端口（VLAN 10）</li><li>IT部门的设备连接到接入交换机的<code>gig0/3</code>端口（VLAN 20）</li><li>Finance部门的设备连接到接入交换机的<code>gig0/4</code>端口（VLAN 30）</li></ul> </li></ol> 
<p>通过这种配置，不同部门的网络流量被隔离在各自的VLAN中，即使跨越多个交换机，VLAN tagging会保持数据包的VLAN ID，确保隔离。</p> 
<h4><a id="_194"></a>总结</h4> 
<ul><li><strong>通过vconfig配置的VLAN</strong>：适用于单个服务器上创建多个VLAN接口，实现服务间的网络流量隔离。配置简单，主要在主机级别管理。</li><li><strong>通过VLAN tagging配置的VLAN</strong>：适用于更大规模的网络环境，通过交换机等网络设备实现跨设备的VLAN流量隔离。适合需要在多个设备间维护VLAN隔离的复杂网络环境。</li></ul> 
<p>这两个方法在各自的应用场景中都能提供有效的网络流量隔离，但适用的网络规模和复杂度不同。</p> 
<blockquote> 
 <p>VTEP 是用来封装 VXLAN 的。它不可以配置vlan</p> 
</blockquote> 
<p>VTEP（VXLAN Tunnel Endpoints）是VXLAN（Virtual Extensible Local Area Network）隧道的端点，它的作用是将VXLAN数据包封装在UDP数据包中，以便在不支持VXLAN的物理网络中传输。这种封装允许跨越不同物理网络的虚拟机（VM）之间进行通信，就像它们在同一个局域网内一样。</p> 
<h4><a id="_207"></a>通俗易懂的解释：</h4> 
<p>想象一下，你在一个大型公司工作，公司大楼分布在不同的城市，员工需要在这些城市之间安全地传输机密文件。但是，这些城市的邮件系统（物理网络）不支持某些类型的文件封装（VXLAN）。为了解决这个问题，公司决定使用一种特殊的快递服务（VTEP），它能够在每个城市设立一个快递点（VTEP），负责将机密文件（虚拟机流量）封装在特殊的快递包裹（UDP数据包）中，然后通过普通的邮件系统发送到目的地。</p> 
<h4><a id="_211"></a>项目实例：</h4> 
<p>假设你负责一个云计算项目，该项目在多个数据中心部署了虚拟机，这些数据中心分布在不同的地理位置。你需要确保这些虚拟机能够互相通信，就像它们在同一个局域网内一样，但是每个数据中心的物理网络是独立的。</p> 
<ol><li> <p><strong>项目需求</strong>：</p> 
  <ul><li>虚拟机需要跨越不同数据中心的物理网络进行通信。</li></ul> </li><li> <p><strong>解决方案</strong>：</p> 
  <ul><li>在每个数据中心的网络设备上配置VTEP。这些设备将作为VXLAN隧道的端点。</li></ul> </li><li> <p><strong>配置过程</strong>：</p> 
  <ul><li>为每个数据中心的网络设备分配一个VTEP IP地址，这个地址将用于VXLAN隧道的通信。</li><li>配置VXLAN网络标识符（VNI），这是一个唯一的数字，用于区分不同的VXLAN网络。</li></ul> </li><li> <p><strong>数据传输</strong>：</p> 
  <ul><li>当一个虚拟机需要发送数据到另一个数据中心的虚拟机时，数据首先被发送到本地数据中心的VTEP。</li><li>VTEP将数据封装在VXLAN头部中，然后再封装在UDP数据包中，通过物理网络发送到目标数据中心的VTEP。</li><li>目标数据中心的VTEP接收到UDP数据包，解封装出VXLAN和原始数据，然后将其传递给目标虚拟机。</li></ul> </li><li> <p><strong>优点</strong>：</p> 
  <ul><li>通过VTEP和VXLAN，你可以在不同的物理网络之上创建一个虚拟的、逻辑上的网络，使得虚拟机之间的通信不受物理位置的限制。</li><li>这种方法简化了跨数据中心的网络配置，提高了网络的灵活性和可扩展性。</li></ul> </li></ol> 
<p>通过这个实例，你可以看到VTEP在封装VXLAN数据包中的作用，它使得在不支持VXLAN的物理网络上实现虚拟机之间的通信成为可能。</p> 
<h3><a id="3_NAT_238"></a>3.网关和路由器都是三层的，都可以做 NAT，网关往往是路由器在某个局域网里面的口。</h3> 
<p>在网络领域中，"三层"指的是网络通信中的第三层，即网络层（Network Layer）。这里简单解释一下网络的不同层级：</p> 
<ol><li> <p><strong>第一层（物理层）</strong>：物理层定义了物理介质上数据的传输方式，例如电缆、光纤、无线电等。它主要关注如何在传输媒介上传输比特流。</p> </li><li> <p><strong>第二层（数据链路层）</strong>：数据链路层建立在物理层之上，负责通过物理网络（如以太网、WiFi）直接连接的通信。它处理帧的传输，包括物理地址（MAC地址）的识别和错误检测。</p> </li><li> <p><strong>第三层（网络层）</strong>：网络层是在数据链路层之上的抽象层，主要负责在不同网络之间传输数据包。它的核心功能是通过路由选择合适的路径，将数据包从源主机传输到目标主机。IP协议就是在网络层工作的一个重要协议。</p> </li></ol> 
<h4><a id="_248"></a>网关和路由器的三层功能</h4> 
<ul><li> <p><strong>路由器（Router）</strong>：路由器是一种网络设备，工作在网络层（第三层）。它根据目标地址的IP地址来决定最佳路径，并转发数据包。路由器在网络中连接不同的子网或网络，并处理不同子网之间的通信。</p> </li><li> <p><strong>网关（Gateway）</strong>：网关通常是指连接两个不同网络的设备或节点，可以是路由器，也可以是其他类型的设备，如防火墙、代理服务器等。网关实际上是一个网络节点，提供了连接两个网络的出入口，通常工作在网络层，帮助不同网络之间的通信。</p> </li></ul> 
<h4><a id="_254"></a>区别和应用</h4> 
<ul><li><strong>路由器</strong>主要作为网络层设备，负责路由和转发数据包，是连接不同网络的关键设备。</li><li><strong>网关</strong>则是一个更广义的概念，可以是路由器，也可以是其他能连接不同网络的设备，它们在网络体系结构中扮演着连接不同网络、实现通信的重要角色。</li></ul> 
<p>总结来说，"三层"指的是网络层，而路由器和网关都在网络层上操作，负责不同网络间的数据包转发和连接，但网关的概念更为广泛，不限于特定类型的设备。</p> 
<h4><a id="_261"></a>基本功能解释：</h4> 
<ol><li> <p><strong>路由器</strong>：</p> 
  <ul><li>路由器是一种网络设备，用于连接不同的网络，它可以在网络层（即OSI模型的第三层，也就是IP层）进行数据包的转发和路由。</li><li>路由器能够识别不同网络的数据包，并根据路由表将数据包发送到正确的目的地。</li></ul> </li><li> <p><strong>网关</strong>：</p> 
  <ul><li>网关是一种特殊的网络设备，通常用于连接不同的网络协议或不同的网络环境。在局域网（LAN）中，网关可以是路由器的特定接口，用于连接局域网和广域网（WAN）。</li><li>网关可以执行多种功能，包括协议转换、数据格式转换等。</li></ul> </li><li> <p><strong>NAT（网络地址转换）</strong>：</p> 
  <ul><li>NAT是一种技术，允许一个网络中的多个设备共享一个或多个公网IP地址。路由器和某些网关设备可以执行NAT，使得私有IP地址的设备能够访问互联网。</li></ul> </li></ol> 
<h4><a id="_274"></a>项目实例：</h4> 
<p>假设你是一家企业的IT管理员，需要配置公司网络以便员工能够访问互联网，并且公司的服务器能够被外部用户安全地访问。</p> 
<ol><li> <p><strong>公司网络配置</strong>：</p> 
  <ul><li>公司内部有一个局域网，所有员工的电脑都连接到这个局域网上，拥有私有IP地址。</li></ul> </li><li> <p><strong>连接到互联网</strong>：</p> 
  <ul><li>为了连接到互联网，公司使用了一个路由器。这个路由器有一个公网IP地址，并且配置了NAT，使得所有员工的电脑可以通过这个公网IP地址访问互联网。</li></ul> </li><li> <p><strong>网关的角色</strong>：</p> 
  <ul><li>在这个场景中，路由器的局域网接口就充当了网关的角色。所有从局域网发出的数据包，首先到达这个网关（即路由器的局域网接口），然后根据NAT规则，数据包的源IP地址被转换为公网IP地址，并通过WAN接口发送到互联网。</li></ul> </li><li> <p><strong>外部访问公司服务器</strong>：</p> 
  <ul><li>同时，公司有一个面向客户的Web服务器，拥有一个公网IP地址。为了安全地让外部用户访问这个服务器，你可以在路由器上设置端口转发规则，将从互联网进入的特定端口的流量转发到Web服务器的私有IP地址。</li></ul> </li><li> <p><strong>NAT的作用</strong>：</p> 
  <ul><li>当外部用户访问公司的Web服务器时，他们的请求首先到达公司的公网IP地址，然后路由器根据端口转发规则，将流量转换为Web服务器的私有IP地址，并完成数据传输。</li></ul> </li></ol> 
<h3><a id="4_IP__294"></a>4.数据中心内部和外部使用的路由协议不太一样。内部的协议主要是用来寻找最短路径，外部的协议往往会有一些策略，可以选择将部分的 IP 地址广播出去</h3> 
<p>数据中心内部和外部使用的路由协议确实可能不同，这主要是由于它们各自的需求和目标不同。下面我将解释这些差异，并提供一些通俗易懂的例子。</p> 
<h4><a id="_297"></a>数据中心内部路由协议：</h4> 
<p>数据中心内部的路由协议主要关注于寻找数据传输的最短路径。这是因为在数据中心内部，网络延迟和带宽利用率是关键考虑因素。</p> 
<ol><li> <p><strong>最短路径优先</strong>：</p> 
  <ul><li>内部路由协议（如OSPF，开放最短路径优先）的目标是找到从源头到目的地的最短路径，这样可以减少数据传输的延迟，提高效率。</li></ul> </li><li> <p><strong>快速收敛</strong>：</p> 
  <ul><li>数据中心的路由协议需要快速适应网络变化，如链路故障或新增路由，这称为快速收敛。</li></ul> </li><li> <p><strong>负载均衡</strong>：</p> 
  <ul><li>内部路由协议可能还会考虑负载均衡，确保网络流量在多条路径上均匀分布，避免某些链路过载。</li></ul> </li></ol> 
<h4><a id="_310"></a>数据中心外部路由协议：</h4> 
<p>数据中心外部的路由协议不仅要考虑路径的选择，还可能涉及到策略路由，这涉及到根据特定的策略来决定哪些IP地址可以被广播到互联网上。</p> 
<ol><li> <p><strong>策略路由</strong>：</p> 
  <ul><li>外部路由协议（如BGP，边界网关协议）允许网络管理员根据特定的策略来选择路由路径，这些策略可能基于性能、成本、政治因素等。</li></ul> </li><li> <p><strong>IP地址广播</strong>：</p> 
  <ul><li>在BGP中，网络管理员可以选择将部分IP地址范围广播给其他网络，这样其他网络就可以知道如何将流量路由到这些地址。</li></ul> </li><li> <p><strong>路径控制</strong>：</p> 
  <ul><li>BGP允许精细控制路由路径，可以指定流量通过特定的网络或避免某些网络。</li></ul> </li></ol> 
<h4><a id="_323"></a>通俗例子：</h4> 
<p>假设你是一家快递公司的调度员，你的工作是确保包裹从发件人安全、快速地到达收件人。</p> 
<ul><li> <p><strong>数据中心内部路由</strong>：</p> 
  <ul><li>想象你在一个大型仓库内部分配包裹，你需要找到从仓库入口到包裹目的地（可能是不同的装卸区或发货区）的最短路径。你的目标是减少包裹在仓库内的运输时间，确保快速处理。</li></ul> </li><li> <p><strong>数据中心外部路由</strong>：</p> 
  <ul><li>当你处理从一个地方到另一个地方的包裹运输时，你需要考虑不同的运输方式和路线。你可能会选择成本最低或最快的路线，或者根据客户的特殊要求选择特定的运输公司。你还需要决定哪些包裹可以被标记为“加急”，并确保这些信息被正确的运输合作伙伴所知晓。</li></ul> </li></ul> 
<p>总结来说，数据中心内部的路由协议主要关注于效率和速度，寻找最短的传输路径；而数据中心外部的路由协议则更加灵活，可以根据多种策略来决定数据传输的路径，包括选择性地广播IP地址信息。</p> 
<h3><a id="5__334"></a>5. 对于传输层协议</h3> 
<p>传输层常用的两种协议是 TCP 和 UDP，其实还有其他的，例如 SCTP。UDP 比较简单，常用于内网，但是它可以让应用层自己实现可靠连接和拥塞控制，因此也常在数据中心外使用。TCP 通过 Sequence Number 和滑动窗口，解决重传和回复的问题，而拥塞窗口解决的是网络拥塞问题。</p> 
<h3><a id="_337"></a>滑动窗口和拥塞窗口</h3> 
<h4><a id="Sliding_Window_338"></a>滑动窗口（Sliding Window）：</h4> 
<ul><li><strong>作用</strong>：滑动窗口是一种流量控制机制，它允许接收方告知发送方自己能够处理的数据量。这样做可以防止发送方发送过多数据导致接收方处理不过来，从而避免数据丢失。</li><li><strong>工作原理</strong>：发送方维护一个窗口大小，表示接收方还能接收多少字节的数据。每当接收方处理了一些数据后，窗口就会向前滑动，告知发送方可以发送更多的数据。</li><li><strong>过程</strong>：当发送方接收到接收方的确认应答（ACK）后，窗口就会根据确认的数据量向前滑动，这样发送方就知道哪些数据已经被成功接收，可以发送新数据。</li></ul> 
<h4><a id="Congestion_Window_343"></a>拥塞窗口（Congestion Window）：</h4> 
<ul><li><strong>作用</strong>：拥塞窗口是一种拥塞控制机制，它用来控制发送方的数据发送速率，以避免网络拥塞。当网络中的流量过多时，拥塞窗口会减小，从而减少发送到网络中的数据量。</li><li><strong>工作原理</strong>：TCP开始时会设置一个较小的拥塞窗口，并根据网络状况逐渐增大。当检测到网络拥塞的迹象（如超时重传或收到多个重复的ACK）时，拥塞窗口会减小。</li><li><strong>过程</strong>：拥塞窗口的大小是基于网络的反馈动态调整的。TCP使用了一些算法，如慢启动、拥塞避免、快速重传和快速恢复，来调整拥塞窗口的大小。</li></ul> 
<h4><a id="_348"></a>通俗例子：</h4> 
<p>想象一条高速公路，滑动窗口和拥塞窗口就像是控制车辆流量的两个机制。</p> 
<ul><li> <p><strong>滑动窗口</strong>：</p> 
  <ul><li>就像每辆车（数据包）在上路前需要检查收费站（接收方）的指示牌，指示牌上写着“下一个可进入的车位”。车辆只能按照指示牌上的位置进入，以避免在收费站造成拥堵。</li></ul> </li><li> <p><strong>拥塞窗口</strong>：</p> 
  <ul><li>就像高速公路上的交通监控系统，它会根据路上的车辆数量来调整入口的开放速度。如果发现路上车辆太多，就会减慢新车辆的进入速度，以避免整个路段的拥堵。</li></ul> </li></ul> 
<p>总结来说，滑动窗口确保接收方不会因为数据量过大而处理不过来，而拥塞窗口则确保整个网络不会因为数据流量过大而出现拥塞。这两个机制共同作用，使得TCP能够在不同网络状况下提供可靠的数据传输服务。</p> 
<h3><a id="6_360"></a>6.</h3> 
<p>TCP确保数据的可靠传输，HTTP层通过幂等性机制防止重复处理请求，而HTTP本身可以传输多种类型的数据。<br> HTTP的POST方法既可以用于向服务器发送数据（如表单提交、文件上传）也可以用于向服务器请求数据（如发送复杂的查询参数），以获取特定的数据。这些数据可能需要在请求体中包含较多的参数信息，而GET方法的URL长度限制可能无法满足。</p> 
<h3><a id="7socket_363"></a>7.socket</h3> 
<p>Socket 可以建立 TCP 和 UDP 连接，但是它处于应用层。Socket 连接后会生成一个文件描述符，所以从内核来看，它只是一个文件。监听的 Socket 和读写的 Socket 并不是同一个。<br> UDP 的 Socket 不是面向连接的，它可以接收来自多个源的网络包。<br> 假设有一个简单的实时音频流服务，服务器使用UDP来向多个客户端传输音频数据。每个客户端都可以通过单独的UDP套接字接收来自服务器发送的音频数据包。这些数据包可以从多个源（服务器）发送到多个目的地（客户端）</p> 
<h3><a id="8DNS_367"></a>8.DNS</h3> 
<p>DNS（域名系统）是互联网上用于将人类可读的域名（如<code>www.example.com</code>）转换为机器可读的IP地址（如<code>192.0.2.1</code>）的系统。在这个系统中，客户端、本地DNS服务器和授权DNS服务器各自扮演不同的角色。下面我将解释这些概念，并举例说明DNS如何在数据中心内和跨数据中心实现负载均衡。</p> 
<h4><a id="DNS_370"></a>DNS解析过程：</h4> 
<ol><li><strong>客户端查询</strong>：当你在浏览器中输入一个网址时，你的计算机（客户端）会向DNS服务器发起查询请求。</li><li><strong>本地DNS服务器</strong>：通常是你的ISP（互联网服务提供商）提供的DNS服务器，它会尝试回答查询。如果答案不在其缓存中，它会向其他DNS服务器查询。</li><li><strong>授权DNS服务器</strong>：这些是有权响应特定域名查询的服务器，它们持有域名的权威记录。</li></ol> 
<h4><a id="DNS_375"></a>轮询DNS树：</h4> 
<ul><li>这个过程通常不是由客户端完成的，而是由本地DNS服务器完成。当本地DNS服务器的缓存中没有答案时，它会向上查询，直到找到可以提供答案的授权DNS服务器。</li></ul> 
<h4><a id="DNS_378"></a>DNS负载均衡：</h4> 
<ul><li><strong>数据中心内的负载均衡</strong>：在一个数据中心内，DNS可以配置为返回多个IP地址，这些地址对应数据中心内的多个服务器。当用户请求域名时，DNS可以根据服务器负载情况返回不同的IP，从而实现负载均衡。</li><li><strong>跨数据中心的全局负载均衡</strong>：在多个数据中心的情况下，DNS可以根据地理位置、服务器负载或策略，返回最接近用户或响应速度最快的数据中心的IP地址。</li></ul> 
<h4><a id="DNS_382"></a>DNS更新延迟：</h4> 
<ul><li>当你修改DNS记录（如将域名指向新的IP地址）后，这个变化可能不会立即生效。这是因为： 
  <ul><li><strong>缓存</strong>：本地DNS服务器和其他中间DNS服务器可能已经缓存了旧的IP地址。</li><li><strong>TTL（生存时间）</strong>：DNS记录有一个TTL值，告诉DNS服务器记录在多长时间内有效。即使记录被更新，已经缓存的记录也会在TTL过期后才会失效。</li></ul> </li></ul> 
<h3><a id="9CDN_386"></a>9.CDN</h3> 
<ol><li>当你使用CDN时，你通常会将你的网站域名的DNS记录配置为CNAME指向CDN提供的域名。这意味着当用户请求你的域名时，他们实际上会被重定向到CDN的服务器，从而享受到CDN提供的加速和优化服务。</li></ol> 
<p>例子：<br> 假设你的网站域名是www.example.com，CDN提供商给你一个CDN域名，如example.cdnprovider.com。你会将DNS的CNAME记录配置为：</p> 
<pre><code class="prism language-bash">www.example.com.  CNAME  example.cdnprovider.com.
</code></pre> 
<p>当用户访问www.example.com时，DNS查询会解析为example.cdnprovider.com，请求被CDN接管。</p> 
<ol start="2"><li>CDN 节点分布在各个地区和运营商。相同的运营商路径更短一些。有时候相同的地区，不同的运营商不能直接连接，而是要到两个运营商互通的地方转一下，所以相同运营商更加重要一些。而对于同一个运营商，地区比较重要。</li><li>CDN 可以加速静态数据，也可以加速动态数据<br> 假设你的网站有一个实时新闻更新功能，内容经常变化。<br> 虽然CDN主要针对静态内容，但一些CDN服务商可能提供应用层的优化，比如通过WebSocket协议来实现实时数据的快速传输。<br> CDN还可以通过智能路由技术，选择最佳的路径来传输动态内容，即使在网络拥塞的情况下也能保证数据传输的速度。</li></ol> 
<h3><a id="10__403"></a>10. 手机网路</h3> 
<p>移动通信网络由多个部分组成，包括无线接入网、核心网和连接到互联网的部分。每个部分都有其特定的功能和组件。下面我将解释这些部分的功能，并举例说明SGW（服务网关）和PGW（PDN网关）的区别，以及GTP（GPRS隧道协议）的作用。</p> 
<h4><a id="_406"></a>移动通信网络的主要部分：</h4> 
<ol><li> <p><strong>无线接入网</strong>：</p> 
  <ul><li>这是移动设备的第一部分接触点，包括手机和基站之间的无线连接。</li></ul> </li><li> <p><strong>核心网</strong>：</p> 
  <ul><li>核心网负责处理数据的路由和传输。它由多个组件组成，包括SGW和PGW。</li></ul> </li><li> <p><strong>互联网连接</strong>：</p> 
  <ul><li>核心网通过互联网连接，将数据传输到最终目的地，比如用户的家中或办公室。</li></ul> </li></ol> 
<h4><a id="SGWPGW_417"></a>SGW和PGW的作用：</h4> 
<ul><li> <p><strong>SGW（服务网关）</strong>：</p> 
  <ul><li>SGW主要负责用户数据的传输，它作为用户设备和核心网之间的桥梁。SGW通常位于无线接入网和核心网之间，负责数据的路由和转发。</li></ul> </li><li> <p><strong>PGW（PDN网关）</strong>：</p> 
  <ul><li>PGW负责将用户数据从核心网传输到外部网络，如互联网或企业网络。它还负责IP地址分配、计费、策略执行等功能。</li></ul> </li></ul> 
<h4><a id="GTP_425"></a>GTP协议：</h4> 
<ul><li>GTP是一种网络协议，用于在GPRS（通用分组无线服务）和LTE（长期演进）网络中传输数据。GTP封装用户数据，并通过UDP（用户数据报协议）在IP网络中传输。</li></ul> 
<h4><a id="_429"></a>通俗例子：</h4> 
<p>想象你在一个大型的国际快递公司工作，这个公司在全球有多个分拣中心（SGW和PGW）。</p> 
<ul><li> <p><strong>无线接入网</strong>：</p> 
  <ul><li>就像快递员从客户手中收集包裹，并将其送到最近的分拣中心。</li></ul> </li><li> <p><strong>核心网</strong>：</p> 
  <ul><li>核心网就像大型的国内分拣中心，负责处理来自全国各地的包裹。</li></ul> </li><li> <p><strong>SGW</strong>：</p> 
  <ul><li>SGW类似于国内分拣中心，它负责将包裹从快递员那里接收过来，并根据目的地进行初步分类。</li></ul> </li><li> <p><strong>PGW</strong>：</p> 
  <ul><li>PGW类似于国际分拣中心，它负责将包裹从国内分拣中心接收过来，并进一步分类，然后发送到世界各地的最终目的地。</li></ul> </li><li> <p><strong>GTP协议</strong>：</p> 
  <ul><li>GTP就像是一个标准化的包裹标签，它包含了包裹的所有必要信息，如目的地、客户信息等。这个标签确保包裹在运输过程中能够被正确处理。</li></ul> </li><li> <p><strong>IP地址分配</strong>：</p> 
  <ul><li>就像每个包裹在国际分拣中心被赋予一个唯一的追踪号码（IP地址），手机的IP地址也是由PGW分配的。</li></ul> </li><li> <p><strong>异地上网问题</strong>：</p> 
  <ul><li>当你在国外旅行时，你的手机需要连接到当地的网络。SGW和PGW的区分确保了你的手机能够被正确地路由到当地的网络，并且能够访问互联网，就像你的包裹能够被正确地送达目的地一样。</li></ul> </li></ul> 
<p>通过这个例子，你可以看到移动通信网络中的不同组件如何协同工作，确保数据能够被正确地传输和处理。</p> 
<p>当你在国外旅行时，你的手机需要连接到当地的移动通信网络以便使用数据服务和打电话。这里SGW（服务网关）和PGW（PDN网关）在LTE（4G）网络中扮演了重要角色，它们帮助确保你的手机能够顺利地接入互联网和进行通信。下面我将用一个更通俗的比喻来解释这个过程：</p> 
<h4><a id="_459"></a>比喻解释：</h4> 
<p>想象你是一位环球旅行者，每到一个新国家，你都需要找到当地的邮局来发送和接收邮件。</p> 
<ul><li> <p><strong>SGW（服务网关）</strong>：</p> 
  <ul><li>就像你进入一个新国家的边境检查站，SGW负责处理你进入新网络的初步请求。它会检查你的旅行文件（手机与网络的连接请求），然后指引你到正确的邮局（核心网）。</li></ul> </li><li> <p><strong>PGW（PDN网关）</strong>：</p> 
  <ul><li>一旦你通过了边境检查站，你来到了当地的邮局。PGW就像邮局的职员，它给你的邮件分配一个当地的邮戳（IP地址），并确保你的邮件能够正确地发送到世界上任何地方，包括你的家乡或你旅行的下一个目的地。</li></ul> </li></ul> 
<h4><a id="SGWPGW_469"></a>移动网络中的SGW和PGW的作用：</h4> 
<ul><li> <p><strong>SGW</strong>：</p> 
  <ul><li>在你到达一个新国家时，SGW作为你与当地移动网络之间的第一个接触点。它帮助你的手机与当地的移动网络建立连接，并确保数据能够开始传输。</li></ul> </li><li> <p><strong>PGW</strong>：</p> 
  <ul><li>当你连接到当地网络后，PGW负责将你的数据请求路由到正确的目的地。比如，当你想访问一个网站时，PGW会将你的请求发送到互联网上正确的服务器。</li></ul> </li></ul> 
<h4><a id="SGWPGW_477"></a>为什么需要SGW和PGW？</h4> 
<ul><li> <p><strong>数据路由</strong>：</p> 
  <ul><li>SGW和PGW帮助你的数据请求在复杂的网络中找到正确的路径，就像邮局帮助你的邮件找到正确的路线一样。</li></ul> </li><li> <p><strong>IP地址分配</strong>：</p> 
  <ul><li>当你到达一个新国家，PGW会为你的手机分配一个新的IP地址，这样你就可以访问当地的互联网服务，就像你获得当地的邮戳一样。</li></ul> </li><li> <p><strong>计费和策略执行</strong>：</p> 
  <ul><li>PGW还可以根据你的数据使用情况来计费，并执行数据使用策略，确保你的数据服务符合当地的规定。</li></ul> </li></ul> 
<p>通过这个比喻，你可以看到SGW和PGW在移动通信网络中的作用，它们确保了你的手机在国外也能顺利地连接到网络并访问互联网。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fbb222994158530ededafd977f21401a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于图像识别的中医AI舌面诊技术，全面开放API对接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c1c7cce09eab81188279907a72e75f6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MYSQL、ORACLE、PostgreSQL数据库对象层次及权限管理对比</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>