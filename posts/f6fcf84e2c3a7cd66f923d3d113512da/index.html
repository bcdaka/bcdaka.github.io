<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CMakeList整理大全 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f6fcf84e2c3a7cd66f923d3d113512da/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="CMakeList整理大全">
  <meta property="og:description" content="0. CMake应用示例 之前我们也整理过cmake 引入第三方库（头文件目录、库目录、库文件）。但是这里面整理的内容其实是不全的。所以我们需要进一步将CMake的使用整理好。以供后面的学习的工程师来检索查询。
cmake-template ├── CMakeLists.txt └── build └── include └── src └── main.cpp 1. CMakeList基础15例 # 设置CMake的最低版本要求 cmake_minimum_required(VERSION 3.15) # 设置项目名称和版本 project(MyProject VERSION 1.0 DESCRIPTION &#34;An example project with CMake&#34;) # 选项，可以通过-D在命令行定义 option(USE_CUSTOM_LIBRARY &#34;Use a custom library&#34; ON) # 定义条件预处理器宏 if(USE_CUSTOM_LIBRARY) add_definitions(-DUSE_CUSTOM_LIB) endif() # 寻找外部依赖包 find_package(Threads REQUIRED) # 指定头文件的搜索路径 include_directories(${PROJECT_SOURCE_DIR}/include) # 指定库文件搜索路径 link_directories(${PROJECT_SOURCE_DIR}/libs) # 添加子目录，这些目录下也应该有自己的CMakeLists.txt add_subdirectory(src) add_subdirectory(libs) # 添加一个可执行文件 add_executable(myExecutable src/main.cpp) # 添加一个静态库 add_library(myStaticLib STATIC src/myStaticLib.cpp) # 添加一个动态库 add_library(mySharedLib SHARED src/mySharedLib.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T14:02:52+08:00">
    <meta property="article:modified_time" content="2024-06-26T14:02:52+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CMakeList整理大全</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="h1-0-cmake-">0. CMake应用示例</h2> 
<p>之前我们也整理过<a href="https://hermit.blog.csdn.net/article/details/129301527" rel="nofollow" title="cmake 引入第三方库（头文件目录、库目录、库文件）">cmake 引入第三方库（头文件目录、库目录、库文件）</a>。但是这里面整理的内容其实是不全的。所以我们需要进一步将CMake的使用整理好。以供后面的学习的工程师来检索查询。</p> 
<pre><code>cmake-template
├── CMakeLists.txt
└── build
└── include
└── src
     └── main.cpp
</code></pre> 
<h2 id="h1-1-cmakelist-15-">1. CMakeList基础15例</h2> 
<pre><code># 设置CMake的最低版本要求
cmake_minimum_required(VERSION 3.15)

# 设置项目名称和版本
project(MyProject VERSION 1.0 DESCRIPTION "An example project with CMake")

# 选项，可以通过-D在命令行定义
option(USE_CUSTOM_LIBRARY "Use a custom library" ON)

# 定义条件预处理器宏
if(USE_CUSTOM_LIBRARY)
    add_definitions(-DUSE_CUSTOM_LIB)
endif()

# 寻找外部依赖包
find_package(Threads REQUIRED)

# 指定头文件的搜索路径
include_directories(${PROJECT_SOURCE_DIR}/include)

# 指定库文件搜索路径
link_directories(${PROJECT_SOURCE_DIR}/libs)

# 添加子目录，这些目录下也应该有自己的CMakeLists.txt
add_subdirectory(src)
add_subdirectory(libs)

# 添加一个可执行文件
add_executable(myExecutable src/main.cpp)

# 添加一个静态库
add_library(myStaticLib STATIC src/myStaticLib.cpp)

# 添加一个动态库
add_library(mySharedLib SHARED src/mySharedLib.cpp)

# 设置静态库和动态库的属性
set_target_properties(myStaticLib PROPERTIES
    ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/static_lib"
)
set_target_properties(mySharedLib PROPERTIES
    LIBRARY_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/shared_lib"
    VERSION ${PROJECT_VERSION}
)

# 设置可执行文件的属性
set_target_properties(myExecutable PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_BINARY_DIR}/bin"
    OUTPUT_NAME "myExecutableFinal"
)

# 指定链接库
target_link_libraries(myExecutable PRIVATE myStaticLib mySharedLib Threads::Threads)

# 安装规则
install(TARGETS myExecutable myStaticLib mySharedLib
    RUNTIME DESTINATION bin
    LIBRARY DESTINATION lib
    ARCHIVE DESTINATION lib/static
)

# 包含目录
target_include_directories(myExecutable PRIVATE ${PROJECT_SOURCE_DIR}/include)

# 自定义命令和依赖
add_custom_target(run
    COMMAND myExecutable
)
add_dependencies(run myExecutable)

# 宏定义，用于打印消息
macro(print_details)
    message("Project details: ${PROJECT_NAME} version ${PROJECT_VERSION}")
endmacro()
print_details()

# 文件操作示例
file(GLOB_RECURSE MY_SOURCES "src/*.cpp")
target_sources(myExecutable PRIVATE ${MY_SOURCES})

# 配置文件生成
configure_file(config.h.in ${CMAKE_BINARY_DIR}/config.h)

# 源文件目录搜索
aux_source_directory(. DIR_SRCS)
add_executable(myProgram ${DIR_SRCS})

# 添加目录，引入其他项目
add_subdirectory(external)

# 自定义目标，不产生输出文件
add_custom_target(CustomCommand ALL
    COMMAND echo "Executing a custom command"
    COMMENT "This is a custom build step"
)

# 文件复制命令
file(COPY ${CMAKE_SOURCE_DIR}/data.txt DESTINATION ${CMAKE_BINARY_DIR})
</code></pre> 
<h4 id="h3-1-1-cmake_minimum_required">1.1 cmake_minimum_required</h4> 
<p>制定CMake的最小版本。它确保了 CMake 的特定版本或更高版本的特性能够被利用，并且保证了在旧版本的 CMake 中可能导致未知行为的特性不会被误用。</p> 
<p>基本语法：</p> 
<pre><code>cmake_minimum_required(VERSION major.minor[.patch][.tweak] [FATAL_ERROR])
</code></pre> 
<ul><li><code>VERSION</code> 关键字后面跟着所需的最低版本号。</li><li><code>FATAL_ERROR</code> 是一个可选的参数，它在 CMake 的老版本中是必需的，如果用户使用的是比指定的 VERSION 更老的 CMake 版本，CMake 会报告一个致命错误并停止处理。在新版本的 CMake 中，默认情况下，如果版本不满足要求，CMake 就会报错并停止。</li></ul> 
<h4 id="h3-1-2-project">1.2 project</h4> 
<p>声明项目的名称和版本，并可选择指定支持的编程语言.此指令通常位于<code>CMakeLists.txt</code>文件的顶部，紧跟在<code>cmake_minimum_required</code>指令之后。</p> 
<p>基本语法：</p> 
<pre><code>project(&lt;PROJECT-NAME&gt; [VERSION &lt;major&gt;[.&lt;minor&gt;[.&lt;patch&gt;[.&lt;tweak&gt;]]]]
                 [DESCRIPTION &lt;project-description-string&gt;]
                 [HOMEPAGE_URL &lt;url-string&gt;]
                 [LANGUAGES &lt;language-name&gt;...])
</code></pre> 
<ul><li><code>&lt;PROJECT-NAME&gt;</code> 是你的项目名称。</li><li><code>VERSION</code> 关键字后面可以跟随项目的版本号。</li><li><code>DESCRIPTION</code>可以添加项目描述。</li><li><code>HOMEPAGE_URL</code>可以指定项目主页的URL。</li><li><code>LANGUAGES</code>关键字后面可以跟一系列编程语言名称，例如 C, CXX (代表C++)，CUDA，Fortran 等。如果不指定语言，CMake默认启用 C 和 CXX。</li></ul> 
<h4 id="h3-1-3-">1.3 $$</h4> 
<p>CMake中的美元符号与括号一起使用，形如<code>{...}</code>，用于引用变量的值。最常用的就是和project联系起来，例如：</p> 
<p>基本语法：</p> 
<pre><code># 设置项目名称和版本
project(MyProject VERSION 1.2.3 LANGUAGES CXX)
set(MY_VARIABLE "Hello, World")

message("Project name: ${PROJECT_NAME}")
message("Project version: ${PROJECT_VERSION}")
message(${MY_VARIABLE})
</code></pre> 
<p>$${MY_VARIABLE} 会被 CMake 替换为变量 MY_VARIABLE 的值.而<code>project</code> 指令将会创建一些变量，比如 <code>PROJECT_NAME</code>，<code>PROJECT_VERSION</code> 等，这些变量随后可以被引用。</p> 
<h4 id="h3-1-4-set">1.4 set</h4> 
<p>在CMake中，<code>set</code>命令用于定义和修改变量。这个命令非常灵活，是CMake脚本中用得最频繁的指令之一，因为它可以用来存储各种类型的数据，如字符串、文件路径、列表（即字符串数组）、布尔值等。</p> 
<p>基本语法：</p> 
<pre><code>set(&lt;variable&gt; &lt;value&gt; [CACHE &lt;type&gt; &lt;docstring&gt; [FORCE]])
</code></pre> 
<p><code>&lt;variable&gt;</code> 是你要设置的变量名。<br><code>&lt;value&gt;</code> 是分配给变量的值。可以是一个或多个值（如果是多个值，它们会被视为一个列表）。<br><code>CACHE</code> 选项用于将变量存储到CMake的缓存中，这对于可配置的选项很有用，因为它们在不同的构建中保持不变，除非被用户或者项目脚本修改。<br><code>&lt;type&gt;</code> 指定缓存中的变量类型，如STRING、BOOL等。<br><code>&lt;docstring&gt;</code> 是对变量的描述，通常出现在CMake GUI中。<br><code>FORCE</code> 用于强制覆盖缓存中的值，即使用户已经设置了该值。</p> 
<p>在 CMake 中，<code>set</code> 指令用于设置变量的值。它的基本语法如下：</p> 
<pre><code>set(my_variable "Hello, World!")
</code></pre> 
<ol><li>设置一个列表变量：</li></ol> 
<pre><code>set(my_list 1 2 3 4 5)
</code></pre> 
<ol><li>设置一个缓存变量：</li></ol> 
<pre><code>set(my_cached_variable  Release CACHE STRING "Set C++ Compiler Flags" FORCE) # Release or Debug

# 取消缓存条目
unset(&lt;variable&gt; CACHE)
</code></pre> 
<p><code>CMakeCache.txt</code>文件用于存储缓存条目，第一次构建时会生成该文件，之后的构建并不会创建该文件。在引用缓存条目时，会去查找该文件，并返回值。</p> 
<p>在使用 <code>set()</code>命令时，默认情况下，如果缓存条目在 <code>CMakeCache.txt</code> 文件不存在，会创建缓存条目，并写入到 <code>CMakeCache.txt</code>文件中。如果缓存条目在 <code>CMakeCache.txt</code>文件存在，忽略 <code>set()</code> 命令，不会覆盖现有的缓存条目。但是我们想强制覆盖现有的缓存条目，我们可以 <code>FORCE</code> 选项。</p> 
<ol><li>强制设置一个缓存变量：</li></ol> 
<pre><code>set(my_cached_variable "Another value" CACHE STRING "Description of my_cached_variable" FORCE)
</code></pre> 
<p>以上是 <code>set</code> 指令的基本语法和使用示例，你可以根据具体的需求设置不同类型的变量，如普通变量、列表变量或者缓存变量。</p> 
<h4 id="h3-1-5-option">1.5 option</h4> 
<p>在 CMake 中，<code>option</code> 指令用于定义一个布尔类型的选项，这个选项可以用来控制编译过程中的一些行为或特性。基本语法如下：</p> 
<p>基本语法：</p> 
<pre><code>option(&lt;option_variable&gt; "&lt;help_string&gt;" [initial_value])
</code></pre> 
<p>其中：</p> 
<ul><li><code>&lt;option_variable&gt;</code> 是要定义的选项的变量名。</li><li><code>"&lt;help_string&gt;"</code> 是对选项的描述，会显示在 CMake GUI 或者命令行帮助信息中。</li><li><code>[initial_value]</code> 是选项的初始值，可选，默认为 <code>OFF</code>。</li></ul> 
<p>下面是定义一个开关选项，表示是否启用某个特性：</p> 
<pre><code>option(ENABLE_FEATURE "Enable some feature" ON)
</code></pre> 
<h4 id="h3-1-6-add_definitions">1.6 add_definitions</h4> 
<p>在 CMake 中，<code>add_definitions</code> 指令用于向编译器添加预定义的宏定义。这些宏定义将在编译源文件时起作用。基本语法如下：</p> 
<pre><code>add_definitions(-D&lt;macro1&gt; [-D&lt;macro2&gt;] ...)
</code></pre> 
<p>其中：</p> 
<ul><li><code>-D&lt;macro&gt;</code> 表示要定义的宏，<code>-D</code> 后跟着宏的名称。如果宏需要带有值，则可以使用等号（<code>=</code>）将宏名称与值分隔开。</li></ul> 
<p>下面是一些 <code>add_definitions</code> 指令的使用示例：</p> 
<ol><li>定义一个简单的宏：</li></ol> 
<pre><code>add_definitions(-DENABLE_LOGGING)
</code></pre> 
<ol><li>定义一个带有值的宏：</li></ol> 
<pre><code>add_definitions(-DDEBUG_LEVEL=2)
</code></pre> 
<ol><li>定义多个宏：</li></ol> 
<pre><code>add_definitions(-DENABLE_FEATURE_A -DENABLE_FEATURE_B)
</code></pre> 
<p>通过 <code>add_definitions</code> 可以向编译器传递预定义的宏，这些宏在编译源文件时将起到作用。需要注意的是，使用 <code>add_definitions</code> 添加的宏定义将应用于整个项目中的所有源文件。</p> 
<h4 id="h3-1-7-find_package">1.7 find_package</h4> 
<p>当使用 <code>find_package</code> 时，你需要指定要查找的软件包的名称，并可能需要提供版本信息和一些其他选项。以下是 <code>find_package</code> 的基本语法和详细使用例子：</p> 
<p>基本语法：</p> 
<pre><code>find_package(&lt;package_name&gt; [version] [EXACT] [QUIET] [MODULE] [REQUIRED]
             [COMPONENTS [components...]]
             [OPTIONAL_COMPONENTS components...]
             [NO_POLICY_SCOPE])
</code></pre> 
<p>参数说明：</p> 
<ul><li><code>&lt;package_name&gt;</code>: 要查找的软件包的名称。</li><li><code>version</code>: 可选参数，用于指定软件包的版本。</li><li><code>EXACT</code>: 可选参数，要求找到的软件包的版本必须与指定的版本完全匹配。</li><li><code>QUIET</code>: 可选参数，如果找不到软件包不会产生错误消息。</li><li><code>MODULE</code>: 可选参数，表示要查找的软件包是一个模块文件而不是一个软件包。</li><li><code>REQUIRED</code>: 可选参数，表示找不到软件包时会产生错误消息并停止配置过程。</li><li><code>COMPONENTS [components...]</code>: 可选参数，用于指定软件包的组件。</li><li><code>OPTIONAL_COMPONENTS components...</code>: 可选参数，用于指定可选的软件包组件。</li><li><code>NO_POLICY_SCOPE</code>: 可选参数，指示 CMake 不要修改 CMake 策略。</li></ul> 
<p>使用例子：</p> 
<p>点击<a href="https://www.guyuehome.com/46742" rel="nofollow" title="CMakeList整理大全 - 古月居 (guyuehome.com)">CMakeList整理大全 - 古月居 (guyuehome.com)</a>可查看全文</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e0ad5c1147ab7abf3fd2b4776f6a6333/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pd虚拟机 Parallels Desktop 19 for Mac 破解版小白安装使用指南</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae687a2cd4c9182995c4e980c01dd626/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">秋招Java后端开发冲刺——非关系型数据库篇（MongoDB）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>