<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络服务综合项目（一键部署shell脚本） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/79129bf8167e434754d9a81f962e3fac/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="网络服务综合项目（一键部署shell脚本）">
  <meta property="og:description" content="需求： 主机环境描述 主机名主机地址需要提供的服务content.exam.com172.25.250.101提供基于 httpd/nginx 的 YUM仓库服务ntp.exam.com172.25.250.102提供基于Chronyd 的 NTP 服务mysql.exam.com172.25.250.103提供基于 MySQL 的数据库服务nfs.example.com172.25.250.104提供基于 NFS 的网络文件系统服务dns.exam.com 172.25.250.105提供基于 bind 的 DNS 服务bbs.exam.com172.25.250.106提供基于 Discuz 的论坛服务 注意： 172.25.250.101-172.25.250.105 共 5 个 IP 地址由servera.exam.com服务器进行提供。 172.25.250.106 由 serverb.exam.com 服务器进行提供。
项目需求：
1. 172.25.250.101 主机上的 Web 服务要求提供 www.exam.com Web站点，该站点在任何路由可达 的主机上被访问，页面内容显示为 &#34;Hello，Welcome to www.exam.com !&#34;，并提供 content.exam.com/yum/AppStream和content.exam.com/yum/BaseOS URL 作为网络仓库供所 有主机使用。
2. 172.25.250.102 主机提供基于Chronyd 的 NTP 服务将本主机作为时间服务器，对外提供 NTP 服 务，并设置本服务器为 3 层。
3. 172.25.250.103 主机提供的MySQL 数据库服务，要求使用需求1中提供的仓库进行安装，并将数据 库密码设定为 redhat。创建名称为 bbs 的数据库提供给论坛服务使用。
4. 172.25.250.104 主机提供 NFS 服务，该服务将导出本地的 /bbs 目录作为论坛数据目录，该导出指 定只能论坛所在主机使用，并且开机自动挂载。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-25T10:52:20+08:00">
    <meta property="article:modified_time" content="2024-07-25T10:52:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络服务综合项目（一键部署shell脚本）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>需求：</h2> 
<p><img alt="" height="583" src="https://images2.imgbox.com/d0/72/3fuFungm_o.png" width="897"></p> 
<h3>主机环境描述</h3> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td>主机名</td><td style="width:159px;">主机地址</td><td style="width:158px;">需要提供的服务</td></tr><tr><td>content.exam.com</td><td style="width:159px;">172.25.250.101</td><td style="width:158px;">提供基于 httpd/nginx 的 YUM仓库服务</td></tr><tr><td>ntp.exam.com</td><td style="width:159px;">172.25.250.102</td><td style="width:158px;">提供基于Chronyd 的 NTP 服务</td></tr><tr><td>mysql.exam.com</td><td style="width:159px;">172.25.250.103</td><td style="width:158px;">提供基于 MySQL 的数据库服务</td></tr><tr><td>nfs.example.com</td><td style="width:159px;">172.25.250.104</td><td style="width:158px;">提供基于 NFS 的网络文件系统服务</td></tr><tr><td>dns.exam.com </td><td style="width:159px;">172.25.250.105</td><td style="width:158px;">提供基于 bind 的 DNS 服务</td></tr><tr><td>bbs.exam.com</td><td style="width:159px;">172.25.250.106</td><td style="width:158px;">提供基于 Discuz 的论坛服务</td></tr></tbody></table> 
<p></p> 
<h3>注意：</h3> 
<p>172.25.250.101-172.25.250.105 共 5 个 IP 地址由servera.exam.com服务器进行提供。 172.25.250.106 由 serverb.exam.com 服务器进行提供。</p> 
<p>项目需求：</p> 
<p>1. 172.25.250.101 主机上的 Web 服务要求提供 www.exam.com Web站点，该站点在任何路由可达 的主机上被访问，页面内容显示为 "Hello，Welcome to www.exam.com !"，并提供 content.exam.com/yum/AppStream和content.exam.com/yum/BaseOS URL 作为网络仓库供所 有主机使用。</p> 
<p>2. 172.25.250.102 主机提供基于Chronyd 的 NTP 服务将本主机作为时间服务器，对外提供 NTP 服 务，并设置本服务器为 3 层。</p> 
<p>3. 172.25.250.103 主机提供的MySQL 数据库服务，要求使用需求1中提供的仓库进行安装，并将数据 库密码设定为 redhat。创建名称为 bbs 的数据库提供给论坛服务使用。</p> 
<p>4. 172.25.250.104 主机提供 NFS 服务，该服务将导出本地的 /bbs 目录作为论坛数据目录，该导出指 定只能论坛所在主机使用，并且开机自动挂载。</p> 
<p>5. 172.25.250.105 主机提供 DNS 服务，该服务需要提供对项目中所有主机名的正向和反向解析，并 要求所有服务器的 DNS 配置为该 DNS 服务器。</p> 
<p>6. 172.25.250.106 主机提供基于 Discuz 的论坛服务，该论坛服务使用 172.25.250.103 主机提供的数 据库 bbs，使用 172.25.250.104 主机提供的 NFS 作为论坛数据目录，并开机挂载。并使用 172.25.250.101 主机提供的网络仓库，172.25.250.102 主机提供的 NTP 服务，172.25.250.105 主 机提供的 DNS 服务。</p> 
<p>7. 所有服务器的防火墙服务和 SELinux 服务必须开启。</p> 
<p>8. 所有服务器提供的网络服务必须在系统重启后仍然可以正常提供服务。</p> 
<p>9. 根据所有服务的相关代码，编写一键部署shell脚本，最基础的功能为 通过执行该脚本实现所有上面 所有需求，要求脚本必须在 servera.exam.com 主机上运行，并支持多次运行</p> 
<p>本代码需要手动配置IP和免密登录</p> 
<h2></h2> 
<h2>代码讲解</h2> 
<h3>配置本地仓库</h3> 
<blockquote> 
 <p>ls /etc/yum.repos.d/ | grep rpm.repo &amp;&gt; /dev/null<br> if [ $? = 0 ];then<br>     echo "已有本地仓库"<br> else<br>     echo "[baseos]<br> name=baseos<br> baseurl=/www/yum/BaseOS<br> gpgcheck=0<br> [baseos1]<br> nmae=baseos<br> baseurl=/www/yum/AppStream<br> gpgcheck=0"&gt;&gt;/etc/yum.repos.d/rpm.repo<br>     echo "本地仓库完成"<br> fi</p> 
</blockquote> 
<p><img alt="" height="692" src="https://images2.imgbox.com/ef/46/6vlfauXw_o.png" width="1121"></p> 
<h3>安装软件包</h3> 
<p>（使用命令安装后，进行判断，如果返回值为0，就说明安装成功）</p> 
<blockquote> 
 <pre># 安装所需软件包
​
yum install -y php* unzip httpd chrony nfs-utils bind vim  autofs &gt; /dev/null 2&gt;&amp;1
​
if [ $? -eq 0 ]; then
    echo "软件安装成功"
else
    echo "软件安装失败"
fi
​
​
#106安装软件
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
yum install -y php* unzip httpd chrony nfs-utils bind vim  autofs &gt; /dev/null 2&gt;&amp;1
EOF1
echo "106软件安装成功"</pre> 
</blockquote> 
<p> <img alt="" height="600" src="https://images2.imgbox.com/10/61/b61CSYQM_o.png" width="1200"></p> 
<h3>配置防火墙</h3> 
<p>将所有会使用到的服务全部进行防火墙放行</p> 
<blockquote> 
 <pre># 配置防火墙规则
firewall-cmd  --permanent  --add-service=http     &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=dns      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=nfs      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=mountd           &gt; /dev/null 4&gt;&amp;1
firewall-cmd  --permanent  --add-service=rpc-bind         &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent --add-service=mysql     &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent --add-service=ntp     &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --reload            &gt; /dev/null 2&gt;&amp;1
if [ $? -eq 0 ]; then
    echo "防火墙已放行"
else
    echo "防火墙放行操作失败"
fi
​
# 配置106防火墙规则
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
firewall-cmd  --permanent  --add-service=http     &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=dns      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=nfs      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=mountd           &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=rpc-bind         &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent --add-service=mysql      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent --add-service=ntp   &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --reload            &gt; /dev/null 2&gt;&amp;1
EOF1
echo "106防火墙已放行"
​</pre> 
</blockquote> 
<p><img alt="" height="927" src="https://images2.imgbox.com/9d/c2/TNmAUtdW_o.png" width="1200"></p> 
<h3>配置策略中的一个布尔值</h3> 
<p>允许 httpd连接到数据库。</p> 
<blockquote> 
 <pre># 配置 SELinux布尔值
setsebool -P httpd_use_nfs 1
setsebool -P httpd_can_network_connect_db 1
​
# 配置106 SELinux布尔值
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
setsebool -P httpd_use_nfs 1
setsebool -P httpd_can_network_connect_db 1
EOF1
​</pre> 
</blockquote> 
<p><img alt="" height="349" src="https://images2.imgbox.com/66/e3/I8182Px8_o.png" width="1120"></p> 
<h3>配置web服务</h3> 
<ol><li> <p>首先向 <code>/etc/httpd/conf.d/vhost.conf</code> 文件中写入一些配置信息。</p> </li><li> <p>创建 <code>/www/exam/</code> 目录，并创建 <code>index.html</code> 文件，写入网页的内容。</p> </li><li> <p>修改 <code>index.html</code> 文件的 SELinux 上下文类型。</p> </li><li> <p>备份 <code>/etc/hosts</code> 文件，然后在原内容基础上添加新的主机名和 IP 地址的映射。</p> </li><li> <p>启用 <code>httpd</code> 服务并重启。</p> </li><li> <p>最后使用 <code>curl</code> 命令访问配置的网站，并根据返回的内容判断 Web 服务配置是否成功。</p> </li></ol> 
<blockquote> 
 <pre># 配置Web 服务
echo "&lt;Directory /www &gt;" &gt; /etc/httpd/conf.d/vhost.conf
echo "AllowOverride None" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "Require all granted" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;/Directory&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;VirtualHost 172.25.250.101:80&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "DocumentRoot /www/exam" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "ServerName www.exam.com" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;/VirtualHost&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf
​
mkdir -p /www/exam/ &gt; /dev/null  2&gt;&amp;1
touch /www/exam/index.html
echo "Hello,Welcome to www.exam.com!" &gt;  /www/exam/index.html
​
chcon -t httpd_sys_content_t /www/exam/index.html -R
​
cp /etc/hosts /etc/hosts.bak
original_content=$(cat /etc/hosts)
​
                                        # 拼接新的内容
new_content="$original_content          
172.25.250.101 www.exam.com
172.25.250.101 content.exam.com"
​
                                        # 将新内容写入文件
echo "$new_content" &gt; /etc/hosts
​
systemctl enable httpd  &gt; /dev/null  2&gt;&amp;1
systemctl restart httpd
​
result=$(curl -s "www.exam.com")
​
if [[ $result == *"Hello,Welcome to www.exam.com!"* ]]; then
    echo "web 服务配置成功"
else
    echo "web 服务配置失败"
fi
​</pre> 
</blockquote> 
<p><img alt="" height="1105" src="https://images2.imgbox.com/3d/7a/eitnuzL3_o.png" width="1014"></p> 
<h3>配置网络仓库</h3> 
<ol><li> <p>首先对本地的 <code>/etc/yum.repos.d/rpm.repo</code> 文件进行备份，然后清空其内容，并写入新的仓库配置信息。</p> </li><li> <p>创建相关目录，并尝试挂载设备。</p> </li><li> <p>通过 <code>yum repolist</code> 命令测试本地仓库配置是否成功，并给出相应的提示。</p> </li><li> <p>使用 <code>ssh</code> 命令在远程主机 <code>172.25.250.106</code> 上执行类似的仓库配置操作。</p> </li></ol> 
<blockquote> 
 <pre>#配置网络仓库
cp /etc/yum.repos.d/rpm.repo /etc/yum.repos.d/rpm.repo.bak      # 备份原文件
&gt; /etc/yum.repos.d/rpm.repo     # 删除原文件内容
​
​
cat &lt;&lt;EOF &gt; /etc/yum.repos.d/rpm.repo
[baseos]
name=baseos
baseurl=http://content.exam.com/yum/BaseOS
gpgcheck=0
​
[appstream]
name=appstream
baseurl=http://content.exam.com/yum/AppStream
gpgcheck=0
EOF
​
mkdir -p /www/exam   &gt; /dev/null  2&gt;&amp;1    # 创建目录
mkdir -p /www/exam/yum
​
mount /dev/sr0 /www/exam/yum   &gt; /dev/null 2&gt;&amp;1   # 执行挂载
​
yum repolist &gt; /dev/null 2&gt;&amp;1   # 测试下载
​
if [ $? -eq 0 ]; then
    echo "网络仓库配置成功"
else
    echo "网络仓库配置失败"
fi
​
#配置主机106的仓库
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF2
cp /etc/yum.repos.d/rpm.repo /etc/yum.repos.d/rpm.repo.bak      # 备份原文件
&gt; /etc/yum.repos.d/rpm.repo     # 删除原文件内容
​
​
echo "[baseos]
name=baseos
baseurl=http://content.exam.com/yum/BaseOS
gpgcheck=0
[appstream]
name=appstream
baseurl=http://content.exam.com/yum/AppStream
gpgcheck=0" &gt; /etc/yum.repos.d/rpm.repo
exit
EOF2
echo "106仓库配置完成"</pre> 
</blockquote> 
<p><img alt="" height="965" src="https://images2.imgbox.com/aa/23/WPWCODGl_o.png" width="1200"></p> 
<h3>配置DNS服务</h3> 
<ol><li> <p>配置主 DNS 服务器（<code>172.25.250.105</code>）的 <code>named.conf</code> 配置文件，指定了监听端口和区域信息。</p> </li><li> <p>分别为正向解析区域 <code>exam.com</code> 和反向解析区域 <code>250.25.172.in-addr.arpa</code> 生成了相应的解析记录文件。</p> </li><li> <p>重启并启用 <code>named</code> 服务。</p> </li><li> <p>对于从 DNS 服务器（<code>172.25.250.106</code>），通过 <code>ssh</code> 远程操作，设置了其 <code>named.conf</code> 配置文件。</p> </li><li> <p>最后通过 <code>dig</code> 命令测试 DNS 服务是否配置成功，并根据结果输出相应的提示。</p> </li></ol> 
<blockquote> 
 <pre># 配置DNS 服务
cat &lt;&lt;EOF &gt; /etc/named.conf
options {
        listen-on port 53 { 172.25.250.105; };
        directory       "/var/named";
};
​
zone "exam.com" IN {
        type master;
        file "named.exam";
};
​
zone "250.25.172.in-addr.arpa" IN {
        type master;
        file "named.fanxiang";
};
EOF
​
cat &lt;&lt;EOF &gt; /var/named/named.exam
\$TTL 1d
@       IN      SOA     @       admin.exam.com. (
                                                0
                                                5
                                                3
                                                10
                                                15 )
        IN      NS      dns.exam.com.
www     IN      A       172.25.250.101
content IN      A       172.25.250.101
ntp     IN      A       172.25.250.102
mysql   IN      A       172.25.250.103
nfs     IN      A       172.25.250.104
dns     IN      A       172.25.250.105
bbs     IN      A       172.25.250.106
EOF
​
cat &lt;&lt;EOF1 &gt; /var/named/named.fanxiang
\$TTL 1d
@       IN      SOA     @       admin.exam.com. (
                                                0
                                                5
                                                3
                                                10
                                                15 )
        IN      NS      dns.exam.com.
101     IN      PTR     content.exam.com.
101     IN      PTR     www.exam.com.
102     IN      PTR     ntp.exam.com.
103     IN      PTR     mysql.exam.com.
104     IN      PTR     nfs.exam.com.
105     IN      PTR     dns.exam.com.
106     IN      PTR     bbs.exam.com.
EOF1
​
systemctl restart named
systemctl enable named          &gt; /dev/null  2&gt;&amp;1
​

result=$(dig -t A www.exam.com )
​
if [[ $result == *"NOERROR"* ]]; then
    echo "DNS服务配置成功"
else
    echo "DNS服务配置失败"
fi</pre> 
</blockquote> 
<p><img alt="" height="898" src="https://images2.imgbox.com/77/31/IZ7xGWCq_o.png" width="647"></p> 
<p><img alt="" height="677" src="https://images2.imgbox.com/1f/39/h6RUp3sW_o.png" width="836"></p> 
<h3>配置NTP服务</h3> 
<ol><li> <p>在主机 <code>172.25.250.102</code> 上： - 使用 <code>sed</code> 命令修改 <code>/etc/chrony.conf</code> 配置文件，允许特定网段（<code>172.25.250.0/24</code>）的访问，设置本地层级为 <code>3</code>，并修改日志相关的配置。 - 重启 <code>chronyd</code> 服务并设置其开机自启。</p> </li><li> <p>在主机 <code>172.25.250.106</code> 上： - 通过 <code>ssh</code> 远程连接，并使用 <code>sed</code> 命令修改 <code>/etc/chrony.conf</code> 配置文件，指定 NTP 服务器为 <code>ntp.exam.com</code> 并设置相关参数。 - 重启 <code>chronyd</code> 服务并设置其开机自启。 - 远程执行 <code>chronyc sources</code> 命令获取结果，并将返回值存储在 <code>result</code> 变量中。</p> </li><li> <p>根据 <code>result</code> 的值判断时间服务器配置是否成功。</p> </li></ol> 
<blockquote> 
 <pre># 配置NTP服务
                #"进入servera中配置NTP服务"     # 配置 172.25.250.102 主机
sed -i '27a\allow 172.25.250.0/24' /etc/chrony.conf
sed -i '30a\local stratum 3' /etc/chrony.conf
sed -i '52c\log measurements statistics tracking' /etc/chrony.conf
​
systemctl restart chronyd
systemctl enable chronyd &gt; /dev/null  2&gt;&amp;1
​
                #"进入serverb中配置NTP服务"     # 配置 172.25.250.106 主机
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt; EOF1
sed -i '3c\server ntp.exam.com iburst' /etc/chrony.conf
systemctl restart chronyd
systemctl enable chronyd        &gt; /dev/null  2&gt;&amp;1
exit
EOF1
​
ssh root@172.25.250.106  &amp;&gt;&gt; /dev/null "chronyc sources"
result=$?
​
if [ $? = 0 ];then
        echo "Chronyd服务成功运行"
else
        echo "NTP已配置，无需重复配置"
fi
EOF1
​</pre> 
</blockquote> 
<p><img alt="" height="928" src="https://images2.imgbox.com/49/b8/41BwKNJE_o.png" width="1200"></p> 
<h3>配置MySQL服务</h3> 
<ol><li> <p>首先使用 <code>yum</code> 命令安装 <code>mysql-server</code>，并将安装过程中的输出重定向到 <code>/dev/null</code> 以隐藏输出。</p> </li><li> <p>启动 MySQL 服务。</p> </li><li> <p>以 root 用户登录 MySQL 执行一系列操作，包括修改 root 用户在本地的密码、创建数据库 <code>bbs</code>、更新 root 用户的主机权限以及刷新权限。</p> </li><li> <p>启用 MySQL 服务并重启。</p> </li><li> <p>通过 SSH 免密登录到 <code>172.25.250.106</code> 执行相同的安装、启用和重启 MySQL 服务的操作。</p> </li><li> <p>最后通过检查 <code>result</code> 变量是否有值来判断 MySQL 服务配置是否成功。</p> </li></ol> 
<blockquote> 
 <pre># 配置MySQL 服务
yum install mysql-server -y &gt; /dev/null 2&gt;&amp;1    # 执行 yum 安装命令，并将输出重定向到黑洞
​
systemctl start mysqld  #启动MySQL服务
​
mysql  &amp;&gt;&gt; /dev/null &lt;&lt; EOF2
alter user 'root'@'localhost' identified with mysql_native_password by 'redhat' ;
create database bbs;
update mysql.user set host='%' where user='root';
flush privileges;
EOF2
​
systemctl enable mysqld &gt; /dev/null  2&gt;&amp;1
systemctl restart mysqld
                                                # 通过 SSH 免密登录到 172.25.250.106 进行操作
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF3
        yum install mysql-server -y &amp;&gt;&gt; /dev/null
systemctl enable mysqld &gt; /dev/null  2&gt;&amp;1
systemctl restart mysqld
​
EOF3
if [ $? = 0 ]; then
    echo "MySQL服务配置成功"
else
    echo "MySQL服务配置失败"
fi
​
systemctl enable mysqld
systemctl start mysqld
​</pre> 
</blockquote> 
<p><img alt="" height="864" src="https://images2.imgbox.com/ae/9f/OfNWY2gP_o.png" width="1200"></p> 
<h3>配置NFS服务</h3> 
<ol><li> <p>在 <code>172.25.250.104</code> 主机上：</p> 
  <ul><li> <p>创建 <code>/bbs</code> 目录并设置权限。</p> </li><li> <p>配置 <code>/etc/exports</code> 文件以共享 <code>/bbs</code> 目录。</p> </li><li> <p>启动 NFS 服务。</p> </li><li> <p>检查 <code>/etc/fstab</code> 中是否有关于 <code>/dev/sr0</code> 的挂载配置，如果没有则添加。</p> </li></ul></li><li> <p>在 <code>172.25.250.106</code> 主机上：</p> 
  <ul><li> <p>通过 <code>ssh</code> 远程执行一系列操作，创建一个脚本 <code>xixi.sh</code> 用于检查并配置自动挂载相关的文件，然后执行该脚本，重启并启用 <code>autofs</code> 服务。</p> </li></ul></li></ol> 
<blockquote> 
 <pre># 配置 172.25.250.104 主机的 NFS 服务
mkdir /bbs &amp;&gt;&gt; /dev/null
chmod 777 /bbs/
echo "/bbs    bbs.exam.com(rw)" &gt; /etc/exports
systemctl start nfs-server      # 启动 NFS 服务
​
#设置开机自动挂载
grep ^\/dev\/sr0 /etc/fstab &amp;&gt;&gt; /dev/null
if [ $? == 1 ]
then
        echo "/dev/sr0  /www/exam/yum   iso9660 defaults        0 0" &gt;&gt; /etc/fstab
fi
echo "开机自动挂载成功"
​
#106主机配置自动挂载
ssh root@172.25.250.106  &amp;&gt;&gt; /dev/null &lt;&lt;EOF2
echo 'grep ^/var/www/html /etc/auto.master &amp;&gt;&gt; /dev/null
        if [ \$? != 0 ]
        then
                echo "/var/www/ /etc/auto.bbs" &gt;&gt; /etc/auto.master
                echo "html nfs.exam.com:/bbs" &gt; /etc/auto.bbs
        fi' &gt; xixi.sh
        bash xixi.sh
systemctl restart autofs
systemctl enable --now autofs
EOF2
</pre> 
</blockquote> 
<p><img alt="" height="877" src="https://images2.imgbox.com/96/b2/k5nAkb3d_o.png" width="1200"></p> 
<h3>配置论坛服务</h3> 
<ol><li> <p>安装 <code>httpd</code> 和 <code>php</code> 相关的软件包。</p> </li><li> <p>将 <code>Discuz_X3.5_SC_UTF8_20230520.zip</code> 复制到 <code>/var/www/html</code> 目录。</p> </li><li> <p>进入该目录并解压压缩包。</p> </li><li> <p>进入特定目录并修改相关目录的权限。</p> </li><li> <p>设置 <code>httpd</code> 的相关 SELinux 布尔值，以允许特定的操作。</p> </li><li> <p>启动、启用并重启 <code>httpd</code> 服务。</p> </li></ol> 
<blockquote> 
 <pre>#搭建论坛服务器
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt; EOF1
cp Discuz_X3.5_SC_UTF8_20230520.zip /var/www/html
cd /var/www/html
unzip Discuz_X3.5_SC_UTF8_20230520.zip &amp;&gt;&gt; /dev/null
cd /var/www/html/upload
chmod 777 data/ uc_server/ uc_client/ config/ -R
​
setsebool -P httpd_use_nfs 1
systemctl start --now httpd
systemctl enable --now httpd
systemctl restart httpd
EOF1
echo "论坛配置完成"</pre> 
</blockquote> 
<p><img alt="" height="780" src="https://images2.imgbox.com/be/c5/nDwIs6Kt_o.png" width="1200"></p> 
<h2>完整版代码</h2> 
<pre><code>#!/bin/bash

#ip
nmcli connection modify ens160 ipv4.method manual ipv4.address 172.25.250.101/24 ipv4.gateway 172.25.250.2  ipv4.dns 172.25.250.105	
nmcli connection modify ens160 +ipv4.addresses 172.25.250.102/24
nmcli connection modify ens160 +ipv4.addresses 172.25.250.103/24
nmcli connection modify ens160 +ipv4.addresses 172.25.250.104/24
nmcli connection modify ens160 +ipv4.addresses 172.25.250.105/24
nmcli c up ens160 &amp;&gt;&gt; /dev/null
if [ $? -eq 0 ]; then
    echo "网络配置成功"
else
    echo "网络配置失败"
fi

#
ls /etc/yum.repos.d/ | grep rpm.repo &amp;&gt; /dev/null
if [ $? = 0 ];then
	echo "已有本地仓库"
else
	echo "[baseos]
name=baseos
baseurl=/www/yum/BaseOS
gpgcheck=0
[baseos1]
nmae=baseos
baseurl=/www/yum/AppStream
gpgcheck=0"&gt;&gt;/etc/yum.repos.d/rpm.repo
	echo "本地仓库完成"
fi

# 安装所需软件包

yum install -y  php php-mysqlnd unzip httpd chrony nfs-utils bind vim  autofs &gt; /dev/null 2&gt;&amp;1

if [ $? -eq 0 ]; then
    echo "软件安装成功"
else
    echo "软件安装失败"
fi


#106安装软件
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
yum install -y  php php-mysqlnd unzip httpd chrony nfs-utils bind vim  autofs &gt; /dev/null 2&gt;&amp;1
EOF1
echo "106软件安装成功"

# 配置防火墙规则
firewall-cmd  --permanent  --add-service=http	  &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=dns  	  &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=nfs	  &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=mountd		  &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=rpc-bind	  &gt; /dev/null 2&gt;&amp;1
firewall-cmd --permanent --add-service=mysql	  &gt; /dev/null 2&gt;&amp;1
firewall-cmd --permanent --add-service=ntp 	&gt; /dev/null 2&gt;&amp;1
firewall-cmd  --reload		  &gt; /dev/null 2&gt;&amp;1
if [ $? -eq 0 ]; then
    echo "防火墙已放行"
else
    echo "防火墙放行操作失败"
fi

# 配置106防火墙规则
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
firewall-cmd  --permanent  --add-service=http     &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=dns      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=nfs      &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=mountd           &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --permanent  --add-service=rpc-bind         &gt; /dev/null 2&gt;&amp;1
firewall-cmd --permanent --add-service=mysql      &gt; /dev/null 2&gt;&amp;1
firewall-cmd --permanent --add-service=ntp   &gt; /dev/null 2&gt;&amp;1
firewall-cmd  --reload            &gt; /dev/null 2&gt;&amp;1
EOF1
echo "106防火墙已放行"

# 配置 SELinux
setsebool -P httpd_can_network_connect_db 1

# 配置106 SELinux
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF1
etsebool -P httpd_can_network_connect_db 1
EOF1

# 配置Web 服务
echo "&lt;Directory /www &gt;" &gt; /etc/httpd/conf.d/vhost.conf
echo "AllowOverride None" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "Require all granted" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;/Directory&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;VirtualHost 172.25.250.101:80&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "DocumentRoot /www/exam" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "ServerName www.exam.com" &gt;&gt; /etc/httpd/conf.d/vhost.conf
echo "&lt;/VirtualHost&gt;" &gt;&gt; /etc/httpd/conf.d/vhost.conf

mkdir -p /www/exam/ &gt; /dev/null  2&gt;&amp;1
touch /www/exam/index.html
echo "Hello,Welcome to www.exam.com!" &gt;  /www/exam/index.html

chcon -t httpd_sys_content_t /www/exam/index.html -R

cp /etc/hosts /etc/hosts.bak
original_content=$(cat /etc/hosts)

					# 拼接新的内容
new_content="$original_content		
172.25.250.101 www.exam.com
172.25.250.101 content.exam.com"

					# 将新内容写入文件
echo "$new_content" &gt; /etc/hosts

systemctl enable httpd	&gt; /dev/null  2&gt;&amp;1
systemctl restart httpd

result=$(curl -s "www.exam.com")

if [[ $result == *"Hello,Welcome to www.exam.com!"* ]]; then
    echo "web 服务配置成功"
else
    echo "web 服务配置失败"
fi

#配置网络仓库
cp /etc/yum.repos.d/rpm.repo /etc/yum.repos.d/rpm.repo.bak      # 备份原文件
&gt; /etc/yum.repos.d/rpm.repo     # 删除原文件内容


cat &lt;&lt;EOF &gt; /etc/yum.repos.d/rpm.repo
[baseos]
name=baseos
baseurl=http://content.exam.com/yum/BaseOS
gpgcheck=0

[appstream]
name=appstream
baseurl=http://content.exam.com/yum/AppStream
gpgcheck=0
EOF

mkdir -p /www/exam   &gt; /dev/null  2&gt;&amp;1    # 创建目录
mkdir -p /www/exam/yum

mount /dev/sr0 /www/exam/yum   &gt; /dev/null 2&gt;&amp;1   # 执行挂载

yum repolist &gt; /dev/null 2&gt;&amp;1   # 测试下载

if [ $? -eq 0 ]; then
    echo "网络仓库配置成功"
else
    echo "网络仓库配置失败"
fi

#配置主机106的仓库
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF2
ls /etc/yum.repos.d/ | grep rpm.repo &amp;&gt;&gt; /dev/null

if [ $? == 1 ]
then
	touch /etc/yum.repo.d/rpm.repo
fi

echo "[baseos]
name=baseos
baseurl=http://content.exam.com/yum/BaseOS
gpgcheck=0
[appstream]
name=appstream
baseurl=http://content.exam.com/yum/AppStream
gpgcheck=0" &gt; /etc/yum.repos.d/rpm.repo
exit
EOF2
echo "106仓库配置成功"

# 配置DNS 服务
cat &lt;&lt;EOF &gt; /etc/named.conf
options {
        listen-on port 53 { 172.25.250.105; };
        directory       "/var/named";
};

zone "exam.com" IN {
        type master;
        file "named.exam";
};

zone "250.25.172.in-addr.arpa" IN {
	type master;
	file "named.fanxiang";
};
EOF

cat &lt;&lt;EOF &gt; /var/named/named.exam
\$TTL 1d
@       IN      SOA     @       admin.exam.com. (
                                                0
                                                5
                                                3
                                                10
                                                15 )
        IN      NS      dns.exam.com.
www     IN      A       172.25.250.101
content IN      A       172.25.250.101
ntp     IN      A       172.25.250.102
mysql   IN      A       172.25.250.103
nfs     IN      A       172.25.250.104
dns     IN      A       172.25.250.105
bbs     IN      A       172.25.250.106
EOF

cat &lt;&lt;EOF1 &gt; /var/named/named.fanxiang
\$TTL 1d
@       IN      SOA     @       admin.exam.com. (
                                                0
                                                5
                                                3
                                                10
                                                15 )
        IN      NS      dns.exam.com.
101	IN	PTR	content.exam.com.
101	IN	PTR	www.exam.com.
102	IN	PTR	ntp.exam.com.
103	IN	PTR	mysql.exam.com.
104	IN	PTR	nfs.exam.com.
105	IN	PTR	dns.exam.com.
106	IN	PTR	bbs.exam.com.
EOF1

systemctl restart named
systemctl enable named		&gt; /dev/null  2&gt;&amp;1

result=$(dig -t A www.exam.com )

if [[ $result == *"NOERROR"* ]]; then
    echo "DNS服务配置成功"
else
    echo "DNS服务配置失败"
fi

# 配置NTP服务
#echo "进入servera中配置Chrony 服务"	# 配置 172.25.250.102 主机
sed -i '27a\allow 172.25.250.0/24' /etc/chrony.conf
sed -i '30a\local stratum 3' /etc/chrony.conf
sed -i '52c\log measurements statistics tracking' /etc/chrony.conf

systemctl restart chronyd
systemctl enable chronyd &gt; /dev/null  2&gt;&amp;1

#echo "进入serverb中配置Chrony服务"	# 配置 172.25.250.106 主机
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt; EOF1
sed -i '3c\server ntp.exam.com iburst' /etc/chrony.conf
systemctl enable chronyd	&gt; /dev/null  2&gt;&amp;1
systemctl restart chronyd
if [ $? = 0 ];then
        echo "Chronyd服务成功运行"
else
        echo "NTP已配置，无需重复配置"
fi
EOF1

# 配置MySQL 服务
yum install mysql-server -y &gt; /dev/null 2&gt;&amp;1	# 执行 yum 安装命令，并将输出重定向到黑洞

systemctl start mysqld	#启动MySQL服务

mysql  &amp;&gt;&gt; /dev/null &lt;&lt; EOF2
alter user 'root'@'localhost' identified with mysql_native_password by 'redhat' ;
create database bbs;
update mysql.user set host='%' where user='root';
flush privileges;
EOF2

systemctl enable mysqld &gt; /dev/null  2&gt;&amp;1
systemctl restart mysqld
						# 通过 SSH 免密登录到 172.25.250.106 进行操作
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt;EOF3
	yum install mysql-server -y &amp;&gt;&gt; /dev/null
systemctl enable mysqld &gt; /dev/null  2&gt;&amp;1
systemctl restart mysqld

EOF3

if [ $? = 0 ]; then
    echo "MySQL服务配置成功"
else
    echo "MySQL服务配置失败"
fi


systemctl enable mysqld
systemctl restart mysqld


# 配置 172.25.250.104 主机的 NFS 服务
mkdir /bbs &amp;&gt;&gt; /dev/null 
chmod 777 /bbs/
echo "/bbs    bbs.exam.com(rw)" &gt; /etc/exports
systemctl start nfs-server	# 启动 NFS 服务
echo "NFS配置成功"

#设置开机自动挂载
grep ^\/dev\/sr0 /etc/fstab &amp;&gt;&gt; /dev/null
if [ $? == 1 ]
then
	echo "/dev/sr0	/www/exam/yum	iso9660	defaults	0 0" &gt;&gt; /etc/fstab
fi
echo "开机自动挂载成功"

#106主机配置自动挂载
ssh root@172.25.250.106  &amp;&gt;&gt; /dev/null &lt;&lt;EOF2
echo 'grep ^/var/www/html /etc/auto.master &amp;&gt;&gt; /dev/null
	if [ \$? != 0 ]
	then
		echo "/var/www/ /etc/auto.bbs" &gt;&gt; /etc/auto.master
		echo "html nfs.exam.com:/bbs" &gt; /etc/auto.bbs
	fi' &gt; xixi.sh
	bash xixi.sh
systemctl restart autofs
systemctl enable --now autofs
EOF2

#搭建论坛服务器
ssh root@172.25.250.106 &amp;&gt;&gt; /dev/null &lt;&lt; EOF1
yum install httpd php* -y &amp;&gt;&gt; /dev/null
cp Discuz_X3.5_SC_UTF8_20230520.zip /var/www/html
cd /var/www/html
unzip Discuz_X3.5_SC_UTF8_20230520.zip &amp;&gt;&gt; /dev/null
cd /var/www/html/upload
chmod 777 data/ uc_server/ uc_client/ config/ -R

setsebool -P httpd_use_nfs 1
setsebool -P httpd_can_network_connect_db 1
systemctl start --now httpd
systemctl enable --now httpd
systemctl restart httpd
EOF1
echo "论坛配置完成"
</code></pre> 
<pre></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f773f97c3bb3db13f454b5aab12ab436/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OpenCV 图像处理 轮廓检测基本原理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c4f6990bb691127c7de45594338f0470/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">qt表格模型视图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>