<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【机器学习/人工智能】 大作业：手写数字识别系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/cd6da276bf8d4086e524c5a11ebc52e3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【机器学习/人工智能】 大作业：手写数字识别系统">
  <meta property="og:description" content="写在前面 参考的是https://zh.d2l.ai/index.html
代码运行的相关实操移步视频https://www.bilibili.com/video/BV1XP411C7Hs/
一、大作业设计目的与要求 （1）利用所学习的聚类算法完成简单的图像分割系统。
（2）编程并利用相关软件完成大作业测试，得到实验结果。
（3）通过对实验结果的分析得出实验结论，培养学生创新思维和编写实验报告的能力，以及处理一般工程设计技术问题的初步能力及实事求是的科学态度。
（4）利用实验更加直观、方便和易于操作的优势，提高学生学习兴趣，让学生自主发挥设计和实施实验，发挥出学生潜在的积极性和创造性。
（5）通过实验的锻炼，使学生进一步掌握基于卷积神经网络的图像分类问题，也进一步领会学习机器学习知识的重要意义。
二、大作业设计内容 大作业1 :手写数字识别系统。
本项目要求选择机器学习算法设计实现手写数字识别系统。手写数字识别在日常生活中有重要应用，例如汇款单、银行支票的处理，以及邮件的分拣等。手写数字识别通常对精度要求较高，虽然只有10类，但是每个人的字迹不同，要做到精确识别有一定难度。项目的具体要求如下:
(1)使用MNIST手写数字数据集，进行手写数字识别(参考课本P186， 例6.2 )。
(2)选择合适的机器学习算法进行手写数字识别，训练分类模型，要求识别精度尽可能高。
(3)编写简单用户界面，可以加载手写数字图片，并调用算法识别数字。
三、程序开发与运行环境 显卡：NVIDIA显卡，CUDA 11.7。
系统与环境：Windows11操作系统，Anaconda3的base虚拟环境。
IDE：Pycharm Community集成开发环境，Jupyter Notebook
深度学习框架：PyTorch深度学习框架，基于GPU版本。
图形界面框架：PyQt5
四、设计正文 （包括分析与设计思路、各模块流程图、主要算法伪代码等，如有改进或者拓展，请重点用一小节进行说明）
4.1 分析与设计思路与流程图 本次实验任务是使用MNIST手写数据集进行手写数字识别。使用传统的多层感知机等神经网络模型不能很好地解决此类问题，因为这种模型直接读取图像的原始像素，基于图像的原始像素进行分类。然而，图像特征的提取还需要人工设计函数进行提取。所以，卷积神经网络模型可以很好地对图像进行自动的特征提取。
本次大作业使用经典的AlexNet卷积神经网络模型。AlexNet卷积神经网络模型具有以下整体结构：
包含8层变换，包括5层卷积和2层全连接的隐藏层，1个全连接的输出层。其中，第一层的卷积窗口形状为1111，可以支持输入更大的图像。第二层卷积窗口形状减小到55，之后的3层卷积采用33的窗口。在第一、第二、第五个卷积层之后都使用了卷积窗口大小为33、且步幅为2的最大池化。卷积通道数比LeNet大了10倍。在最后一个卷积与池化层后，就是两个输出个数为4096的全连接层，最后输出结果。
1.引入了图像增广、翻转、裁剪等方法，进一步从原始数据集中制作、扩大数据集。
AlexNet流程图如下：
在本实验中，因为运行的是MNIST数据集，所以最后一个全连接层只有10个结点，而非该流程图中的1000。
为了进行图形化的界面展示，还利用PyQt框架设置了前端图形界面。
在训练完成数据集后，将模型写入硬盘文件并保存，以供前端的图形界面调用、读取。
所以，前端的图形界面在初始化过程中，就预先加载好了训练好的模型。用户可以从文件中读入需要识别的手写数字图片，由前端图形界面根据加载好的模型自动给出该手写数字图片的识别结果。所以，本次实验中各个模块的交互逻辑如下图所示。
4.2 主要算法代码 训练模型
import numpy as np # numpy数组库 import math # 数学运算库 import matplotlib.pyplot as plt # 画图库 import torch # torch基础库 import torchvision.datasets as dataset # 公开数据集的下载和管理 import torchvision.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-01T20:45:20+08:00">
    <meta property="article:modified_time" content="2023-09-01T20:45:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【机器学习/人工智能】 大作业：手写数字识别系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>写在前面</h2> 
<p>参考的是<a href="https://zh.d2l.ai/index.html" rel="nofollow">https://zh.d2l.ai/index.html</a><br> 代码运行的相关实操移步视频<a href="https://www.bilibili.com/video/BV1XP411C7Hs/" rel="nofollow">https://www.bilibili.com/video/BV1XP411C7Hs/</a></p> 
<h2><a id="_3"></a>一、大作业设计目的与要求</h2> 
<p>（1）利用所学习的聚类算法完成简单的图像分割系统。<br> （2）编程并利用相关软件完成大作业测试，得到实验结果。<br> （3）通过对实验结果的分析得出实验结论，培养学生创新思维和编写实验报告的能力，以及处理一般工程设计技术问题的初步能力及实事求是的科学态度。<br> （4）利用实验更加直观、方便和易于操作的优势，提高学生学习兴趣，让学生自主发挥设计和实施实验，发挥出学生潜在的积极性和创造性。<br> （5）通过实验的锻炼，使学生进一步掌握基于卷积神经网络的图像分类问题，也进一步领会学习机器学习知识的重要意义。</p> 
<h2><a id="_9"></a>二、大作业设计内容</h2> 
<p>大作业1 :手写数字识别系统。<br> 本项目要求选择机器学习算法设计实现手写数字识别系统。手写数字识别在日常生活中有重要应用，例如汇款单、银行支票的处理，以及邮件的分拣等。手写数字识别通常对精度要求较高，虽然只有10类，但是每个人的字迹不同，要做到精确识别有一定难度。项目的具体要求如下:<br> (1)使用MNIST手写数字数据集，进行手写数字识别(参考课本P186， 例6.2 )。<br> (2)选择合适的机器学习算法进行手写数字识别，训练分类模型，要求识别精度尽可能高。<br> (3)编写简单用户界面，可以加载手写数字图片，并调用算法识别数字。</p> 
<h2><a id="_15"></a>三、程序开发与运行环境</h2> 
<p>显卡：NVIDIA显卡，CUDA 11.7。<br> 系统与环境：Windows11操作系统，Anaconda3的base虚拟环境。<br> IDE：Pycharm Community集成开发环境，Jupyter Notebook<br> 深度学习框架：PyTorch深度学习框架，基于GPU版本。<br> 图形界面框架：PyQt5</p> 
<h2><a id="_21"></a>四、设计正文</h2> 
<p>（包括分析与设计思路、各模块流程图、主要算法伪代码等，如有改进或者拓展，请重点用一小节进行说明）</p> 
<h3><a id="41__23"></a>4.1 分析与设计思路与流程图</h3> 
<p>本次实验任务是使用MNIST手写数据集进行手写数字识别。使用传统的多层感知机等神经网络模型不能很好地解决此类问题，因为这种模型直接读取图像的原始像素，基于图像的原始像素进行分类。然而，图像特征的提取还需要人工设计函数进行提取。所以，卷积神经网络模型可以很好地对图像进行自动的特征提取。<br> 本次大作业使用经典的AlexNet卷积神经网络模型。AlexNet卷积神经网络模型具有以下整体结构：<br> 包含8层变换，包括5层卷积和2层全连接的隐藏层，1个全连接的输出层。其中，第一层的卷积窗口形状为11<em>11，可以支持输入更大的图像。第二层卷积窗口形状减小到5</em>5，之后的3层卷积采用3<em>3的窗口。在第一、第二、第五个卷积层之后都使用了卷积窗口大小为3</em>3、且步幅为2的最大池化。卷积通道数比LeNet大了10倍。在最后一个卷积与池化层后，就是两个输出个数为4096的全连接层，最后输出结果。<br> 1.引入了图像增广、翻转、裁剪等方法，进一步从原始数据集中制作、扩大数据集。<br> AlexNet流程图如下：<br> <img src="https://images2.imgbox.com/12/9e/HYlP9eeC_o.png" alt="在这里插入图片描述"><br> 在本实验中，因为运行的是MNIST数据集，所以最后一个全连接层只有10个结点，而非该流程图中的1000。<br> 为了进行图形化的界面展示，还利用PyQt框架设置了前端图形界面。<br> 在训练完成数据集后，将模型写入硬盘文件并保存，以供前端的图形界面调用、读取。<br> 所以，前端的图形界面在初始化过程中，就预先加载好了训练好的模型。用户可以从文件中读入需要识别的手写数字图片，由前端图形界面根据加载好的模型自动给出该手写数字图片的识别结果。所以，本次实验中各个模块的交互逻辑如下图所示。<br> <img src="https://images2.imgbox.com/57/91/j7ekOlto_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42__35"></a>4.2 主要算法代码</h3> 
<p>训练模型</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np  <span class="token comment"># numpy数组库</span>
<span class="token keyword">import</span> math  <span class="token comment"># 数学运算库</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt  <span class="token comment"># 画图库</span>
<span class="token keyword">import</span> torch  <span class="token comment"># torch基础库</span>
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> dataset  <span class="token comment"># 公开数据集的下载和管理</span>
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms  <span class="token comment"># 公开数据集的预处理库,格式转换</span>
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>utils <span class="token keyword">as</span> utils
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data <span class="token keyword">as</span> data_utils  <span class="token comment"># 对数据集进行分批加载的工具集</span>
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils <span class="token keyword">import</span> data
<span class="token keyword">from</span> d2l <span class="token keyword">import</span> torch <span class="token keyword">as</span> d2l
d2l<span class="token punctuation">.</span>use_svg_display<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
    <span class="token comment"># 这里，我们使用一个11*11的更大窗口来捕捉对象。</span>
    <span class="token comment"># 同时，步幅为4，以减少输出的高度和宽度。</span>
    <span class="token comment"># 另外，输出通道的数目远大于LeNet</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 减小卷积窗口，使用填充为2来使得输入与输出的高和宽一致，且增大输出通道数</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 使用三个连续的卷积层和较小的卷积窗口。</span>
    <span class="token comment"># 除了最后的卷积层，输出通道的数量进一步增加。</span>
    <span class="token comment"># 在前两个卷积层之后，汇聚层不用于减少输入的高度和宽度</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 这里，全连接层的输出数量是LeNet中的好几倍。使用dropout层来减轻过拟合</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">6400</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 最后是输出层。由于这里使用MNIST，所以用类别数为10，而非论文中的1000</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token comment">#随机初值</span>
<span class="token keyword">for</span> layer <span class="token keyword">in</span> net<span class="token punctuation">:</span><span class="token comment">#用随机权重参数初始化CNN</span>
    X<span class="token operator">=</span>layer<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span><span class="token string">'output shape:\t'</span><span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">load_data_mnist</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> resize<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#读取、加载MNIST数据集，并batch</span>
    trans <span class="token operator">=</span> <span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> resize<span class="token punctuation">:</span>
        trans<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>resize<span class="token punctuation">)</span><span class="token punctuation">)</span>
    trans <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span>trans<span class="token punctuation">)</span>
    mnist_train <span class="token operator">=</span> dataset<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>
        root<span class="token operator">=</span><span class="token string">"../data"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>trans<span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    mnist_test <span class="token operator">=</span> dataset<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>
        root<span class="token operator">=</span><span class="token string">"../data"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>trans<span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>mnist_train<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                            num_workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>mnist_test<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            num_workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
batch_size <span class="token operator">=</span> <span class="token number">128</span>
train_iter<span class="token punctuation">,</span> test_iter <span class="token operator">=</span> load_data_mnist<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>resize<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
    X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"X:"</span><span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"y:"</span><span class="token punctuation">,</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">evaluate_accuracy_gpu</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> data_iter<span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#@save</span>
    <span class="token triple-quoted-string string">"""使用GPU计算模型在数据集上的精度"""</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
        net<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 设置为评估模式</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> device<span class="token punctuation">:</span>
            device <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>device
    <span class="token comment"># 正确预测的数量，总预测的数量</span>
    metric <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Accumulator<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> X<span class="token punctuation">,</span> y <span class="token keyword">in</span> data_iter<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># BERT微调所需的</span>
                X <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> X<span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                X <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            y <span class="token operator">=</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            metric<span class="token punctuation">.</span>add<span class="token punctuation">(</span>d2l<span class="token punctuation">.</span>accuracy<span class="token punctuation">(</span>net<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>numel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> metric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">train_ch6</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""用GPU训练模型(在第六章定义)"""</span>
    <span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear <span class="token keyword">or</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">:</span>
            nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>xavier_uniform_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
    net<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'training on'</span><span class="token punctuation">,</span> device<span class="token punctuation">)</span>
    net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">)</span>
    loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
    animator <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Animator<span class="token punctuation">(</span>xlabel<span class="token operator">=</span><span class="token string">'epoch'</span><span class="token punctuation">,</span> xlim<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> num_epochs<span class="token punctuation">]</span><span class="token punctuation">,</span>
                            legend<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'train loss'</span><span class="token punctuation">,</span> <span class="token string">'train acc'</span><span class="token punctuation">,</span> <span class="token string">'test acc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    timer<span class="token punctuation">,</span> num_batches <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Timer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 训练损失之和，训练准确率之和，样本数</span>
        metric <span class="token operator">=</span> d2l<span class="token punctuation">.</span>Accumulator<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        net<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
            timer<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            y_hat <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                metric<span class="token punctuation">.</span>add<span class="token punctuation">(</span>l <span class="token operator">*</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>accuracy<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            timer<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            train_l <span class="token operator">=</span> metric<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> metric<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            train_acc <span class="token operator">=</span> metric<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> metric<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>num_batches <span class="token operator">//</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> i <span class="token operator">==</span> num_batches <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
                animator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> num_batches<span class="token punctuation">,</span>
                             <span class="token punctuation">(</span>train_l<span class="token punctuation">,</span> train_acc<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        test_acc <span class="token operator">=</span> evaluate_accuracy_gpu<span class="token punctuation">(</span>net<span class="token punctuation">,</span> test_iter<span class="token punctuation">)</span>
        animator<span class="token punctuation">.</span>add<span class="token punctuation">(</span>epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> test_acc<span class="token punctuation">)</span><span class="token punctuation">)</span>
        animator<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'loss </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>train_l<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">, train acc </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>train_acc<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">, '</span></span>
          <span class="token string-interpolation"><span class="token string">f'test acc </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>test_acc<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>metric<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> num_epochs <span class="token operator">/</span> timer<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string"> examples/sec '</span></span>
          <span class="token string-interpolation"><span class="token string">f'on </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

lr<span class="token punctuation">,</span> num_epochs <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">10</span>
train_ch6<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> d2l<span class="token punctuation">.</span>try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token string">"cnn.pt"</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果需要在colab上运行，可以使用如下代码</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch  <span class="token comment"># torch基础库</span>
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>datasets <span class="token keyword">as</span> dataset  <span class="token comment"># 公开数据集的下载和管理</span>
<span class="token keyword">import</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">as</span> transforms  <span class="token comment"># 公开数据集的预处理库,格式转换</span>
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils <span class="token keyword">import</span> data
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
net <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
    <span class="token comment"># 这里，我们使用一个11*11的更大窗口来捕捉对象。</span>
    <span class="token comment"># 同时，步幅为4，以减少输出的高度和宽度。</span>
    <span class="token comment"># 另外，输出通道的数目远大于LeNet</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 减小卷积窗口，使用填充为2来使得输入与输出的高和宽一致，且增大输出通道数</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 使用三个连续的卷积层和较小的卷积窗口。</span>
    <span class="token comment"># 除了最后的卷积层，输出通道的数量进一步增加。</span>
    <span class="token comment"># 在前两个卷积层之后，汇聚层不用于减少输入的高度和宽度</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 这里，全连接层的输出数量是LeNet中的好几倍。使用dropout层来减轻过拟合</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">6400</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>p<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># 最后是输出层。由于这里使用MNIST，所以用类别数为10，而非论文中的1000</span>
    nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token comment">#随机初值</span>
<span class="token keyword">for</span> layer <span class="token keyword">in</span> net<span class="token punctuation">:</span><span class="token comment">#用随机权重参数初始化CNN</span>
    X<span class="token operator">=</span>layer<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>layer<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span><span class="token string">'output shape:\t'</span><span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">load_data_mnist</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> resize<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#读取、加载MNIST数据集，并batch</span>
    trans <span class="token operator">=</span> <span class="token punctuation">[</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> resize<span class="token punctuation">:</span>
        trans<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span>resize<span class="token punctuation">)</span><span class="token punctuation">)</span>
    trans <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span>trans<span class="token punctuation">)</span>
    mnist_train <span class="token operator">=</span> dataset<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>
        root<span class="token operator">=</span><span class="token string">"../data"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>trans<span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    mnist_test <span class="token operator">=</span> dataset<span class="token punctuation">.</span>MNIST<span class="token punctuation">(</span>
        root<span class="token operator">=</span><span class="token string">"../data"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>trans<span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>mnist_train<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                            num_workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>mnist_test<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                            num_workers<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
batch_size <span class="token operator">=</span> <span class="token number">128</span>
train_iter<span class="token punctuation">,</span> test_iter <span class="token operator">=</span> load_data_mnist<span class="token punctuation">(</span>batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>resize<span class="token operator">=</span><span class="token number">224</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
    device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
    X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"X:"</span><span class="token punctuation">,</span>X<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"y:"</span><span class="token punctuation">,</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">train_ch6</span><span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""用GPU训练模型(在第六章定义)"""</span>
    <span class="token keyword">def</span> <span class="token function">init_weights</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Linear <span class="token keyword">or</span> <span class="token builtin">type</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">==</span> nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">:</span>
            nn<span class="token punctuation">.</span>init<span class="token punctuation">.</span>xavier_uniform_<span class="token punctuation">(</span>m<span class="token punctuation">.</span>weight<span class="token punctuation">)</span>
    net<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>init_weights<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'training on'</span><span class="token punctuation">,</span> device<span class="token punctuation">)</span>
    net<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
    optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>net<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>lr<span class="token punctuation">)</span>
    loss <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 训练损失之和，训练准确率之和，样本数</span>
        net<span class="token punctuation">.</span>train<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>train_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>
            X<span class="token punctuation">,</span> y <span class="token operator">=</span> X<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
            y_hat <span class="token operator">=</span> net<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
            l <span class="token operator">=</span> loss<span class="token punctuation">(</span>y_hat<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
            l<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">try_gpu</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>device_count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cuda:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span>
lr<span class="token punctuation">,</span> num_epochs <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token number">10</span>
train_ch6<span class="token punctuation">(</span>net<span class="token punctuation">,</span> train_iter<span class="token punctuation">,</span> test_iter<span class="token punctuation">,</span> num_epochs<span class="token punctuation">,</span> lr<span class="token punctuation">,</span> try_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>net<span class="token punctuation">,</span> <span class="token string">"cnn.pt"</span><span class="token punctuation">)</span>
</code></pre> 
<p>用户界面</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> <span class="token punctuation">(</span>QMainWindow<span class="token punctuation">,</span> QMenuBar<span class="token punctuation">,</span> QToolBar<span class="token punctuation">,</span> QTextEdit<span class="token punctuation">,</span> QAction<span class="token punctuation">,</span> QApplication<span class="token punctuation">,</span>
                             qApp<span class="token punctuation">,</span> QMessageBox<span class="token punctuation">,</span> QFileDialog<span class="token punctuation">,</span> QLabel<span class="token punctuation">,</span> QHBoxLayout<span class="token punctuation">,</span> QGroupBox<span class="token punctuation">,</span>
                             QComboBox<span class="token punctuation">,</span> QGridLayout<span class="token punctuation">,</span> QLineEdit<span class="token punctuation">,</span> QSlider<span class="token punctuation">,</span> QPushButton<span class="token punctuation">)</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QPalette<span class="token punctuation">,</span> QImage<span class="token punctuation">,</span> QPixmap<span class="token punctuation">,</span> QBrush
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> time
<span class="token keyword">from</span> pylab <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">class</span> <span class="token class-name">Window</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    path <span class="token operator">=</span> <span class="token string">' '</span>
    change_path <span class="token operator">=</span> <span class="token string">"change.png"</span><span class="token comment">#被处理过的图像的路径</span>
    IMG1 <span class="token operator">=</span> <span class="token string">' '</span>
    IMG2 <span class="token operator">=</span> <span class="token string">'null'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Window<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 界面初始化</span>

        self<span class="token punctuation">.</span>createMenu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#创建左上角菜单栏</span>
        self<span class="token punctuation">.</span>cwd <span class="token operator">=</span> os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#当前工作目录</span>
        self<span class="token punctuation">.</span>image_show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label1 <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>initUI<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 菜单栏</span>
    <span class="token keyword">def</span> <span class="token function">createMenu</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># menubar = QMenuBar(self)</span>
        menubar <span class="token operator">=</span> self<span class="token punctuation">.</span>menuBar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        menu1 <span class="token operator">=</span> menubar<span class="token punctuation">.</span>addMenu<span class="token punctuation">(</span><span class="token string">"文件"</span><span class="token punctuation">)</span>
        menu1<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span><span class="token string">"打开"</span><span class="token punctuation">)</span>
        menu1<span class="token punctuation">.</span>triggered<span class="token punctuation">[</span>QAction<span class="token punctuation">]</span><span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menu1_process<span class="token punctuation">)</span>

    <span class="token comment">#展示大图片</span>
    <span class="token keyword">def</span> <span class="token function">image_show</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>lbl <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lbl<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QPixmap<span class="token punctuation">(</span><span class="token string">'source.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lbl<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>AlignCenter<span class="token punctuation">)</span>  <span class="token comment"># 图像显示区，居中</span>
        self<span class="token punctuation">.</span>lbl<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">700</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lbl<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token string">"border: 2px solid black"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">initUI</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">900</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">'mnist识别系统'</span><span class="token punctuation">)</span>
        palette <span class="token operator">=</span> QPalette<span class="token punctuation">(</span><span class="token punctuation">)</span>
        palette<span class="token punctuation">.</span>setColor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>backgroundRole<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> QColor<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setPalette<span class="token punctuation">(</span>palette<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>label1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"TextLabel"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label1<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">730</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 菜单1处理</span>
    <span class="token keyword">def</span> <span class="token function">menu1_process</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> QFileDialog<span class="token punctuation">.</span>getOpenFileName<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'打开文件'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>cwd<span class="token punctuation">,</span>
                                                <span class="token string">"All Files (*);;(*.bmp);;(*.tif);;(*.png);;(*.jpg)"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>image <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>lbl<span class="token punctuation">.</span>setPixmap<span class="token punctuation">(</span>QPixmap<span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>self<span class="token punctuation">.</span>change_path<span class="token punctuation">,</span> self<span class="token punctuation">.</span>image<span class="token punctuation">)</span>
        transforms1 <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
            transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"识别中"</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>change_path<span class="token punctuation">)</span>
        img <span class="token operator">=</span> img<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        tensor <span class="token operator">=</span> transforms1<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tensor<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
        tensor <span class="token operator">=</span> tensor<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>FloatTensor<span class="token punctuation">)</span>
        device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span><span class="token punctuation">)</span>
        tensor <span class="token operator">=</span> tensor<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
        tensor <span class="token operator">=</span> tensor<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tensor<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
        y <span class="token operator">=</span> net<span class="token punctuation">(</span>tensor<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>label1<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    net <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'cnn.pt'</span><span class="token punctuation">)</span>
    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    ex <span class="token operator">=</span> Window<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ex<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="43__341"></a>4.3 改进与拓展</h3> 
<p>1.重新配置了环境，安装了基于GPU版本的Pytorch。与CPU版本相比，GPU能够支持更快的卷积运算。同时，更大的显存也能够支持将更多的数据batch分批处理，有利于训练的稳定性防止“梯度消失”。在CPU版本中，若batch size过大则可能出现爆内存等问题。<br> 2.AlexNet将sigmoid激活函数替换成了更简单的ReLU激活函数。ReLU的计算更简单，使得模型更容易训练，不会造成“梯度消失”等使得模型无法得到有效训练的情况。<br> 3.为了防止过拟合，还引入了一定概率的dropout控制全连接层的模型复杂度。</p> 
<h2><a id="_346"></a>五、实验运行结果及分析</h2> 
<p>（不同情形的运行结果及详细分析）<br> 以下为python控制台输出结果</p> 
<pre><code class="prism language-python">D<span class="token punctuation">:</span>\ProgramData\Anaconda3\python<span class="token punctuation">.</span>exe F<span class="token punctuation">:</span><span class="token operator">/</span>mnist<span class="token operator">/</span>mlhw3<span class="token punctuation">.</span>py 
Conv2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
MaxPool2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Conv2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
MaxPool2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Conv2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Conv2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">384</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Conv2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
MaxPool2d output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Flatten output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6400</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Linear output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Dropout output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Linear output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ReLU output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Dropout output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Linear output shape<span class="token punctuation">:</span>	 torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
training on cuda<span class="token punctuation">:</span><span class="token number">0</span>
<span class="token operator">&lt;</span>Figure size 350x250 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 350x250 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 350x250 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 350x250 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 350x250 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>Figure size 1920x951 <span class="token keyword">with</span> <span class="token number">1</span> Axes<span class="token operator">&gt;</span>
loss <span class="token number">0.039</span><span class="token punctuation">,</span> train acc <span class="token number">0.988</span><span class="token punctuation">,</span> test acc <span class="token number">0.991</span>
<span class="token number">624.4</span> examples<span class="token operator">/</span>sec on cuda<span class="token punctuation">:</span><span class="token number">0</span>
</code></pre> 
<p>可以看出，正确地建立了模型，正确地进行迭代与更新、训练的过程。训练完成后，loss函数为0.039，训练集准确率为0.988，测试集准确率为0.991。在cuda上，每一秒都运行了624个训练数据。<br> 训练集准确率、测试集准确率、loss函数的变化曲线如下。可以看出，其识别精度是非常高的。<br> <img src="https://images2.imgbox.com/3d/2d/Ca9RgLNV_o.png" alt="在这里插入图片描述"><br> 此为用户图形界面<br> <img src="https://images2.imgbox.com/fa/b0/TAQIuedP_o.png" alt="在这里插入图片描述"><br> 可以读取文件<br> <img src="https://images2.imgbox.com/38/00/jUFXZmR8_o.png" alt="在这里插入图片描述"><br> 读取数字“0”的图片并正确识别。该图片为真实手写并反色处理后的图片，不来源于训练集。<br> 控制台输出如下：</p> 
<pre><code>torch.Size([1, 224, 224])
torch.Size([1, 1, 224, 224])
tensor([[16.5969, -2.6974,  1.0315, -4.3109, -2.4112, -2.2494,  2.9837, -2.5753,
         -1.0474,  0.4374]], device='cuda:0', grad_fn=&lt;AddmmBackward0&gt;)
tensor(0, device='cuda:0')
</code></pre> 
<p>用户界面如下：<br> <img src="https://images2.imgbox.com/0c/e5/NzM1WoNu_o.png" alt="在这里插入图片描述"><br> 读取数字“6”并正确识别。该图片为真实手写并反色处理后的图片，不来源于训练集。<br> 控制台输出如下：</p> 
<pre><code class="prism language-python">torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
torch<span class="token punctuation">.</span>Size<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3.4247</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.9304</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.6991</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.0964</span><span class="token punctuation">,</span>  <span class="token number">0.0769</span><span class="token punctuation">,</span>  <span class="token number">2.2364</span><span class="token punctuation">,</span> <span class="token number">11.2306</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">6.2827</span><span class="token punctuation">,</span>
          <span class="token number">6.0278</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7.4283</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">'cuda:0'</span><span class="token punctuation">,</span> grad_fn<span class="token operator">=</span><span class="token operator">&lt;</span>AddmmBackward0<span class="token operator">&gt;</span><span class="token punctuation">)</span>
tensor<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">'cuda:0'</span><span class="token punctuation">)</span>
</code></pre> 
<p>用户界面如下：<br> <img src="https://images2.imgbox.com/2c/0e/Bymh1aWG_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_475"></a>六、总结与进一步改进设想</h2> 
<p>在本次实验中，使用了经典的AlexNet卷积神经网络对经典的MNIST数据集进行训练。完成了模型搭建与训练的任务，识别精度也足够高，也编写了简单的用户界面，用真实手写的图片进行测试，可以看出模型对于真实场景的效果也是适用的，而不是只适用于加载出来并分割出来的测试集。<br> 为了进一步改进，可以引入图像增广、翻转、裁剪、颜色变化等办法进一步扩大制作数据集，用于训练与测试。可以使用RGB颜色的3通道彩图而不是仅仅使用单通道二值化图像进行训练。</p> 
<h2><a id="_478"></a>七、参考文献</h2> 
<p>[1]周志华. 机器学习[M]. 2016年1月第1版. 北京:清华大学出版社, 2016.<br> [2]赵卫东, 董亮. 机器学习[M]. 2018年8月第1版. 北京:人民邮电出版社, 2018.<br> [3]李航. 统计学习方法[M]. 2019年5月第2版. 北京:清华大学出版社, 2019.<br> [4]阿斯顿·张(Aston Zhang), 李沐(Mu Li), [美]扎卡里·C.立顿(Zachary C.Lipton), 等. 动手学深度学习[M]. 2019年6月第1版. 北京:人民邮电出版社, 2019.<br> [5][美]Ian Goodfellow [加]Yoshua Bengio [加]Aaron Courville. 深度学习[M]. 2017年8月第1版. 北京:人民邮电出版社, 2017.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc0279af00c61229d14efa90fc9ee320/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决：Collecting package metadata (current_repodata.json)/ Solving environment</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a54e6a723f2193e2da1b02159c346a29/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">确定Mac\Linux系统的架构类型是 x86-64（amd64），还是 arm64 架构</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>