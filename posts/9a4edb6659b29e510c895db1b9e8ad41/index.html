<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HiveSQL经典面试题（建议点赞收藏） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9a4edb6659b29e510c895db1b9e8ad41/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="HiveSQL经典面试题（建议点赞收藏）">
  <meta property="og:description" content="目录
经典面试系列
每科成绩都大于80分的学生信息
连续登录问题
行列转换问题
留存问题：看当天登录后第N天是否登录
TopN问题
累计计算问题
HSQL进阶版
直播间在线最大人数
SQL循环
计算中位数
产生连续数值
经典面试系列 每科成绩都大于80分的学生信息 建表&#43;初始化 --创建表scdn_student_score_test 并且初始化三个学生成绩 create table hdw_tmp_dev.scdn_student_score_test as select &#39;张三&#39; as name,&#39;数学&#39; as subject ,&#39;80&#39; as score union all select &#39;张三&#39; as name,&#39;语文&#39; as subject ,&#39;90&#39; as score union all select &#39;张三&#39; as name,&#39;英语&#39; as subject ,&#39;90&#39; as score union all select &#39;李四&#39; as name,&#39;数学&#39; as subject ,&#39;90&#39; as score union all select &#39;李四&#39; as name,&#39;语文&#39; as subject ,&#39;90&#39; as score union all select &#39;李四&#39; as name,&#39;英语&#39; as subject ,&#39;70&#39; as score union all select &#39;王五&#39; as name,&#39;数学&#39; as subject ,&#39;90&#39; as score union all select &#39;王五&#39; as name,&#39;语文&#39; as subject ,&#39;90&#39; as score union all select &#39;王五&#39; as name,&#39;英语&#39; as subject ,&#39;50&#39; as score --查询结果显示 | scdn_student_score_test.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-08T09:33:19+08:00">
    <meta property="article:modified_time" content="2024-02-08T09:33:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HiveSQL经典面试题（建议点赞收藏）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E7%B3%BB%E5%88%97-toc" style="margin-left:0px;"><a href="#%E7%BB%8F%E5%85%B8%E9%9D%A2%E8%AF%95%E7%B3%BB%E5%88%97" rel="nofollow">经典面试系列</a></p> 
<p id="%E6%AF%8F%E7%A7%91%E6%88%90%E7%BB%A9%E9%83%BD%E5%A4%A7%E4%BA%8E80%E5%88%86%E7%9A%84%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF-toc" style="margin-left:40px;"><a href="#%E6%AF%8F%E7%A7%91%E6%88%90%E7%BB%A9%E9%83%BD%E5%A4%A7%E4%BA%8E80%E5%88%86%E7%9A%84%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF" rel="nofollow">每科成绩都大于80分的学生信息</a></p> 
<p id="%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98" rel="nofollow">连续登录问题</a></p> 
<p id="%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98" rel="nofollow">行列转换问题</a></p> 
<p id="%E7%95%99%E5%AD%98%E9%97%AE%E9%A2%98%EF%BC%9A%E7%9C%8B%E5%BD%93%E5%A4%A9%E7%99%BB%E5%BD%95%E5%90%8E%E7%AC%ACN%E5%A4%A9%E6%98%AF%E5%90%A6%E7%99%BB%E5%BD%95-toc" style="margin-left:40px;"><a href="#%E7%95%99%E5%AD%98%E9%97%AE%E9%A2%98%EF%BC%9A%E7%9C%8B%E5%BD%93%E5%A4%A9%E7%99%BB%E5%BD%95%E5%90%8E%E7%AC%ACN%E5%A4%A9%E6%98%AF%E5%90%A6%E7%99%BB%E5%BD%95" rel="nofollow">留存问题：看当天登录后第N天是否登录</a></p> 
<p id="TopN%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#TopN%E9%97%AE%E9%A2%98" rel="nofollow">TopN问题</a></p> 
<p id="%E7%B4%AF%E8%AE%A1%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#%E7%B4%AF%E8%AE%A1%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98" rel="nofollow">累计计算问题</a></p> 
<p id="HSQL%E8%BF%9B%E9%98%B6%E7%89%88-toc" style="margin-left:0px;"><a href="#HSQL%E8%BF%9B%E9%98%B6%E7%89%88" rel="nofollow">HSQL进阶版</a></p> 
<p id="%C2%A0%E7%9B%B4%E6%92%AD%E9%97%B4%E5%9C%A8%E7%BA%BF%E6%9C%80%E5%A4%A7%E4%BA%BA%E6%95%B0-toc" style="margin-left:40px;"><a href="#%C2%A0%E7%9B%B4%E6%92%AD%E9%97%B4%E5%9C%A8%E7%BA%BF%E6%9C%80%E5%A4%A7%E4%BA%BA%E6%95%B0" rel="nofollow"> 直播间在线最大人数</a></p> 
<p id="SQL%E5%BE%AA%E7%8E%AF-toc" style="margin-left:40px;"><a href="#SQL%E5%BE%AA%E7%8E%AF" rel="nofollow">SQL循环</a></p> 
<p id="%E8%AE%A1%E7%AE%97%E4%B8%AD%E4%BD%8D%E6%95%B0-toc" style="margin-left:40px;"><a href="#%E8%AE%A1%E7%AE%97%E4%B8%AD%E4%BD%8D%E6%95%B0" rel="nofollow">计算中位数</a></p> 
<p id="%E4%BA%A7%E7%94%9F%E8%BF%9E%E7%BB%AD%E6%95%B0%E5%80%BC-toc" style="margin-left:40px;"><a href="#%E4%BA%A7%E7%94%9F%E8%BF%9E%E7%BB%AD%E6%95%B0%E5%80%BC" rel="nofollow">产生连续数值</a></p> 
<hr id="hr-toc"> 
<h2>经典面试系列</h2> 
<ol><li> <h3 id="%E6%AF%8F%E7%A7%91%E6%88%90%E7%BB%A9%E9%83%BD%E5%A4%A7%E4%BA%8E80%E5%88%86%E7%9A%84%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF">每科成绩都大于80分的学生信息</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">--创建表scdn_student_score_test 并且初始化三个学生成绩
create table hdw_tmp_dev.scdn_student_score_test as 
select '张三' as name,'数学' as subject ,'80' as score 
union all 
select '张三' as name,'语文' as subject ,'90' as score
union all 
select '张三' as name,'英语' as subject ,'90' as score 
union all 
select '李四' as name,'数学' as subject ,'90' as score
union all 
select '李四' as name,'语文' as subject ,'90' as score
union all 
select '李四' as name,'英语' as subject ,'70' as score 
union all 
select '王五' as name,'数学' as subject ,'90' as score
union all 
select '王五' as name,'语文' as subject ,'90' as score
union all 
select '王五' as name,'英语' as subject ,'50' as score 
--查询结果显示
| scdn_student_score_test.name  | scdn_student_score_test.subject  | scdn_student_score_test.score  |
+-------------------------------+----------------------------------+--------------------------------+
| 张三                            | 数学                               | 80                             |
| 张三                            | 语文                               | 90                             |
| 张三                            | 英语                               | 90                             |
| 李四                            | 数学                               | 90                             |
| 李四                            | 语文                               | 90                             |
| 李四                            | 英语                               | 70                             |
| 王五                            | 数学                               | 90                             |
| 王五                            | 语文                               | 90                             |
| 王五                            | 英语                               | 50                             |
+-------------------------------+----------------------------------+---------------------

--求所有学科成绩都大于等于80分的学生姓名</code></pre> </li><li>思路一（思维转换）：所有问题找最小（最大） <pre><code class="language-sql">select 
    t1.name
    ,t1.min_score 
from 
    (
        select 
            name 
            ,min(score)  as min_score
        from hdw_tmp_dev.scdn_student_score_test
        group by name 
    ) as t1 --求出最小的成绩
where t1.min_score &gt;=80 --最小成绩大于等于80，则这个学生的所有成绩都会大于等于80</code></pre> </li><li>执行结果<img alt="" height="120" src="https://images2.imgbox.com/13/98/TSPkBC8a_o.png" width="1123"></li><li>思路二（巧用左关联进行筛选）： <pre><code class="language-sql">select 
    t1.name 
from 
(
    select 
        name 
    from hdw_tmp_dev.scdn_student_score_test
    group by name 
) as t1 
left join 
(
    select 
        name 
    from hdw_tmp_dev.scdn_student_score_test
    where score &lt;80
    group by name 
) as t2 on t1.name = t2.name
where t2.name is null </code></pre> </li></ol></li><li> <h3 id="%E8%BF%9E%E7%BB%AD%E7%99%BB%E5%BD%95%E9%97%AE%E9%A2%98">连续登录问题</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">create table hdw_tmp_dev.csdn_user_login_test as 
select 'xiaoming' as user_name,'2024-01-01' as login_date 
union all 
select 'xiaoming' as user_name,'2024-01-02' as login_date 
union all 
select 'xiaoming' as user_name,'2024-01-03' as login_date
union all 
select 'xiaoming' as user_name,'2024-01-04' as login_date
union all 
select 'xiaoming' as user_name,'2024-01-05' as login_date
union all 
select 'dahuang' as user_name,'2024-01-02' as login_date 
union all 
select 'dahuang' as user_name,'2024-01-03' as login_date
union all 
select 'dahuang' as user_name,'2024-01-04' as login_date
union all 
select 'dahuang' as user_name,'2024-01-05' as login_date
union all 
select 'lucky_dog' as user_name,'2024-01-01' as login_date 
union all 
select 'lucky_dog' as user_name,'2024-01-03' as login_date
union all 
select 'lucky_dog' as user_name,'2024-01-04' as login_date
union all 
select 'lucky_dog' as user_name,'2024-01-05' as login_date</code></pre> </li><li>Sql参考 <pre><code class="language-sql">select 
    t2.user_name 
    ,t2.date_begin_flag
    ,count(1) as max_login_days
from 
(
    select 
        t1.user_name 
        ,t1.login_date
        ,date_sub(date(login_date),t1.rn) as date_begin_flag
    from 
    (
        select 
            user_name 
            ,login_date 
            ,row_number()over(partition by user_name order by login_date) as rn 
        from hdw_tmp_dev.csdn_user_login_test
    ) as t1
) as t2  
group by t2.user_name 
    ,t2.date_begin_flag</code></pre> </li><li>执行过程+结果<img alt="" height="314" src="https://images2.imgbox.com/97/3a/Chc1aIAN_o.png" width="576"><img alt="" height="165" src="https://images2.imgbox.com/5f/87/iMafECN6_o.png" width="630"></li></ol></li><li> <h3 id="%E8%A1%8C%E5%88%97%E8%BD%AC%E6%8D%A2%E9%97%AE%E9%A2%98">行列转换问题</h3> 
  <ol><li>建表+初始化：参考问题一的表 <pre><code class="language-sql">| t1.name              | t1.subject             | t1.score  |
+-------------------------------+----------------------------------+-----------------+
| 张三                 | 数学                    | 80                             |
| 张三                 | 语文                    | 90                             |
| 张三                 | 英语                    | 90                             |
| 李四                 | 数学                    | 90                             |
| 李四                 | 语文                    | 90                             |
| 李四                 | 英语                    | 70                             |
| 王五                 | 数学                    | 90                             |
| 王五                 | 语文                    | 90                             |
| 王五                 | 英语                    | 50                             |
+-------------------------------+----------------------------------+------------------</code></pre> </li><li>行专列Sql参考 <pre><code class="language-sql">select 
    name 
    ,max(case when subject = '数学' then score end) as math_score
    ,max(case when subject = '语文' then score end) as china_score
    ,max(case when subject = '英语' then score end) as english_score
from hdw_tmp_dev.scdn_student_score_test
group by name </code></pre> </li><li>行专列执行结果<img alt="" height="147" src="https://images2.imgbox.com/7d/91/EYPTRGdv_o.png" width="573"></li><li>列转行：可以参考建表初始化语句（union all） <pre><code class="language-sql">select 
    name
    ,collect_set(subject)  as subject_set
from hdw_tmp_dev.scdn_student_score_test
group by name </code></pre> </li><li> <p>每个学生选课结果（多行变一行）：<img alt="" height="158" src="https://images2.imgbox.com/83/b9/eB5l5xip_o.png" width="1200"></p> </li><li> <p> 将上面的结果展开（一行变多行）数据准备：</p> <pre><code class="language-sql">create table hdw_tmp_dev.scdn_student_score_test_collect as 
select 'zhangsan' as name ,'"数学","语文","英语"' as subject_list
union all 
select 'lisi' as name ,'"美术","生物","物理"' as subject_list
union all 
select 'wangwu' as name ,'"计算机","日语","韩语"' as subject_list</code></pre> </li><li>炸开代码 <pre><code class="language-sql">select 
    name
    ,subject_list
    ,subject_name
from hdw_tmp_dev.scdn_student_score_test_collect
lateral view explode(split(subject_list,',')) extend_sub as subject_name</code></pre> </li><li> <p>结果<img alt="" height="362" src="https://images2.imgbox.com/f6/02/AnVaYXrh_o.png" width="1158"></p> </li></ol></li><li> <h3 id="%E7%95%99%E5%AD%98%E9%97%AE%E9%A2%98%EF%BC%9A%E7%9C%8B%E5%BD%93%E5%A4%A9%E7%99%BB%E5%BD%95%E5%90%8E%E7%AC%ACN%E5%A4%A9%E6%98%AF%E5%90%A6%E7%99%BB%E5%BD%95">留存问题：看当天登录后第N天是否登录</h3> 
  <ol><li>建表+初始化：参照连续登录表</li><li>Sql参考 <pre><code class="language-sql">--方案一：利用lead(日期，N)是否等于 当天登录实践+N天
select 
    t1.user_name
    ,t1.logon_date
    ,case when lead1_logon_date = date_add(logon_date,1) then '1天留存' end as 1day_remain
    ,case when lead3_logon_date = date_add(logon_date,3) then '3天留存' end as 3day_remain
from 
(
    select 
        user_name 
        ,logon_date 
        ,lead(user_name,1)over(partition by user_name order by logon_date) as lead1_user_name
        ,lead(logon_date,1)over(partition by user_name order by logon_date) as lead1_logon_date
        ,lead(user_name,3)over(partition by user_name order by logon_date) as lead3_user_name
        ,lead(logon_date,3)over(partition by user_name order by logon_date) as lead3_logon_date
    from hdw_tmp_dev.csdn_user_logon_test
) as t1 
--方案二：
select 
    t2.first_log_date       as first_log_date
    ,count(t2.user_id)      as new_user_cnt --新用户数 
    ,count(t3.user_id)      as next_user_id --次日回访用户数
    ,count(t4.user_id)      as 30_user_id   --30天回访用户数
    ,count(t3.user_id)/count(t2.user_id)    as next_back_rate --次日回访率
    ,count(t4.user_id)/count(t2.user_id)    as 30_back_rate   --30天回访率
from 
(
    select 
        first_log_date
        ,user_id 
        ,date_add(first_log_date,1)  as next_log_date
        ,date_add(first_log_date,29) as 30_log_date
    from 
    (
        select 
            user_id 
            ,log_time 
            ,first_value(date(log_time))over(partition by user_id) as first_log_date 
        from user_log 
    ) as t1 
    group by first_log_date
        ,user_id 
) as t2 
left join 
(
    select 
        user_id 
        ,date(log_date) as log_date  
    from user_log 
    group by user_id 
        ,date(log_date) as log_date 
) as t3 on t2.user_id = t2.user_id and t2.next_log_date = t3.log_date
left join 
(
    select 
        user_id 
        ,date(log_date) as log_date  
    from user_log 
    group by user_id 
        ,date(log_date) as log_date 
) as t4 on t2.user_id = t4.user_id and t2.30_log_date = t4.log_date
group by t2.first_log_date </code></pre> </li><li>方案一执行结果<img alt="" height="275" src="https://images2.imgbox.com/a2/7c/3oI20bUv_o.png" width="591"></li></ol></li><li> <h3 id="TopN%E9%97%AE%E9%A2%98">TopN问题</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">create table hdw_tmp_dev.scdn_student_score_test1 as 
select '张三' as name,'数学' as subject ,'80' as score 
union all 
select '张三' as name,'语文' as subject ,'90' as score
union all 
select '张三' as name,'英语' as subject ,'90' as score 
union all 
select '李四' as name,'数学' as subject ,'90' as score
union all 
select '李四' as name,'语文' as subject ,'90' as score
union all 
select '李四' as name,'英语' as subject ,'70' as score 
union all 
select '王五' as name,'数学' as subject ,'90' as score
union all 
select '王五' as name,'语文' as subject ,'90' as score
union all 
select '王五' as name,'英语' as subject ,'50' as score 
union all 
select '小明' as name,'数学' as subject ,'88' as score
union all 
select '小明' as name,'语文' as subject ,'99' as score
union all 
select '小明' as name,'英语' as subject ,'77' as score
union all 
select '小文' as name,'数学' as subject ,'66' as score
union all 
select '小文' as name,'语文' as subject ,'89' as score
union all 
select '小文' as name,'英语' as subject ,'90' as score</code></pre> </li><li>Sql参考：求每科前三名对应的人员的成绩单 <pre><code class="language-sql">select 
    *
from 
(
    select 
        name
        ,subject
        ,score
        ,row_number()over(partition by subject order by score desc) as rn 
    from hdw_tmp_dev.scdn_student_score_test1
) as t1 
where rn&lt;=3</code></pre> </li><li>执行结果<img alt="" height="245" src="https://images2.imgbox.com/48/49/f64pA00m_o.png" width="1200"></li></ol></li><li> <h3 id="%E7%B4%AF%E8%AE%A1%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98">累计计算问题</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">create table hdw_tmp_dev.user_sale_date as 
select '001' as user_id,'2024-02-01' as sale_date, 100 as amount 
union all 
select '001' as user_id,'2024-02-02' as sale_date, 200 as amount 
union all 
select '001' as user_id,'2024-02-03' as sale_date, 300 as amount 
union all 
select '001' as user_id,'2024-02-04' as sale_date, 400 as amount 
union all 
select '001' as user_id,'2024-02-05' as sale_date, 500 as amount 
union all 
select '001' as user_id,'2024-02-06' as sale_date, 600 as amount </code></pre> </li><li>SQL逻辑 <pre><code class="language-sql">select 
    user_id
    ,sale_date
    ,amount
    ,sum(amount)over(partition by user_id order by sale_date) as accuma_amount --按日期逐渐累加
    ,sum(amount)over(partition by user_id) as total_amount --按人汇总
    ,avg(amount)over(partition by user_id) as avg_amount --安人平均每天
    ,max(amount)over(partition by user_id) as max_amount --单日最大销售
    ,min(amount)over(partition by user_id) as min_amount --单日最小销售
from hdw_tmp_dev.user_sale_date</code></pre> </li><li>结果展示<img alt="" height="195" src="https://images2.imgbox.com/75/30/xJTpteDS_o.png" width="1200"></li></ol></li></ol> 
<h2 id="HSQL%E8%BF%9B%E9%98%B6%E7%89%88">HSQL进阶版</h2> 
<ol><li> <h3 id="%C2%A0%E7%9B%B4%E6%92%AD%E9%97%B4%E5%9C%A8%E7%BA%BF%E6%9C%80%E5%A4%A7%E4%BA%BA%E6%95%B0"> 直播间在线最大人数</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">create table hdw_tmp_dev.csdn_user_login_time_detail as 
select '001' as user_id,'2024-02-01 10:00:00' as begin_time,'2024-02-01 12:00:00' as end_time 
union all 
select '002' as user_id,'2024-02-01 11:00:00' as begin_time,'2024-02-01 13:00:00' as end_time 
union all 
select '003' as user_id,'2024-02-01 11:00:00' as begin_time,'2024-02-01 14:00:00' as end_time 
union all 
select '004' as user_id,'2024-02-01 15:00:00' as begin_time,'2024-02-01 16:00:00' as end_time </code></pre> </li><li>SQL逻辑 <pre><code class="language-sql">select 
    t1.user_id 
    ,t1.time1
    ,t1.flag
    ,sum(flag)over(order by t1.time1) as user_cnt 
from 
(
    select 
        user_id
        ,begin_time as time1 
        ,1    as flag 
    from hdw_tmp_dev.csdn_user_login_time_detail
    union all 
    select 
        user_id
        ,end_time
        ,-1    as flag 
    from hdw_tmp_dev.csdn_user_login_time_detail
) as t1 </code></pre> </li><li>结果展示<img alt="" height="233" src="https://images2.imgbox.com/9c/c8/kZSCQirF_o.png" width="1119"></li></ol></li><li> <h3 id="SQL%E5%BE%AA%E7%8E%AF">SQL循环</h3> 
  <ol><li>建表+初始化 <pre><code class="language-sql">create table hdw_tmp_dev.cycle_1 as 
select '1011' as a 
union all 
select '0101' as a</code></pre> </li><li>SQL逻辑 <pre><code class="language-sql">select  
        a,
        concat_ws(",",collect_list(cast(index  as  string)))  as  res
from  (
        select  
                a,
                index+1  as  index,
                chr
        from  (
                select  
                        a,
                        concat_ws(",",substr(a,1,1),substr(a,2,1),substr(a,3,1),substr(a,-1))  str
                from  hdw_tmp_dev.cycle_1 as t8
        )  tmp1
        lateral  view  posexplode(split(str,","))  t  as  index,chr
        where  chr  =  "1"
)  tmp2
group  by  a;</code></pre> </li><li>结果展示<img alt="" height="158" src="https://images2.imgbox.com/36/5b/xem65fAe_o.png" width="1130"></li></ol></li><li> <h3 id="%E8%AE%A1%E7%AE%97%E4%B8%AD%E4%BD%8D%E6%95%B0">计算中位数</h3> 
  <ol><li>建表+初始化: <pre><code class="language-sql">create table hdw_tmp_dev.user_sale_date as 
select '001' as user_id,'2024-02-01' as sale_date, 100 as amount 
union all 
select '001' as user_id,'2024-02-02' as sale_date, 200 as amount 
union all 
select '001' as user_id,'2024-02-03' as sale_date, 300 as amount 
union all 
select '001' as user_id,'2024-02-04' as sale_date, 400 as amount 
union all 
select '001' as user_id,'2024-02-05' as sale_date, 500 as amount 
union all 
select '001' as user_id,'2024-02-06' as sale_date, 600 as amount </code></pre> </li><li>SQL逻辑 <pre><code class="language-sql">select 
    t1.user_id
    ,t1.sale_date
    ,t1.amount
    ,avg(t1.amount)over(partition by t1.user_id) as zhongwenshu
from 
(
    select 
        user_id
        ,sale_date
        ,amount
        ,row_number()over(partition by user_id order by amount) as rn 
    from hdw_tmp_dev.user_sale_date
) as t1 
left join 
(
    select 
        user_id 
        ,count(1) as cnt 
    from hdw_tmp_dev.user_sale_date
    group by user_id 
) as t2 on t1.user_id = t2.user_id 
where t1.rn in (cnt/2,(cnt+1)/2,cnt/2+1)
--总个数为奇数命中(cnt+1)/2；总个数为偶数命中：cnt/2,cnt/2+1，两数相加求平均值</code></pre> </li><li>结果展示<img alt="" height="125" src="https://images2.imgbox.com/a6/0f/iVGw6DZH_o.png" width="1200"></li></ol></li><li> <h3 id="%E4%BA%A7%E7%94%9F%E8%BF%9E%E7%BB%AD%E6%95%B0%E5%80%BC">产生连续数值</h3> 
  <ol><li>SQL逻辑 <pre><code class="language-sql">--产生1到10的连续数据
select
    start_id + pos  as  id
    ,pos
    ,val
from(
    select
        1   as  start_id,
        10  as  end_id
)  m  lateral  view  posexplode(split(space(end_id - start_id),''))  t  as  pos,  val
--方案二
select
    row_number()  over()  as  id
from    
    (select  split(space(99), '') as  x)  t
lateral  view
explode(x)  ex;</code></pre> </li><li>结果展示<img alt="" height="420" src="https://images2.imgbox.com/e3/46/C6iHYiwK_o.png" width="1103"></li></ol></li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9cfcd540ade1eb71768894f87d653db0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入理解Spark BlockManager：定义、原理与实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9cb6c320deba74f0115b8e378270f738/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis内存使用指南：maxmemory参数详解与配置建议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>