<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>秋招Java后端开发冲刺——非关系型数据库篇（MongoDB） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ae687a2cd4c9182995c4e980c01dd626/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="秋招Java后端开发冲刺——非关系型数据库篇（MongoDB）">
  <meta property="og:description" content="MongoDB 本文介绍非关系型数据库MongoDB的基础知识和常见面试题。
（一）基础知识 1. 介绍：MongoDB是一个基于分布式文件存储的数据库，由C&#43;&#43;语言编写，旨在为WEB应用提供可扩展的高性能数据存储解决方案。
2.特点
特点说明文档存储使用 BSON（二进制 JSON）格式存储文档，支持嵌套结构和数组。灵活的模式（Schema-less）支持动态模式设计，文档结构可以不固定，适合快速迭代开发。高性能通过内存映射文件和高效的索引机制，提供高性能读写操作。高可用性支持复制集（Replica Set），提供自动故障转移和数据冗余。横向扩展支持分片（Sharding）功能，通过分布式架构实现数据的水平扩展。强一致性默认提供强一致性保证，通过复制集配置可以调整一致性级别。丰富的查询语言提供丰富的查询语言，支持字段、范围、正则表达式查询以及聚合框架。原子操作支持单文档级别的原子操作，确保数据修改的一致性和完整性。支持事务4.0 版本开始支持多文档 ACID 事务，增强数据操作的可靠性。跨平台支持多种操作系统，包括 Windows、Linux 和 macOS。易于集成提供多种官方驱动程序，支持多种编程语言，如 JavaScript、Python、Java、C# 等。强大的社区支持拥有活跃的社区和丰富的文档资料，便于开发者学习和使用。灵活的索引支持多种类型的索引，如单字段索引、复合索引、地理空间索引和全文索引。聚合框架提供强大的聚合框架，支持数据处理和分析操作，如过滤、排序、分组、投影等。文件存储通过 GridFS 实现大文件存储，适用于存储图片、视频等大文件数据。安全性提供认证和授权机制，支持基于角色的访问控制（RBAC），确保数据安全。备份与恢复提供多种备份与恢复机制，包括快照备份、导入导出工具和云备份服务。可视化工具提供官方的 MongoDB Compass 可视化工具，便于管理和分析数据库。 3. 存储结构
（1）文档
文档是 MongoDB 的基本数据单位，使用 BSON 格式存储。每个文档包含键值对，类似于 JSON 对象.
注：BSON文档是JSON 文档的二进制表示
（2）集合
集合是一组文档的容器，相当于关系型数据库中的表。集合中的文档可以具有不同的结构。
（3）数据库
数据库是集合的命名空间，相当于关系型数据库中的数据库，每个数据库包含集合、索引和一些元数据。
4. 存储引擎
MangoDB的默认存储引擎是 WiredTiger，支持文档级别的并发控制和压缩。除此之外，MangoDB还支持 MMAPv1（旧版本）和其他第三方存储引擎。
（1）WiredTiger存储引擎
① WiredTiger是MongoDB 3.2 版本开始默认的存储引擎，提供了更高的并发性、压缩和高效的内存使用。
② 特点
文档级锁定：WiredTiger 使用文档级锁定，提高了并发写操作的性能数据压缩：支持数据和索引压缩，减少磁盘空间的使用缓存管理：WiredTiger 使用自适应缓存管理，优化内存使用事务支持：提供多文档 ACID 事务支持，保证数据一致性（与InnoDB事务不相同）
③ 配置 storage: dbPath: /var/lib/mongodb engine: wiredTiger wiredTiger: engineConfig: cacheSizeGB: 1 statisticsLogDelaySecs: 0 journalCompressor: snappy collectionConfig: blockCompressor: snappy indexConfig: prefixCompression: true （2）MMAPv1 存储引擎">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T14:32:53+08:00">
    <meta property="article:modified_time" content="2024-06-26T14:32:53+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">秋招Java后端开发冲刺——非关系型数据库篇（MongoDB）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="MongoDB_0"></a>MongoDB</h4> 
<p>本文介绍非关系型数据库MongoDB的基础知识和常见面试题。<br> <img src="https://images2.imgbox.com/42/77/XR0WlnSL_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_4"></a>（一）基础知识</h5> 
<p><strong>1. 介绍</strong>：MongoDB是一个基于分布式文件存储的数据库，由C++语言编写，旨在为WEB应用提供可扩展的高性能数据存储解决方案。<br> <strong>2.特点</strong></p> 
<table><thead><tr><th>特点</th><th>说明</th></tr></thead><tbody><tr><td>文档存储</td><td>使用 BSON（二进制 JSON）格式存储文档，支持嵌套结构和数组。</td></tr><tr><td>灵活的模式（Schema-less）</td><td>支持动态模式设计，文档结构可以不固定，适合快速迭代开发。</td></tr><tr><td>高性能</td><td>通过内存映射文件和高效的索引机制，提供高性能读写操作。</td></tr><tr><td>高可用性</td><td>支持复制集（Replica Set），提供自动故障转移和数据冗余。</td></tr><tr><td>横向扩展</td><td>支持分片（Sharding）功能，通过分布式架构实现数据的水平扩展。</td></tr><tr><td>强一致性</td><td>默认提供强一致性保证，通过复制集配置可以调整一致性级别。</td></tr><tr><td>丰富的查询语言</td><td>提供丰富的查询语言，支持字段、范围、正则表达式查询以及聚合框架。</td></tr><tr><td>原子操作</td><td>支持单文档级别的原子操作，确保数据修改的一致性和完整性。</td></tr><tr><td>支持事务</td><td>4.0 版本开始支持多文档 ACID 事务，增强数据操作的可靠性。</td></tr><tr><td>跨平台</td><td>支持多种操作系统，包括 Windows、Linux 和 macOS。</td></tr><tr><td>易于集成</td><td>提供多种官方驱动程序，支持多种编程语言，如 JavaScript、Python、Java、C# 等。</td></tr><tr><td>强大的社区支持</td><td>拥有活跃的社区和丰富的文档资料，便于开发者学习和使用。</td></tr><tr><td>灵活的索引</td><td>支持多种类型的索引，如单字段索引、复合索引、地理空间索引和全文索引。</td></tr><tr><td>聚合框架</td><td>提供强大的聚合框架，支持数据处理和分析操作，如过滤、排序、分组、投影等。</td></tr><tr><td>文件存储</td><td>通过 GridFS 实现大文件存储，适用于存储图片、视频等大文件数据。</td></tr><tr><td>安全性</td><td>提供认证和授权机制，支持基于角色的访问控制（RBAC），确保数据安全。</td></tr><tr><td>备份与恢复</td><td>提供多种备份与恢复机制，包括快照备份、导入导出工具和云备份服务。</td></tr><tr><td>可视化工具</td><td>提供官方的 MongoDB Compass 可视化工具，便于管理和分析数据库。</td></tr></tbody></table> 
<p><strong>3. 存储结构</strong><br> <strong>（1）文档</strong><br> 文档是 MongoDB 的基本数据单位，使用 <strong>BSON</strong> 格式存储。每个文档包含键值对，类似于 JSON 对象.<br> <strong>注</strong>：BSON文档是JSON 文档的二进制表示<br> <strong>（2）集合</strong><br> 集合是一组文档的容器，相当于关系型数据库中的表。集合中的文档可以具有不同的结构。<br> <strong>（3）数据库</strong><br> 数据库是集合的命名空间，相当于关系型数据库中的数据库，每个数据库包含集合、索引和一些元数据。</p> 
<p><strong>4. 存储引擎</strong><br> MangoDB的默认存储引擎是 WiredTiger，支持文档级别的并发控制和压缩。除此之外，MangoDB还支持 MMAPv1（旧版本）和其他第三方存储引擎。<br> <strong>（1）WiredTiger存储引擎</strong><br> ① WiredTiger是MongoDB 3.2 版本开始默认的存储引擎，提供了更高的并发性、压缩和高效的内存使用。<br> <strong>② 特点</strong></p> 
<ul><li>文档级锁定：WiredTiger 使用文档级锁定，提高了并发写操作的性能</li><li>数据压缩：支持数据和索引压缩，减少磁盘空间的使用</li><li>缓存管理：WiredTiger 使用自适应缓存管理，优化内存使用</li><li>事务支持：提供多文档 ACID 事务支持，保证数据一致性（与InnoDB事务不相同）<br> ③ 配置</li></ul> 
<pre><code class="prism language-bash">storage:
  dbPath: /var/lib/mongodb
  engine: wiredTiger
  wiredTiger:
    engineConfig:
      cacheSizeGB: <span class="token number">1</span>
      statisticsLogDelaySecs: <span class="token number">0</span>
      journalCompressor: snappy
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: <span class="token boolean">true</span>
</code></pre> 
<p><strong>（2）MMAPv1 存储引擎</strong><br> ① MMAPv1 是 MongoDB 的原始存储引擎，在 MongoDB 3.0 之前是默认存储引擎，它使用内存映射文件来存储数据。<br> <strong>② 特点</strong></p> 
<ul><li>集合级锁定：MMAPv1 使用集合级锁定，适用于读操作较多的场景。</li><li>简单实现：设计简单，适合需要快速读取的大量数据<br> ③ 配置</li></ul> 
<pre><code class="prism language-bash">storage:
  dbPath: /var/lib/mongodb
  engine: mmapv1
  mmapv1:
    nsSize: <span class="token number">16</span>
    smallFiles: <span class="token boolean">true</span>
    journal:
      enabled: <span class="token boolean">true</span>
</code></pre> 
<p><strong>（3）In-Memory 存储引擎</strong>（（在 MongoDB Enterprise 中可用））<br> ① In-Memory 存储引擎将所有数据存储在内存中，适用于需要极高性能和低延迟的场景。<br> <strong>② 特点</strong></p> 
<ul><li>高性能：由于数据全部存储在内存中，读写操作速度极快。</li><li>无持久化：数据仅在内存中存储，服务器重启后数据会丢失。<br> ③ 配置</li></ul> 
<pre><code class="prism language-bash">storage:
  dbPath: /var/lib/mongodb
  engine: inMemory
  inMemory:
    engineConfig:
      inMemorySizeGB: <span class="token number">2</span>
</code></pre> 
<p><strong>5. 索引</strong></p> 
<ul><li>单字段索引</li><li>复合索引：遵循最左前缀原则</li><li>多键索引：MongoDB 的一个字段可能是数组，在对这种字段创建索引时，就是多键索引；多键索引为数组中每一个值创建索引</li><li>哈希索引：按数据的哈希值索引，用在哈希分片集群上</li><li>文本索引： 支持对字符串内容的文本搜索查询，一个集合一个</li><li>TTL索引：参考<a href="https://blog.csdn.net/qq_50604294/article/details/139963293?spm=1001.2014.3001.5501">MongoDB索引</a></li><li>地理位置索引</li></ul> 
<h5><a id="_105"></a>（二）常见面试题</h5> 
<p><strong>1. MongoDB 集群</strong><br> （1）复制集群</p> 
<ul><li>是一组维护相同数据集合的 mongodb 进程</li><li>组成：包含 1 个主节点（Primary），多个从节点（Secondary）以及零个或 1 个仲裁节点（Arbiter）</li><li>主节点负责写和读，从节点负责读，仲裁节点不存储数据，只负责选举时投票</li><li>主节点与备节点之间是通过 oplog（操作日志） 来同步数据的（ local 库下的一个特殊的 上限集合(Capped Collection) ，用来保存写操作所产生的增量日志）</li></ul> 
<p>（2）分片集群</p> 
<ul><li>数据被均衡的分布在不同分片中</li><li>组成<br> ① Config Servers：配置服务器，本质上是一个 MongoDB 的副本集，负责存储集群的各种元数据和配置，如分片地址、Chunks 等<br> ② Mongos：路由服务，不存具体数据，从 Config 获取集群配置讲请求转发到特定的分片，并且整合分片结果返回给客户端<br> ③ Shard：每个分片是整体数据的一部分子集</li><li>分片算法<br> ① 基于范围的分片：适合分片键的值不是单调递增或单调递减、分片键的值基数大且重复的频率低、需要范围查询等业务场景。<br> ② 基于 Hash 值的分片：适合分片键的值存在单调递增或递减、片键的值基数大且重复的频率低、需要写入的数据随机分发、数据读取随机性较大等业务场景。</li></ul> 
<p><strong>2. MongoDB聚合</strong><br> <strong>（1）介绍</strong><br> ① MongoDB 的聚合框架是一个强大的工具，用于处理数据并生成汇总结果。它允许在文档集合上执行复杂的数据处理和分析操作。<br> ② <strong>聚合管道</strong>：是一系列数据处理阶段的组合，每个阶段会对输入文档进行操作，并将结果传递给下一个阶段。</p> 
<p><strong>（2）聚合管道常用阶段操作符</strong></p> 
<ul><li>$match：过滤文档，类似于查询的 find 操作</li><li>$group：将文档分组，并可对每个分组进行计算</li><li>$sort：对文档排序</li><li>$project：重新定义文档的结构，可以添加、删除字段</li><li>$limit：限制返回的文档数量</li><li>$skip：跳过指定数量的文档</li><li>$unwind：将数组类型字段拆分为多个文档</li></ul> 
<p><strong>（3）聚合框架的性能优化</strong></p> 
<ul><li><strong>使用索引</strong>：在 $match 阶段尽量使用索引，以提高过滤数据的速度</li><li><strong>限制返回数据量</strong>：使用 $limit 和 $skip 控制返回的数据量，避免一次性处理大量数据</li><li><strong>简化管道阶段</strong>：尽量减少管道阶段的数量，每个阶段只处理必要的数据</li><li><strong>适当使用 $project</strong>：在数据进入聚合管道时尽早使用 $project 只保留需要的字段，以减少数据传递的开销</li></ul> 
<p><strong>3. MongoDB的数据备份和恢复</strong><br> （1）备份</p> 
<ul><li>mongodump 命令将 MongoDB 数据导出为 BSON 格式的文件</li><li>可以备份整个数据库或指定的集合</li><li>示例</li></ul> 
<pre><code class="prism language-bash">mongodump <span class="token parameter variable">--db</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> <span class="token parameter variable">--out</span> <span class="token operator">&lt;</span>backup_directory<span class="token operator">&gt;</span>
</code></pre> 
<p>（2）恢复</p> 
<ul><li>mongorestore 命令将 BSON 文件导入到 MongoDB 中，用于恢复数据</li><li>示例</li></ul> 
<pre><code class="prism language-bash">mongorestore <span class="token parameter variable">--db</span> <span class="token operator">&lt;</span>database_name<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>backup_directory<span class="token operator">&gt;</span>
</code></pre> 
<p>（3）文件级备份</p> 
<ul><li>通过复制 MongoDB 数据存储文件来实现，适用于使用 WiredTiger 存储引擎的 MongoDB 数据库</li><li>步骤<br> ① 锁定数据库：使用 fsync 锁定数据库以确保数据一致性<br> ② 复制数据文件：复制 MongoDB 数据存储文件<br> ③ 解锁数据库：解锁数据库</li></ul> 
<p><strong>4. MongoDB事务</strong></p> 
<ul><li>MongoDB 在 4.0 版本开始支持多文档 ACID 事务，使其在操作多个文档和集合时能够保证数据的一致性。</li><li>复制集环境：MongoDB 的多文档事务需要在复制集环境中才能使用。</li><li>跨分片事务：MongoDB 4.2 及以上版本支持跨分片事务，但需要配置分片集群。</li></ul> 
<p><strong>5. 如何处理 MongoDB 中的慢查询</strong><br> <strong>（1）慢查询日志</strong></p> 
<ul><li>MongoDB 具有内置的慢查询日志功能，可以记录超过指定时间的查询。配置方法如下：</li></ul> 
<pre><code class="prism language-bash"><span class="token comment"># mongod.conf</span>
operationProfiling:
  slowOpThresholdMs: <span class="token number">100</span> <span class="token comment"># 设置慢查询阈值为 100 毫秒</span>
  mode: slowOp
</code></pre> 
<ul><li>db.currentOp() ：可以查看当前正在执行的操作，包括运行时间长的查询</li><li>db.system.profile：数据库的性能分析器，捕获详细的操作信息</li></ul> 
<p><strong>（2）慢查询分析</strong><br> 使用 explain() 分析查询计划，帮助分析查询是如何执行的，包括使用的索引、扫描的文档数等</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f6fcf84e2c3a7cd66f923d3d113512da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CMakeList整理大全</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/507aaf4d8e42d60de9f3bce24122e72e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">万字详解Kafka并附带go操作Kafka</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>