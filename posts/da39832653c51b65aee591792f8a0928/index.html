<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#使用Asp.Net创建Web Service接口并调用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/da39832653c51b65aee591792f8a0928/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C#使用Asp.Net创建Web Service接口并调用">
  <meta property="og:description" content="目录
一.创建Asp.net web应用以及Web Service服务
(1).运行环境
(2)创建项目
二.创建控制台应用来调用上面创建的Web Service
一.创建Asp.net web应用以及Web Service服务 (1).运行环境 开发工具: Visual Studio 2022 Current (免费社区版)
框架版本: .net framework4.7.2,更高的.net 5 、net6貌似没有默认提供带web service的asp.net 应用模板了。
确保VS的工作负荷有勾选下方箭头所指的模块
确认环境没有问题之后就可以开始创建项目了。
(2)创建项目 打开vs点创建新项目
选择箭头指向的项目模板，注意是.NET Framework后缀的，带Core的都是版本比较新的框架项目模板，选择好之后点击下一步选择项目存放的路径以及项目命名、解决方案命名、框架版本，
我这里就用默认的命名了，框架我选.net framework 4.7.2，然后点击创建即可开始下一步。
点击创建进去会出来一个模板进一步的配置，因为我这也只是整个Web Service接口来而已就选空模板，直接在本机跑也不需要Docker之类的
搞定之后直接创建，创建完成后右键项目点添加-&gt;新建项-&gt;找到Web 服务(AMSX),选择之后点添加就能创建一个web service默认的hello world模板
加上之后直接启动就可以看到一个网页的服务说明以及对应方法的测试路由,以及对应的方法
在调试模式下可以直接通过上面的调用按钮调用指定的方法，这里点一下调用会返回一个xml并转换成网页
打包之后这个操作就不支持了，到这里创建就算完成了。
这里因为打开的文档就是刚刚创建的web服务所以vs会直接把路由跳到这里，如果当前打开的文档不是创建的WebService1类运行起来就会报服务器没有开启目录浏览，所以要像下面设置一下项目属性。
二.创建控制台应用来调用上面创建的Web Service 直接右键解决方案添加一个控制台应用,这里我用HttpClinet类所以用的框架版本是.net 6
且使用顶级语句，因为就几句话emmmm,发送报文运行一下web服务把报文copy下来就好。
本地测试的时候可以用http直接调用，虽然不知道为什么部署到服务器之后就只能通过Soap协议丢xml报文来调了。下面是代码报文是运行一下web服务把对应方法的post请求直接copy下来
返回的就是一坨xml,箭头指的就是方法返回的Hello world，可以用.net自带的linq来解析很方便,命名空间是这个
using System.Xml.Linq;
这是上面运行的代码。
using System.Net.Http.Headers; var clinet = new HttpClient(); var xml = &#34;&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;utf-8\&#34;?&gt;&#34; &#43; &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-21T19:02:23+08:00">
    <meta property="article:modified_time" content="2023-10-21T19:02:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#使用Asp.Net创建Web Service接口并调用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80.%E5%88%9B%E5%BB%BAAsp.net%20web%E5%BA%94%E7%94%A8%E4%BB%A5%E5%8F%8AWeb%20Service%E6%9C%8D%E5%8A%A1-toc" style="margin-left:0px;"><a href="#%E4%B8%80.%E5%88%9B%E5%BB%BAAsp.net%20web%E5%BA%94%E7%94%A8%E4%BB%A5%E5%8F%8AWeb%20Service%E6%9C%8D%E5%8A%A1" rel="nofollow">一.创建Asp.net web应用以及Web Service服务</a></p> 
<p id="(1).%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#%281%29.%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83" rel="nofollow">(1).运行环境</a></p> 
<p id="(2)%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE-toc" style="margin-left:40px;"><a href="#%282%29%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE" rel="nofollow">(2)创建项目</a></p> 
<p id="%E4%BA%8C.%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%A5%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E5%88%9B%E5%BB%BA%E7%9A%84Web%20Service-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%A5%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E5%88%9B%E5%BB%BA%E7%9A%84Web%20Service" rel="nofollow">二.创建控制台应用来调用上面创建的Web Service</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80.%E5%88%9B%E5%BB%BAAsp.net%20web%E5%BA%94%E7%94%A8%E4%BB%A5%E5%8F%8AWeb%20Service%E6%9C%8D%E5%8A%A1" style="background-color:transparent;">一.创建Asp.net web应用以及Web Service服务</h2> 
<h3 id="(1).%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83" style="background-color:transparent;">(1).运行环境</h3> 
<p>开发工具: Visual Studio 2022 Current (免费社区版)</p> 
<p>框架版本: .net framework4.7.2,更高的.net 5 、net6貌似没有默认提供带web service的asp.net 应用模板了。</p> 
<p>确保VS的工作负荷有勾选下方箭头所指的模块</p> 
<p><img alt="" height="263" src="https://images2.imgbox.com/9f/36/iL6e7wUu_o.png" width="497"></p> 
<p>确认环境没有问题之后就可以开始创建项目了。</p> 
<h3 id="(2)%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE" style="background-color:transparent;">(2)创建项目</h3> 
<p>打开vs点创建新项目</p> 
<p><img alt="" height="619" src="https://images2.imgbox.com/5d/8e/JOaOKw3Y_o.png" width="1001"></p> 
<p>选择箭头指向的项目模板，注意是.NET Framework后缀的，带Core的都是版本比较新的框架项目模板，选择好之后点击下一步选择项目存放的路径以及项目命名、解决方案命名、框架版本，</p> 
<p>我这里就用默认的命名了，框架我选.net framework 4.7.2，然后点击创建即可开始下一步。</p> 
<p><img alt="" height="630" src="https://images2.imgbox.com/2e/43/TDzxh127_o.png" width="990"></p> 
<p>点击创建进去会出来一个模板进一步的配置，因为我这也只是整个Web Service接口来而已就选空模板，直接在本机跑也不需要Docker之类的</p> 
<p><img alt="" height="682" src="https://images2.imgbox.com/52/de/Bhpcvd9g_o.png" width="957"></p> 
<p>搞定之后直接创建，创建完成后右键项目点添加-&gt;新建项-&gt;找到Web 服务(AMSX),选择之后点添加就能创建一个web service默认的hello world模板</p> 
<p><img alt="" height="729" src="https://images2.imgbox.com/74/bb/5iBApGPh_o.png" width="1021"></p> 
<p><img alt="" height="727" src="https://images2.imgbox.com/3b/df/Eb6956SS_o.png" width="1200"></p> 
<p>加上之后直接启动就可以看到一个网页的服务说明以及对应方法的测试路由,以及对应的方法</p> 
<p><img alt="" height="792" src="https://images2.imgbox.com/19/4f/PILVHcD7_o.png" width="1005"><img alt="" height="1007" src="https://images2.imgbox.com/05/83/6p5V8FnE_o.png" width="1200"></p> 
<p>在调试模式下可以直接通过上面的调用按钮调用指定的方法，这里点一下调用会返回一个xml并转换成网页<img alt="" height="339" src="https://images2.imgbox.com/64/cb/K8J6oaWh_o.png" width="1200"></p> 
<p>打包之后这个操作就不支持了，到这里创建就算完成了。</p> 
<p>这里因为打开的文档就是刚刚创建的web服务所以vs会直接把路由跳到这里，如果当前打开的文档不是创建的WebService1类运行起来就会报服务器没有开启目录浏览，所以要像下面设置一下项目属性。</p> 
<p><img alt="" height="951" src="https://images2.imgbox.com/13/c5/traMt2HF_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<h2 id="%E4%BA%8C.%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%BA%94%E7%94%A8%E6%9D%A5%E8%B0%83%E7%94%A8%E4%B8%8A%E9%9D%A2%E5%88%9B%E5%BB%BA%E7%9A%84Web%20Service" style="background-color:transparent;">二.创建控制台应用来调用上面创建的Web Service</h2> 
<p>直接右键解决方案添加一个控制台应用,这里我用HttpClinet类所以用的框架版本是.net 6</p> 
<p>且使用顶级语句，因为就几句话emmmm,发送报文运行一下web服务把报文copy下来就好。</p> 
<p>本地测试的时候可以用http直接调用，虽然不知道为什么部署到服务器之后就只能通过Soap协议丢xml报文来调了。下面是代码报文是运行一下web服务把对应方法的post请求直接copy下来</p> 
<p><img alt="" height="675" src="https://images2.imgbox.com/08/d5/g7IjgCMr_o.png" width="1200"></p> 
<p>返回的就是一坨xml,箭头指的就是方法返回的Hello world，可以用.net自带的linq来解析很方便,命名空间是这个</p> 
<p>using System.Xml.Linq;</p> 
<p>这是上面运行的代码。</p> 
<pre><code class="language-cs">using System.Net.Http.Headers;

var clinet = new HttpClient();
var xml = "&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;" +
    "\r\n&lt;soap12:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" " +
    "xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap12=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\r\n" +
    "  &lt;soap12:Body&gt;\r\n    &lt;HelloWorld xmlns=\"http://tempuri.org/\" /&gt;\r\n " +
    " &lt;/soap12:Body&gt;\r\n&lt;/soap12:Envelope&gt;";//把请求xml直接copy下来
var httpcotent = new StringContent(xml);//创建一个http字符报文实例,把上面的报文丢进去当正文
httpcotent.Headers.ContentType = MediaTypeHeaderValue.Parse(" application/soap+xml; charset=utf-8");//设置报文的内容标头，一样上启动的页面上copy下来，soap1.1、soap1.2都一样，我这里用的是Soap1.2
var respon = await clinet.PostAsync(requestUri: "http://localhost:56298/WebService1.asmx?op=HelloWorld", content: httpcotent);//uri一样上去打开那个方法从浏览器copy下来
Console.WriteLine(await respon.Content.ReadAsStringAsync());//异步读取服务器返回的所有数据并且转成字符串,这里回复的会是一个xml文本
Console.ReadKey();</code></pre> 
<p>下面是使用XDocument类进行解析xml数据的代码</p> 
<p><img alt="" height="505" src="https://images2.imgbox.com/fc/77/q9k0nf08_o.png" width="1200"></p> 
<pre><code class="language-cs">using System.Net.Http.Headers;
using System.Xml.Linq;

var clinet = new HttpClient();
var xml = "&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;" +
    "\r\n&lt;soap12:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" " +
    "xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap12=\"http://www.w3.org/2003/05/soap-envelope\"&gt;\r\n" +
    "  &lt;soap12:Body&gt;\r\n    &lt;HelloWorld xmlns=\"http://tempuri.org/\" /&gt;\r\n " +
    " &lt;/soap12:Body&gt;\r\n&lt;/soap12:Envelope&gt;";//把请求xml直接copy下来
var httpcotent = new StringContent(xml);//创建一个http字符报文实例,把上面的报文丢进去当正文
httpcotent.Headers.ContentType = MediaTypeHeaderValue.Parse(" application/soap+xml; charset=utf-8");//设置报文的内容标头，一样上启动的页面上copy下来，soap1.1、soap1.2都一样，我这里用的是Soap1.2
var respon = await clinet.PostAsync(requestUri: "http://localhost:56298/WebService1.asmx?op=HelloWorld", content: httpcotent);//uri一样上去打开那个方法从浏览器copy下来
var responstr = await respon.Content.ReadAsStringAsync();
Console.WriteLine(responstr);//异步读取服务器返回的所有数据并且转成字符串,这里回复的会是一个xml文本
Console.ReadKey();
Console.WriteLine("下面用XDocument来取返回的值Hello World");
var xd = XDocument.Parse(responstr);//将返回的xml文本转换成XDocument对象
Console.WriteLine(xd.Root?.Value);//因为直接就是一个节点就不用Find了直接root.value
Console.ReadKey();</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9041da3d121c3329e43dc7286575fb8c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">我的数据仓库与数据挖掘期末大作业重置版</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/37ea205afdf743d93ed9eb0f7a5d0d57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">超详细 | 差分进化算法原理及其实现(Matlab/Python)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>