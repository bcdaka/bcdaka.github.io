<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot 整合多 Redis 数据源配置及操作 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/218ea4919c0d9e8b2b2e5a2bbd6b03da/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spring Boot 整合多 Redis 数据源配置及操作">
  <meta property="og:description" content="Spring Boot 整合多 Redis 数据源配置及操作 简介 本文档介绍了如何在Spring Boot应用程序中配置和操作多个Redis数据源。通过配置多个RedisConnectionFactory和RedisTemplate，可以实现对多个Redis数据源的整合，以便在应用程序中灵活地使用不同的Redis实例。
以下是本文档的主要内容：
添加依赖：介绍了在pom.xml文件中添加Spring Boot和Redis相关依赖的步骤。配置多个Redis数据源：说明了如何在application.properties或application.yml中配置多个Redis数据源的连接信息。创建多个RedisConnectionFactory：展示了在配置类中创建多个RedisConnectionFactory的Bean，并分别指定不同连接信息的步骤。创建多个RedisTemplate：介绍了根据不同的RedisConnectionFactory创建对应的RedisTemplate的步骤。使用多个RedisTemplate进行操作：说明了在需要使用Redis的地方，如何注入对应的RedisTemplate，并使用它们来操作不同的Redis数据源。 通过本文档的指导，您将能够轻松地在Spring Boot应用程序中实现对多个Redis数据源的整合配置和操作，从而满足不同业务场景下对多个Redis实例的需求。
代码实现 配置POM依赖 &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;/dependency&gt; 配置多个Redis数据源 spring: redis: host: localhost port: 6379 database: 0 password: 123456 lettuce: # 使用Lettuce作为Redis的客户端 pool: # 连接池 max-active: 32 # 最大的活跃连接数 max-wait: 300 # 获取连接的最大等待时间 max-idle: 16 # 最大的空闲连接数 min-idle: 8 # 最小的空闲连接数 redis-node02: host: localhost port: 6379 database: 1 password: 123456 lettuce: pool: max-active: 16 max-wait: 100 max-idle: 8 min-idle: 4 创建多个Redis连接配置 读取配置信息初始化ConnectionFactory创建RedisTemplate实例 @Configuration public class RedisAutoConfig { @Bean @Primary public LettuceConnectionFactory defaultLettuceConnectionFactory(RedisStandaloneConfiguration defaultRedisConfig, GenericObjectPoolConfig defaultPoolConfig) { LettuceClientConfiguration clientConfig = LettucePoolingClientConfiguration.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-04T14:54:19+08:00">
    <meta property="article:modified_time" content="2024-01-04T14:54:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot 整合多 Redis 数据源配置及操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Spring_Boot__Redis__0"></a>Spring Boot 整合多 Redis 数据源配置及操作</h2> 
<h3><a id="_2"></a>简介</h3> 
<p>本文档介绍了如何在Spring Boot应用程序中配置和操作多个Redis数据源。通过配置多个RedisConnectionFactory和RedisTemplate，可以实现对多个Redis数据源的整合，以便在应用程序中灵活地使用不同的Redis实例。</p> 
<p>以下是本文档的主要内容：</p> 
<ul><li>添加依赖：介绍了在pom.xml文件中添加Spring Boot和Redis相关依赖的步骤。</li><li>配置多个Redis数据源：说明了如何在application.properties或application.yml中配置多个Redis数据源的连接信息。</li><li>创建多个RedisConnectionFactory：展示了在配置类中创建多个RedisConnectionFactory的Bean，并分别指定不同连接信息的步骤。</li><li>创建多个RedisTemplate：介绍了根据不同的RedisConnectionFactory创建对应的RedisTemplate的步骤。</li><li>使用多个RedisTemplate进行操作：说明了在需要使用Redis的地方，如何注入对应的RedisTemplate，并使用它们来操作不同的Redis数据源。</li></ul> 
<p>通过本文档的指导，您将能够轻松地在Spring Boot应用程序中实现对多个Redis数据源的整合配置和操作，从而满足不同业务场景下对多个Redis实例的需求。</p> 
<h3><a id="_16"></a>代码实现</h3> 
<h4><a id="POM_17"></a>配置POM依赖</h4> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>redis<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
    <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>commons<span class="token operator">-</span>pool2<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="Redis_30"></a>配置多个Redis数据源</h4> 
<pre><code class="prism language-java">spring<span class="token operator">:</span>
  redis<span class="token operator">:</span>
    host<span class="token operator">:</span> localhost
    port<span class="token operator">:</span> <span class="token number">6379</span>
    database<span class="token operator">:</span> <span class="token number">0</span>
    password<span class="token operator">:</span> <span class="token number">123456</span>
    lettuce<span class="token operator">:</span> # 使用<span class="token class-name">Lettuce</span>作为<span class="token class-name">Redis</span>的客户端
      pool<span class="token operator">:</span> # 连接池
        max<span class="token operator">-</span>active<span class="token operator">:</span> <span class="token number">32</span> # 最大的活跃连接数
        max<span class="token operator">-</span>wait<span class="token operator">:</span> <span class="token number">300</span> # 获取连接的最大等待时间
        max<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">16</span> # 最大的空闲连接数
        min<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">8</span> # 最小的空闲连接数
  redis<span class="token operator">-</span>node02<span class="token operator">:</span>
    host<span class="token operator">:</span> localhost
    port<span class="token operator">:</span> <span class="token number">6379</span>
    database<span class="token operator">:</span> <span class="token number">1</span>
    password<span class="token operator">:</span> <span class="token number">123456</span>
    lettuce<span class="token operator">:</span>
      pool<span class="token operator">:</span>
        max<span class="token operator">-</span>active<span class="token operator">:</span> <span class="token number">16</span>
        max<span class="token operator">-</span>wait<span class="token operator">:</span> <span class="token number">100</span>
        max<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">8</span>
        min<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">4</span>
</code></pre> 
<h4><a id="Redis_57"></a>创建多个Redis连接配置</h4> 
<ul><li>读取配置信息</li><li>初始化ConnectionFactory</li><li>创建RedisTemplate实例</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceConnectionFactory</span> <span class="token function">defaultLettuceConnectionFactory</span><span class="token punctuation">(</span><span class="token class-name">RedisStandaloneConfiguration</span> defaultRedisConfig<span class="token punctuation">,</span>
                                                                    <span class="token class-name">GenericObjectPoolConfig</span> defaultPoolConfig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LettuceClientConfiguration</span> clientConfig <span class="token operator">=</span>
                <span class="token class-name">LettucePoolingClientConfiguration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">poolConfig</span><span class="token punctuation">(</span>defaultPoolConfig<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>defaultRedisConfig<span class="token punctuation">,</span> clientConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">defaultRedisTemplate</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"defaultLettuceConnectionFactory"</span><span class="token punctuation">)</span> <span class="token class-name">LettuceConnectionFactory</span> defaultLettuceConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>defaultLettuceConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"node02RedisConfig"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceConnectionFactory</span> <span class="token function">node02LettuceConnectionFactory</span><span class="token punctuation">(</span><span class="token class-name">RedisStandaloneConfiguration</span> node02RedisConfig<span class="token punctuation">,</span>
                                                                    <span class="token class-name">GenericObjectPoolConfig</span> node02PoolConfig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LettuceClientConfiguration</span> clientConfig <span class="token operator">=</span>
                <span class="token class-name">LettucePoolingClientConfiguration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commandTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">poolConfig</span><span class="token punctuation">(</span>node02PoolConfig<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>node02RedisConfig<span class="token punctuation">,</span> clientConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"node02LettuceConnectionFactory"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">node02RedisTemplate</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"node02LettuceConnectionFactory"</span><span class="token punctuation">)</span> <span class="token class-name">LettuceConnectionFactory</span> node02LettuceConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>node02LettuceConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 默认配置
     */</span>
    <span class="token annotation punctuation">@Configuration</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DefaultRedisConfig</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.host:127.0.0.1}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.port:6379}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.password:}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.database:0}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> database<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.lettuce.pool.max-active:8}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> maxActive<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.lettuce.pool.max-wait:-1}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> maxWait<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.lettuce.pool.max-idle:8}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> maxIdle<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.lettuce.pool.min-idle:0}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> minIdle<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token keyword">public</span> <span class="token class-name">GenericObjectPoolConfig</span> <span class="token function">defaultPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">GenericObjectPoolConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span>maxActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span>maxWait<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span>maxIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> config<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token keyword">public</span> <span class="token class-name">RedisStandaloneConfiguration</span> <span class="token function">defaultRedisConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RedisStandaloneConfiguration</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">RedisPassword</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> config<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * Node02配置
     */</span>
    <span class="token annotation punctuation">@Configuration</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node02RedisConfig</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.host:127.0.0.1}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.port:6379}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.password:}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.database:0}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> database<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.lettuce.pool.max-active:8}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> maxActive<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.lettuce.pool.max-wait:-1}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Long</span> maxWait<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.lettuce.pool.max-idle:8}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> maxIdle<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis-node02.lettuce.pool.min-idle:0}"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> minIdle<span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token keyword">public</span> <span class="token class-name">GenericObjectPoolConfig</span> <span class="token function">node02PoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">GenericObjectPoolConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPoolConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxTotal</span><span class="token punctuation">(</span>maxActive<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxWaitMillis</span><span class="token punctuation">(</span>maxWait<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMaxIdle</span><span class="token punctuation">(</span>maxIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setMinIdle</span><span class="token punctuation">(</span>minIdle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> config<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Bean</span>
        <span class="token keyword">public</span> <span class="token class-name">RedisStandaloneConfiguration</span> <span class="token function">node02RedisConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RedisStandaloneConfiguration</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisStandaloneConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setHostName</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">RedisPassword</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            config<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span>database<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> config<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>如果不借助<code>@Primary</code>来指定默认的连接工厂，就会报错如下打印信息：</p> 
<pre><code class="prism language-java"><span class="token class-name">Description</span><span class="token operator">:</span>

<span class="token class-name">Parameter</span> <span class="token number">0</span> of method reactiveRedisTemplate in <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span></span>RedisReactiveAutoConfiguration</span> required a single bean<span class="token punctuation">,</span> but <span class="token number">2</span> were found<span class="token operator">:</span>
	<span class="token operator">-</span> defaultLettuceConnectionFactory<span class="token operator">:</span> defined by method 'defaultLettuceConnectionFactory' in <span class="token keyword">class</span> path resource <span class="token punctuation">[</span>com<span class="token operator">/</span>itwenke<span class="token operator">/</span>springbootdemo<span class="token operator">/</span>redismultiple<span class="token operator">/</span>config<span class="token operator">/</span><span class="token class-name">RedisAutoConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">]</span>
	<span class="token operator">-</span> node02LettuceConnectionFactory<span class="token operator">:</span> defined by method 'node02LettuceConnectionFactory' in <span class="token keyword">class</span> path resource <span class="token punctuation">[</span>com<span class="token operator">/</span>itwenke<span class="token operator">/</span>springbootdemo<span class="token operator">/</span>redismultiple<span class="token operator">/</span>config<span class="token operator">/</span><span class="token class-name">RedisAutoConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">]</span>


<span class="token class-name">Action</span><span class="token operator">:</span>

<span class="token class-name">Consider</span> marking one of the beans as <span class="token annotation punctuation">@Primary</span><span class="token punctuation">,</span> updating the consumer <span class="token keyword">to</span> <span class="token namespace">accept</span> multiple beans<span class="token punctuation">,</span> or using <span class="token annotation punctuation">@Qualifier</span> <span class="token keyword">to</span> <span class="token namespace">identify</span> the bean that should be consumed
</code></pre> 
<h4><a id="RedisTemplate_209"></a>使用多个RedisTemplate进行操作</h4> 
<ul><li>写操作</li><li>读操作</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"api/test"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> defaultRedisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> node02RedisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"set"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        defaultRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        node02RedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>path <span class="token operator">=</span> <span class="token string">"get"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> value1 <span class="token operator">=</span> defaultRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> value2 <span class="token operator">=</span> node02RedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"value1 = "</span> <span class="token operator">+</span> value1 <span class="token operator">+</span> <span class="token string">", value2 = "</span> <span class="token operator">+</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_240"></a>开始测试</h3> 
<h4><a id="_241"></a>查询数据库</h4> 
<p>数据库0和1都为空，因为还没添加数据</p> 
<p><img src="https://images2.imgbox.com/d4/d6/zDl7nMU7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="set_246"></a>执行set写操作</h4> 
<p><a href="http://localhost:8080/api/test/set" rel="nofollow">http://localhost:8080/api/test/set</a></p> 
<p>可以查看到数据库0和1都添加了对应的数据</p> 
<p><img src="https://images2.imgbox.com/e6/f1/y9YdlCEG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="get_253"></a>执行get读操作</h4> 
<p><a href="http://localhost:8080/api/test/get" rel="nofollow">http://localhost:8080/api/test/get</a></p> 
<p>控制台打印信息：<code>value1 = value1, value2 = value2</code></p> 
<p><img src="https://images2.imgbox.com/d8/9b/PHqxD82y_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/886b971a6c6472239ad376c733d0c19f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python（wordcloud）：根据文本数据（.txt文件）绘制词云图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1dca94651f6d8072da1efc107d5b813e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">工具篇--SpringBoot与SpringCloud 的版本对应关系&amp;SpringBoot与JDK对应关系（官网文档解释）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>