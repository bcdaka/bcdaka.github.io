<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java的23种设计模式 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/01b8f3b3aa9ab0055cf79e539c68f010/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Java的23种设计模式">
  <meta property="og:description" content="Java的23种设计模式 一、创建型设计模式1.单例模式 singleton1.1.静态属性单例模式1.2 静态属性变种1.3 基础的懒汉模式1.4 线程安全的懒加载单例1.5 线程安全的懒加载 单例-改进1.6 双重检查锁1.7 静态内部类1.8 枚举单例1.9 注册表单例 2.工厂方法模式 factory3.抽象工厂模式 factory4.建造者模式 builder5.原型模式 prototype 二、结构型设计模式1.适配器模式 adapter1.1 类适配器模式1.2 对象适配器模式（接口适配器） 2.桥接模式 bridge3.组合模式：Composite /ˈkɒmpəzɪt/4.装饰模式 Decorator /ˈdekəreɪtə(r)/5.代理模式 proxy5.1 静态代理5.2 JDK动态代理5.3 CGLIB动态代理 6.外观模式 facade /fəˈsɑːd/7.享元模式 Flyweight /ˈflaɪweɪt/ 三、行为型设计模式1.解释器模式2.模版方法模式 template method3.责任链模式 chain of responsibility4.命令模式 command5.迭代器模式 iterator6.中介者模式 mediator /ˈmiːdieɪtə(r)/7.备忘录模式 memento /məˈmentəʊ/8.观察者模式 observer /əbˈzɜːvə(r)/9.状态模式 state10.策略模式 strategy /ˈstrætədʒi/11.访问者模式 visitor 设计模式就是对优良设计的总结，固化下来的写法，是业界公认的优雅设计。 一、创建型设计模式 1.单例模式 singleton 单例模式常见的不同写法有八种之多，真正完美无缺的只有一种枚举单例。其他单例都存在些许问题，但一般不会有人去用枚举来写单例，因为很怪，本来只是要搞个单例结果整了个枚举，我也不是太偏向这么写，一般使用：双重检查锁、静态内部类、静态属性三种写法都是可以接受的。我们经常使用的Spring框架的单例模式是从静态属性的单例模式变化而来，被称为注册表单例模式，后面也会说下。
1.1.静态属性单例模式 加载方式：饿汉
优势：无线程安全问题
唯一缺点：饿汉加载，存在加载不使用的可能，不使用则浪费内存（感觉其实不是事）
public class Single1 { private static final Single1 singleton = new Single1(); // 核心点是私有化构造器，让外部无法进行新对象创建 private Single1() { } public static Single1 getInstance() { return singleton; } } 1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-23T17:49:27+08:00">
    <meta property="article:modified_time" content="2024-01-23T17:49:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java的23种设计模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Java的23种设计模式</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、创建型设计模式</a></li><li><ul><li><a href="#1_singleton_3" rel="nofollow">1.单例模式 singleton</a></li><li><ul><li><a href="#11_5" rel="nofollow">1.1.静态属性单例模式</a></li><li><a href="#12__22" rel="nofollow">1.2 静态属性变种</a></li><li><a href="#13__45" rel="nofollow">1.3 基础的懒汉模式</a></li><li><a href="#14__76" rel="nofollow">1.4 线程安全的懒加载单例</a></li><li><a href="#15___95" rel="nofollow">1.5 线程安全的懒加载 单例-改进</a></li><li><a href="#16__116" rel="nofollow">1.6 双重检查锁</a></li><li><a href="#17__142" rel="nofollow">1.7 静态内部类</a></li><li><a href="#18__161" rel="nofollow">1.8 枚举单例</a></li><li><a href="#19__181" rel="nofollow">1.9 注册表单例</a></li></ul> 
   </li><li><a href="#2_factory_211" rel="nofollow">2.工厂方法模式 factory</a></li><li><a href="#3_factory_256" rel="nofollow">3.抽象工厂模式 factory</a></li><li><a href="#4_builder_292" rel="nofollow">4.建造者模式 builder</a></li><li><a href="#5_prototype_345" rel="nofollow">5.原型模式 prototype</a></li></ul> 
  </li><li><a href="#_408" rel="nofollow">二、结构型设计模式</a></li><li><ul><li><a href="#1_adapter_410" rel="nofollow">1.适配器模式 adapter</a></li><li><ul><li><a href="#11__412" rel="nofollow">1.1 类适配器模式</a></li><li><a href="#12__465" rel="nofollow">1.2 对象适配器模式（接口适配器）</a></li></ul> 
   </li><li><a href="#2_bridge_531" rel="nofollow">2.桥接模式 bridge</a></li><li><a href="#3Composite%09kmpzt_607" rel="nofollow">3.组合模式：Composite /ˈkɒmpəzɪt/</a></li><li><a href="#4_Decorator_dekretr_736" rel="nofollow">4.装饰模式 Decorator /ˈdekəreɪtə(r)/</a></li><li><a href="#5_proxy_783" rel="nofollow">5.代理模式 proxy</a></li><li><ul><li><a href="#51__786" rel="nofollow">5.1 静态代理</a></li><li><a href="#52_JDK_860" rel="nofollow">5.2 JDK动态代理</a></li><li><a href="#53_CGLIB_917" rel="nofollow">5.3 CGLIB动态代理</a></li></ul> 
   </li><li><a href="#6_facade_fsd_970" rel="nofollow">6.外观模式 facade /fəˈsɑːd/</a></li><li><a href="#7_Flyweight_flawet_1002" rel="nofollow">7.享元模式 Flyweight /ˈflaɪweɪt/</a></li></ul> 
  </li><li><a href="#_1031" rel="nofollow">三、行为型设计模式</a></li><li><ul><li><a href="#1_1034" rel="nofollow">1.解释器模式</a></li><li><a href="#2_template_method_1037" rel="nofollow">2.模版方法模式 template method</a></li><li><a href="#3_chain_of_responsibility_1123" rel="nofollow">3.责任链模式 chain of responsibility</a></li><li><a href="#4_command_1221" rel="nofollow">4.命令模式 command</a></li><li><a href="#5_iterator_1328" rel="nofollow">5.迭代器模式 iterator</a></li><li><a href="#6_mediator__midietr_1400" rel="nofollow">6.中介者模式 mediator /ˈmiːdieɪtə(r)/</a></li><li><a href="#7_memento_mment_1482" rel="nofollow">7.备忘录模式 memento /məˈmentəʊ/</a></li><li><a href="#8_observer_bzvr_1581" rel="nofollow">8.观察者模式 observer /əbˈzɜːvə(r)/</a></li><li><a href="#9_state_1717" rel="nofollow">9.状态模式 state</a></li><li><a href="#10_strategy_strtdi_1810" rel="nofollow">10.策略模式 strategy /ˈstrætədʒi/</a></li><li><a href="#11_visitor_1977" rel="nofollow">11.访问者模式 visitor</a></li></ul> 
 </li></ul> 
</div> 
<br> 设计模式就是对优良设计的总结，固化下来的写法，是业界公认的优雅设计。 
<p></p> 
<h2><a id="_2"></a>一、创建型设计模式</h2> 
<h3><a id="1_singleton_3"></a>1.单例模式 singleton</h3> 
<p>单例模式常见的不同写法有八种之多，真正完美无缺的只有一种枚举单例。其他单例都存在些许问题，但一般不会有人去用枚举来写单例，因为很怪，本来只是要搞个单例结果整了个枚举，我也不是太偏向这么写，一般使用：双重检查锁、静态内部类、静态属性三种写法都是可以接受的。我们经常使用的Spring框架的单例模式是从静态属性的单例模式变化而来，被称为注册表单例模式，后面也会说下。</p> 
<h4><a id="11_5"></a>1.1.静态属性单例模式</h4> 
<p>加载方式：饿汉<br> 优势：无线程安全问题<br> 唯一缺点：饿汉加载，存在加载不使用的可能，不使用则浪费内存（感觉其实不是事）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single1</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Single1</span> singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Single1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 核心点是私有化构造器，让外部无法进行新对象创建</span>
    <span class="token keyword">private</span> <span class="token class-name">Single1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single1</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="12__22"></a>1.2 静态属性变种</h4> 
<p>这个和上个唯一区别是将实例化放在了静态代码块，其实和第一种基本差不多<br> 加载方式：饿汉<br> 优势：无线程安全问题<br> 唯一缺点：饿汉加载，存在加载不使用的可能，不使用则浪费内存（感觉其实不是事）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single2</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Single2</span> singleTwo<span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        singleTwo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Single2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Single2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single2</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleTwo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="13__45"></a>1.3 基础的懒汉模式</h4> 
<p>这是最基础的懒汉模式，所以他有不可接受的缺点<br> 加载方式：懒汉<br> 优点：懒加载，不存在内存泄露的问题<br> 缺点：存在线程安全问题，并发时，单例无法保证</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single3</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span>  <span class="token keyword">static</span> <span class="token class-name">Single3</span> instance <span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Single3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single3</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token comment">// 放大线程安全问题</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>


            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Single3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="14__76"></a>1.4 线程安全的懒加载单例</h4> 
<p>这是对上一个的改进，但是依然存在问题，虽然实现了懒加载，也增加了安全锁，但是锁的粒度太大<br> 优点：安全、懒加载<br> 缺点：高并发时效率不高</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single4</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Single4</span> instance<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Single4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Single4</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> instance <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Single4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="15___95"></a>1.5 线程安全的懒加载 单例-改进</h4> 
<p>这是对上一个的改进，改进方向是缩小锁的粒度，下面代码猛一看感觉没问题，其实再一看就会发现有安全漏洞，当并发高时，肯定存在多个线程都进入到实例为空的逻辑内部，然后排队等待锁，这时候就会重复创建对象了<br> 加载模式：懒加载<br> 优点：降低了锁粒度<br> 缺点：高并发无法保证单例</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single5</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Single5</span> instance<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Single5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single5</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Single5</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Single5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="16__116"></a>1.6 双重检查锁</h4> 
<p>这被认为是一个没有缺点的单例模式，实际上他只是保证了在使用构造器创建对象时完全实现了单例，且保证了锁的粒度足够小的同时保证了线程安全性。但是我们知道创建对象java里还可以使用Cloneable的clone方法，还可以使用反射，还可以使用反序列化这些操作。这些操作其实一样式可以绕可这个单例的。<br> 优点：懒加载、线程安全，尽最大努力降低了锁的粒度<br> 缺点：相比于静态内部类效率稍微差点，但是生产可用</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single6</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Single6</span> single6<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Single6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single6</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这里加if可已在高并发时省去大部分排队加锁的操作，是有必要的</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>single6<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 这里可能存在多个线程都进入的场景，所以下面的同步代码块可能存在执行多次的场景</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Single6</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 因为这段代码可能存在多次执行，但是同一时间只有一个会执行，所以再进行一次非空判断就解决了问题</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>single6<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    single6<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Single6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> single6<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> single6<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="17__142"></a>1.7 静态内部类</h4> 
<p>这种单例不会有线程安全问题，线程安全由JVM保证，且是懒加载，算是一种好的设计了<br> 加载：懒加载<br> 优点：线程安全、懒加载、并发由JVM保证单例<br> 缺点：基本无（抛开了反射、反序列化、克隆等创建对象的方式不谈）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single7</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Single7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Single7</span> single7 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Single7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single7</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span>single7<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="18__161"></a>1.8 枚举单例</h4> 
<p>这是java自身就支持的特性，java里的枚举类就是单例的，所以使用枚举来实现单例简单也简洁，不过把正常类写成枚举总感觉怪怪的。此外枚举单例还解决了上面这些单例解决不了的问题<br> 解决反序列化破坏单例：枚举类天生支持序列化，在序列化的时候，只会序列化枚举的name，而不会序列化枚举的属性，反序列化时也是根据name找到实例返回，并不会创建新对象，所以序列化破坏不了这个单例。<br> 解决反射场景破坏单例：反射还是利用原类的构造方法进行创建，而枚举类的实际上集成了Enum这个类，他没有空参构造，且有参构造不支持枚举类的创建，所以不存在反射的问题<br> 解决克隆破坏单例：枚举类无法被克隆，所以不会被创建，他的clone方法是final的无法重写，所以克隆也破坏不了单例</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Single8</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">INSTANCE</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span>  <span class="token class-name">Single8</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Single8</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="19__181"></a>1.9 注册表单例</h4> 
<p>这是Spring采用的单例模式，其实和静态属性差不多，只是将对象存储到了Map中，利用了Map的键不能重复的原则 实现了值的唯一，从而保证了单例。<br> 优点：线程安全、懒加载、设计新颖（利用Map的键不重复保证了值的唯一）<br> 缺点：高并发下存在多个线程同时创建多个对象的可能，但是不会存在多个实例<br> 下面是笔者自己仿写的</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Single9</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> hashMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 测试</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"com.example.design.pattern.Single.Single9"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_factory_211"></a>2.工厂方法模式 factory</h3> 
<p>优点：集中创建对象，当创建对象的过程需要变更时只需要微调部分代码即可，因为真实场景中是有一些对象的创建是需要依赖很多的其他信息的，比如数据库连接的创建等。<br> 下面是一个简单工厂，Spring中的工厂类似于这个</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleFactory</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我感觉上面写法挺好，就是类似一个单例，其实常见的写法是直接return一个实例，而不是类似于Spring这种使用单例（这里并未保证单例）。而常见的return一个实例的写法就回存在一个问题，类型变换需要增加代码，这明显<mark>违反了设计模式的开闭原则</mark>，所以为了遵守开闭原则而有了下边的工厂方法模式，他不支持修改，只是对工厂类的扩展。但是新增对象后还是需要新增对应的工厂。<br> 下工厂方法模式的代码：</p> 
<pre><code class="prism language-java"><span class="token comment">// 猫类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span>
<span class="token punctuation">}</span>
<span class="token comment">// 狗类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token comment">// 工厂顶层接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 猫工厂</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CatFactory</span> <span class="token keyword">implements</span> <span class="token class-name">Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Cat</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 狗工厂</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DogFactory</span> <span class="token keyword">implements</span> <span class="token class-name">Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Dog</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Dog</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_factory_256"></a>3.抽象工厂模式 factory</h3> 
<p>上一个工厂的缺点就是有多少对象就得有多少个工厂，其实很麻烦，所以抽象工厂模式对上一个工厂模式是一个改进，对可以进行抽象的类进行一个抽象，从而进行减少工厂类的实现，当有一个华为品牌时，可以创建一个华为工厂用于生产多种产品，当有小米时可以为其再建一个工程，其实相对于工厂方法，就是将不同的创建归拢到了一起。但是这种写法当类型中多一个具体类时，还是要破坏开闭原则对其进行修改。</p> 
<pre><code class="prism language-java"><span class="token comment">// 电视类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> TV <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token comment">// 手机类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token comment">// 电脑类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
<span class="token comment">// 顶层工厂</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Factory</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">TV</span> <span class="token function">getInstanceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Phone</span> <span class="token function">getInstancePhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Computer</span> <span class="token function">getInstanceComputer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 华为工厂</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HuaWeiFactory</span>  <span class="token keyword">implements</span> <span class="token class-name">Factory</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TV</span> <span class="token function">getInstanceTV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token function">TV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Phone</span> <span class="token function">getInstancePhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Computer</span> <span class="token function">getInstanceComputer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_builder_292"></a>4.建造者模式 builder</h3> 
<p>建造者模式也是比较常用的模式了，常用的框架Lombok的注解@Builder就是将我们的实体类自动增加建造者。所以建造者就按字面意思理解即可，就是用来建造对象的模式。代码如下，核心是对外隐藏场景，只能有build方法来进行对象构建。<br> 优点：更加关注创建对象的过程，当参数过多时使用普通构造器创建很容易搞混参数，建造者不会。核心是利用静态内部类来对创建对象进行封装。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyString</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MyString</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyStringBuilder</span> <span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyStringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyStringBuilder</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyStringBuilder</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">MyStringBuilder</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">MyString</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyString</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBuilder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MyString</span> build <span class="token operator">=</span> <span class="token class-name">MyString</span>
                <span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token string">"beijing"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>build<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/36/3b/pC2yFTch_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_prototype_345"></a>5.原型模式 prototype</h3> 
<p>说原型模式之前先说下深浅拷贝。</p> 
<ul><li>浅拷贝：只拷贝栈中的信息为浅拷贝，基础数据类型存在栈中，所以肯定浅拷贝，引用类型的引用也是存储在占中java在进行对象赋值时只是复制了一个引用所以也是浅拷贝，所以java默认情况是浅拷贝的。</li><li>深拷贝：深拷贝就是将原对象的所有属性都从新复制一份形成一个新的对象，注意对象的属性也不能和原对象共用，这样才能算是原型模式<br> java里实现原型模式可以借助clone方法，但是也可以自己写将对象中的每个属性进行从新创建然后赋值给新对象</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DogPrototype</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DogPrototype</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">DogPrototype</span> clone <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DogPrototype</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DogPrototype</span> dogPrototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DogPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dogPrototype<span class="token punctuation">.</span><span class="token function">setDog</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DogPrototype</span> dogPrototypeClone <span class="token operator">=</span> dogPrototype<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dogPrototype <span class="token operator">==</span> dogPrototypeClone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dogPrototype<span class="token punctuation">.</span><span class="token function">getDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> dogPrototypeClone<span class="token punctuation">.</span><span class="token function">getDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cc/ae/fGSKMc65_o.png" alt="在这里插入图片描述"><br> 从上面的输出结果可以看到，显然上面不是一个正确的原型模式，因为对象内部的属性和之前还是相同的，所以我们是需要对属性进行从新创建的，这样才能保证原型模式的正确。实现一个对象的完全复制，如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DogPrototype</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Dog</span> dog<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DogPrototype</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">DogPrototype</span> clone <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DogPrototype</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>clone<span class="token punctuation">.</span><span class="token function">getDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>dog<span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">// dog若是有属性也是需要进行操作的，其实最好是原型模式依赖的来也需要实现原型模式，那么就不需要考虑属性的属性的问题了</span>
                <span class="token comment">// 只需保证自身属性从新创建即可</span>
                clone<span class="token punctuation">.</span><span class="token function">setDog</span><span class="token punctuation">(</span>dog<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AssertionError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DogPrototype</span> dogPrototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DogPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dogPrototype<span class="token punctuation">.</span><span class="token function">setDog</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DogPrototype</span> dogPrototypeClone <span class="token operator">=</span> dogPrototype<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dogPrototype <span class="token operator">==</span> dogPrototypeClone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dogPrototype<span class="token punctuation">.</span><span class="token function">getDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> dogPrototypeClone<span class="token punctuation">.</span><span class="token function">getDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e5/a5/W0W588fq_o.png" alt="在这里插入图片描述"><br> 上面的代码需要注意，实现原型模式的对象的属性也需要时原型模式的，不然我们就需要在clone方法内部去实现（属性的属性）的原型问题了，这种设计就很沙雕了。</p> 
<h2><a id="_408"></a>二、结构型设计模式</h2> 
<p>结构型的设计模式，基本都是利用现有的类或者对象组合到一起，形成更强大的结构。这一组模式里对于“合成复用原则”体现的比较明显。</p> 
<h3><a id="1_adapter_410"></a>1.适配器模式 adapter</h3> 
<p>适配器模式的核心是适配，将原本无法适配的场景，通过类、对象、接口等方式变得支持适配，可以使用。这就是适配器模式的核心场景。比如电脑的适配器，手机充电的适配器等。</p> 
<h4><a id="11__412"></a>1.1 类适配器模式</h4> 
<p>通过继承需要适配的类，然后对类中的方法进行适配，从而达到可用的目的</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 这是标准的手机生产者，但是无法满足
 * 客户的需求，需要增加一些功能，
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SupplierPhone</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"生产标准手机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 这是假设场景里真正需要的手机生产者，需要使用他来进行生产
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NeedPhone</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">/**
 * @author pcc
 * SupplierPhone生产的是标准手机，业务场景无法直接使用
 * 所以我们需要对其进行适配，在生产我们自己手机时对其进行二次加工
 * 所以这里需要继承SupplierPhone来获得他的手机生产方式
 * 然后对手机进行二次加工
 *
 * 这里最好不要让SupplierPhone 和 NeedPhone 的生产方法同名，同名的话
 * 会把SupplierPhone的方法认为是NeedPhone的实现了
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">SupplierPhone</span> <span class="token keyword">implements</span> <span class="token class-name">NeedPhone</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"更换手机原件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"为手机增加商标"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过上面我们就可以使得自己的生产方法里拥有对标准手机生产改造的场景了，从而满足自己的特殊需要场景。下面是验证</p> 
<pre><code class="prism language-java">
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PhoneAdapter</span> phoneAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhoneAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        phoneAdapter<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9a/a8/ckyMkuIO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12__465"></a>1.2 对象适配器模式（接口适配器）</h4> 
<p>（类适配器模式+桥接模式=对象适配器模式）<br> 类适配器，核心是通过继承需要适配的对象来实现适配，对象适配器则是通过将需要适配的对象进行引入，从而实现适配。那为什么要有这个设计呢，其实核心有两点原因：</p> 
<ul><li>1.java的类是单继承，类适配器会占用继承坑位，导致无法去继承其他类，影响扩展</li><li>2.类适配器无法解决需要适配接口的场景，假设上面场景中SupplierPhone是个接口，则无法使用上面的写法，所以有了对象适配<br> 还有人把对象适配器又划分为对象适配和接口适配的（按照适配的是类和接口来区分），其实他俩没啥区别，所以一般认为都是对象适配器。</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// 需要适配的对象从类变成了接口，当然这里是类也依然是可以的</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">interface</span> <span class="token class-name">SupplierPhoneInterface</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">/**
 * 这是假设场景里真正需要的手机生产者，需要使用他来进行生产
 * 这个还是自己的生产手机的地方，这个没动
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NeedPhone</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 适配器
 * @author pcc 
 * 对象适配和类适配的区别是，对象适配是引入一个待适配的对象
 * 而类适配则是通过继承来实现，类适配无法处理接口需要适配的场景，且占用继承坑位不利于扩展
 * 这里使用的NeedPhone还是上面代码的NeedPhone
 * 新增SupplierPhoneInterface 这是待适配的接口
 */</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectPhoneAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">NeedPhone</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">SupplierPhoneInterface</span> supplierPhoneInterface<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ObjectPhoneAdapter</span><span class="token punctuation">(</span><span class="token class-name">SupplierPhoneInterface</span> supplierPhoneInterface<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>supplierPhoneInterface <span class="token operator">=</span> supplierPhoneInterface<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"更换原手机组件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierPhoneInterface<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"为手机贴标"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是对象适配器模式了，核心就是将需要适配的对象通过构造方法传入，而不是通过继承实现，因为是通过传入，所以既可以支持对象也可以支持接口实现类。下面是测试</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestObjectAdapter</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 对象适配器，传入接口实现类</span>
        <span class="token class-name">ObjectPhoneAdapter</span> objectPhoneAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectPhoneAdapter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我生产标准手机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        objectPhoneAdapter<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c3/63/gh2FW93r_o.png" alt="在这里插入图片描述"><br> 其实完全可以把我们写的Service层的实现类，看成对象适配模式：ServiceImpl中需要维护一个Mapper接口，然后我们是对Mapper接口进行一些处理，增加一些逻辑，最后返回一个新的结果给到客户端。其实是可以看成适配器模式的代码，但是这里作用不是为了适配，而是为了增强，看作用更像是装饰模式，但是代码结构和对象适配器模式更像。</p> 
<h3><a id="2_bridge_531"></a>2.桥接模式 bridge</h3> 
<p>桥接模式的核心是解耦抽象和实现，抽象部分不集成在使用端进行变化，而是将变化进行独立。从而达到了提高代码的灵活性和可扩展性。<br> 假设我们需要一杯coffee，我们可以选择杯子的大小，是否加冰。此外还有我们无需选择的比如使用咖啡豆进行制作coffee。那这里的杯子的大小，可能是大杯、中杯、小杯。是否加冰也是有多重选择：多冰、少冰、不加冰。在这个场景里杯子的大小就是一个抽象，大小的不同就是抽象的不同实现。是否加冰也是如如此。对于这种场景最原始的做法是抽象一个抽象类出来CupSize、IfIce。我们如果想要一个大杯咖啡，那就是继承抽象类，然后定义杯子大小和是否加冰。到这里就会发现：好像不能多继承，所以这种方式有很大的短板，不仅不能多继承，而且还提升了代码的耦合度，将抽象与实现耦合在了一起。怎么解决就需要引入桥接模式了：桥接模式关注的核心点是解耦抽象和是实现</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 这是桥接模式类
 * 通过使用抽象的尺寸大小的对象，而不是继承抽象类，从而实现分类抽象和实现的目的。
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SupplierCoffee</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">CupSize</span> cupSize<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">SupplierCoffee</span><span class="token punctuation">(</span><span class="token class-name">CupSize</span> cupSize<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cupSize <span class="token operator">=</span> cupSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSupplierCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用原料制作咖啡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"使用杯子:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cupSize<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"咖啡制作完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">/**
 * @author pcc
 * 因为杯子有多种尺寸，所以对杯子的共性进行抽象，定义一个抽象类
 * 不同的尺寸对应不同的子类，子类中定义自己的特有属性，这里假设只有尺寸不同
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">CupSize</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">BigCupSize</span> <span class="token keyword">extends</span> <span class="token class-name">CupSize</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"大杯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MiddleCupSize</span> <span class="token keyword">extends</span> <span class="token class-name">CupSize</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"中杯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">LittleCupSize</span> <span class="token keyword">extends</span> <span class="token class-name">CupSize</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小杯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>== 上面就是桥接模式的代码了，他的核心是分离抽象和实现，对抽象和实现进行解耦。从而达到提高代码的可用性和扩展性。猛一看可能感觉桥接模式和对象适配器有些类似，其实是不同的，只不过他们都是结构型适配都是遵循组合复用原则，所以猛一看有些相似。对象适配关注的是对现有接口方法或者类方法的改造，而桥接模式关注的是抽象和实现的分离，非要对比的话，感觉对象适配器模式应该在桥接模式的上面，比如如果桥接模式提供的子类不能满足我们的需要，我们是可以对桥接的对象进行适配的。所以说他们的关注点不同。一个关注在对象的不同实现，一个关注的是对象的方法合不合用。==<br> 下面是测试：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBridge</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SupplierCoffee</span> supplierCoffee <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SupplierCoffee</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigCupSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierCoffee<span class="token punctuation">.</span><span class="token function">doSupplierCoffee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/02/bf/ASVsmAn3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3Composite%09kmpzt_607"></a>3.组合模式：Composite /ˈkɒmpəzɪt/</h3> 
<p>组合模式应用场景主要是在树形结构的数据中如：组织、文件系统、UI元素等。组合模式主要解决使用端对不同的节点需要不同的方法来处理的弊端问题。比如下面的例子，处理国家、省份等都提供一套方法就很麻烦，我们完全可以将不同的组织抽象成一个抽象类，客户端处理时，面向抽象类来处理，而不关心真正的实现（这里只能是处理各个组织都拥有的共性属性）。从而实现降低客户端与各个对象的耦合，提升代码的可读性。<br> 树形结构的数据中的不同数据一般都具有一些共性，我们是可以将他们的共性进行抽取，然后形成一个抽象类。以行政区划为例来说下，中国的行政区划包含中国、中国下面有34个省级行政区划，34个省级下面还有不同的市级等。那么行政区划就是我们抽象出来的抽象类他需要包含不同组织的相同共性。而针对不同的组织我们是需要有不同的实现类的，比如国家、省、市等不同抽象类。他们又拥有各自不同的特有属性。<br> 组合模式关注的核心点是：抽离对象共性，从而降低客户端与对象的耦合度，实现客户端可以调用一个方法对所有对象的都可以操作。组合模式的弊端：结构比较简单时实用组合模式反而增加复杂度，所以设计模式不应该强行使用。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>experimental<span class="token punctuation">.</span></span><span class="token class-name">Accessors</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * 这是将行政区划抽象出来的一个抽象的组织类
 * 假设只抽离除了名称、编码、子节点三个属性
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Organization</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Organization</span><span class="token punctuation">&gt;</span></span> children<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 国家类
 */</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Country</span> <span class="token keyword">extends</span> <span class="token class-name">Organization</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">supplierRMB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我是国家，我可以印钱"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 省类
 */</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Province</span> <span class="token keyword">extends</span> <span class="token class-name">Organization</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">manageCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我是省，我可以管理市"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 市类
 */</span>
<span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token keyword">extends</span> <span class="token class-name">Organization</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我是底层人民，只能哭泣"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>组合模式代码就是上面了，抽象了组织的共同属性，这样客户端在进行操作共同属性时，就无需关心到底是哪个节点了，只需要面对抽象类即可实现操作了。简化了客户端的操作，解耦了客户端与不同对象的耦合。<br> 需要注意的是组合模式一般得用递归去遍历所有元素，这其实对性能上是有一定损耗的。<br> 下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestComposite</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Organization</span> organization <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Country</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        organization<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"中国"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        organization<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Organization</span> province1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Province</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Organization</span> province2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Province</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        province1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"台湾省"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        province1<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        province2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"日本省"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        province2<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001002"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Organization</span> city1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Organization</span> city2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Organization</span> city3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Organization</span> city4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"高雄市"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city1<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001001001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city2<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"台北市"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city2<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001001002"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city3<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"东京市"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city3<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001002001"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city4<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"大阪市"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        city4<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token string">"001002002"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 组合属性结构</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Organization</span><span class="token punctuation">&gt;</span></span> listProvince <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        listProvince<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>province1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        listProvince<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>province2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 台湾省</span>
         <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Organization</span><span class="token punctuation">&gt;</span></span> listCity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         listCity<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>city1<span class="token punctuation">)</span><span class="token punctuation">;</span>
         listCity<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>city2<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// 日本省</span>
         <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Organization</span><span class="token punctuation">&gt;</span></span> listCity2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         listCity2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>city3<span class="token punctuation">)</span><span class="token punctuation">;</span>
         listCity2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>city4<span class="token punctuation">)</span><span class="token punctuation">;</span>

        organization<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span>listProvince<span class="token punctuation">)</span><span class="token punctuation">;</span>
        province1<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span>listCity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        province2<span class="token punctuation">.</span><span class="token function">setChildren</span><span class="token punctuation">(</span>listCity2<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 假设我们的业务场景是获取每个组织的名称和编码</span>
        <span class="token function">outPut</span><span class="token punctuation">(</span>organization<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token comment">// 递归遍历</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">outPut</span><span class="token punctuation">(</span><span class="token class-name">Organization</span> organization<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>organization<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>org <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>org<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> org<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 存在子节点</span>
            <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>org<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>children <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">TestComposite</span><span class="token operator">::</span><span class="token function">outPut</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面是运行截图<br> <img src="https://images2.imgbox.com/04/af/Pudbt58u_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_Decorator_dekretr_736"></a>4.装饰模式 Decorator /ˈdekəreɪtə®/</h3> 
<p>装饰模式的核心是在于不改变原接口的情况下实现对原接口方法的增强。猛一看会感觉他和对象适配模式有些像，其实区别还是挺明显的。</p> 
<ul><li>类适配模式，是有自己的接口然后将自己的方法区适配标准方法</li><li>装饰模式，用的还是原接口，是对原接口的一个增强<br> 不过他们在思想上是一致的，下面的代理模式中的静态代理，才是和装饰模式在代码上傻傻分不清，可以说一模一样了。</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 这是建造房子的接口
 * 假设这个接口有一个建造方法的方法，createRoom
 * 他有一个实现类BuildRoomImpl,这个类负责真正去建造一个房子
 * 这里对实现类BuildRoomImpl进行装饰，增加一些功能
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BuildRoom</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">createRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">BuildRoomImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BuildRoom</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"建造了一个房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * @author pcc
 * 这里是一个简单写法，若是建造房子有多个子类且要求 有不同的装饰
 * 则我们需要创建多个装饰类，这里只是写了单个的子类场景，不过若是装饰都相同，也可以面向BuildRoom
 * 进行装饰，这种只需要一个装饰类即可
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuildRoomDecorator</span> <span class="token keyword">implements</span> <span class="token class-name">BuildRoom</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">BuildRoom</span> buildRoom<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">BuildRoomDecorator</span><span class="token punctuation">(</span><span class="token class-name">BuildRoom</span> buildRoom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>buildRoom <span class="token operator">=</span> buildRoom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">createRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        buildRoom<span class="token punctuation">.</span><span class="token function">createRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"为房子增加装饰：粉刷墙面"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是装饰模式的代码了，其实在效果上他和对象适配器很像。因为都是结构型的设计模式，他们都有一个核心，那就是组合复用，基本都是围绕这一个核心点的。所以看起来很像。</p> 
<h3><a id="5_proxy_783"></a>5.代理模式 proxy</h3> 
<p>代理模式一般是说静态代理，此外java还提供了动态代理，动态代理当然是根据静态代理来实现的，只不过不需要我们自己写代理类了，jdk会帮助我们自动进行生成，此外cglib也有一套动态代理，不过他的原理就和jdk的不同了，而且他还支持对类的代理，不像jdk只能代理接口的。<br> 代理模式的核心是对于代理类的访问控制，实现对原类型方法的访问控制。但是在实现和操作上和装饰模式基本没区别，而且Spring使用代理模式做AOP，明显不是对类的访问控制，而是对于原始方法的一个装饰，更像是装饰者模式，所以他们很容易混，但笔者感觉无需分的这么清晰，本来设计模式就是为了让代码更优雅，解耦提高复用性的，无论装设模式还是代理模式，他们都能达到我们想要的目的，就是个名称而已。所以不要被名称欺骗了，重要的是会用。</p> 
<h4><a id="51__786"></a>5.1 静态代理</h4> 
<p>普通的代理模式被称为静态代理，他是相对于动态代理来说的，代码和装饰模式没有区别。<br> 假设存在这种场景：有一个药品生产的接口，定义了药品生产和检查。云南白药想要生产自己的药品，就需要实现这套标准。现在我想要代理云南白药的药品，对药品需要二级包装。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 静态代理和装饰模式代码上基本相同
 * 假设有一个药品接口：drug /drʌɡ/,他有两个抽象方法
 * 1. 生产药品
 * 2. 检验药品
 * 他有一个实现类云南白药 YunNanBaiYaoSupplierDrug
 * 现在我想要做云南白药药厂生产的药的代理
 *

 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SupplierDrug</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token comment">// 云南药厂</span>
<span class="token keyword">class</span> <span class="token class-name">YunNanBaiYaoSupplierDrug</span> <span class="token keyword">implements</span> <span class="token class-name">SupplierDrug</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"云南白药生产药品"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"云南白药检验药品"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




<span class="token comment">// 代理云南药厂</span>
<span class="token keyword">class</span> <span class="token class-name">ProxyYunNanBaiYaoSupplierDrug</span> <span class="token keyword">implements</span> <span class="token class-name">SupplierDrug</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">SupplierDrug</span> supplierDrug<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ProxyYunNanBaiYaoSupplierDrug</span><span class="token punctuation">(</span><span class="token class-name">SupplierDrug</span> supplierDrug<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>supplierDrug <span class="token operator">=</span> supplierDrug<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代理生产对药品二次包装"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代理二次检验药品"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这就是静态代理模式了，可以说和装饰模式基本一样了，下面是测试：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestProxy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SupplierDrug</span> supplierDrug <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyYunNanBaiYaoSupplierDrug</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">YunNanBaiYaoSupplierDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/a6/lLaAezg1_o.png" alt="在这里插入图片描述"><br> <mark>注意静态代理是支持代理抽象类和普通类的，即使不是接口我们也是可以做代理的。只需要去继承即可，只不过java单继承，使用继承方法影响扩展，所以一般都是设计成接口。</mark></p> 
<h4><a id="52_JDK_860"></a>5.2 JDK动态代理</h4> 
<p>之所以有动态代理，是因为静态代理每次需要写代理类，其实我们可能只想要代理其中一个方法，但是不得不必须去写一个代理类，因为是接口还得实现接口的所有方法，这其实不够友好。所以才有了动态代理。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TestDynamicProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//只代理生产药品的方法</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"produceDrug"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" invoke method "</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" begin..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"动态代理前置操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"动态代理后置操作"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回参数:"</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>上面是动态代理的代码，其实很简单就是实现InvocationHandler接口重写invoke方法就行了。一般使用动态代理都是对一类方法进行代理，对于单个方法进行代理的也有不过会少一些。那如何使用呢，只有这些怎么来操作动态代理呢，下面是使用的代码，使用时我们需要为Proxy.newInstance传入三个参数，①类加载器，②接口列表，③InvocationHandler的实现类。JDK通过类加载器来加载传入接口列表自动生成的实现类，这个实现类中就是将nvocationHandler的Invoke方法进行编织到目标方法上，从而实现动态代理。</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SupplierDrug</span> yunNanBaiYaoSupplierDrug <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YunNanBaiYaoSupplierDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SupplierDrug</span> supplierDrug<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SupplierDrug</span><span class="token punctuation">)</span><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                <span class="token comment">// 传入类加载器</span>
                yunNanBaiYaoSupplierDrug<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// 传入类接口列表</span>
                yunNanBaiYaoSupplierDrug<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// 传入handler实现类</span>
                <span class="token keyword">new</span> <span class="token class-name">TestDynamicProxy</span><span class="token punctuation">(</span>yunNanBaiYaoSupplierDrug<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>真正使用时是可以对上面操作进行封装，不然看着挺难看，他们三个参数其实只穿一个被代理的对象和InvocationHandler的实现类即可。<br> <img src="https://images2.imgbox.com/25/7d/2Aq1I6Yv_o.png" alt="在这里插入图片描述"><br> 那为什么jdk动态代理不能代理类呢而只能代理接口？一句话java是单继承，因为jdk动态代理生成的最终代理类继承了Proxy这个代理类，这个代理类有一个属性h，指向的就是我么自己编写的InvocationHandler类，最终的代理类通过继承Proxy获得了invoke方法，然后最终的代理类还实现了我们传入的接口，这样就可以重写接口方法然后调用invoke了。这样就实现了cglib的动态代理，也因此直支持类的动态代理了。</p> 
<h4><a id="53_CGLIB_917"></a>5.3 CGLIB动态代理</h4> 
<p>JDK的动态代理具有鲜明的特点是只能代理接口，那若是一个类没有实现接口或者实现的是抽象类，则使用JDK动态代理就会报错，他会告诉你类型转换的错误。所以Spring中只使用JDK动态代理是无法解决问题的，所以Spring还是用了CGLIB的动态代理。CGLIB底层使用的是一个叫ASM的框架，这个框架支持对字节码的编辑，可以直接更改编译后的信息，这样实现代理自然也是可以的。因为本来java也是支持普通类的代理的。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCGLIBDynamicProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 注意final类型的参数，要么在静态代码块初始化，要么在构造函数初始化，要么就是直接初始化，其他不支持了</span>
    <span class="token class-name">Object</span> object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TestCGLIBDynamicProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"checkDrug"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"增强前"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span> invoke <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"增强后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> invoke<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

	<span class="token comment">// 下面是测试代码</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 增强器</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置代理类的父类，这里可以是被代理类，也可以是他的父类或者接口，这里</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">YunNanBaiYaoSupplierDrug</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置MethodInterceptor的实现类，MethodInterceptor的intercept方法会在调用代理类的方法时调用</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestCGLIBDynamicProxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">YunNanBaiYaoSupplierDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建代理类</span>
        <span class="token class-name">SupplierDrug</span> supplierDrug <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SupplierDrug</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 调用代理类的方法</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">produceDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        supplierDrug<span class="token punctuation">.</span><span class="token function">checkDrug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面是运行截图：<br> <img src="https://images2.imgbox.com/23/72/KI5MCHDd_o.png" alt="在这里插入图片描述"><br> 总结代理模式，其实还是cglib的代理其实更优秀一些。上面笔者用的其实是Spring提供的一套cglib的实现，api和cglib的一模一样，所以用起来没有任何感觉，如果想用原生cglib的可以引入cglib的包，将其中 的类换成cglib的即可。类名方法名等都和cglib一模一样。</p> 
<h3><a id="6_facade_fsd_970"></a>6.外观模式 facade /fəˈsɑːd/</h3> 
<p>外观模式是一个简单的结构型模式，他的核心时：统筹一复杂的流程，然后对外暴露出的接口只是一个，自己内部将复杂流程进行处理操作。从而实现对外的简洁化。这种模式其实引用场景很多。举一个例子你需要请假：我们需要先填写审批单、然后在进行提交、提交后再进行审核、审核完成后还需要将请假单给到考勤。这个过程其实是很繁琐臃肿的，那么我们就可以使用外观模式，简化我们的操作，对外暴露的接口就是一个提起请假的接口就行了，剩下的自动化流程处理。<br> 外观模式，有的也叫门面模式，很明显是为了简化流程的。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFacade</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">funOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"填写请假信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">funTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"找留到审批请假"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">funThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将请假信息交给考勤人员"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">funFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">funOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">funTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">funThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">TestFacade</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">funFour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7_Flyweight_flawet_1002"></a>7.享元模式 Flyweight /ˈflaɪweɪt/</h3> 
<p>享元模式也是一种比较简单的结构型模式，他的核心思想是共享可以共享的部分，尽量减少内存的压力。比如Java里的String对象就是一种享元模式的设计，如果我们新建两个相同的String对象，那么字符串在常量池中只会存在一份，他并没有进行重复存储相同的对象，而是去共用一份。包括基本数据类型也是如此，他们在栈中也都是共用的。享元模式就是这个思路：比如一个工程中需要很多地方使用一个对象，这个对象只需要一个，那我们只需要为这个工厂创建一个对象即可，然后大家一起用。这里其实就是单例了。但是他们是从不从角度对代码的优化，只是最后走到了一起。（享元模式和原型模式在理念上正好相反，他们适合相反的场景）</p> 
<pre><code class="prism language-java"><span class="token comment">// 这里就以单例来举例吧</span>
<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFlyweight</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">TestFlyweightInner</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">TestFlyweight</span> testFlyweight <span class="token operator">=</span> <span class="token keyword">new</span>  <span class="token class-name">TestFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">TestFlyweight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">TestFlyweight</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">TestFlyweightInner</span><span class="token punctuation">.</span>testFlyweight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>到这里结构型的设计模式就都完了，结构型设计模式最突出的原则就是“组合复用原则”。看完可能会感觉有些模式很相似，其实有些类似的设计模式是下面三个，其他模式都是各有特点</p> 
<ul><li><strong>适配模式</strong>：类适配、对象适配，对象适配和下面有些像，不过适配模式的核心是关注方法的适配，而不是增强和装饰</li><li><strong>装饰模式</strong>：继承接口对原方法进行装饰，功能扩展，类同样支持，只是扩展性不好</li><li><strong>代理模式</strong>：代码和上面不同，主要是使用不同，主要用于做一些和主体功能无关的动作，比如日志，异常等<br> 以下模式特点比较鲜明</li><li><strong>组合模式</strong>：处理树形结构的数据，核心思想是抽离共性，简化客户端的操作，解耦</li><li><strong>桥接模式</strong>：比较简单，核心是将抽象与实现进行分离解耦，使用不关心实现，只关心抽象的类，由调用放再指定具体实现类</li><li><strong>外观模式</strong>：比较简单，对繁琐的步骤进行封装，对外暴漏统一接口，简化操作</li><li><strong>享元模式</strong>：比较简单，相同部分实现共享，从而降低内存压力</li></ul> 
<h2><a id="_1031"></a>三、行为型设计模式</h2> 
<p>行为型设计模式关注的是系统中对象之间的交互，研究系统在运行时对象之间的通信与协作。</p> 
<h3><a id="1_1034"></a>1.解释器模式</h3> 
<p>解释器模式顾名思义就是用来做解释使用的。他并没有什么标准的格式，一般用来做解析时使用，比如JVM解析栈针中的指令，这就可以看成解释器模式，只不过语言不是java了。同样我们自己也可以写一种我们自定义的语言，然后写一个解释器来运行这个语言。事实上解释器模式基本是用不到的。这里有一个大佬写的挺好，可以参考：<br> <a href="https://blog.csdn.net/li1325169021/article/details/112758017">解释器模式</a></p> 
<h3><a id="2_template_method_1037"></a>2.模版方法模式 template method</h3> 
<p>模板方法模式，在日常代码中是随处可见的，这点在java的源码中体现的尤为明显。模版方法模式的核心是：使用顶层类或者接口来定义一些方法，对于逻辑确定的方法进行实现，对于不确定的则交给子类进行实现，子类只负责其中一部分功能的实现就可以使用一个完整的功能。比如java中的函数式接口对于模版方法模式使用的就比较频繁，常见的Consumer、Function、Predicate等，都有使用这种设计风格。以Predicate进行举例（只使用两个方法来进行说明）。</p> 
<pre><code class="prism language-java">
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	* 这是函数式接口唯一的抽象方法
	* 也就是模版方法模式中，不确定的方法内容，需要子类进行实现的
	*/</span>
    <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * 这是一个默认方法，有自己的实现，他是对test方法的一个处理
    * 判断两个test返回都为真时他则为真，他是一个确定的实现，不定的是test，需要子类进行实现。
    */</span>
    <span class="token keyword">default</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">and</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token function">test</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> other<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这就是模版方法模式，<mark>模版方法模式的核心是提供模版方法让子类实现，但同时又定了了模版方法的使用规则，子类 只需要关系模版方法的实现，而不用关心使用方法的创建和修改，此外模版方法 模式还有一个比较亮眼的优点：当我们需要对变更的方法进行修改时，若是使用的模版方法模式，则只需要对其实现类进行修改，而不是去修改一坨需要看很久的代码了，这很利于代码的扩展，利于后期维护。</mark><br> 假设有这种场景：一个业务流程结束以后，我们需要做一些操作，但是这个操作呢可能存在很多场景，也有可能会发生变更，他是不确定的，所以我们可以使用模版方法模式，代码如下：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 这是完成流程的接口，完成流程时我们将数据的状态进行更新记录日志等这是一个固定操作
 * 此外可能还有需要通知三方系统等，但不确定有哪些三方系统
 * 这里使用的是函数式接口来实现场景，无论是函数式接口还是普通类、抽象类都是可以的
 */</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CompleteProcess</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 这是一个抽象方法：供子类实现
     */</span>
    <span class="token keyword">void</span> <span class="token function">notifyThirdSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">/**
     * 完成的流程是确定的，我们唯一不确定的是通知的系统
     */</span>
    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"更新数据状态"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">notifyThirdSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"记录日志"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>




<span class="token comment">/**
* 这是子类
*/</span>
<span class="token keyword">class</span> <span class="token class-name">DealProcess</span> <span class="token keyword">implements</span> <span class="token class-name">CompleteProcess</span><span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     *
     * 子类只负责这个方法，其他方法由父类实现
     * 此外若是这个实现变动，也无需改动父类
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">notifyThirdSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"通知三方系统:A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"通知三方系统:B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是模版方法模式的代码了，下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTemplateMethod</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DealProcess</span>  process <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DealProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/8c/gyo3Tx9I_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_chain_of_responsibility_1123"></a>3.责任链模式 chain of responsibility</h3> 
<p>责任链模式比较重要，在实际应用场景中比较多，而且使用责任链是可以解决很多问题的。先说下责任链模式的核心：<mark>他的典型特点是一个请求需要被多个结点处理，且每个结点的需要依赖上个结点处理完成后才能开始。此时我们就可以使用责任链模式了</mark></p> 
<ul><li>责任链模式解耦请求的发送者和处理者（对于多个处理者，请求者只需要把请求发送给第一个处理者即可）</li><li>责任链支持动态的添加、移除处理者，灵活性高，方便扩展<br> 假设有如下的场景：一个新增场景的业务流程，请求者是只需要发起请求，后面后多个审核节点，每个审核节点都需要依赖前一个审核完成的动作才能开始。那这就是一个典型的可以使用责任链的场景。下面是代码演示：</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 这是定义的顶层的处理器抽象类，所有的处理器，都是需要是吸纳处理方法
 * 然后通过next方法获取到下一个结点，来设置链式调用
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">DealProcess</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">DealProcess</span> next<span class="token punctuation">;</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 这里返回this其实也可以，只不过到时候调用方式就得改变，且不好看，使用next更直观易于理解，代码更优雅</span>
    <span class="token class-name">DealProcess</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">DealProcess</span> next<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
        <span class="token keyword">return</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>





<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DealProcessOne</span> <span class="token keyword">extends</span> <span class="token class-name">DealProcess</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行处理1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            next<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行最终节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DealProcessTwo</span> <span class="token keyword">extends</span> <span class="token class-name">DealProcess</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行处理2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            next<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行最终节点"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DealProcessThree</span> <span class="token keyword">extends</span> <span class="token class-name">DealProcess</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>next<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行处理3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            next<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"执行最终处理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是责任链的代码了，其实也很简单，最上层的处理器抽象类使用接口也可以，不过接口不支持声明变量，变量的操作就需要增加到子处理器中，这样增加了代码复杂度，所以使用抽象类作为顶层的处理器更合适。这样每个处理器都只需要关注处理操作即可。而无需关系其他动作，解耦了无关操作。下面是测试方法：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDealProcess</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DealProcess</span> dealProcess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DealProcessOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dealProcess<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DealProcessTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DealProcessThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dealProcess<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3f/48/2euBcS3K_o.png" alt="在这里插入图片描述"><br> 这就是责任链了，应用起来很简单，而且可以很方便的替换各个节点。<br> 在java中比较典型的责任链就是Filter的调用链了，当我们自己实现一个Filter时，需要实现他的doFilter方法，如下</p> 
<pre><code class="prism language-java"><span class="token keyword">class</span> <span class="token class-name">TestFilter</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{<!-- --></span>
        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当执行完毕后我们都需要去执行一个chain.doFilter(request, response)这个命令，他的作用其实就是开始执行下一个Filter的。在FilterChain的实现ApplicationFilterChain中他的调用动作是这样的：doFilter----&gt;internalDoFilter----&gt;filter.doFilter。通过这种形式完成了对下一个Filter的调用。这里可能会存在的疑问点：这个filter时哪里来的？我们使用FIlter无论是原始的配置servlet还是使用WebFilter注解，都会再项目启动时将所有的Filter进行加载，然后给到FilterChain的实现类，形成一个Filter的数组，FilterChain就是通过维护这个数组来进行Filter链调用的。当然这种模式与上面的例子略有区别，上面的例子我们是通过链表的形式来维护调用链的，而Filter是通过数组来进行维护调用链，其实都是可以的。</p> 
<h3><a id="4_command_1221"></a>4.命令模式 command</h3> 
<p>命令模式的核心是：减少调用者和接收者的耦合，方便扩展。<br> 假设有这种场景：一个遥控器需要给电视发送开机和关机的命令。假如不使用命令模式，我们可能会这么做，点击开机按钮，我们调用电视的开机接口实现开机。那假如遥控对象换成空调，我们又需要重新定义一个空调的遥控器。而且我们每次直接面向命令的接收者编程代码也不优雅。这种场景下我们就可以使用命令模式了。命令模式的核心就是解耦请求和实现。下面是代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 命令都是需要接收者执行的，这里的TV就是接收者
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> TV <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">powerOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TV power on"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">powerOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TV power off"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token comment">/**
 * @author pcc
 * 命令模式的核心就是命令的抽象类，所有命令都需要实现这个抽象类
 * 每个命令是一个具体的命令类，每个命令类都只实现一个命令，每个命令类都只完成一项功能
 * 调用者通过调用命令对象的execute方法来执行命令
 * 命令模式的核心是抽象命令类，每个具体的命令类都是抽象命令类的子类，每个具体的命令类都完成具体的功能。
 * 命令模式把本来复杂的代码，抽离出来，形成一个个命令类，这样会更直观更容易理解。代码也更容易维护、扩展
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Command</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PowerOnCommand</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">TV</span> tv<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PowerOnCommand</span><span class="token punctuation">(</span><span class="token class-name">TV</span> tv<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tv<span class="token punctuation">.</span><span class="token function">powerOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">PowerOffCommand</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">TV</span> tv<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PowerOffCommand</span><span class="token punctuation">(</span><span class="token class-name">TV</span> tv<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tv <span class="token operator">=</span> tv<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tv<span class="token punctuation">.</span><span class="token function">powerOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




<span class="token comment">/**
 * @author pcc
 * 这是遥控器类，负责统筹各种命令
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RemoteController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Command</span> <span class="token class-name">PowerOnCommand</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Command</span> <span class="token class-name">PowerOffCommand</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RemoteController</span> <span class="token punctuation">(</span><span class="token class-name">Command</span> <span class="token class-name">PowerOnCommand</span><span class="token punctuation">,</span> <span class="token class-name">Command</span> <span class="token class-name">PowerOffCommand</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>PowerOnCommand</span> <span class="token operator">=</span> <span class="token class-name">PowerOnCommand</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">this<span class="token punctuation">.</span></span>PowerOffCommand</span> <span class="token operator">=</span> <span class="token class-name">PowerOffCommand</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> powerOn <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PowerOnCommand</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> powerOff <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">PowerOffCommand</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是命令模式的代码了，他最鲜明的特点就是解耦请求和执行者，通过加入命令这一中间商，从而解开两者的耦合，实现代码的可读性、扩展性等方面的提高。下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 当真正使用时代码的清晰度就会非常高了，而不会看着都是一坨，
 * 同时解耦了命令的发送者和执行者，两者之间没有直接引用，而是通过命令对象进行command的调用
 * 这样就避免了调用者与接收者之间的耦合。
 * 命令模式的关键在于引入了命令对象，将调用者与接收者解耦。
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCommand</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TV</span> tv  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RemoteController</span> remoteController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RemoteController</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PowerOnCommand</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">PowerOffCommand</span><span class="token punctuation">(</span>tv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        remoteController<span class="token punctuation">.</span><span class="token function">powerOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        remoteController<span class="token punctuation">.</span><span class="token function">powerOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ca/67/lBPP86sO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_iterator_1328"></a>5.迭代器模式 iterator</h3> 
<p>迭代器模式，应该所有人都用过，因为java里的集合类都和迭代器有关，他们都直接或者间接实现了迭代器接口，Map是通过他的key实现的。迭代器模式主要是定义了迭代的规则，方便集合和数组的遍历。Java里提供了Iterator接口用以实现我们自己的迭代器，下面仿写一个ArrayList。用以实现我们自己的迭代器（日常开发中感觉不会自己写的，使用java提供的已经完全足够了）。但是自己写一个集合挺有意思，但是需要考虑的场景太多了，不如直接用。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author pcc
 * 这里继承的是Iterable接口，而不是Iterator接口,注意
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t <span class="token punctuation">;</span>

    <span class="token comment">// 内部容器数组需要初始化</span>
    <span class="token keyword">public</span> <span class="token class-name">MyArrayList</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> t<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>t <span class="token operator">=</span> t<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MyArrayList</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>t<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token operator">=</span>t<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 需要一个Iterator的实现</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">MyIterator</span> <span class="token keyword">implements</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>

        <span class="token keyword">int</span> cursor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cursor<span class="token operator">&lt;</span>t<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> t<span class="token punctuation">[</span>cursor<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面是自己定义了一个迭代器MyArrayList需要实现Iterable，它内部有一个Iterator的接受方法，所以还需要提供一个Iterator对象。下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMyArrayList</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MyArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> myArrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"e"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"f"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"g"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        myArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"j"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> myArrayList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_mediator__midietr_1400"></a>6.中介者模式 mediator /ˈmiːdieɪtə®/</h3> 
<p>中介者模式的核心是解决复杂的多对多关系，将其简化为简单的一对一。单个对象的事件的处理只需要单向的通过中介者来操作即可，实现与中介者的一对一，中介者与目标则是一对多的关系。<br> 假设有这样的场景：很多人想买房，很多人也想卖房，但是他们之间存在信息差。此时就需要房产中介来做中介者了。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * 这是中介者模式的中介：房产中介
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mediator</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 中介者需要存储被注册的房客和房主的信息</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 注册房客和房主</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取房客和房主的信息</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SellPerson</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">String</span>  name<span class="token punctuation">;</span>
    <span class="token class-name">String</span> address<span class="token punctuation">;</span>

    <span class="token comment">// 把房子交给中介</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sellRoom</span><span class="token punctuation">(</span><span class="token class-name">Mediator</span> mediator<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mediator<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其实很简单，就是简化多对多关系，将他们封装，这样就可以大大简化系统的复杂度，将杂乱的关系梳理清晰。代码很简单，思路也比较清晰。下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMediator</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Mediator</span> mediator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mediator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SellPerson</span>  sellPerson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SellPerson</span><span class="token punctuation">(</span><span class="token string">"金城碧桂园1"</span><span class="token punctuation">,</span><span class="token string">"12栋1单元201"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SellPerson</span>  sellPerson2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SellPerson</span><span class="token punctuation">(</span><span class="token string">"金城碧桂园2"</span><span class="token punctuation">,</span><span class="token string">"12栋1单元202"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SellPerson</span>  sellPerson3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SellPerson</span><span class="token punctuation">(</span><span class="token string">"金城碧桂园3"</span><span class="token punctuation">,</span><span class="token string">"12栋1单元203"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sellPerson<span class="token punctuation">.</span><span class="token function">sellRoom</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sellPerson2<span class="token punctuation">.</span><span class="token function">sellRoom</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sellPerson3<span class="token punctuation">.</span><span class="token function">sellRoom</span><span class="token punctuation">(</span>mediator<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 下面假设是买方动作</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">!=</span>mediator<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"金城碧桂园1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"周到目标："</span><span class="token operator">+</span>mediator<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"金城碧桂园1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b5/c0/b3LoiCy3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_memento_mment_1482"></a>7.备忘录模式 memento /məˈmentəʊ/</h3> 
<p>备忘录模式的核心就是将对象作为临时状态进行存储，在需要的场景下支持对历史信息的恢复。常见的场景比如，使用在线的腾讯文档或者飞书文档等，都是支持对历史版本进行回溯的，这其实就是备忘录模式。但是备忘录模式好是好，他非常占用资源，当对象比较大时对磁盘空间消耗将会很大。所以使用时需要合理设计。<br> 假设我们在使用腾讯的在线文档功能，那我们来一个破产版的在线文档：</p> 
<pre><code class="prism language-java"><span class="token comment">// 这是基础的文档类</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">class</span> <span class="token class-name">Document</span><span class="token punctuation">{<!-- --></span>


    <span class="token comment">/**
     * 文档内容
     */</span>
    <span class="token class-name">String</span> content<span class="token punctuation">;</span>
<span class="token punctuation">}</span>






<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DocumentMemento</span> <span class="token punctuation">{<!-- --></span>


    <span class="token comment">/**
     * 文档暂存时的时间，用于恢复文档的历史状态
     */</span>
    <span class="token class-name">LocalDate</span> dateTime<span class="token punctuation">;</span>


    <span class="token comment">/**
     * 暂存文档的集合，真实场景都是数据库或者缓存
     */</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LocalDate</span><span class="token punctuation">,</span><span class="token class-name">Document</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 暂存文档
     * @param document 文档
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">docuMemento</span><span class="token punctuation">(</span><span class="token class-name">Document</span> document<span class="token punctuation">,</span><span class="token class-name">LocalDate</span> dateTime<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取对应时间的文档信息
     * 恢复历史记录
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Document</span> <span class="token function">getDocuMemento</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> dateTime<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是代码了，其实很简单，就是将对象保存到一个容器里，这里使用Map，真实场景中大多是缓存或者数据库来存储。使用Map需要注意的是存储时得新建对象存储，不然对象属性更改了Map中也会更改，因为他们所有引用都是指向堆中唯一的对象。下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestMemento</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DocumentMemento</span> documentMemento <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DocumentMemento</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Document</span>  document <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Document</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"北国风光，万"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveTmp</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span>documentMemento<span class="token punctuation">,</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂存一次</span>
        document<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"北国风光，万里雪飘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveTmp</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span>documentMemento<span class="token punctuation">,</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂存一次</span>
        document<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"北国风光，万里雪飘，千里冰封"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">saveTmp</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span>documentMemento<span class="token punctuation">,</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂存一次</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前文档为："</span><span class="token operator">+</span>document<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// 假设有一个页面，我们选择了恢复到时间点为第二条的数据</span>
        <span class="token class-name">Document</span> docuMemento <span class="token operator">=</span> documentMemento<span class="token punctuation">.</span><span class="token function">getDocuMemento</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"恢复文档为："</span><span class="token operator">+</span>docuMemento<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveTmp</span><span class="token punctuation">(</span><span class="token class-name">Document</span> document<span class="token punctuation">,</span><span class="token class-name">DocumentMemento</span> documentMemento<span class="token punctuation">,</span><span class="token class-name">LocalDate</span> localDate<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>docume<span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            documentMemento<span class="token punctuation">.</span><span class="token function">docuMemento</span><span class="token punctuation">(</span>docume<span class="token punctuation">,</span> localDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/79/54/6ZedmEq0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8_observer_bzvr_1581"></a>8.观察者模式 observer /əbˈzɜːvə®/</h3> 
<p>观察者模式又被称为发布订阅模式，他的核心是一对多的通知。我们可以做广播类型的观察者，也可以做topic类型的观察者。<br> java本身提供了观察者的的接口，我们可以直接使用（自己写也很简单，但肯定没有jdk提供的全面）。</p> 
<ul><li>Observalbe: 被观察对象，是一个类，可以管理观察者</li><li>Observer：观察者接口<br> 这里使用一个父类封装被观察者添加观察者的动作，如下：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>observer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Observable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Observer</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Predicate</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 *
 * @description  观察者父类，这里使用Spring的InitializingBean接口，在bean初始化时，将当前对象添加到被观察者中
 *               该观察者不做任何业务动作，只为了封装被观察者的addObserver方法
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MyObserver</span> <span class="token keyword">implements</span> <span class="token class-name">Observer</span><span class="token punctuation">,</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">Observable</span> observable<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 父级观察者不加入</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token punctuation">.</span><span class="token function">isEqual</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">MyObserver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            observable<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>下面是两个观察者，他们都是上面父级观察者的子类：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>observer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Observable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 观察者1
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObserverOne</span> <span class="token keyword">extends</span> <span class="token class-name">MyObserver</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Observable</span> o<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ObserverOne收到消息："</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>observer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Observable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 观察者2
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObserverTwo</span> <span class="token keyword">extends</span> <span class="token class-name">MyObserver</span>  <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Observable</span> o<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ObserverTwo收到消息："</span> <span class="token operator">+</span> arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>下面是被观察者的代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>observer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Observable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 被观察对象
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObservable</span> <span class="token keyword">extends</span> <span class="token class-name">Observable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这里可以写业务代码</span>
        <span class="token function">setChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token string">"更新消息了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>这就是观察者模式的全部代码了，下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>observer</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 测试类
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestObserverController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">MyObservable</span> observable<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">"/testObserver"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        observable<span class="token punctuation">.</span><span class="token function">postUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>下面是执行截图：<br> <img src="https://images2.imgbox.com/f2/17/IGTcKdsQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="9_state_1717"></a>9.状态模式 state</h3> 
<p>状态模式的核心是对于对象不同的状态应该对应着不同的业务动作，注意这里要区别备忘录模式，备忘录相当于存的是版本，而状态更强调的时不同的状态下对象应该做什么。状态模主要讲述对象状态变更时应该做何种处理的场景。状态模式有一个顶层的状态接口，还有多个状态实现类，不同的状态类代表不同的状态，同时有着不同的动作。<br> 假设有这种场景：有个新增流程，它对应着发起、审批、完成三个状态，我们需要在不同的状态结点通知不同的审核人</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 * 状态抽象类，定义为借口其实更好
 * 以及他的三个状态实现类
 *
 * 优点：解耦状态还业务实现
 * 缺点：若是状态过多，容易造成状态类过多（感觉不是缺点，若是每个状态都做自己的动作与业务代码耦合在一起，会导致后期维护越来越乱）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">State</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">StartState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> STATE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"start-process"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">DealState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> STATE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"deal-process"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CompleteState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> STATE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"complete-process"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>




<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">EqualsAndHashCode</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Process</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token punctuation">{<!-- --></span>

    <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">// 流程名</span>
    <span class="token class-name">String</span> desc<span class="token punctuation">;</span> <span class="token comment">// 流程描述</span>

    <span class="token class-name">State</span> state<span class="token punctuation">;</span> <span class="token comment">// 流程状态</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        state<span class="token punctuation">.</span><span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面就是状态模式的代码了，其实也很简单，但是当我们对对象做状态相应的变更时，就可以实现解耦业务和状态的操作。下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestState</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StartState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在合适的场景进行状态变更的处理操作</span>
        process<span class="token punctuation">.</span><span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        process<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DealState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在合适的场景进行状态变更的处理操作</span>
        process<span class="token punctuation">.</span><span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        process<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CompleteState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 在合适的场景进行状态变更的处理操作</span>
        process<span class="token punctuation">.</span><span class="token function">handlerEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/22/a5/mxmRTndF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="10_strategy_strtdi_1810"></a>10.策略模式 strategy /ˈstrætədʒi/</h3> 
<p>策略模式的核心是将不同场景的运算逻辑封装在不同的策略里，从而实现针对不同场景的处理进行分开处理。解耦场景判断与场景实现的耦合，当有不同的场景时，我们需要增加场景类来提供不同的场景算法。<br> 当if、else判断场景比较多时，我们就可以考虑使用策略模式，来对代码进行优化。策略模式可以解耦场景和算法，易扩展。策略模式需要以下类：</p> 
<ul><li>策略上下文：用于管理策略，执行时通过上下文选择策略</li><li>策略父类：定义策略的方法</li><li>若干策略子类：重写策略父类的方法，也是真正的算法实现的地方</li></ul> 
<p>这是策略父类代码</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>strategy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 策略父类，用以定义策略的方法和策略标识
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FatherStrategy</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> STRATEGY_NAME <span class="token operator">=</span> <span class="token string">"strategy0"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStrategyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> STRATEGY_NAME<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父类策略-method1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父类策略-method2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>这是两个策略子类的代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>strategy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 策略类1，重写策略方法和定义自己的策略类型
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyOne</span> <span class="token keyword">extends</span> <span class="token class-name">FatherStrategy</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> STRATEGY_NAME <span class="token operator">=</span> <span class="token string">"strategy1"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStrategyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> STRATEGY_NAME<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"策略1-method1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"策略1-method2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>strategy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 策略类2，重写策略方法和定义自己的策略类型
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyTwo</span> <span class="token keyword">extends</span> <span class="token class-name">FatherStrategy</span><span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> STRATEGY_NAME <span class="token operator">=</span> <span class="token string">"strategy2"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getStrategyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> STRATEGY_NAME<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"策略2-method1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dealStrategy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"策略2-method2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>这是策略上下文代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>strategy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Predicate</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 策略上下文，客户端选择策略时使用
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StrategyContext</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FatherStrategy</span><span class="token punctuation">&gt;</span></span> strategies<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FatherStrategy</span> <span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">FatherStrategy</span> strategy <span class="token operator">:</span> strategies<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token punctuation">.</span><span class="token function">isEqual</span><span class="token punctuation">(</span>strategy<span class="token punctuation">.</span><span class="token function">getStrategyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> strategy<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"stratey异常：无可用策略"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>cheng<span class="token punctuation">.</span>ebbing<span class="token punctuation">.</span>message<span class="token punctuation">.</span>strategy</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 * @version 1.0.0
 * @description 测试策略
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestStrategyController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">StrategyContext</span> strategyContext<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">"/testStrategy"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">FatherStrategy</span> strategy <span class="token operator">=</span> strategyContext<span class="token punctuation">.</span><span class="token function">getStrategy</span><span class="token punctuation">(</span><span class="token string">"strategy1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        strategy<span class="token punctuation">.</span><span class="token function">dealStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        strategy<span class="token punctuation">.</span><span class="token function">dealStrategy2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>下面是执行结果：<br> <img src="https://images2.imgbox.com/4d/b1/eVDhoRXJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="11_visitor_1977"></a>11.访问者模式 visitor</h3> 
<p>访问者模式的核心是在不改变原有对象的基础上，提供针对同一个对象的不同操作。可以这么理解一个学生考了59分，当学生知道59分的时候，学生是访问者，当老师、父母等看到59分时他们都可以是访问者，不同的访问者对于这个分数他们的处理应该是不同的。访问者模式通过抽象不同的访问者来实现解耦，而且易于扩展。<br> 下面以学生分数为例来说明访问者模式：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ScoreVisitor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 学生访问者，不同的访问者对待同一个事情的反应是不同的</span>
<span class="token keyword">class</span> <span class="token class-name">StudentVisitor</span> <span class="token keyword">implements</span>  <span class="token class-name">ScoreVisitor</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"学生：及格了好开心，回家不用挨打了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"学生：没及格，回家挨打"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 老师访问者</span>
<span class="token keyword">class</span> <span class="token class-name">TeacherVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">ScoreVisitor</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"老师：及格了，希望能考个好大学，给我送个红包"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"老师：废物一个，下次给他安排旮旯角"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 父母访问者</span>
<span class="token keyword">class</span> <span class="token class-name">ParentsVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">ScoreVisitor</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Student</span> student<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>s<span class="token operator">-&gt;</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">.</span><span class="token function">getScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父母：及格了，希望孩子有个好的未来"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父母：得想想怎么帮助他了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">EqualsAndHashCode</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author pcc
 */</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span> <span class="token comment">// 姓名</span>
    <span class="token class-name">String</span> identity<span class="token punctuation">;</span> <span class="token comment">// 身份</span>
<span class="token punctuation">}</span>

<span class="token comment">// 这是学生类，他拥有分数</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Integer</span> score<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> level<span class="token punctuation">;</span> <span class="token comment">// 教师职级</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> love<span class="token punctuation">;</span> <span class="token comment">// 父母的爱</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>访问者模式代码也就是这些了，核心就是针对同一个场景或者对象，不同访问者具有完全不同的动作，下面是测试代码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author pcc
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        student<span class="token punctuation">.</span><span class="token function">setScore</span><span class="token punctuation">(</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设考了59分</span>

        <span class="token class-name">StudentVisitor</span> studentVisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StudentVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TeacherVisitor</span> teacherVisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TeacherVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ParentsVisitor</span> parentsVisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ParentsVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        studentVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
        teacherVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
        parentsVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e4/b1/dzxp7xqB_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/256f221312aff15967acd5ef6fabd71c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Authorization Server入门 (二) Spring Boot整合Spring Authorization Server</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c071d64a84ec0f5891c9fb6d07ae1b71/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C# HttpClient全攻略：GET、POST、文件传输与授权设置一网打尽</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>