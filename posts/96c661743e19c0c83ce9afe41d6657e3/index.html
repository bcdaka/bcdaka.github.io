<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Django åç«¯æ¶æ„å¼€å‘ï¼šJWT é¡¹ç›®å®è·µä¸Drfç‰ˆæœ¬æ§åˆ¶ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/96c661743e19c0c83ce9afe41d6657e3/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="Django åç«¯æ¶æ„å¼€å‘ï¼šJWT é¡¹ç›®å®è·µä¸Drfç‰ˆæœ¬æ§åˆ¶">
  <meta property="og:description" content="ğŸ› ï¸ Django åç«¯æ¶æ„å¼€å‘ï¼šJWT é¡¹ç›®å®è·µä¸Drfç‰ˆæœ¬æ§åˆ¶ ğŸ“Œ JWT é¡¹ç›®å®è·µï¼šä»ç†è®ºåˆ°å®æˆ˜ JSON Web Tokenï¼ˆJWTï¼‰æ˜¯å½“å‰æœ€æµè¡Œçš„èº«ä»½è®¤è¯æœºåˆ¶ä¹‹ä¸€ï¼Œåœ¨åç«¯å¼€å‘ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒåŸºäºTokençš„èº«ä»½éªŒè¯æ–¹å¼ï¼Œé¿å…äº†ä¼ ç»Ÿçš„Sessionè®¤è¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å±€é™æ€§ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªå®é™…çš„Djangoé¡¹ç›®ï¼Œè¯¦ç»†è§£æJWTçš„åº”ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ã€‚
é¦–å…ˆï¼Œåœ¨Djangoä¸­ä½¿ç”¨JWTè¿›è¡Œç”¨æˆ·è®¤è¯æ—¶ï¼Œé€šå¸¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ djangorestframework-jwt æˆ– django-rest-framework-simplejwtã€‚è¿™äº›åº“æä¾›äº†æ–¹ä¾¿çš„å·¥å…·å’Œæ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨Django REST Frameworkä¸­é›†æˆJWTã€‚
ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é¡¹ç›®ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†é€æ­¥è§£æå…¶ä¸­çš„å…³é”®ä»£ç ã€‚
# settings.py é…ç½® INSTALLED_APPS = [ ... &#39;rest_framework&#39;, &#39;rest_framework_simplejwt&#39;, ] REST_FRAMEWORK = { &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: ( &#39;rest_framework_simplejwt.authentication.JWTAuthentication&#39;, ), } # é…ç½®JWTçš„è¿‡æœŸæ—¶é—´ç­‰å‚æ•° SIMPLE_JWT = { &#39;ACCESS_TOKEN_LIFETIME&#39;: timedelta(minutes=5), &#39;REFRESH_TOKEN_LIFETIME&#39;: timedelta(days=1), &#39;ROTATE_REFRESH_TOKENS&#39;: True, &#39;BLACKLIST_AFTER_ROTATION&#39;: True, &#39;ALGORITHM&#39;: &#39;HS256&#39;, &#39;SIGNING_KEY&#39;: SECRET_KEY, &#39;VERIFYING_KEY&#39;: None, &#39;AUTH_HEADER_TYPES&#39;: (&#39;Bearer&#39;,), ... } åœ¨ settings.py ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†JWTçš„è®¤è¯æ–¹å¼ï¼Œå¹¶è®¾ç½®äº†ç›¸å…³å‚æ•°ã€‚ACCESS_TOKEN_LIFETIME æ˜¯è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ—¶é—´ï¼Œè€Œ REFRESH_TOKEN_LIFETIME åˆ™å†³å®šäº†åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæœŸã€‚è¿™äº›å‚æ•°çš„è®¾ç½®ç›´æ¥å½±å“äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ views.py ä¸­å®ç°JWTçš„ç™»å½•é€»è¾‘ã€‚
from rest_framework_simplejwt.views import TokenObtainPairView from rest_framework_simplejwt.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-21T14:16:51+08:00">
    <meta property="article:modified_time" content="2024-08-21T14:16:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Django åç«¯æ¶æ„å¼€å‘ï¼šJWT é¡¹ç›®å®è·µä¸Drfç‰ˆæœ¬æ§åˆ¶</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_Django_JWT_Drf_0"></a>ğŸ› ï¸ <strong>Django åç«¯æ¶æ„å¼€å‘ï¼šJWT é¡¹ç›®å®è·µä¸Drfç‰ˆæœ¬æ§åˆ¶</strong></h4> 
<h5><a id="_JWT__2"></a>ğŸ“Œ <strong>JWT é¡¹ç›®å®è·µï¼šä»ç†è®ºåˆ°å®æˆ˜</strong></h5> 
<p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯å½“å‰æœ€æµè¡Œçš„èº«ä»½è®¤è¯æœºåˆ¶ä¹‹ä¸€ï¼Œåœ¨åç«¯å¼€å‘ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚å®ƒåŸºäºTokençš„èº«ä»½éªŒè¯æ–¹å¼ï¼Œé¿å…äº†ä¼ ç»Ÿçš„Sessionè®¤è¯åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å±€é™æ€§ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªå®é™…çš„Djangoé¡¹ç›®ï¼Œè¯¦ç»†è§£æJWTçš„åº”ç”¨åœºæ™¯å’Œå®ç°æ–¹å¼ã€‚</p> 
<p>é¦–å…ˆï¼Œåœ¨Djangoä¸­ä½¿ç”¨JWTè¿›è¡Œç”¨æˆ·è®¤è¯æ—¶ï¼Œé€šå¸¸éœ€è¦å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ <code>djangorestframework-jwt</code> æˆ– <code>django-rest-framework-simplejwt</code>ã€‚è¿™äº›åº“æä¾›äº†æ–¹ä¾¿çš„å·¥å…·å’Œæ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨Django REST Frameworkä¸­é›†æˆJWTã€‚</p> 
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é¡¹ç›®ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†é€æ­¥è§£æå…¶ä¸­çš„å…³é”®ä»£ç ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># settings.py é…ç½®</span>
INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span>
    <span class="token string">'rest_framework_simplejwt'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework_simplejwt.authentication.JWTAuthentication'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment"># é…ç½®JWTçš„è¿‡æœŸæ—¶é—´ç­‰å‚æ•°</span>
SIMPLE_JWT <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'ACCESS_TOKEN_LIFETIME'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>minutes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'REFRESH_TOKEN_LIFETIME'</span><span class="token punctuation">:</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'ROTATE_REFRESH_TOKENS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">'BLACKLIST_AFTER_ROTATION'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">'ALGORITHM'</span><span class="token punctuation">:</span> <span class="token string">'HS256'</span><span class="token punctuation">,</span>
    <span class="token string">'SIGNING_KEY'</span><span class="token punctuation">:</span> SECRET_KEY<span class="token punctuation">,</span>
    <span class="token string">'VERIFYING_KEY'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">'AUTH_HEADER_TYPES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'Bearer'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ <code>settings.py</code> ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†JWTçš„è®¤è¯æ–¹å¼ï¼Œå¹¶è®¾ç½®äº†ç›¸å…³å‚æ•°ã€‚<code>ACCESS_TOKEN_LIFETIME</code> æ˜¯è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ—¶é—´ï¼Œè€Œ <code>REFRESH_TOKEN_LIFETIME</code> åˆ™å†³å®šäº†åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæœŸã€‚è¿™äº›å‚æ•°çš„è®¾ç½®ç›´æ¥å½±å“äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p> 
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ <code>views.py</code> ä¸­å®ç°JWTçš„ç™»å½•é€»è¾‘ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenObtainPairView
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>tokens <span class="token keyword">import</span> RefreshToken
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> api_view<span class="token punctuation">,</span> permission_classes

<span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨æˆ·ç™»å½•è§†å›¾ï¼Œä½¿ç”¨JWTè¿›è¡Œèº«ä»½éªŒè¯
    """</span>
    serializer <span class="token operator">=</span> TokenObtainPairView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>_request<span class="token punctuation">)</span><span class="token punctuation">.</span>data
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@api_view</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@permission_classes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨æˆ·æ³¨é”€è§†å›¾ï¼ŒåºŸå¼ƒå½“å‰çš„Refresh Token
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        token <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'refresh'</span><span class="token punctuation">]</span>
        token_obj <span class="token operator">=</span> RefreshToken<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
        token_obj<span class="token punctuation">.</span>blacklist<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'æ³¨é”€æˆåŠŸ'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'error'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>
</code></pre> 
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† <code>login</code> å’Œ <code>logout</code> è§†å›¾ã€‚<code>login</code> è§†å›¾é€šè¿‡ <code>TokenObtainPairView</code> ç”Ÿæˆè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼Œ<code>logout</code> è§†å›¾åˆ™é€šè¿‡é»‘åå•æœºåˆ¶åºŸå¼ƒç”¨æˆ·çš„åˆ·æ–°ä»¤ç‰Œï¼Œç¡®ä¿å…¶åç»­çš„è¯·æ±‚å¤±æ•ˆã€‚</p> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŸºäºJWTçš„å®Œæ•´è®¤è¯æµç¨‹ï¼Œå¹¶ä¸”æ”¯æŒä»¤ç‰Œçš„æ‰‹åŠ¨åºŸå¼ƒï¼Œæå‡äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚</p> 
<h5><a id="_JWT__76"></a>ğŸ“Œ <strong>JWT ä½¿ç”¨æ–¹å¼å’Œç‰¹ç‚¹ï¼šçµæ´»ä¸”é«˜æ•ˆçš„è®¤è¯æœºåˆ¶</strong></h5> 
<p>JWTçš„å…¨ç§°æ˜¯JSON Web Tokenï¼Œæ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡çš„å½¢å¼ä¼ é€’ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯é€šè¿‡æ•°å­—ç­¾åè¿›è¡ŒéªŒè¯ï¼Œä»è€Œç¡®ä¿æ•°æ®çš„çœŸå®æ€§ä¸å®Œæ•´æ€§ã€‚JWTçš„åº”ç”¨åœºæ™¯å¹¿æ³›ï¼Œå°¤å…¶åœ¨ç°ä»£Webåº”ç”¨ä¸­ï¼Œå› å…¶æ— çŠ¶æ€ã€è·¨åŸŸæ”¯æŒç­‰ä¼˜ç‚¹ï¼Œå¹¿å—æ¬¢è¿ã€‚</p> 
<p>ä¸ä¼ ç»Ÿçš„Sessionè®¤è¯æœºåˆ¶ä¸åŒï¼ŒJWTçš„æ— çŠ¶æ€æ€§ä½¿å…¶éå¸¸é€‚åˆäºå¾®æœåŠ¡æ¶æ„å’Œåˆ†å¸ƒå¼ç³»ç»Ÿã€‚åœ¨ä¼ ç»Ÿçš„Sessionè®¤è¯ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦ä¿å­˜æ¯ä¸ªç”¨æˆ·çš„Sessionæ•°æ®ï¼Œè¿™åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ä¼šå¸¦æ¥å¾ˆå¤šæŒ‘æˆ˜ã€‚è€ŒJWTçš„è‡ªåŒ…å«æ€§å…è®¸æœåŠ¡å™¨ä¸å¿…ä¿å­˜ä¼šè¯çŠ¶æ€ï¼Œæå¤§åœ°å‡è½»äº†æœåŠ¡å™¨çš„è´Ÿæ‹…ã€‚</p> 
<p>JWTçš„ç»“æ„åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼šå¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPayloadï¼‰å’Œç­¾åï¼ˆSignatureï¼‰ã€‚</p> 
<ul><li> <p><strong>å¤´éƒ¨</strong>ï¼šå¤´éƒ¨é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä»¤ç‰Œçš„ç±»å‹ï¼ˆå³JWTï¼‰å’Œæ‰€ä½¿ç”¨çš„ç­¾åç®—æ³•ï¼ˆå¦‚HMAC SHA256æˆ–RSAï¼‰ã€‚</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>è½½è·</strong>ï¼šè½½è·éƒ¨åˆ†åŒ…å«å£°æ˜ï¼ˆclaimsï¼‰ï¼Œå£°æ˜æ˜¯ä¸€äº›å®ä½“ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·ï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚å£°æ˜å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼šæ³¨å†Œå£°æ˜ï¼ˆå¦‚ <code>iss</code>ã€<code>exp</code>ã€<code>sub</code>ï¼‰ã€å…¬å…±å£°æ˜å’Œç§æœ‰å£°æ˜ã€‚</p> <pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"sub"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"admin"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><strong>ç­¾å</strong>ï¼šç­¾åæ˜¯å°†å¤´éƒ¨ã€è½½è·å’Œä¸€ä¸ªå¯†é’¥è¿›è¡Œç¼–ç åç”Ÿæˆçš„ã€‚ç­¾åéƒ¨åˆ†æ˜¯ä¿è¯JWTæ•°æ®å®Œæ•´æ€§çš„é‡è¦æ‰‹æ®µï¼Œåªæœ‰æ‹¥æœ‰å¯†é’¥çš„ä¸€æ–¹æ‰èƒ½ç”Ÿæˆæˆ–éªŒè¯ç­¾åã€‚</p> </li></ul> 
<p>JWTçš„ä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼Œé€šå¸¸åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªJWTå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°†å…¶ä¿å­˜åœ¨æœ¬åœ°å­˜å‚¨ä¸­ã€‚åœ¨åç»­çš„è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯å°†JWTæ”¾å…¥HTTPè¯·æ±‚å¤´ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡éªŒè¯JWTçš„ç­¾åæ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆæ³•ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># ç¤ºä¾‹ï¼šåœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWT</span>
<span class="token keyword">import</span> requests

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'Authorization'</span><span class="token punctuation">:</span> <span class="token string">'Bearer &lt;your_jwt_token_here&gt;'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://example.com/api/resource'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
</code></pre> 
<p>è¿™ç§æ— çŠ¶æ€çš„è®¤è¯æœºåˆ¶ï¼Œä½¿å¾—JWTç‰¹åˆ«é€‚åˆè·¨åŸŸè®¤è¯ä»¥åŠå¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿã€‚å®¢æˆ·ç«¯ä¸éœ€è¦æ¯æ¬¡è¯·æ±‚éƒ½ä¸æœåŠ¡å™¨è¿›è¡Œä¼šè¯çŠ¶æ€çš„æ ¡éªŒï¼Œæå¤§åœ°æå‡äº†ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p> 
<h5><a id="_REST_FrameworkJWT__119"></a>ğŸ“Œ <strong>REST Framework-JWT ä»‹ç»å’Œä½¿ç”¨ï¼šé›†æˆä¸æ‰©å±•</strong></h5> 
<p>Django REST Frameworkï¼ˆDRFï¼‰æä¾›äº†å¼ºå¤§çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œè€Œ <code>djangorestframework-jwt</code> æˆ– <code>django-rest-framework-simplejwt</code> åˆ™è¿›ä¸€æ­¥æ‰©å±•äº†DRFï¼Œæ–¹ä¾¿æˆ‘ä»¬é›†æˆJWTã€‚</p> 
<p><code>rest_framework_simplejwt</code> æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„JWTæ‰©å±•åº“ï¼Œå®ƒèƒ½å¤Ÿè½»æ¾åœ°ä¸DRFé›†æˆï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œè‡ªå®šä¹‰åŠŸèƒ½ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡å®é™…ä»£ç æ¼”ç¤ºå¦‚ä½•åœ¨DRFä¸­é›†æˆJWTè®¤è¯ï¼Œå¹¶è¿›è¡Œæ‰©å±•ä»¥æ»¡è¶³é¡¹ç›®éœ€æ±‚ã€‚</p> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å®‰è£…å¹¶é…ç½® <code>rest_framework_simplejwt</code>ã€‚</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> djangorestframework-simplejwt
</code></pre> 
<p>å®‰è£…å®Œæˆåï¼Œæˆ‘ä»¬åœ¨ <code>settings.py</code> ä¸­è¿›è¡Œé…ç½®ï¼ŒæŒ‡å®šé»˜è®¤çš„è®¤è¯ç±»ä¸º <code>JWTAuthentication</code>ã€‚</p> 
<pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_AUTHENTICATION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework_simplejwt.authentication.JWTAuthentication'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰çš„è§†å›¾å’Œè·¯ç”±ï¼Œä»¥æ”¯æŒJWTçš„ç”Ÿæˆå’Œåˆ·æ–°ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># urls.py é…ç½®</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> <span class="token punctuation">(</span>
    TokenObtainPairView<span class="token punctuation">,</span>
    TokenRefreshView<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'api/token/'</span><span class="token punctuation">,</span> TokenObtainPairView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'token_obtain_pair'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'api/token/refresh/'</span><span class="token punctuation">,</span> TokenRefreshView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'token_refresh'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªè·¯ç”±ï¼Œä¸€ä¸ªç”¨äºè·å–åˆå§‹çš„è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼Œå¦ä¸€ä¸ªç”¨äºåˆ·æ–°è®¿é—®ä»¤ç‰Œã€‚è¿™ç§æœºåˆ¶ç¡®ä¿äº†ä»¤ç‰Œåœ¨è¿‡æœŸåå¯ä»¥é€šè¿‡åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œè€Œä¸éœ€è¦é‡æ–°ç™»å½•ã€‚</p> 
<p>ä¸ºäº†å¢å¼ºé¡¹ç›®çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ <code>TokenObtainPairSerializer</code>ï¼Œä»¥åŠ å…¥é¢å¤–çš„ç”¨æˆ·ä¿¡æ¯åˆ°JWTè½½è·ä¸­ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># serializers.py</span>
<span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> TokenObtainPairSerializer

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairSerializer</span><span class="token punctuation">(</span>TokenObtainPairSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">validate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>validate<span class="token punctuation">(</span>attrs<span class="token punctuation">)</span>
        data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username
        data<span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>user<span class="token punctuation">.</span>email
        <span class="token keyword">return</span> data
</code></pre> 
<p>ç„¶ååœ¨è§†å›¾ä¸­ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„åºåˆ—åŒ–å™¨ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework_simplejwt<span class="token punctuation">.</span>views <span class="token keyword">import</span> TokenObtainPairView

<span class="token keyword">class</span> <span class="token class-name">CustomTokenObtainPairView</span><span class="token punctuation">(</span>TokenObtainPairView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer_class <span class="token operator">=</span> CustomTokenObtainPairSerializer
</code></pre> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ›´å¤šçš„ç”¨æˆ·ä¿¡æ¯åµŒå…¥åˆ°JWTä¸­ï¼Œæ»¡è¶³é¡¹ç›®çš„å…·ä½“éœ€æ±‚ã€‚</p> 
<h5><a id="_REST_Framework__184"></a>ğŸ“Œ <strong>REST Framework èº«ä»½éªŒè¯å’Œæƒé™ç®¡ç†ï¼šå®‰å…¨ä¸çµæ´»æ€§çš„å®Œç¾ç»“åˆ</strong></h5> 
<p>åœ¨æ„å»ºWeb APIæ—¶ï¼Œèº«ä»½éªŒè¯å’Œæƒé™ç®¡ç†æ˜¯ä¸å¯å¿½è§†çš„é‡è¦ç¯èŠ‚ã€‚Django REST Frameworkï¼ˆDRFï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†çµæ´»ä¸”å¼ºå¤§çš„èº«ä»½éªŒè¯ä¸æƒé™ç®¡ç†æœºåˆ¶ã€‚é€šè¿‡åˆç†é…ç½®å’Œæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿APIçš„å®‰å…¨æ€§ï¼Œå¹¶å®ç°ç²¾ç»†åŒ–çš„æƒé™æ§åˆ¶ã€‚</p> 
<h6><a id="1__188"></a>1. <strong>èº«ä»½éªŒè¯</strong></h6> 
<p>åœ¨DRFä¸­ï¼Œèº«ä»½éªŒè¯æ˜¯é€šè¿‡è®¾ç½® <code>DEFAULT_AUTHENTICATION_CLASSES</code> æ¥å®ç°çš„ã€‚å¸¸è§çš„èº«ä»½éªŒè¯æ–¹å¼åŒ…æ‹¬Sessionã€Tokenã€JWTç­‰ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è®¨è®ºJWTçš„èº«ä»½éªŒè¯ã€‚</p> 
<pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    'DEFAULT_AUTHENTICATION_CLASSES

'<span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token string">'rest_framework_simplejwt.authentication.JWTAuthentication'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>é€šè¿‡ä¸Šè¿°é…ç½®ï¼ŒDRFå°†ä½¿ç”¨JWTè¿›è¡Œèº«ä»½éªŒè¯ã€‚æ¯æ¬¡APIè¯·æ±‚æ—¶ï¼ŒDRFä¼šä»è¯·æ±‚å¤´ä¸­æå–JWTï¼Œå¹¶éªŒè¯å…¶æœ‰æ•ˆæ€§ã€‚è‹¥éªŒè¯é€šè¿‡ï¼Œåˆ™è¯·æ±‚å°†ç»§ç»­å¤„ç†ï¼Œå¦åˆ™è¿”å›401æœªæˆæƒé”™è¯¯ã€‚</p> 
<h6><a id="2__204"></a>2. <strong>æƒé™ç®¡ç†</strong></h6> 
<p>DRFçš„æƒé™ç®¡ç†æœºåˆ¶å…è®¸æˆ‘ä»¬æ ¹æ®è¯·æ±‚ç”¨æˆ·çš„èº«ä»½ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚èµ„æºç­‰æ¡ä»¶ï¼Œç²¾ç»†æ§åˆ¶è®¿é—®æƒé™ã€‚DRFæä¾›äº†å¤šç§å†…ç½®æƒé™ç±»ï¼Œå¦‚ <code>AllowAny</code>ã€<code>IsAuthenticated</code>ã€<code>IsAdminUser</code> å’Œ <code>IsAuthenticatedOrReadOnly</code> ç­‰ã€‚</p> 
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>IsAuthenticated</code> æƒé™ç±»ï¼Œç¡®ä¿åªæœ‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æ‰èƒ½è®¿é—®æŸäº›æ•æ„Ÿèµ„æºã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsAuthenticated
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response

<span class="token keyword">class</span> <span class="token class-name">SecureAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'åªæœ‰è®¤è¯ç”¨æˆ·å¯ä»¥çœ‹åˆ°è¿™æ¡ä¿¡æ¯'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æƒé™ç±»ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>IsOwner</code> æƒé™ç±»ï¼Œç¡®ä¿åªæœ‰èµ„æºçš„æ‰€æœ‰è€…æ‰èƒ½å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission

<span class="token keyword">class</span> <span class="token class-name">IsOwner</span><span class="token punctuation">(</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    åªå…è®¸èµ„æºçš„æ‰€æœ‰è€…è¿›è¡Œæ“ä½œ
    """</span>

    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">.</span>owner <span class="token operator">==</span> request<span class="token punctuation">.</span>user
</code></pre> 
<p>åœ¨è§†å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è‡ªå®šä¹‰æƒé™ç±»ä¸å…¶ä»–æƒé™ç±»ç»„åˆä½¿ç”¨ï¼Œä»¥å®ç°å¤æ‚çš„æƒé™æ§åˆ¶é€»è¾‘ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">UserDetailAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>IsAuthenticated<span class="token punctuation">,</span> IsOwner<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>User<span class="token punctuation">,</span> pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>check_object_permissions<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'username'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>email<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>é€šè¿‡ä¸Šè¿°é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿åªæœ‰èµ„æºæ‰€æœ‰è€…æœ¬äººæ‰èƒ½æŸ¥çœ‹æˆ–ä¿®æ”¹å…¶ä¸ªäººä¿¡æ¯ï¼Œæå‡äº†ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p> 
<h5><a id="_REST_Framework___URLPathVersioningQueryParameterVersioning__NamespaceVersioningAPI_250"></a>ğŸ“Œ <strong>REST Framework ç‰ˆæœ¬æ§åˆ¶ - URLPathVersioningã€QueryParameterVersioning å’Œ NamespaceVersioningï¼šçµæ´»åº”å¯¹APIæ¼”åŒ–</strong></h5> 
<p>åœ¨APIå¼€å‘ä¸­ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•å’Œç”¨æˆ·éœ€æ±‚çš„å˜åŒ–ï¼ŒAPIçš„ç‰ˆæœ¬æ§åˆ¶å˜å¾—å°¤ä¸ºé‡è¦ã€‚Django REST Frameworkï¼ˆDRFï¼‰æä¾›äº†å¤šç§ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼ŒåŒ…æ‹¬ <code>URLPathVersioning</code>ã€<code>QueryParameterVersioning</code> å’Œ <code>NamespaceVersioning</code>ï¼Œå¸®åŠ©æˆ‘ä»¬çµæ´»åº”å¯¹APIçš„æ¼”åŒ–ã€‚</p> 
<h6><a id="1_URLPathVersioning_254"></a>1. <strong>URLPathVersioning</strong></h6> 
<p><code>URLPathVersioning</code> æ˜¯ä¸€ç§å°†ç‰ˆæœ¬å·åµŒå…¥åˆ°URLè·¯å¾„ä¸­çš„ç‰ˆæœ¬æ§åˆ¶æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œ<code>/api/v1/resource/</code> å’Œ <code>/api/v2/resource/</code> åˆ†åˆ«å¯¹åº”APIçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å’Œç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚</p> 
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>settings.py</code> ä¸­é…ç½®é»˜è®¤çš„ç‰ˆæœ¬æ§åˆ¶ç±»ä¸º <code>URLPathVersioning</code>ã€‚</p> 
<pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_VERSIONING_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.versioning.URLPathVersioning'</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_VERSION'</span><span class="token punctuation">:</span> <span class="token string">'v1'</span><span class="token punctuation">,</span>
    <span class="token string">'ALLOWED_VERSIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">,</span> <span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ç„¶åï¼Œåœ¨ <code>urls.py</code> ä¸­é…ç½®è·¯å¾„ç‰ˆæœ¬å·ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> <span class="token punctuation">.</span>views <span class="token keyword">import</span> ResourceAPIView

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v1/resource/'</span><span class="token punctuation">,</span> ResourceAPIView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'resource_v1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v2/resource/'</span><span class="token punctuation">,</span> ResourceAPIView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'resource_v2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æŒ‡å®šä¸åŒçš„URLè·¯å¾„æ¥è®¿é—®ä¸åŒç‰ˆæœ¬çš„APIã€‚</p> 
<h6><a id="2_QueryParameterVersioning_282"></a>2. <strong>QueryParameterVersioning</strong></h6> 
<p><code>QueryParameterVersioning</code> æ˜¯å¦ä¸€ç§å¸¸è§çš„ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥ï¼Œå®ƒé€šè¿‡åœ¨è¯·æ±‚URLä¸­æ·»åŠ æŸ¥è¯¢å‚æ•°æ¥æŒ‡å®šAPIç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œ<code>/api/resource/?version=1</code> å’Œ <code>/api/resource/?version=2</code> åˆ†åˆ«å¯¹åº”APIçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å’Œç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚</p> 
<p>åœ¨ <code>settings.py</code> ä¸­é…ç½® <code>QueryParameterVersioning</code>ã€‚</p> 
<pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_VERSIONING_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.versioning.QueryParameterVersioning'</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_VERSION'</span><span class="token punctuation">:</span> <span class="token string">'v1'</span><span class="token punctuation">,</span>
    <span class="token string">'ALLOWED_VERSIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">,</span> <span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'VERSION_PARAM'</span><span class="token punctuation">:</span> <span class="token string">'version'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚URLä¸­æŒ‡å®šæŸ¥è¯¢å‚æ•°æ¥é€‰æ‹©æ‰€éœ€çš„APIç‰ˆæœ¬ã€‚</p> 
<h6><a id="3_NamespaceVersioning_299"></a>3. <strong>NamespaceVersioning</strong></h6> 
<p><code>NamespaceVersioning</code> æ˜¯ä¸€ç§é€šè¿‡URLå‘½åç©ºé—´æ¥å®ç°APIç‰ˆæœ¬æ§åˆ¶çš„ç­–ç•¥ã€‚å®ƒå…è®¸æˆ‘ä»¬ä¸ºä¸åŒç‰ˆæœ¬çš„APIåˆ†é…ä¸åŒçš„URLå‘½åç©ºé—´ï¼Œä»è€Œå®ç°ç‰ˆæœ¬éš”ç¦»ã€‚</p> 
<p>åœ¨ <code>urls.py</code> ä¸­é…ç½®å‘½åç©ºé—´ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v1/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'myapp.urls_v1'</span><span class="token punctuation">,</span> <span class="token string">'myapp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'v1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'api/v2/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'myapp.urls_v2'</span><span class="token punctuation">,</span> <span class="token string">'myapp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'v2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>åœ¨è§†å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>reverse</code> å‡½æ•°æˆ– <code>reverse_lazy</code> å‡½æ•°ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬çš„URLã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">class</span> <span class="token class-name">SomeAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        url_v1 <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'v1:resource-detail'</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'pk'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        url_v2 <span class="token operator">=</span> reverse<span class="token punctuation">(</span><span class="token string">'v2:resource-detail'</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'pk'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'v1_url'</span><span class="token punctuation">:</span> url_v1<span class="token punctuation">,</span> <span class="token string">'v2_url'</span><span class="token punctuation">:</span> url_v2<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿™ç§ç‰ˆæœ¬æ§åˆ¶æ–¹å¼ç‰¹åˆ«é€‚ç”¨äºå¤§å‹é¡¹ç›®ï¼Œé€šè¿‡URLå‘½åç©ºé—´å¯ä»¥æœ‰æ•ˆç®¡ç†ä¸åŒç‰ˆæœ¬çš„APIï¼Œå¹¶ç¡®ä¿ç‰ˆæœ¬ä¹‹é—´çš„éš”ç¦»ã€‚</p> 
<h5><a id="_REST_Framework___AcceptHeaderVersioning_328"></a>ğŸ“Œ <strong>REST Framework ç‰ˆæœ¬æ§åˆ¶ - AcceptHeaderVersioningï¼šé€šè¿‡è¯·æ±‚å¤´å®ç°ç‰ˆæœ¬é€‰æ‹©</strong></h5> 
<p><code>AcceptHeaderVersioning</code> æ˜¯ä¸€ç§é€šè¿‡HTTPè¯·æ±‚å¤´ä¸­çš„ <code>Accept</code> å­—æ®µæ¥æ§åˆ¶APIç‰ˆæœ¬çš„ç­–ç•¥ã€‚å®¢æˆ·ç«¯é€šè¿‡åœ¨è¯·æ±‚å¤´ä¸­æŒ‡å®šç‰ˆæœ¬ä¿¡æ¯ï¼Œæ¥è¯·æ±‚ä¸åŒç‰ˆæœ¬çš„APIã€‚</p> 
<p>åœ¨ <code>settings.py</code> ä¸­é…ç½® <code>AcceptHeaderVersioning</code>ã€‚</p> 
<pre><code class="prism language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'DEFAULT_VERSIONING_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.versioning.AcceptHeaderVersioning'</span><span class="token punctuation">,</span>
    <span class="token string">'DEFAULT_VERSION'</span><span class="token punctuation">:</span> <span class="token string">'v1'</span><span class="token punctuation">,</span>
    <span class="token string">'ALLOWED_VERSIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">,</span> <span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'VERSION_PARAM'</span><span class="token punctuation">:</span> <span class="token string">'version'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ç„¶åï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æŒ‡å®šç‰ˆæœ¬ä¿¡æ¯ï¼š</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"Accept: application/vnd.example.v1+json"</span> https://example.com/api/resource/
</code></pre> 
<p>æˆ–</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">"Accept: application/vnd.example.v2+json"</span> https://example.com/api/resource/
</code></pre> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒAPIçš„ç‰ˆæœ¬ä¿¡æ¯ç›´æ¥åµŒå…¥åˆ°è¯·æ±‚å¤´ä¸­ï¼Œæå‡äº†è¯·æ±‚URLçš„å¯è¯»æ€§ï¼Œå¹¶ä¸”æœ‰åŠ©äºä¿æŒURLçš„ç®€æ´ã€‚</p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6667611450b109a006bec95038b59b69/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">æ™ºèƒ½æ§åˆ¶ï¼Œé«˜æ•ˆèŠ‚èƒ½ã€‚ZLGè‡´è¿œç”µå­èƒ½æºæ™ºæ…§ç®¡ç†è§£å†³æ–¹æ¡ˆ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/516ff4808d6bd0b6d1bb84d0ea45028a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">goä¸­çš„å¹¶å‘å¤„ç†</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>