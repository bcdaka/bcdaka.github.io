<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【hive】行转列—explode()/posexplode()/lateral view 函数使用场景 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a1dbbfc78192b08b24f67b9ea58d0b97/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【hive】行转列—explode()/posexplode()/lateral view 函数使用场景">
  <meta property="og:description" content="文章目录 一、lateral view函数二、explode()函数三、posexplode()函数四、行转列使用单列转多行多列转多行 一、lateral view函数 功能:
用于和UDTF函数（explode,split）结合使用，把某一行数据拆分成多行数据，再将多行结果组合成一个支持别名的虚拟表。主要解决select使用UDTF做查询的过程中查询只能包含单个UDTF，不能包含其它字段以及多个UDTF的情况。 语法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias (‘,’ columnAlias)
columnAlias是给udtf(expression)列起的别名。tableAlias 虚拟表的别名。 lateral view函数会将lUDTF生成的结果放到一个虚拟表中，然后这个虚拟表和输入行进行join来达到连接UDTF外的select字段的目的。
使用方式：
举例1：与explode() 函数连用
--测试表的数据结构，可以看到第一列是id(string类型),第二列是rule_array(array&lt;string&gt;类型) &gt; desc test_2; --结果： &#43;-------------&#43;----------------&#43;----------&#43; | col_name | data_type | comment | &#43;-------------&#43;----------------&#43;----------&#43; | id | string | | | rule_array | array&lt;string&gt; | | &#43;-------------&#43;----------------&#43;----------&#43; --查看测试表的内容 &gt; select * from test_2; --结果： &#43;------------&#43;----------------------------------------&#43; | test_2.id | test_2.rule_array | &#43;------------&#43;----------------------------------------&#43; | a | [&#34;501&#34;,&#34;502&#34;,&#34;503&#34;,&#34;501&#34;,&#34;512&#34;] | | b | [&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-13T15:22:30+08:00">
    <meta property="article:modified_time" content="2023-09-13T15:22:30+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【hive】行转列—explode()/posexplode()/lateral view 函数使用场景</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#lateral_view_6" rel="nofollow">一、lateral view函数</a></li><li><a href="#explode_165" rel="nofollow">二、explode()函数</a></li><li><a href="#posexplode_279" rel="nofollow">三、posexplode()函数</a></li><li><a href="#_344" rel="nofollow">四、行转列使用</a></li><li><ul><li><a href="#_346" rel="nofollow">单列转多行</a></li><li><a href="#_432" rel="nofollow">多列转多行</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="lateral_view_6"></a>一、lateral view函数</h2> 
<ul><li> <p>功能:</p> 
  <ul><li>用于和UDTF函数（explode,split）结合使用，把某一行数据拆分成多行数据，再将多行结果组合成一个支持别名的虚拟表。</li><li>主要解决select使用UDTF做查询的过程中查询只能包含单个UDTF，不能包含其它字段以及多个UDTF的情况。</li></ul> </li><li> <p>语法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias (‘,’ columnAlias)</p> 
  <ul><li>columnAlias是给udtf(expression)列起的别名。</li><li>tableAlias 虚拟表的别名。</li></ul> </li><li> <p>lateral view函数会将lUDTF生成的结果放到一个虚拟表中，然后这个虚拟表和输入行进行join来达到连接UDTF外的select字段的目的。</p> </li></ul> 
<p>使用方式：</p> 
<p>举例1：与explode() 函数连用</p> 
<pre><code class="prism language-bash">--测试表的数据结构，可以看到第一列是id<span class="token punctuation">(</span>string类型<span class="token punctuation">)</span>,第二列是rule_array<span class="token punctuation">(</span>array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>类型<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> desc test_2<span class="token punctuation">;</span>

--结果：
+-------------+----------------+----------+
<span class="token operator">|</span>  col_name   <span class="token operator">|</span>   data_type    <span class="token operator">|</span> comment  <span class="token operator">|</span>
+-------------+----------------+----------+
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> string         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> rule_array  <span class="token operator">|</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
+-------------+----------------+----------+

--查看测试表的内容
<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from test_2<span class="token punctuation">;</span>

--结果：
+------------+----------------------------------------+
<span class="token operator">|</span> test_2.id  <span class="token operator">|</span>           test_2.rule_array            <span class="token operator">|</span>
+------------+----------------------------------------+
<span class="token operator">|</span> a          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"501"</span>,<span class="token string">"502"</span>,<span class="token string">"503"</span>,<span class="token string">"501"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>        <span class="token operator">|</span>
<span class="token operator">|</span> b          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"511"</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> c          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>              <span class="token operator">|</span>
+------------+----------------------------------------+

--拆分rule_array
<span class="token operator">&gt;</span> <span class="token keyword">select</span> id, rule_explode 
<span class="token operator">&gt;</span> from test_2
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> adTable AS rule_explode<span class="token punctuation">;</span>

--结果：
+-----+---------------+
<span class="token operator">|</span> <span class="token function">id</span>  <span class="token operator">|</span> rule_explode  <span class="token operator">|</span>
+-----+---------------+
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">501</span>           <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">502</span>           <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">503</span>           <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">501</span>           <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">512</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">512</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">513</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">512</span>           <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>           <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">512</span>           <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">513</span>           <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">511</span>           <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">512</span>           <span class="token operator">|</span>
+-----+---------------+
</code></pre> 
<p>举例2：与parse_url_tuple()函数连用</p> 
<ul><li>parse_url_tuple()函数 
  <ul><li>语法：parse_url(string urlString, string partToExtract [, string keyToExtract])</li><li>功能：UDTF函数，解析URL字符串，它通过一次指定多个参数，从URL中解析出多个参数值返回多列。</li><li>参数：partToExtract的有效值为：HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO。</li><li>注意：在使用 select 时不能同时返回其他字段，不能嵌套调用，不能与group by放在一起调用等。为解决此问题，可以通过测试图(Lateral View)搭配调用。</li></ul> </li></ul> 
<pre><code class="prism language-bash">--测试表的数据结构，可以看到第一列是id<span class="token punctuation">(</span>int类型<span class="token punctuation">)</span>,第二列是url<span class="token punctuation">(</span>string类型<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> desc tb_url<span class="token punctuation">;</span>

--结果：
+-----------+------------+----------+
<span class="token operator">|</span> col_name  <span class="token operator">|</span> data_type  <span class="token operator">|</span> comment  <span class="token operator">|</span>
+-----------+------------+----------+
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> int        <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> url       <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
+-----------+------------+----------+

--查看测试表的内容
<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from tb_url<span class="token punctuation">;</span>

--结果：
+------------+-------------------------------------------------+
<span class="token operator">|</span> tb_url.id  <span class="token operator">|</span>                   tb_url.url                    <span class="token operator">|</span>
+------------+-------------------------------------------------+
<span class="token operator">|</span> <span class="token number">1</span>          <span class="token operator">|</span> http://facebook.com/path/p1.php?query<span class="token operator">=</span><span class="token number">1</span>         <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>          <span class="token operator">|</span> http://www.baidu.com/news/index.jsp?uuid<span class="token operator">=</span>frank  <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>          <span class="token operator">|</span> http://www.jd.com/index?source<span class="token operator">=</span>baidu            <span class="token operator">|</span>
+------------+-------------------------------------------------+

--提取tb_url的query部分
<span class="token operator">&gt;</span> <span class="token keyword">select</span>
<span class="token operator">&gt;</span> a.id as id,
<span class="token operator">&gt;</span> c.query as query
<span class="token operator">&gt;</span> from tb_url a
<span class="token operator">&gt;</span> lateral view parse_url_tuple<span class="token punctuation">(</span>url,<span class="token string">"QUERY"</span><span class="token punctuation">)</span> c as query
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-----+---------------+
<span class="token operator">|</span> <span class="token function">id</span>  <span class="token operator">|</span>     query     <span class="token operator">|</span>
+-----+---------------+
<span class="token operator">|</span> <span class="token number">1</span>   <span class="token operator">|</span> <span class="token assign-left variable">query</span><span class="token operator">=</span><span class="token number">1</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>   <span class="token operator">|</span> <span class="token assign-left variable">uuid</span><span class="token operator">=</span>frank    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>   <span class="token operator">|</span> <span class="token assign-left variable">source</span><span class="token operator">=</span>baidu  <span class="token operator">|</span>
+-----+---------------+
</code></pre> 
<p>举例3：多个lateral view连用</p> 
<pre><code class="prism language-bash">--提取tb_url的HOST、<span class="token environment constant">PATH</span>和QUERY部分
<span class="token operator">&gt;</span> <span class="token keyword">select</span>
<span class="token operator">&gt;</span> a.id as id,
<span class="token operator">&gt;</span> b.host as host,
<span class="token operator">&gt;</span> b.path as path,
<span class="token operator">&gt;</span> c.query as query
<span class="token operator">&gt;</span> from tb_url a
<span class="token operator">&gt;</span> lateral view parse_url_tuple<span class="token punctuation">(</span>url,<span class="token string">"HOST"</span>,<span class="token string">"PATH"</span><span class="token punctuation">)</span> b as host,path
<span class="token operator">&gt;</span> lateral view parse_url_tuple<span class="token punctuation">(</span>url,<span class="token string">"QUERY"</span><span class="token punctuation">)</span> c as query
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-----+----------------+------------------+---------------+
<span class="token operator">|</span> <span class="token function">id</span>  <span class="token operator">|</span>      <span class="token function">host</span>      <span class="token operator">|</span>       path       <span class="token operator">|</span>     query     <span class="token operator">|</span>
+-----+----------------+------------------+---------------+
<span class="token operator">|</span> <span class="token number">1</span>   <span class="token operator">|</span> facebook.com   <span class="token operator">|</span> /path/p1.php     <span class="token operator">|</span> <span class="token assign-left variable">query</span><span class="token operator">=</span><span class="token number">1</span>       <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2</span>   <span class="token operator">|</span> www.baidu.com  <span class="token operator">|</span> /news/index.jsp  <span class="token operator">|</span> <span class="token assign-left variable">uuid</span><span class="token operator">=</span>frank    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3</span>   <span class="token operator">|</span> www.jd.com     <span class="token operator">|</span> /index           <span class="token operator">|</span> <span class="token assign-left variable">source</span><span class="token operator">=</span>baidu  <span class="token operator">|</span>
+-----+----------------+------------------+---------------+
</code></pre> 
<p><strong>注意：</strong></p> 
<ul><li>lateral view函数的位置在from后where条件前。</li><li>生成虚拟表的别名不可省略。</li><li>from后可带多个 lateral view函数。</li><li>如果要拆分的字段有null值，需要使用 lateral view outer替代，避免数据缺失。</li></ul> 
<hr> 
<h2><a id="explode_165"></a>二、explode()函数</h2> 
<ul><li>功能：UDTF函数，可以将一个array或者map展开</li><li>语法：explode(map&lt;string&gt; ,array &lt;string&gt;) 
  <ul><li>explode(array)：将array列表里的每个元素生成一行</li><li>explode(map)：每一对元素作为一行，key为一列，value为一列</li></ul> </li></ul> 
<p>使用方式:</p> 
<p>举例1：直接使用</p> 
<pre><code class="prism language-bash">--explode<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>array<span class="token punctuation">(</span><span class="token number">11,22</span>,33<span class="token punctuation">))</span> as item<span class="token punctuation">;</span>

--结果：
+-------+
<span class="token operator">|</span> item  <span class="token operator">|</span>
+-------+
<span class="token operator">|</span> <span class="token number">11</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span>    <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">33</span>    <span class="token operator">|</span>
+-------+

--explode<span class="token punctuation">(</span>map<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>map<span class="token punctuation">(</span><span class="token string">"id"</span>,11,<span class="token string">"name"</span>,<span class="token string">"lily"</span>,<span class="token string">"age"</span>,18<span class="token punctuation">))</span> as <span class="token punctuation">(</span>k,v<span class="token punctuation">)</span><span class="token punctuation">;</span>

--结果：
+-------+-------+
<span class="token operator">|</span>   k   <span class="token operator">|</span>   <span class="token function">v</span>   <span class="token operator">|</span>
+-------+-------+
<span class="token operator">|</span> <span class="token function">id</span>    <span class="token operator">|</span> <span class="token number">11</span>    <span class="token operator">|</span>
<span class="token operator">|</span> name  <span class="token operator">|</span> lily  <span class="token operator">|</span>
<span class="token operator">|</span> age   <span class="token operator">|</span> <span class="token number">18</span>    <span class="token operator">|</span>
+-------+-------+
</code></pre> 
<p>举例2：与lateral view一起使用</p> 
<ul><li>语法：lateral view explode(字段) 表别名 as 列别名</li><li>如果字段类型是map：lateral view explode(字段) 表别名 as (key别名,value别名)</li></ul> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> * from test_2<span class="token punctuation">;</span>

--结果：
+------------+----------------------------------------+
<span class="token operator">|</span> test_2.id  <span class="token operator">|</span>           test_2.rule_array            <span class="token operator">|</span>
+------------+----------------------------------------+
<span class="token operator">|</span> a          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"501"</span>,<span class="token string">"502"</span>,<span class="token string">"503"</span>,<span class="token string">"501"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>        <span class="token operator">|</span>
<span class="token operator">|</span> b          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"511"</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> c          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>              <span class="token operator">|</span>
+------------+----------------------------------------+

<span class="token operator">&gt;</span> <span class="token keyword">select</span> id,rule
<span class="token operator">&gt;</span> from test_2 
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> tbl as rule
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-----+-------+
<span class="token operator">|</span> <span class="token function">id</span>  <span class="token operator">|</span> rule  <span class="token operator">|</span>
+-----+-------+
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">501</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">502</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">503</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">501</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a   <span class="token operator">|</span> <span class="token number">512</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">512</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">513</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">512</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b   <span class="token operator">|</span> <span class="token number">511</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">512</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">513</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">511</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c   <span class="token operator">|</span> <span class="token number">512</span>   <span class="token operator">|</span>
+-----+-------+
</code></pre> 
<p>举例3：使用局限性</p> 
<ul><li>不能关联原有的表中其它字段。例如：</li></ul> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> id, explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> as rule from test_2<span class="token punctuation">;</span>

--报错：
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token punctuation">[</span>Error <span class="token number">10081</span><span class="token punctuation">]</span>: UDTF's are not supported outside the SELECT clause, nor nested <span class="token keyword">in</span> expressions <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42000</span>,code<span class="token operator">=</span><span class="token number">10081</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>不能与group by、cluster by 、distribute by、sort by联用。例如：</li></ul> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> as rule from test_2 group by explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span><span class="token punctuation">;</span>

--报错：
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token punctuation">[</span>Error <span class="token number">10081</span><span class="token punctuation">]</span>: UDTF's are not supported outside the SELECT clause, nor nested <span class="token keyword">in</span> expressions <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42000</span>,code<span class="token operator">=</span><span class="token number">10081</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>不能进行UDTF嵌套。例如：</li></ul> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span>explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">))</span> from test_2 <span class="token punctuation">;</span>

--报错：
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: SemanticException <span class="token punctuation">[</span>Error <span class="token number">10081</span><span class="token punctuation">]</span>: UDTF's are not supported outside the SELECT clause, nor nested <span class="token keyword">in</span> expressions <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42000</span>,code<span class="token operator">=</span><span class="token number">10081</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>不允许选择其他表达式。例如：</li></ul> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> explode<span class="token punctuation">(</span><span class="token string">"1,2,3,4,5"</span><span class="token punctuation">)</span> from test_2 <span class="token punctuation">;</span> 

--报错：
Error: Error <span class="token keyword">while</span> compiling statement: FAILED: UDFArgumentException explode<span class="token punctuation">(</span><span class="token punctuation">)</span> takes an array or a map as a parameter <span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token number">42000</span>,code<span class="token operator">=</span><span class="token number">40000</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h2><a id="posexplode_279"></a>三、posexplode()函数</h2> 
<ul><li>功能：UDTF函数，将一个array或者map展开，可以将index（索引）和数据都取出来，使用两次posexplode()并用where语句使两次取到的index相等，从而实现对多列进行多行转换。explode()函数只能将对一列进行行转换。</li><li>语法：posexplode(map&lt;string&gt; ,array &lt;string&gt;)</li></ul> 
<p>使用方式:</p> 
<p>举例1：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> desc test_2<span class="token punctuation">;</span>

--结果：
+-------------+----------------+----------+
<span class="token operator">|</span>  col_name   <span class="token operator">|</span>   data_type    <span class="token operator">|</span> comment  <span class="token operator">|</span>
+-------------+----------------+----------+
<span class="token operator">|</span> <span class="token function">id</span>          <span class="token operator">|</span> string         <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> dt_array    <span class="token operator">|</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> rule_array  <span class="token operator">|</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>  <span class="token operator">|</span>          <span class="token operator">|</span>
+-------------+----------------+----------+

<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from test_2<span class="token punctuation">;</span>

--结果：
+------------+----------------------------------------------------+----------------------------------------+
<span class="token operator">|</span> test_2.id  <span class="token operator">|</span>                  test_2.dt_array                   <span class="token operator">|</span>           test_2.rule_array            <span class="token operator">|</span>
+------------+----------------------------------------------------+----------------------------------------+
<span class="token operator">|</span> a          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"20230809"</span>,<span class="token string">"20230811"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230813"</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"501"</span>,<span class="token string">"502"</span>,<span class="token string">"503"</span>,<span class="token string">"501"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>        <span class="token operator">|</span>
<span class="token operator">|</span> b          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"20230809"</span>,<span class="token string">"20230811"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230813"</span>,<span class="token string">"20230809"</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span>,<span class="token string">"511"</span><span class="token punctuation">]</span>  <span class="token operator">|</span>
<span class="token operator">|</span> c          <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"20230811"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230812"</span>,<span class="token string">"20230813"</span><span class="token punctuation">]</span>      <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token string">"512"</span>,<span class="token string">"513"</span>,<span class="token string">"511"</span>,<span class="token string">"512"</span><span class="token punctuation">]</span>              <span class="token operator">|</span>
+------------+----------------------------------------------------+----------------------------------------+

--注：语句中b.idxb和c.idxc分别是子视图的两个索引，我们where子句中使用b.idxb<span class="token operator">=</span>c.idxc保证顺序的一致性。
<span class="token operator">&gt;</span> <span class="token keyword">select</span> a.id,b.cur_day,c.rule 
<span class="token operator">&gt;</span> from test_2 a
<span class="token operator">&gt;</span> lateral view posexplode<span class="token punctuation">(</span>dt_array<span class="token punctuation">)</span> b as idxb,cur_day,
<span class="token operator">&gt;</span> lateral view posexplode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> c as idxc,rule where <span class="token assign-left variable">b.idxb</span><span class="token operator">=</span>c.idxc
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-------+------------+---------+
<span class="token operator">|</span> a.id  <span class="token operator">|</span> b.cur_day  <span class="token operator">|</span> c.rule  <span class="token operator">|</span>
+-------+------------+---------+
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
+-------+------------+---------+
</code></pre> 
<hr> 
<h2><a id="_344"></a>四、行转列使用</h2> 
<h3><a id="_346"></a>单列转多行</h3> 
<p>举例1：使用explode()+lateral view</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> t.id,a.cur_day
<span class="token operator">&gt;</span> from test_2 t
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>t.dt_array<span class="token punctuation">)</span> a as cur_day
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-------+------------+
<span class="token operator">|</span> t.id  <span class="token operator">|</span> a.cur_day  <span class="token operator">|</span>
+-------+------------+
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
+-------+------------+
</code></pre> 
<p>举例2：explode字段是string格式，先split()指定分隔符，如果省略split()则使用默认分隔符是英文逗号。</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> desc test_3<span class="token punctuation">;</span>

--结果：
+-----------+------------+----------+
<span class="token operator">|</span> col_name  <span class="token operator">|</span> data_type  <span class="token operator">|</span> comment  <span class="token operator">|</span>
+-----------+------------+----------+
<span class="token operator">|</span> <span class="token function">id</span>        <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> dt        <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
<span class="token operator">|</span> rule1     <span class="token operator">|</span> string     <span class="token operator">|</span>          <span class="token operator">|</span>
+-----------+------------+----------+

<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from test_3<span class="token punctuation">;</span>

--结果：
+------------+----------------------------------------------------+--------------------------+
<span class="token operator">|</span> test_3.id  <span class="token operator">|</span>                     test_3.dt                      <span class="token operator">|</span>       test_3.rule1       <span class="token operator">|</span>
+------------+----------------------------------------------------+--------------------------+
<span class="token operator">|</span> a          <span class="token operator">|</span> <span class="token number">20230809,20230811</span>,20230812,20230812,20230813       <span class="token operator">|</span> <span class="token number">501,502</span>,503,501,512      <span class="token operator">|</span>
<span class="token operator">|</span> b          <span class="token operator">|</span> <span class="token number">20230809,20230811</span>,20230812,20230812,20230813,20230809 <span class="token operator">|</span> <span class="token number">511,512</span>,513,511,512,511  <span class="token operator">|</span>
<span class="token operator">|</span> c          <span class="token operator">|</span> <span class="token number">20230811,20230812</span>,20230812,20230813                <span class="token operator">|</span> <span class="token number">512,513</span>,511,512          <span class="token operator">|</span>
+------------+----------------------------------------------------+--------------------------+

<span class="token operator">&gt;</span> <span class="token keyword">select</span> t.id,a.cur_day
<span class="token operator">&gt;</span> from test_3 t
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>split<span class="token punctuation">(</span>t.dt,<span class="token string">','</span><span class="token punctuation">))</span> a as cur_day
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-------+------------+
<span class="token operator">|</span> t.id  <span class="token operator">|</span> a.cur_day  <span class="token operator">|</span>
+-------+------------+
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span>
+-------+------------+
</code></pre> 
<h3><a id="_432"></a>多列转多行</h3> 
<p>举例1：使用posexplode()+lateral view</p> 
<p>先测试使用explode(), 看看效果:</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span>  a.id,b.cur_day,c.rule 
<span class="token operator">&gt;</span> from test_2 a
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>dt_array<span class="token punctuation">)</span> b as cur_day,
<span class="token operator">&gt;</span> lateral view explode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> c as rule
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-------+------------+---------+
<span class="token operator">|</span> a.id  <span class="token operator">|</span> b.cur_day  <span class="token operator">|</span> c.rule  <span class="token operator">|</span>
+-------+------------+---------+
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
+-------+------------+---------+
</code></pre> 
<p>出现这种情况，是因为两个并列的explode()的hql没办法识别cur_day对应的rule是什么，对于多个数组的行转列可以使用posexplode()函数。<br> 例如使用如下查询语句：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> <span class="token keyword">select</span> a.id,b.cur_day,c.rule 
<span class="token operator">&gt;</span> from test_2 a
<span class="token operator">&gt;</span> lateral view posexplode<span class="token punctuation">(</span>dt_array<span class="token punctuation">)</span> b as idxb,cur_day,
<span class="token operator">&gt;</span> lateral view posexplode<span class="token punctuation">(</span>rule_array<span class="token punctuation">)</span> c as idxc,rule where <span class="token assign-left variable">b.idxb</span><span class="token operator">=</span>c.idxc
<span class="token operator">&gt;</span> <span class="token punctuation">;</span>

--结果：
+-------+------------+---------+
<span class="token operator">|</span> a.id  <span class="token operator">|</span> b.cur_day  <span class="token operator">|</span> c.rule  <span class="token operator">|</span>
+-------+------------+---------+
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> b     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">513</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">511</span>     <span class="token operator">|</span>
<span class="token operator">|</span> c     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230809</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230811</span>   <span class="token operator">|</span> <span class="token number">502</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">503</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230812</span>   <span class="token operator">|</span> <span class="token number">501</span>     <span class="token operator">|</span>
<span class="token operator">|</span> a     <span class="token operator">|</span> <span class="token number">20230813</span>   <span class="token operator">|</span> <span class="token number">512</span>     <span class="token operator">|</span>
+-------+------------+---------+
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9ff15d7e2fa2b3b7666f859c3abd3687/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">H5（uniapp）跳转至小程序页面</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd8fae7d70b914ecf4a85a93b334eb42/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python 如何降低版本?从 Python3.9降低到 3.8, /anaconda/虚拟环境等.</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>