<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】string模拟实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/fd5588ba8277b4e893d08ed5e1d8679e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】string模拟实现">
  <meta property="og:description" content="🔥个人主页： Forcible Bug Maker
🔥专栏： STL || C&#43;&#43;
目录 前言🔥string类的接口函数🔥string类的模拟实现==swap交换====默认成员函数====迭代器====获取容量和内容信息====reserve预留空间====尾插字符和字符串====字符或字符串的插入和删除====find查找====比大小运算符重载====获取子串====清除clear====流插入和流提取====常量成员npos== 结语 前言 本篇博客主要内容：实现string类的基本功能。
string使用很快就讲完了，但是光会用string还不够，在面试中，面试官总喜欢让我们自己来模拟实现string类，包括string类的构造、拷贝构造、赋值运算符重载以及析构函数等等内容。所以，我认为string类的自实现还是有必要讲一下的。
🔥string类的接口函数 我们本次并不会将string类的所有接口函数逐一讲解，讲一些常用的和重点的。本次string的实现分成了两个文件，一份是string.h，一份string.cpp。
看看string.h的内容：
# define _CRT_SECURE_NO_WARNINGS 1 #pragma once #include&lt;iostream&gt; #include&lt;cstring&gt; #include&lt;cassert&gt; using std::cout; using std::cin; using std::endl; namespace ForcibleBugMaker { class string { public: // 交换，非成员函数 friend void swap(string&amp; s1, string s2); // 定义迭代器 typedef char* iterator; typedef const char* const_iterator; //迭代器获取 iterator begin(); iterator end(); const_iterator begin() const; const_iterator end() const; // string默认成员函数 string(const char* str = &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-18T20:30:39+08:00">
    <meta property="article:modified_time" content="2024-05-18T20:30:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】string模拟实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/b1/a8/mtOttWIw_o.png" alt="在这里插入图片描述"></p> 
<p>🔥<font color="SandyBrown"><strong>个人主页：</strong> <a href="https://blog.csdn.net/2303_79329831?spm=1000.2115.3001.5343"><font color="LightSeaGreen"><strong>Forcible Bug Maker</strong></font></a><br> 🔥<strong>专栏：</strong> <a href="https://blog.csdn.net/2303_79329831/category_12665973.html"><font color="LightSeaGreen"><strong>STL</strong></font></a> || <a href="https://blog.csdn.net/2303_79329831/category_12597496.html?spm=1001.2014.3001.5482"><font color="LightSeaGreen"><strong>C++</strong></font></a><br> </font></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">前言</a></li><li><a href="#string_10" rel="nofollow">🔥string类的接口函数</a></li><li><a href="#string_112" rel="nofollow">🔥string类的模拟实现</a></li><li><ul><li><a href="#swap_115" rel="nofollow">==swap交换==</a></li><li><a href="#_144" rel="nofollow">==默认成员函数==</a></li><li><a href="#_214" rel="nofollow">==迭代器==</a></li><li><a href="#_258" rel="nofollow">==获取容量和内容信息==</a></li><li><a href="#reserve_292" rel="nofollow">==reserve预留空间==</a></li><li><a href="#_307" rel="nofollow">==尾插字符和字符串==</a></li><li><a href="#_360" rel="nofollow">==字符或字符串的插入和删除==</a></li><li><a href="#find_433" rel="nofollow">==find查找==</a></li><li><a href="#_461" rel="nofollow">==比大小运算符重载==</a></li><li><a href="#_490" rel="nofollow">==获取子串==</a></li><li><a href="#clear_509" rel="nofollow">==清除clear==</a></li><li><a href="#_518" rel="nofollow">==流插入和流提取==</a></li><li><a href="#npos_549" rel="nofollow">==常量成员npos==</a></li></ul> 
  </li><li><a href="#_555" rel="nofollow">结语</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_6"></a>前言</h2> 
<blockquote> 
 <p>本篇博客主要内容：实现<strong>string类的基本功能</strong>。</p> 
</blockquote> 
<p>string使用很快就讲完了，但是光会用string还不够，在面试中，面试官总喜欢让我们自己来模拟实现string类，包括string类的构造、拷贝构造、赋值运算符重载以及析构函数等等内容。所以，我认为string类的自实现还是有必要讲一下的。</p> 
<h2><a id="string_10"></a>🔥string类的接口函数</h2> 
<p>我们本次并不会将string类的所有接口函数逐一讲解，讲一些常用的和重点的。本次string的实现分成了两个文件，一份是<code>string.h</code>，一份<code>string.cpp</code>。<br> 看看string.h的内容：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">define</span> <span class="token macro-name">_CRT_SECURE_NO_WARNINGS</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cstring&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cassert&gt;</span></span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cin<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token keyword">namespace</span> ForcibleBugMaker
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">class</span> <span class="token class-name">string</span> 
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token comment">// 交换，非成员函数</span>
		<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> s1<span class="token punctuation">,</span> string s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 定义迭代器</span>
		<span class="token keyword">typedef</span> <span class="token keyword">char</span><span class="token operator">*</span> iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> const_iterator<span class="token punctuation">;</span>
		<span class="token comment">//迭代器获取</span>
		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// string默认成员函数</span>
		<span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
		string<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>string tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 获取只读字符串</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// 获取容量</span>
		size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		size_t <span class="token function">capaity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// []获取元素重载</span>
		<span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// 开辟空间</span>
		<span class="token keyword">void</span> <span class="token function">reserve</span><span class="token punctuation">(</span>size_t n<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 尾插字符或字符串</span>
		<span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		string<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		string<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 插入字符或字符串</span>
		<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//删除字符串</span>
		<span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span>size_t pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> size_t len <span class="token operator">=</span> npos<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 查找字符或字串</span>
		size_t <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">,</span> size_t pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		size_t <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> size_t pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// string对象比较</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// 获取string对象字串</span>
		string <span class="token function">substr</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 交换函数，成员函数</span>
		<span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 清除串中内容</span>
		<span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		<span class="token keyword">char</span><span class="token operator">*</span> _str <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		size_t _size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		size_t _capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token comment">// 常量成员</span>
		<span class="token keyword">const</span> <span class="token keyword">static</span> size_t npos<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// 交换函数，非成员函数</span>
	<span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> s1<span class="token punctuation">,</span> string s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 流插入和流提取重载，非成员函数</span>
	std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> so<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在实现string类添加和拷贝的一些函数中，使用了C语言中的一些库函数，以此方便实现，这些函数在C++中统一存放在<code>&lt;cstring&gt;</code>。<br> 如果对C语言的一些字符串函数不太了解，可以看看我之前写的一篇博客：<a href="https://blog.csdn.net/2303_79329831/article/details/134655675?spm=1001.2014.3001.5501">C语言-字符串函数</a>，相信会对你有所帮助。</p> 
<h2><a id="string_112"></a>🔥string类的模拟实现</h2> 
<p>接下来进入主要内容，按照string.h的接口开始实现。</p> 
<blockquote> 
 <p>以下接口都是放在命名空间里的，不同文件的相同命名空间在编译时会自动合并。</p> 
</blockquote> 
<h3><a id="swap_115"></a><mark>swap交换</mark></h3> 
<p>如果你仔细观察，会发现存在两个swap交换函数，一个string中的成员函数，另一个是非成员函数。<br> 在std的默认swap当中，是这样的：<br> <img src="https://images2.imgbox.com/d6/b6/aSBalo5O_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token keyword">void</span> <span class="token function">swap</span> <span class="token punctuation">(</span> T<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> T<span class="token operator">&amp;</span> b <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  T <span class="token function">c</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> a<span class="token operator">=</span>b<span class="token punctuation">;</span> b<span class="token operator">=</span>c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当我们使用这个成员函数进行交换时，会造成拷贝消耗，我们提供对应的非成员函数重载是为了防止C++程序员掉坑。<br> <strong>成员函数的swap：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> str<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_size<span class="token punctuation">,</span> str<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_capacity<span class="token punctuation">,</span> str<span class="token punctuation">.</span>_capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>非成员函数的swap：</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> s1<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> s2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>_str<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>_size<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span>_capacity<span class="token punctuation">,</span> s2<span class="token punctuation">.</span>_capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_144"></a><mark>默认成员函数</mark></h3> 
<p>默认成员函数，就是不提供编译器自动会生成的一些函数。我们这里实现<strong>构造函数，析构函数和赋值运算符重载</strong>。</p> 
<p><strong>构造函数：</strong></p> 
<pre><code class="prism language-cpp">string<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
	<span class="token operator">:</span><span class="token function">_size</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	_capacity <span class="token operator">=</span> _size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	_str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>_capacity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	_str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>s<span class="token punctuation">.</span>_capacity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_size <span class="token operator">=</span> s<span class="token punctuation">.</span>_size<span class="token punctuation">;</span>
	_capacity <span class="token operator">=</span> s<span class="token punctuation">.</span>_capacity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>构造函数提供了两个，分别支持了字符串构造和string对象构造。_str指向通过new开辟空间，这个空间需要比实际的capacity大，因为需要在字符串末尾多存放一个<code>'\0'</code>。</p> 
<p><strong>析构函数：</strong></p> 
<pre><code class="prism language-cpp"><span class="token class-name">string</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span>
	_str <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	_capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个没什么好说，释放空间，指针置空，_size和_capacity置0。</p> 
<p><strong>赋值运算符重载：</strong></p> 
<blockquote> 
 <p>string的赋值属于深拷贝。</p> 
</blockquote> 
<blockquote> 
 <p>拷贝分为深拷贝和浅拷贝：<br> 浅拷贝：也称位拷贝，编译器<strong>只是将对象中的值拷贝过来</strong>。如果对象中管理资源，最后就会导致多个对象共享同一份资源，当一个对象销毁时就会将该资源释放掉，而此时另一些对象不知道该资源已经被释放，以为还有效，所以当继续对资源进项操作时，就会发生发生了访问违规。可以<strong>采用深拷贝解决浅拷贝问题</strong>，即：<strong>每个对象都有一份独立的资源，不要和其他对象共享</strong>。<br> 深拷贝：<strong>如果一个类中涉及到资源的管理，其拷贝构造函数、赋值运算符重载以及析构函数必须要显式给出</strong>。一般情况都是按照深拷贝方式提供。</p> 
</blockquote> 
<p>浅拷贝：<br> <img src="https://images2.imgbox.com/2d/f7/RwbTJlcn_o.png" alt="在这里插入图片描述"><br> 深拷贝：<br> <img src="https://images2.imgbox.com/d6/5a/2qtJ6gd8_o.png" alt="在这里插入图片描述"><br> <strong>如果中规中矩的来写（传统版赋值重载）：</strong></p> 
<pre><code class="prism language-cpp">String<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> String<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">char</span><span class="token operator">*</span> pStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>pStr<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span>
		_str <span class="token operator">=</span> pStr<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但如果你能对之前实现的代码进行复用，你会发现这个过程<strong>可以简化非常多（现代版赋值重载）</strong>：</p> 
<pre><code class="prism language-cpp">string<span class="token operator">&amp;</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>string tmp<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 调用成员函数的swap，交换*this和tmp</span>
	<span class="token function">swap</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>在C++的编写中，学会复很有必要。</p> 
</blockquote> 
<h3><a id="_214"></a><mark>迭代器</mark></h3> 
<p>之前讲过，迭代器不一定是指针，但是你可以把它想象成指针，可以通过正常的运算操作来控制其指向的元素。在string中，我们使用指针来模拟实现迭代器。</p> 
<blockquote> 
 <p>迭代器在不同编译器下的实现方式有所不同，比如VS下的迭代器就不是一个指针，而是一个类模板。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5c/42/t3WXZ0iP_o.png" alt="在这里插入图片描述"><br> 在类中需要typedef一下，可以看到我们所实现的<strong>string迭代器的本质：</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 定义迭代器</span>
<span class="token keyword">typedef</span> <span class="token keyword">char</span><span class="token operator">*</span> iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> const_iterator<span class="token punctuation">;</span>
</code></pre> 
<p><strong>获取迭代器的接口：</strong></p> 
<pre><code class="prism language-cpp">string<span class="token double-colon punctuation">::</span>iterator string<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token double-colon punctuation">::</span>iterator string<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str <span class="token operator">+</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token double-colon punctuation">::</span>const_iterator string<span class="token double-colon punctuation">::</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token double-colon punctuation">::</span>const_iterator string<span class="token double-colon punctuation">::</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str <span class="token operator">+</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这时，我们已经可以使用我们自己的迭代器了：</p> 
<pre><code class="prism language-cpp">string <span class="token function">str</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
string<span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
	<span class="token operator">++</span>it<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/cb/odUuJRsp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_258"></a><mark>获取容量和内容信息</mark></h3> 
<p>这些都是返回str类型状态和内容的函数。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token double-colon punctuation">::</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

size_t string<span class="token double-colon punctuation">::</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

size_t string<span class="token double-colon punctuation">::</span><span class="token function">capaity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _capacity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 运算符重载</span>
<span class="token keyword">char</span><span class="token operator">&amp;</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> _str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> _str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>都比较简单易懂。</p> 
<h3><a id="reserve_292"></a><mark>reserve预留空间</mark></h3> 
<p>在开始字符串增删查改之前，有必要介绍这个函数，使用它可以更好的控制我们string对象的内存管理。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">reserve</span><span class="token punctuation">(</span>size_t n<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_capacity <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">char</span><span class="token operator">*</span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> _str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span>
		_str <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> n<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当n大于当前容量_capacity的时候，进行空间的开辟，将_str中的内容拷贝到新空间中去，同时delete释放旧空间。</p> 
<h3><a id="_307"></a><mark>尾插字符和字符串</mark></h3> 
<p>接口函数，一个是push_back，一个是append。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">&gt;=</span> _capacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	_str<span class="token punctuation">[</span>_size<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
	_str<span class="token punctuation">[</span>_size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_capacity <span class="token operator">&lt;</span> _size <span class="token operator">+</span> len<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_size <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> _size<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_size <span class="token operator">+=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这两个成员函数都使用了reserve来预留空间。<br> 同时还需要有 <strong>运算符重载+=</strong> 来实现尾插，用重载的运算符执行这样的操作才是最爽的。</p> 
<pre><code class="prism language-cpp">string<span class="token operator">&amp;</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">push_back</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token operator">&amp;</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其实不用再实现一遍了，直接复用就行。<br> 可以简单看一下使用的效果：</p> 
<pre><code class="prism language-cpp">string <span class="token function">str</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'T'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s <span class="token operator">=</span> <span class="token string">"hhhhhh"</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

str <span class="token operator">+=</span> ch<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

str <span class="token operator">+=</span> s<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/28/e6/FaA3R8GF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_360"></a><mark>字符或字符串的插入和删除</mark></h3> 
<p>这里的逻辑稍微有些复杂，而且还有几个比较容易掉的坑。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 字符的插入</span>
<span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">insert</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">&gt;=</span> _capacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 注意这里为什么要+1，size_t是无符号整型，没有负值</span>
	<span class="token comment">//当有符号和无符号比较时，统一会被转成无符号</span>
	size_t end <span class="token operator">=</span> _size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 字符串的插入</span>
<span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">insert</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">+</span> len <span class="token operator">&gt;</span> _capacity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_size <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 注意这里为什么要+len，size_t是无符号整型，没有负值</span>
	<span class="token comment">//当有符号和无符号比较时，统一会被转成无符号</span>
	size_t end <span class="token operator">=</span> _size <span class="token operator">+</span> len<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;</span> pos <span class="token operator">+</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end <span class="token operator">-</span> len<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">,</span> str<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_size <span class="token operator">+=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 字符串的删除</span>
<span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">erase</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 当pos+len过大，超过_size，则取到末尾</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&gt;=</span> _size <span class="token operator">-</span> pos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
		_size <span class="token operator">=</span> pos<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">,</span> _str <span class="token operator">+</span> pos <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_size <span class="token operator">-=</span> len<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用案例：</p> 
<pre><code class="prism language-cpp">string <span class="token function">str</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token char">'T'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s <span class="token operator">=</span> <span class="token string">"hhhhhh"</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

str<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

str<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

str<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/d1/hT2fS0la_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="find_433"></a><mark>find查找</mark></h3> 
<p>查找C语言查找字符串的库也有提供，可以直接使用。</p> 
<pre><code class="prism language-cpp">size_t string<span class="token double-colon punctuation">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">,</span> size_t pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> pos<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span>
			<span class="token keyword">return</span> i<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> npos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

size_t string<span class="token double-colon punctuation">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> sub<span class="token punctuation">,</span> size_t pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> ptr <span class="token operator">-</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用案例：</p> 
<pre><code class="prism language-cpp">string <span class="token function">str</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'w'</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">"wor"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/83/61/6VeLfSp1_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>缺省参数在函数声明那里。</p> 
</blockquote> 
<h3><a id="_461"></a><mark>比大小运算符重载</mark></h3> 
<p>C语言中，有一个按能按字典序将字符串比大小的函数——<code>strcmp</code>。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> str<span class="token punctuation">.</span>_str<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> str<span class="token punctuation">.</span>_str<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&gt;</span> str <span class="token operator">||</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">==</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&gt;=</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&gt;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">bool</span> string<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">==</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>只需要实现前两个，后面的复用就行。</p> 
<h3><a id="_490"></a><mark>获取子串</mark></h3> 
<p>使用substr可以获取所需对象字串。</p> 
<pre><code class="prism language-cpp">string string<span class="token double-colon punctuation">::</span><span class="token function">substr</span><span class="token punctuation">(</span>size_t pos<span class="token punctuation">,</span> size_t len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">+</span> len <span class="token operator">&gt;=</span> _size<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		string <span class="token function">sub</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> sub<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		string sub<span class="token punctuation">;</span>
		sub<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			sub <span class="token operator">+=</span> _str<span class="token punctuation">[</span>pos <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sub<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="clear_509"></a><mark>清除clear</mark></h3> 
<p>可以将对象内容都删除，但_capacity保持不变。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> string<span class="token double-colon punctuation">::</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
	_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_518"></a><mark>流插入和流提取</mark></h3> 
<p>这两个函数之前在Date类部分实现的时候，定义为了Date类的友元。但是，流插入和流提取其实可以不定义为string类的友元。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 流插入</span>
std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		os <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 流提取</span>
std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	str<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> ch <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token char">' '</span> <span class="token operator">&amp;&amp;</span> ch <span class="token operator">!=</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		str <span class="token operator">+=</span> ch<span class="token punctuation">;</span>
		ch <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>string对象读取的截断是<strong>空格</strong>和<strong>换行</strong>，但是<code>cin</code>对象默认是读不到这两个字符的，这就需要使用另一种读取方式：<code>cin.get()</code>。<br> 使用案例：</p> 
<pre><code class="prism language-cpp">string str<span class="token punctuation">;</span>
cin <span class="token operator">&gt;&gt;</span> str<span class="token punctuation">;</span>
cout <span class="token operator">&lt;&lt;</span> str <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/15/OXBotaGZ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="npos_549"></a><mark>常量成员npos</mark></h3> 
<p>常量成员的定义需要实现在类的外部，像这样：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">const</span> size_t string<span class="token double-colon punctuation">::</span>npos <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p>当<strong>常量的内容是整型</strong>（浮点型和字符类型等都不行）时，也可以作为缺省参数进行定义。</p> 
<h2><a id="_555"></a>结语</h2> 
<p>本篇博客主要介绍了string类常用接口的实现，包括默认成员函数，迭代器，字符和字符串的插入删除等等内容。<br> 后续博主还会继续分享与STL相关的内容，感谢大家的支持。♥</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1f2ee6c9605a2e8d6b5aede5d89641c6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【机器学习聚类算法实战-4】机器学习聚类算法之k-均值聚类、分层聚类算法、凝聚聚类和谱聚类实例分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba2cb0678b4479baa72369ce93c62e8a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何使用 GPT 4o API 实现视觉、文本、图像等功能？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>