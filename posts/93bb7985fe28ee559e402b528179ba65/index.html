<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Quart 框架——来源于Flask的强大且灵活的异步Web框架】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/93bb7985fe28ee559e402b528179ba65/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Quart 框架——来源于Flask的强大且灵活的异步Web框架】">
  <meta property="og:description" content="目录 前言一、Quart简介1-1、简介1-2、与flask的区别 二、快速开始2-1、安装2-2、基本用法 三、核心功能3-1、异步路由3-2、WebSockets 支持3-3、中间件3-4、蓝图 (Blueprints) 四、部署4-1、使用uvicorn部署4-2、使用hypercorn部署 五、案例分析总结 前言 Quart 是一个基于 Python 的异步 Web 框架，灵感来自 Flask。它结合了 Flask 的易用性和成熟度，并添加了对 Python 异步特性的支持。 一、Quart简介 1-1、简介 Quart 是一个基于 Python 的异步 Web 框架，灵感来自 Flask。它结合了 Flask 的易用性和成熟度，并添加了对 Python 异步特性的支持。使用Quart你可以：
渲染和提供HTML模板构建Json API服务WebScoket流式请求、响应。 Quart 旨在提供一个类似于 Flask 的简单且灵活的 Web 框架，同时支持 Python 的异步功能（async 和 await）。这使得 Quart 能够处理高并发和异步 I/O 操作，适用于需要处理大量并发连接的应用程序，如实时 Web 应用和微服务。
1-2、与flask的区别 异步支持：Quart 的最大特点是对异步操作的支持，而 Flask 主要是同步的。WebSockets：Quart 内置对 WebSockets 的支持，而 Flask 需要使用 Flask-SocketIO 扩展。路由定义：Quart 的路由定义和 Flask 基本一致，但 Quart 的路由处理函数可以是异步的。 二、快速开始 2-1、安装 安装： python的版本必须大于3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-12T16:52:12+08:00">
    <meta property="article:modified_time" content="2024-07-12T16:52:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Quart 框架——来源于Flask的强大且灵活的异步Web框架】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">前言</a></li><li><a href="#Quart_12" rel="nofollow">一、Quart简介</a></li><li><ul><li><a href="#11_14" rel="nofollow">1-1、简介</a></li><li><a href="#12flask_27" rel="nofollow">1-2、与flask的区别</a></li></ul> 
  </li><li><a href="#_33" rel="nofollow">二、快速开始</a></li><li><ul><li><a href="#21_35" rel="nofollow">2-1、安装</a></li><li><a href="#22_42" rel="nofollow">2-2、基本用法</a></li></ul> 
  </li><li><a href="#_65" rel="nofollow">三、核心功能</a></li><li><ul><li><a href="#31_67" rel="nofollow">3-1、异步路由</a></li><li><a href="#32WebSockets__78" rel="nofollow">3-2、WebSockets 支持</a></li><li><a href="#33_91" rel="nofollow">3-3、中间件</a></li><li><a href="#34_Blueprints_105" rel="nofollow">3-4、蓝图 (Blueprints)</a></li></ul> 
  </li><li><a href="#_119" rel="nofollow">四、部署</a></li><li><ul><li><a href="#41uvicorn_120" rel="nofollow">4-1、使用uvicorn部署</a></li><li><a href="#42hypercorn_130" rel="nofollow">4-2、使用hypercorn部署</a></li></ul> 
  </li><li><a href="#_142" rel="nofollow">五、案例分析</a></li><li><a href="#_196" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_4"></a>前言</h2> 
<font color="#999AAA"> Quart 是一个基于 Python 的异步 Web 框架，灵感来自 Flask。它结合了 Flask 的易用性和成熟度，并添加了对 Python 异步特性的支持。</font> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="5RtF5kW7-1720771796211" frameborder="0" src="https://live.csdn.net/v/embed/281658" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p></p> 
</div> 
<p></p> 
<h2><a id="Quart_12"></a>一、Quart简介</h2> 
<h3><a id="11_14"></a>1-1、简介</h3> 
<p><strong>Quart 是一个基于 Python 的异步 Web 框架，灵感来自 Flask。它结合了 Flask 的易用性和成熟度，并添加了对 Python 异步特性的支持。使用Quart你可以</strong>：</p> 
<ul><li>渲染和提供HTML模板</li><li>构建Json API</li><li>服务WebScoket</li><li>流式请求、响应。</li></ul> 
<p><img src="https://images2.imgbox.com/28/4e/aMeISyJ7_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>Quart 旨在提供一个类似于 Flask 的简单且灵活的 Web 框架，同时支持 Python 的异步功能（async 和 await）。这使得 Quart 能够处理高并发和异步 I/O 操作，适用于需要处理大量并发连接的应用程序，如实时 Web 应用和微服务。</p> 
</blockquote> 
<h3><a id="12flask_27"></a>1-2、与flask的区别</h3> 
<ul><li>异步支持：Quart 的最大特点是对异步操作的支持，而 Flask 主要是同步的。</li><li>WebSockets：Quart 内置对 WebSockets 的支持，而 Flask 需要使用 Flask-SocketIO 扩展。</li><li>路由定义：Quart 的路由定义和 Flask 基本一致，但 Quart 的路由处理函数可以是异步的。</li></ul> 
<h2><a id="_33"></a>二、快速开始</h2> 
<h3><a id="21_35"></a>2-1、安装</h3> 
<p><strong>安装：</strong> python的版本必须大于3.8。</p> 
<pre><code class="prism language-c">pip install quart
pip install python
</code></pre> 
<h3><a id="22_42"></a>2-2、基本用法</h3> 
<pre><code class="prism language-c">from quart import Quart<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> websocket

app <span class="token operator">=</span> <span class="token function">Quart</span><span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
async def <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> await <span class="token function">render_template</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span>
async def <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token operator">:</span> <span class="token string">"world"</span><span class="token punctuation">}</span>

@app<span class="token punctuation">.</span><span class="token function">websocket</span><span class="token punctuation">(</span><span class="token string">"/ws"</span><span class="token punctuation">)</span>
async def <span class="token function">ws</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">while</span> True<span class="token operator">:</span>
        await websocket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>
        await websocket<span class="token punctuation">.</span><span class="token function">send_json</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"hello"</span><span class="token operator">:</span> <span class="token string">"world"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token operator">:</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_65"></a>三、核心功能</h2> 
<h3><a id="31_67"></a>3-1、异步路由</h3> 
<p><strong>Quart 允许你定义异步路由处理函数，使得处理异步 I/O 操作更加高效。</strong></p> 
<pre><code class="prism language-c">@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token char">'/async'</span><span class="token punctuation">)</span>
async def <span class="token function">async_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    # 异步操作
    await asyncio<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token char">'This is an async route'</span>
</code></pre> 
<h3><a id="32WebSockets__78"></a>3-2、WebSockets 支持</h3> 
<p><strong>Quart 内置对 WebSockets 的支持，可以轻松处理实时通信。</strong></p> 
<pre><code class="prism language-c">from quart import websocket

@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token char">'/ws'</span><span class="token punctuation">)</span>
async def <span class="token function">ws</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">while</span> True<span class="token operator">:</span>
        message <span class="token operator">=</span> await websocket<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        await websocket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>f<span class="token char">'You said: {message}'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="33_91"></a>3-3、中间件</h3> 
<p><strong>Quart 支持中间件，可以在请求处理之前或之后执行一些操作。</strong></p> 
<pre><code class="prism language-c">@app<span class="token punctuation">.</span>before_request
async def <span class="token function">before_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"This runs before each request"</span><span class="token punctuation">)</span>

@app<span class="token punctuation">.</span>after_request
async def <span class="token function">after_request</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"This runs after each request"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response
</code></pre> 
<h3><a id="34_Blueprints_105"></a>3-4、蓝图 (Blueprints)</h3> 
<p><strong>Quart 支持蓝图，用于模块化应用程序的路由和视图。</strong></p> 
<pre><code class="prism language-c">from quart import Blueprint

bp <span class="token operator">=</span> <span class="token function">Blueprint</span><span class="token punctuation">(</span><span class="token char">'example'</span><span class="token punctuation">,</span> __name__<span class="token punctuation">)</span>

@bp<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token char">'/example'</span><span class="token punctuation">)</span>
async def <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token char">'This is an example route'</span>

app<span class="token punctuation">.</span><span class="token function">register_blueprint</span><span class="token punctuation">(</span>bp<span class="token punctuation">,</span> url_prefix<span class="token operator">=</span><span class="token char">'/bp'</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_119"></a>四、部署</h2> 
<h3><a id="41uvicorn_120"></a>4-1、使用uvicorn部署</h3> 
<p><strong>安装：</strong></p> 
<pre><code class="prism language-c">pip install uvicorn
</code></pre> 
<p><strong>运行：</strong> 在项目根目录下运行以下命令，这里 app:app 表示在 app.py 文件中有一个名为 app 的 Quart 应用实例。</p> 
<pre><code class="prism language-c">uvicorn app<span class="token operator">:</span>app
</code></pre> 
<h3><a id="42hypercorn_130"></a>4-2、使用hypercorn部署</h3> 
<p><strong>安装：</strong></p> 
<pre><code class="prism language-c">pip install hypercorn
</code></pre> 
<p><strong>部署：</strong> 指定端口和启用自动重载</p> 
<pre><code class="prism language-c">hypercorn app<span class="token operator">:</span>app <span class="token operator">--</span>bind <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">8000</span> <span class="token operator">--</span>reload
</code></pre> 
<h2><a id="_142"></a>五、案例分析</h2> 
<blockquote> 
 <p><strong>概述</strong>：这段代码创建了一个基于 Quart 框架的异步 Web 应用程序，暴露了一个 POST 接口 /aiops。该接口接收 JSON 请求，提取其中的 prompt 字段，并调用 run_query 函数处理这个 prompt。主要功能如下：</p> 
</blockquote> 
<ul><li>logger.add(‘app.log’) 记录日志到app.log</li><li>禁用 Quart 和 werkzeug 的默认日志，以避免日志冗余。</li><li>定义名为aiops的post路由并且构建异步处理函数</li><li>异步获取请求中的json数据</li></ul> 
<pre><code class="prism language-c">from quart import Quart<span class="token punctuation">,</span> request<span class="token punctuation">,</span> jsonify
from querySLSLog import run_query
from loguru import logger
import logging
from querySLSLog import run_query

app <span class="token operator">=</span> <span class="token function">Quart</span><span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

logger<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">'app.log'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>disabled <span class="token operator">=</span> True
werkzeug_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token char">'werkzeug'</span><span class="token punctuation">)</span>
werkzeug_logger<span class="token punctuation">.</span>disabled <span class="token operator">=</span> True


@app<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token char">'/aiops'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token char">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
async def <span class="token function">run_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>

    data <span class="token operator">=</span> await request<span class="token punctuation">.</span>json
    prompt <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token char">'prompt'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> not prompt<span class="token operator">:</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>f<span class="token string">"提取prompt失败: {request.data.decode('utf-8')}"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">jsonify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token char">'error'</span><span class="token operator">:</span> <span class="token char">'No prompt provided'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span>
    
    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>f<span class="token string">"prompt: {prompt}"</span><span class="token punctuation">)</span>

    try<span class="token operator">:</span>
        result <span class="token operator">=</span> await <span class="token function">run_query</span><span class="token punctuation">(</span>prompt<span class="token punctuation">)</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>f<span class="token string">"result: {result}"</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> result<span class="token punctuation">.</span>content
        <span class="token keyword">return</span> <span class="token function">jsonify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    except Exception as e<span class="token operator">:</span>
        error <span class="token operator">=</span> f<span class="token string">"调用run_query方法失败: {e}"</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">jsonify</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token char">'__main__'</span><span class="token operator">:</span>
    app<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token char">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6789</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>参考文章：</strong></p> 
<p><a href="https://pypi.org/project/Quart/" rel="nofollow">Quart</a></p> 
<h2><a id="_196"></a>总结</h2> 
<p><font color="#999AAA"> Quart 是一个强大且灵活的异步 Web 框架，适用于需要高并发和异步 I/O 操作的应用程序。它结合了 Flask 的简单性和 Python 异步特性的优势，是开发现代 Web 应用和微服务的一个有力工具。</font></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a1071f8c730b2d606e64cc41eef6bb4d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA 中的调试方式(以 java 为例)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95a4a0e3cfc46d363419fcce98451fd5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;航海王：追寻罗杰的编程之路】一篇文章带你认识哈希</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>