<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Datawhale AI 夏令营 市场博弈和价格预测 EDA 探索性数据分析 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/993a62f91b2e2e3d0e5b1b96dbd1e5ca/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Datawhale AI 夏令营 市场博弈和价格预测 EDA 探索性数据分析">
  <meta property="og:description" content="前言 基于挑战赛“市场博弈和价格预测”
使用探索性数据分析（EDA）深入理解赛题。
对数据做尽可能多的探索，
了解数据所在的领域先验知识，数据本身的特性等，
（发现数据的结构、异常值、模式、趋势、关系以及变量之间的相互作用）
并总结为一系列有用的信息
0 编程准备 !pip install numpy pandas seaborn matplotlib statsmodels import pandas as pd import seaborn as sns import matplotlib.pylab as plt from pathlib import Path import warnings warnings.filterwarnings(&#39;ignore&#39;) plt.style.use(&#39;ggplot&#39;) plt.rcParams[&#39;font.sans-serif&#39;] = [&#39;WenQuanYi Micro Hei&#39;,&#34;SimHei&#34;] plt.rcParams[&#39;axes.unicode_minus&#39;] = False base_path=Path(&#34;data&#34;) 请将数据文件electricity_price_parsed放在代码文件同级的data文件夹路径
下载链接：https://linklearner.com/activity/12/2/2 =&gt; 左上角打开面板 =&gt; 选择“Tsak 2”
1 数据基本信息 读取数据，并按照 NAN 划分训练集&amp;测试集 代码
electricity_price = pd.read_csv(base_path/&#34;electricity_price_parsed.csv&#34;, parse_dates=[&#34;timestamp&#34;], index_col=0) electricity_price.columns = [&#34;demand&#34;, &#34;price&#34;] electricity_price.head() # 创建测试集掩码，标记出所有价格为 NaN 的数据行 test_mask = electricity_price[&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-02T17:41:41+08:00">
    <meta property="article:modified_time" content="2024-08-02T17:41:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Datawhale AI 夏令营 市场博弈和价格预测 EDA 探索性数据分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>基于挑战赛<a href="http://competition.sais.com.cn/competitionDetail/532232/format" rel="nofollow">“市场博弈和价格预测”</a><br> 使用探索性数据分析（EDA）深入理解赛题。</p> 
<blockquote> 
 <p>对数据做尽可能多的探索，<br> 了解数据所在的领域先验知识，数据本身的特性等，<br> （发现数据的结构、异常值、模式、趋势、关系以及变量之间的相互作用）<br> 并总结为一系列有用的信息</p> 
</blockquote> 
<h2><a id="0__10"></a>0 编程准备</h2> 
<pre><code class="prism language-python">!pip install numpy pandas seaborn matplotlib statsmodels

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pylab <span class="token keyword">as</span> plt
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'ggplot'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'WenQuanYi Micro Hei'</span><span class="token punctuation">,</span><span class="token string">"SimHei"</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>

base_path<span class="token operator">=</span>Path<span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">)</span>

</code></pre> 
<blockquote> 
 <p>请将<strong>数据文件electricity_price_parsed</strong>放在<strong>代码文件</strong>同级的data文件夹路径<br> 下载链接：<a href="https://linklearner.com/activity/12/2/2" rel="nofollow">https://linklearner.com/activity/12/2/2</a> =&gt; 左上角打开面板 =&gt; 选择“Tsak 2”</p> 
</blockquote> 
<h2><a id="1__33"></a>1 数据基本信息</h2> 
<p><img src="https://images2.imgbox.com/28/3e/xeOJFKUF_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">读取数据，并按照 NAN 划分训练集&amp;测试集</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">electricity_price <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>base_path<span class="token operator">/</span><span class="token string">"electricity_price_parsed.csv"</span><span class="token punctuation">,</span> parse_dates<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"timestamp"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
electricity_price<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">,</span> <span class="token string">"price"</span><span class="token punctuation">]</span>
electricity_price<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建测试集掩码，标记出所有价格为 NaN 的数据行</span>
test_mask <span class="token operator">=</span> electricity_price<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isna<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建训练集掩码，标记出所有价格不为 NaN 的数据行,其中~代表布尔取反，即True和False互换。 `[True,False]`和 `~[False,True]`一致</span>
train_mask <span class="token operator">=</span> <span class="token operator">~</span>test_mask

<span class="token comment"># 打印训练集的范围和总长度</span>
<span class="token comment"># 训练集范围从训练集中最早的日期到最新的日期</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"训练集范围：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> --&gt; </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\t总长度</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 打印测试集的范围和总长度</span>
<span class="token comment"># 测试集范围从测试集中最早的日期到最新的日期</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"测试集范围：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>electricity_price<span class="token punctuation">[</span>test_mask<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> --&gt; </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>electricity_price<span class="token punctuation">[</span>test_mask<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">\t总长度</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>test_mask<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

electricity_price<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span> 

electricity_price<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong><br> <img src="https://images2.imgbox.com/f6/c6/KnB7oXQz_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">自定义函数 确认</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">check_repeated</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> repeat_count<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    
    <span class="token triple-quoted-string string">"""
    检查给定数据序列中是否存在元素不断重复的情况。

    参数:
    data (list): 要检查的序列数据。
    repeat_count (int): 每个元素应重复的次数。默认值为4。

    返回:
    None
    """</span>
    <span class="token comment"># 以步长 repeat_count 遍历 data 的索引</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> repeat_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 从索引 i 开始，取长度为 repeat_count 的子序列</span>
        subsequence <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> repeat_count<span class="token punctuation">]</span>
        
        <span class="token comment"># 如果子序列的独特元素数量不等于 1，则表示不是同一元素重复</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>subsequence<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"序列数据不是元素不断重复 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>repeat_count<span class="token punctuation">}</span></span><span class="token string"> 次"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>  <span class="token comment"># 发现不满足条件的情况后，直接返回</span>
        
    <span class="token comment"># 如果遍历完所有子序列，未发现不满足条件的情况，则输出满足条件的信息</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"序列数据是元素不断重复 </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>repeat_count<span class="token punctuation">}</span></span><span class="token string"> 次"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 调用函数并传入特定的电价数据</span>
check_repeated<span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<pre><code class="prism language-python">序列数据是元素不断重复 <span class="token number">4</span> 次
</code></pre> 
<center> 
 <font face="黑体" color="orange" size="5">使用 matplotlib.pylab 库画图确认</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 使用loc方法选择指定日期的数据，绘制价格图表</span>
electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2023-01-03"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token string">"price"</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置图表的标题</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"2023年1月3日出清价格走势"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p>Text(0.5, 1.0, ‘2023年1月3日出清价格走势’)<br> <img src="https://images2.imgbox.com/7f/cf/p0BNtb9X_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="2__122"></a>2 统计指标分析</h2> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/6d/2a/k3DFCyBJ_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">最基本的单变量数值关系</font> 
</center> 
<p><em>可以使用<code>electricity_price.describe()</code>快速生成描述性统计信息</em></p> 
<p><strong>中心趋势</strong></p> 
<ul><li>均值：<code>df[feature].mean()</code></li><li>中位数 <code>df[feature].median()</code></li><li>最大值 <code>df[feature].max()</code></li><li>最小值 <code>df[feature].min()</code></li><li>众数 <code>df[feature].mode()</code></li></ul> 
<p><strong>变异程度</strong></p> 
<ul><li>标准差 <code>df[feature].std()</code></li><li>极差 <code>df[feature].apply(lambda x: x.max() - x.min())</code></li><li>四分位数 <code>df[feature].quantile([0.25, 0.5, 0.75])</code></li><li>变异系数 <code>df[feature].std()/df[feature].mean()</code></li><li>偏度和峰度 <code>df[feature].skew()</code>, <code>df[feature].kurtosis()</code></li></ul> 
<p><strong>变化率</strong>：<code>df[feature].pct_change()</code></p> 
<ul><li>计算公式为<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
           
            
            
              x 
             
            
              2 
             
            
           
             − 
            
            
            
              x 
             
            
              1 
             
            
           
           
           
             x 
            
           
             1 
            
           
          
         
        
          \frac{x_2 - x_1}{x_1} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.0963em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></li></ul> 
<center> 
 <font face="黑体" color="orange" size="5">总负荷的 数值分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 使用 Seaborn 库绘制总负荷数值的分布图</span>
<span class="token comment"># sns.displot(...) 函数用于绘制数据的分布图</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>displot<span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">,</span>  <span class="token comment"># 输入数据，包含绘制所需的列</span>
    x<span class="token operator">=</span><span class="token string">"demand"</span><span class="token punctuation">,</span>         <span class="token comment"># 指定绘图的列，这里是 "demand" 列</span>
    aspect<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span>         <span class="token comment"># 图形的宽高比，1.5 表示宽度是高度的 1.5 倍</span>
    height<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>           <span class="token comment"># 图形的高度设置为 5 英寸</span>
    kde<span class="token operator">=</span><span class="token boolean">True</span>            <span class="token comment"># 启用核密度估计（KDE），用于绘制数据的平滑概率密度曲线</span>
<span class="token punctuation">)</span>

<span class="token comment"># 设置图形的标题</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"总负荷数值分布"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/36/0d/t0ZHQORi_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">出清价格 数值分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">ax<span class="token operator">=</span>sns<span class="token punctuation">.</span>displot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token string">"price"</span><span class="token punctuation">,</span>aspect<span class="token operator">=</span><span class="token number">1.5</span><span class="token punctuation">,</span>height<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>kde<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"出清价格数值分布"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/8d/e1/X4SXjdb0_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="3__185"></a>3 分时统计指标分析</h2> 
<h3><a id="_188"></a>线图</h3> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/8b/3d/n0FKFXtv_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">不同年份的分时 电价 线图</font> 
</center> 
<center> 
 <font face="黑体" color="orange" size="5">不同年份的分时 总负荷 线图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 从 DataFrame 的索引中提取时间信息，并添加为新的列</span>
<span class="token comment"># 假设索引为 DatetimeIndex 类型</span>

<span class="token comment"># 提取小时信息，并创建一个新列 "hour"</span>
electricity_price<span class="token punctuation">[</span><span class="token string">"hour"</span><span class="token punctuation">]</span> <span class="token operator">=</span> electricity_price<span class="token punctuation">.</span>index<span class="token punctuation">.</span>hour
<span class="token comment"># 提取月份信息，并创建一个新列 "month"</span>
electricity_price<span class="token punctuation">[</span><span class="token string">"month"</span><span class="token punctuation">]</span> <span class="token operator">=</span> electricity_price<span class="token punctuation">.</span>index<span class="token punctuation">.</span>month
<span class="token comment"># 提取日期信息，并创建一个新列 "day"</span>
electricity_price<span class="token punctuation">[</span><span class="token string">"day"</span><span class="token punctuation">]</span> <span class="token operator">=</span> electricity_price<span class="token punctuation">.</span>index<span class="token punctuation">.</span>day
<span class="token comment"># 提取星期几的信息（0 = 周一, 6 = 周日），并创建一个新列 "weekday"</span>
electricity_price<span class="token punctuation">[</span><span class="token string">"weekday"</span><span class="token punctuation">]</span> <span class="token operator">=</span> electricity_price<span class="token punctuation">.</span>index<span class="token punctuation">.</span>weekday
<span class="token comment"># 提取年份信息，并创建一个新列 "year"</span>
electricity_price<span class="token punctuation">[</span><span class="token string">"year"</span><span class="token punctuation">]</span> <span class="token operator">=</span> electricity_price<span class="token punctuation">.</span>index<span class="token punctuation">.</span>year


<span class="token comment"># 创建一个包含两个子图的绘图区域，图形大小为 20x9 英寸，并启用约束布局</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>
    <span class="token number">1</span><span class="token punctuation">,</span>                       <span class="token comment"># 子图的行数为 1</span>
    <span class="token number">2</span><span class="token punctuation">,</span>                       <span class="token comment"># 子图的列数为 2</span>
    figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment"># 设置整个图形的大小为 20x9 英寸</span>
    constrained_layout<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token comment"># 启用约束布局以自动调整子图位置和大小</span>
<span class="token punctuation">)</span>

<span class="token comment"># 绘制不同年份的分时电价线图</span>
sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"hour"</span><span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 按小时和年份分组，计算每组的平均电价，并重置索引</span>
    x<span class="token operator">=</span><span class="token string">"hour"</span><span class="token punctuation">,</span>                  <span class="token comment"># x 轴数据为小时</span>
    y<span class="token operator">=</span><span class="token string">"price"</span><span class="token punctuation">,</span>                 <span class="token comment"># y 轴数据为平均电价</span>
    ax<span class="token operator">=</span>ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment"># 将图绘制到第一个子图 (ax[0])</span>
    marker<span class="token operator">=</span><span class="token string">"o"</span><span class="token punctuation">,</span>                <span class="token comment"># 数据点标记为圆圈</span>
    hue<span class="token operator">=</span><span class="token string">"year"</span><span class="token punctuation">,</span>                <span class="token comment"># 根据年份不同设置不同的颜色</span>
    palette<span class="token operator">=</span><span class="token string">"Set1"</span>             <span class="token comment"># 使用 "Set1" 调色板</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"不同年份的分时电价"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置第一个子图的标题</span>
ax<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment"># 设置 x 轴刻度为 0 到 23（小时范围）</span>

<span class="token comment"># 绘制不同年份的分时总负荷线图</span>
sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"hour"</span><span class="token punctuation">,</span> <span class="token string">"year"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 按小时和年份分组，计算每组的平均总负荷，并重置索引</span>
    x<span class="token operator">=</span><span class="token string">"hour"</span><span class="token punctuation">,</span>                  <span class="token comment"># x 轴数据为小时</span>
    y<span class="token operator">=</span><span class="token string">"demand"</span><span class="token punctuation">,</span>                <span class="token comment"># y 轴数据为平均总负荷</span>
    ax<span class="token operator">=</span>ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment"># 将图绘制到第二个子图 (ax[1])</span>
    marker<span class="token operator">=</span><span class="token string">"o"</span><span class="token punctuation">,</span>                <span class="token comment"># 数据点标记为圆圈</span>
    hue<span class="token operator">=</span><span class="token string">"year"</span><span class="token punctuation">,</span>                <span class="token comment"># 根据年份不同设置不同的颜色</span>
    palette<span class="token operator">=</span><span class="token string">"Set1"</span>             <span class="token comment"># 使用 "Set1" 调色板</span>
<span class="token punctuation">)</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"不同年份的分时总负荷"</span><span class="token punctuation">)</span>  <span class="token comment"># 设置第二个子图的标题</span>
ax<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>set_xticks<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment"># 设置 x 轴刻度为 0 到 23（小时范围）</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/7c/b7/WnyLdPzX_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h3><a id="_257"></a>透视表&amp;热力图</h3> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/0a/e0/qGggYE2x_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">不同月份的分时 电价 透视表</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 创建一个透视表，计算不同月份和时间下的电价</span>
pivot <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">,</span>          <span class="token comment"># 输入的 DataFrame</span>
    values<span class="token operator">=</span><span class="token string">"price"</span><span class="token punctuation">,</span>             <span class="token comment"># 透视表中要填充的值，这里是 "price"</span>
    index<span class="token operator">=</span><span class="token string">"month"</span><span class="token punctuation">,</span>              <span class="token comment"># 设置行索引为月份</span>
    columns<span class="token operator">=</span><span class="token string">"hour"</span>              <span class="token comment"># 设置列索引为小时</span>
<span class="token punctuation">)</span>

<span class="token comment"># 将透视表中的数据类型转换为整数</span>
pivot <span class="token operator">=</span> pivot<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>
pivot
</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/b1/37/flPI6Zft_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">不同月份的分时 电价 热力图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 创建一个图形，大小为 17x10 英寸</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制热图，显示不同月份和时间下的电价</span>
sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>
    pivot<span class="token punctuation">,</span>                      <span class="token comment"># 透视表数据</span>
    cmap<span class="token operator">=</span><span class="token string">"coolwarm"</span><span class="token punctuation">,</span>            <span class="token comment"># 使用 "coolwarm" 调色板，显示热图的颜色</span>
    linewidths<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span>             <span class="token comment"># 设置单元格之间的分隔线宽度为 0.5</span>
    annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>                 <span class="token comment"># 启用单元格值的注释</span>
    fmt<span class="token operator">=</span><span class="token string">".0f"</span><span class="token punctuation">,</span>                  <span class="token comment"># 注释的格式为整数</span>
    annot_kws<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"size"</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span>      <span class="token comment"># 注释文本的大小设置为 12</span>
               <span class="token string">"weight"</span><span class="token punctuation">:</span> <span class="token string">"bold"</span><span class="token punctuation">,</span>  <span class="token comment"># 注释文本的字体加粗</span>
               <span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"black"</span><span class="token punctuation">}</span>  <span class="token comment"># 注释文本的颜色为黑色</span>
<span class="token punctuation">)</span>

<span class="token comment"># 设置图形的标题</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"不同月份和时间下的电价"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/47/8b/Wb1NzkbD_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="4__312"></a>4 负电价形成原因分析</h2> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/c3/ac/66FFUZ2F_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">负电价频数 出现的小时分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">minus_mask <span class="token operator">=</span> electricity_price<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span>
</code></pre> 
<pre><code class="prism language-python">
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>minus_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">"hour"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"负电量频数出现的小时分布"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/e6/d6/c7aIgWhZ_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">负电价频数 出现的月分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>minus_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">"month"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"负电量频数出现的月分布"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/97/a3/Yl3f5dUX_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">负电价频数 出现的日期排序数表</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token punctuation">(</span>
    <span class="token comment"># 选择不满足 minus_mask 条件的数据</span>
    electricity_price<span class="token punctuation">[</span>minus_mask<span class="token punctuation">]</span>
    <span class="token comment"># 按月份和日期分组，计算每个组合的记录数量</span>
    <span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"month"</span><span class="token punctuation">,</span> <span class="token string">"day"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment"># 计算每个分组的大小（即每个分组的记录数）</span>
    <span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'count'</span><span class="token punctuation">)</span>              <span class="token comment"># 重置索引，使 groupby 结果成为 DataFrame，并保留分组字段为列</span>
    <span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">,</span>       <span class="token comment"># 按 "count" 列排序</span>
                 ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token comment"># 降序排序</span>
    <span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>                   <span class="token comment"># 选择排序后的前 15 行</span>
<span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/cc/e3/T0lKws68_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">2022年5月1日 - 2022年5月9日 电价 线图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 创建一个图形，大小为 20x8 英寸</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制从 2022年5月1日到2022年5月9日的电价数据的折线图</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2022-05-01"</span><span class="token punctuation">:</span><span class="token string">"2022-05-09"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 从 DataFrame 中选择时间范围内的电价数据</span>
    color<span class="token operator">=</span><span class="token string">"black"</span>  <span class="token comment"># 设置折线的颜色为黑色</span>
<span class="token punctuation">)</span>

<span class="token comment"># 在每一天的 10:00 到 15:00 之间添加黄色半透明的高亮区域</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ax<span class="token punctuation">.</span>axvspan<span class="token punctuation">(</span>
        <span class="token string-interpolation"><span class="token string">f"2022-05-0</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string"> 10:00:00"</span></span><span class="token punctuation">,</span>  <span class="token comment"># 高亮区域的开始时间</span>
        <span class="token string-interpolation"><span class="token string">f"2022-05-0</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span></span><span class="token string"> 15:00:00"</span></span><span class="token punctuation">,</span>  <span class="token comment"># 高亮区域的结束时间</span>
        color<span class="token operator">=</span><span class="token string">'yellow'</span><span class="token punctuation">,</span>            <span class="token comment"># 高亮区域的颜色为黄色</span>
        alpha<span class="token operator">=</span><span class="token number">0.2</span>                  <span class="token comment"># 高亮区域的透明度设置为 0.2（0 完全透明，1 完全不透明）</span>
    <span class="token punctuation">)</span>

<span class="token comment"># 添加一条红色的虚线，y 值为 0，用于显示负电价的参考线</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>
    y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>                      <span class="token comment"># y 轴的值为 0</span>
    color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span>              <span class="token comment"># 虚线的颜色为红色</span>
    linestyle<span class="token operator">=</span><span class="token string">"--"</span>           <span class="token comment"># 虚线的线型为虚线</span>
<span class="token punctuation">)</span>

<span class="token comment"># 设置 x 轴刻度标签的旋转角度为 45 度，并且水平对齐方式为右对齐</span>
plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>
    ax<span class="token punctuation">.</span>get_xticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment"># 获取 x 轴刻度标签</span>
    rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span>              <span class="token comment"># 设置标签的旋转角度为 45 度</span>
    ha<span class="token operator">=</span><span class="token string">'right'</span>                <span class="token comment"># 设置标签的水平对齐方式为右对齐</span>
<span class="token punctuation">)</span>

<span class="token comment"># 设置图形的标题</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"一段比较典型的负电价趋势：2022年5月1日 - 2022年5月9日"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/0f/e3/QYkpR7BT_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">2022年1月28日 - 2022年2月6日 电价 线图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2023-01-21"</span><span class="token punctuation">:</span><span class="token string">"2023-02-02"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"--"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>ax<span class="token punctuation">.</span>get_xticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"假期对负电价的影响 2022年1月28日 - 2022年2月6日"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/22/bb/Q9OmcpDv_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="5__436"></a>5 高电价形成原因分析</h2> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/58/0a/j5B6cXK6_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">高电价频数 出现的小时分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 计算电价的上限阈值，使用 3 标准差原则来检测异常值</span>
upper_threshold <span class="token operator">=</span> <span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>      <span class="token comment"># 电价的均值</span>
    <span class="token number">3</span> <span class="token operator">*</span> electricity_price<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 加上 3 倍的电价标准差</span>
<span class="token punctuation">)</span>

<span class="token comment"># 创建一个布尔型掩码，用于标识电价高于上限阈值的异常值</span>
high_abnormal_mask <span class="token operator">=</span> <span class="token punctuation">(</span>
    electricity_price<span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> upper_threshold  <span class="token comment"># 判断电价是否大于计算得到的上限阈值</span>
<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>high_abnormal_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">"hour"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"高电量频数出现的小时分布"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/35/4f/Zn3Zj0JB_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">高电价频数 出现的月分布</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax<span class="token operator">=</span>sns<span class="token punctuation">.</span>countplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">[</span>high_abnormal_mask<span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token operator">=</span><span class="token string">"month"</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"高电量频数出现的月分布"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/20/83/ObUJYY6Z_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">高电价频数 出现的日期排序数表</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 从电价数据中筛选出高于上限阈值的异常值</span>
<span class="token punctuation">(</span>
electricity_price<span class="token punctuation">[</span>high_abnormal_mask<span class="token punctuation">]</span>
    <span class="token comment"># 按月份和日期分组，并计算每个组合的异常值记录数量</span>
    <span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"month"</span><span class="token punctuation">,</span> <span class="token string">"day"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span>                      <span class="token comment"># 计算每个分组的大小（即每个分组的记录数）</span>
    <span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"count"</span><span class="token punctuation">)</span>              <span class="token comment"># 重置索引，将分组字段转换为 DataFrame 的列</span>
    <span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">"count"</span><span class="token punctuation">,</span>       <span class="token comment"># 按 "price" 列排序</span>
        ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        <span class="token comment"># 降序排序</span>
    <span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>                   <span class="token comment"># 选择排序后的前 15 行</span>
<span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/bf/8c/4iyHHfMX_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">2022年8月1日 - 2022年8月8日 总需求 线图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2022-08-01"</span><span class="token punctuation">:</span><span class="token string">"2022-08-08"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>ax<span class="token punctuation">.</span>get_xticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axvspan<span class="token punctuation">(</span><span class="token string">"2022-08-03"</span><span class="token punctuation">,</span> <span class="token string">"2022-08-06"</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"yellow"</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"2022年8月1日 - 2022年8月8日 总需求"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/40/c3/EML25wIp_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">2022年8月1日 - 2022年8月8日 电价 线图</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2022-08-01"</span><span class="token punctuation">:</span><span class="token string">"2022-08-08"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"black"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axhline<span class="token punctuation">(</span>y<span class="token operator">=</span>upper_threshold<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> linestyle<span class="token operator">=</span><span class="token string">"--"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>setp<span class="token punctuation">(</span>ax<span class="token punctuation">.</span>get_xticklabels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> ha<span class="token operator">=</span><span class="token string">'right'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"典型高电价时间段 2022年8月1日 - 2022年8月8日 中的3-6日"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/32/c3/D7suy2vo_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="6__535"></a>6 双变量分析</h2> 
<p><font face="黑体" color="gray"><em>鼠标右键 -&gt; 在新标签页中打开图像</em></font><br> <img src="https://images2.imgbox.com/d6/0a/Sq8DhkCe_o.png" alt="在这里插入图片描述"></p> 
<center> 
 <font face="黑体" color="orange" size="5">pandas 库 编程实现 皮尔逊相关系数（r）</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python">electricity_price<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">,</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>corr<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/34/0e/2U1iEnfp_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">numpy 库 编程实现 皮尔逊相关系数（r）</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
ar_1<span class="token operator">=</span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
ar_2<span class="token operator">=</span>electricity_price<span class="token punctuation">[</span>train_mask<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"price"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values
np<span class="token punctuation">.</span>corrcoef<span class="token punctuation">(</span>np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>ar_1<span class="token punctuation">,</span> ar_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/9a/6d/kSdOCzuj_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<center> 
 <font face="黑体" color="orange" size="5">回归图（散点图及拟合线）</font> 
</center> 
<p><strong>代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># 创建一个图形，大小为 8x10 英寸</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制回归图（散点图及拟合线）</span>
sns<span class="token punctuation">.</span>regplot<span class="token punctuation">(</span>
    data<span class="token operator">=</span>electricity_price<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">"2022"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 选择2022年的数据</span>
    x<span class="token operator">=</span><span class="token string">"demand"</span><span class="token punctuation">,</span>                         <span class="token comment"># x 轴的变量为 "demand"</span>
    y<span class="token operator">=</span><span class="token string">"price"</span><span class="token punctuation">,</span>                          <span class="token comment"># y 轴的变量为 "price"</span>
    scatter_kws<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>                       <span class="token comment"># 设置散点图的样式</span>
        <span class="token string">"s"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>                      <span class="token comment"># 散点的大小设置为 0.5</span>
        <span class="token string">"alpha"</span><span class="token punctuation">:</span> <span class="token number">0.6</span><span class="token punctuation">,</span>                  <span class="token comment"># 散点的透明度设置为 0.6</span>
        <span class="token string">"color"</span><span class="token punctuation">:</span> <span class="token string">"black"</span>               <span class="token comment"># 散点的颜色设置为黑色</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    color<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span>                        <span class="token comment"># 拟合线的颜色设置为红色</span>
    lowess<span class="token operator">=</span><span class="token boolean">True</span>                          <span class="token comment"># 启用局部加权回归（Lowess）以拟合数据</span>
<span class="token punctuation">)</span>

</code></pre> 
<p><strong>回显</strong></p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/8e/61/aPzUhHF0_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="EDA__594"></a>EDA 总结</h2> 
<p><img src="https://images2.imgbox.com/b0/e0/2FuVXT5Z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Read_more_599"></a>Read more</h2> 
<ul><li>Datawhale AI 夏令营 第三期 数学建模（市场博弈和价格预测）<br> <a href="https://linklearner.com/activity/12/2/2" rel="nofollow">https://linklearner.com/activity/12/2/2</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/837938daa1350507b00302d37f525028/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2024下半年，前端的技术风口来了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c38bd73f5fb65ca9f6f7497b8f27509/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用Python打造精彩动画与视频，4.3 创建动态文本和字幕</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>