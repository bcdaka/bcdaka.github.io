<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>一起玩儿物联网人工智能小车（ESP32）——69 使用INMP441模块采集声音 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/18e3fef41ea5123f16297ed1f09d1904/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="一起玩儿物联网人工智能小车（ESP32）——69 使用INMP441模块采集声音">
  <meta property="og:description" content="摘要：本文介绍如何使用INMP441模块采集声音
前边介绍了第一个基于I2S通信协议的MAX98357A模块，利用该模块可以播放各种声音文件。今天来介绍如何使用INMP441模块实现声音的采集功能，也就是如何将声音转变成数字信号。
INMP441是一款高性能，低功耗，数字输出的全向MEMS（微型机电系统）麦克风。完整的INMP441由一个MEMS声音传感器，模数转换器（ADC），抗混叠滤波器，电源管理和标准的24位I2S接口组成。I2S接口允许INMP441直接连接到数字处理器，如DSP和微控制器，而无需再使用音频编解码器，极大的降低了开发的难度。INMP441具有高信噪比，是一款出色的近场应用。INMP441具有扁平宽带频率响应，使得采集声音的清晰度很高。
INMP441模块如下图所示：
INMP441具有以下这些特性和规格参数：
1 具有高精度24位数据的数字I2S接口
2 高信噪比为61dBA
3 高灵敏度-26dBFS
4 从60Hz到15kHz的稳定频率响应
5 低功耗:低电流消耗1.4mA
6 电源电压：1.62 V至3.63 V
7 高PSR：-75dBFS
8 尺寸：12mm*14mm
INMP441的接口定义如下所示：
序号
标识
说明
1
SCK
I2S接口的串行数据时钟
2
WS
用于I2S接口的串行数据字选择
3
L/R
左/右声道选择。设置为低电平时，麦克风在I2S帧的左声道输出信号。设置为高电平时，麦克风在右声道输出信号
4
SD
I2S接口的串行数据输出。
5
VCC
输入电源，1.8V至3.3V.
6
GND
电源地
在这里需要注意的是L/R引脚是用来设置本模块属于哪个声道的，也就决定了这个模块在WS信号是高电平还是低电平的时候有输出。一个双声道声音采集系统，如下图所示：
在上图中可以看到左声道的441模块L/R为接地，是低电平状态，右声道的L/R为接电源正极，是高电平状态。这样微处理器在读取数据时，通过控制WS的状态，就可以分别读取左右声道的数据了。
前面的MAX98357A模块的使用借助了第三方的库函数，可以说在开发中基本没有涉及到I2S协议的底层操作。这次通过使用微处理器厂家提供的原生驱动来实现INMP441声音采集后由MAX98357A播放出来的程序。
使用微处理器厂家提供的原始库函数来驱动I2S设备工作，通常需要以下几个步骤：
1.引入头文件
#include &lt;driver/i2s.h&gt;
2.I2S控制器初始化
ESP32处理器内置了2个I2S控制器，因此可以同时与两个音频设备之间传输音频数据。每个I2S控制器都具备以下功能，可由I2S驱动进行配置：
可用作系统主机或从机可用作发射器或接收器DMA控制器支持流数据采样，CPU无需单独复制每个采样数据 在Arduino中，对I2S控制器进行初始化的方法为：i2s_driver_install()。该方法的主要参数为i2s_config_t类型的结构实例，在该数据结构中，定义了I2S通信的基本参数，主要包括了以下这些属性：
mode：I2S的工作模式。
sample_rate：I2S的采样率
bits_per_sample：I2S的采样位数
channel_format：设置左右声道
communication_format：设置交流格式
dma_buf_count：设置DMA缓冲区的数量
dma_buf_len：设置每个DMA缓冲区的大小
use_apll：设置是否使用精确时钟
intr_alloc_flags：设置如何分配中断
3.设置I2S使用的引脚
使用i2s_set_pin()方法可以设置I2S通信所使用的引脚。该方法所使用的参数为i2s_pin_config_t类型的数据结构，在该结构中定义的了I2S通信所使用的引脚。该结构有如下属性：
bck_io_num：设置串行时钟引脚
ws_io_num：设置左右声道的时钟引脚">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-25T12:57:41+08:00">
    <meta property="article:modified_time" content="2024-02-25T12:57:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">一起玩儿物联网人工智能小车（ESP32）——69 使用INMP441模块采集声音</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">摘要：本文介绍如何使用INMP441模块采集声音</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">前边介绍了第一个基于I2S通信协议的MAX98357A模块，利用该模块可以播放各种声音文件。今天来介绍如何使用INMP441模块实现声音的采集功能，也就是如何将声音转变成数字信号。</p> 
<p style="margin-left:.0001pt;text-align:justify;">INMP441是一款高性能，低功耗，数字输出的全向MEMS（微型机电系统）麦克风。完整的INMP441由一个MEMS声音传感器，模数转换器（ADC），抗混叠滤波器，电源管理和标准的24位I2S接口组成。I2S接口允许INMP441直接连接到数字处理器，如DSP和微控制器，而无需再使用音频编解码器，极大的降低了开发的难度。INMP441具有高信噪比，是一款出色的近场应用。INMP441具有扁平宽带频率响应，使得采集声音的清晰度很高。</p> 
<p style="margin-left:.0001pt;text-align:justify;">INMP441模块如下图所示：</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/4e/76/5thHlxVX_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">INMP441具有以下这些特性和规格参数：</p> 
<p style="margin-left:.0001pt;text-align:justify;">1 具有高精度24位数据的数字I2S接口</p> 
<p style="margin-left:.0001pt;text-align:justify;">2 高信噪比为61dBA</p> 
<p style="margin-left:.0001pt;text-align:justify;">3 高灵敏度-26dBFS</p> 
<p style="margin-left:.0001pt;text-align:justify;">4 从60Hz到15kHz的稳定频率响应</p> 
<p style="margin-left:.0001pt;text-align:justify;">5 低功耗:低电流消耗1.4mA</p> 
<p style="margin-left:.0001pt;text-align:justify;">6 电源电压：1.62 V至3.63 V</p> 
<p style="margin-left:.0001pt;text-align:justify;">7 高PSR：-75dBFS</p> 
<p style="margin-left:.0001pt;text-align:justify;">8 尺寸：12mm*14mm</p> 
<p style="margin-left:.0001pt;text-align:justify;">INMP441的接口定义如下所示：</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">序号</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">标识</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">说明</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">1</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">SCK</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">I</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">2</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">S接口的串行数据时钟</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">2</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">WS</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">用于I</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">2</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">S接口的串行数据字选择</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">3</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">L/R</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">左/右声道选择。设置为低电平时，麦克风在I</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">2</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">S帧的左声道输出信号。设置为高电平时，麦克风在右声道输出信号</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">4</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">SD</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">I</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">2</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">S接口的串行数据输出。</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">5</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">VCC</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">输入电源，1.8V至3.3V.</span></span></p> </td></tr><tr><td style="vertical-align:top;width:30.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">6</span></span></p> </td><td style="vertical-align:top;width:36.5pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">GND</span></span></p> </td><td style="vertical-align:top;width:359.2pt;"> <p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">电源地</span></span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;">在这里需要注意的是L/R引脚是用来设置本模块属于哪个声道的，也就决定了这个模块在WS信号是高电平还是低电平的时候有输出。一个双声道声音采集系统，如下图所示：</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/9a/7a/c6nyvztc_o.png"></p> 
<p style="margin-left:.0001pt;text-align:justify;">在上图中可以看到左声道的441模块L/R为接地，是低电平状态，右声道的L/R为接电源正极，是高电平状态。这样微处理器在读取数据时，通过控制WS的状态，就可以分别读取左右声道的数据了。</p> 
<p style="margin-left:.0001pt;text-align:justify;">前面的MAX98357A模块的使用借助了第三方的库函数，可以说在开发中基本没有涉及到I2S协议的底层操作。这次通过使用微处理器厂家提供的原生驱动来实现INMP441声音采集后由MAX98357A播放出来的程序。</p> 
<p style="margin-left:.0001pt;text-align:justify;">使用微处理器厂家提供的原始库函数来驱动I2S设备工作，通常需要以下几个步骤：</p> 
<p style="text-align:justify;">1.引入头文件</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#include</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">&lt;driver/i2s.h&gt;</span></span></span></p> 
<p style="text-align:justify;">2.I2S控制器初始化</p> 
<p style="margin-left:.0001pt;text-align:justify;">ESP32处理器内置了2个I2S控制器，因此可以同时与两个音频设备之间传输音频数据。每个I2S控制器都具备以下功能，可由I2S驱动进行配置：</p> 
<ol><li style="text-align:justify;">可用作系统主机或从机</li><li style="text-align:justify;">可用作发射器或接收器</li><li style="text-align:justify;">DMA控制器支持流数据采样，CPU无需单独复制每个采样数据</li></ol> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">在Arduino中，对I2S控制器进行初始化的方法为：<span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_driver_install</span></span><span style="background-color:#ffffff;"><span style="color:#d35400;">()</span></span>。该方法的主要参数为i2s_config_t类型的结构实例，在该数据结构中，定义了I2S通信的基本参数，主要包括了以下这些属性：</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">mode：I2S的工作模式。</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">sample_rate：I2S的采样率</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">bits_per_sample：I2S的采样位数</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">channel_format：设置左右声道</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">communication_format：设置交流格式</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">dma_buf_count：设置DMA缓冲区的数量</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">dma_buf_len：设置每个DMA缓冲区的大小</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">use_apll：设置是否使用精确时钟</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">intr_alloc_flags：设置如何分配中断</span></p> 
<p style="text-align:justify;">3.设置I2S使用的引脚</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">使用<span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_set_pin</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">()</span></span>方法可以设置I2S通信所使用的引脚。该方法所使用的参数为i2s_pin_config_t类型的数据结构，在该结构中定义的了I2S通信所使用的引脚。该结构有如下属性：</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">bck_io_num：设置串行时钟引脚</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">ws_io_num：设置左右声道的时钟引脚</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">data_out_num：设置数据输出引脚</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">data_in_num：设置数据输入引脚</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">需要注意的是，在驱动MAX98357A模块的时候，使用的是数据输出引脚，而在驱动INMP441模块的时候，则使用的是输入引脚。不使用的引脚可以赋值-1。ESP32微处理器是支持输入和输出引脚同时使用的，也就是可以同时读入音频数据和输出音频数据。但前提条件是由于收发通道共用一个时钟信号，因此要求两者的配置相同。</p> 
<p style="text-align:justify;">4.读入或者输出音频数据。</p> 
<p style="margin-left:.0001pt;text-align:justify;">在前面配置完成后，就可以使用i2s_read()方法读入音频数据，i2s_write()方法输出音频数据了。这两个方法的具体使用，请参照下面的例子。</p> 
<p style="margin-left:.0001pt;text-align:justify;">接下来就看一下这个示例的源代码吧，如下所示：</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:426.1pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#include</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">"Arduino.h"</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#include</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">&lt;driver/i2s.h&gt;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">INMP441_WS</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">22</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">INMP441_SCK</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">21</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">INMP441_SD</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">32</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">MAX98357_LRC</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">27</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">MAX98357_BCLK</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">26</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">MAX98357_DIN</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">25</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#728e00;">#define</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">SAMPLE_RATE</span></span> <span style="background-color:#ffffff;"><span style="color:#005c5f;">44100</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_config_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> i2sIn_config = </span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .mode = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_mode_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_MODE_MASTER | I2S_MODE_RX</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .sample_rate = SAMPLE_RATE,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .bits_per_sample = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_bits_per_sample_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">16</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .channel_format = I2S_CHANNEL_FMT_ONLY_LEFT,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .communication_format = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_comm_format_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_COMM_FORMAT_STAND_I2S</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .intr_alloc_flags = ESP_INTR_FLAG_LEVEL1,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .dma_buf_count = </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">8</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .dma_buf_len = </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">1024</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">const</span></span> <span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_pin_config_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> i2sIn_pin_config = </span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .bck_io_num = INMP441_SCK,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .ws_io_num = INMP441_WS,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .data_out_num = -</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">1</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .data_in_num = INMP441_SD</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_config_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> i2sOut_config = </span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .mode = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_mode_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_MODE_MASTER | I2S_MODE_TX</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .sample_rate = SAMPLE_RATE,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .bits_per_sample = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_bits_per_sample_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">16</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .channel_format = I2S_CHANNEL_FMT_ONLY_RIGHT,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .communication_format = </span></span><span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_comm_format_t</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_COMM_FORMAT_STAND_I2S</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .intr_alloc_flags = ESP_INTR_FLAG_LEVEL1,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .dma_buf_count = </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">8</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .dma_buf_len = </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">1024</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">const</span></span> <span style="background-color:#ffffff;"><span style="color:#00979d;">i2s_pin_config_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> i2sOut_pin_config = </span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .bck_io_num = MAX98357_BCLK,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .ws_io_num = MAX98357_LRC,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .data_out_num = MAX98357_DIN,</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  .data_in_num = -</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">1</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">void</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">setup</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">()</span></span> <span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#95a5a6;">  // put your setup code here, to run once:</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#d35400;">Serial</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">.</span></span><span style="background-color:#ffffff;"><span style="color:#d35400;">begin</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">115200</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_driver_install</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_0, &amp;i2sIn_config, </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">0</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">, </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">NULL</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_set_pin</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_0, &amp;i2sIn_pin_config</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_driver_install</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_1, &amp;i2sOut_config, </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">0</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">, </span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">NULL</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_set_pin</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_1, &amp;i2sOut_pin_config</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#00979d;">void</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">()</span></span> <span style="background-color:#ffffff;"><span style="color:#434f54;">{<!-- --></span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#95a5a6;">  // put your main code here, to run repeatedly:</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#00979d;">size_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> bytes_read;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#00979d;">int16_t</span></span> <span style="background-color:#ffffff;"><span style="color:#d35400;">data</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">[</span></span><span style="background-color:#ffffff;"><span style="color:#005c5f;">512</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">];</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;">  <span style="background-color:#ffffff;"><span style="color:#00979d;">esp_err_t</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;"> result = </span></span><span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_read</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_0, &amp;data, sizeof</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">data</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">, &amp;bytes_read, portMAX_DELAY</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#4e5b61;">  result = </span></span><span style="background-color:#ffffff;"><span style="color:#d35400;">i2s_write</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">I2S_NUM_1, &amp;data, sizeof</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">(</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">data</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">, &amp;bytes_read, portMAX_DELAY</span></span><span style="background-color:#ffffff;"><span style="color:#434f54;">)</span></span><span style="background-color:#ffffff;"><span style="color:#4e5b61;">;</span></span></span></p> <p style="margin-left:.0001pt;text-align:left;"></p> <p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#434f54;">}</span></span></span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;">好了，I2S通信协议的使用方法就介绍到这里了。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3583fb119d1de39c4f27568286471bc5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python request访问401错误与权限验证</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4f1f719cda1ba123136224bc1fa35eb0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python 的 complex() 函数：处理复数数据类型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>