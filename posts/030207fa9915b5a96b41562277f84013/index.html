<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV目标识别 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/030207fa9915b5a96b41562277f84013/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="OpenCV目标识别">
  <meta property="og:description" content="一 图像轮廓 具有相同颜色或强度的连续点的曲线。
图像轮廓的作用
可以用于图像分析
物体的识别与检测
注意 为了检测的准确性，需要先对图像进行二值化或Canny操作。
画轮廓时会修改输入的图像。
轮廓查找的API
findContours(img,mode,ApproximationMode,...) 两个返回值，contours和hierarchy mode RETR_EXTERNAL=0,表示只检测外轮廓。 RETR_LIST=1，检测的轮廓不建立等级关系 RETR_CCOMP=2,每层最多两级 RETR_TREE=3,桉树形存储轮廓 ApproximationMode CHAIN_APPROX_NONE,保存所有轮廓上的点 CHAIN_APPROX_SIMPLE，只保存角点 import cv2 import numpy as np img=cv2.imread(&#39;./9615.jpg&#39;) print(img.shape) #转变成单通道 gray=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY) print(gray.shape) #二值化 ret,binary=cv2.threshold(gray,150,255,cv2.THRESH_BINARY) #轮廓查找 contours,hierarchy=cv2.findContours(binary,cv2.RETR_EXTERNAL,cv2.CHAIN_APPROX_SIMPLE) print(contours) cv2.imshow(&#39;img&#39;,img) cv2.waitKey(0) 二 绘制轮廓 如何绘制轮廓
drawContours(img,contours,contourIdx,color,thickness...) contourIdx,-1表示绘制所有轮廓 color,颜色(0,0,255) thickness,线宽，-1是全部填充 import cv2 import numpy as np img=cv2.imread(&#39;./9615.jpg&#39;) print(img.shape) #转变成单通道 gray=cv2.cvtColor(img,cv2.COLOR_BGR2GRAY) print(gray.shape) #二值化 ret,binary=cv2.threshold(gray,150,255,cv2.THRESH_BINARY) #轮廓查找 contours,hierarchy=cv2.findContours(binary,cv2.RETR_EXTERNAL,cv2.CHAIN_APPROX_SIMPLE) print(contours) #绘制轮廓 img1=cv2.drawContours(img,contours,0,(0,0,255),5) #cv2.imshow(&#39;img&#39;,img) cv2.imshow(&#39;img1&#39;,img1) cv2.waitKey(0) 三 轮廓的面积和周长 1 轮廓的面积 contourArea(contour) contour：轮廓 2 轮廓的周长 arcLength(curve,closed) curve:轮廓 closed:是否是闭合的轮廓 import cv2 import numpy as np img=cv2.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-16T21:42:22+08:00">
    <meta property="article:modified_time" content="2024-06-16T21:42:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV目标识别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="__0"></a>一 图像轮廓</h2> 
<p>具有相同颜色或强度的连续点的曲线。<br> <img src="https://images2.imgbox.com/5f/16/EWtOHKcF_o.png" alt="在这里插入图片描述"><br> 图像轮廓的作用<br> 可以用于图像分析<br> 物体的识别与检测</p> 
<h2><a id="_7"></a>注意</h2> 
<p>为了检测的准确性，需要先对图像进行二值化或Canny操作。<br> 画轮廓时会修改输入的图像。</p> 
<p>轮廓查找的API</p> 
<pre><code class="prism language-cpp"><span class="token function">findContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>mode<span class="token punctuation">,</span>ApproximationMode<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
两个返回值，contours和hierarchy
mode
RETR_EXTERNAL<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>表示只检测外轮廓。
RETR_LIST<span class="token operator">=</span><span class="token number">1</span>，检测的轮廓不建立等级关系
RETR_CCOMP<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>每层最多两级
RETR_TREE<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>桉树形存储轮廓
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/45/8RXf9Pvo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/26/f6/WOOr1hg6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8f/f0/ExoMBEtF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/86/5e/aRWfMQMt_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp">ApproximationMode
CHAIN_APPROX_NONE<span class="token punctuation">,</span>保存所有轮廓上的点
CHAIN_APPROX_SIMPLE，只保存角点
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'./9615.jpg'</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#转变成单通道
gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#二值化
ret<span class="token punctuation">,</span>binary<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>

#轮廓查找
contours<span class="token punctuation">,</span>hierarchy<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>contours<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="__54"></a>二 绘制轮廓</h2> 
<p>如何绘制轮廓</p> 
<pre><code class="prism language-cpp"><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span>contourIdx<span class="token punctuation">,</span>color<span class="token punctuation">,</span>thickness<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
contourIdx<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span>表示绘制所有轮廓
color<span class="token punctuation">,</span>颜色<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span>
thickness<span class="token punctuation">,</span>线宽，<span class="token operator">-</span><span class="token number">1</span>是全部填充
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'./9615.jpg'</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#转变成单通道
gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#二值化
ret<span class="token punctuation">,</span>binary<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>

#轮廓查找
contours<span class="token punctuation">,</span>hierarchy<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>contours<span class="token punctuation">)</span>

#绘制轮廓
img1<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">cv</span><span class="token expression"><span class="token number">2.</span><span class="token function">imshow</span><span class="token punctuation">(</span></span><span class="token char">'img'</span><span class="token expression"><span class="token punctuation">,</span>img<span class="token punctuation">)</span></span></span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'img1'</span><span class="token punctuation">,</span>img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="__89"></a>三 轮廓的面积和周长</h2> 
<h3><a id="1__90"></a>1 轮廓的面积</h3> 
<pre><code class="prism language-cpp"><span class="token function">contourArea</span><span class="token punctuation">(</span>contour<span class="token punctuation">)</span>
contour：轮廓
</code></pre> 
<h3><a id="2__96"></a>2 轮廓的周长</h3> 
<pre><code class="prism language-cpp"><span class="token function">arcLength</span><span class="token punctuation">(</span>curve<span class="token punctuation">,</span>closed<span class="token punctuation">)</span>
curve<span class="token operator">:</span>轮廓
closed<span class="token operator">:</span>是否是闭合的轮廓
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'./9615.jpg'</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#转变成单通道
gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#二值化
ret<span class="token punctuation">,</span>binary<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>

#轮廓查找
contours<span class="token punctuation">,</span>hierarchy<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_EXTERNAL<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>contours<span class="token punctuation">)</span>

#绘制轮廓
img1<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

#计算面积
area<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">contourArea</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"area=%d"</span><span class="token operator">%</span><span class="token punctuation">(</span>area<span class="token punctuation">)</span><span class="token punctuation">)</span>

# 计算周长
len<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">arcLength</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>True<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"len=%d"</span><span class="token operator">%</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">cv</span><span class="token expression"><span class="token number">2.</span><span class="token function">imshow</span><span class="token punctuation">(</span></span><span class="token char">'img'</span><span class="token expression"><span class="token punctuation">,</span>img<span class="token punctuation">)</span></span></span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'img1'</span><span class="token punctuation">,</span>img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="__136"></a>四 多边形逼近与凸包</h2> 
<p><img src="https://images2.imgbox.com/5b/a9/UZt9Jc04_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1__138"></a>1 多边形逼近</h3> 
<pre><code class="prism language-cpp"><span class="token function">approxPolyDP</span><span class="token punctuation">(</span>curve<span class="token punctuation">,</span>epsilon<span class="token punctuation">,</span>closed<span class="token punctuation">)</span>
curve<span class="token operator">:</span>轮廓
epsilon
closed<span class="token operator">:</span>是否是闭合的轮廓
</code></pre> 
<h3><a id="2__146"></a>2 凸包</h3> 
<pre><code class="prism language-cpp"><span class="token function">convexHull</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>clockwise<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
points<span class="token operator">:</span>轮廓
clockwise<span class="token operator">:</span>顺时针绘制
</code></pre> 
<p>轮廓查找：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

def <span class="token function">drawShape</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span>points<span class="token punctuation">)</span><span class="token operator">:</span>
    i<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token function">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token function">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            cv2<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            cv2<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span>

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'./palm.png'</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span></span>

#转变成单通道
gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#二值化
ret<span class="token punctuation">,</span>binary<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY_INV<span class="token punctuation">)</span>

#轮廓查找
contours<span class="token punctuation">,</span>hierarchy<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_CCOMP<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_NONE<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>contours<span class="token punctuation">)</span></span></span>

#绘制轮廓
img1<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

e<span class="token operator">=</span><span class="token number">20</span>

approx<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">approxPolyDP</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>True<span class="token punctuation">)</span>

<span class="token function">drawShape</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>approx<span class="token punctuation">)</span>

hull<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">convexHull</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">drawShape</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span>hull<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">cv</span><span class="token expression"><span class="token number">2.</span><span class="token function">imshow</span><span class="token punctuation">(</span></span><span class="token char">'img'</span><span class="token expression"><span class="token punctuation">,</span>img<span class="token punctuation">)</span></span></span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'img1'</span><span class="token punctuation">,</span>img1<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>凸包绘制</p> 
<p><img src="https://images2.imgbox.com/a0/a4/0iHIu28z_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__203"></a>五 外接矩形</h2> 
<p>最小外接矩形<br> 最大外接矩形<br> 外接矩形<br> <img src="https://images2.imgbox.com/fa/30/j1A4NKBN_o.png" alt="在这里插入图片描述"><br> 最小外接矩形</p> 
<pre><code class="prism language-cpp"><span class="token function">minAreaRect</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
points<span class="token operator">:</span>轮廓
返回值：RotatedRect
RotatedRect
x<span class="token punctuation">,</span>y
width<span class="token punctuation">,</span>height
angle
</code></pre> 
<p>最大外接矩形</p> 
<pre><code class="prism language-cpp"><span class="token function">boundingRect</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>
array：轮廓
返回值：Rect 
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

def <span class="token function">drawShape</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span>points<span class="token punctuation">)</span><span class="token operator">:</span>
    i<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">while</span> i<span class="token operator">&lt;</span><span class="token function">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token function">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            cv2<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            x<span class="token punctuation">,</span> y <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            cv2<span class="token punctuation">.</span><span class="token function">line</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span>

img<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'./Hello.png'</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>img<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></span></span>

#转变成单通道
gray<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>gray<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

#二值化
ret<span class="token punctuation">,</span>binary<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>binary<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
#轮廓查找cv2<span class="token punctuation">.</span>RETR_CCOMP CHAIN_APPROX_NONE
contours<span class="token punctuation">,</span>hierarchy<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>contours<span class="token punctuation">)</span></span></span>

#绘制轮廓
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">img</span><span class="token expression"><span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>contours<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span></span></span>

r<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">minAreaRect</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
box<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">boxPoints</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
box<span class="token operator">=</span>np<span class="token punctuation">.</span><span class="token function">int32</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span><span class="token function">drawContours</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">[</span>box<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>contours<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span><span class="token function">rectangle</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span>y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>


cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'img'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>

cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>


</code></pre> 
<p><img src="https://images2.imgbox.com/c9/c6/ddwaXLOh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="__280"></a>六 车辆统计</h2> 
<p>窗口的展示<br> 图像/视频的加载<br> 基本图形的绘制<br> 车辆识别<br> 基本图像运算与处理<br> 形态学<br> 轮廓查找</p> 
<h3><a id="1__289"></a>1 涉及到的知识点</h3> 
<p>加载视频<br> 通过形态学识别车辆<br> 对车辆进行统计<br> 显示车辆统计信息</p> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

cap<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token char">'video.mp4'</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> True<span class="token operator">:</span>
   ret<span class="token punctuation">,</span>frame<span class="token operator">=</span> cap<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">==</span>True<span class="token punctuation">)</span><span class="token operator">:</span>
       cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'video'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>

   key<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">27</span><span class="token punctuation">)</span>
       <span class="token keyword">break</span>
cap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>形态学处理</p> 
<pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np

cap<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">VideoCapture</span><span class="token punctuation">(</span><span class="token char">'video.mp4'</span><span class="token punctuation">)</span>

bgsubmog<span class="token operator">=</span>cv2<span class="token punctuation">.</span>bgsegm<span class="token punctuation">.</span><span class="token function">createBackgroundSubtractorMOG</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

#形态学kernel
kernel<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">getStructuringElement</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>MORPH_RECT<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> True<span class="token operator">:</span>
   ret<span class="token punctuation">,</span>frame<span class="token operator">=</span> cap<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

   <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">==</span>True<span class="token punctuation">)</span><span class="token operator">:</span>
       #灰度
       cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
       #去噪<span class="token punctuation">(</span>高斯<span class="token punctuation">)</span>
       blu<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">GaussianBlur</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
       #去背影
       mask<span class="token operator">=</span>bgsubmog<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>blu<span class="token punctuation">)</span>

       #腐蚀
       erode<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">erode</span><span class="token punctuation">(</span>mask<span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>

       #膨胀
       dilate<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">dilate</span><span class="token punctuation">(</span>mask<span class="token punctuation">,</span>kernel<span class="token punctuation">,</span>iterations<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

       #闭操作，去掉物体内部的小块
       close<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">morphologyEx</span><span class="token punctuation">(</span>dilate<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>MORPH_CLOSE<span class="token punctuation">,</span>kernel<span class="token punctuation">)</span>

       cnts<span class="token punctuation">,</span>h<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">findContours</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>RETR_TREE<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>CHAIN_APPROX_NONE<span class="token punctuation">)</span>

       <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>c<span class="token punctuation">)</span>in <span class="token function">enumerate</span><span class="token punctuation">(</span>cnts<span class="token punctuation">)</span><span class="token operator">:</span>
           <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">boundingRect</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
           cv2<span class="token punctuation">.</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token operator">+</span>w<span class="token punctuation">,</span>y<span class="token operator">+</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

       cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'mask'</span><span class="token punctuation">,</span>mask<span class="token punctuation">)</span>
       cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'erode'</span><span class="token punctuation">,</span>erode<span class="token punctuation">)</span>
       cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token char">'video'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>

   key<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token operator">==</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token operator">:</span>
       <span class="token keyword">break</span>
cap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a40aeff91d6899dc901392f8a51ad3e6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Parallels Desktop 19 激活码 - 苹果 Mac 最新版 PD 19激活密钥虚拟机下载 (支持Win11/macOS Sonoma)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6392bdd5de03406f24f7324c8c133ca1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">哈喽GPT-4o——对GPT-4o 提示词的思考与看法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>