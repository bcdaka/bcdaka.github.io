<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 | Pytorch2.0 AI框架视频处理】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/817e6627271658dd71149a1c25b7b6ba/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 | Pytorch2.0 AI框架视频处理】">
  <meta property="og:description" content="利用HAI的ChatGLM2 6B做一个即时对话小游戏 ChatGLM2-6B 是开源中英双语对话模型 ChatGLM-6B 的第二代版本，在保留了初代模型对话流畅、部署门槛较低等众多优秀特性的基础之上，ChatGLM2-6B 引入了更强大的性能、更长的上下文、更高效的推理，所以用来做个小游戏非常的合适了。
我基本没有做什么语句优化，直接给了，并且能看到回复的情况，相当可以的呢。接下来我们使用ChatGLM2 6B返回的结果来做个适合大学生们学习的职场即时对话类游戏。 游戏框架概述 在大学中，我们能学到有限的知识，但是我们要步入社会，想要在短时间内能站稳跟脚绝对是一件很难的事情，那么，我们就可以通过我们这款小游戏来历练我们的对话能力。
【腾讯云 HAI域探秘】——即时职场生存指南小游戏
游戏接口的用语，可以自己尝试，挺好的。
目标：生成领导与员工的对话语句，来考验员工的职场适应能力。
1、信息1领导提问员工一个问题；
2、信息2是普通员工的回答方式；
3、信息3是优秀员工的回答方式；
4、信息4是领导对信息2普通员工的回复并告知回错误，给予一定的错误惩罚；
5、信息5是领导对信息3优秀员工的回复并告知回正确，给予一定的奖励话语。
6、仅生成以上5条信息，每条信息长度不超过50个字。
7、对话中不能有不文明用语。
这里用到了Stable Diffusion来创建AI图片使游戏变得更加有意思。
例如，下图就是游戏页面，老板生成的时候我写的：
翻译完成后到【Stable Diffusion】里面生成就行，注意反向用语我写的：【(semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime:1.1)close up】，反向用词很多我再下面的SD中有说明。
开启ChatGLM2 6B的服务，下面有对应操作。这里建议选用高性能的服务。不然可能起不来。
成功示例： 有了这个就代表我们有接口了。
先返回到腾讯云，搜索一下Cloud Studio创建一个空项目
创建空项目
编码：
编码完成后就能运行了哦，网页单独的使用【python -m http.server】来启动，不启动无法访问的哦。
自带的内置浏览器访问不效果不如单独打开的，我们可以进行测试以下。
目录
利用HAI的ChatGLM2 6B做一个即时对话小游戏
游戏框架概述
自行搭建Stable Diffusion模型服务用于生成AI图片
一、服务创建
1、服务地址：
2、等待审核(大概24小时)
二、创建服务
1、新建服务
2、选择AI模型：Stable Diffusion
3、等待创建(5~8分钟）
三、操作面板介绍
1、webui操作
2、jupyter_lab操作
四、webui操作步骤
1、中文插件安装
2、配置中文插件操作步骤
3、Reload UI后效果">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-19T22:06:37+08:00">
    <meta property="article:modified_time" content="2023-11-19T22:06:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【腾讯云 HAI域探秘】——即时职场生存指南小游戏以及【自行搭建Stable Diffusion图片AI绘制 | ChatGLM2-6B AI进行智能对话 | Pytorch2.0 AI框架视频处理】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="main-toc">利用HAI的ChatGLM2 6B做一个即时对话小游戏</h3> 
<p>ChatGLM2-6B 是开源中英双语对话模型 ChatGLM-6B 的第二代版本，在保留了初代模型对话流畅、部署门槛较低等众多优秀特性的基础之上，ChatGLM2-6B 引入了更强大的性能、更长的上下文、更高效的推理，所以用来做个小游戏非常的合适了。</p> 
<p><img alt="" height="939" src="https://images2.imgbox.com/57/a3/OXdu66EL_o.png" width="1200"></p> 
<p>我基本没有做什么语句优化，直接给了，并且能看到回复的情况，相当可以的呢。接下来我们使用ChatGLM2 6B返回的结果来做个适合大学生们学习的职场即时对话类游戏。 </p> 
<h2 id="%E6%B8%B8%E6%88%8F%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0">游戏框架概述</h2> 
<p>在大学中，我们能学到有限的知识，但是我们要步入社会，想要在短时间内能站稳跟脚绝对是一件很难的事情，那么，我们就可以通过我们这款小游戏来历练我们的对话能力。</p> 
<p><img alt="" height="1168" src="https://images2.imgbox.com/e2/f1/G3fulk6w_o.png" width="1200"></p> 
<div class="csdn-video-box"> 
 <iframe id="T3feCBZD-1700402626847" frameborder="0" src="https://player.bilibili.com/player.html?aid=918594893" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>【腾讯云 HAI域探秘】——即时职场生存指南小游戏</p> 
</div> 
<p>游戏接口的用语，可以自己尝试，挺好的。</p> 
<blockquote> 
 <p>目标：生成领导与员工的对话语句，来考验员工的职场适应能力。<br> 1、信息1领导提问员工一个问题；<br> 2、信息2是普通员工的回答方式；<br> 3、信息3是优秀员工的回答方式；<br> 4、信息4是领导对信息2普通员工的回复并告知回错误，给予一定的错误惩罚；<br> 5、信息5是领导对信息3优秀员工的回复并告知回正确，给予一定的奖励话语。<br> 6、仅生成以上5条信息，每条信息长度不超过50个字。<br> 7、对话中不能有不文明用语。</p> 
</blockquote> 
<p>这里用到了Stable Diffusion来创建AI图片使游戏变得更加有意思。</p> 
<p>例如，下图就是游戏页面，老板生成的时候我写的：</p> 
<p><img alt="" height="345" src="https://images2.imgbox.com/fd/4f/V0CaKy9P_o.png" width="1200"></p> 
<p>翻译完成后到【Stable Diffusion】里面生成就行，注意反向用语我写的：【(semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime:1.1)close up】，反向用词很多我再下面的SD中有说明。</p> 
<p class="img-center"><img alt="" height="681" src="https://images2.imgbox.com/f9/40/uNQupGED_o.png" width="510"></p> 
<p>开启ChatGLM2 6B的服务，下面有对应操作。这里建议选用高性能的服务。不然可能起不来。</p> 
<p><img alt="" height="89" src="https://images2.imgbox.com/8e/80/dkpXHojW_o.png" width="1200"></p> 
<p>成功示例： </p> 
<p><img alt="" height="153" src="https://images2.imgbox.com/e2/4a/cNdPB0xY_o.png" width="1054"></p> 
<p>有了这个就代表我们有接口了。</p> 
<p>先返回到腾讯云，搜索一下Cloud Studio创建一个空项目</p> 
<p><img alt="" height="937" src="https://images2.imgbox.com/37/6d/RhCedtHT_o.png" width="1200"></p> 
<p>创建空项目</p> 
<p><img alt="" height="710" src="https://images2.imgbox.com/45/3c/5NI7eRbq_o.png" width="1200"></p> 
<p>编码：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/97/2b/IeNaCgCr_o.png" width="1200"></p> 
<p>编码完成后就能运行了哦，网页单独的使用【python -m http.server】来启动，不启动无法访问的哦。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a0/4b/c5FMKXB7_o.png" width="1200">自带的内置浏览器访问不效果不如单独打开的，我们可以进行测试以下。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/4b/ee/bcGRZ2Y4_o.png" width="1200"></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="main-toc-toc" style="margin-left:40px;"><a href="#main-toc" rel="nofollow">利用HAI的ChatGLM2 6B做一个即时对话小游戏</a></p> 
<p id="%E6%B8%B8%E6%88%8F%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E6%B8%B8%E6%88%8F%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0" rel="nofollow">游戏框架概述</a></p> 
<p id="%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAStable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87-toc" style="margin-left:0px;"><a href="#%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAStable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87" rel="nofollow">自行搭建Stable Diffusion模型服务用于生成AI图片</a></p> 
<p id="%E4%B8%80%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA" rel="nofollow">一、服务创建</a></p> 
<p id="1%E3%80%81%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%EF%BC%9A-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%EF%BC%9A" rel="nofollow">1、服务地址：</a></p> 
<p id="2%E3%80%81%E7%AD%89%E5%BE%85%E5%AE%A1%E6%A0%B8(%E5%A4%A7%E6%A6%8224%E5%B0%8F%E6%97%B6)-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E7%AD%89%E5%BE%85%E5%AE%A1%E6%A0%B8%28%E5%A4%A7%E6%A6%8224%E5%B0%8F%E6%97%B6%29" rel="nofollow">2、等待审核(大概24小时)</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1" rel="nofollow">二、创建服务</a></p> 
<p id="1%E3%80%81%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1" rel="nofollow">1、新建服务</a></p> 
<p id="2%E3%80%81%E9%80%89%E6%8B%A9AI%E6%A8%A1%E5%9E%8B%EF%BC%9AStable%20Diffusion-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E9%80%89%E6%8B%A9AI%E6%A8%A1%E5%9E%8B%EF%BC%9AStable%20Diffusion" rel="nofollow">2、选择AI模型：Stable Diffusion</a></p> 
<p id="3%E3%80%81%E7%AD%89%E5%BE%85%E5%88%9B%E5%BB%BA(5~8%E5%88%86%E9%92%9F%EF%BC%89-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E7%AD%89%E5%BE%85%E5%88%9B%E5%BB%BA%285~8%E5%88%86%E9%92%9F%EF%BC%89" rel="nofollow">3、等待创建(5~8分钟）</a></p> 
<p id="%E4%B8%89%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D" rel="nofollow">三、操作面板介绍</a></p> 
<p id="1%E3%80%81webui%E6%93%8D%E4%BD%9C-toc" style="margin-left:80px;"><a href="#1%E3%80%81webui%E6%93%8D%E4%BD%9C" rel="nofollow">1、webui操作</a></p> 
<p id="2%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C-toc" style="margin-left:80px;"><a href="#2%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C" rel="nofollow">2、jupyter_lab操作</a></p> 
<p id="%E5%9B%9B%E3%80%81webui%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81webui%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" rel="nofollow">四、webui操作步骤</a></p> 
<p id="1%E3%80%81%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85" rel="nofollow">1、中文插件安装</a></p> 
<p id="2%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" rel="nofollow">2、配置中文插件操作步骤</a></p> 
<p id="3%E3%80%81Reload%20UI%E5%90%8E%E6%95%88%E6%9E%9C-toc" style="margin-left:80px;"><a href="#3%E3%80%81Reload%20UI%E5%90%8E%E6%95%88%E6%9E%9C" rel="nofollow">3、Reload UI后效果</a></p> 
<p id="%E4%BA%94%E3%80%81stable%20Diffusion%E2%80%94%E2%80%94AI%E7%BB%98%E5%9B%BE%E6%8A%80%E5%B7%A7(%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD)-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81stable%20Diffusion%E2%80%94%E2%80%94AI%E7%BB%98%E5%9B%BE%E6%8A%80%E5%B7%A7%28%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD%29" rel="nofollow">五、stable Diffusion——AI绘图技巧(特色功能)</a></p> 
<p id="%E5%85%AD%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E5%85%AD%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" rel="nofollow">六、jupyter_lab操作步骤</a></p> 
<p id="%C2%A01%E3%80%81%E8%BF%9B%E5%85%A5jupyter_lab%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2-toc" style="margin-left:80px;"><a href="#%C2%A01%E3%80%81%E8%BF%9B%E5%85%A5jupyter_lab%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2" rel="nofollow"> 1、进入jupyter_lab操作页面</a></p> 
<p id="2%E3%80%81%E9%9D%A2%E6%9D%BF%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E9%9D%A2%E6%9D%BF%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D" rel="nofollow">2、面板功能介绍</a></p> 
<p id="3%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1" rel="nofollow">3、启动服务</a></p> 
<p id="4%E3%80%81%E6%B7%BB%E5%8A%A07862%E7%AB%AF%E5%8F%A3%E8%A7%84%E5%88%99-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E6%B7%BB%E5%8A%A07862%E7%AB%AF%E5%8F%A3%E8%A7%84%E5%88%99" rel="nofollow">4、添加7862端口规则</a></p> 
<p id="3%E3%80%81%E8%AE%BF%E9%97%AEswagger%E6%8E%A5%E5%8F%A3-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E8%AE%BF%E9%97%AEswagger%E6%8E%A5%E5%8F%A3" rel="nofollow">3、访问swagger接口</a></p> 
<p id="%E4%B8%83%E3%80%81python%E6%8E%A5%E5%8F%A3%E8%A7%A3%E6%9E%90%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87-toc" style="margin-left:40px;"><a href="#%E4%B8%83%E3%80%81python%E6%8E%A5%E5%8F%A3%E8%A7%A3%E6%9E%90%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87" rel="nofollow">七、python接口解析生成AI图片</a></p> 
<p id="1%E3%80%81%E6%89%93%E5%BC%80python%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%89%93%E5%BC%80python%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7" rel="nofollow">1、打开python开发工具</a></p> 
<p id="2%E3%80%81%E5%88%9B%E5%BB%BApy%E6%96%87%E4%BB%B6%E5%B9%B6%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E5%88%9B%E5%BB%BApy%E6%96%87%E4%BB%B6%E5%B9%B6%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81" rel="nofollow">2、创建py文件并输入以下代码</a></p> 
<p id="%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-toc" style="margin-left:80px;"><a href="#%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C" rel="nofollow"> 3、运行效果</a></p> 
<p id="Stable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#Stable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93" rel="nofollow">Stable Diffusion模型总结</a></p> 
<p id="%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8EAI%E5%AF%B9%E8%AF%9D-toc" style="margin-left:0px;"><a href="#%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8EAI%E5%AF%B9%E8%AF%9D" rel="nofollow">自行搭建ChatGL M26BAI模型服务用于AI对话</a></p> 
<p id="%E4%B8%80%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA" rel="nofollow">一、服务创建</a></p> 
<p id="%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1" rel="nofollow">新建服务</a></p> 
<p id="%E6%9C%8D%E5%8A%A1%E9%80%89%E6%8B%A9%EF%BC%9A(%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9%E5%A4%A7%E4%B8%80%E4%BA%9B%E7%9A%84%E7%A1%AC%E7%9B%98)-toc" style="margin-left:80px;"><a href="#%E6%9C%8D%E5%8A%A1%E9%80%89%E6%8B%A9%EF%BC%9A%28%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9%E5%A4%A7%E4%B8%80%E4%BA%9B%E7%9A%84%E7%A1%AC%E7%9B%98%29" rel="nofollow">服务选择：(这里可以下拉选择大一些的硬盘)</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D" rel="nofollow">二、操作面板介绍</a></p> 
<p id="1%E3%80%81chatglm_gradio%3A-toc" style="margin-left:80px;"><a href="#1%E3%80%81chatglm_gradio%3A" rel="nofollow">1、chatglm_gradio:</a></p> 
<p id="2%E3%80%81jupyter_lab%3A-toc" style="margin-left:80px;"><a href="#2%E3%80%81jupyter_lab%3A" rel="nofollow">2、jupyter_lab:</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E7%A4%BA%E4%BE%8B(jupyter_lab%E6%93%8D%E4%BD%9C)-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E7%A4%BA%E4%BE%8B%28jupyter_lab%E6%93%8D%E4%BD%9C%29" rel="nofollow">三、基础服务示例(jupyter_lab操作)</a></p> 
<p id="1%E3%80%81%E8%BF%9B%E5%85%A5%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E8%BF%9B%E5%85%A5%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1" rel="nofollow">1、进入并启动服务</a></p> 
<p id="2%E3%80%81%E5%90%AF%E5%8A%A8%E5%90%8E%E5%BC%80%E5%90%AF%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A3(8000)-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E5%90%AF%E5%8A%A8%E5%90%8E%E5%BC%80%E5%90%AF%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A3%288000%29" rel="nofollow">2、启动后开启访问端口(8000)</a></p> 
<p id="3%E3%80%81Python%E6%8E%A5%E5%8F%A3%E8%AE%BF%E9%97%AE%E6%95%88%E6%9E%9C-toc" style="margin-left:80px;"><a href="#3%E3%80%81Python%E6%8E%A5%E5%8F%A3%E8%AE%BF%E9%97%AE%E6%95%88%E6%9E%9C" rel="nofollow">3、Python接口访问效果</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%AD%A3%E5%BC%8F%E6%9C%8D%E5%8A%A1%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E6%AD%A3%E5%BC%8F%E6%9C%8D%E5%8A%A1%E4%BB%A3%E7%A0%81" rel="nofollow">四、正式服务代码</a></p> 
<p id="1%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6" rel="nofollow">1、修改【openai-api.py】文件</a></p> 
<p id="%C2%A02%E3%80%81%E8%BF%90%E8%A1%8C%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6%EF%BC%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%C2%A02%E3%80%81%E8%BF%90%E8%A1%8C%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6%EF%BC%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1" rel="nofollow"> 2、运行【openai-api.py】文件，服务端开启服务</a></p> 
<p id="%E4%BA%94%E3%80%81%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A1%B5%E9%9D%A2%E6%90%AD%E5%BB%BA-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A1%B5%E9%9D%A2%E6%90%AD%E5%BB%BA" rel="nofollow">五、可视化页面搭建</a></p> 
<p id="1%E3%80%81%E5%9C%A8%E5%88%9B%E5%BB%BAcloud%20Studio%E7%9A%84%E6%97%B6%E5%80%99%E9%80%89%E6%8B%A9%E3%80%90%E5%BA%94%E7%94%A8%E6%8E%A8%E8%8D%90%E3%80%91-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%9C%A8%E5%88%9B%E5%BB%BAcloud%20Studio%E7%9A%84%E6%97%B6%E5%80%99%E9%80%89%E6%8B%A9%E3%80%90%E5%BA%94%E7%94%A8%E6%8E%A8%E8%8D%90%E3%80%91" rel="nofollow">1、在创建cloud Studio的时候选择【应用推荐】</a></p> 
<p id="2%E3%80%81Fork%E9%A1%B9%E7%9B%AE-toc" style="margin-left:80px;"><a href="#2%E3%80%81Fork%E9%A1%B9%E7%9B%AE" rel="nofollow">2、Fork项目</a></p> 
<p id="3%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E6%96%87%E4%BB%B6" rel="nofollow">3、修改【.env.template】文件</a></p> 
<p id="4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E4%B8%BA%E3%80%90.env%E3%80%91%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E4%B8%BA%E3%80%90.env%E3%80%91%E6%96%87%E4%BB%B6" rel="nofollow">4、修改【.env.template】为【.env】文件</a></p> 
<p id="%E5%85%AD%E3%80%81%E8%BF%90%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2-toc" style="margin-left:40px;"><a href="#%E5%85%AD%E3%80%81%E8%BF%90%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2" rel="nofollow">六、运行可视化操作页面</a></p> 
<p id="1%E3%80%81%E6%96%B0%E5%BB%BA%E7%BB%88%E7%AB%AF-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%96%B0%E5%BB%BA%E7%BB%88%E7%AB%AF" rel="nofollow">1、新建终端</a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91-toc" style="margin-left:80px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91" rel="nofollow">​编辑</a></p> 
<p id="2%E3%80%81%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1" rel="nofollow">2、运行服务</a></p> 
<p id="3%E3%80%81%E9%80%89%E6%8B%A9%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E9%80%89%E6%8B%A9%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F" rel="nofollow">3、选择打开方式</a></p> 
<p id="ChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93%E3%80%81-toc" style="margin-left:40px;"><a href="#ChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93%E3%80%81" rel="nofollow">ChatGL M26BAI模型总结、</a></p> 
<p id="Pytorch2.0%20AI%E6%A1%86%E6%9E%B6%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86-toc" style="margin-left:0px;"><a href="#Pytorch2.0%20AI%E6%A1%86%E6%9E%B6%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86" rel="nofollow">Pytorch2.0 AI框架视频处理</a></p> 
<p id="%E4%B8%80%E3%80%81%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9" rel="nofollow">一、框架选择</a></p> 
<p id="%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B" rel="nofollow">二、使用 JupyterLab 体验完整的机器学习工作流程</a></p> 
<p id="1%E3%80%81Terminal%E6%93%8D%E4%BD%9C-toc" style="margin-left:80px;"><a href="#1%E3%80%81Terminal%E6%93%8D%E4%BD%9C" rel="nofollow">1、Terminal操作</a></p> 
<p id="2%E3%80%81%E6%89%93%E5%BC%80root%2Fdataset-fashion-mnist%2Fdata%2Ffashion%E6%96%87%E4%BB%B6%E5%A4%B9-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E6%89%93%E5%BC%80root%2Fdataset-fashion-mnist%2Fdata%2Ffashion%E6%96%87%E4%BB%B6%E5%A4%B9" rel="nofollow">2、打开root/dataset-fashion-mnist/data/fashion文件夹</a></p> 
<p id="3%E3%80%81%E5%88%9B%E5%BB%BA%E3%80%90Notebook%E3%80%91-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E3%80%90Notebook%E3%80%91" rel="nofollow">3、创建【Notebook】</a></p> 
<p id="4%E3%80%81%E8%BF%90%E8%A1%8C%E6%96%B9%E6%B3%95-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E8%BF%90%E8%A1%8C%E6%96%B9%E6%B3%95" rel="nofollow">4、运行方法</a></p> 
<p id="5%E3%80%81%E4%BF%AE%E6%94%B9pip%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E4%BF%AE%E6%94%B9pip%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" rel="nofollow">5、修改pip环境配置</a></p> 
<p id="6%E3%80%81%E5%88%9B%E5%BB%BATerminal%E6%8C%81%E7%BB%AD%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%C2%A0-toc" style="margin-left:80px;"><a href="#6%E3%80%81%E5%88%9B%E5%BB%BATerminal%E6%8C%81%E7%BB%AD%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%C2%A0" rel="nofollow">6、创建Terminal持续运行以下代码 </a></p> 
<p id="7%E3%80%81%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B-toc" style="margin-left:80px;"><a href="#7%E3%80%81%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B" rel="nofollow">7、保存模型</a></p> 
<p id="8%E3%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%B9%B6%E9%A2%84%E6%B5%8B-toc" style="margin-left:80px;"><a href="#8%E3%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%B9%B6%E9%A2%84%E6%B5%8B" rel="nofollow">8、加载模型并预测</a></p> 
<p id="9%E3%80%81%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B-toc" style="margin-left:80px;"><a href="#9%E3%80%81%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B" rel="nofollow">9、预测模型</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E7%BA%A7%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C(RNN)%20%E7%94%9F%E6%88%90%E5%A7%93%E5%90%8D-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E7%BA%A7%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%28RNN%29%20%E7%94%9F%E6%88%90%E5%A7%93%E5%90%8D" rel="nofollow">三、使用 JupyterLab 体验使用字符级循环神经网络(RNN) 生成姓名</a></p> 
<p id="1%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87" rel="nofollow">1、数据准备</a></p> 
<p id="2%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%C2%A0Notebook%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E9%80%89%E6%8B%A9%C2%A0Python%203-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%C2%A0Notebook%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E9%80%89%E6%8B%A9%C2%A0Python%203" rel="nofollow">2、新建一个 Notebook 页面，选择 Python 3</a></p> 
<p id="3%E3%80%81%E7%AC%AC%E5%85%AB%E6%AD%A5%E9%AA%A4%E7%9A%84%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E7%AC%AC%E5%85%AB%E6%AD%A5%E9%AA%A4%E7%9A%84%E4%BB%A3%E7%A0%81" rel="nofollow">3、第八步骤的代码</a></p> 
<p id="4%E3%80%81%E7%BB%98%E5%88%B6%E6%8D%9F%E5%A4%B1-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E7%BB%98%E5%88%B6%E6%8D%9F%E5%A4%B1" rel="nofollow">4、绘制损失</a></p> 
<p id="5%E3%80%81%E7%BD%91%E7%BB%9C%E9%87%87%E6%A0%B7-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E7%BD%91%E7%BB%9C%E9%87%87%E6%A0%B7" rel="nofollow">5、网络采样</a></p> 
<p id="%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E8%A7%86%E9%A2%91%E6%8A%A0%E5%83%8F%E7%A5%9E%E5%99%A8RobustVideoMatting-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E8%A7%86%E9%A2%91%E6%8A%A0%E5%83%8F%E7%A5%9E%E5%99%A8RobustVideoMatting" rel="nofollow">四、使用 JupyterLab 体验视频抠像神器RobustVideoMatting</a></p> 
<p id="1%E3%80%81%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85" rel="nofollow">1、依赖安装</a></p> 
<p id="2%E3%80%81%E4%B8%8B%E8%BD%BD%E5%AE%9E%E9%AA%8C%E8%B5%84%E6%BA%90-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E4%B8%8B%E8%BD%BD%E5%AE%9E%E9%AA%8C%E8%B5%84%E6%BA%90" rel="nofollow">2、下载实验资源</a></p> 
<p id="%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C-toc" style="margin-left:80px;"><a href="#%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C" rel="nofollow"> 3、运行</a></p> 
<p id="4%E3%80%81%E6%8A%A0%E5%9B%BE%E6%95%88%E6%9E%9C-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E6%8A%A0%E5%9B%BE%E6%95%88%E6%9E%9C" rel="nofollow">4、抠图效果</a></p> 
<p id="5%E3%80%81%E6%8D%A2%E8%83%8C%E6%99%AF%E6%95%88%E6%9E%9C-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E6%8D%A2%E8%83%8C%E6%99%AF%E6%95%88%E6%9E%9C" rel="nofollow">5、换背景效果</a></p> 
<p id="Pytorch2.0%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#Pytorch2.0%E6%80%BB%E7%BB%93" rel="nofollow">Pytorch2.0总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p> </p> 
<h2 id="%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAStable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8E%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87">自行搭建Stable Diffusion模型服务用于生成AI图片</h2> 
<h3 id="%E4%B8%80%E3%80%81%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA">一、服务创建</h3> 
<h4 id="1%E3%80%81%E6%9C%8D%E5%8A%A1%E5%9C%B0%E5%9D%80%EF%BC%9A">1、服务地址：</h4> 
<p><a href="https://cloud.tencent.com/act/pro/hai" rel="nofollow" title="高性能应用服务HAI 新品内测">高性能应用服务HAI 新品内测</a></p> 
<p><img alt="" height="519" src="https://images2.imgbox.com/a8/c6/ssK9uRp2_o.png" width="824"></p> 
<h4 id="2%E3%80%81%E7%AD%89%E5%BE%85%E5%AE%A1%E6%A0%B8(%E5%A4%A7%E6%A6%8224%E5%B0%8F%E6%97%B6)">2、等待审核(大概24小时)</h4> 
<p><img alt="" height="1030" src="https://images2.imgbox.com/3e/3e/ozJh5i8R_o.png" width="1200"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1">二、创建服务</h3> 
<h4 id="1%E3%80%81%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1">1、新建服务</h4> 
<p><img alt="" height="949" src="https://images2.imgbox.com/a7/d0/esKXtnfC_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E9%80%89%E6%8B%A9AI%E6%A8%A1%E5%9E%8B%EF%BC%9AStable%20Diffusion">2、选择AI模型：Stable Diffusion</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/51/16/mjItJCYz_o.png" width="1200"></p> 
<p>高性能，效率更快。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7a/09/skWxS2Dw_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E7%AD%89%E5%BE%85%E5%88%9B%E5%BB%BA(5~8%E5%88%86%E9%92%9F%EF%BC%89">3、等待创建(5~8分钟）</h4> 
<p>这里可以看到温馨提示，创建中不计费的。</p> 
<p><img alt="" height="670" src="https://images2.imgbox.com/24/56/oyKWUDsB_o.png" width="1010"></p> 
<p>创建完成效果：</p> 
<p><img alt="" height="544" src="https://images2.imgbox.com/0d/af/X6ZLgoW8_o.png" width="1021"></p> 
<h3 id="%E4%B8%89%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D">三、操作面板介绍</h3> 
<p><img alt="" height="697" src="https://images2.imgbox.com/df/fb/zaP8J2LL_o.png" width="1200"></p> 
<h4 id="1%E3%80%81webui%E6%93%8D%E4%BD%9C">1、webui操作</h4> 
<p>都是鼠标点击操作，方便。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e3/1f/wlGTxIW2_o.png" width="1200"></p> 
<h4 id="2%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C">2、jupyter_lab操作</h4> 
<p>命令行操作，有一定难度，但是按照步骤可以一步步搞定哦。自己配置接口，多舒服。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fe/61/BQPTEzyZ_o.png" width="1200"></p> 
<h3 id="%E5%9B%9B%E3%80%81webui%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4">四、webui操作步骤</h3> 
<h4 id="1%E3%80%81%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85">1、中文插件安装</h4> 
<blockquote> 
 <p>步骤1、选择Extensions、</p> 
 <p>步骤2、选择Available、</p> 
 <p>步骤3、按照图示选择</p> 
 <p>步骤4、搜索zh_CH</p> 
 <p>步骤5、点击【Load from】进行搜索</p> 
</blockquote> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ad/77/znPmuvXd_o.png" width="1200"></p> 
<p>搜索效果</p> 
<p><img alt="" height="1060" src="https://images2.imgbox.com/50/46/JCYAFx1d_o.png" width="1200"></p> 
<p>搜索【zh_CN】找到后，点击【install】进行安装。</p> 
<p><img alt="" height="808" src="https://images2.imgbox.com/32/8d/cmpiFTsA_o.png" width="1200"></p> 
<p>安装完毕效果</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/21/b7/z2b2mGIL_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%AD%E6%96%87%E6%8F%92%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4">2、配置中文插件操作步骤</h4> 
<p>按照下图操作，其中步骤3是在没有看到zh_CN的情况下刷新一下。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/8a/ed/ke9WSO2Z_o.png" width="1200"></p> 
<h4 id="3%E3%80%81Reload%20UI%E5%90%8E%E6%95%88%E6%9E%9C">3、Reload UI后效果</h4> 
<p>刷新后能看到中文的显示状态。刚才我们在扩展中安装了中文的插件，在设置中配置了中文插件。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/7c/a5/xSfzLjrQ_o.png" width="1200"></p> 
<p>页面说明，这个图给的描述很详细。</p> 
<p><img alt="" height="1185" src="https://images2.imgbox.com/aa/93/Bn6KVrWr_o.png" width="1200"></p> 
<p>数据示例：</p> 
<table><thead><tr><th>参数名</th><th>描述</th><th>值</th></tr></thead><tbody><tr><td>提示词</td><td>主要描述图像，包括内容风格等信息，原始的webui会对这个地方有字数的限制，可以安装一些插件突破字数的限制</td><td>a pretty cat,cyberpunk art，kerem beyit，very cute robot zen,Playful,Independent，beeple</td></tr><tr><td>反向提示词</td><td>为了提供给模型，我们不需要的风格</td><td>(deformed，distorted，disfigured:1.0)，poorly drawn，bad anatomy，wrong anatomy，extra limb，missing limb，floating limbs，(mutated hands and fingers:1.5)，disconnected limbs，mutation，mutated，ugly，disgusting，blurry，amputation，flowers，human，man，woman</td></tr><tr><td>提示词相关性（CFG scale）</td><td>分类器自由引导尺度——图像与提示符的一致程度——越低的值产生的结果越有创意，数值越大成图越贴近描述文本。一般设置为7</td><td>7</td></tr><tr><td>采样方法（Sampling method）</td><td>采样模式，即扩散算法的去噪声采样模式会影响其效果，不同的采样模式的结果会有很大差异，一般是默认选择euler，具体效果我也在逐步尝试中。</td><td>Euler a</td></tr><tr><td>采样迭代步数（Sampling steps）</td><td>在使用扩散模型生成图片时所进行的迭代步骤。每经过一次迭代，AI就有更多的机会去比对prompt和当前结果，并作出相应的调整。需要注意的是，更高的迭代步数会消耗更多的计算时间和成本，但并不意味着一定会得到更好的结果。然而，如果迭代步数过少，一般不少于50，则图像质量肯定会下降</td><td>80</td></tr><tr><td>随机种子（Seed）</td><td>随机数种子，生成每张图片时的随机种子，这个种子是用来作为确定扩散初始状态的基础。不懂的话，用随机的即可</td><td>127361827368</td></tr></tbody></table> 
<p>随机种子也可以自己添加，下面的实验我用-1和 </p> 
<p>实验效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/6d/36/6JJoYfOd_o.png" width="1200"></p> 
<p> 随机种子实验效果</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d5/d2/2juQkiX3_o.png" width="1200"></p> 
<h3 id="%E4%BA%94%E3%80%81stable%20Diffusion%E2%80%94%E2%80%94AI%E7%BB%98%E5%9B%BE%E6%8A%80%E5%B7%A7(%E7%89%B9%E8%89%B2%E5%8A%9F%E8%83%BD)"><span style="color:#fe2c24;"><strong>五、</strong>stable Diffusion——<strong>AI绘图技巧(特色功能)</strong></span></h3> 
<p>在stable Diffusion中会有正向提示词&amp;反向提示词，这个是很独特的一个功能，这里深入的测试一下。</p> 
<blockquote> 
 <p>提示词（prompt）由多个词缀构成，分为正向提示词（positive prompt）和反向提示词（negative prompt），用来告诉AI哪些需要，哪些不需要。</p> 
 <p>注：词缀的权重默认值都是1，从左到右依次减弱，权重会影响画面生成结果。 比如景色Tag在前，人物就会小，相反的人物会变大或半身。 选择正确的顺序、语法来使用提示词，将更好、更快、更有效率地展现所想所愿的画面。</p> 
 <p>逗号(,)：分割词缀，有一定权重排序功能，逗号前权重高，逗号后权重低，因而建议排序：<br> 综述（图像质量+画风+镜头效果+光照效果+主题+构图）<br> 主体（人物&amp;对象+姿势+服装+道具）<br> 细节（场景+环境+饰品+特征）</p> 
</blockquote> 
<p>权重示例：</p> 
<blockquote> 
 <p>冒号(:)：自定义权重数值 格式：左圆括号 + 词缀 + 冒号 + 数字 + 右圆括号<br> 单人女孩词缀，权重为0.75 (1girl:0.75)</p> 
 <p>()仅圆括号：增加权重0.1 大部分情况用圆括号即可。<br> 权重乘以1.1 (1girl)</p> 
 <p>{}花括号：增加权重0.05<br> 权重乘以1.05 {1girl}</p> 
 <p>[] 方括号：减少权重0.1，也有说是减弱0.05的 方括号中无法自定义权重数值，自定义权重只能使用(x:0.5)形式。<br> 权重除以1.1 [1girl]</p> 
 <p>(())、{<!-- -->{}}、[[]]复用括号：叠加权重<br> 权重乘以1.1*1.1，即权重为1.21 ((1girl))</p> 
</blockquote> 
<p>提示词：</p> 
<pre><code>hanfu,tang style outfits,pink upper shan, blue chest po skirt, purple with white waistband, light green pibo, 1girl, blue eyes, gray hair, dusk, over  the  sea, HDR,UHD,8K, best quality, masterpiece, Highly detailed, Studio lighting, ultra-fine painting, sharp focus, physically-based rendering, extreme detail description, Professional, Vivid Colors, close-up view</code></pre> 
<p>反向(负面)提示词：</p> 
<pre><code>nsfw,logo,text,badhandv4,EasyNegative,ng_deepnegative_v1_75t,rev2-badprompt,verybadimagenegative_v1.3,negative_hand-neg,mutated hands and fingers,poorly drawn face,extra limb,missing limb,disconnected limbs,malformed hands,ugly </code></pre> 
<p><img alt="" height="974" src="https://images2.imgbox.com/bd/0e/2cxm6EUL_o.png" width="1200"></p> 
<p>可以直接生成，效果还是不错的，就是时间较长，这里建议使用高一些配置的服务，能快一些。</p> 
<p>提示词我们还可以加以修饰一下效果会更好。</p> 
<pre><code>1girl, aqua  eyes, lipstick, brown hair, asymmetrical bangs, light smile, in  summer, bamboo  forest, flower  sea, HDR,UHD,8K, best quality, masterpiece, Highly detailed, ultra-fine painting, sharp focus, physically-based rendering, extreme detail description, Professional, Vivid Colors, close-up view, looking at viewer, hanfu, tang style outfits,&lt;lora:hanfuTang_v32:0.5&gt;, red upper shan, blue chest po skirt, orange waistband, light green pibo</code></pre> 
<p>我生成了几张图片，这是使用的词语</p> 
<pre><code>a young female holding a sign that says “I Love CSDN”, highlights in hair, sitting outside restaurant, brown eyes, wearing a dress, side light,[the: (painting cartoon:1.9): 0.3]</code></pre> 
<p>反向词语</p> 
<pre><code>painting, cartoon</code></pre> 
<p>我生成了6张，可以看看。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/12/d4/QHXd8CuB_o.jpg"></p> 
<p><img alt="" src="https://images2.imgbox.com/f1/af/wlwwfhn1_o.jpg"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cd/b3/3TswHOG9_o.jpg"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/3b/3b/NvG4LRB0_o.jpg"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/37/34/aACMM06V_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e8/41/SVBcyEB7_o.jpg"></p> 
<h3 id="%E5%85%AD%E3%80%81jupyter_lab%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4">六、jupyter_lab操作步骤</h3> 
<h4 id="%C2%A01%E3%80%81%E8%BF%9B%E5%85%A5jupyter_lab%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2"> 1、进入jupyter_lab操作页面</h4> 
<p><img alt="" height="735" src="https://images2.imgbox.com/b0/93/YsDmdDTG_o.png" width="1092"></p> 
<p>操作页面效果</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/df/8c/Jy8YCQCq_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E9%9D%A2%E6%9D%BF%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D">2、面板功能介绍</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/71/60/0CvSKBzv_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">3、启动服务</h4> 
<p>命令如下，直接复制并【ctrl+v】即可</p> 
<pre><code class="language-bash">cd /root/stable-diffusion-webui
python launch.py --nowebui --xformers --opt-split-attention  --listen --port 7862</code></pre> 
<p>命令参数描述：</p> 
<table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>--nowebui</td><td>以 API 模式启动</td></tr><tr><td>--xformers</td><td>使用xformers库。极大地改善了内存消耗和速度。</td></tr><tr><td>--opt-split-attention</td><td>Cross attention layer optimization 优化显着减少了内存使用，几乎没有成本（一些报告改进了性能）。黑魔法。默认情况下torch.cuda，包括 NVidia 和 AMD 卡。</td></tr><tr><td><strong>--listen</strong></td><td><strong>默认启动绑定的 ip 是 127.0.0.1，只能是你自己电脑可以访问 webui，如果你想让同个局域网的人都可以访问的话，可以配置该参数（会自动绑定 0.0.0.0 ip）。</strong></td></tr><tr><td>--port</td><td>默认端口是 7860，如果想换个端口，可以配置该参数，例如：--port 7862</td></tr><tr><td>--gradio-auth username:password</td><td>如果你希望给 webui 设置登录密码，可以配置该参数，例如：--gradio-auth GitLqr:123456。</td></tr></tbody></table> 
<p>本地启动效果(不支持公网访问，可以看到是127.0.0.1:7862)</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a3/ac/Ae7loVnU_o.png" width="1200"></p> 
<p>启动效果(支持公网访问，可以看到是0.0.0.0:7862)</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e2/b5/ft2KCiaQ_o.png" width="1200"></p> 
<h4 id="4%E3%80%81%E6%B7%BB%E5%8A%A07862%E7%AB%AF%E5%8F%A3%E8%A7%84%E5%88%99">4、添加7862端口规则</h4> 
<p>操作1、进入模型操作面板</p> 
<p><img alt="" height="832" src="https://images2.imgbox.com/df/3b/9wnCH4e5_o.png" width="1200"></p> 
<p>添加7862端口号码</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bb/94/Mh2fB8Ss_o.png" width="1200"></p> 
<p>添加端口操作</p> 
<p><img alt="" height="1036" src="https://images2.imgbox.com/cc/b4/lH5UPp3O_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E8%AE%BF%E9%97%AEswagger%E6%8E%A5%E5%8F%A3">3、访问swagger接口</h4> 
<p>访问地址：ip:7862端口</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/86/22/r2xLcLSy_o.png" width="1200"></p> 
<h3 id="%E4%B8%83%E3%80%81python%E6%8E%A5%E5%8F%A3%E8%A7%A3%E6%9E%90%E7%94%9F%E6%88%90AI%E5%9B%BE%E7%89%87">七、python接口解析生成AI图片</h3> 
<h4 id="1%E3%80%81%E6%89%93%E5%BC%80python%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7">1、打开python开发工具</h4> 
<p>我们使用的是【PyCharm Community Edition 2023.1.4】版本。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/18/2b/ExcNJxki_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E5%88%9B%E5%BB%BApy%E6%96%87%E4%BB%B6%E5%B9%B6%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81">2、创建py文件并输入以下代码</h4> 
<p>注：这里一定要修改服务的IP，也就是公网的那个IP</p> 
<pre><code class="language-python">
import json
import base64
import requests

your_ip = '0.0.0.0' # HAI服务器IP地址
your_port = 7862  # SD api 监听的端口

def submit_post(url: str,data: dict):
  """
  Submit a POST request to the given URL with the given data.
  """
  return requests.post(url,data=json.dumps(data))

def save_encoded_image(b64_image: str,output_path: str):
  """
  Save the given image to the given output path.
  """
  with open(output_path,"wb") as image_file:
      image_file.write(base64.b64decode(b64_image))

if __name__ == '__main__':
  # /sdapi/v1/txt2img
  txt2img_url = f'http://{your_ip}:{your_port}/sdapi/v1/txt2img'
  data = {
     'prompt': 'a pretty cat,cyberpunk art,kerem beyit,very cute robot zen,Playful,Independent,beeple |',
     'negative_prompt':'(deformed,distorted,disfigured:1.0),poorly drawn,bad anatomy,wrong anatomy,extra limb,missing limb,floating limbs,(mutated hands and fingers:1.5),disconnected limbs,mutation,mutated,ugly,disgusting,blurry,amputation,flowers,human,man,woman',
     'Steps':50,
     'Seed':127361827368
  }
  response = submit_post(txt2img_url,data)
  save_encoded_image(response.json()['images'][0],'cat.png')

</code></pre> 
<p>参数说明</p> 
<table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>prompt</td><td>提示词</td></tr><tr><td>negative_prompt</td><td>反向提示词</td></tr><tr><td>seed</td><td>种子，随机数</td></tr><tr><td>batch_size</td><td>每次张数</td></tr><tr><td>n_iter</td><td>生成批次</td></tr><tr><td>steps</td><td>生成步数</td></tr><tr><td>cfg_scale</td><td>关键词相关性</td></tr><tr><td>width</td><td>宽度</td></tr><tr><td>height</td><td>高度</td></tr><tr><td>restore_faces</td><td>脸部修复</td></tr><tr><td>tiling</td><td>可平铺</td></tr><tr><td>sampler_index</td><td>采样方法</td></tr></tbody></table> 
<h4 id="%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C"> 3、运行效果</h4> 
<p>可以看到生成的图片就在对应的文件夹内，我们还可以改很多参数。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/2a/c7/qQbtcxam_o.png" width="1200"></p> 
<h3 id="Stable%20Diffusion%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93">Stable Diffusion模型总结</h3> 
<p>图片生成，还是用处非常多的，而且价格也比较划算，使用和配置都很方便，效率也好高，可以自己搭建尝试一下，很棒的。</p> 
<hr> 
<h2 id="%E8%87%AA%E8%A1%8C%E6%90%AD%E5%BB%BAChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%9C%8D%E5%8A%A1%E7%94%A8%E4%BA%8EAI%E5%AF%B9%E8%AF%9D">自行搭建ChatGL M26BAI模型服务用于AI对话</h2> 
<p>单独访问效果： </p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/9d/a2/9LYHN025_o.png" width="1200"></p> 
<p>vscode内运行效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/97/a1/ejDbUlt8_o.png" width="1200"></p> 
<p>我们使用腾讯云来创建，有完整的操作流程，很方便我们搭建使用。</p> 
<h3>一、服务创建</h3> 
<p>创建效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/38/fc/180T2gVT_o.png" width="1200"></p> 
<h4 id="%E6%96%B0%E5%BB%BA%E6%9C%8D%E5%8A%A1">新建服务</h4> 
<p><img alt="" height="714" src="https://images2.imgbox.com/22/06/MaINuHKk_o.png" width="1200"></p> 
<h4 id="%E6%9C%8D%E5%8A%A1%E9%80%89%E6%8B%A9%EF%BC%9A(%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E4%B8%8B%E6%8B%89%E9%80%89%E6%8B%A9%E5%A4%A7%E4%B8%80%E4%BA%9B%E7%9A%84%E7%A1%AC%E7%9B%98)">服务选择：(这里可以下拉选择大一些的硬盘)</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5b/ec/v2FJyrvv_o.png" width="1200"></p> 
<p><img alt="" height="737" src="https://images2.imgbox.com/c1/2e/1qn5xxsL_o.png" width="1200"></p> 
<p>剩余的时间需要等待。</p> 
<p>创建完毕效果：</p> 
<p><img alt="" height="605" src="https://images2.imgbox.com/50/1f/ysLQ8YWK_o.png" width="941"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E6%93%8D%E4%BD%9C%E9%9D%A2%E6%9D%BF%E4%BB%8B%E7%BB%8D">二、操作面板介绍</h3> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/85/1e/bSV2CmqX_o.png" width="1200"></p> 
<h4 id="1%E3%80%81chatglm_gradio%3A">1、chatglm_gradio:</h4> 
<p>我们可以直接通过这个网址进行对话操作。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e1/47/p58ndlMX_o.png" width="1200"></p> 
<h4 id="2%E3%80%81jupyter_lab%3A">2、jupyter_lab:</h4> 
<p>创建控制台窗口，可以在这里进行具体的代码编辑与运行。</p> 
<p><img alt="" height="863" src="https://images2.imgbox.com/b9/49/YYRXNJJT_o.png" width="1200"></p> 
<h3 id="%E4%B8%89%E3%80%81%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E7%A4%BA%E4%BE%8B(jupyter_lab%E6%93%8D%E4%BD%9C)">三、基础服务示例(jupyter_lab操作)</h3> 
<h4 id="1%E3%80%81%E8%BF%9B%E5%85%A5%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1">1、进入并启动服务</h4> 
<pre><code>cd /root/ChatGLM2-6B/
python api.py
</code></pre> 
<p>运行起来能看到有信息提示。 </p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/14/59/TWS64mpl_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E5%90%AF%E5%8A%A8%E5%90%8E%E5%BC%80%E5%90%AF%E8%AE%BF%E9%97%AE%E7%AB%AF%E5%8F%A3(8000)">2、启动后开启访问端口(8000)</h4> 
<p>进入到服务详情。</p> 
<p><img alt="" height="1041" src="https://images2.imgbox.com/67/a6/4UM3BrX5_o.png" width="1200"></p> 
<p>添加防火墙可通过的端口号。 </p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f3/34/nVei764U_o.png" width="1200"></p> 
<p>添加效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/db/9b/rjNcNUZW_o.png" width="1200"></p> 
<h4 id="3%E3%80%81Python%E6%8E%A5%E5%8F%A3%E8%AE%BF%E9%97%AE%E6%95%88%E6%9E%9C">3、Python接口访问效果</h4> 
<p>添加后即可访问：<a href="http://xn--ip-0p3cr1ft42fjbl:8000/" rel="nofollow" title="http://你的公网IP:8000/">http://你的公网IP:8000/</a> 的这个接口，具体服务参数如下列代码：</p> 
<pre><code class="language-python">import requests

# 定义测试数据，以及FastAPI服务器的地址和端口
server_url = "http://0.0.0.0:8000"  # 请确保将地址和端口更改为您的API服务器的实际地址和端口
test_data = {
    "prompt": "'电影雨人讲的是什么？'",
    "history": [],
    "max_length": 50,
    "top_p": 0.7,
    "temperature": 0.95
}

# 发送HTTP POST请求
response = requests.post(server_url, json=test_data)

# 处理响应
if response.status_code == 200:
    result = response.json()
    print("Response:", result["response"])
    print("History:", result["history"])
    print("Status:", result["status"])
    print("Time:", result["time"])
else:
    print("Failed to get a valid response. Status code:", response.status_code)

</code></pre> 
<p>访问效果：</p> 
<p><img alt="" height="913" src="https://images2.imgbox.com/4d/bf/JrLALIoF_o.png" width="1200"></p> 
<h3 id="%E5%9B%9B%E3%80%81%E6%AD%A3%E5%BC%8F%E6%9C%8D%E5%8A%A1%E4%BB%A3%E7%A0%81">四、正式服务代码</h3> 
<h4 id="1%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6">1、修改【openai<strong>-api.py</strong>】文件</h4> 
<p>使用以下代码覆盖原有的代码：</p> 
<pre><code class="language-python"># coding=utf-8
# Implements API for ChatGLM2-6B in OpenAI's format. (https://platform.openai.com/docs/api-reference/chat)
# Usage: python openai_api.py
# Visit http://localhost:8000/docs for documents.

import time
import torch
import uvicorn
from pydantic import BaseModel, Field
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from contextlib import asynccontextmanager
from typing import Any, Dict, List, Literal, Optional, Union
from transformers import AutoTokenizer, AutoModel
from sse_starlette.sse import ServerSentEvent, EventSourceResponse


@asynccontextmanager
async def lifespan(app: FastAPI): # collects GPU memory
    yield
    if torch.cuda.is_available():
        torch.cuda.empty_cache()
        torch.cuda.ipc_collect()


app = FastAPI(lifespan=lifespan)

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

class ModelCard(BaseModel):
    id: str
    object: str = "model"
    created: int = Field(default_factory=lambda: int(time.time()))
    owned_by: str = "owner"
    root: Optional[str] = None
    parent: Optional[str] = None
    permission: Optional[list] = None


class ModelList(BaseModel):
    object: str = "list"
    data: List[ModelCard] = []


class ChatMessage(BaseModel):
    role: Literal["user", "assistant", "system"]
    content: str


class DeltaMessage(BaseModel):
    role: Optional[Literal["user", "assistant", "system"]] = None
    content: Optional[str] = None


class ChatCompletionRequest(BaseModel):
    model: str
    messages: List[ChatMessage]
    temperature: Optional[float] = None
    top_p: Optional[float] = None
    max_length: Optional[int] = None
    stream: Optional[bool] = False


class ChatCompletionResponseChoice(BaseModel):
    index: int
    message: ChatMessage
    finish_reason: Literal["stop", "length"]


class ChatCompletionResponseStreamChoice(BaseModel):
    index: int
    delta: DeltaMessage
    finish_reason: Optional[Literal["stop", "length"]]


class ChatCompletionResponse(BaseModel):
    model: str
    object: Literal["chat.completion", "chat.completion.chunk"]
    choices: List[Union[ChatCompletionResponseChoice, ChatCompletionResponseStreamChoice]]
    created: Optional[int] = Field(default_factory=lambda: int(time.time()))


@app.get("/v1/models", response_model=ModelList)
async def list_models():
    global model_args
    model_card = ModelCard(id="gpt-3.5-turbo")
    return ModelList(data=[model_card])


@app.post("/v1/chat/completions", response_model=ChatCompletionResponse)
async def create_chat_completion(request: ChatCompletionRequest):
    global model, tokenizer

    if request.messages[-1].role != "user":
        raise HTTPException(status_code=400, detail="Invalid request")
    query = request.messages[-1].content

    prev_messages = request.messages[:-1]
    if len(prev_messages) &gt; 0 and prev_messages[0].role == "system":
        query = prev_messages.pop(0).content + query

    history = []
    if len(prev_messages) % 2 == 0:
        for i in range(0, len(prev_messages), 2):
            if prev_messages[i].role == "user" and prev_messages[i+1].role == "assistant":
                history.append([prev_messages[i].content, prev_messages[i+1].content])

    if request.stream:
        generate = predict(query, history, request.model)
        return EventSourceResponse(generate, media_type="text/event-stream")

    response, _ = model.chat(tokenizer, query, history=history)
    choice_data = ChatCompletionResponseChoice(
        index=0,
        message=ChatMessage(role="assistant", content=response),
        finish_reason="stop"
    )

    return ChatCompletionResponse(model=request.model, choices=[choice_data], object="chat.completion")


async def predict(query: str, history: List[List[str]], model_id: str):
    global model, tokenizer

    choice_data = ChatCompletionResponseStreamChoice(
        index=0,
        delta=DeltaMessage(role="assistant"),
        finish_reason=None
    )
    chunk = ChatCompletionResponse(model=model_id, choices=[choice_data], object="chat.completion.chunk")
    #yield "{}".format(chunk.json(exclude_unset=True, ensure_ascii=False))
    yield "{}".format(chunk.model_dump_json(exclude_unset=True))

    current_length = 0

    for new_response, _ in model.stream_chat(tokenizer, query, history):
        if len(new_response) == current_length:
            continue

        new_text = new_response[current_length:]
        current_length = len(new_response)

        choice_data = ChatCompletionResponseStreamChoice(
            index=0,
            delta=DeltaMessage(content=new_text),
            finish_reason=None
        )
        chunk = ChatCompletionResponse(model=model_id, choices=[choice_data], object="chat.completion.chunk")
        #yield "{}".format(chunk.json(exclude_unset=True, ensure_ascii=False))
        yield "{}".format(chunk.model_dump_json(exclude_unset=True))

    choice_data = ChatCompletionResponseStreamChoice(
        index=0,
        delta=DeltaMessage(),
        finish_reason="stop"
    )
    chunk = ChatCompletionResponse(model=model_id, choices=[choice_data], object="chat.completion.chunk")
    #yield "{}".format(chunk.json(exclude_unset=True, ensure_ascii=False))
    yield "{}".format(chunk.model_dump_json(exclude_unset=True))
    yield '[DONE]'



if __name__ == "__main__":
    tokenizer = AutoTokenizer.from_pretrained("THUDM/chatglm2-6b", revision="v1.0", trust_remote_code=True)
    model = AutoModel.from_pretrained("THUDM/chatglm2-6b", revision="v1.0", trust_remote_code=True).cuda()
    # 多显卡支持，使用下面两行代替上面一行，将num_gpus改为你实际的显卡数量
    # from utils import load_model_on_gpus
    # model = load_model_on_gpus("THUDM/chatglm2-6b", num_gpus=2)
    model.eval()

    uvicorn.run(app, host='0.0.0.0', port=8000, workers=1)

</code></pre> 
<p></p> 
<h4 id="%C2%A02%E3%80%81%E8%BF%90%E8%A1%8C%E3%80%90openai-api.py%E3%80%91%E6%96%87%E4%BB%B6%EF%BC%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1"> 2、运行【<strong>openai-api.py</strong>】文件，服务端开启服务</h4> 
<p>在控制台直接输入python openai-api.py即可运行</p> 
<p><img alt="" height="358" src="https://images2.imgbox.com/27/0e/Ouwx8LOe_o.png" width="1200"></p> 
<h3 id="%E4%BA%94%E3%80%81%E5%8F%AF%E8%A7%86%E5%8C%96%E9%A1%B5%E9%9D%A2%E6%90%AD%E5%BB%BA">五、可视化页面搭建</h3> 
<h4 id="1%E3%80%81%E5%9C%A8%E5%88%9B%E5%BB%BAcloud%20Studio%E7%9A%84%E6%97%B6%E5%80%99%E9%80%89%E6%8B%A9%E3%80%90%E5%BA%94%E7%94%A8%E6%8E%A8%E8%8D%90%E3%80%91">1、在创建cloud Studio的时候选择【应用推荐】</h4> 
<p>选择【ChatGPT Next Web】</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ff/c4/e3968lNY_o.png" width="1200"></p> 
<h4 id="2%E3%80%81Fork%E9%A1%B9%E7%9B%AE">2、Fork项目</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5b/37/gdWZngwR_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E6%96%87%E4%BB%B6">3、修改【<strong>.env.template</strong>】文件</h4> 
<p><img alt="" height="453" src="https://images2.imgbox.com/bb/55/x0jZfplN_o.png" width="548"></p> 
<p>直接替换我下面的就行，但是需要替换一下你服务的IP。</p> 
<pre><code class="language-python">
# Your openai api key. (required)
OPENAI_API_KEY="hongMuXiangXun"

# Access passsword, separated by comma. (optional)
CODE=

# You can start service behind a proxy
PROXY_URL=http://你的IP:8000

# Override openai api request base url. (optional)
# Default: https://api.openai.com
# Examples: http://your-openai-proxy.com
BASE_URL=http://你的IP:8000

# Specify OpenAI organization ID.(optional)
# Default: Empty
OPENAI_ORG_ID=

# (optional)
# Default: Empty
# If you do not want users to input their own API key, set this value to 1.
HIDE_USER_API_KEY=

# (optional)
# Default: Empty
# If you do not want users to use GPT-4, set this value to 1.
DISABLE_GPT4=

# (optional)
# Default: Empty
# If you do not want users to query balance, set this value to 1.
HIDE_BALANCE_QUERY=
</code></pre> 
<h4 id="4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%90.env.template%E3%80%91%E4%B8%BA%E3%80%90.env%E3%80%91%E6%96%87%E4%BB%B6">4、修改【<strong>.env.template</strong>】为【<strong>.env</strong>】文件</h4> 
<p>鼠标右键，重命名即可。</p> 
<p><img alt="" height="1091" src="https://images2.imgbox.com/2b/42/tbNesZAB_o.png" width="1200"></p> 
<h3 id="%E5%85%AD%E3%80%81%E8%BF%90%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E6%93%8D%E4%BD%9C%E9%A1%B5%E9%9D%A2">六、运行可视化操作页面</h3> 
<h4 id="1%E3%80%81%E6%96%B0%E5%BB%BA%E7%BB%88%E7%AB%AF">1、新建终端</h4> 
<h4 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="916" src="https://images2.imgbox.com/66/e4/AExCUJf7_o.png" width="1200"></h4> 
<h4 id="2%E3%80%81%E8%BF%90%E8%A1%8C%E6%9C%8D%E5%8A%A1">2、运行服务</h4> 
<p> 先运行npm的安装，在通过【yarn dev】启动。</p> 
<pre><code class="language-python">npm install

yarn dev</code></pre> 
<p>安装时间较长，别急，等一会。</p> 
<p><img alt="" height="105" src="https://images2.imgbox.com/e0/fa/UNGSP2kC_o.png" width="1131"></p> 
<p>运行yarn dev效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/48/9c/JTdZtsQ5_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E9%80%89%E6%8B%A9%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F">3、选择打开方式</h4> 
<p>这里需要选择到端口处进行具体的选择，选择方式如下图。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/0c/4c/eMEtsZMj_o.png" width="1200"></p> 
<p>我觉得这个页面设计的还是不错的。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/49/2a/gSoLrdUG_o.png" width="1200"></p> 
<p>内部访问效果也OK：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/62/fe/Tb0LAE80_o.png" width="1200"></p> 
<p>到此，恭喜你，创建完毕了。</p> 
<h3 id="ChatGL%20M26BAI%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93%E3%80%81">ChatGL M26BAI模型总结、</h3> 
<p>整体上六个大步骤，没有消耗多长时间，我是搞了一遍之后开始写的这篇文章，故而看着时间长一些，其实熟练操作也就分分钟的事情，应该是适合绝大多数的程序员来操作的。</p> 
<p>操作不复杂，基本都有提示，希望对大家都能有所帮助，下面我单独问了一个问题，就是我们程序员未来发展之路，未遂没有一个具体解答，但是还是很中肯的，那就是学无止境。</p> 
<p><img alt="" height="688" src="https://images2.imgbox.com/cb/ce/UanpygSs_o.png" width="1200"></p> 
<h2 id="Pytorch2.0%20AI%E6%A1%86%E6%9E%B6%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86">Pytorch2.0 AI框架视频处理</h2> 
<h3 id="%E4%B8%80%E3%80%81%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9">一、框架选择</h3> 
<p>1、这里选择【Pytorch2.0】框架办版本。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/23/86/Yi7m43AQ_o.png" width="1200"></p> 
<p>创建完就是等待的时间，这个还是比较快的，我们主要使用【jupyter_lab】。</p> 
<p><img alt="" height="486" src="https://images2.imgbox.com/d7/e4/fLeaAhVT_o.png" width="1072"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d0/55/bh6hQJe3_o.png" width="1200"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E5%AE%8C%E6%95%B4%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">二、使用 JupyterLab 体验完整的机器学习工作流程</h3> 
<p>这里主要使用的是 FashionMNIST 数据集。</p> 
<h4 id="1%E3%80%81Terminal%E6%93%8D%E4%BD%9C">1、Terminal操作</h4> 
<p>使用的是清华大学的镜像加载本地数据集</p> 
<pre><code>mkdir dataset-fashion-mnist #创建文件夹 dataset-fashion-mnist
cd dataset-fashion-mnist
wget https://mirror.tuna.tsinghua.edu.cn/raspberry-pi-os/raspbian/pool/main/d/dataset-fashion-mnist/dataset-fashion-mnist_0.0~git20200523.55506a9.orig.tar.xz #下载数据集
tar -xf dataset-fashion-mnist_0.0~git20200523.55506a9.orig.tar.xz --strip-components=1
cd data &amp;&amp; mkdir FashionMNIST &amp;&amp; mkdir FashionMNIST/raw 
</code></pre> 
<h4 id="2%E3%80%81%E6%89%93%E5%BC%80root%2Fdataset-fashion-mnist%2Fdata%2Ffashion%E6%96%87%E4%BB%B6%E5%A4%B9">2、打开<strong>root/dataset-fashion-mnist/data/fashion文件夹</strong></h4> 
<p><img alt="" height="935" src="https://images2.imgbox.com/63/e4/SURXVjNt_o.png" width="1161"></p> 
<p>复制文件至【<strong>root/dataset-fashion-mnist/data/FashionMNIST/raw/</strong>】文件夹</p> 
<p><img alt="" height="878" src="https://images2.imgbox.com/d1/61/Kz7dKBDH_o.png" width="1200"></p> 
<h4 id="3%E3%80%81%E5%88%9B%E5%BB%BA%E3%80%90Notebook%E3%80%91">3、创建【Notebook】</h4> 
<p><img alt="" height="374" src="https://images2.imgbox.com/7b/db/m5QjDK5n_o.png" width="1200"></p> 
<p>运行以下代码：</p> 
<pre><code class="language-python">import torch
from torch import nn
from torch.utils.data import DataLoader
from torchvision import datasets
from torchvision.transforms import ToTensor

# 加载本地训练数据
training_data = datasets.FashionMNIST(
    root="/root/dataset-fashion-mnist/data",
    train=True,
    download=True,
    transform=ToTensor(),
)
# 加载本地测试数据
test_data = datasets.FashionMNIST(
    root="/root/dataset-fashion-mnist/data",
    train=False,
    download=True,
    transform=ToTensor(),
)

</code></pre> 
<hr> 
<h4 id="4%E3%80%81%E8%BF%90%E8%A1%8C%E6%96%B9%E6%B3%95"><span style="color:#fe2c24;"><strong>4、运行方法</strong></span></h4> 
<p><span style="color:#fe2c24;"><strong>注意看下图：</strong></span></p> 
<p><img alt="" height="611" src="https://images2.imgbox.com/14/b3/GkwlXWU7_o.png" width="1200"></p> 
<p><img alt="" height="913" src="https://images2.imgbox.com/d0/a2/0x04sVu3_o.png" width="1200"></p> 
<p>运行效果： </p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/12/7c/pITUGtug_o.png" width="1200"></p> 
<h4 id="5%E3%80%81%E4%BF%AE%E6%94%B9pip%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">5、修改pip环境配置</h4> 
<p><img alt="" height="476" src="https://images2.imgbox.com/6e/c9/BH2gwFw5_o.png" width="1200"></p> 
<pre><code class="language-python">pip config set global.index-url http://mirrors.cloud.tencent.com/pypi/simple
pip config set global.trusted-host mirrors.cloud.tencent.com

</code></pre> 
<p><img alt="" height="619" src="https://images2.imgbox.com/de/4b/3Oz62DxH_o.png" width="1200"></p> 
<h4 id="6%E3%80%81%E5%88%9B%E5%BB%BATerminal%E6%8C%81%E7%BB%AD%E8%BF%90%E8%A1%8C%E4%BB%A5%E4%B8%8B%E4%BB%A3%E7%A0%81%C2%A0">6、创建Terminal持续运行以下代码 </h4> 
<pre><code class="language-python">import matplotlib.pyplot as plt

labels_map = {
    0: "T-Shirt",
    1: "Trouser",
    2: "Pullover",
    3: "Dress",
    4: "Coat",
    5: "Sandal",
    6: "Shirt",
    7: "Sneaker",
    8: "Bag",
    9: "Ankle Boot",
}
figure = plt.figure(figsize=(8, 8))
cols, rows = 3, 3
for i in range(1, cols * rows + 1):
    sample_idx = torch.randint(len(training_data), size=(1,)).item()
    img, label = training_data[sample_idx]
    figure.add_subplot(rows, cols, i)
    plt.title(labels_map[label])
    plt.axis("off")
    plt.imshow(img.squeeze(), cmap="gray")
plt.show()
</code></pre> 
<p> 运行效果：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/90/45/tjZfjk2w_o.png" width="1200"></p> 
<pre><code class="language-python">batch_size = 64

# 创建 dataloader
train_dataloader = DataLoader(training_data, batch_size=batch_size)
test_dataloader = DataLoader(test_data, batch_size=batch_size)

for X, y in test_dataloader:
    print(f"Shape of X [N, C, H, W]: {X.shape}")
    print(f"Shape of y: {y.shape} {y.dtype}")
    break
</code></pre> 
<pre><code class="language-python"># 获取用于训练的 cpu 或 gpu 设备
device = "cuda" if torch.cuda.is_available() else "mps" if torch.backends.mps.is_available() else "cpu"
print(f"Using {device} device")

# 定义模型
class NeuralNetwork(nn.Module):
    def __init__(self):
        super().__init__()
        self.flatten = nn.Flatten()
        self.linear_relu_stack = nn.Sequential(
            nn.Linear(28*28, 512),
            nn.ReLU(),
            nn.Linear(512, 512),
            nn.ReLU(),
            nn.Linear(512, 10)
        )

    def forward(self, x):
        x = self.flatten(x)
        logits = self.linear_relu_stack(x)
        return logits

model = NeuralNetwork().to(device)
print(model)
</code></pre> 
<pre><code class="language-python">loss_fn = nn.CrossEntropyLoss() 
optimizer = torch.optim.SGD(model.parameters(), lr=1e-3)
</code></pre> 
<pre><code class="language-python">def train(dataloader, model, loss_fn, optimizer):
    size = len(dataloader.dataset)
    model.train()
    for batch, (X, y) in enumerate(dataloader):
        X, y = X.to(device), y.to(device)

        # 计算预测误差
        pred = model(X)
        loss = loss_fn(pred, y)

        # 反向传播
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()

        if batch % 100 == 0:
            loss, current = loss.item(), (batch + 1) * len(X)
            print(f"loss: {loss:&gt;7f}  [{current:&gt;5d}/{size:&gt;5d}]")
</code></pre> 
<pre><code class="language-python">def test(dataloader, model, loss_fn):
    size = len(dataloader.dataset)
    num_batches = len(dataloader)
    model.eval()
    test_loss, correct = 0, 0
    with torch.no_grad():
        for X, y in dataloader:
            X, y = X.to(device), y.to(device)
            pred = model(X)
            test_loss += loss_fn(pred, y).item()
            correct += (pred.argmax(1) == y).type(torch.float).sum().item()
    test_loss /= num_batches
    correct /= size
    print(f"Test Error: \n Accuracy: {(100*correct):&gt;0.1f}%, Avg loss: {test_loss:&gt;8f} \n")
</code></pre> 
<p>这里是第7步，这里需要等一会，一直等到出现【Done!】才结束。这里等一会。 </p> 
<pre><code class="language-python">epochs = 5
for t in range(epochs):
    print(f"Epoch {t+1}\n-------------------------------")
    train(train_dataloader, model, loss_fn, optimizer)
    test(test_dataloader, model, loss_fn)
print("Done!")
</code></pre> 
<h4 id="7%E3%80%81%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B">7、保存模型</h4> 
<pre><code class="language-python">torch.save(model.state_dict(), "/root/model.pth")
print("Saved PyTorch Model State to model.pth")
</code></pre> 
<p><img alt="" height="1015" src="https://images2.imgbox.com/be/ab/6aqt7ktn_o.png" width="1200"></p> 
<h4 id="8%E3%80%81%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%B9%B6%E9%A2%84%E6%B5%8B">8、加载模型并预测</h4> 
<pre><code class="language-python">model = NeuralNetwork()
model.load_state_dict(torch.load("/root/model.pth"))
</code></pre> 
<p><img alt="" height="871" src="https://images2.imgbox.com/58/05/F6lufDuH_o.png" width="1200"></p> 
<h4 id="9%E3%80%81%E9%A2%84%E6%B5%8B%E6%A8%A1%E5%9E%8B">9、预测模型</h4> 
<pre><code class="language-python">classes = [
    "包",
    "上衣",
    "套头衫",
    "连衣裙",
    "外套",
    "凉鞋",
    "衬衫",
    "运动鞋",
    "包",
    "短靴",
] #定义了一个包含类别标签的 classes 列表

model.eval() #将 PyTorch 模型设置为评估模式
x, y = test_data[1][0], test_data[1][1]#测试数据 test_data 中获取样本 分别为图像数据和其真实标签
with torch.no_grad():
    pred = model(x)
    predicted, actual = classes[pred[0].argmax(0)], classes[y]#选择具有最高概率的类别索引
    print(f'Predicted: "{predicted}", Actual: "{actual}"') #模型的预测结果 predicted 与真实标签 actual 进行比较，并使用 print 函数输出这两个值。
#输出图片信息
# 将 x 转换回图像格式
image = x.numpy().transpose(1, 2, 0)
# 显示图像
plt.figure(figsize=(4, 4))
plt.imshow(image)
# 设置中文标题
print('预测结果: "{predicted}", 实际结果: "{actual}"'.format(predicted=predicted, actual=actual))
plt.axis('off')
plt.show()
</code></pre> 
<p>预测结果： </p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ce/d6/Vb9q5pj8_o.png" width="1200"></p> 
<h3 id="%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E7%BA%A7%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C(RNN)%20%E7%94%9F%E6%88%90%E5%A7%93%E5%90%8D">三、使用 JupyterLab 体验使用字符级循环神经网络(RNN) 生成姓名</h3> 
<h4 id="1%E3%80%81%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87">1、数据准备</h4> 
<p>新建一个命令窗口，输入以下命令，下载资源包并解压</p> 
<pre><code class="language-python">cd /root
wget https://gitee.com/mmliujc/tencent_gpu/raw/master/data.zip
unzip data
</code></pre> 
<h4 id="2%E3%80%81%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%C2%A0Notebook%C2%A0%E9%A1%B5%E9%9D%A2%EF%BC%8C%E9%80%89%E6%8B%A9%C2%A0Python%203">2、新建一个 <strong>Notebook</strong> 页面，选择 <strong>Python 3</strong></h4> 
<p>持续运行以下代码到步骤8。</p> 
<pre><code class="language-python">from __future__ import unicode_literals, print_function, division
from io import open
import glob
import os
import unicodedata
import string

all_letters = string.ascii_letters + " .,;'-"
n_letters = len(all_letters) + 1 # Plus EOS marker

def findFiles(path): return glob.glob(path)

# Turn a Unicode string to plain ASCII, thanks to https://stackoverflow.com/a/518232/2809427
def unicodeToAscii(s):
    return ''.join(
        c for c in unicodedata.normalize('NFD', s)
        if unicodedata.category(c) != 'Mn'
        and c in all_letters
    )

# Read a file and split into lines
def readLines(filename):
    with open(filename, encoding='utf-8') as some_file:
        return [unicodeToAscii(line.strip()) for line in some_file]

# Build the category_lines dictionary, a list of lines per category
category_lines = {}
all_categories = []
for filename in findFiles('/root/data/names/*.txt'):
    category = os.path.splitext(os.path.basename(filename))[0]
    all_categories.append(category)
    lines = readLines(filename)
    category_lines[category] = lines

n_categories = len(all_categories)

if n_categories == 0:
    raise RuntimeError('Data not found. Make sure that you downloaded data '
        'from https://download.pytorch.org/tutorial/data.zip and extract it to '
        'the current directory.')

print('# categories:', n_categories, all_categories)
print(unicodeToAscii("O'Néàl"))
</code></pre> 
<p>创建网络</p> 
<pre><code class="language-python">import torch
import torch.nn as nn

class RNN(nn.Module):
    def __init__(self, input_size, hidden_size, output_size):
        super(RNN, self).__init__()
        self.hidden_size = hidden_size

        self.i2h = nn.Linear(n_categories + input_size + hidden_size, hidden_size)
        self.i2o = nn.Linear(n_categories + input_size + hidden_size, output_size)
        self.o2o = nn.Linear(hidden_size + output_size, output_size)
        self.dropout = nn.Dropout(0.1)
        self.softmax = nn.LogSoftmax(dim=1)

    def forward(self, category, input, hidden):
        input_combined = torch.cat((category, input, hidden), 1)
        hidden = self.i2h(input_combined)
        output = self.i2o(input_combined)
        output_combined = torch.cat((hidden, output), 1)
        output = self.o2o(output_combined)
        output = self.dropout(output)
        output = self.softmax(output)
        return output, hidden

    def initHidden(self):
        return torch.zeros(1, self.hidden_size)
</code></pre> 
<p>训练网络</p> 
<pre><code class="language-python">import random

# Random item from a list
def randomChoice(l):
    return l[random.randint(0, len(l) - 1)]

# Get a random category and random line from that category
def randomTrainingPair():
    category = randomChoice(all_categories)
    line = randomChoice(category_lines[category])
    return category, line
</code></pre> 
<pre><code class="language-python"># One-hot vector for category
def categoryTensor(category):
    li = all_categories.index(category)
    tensor = torch.zeros(1, n_categories)
    tensor[0][li] = 1
    return tensor

# One-hot matrix of first to last letters (not including EOS) for input
def inputTensor(line):
    tensor = torch.zeros(len(line), 1, n_letters)
    for li in range(len(line)):
        letter = line[li]
        tensor[li][0][all_letters.find(letter)] = 1
    return tensor

# ``LongTensor`` of second letter to end (EOS) for target
def targetTensor(line):
    letter_indexes = [all_letters.find(line[li]) for li in range(1, len(line))]
    letter_indexes.append(n_letters - 1) # EOS
    return torch.LongTensor(letter_indexes)
</code></pre> 
<pre><code class="language-python"># Make category, input, and target tensors from a random category, line pair
def randomTrainingExample():
    category, line = randomTrainingPair()
    category_tensor = categoryTensor(category)
    input_line_tensor = inputTensor(line)
    target_line_tensor = targetTensor(line)
    return category_tensor, input_line_tensor, target_line_tensor
</code></pre> 
<pre><code class="language-python">criterion = nn.NLLLoss()

learning_rate = 0.0005

def train(category_tensor, input_line_tensor, target_line_tensor):
    target_line_tensor.unsqueeze_(-1)
    hidden = rnn.initHidden()

    rnn.zero_grad()

    loss = 0

    for i in range(input_line_tensor.size(0)):
        output, hidden = rnn(category_tensor, input_line_tensor[i], hidden)
        l = criterion(output, target_line_tensor[i])
        loss += l

    loss.backward()

    for p in rnn.parameters():
        p.data.add_(p.grad.data, alpha=-learning_rate)

    return output, loss.item() / input_line_tensor.size(0)
</code></pre> 
<pre><code class="language-python">import time
import math

def timeSince(since):
    now = time.time()
    s = now - since
    m = math.floor(s / 60)
    s -= m * 60
    return '%dm %ds' % (m, s)
</code></pre> 
<h4 id="3%E3%80%81%E7%AC%AC%E5%85%AB%E6%AD%A5%E9%AA%A4%E7%9A%84%E4%BB%A3%E7%A0%81">3、第八步骤的代码</h4> 
<p>这里需要运行的时间比较长，需要长时间等待。过程中可以看到显示，官方提示大概21分钟。</p> 
<pre><code class="language-python">rnn = RNN(n_letters, 128, n_letters)

n_iters = 100000
print_every = 5000
plot_every = 500
all_losses = []
total_loss = 0 # Reset every ``plot_every`` ``iters``

start = time.time()

for iter in range(1, n_iters + 1):
    output, loss = train(*randomTrainingExample())
    total_loss += loss

    if iter % print_every == 0:
        print('%s (%d %d%%) %.4f' % (timeSince(start), iter, iter / n_iters * 100, loss))

    if iter % plot_every == 0:
        all_losses.append(total_loss / plot_every)
        total_loss = 0
</code></pre> 
<p>持续显示过程，注意看显示是否执行。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5d/66/pZIyfYWn_o.png" width="1200"></p> 
<h4 id="4%E3%80%81%E7%BB%98%E5%88%B6%E6%8D%9F%E5%A4%B1">4、绘制损失</h4> 
<p>在Notebook中执行</p> 
<pre><code class="language-python">import matplotlib.pyplot as plt

plt.figure()
plt.plot(all_losses)
</code></pre> 
<p><img alt="" height="839" src="https://images2.imgbox.com/c5/cb/8nltCfiT_o.png" width="1152"></p> 
<h4 id="5%E3%80%81%E7%BD%91%E7%BB%9C%E9%87%87%E6%A0%B7">5、网络采样</h4> 
<p>进行采样时，向网络中输入一个字母，预测下一个字母是什么，并将其作为下一个输入的字母，重复此过程直到遇到 EOS。</p> 
<p>创建输入类别、起始字母和空隐藏状态的张量</p> 
<p>使用起始字母创建一个字符串 output_name</p> 
<p>在最大输出长度范围内，</p> 
<blockquote> 
 <p>将当前字母输入网络<br> 从最近输出中获取下一个字母和下一个隐藏状态<br> 如果字母是 EOS，则停止<br> 如果是普通字母，则将其添加到 output_name 中并继续<br> 返回最终的姓名</p> 
</blockquote> 
<p><strong>注意：</strong> 比起要求输入一个起始字母，另一种策略是在训练中加入一个“字符串起始”的标记，并让网络自己选择起始字母。</p> 
<pre><code class="language-python">max_length = 20

# Sample from a category and starting letter
def sample(category, start_letter='A'):
    with torch.no_grad():  # no need to track history in sampling
        category_tensor = categoryTensor(category)
        input = inputTensor(start_letter)
        hidden = rnn.initHidden()

        output_name = start_letter

        for i in range(max_length):
            output, hidden = rnn(category_tensor, input[0], hidden)
            topv, topi = output.topk(1)
            topi = topi[0][0]
            if topi == n_letters - 1:
                break
            else:
                letter = all_letters[topi]
                output_name += letter
            input = inputTensor(letter)

        return output_name

# Get multiple samples from one category and multiple starting letters
def samples(category, start_letters='ABC'):
    for start_letter in start_letters:
        print(sample(category, start_letter))

samples('Russian', 'RUS')

samples('German', 'GER')

samples('Spanish', 'SPA')

samples('Chinese', 'CHI')

</code></pre> 
<p>执行效果： </p> 
<p><img alt="" height="1007" src="https://images2.imgbox.com/a7/dd/SNv5VWWW_o.png" width="735"></p> 
<h3 id="%E5%9B%9B%E3%80%81%E4%BD%BF%E7%94%A8%20JupyterLab%20%E4%BD%93%E9%AA%8C%E8%A7%86%E9%A2%91%E6%8A%A0%E5%83%8F%E7%A5%9E%E5%99%A8RobustVideoMatting">四、使用 JupyterLab 体验视频抠像神器RobustVideoMatting</h3> 
<h4 id="1%E3%80%81%E4%BE%9D%E8%B5%96%E5%AE%89%E8%A3%85">1、依赖安装</h4> 
<p><img alt="" height="503" src="https://images2.imgbox.com/f1/97/22hoWQkw_o.png" width="1200"></p> 
<p>克隆gitee</p> 
<pre><code class="language-python">git clone https://gitee.com/ai-toys/RobustVideoMatting
# 输入你的gitee账号密码
cd RobustVideoMatting
</code></pre> 
<p>克隆后进行环境安装。</p> 
<pre><code class="language-python">pip install -r requirements_inference.txt
</code></pre> 
<p> 这里需要等一会，安装完成后显示是：有一个Error没关系哦。</p> 
<p><img alt="" height="893" src="https://images2.imgbox.com/79/e2/287fwrtD_o.png" width="1200"></p> 
<h4 id="2%E3%80%81%E4%B8%8B%E8%BD%BD%E5%AE%9E%E9%AA%8C%E8%B5%84%E6%BA%90">2、下载实验资源</h4> 
<p>在【RobustVideoMatting】文件夹下上传【rvm_res.zip】文件。</p> 
<p class="img-center"><img alt="" height="265" src="https://images2.imgbox.com/4f/44/QGprvY5f_o.png" width="419"></p> 
<p>可以直接下载：【<a href="https://download.csdn.net/download/feng8403000/88519620" title="https://download.csdn.net/download/feng8403000/88519620">https://download.csdn.net/download/feng8403000/88519620</a>】</p> 
<p>单独wget也可以</p> 
<pre><code>wget https://gitee.com/mmliujc/tencent_gpu/raw/master/rvm_res.zip</code></pre> 
<p>下载完成后再【RobustVideoMatting】文件夹下解压即可。</p> 
<pre><code>unzip rvm_res.zip</code></pre> 
<p><img alt="" height="154" src="https://images2.imgbox.com/1d/12/WPbYKKEY_o.png" width="857"></p> 
<p>解压完毕后我们创建一个【output】文件夹</p> 
<pre><code>mkdir output</code></pre> 
<h4 id="%C2%A03%E3%80%81%E8%BF%90%E8%A1%8C"> 3、运行</h4> 
<p>创建一个文件，粘贴以下代码，使用【ctrl+s】保存文件，文件名为【test.py】</p> 
<pre><code class="language-python">import torch
import base64


from model import MattingNetwork
from inference import convert_video

model = MattingNetwork('mobilenetv3').eval().cuda()  # 或 "resnet50"
model.load_state_dict(torch.load('rvm_mobilenetv3.pth'))


convert_video(
    model,                           # 模型，可以加载到任何设备（cpu 或 cuda）
    input_source='1917.mp4',        # 视频文件，或图片序列文件夹
    output_type='video',             # 可选 "video"（视频）或 "png_sequence"（PNG 序列）
    output_composition='output/com.mp4',    # 若导出视频，提供文件路径。若导出 PNG 序列，提供文件夹路径
    output_alpha="output/pha.mp4",          # [可选项] 输出透明度预测
    output_foreground="output/fgr.mp4",     # [可选项] 输出前景预测
    output_video_mbps=4,             # 若导出视频，提供视频码率
    downsample_ratio=None,           # 下采样比，可根据具体视频调节，或 None 选择自动
    seq_chunk=12,                    # 设置多帧并行计算
)
</code></pre> 
<p>保存完毕后在【Terminal】下执行【python test.py】</p> 
<pre><code class="language-python">python test.py</code></pre> 
<p><img alt="" height="231" src="https://images2.imgbox.com/0f/f7/So03jCFQ_o.png" width="1200">别着急，等到完成。生成完成后可以在output中看到：</p> 
<p><img alt="" height="405" src="https://images2.imgbox.com/9e/8c/AP1JTIWw_o.png" width="479"></p> 
<p>创建【Notebook】</p> 
<p><img alt="" height="446" src="https://images2.imgbox.com/15/f0/MwUA7xpB_o.png" width="1200"></p> 
<h4 id="4%E3%80%81%E6%8A%A0%E5%9B%BE%E6%95%88%E6%9E%9C">4、抠图效果</h4> 
<p>运行以下代码，如果路径不对自己改一下。</p> 
<pre><code class="language-python">import torch
import base64
from IPython.display import HTML

outpath = "/root/RobustVideoMatting/output/com.mp4"
mp4 = open(outpath,'rb').read()
data_url = "data:video/mp4;base64," + base64.b64encode(mp4).decode()
HTML("""
&lt;video width=400 controls&gt;
      &lt;source src="%s" type="video/mp4"&gt;
&lt;/video&gt;
""" % data_url)
</code></pre> 
<p><img alt="" height="825" src="https://images2.imgbox.com/b9/7d/7na4aALo_o.png" width="1200"></p> 
<h4 id="5%E3%80%81%E6%8D%A2%E8%83%8C%E6%99%AF%E6%95%88%E6%9E%9C">5、换背景效果</h4> 
<pre><code class="language-python">import torch
import base64
from IPython.display import HTML

outpath = "/root/RobustVideoMatting/output/fgr.mp4"
mp4 = open(outpath,'rb').read()
data_url = "data:video/mp4;base64," + base64.b64encode(mp4).decode()
HTML("""
&lt;video width=400 controls&gt;
      &lt;source src="%s" type="video/mp4"&gt;
&lt;/video&gt;
""" % data_url)
</code></pre> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/c5/2a/82F7iVf6_o.png" width="1200"></p> 
<h3 id="Pytorch2.0%E6%80%BB%E7%BB%93">Pytorch2.0总结</h3> 
<p>这里3个实验示例可以帮助大家在预测、生成姓名、视频抠像上帮助到大家，上手也是非常的快的，自己搞定后希望能在工作中帮助到到家。</p> 
<hr> 
<p>现在还有活动呢，下面是活动的连接：</p> 
<p>腾讯云 HAI 新品公测产品体验地址 ：<a class="link-info" href="https://cloud.tencent.com/act/pro/hai" rel="nofollow" title="https://cloud.tencent.com/act/pro/hai">https://cloud.tencent.com/act/pro/hai</a></p> 
<p>腾讯云 HAI 新品公测专题页地址：<a class="link-info" href="https://marketing.csdn.net/p/b18dedb1166a0d94583db1877e49b039" title="https://marketing.csdn.net/p/b18dedb1166a0d94583db1877e49b039">https://marketing.csdn.net/p/b18dedb1166a0d94583db1877e49b039</a></p> 
<p>腾讯云 HAI 新品公测活动报名地址：<a class="link-info" href="https://jinshuju.net/f/dHxwJ7" rel="nofollow" title="https://jinshuju.net/f/dHxwJ7">https://jinshuju.net/f/dHxwJ7</a></p> 
<hr> 
<p>希望大家踊跃参加啊。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/743afd159ea91b09d497a431b94a9b61/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构之双向带头循环链表函数功能实现与详细解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e4773f6b334b72565487b0a34aef9f96/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Stable Diffusion1.5网络结构-超详细原创</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>