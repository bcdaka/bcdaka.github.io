<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatisPlus详解(三)lambdaQuery、lambdaUpdate、批量新增、代码生成、Db静态工具、逻辑删除 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/886820a39ad1288a5bf3ce05bba11df4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MyBatisPlus详解(三)lambdaQuery、lambdaUpdate、批量新增、代码生成、Db静态工具、逻辑删除">
  <meta property="og:description" content="文章目录 前言2 核心功能2.3 Service接口2.3.3 Lambda2.3.3.1 lambdaQuery2.3.3.2 lambdaUpdate 2.3.4 批量新增 3 扩展功能3.1 代码生成3.2 静态工具3.2.1 基本用法3.2.2 代码实例 3.3 逻辑删除 前言 MyBatisPlus详解系列文章：
MyBatisPlus详解(一)项目搭建、@TableName、@TableId、@TableField注解与常见配置
MyBatisPlus详解(二)条件构造器Wrapper、自定义SQL、Service接口
2 核心功能 2.3 Service接口 2.3.3 Lambda IService接口中还提供了Lambda功能来简化复杂查询及更新功能。
2.3.3.1 lambdaQuery 例如，要实现一个根据复杂条件查询用户信息的接口，接口文档如下：
接口请求方式请求路径请求参数返回值根据条件查询用户列表GET/user/listUserQueryList&lt;User&gt; 查询条件UserQuery的字段如下：
username：用户名关键字，可以为空status：用户状态，可以为空minBalance：最小余额，可以为空maxBalance：最大余额，可以为空 上述条件有可能为空，因此在查询时需要做判断。
首先定义一个查询实体类UserQuery：
// com.star.learning.pojo.UserQuery @Data public class UserQuery { private String username; private Integer status; private Integer minBalance; private Integer maxBalance; } 接着在UserController类中编写一个list()方法：
// com.star.learning.controller.UserController @GetMapping(&#34;/list&#34;) public List&lt;User&gt; list(UserQuery userQuery) { // 1.组织条件 String username = userQuery.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-22T21:45:00+08:00">
    <meta property="article:modified_time" content="2024-04-22T21:45:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatisPlus详解(三)lambdaQuery、lambdaUpdate、批量新增、代码生成、Db静态工具、逻辑删除</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#2__8" rel="nofollow">2 核心功能</a></li><li><ul><li><a href="#23_Service_10" rel="nofollow">2.3 Service接口</a></li><li><ul><li><a href="#233_Lambda_12" rel="nofollow">2.3.3 Lambda</a></li><li><ul><li><a href="#2331_lambdaQuery_16" rel="nofollow">2.3.3.1 lambdaQuery</a></li><li><a href="#2332_lambdaUpdate_117" rel="nofollow">2.3.3.2 lambdaUpdate</a></li></ul> 
    </li><li><a href="#234__177" rel="nofollow">2.3.4 批量新增</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3__258" rel="nofollow">3 扩展功能</a></li><li><ul><li><a href="#31__260" rel="nofollow">3.1 代码生成</a></li><li><a href="#32__292" rel="nofollow">3.2 静态工具</a></li><li><ul><li><a href="#321__294" rel="nofollow">3.2.1 基本用法</a></li><li><a href="#322__345" rel="nofollow">3.2.2 代码实例</a></li></ul> 
   </li><li><a href="#33__427" rel="nofollow">3.3 逻辑删除</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>MyBatisPlus详解系列文章：</p> 
<p><a href="https://blog.csdn.net/weixin_42739799/article/details/138029981">MyBatisPlus详解(一)项目搭建、@TableName、@TableId、@TableField注解与常见配置</a><br> <a href="https://blog.csdn.net/weixin_42739799/article/details/138042964">MyBatisPlus详解(二)条件构造器Wrapper、自定义SQL、Service接口</a></p> 
<h2><a id="2__8"></a>2 核心功能</h2> 
<h3><a id="23_Service_10"></a>2.3 Service接口</h3> 
<h4><a id="233_Lambda_12"></a>2.3.3 Lambda</h4> 
<p>IService接口中还提供了Lambda功能来简化复杂查询及更新功能。</p> 
<h5><a id="2331_lambdaQuery_16"></a>2.3.3.1 lambdaQuery</h5> 
<p>例如，要实现一个根据复杂条件查询用户信息的接口，接口文档如下：</p> 
<table><thead><tr><th>接口</th><th>请求方式</th><th>请求路径</th><th>请求参数</th><th>返回值</th></tr></thead><tbody><tr><td>根据条件查询用户列表</td><td>GET</td><td>/user/list</td><td>UserQuery</td><td>List&lt;User&gt;</td></tr></tbody></table> 
<p>查询条件UserQuery的字段如下：</p> 
<ul><li>username：用户名关键字，可以为空</li><li>status：用户状态，可以为空</li><li>minBalance：最小余额，可以为空</li><li>maxBalance：最大余额，可以为空</li></ul> 
<p><strong>上述条件有可能为空，因此在查询时需要做判断。</strong></p> 
<p>首先定义一个查询实体类UserQuery：</p> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.pojo.UserQuery</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserQuery</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> minBalance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> maxBalance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接着在UserController类中编写一个<code>list()</code>方法：</p> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.controller.UserController</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">UserQuery</span> userQuery<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.组织条件</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> status <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> minBalance <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getMinBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> maxBalance <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getMaxBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"根据条件查询用户列表 =&gt; "</span> <span class="token operator">+</span> userQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> wrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lambda</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span>minBalance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> minBalance<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span>maxBalance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> maxBalance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.查询用户</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"查询结果 =&gt; "</span> <span class="token operator">+</span> userQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> users<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>在上述代码进行组织条件时，使用了<code>username != null</code>这样的判断语句，它的效果就和Mapper文件的<code>&lt;if&gt;</code>标签一样，只有当条件成立时才会添加这个查询条件，从而实现动态查询。</strong></p> 
<p>调用<code>/user/list?username=o&amp;minBalance=500</code>，控制台打印信息如下：</p> 
<pre><code>根据条件查询用户列表 =&gt; UserQuery(username=o, status=null, minBalance=500, maxBalance=null)
==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM t_user WHERE (username LIKE ? AND balance &gt;= ?)
==&gt; Parameters: %o%(String), 500(Integer)
&lt;==      Total: 1
查询结果 =&gt; [User(id=3, username=Hope, password=123, phone=13900112222, info={"age": 25, "intro": "上进青年", "gender": "male"}, status=1, balance=19800, createTime=2024-04-21T10:13:35, updateTime=2024-04-21T18:48:28)]
</code></pre> 
<p>可见，在上述SQL语句中只有username和minBalance是查询条件，其余两个字段均没有作为查询条件。</p> 
<p><strong>上述代码还可以继续简化，我们无需通过new的方式来创建Wrapper，而是直接调用<code>lambdaQuery</code>方法：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.controller.UserController</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">UserQuery</span> userQuery<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.组织条件</span>
    <span class="token class-name">String</span> username <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> status <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> minBalance <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getMinBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> maxBalance <span class="token operator">=</span> userQuery<span class="token punctuation">.</span><span class="token function">getMaxBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"根据条件查询用户列表 =&gt; "</span> <span class="token operator">+</span> userQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.查询用户</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">lambdaQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span>username <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>status <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span>minBalance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> minBalance<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">le</span><span class="token punctuation">(</span>maxBalance <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> maxBalance<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"查询结果 =&gt; "</span> <span class="token operator">+</span> users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> users<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>可以发现，<code>lambdaQuery</code>方法中除了可以构建条件，还可以在链式编程的最后添加一个<code>list()</code>，告诉MP调用结果需要是一个List集合。</strong></p> 
<p>再次调用<code>/user/list?username=o&amp;minBalance=500</code>接口，执行结果是一致的。</p> 
<p><strong>MybatisPlus会根据链式编程的最后一个方法来判断最终的返回结果，除了使用<code>list()</code>返回集合结果，还可以使用<code>one()</code>返回1个结果，使用<code>count()</code>返回计数结果。</strong></p> 
<h5><a id="2332_lambdaUpdate_117"></a>2.3.3.2 lambdaUpdate</h5> 
<p><strong>与<code>lambdaQuery()</code>方法类似，IService中的<code>lambdaUpdate()</code>方法可以非常方便的实现复杂更新业务。</strong></p> 
<p>例如有这样一个需求：根据id修改用户余额时，如果扣减后余额为0，则将用户status修改为冻结状态（2）。</p> 
<p>也就是说，在扣减用户余额时，需要对用户剩余余额做出判断，如果发现剩余余额为0，则应该将status修改为2，<strong>这就是说update语句的set部分是动态的。</strong></p> 
<p>修改UserServiceImpl实现类中的<code>deductBalance()</code>方法：</p> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.service.impl.UserServiceImpl</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deductBalance</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> money<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.查询用户</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token function">getById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.判断用户状态</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> user<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"用户状态异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.判断用户余额</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> money<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"用户余额不足"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 4.扣减余额</span>
    <span class="token keyword">int</span> remainBalance <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> money<span class="token punctuation">;</span>
    <span class="token function">lambdaUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 更新余额</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> remainBalance<span class="token punctuation">)</span>
            <span class="token comment">// 动态判断是否更新status</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>remainBalance <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token comment">// 条件</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
            <span class="token comment">// 乐观锁</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// UpdateWrapper&lt;User&gt; wrapper = new UpdateWrapper&lt;User&gt;()</span>
    <span class="token comment">//        .eq("id", userId);</span>
    <span class="token comment">// userMapper.deductBalanceByIds(money, wrapper);</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>调用<code>/user/4/deduction/400</code>接口，控制台打印信息如下：</p> 
<pre><code>扣减id=4的用户的余额400
==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM t_user WHERE id=?
==&gt; Parameters: 4(Long)
&lt;==      Total: 1
User(id=4, username=Thomas, password=123, phone=17701265258, info={"age": 29, "intro": "伏地魔", "gender": "male"}, status=1, balance=400, createTime=2024-04-21T10:13:35, updateTime=2024-04-21T16:10:20)
==&gt;  Preparing: UPDATE t_user SET balance=?,status=? WHERE (id = ? AND balance = ?)
==&gt; Parameters: 0(Integer), 2(Integer), 4(Long), 400(Integer)
&lt;==    Updates: 1
</code></pre> 
<p>可以看到，SQL语句中同时将status字段也更新了。</p> 
<h4><a id="234__177"></a>2.3.4 批量新增</h4> 
<p>现有以下单元测试，<strong>逐条向数据库插入10000条数据：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSaveOneByOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">buildUser</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> e <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"耗时："</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">User</span> <span class="token function">buildUser</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"user_"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">18688190000L</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setBalance</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setInfo</span><span class="token punctuation">(</span><span class="token string">"{\"age\": 24, \"intro\": \"英文老师\", \"gender\": \"female\"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行单元测试，控制台打印信息如下：</p> 
<pre><code>耗时：28069
</code></pre> 
<p>然后再测试一下<strong>使用MybatisPlus的批量新增<code>saveBatch()</code>方法：</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> b <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        userList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">buildUser</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 每1000条插入一次数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            userService<span class="token punctuation">.</span><span class="token function">saveBatch</span><span class="token punctuation">(</span>userList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> e <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"耗时："</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行单元测试，控制台打印信息如下：</p> 
<pre><code>耗时：4675
</code></pre> 
<p><strong>可以看到，使用了MybatisPlus的批量新增<code>saveBatch()</code>方法后，比逐条新增所用的时间缩短了7倍左右，性能大大提升。</strong></p> 
<p><strong>实际上，MybatisPlus的批处理是基于PrepareStatement的预编译模式，将批量insert语句准备好后批量进行提交，因此最终在数据库执行时还是会有执行多条insert语句。</strong></p> 
<p><strong>而如果想要得到最佳性能，最好是将多条SQL合并为一条。在MySQL的客户端连接参数中有这样的一个参数：<code>rewriteBatchedStatements</code>，用于设置是否重写批处理的statement语句，默认值为false。</strong></p> 
<p><strong>因此，想要将多条SQL合并为一条，只需要修改项目中的application.yml文件，在jdbc的url后面添加参数<code>&amp;rewriteBatchedStatements=true</code>。</strong></p> 
<p><img src="https://images2.imgbox.com/8e/31/ASuVpLeE_o.png" alt=""></p> 
<p>修改完成后，再次测试插入10000条数据，控制台打印信息如下：</p> 
<pre><code>耗时：2263
</code></pre> 
<p>可见，性能得到进一步地提升，且SQL语句被合并成了一条：</p> 
<p><img src="https://images2.imgbox.com/d6/2e/aESgU4iC_o.png" alt=""></p> 
<blockquote> 
 <p>提示：测试项目中原本使用的MySQL驱动版本是5.1.48，无法实现合并SQL语句的功能；<br> 而将其版本更新到8.0.16之后，就可以实现了。</p> 
</blockquote> 
<h2><a id="3__258"></a>3 扩展功能</h2> 
<h3><a id="31__260"></a>3.1 代码生成</h3> 
<p><strong>MybatisPlus官方提供了代码生成器根据数据库表结构生成POJO、Mapper、Service等相关代码</strong>。只不过代码生成器同样要编码使用，相对麻烦。</p> 
<p>但在IDEA中，有一款MybatisPlus的插件，它可以基于图形化界面完成MybatisPlus的代码生成，非常简单。</p> 
<p><img src="https://images2.imgbox.com/cd/77/HHmNZz4v_o.png" alt=""></p> 
<p>下面就以数据库中的<code>t_address</code>表来演示代码自动生成。</p> 
<p>在IDEA顶部菜单栏中，找到<code>Tools</code>菜单，选择<code>Config Database</code>：</p> 
<p><img src="https://images2.imgbox.com/9c/15/OGGG9YtC_o.png" alt=""></p> 
<p>在弹出的窗口中填写数据库连接的基本信息，并保存：</p> 
<p><img src="https://images2.imgbox.com/6f/5f/cSJQMyT5_o.png" alt=""></p> 
<p>然后再次在IDEA顶部菜单栏中，找到<code>Tools</code>菜单，选择<code>Code Generator</code>：</p> 
<p><img src="https://images2.imgbox.com/15/c0/lJUBAKZm_o.png" alt=""></p> 
<p>在弹出的窗口中填写要生成的代码的基本信息：</p> 
<p><img src="https://images2.imgbox.com/bb/34/fSkEMlSy_o.png" alt=""></p> 
<p>点击<code>code generatro</code>，即可在指定包下生成对应的类：</p> 
<p><img src="https://images2.imgbox.com/70/cc/U77IBojY_o.png" alt=""></p> 
<p>当然生成的代码并一定完全符合要求，这时只需要根据要求做简单地修改即可，比全部手写省事多了。</p> 
<h3><a id="32__292"></a>3.2 静态工具</h3> 
<h4><a id="321__294"></a>3.2.1 基本用法</h4> 
<p>有的时候Service之间也会相互调用，但很有可能会出现循环依赖问题。</p> 
<p><strong>为了避免这个问题，MybatisPlus提供一个静态工具类：Db类，它其中的一些静态方法与IService中的方法基本一致，也可以实现CRUD功能：</strong></p> 
<p><img src="https://images2.imgbox.com/ce/b0/HqQkd1Cs_o.png" alt=""></p> 
<p>其基本使用方法如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 利用Db实现根据ID查询</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 利用Db实现复杂条件查询</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">lambdaQuery</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> <span class="token string">"o"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ge</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 利用Db实现条件更新</span>
    <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">lambdaUpdate</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getBalance</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getUsername</span><span class="token punctuation">,</span> <span class="token string">"Rose"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>执行以上单元测试，控制台打印信息如下：</p> 
<pre><code>==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM t_user WHERE id=?
==&gt; Parameters: 1(Long)
&lt;==      Total: 1
User(id=1, username=Jack, password=123, phone=13900112224, info={"age": 20, "intro": "佛系青年", "gender": "male"}, status=1, balance=1600, createTime=2024-04-22T19:40:36, updateTime=2024-04-22T19:40:36)
==========
==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM t_user WHERE (username LIKE ? AND balance &gt;= ?)
==&gt; Parameters: %o%(String), 1000(Integer)
&lt;==      Total: 1
User(id=3, username=Hope, password=123, phone=13900112222, info={"age": 25, "intro": "上进青年", "gender": "male"}, status=1, balance=100000, createTime=2024-04-22T19:40:36, updateTime=2024-04-22T19:40:36)
==========
==&gt;  Preparing: UPDATE t_user SET balance=? WHERE (username = ?)
==&gt; Parameters: 2000(Integer), Rose(String)
&lt;==    Updates: 1
</code></pre> 
<h4><a id="322__345"></a>3.2.2 代码实例</h4> 
<p>下面实现一个需求：改造根据id查询用户信息的接口，在查询用户的同时返回用户收货地址列表。</p> 
<ul><li>1）修改User对象，添加收货地址列表属性：</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.pojo.User</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"t_user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// ...</span>

    <span class="token comment">/**
     * 收货地址列表
     */</span>
    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> addressList<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<ul><li>2）修改UserController中根据id查询用户信息的<code>getById()</code>方法：</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.controller.UserController</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// User user = userService.getById(userId);</span>
    <span class="token comment">// System.out.println("根据id查询用户 =&gt; " + user);</span>
    <span class="token comment">// 基于自定义Service方法查询</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserAndAddressById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"根据id查询用户及其收货地址信息 =&gt; "</span> <span class="token operator">+</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>3）在IService接口中定义<code>queryUserAndAddressById()</code>方法，并在UserServiceImpl类中具体实现：</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.service.IUserService</span>

<span class="token class-name">User</span> <span class="token function">queryUserAndAddressById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// com.star.learning.service.impl.UserServiceImpl</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryUserAndAddressById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1.查询用户</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token function">getById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 2.使用Db来查询收货地址</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> addressList <span class="token operator">=</span> <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">lambdaQuery</span><span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token class-name">Address</span><span class="token operator">::</span><span class="token function">getUserId</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.处理返回</span>
    user<span class="token punctuation">.</span><span class="token function">setAddressList</span><span class="token punctuation">(</span>addressList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>4）调用<code>/user/1</code>接口，控制台打印信息如下：</li></ul> 
<pre><code>==&gt;  Preparing: SELECT id,username,password,phone,info,status,balance,create_time,update_time FROM t_user WHERE id=?
==&gt; Parameters: 1(Long)
&lt;==      Total: 1
==&gt;  Preparing: SELECT id,user_id,province,city,town,mobile,street,contact,is_default,notes,deleted FROM t_address WHERE (user_id = ?)
==&gt; Parameters: 1(Long)
&lt;==      Total: 2
根据id查询用户及其收货地址信息 =&gt; User(id=1, username=Jack, password=123, phone=13900112224, info={"age": 20, "intro": "佛系青年", "gender": "male"}, status=1, balance=1600, createTime=2024-04-22T19:40:36, updateTime=2024-04-22T19:40:36, addressList=[Address(id=2, userId=1, province=北京, city=北京, town=朝阳区, mobile=13700221122, street=修正大厦, contact=Jack, isDefault=false, notes=null, deleted=false), Address(id=3, userId=1, province=上海, city=上海, town=浦东新区, mobile=13301212233, street=航头镇航头路, contact=Jack, isDefault=true, notes=null, deleted=false)])
</code></pre> 
<p><strong>可见，在查询地址时，采用了Db类的静态方法，避免了注入AddressService，从而减少了循环依赖的风险。</strong></p> 
<h3><a id="33__427"></a>3.3 逻辑删除</h3> 
<p><strong>对于一些比较重要的数据，往往会采用逻辑删除的方案，即在表中添加一个字段标记数据是否被删除，当删除数据时把标记置为true，当查询时过滤掉标记为true的数据。</strong></p> 
<p>但是一旦采用逻辑删除，查询和删除逻辑就会变得更加复杂。为此，MybatisPlus添加了对逻辑删除的支持。</p> 
<p><strong>但是要注意，只有MybatisPlus生成的SQL语句才支持自动的逻辑删除，自定义SQL需要自己手动处理逻辑删除。</strong></p> 
<p>例如，在<code>t_address</code>表及其对应的实体Address类中有一个逻辑删除字段<code>deleted</code>，默认值为0：</p> 
<p><img src="https://images2.imgbox.com/60/f1/FhpJP5GJ_o.png" alt=""></p> 
<p><strong>要开启MyBatisPlus的逻辑删除功能，需要在application.yml中配置逻辑删除字段：</strong></p> 
<pre><code class="prism language-yaml"><span class="token comment"># src/main/resources/application.yaml</span>

<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">logic-delete-field</span><span class="token punctuation">:</span> deleted <span class="token comment"># 全局逻辑删除的实体字段名</span>
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 逻辑已删除值(默认为 1)</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># 逻辑未删除值(默认为 0)</span>
</code></pre> 
<p>接下来编写测试代码：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDeleteByLogic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    addressService<span class="token punctuation">.</span><span class="token function">removeById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行以上单元测试，控制台打印信息如下：</p> 
<pre><code>==&gt;  Preparing: UPDATE t_address SET deleted=1 WHERE id=? AND deleted=0
==&gt; Parameters: 1(Integer)
&lt;==    Updates: 1
</code></pre> 
<p>可见，SQL语句并不是DELETE语句，而是UPDATE语句，将<code>deleted</code>字段设置为1。</p> 
<p>再来测试以下查询操作：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Address</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> addressService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>执行以上单元测试，控制台打印信息如下：</p> 
<pre><code>==&gt;  Preparing: SELECT id,user_id,province,city,town,mobile,street,contact,is_default,notes,deleted FROM t_address WHERE deleted=0
==&gt; Parameters: 
&lt;==      Total: 10
</code></pre> 
<p>可见，SQL语句自动添加了一个条件：<code>WHERE deleted=0</code>。</p> 
<p>总的来说，开启了逻辑删除功能以后，我们就可以像普通删除一样做CRUD，基本不用考虑代码逻辑问题。</p> 
<p>同时，逻辑删除本身也是有问题的，比如：</p> 
<ul><li>会导致数据库表垃圾数据越来越多，从而影响查询效率；</li><li>SQL中全都需要对逻辑删除字段做判断，影响查询效率。</li></ul> 
<p>…</p> 
<p>本节完，更多内容请查阅分类专栏：<a href="https://blog.csdn.net/weixin_42739799/category_12649235.html">MyBatisPlus详解</a></p> 
<p>本文涉及代码下载地址：<a href="https://gitee.com/weidag/mybatis_plus_learning.git" rel="nofollow">https://gitee.com/weidag/mybatis_plus_learning.git</a></p> 
<p>感兴趣的读者还可以查阅我的另外几个专栏：</p> 
<ul><li><a href="https://blog.csdn.net/weixin_42739799/category_12552223.html">SpringBoot源码解读与原理分析(已完结)</a></li><li><a href="https://blog.csdn.net/weixin_42739799/category_12581999.html">MyBatis3源码深度解析(已完结)</a></li><li><a href="https://blog.csdn.net/weixin_42739799/category_12625438.html">Redis从入门到精通(已完结)</a></li><li><a href="https://blog.csdn.net/weixin_42739799/category_12623518.html">再探Java为面试赋能(持续更新中…)</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2adf0d84d79d1949bce6126936f12874/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java实现分片上传（前端分，后端合并）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b46345cd3b8f1838b44ac2ef07e22eb7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言：数据结构(单链表)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>