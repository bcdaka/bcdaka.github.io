<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【路径规划】局部路径规划算法——DWA算法（动态窗口法）|（含python实现 | c&#43;&#43;实现） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/daef017989fc167313c6a8d894aacccd/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【路径规划】局部路径规划算法——DWA算法（动态窗口法）|（含python实现 | c&#43;&#43;实现）">
  <meta property="og:description" content="文章目录 参考资料1. DWA算法原理1.1 简介1.2 算法原理1. 速度采样2. 轨迹预测（轨迹推算）3. 轨迹评价 2. Python实现2.1 参数配置2.2 机器人运动学模型2.3 DWA算法类实现2.4 画图2.5 主函数 3. c&#43;&#43;实现4. 总结 参考资料 The Dynamic Window Approach to Collision Avoidance基于室内多障碍物复杂环境的路径规划方法研究基于改进A*算法与改进DWA算法的无人驾驶汽车路径规划研究室内移动机器人路径规划方法研究机器人局部避障的动态窗口法 1. DWA算法原理 1.1 简介 动态窗口算法(Dynamic Window Approaches, DWA) 是基于预测控制理论的一种次优方法，因其在未知环境下能够安全、有效的避开障碍物, 同时具有计算量小, 反应迅速、可操作性强等特点。
DWA算法属于局部路径规划算法。
DWA算法的核心思想是根据移动机器人当前的位置状态和速度状态在速度空间 ( v , ω ) (v, \omega) (v,ω) 中确定一个满足移动机器人硬件约束的采样速度空间，然后计算移动机器人在这些速度情况下移动一定时间内的轨迹， 并通过评价函数对该轨迹进行评价，最后选出评价最优的轨迹所对应的速度来作为移动机器人运动速度， 如此循环直至移动机器人到达目标点。
对于无人驾驶汽车而言，情况类似，将车辆的位置变化转化为线速度和角速度控制，避障问题转变成空间中的运动约束问题，这样可以通过运动约束条件选择局部最优的路径。
1.2 算法原理 DWA算法的思路是：先通过机器人数学模型采集机器人速度样本，并预测模拟出在样本速度下一段时间内生成的运动轨迹， 并对这些运动轨迹进行标准评价， 选择出一组最优轨迹，机器人按照最优轨迹运动。机器人的运动姿态和方向是由机器人当前的线速度及角速度 (转向速度) 共同决定的。
DWA算法主要包括3个步骤：速度采样、轨迹预测（推算）、轨迹评价。
1. 速度采样 由于移动机器人硬件、结构和环境等限制条件，移动机器人的速度采样空间 V s \mathbf{V}_{\mathrm{s}} Vs​ 中 ( v , ω ) (v, \omega) (v,ω) 有一定的范围限制。该限制主要分为三大类：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-11-28T19:15:47+08:00">
    <meta property="article:modified_time" content="2022-11-28T19:15:47+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【路径规划】局部路径规划算法——DWA算法（动态窗口法）|（含python实现 | c&#43;&#43;实现）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">参考资料</a></li><li><a href="#1_DWA_8" rel="nofollow">1. DWA算法原理</a></li><li><ul><li><a href="#11__9" rel="nofollow">1.1 简介</a></li><li><a href="#12__19" rel="nofollow">1.2 算法原理</a></li><li><ul><li><a href="#1__24" rel="nofollow">1. 速度采样</a></li><li><a href="#2__77" rel="nofollow">2. 轨迹预测（轨迹推算）</a></li><li><a href="#3__103" rel="nofollow">3. 轨迹评价</a></li></ul> 
  </li></ul> 
  </li><li><a href="#2_Python_145" rel="nofollow">2. Python实现</a></li><li><ul><li><a href="#21__150" rel="nofollow">2.1 参数配置</a></li><li><a href="#22__215" rel="nofollow">2.2 机器人运动学模型</a></li><li><a href="#23_DWA_244" rel="nofollow">2.3 DWA算法类实现</a></li><li><a href="#24__487" rel="nofollow">2.4 画图</a></li><li><a href="#25__505" rel="nofollow">2.5 主函数</a></li></ul> 
  </li><li><a href="#3_c_569" rel="nofollow">3. c++实现</a></li><li><a href="#4__572" rel="nofollow">4. 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>参考资料</h2> 
<ul><li><a href="https://www.ri.cmu.edu/pub_files/pub1/fox_dieter_1997_1/fox_dieter_1997_1.pdf" rel="nofollow">The Dynamic Window Approach to Collision Avoidance</a></li><li><a href="https://kreader.cnki.net/Kreader/CatalogViewPage.aspx?dbCode=CMFD&amp;filename=1021522680.nh&amp;tablename=CMFDTEMP&amp;compose=&amp;first=1&amp;uid=WEEvREcwSlJHSldSdmVpbisvQWlDQWpvS0hTdmNTaUlCMTd6MEtJTG9BMD0=%249A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" rel="nofollow">基于室内多障碍物复杂环境的路径规划方法研究</a></li><li><a href="https://kreader.cnki.net/Kreader/CatalogViewPage.aspx?dbCode=CMFD&amp;filename=1021627194.nh&amp;tablename=CMFD202102&amp;compose=&amp;first=1&amp;uid=WEEvREcwSlJHSldSdmVpbisvQWlDQWpvS0hTdmNTaUlCMTd6MEtJTG9BMD0=%249A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" rel="nofollow">基于改进A*算法与改进DWA算法的无人驾驶汽车路径规划研究</a></li><li><a href="https://kreader.cnki.net/Kreader/CatalogViewPage.aspx?dbCode=CMFD&amp;filename=1022718394.nh&amp;tablename=CMFDTEMP&amp;compose=&amp;first=1&amp;uid=WEEvREcwSlJHSldSdmVpbisvQWlDQWpvS0hTdmNTaUlCMTd6MEtJTG9BMD0=%249A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!" rel="nofollow">室内移动机器人路径规划方法研究</a></li><li><a href="https://blog.csdn.net/heyijia0327/article/details/44983551">机器人局部避障的动态窗口法</a></li></ul> 
<h2><a id="1_DWA_8"></a>1. DWA算法原理</h2> 
<h3><a id="11__9"></a>1.1 简介</h3> 
<ul><li> <p>动态窗口算法(Dynamic Window Approaches, DWA) 是基于预测控制理论的一种次优方法，因其在未知环境下能够安全、有效的避开障碍物, 同时具有计算量小, 反应迅速、可操作性强等特点。</p> </li><li> <p>DWA算法属于局部路径规划算法。</p> </li><li> <p>DWA算法的<mark>核心思想</mark>是根据移动机器人当前的位置状态和速度状态在速度空间 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           v 
          
         
           , 
          
         
           ω 
          
         
           ) 
          
         
        
          (v, \omega) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 中确定一个满足移动机器人硬件约束的采样速度空间，然后计算移动机器人在这些速度情况下移动一定时间内的轨迹， 并通过评价函数对该轨迹进行评价，最后选出评价最优的轨迹所对应的速度来作为移动机器人运动速度， 如此循环直至移动机器人到达目标点。</p> </li><li> <p>对于无人驾驶汽车而言，情况类似，将车辆的位置变化转化为线速度和角速度控制，避障问题转变成空间中的运动约束问题，这样可以通过运动约束条件选择局部最优的路径。</p> </li></ul> 
<h3><a id="12__19"></a>1.2 算法原理</h3> 
<ul><li> <p>DWA算法的思路是：先通过机器人数学模型采集机器人速度样本，并预测模拟出在样本速度下一段时间内生成的运动轨迹， 并对这些运动轨迹进行标准评价， 选择出一组最优轨迹，机器人按照最优轨迹运动。机器人的运动姿态和方向是由机器人当前的线速度及角速度 (转向速度) 共同决定的。</p> </li><li> <p>DWA算法主要包括3个步骤：速度采样、轨迹预测（推算）、轨迹评价。</p> </li></ul> 
<h4><a id="1__24"></a>1. 速度采样</h4> 
<p>由于移动机器人硬件、结构和环境等限制条件，移动机器人的速度采样空间 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          V 
         
        
          s 
         
        
       
      
        \mathbf{V}_{\mathrm{s}} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">s</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         v 
        
       
         , 
        
       
         ω 
        
       
         ) 
        
       
      
        (v, \omega) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 有一定的范围限制。该限制主要分为三大类：</p> 
<ul><li> <p><font color="red">速度边界限制</font></p> <p>根据移动机器人的硬件条件和环境限制, 移动机器人的速度存在的边界限制, 此时可采样的速度空间 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            V 
           
          
            m 
           
          
         
        
          \mathbf{V}_m 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 为<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                V 
               
              
                m 
               
              
             
               = 
              
              
              
                { 
               
              
                ( 
               
              
                v 
               
              
                , 
               
              
                ω 
               
              
                ) 
               
              
                ∣ 
               
              
                v 
               
              
                ∈ 
               
               
               
                 [ 
                
                
                
                  v 
                 
                
                  min  
                 
                
               
                 , 
                
                
                
                  v 
                 
                
                  max  
                 
                
               
                 ] 
                
               
              
                , 
               
              
                ω 
               
              
                ∈ 
               
               
               
                 [ 
                
                
                
                  ω 
                 
                
                  min  
                 
                
               
                 , 
                
                
                
                  ω 
                 
                
                  max  
                 
                
               
                 ] 
                
               
              
                } 
               
              
             
            
            
            
            
              (1) 
             
            
           
          
         
           \tag{1} \mathbf{V}_m=\left\{(v, \omega) \mid v \in\left[v_{\text {min }}, v_{\text {max }}\right], \omega \in\left[\omega_{\text {min }}, \omega_{\text {max }}\right]\right\} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">{<!-- --></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">max </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">max </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="mclose delimcenter" style="top: 0em;">}</span></span></span><span class="tag"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 式中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            v 
           
          
            min  
           
          
         
           、 
          
          
          
            v 
           
          
            max  
           
          
         
        
          v_{\text {min }} 、 v_{\text {max }} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">max </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 分别为移动机器人最小线速度和最大线速度, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            ω 
           
          
            min  
           
          
         
           、 
          
          
          
            ω 
           
          
            max 
           
          
            ⁡ 
           
          
         
        
          \omega_{\text {min }} 、 \omega_{\max } 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.15139em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.30139em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 分别 为移动机器人最小角速度和最大角速度。</p> </li><li> <p><font color="red">加速度限制</font></p> <p>由于移动机器人的驱动电机的限制， 故移动机器人的线加速度和角加速度均存在边界限制，假设最大加速度和减速度大小一样，故考虑加速度时可采样的速度空间 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            V 
           
          
            d 
           
          
         
        
          \mathbf{V}_d 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 为<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                V 
               
              
                d 
               
              
             
               = 
              
              
              
                { 
               
              
                ( 
               
              
                v 
               
              
                , 
               
              
                ω 
               
              
                ) 
               
              
                ∣ 
               
               
                
                 
                  
                   
                   
                     v 
                    
                   
                     ∈ 
                    
                    
                    
                      [ 
                     
                     
                     
                       v 
                      
                     
                       c 
                      
                     
                    
                      − 
                     
                     
                     
                       a 
                      
                      
                      
                        v 
                       
                      
                        max 
                       
                      
                        ⁡ 
                       
                      
                     
                    
                      ⋅ 
                     
                    
                      Δ 
                     
                    
                      t 
                     
                    
                      , 
                     
                     
                     
                       v 
                      
                     
                       c 
                      
                     
                    
                      + 
                     
                     
                     
                       a 
                      
                      
                      
                        v 
                       
                      
                        max 
                       
                      
                        ⁡ 
                       
                      
                     
                    
                      ∙ 
                     
                    
                      Δ 
                     
                    
                      t 
                     
                    
                      ] 
                     
                    
                   
                  
                 
                
                
                 
                  
                   
                   
                     ω 
                    
                   
                     ∈ 
                    
                    
                    
                      [ 
                     
                     
                     
                       ω 
                      
                     
                       c 
                      
                     
                    
                      − 
                     
                     
                     
                       a 
                      
                      
                      
                        w 
                       
                      
                        max 
                       
                      
                        ⁡ 
                       
                      
                     
                    
                      ∙ 
                     
                    
                      Δ 
                     
                    
                      t 
                     
                    
                      , 
                     
                     
                     
                       ω 
                      
                     
                       c 
                      
                     
                    
                      + 
                     
                     
                     
                       a 
                      
                      
                      
                        w 
                       
                      
                        max 
                       
                      
                        ⁡ 
                       
                      
                     
                    
                      ∙ 
                     
                    
                      Δ 
                     
                    
                      t 
                     
                    
                      ] 
                     
                    
                   
                  
                 
                
               
              
                } 
               
              
             
            
            
            
            
              (2) 
             
            
           
          
         
           \tag{2} \mathbf{V}_d=\left\{(v, \omega) \mid \begin{array}{l} v \in\left[v_c-a_{v \max } \cdot \Delta t, v_c+a_{v \max } \bullet \Delta t\right] \\ \omega \in\left[\omega_c-a_{w \max } \bullet \Delta t, \omega_c+a_{w \max } \bullet \Delta t\right] \end{array}\right\} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">{<!-- --></span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∙</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∙</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∙</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">}</span></span></span></span><span class="tag"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br> 式中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            v 
           
          
            c 
           
          
         
           、 
          
          
          
            ω 
           
          
            c 
           
          
         
        
          v_c 、 \omega_c 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 分别为移动机器人当前时刻的线速度和角速度，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            a 
           
           
           
             v 
            
           
             max 
            
           
             ⁡ 
            
           
          
         
           、 
          
          
          
            a 
           
           
           
             w 
            
           
              max  
            
           
          
         
        
          a_{v \max } 、 a_{w \text { max }} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span><span class="mord text mtight"><span class="mord mtight"> max </span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 分别为 移动机器人最大线加速度和最大角加速度。</p> </li><li> <p><font color="red">环境障碍物限制</font></p> <p>局部规划还需要有动态实时的避障功能。考虑移动机器人的周围的障碍物因素，某一时刻移动机器人不与周围障碍物发生碰撞的可约束条件为<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
              
                V 
               
              
                a 
               
              
             
               = 
              
              
              
                { 
               
              
                ( 
               
              
                v 
               
              
                , 
               
              
                ω 
               
              
                ) 
               
              
                ∣ 
               
               
                
                 
                  
                   
                   
                     v 
                    
                   
                     ∈ 
                    
                    
                    
                      [ 
                     
                     
                     
                       v 
                      
                     
                       min 
                      
                     
                       ⁡ 
                      
                     
                    
                      , 
                     
                     
                      
                      
                        2 
                       
                      
                        ⋅ 
                       
                      
                        d 
                       
                      
                        i 
                       
                      
                        s 
                       
                      
                        t 
                       
                      
                        ( 
                       
                      
                        v 
                       
                      
                        , 
                       
                      
                        ω 
                       
                      
                        ) 
                       
                      
                        ⋅ 
                       
                       
                       
                         a 
                        
                        
                        
                          v 
                         
                        
                          max 
                         
                        
                          ⁡ 
                         
                        
                       
                      
                     
                    
                      ] 
                     
                    
                   
                  
                 
                
                
                 
                  
                   
                   
                     ω 
                    
                   
                     ∈ 
                    
                    
                    
                      [ 
                     
                     
                     
                       ω 
                      
                     
                       min 
                      
                     
                       ⁡ 
                      
                     
                    
                      , 
                     
                     
                      
                      
                        2 
                       
                      
                        ⋅ 
                       
                      
                        d 
                       
                      
                        i 
                       
                      
                        s 
                       
                      
                        t 
                       
                      
                        ( 
                       
                      
                        v 
                       
                      
                        , 
                       
                      
                        ω 
                       
                      
                        ) 
                       
                      
                        ⋅ 
                       
                       
                       
                         a 
                        
                        
                        
                          ω 
                         
                        
                          max 
                         
                        
                          ⁡ 
                         
                        
                       
                      
                     
                    
                      ] 
                     
                    
                   
                  
                 
                
               
              
                } 
               
              
             
            
            
            
            
              (3) 
             
            
           
          
         
           \tag{3} \mathbf{V}_a=\left\{(v, \omega) \mid \begin{array}{l} v \in\left[v_{\min}, \sqrt{2\cdot dist(v,\omega)\cdot a_{v \max}}\right] \\ \omega \in\left[\omega_{\min}, \sqrt{2\cdot dist(v,\omega)\cdot a_{\omega \max}}\right] \end{array}\right\} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.60004em; vertical-align: -1.55002em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.49999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎩</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎨</span></span></span><span class="" style="top: -4.30002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -4.05002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">[</span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.3175em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.4675em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.935em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.895em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"> 
                        <svg width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"> 
                         <path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z"></path> 
                        </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.305em;"><span class=""></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">]</span></span></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.15em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size2">[</span></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.317502em;"><span class="" style="top: -2.3175em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.4675em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight">min</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.935em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">ω</span><span class="mspace mtight" style="margin-right: 0.195167em;"></span><span class="mop mtight">max</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.895em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"> 
                        <svg width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"> 
                         <path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z"></path> 
                        </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.305em;"><span class=""></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size2">]</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.05002em;"><span class="" style="top: -2.49999em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎭</span></span></span><span class="" style="top: -3.15001em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎬</span></span></span><span class="" style="top: -4.30002em;"><span class="pstrut" style="height: 3.15em;"></span><span class="delimsizinginner delim-size4"><span class="">⎫</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.55002em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 3.60004em; vertical-align: -1.55002em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p>式中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           dist 
          
         
           ⁡ 
          
         
           ( 
          
         
           v 
          
         
           , 
          
         
           ω 
          
         
           ) 
          
         
        
          \operatorname{dist}(v, \omega) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span>表示当前速度下对应模拟轨迹与障碍物之间的最近距离。 在无障碍物的情况下 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           dist 
          
         
           ⁡ 
          
         
           ( 
          
         
           v 
          
         
           , 
          
         
           ω 
          
         
           ) 
          
         
        
          \operatorname{dist}(v, \omega) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 会是一个很大的常数值。当机器人运行采样速度在公式 (3) 范围时, 能够以最大减速度的约束实现安全减速直至避开障碍物。</p> <p><mark>注意:</mark> 这个限制条件在采样初期是得不到的，需要我们先使用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            V 
           
          
            m 
           
          
         
           ∩ 
          
          
          
            V 
           
          
            d 
           
          
         
        
          \mathbf{V}_m \cap \mathbf{V}_d 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的速度组合采样模拟出轨迹后, 计算当前速度下对应模拟轨迹与障碍物之间的最近距离, 然后看当前采样的这对速度能否在碰到障碍物之前停下来， 如果能够停下来, 那这对速度就是可接收的。如果不能停下来, 这对速度就得抛弃掉。</p> 
  <blockquote> 
   <p>我在<a href="https://github.com/CHH3213/chhRobotics/blob/master/PathPlanning/%E5%8A%A8%E6%80%81%E7%AA%97%E5%8F%A3%E6%B3%95%28DWA%29/DynamicWindowApproaches.py#L142">代码</a>中并没有采用这种做法，而是直接计算机器人当前位置（并不是模拟轨迹）与障碍物的最近距离来得到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             V 
            
           
             a 
            
           
          
         
           \mathbf{V}_a 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，算是一种比较投机的做法。</p> 
  </blockquote> </li></ul> 
<p>结合上述三类速度限制， 最终的移动机器人速度采样空间是三个速度空间的交集，即<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
           
            
            
              V 
             
            
              s 
             
            
           
             = 
            
            
            
              V 
             
            
              m 
             
            
           
             ∩ 
            
            
            
              V 
             
            
              d 
             
            
           
             ∩ 
            
            
            
              V 
             
            
              a 
             
            
           
          
          
          
          
            (4) 
           
          
         
        
       
         \tag{4} \mathbf{V}_s=\mathbf{V}_m \cap \mathbf{V}_d \cap \mathbf{V}_a 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∩</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<h4><a id="2__77"></a>2. 轨迹预测（轨迹推算）</h4> 
<ul><li> <p>在确定速度采样空间 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            V 
           
          
            s 
           
          
         
        
          \mathbf{V}_s 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83611em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.01597em;" class="mord mathbf">V</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 后，DWA算法以一定的<strong>采样间距</strong>（分辨率）在该空间均匀采样。</p> </li><li> <p>在速度空间中, 分别对线速度和角速度设置分辨率, 分别用 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            E 
           
          
            w 
           
          
         
           、 
          
          
          
            E 
           
          
            v 
           
          
         
        
          E_w 、 E_v 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 表示采样分辨率，那么采样速度组的个数就可以确定下来, 如下式所示。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            n 
           
          
            = 
           
           
           
             [ 
            
            
            
              ( 
             
             
             
               v 
              
              
              
                h 
               
              
                i 
               
              
                g 
               
              
                h 
               
              
             
            
              − 
             
             
             
               v 
              
              
              
                l 
               
              
                o 
               
              
                w 
               
              
             
            
              ) 
             
            
           
             / 
            
            
            
              E 
             
            
              v 
             
            
           
             ] 
            
           
          
            ⋅ 
           
           
           
             [ 
            
            
            
              ( 
             
             
             
               w 
              
              
              
                h 
               
              
                i 
               
              
                g 
               
              
                h 
               
              
             
            
              − 
             
             
             
               w 
              
              
              
                l 
               
              
                o 
               
              
                w 
               
              
             
            
              ) 
             
            
           
             / 
            
            
            
              E 
             
            
              w 
             
            
           
             ] 
            
           
          
         
           n=\left[\left(v_{high}-v_{low }\right) / E_v\right]\cdot\left[\left(w_{high }-w_{low }\right) / E_w\right] 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">g</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span><span class="mord mathdefault mtight">o</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.03611em; vertical-align: -0.286108em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">[</span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">(</span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">g</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span><span class="mord mathdefault mtight">o</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">)</span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">/</span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">]</span></span></span></span></span></span></span><br> 式中的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            v 
           
           
           
             h 
            
           
             i 
            
           
             g 
            
           
             h 
            
           
          
         
           , 
          
          
          
            v 
           
           
           
             l 
            
           
             o 
            
           
             w 
            
           
          
         
           , 
          
          
          
            w 
           
           
           
             h 
            
           
             i 
            
           
             g 
            
           
             h 
            
           
          
         
           , 
          
          
          
            w 
           
           
           
             l 
            
           
             o 
            
           
             w 
            
           
          
         
        
          v_{high},v_{low },w_{high },w_{low } 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">g</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span><span class="mord mathdefault mtight">o</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">i</span><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">g</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span style="margin-right: 0.02691em;" class="mord mathdefault">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.01968em;" class="mord mathdefault mtight">l</span><span class="mord mathdefault mtight">o</span><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是速度空间的上下限。</p> <p>上式说明线速度每间隔一个 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            E 
           
          
            v 
           
          
         
        
          E_v 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathdefault mtight">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 大小取一个值, 角速度每间隔一个 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            E 
           
          
            w 
           
          
         
        
          E_w 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.05764em;" class="mord mathdefault">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02691em;" class="mord mathdefault mtight">w</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 大小取一个值，由此组成了一系列的速度组。</p> </li><li> <p>当采样了一组 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           v 
          
         
           , 
          
         
           ω 
          
         
           ) 
          
         
        
          (v, \omega) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 后, 通过移动机器人（无人车辆）的<strong>运动学模型</strong>进行轨迹预测（即位置更新）。</p> </li><li> <p>因此，在轨迹预测阶段，只需要知道机器人（无人车辆）的运动学模型即可，然后在预测时间内保存预测轨迹便于后面处理。有关无人车的运动学模型可参考<a href="https://blog.csdn.net/weixin_42301220/article/details/124747072">这篇博客</a>。</p> </li><li> <p>这边不妨使用差分驱动移动机器人的运动学模型，那么轨迹预测就是计算下式：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
             
              
              
                x 
               
              
                k 
               
              
             
            
            
             
              
               
              
                = 
               
               
               
                 x 
                
                
                
                  k 
                 
                
                  − 
                 
                
                  1 
                 
                
               
              
                + 
               
              
                v 
               
              
                ⋅ 
               
              
                cos 
               
              
                ⁡ 
               
               
               
                 ( 
                
                
                
                  θ 
                 
                 
                 
                   k 
                  
                 
                   − 
                  
                 
                   1 
                  
                 
                
               
                 ) 
                
               
              
                Δ 
               
              
                t 
               
              
             
            
           
           
            
             
              
              
                y 
               
              
                k 
               
              
             
            
            
             
              
               
              
                = 
               
               
               
                 y 
                
                
                
                  k 
                 
                
                  − 
                 
                
                  1 
                 
                
               
              
                + 
               
              
                v 
               
              
                ⋅ 
               
              
                sin 
               
              
                ⁡ 
               
               
               
                 ( 
                
                
                
                  θ 
                 
                 
                 
                   k 
                  
                 
                   − 
                  
                 
                   1 
                  
                 
                
               
                 ) 
                
               
              
                Δ 
               
              
                t 
               
              
             
            
           
           
            
             
              
              
                θ 
               
              
                k 
               
              
             
            
            
             
              
               
              
                = 
               
               
               
                 θ 
                
                
                
                  k 
                 
                
                  − 
                 
                
                  1 
                 
                
               
              
                + 
               
              
                ω 
               
              
                Δ 
               
              
                t 
               
              
             
            
           
          
         
           \begin{aligned} x_k&amp;=x_{k-1}+v\cdot \cos{(\theta_{k-1})}\Delta t\\ y_k&amp;=y_{k-1}+v\cdot \sin{(\theta_{k-1})}\Delta t\\ \theta_k &amp;= \theta_{k-1}+\omega \Delta t \end{aligned} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 4.5em; vertical-align: -2em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.16em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -1.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.5em;"><span class="" style="top: -4.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span><span class="" style="top: -3.16em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span><span class="" style="top: -1.66em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.03148em;" class="mord mathdefault mtight">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br> 式中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           ( 
          
         
           x 
          
         
           , 
          
         
           y 
          
         
           , 
          
         
           θ 
          
         
           ) 
          
         
        
          (x,y,\theta) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span><span class="mclose">)</span></span></span></span></span>代表机器人的位姿，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           k 
          
         
        
          k 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span style="margin-right: 0.03148em;" class="mord mathdefault">k</span></span></span></span></span>代表采样时刻，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Δ 
          
         
           t 
          
         
        
          \Delta t 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord">Δ</span><span class="mord mathdefault">t</span></span></span></span></span>表示采样间隔。</p> </li></ul> 
<blockquote> 
 <p>上面轨迹推算这块是我比较肤浅的理解，因为按照<a href="https://www.ri.cmu.edu/pub_files/pub1/fox_dieter_1997_1/fox_dieter_1997_1.pdf" rel="nofollow">原论文</a>是需要假设相邻时间段内机器人的轨迹是圆弧，然后再进行轨迹推算，感兴趣的朋友可以直接查看原论文。</p> 
</blockquote> 
<h4><a id="3__103"></a>3. 轨迹评价</h4> 
<p>确定了机器人约束速度范围后，有一些速度模拟的轨迹是可行的， 但是还有不达标的轨迹， 这需要对采样得到的多组轨迹进行评价择优。通过标准评价轨迹， 比较评分来选出最优轨迹， 然后选取最优轨迹对应的速度作为驱动速度。对每条轨迹进行评估 的评价函数如公式 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         5 
        
       
         ) 
        
       
      
        (5) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">5</span><span class="mclose">)</span></span></span></span></span> 所示。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
           
           
             G 
            
           
             ( 
            
           
             v 
            
           
             , 
            
           
             ω 
            
           
             ) 
            
           
             = 
            
           
             σ 
            
           
             ( 
            
           
             α 
            
           
             ⋅ 
            
           
             heading 
            
           
             ⁡ 
            
           
             ( 
            
           
             v 
            
           
             , 
            
           
             ω 
            
           
             ) 
            
           
             ) 
            
           
             + 
            
           
             σ 
            
           
             ( 
            
           
             β 
            
           
             ⋅ 
            
           
             dist 
            
           
             ⁡ 
            
           
             ( 
            
           
             v 
            
           
             , 
            
           
             ω 
            
           
             ) 
            
           
             ) 
            
           
             + 
            
           
             σ 
            
           
             ( 
            
           
             γ 
            
           
             ⋅ 
            
           
             velocity 
            
           
             ⁡ 
            
           
             ( 
            
           
             v 
            
           
             , 
            
           
             ω 
            
           
             ) 
            
           
             ) 
            
           
          
          
          
          
            (5) 
           
          
         
        
       
         \tag{5} G(v, \omega)=\sigma(\alpha \cdot \operatorname{heading}(v, \omega))+\sigma(\beta \cdot \operatorname{dist}(v, \omega))+\sigma(\gamma \cdot \operatorname{velocity}(v, \omega)) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">G</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mopen">(</span><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span style="margin-right: 0.01389em;" class="mord mathrm">g</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mopen">(</span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mopen">(</span><span style="margin-right: 0.05556em;" class="mord mathdefault">γ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span style="margin-right: 0.01389em;" class="mord mathrm">v</span><span class="mord mathrm">e</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">c</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span><span style="margin-right: 0.01389em;" class="mord mathrm">y</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></span></p> 
<ul><li> <p><font color="red">heading <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            v 
           
          
            , 
           
          
            ω 
           
          
            ) 
           
          
         
           (v, \omega) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 是方位角评价函数</font>， 用作评估在当前采样速度下产生的轨迹<strong>终点位置方向</strong>与目标点连线的夹角的误差<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           Δ 
          
         
           θ 
          
         
        
          \Delta\theta 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord">Δ</span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span></span></span></span></span>；由于我们想要用评价函数越大表示越优，所以用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           π 
          
         
           − 
          
         
           Δ 
          
         
           θ 
          
         
        
          \pi-\Delta\theta 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord">Δ</span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span></span></span></span></span>来参与评价，即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           h 
          
         
           e 
          
         
           a 
          
         
           d 
          
         
           i 
          
         
           n 
          
         
           g 
          
         
           ( 
          
         
           v 
          
         
           , 
          
         
           ω 
          
         
           ) 
          
         
           = 
          
         
           π 
          
         
           − 
          
         
           Δ 
          
         
           θ 
          
         
        
          heading (v, \omega)= \pi-\Delta\theta 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">h</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span style="margin-right: 0.03588em;" class="mord mathdefault">g</span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">π</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord">Δ</span><span style="margin-right: 0.02778em;" class="mord mathdefault">θ</span></span></span></span></span>。</p> 
  <center> 
   <img src="https://images2.imgbox.com/bc/b6/Z70BRkFm_o.png" width="40%"> 
  </center></li><li> <p><font color="red"><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            dist 
           
          
            ⁡ 
           
          
            ( 
           
          
            v 
           
          
            , 
           
          
            ω 
           
          
            ) 
           
          
         
           \operatorname{dist}(v, \omega) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 是距离评价函数</font>， 表示当前速度下对应模拟轨迹与障碍物之间的最近距离；如果没有障碍物或者最近距离大于设定的阈值，那么就将其值设为一个较大的常数值。</p> </li><li> <p><font color="red">velocity <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            ( 
           
          
            v 
           
          
            , 
           
          
            ω 
           
          
            ) 
           
          
         
           (v, \omega) 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span></span></span></span></span> 是速度评价函数</font>， 表示当前的速度大小，可以直接用当前线速度的大小来表示。它越大，表示规划轨迹上的速度越快，评价得分越高。</p> </li></ul> 
<blockquote> 
 <p>以上三种评价函数只是给了个大体的意思，并不绝对，例如有的人是把评价函数作为代价，代价越小，轨迹越优。可根据自己的想法进行评价函数的设置，但无论怎么变，这三种评价函数都是需要的。</p> 
</blockquote> 
<p><font color="red"><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          α 
         
        
          、 
         
        
          β 
         
        
       
         \alpha 、 \beta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.0037em;" class="mord mathdefault">α</span><span class="mord cjk_fallback">、</span><span style="margin-right: 0.05278em;" class="mord mathdefault">β</span></span></span></span></span> 和 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          γ 
         
        
       
         \gamma 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05556em;" class="mord mathdefault">γ</span></span></span></span></span> 均为评价函数的系数</font>。由于局部路径规划的过程需要多传感器的采集, 采集信息无法做到连续, 这样也会使得评价后差别较大, 所以可以进行归一化处理（平滑处理）， 其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         σ 
        
       
      
        \sigma 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span></span></span></span></span> 表示 <font color="red">归一化。</font></p> 
<ul><li> <p>归一化处理过程如下式 (6) 所示:<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
             
              
               
                
                 
                
               
               
                
                 
                  
                 
                   σ 
                  
                 
                   ⋅ 
                  
                 
                    heading  
                  
                 
                   ( 
                  
                 
                   v 
                  
                 
                   , 
                  
                 
                   ω 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                   normalize-heading 
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   = 
                  
                  
                   
                   
                     heading 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                   
                    
                    
                      ∑ 
                     
                     
                     
                       i 
                      
                     
                       = 
                      
                     
                       1 
                      
                     
                    
                      n 
                     
                    
                   
                     heading 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   σ 
                  
                 
                   ⋅ 
                  
                 
                   dist 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   v 
                  
                 
                   , 
                  
                 
                   ω 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                    normalize-dist  
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   = 
                  
                  
                   
                   
                     dist 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                   
                    
                    
                      ∑ 
                     
                     
                     
                       i 
                      
                     
                       = 
                      
                     
                       1 
                      
                     
                    
                      n 
                     
                    
                   
                     dist 
                    
                   
                     ⁡ 
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                  
                 
                
               
              
              
               
                
                 
                
               
               
                
                 
                  
                 
                   σ 
                  
                 
                   ⋅ 
                  
                 
                   velocity 
                  
                 
                   ⁡ 
                  
                 
                   ( 
                  
                 
                   v 
                  
                 
                   , 
                  
                 
                   ω 
                  
                 
                   ) 
                  
                 
                   = 
                  
                 
                    normalize-velocity  
                  
                 
                   ( 
                  
                 
                   i 
                  
                 
                   ) 
                  
                 
                   = 
                  
                  
                   
                   
                      velocity  
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                   
                    
                    
                      ∑ 
                     
                     
                     
                       i 
                      
                     
                       = 
                      
                     
                       1 
                      
                     
                    
                      n 
                     
                    
                   
                      velocity  
                    
                   
                     ( 
                    
                   
                     i 
                    
                   
                     ) 
                    
                   
                  
                 
                
               
              
             
            
            
            
            
              (6) 
             
            
           
          
         
           \tag{6} \begin{aligned} &amp;\sigma \cdot \text { heading }(v, \omega)=\text {normalize-heading}(i)=\frac{\operatorname{heading}(i)}{\sum_{i=1}^n \operatorname{heading}(i)} \\ &amp;\sigma \cdot \operatorname{dist}(v, \omega)=\text { normalize-dist }(i)=\frac{\operatorname{dist}(i)}{\sum_{i=1}^n \operatorname{dist}(i)}\\ &amp;\sigma \cdot \operatorname{velocity}(v, \omega)=\text { normalize-velocity }(i)=\frac{\text { velocity }(i)}{\sum_{i=1}^n \text { velocity }(i)} \end{aligned} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 8.16301em; vertical-align: -3.8315em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.3315em;"><span class="" style="top: -6.3315em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"></span></span><span class="" style="top: -3.6105em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"></span></span><span class="" style="top: -0.889499em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.8315em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 4.3315em;"><span class="" style="top: -6.3315em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord text"><span class="mord"> heading </span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord text"><span class="mord">normalize-heading</span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.30571em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span style="margin-right: 0.01389em;" class="mord mathrm">g</span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mord mathrm">h</span><span class="mord mathrm">e</span><span class="mord mathrm">a</span><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span style="margin-right: 0.01389em;" class="mord mathrm">g</span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.994002em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.6105em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord text"><span class="mord"> normalize-dist </span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.30571em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mord mathrm">d</span><span class="mord mathrm">i</span><span class="mord mathrm">s</span><span class="mord mathrm">t</span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.994002em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -0.889499em;"><span class="pstrut" style="height: 3.427em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">σ</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop"><span style="margin-right: 0.01389em;" class="mord mathrm">v</span><span class="mord mathrm">e</span><span class="mord mathrm">l</span><span class="mord mathrm">o</span><span class="mord mathrm">c</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span><span style="margin-right: 0.01389em;" class="mord mathrm">y</span></span><span class="mopen">(</span><span style="margin-right: 0.03588em;" class="mord mathdefault">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span style="margin-right: 0.03588em;" class="mord mathdefault">ω</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord text"><span class="mord"> normalize-velocity </span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.30571em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -0.000005em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord text"><span class="mord"> velocity </span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord"> velocity </span></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.994002em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 3.8315em;"><span class=""></span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height: 8.16301em; vertical-align: -3.8315em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></span></p> <p>其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           i 
          
         
        
          i 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathdefault">i</span></span></span></span></span> 代表第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           i 
          
         
        
          i 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathdefault">i</span></span></span></span></span>条模拟轨迹，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           n 
          
         
        
          n 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span> 为约束条件下的全部采样轨迹总数。由上述公式 (5) 和公式 (6) 可以得出一条满足避开障碍物并朝着目标点快速行进的路径， 使得机器人完成局部路径最优规划。</p> </li></ul> 
<p>DWA算法的流程如下图所示。</p> 
<center> 
 <img src="https://images2.imgbox.com/c7/a9/iN6FFt4X_o.png" width="40%"> 
</center> 
<h2><a id="2_Python_145"></a>2. Python实现</h2> 
<blockquote> 
 <p>完整程序请移步<a href="https://github.com/CHH3213/chhRobotics/tree/master/PathPlanning/%E5%8A%A8%E6%80%81%E7%AA%97%E5%8F%A3%E6%B3%95%28DWA%29">github仓库</a>。<br> 本次代码的<mark>参数配置</mark>和<mark>画图代码</mark>参考了<a href="https://github.com/AtsushiSakai/PythonRobotics/blob/master/PathPlanning/DynamicWindowApproach/dynamic_window_approach.py">AtsushiSakai/PythonRobotics </a>。</p> 
</blockquote> 
<h3><a id="21__150"></a>2.1 参数配置</h3> 
<p>使用一个类来保存需要设置的参数。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> copy
<span class="token keyword">from</span> celluloid <span class="token keyword">import</span> Camera  <span class="token comment"># 保存动图时用，pip install celluloid</span>
<span class="token keyword">import</span> math

<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    simulation parameter class
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># robot parameter</span>
        <span class="token comment"># 线速度边界</span>
        self<span class="token punctuation">.</span>v_max <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># [m/s]</span>
        self<span class="token punctuation">.</span>v_min <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span>  <span class="token comment"># [m/s]</span>
        <span class="token comment"># 角速度边界</span>
        self<span class="token punctuation">.</span>w_max <span class="token operator">=</span> <span class="token number">40.0</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180.0</span>  <span class="token comment"># [rad/s]</span>
        self<span class="token punctuation">.</span>w_min <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40.0</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180.0</span>  <span class="token comment"># [rad/s]</span>
        <span class="token comment"># 线加速度和角加速度最大值</span>
        self<span class="token punctuation">.</span>a_vmax <span class="token operator">=</span> <span class="token number">0.2</span>  <span class="token comment"># [m/ss]</span>
        self<span class="token punctuation">.</span>a_wmax <span class="token operator">=</span> <span class="token number">40.0</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180.0</span>  <span class="token comment"># [rad/ss]</span>
        <span class="token comment"># 采样分辨率 </span>
        self<span class="token punctuation">.</span>v_sample <span class="token operator">=</span> <span class="token number">0.01</span>  <span class="token comment"># [m/s]</span>
        self<span class="token punctuation">.</span>w_sample <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">180.0</span>  <span class="token comment"># [rad/s]</span>
        <span class="token comment"># 离散时间间隔</span>
        self<span class="token punctuation">.</span>dt <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># [s] Time tick for motion prediction</span>
        <span class="token comment"># 轨迹推算时间长度</span>
        self<span class="token punctuation">.</span>predict_time <span class="token operator">=</span> <span class="token number">3.0</span>  <span class="token comment"># [s]</span>
        <span class="token comment"># 轨迹评价函数系数</span>
        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> <span class="token number">0.15</span>
        self<span class="token punctuation">.</span>beta <span class="token operator">=</span> <span class="token number">1.0</span>
        self<span class="token punctuation">.</span>gamma <span class="token operator">=</span> <span class="token number">1.0</span>

        <span class="token comment"># Also used to check if goal is reached in both types</span>
        self<span class="token punctuation">.</span>robot_radius <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># [m] for collision check</span>
        
        self<span class="token punctuation">.</span>judge_distance <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment"># 若与障碍物的最小距离大于阈值（例如这里设置的阈值为robot_radius+0.2）,则设为一个较大的常值</span>

        <span class="token comment"># 障碍物位置 [x(m) y(m), ....]</span>
        self<span class="token punctuation">.</span>ob <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">4.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">6.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">9.0</span><span class="token punctuation">,</span> <span class="token number">11.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12.0</span><span class="token punctuation">,</span> <span class="token number">13.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">15.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">13.0</span><span class="token punctuation">,</span> <span class="token number">13.0</span><span class="token punctuation">]</span>
                    <span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 目标点位置</span>
        self<span class="token punctuation">.</span>target <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>值得注意的是，这边障碍物只给了位置，并没有给定大小，因为这边相当于把障碍物的大小合并到了机器人本体大小上，也即代码中的<code>robot_radius</code>上。</p> 
<h3><a id="22__215"></a>2.2 机器人运动学模型</h3> 
<p>主要用于轨迹推算。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">KinematicModel</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span>control<span class="token punctuation">,</span>dt<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""机器人运动学模型

  Args:
      state (_type_): 状态量---x,y,yaw,v,w
      control (_type_): 控制量---v,w,线速度和角速度
      dt (_type_): 离散时间

  Returns:
      _type_: 下一步的状态
  """</span>
  state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> control<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> dt
  state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+=</span> control<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> dt
  state<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> control<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> dt
  state<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> control<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  state<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> control<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

  <span class="token keyword">return</span> state

</code></pre> 
<p>在这里顺便保存了线速度和角速度作为状态分量，便于后面轨迹计算。</p> 
<h3><a id="23_DWA_244"></a>2.3 DWA算法类实现</h3> 
<p>通过一个类来实现DWA算法的速度采样、轨迹预测、轨迹评价三个主要步骤。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">DWA</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>config<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""初始化

        Args:
            config (_type_): 参数类
        """</span>
        self<span class="token punctuation">.</span>dt<span class="token operator">=</span>config<span class="token punctuation">.</span>dt
        self<span class="token punctuation">.</span>v_min<span class="token operator">=</span>config<span class="token punctuation">.</span>v_min
        self<span class="token punctuation">.</span>w_min<span class="token operator">=</span>config<span class="token punctuation">.</span>w_min
        self<span class="token punctuation">.</span>v_max<span class="token operator">=</span>config<span class="token punctuation">.</span>v_max
        self<span class="token punctuation">.</span>w_max<span class="token operator">=</span>config<span class="token punctuation">.</span>w_max
        self<span class="token punctuation">.</span>predict_time <span class="token operator">=</span> config<span class="token punctuation">.</span>predict_time
        self<span class="token punctuation">.</span>a_vmax <span class="token operator">=</span> config<span class="token punctuation">.</span>a_vmax
        self<span class="token punctuation">.</span>a_wmax <span class="token operator">=</span> config<span class="token punctuation">.</span>a_wmax
        self<span class="token punctuation">.</span>v_sample <span class="token operator">=</span> config<span class="token punctuation">.</span>v_sample <span class="token comment"># 线速度采样分辨率</span>
        self<span class="token punctuation">.</span>w_sample <span class="token operator">=</span> config<span class="token punctuation">.</span>w_sample <span class="token comment"># 角速度采样分辨率</span>
        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> config<span class="token punctuation">.</span>alpha
        self<span class="token punctuation">.</span>beta <span class="token operator">=</span> config<span class="token punctuation">.</span>beta
        self<span class="token punctuation">.</span>gamma <span class="token operator">=</span> config<span class="token punctuation">.</span>gamma
        self<span class="token punctuation">.</span>radius <span class="token operator">=</span> config<span class="token punctuation">.</span>robot_radius
        self<span class="token punctuation">.</span>judge_distance <span class="token operator">=</span> config<span class="token punctuation">.</span>judge_distance

    <span class="token keyword">def</span> <span class="token function">dwa_control</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>state<span class="token punctuation">,</span>goal<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""滚动窗口算法入口

        Args:
            state (_type_): 机器人当前状态--[x,y,yaw,v,w]
            goal (_type_): 目标点位置，[x,y]

            obstacle (_type_): 障碍物位置，dim:[num_ob,2]

        Returns:
            _type_: 控制量、轨迹（便于绘画）
        """</span>
        control<span class="token punctuation">,</span>trajectory <span class="token operator">=</span> self<span class="token punctuation">.</span>trajectory_evaluation<span class="token punctuation">(</span>state<span class="token punctuation">,</span>goal<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span>
        <span class="token keyword">return</span> control<span class="token punctuation">,</span>trajectory


    <span class="token keyword">def</span> <span class="token function">cal_dynamic_window_vel</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>v<span class="token punctuation">,</span>w<span class="token punctuation">,</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""速度采样,得到速度空间窗口

        Args:
            v (_type_): 当前时刻线速度
            w (_type_): 当前时刻角速度
            state (_type_): 当前机器人状态
            obstacle (_type_): 障碍物位置
        Returns:
            [v_low,v_high,w_low,w_high]: 最终采样后的速度空间
        """</span>
        Vm <span class="token operator">=</span> self<span class="token punctuation">.</span>__cal_vel_limit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        Vd <span class="token operator">=</span> self<span class="token punctuation">.</span>__cal_accel_limit<span class="token punctuation">(</span>v<span class="token punctuation">,</span>w<span class="token punctuation">)</span>
        Va <span class="token operator">=</span> self<span class="token punctuation">.</span>__cal_obstacle_limit<span class="token punctuation">(</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span>
        a <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Vm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Vd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Va<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Vm<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Vd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Va<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Vm<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Vd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Va<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        d <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Vm<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Vd<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Va<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__cal_vel_limit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算速度边界限制Vm

        Returns:
            _type_: 速度边界限制后的速度空间Vm
        """</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>v_min<span class="token punctuation">,</span>self<span class="token punctuation">.</span>v_max<span class="token punctuation">,</span>self<span class="token punctuation">.</span>w_min<span class="token punctuation">,</span>self<span class="token punctuation">.</span>w_max<span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">__cal_accel_limit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>v<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算加速度限制Vd

        Args:
            v (_type_): 当前时刻线速度
            w (_type_): 当前时刻角速度
        Returns: 
            _type_:考虑加速度时的速度空间Vd
        """</span>
        v_low <span class="token operator">=</span> v<span class="token operator">-</span>self<span class="token punctuation">.</span>a_vmax<span class="token operator">*</span>self<span class="token punctuation">.</span>dt
        v_high <span class="token operator">=</span> v<span class="token operator">+</span>self<span class="token punctuation">.</span>a_vmax<span class="token operator">*</span>self<span class="token punctuation">.</span>dt
        w_low <span class="token operator">=</span> w<span class="token operator">-</span>self<span class="token punctuation">.</span>a_wmax<span class="token operator">*</span>self<span class="token punctuation">.</span>dt
        w_high <span class="token operator">=</span> w<span class="token operator">+</span>self<span class="token punctuation">.</span>a_wmax<span class="token operator">*</span>self<span class="token punctuation">.</span>dt
        <span class="token keyword">return</span> <span class="token punctuation">[</span>v_low<span class="token punctuation">,</span> v_high<span class="token punctuation">,</span>w_low<span class="token punctuation">,</span> w_high<span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">__cal_obstacle_limit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""环境障碍物限制Va

        Args:
            state (_type_): 当前机器人状态
            obstacle (_type_): 障碍物位置

        Returns:
            _type_: 某一时刻移动机器人不与周围障碍物发生碰撞的速度空间Va
        """</span>
        v_low<span class="token operator">=</span>self<span class="token punctuation">.</span>v_min
        v_high <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_dist<span class="token punctuation">(</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token operator">*</span>self<span class="token punctuation">.</span>a_vmax<span class="token punctuation">)</span>
        w_low <span class="token operator">=</span>self<span class="token punctuation">.</span>w_min
        w_high <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>self<span class="token punctuation">.</span>_dist<span class="token punctuation">(</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token operator">*</span>self<span class="token punctuation">.</span>a_wmax<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>v_low<span class="token punctuation">,</span>v_high<span class="token punctuation">,</span>w_low<span class="token punctuation">,</span>w_high<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">trajectory_predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>state_init<span class="token punctuation">,</span> v<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""轨迹推算

        Args:
            state_init (_type_): 当前状态---x,y,yaw,v,w
            v (_type_): 当前时刻线速度
            w (_type_): 当前时刻线速度

        Returns:
            _type_: _description_
        """</span>
        state <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>state_init<span class="token punctuation">)</span>
        trajectory <span class="token operator">=</span> state
        time <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 在预测时间段内</span>
        <span class="token keyword">while</span> time <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>predict_time<span class="token punctuation">:</span>
            x <span class="token operator">=</span> KinematicModel<span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">,</span>w<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>dt<span class="token punctuation">)</span> <span class="token comment"># 运动学模型</span>
            trajectory <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>trajectory<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
            time <span class="token operator">+=</span> self<span class="token punctuation">.</span>dt

        <span class="token keyword">return</span> trajectory

    <span class="token keyword">def</span> <span class="token function">trajectory_evaluation</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>state<span class="token punctuation">,</span>goal<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""轨迹评价函数,评价越高，轨迹越优

        Args:
            state (_type_): 当前状态---x,y,yaw,v,w
            dynamic_window_vel (_type_): 采样的速度空间窗口---[v_low,v_high,w_low,w_high]
            goal (_type_): 目标点位置，[x,y]
            obstacle (_type_): 障碍物位置，dim:[num_ob,2]

        Returns:
            _type_: 最优控制量、最优轨迹
        """</span>
        G_max <span class="token operator">=</span> <span class="token operator">-</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span> <span class="token comment"># 最优评价</span>
        trajectory_opt <span class="token operator">=</span> state <span class="token comment"># 最优轨迹</span>
        control_opt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span><span class="token number">0.</span><span class="token punctuation">]</span> <span class="token comment"># 最优控制</span>
        dynamic_window_vel <span class="token operator">=</span> self<span class="token punctuation">.</span>cal_dynamic_window_vel<span class="token punctuation">(</span>state<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> state<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span> <span class="token comment"># 第1步--计算速度空间</span>
        
        <span class="token comment"># sum_heading,sum_dist,sum_vel = 0,0,0 # 统计全部采样轨迹的各个评价之和，便于评价的归一化</span>
        <span class="token comment"># # 在本次实验中，不进行归一化也可实现该有的效果。</span>
        <span class="token comment"># for v in np.arange(dynamic_window_vel[0],dynamic_window_vel[1],self.v_sample):</span>
        <span class="token comment">#     for w in np.arange(dynamic_window_vel[2], dynamic_window_vel[3], self.w_sample):   </span>
        <span class="token comment">#         trajectory = self.trajectory_predict(state, v, w)  </span>

        <span class="token comment">#         heading_eval = self.alpha*self.__heading(trajectory,goal)</span>
        <span class="token comment">#         dist_eval = self.beta*self.__dist(trajectory,obstacle)</span>
        <span class="token comment">#         vel_eval = self.gamma*self.__velocity(trajectory)</span>
        <span class="token comment">#         sum_vel+=vel_eval</span>
        <span class="token comment">#         sum_dist+=dist_eval</span>
        <span class="token comment">#         sum_heading +=heading_eval</span>

        sum_heading<span class="token punctuation">,</span>sum_dist<span class="token punctuation">,</span>sum_vel <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span> <span class="token comment"># 不进行归一化</span>
        <span class="token comment"># 在速度空间中按照预先设定的分辨率采样</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>dynamic_window_vel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dynamic_window_vel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>v_sample<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> w <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>dynamic_window_vel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dynamic_window_vel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>w_sample<span class="token punctuation">)</span><span class="token punctuation">:</span>

                trajectory <span class="token operator">=</span> self<span class="token punctuation">.</span>trajectory_predict<span class="token punctuation">(</span>state<span class="token punctuation">,</span> v<span class="token punctuation">,</span> w<span class="token punctuation">)</span>  <span class="token comment"># 第2步--轨迹推算</span>

                heading_eval <span class="token operator">=</span> self<span class="token punctuation">.</span>alpha<span class="token operator">*</span>self<span class="token punctuation">.</span>__heading<span class="token punctuation">(</span>trajectory<span class="token punctuation">,</span>goal<span class="token punctuation">)</span><span class="token operator">/</span>sum_heading
                dist_eval <span class="token operator">=</span> self<span class="token punctuation">.</span>beta<span class="token operator">*</span>self<span class="token punctuation">.</span>__dist<span class="token punctuation">(</span>trajectory<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token operator">/</span>sum_dist
                vel_eval <span class="token operator">=</span> self<span class="token punctuation">.</span>gamma<span class="token operator">*</span>self<span class="token punctuation">.</span>__velocity<span class="token punctuation">(</span>trajectory<span class="token punctuation">)</span><span class="token operator">/</span>sum_vel
                G <span class="token operator">=</span> heading_eval<span class="token operator">+</span>dist_eval<span class="token operator">+</span>vel_eval <span class="token comment"># 第3步--轨迹评价</span>

                <span class="token keyword">if</span> G_max<span class="token operator">&lt;=</span>G<span class="token punctuation">:</span>
                    G_max <span class="token operator">=</span> G
                    trajectory_opt <span class="token operator">=</span> trajectory
                    control_opt <span class="token operator">=</span> <span class="token punctuation">[</span>v<span class="token punctuation">,</span>w<span class="token punctuation">]</span>

        <span class="token keyword">return</span> control_opt<span class="token punctuation">,</span> trajectory_opt

    <span class="token keyword">def</span> <span class="token function">_dist</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>state<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算当前移动机器人距离障碍物最近的几何距离

        Args:
            state (_type_): 当前机器人状态
            obstacle (_type_): 障碍物位置

        Returns:
            _type_: 移动机器人距离障碍物最近的几何距离
        """</span>
        ox <span class="token operator">=</span> obstacle<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        oy <span class="token operator">=</span> obstacle<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        dx <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">-</span> ox<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
        dy <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">]</span> <span class="token operator">-</span> oy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
        r <span class="token operator">=</span> np<span class="token punctuation">.</span>hypot<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__dist</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>trajectory<span class="token punctuation">,</span>obstacle<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""距离评价函数
        表示当前速度下对应模拟轨迹与障碍物之间的最近距离；
        如果没有障碍物或者最近距离大于设定的阈值，那么就将其值设为一个较大的常数值。
        Args:
            trajectory (_type_): 轨迹，dim:[n,5]
            
            obstacle (_type_): 障碍物位置，dim:[num_ob,2]

        Returns:
            _type_: _description_
        """</span>
        ox <span class="token operator">=</span> obstacle<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        oy <span class="token operator">=</span> obstacle<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        dx <span class="token operator">=</span> trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> ox<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
        dy <span class="token operator">=</span> trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> oy<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">]</span>
        r <span class="token operator">=</span> np<span class="token punctuation">.</span>hypot<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token keyword">if</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>r <span class="token operator">&lt;</span>self<span class="token punctuation">.</span>radius<span class="token operator">+</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> self<span class="token punctuation">.</span>judge_distance

    <span class="token keyword">def</span> <span class="token function">__heading</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>trajectory<span class="token punctuation">,</span> goal<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""方位角评价函数
        评估在当前采样速度下产生的轨迹终点位置方向与目标点连线的夹角的误差

        Args:
            trajectory (_type_): 轨迹，dim:[n,5]
            goal (_type_): 目标点位置[x,y]

        Returns:
            _type_: 方位角评价数值
        """</span>
        dx <span class="token operator">=</span> goal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> trajectory<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
        dy <span class="token operator">=</span> goal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> trajectory<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
        error_angle <span class="token operator">=</span> math<span class="token punctuation">.</span>atan2<span class="token punctuation">(</span>dy<span class="token punctuation">,</span> dx<span class="token punctuation">)</span>
        cost_angle <span class="token operator">=</span> error_angle <span class="token operator">-</span> trajectory<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
        cost <span class="token operator">=</span> math<span class="token punctuation">.</span>pi<span class="token operator">-</span><span class="token builtin">abs</span><span class="token punctuation">(</span>cost_angle<span class="token punctuation">)</span>

        <span class="token keyword">return</span> cost

    <span class="token keyword">def</span> <span class="token function">__velocity</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>trajectory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""速度评价函数， 表示当前的速度大小，可以用模拟轨迹末端位置的线速度的大小来表示

        Args:
            trajectory (_type_): 轨迹，dim:[n,5]

        Returns:
            _type_: 速度评价
        """</span>
        <span class="token keyword">return</span> trajectory<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>

</code></pre> 
<p>从后面的实验效果上看，这边没有进行归一化也是可以的。</p> 
<h3><a id="24__487"></a>2.4 画图</h3> 
<p>主要用于机器人和方向箭头的绘制。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">plot_arrow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> yaw<span class="token punctuation">,</span> length<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># pragma: no cover</span>
    plt<span class="token punctuation">.</span>arrow<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> length <span class="token operator">*</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">,</span> length <span class="token operator">*</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">,</span>
              head_length<span class="token operator">=</span>width<span class="token punctuation">,</span> head_width<span class="token operator">=</span>width<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">plot_robot</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> yaw<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># pragma: no cover</span>
        circle <span class="token operator">=</span> plt<span class="token punctuation">.</span>Circle<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>robot_radius<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">"b"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add_artist<span class="token punctuation">(</span>circle<span class="token punctuation">)</span>
        out_x<span class="token punctuation">,</span> out_y <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                        np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>yaw<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> config<span class="token punctuation">.</span>robot_radius<span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> out_x<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> out_y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-k"</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="25__505"></a>2.5 主函数</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># initial state [x(m), y(m), yaw(rad), v(m/s), omega(rad/s)]</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>pi <span class="token operator">/</span> <span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># goal position [x(m), y(m)]</span>
    goal <span class="token operator">=</span> config<span class="token punctuation">.</span>target

    <span class="token comment"># input [forward speed, yaw_rate]</span>

    trajectory <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    ob <span class="token operator">=</span> config<span class="token punctuation">.</span>ob
    dwa <span class="token operator">=</span> DWA<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    fig<span class="token operator">=</span>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    camera <span class="token operator">=</span> Camera<span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        u<span class="token punctuation">,</span> predicted_trajectory <span class="token operator">=</span> dwa<span class="token punctuation">.</span>dwa_control<span class="token punctuation">(</span>x<span class="token punctuation">,</span>goal<span class="token punctuation">,</span> ob<span class="token punctuation">)</span>

        x <span class="token operator">=</span> KinematicModel<span class="token punctuation">(</span>x<span class="token punctuation">,</span> u<span class="token punctuation">,</span> config<span class="token punctuation">.</span>dt<span class="token punctuation">)</span>  <span class="token comment"># simulate robot</span>
        trajectory <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>trajectory<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># store state history</span>
        plt<span class="token punctuation">.</span>cla<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># for stopping simulation with the esc key.</span>
        plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>mpl_connect<span class="token punctuation">(</span>
            <span class="token string">'key_release_event'</span><span class="token punctuation">,</span>
            <span class="token keyword">lambda</span> event<span class="token punctuation">:</span> <span class="token punctuation">[</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">if</span> event<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token string">'escape'</span> <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>predicted_trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> predicted_trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-g"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"xr"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>goal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> goal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"xb"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ob<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ob<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"ok"</span><span class="token punctuation">)</span>
        plot_robot<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span>
        plot_arrow<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">"equal"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>

        <span class="token comment"># check reaching goal</span>
        dist_to_goal <span class="token operator">=</span> math<span class="token punctuation">.</span>hypot<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> goal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> goal<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> dist_to_goal <span class="token operator">&lt;=</span> config<span class="token punctuation">.</span>robot_radius<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Goal!!"</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># camera.snap()</span>
        <span class="token comment"># print(x)</span>
        <span class="token comment"># print(u)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Done"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> trajectory<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"-r"</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
    <span class="token comment"># camera.snap()</span>
    <span class="token comment"># animation = camera.animate()</span>
    <span class="token comment"># animation.save('trajectory.gif')</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


main<span class="token punctuation">(</span>Config<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行主函数，即可得到下图所示的效果：</p> 
<p><img src="https://images2.imgbox.com/e5/fc/Ej9zJ0tT_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="3_c_569"></a>3. c++实现</h2> 
<p>由于在自动驾驶中算法实现一般使用C++，所以我也使用C++实现了相关功能，代码结构与python代码实现类似，这边就不再做相关代码解释了。完整代码详见<a href="https://github.com/CHH3213/chhRobotics_CPP/tree/master/PathPlanning/Dynamic_Window_Approach">另一个github仓库</a>。</p> 
<h2><a id="4__572"></a>4. 总结</h2> 
<p>起初在不了解之前我以为DWA算法是一种很难实现的算法，但最近因为毕设想要用到这个传统方法进行对比，所以花了点时间去看别人写的论文，发现DWA算法的原理比较简单，代码实现也比较简单，并没有我想象中得那么困难。所以还是不能有<strong>畏难心理</strong>！</p> 
<p>在实际调试过程中发现评价函数的设置非常重要，设置的不好，以及参数设置的不好（例如评价函数的系数），那么就极有可能算法失效。也看了一些别人写的论文，针对DWA算法的改进基本也是集中在评价函数上，所以如果需要改进效果的话不妨从这上面入手。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/683a216e8fba5f79d9e356a54d9f544b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA结课作品——超市管理系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3b80fd25cb063ad8071a3c602dcf540d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">飞机大战--python基础项目(附源码和原理讲解)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>