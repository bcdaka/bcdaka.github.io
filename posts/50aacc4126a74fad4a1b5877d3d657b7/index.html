<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title># RocketMQ 实战：模拟电商网站场景综合案例（六） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/50aacc4126a74fad4a1b5877d3d657b7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="# RocketMQ 实战：模拟电商网站场景综合案例（六）">
  <meta property="og:description" content="RocketMQ 实战：模拟电商网站场景综合案例（六） 一、RocketMQ 实战 ：项目公共类介绍 1、ID 生成器 ：IDWorker：Twitter 雪花算法。 在 shop-common 工程模块中，IDWorker.java 是 ID 生成器公共类，运用 Twitter 雪花算法，自动生成项目 ID，而不会存在重复现象。
package com.itheima.utils; public class IDWorker { /** * 起始的时间戳 */ private final static long START_STMP = 1480166465631L; /** * 每一部分占用的位数 */ private final static long SEQUENCE_BIT = 12; //序列号占用的位数 private final static long MACHINE_BIT = 5; //机器标识占用的位数 private final static long DATACENTER_BIT = 5;//数据中心占用的位数 /** * 每一部分的最大值 */ private final static long MAX_DATACENTER_NUM = -1L ^ (-1L &lt;&lt; DATACENTER_BIT); private final static long MAX_MACHINE_NUM = -1L ^ (-1L &lt;&lt; MACHINE_BIT); private final static long MAX_SEQUENCE = -1L ^ (-1L &lt;&lt; SEQUENCE_BIT); /** * 每一部分向左的位移 */ private final static long MACHINE_LEFT = SEQUENCE_BIT; private final static long DATACENTER_LEFT = SEQUENCE_BIT &#43; MACHINE_BIT; private final static long TIMESTMP_LEFT = DATACENTER_LEFT &#43; DATACENTER_BIT; private long datacenterId; //数据中心 private long machineId; //机器标识 private long sequence = 0L; //序列号 private long lastStmp = -1L;//上一次时间戳 public IDWorker(long datacenterId, long machineId) { if (datacenterId &gt; MAX_DATACENTER_NUM || datacenterId &lt; 0) { throw new IllegalArgumentException(&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-12T17:07:12+08:00">
    <meta property="article:modified_time" content="2024-06-12T17:07:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title"># RocketMQ 实战：模拟电商网站场景综合案例（六）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="RocketMQ__0"></a>RocketMQ 实战：模拟电商网站场景综合案例（六）</h2> 
<h3><a id="RocketMQ___2"></a>一、RocketMQ 实战 ：项目公共类介绍</h3> 
<h4><a id="1ID__IDWorkerTwitter__4"></a>1、ID 生成器 ：IDWorker：Twitter 雪花算法。</h4> 
<p>在 shop-common 工程模块中，IDWorker.java 是 ID 生成器公共类，运用 Twitter 雪花算法，自动生成项目 ID，而不会存在重复现象。</p> 
<pre><code class="prism language-bash">
package com.itheima.utils<span class="token punctuation">;</span>

public class IDWorker <span class="token punctuation">{<!-- --></span>

    /**
     * 起始的时间戳
     */
    private final static long START_STMP <span class="token operator">=</span> 1480166465631L<span class="token punctuation">;</span>

    /**
     * 每一部分占用的位数
     */
    private final static long SEQUENCE_BIT <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> //序列号占用的位数
    private final static long MACHINE_BIT <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>   //机器标识占用的位数
    private final static long DATACENTER_BIT <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>//数据中心占用的位数

    /**
     * 每一部分的最大值
     */
    private final static long MAX_DATACENTER_NUM <span class="token operator">=</span> <span class="token parameter variable">-1L</span> ^ <span class="token punctuation">(</span>-1L <span class="token operator">&lt;&lt;</span> DATACENTER_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    private final static long MAX_MACHINE_NUM <span class="token operator">=</span> <span class="token parameter variable">-1L</span> ^ <span class="token punctuation">(</span>-1L <span class="token operator">&lt;&lt;</span> MACHINE_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    private final static long MAX_SEQUENCE <span class="token operator">=</span> <span class="token parameter variable">-1L</span> ^ <span class="token punctuation">(</span>-1L <span class="token operator">&lt;&lt;</span> SEQUENCE_BIT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    /**
     * 每一部分向左的位移
     */
    private final static long MACHINE_LEFT <span class="token operator">=</span> SEQUENCE_BIT<span class="token punctuation">;</span>
    private final static long DATACENTER_LEFT <span class="token operator">=</span> SEQUENCE_BIT + MACHINE_BIT<span class="token punctuation">;</span>
    private final static long TIMESTMP_LEFT <span class="token operator">=</span> DATACENTER_LEFT + DATACENTER_BIT<span class="token punctuation">;</span>

    private long datacenterId<span class="token punctuation">;</span>  //数据中心
    private long machineId<span class="token punctuation">;</span>     //机器标识
    private long sequence <span class="token operator">=</span> 0L<span class="token punctuation">;</span> //序列号
    private long lastStmp <span class="token operator">=</span> -1L<span class="token punctuation">;</span>//上一次时间戳

    public IDWorker<span class="token punctuation">(</span>long datacenterId, long machineId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>datacenterId <span class="token operator">&gt;</span> MAX_DATACENTER_NUM <span class="token operator">||</span> datacenterId <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            throw new IllegalArgumentException<span class="token punctuation">(</span><span class="token string">"datacenterId can't be greater than MAX_DATACENTER_NUM or less than 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>machineId <span class="token operator">&gt;</span> MAX_MACHINE_NUM <span class="token operator">||</span> machineId <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            throw new IllegalArgumentException<span class="token punctuation">(</span><span class="token string">"machineId can't be greater than MAX_MACHINE_NUM or less than 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        this.datacenterId <span class="token operator">=</span> datacenterId<span class="token punctuation">;</span>
        this.machineId <span class="token operator">=</span> machineId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 产生下一个ID
     *
     * @return
     */
    public synchronized long <span class="token function-name function">nextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        long currStmp <span class="token operator">=</span> getNewstmp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currStmp <span class="token operator">&lt;</span> lastStmp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            throw new RuntimeException<span class="token punctuation">(</span><span class="token string">"Clock moved backwards.  Refusing to generate id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>currStmp <span class="token operator">==</span> lastStmp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            //相同毫秒内，序列号自增
            sequence <span class="token operator">=</span> <span class="token punctuation">(</span>sequence + <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> MAX_SEQUENCE<span class="token punctuation">;</span>
            //同一毫秒的序列数已经达到最大
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sequence <span class="token operator">==</span> 0L<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                currStmp <span class="token operator">=</span> getNextMill<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            //不同毫秒内，序列号置为0
            sequence <span class="token operator">=</span> 0L<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        lastStmp <span class="token operator">=</span> currStmp<span class="token punctuation">;</span>

        <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>currStmp - START_STMP<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> TIMESTMP_LEFT //时间戳部分
                <span class="token operator">|</span> datacenterId <span class="token operator">&lt;&lt;</span> DATACENTER_LEFT       //数据中心部分
                <span class="token operator">|</span> machineId <span class="token operator">&lt;&lt;</span> MACHINE_LEFT             //机器标识部分
                <span class="token operator">|</span> sequence<span class="token punctuation">;</span>                             //序列号部分
    <span class="token punctuation">}</span>

    private long <span class="token function-name function">getNextMill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        long mill <span class="token operator">=</span> getNewstmp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>mill <span class="token operator">&lt;=</span> lastStmp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mill <span class="token operator">=</span> getNewstmp<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token builtin class-name">return</span> mill<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    private long <span class="token function-name function">getNewstmp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> System.currentTimeMillis<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        IDWorker idWorker <span class="token operator">=</span> new IDWorker<span class="token punctuation">(</span><span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i++<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            System.out.println<span class="token punctuation">(</span>idWorker.nextId<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/f3/c6/KtDkYxev_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_113"></a>2、异常处理类：</h4> 
<p>在 shop-common 工程模块中，<br> CustomerException.java ：自定义异常公共类，CastException.java ：异常抛出公共类。</p> 
<pre><code class="prism language-bash">package com.itheima.exception<span class="token punctuation">;</span>

<span class="token function">import</span> com.itheima.constant.ShopCode<span class="token punctuation">;</span>
<span class="token function">import</span> lombok.extern.slf4j.Slf4j<span class="token punctuation">;</span>

/**
 * 异常抛出类
 */
@Slf4j
public class CastException <span class="token punctuation">{<!-- --></span>
    public static void cast<span class="token punctuation">(</span>ShopCode shopCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log.error<span class="token punctuation">(</span>shopCode.toString<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        throw new CustomerException<span class="token punctuation">(</span>shopCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-bash">
package com.itheima.exception<span class="token punctuation">;</span>

<span class="token function">import</span> com.itheima.constant.ShopCode<span class="token punctuation">;</span>

/**
 * 自定义异常
 */
public class CustomerException extends RuntimeException<span class="token punctuation">{<!-- --></span>

    private ShopCode shopCode<span class="token punctuation">;</span>

    public CustomerException<span class="token punctuation">(</span>ShopCode shopCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.shopCode <span class="token operator">=</span> shopCode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="3__ShopCode_158"></a>3、常量类 ： ShopCode：系统状态类</h4> 
<p>在 shop-common 工程模块中，ShopCode.java ：是系统状态公共类。</p> 
<pre><code class="prism language-bash">
package com.itheima.constant<span class="token punctuation">;</span>

/**
 * @author Think
 */

public enum ShopCode <span class="token punctuation">{<!-- --></span>
    //正确
    SHOP_SUCCESS<span class="token punctuation">(</span>true, <span class="token number">1</span>, <span class="token string">"正确"</span><span class="token punctuation">)</span>,
    //错误
    SHOP_FAIL<span class="token punctuation">(</span>false, <span class="token number">0</span>, <span class="token string">"错误"</span><span class="token punctuation">)</span>,

    //付款
    SHOP_USER_MONEY_PAID<span class="token punctuation">(</span>true, <span class="token number">1</span>, <span class="token string">"付款"</span><span class="token punctuation">)</span>,
    //退款
    SHOP_USER_MONEY_REFUND<span class="token punctuation">(</span>true, <span class="token number">2</span>, <span class="token string">"退款"</span><span class="token punctuation">)</span>,
    //订单未确认
    SHOP_ORDER_NO_CONFIRM<span class="token punctuation">(</span>false, <span class="token number">0</span>, <span class="token string">"订单未确认"</span><span class="token punctuation">)</span>,
    //订单已确认
    SHOP_ORDER_CONFIRM<span class="token punctuation">(</span>true, <span class="token number">1</span>, <span class="token string">"订单已经确认"</span><span class="token punctuation">)</span>,
    //订单已取消
    SHOP_ORDER_CANCEL<span class="token punctuation">(</span>false, <span class="token number">2</span>, <span class="token string">"订单已取消"</span><span class="token punctuation">)</span>,
    //订单已取消
    SHOP_ORDER_INVALID<span class="token punctuation">(</span>false, <span class="token number">3</span>, <span class="token string">"订单无效"</span><span class="token punctuation">)</span>,
    //订单已取消
    SHOP_ORDER_RETURNED<span class="token punctuation">(</span>false, <span class="token number">4</span>, <span class="token string">"订单已退货"</span><span class="token punctuation">)</span>,
    //订单已付款
    SHOP_ORDER_PAY_STATUS_NO_PAY<span class="token punctuation">(</span>true,0,<span class="token string">"订单未付款"</span><span class="token punctuation">)</span>,
    //订单已付款
    SHOP_ORDER_PAY_STATUS_PAYING<span class="token punctuation">(</span>true,1,<span class="token string">"订单正在付款"</span><span class="token punctuation">)</span>,
    //订单已付款
    SHOP_ORDER_PAY_STATUS_IS_PAY<span class="token punctuation">(</span>true,2,<span class="token string">"订单已付款"</span><span class="token punctuation">)</span>,
    //消息正在处理
    SHOP_MQ_MESSAGE_STATUS_PROCESSING<span class="token punctuation">(</span>true, <span class="token number">0</span>, <span class="token string">"消息正在处理"</span><span class="token punctuation">)</span>,
    //消息处理成功
    SHOP_MQ_MESSAGE_STATUS_SUCCESS<span class="token punctuation">(</span>true, <span class="token number">1</span>, <span class="token string">"消息处理成功"</span><span class="token punctuation">)</span>,
    //消息处理失败
    SHOP_MQ_MESSAGE_STATUS_FAIL<span class="token punctuation">(</span>false, <span class="token number">2</span>, <span class="token string">"消息处理失败"</span><span class="token punctuation">)</span>,
    //请求参数有误
    SHOP_REQUEST_PARAMETER_VALID<span class="token punctuation">(</span>false, -1, <span class="token string">"请求参数有误"</span><span class="token punctuation">)</span>,
    //优惠券已经使用
    SHOP_COUPON_ISUSED<span class="token punctuation">(</span>true, <span class="token number">1</span>, <span class="token string">"优惠券已经使用"</span><span class="token punctuation">)</span>,
    //优惠券未使用
    SHOP_COUPON_UNUSED<span class="token punctuation">(</span>false, <span class="token number">0</span>, <span class="token string">"优惠券未使用"</span><span class="token punctuation">)</span>,
    //快递运费不正确
    SHOP_ORDER_STATUS_UPDATE_FAIL<span class="token punctuation">(</span>false, <span class="token number">10001</span>, <span class="token string">"订单状态修改失败"</span><span class="token punctuation">)</span>,
    //快递运费不正确
    SHOP_ORDER_SHIPPINGFEE_INVALID<span class="token punctuation">(</span>false, <span class="token number">10002</span>, <span class="token string">"订单运费不正确"</span><span class="token punctuation">)</span>,
    //订单总价格不合法
    SHOP_ORDERAMOUNT_INVALID<span class="token punctuation">(</span>false, <span class="token number">10003</span>, <span class="token string">"订单总价格不正确"</span><span class="token punctuation">)</span>,
    //订单保存失败
    SHOP_ORDER_SAVE_ERROR<span class="token punctuation">(</span>false, <span class="token number">10004</span>, <span class="token string">"订单保存失败"</span><span class="token punctuation">)</span>,
    //订单确认失败
    SHOP_ORDER_CONFIRM_FAIL<span class="token punctuation">(</span>false, <span class="token number">10005</span>, <span class="token string">"订单确认失败"</span><span class="token punctuation">)</span>,
    //商品不存在
    SHOP_GOODS_NO_EXIST<span class="token punctuation">(</span>false, <span class="token number">20001</span>, <span class="token string">"商品不存在"</span><span class="token punctuation">)</span>,
    //订单价格非法
    SHOP_GOODS_PRICE_INVALID<span class="token punctuation">(</span>false, <span class="token number">20002</span>, <span class="token string">"商品价格非法"</span><span class="token punctuation">)</span>,
    //商品库存不足
    SHOP_GOODS_NUM_NOT_ENOUGH<span class="token punctuation">(</span>false, <span class="token number">20003</span>, <span class="token string">"商品库存不足"</span><span class="token punctuation">)</span>,
    //扣减库存失败
    SHOP_REDUCE_GOODS_NUM_FAIL<span class="token punctuation">(</span>false, <span class="token number">20004</span>, <span class="token string">"扣减库存失败"</span><span class="token punctuation">)</span>,
    //库存记录为空
    SHOP_REDUCE_GOODS_NUM_EMPTY<span class="token punctuation">(</span>false, <span class="token number">20005</span>, <span class="token string">"扣减库存失败"</span><span class="token punctuation">)</span>,
    //用户账号不能为空
    SHOP_USER_IS_NULL<span class="token punctuation">(</span>false, <span class="token number">30001</span>, <span class="token string">"用户账号不能为空"</span><span class="token punctuation">)</span>,
    //用户信息不存在
    SHOP_USER_NO_EXIST<span class="token punctuation">(</span>false, <span class="token number">30002</span>, <span class="token string">"用户不存在"</span><span class="token punctuation">)</span>,
    //余额扣减失败
    SHOP_USER_MONEY_REDUCE_FAIL<span class="token punctuation">(</span>false, <span class="token number">30003</span>, <span class="token string">"余额扣减失败"</span><span class="token punctuation">)</span>,
    //已经退款
    SHOP_USER_MONEY_REFUND_ALREADY<span class="token punctuation">(</span>true, <span class="token number">30004</span>, <span class="token string">"订单已经退过款"</span><span class="token punctuation">)</span>,
    //优惠券不不存在
    SHOP_COUPON_NO_EXIST<span class="token punctuation">(</span>false, <span class="token number">40001</span>, <span class="token string">"优惠券不存在"</span><span class="token punctuation">)</span>,
    //优惠券不合法
    SHOP_COUPON_INVALIED<span class="token punctuation">(</span>false, <span class="token number">40002</span>, <span class="token string">"优惠券不合法"</span><span class="token punctuation">)</span>,
    //优惠券使用失败
    SHOP_COUPON_USE_FAIL<span class="token punctuation">(</span>false, <span class="token number">40003</span>, <span class="token string">"优惠券使用失败"</span><span class="token punctuation">)</span>,
    //余额不能小于0
    SHOP_MONEY_PAID_LESS_ZERO<span class="token punctuation">(</span>false, <span class="token number">50001</span>, <span class="token string">"余额不能小于0"</span><span class="token punctuation">)</span>,
    //余额非法
    SHOP_MONEY_PAID_INVALID<span class="token punctuation">(</span>false, <span class="token number">50002</span>, <span class="token string">"余额非法"</span><span class="token punctuation">)</span>,
    //Topic不能为空
    SHOP_MQ_TOPIC_IS_EMPTY<span class="token punctuation">(</span>false, <span class="token number">60001</span>, <span class="token string">"Topic不能为空"</span><span class="token punctuation">)</span>,
    //消息体不能为空
    SHOP_MQ_MESSAGE_BODY_IS_EMPTY<span class="token punctuation">(</span>false, <span class="token number">60002</span>, <span class="token string">"消息体不能为空"</span><span class="token punctuation">)</span>,
    //消息发送失败
    SHOP_MQ_SEND_MESSAGE_FAIL<span class="token punctuation">(</span>false,60003,<span class="token string">"消息发送失败"</span><span class="token punctuation">)</span>,
    //支付订单未找到
    SHOP_PAYMENT_NOT_FOUND<span class="token punctuation">(</span>false,70001,<span class="token string">"支付订单未找到"</span><span class="token punctuation">)</span>,
    //支付订单已支付
    SHOP_PAYMENT_IS_PAID<span class="token punctuation">(</span>false,70002,<span class="token string">"支付订单已支付"</span><span class="token punctuation">)</span>,
    //订单付款失败
    SHOP_PAYMENT_PAY_ERROR<span class="token punctuation">(</span>false,70002,<span class="token string">"订单支付失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    Boolean success<span class="token punctuation">;</span>
    Integer code<span class="token punctuation">;</span>
    String message<span class="token punctuation">;</span>

    <span class="token function-name function">ShopCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    ShopCode<span class="token punctuation">(</span>Boolean success, Integer code, String message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.success <span class="token operator">=</span> success<span class="token punctuation">;</span>
        this.code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        this.message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public Boolean <span class="token function-name function">getSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> success<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public void setSuccess<span class="token punctuation">(</span>Boolean success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.success <span class="token operator">=</span> success<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public Integer <span class="token function-name function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public void setCode<span class="token punctuation">(</span>Integer code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public String <span class="token function-name function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public void setMessage<span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public String <span class="token function-name function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> <span class="token string">"ShopCode{"</span> +
                <span class="token string">"success="</span> + success +
                <span class="token string">", code="</span> + code +
                <span class="token string">", message='"</span> + message + <span class="token string">'\'</span>' +
                <span class="token string">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="4_Result_312"></a>4、响应实体类 ：Result：封装响应状态和响应信息</h4> 
<p>在 shop-pojo 工程模块中，Result.java ：是封装响应状态和响应信息的公共类。</p> 
<pre><code class="prism language-bash">package com.itheima.entity<span class="token punctuation">;</span>

<span class="token function">import</span> java.io.Serializable<span class="token punctuation">;</span>

/**
 * 结果实体类
 */
public class Result implements Serializable <span class="token punctuation">{<!-- --></span>
    private Boolean success<span class="token punctuation">;</span>
    private String message<span class="token punctuation">;</span>

    public <span class="token function-name function">Result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>

    public Result<span class="token punctuation">(</span>Boolean success, String message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.success <span class="token operator">=</span> success<span class="token punctuation">;</span>
        this.message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public Boolean <span class="token function-name function">getSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> success<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public void setSuccess<span class="token punctuation">(</span>Boolean success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.success <span class="token operator">=</span> success<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public String <span class="token function-name function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    public void setMessage<span class="token punctuation">(</span>String message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        this.message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public String <span class="token function-name function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token builtin class-name">return</span> <span class="token string">"Result{"</span> +
                <span class="token string">"success="</span> + success +
                <span class="token string">", message='"</span> + message + <span class="token string">'\'</span>' +
                <span class="token string">'}'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="RocketMQ____364"></a>二、RocketMQ 实战：模拟电商网站场景综合案例 – 下单功能时序图</h3> 
<p><img src="https://images2.imgbox.com/91/c1/4mt4ZePi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="RocketMQ__369"></a>三、RocketMQ 实战：下单接口定义和编码步骤分析</h3> 
<h4><a id="1_IOrderServicejava_371"></a>1、下单基本流程：接口定义 IOrderService.java</h4> 
<p>在 shop-api 工程模块中，创建 IOrderService.java 下单接口类。</p> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeOrder</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IOrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 下单接口
     * @param order
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">confirmOrder</span><span class="token punctuation">(</span><span class="token class-name">TradeOrder</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="2_OrderServiceImpljava_395"></a>2、下单基本流程：业务类实现 OrderServiceImpl.java</h4> 
<p>在 shop-order-service 工程模块中，创建 OrderServiceImpl.java 业务实现类。<br> 基本框架如下：</p> 
<pre><code class="prism language-java">
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>interfaceClass <span class="token operator">=</span> <span class="token class-name">IOrderService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IOrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">confirmOrder</span><span class="token punctuation">(</span><span class="token class-name">TradeOrder</span> order<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.校验订单</span>
       
        <span class="token comment">//2.生成预订单</span>
       
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//3.扣减库存</span>
            
            <span class="token comment">//4.扣减优惠券</span>
           
            <span class="token comment">//5.使用余额</span>
           
            <span class="token comment">//6.确认订单</span>
            
            <span class="token comment">//7.返回成功状态</span>
           
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//1.确认订单失败,发送消息</span>
            
            <span class="token comment">//2.返回失败状态</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="RocketMQ__435"></a>四、RocketMQ 实战：模拟电商网站场景综合案例–校验订单流程分析图</h3> 
<p><img src="https://images2.imgbox.com/37/78/eODyMAWU_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="RocketMQ__440"></a>五、RocketMQ 实战：模拟电商网站场景综合案例–校验订单实现</h3> 
<h4><a id="1_shoporderservice__OrderServiceImpljava__442"></a>1、在 shop-order-service 工程模块中，创建 OrderServiceImpl.java 下单业务类，</h4> 
<p>完成 订单校验方法。</p> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Reference</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span></span><span class="token class-name">JSON</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">ICouponService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">IGoodsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">IOrderService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">IUserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">ShopCode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">MQEntity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">CastException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">TradeOrderMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">IDWorker</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQBrokerException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">MQClientException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>common<span class="token punctuation">.</span>message<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>remoting<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">RemotingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>rocketmq<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RocketMQTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>interfaceClass <span class="token operator">=</span> <span class="token class-name">IOrderService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IOrderService</span> <span class="token punctuation">{<!-- --></span>


    <span class="token annotation punctuation">@Reference</span>
    <span class="token keyword">private</span> <span class="token class-name">IGoodsService</span> goodsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Reference</span>
    <span class="token keyword">private</span> <span class="token class-name">IUserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">confirmOrder</span><span class="token punctuation">(</span><span class="token class-name">TradeOrder</span> order<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.校验订单</span>
        <span class="token function">checkOrder</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//2.生成预订单</span>
       
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//3.扣减库存</span>
     
            <span class="token comment">//4.扣减优惠券</span>
     
            <span class="token comment">//5.使用余额</span>

            <span class="token comment">//6.确认订单</span>
          
            <span class="token comment">//7.返回成功状态</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//1.确认订单失败,发送消息</span>
    

            <span class="token comment">//2.返回订单确认失败消息</span>
     
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 校验订单
     *
     * @param order
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">checkOrder</span><span class="token punctuation">(</span><span class="token class-name">TradeOrder</span> order<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//1.校验订单是否存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_ORDER_INVALID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//2.校验订单中的商品是否存在</span>
        <span class="token class-name">TradeGoods</span> goods <span class="token operator">=</span> goodsService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getGoodsId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>goods <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_GOODS_NO_EXIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//3.校验下单用户是否存在</span>
        <span class="token class-name">TradeUser</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_USER_NO_EXIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//4.校验商品单价是否合法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getGoodsPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>goods<span class="token punctuation">.</span><span class="token function">getGoodsPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_GOODS_PRICE_INVALID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//5.校验订单商品数量是否合法</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">getGoodsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> goods<span class="token punctuation">.</span><span class="token function">getGoodsNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_GOODS_NUM_NOT_ENOUGH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"校验订单通过"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre> 
<h4><a id="2_shopapi__IGoodsServicejava__551"></a>2、在 shop-api 工程模块中，创建 IGoodsService.java 接口类。</h4> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeGoods</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeGoodsNumberLog</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IGoodsService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 根据ID查询商品对象
     * @param goodsId
     * @return
     */</span>
    <span class="token class-name">TradeGoods</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Long</span> goodsId<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token punctuation">}</span>


</code></pre> 
<h4><a id="3_shopapi__IUserServicejava__575"></a>3、在 shop-api 工程模块中，创建 IUserService.java 接口类。</h4> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeUserMoneyLog</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IUserService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">TradeUser</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Result</span> <span class="token function">updateMoneyPaid</span><span class="token punctuation">(</span><span class="token class-name">TradeUserMoneyLog</span> userMoneyLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<h4><a id="4_shopuserservice__UserServiceImpljava__594"></a>4、在 shop-user-service 工程模块中，创建 UserServiceImpl.java 实现类。</h4> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">IUserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">ShopCode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">CastException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">TradeUserMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">TradeUserMoneyLogMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeUser</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeUserMoneyLog</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeUserMoneyLogExample</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">BigDecimal</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>interfaceClass <span class="token operator">=</span> <span class="token class-name">IUserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IUserService</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TradeUserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TradeUserMoneyLogMapper</span> userMoneyLogMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TradeUser</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>userId<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_REQUEST_PARAMETER_VALID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


</code></pre> 
<h4><a id="5_shopgoodsservice__GoodsServiceImpljava__640"></a>5、在 shop-goods-service 工程模块中，创建 GoodsServiceImpl.java 实现类。</h4> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>dubbo<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">IGoodsService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>constant<span class="token punctuation">.</span></span><span class="token class-name">ShopCode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">Result</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">CastException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">TradeGoodsMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">TradeGoodsNumberLogMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeGoods</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>itheima<span class="token punctuation">.</span>shop<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">TradeGoodsNumberLog</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Service</span><span class="token punctuation">(</span>interfaceClass <span class="token operator">=</span> <span class="token class-name">IGoodsService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodsServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IGoodsService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TradeGoodsMapper</span> goodsMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TradeGoodsNumberLogMapper</span> goodsNumberLogMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TradeGoods</span> <span class="token function">findOne</span><span class="token punctuation">(</span><span class="token class-name">Long</span> goodsId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>goodsId <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">CastException</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token class-name">ShopCode</span><span class="token punctuation">.</span><span class="token constant">SHOP_REQUEST_PARAMETER_VALID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> goodsMapper<span class="token punctuation">.</span><span class="token function">selectByPrimaryKey</span><span class="token punctuation">(</span>goodsId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p><strong>上一节关联链接请点击：</strong><br> <a href="https://dzs168.blog.csdn.net/article/details/139573754" rel="nofollow"># RocketMQ 实战：模拟电商网站场景综合案例（五）</a></p> 
<p><strong>环境搭建：数据库表结构介绍–项目工程初始化 查看 请点击：</strong><br> <a href="https://dzs168.blog.csdn.net/article/details/139451817" rel="nofollow"># RocketMQ 实战：模拟电商网站场景综合案例（三）</a></p> 
<p><strong>mybatis 逆向工程 生成 POJO 类 源文件 和 mapper 映射文件 查看 请点击：</strong><br> <a href="https://dzs168.blog.csdn.net/article/details/139569683" rel="nofollow">RocketMQ 实战：模拟电商网站场景综合案例（四）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fc5c6316a0be45ef19aa0cf7b39cf008/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java设计模式和面向对象编程思想</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/feaae1cf7846b74355efc38fe0542727/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hadoop 2.0：主流开源云架构（三）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>