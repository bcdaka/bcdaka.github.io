<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【超长好文】Redis在项目中的17种使用场景 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f5209d8b9570f2878489fe21e5fe2ef0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【超长好文】Redis在项目中的17种使用场景">
  <meta property="og:description" content="Redis 是一个开源的高性能键值对数据库，它以其内存中数据存储、键过期策略、持久化、事务、丰富的数据类型支持以及原子操作等特性，在许多项目中扮演着关键角色。以下是V哥整理的17个Redis在项目中常见的使用场景：
缓存：Redis 可以作为应用程序的缓存层，减少数据库的读取压力，提高数据访问速度。
会话存储：在 Web 应用中，Redis 可以用来存储用户的会话信息，如登录状态、购物车内容等。
排行榜和计数器：Redis 支持原子操作，非常适合实现实时排行榜、点赞数、访问计数等功能。
消息队列：Redis 可以作为消息队列系统，用于处理异步任务，例如邮件发送、后台任务处理等。
实时分析：Redis 可以用于实时分析，如用户行为分析、实时统计信息等。
分布式锁：在分布式系统中，Redis 可以用于实现分布式锁，确保在多个节点之间共享资源的一致性。
发布/订阅：Redis 提供了发布/订阅模式，可以用于实现消息广播，例如实时通知系统。
限流：Redis 可以用于实现限流功能，防止系统过载，如 API 调用频率限制。
数据过期：Redis 支持设置数据的过期时间，自动清理过期数据，适用于临时数据存储。
全页缓存：Redis 可以缓存整个页面的输出，减少数据库查询和页面渲染时间。
社交功能：在社交网络应用中，Redis 可以用于存储好友关系、用户状态更新等。
实时推荐系统：Redis 可以用于存储用户的行为数据和偏好，实现实时推荐。
地理位置信息：Redis 支持 Geospatial 索引，可以用于实现地理位置相关的查询和推荐。
时间序列数据：Redis 可以存储时间序列数据，用于监控和分析。
任务调度：Redis 可以用于任务调度，例如定时任务的执行。
数据共享：在微服务架构中，Redis 可以作为服务间共享数据的媒介。
持久化：虽然 Redis 是内存数据库，但它也支持数据持久化，可以在系统故障后恢复数据。
Redis 的使用场景非常广泛，可以根据项目的具体需求来选择合适的应用方式。
下面V哥依次对17种业务场景举例说明和解释：
1. 缓存 针对Redis作为缓存层的使用场景，我将提供一个简单的Java Spring Boot应用案例，该应用使用Redis缓存来提高数据库查询的效率。
场景描述
假设我们有一个在线书店，用户可以查看书籍的详细信息。每次用户请求书籍详情时，后端需要查询数据库以获取书籍信息。为了提高性能，我们可以使用Redis缓存来存储热门书籍的信息，以减少对数据库的查询次数。
环境准备
安装Java开发环境。安装Redis并确保其运行。创建一个Spring Boot项目，并添加以下依赖： Spring WebSpring Data RedisRedis客户端驱动，如lettuce或jedis 创建Spring Boot项目
使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。
配置Redis连接
在src/main/resources/application.properties中配置Redis服务器的连接信息：
spring.redis.host=localhost spring.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-07T10:51:48+08:00">
    <meta property="article:modified_time" content="2024-06-07T10:51:48+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【超长好文】Redis在项目中的17种使用场景</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>Redis 是一个开源的高性能键值对数据库，它以其内存中数据存储、键过期策略、持久化、事务、丰富的数据类型支持以及原子操作等特性，在许多项目中扮演着关键角色。以下是V哥整理的17个Redis在项目中常见的使用场景：</p> 
</blockquote> 
<ol><li> <p>缓存：Redis 可以作为应用程序的缓存层，减少数据库的读取压力，提高数据访问速度。</p> </li><li> <p>会话存储：在 Web 应用中，Redis 可以用来存储用户的会话信息，如登录状态、购物车内容等。</p> </li><li> <p>排行榜和计数器：Redis 支持原子操作，非常适合实现实时排行榜、点赞数、访问计数等功能。</p> </li><li> <p>消息队列：Redis 可以作为消息队列系统，用于处理异步任务，例如邮件发送、后台任务处理等。</p> </li><li> <p>实时分析：Redis 可以用于实时分析，如用户行为分析、实时统计信息等。</p> </li><li> <p>分布式锁：在分布式系统中，Redis 可以用于实现分布式锁，确保在多个节点之间共享资源的一致性。</p> </li><li> <p>发布/订阅：Redis 提供了发布/订阅模式，可以用于实现消息广播，例如实时通知系统。</p> </li><li> <p>限流：Redis 可以用于实现限流功能，防止系统过载，如 API 调用频率限制。</p> </li><li> <p>数据过期：Redis 支持设置数据的过期时间，自动清理过期数据，适用于临时数据存储。</p> </li><li> <p>全页缓存：Redis 可以缓存整个页面的输出，减少数据库查询和页面渲染时间。</p> </li><li> <p>社交功能：在社交网络应用中，Redis 可以用于存储好友关系、用户状态更新等。</p> </li><li> <p>实时推荐系统：Redis 可以用于存储用户的行为数据和偏好，实现实时推荐。</p> </li><li> <p>地理位置信息：Redis 支持 Geospatial 索引，可以用于实现地理位置相关的查询和推荐。</p> </li><li> <p>时间序列数据：Redis 可以存储时间序列数据，用于监控和分析。</p> </li><li> <p>任务调度：Redis 可以用于任务调度，例如定时任务的执行。</p> </li><li> <p>数据共享：在微服务架构中，Redis 可以作为服务间共享数据的媒介。</p> </li><li> <p>持久化：虽然 Redis 是内存数据库，但它也支持数据持久化，可以在系统故障后恢复数据。</p> </li></ol> 
<p>Redis 的使用场景非常广泛，可以根据项目的具体需求来选择合适的应用方式。</p> 
<p>下面V哥依次对17种业务场景举例说明和解释：</p> 
<h3><a id="1__40"></a>1. 缓存</h3> 
<p>针对Redis作为缓存层的使用场景，我将提供一个简单的Java Spring Boot应用案例，该应用使用Redis缓存来提高数据库查询的效率。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们有一个在线书店，用户可以查看书籍的详细信息。每次用户请求书籍详情时，后端需要查询数据库以获取书籍信息。为了提高性能，我们可以使用Redis缓存来存储热门书籍的信息，以减少对数据库的查询次数。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Web</li><li>Spring Data Redis</li><li>Redis客户端驱动，如lettuce或jedis</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (<code>https://start.spring.io/</code>) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在<code>src/main/resources/application.properties</code>中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>定义书籍实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建书籍服务接口和实现类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Book</span> <span class="token function">getBookById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BookService</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookRepository</span> bookRepository<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">getBookById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 尝试从Redis缓存中获取书籍</span>
        <span class="token class-name">Book</span> cachedBook <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedBook <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> cachedBook<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 如果缓存中没有，从数据库查询</span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> bookRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>book <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 将查询结果放入缓存，设置过期时间为10分钟</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> book<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> book<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建书籍仓库接口</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BookRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/books"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">BookService</span> bookService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBook</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Book</span> book <span class="token operator">=</span> bookService<span class="token punctuation">.</span><span class="token function">getBookById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>book <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">notFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>定义书籍实体类：这是一个简单的POJO类，代表数据库中的书籍记录。</p> </li><li> <p>创建书籍服务：BookService接口定义了获取书籍的方法。BookServiceImpl实现了这个接口，并使用BookRepository从数据库获取数据。同时，它还使用了StringRedisTemplate来操作Redis缓存。</p> </li><li> <p>缓存逻辑：在getBookById方法中，首先尝试从Redis缓存中获取书籍信息。如果缓存中存在，直接返回；如果不存在，则从数据库查询，并把结果存入缓存，同时设置10分钟的过期时间。</p> </li><li> <p>创建控制器：BookController提供了一个RESTful API端点/books/{id}，用于根据书籍ID获取书籍信息。</p> </li></ul> 
<p>通过这种方式，我们可以显著减少对数据库的查询次数，特别是对于热门书籍，从而提高应用的性能和响应速度。</p> 
<h3><a id="2__151"></a>2. 会话存储</h3> 
<p>针对Redis作为会话存储的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来存储用户会话信息。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个Web应用程序，用户需要登录以访问某些受保护的资源。为了管理用户会话，我们可以使用Redis来存储会话信息，而不是将它们存储在服务器的内存中或数据库中。</p> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
server.servlet.session.persistent=false
server.servlet.session.timeout=15
spring.session.store-type=redis
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建用户实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建用户存储库接口</li></ol> 
<p>这里我们使用内存存储作为示例，实际应用中应连接到数据库。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InMemoryUserRepository</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        users<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加更多用户...</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UsernameNotFoundException</span><span class="token punctuation">(</span><span class="token string">"User not found with username: "</span> <span class="token operator">+</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>core<span class="token punctuation">.</span>userdetails<span class="token punctuation">.</span></span>User</span><span class="token punctuation">(</span>
                user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>配置Spring Security</li></ol> 
<pre><code>@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/admin/**").hasRole("ADMIN")
                .antMatchers("/user/**").hasAnyRole("USER", "ADMIN")
                .antMatchers("/", "/home", "/register").permitAll()
                .anyRequest().authenticated()
            .and()
            .formLogin()
                .loginPage("/login")
                .permitAll()
            .and()
            .logout()
                .permitAll();
    }

    @Autowired
    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre> 
<ol start="4"><li>创建登录和登出控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/admin"</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adminPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"admin"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"user"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:/login?logout"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="5"><li>创建登录页面（login.html）</li></ol> 
<p>这是一个简单的HTML页面，包含表单用于用户登录。</p> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口，并设置了Spring Session的存储类型为Redis。</p> </li><li> <p>创建用户实体类：这是一个简单的POJO类，代表用户信息。</p> </li><li> <p>用户存储库接口：InMemoryUserRepository实现了UserDetailsService接口，用于Spring Security的认证过程。实际应用中，应连接到数据库来获取用户信息。</p> </li><li> <p>配置Spring Security：WebSecurityConfig类配置了Spring Security的认证和授权规则。它还配置了自定义的登录页面和登出逻辑。</p> </li><li> <p>创建控制器：WebController提供了访问不同页面的路由和登出逻辑。</p> </li><li> <p>登录页面：login.html是用户登录的前端页面。</p> </li></ul> 
<p>通过这种方式，Spring Session会自动管理用户的会话信息，并将其存储在Redis中。当用户登录时，会话信息将被存储在Redis中，而不是传统的服务器端HttpSession中。这使得会话信息可以在多个服务器实例之间共享，非常适合于分布式部署的Web应用程序。此外，Redis的高性能也有助于提高应用程序的响应速度。</p> 
<h3><a id="3__295"></a>3. 排行榜和计数器</h3> 
<p>针对Redis作为排行榜和计数器的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来实现一个简单的文章点赞功能，并将点赞数用作排行榜的依据。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个博客平台，用户可以对文章进行点赞。我们希望根据文章的点赞数来显示一个实时更新的热门文章排行榜。</p> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis<br> 服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>定义文章实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> likeCount<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建文章服务接口和实现类</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">likeArticle</span><span class="token punctuation">(</span><span class="token class-name">String</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 增加文章的点赞数</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>articleId<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTopLikedArticles</span><span class="token punctuation">(</span><span class="token keyword">int</span> topN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取topN个点赞数最多的文章</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> articleIds <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"article:*:likeCount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> topArticles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> id <span class="token operator">:</span> articleIds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> likeCount <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Article</span> article <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            article<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"article:"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">":likeCount"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            article<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"文章标题待查询"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            article<span class="token punctuation">.</span><span class="token function">setLikeCount</span><span class="token punctuation">(</span>likeCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            topArticles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 根据点赞数排序</span>
        topArticles<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a2<span class="token punctuation">.</span><span class="token function">getLikeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> a1<span class="token punctuation">.</span><span class="token function">getLikeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> topArticles<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> topN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/articles"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ArticleService</span> articleService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}/like"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">likeArticle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        articleService<span class="token punctuation">.</span><span class="token function">likeArticle</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"点赞成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/top/{topN}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTopLikedArticles</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">int</span> topN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> topArticles <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getTopLikedArticles</span><span class="token punctuation">(</span>topN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>topArticles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>定义文章实体类：这是一个简单的POJO类，代表文章信息，包括文章ID、标题和点赞数。</p> </li><li> <p>创建文章服务：ArticleService提供了两个方法，likeArticle用于增加文章的点赞数，getTopLikedArticles用于获取点赞数最多的前N篇文章。</p> </li><li> <p>点赞逻辑：在likeArticle方法中，我们使用StringRedisTemplate的increment操作来原子性地增加文章的点赞数。</p> </li><li> <p>获取排行榜逻辑：在getTopLikedArticles方法中，我们首先获取所有文章的点赞数键，然后构建一个包含文章点赞数的列表。接着，我们对这个列表进行排序，以获取点赞数最多的前N篇文章。</p> </li><li> <p>创建控制器：ArticleController提供了两个RESTful API端点，/articles/{id}/like用于点赞文章，/articles/top/{topN}用于获取点赞数最多的前N篇文章。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的原子操作和高性能特性来实现一个高效的点赞和排行榜功能。每次用户点赞时，Redis都会原子性地更新点赞数，而获取排行榜时，我们可以快速地从Redis中检索和排序数据，从而提供实时的热门文章排行。</p> 
<h3><a id="4__395"></a>4. 消息队列</h3> 
<p>针对Redis作为消息队列的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis的发布/订阅功能来实现一个简单的任务队列。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们有一个电商平台，需要处理用户的订单。为了提高效率，我们希望将订单处理任务异步化，即用户下单后，订单信息将被发送到一个队列中，然后由一个或多个后台服务来异步处理这些订单。</p> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>配置Redis消息队列</li></ol> 
<p>创建一个配置类来设置发布者和订阅者使用的通道。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisMessageListenerContainer</span> <span class="token function">redisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisMessageListenerContainer</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        container<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        container<span class="token punctuation">.</span><span class="token function">addMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageListenerImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PatternTopic</span><span class="token punctuation">(</span><span class="token string">"order-channel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>实现消息监听器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageListenerImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MessageListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pattern<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> orderData <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">processOrder</span><span class="token punctuation">(</span>orderData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理订单逻辑</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Processing order: "</span> <span class="token operator">+</span> orderData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 假设订单处理成功</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建订单服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ReactiveRedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> reactiveRedisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token class-name">String</span> orderData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> reactiveRedisTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"order-channel"</span><span class="token punctuation">,</span> orderData<span class="token punctuation">)</span>
                                   <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/orders"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> orderData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> orderService<span class="token punctuation">.</span><span class="token function">placeOrder</span><span class="token punctuation">(</span>orderData<span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                          <span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis消息队列：RedisConfig配置类设置了Redis消息监听器容器，它将监听名为order-channel的通道。</p> </li><li> <p>实现消息监听器：MessageListenerImpl实现了MessageListener接口，用于接收并处理发送到order-channel的消息。每当有新消息到达时，onMessage方法会被调用，订单数据将被传递到processOrder方法进行处理。</p> </li><li> <p>创建订单服务：OrderService服务中定义了placeOrder方法，它使用ReactiveRedisTemplate的convertAndSend方法将订单数据发布到order-channel。</p> </li><li> <p>创建控制器：OrderController提供了一个POST端点/orders，用于接收订单数据。当接收到订单请求时，它将调用OrderService的placeOrder方法将订单数据发送到Redis消息队列，并返回相应的响应。</p> </li></ul> 
<p>通过这种方式，我们可以将订单处理逻辑异步化，提高系统的整体性能和响应能力。用户下单后，前端可以立即收到响应，而订单处理则在后台异步进行。这种模式适用于需要高吞吐量和快速响应的业务场景。</p> 
<h3><a id="5__492"></a>5. 实时分析</h3> 
<p>针对Redis作为实时分析使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis的Sorted Set来实现一个简单的用户在线时长统计和分析功能。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个在线教育平台，需要统计每个用户的在线时长，并根据这些数据生成实时的在线时长排行榜。</p> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>用户在线时长服务接口和实现类</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineDurationService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUserOnlineDuration</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token keyword">long</span> duration<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用Sorted Set存储用户ID和在线时长</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">incrementScore</span><span class="token punctuation">(</span><span class="token string">"user:online:duration"</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTopUsersByOnlineDuration</span><span class="token punctuation">(</span><span class="token keyword">int</span> topN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取在线时长最长的前N个用户</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topUsers <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForZSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverseRange</span><span class="token punctuation">(</span><span class="token string">"user:online:duration"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> topN <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> topUsers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>用户登录和登出逻辑</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OnlineDurationService</span> onlineDurationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/user/{userId}/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 用户登录逻辑，可以是任何触发登录的事件</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"User "</span> <span class="token operator">+</span> userId <span class="token operator">+</span> <span class="token string">" logged in"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/user/{userId}/logout"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">userLogout</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 用户登出时记录在线时长</span>
        <span class="token keyword">long</span> duration <span class="token operator">=</span> <span class="token comment">// 计算用户在线时长的逻辑</span>
        onlineDurationService<span class="token punctuation">.</span><span class="token function">updateUserOnlineDuration</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"User "</span> <span class="token operator">+</span> userId <span class="token operator">+</span> <span class="token string">" logged out"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>获取在线时长排行榜</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRankController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OnlineDurationService</span> onlineDurationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/online-duration/top/{topN}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTopUsersByOnlineDuration</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">int</span> topN<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topUsers <span class="token operator">=</span> onlineDurationService<span class="token punctuation">.</span><span class="token function">getTopUsersByOnlineDuration</span><span class="token punctuation">(</span>topN<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>topUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>用户在线时长服务：OnlineDurationService服务中定义了两个方法，updateUserOnlineDuration用于更新用户的在线时长，这里使用Redis的Sorted Set数据结构，将用户ID作为成员，在线时长作为分数进行存储。getTopUsersByOnlineDuration方法用于获取在线时长最长的前N个用户。</p> </li><li> <p>用户登录和登出逻辑：在UserController中，定义了用户登录和登出的RESTful API。用户登录时，可以执行任何触发登录的逻辑；用户登出时，计算在线时长并通过OnlineDurationService服务更新到Redis中。</p> </li><li> <p>获取在线时长排行榜：UserRankController提供了一个GET端点/users/online-duration/top/{topN}，用于获取在线时长最长的前N个用户。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的Sorted Set来存储和排序用户的在线时长，实现一个高效的实时在线时长统计和分析功能。每当用户登出时，系统都会更新用户的在线时长，并可以快速地根据在线时长对用户进行排名，从而提供一个动态的在线时长排行榜。这对于在线教育平台等需要监控用户活跃度的业务场景非常有用。</p> 
<h3><a id="6__583"></a>6. 分布式锁</h3> 
<p>针对Redis作为分布式锁的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redisson作为客户端来实现分布式锁。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们有一个高流量的电子商务网站，需要执行一些资源密集型的操作，比如生成日报表。为了防止多个实例同时执行这些操作，我们需要一个分布式锁来确保每次只有一个实例可以执行这些操作。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Web</li><li>Redisson</li><li>Spring Boot Starter Cache（可选，如果需要使用Spring的缓存抽象）</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redisson连接</strong></p> 
<p>在src/main/resources/application.properties或application.yml中配置Redisson客户端连接到Redis服务器：</p> 
<pre><code># application.properties
redisson.address=redis://localhost:6379
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-yml"><span class="token comment"># application.yml</span>
<span class="token key atrule">redisson</span><span class="token punctuation">:</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">"redis://localhost:6379"</span>
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>配置Redisson</li></ol> 
<p>创建一个配置类来配置Redisson客户端。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod <span class="token operator">=</span> <span class="token string">"shutdown"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedissonClientConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedissonClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>redisson<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${redisson.address}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> redissonAddress<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>使用分布式锁</li></ol> 
<p>创建一个服务类来执行需要分布式锁保护的资源密集型操作。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReportService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">generateDailyReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"dailyReportLock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 尝试获取锁，最多等待3秒，锁的自动过期时间设置为10秒</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 执行生成日报表的操作</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Generating daily report..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 模拟长时间运行的任务</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Daily report generated."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 释放锁</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<p>创建一个控制器来触发生成日报表的操作。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/reports"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReportController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ReportService</span> reportService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/daily"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">generateDailyReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        reportService<span class="token punctuation">.</span><span class="token function">generateDailyReport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Daily report generation triggered."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redisson连接：在配置文件中指定Redis服务器的地址，并创建一个RedissonClient Bean。</p> </li><li> <p>使用分布式锁：ReportService服务中的generateDailyReport方法使用Redisson的RLock来获取一个名为dailyReportLock的分布式锁。tryLock方法尝试获取锁，并指定最多等待时间和锁的自动过期时间。如果成功获取锁，则执行生成日报表的操作；如果获取锁失败，则方法将立即返回，不会执行任何操作。</p> </li><li> <p>创建控制器：ReportController提供了一个GET端点/reports/daily，用于触发生成日报表的操作。</p> </li></ul> 
<p>通过这种方式，我们可以确保在分布式系统中，即使有多个实例运行，也只有一个实例可以执行生成日报表的操作，从而避免资源冲突和重复劳动。Redisson客户端简化了Redis分布式锁的使用，使得在Spring Boot应用中实现分布式锁变得简单而高效。</p> 
<h3><a id="7__695"></a>7. 发布/订阅</h3> 
<p>针对Redis作为发布/订阅消息队列的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis的发布/订阅功能来实现一个简单的实时消息通知系统。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个社交媒体平台，需要实现一个功能，当用户发布新帖子时，他/她的关注者能够实时收到通知。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Data Redis Reactive (对于响应式编程)</li><li>Spring WebFlux (响应式Web框架)</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>配置发布/订阅通道</li></ol> 
<p>创建一个配置类来定义发布者和订阅者使用的通道。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisPubSubConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ReactiveRedisConnectionFactory</span> <span class="token function">reactiveRedisConnectionFactory</span><span class="token punctuation">(</span><span class="token class-name">LettuceClientConfiguration</span> clientConfig<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LettuceConnectionFactory</span><span class="token punctuation">(</span>clientConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisMessageListenerContainer</span> <span class="token function">redisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token class-name">ReactiveRedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisMessageListenerContainer</span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisMessageListenerContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        container<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        container<span class="token punctuation">.</span><span class="token function">addMessageListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PostNotificationListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PatternTopic</span><span class="token punctuation">(</span><span class="token string">"newPostChannel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LettuceClientConfiguration</span> <span class="token function">clientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">LettuceClientConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Component</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostNotificationListener</span> <span class="token keyword">implements</span> <span class="token class-name">MessageListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理接收到的帖子通知</span>
            <span class="token class-name">String</span> postContent <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"New post notification received: "</span> <span class="token operator">+</span> postContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 这里可以添加逻辑，比如通知关注者</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>发送新帖子通知</li></ol> 
<p>创建一个服务类来发送新帖子的通知。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ReactiveRedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> reactiveRedisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">publishNewPostNotification</span><span class="token punctuation">(</span><span class="token class-name">String</span> postContent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> reactiveRedisTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"newPostChannel"</span><span class="token punctuation">,</span> postContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<p>创建一个控制器来处理新帖子的发布请求。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/posts"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PostService</span> postService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">createPost</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">String</span> postContent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> postService<span class="token punctuation">.</span><span class="token function">publishNewPostNotification</span><span class="token punctuation">(</span>postContent<span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置发布/订阅通道：RedisPubSubConfig配置类设置了ReactiveRedisConnectionFactory和RedisMessageListenerContainer。PostNotificationListener实现了MessageListener接口，用于接收并处理新帖子的通知。</p> </li><li> <p>发送新帖子通知：PostService服务中的publishNewPostNotification方法使用ReactiveRedisTemplate的convertAndSend方法将新帖子的内容发布到newPostChannel通道。</p> </li><li> <p>创建控制器：PostController提供了一个POST端点/posts，用于接收新帖子的内容。当接收到新帖子的请求时，它将调用PostService的publishNewPostNotification方法将新帖子的内容发送到Redis通道，并返回相应的响应。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的发布/订阅功能来实现一个高效的实时消息通知系统。每当有新帖子发布时，Redis会将通知消息发布到newPostChannel通道，所有订阅了该通道的监听器（如PostNotificationListener）都会收到消息并进行处理，比如通知帖子作者的关注者。这种模式适用于需要实时通信和通知的业务场景，如社交媒体、实时聊天应用等。</p> 
<h3><a id="8__807"></a>8. 限流</h3> 
<p>针对Redis作为限流功能的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来实现API的限流。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个公共API服务，该服务需要对外部请求进行限流，以防止滥用和过载。我们希望对每个IP地址每分钟的请求次数进行限制。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Web</li><li>Spring Boot Starter Data Redis</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建限流注解</li></ol> 
<p>定义一个自定义注解，用于标识需要限流的API。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">RateLimit</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> <span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 默认每分钟请求次数限制</span>
    <span class="token keyword">long</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">60</span><span class="token punctuation">;</span> <span class="token comment">// 默认时间窗口为60秒</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建限流拦截器</li></ol> 
<p>实现一个拦截器来检查请求频率。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RateLimiterInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> rateLimitKeyPrefix <span class="token operator">=</span> <span class="token string">"rate_limit:"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RateLimiterInterceptor</span><span class="token punctuation">(</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate <span class="token operator">=</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> ip <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteAddr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> rateLimitKey <span class="token operator">=</span> rateLimitKeyPrefix <span class="token operator">+</span> methodName <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> ip<span class="token punctuation">;</span>

        <span class="token keyword">int</span> currentCount <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>rateLimitKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentCount <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果当前计数大于1，则说明请求已超过限制</span>
            response<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_TOO_MANY_REQUESTS</span><span class="token punctuation">,</span> <span class="token string">"Too many requests, please try again later."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 设置过期时间</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>rateLimitKey<span class="token punctuation">,</span> <span class="token class-name">RateLimit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> handler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RateLimit</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>配置拦截器</li></ol> 
<p>配置拦截器以应用于所有控制器。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RateLimiterInterceptor</span> rateLimiterInterceptor<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>rateLimiterInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>应用限流注解</li></ol> 
<p>在需要限流的API上应用自定义的RateLimit注解。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApiController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@RateLimit</span><span class="token punctuation">(</span>limit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token comment">// 每分钟最多5个请求</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/api/resource"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLimitedResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Access to limited resource"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>创建限流注解：定义了一个RateLimit注解，它包含限制的请求次数和时间窗口。</p> </li><li> <p>创建限流拦截器：RateLimiterInterceptor实现了HandlerInterceptor接口，用于在请求处理之前检查请求频率。它使用RedisTemplate来递增每个IP地址的请求计数，并设置计数的过期时间。</p> </li><li> <p>配置拦截器：WebConfig类实现了WebMvcConfigurer接口，用于注册RateLimiterInterceptor拦截器，使其应用于所有的控制器方法。</p> </li><li> <p>应用限流注解：在ApiController中的getLimitedResource方法上应用了RateLimit注解，指定了每分钟最多5个请求的限制。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的原子递增操作和键过期特性来实现API的限流。每次请求都会检查当前IP的请求计数，如果超过限制，则返回429错误码（Too Many Requests）。这有助于保护API免受滥用，并确保服务的稳定性和可用性。</p> 
<h3><a id="9__923"></a>9. 数据过期</h3> 
<p>针对Redis作为数据过期自动清理的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来存储临时数据，比如用户会话信息，并设置过期时间以自动清理这些数据。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个Web应用，用户登录后生成的会话信息需要在用户登出或一定时间后自动清除。我们可以使用Redis来存储这些会话信息，并利用它的过期时间特性来自动清理这些会话。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Session Data Redis</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接和Spring Session</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息以及Spring Session的存储类型：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379

spring.session.store-type=redis
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>配置Spring Session Redis</li></ol> 
<p>创建配置类以启用Spring Session的Redis支持：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableRedisHttpSession</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionConfig</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 配置类不需要额外代码，@EnableRedisHttpSession将自动配置所需的Bean</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>用户登录和登出逻辑</li></ol> 
<p>创建一个控制器来处理用户登录和登出，并存储会话信息：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 用户登录后，Spring Session会自动存储会话信息到Redis</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">SessionStatus</span> sessionStatus<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sessionStatus<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"loginSuccess"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 用户登出时，清除会话信息</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">SessionStatus</span> sessionStatus<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        sessionStatus<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"logoutSuccess"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>设置会话超时</li></ol> 
<p>创建一个配置类来设置会话的超时时间：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionTimeoutConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ConfigurableServletWebServerFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">webServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TomcatServletWebServerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TomcatServletWebServerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factory<span class="token punctuation">.</span><span class="token function">setSessionTimeout</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置会话超时时间（以分钟为单位）</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接和Spring Session：在application.properties中配置了Redis服务器的地址和端口，并指定Spring Session使用Redis作为存储。</p> </li><li> <p>配置Spring Session Redis：SessionConfig类通过@EnableRedisHttpSession注解启用了Spring Session的Redis支持。Spring Session将自动管理HTTP Session，并将其存储在Redis中。</p> </li><li> <p>用户登录和登出逻辑：SessionController控制器提供了登录和登出的处理逻辑。在用户登录时，会将用户名存储到会话中。在用户登出时，会话将被无效化，Spring Session会自动从Redis中清除会话信息。</p> </li><li> <p>设置会话超时：SessionTimeoutConfig配置类设置了会话的超时时间。Tomcat的TomcatServletWebServerFactory用于设置会话超时时间，这个时间之后，即使用户没有显式登出，会话也会被自动清除。</p> </li></ul> 
<p>通过这种方式，我们可以确保用户的会话信息在一定时间后自动从Redis中清除，无需手动干预。这不仅有助于释放Redis存储空间，还可以提高应用的安全性，防止旧会话被滥用。此外，Spring Session的自动管理简化了会话管理的复杂性，使得开发者可以更专注于业务逻辑的实现。</p> 
<h3><a id="10__1014"></a>10. 全页缓存</h3> 
<p>针对Redis作为全页缓存的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来缓存整个页面的HTML内容。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个新闻网站，该网站的首页包含多个新闻文章的摘要信息。由于首页访问频率很高，我们希望将整个首页的内容缓存起来，以减少数据库的查询次数和页面渲染时间。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Web</li><li>Spring Boot Starter Data Redis</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建新闻文章服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 假设有一个方法来获取新闻列表</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">getNewsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这里是获取新闻列表的逻辑</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>配置Redis缓存</li></ol> 
<p>创建一个配置类来设置Spring Cache和Redis缓存。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisCacheManager</span> cacheManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置缓存过期时间（例如5分钟）</span>
        cacheManager<span class="token punctuation">.</span><span class="token function">setDefaultExpiration</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cacheManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器和视图</li></ol> 
<p>创建一个控制器来返回首页，并使用Redis缓存整个页面。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">NewsService</span> newsService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CacheManager</span> cacheManager<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"homePage"</span><span class="token punctuation">,</span> condition <span class="token operator">=</span> <span class="token string">"#root.caches[0].name == 'homePage'"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">homePage</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 尝试从缓存中获取页面</span>
        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"newsList"</span><span class="token punctuation">,</span> newsService<span class="token punctuation">.</span><span class="token function">getNewsList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"home"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>创建Thymeleaf模板</li></ol> 
<p>创建一个Thymeleaf模板home.html来渲染首页。</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>th</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.thymeleaf.org<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>新闻首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name"><span class="token namespace">th:</span>each</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>article : ${newsList}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${article.title}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name"><span class="token namespace">th:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${article.summary}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建新闻文章服务：NewsService服务包含获取新闻列表的逻辑。</p> </li><li> <p>配置Redis缓存：CacheConfig配置类通过@EnableCaching注解启用了Spring的缓存支持，并配置了一个RedisCacheManager Bean来管理Redis缓存。</p> </li><li> <p>创建控制器和视图：NewsController控制器中的homePage方法使用@Cacheable注解来指定缓存的名称（这里是homePage）。当这个方法被调用时，Spring会检查指定的缓存中是否存在该页面的缓存。如果存在，就直接返回缓存的内容；如果不存在，就执行方法并将结果存储到缓存中。</p> </li><li> <p>创建Thymeleaf模板：home.html是一个Thymeleaf模板，用于渲染新闻列表。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis来缓存整个页面的内容。首页的访问非常频繁，通过缓存可以显著减少数据库的查询次数和页面渲染时间，提高网站的响应速度和性能。此外，Spring的缓存抽象和Thymeleaf模板使得实现全页缓存变得简单而高效。</p> 
<h3><a id="11__1127"></a>11. 社交功能</h3> 
<p>针对Redis作为社交功能存储的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来存储用户的社交关系信息，如好友列表和用户状态更新。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个社交网络平台，用户可以添加好友，并且可以发布状态更新。我们需要存储每个用户的好友列表以及状态更新的时间线。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>定义用户和状态更新实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StatusUpdate</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Instant</span> timestamp<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建社交服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocialService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFriend</span><span class="token punctuation">(</span><span class="token class-name">String</span> userOneId<span class="token punctuation">,</span> <span class="token class-name">String</span> userTwoId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用集合存储用户的好友列表</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"friends:"</span> <span class="token operator">+</span> userOneId<span class="token punctuation">,</span> userTwoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"friends:"</span> <span class="token operator">+</span> userTwoId<span class="token punctuation">,</span> userOneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getFriends</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取用户的好友列表</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"friends:"</span> <span class="token operator">+</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postStatusUpdate</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 使用列表存储用户的状态更新时间线</span>
        <span class="token class-name">StatusUpdate</span> statusUpdate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StatusUpdate</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span><span class="token string">"timeline:"</span> <span class="token operator">+</span> userId<span class="token punctuation">,</span> statusUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatusUpdate</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStatusUpdates</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取用户的状态更新时间线</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string">"timeline:"</span> <span class="token operator">+</span> userId<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/social"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SocialController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">SocialService</span> socialService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/addFriend"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">addFriend</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userOneId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userTwoId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        socialService<span class="token punctuation">.</span><span class="token function">addFriend</span><span class="token punctuation">(</span>userOneId<span class="token punctuation">,</span> userTwoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Friends added successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/friends/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getFriends</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> friends <span class="token operator">=</span> socialService<span class="token punctuation">.</span><span class="token function">getFriends</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/status"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">postStatusUpdate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        socialService<span class="token punctuation">.</span><span class="token function">postStatusUpdate</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Status updated successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/timeline/{userId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">StatusUpdate</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStatusUpdates</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StatusUpdate</span><span class="token punctuation">&gt;</span></span> updates <span class="token operator">=</span> socialService<span class="token punctuation">.</span><span class="token function">getStatusUpdates</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>updates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>定义用户和状态更新实体类：User类代表用户信息，StatusUpdate类代表用户的状态更新信息。</p> </li><li> <p>创建社交服务：SocialService服务提供了添加好友、获取好友列表、发布状态更新和获取状态更新时间线的方法。好友列表使用Redis的Set数据结构存储，确保好友关系是无序且不重复的。状态更新时间线使用List数据结构存储，新的状态更新会被添加到列表的尾部。</p> </li><li> <p>创建控制器：SocialController控制器提供了四个RESTful API端点，分别用于添加好友、获取好友列表、发布状态更新和获取状态更新时间线。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的高性能和数据结构特性来实现社交网络平台中的社交功能。Redis的Set和List数据结构非常适合存储和管理好友关系和状态更新时间线，能够提供快速的读写性能，满足社交网络平台的需求。</p> 
<h3><a id="12__1250"></a>12. 实时推荐系统</h3> 
<p>针对Redis作为实时推荐系统存储的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来存储用户行为数据和偏好，以及提供一个简单的推荐功能。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个电子商务平台，我们希望根据用户的浏览和购买历史来推荐商品。我们将使用Redis来存储用户的这些行为数据，并根据这些数据生成推荐。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建商品和用户实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建推荐服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecommendationService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recordView</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 记录用户查看的商品</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">"user:"</span> <span class="token operator">+</span> userId <span class="token operator">+</span> <span class="token string">":views"</span><span class="token punctuation">,</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">recommendProducts</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 简单推荐算法：返回用户查看次数最多的商品</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> viewedProducts <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"user:"</span> <span class="token operator">+</span> userId <span class="token operator">+</span> <span class="token string">":views"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> productViewCounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        viewedProducts<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>productId <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string">"user:"</span> <span class="token operator">+</span> userId <span class="token operator">+</span> <span class="token string">":views:"</span> <span class="token operator">+</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            productViewCounts<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>productId<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> productViewCounts<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token function">comparingByValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token operator">::</span><span class="token function">getKey</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/recommendations"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecommendationController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RecommendationService</span> recommendationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/view"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">recordProductView</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> productId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        recommendationService<span class="token punctuation">.</span><span class="token function">recordView</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> productId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"View recorded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/products"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getRecommendations</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> recommendedProducts <span class="token operator">=</span> recommendationService<span class="token punctuation">.</span><span class="token function">recommendProducts</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>recommendedProducts<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建商品和用户实体类：Product类代表商品信息，User类代表用户信息。</p> </li><li> <p>创建推荐服务：</p> 
  <ul><li>recordView方法用于记录用户查看的商品。这里使用Redis的List来存储用户的浏览历史，每次用户查看商品时，商品ID被推入到对应用户的List中。</li><li>recommendProducts方法提供了一个简单的推荐算法。首先，获取用户的浏览历史中的所有商品ID，然后统计每个商品的浏览次数（这里简化处理，每次查看减少商品ID对应的计数器）。最后，根据浏览次数对商品进行排序，并返回用户浏览次数最多的商品列表。</li></ul> </li><li> <p>创建控制器：</p> 
  <ul><li>recordProductView端点用于记录用户查看商品的行为。</li><li>getRecommendations端点用于获取推荐商品列表。</li></ul> </li></ul> 
<p>通过这种方式，我们可以利用Redis的高性能和简单的数据结构来快速记录用户行为并生成推荐。虽然这里的推荐算法非常简单，但它展示了如何使用Redis来实现实时推荐系统的基础功能。在实际应用中，推荐算法可能会更复杂，涉及机器学习模型和更丰富的用户行为数据。</p> 
<h3><a id="13__1362"></a>13. 地理位置信息</h3> 
<p>针对Redis作为地理位置信息存储的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis的Geospatial索引来实现基于地理位置的推荐功能。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一款基于位置的社交应用，用户可以查看附近的其他用户或地点。我们需要存储用户的地理位置，并能够查询给定位置附近的用户。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。（确保Redis版本支持Geospatial索引，如Redis 3.2以上）</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis Reactive（如果使用响应式编程）</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建用户实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> longitude<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> latitude<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建地理位置服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeoLocationService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLocation</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token keyword">double</span> longitude<span class="token punctuation">,</span> <span class="token keyword">double</span> latitude<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> <span class="token string">"username"</span><span class="token punctuation">,</span> longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用Geospatial索引存储用户位置</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"userLocations"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">GeoLocation</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getLongitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getLatitude</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsersNearby</span><span class="token punctuation">(</span><span class="token keyword">double</span> longitude<span class="token punctuation">,</span> <span class="token keyword">double</span> latitude<span class="token punctuation">,</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 查询给定位置附近的用户</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GeoWithin</span><span class="token punctuation">&gt;</span></span> nearbyUsersGeo <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">radius</span><span class="token punctuation">(</span><span class="token string">"userLocations"</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Circle</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GeoCoordinate</span><span class="token punctuation">(</span>latitude<span class="token punctuation">,</span> longitude<span class="token punctuation">)</span><span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">RedisGeoCommands<span class="token punctuation">.</span>GeoRadiusCommandArgs</span><span class="token punctuation">.</span><span class="token function">newGeoRadiusArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> nearbyUsers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">GeoWithin</span> geoWithin <span class="token operator">:</span> nearbyUsersGeo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nearbyUsers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>geoWithin<span class="token punctuation">.</span><span class="token function">getMember</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> nearbyUsers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">GeoLocationService</span> geoLocationService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/addLocation"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">addLocation</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span>
                                               <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> longitude<span class="token punctuation">,</span>
                                               <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> latitude<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        geoLocationService<span class="token punctuation">.</span><span class="token function">addLocation</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"User location added"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/nearby"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsersNearby</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> longitude<span class="token punctuation">,</span>
                                                      <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> latitude<span class="token punctuation">,</span>
                                                      <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> radius<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> nearbyUsers <span class="token operator">=</span> geoLocationService<span class="token punctuation">.</span><span class="token function">getUsersNearby</span><span class="token punctuation">(</span>longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">,</span> radius<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>nearbyUsers<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建用户实体类：User类代表用户信息，包括用户的ID、名称、经度和纬度。</p> </li><li> <p>创建地理位置服务：</p> 
  <ul><li>addLocation方法用于将用户的地理位置信息存储到Redis的Geospatial索引中。这里使用RedisTemplate的opsForGeo方法来添加位置信息。</li><li>getUsersNearby方法用于查询给定位置附近的用户。使用radius方法来查找指定半径内的用户，然后从Redis中获取这些用户的详细信息。</li></ul> </li><li> <p>创建控制器：</p> 
  <ul><li>addLocation端点允许用户添加其地理位置信息。</li><li>getUsersNearby端点允许查询指定位置和半径内的附近用户。</li></ul> </li></ul> 
<p>通过这种方式，我们可以利用Redis的Geospatial索引来存储和查询地理位置信息。这对于需要基于地理位置提供服务的应用非常有用，如社交网络、共享出行、本地服务推荐等。Redis的Geospatial索引提供了高效的邻近查询功能，可以快速找到指定范围内的用户或其他地理位置相关的实体。</p> 
<h3><a id="14__1473"></a>14. 时间序列数据</h3> 
<p>针对Redis作为时间序列数据存储的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来存储和查询时间序列数据。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个监控系统，需要记录服务器的CPU使用率随时间变化的数据。我们将使用Redis的时间序列数据结构来存储这些监控数据，并能够查询任意时间范围内的CPU使用率。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。（确保Redis版本支持时间序列数据结构，可能需要使用RedisModules如RedisTimeSeries）</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建监控数据实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CpuUsageData</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Instant</span> timestamp<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> cpuUsage<span class="token punctuation">;</span>

    <span class="token comment">// 省略构造函数、getter和 setter 方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建监控服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitoringService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LettuceConnectionFactory</span> connectionFactory<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logCpuUsage</span><span class="token punctuation">(</span><span class="token class-name">String</span> serverId<span class="token punctuation">,</span> <span class="token keyword">double</span> cpuUsage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 记录CPU使用率数据</span>
        <span class="token class-name">CpuUsageData</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CpuUsageData</span><span class="token punctuation">(</span><span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cpuUsage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用Lettuce客户端的命令执行器来与RedisTimeSeries模块交互</span>
        <span class="token class-name">StatefulRedisConnection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RedisTimeSeriesCommands</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> ts <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ts<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>serverId<span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCpuUsageHistory</span><span class="token punctuation">(</span><span class="token class-name">String</span> serverId<span class="token punctuation">,</span> <span class="token class-name">Instant</span> start<span class="token punctuation">,</span> <span class="token class-name">Instant</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 查询指定时间范围内的CPU使用率历史数据</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StatefulRedisConnection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RedisTimeSeriesCommands</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> ts <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Range</span> range <span class="token operator">=</span> <span class="token class-name">Range</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">,</span> end<span class="token punctuation">.</span><span class="token function">toEpochMilli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Cursor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> cursor <span class="token operator">=</span> ts<span class="token punctuation">.</span><span class="token function">rangeRead</span><span class="token punctuation">(</span>serverId<span class="token punctuation">,</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                history<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> history<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/monitoring"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitoringController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MonitoringService</span> monitoringService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/logCpuUsage"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">logCpuUsage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> serverId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">double</span> cpuUsage<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        monitoringService<span class="token punctuation">.</span><span class="token function">logCpuUsage</span><span class="token punctuation">(</span>serverId<span class="token punctuation">,</span> cpuUsage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"CPU usage logged"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cpuUsageHistory"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCpuUsageHistory</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> serverId<span class="token punctuation">,</span>
                                                                 <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Instant</span> start<span class="token punctuation">,</span>
                                                                 <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">Instant</span> end<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CpuUsageData</span><span class="token punctuation">&gt;</span></span> history <span class="token operator">=</span> monitoringService<span class="token punctuation">.</span><span class="token function">getCpuUsageHistory</span><span class="token punctuation">(</span>serverId<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建监控数据实体类：CpuUsageData类代表CPU使用率数据，包括时间戳和CPU使用率。</p> </li><li> <p>创建监控服务：</p> 
  <ul><li>logCpuUsage方法用于记录服务器的CPU使用率。使用Lettuce客户端的同步命令执行器与RedisTimeSeries模块交互，将数据添加到时间序列中。</li><li>getCpuUsageHistory方法用于查询指定时间范围内的CPU使用率历史数据。使用rangeRead方法从时间序列中读取数据。</li></ul> </li><li> <p>创建控制器：</p> 
  <ul><li>logCpuUsage端点允许记录服务器的CPU使用率。</li><li>getCpuUsageHistory端点允许查询指定时间范围内的CPU使用率历史数据。</li></ul> </li></ul> 
<p>通过这种方式，我们可以利用Redis的RedisTimeSeries模块来存储和查询时间序列数据。这对于需要监控和分析随时间变化的数据的应用非常有用，如服务器监控、网站访问量分析等。RedisTimeSeries提供了高效的时间序列数据存储和查询功能，可以快速插入和检索大量时间戳数据。</p> 
<h3><a id="15__1591"></a>15. 任务调度</h3> 
<p>针对Redis作为任务调度的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis的延迟队列特性来实现任务调度。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们正在开发一个定时任务管理系统，需要安排一些任务在将来的某个时间点执行。我们将使用Redis的schedule命令来安排任务的执行。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装支持schedule命令的Redis版本（Redis 5.0及以上版本）。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-prop">spring.redis.host=localhost
spring.redis.port=6379
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建任务调度服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskSchedulingService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scheduleTask</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">,</span> <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 将任务和延迟时间存储到Redis中</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
            <span class="token string">"task:"</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            task<span class="token punctuation">,</span> 
            timeUnit<span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">,</span> 
            timeUnit
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用schedule命令安排任务在未来执行</span>
        <span class="token class-name">String</span> scheduleCommand <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>
            <span class="token string">"SCHEDULE %d %s"</span><span class="token punctuation">,</span> 
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeUnit<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token string">"task:"</span> <span class="token operator">+</span> task<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">RedisConnection</span> connection<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            connection<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>scheduleCommand<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建具体的任务</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Task is running: "</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 执行任务逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/tasks"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TaskSchedulingService</span> taskSchedulingService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/schedule"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">scheduleTask</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        taskSchedulingService<span class="token punctuation">.</span><span class="token function">scheduleTask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SampleTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">,</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Task scheduled for execution at "</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plusNanos</span><span class="token punctuation">(</span>timeUnit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建任务调度服务：scheduleTask方法用于安排一个Runnable任务在未来的某个时间点执行。首先，任务被存储到Redis中，并设置相应的延迟时间。然后，使用Redis的schedule命令安排任务在未来执行。</p> </li><li> <p>创建具体的任务：SampleTask类实现了Runnable接口，定义了任务的具体执行逻辑。</p> </li><li> <p>创建控制器：scheduleTask端点允许用户安排任务在未来执行。用户需要提供延迟时间和时间单位。</p> </li></ul> 
<p>通过这种方式，我们可以利用Redis的schedule命令来安排任务的执行。这对于需要执行定时任务的应用非常有用，如定时数据备份、定时发送通知等。通过Redis的延迟队列特性，我们可以简化任务调度的复杂性，并且能够灵活地安排任务在未来的任意时间点执行。</p> 
<h3><a id="16__1687"></a>16. 数据共享</h3> 
<p>针对Redis作为数据共享的使用场景，下面是一个Java Spring Boot应用的案例，其中使用Redis来实现微服务架构中的服务间数据共享。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们有一个电商平台，它由多个微服务组成，比如用户服务、产品服务和订单服务。这些服务需要共享购物车数据，以确保用户在平台上的购物体验是连贯的。我们将使用Redis来存储和共享购物车数据。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Data Redis</li><li>Spring Web</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-java">spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>host<span class="token operator">=</span>localhost
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">6379</span>
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建购物车项实体类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartItem</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> productId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> quantity<span class="token punctuation">;</span>
    <span class="token comment">// 省略构造函数、getter和setter方法</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>创建购物车服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token class-name">String</span> cartId<span class="token punctuation">,</span> <span class="token class-name">String</span> productId<span class="token punctuation">,</span> <span class="token keyword">int</span> quantity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 将购物车项存储到Redis的Hash结构中</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"cart:"</span> <span class="token operator">+</span> cartId<span class="token punctuation">,</span> productId<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCart</span><span class="token punctuation">(</span><span class="token class-name">String</span> cartId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 从Redis获取购物车内容</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token string">"cart:"</span> <span class="token operator">+</span> cartId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建控制器</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/cart"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">CartService</span> cartService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/{cartId}/items"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">addToCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> cartId<span class="token punctuation">,</span>
                                             <span class="token annotation punctuation">@RequestParam</span> <span class="token class-name">String</span> productId<span class="token punctuation">,</span>
                                             <span class="token annotation punctuation">@RequestParam</span> <span class="token keyword">int</span> quantity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cartService<span class="token punctuation">.</span><span class="token function">addToCart</span><span class="token punctuation">(</span>cartId<span class="token punctuation">,</span> productId<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token string">"Item added to cart"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{cartId}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCart</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> cartId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> cart <span class="token operator">=</span> cartService<span class="token punctuation">.</span><span class="token function">getCart</span><span class="token punctuation">(</span>cartId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>cart<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建购物车项实体类：CartItem类代表购物车中的商品项，包含商品ID和数量。</p> </li><li> <p>创建购物车服务：</p> 
  <ul><li>addToCart方法用于将商品项添加到用户的购物车中。使用Redis的Hash结构来存储购物车数据，其中cart:加上cartId作为Hash的键，productId作为字段名，quantity作为字段值。</li><li>getCart方法用于从Redis获取用户的购物车内容。</li></ul> </li><li> <p>创建控制器：</p> 
  <ul><li>addToCart端点允许用户将商品添加到购物车中。</li><li>getCart端点允许用户获取其购物车的内容。</li></ul> </li></ul> 
<p>通过这种方式，我们可以利用Redis的高性能和数据共享能力来实现微服务架构中的服务间数据共享。购物车数据被存储在Redis中，可以被不同的微服务实例访问和修改，确保了数据的一致性和实时性。这对于需要高度协同工作的分布式系统非常有用，如电商平台、在线协作工具等。</p> 
<h3><a id="17__1785"></a>17. 持久化</h3> 
<p>针对Redis作为任务调度使用场景，下面是一个Java Spring Boot应用的案例，其中使用Spring的@Scheduled注解与Redisson结合来实现任务调度。</p> 
<p><strong>场景描述</strong></p> 
<p>假设我们有一个自动化的营销平台，需要定期（例如每天凌晨1点）执行一些任务，比如发送时事通讯邮件给订阅用户。我们将使用Spring的定时任务功能结合Redisson来确保分布式环境下任务的准时和准确执行。</p> 
<p><strong>环境准备</strong></p> 
<ol><li>安装Java开发环境。</li><li>安装Redis并确保其运行。</li><li>创建一个Spring Boot项目，并添加以下依赖：</li></ol> 
<ul><li>Spring Boot Starter Web</li><li>Spring Boot Starter Data Redis</li><li>Redisson</li></ul> 
<p><strong>创建Spring Boot项目</strong></p> 
<p>使用Spring Initializr (https://start.spring.io/) 创建一个项目，并添加所需的依赖。</p> 
<p><strong>配置Redis连接</strong></p> 
<p>在src/main/resources/application.properties中配置Redis服务器的连接信息：</p> 
<pre><code class="prism language-java">spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>host<span class="token operator">=</span>localhost
spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">6379</span>
</code></pre> 
<p><strong>编写业务代码</strong></p> 
<ol><li>创建任务执行服务</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTaskService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 执行任务的逻辑，例如发送邮件</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Executing scheduled task: "</span> <span class="token operator">+</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>配置Redisson</li></ol> 
<p>创建一个配置类来配置Redisson客户端。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod <span class="token operator">=</span> <span class="token string">"shutdown"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonClient</span> <span class="token function">redissonClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedissonClientConfig</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedissonClientConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token string">"redis://"</span> <span class="token operator">+</span> spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>host <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> spring<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Redisson</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.host}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> redisHost<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.redis.port}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> redisPort<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建定时任务配置</li></ol> 
<p>使用Redisson的RedissonScheduledExecutorService来创建一个分布式的调度器。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonScheduledExecutorService</span> <span class="token function">redissonScheduledExecutorService</span><span class="token punctuation">(</span><span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> redissonClient<span class="token punctuation">.</span><span class="token function">getExecutorService</span><span class="token punctuation">(</span><span class="token string">"myScheduler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>创建定时任务</li></ol> 
<p>使用Spring的@Scheduled注解和Redisson的调度器来执行定时任务。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTasks</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ScheduledTaskService</span> taskService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedissonScheduledExecutorService</span> scheduler<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span>cron <span class="token operator">=</span> <span class="token string">"0 0 1 * * ?"</span><span class="token punctuation">)</span> <span class="token comment">// 每天凌晨1点执行</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">scheduledTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        scheduler<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> taskService<span class="token punctuation">.</span><span class="token function">executeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>详细解释</strong></p> 
<ul><li> <p>配置Redis连接：在application.properties中配置了Redis服务器的地址和端口。</p> </li><li> <p>创建任务执行服务：ScheduledTaskService服务包含实际要执行的任务逻辑。</p> </li><li> <p>配置Redisson：RedissonConfig配置类设置了Redisson客户端，用于后续创建分布式调度器。</p> </li><li> <p>创建定时任务配置：ScheduledConfig配置类创建了一个RedissonScheduledExecutorService Bean，它将被用作分布式任务调度器。</p> </li><li> <p>创建定时任务：ScheduledTasks组件包含一个用@Scheduled注解的方法，该方法根据指定的cron表达式触发。当触发时，它使用Redisson的调度器来安排任务的执行。</p> </li></ul> 
<p>通过这种方式，我们可以利用Spring的定时任务功能和Redisson的分布式调度器来实现任务调度。这确保了即使在分布式系统中，任务也能准时和准确地执行，避免了任务执行的冲突和重复。这对于需要定时执行的任务，如发送时事通讯、数据备份、报告生成等场景非常有用。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/62b33a865f9a1410e4931295482769bd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flink⼤状态作业调优实践指南：状态报错与启停慢篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f481e58b42d46b6ebd0e41eede6e89ea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于Spark的电商推荐系统（高分毕设）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>