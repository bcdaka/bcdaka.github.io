<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【实战指南】SpringBoot结合Zookeeper/Nacos构建Dubbo微服务 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/535d13419b3c552b96d70a4b3a54e39c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【实战指南】SpringBoot结合Zookeeper/Nacos构建Dubbo微服务">
  <meta property="og:description" content="1、微服务架构 微服务架构是一种设计复杂应用程序的方法，它提倡将单一应用程序开发为一组小型、独立的服务，每个服务运行在其自己的进程中，并通过轻量级通信（通常是HTTP协议）进行交互。每个服务都是围绕业务功能构建的，能够独立部署、扩展和维护。
上述说常用的服务间通信的协议是HTTP协议，但是目前很多公司里也会使用Dubbo作为RPC调用框架。
HTTP协议是存在于ISO模型中的应用层，应用层实现具体的应用功能，为应用程序提供服务。
Dubbo则是基于TCP协议的RPC架构，而TCP协议处于ISO模型的传输层，传输层只是建立、管理和维护端到端的连接。
所以在请求的过程中，TCP协议会比HTTP协议封装更少的内容，速度也比HTTP会快一些。
微服务核心特点：
模块化：微服务架构强调高内聚低耦合，每个服务专注于执行单一业务功能，这使得系统更易于理解和维护。独立部署：每个微服务都可以独立于其他服务进行构建、测试、部署和扩展，减少了部署时的相互影响。技术栈灵活：不同的微服务可以根据具体需求选择最适合的技术栈，不必受限于整个系统的统一技术选择。弹性伸缩：微服务架构允许按需扩展特定的服务实例，以应对高负载情况，而无需扩展整个应用程序。故障隔离：如果某个微服务出现故障，不会立即影响整个系统，因为其他服务仍然可以正常运行。持续交付：由于微服务的独立性和自动化测试，团队可以更频繁地进行代码提交和部署，加速产品迭代速度。数据管理：每个微服务通常拥有自己的数据库，遵循“数据所有权”原则，避免了全局数据模式的复杂性。 1.1、Dubbo在微服务架构中的角色 Dubbo在微服务架构中不仅提供了高效的服务间通信机制，还通过其全面的服务治理能力，极大地降低了构建、管理和维护复杂微服务架构的难度
服务治理：Dubbo是一个高性能、轻量级的开源服务框架，它提供了全面的服务治理解决方案，包括服务注册、服务发现、负载均衡、容错、限流、动态配置等功能，帮助构建稳定可靠的微服务架构。RPC通信：Dubbo采用高性能的RPC（Remote Procedure Call）通信机制，允许服务消费者远程调用服务提供者的接口，就像调用本地方法一样简单，极大地简化了分布式系统间的交互。服务注册与发现：Dubbo支持多种注册中心，如Zookeeper、Nacos、Consul等，用于服务的自动注册与发现，使得服务提供者和消费者之间能够动态地找到彼此，而无需硬编码服务地址。智能路由：Dubbo提供了丰富的路由策略，如随机、轮询、最少活跃数、一致性哈希等，可以根据不同的场景和需求，智能地选择服务实例进行调用，提高服务调用效率和系统的整体性能。容错与重试：Dubbo内置了多种容错策略，如失败重试、失败回调、降级、熔断等，能够在服务不可用或网络异常时，提供优雅的降级方案，保证系统的稳定性和用户体验。监控与统计：Dubbo集成了强大的监控统计功能，可以实时监控服务调用的延迟、吞吐量、异常率等关键指标，帮助开发者快速定位和解决问题。灵活的配置管理：Dubbo支持动态配置更新，可以在不重启服务的情况下调整服务参数，提高了运维的灵活性和效率。 1.2、Zookeeper和Nacos作为服务注册与发现中心的作用。 （1）Zookeeper
Zookeeper主要用于协调分布式应用，提供了一套完整的分布式协调服务解决方案。它能够为分布式应用提供命名服务、配置管理、集群管理、分布式锁、队列管理等服务。
在微服务架构中，Zookeeper可以作为一个服务注册中心，各个微服务启动后会向Zookeeper注册自己的信息（如IP地址、端口号等），而其他需要调用这些服务的应用则可以从Zookeeper上查询到服务的信息，实现服务的自动发现。
Zookeeper的核心是其数据模型和Watcher机制，通过维护一个层次化的命名空间来存储数据，并且提供了实时的数据变更通知机制。但是，Zookeeper的性能并不适合高并发场景，且其API相对复杂，需要一定的学习成本。
（2）Nacos
Nacos是阿里巴巴开源的一款易于构建云原生应用的动态服务发现、配置管理和服务管理平台。它结合了服务发现与配置管理的功能，旨在简化微服务和DevOps的运维工作。
Nacos提供了一个强大的服务注册与发现功能，微服务可以在启动时向Nacos注册，同时Nacos也支持健康检查，确保只返回可用的服务实例。服务消费者可以通过Nacos发现并调用服务。
Nacos具有高可用性、高性能和易用性，支持动态配置更新，无需重启服务即可生效。此外，Nacos还提供了丰富的可视化界面，方便用户管理和监控服务。
2、环境准备 1、IDEA编码工具。
2、Maven依赖管理工具
2.1、安装和配置Zookeeper和Nacos。 2.1.1、Zookeeper （1）下载
Zookeeper是Apache旗下的产品，下载地址：Apache Zookeeper
（2）解压并启动
将Zookeeper压缩包下载好后进行解压。
解压好后还不能直接启动，还需要修改配置文件，一个很简单的修改操作。将conf目录下的zoo_sample.cfg文件改为zoo.cfg文件即可。
修改前：
修改后：
进入bin目录，在windows系统中直接双击zkServer.cmd文件启动Zookeeper，而在Linux系统下则需要运行zkServer.sh文件。
2.1.2、Nacos （1）下载
Nacos 是阿里的产品，现在是 SpringCloud 中的一个组件。它的功能要比 Eureka、Zookeeper 更加丰富，在国内比较受欢迎。
下载地址：Nacos GitHub下载地址
（2）下载后解压
（3）修改数据库配置
进入conf目录下，打开application.properties文件，需要在这里面修改数据库的配置。
在修改数据库配置之前需要走一个必不可少的流程，就是将conf目录下的mysql-schema.sql在指定的数据库中执行一次，让数据库中有所需要的表。
数据库的配置信息从33行开始。
#*************** Config Module Related Configurations ***************# ### If use MySQL as datasource: ### Deprecated configuration property, it is recommended to use `spring.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-19T23:45:46+08:00">
    <meta property="article:modified_time" content="2024-06-19T23:45:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【实战指南】SpringBoot结合Zookeeper/Nacos构建Dubbo微服务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_0"></a>1、微服务架构</h2> 
<p><font color="red">微服务架构是一种设计复杂应用程序的方法，它提倡将单一应用程序开发为一组小型、独立的服务，每个服务运行在其自己的进程中，并通过轻量级通信（通常是HTTP协议）进行交互。每个服务都是围绕业务功能构建的，能够独立部署、扩展和维护。</font></p> 
<p>上述说常用的服务间通信的协议是HTTP协议，但是目前很多公司里也会使用Dubbo作为RPC调用框架。</p> 
<p><strong><font color="red">HTTP协议是存在于ISO模型中的应用层，应用层实现具体的应用功能，为应用程序提供服务。<br> Dubbo则是基于TCP协议的RPC架构，而TCP协议处于ISO模型的传输层，传输层只是建立、管理和维护端到端的连接。</font></strong></p> 
<p><font color="green">所以在请求的过程中，TCP协议会比HTTP协议封装更少的内容，速度也比HTTP会快一些。</font></p> 
<p><img src="https://images2.imgbox.com/9e/43/eFcxo1GJ_o.png" alt="在这里插入图片描述"></p> 
<p>微服务核心特点：</p> 
<ol><li><strong>模块化</strong>：微服务架构强调高内聚低耦合，每个服务专注于执行单一业务功能，这使得系统更易于理解和维护。</li><li><strong>独立部署</strong>：每个微服务都可以独立于其他服务进行构建、测试、部署和扩展，减少了部署时的相互影响。</li><li><strong>技术栈灵活</strong>：不同的微服务可以根据具体需求选择最适合的技术栈，不必受限于整个系统的统一技术选择。</li><li><strong>弹性伸缩</strong>：微服务架构允许按需扩展特定的服务实例，以应对高负载情况，而无需扩展整个应用程序。</li><li><strong>故障隔离</strong>：如果某个微服务出现故障，不会立即影响整个系统，因为其他服务仍然可以正常运行。</li><li><strong>持续交付</strong>：由于微服务的独立性和自动化测试，团队可以更频繁地进行代码提交和部署，加速产品迭代速度。</li><li><strong>数据管理</strong>：每个微服务通常拥有自己的数据库，遵循“数据所有权”原则，避免了全局数据模式的复杂性。</li></ol> 
<p><img src="https://images2.imgbox.com/2c/a0/tqwN0kOm_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="11Dubbo_27"></a>1.1、Dubbo在微服务架构中的角色</h3> 
<p>Dubbo在微服务架构中不仅提供了高效的服务间通信机制，还通过其全面的服务治理能力，极大地降低了构建、管理和维护复杂微服务架构的难度</p> 
<ol><li><strong>服务治理</strong>：Dubbo是一个高性能、轻量级的开源服务框架，它提供了全面的服务治理解决方案，包括服务注册、服务发现、负载均衡、容错、限流、动态配置等功能，帮助构建稳定可靠的微服务架构。</li><li><strong>RPC通信</strong>：Dubbo采用高性能的RPC（Remote Procedure Call）通信机制，允许服务消费者远程调用服务提供者的接口，就像调用本地方法一样简单，极大地简化了分布式系统间的交互。</li><li><strong>服务注册与发现</strong>：Dubbo支持多种注册中心，如Zookeeper、Nacos、Consul等，用于服务的自动注册与发现，使得服务提供者和消费者之间能够动态地找到彼此，而无需硬编码服务地址。</li><li><strong>智能路由</strong>：Dubbo提供了丰富的路由策略，如随机、轮询、最少活跃数、一致性哈希等，可以根据不同的场景和需求，智能地选择服务实例进行调用，提高服务调用效率和系统的整体性能。</li><li><strong>容错与重试</strong>：Dubbo内置了多种容错策略，如失败重试、失败回调、降级、熔断等，能够在服务不可用或网络异常时，提供优雅的降级方案，保证系统的稳定性和用户体验。</li><li><strong>监控与统计</strong>：Dubbo集成了强大的监控统计功能，可以实时监控服务调用的延迟、吞吐量、异常率等关键指标，帮助开发者快速定位和解决问题。</li><li><strong>灵活的配置管理</strong>：Dubbo支持动态配置更新，可以在不重启服务的情况下调整服务参数，提高了运维的灵活性和效率。</li></ol> 
<h3><a id="12ZookeeperNacos_38"></a>1.2、Zookeeper和Nacos作为服务注册与发现中心的作用。</h3> 
<p>（1）Zookeeper<br> <font color="red"> Zookeeper主要用于协调分布式应用，提供了一套完整的分布式协调服务解决方案。它能够为分布式应用提供命名服务、配置管理、集群管理、分布式锁、队列管理等服务。</font></p> 
<p>在微服务架构中，Zookeeper可以作为一个服务注册中心，各个微服务启动后会向Zookeeper注册自己的信息（如IP地址、端口号等），而其他需要调用这些服务的应用则可以从Zookeeper上查询到服务的信息，实现服务的自动发现。</p> 
<p><strong><font color="green">Zookeeper的核心是其数据模型和Watcher机制，通过维护一个层次化的命名空间来存储数据，并且提供了实时的数据变更通知机制。但是，Zookeeper的性能并不适合高并发场景，且其API相对复杂，需要一定的学习成本。</font></strong></p> 
<p>（2）Nacos<br> <font color="red">Nacos是阿里巴巴开源的一款易于构建云原生应用的动态服务发现、配置管理和服务管理平台。它结合了服务发现与配置管理的功能，旨在简化微服务和DevOps的运维工作。</font></p> 
<p>Nacos提供了一个强大的服务注册与发现功能，微服务可以在启动时向Nacos注册，同时Nacos也支持健康检查，确保只返回可用的服务实例。服务消费者可以通过Nacos发现并调用服务。</p> 
<p><strong><font color="green">Nacos具有高可用性、高性能和易用性，支持动态配置更新，无需重启服务即可生效。此外，Nacos还提供了丰富的可视化界面，方便用户管理和监控服务。</font></strong></p> 
<h2><a id="2_53"></a>2、环境准备</h2> 
<p>1、IDEA编码工具。<br> 2、Maven依赖管理工具</p> 
<h3><a id="21ZookeeperNacos_56"></a>2.1、安装和配置Zookeeper和Nacos。</h3> 
<h4><a id="211Zookeeper_57"></a>2.1.1、Zookeeper</h4> 
<p>（1）下载<br> Zookeeper是Apache旗下的产品，下载地址：<a href="https://downloads.apache.org/zookeeper/" rel="nofollow">Apache Zookeeper</a><br> <img src="https://images2.imgbox.com/41/05/ZyEgAiOs_o.png" alt="在这里插入图片描述"><br> （2）解压并启动<br> 将Zookeeper压缩包下载好后进行解压。<br> <img src="https://images2.imgbox.com/76/12/cisU1GlU_o.png" alt="在这里插入图片描述"><br> 解压好后还不能直接启动，还需要修改配置文件，一个很简单的修改操作。<code>将conf目录下的zoo_sample.cfg文件改为zoo.cfg文件</code>即可。</p> 
<p>修改前：<br> <img src="https://images2.imgbox.com/1d/cb/B2GobCmG_o.png" alt="在这里插入图片描述"><br> 修改后：<br> <img src="https://images2.imgbox.com/eb/21/n3xuVPAy_o.png" alt="在这里插入图片描述"><br> <code>进入bin目录，在windows系统中直接双击zkServer.cmd文件启动Zookeeper，而在Linux系统下则需要运行zkServer.sh文件。</code></p> 
<h4><a id="212Nacos_72"></a>2.1.2、Nacos</h4> 
<p>（1）下载<br> Nacos 是阿里的产品，现在是 SpringCloud 中的一个组件。它的功能要比 Eureka、Zookeeper 更加丰富，在国内比较受欢迎。<br> 下载地址：<a href="https://github.com/alibaba/nacos/releases">Nacos GitHub下载地址</a><br> <img src="https://images2.imgbox.com/3b/a0/QCkI6DKK_o.png" alt="在这里插入图片描述"></p> 
<p>（2）下载后解压<br> <img src="https://images2.imgbox.com/56/fe/pP9Xcg4C_o.png" alt="在这里插入图片描述"><br> （3）修改数据库配置<br> <code>进入conf目录下，打开application.properties文件，需要在这里面修改数据库的配置。</code><br> <img src="https://images2.imgbox.com/92/79/CyIdtcTF_o.png" alt="在这里插入图片描述"><br> <strong><font color="red">在修改数据库配置之前需要走一个必不可少的流程，就是将conf目录下的mysql-schema.sql在指定的数据库中执行一次，让数据库中有所需要的表。</font></strong></p> 
<p>数据库的配置信息从33行开始。</p> 
<pre><code class="prism language-bash"><span class="token comment">#*************** Config Module Related Configurations ***************#</span>
<span class="token comment">### If use MySQL as datasource:</span>
<span class="token comment">### Deprecated configuration property, it is recommended to use `spring.sql.init.platform` replaced.</span>
<span class="token assign-left variable">spring.datasource.platform</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">spring.sql.init.platform</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">db.num</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">db.url</span><span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC
<span class="token assign-left variable">db.user</span><span class="token operator">=</span>root
<span class="token assign-left variable">db.password</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre> 
<p>（4）启动Nacos<br> 在bin目录下执行指定的命令：<br> 1、单机模式：<code>startup.cmd -m standalone</code><br> 2、集群模式：<code>startup.cmd -m cluster</code>，需要开启集群模式。<br> <img src="https://images2.imgbox.com/2d/9b/pAMRTBtd_o.png" alt="在这里插入图片描述"><br> 看到上述情况则表示Nacos启动成功，可以访问：<code>http://localhost:8848/nacos</code>，用户名和密码如果没有设置的话都是：nacos/nacos。<br> <img src="https://images2.imgbox.com/fb/68/FCi0tHTK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22_108"></a>2.2、依赖版本选择</h3> 
<ol><li>SpringBoot依赖版本：<strong>2.7.17</strong></li><li>JDK版本：<strong>JDK 17</strong></li><li>Dobbu依赖版本：<strong>2.7.17（nacos)、3.2.12（zookeeper)</strong></li><li>Nacos依赖版本：<strong>2021.0.5.0</strong></li></ol> 
<h4><a id="221Zookeeperpom_115"></a>2.2.1、Zookeeper版本下父pom依赖</h4> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns:xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi:schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/modelVersion<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com.tt<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-demo<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">0.0</span>.1-SNAPSHOT<span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>packaging<span class="token operator">&gt;</span>pom<span class="token operator">&lt;</span>/packaging<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>zookeeper-registry<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>modules<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>provider<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>interface-api<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>Consumer<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/modules<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.source<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/maven.compiler.source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.target<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/maven.compiler.target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>project.build.sourceEncoding<span class="token operator">&gt;</span>UTF-<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/project.build.sourceEncoding<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencyManagement<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.apache.dubbo<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-spring-boot-starter<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">3.2</span>.1<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">3.2</span>.<span class="token operator"><span class="token file-descriptor important">5</span>&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.apache.dubbo<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-registry-zookeeper<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">3.2</span>.1<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-web<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">3.2</span>.<span class="token operator"><span class="token file-descriptor important">5</span>&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.projectlombok<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.18</span>.3<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/version<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>provided<span class="token operator">&lt;</span>/scope<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>/dependencies<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/dependencyManagement<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/project<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="222Nacospom_181"></a>2.2.2、Nacos模式下父pom依赖</h4> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>?<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>project <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0"</span>
         xmlns:xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         xsi:schemaLocation<span class="token operator">=</span><span class="token string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>modelVersion<span class="token operator">&gt;</span><span class="token number">4.0</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/modelVersion<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>parent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com.tt<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-demo<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">0.0</span>.1-SNAPSHOT<span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/parent<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>packaging<span class="token operator">&gt;</span>pom<span class="token operator">&lt;</span>/packaging<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>nacos-registry<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>modules<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>nacos-interface-api<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>nacos-provider<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>nacos-consumer<span class="token operator">&lt;</span>/module<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/modules<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.source<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/maven.compiler.source<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>maven.compiler.target<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/maven.compiler.target<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>project.build.sourceEncoding<span class="token operator">&gt;</span>UTF-<span class="token operator"><span class="token file-descriptor important">8</span>&lt;</span>/project.build.sourceEncoding<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>spring.version<span class="token operator">&gt;</span><span class="token number">2.7</span>.1<span class="token operator"><span class="token file-descriptor important">7</span>&lt;</span>/spring.version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>dependencyManagement<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>dependencies<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.apache.dubbo<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-spring-boot-starter<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${spring.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${spring.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.springframework.boot<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-boot-starter-web<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${spring.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.projectlombok<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>lombok<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">1.18</span>.3<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>org.apache.dubbo<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>dubbo-registry-nacos<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token variable">${spring.version}</span><span class="token operator">&lt;</span>/version<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>dependency<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>groupId<span class="token operator">&gt;</span>com.alibaba.cloud<span class="token operator">&lt;</span>/groupId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>artifactId<span class="token operator">&gt;</span>spring-cloud-alibaba-dependencies<span class="token operator">&lt;</span>/artifactId<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">2021.0</span>.5.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>type<span class="token operator">&gt;</span>pom<span class="token operator">&lt;</span>/type<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>scope<span class="token operator">&gt;</span>import<span class="token operator">&lt;</span>/scope<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>/dependency<span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span>/dependencies<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>/dependencyManagement<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>/project<span class="token operator">&gt;</span>
</code></pre> 
<h2><a id="3DubboSpringBoot_257"></a>3、Dubbo与SpringBoot集成</h2> 
<p>将阿里巴巴开源的高性能、轻量级的微服务框架Dubbo，与流行的Spring Boot框架结合使用，以构建分布式服务应用。这种集成可以充分利用Dubbo的RPC（远程过程调用）功能和Spring Boot的快速开发特性，<font color="red">实现服务的自动注册、发现、负载均衡、容错、降级等功能。</font></p> 
<h3><a id="31_260"></a>3.1、整体项目结构</h3> 
<p><img src="https://images2.imgbox.com/03/62/0q5vkMqL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32_263"></a>3.2、公共模块</h3> 
<p>公共模块主要是提供接口和公共的对象。</p> 
<h4><a id="321Nacos_265"></a>3.2.1、Nacos模式下的公共模块</h4> 
<p><img src="https://images2.imgbox.com/a7/eb/zJEjBs0A_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token comment">// 提供公共的接口，具体业务由实现类完成。</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="322Zookeeper_278"></a>3.2.2、Zookeeper模式下的公共模块</h4> 
<p><img src="https://images2.imgbox.com/fe/b8/SXxD3b8h_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="32_288"></a>3.2、构建服务提供者</h3> 
<p>服务提供者，先导入公共模块的依赖同时实现相应的接口，并将实现类的信息上传到注册中心。</p> 
<h4><a id="321Nacos_291"></a>3.2.1、Nacos模式服务提供者</h4> 
<p>（1）导入API公共模块依赖<br> 在服务提供者的pom文件中导入API模块的依赖</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.tt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nacos-interface-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（2）实现接口，完成业务逻辑</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@DubboService</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 省略具体的业务逻辑</span>
        <span class="token keyword">return</span> username <span class="token operator">+</span> <span class="token string">"登录成功"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p><font color="red">@DubboService是Dubbo Spring Boot Starter提供的一个注解，用于标记一个接口的实现类为Dubbo的服务提供者。</font></p> 
<p>（3）开启Dubbo服务并设置配置中心</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDubbo</span> <span class="token comment">// 在启动类上开启Dubbo服务</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosProviderApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosProviderApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 2cb71f92<span class="token punctuation">-</span>6787<span class="token punctuation">-</span>40bd<span class="token punctuation">-</span>b9df<span class="token punctuation">-</span>ccc2be92e0ec
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 2cb71f92<span class="token punctuation">-</span>6787<span class="token punctuation">-</span>40bd<span class="token punctuation">-</span>b9df<span class="token punctuation">-</span>ccc2be92e0ec
<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>//$<span class="token punctuation">{<!-- --></span>spring.cloud.nacos.config.server<span class="token punctuation">-</span>addr<span class="token punctuation">}</span>
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20880</span> <span class="token comment"># dubbo服务端口</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo <span class="token comment"># 协议</span>
<span class="token comment">#  monitor:</span>
<span class="token comment">#    protocol: registry</span>
  <span class="token key atrule">scan</span><span class="token punctuation">:</span>
    <span class="token key atrule">base-packages</span><span class="token punctuation">:</span> com.tt.service
</code></pre> 
<h4><a id="322Zookeeper_358"></a>3.2.2、Zookeeper模式服务提供者</h4> 
<p>Zookeeper模式下的服务提供者除了配置文件与Nacos模式的服务提供者不同，其他基本一致。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tt<span class="token punctuation">-</span>provider

<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span>
<span class="token comment">#    serialization: kryo</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> zookeeper<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">2181</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">qos-port</span><span class="token punctuation">:</span> <span class="token number">2222</span>
  <span class="token key atrule">provider</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
  <span class="token key atrule">scan</span><span class="token punctuation">:</span>
    <span class="token key atrule">base-packages</span><span class="token punctuation">:</span> com.tt.service

</code></pre> 
<h3><a id="33_382"></a>3.3、构建服务消费者</h3> 
<p>在Dubbo模式下，服务消费者调用服务提供者的路径是一个涉及多个组件和步骤的过程。下面是一个典型的调用流程概述：</p> 
<ol><li>服务注册<br> 服务提供者启动时，它会向注册中心（如Zookeeper）注册其提供的服务，包括服务的接口名、版本、所在主机、端口等信息。</li><li>服务发现<br> 当服务消费者启动时，它会向注册中心订阅所需服务的接口信息。<br> 注册中心返回服务提供者列表给消费者。</li><li>代理创建<br> 消费者根据服务接口生成动态代理对象（Proxy），这个代理对象对用户透明，看起来就像在本地调用一样。</li><li>调用路由<br> 当消费者通过代理对象调用服务时，调用会被转发到Invoker。<br> Invoker使用集群路由策略（如轮询、最少活跃数、一致性哈希等）选择一个服务提供者。</li><li>远程调用<br> 选定提供者后，调用请求通过网络传输到提供者，通常使用Netty等高性能网络框架。<br> 提供者接收到请求后，执行本地调用并返回结果。</li><li>结果处理<br> 结果被编码并通过网络返回给消费者。<br> 消费者接收到结果，完成整个调用链路。</li></ol> 
<h4><a id="331Nacos_402"></a>3.3.1、Nacos模式下消费者</h4> 
<p>（1）开启Dubbo服务并配置注册中心</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDubbo</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConsumerApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosConsumerApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8082</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>consumer
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 2cb71f92<span class="token punctuation">-</span>6787<span class="token punctuation">-</span>40bd<span class="token punctuation">-</span>b9df<span class="token punctuation">-</span>ccc2be92e0ec
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 2cb71f92<span class="token punctuation">-</span>6787<span class="token punctuation">-</span>40bd<span class="token punctuation">-</span>b9df<span class="token punctuation">-</span>ccc2be92e0ec
<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>//$<span class="token punctuation">{<!-- --></span>spring.cloud.nacos.config.server<span class="token punctuation">-</span>addr<span class="token punctuation">}</span>
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20880</span> <span class="token comment"># dubbo服务端口</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo <span class="token comment"># 协议</span>
<span class="token comment">#  monitor:</span>
<span class="token comment">#    protocol: registry</span>
<span class="token comment">#  scan:</span>
<span class="token comment">#    base-packages: com.tt.service</span>
</code></pre> 
<p>（2）进行Dubbo调用</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@DubboReference</span> <span class="token comment">// 通过接口进行代理对象的注入，然后进行RPC调用</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/login/{username}/{password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="332Zookeeper_462"></a>3.3.2、Zookeeper模式下消费者</h4> 
<p>同Nacos模式下的消费者类似。</p> 
<h2><a id="4Dubbo_465"></a>4、Dubbo特性</h2> 
<h3><a id="41Dubbo_466"></a>4.1、Dubbo的负载均衡策略</h3> 
<p>Dubbo是一个高性能、轻量级的开源微服务框架，它支持多种负载均衡策略来优化服务调用的分布，从而提高系统的整体性能和稳定性。以下是Dubbo支持的主要负载均衡策略：</p> 
<ol><li>随机（Random）<br> <font color="Red">这是Dubbo默认的负载均衡策略</font>，它随机选择一个可用的服务实例进行调用。如果配置了权重，那么权重较大的服务实例被选中的概率也更大。</li><li>轮询（RoundRobin）<br> 也称为循环调度，按顺序逐一分配请求到不同的服务实例，保证每个实例都能公平地接收请求。当配置了权重时，权重高的实例会有更高的机会被选中。</li><li>最少活跃数（LeastActive）<br> 选择活跃数最少的服务实例，即正在处理请求最少的那个实例，这样可以避免某些服务实例过载。</li><li>一致性哈希（ConsistentHash）<br> 基于请求参数的哈希值进行路由，将请求分配给距离当前哈希值最近的下一个服务实例。这种策略可以减少服务实例变化带来的重新分配成本。</li><li>加权轮询（WeightedRoundRobin）<br> 这是轮询策略的一种扩展，根据服务实例的权重进行轮询，权重大的实例被选中的频率更高。</li><li>加权随机（WeightedRandom）<br> 类似于随机策略，但是根据服务实例的权重来随机选择，权重越高的实例被选中的概率越大。</li></ol> 
<p>在实际应用中，你可以根据服务的具体需求和场景选择合适的负载均衡策略，也可以自定义实现以满足更复杂的需求。这些策略可以通过Dubbo的配置文件或者注解来指定，例如在@Reference注解中使用loadbalance属性来指定负载均衡策略。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@DubboReference</span><span class="token punctuation">(</span>loadbalance <span class="token operator">=</span> <span class="token string">"random"</span><span class="token punctuation">)</span> <span class="token comment">// 声明使用的负载均衡策略</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/login/{username}/{password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>负载均衡是分布式系统中一个关键的部分，它有助于提升系统的可用性、伸缩性和性能。</p> 
<h3><a id="42_499"></a>4.2、容错机制和重试策略。</h3> 
<p>Dubbo提供了多种容错机制和重试策略，用于处理服务调用时可能遇到的故障和异常情况。<font color="red">这些机制可以帮助服务保持高可用性和稳定性</font>，尤其是在分布式系统中。下面是几种主要的容错和重试策略：</p> 
<ol><li>Failover（失败自动切换）<br> 当调用失败时，Dubbo会自动切换到其他可用的服务提供者进行重试。<br> 这种策略通常用于读操作，因为重试可能会带来额外的延迟。<br> 可以通过retries参数来设置重试次数（不包括首次调用）。</li><li>Failfast（快速失败）：<br> 只发起一次调用，如果调用失败，则立即抛出异常并终止后续调用。<br> 适用于非幂等性的写操作，例如新增记录。</li><li>Failsafe（失败安全）：<br> 出现异常时，直接忽略并返回一个默认结果或空结果。<br> 通常用于写入审计日志等操作，即使失败也不影响系统的主要功能。</li><li>Failback（失败自动恢复）：<br> 请求失败后，会自动记录在失败队列中，并由一个定时线程在后台重试。<br> 这种策略适用于那些可以延后处理且不会造成严重后果的操作。</li><li>Forking（并行调用）：<br> 同时调用多个服务提供者，只要其中一个成功即返回。<br> 适用于实时性要求较高的读操作，但需要消耗更多的服务资源。</li><li>Broadcast（广播调用）：<br> 广播调用所有服务提供者，逐个调用，任意一台报错则报错。<br> 通常用于通知所有提供者更新缓存或日志等本地资源信息。</li></ol> 
<p>在实际应用中，可以根据服务的特性和业务需求选择合适的容错策略。例如，对于查询语句，推荐使用默认的Failover策略，而对于增删改操作，建议使用Failfast策略，或者使用Failover策略但将retries设为0，以防止数据重复添加。</p> 
<p>这些策略可以通过Dubbo的配置文件或代码中的注解来指定，例如在@DubboReference或@DubboService注解中使用cluster属性来设置容错策略。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

<span class="token comment">// 随机的负载均衡策略，失败自动切换的容错机制，5次的重试机制</span>
    <span class="token annotation punctuation">@DubboReference</span><span class="token punctuation">(</span>loadbalance <span class="token operator">=</span> <span class="token string">"random"</span><span class="token punctuation">,</span> cluster <span class="token operator">=</span> <span class="token string">"failover"</span><span class="token punctuation">,</span> retries <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/login/{username}/{password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果项目中使用的是XML，可以使用以下写法：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">dubbo:</span>reference</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>demoService<span class="token punctuation">"</span></span> <span class="token attr-name">interface</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.DemoService<span class="token punctuation">"</span></span>  <span class="token attr-name">cluster</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>failover<span class="token punctuation">"</span></span> <span class="token attr-name">retries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<h3><a id="43_546"></a>4.3、服务降级和熔断</h3> 
<p>Dubbo的服务降级和服务熔断是微服务架构中用于增强系统稳定性和防止雪崩效应的关键机制。它们通过限制或改变服务调用行为，来保护系统免受异常服务实例的影响。</p> 
<h4><a id="431_548"></a>4.3.1、服务降级</h4> 
<p>服务降级是指在服务调用遇到问题时，主动降低服务的功能或性能，返回一个默认或简化的响应，而不是等待服务响应或重试。这有助于避免服务调用方因等待无响应的服务而导致的资源耗尽。</p> 
<p>在Dubbo中，服务降级可以通过多种方式实现：</p> 
<ol><li>Mock机制：Dubbo允许你配置一个Mock对象，当服务调用失败时，Mock对象会返回一个预定义的响应，而不是抛出异常。这可以通过在@DubboReference注解中设置mock属性，或者在XML配置中使用mock标签来实现。</li><li>自定义降级逻辑：你也可以编写自定义的降级逻辑，例如，当服务不可用时，返回一个静态的错误页面或默认值。</li></ol> 
<h5><a id="4311_556"></a>4.3.1.1、简单的降级</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@DubboReference</span><span class="token punctuation">(</span>mock <span class="token operator">=</span> <span class="token string">"return null"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">MyService</span> myService<span class="token punctuation">;</span>
</code></pre> 
<p>当myService调用失败时立马返回null。</p> 
<h5><a id="4312Mock_564"></a>4.3.1.2、自定义Mock</h5> 
<p>（1）实现降级方法</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServiceMock</span> <span class="token keyword">implements</span> <span class="token class-name">MyService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> param<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Mocked response for: "</span> <span class="token operator">+</span> param<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（2）配置mock</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@DubboReference</span><span class="token punctuation">(</span>mock <span class="token operator">=</span> <span class="token string">"com.example.service.MyServiceMock$someMethod"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">MyService</span> myService<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="432_583"></a>4.3.2、服务熔断</h4> 
<p>服务熔断是一种保护机制，当一个服务的调用失败率达到一定程度时，Dubbo会自动“断开”对该服务的调用，直接返回错误或预定义的响应，而不是继续尝试调用可能已失败的服务。这可以防止大量请求涌向已知有问题的服务，避免进一步的系统崩溃。</p> 
<p>Dubbo可以通过集成Hystrix来实现服务熔断。Hystrix是Netflix开源的一个容错库，它可以监控服务调用的健康状态，并在必要时触发熔断机制。</p> 
<p>要使用Hystrix进行熔断，你需要做以下几点：</p> 
<ol><li>引入Hystrix依赖：在项目中添加Hystrix的依赖。</li><li>配置Hystrix：配置Hystrix的规则，比如失败率阈值、熔断时间窗口等。</li><li>使用@HystrixCommand注解：在服务调用方法上添加@HystrixCommand注解，指定熔断的逻辑和回退方法。</li><li>定义回退方法：当服务调用被熔断时，Hystrix会调用你定义的回退方法来处理请求。</li></ol> 
<p>在Dubbo中，你还可以通过配置circuitBreaker相关属性来控制熔断的行为:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@DubboReference</span><span class="token punctuation">(</span>circuitBreaker <span class="token operator">=</span> <span class="token string">"on"</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">,</span> retries <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">DemoService</span> demoService<span class="token punctuation">;</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4dae73fbb22e058f00e706ad2c87c66b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java——常用类库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0974068b977de7e9bd19c1b93461500c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Mac 从 0 到 1 保姆级配置教程 03】 - 安装配置美化 iterm2 一气呵成，Mac 下经久不衰的终端</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>