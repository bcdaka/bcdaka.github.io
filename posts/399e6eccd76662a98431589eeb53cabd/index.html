<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【MySQL】MySQL Connect -- 详解 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/399e6eccd76662a98431589eeb53cabd/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【MySQL】MySQL Connect -- 详解">
  <meta property="og:description" content="一、Connector / C 使用 要使用 C 语言连接 MySQL，需要使用 MySQL 官网提供的库，可以去官网进行下载：MySQL :: MySQL Community Downloads
我们使用 C 接口库来进行连接，要正确使用，还需要做一些准备工作： 保证 MySQL 服务有效。在官网上下载合适自己平台的 MySQL Connect 库，以备后用。 现在可以不需要像上面这样做了，因为我们在安装数据库时，系统就已经帮我们安装好了。
二、准备工作 1、验证库是否引入成功 编译并运行：
可以查看到当前 mysql 客户端的版本号。
三、MySQL 接口介绍 MySQL :: Developer Zone
可以自行选择：
1、初始化 mysql_init() 要使用库，就必须先进行初始化。
2、链接数据库 mysql_real_connect 初始化完毕之后，必须先链接数据库，在进行后续操作（MySQL 网络部分是基于 TCP/IP的）。
第一个参数 MYSQL 是 C api 中一个非常重要的变量（mysql_init 的返回值），里面内存非常丰富，有 port，dbname，charset 等连接基本参数。它也包含了一个叫 st_mysql_methods 的结构体变量，该变量里面保存着很多函数指针，这些函数指针将会在数据库连接成功以后的各种数据操作中被调用。
建立好链接之后，获取英文没有问题，如果获取中文是乱码：需要设置链接的默认字符集为 utf-8，原始默认是 latin1。
3、下发 MySQL 命令 mysql_query 第二个参数是要执行的 sql 语句，如 select * from table。 4、获取执行结果 mysql_store_result sql 执行完以后，如果是查询语句，当然还要读取数据。如果 update，insert 等语句，那么就看下操作成功与否即可。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-03T08:55:22+08:00">
    <meta property="article:modified_time" content="2024-06-03T08:55:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【MySQL】MySQL Connect -- 详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、<span style="color:#333333;">Connector / C </span><span style="color:#333333;">使用</span></h2> 
<p><span style="color:#333333;">要使用 C 语言连接 MySQL，需要使用 MySQL 官网提供的库，可以去官网进行下载：</span><a href="https://dev.mysql.com/downloads/" rel="nofollow" title="MySQL :: MySQL Community Downloads">MySQL :: MySQL Community Downloads</a></p> 
<p><span style="color:#333333;">我们使用 </span><span style="color:#333333;">C </span><span style="color:#333333;">接口库来进行连接，要正确使用，还需要做一些准备工作： </span></p> 
<div> 
 <blockquote> 
  <ul><li><span style="color:#0d0016;">保证 </span><span style="color:#333333;">MySQL </span><span style="color:#0d0016;">服务有效。</span></li><li><span style="color:#0d0016;">在官网上下载合适自己平台的 </span><span style="color:#333333;">MySQL C</span><span style="color:#0d0016;">onnect 库，以备后用。</span></li></ul> 
 </blockquote> 
 <p>现在可以不需要像上面这样做了，因为我们在安装数据库时，系统就已经帮我们安装好了。</p> 
 <p><img alt="" height="240" src="https://images2.imgbox.com/6a/71/pT4MNiz0_o.png" width="700"></p> 
 <p><img alt="" height="233" src="https://images2.imgbox.com/0e/85/GSeGVyZr_o.png" width="700"></p> 
</div> 
<hr> 
<h2>二、准备工作</h2> 
<h4>1、验证库是否引入成功</h4> 
<p><img alt="" height="179" src="https://images2.imgbox.com/e8/4c/ye3jLtyr_o.png" width="700"></p> 
<p>编译并运行：</p> 
<p><img alt="" height="148" src="https://images2.imgbox.com/84/49/EKedWDQj_o.png" width="700"></p> 
<p>可以查看到当前 mysql 客户端的版本号。</p> 
<p><img alt="" height="192" src="https://images2.imgbox.com/09/6a/vMxBDtez_o.png" width="700"></p> 
<hr> 
<h2>三、M<span style="color:#333333;">ySQL 接口介绍 </span></h2> 
<p><a href="https://dev.mysql.com/" rel="nofollow" title="MySQL :: Developer Zone">MySQL :: Developer Zone</a></p> 
<p><img alt="" height="322" src="https://images2.imgbox.com/63/6e/EOrVzy4k_o.png" width="700"></p> 
<p>可以自行选择：</p> 
<p><img alt="" height="363" src="https://images2.imgbox.com/17/a3/dPb5lfJp_o.png" width="700"></p> 
<p><img alt="" height="381" src="https://images2.imgbox.com/c1/74/w4oR0WzU_o.png" width="360"></p> 
<hr> 
<h4><span style="color:#0d0016;">1、初始化 mysql_init()</span><span style="color:#777777;"> </span></h4> 
<p><span style="color:#333333;">要使用库，就必须先进行<strong>初始化</strong>。</span></p> 
<p><img alt="" height="362" src="https://images2.imgbox.com/0a/23/6PxEAV8m_o.png" width="700"></p> 
<div> 
 <img alt="" height="145" src="https://images2.imgbox.com/15/0c/dzionjpx_o.png" width="460"> 
</div> 
<hr> 
<h4><span style="color:#0d0016;">2、链接数据库 mysql_real_connect</span></h4> 
<p><span style="color:#333333;">初始化完毕之后，必须先链接数据库，在进行后续操作（M</span><span style="color:#333333;">ySQL </span><span style="color:#333333;">网络部分是基于 </span><span style="color:#333333;">TCP/IP</span><span style="color:#333333;">的）。</span></p> 
<p><img alt="" height="183" src="https://images2.imgbox.com/88/59/LwOg7Ep6_o.png" width="700"></p> 
<p><span style="color:#333333;">第一个参数 MYSQL 是</span><span style="color:#333333;"> C api </span><span style="color:#333333;">中一个非常重要的变量（</span><span style="color:#333333;">mysql_init </span><span style="color:#333333;">的返回值），里面内存非常丰富，有 port，dbname，charset 等连接基本参数。它也包含了一个叫</span><span style="color:#333333;"> st_mysql_methods </span><span style="color:#333333;">的结构体变量，该变量里面保存着很多函数指针，这些函数指针将会在数据库连接成功以后的各种数据操作中被调用。</span></p> 
<p><img alt="" height="850" src="https://images2.imgbox.com/9f/20/Mkr1zeNR_o.png" width="560"></p> 
<p><img alt="" height="68" src="https://images2.imgbox.com/94/5f/ViMSBhX5_o.png" width="700"></p> 
<p><img alt="" height="473" src="https://images2.imgbox.com/8e/59/xAmuM41y_o.png" width="700"></p> 
<p>建立好链接之后，获取英文没有问题，如果获取中文是乱码：需要设置链接的默认字符集为 utf-8，原始默认是 latin1。</p> 
<p><img alt="" height="78" src="https://images2.imgbox.com/ae/67/xA6NXX0h_o.png" width="560"></p> 
<hr> 
<h4><span style="color:#333333;">3、</span><span style="color:#0d0016;">下发 MySQL 命令 mysql_query</span><span style="color:#777777;"> </span></h4> 
<p><img alt="" height="102" src="https://images2.imgbox.com/aa/e8/eyTKxhPQ_o.png" width="700"></p> 
<p><span style="color:#333333;"><strong>第二个参数</strong>是<span style="background-color:#ffd900;">要执行的 </span></span><span style="color:#333333;"><span style="background-color:#ffd900;">sql </span></span><span style="color:#333333;"><span style="background-color:#ffd900;">语句</span>，</span><span style="color:#333333;">如 </span><span style="color:#333333;">select * from table</span><span style="color:#333333;">。 </span></p> 
<div> 
 <img alt="" height="76" src="https://images2.imgbox.com/20/d4/uPxFsZlh_o.png" width="360"> 
</div> 
<p><img alt="" height="688" src="https://images2.imgbox.com/46/26/Zgy0hYcI_o.png" width="700"></p> 
<p><img alt="" height="202" src="https://images2.imgbox.com/aa/7f/ZfxxGz4d_o.png" width="320"></p> 
<p><img alt="" height="406" src="https://images2.imgbox.com/1f/a6/wW0SdsF5_o.png" width="700"></p> 
<p><img alt="" height="156" src="https://images2.imgbox.com/17/59/PglRZpi6_o.png" width="560"></p> 
<div> 
 <img alt="" height="196" src="https://images2.imgbox.com/f9/d5/lEiYjJHy_o.png" width="700"> 
</div> 
<hr> 
<h4 style="background-color:transparent;"><span style="color:#0d0016;">4、获取执行结果 mysql_store_result</span></h4> 
<p><span style="color:#333333;">sql </span><span style="color:#333333;">执行完以后，如果是查询语句，当然还要读取数据。如果 </span><span style="color:#333333;">update</span><span style="color:#333333;">，</span><span style="color:#333333;">insert </span><span style="color:#333333;">等语句，那么就看下操作成功与否即可。</span></p> 
<p><span style="color:#333333;">来看看如何获取查询结果： 如果 mysql_query </span><span style="color:#333333;">返回成功，那么就通过 </span><span style="color:#333333;">mysql_store_result </span><span style="color:#333333;">这个函数来读取结果。原型如下：</span></p> 
<p><img alt="" height="87" src="https://images2.imgbox.com/28/ea/X4BuvtYR_o.png" width="700"></p> 
<p><img alt="" height="69" src="https://images2.imgbox.com/a1/9f/w47G4rD0_o.png" width="700"></p> 
<p><span style="color:#333333;">该函数会调用 </span><span style="color:#333333;">MYSQL </span><span style="color:#333333;">变量中的 </span><span style="color:#333333;">st_mysql_methods </span><span style="color:#333333;">中的</span><span style="color:#333333;"> read_rows </span><span style="color:#333333;">函数指针来获取查询的结果，同时该函数还会返回 MYSQL_RES 这样一个变量，这个变量主要用于保存查询的结果。同时该函数 </span><span style="color:#333333;">malloc </span><span style="color:#333333;">了一片内存空间来存储查询过来的数据，所以一定要记得 free(result)，</span><span style="color:#333333;">不然肯定会造成内存泄漏的。 执行完 </span><span style="color:#333333;">mysql_store_result </span><span style="color:#333333;">后，其实数据都已经在 MYSQL_RES </span><span style="color:#333333;">变量中了，下面的 </span><span style="color:#333333;">api </span><span style="color:#333333;">基本就是读取 </span><span style="color:#333333;">MYSQL_RES </span><span style="color:#333333;">中的数据。 </span></p> 
<p><img alt="" height="374" src="https://images2.imgbox.com/c0/d7/EBWJDScs_o.png" width="560"></p> 
<p> MYSQL_RES 结构体可以行列为单位把查询得到的表结构数据组织好。</p> 
<p>在我们使用 mysql_query 函数进行查询结果后，对应的数据就被存放进了 MYSQL 结构体响应的空间中，此时我们再调用 mysql_store_result 函数，把这部分数据转储进 MYSQL_RES 结构体里。</p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/42/5b/ewqneXeu_o.png" width="500"></p> 
<hr> 
<h5><span style="color:#0d0016;">（1）获取结果行数 mysql_num_rows </span></h5> 
<p><img alt="" height="366" src="https://images2.imgbox.com/d8/e6/Q2gnpbGh_o.png" width="700"></p> 
<p><img alt="" height="187" src="https://images2.imgbox.com/34/64/DJp1wC5n_o.png" width="500"></p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/5c/b6/zGmpDylz_o.png" width="500"></p> 
<p><img alt="" height="179" src="https://images2.imgbox.com/03/63/ZEIu2aeE_o.png" width="1200"></p> 
<hr> 
<h5><span style="color:#0d0016;">（2）获取结果列数 mysql_num_fields</span></h5> 
<p><img alt="" height="397" src="https://images2.imgbox.com/ad/8e/qZkEZicr_o.png" width="700"></p> 
<p><img alt="" height="187" src="https://images2.imgbox.com/4f/82/vYdoGhak_o.png" width="500"></p> 
<p><img alt="" height="263" src="https://images2.imgbox.com/83/cd/emWjeIwR_o.png" width="500"></p> 
<p><img alt="" height="82" src="https://images2.imgbox.com/d4/91/6Lx09AWR_o.png" width="700"></p> 
<div> 
 <div> 
  <hr> 
  <h5><span style="color:#0d0016;">（3）获取列名 mysql_fetch_fields</span></h5> 
 </div> 
 <div> 
  <p><img alt="" height="264" src="https://images2.imgbox.com/aa/b5/mioKdsEv_o.png" width="700"></p> 
  <p><strong>MYSQL_FIELD </strong>中存储列的所有属性信息：</p> 
  <p><img alt="" height="417" src="https://images2.imgbox.com/0f/9b/PlLOcFrv_o.png" width="560"></p> 
  <p><img alt="" height="165" src="https://images2.imgbox.com/ce/f4/UVPJpZD0_o.png" width="460"></p> 
  <p><img alt="" height="144" src="https://images2.imgbox.com/df/20/OyKXhiBZ_o.png" width="360"></p> 
  <hr> 
  <h5><span style="color:#0d0016;">（4）获取结果内容 mysql_fetch_row </span></h5> 
  <p><img alt="" height="93" src="https://images2.imgbox.com/38/54/l1uEktHh_o.png" width="700"></p> 
  <p><img alt="" height="126" src="https://images2.imgbox.com/08/58/tQnvYsoc_o.png" width="700"></p> 
 </div> 
</div> 
<p><span style="color:#333333;">它会返回一个 </span><span style="color:#333333;">MYSQL_ROW </span><span style="color:#333333;">变量，</span><strong><span style="color:#333333;">MYSQL_ROW </span></strong><span style="color:#333333;">其实就是 </span><span style="color:#fe2c24;"><strong>char**</strong></span><span style="color:#333333;">，就把它</span><span style="color:#333333;">当作一个二维数组来用。</span></p> 
<p><img alt="" height="37" src="https://images2.imgbox.com/1b/73/pyPmwbp0_o.png" width="560"></p> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>注意</strong></span><span style="color:#333333;">：mysql 将所有的数据读取出来时，全都当作字符串。</span></p> 
</blockquote> 
<p><img alt="" height="234" src="https://images2.imgbox.com/6c/79/lzRJXKbu_o.png" width="460"></p> 
<p><img alt="" height="94" src="https://images2.imgbox.com/2c/61/ARxDo1vX_o.png" width="700"></p> 
<hr> 
<h4><span style="color:#0d0016;">5、释放结果集的空间 mysql_free_result</span></h4> 
<p><img alt="" height="309" src="https://images2.imgbox.com/79/a0/LlMyHEZg_o.png" width="700"></p> 
<p><img alt="" height="40" src="https://images2.imgbox.com/fe/13/4JuOIS5j_o.png" width="300"></p> 
<hr> 
<h4 style="background-color:transparent;"><span style="color:#0d0016;">6、关闭 </span><span style="color:#333333;">MySQL </span><span style="color:#0d0016;">链接 mysql_close</span><span style="color:#777777;"> </span></h4> 
<p><img alt="" height="284" src="https://images2.imgbox.com/8b/b6/E09MYbau_o.png" width="700"></p> 
<p><img alt="" height="86" src="https://images2.imgbox.com/7c/55/slw1TpFk_o.png" width="260"></p> 
<hr> 
<p><span style="color:#333333;">MySQL C api </span><span style="color:#333333;">还支持事务等常用操作，可以自行了解：</span></p> 
<pre><code class="language-cpp">my_bool STDCALL mysql_autocommit(MYSQL * mysql, my_bool auto_mode);
my_bool STDCALL mysql_commit(MYSQL * mysql);
my_bool STDCALL mysql_rollback(MYSQL * mysql);</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/66b9cfb919648668832219930b93525c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI大模型在穿戴设备健康中的心率深度融合与案例分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/59983497de7c128466b6850f10e625c9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【CDN】快速上手QiuDN，加速你的网站（附完整配置）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>