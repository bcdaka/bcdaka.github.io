<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>USB2.0学习3--USB传输和事务 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/59702ce41ae386f480ab41620d917c39/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="USB2.0学习3--USB传输和事务">
  <meta property="og:description" content="目录
1. USB帧和微帧
2. USB传输类型（Transfer）
2.1 控制传输（Control Transfer）
2.2 中断传输（Interrupt Transfer）
2.3 批量传输（Bulk Transfer）
2.4 同步传输（Isochronous Transfer）
3. USB事务(Transaction)
4. USB传输及事务组成
4.1 控制传输及事务组成
4.2 中断传输及事务组成
4.3 批量传输及事务组成
4.4 同步传输及事务组成
5. USB帧、微帧、传输、事务、包的关系
USB 通信由一系列帧构成（从时间角度来看）；在一帧数据内，可以划分为4种传输方式（从功能场景角度来看），每种传输方式都有各自的特点。再往下细分，每种传输又由3种基本的事务组成，一个事务由若干个数据包组成，包则是USB总线上数据传输的最小单位，所有的数据都是打包后再发送出去的。
1. USB帧和微帧 USB2.0协议中，帧和微帧属于时间上的概念。
由于USB总线上可能会存在多个从机，如果同一时间内，有多个从机同时要使用总线的话，会产生冲突，所以USB协议规定了帧/微帧的时间概念，USB主机每隔1帧/1微帧（即每1ms/125us），会将总线的使用权指定给某个USB从机，USB从机在这帧/微帧的时间内，可以通过总线进行数据传输的操作，如果没有数据传输操作需要执行，USB总线就会进入空闲状态，等这帧/微帧过后，USB总线的使用权会交给其他USB从机，周而复始。帧/微帧的间隔足够小，数据传输的操作就会频繁的在多个USB从机之间切换，看起来就好像是同时在进行数据传输一样。
USB低速模式，全速模式下，每个帧的长度为1ms；而高速模式下，每个微帧的长度为125us，即1帧=8微帧，帧的时间长度是固定的，如下图所示。
每一帧都有一个帧开始（SOF），随后才是数据传输，如下图所示。
2. USB传输类型（Transfer） 为了满足不同的应用场景需求，USB协议定义了4种数据传输方式，它们在数据格式、传输方向、数据包容量限制、总线访问限制等方面有着各自不同的特征。这4种传输分别是：
控制传输（Control Transfer）、中断传输（Interrupt Transfer）、批量传输（Bulk Transfer）、同步传输（Isochronous Transfer）。 2.1 控制传输（Control Transfer） 控制传输是 USB 最基本也是最重要的传输，所有的设备都会支持这种传输模式。 设备的配置，命令，状态都通过控制传输传递。控制传输主要有2个作用，一是USB主机对设备进行初始化，设备在正常工作之前必须先进行配置，比如分配设备地址，读取设备的各种描述符，配置管道、带宽等；另一个是在设备的工作过程中，主机希望能及时地获取设备的当前状态，或者设备出现问题时希望主机能及时做出补救措施，或者主机根据某些需求改变设备的当前配置等工作。
控制传输有如下特点：
控制传输是一种可靠的双向传输，即可以接收数据包又可以发送数据包，相应的控制传输的管道也是双向的；控制传输对于最大包长度有固定的要求，对于高速设备该值为64Byte；对于低速设备该值为8 Byte；全速设备可以是8或16或32或64 Byte；所有的设备必须有至少一个控制端点，且端点号为0；支持错误检测和数据重传。 2.2 中断传输（Interrupt Transfer） 这里的中断传输不是传统意义上的中断传输，而是指一种轮询的传输方式，HOST通过固定的间隔对中断端点进行查询，若有数据传输或可以接收数据则返回数据或发送数据，否则返回NAK，表示尚未准备好。中断传输对延迟要求严格，只发送或接收少量的数据。
中断传输有一个确定的传输周期，每隔一定的周期要求传输一次（但是并不是要求必须按固定周期发送一次数据，它的只会保证轮询的间隔小于我们设置的间隔）。系统在对进行中断传输的设备进行配置时，只要当前总线上用于周期性传输的空闲带宽能够容纳此设备，设备就可以工作。使用这种传输方式的设备有键盘、鼠标、游戏杆等。
中断传输有如下特点：
中断传输的最大服务周期（单位：毫秒）必须得到保证；是一种可靠的数据传输方式；由于错误而引起的数据重传将在下一服务周期进行；数据的结尾也是通过与包的最大传输字节数比较来确定；对于高速/全速/低速端点，最大包长度分别可以达到 1024/64/8 Bytes； 2.3 批量传输（Bulk Transfer） 批量传输是一种传输大量数据的可靠传输，对延迟要求宽松，常见的如打印机、扫描仪、硬盘、U盘等设备的数据传输都有这种特点。当一帧内的总线时间（带宽）有空余时，USB主机就会将剩余的时间（带宽）分配给等待使用总线的批量传输的USB设备，也就是说，批量传输可以利用任何可获得的总线带宽来进行数据传输。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-24T11:41:10+08:00">
    <meta property="article:modified_time" content="2024-06-24T11:41:10+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">USB2.0学习3--USB传输和事务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.%20USB%E5%B8%A7%E5%92%8C%E5%BE%AE%E5%B8%A7-toc" style="margin-left:0px;"><a href="#1.%20USB%E5%B8%A7%E5%92%8C%E5%BE%AE%E5%B8%A7" rel="nofollow">1. USB帧和微帧</a></p> 
<p id="2.%C2%A0USB%E4%BC%A0%E8%BE%93%E7%B1%BB%E5%9E%8B%EF%BC%88Transfer%EF%BC%89-toc" style="margin-left:0px;"><a href="#2.%C2%A0USB%E4%BC%A0%E8%BE%93%E7%B1%BB%E5%9E%8B%EF%BC%88Transfer%EF%BC%89" rel="nofollow">2. USB传输类型（Transfer）</a></p> 
<p id="2.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%EF%BC%88Control%20Transfer%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%EF%BC%88Control%20Transfer%EF%BC%89" rel="nofollow">2.1 控制传输（Control Transfer）</a></p> 
<p id="2.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%EF%BC%88Interrupt%20Transfer%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%EF%BC%88Interrupt%20Transfer%EF%BC%89" rel="nofollow">2.2 中断传输（Interrupt Transfer）</a></p> 
<p id="2.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%EF%BC%88Bulk%20Transfer%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%EF%BC%88Bulk%20Transfer%EF%BC%89" rel="nofollow">2.3 批量传输（Bulk Transfer）</a></p> 
<p id="2.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%EF%BC%88Isochronous%20Transfer%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%EF%BC%88Isochronous%20Transfer%EF%BC%89" rel="nofollow">2.4 同步传输（Isochronous Transfer）</a></p> 
<p id="3.%20USB%E4%BA%8B%E5%8A%A1(Transaction)-toc" style="margin-left:0px;"><a href="#3.%20USB%E4%BA%8B%E5%8A%A1%28Transaction%29" rel="nofollow">3. USB事务(Transaction)</a></p> 
<p id="4.%20USB%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90-toc" style="margin-left:0px;"><a href="#4.%20USB%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" rel="nofollow">4. USB传输及事务组成</a></p> 
<p id="4.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90-toc" style="margin-left:40px;"><a href="#4.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" rel="nofollow">4.1 控制传输及事务组成</a></p> 
<p id="4.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90-toc" style="margin-left:40px;"><a href="#4.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" rel="nofollow">4.2 中断传输及事务组成</a></p> 
<p id="4.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90-toc" style="margin-left:40px;"><a href="#4.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" rel="nofollow">4.3 批量传输及事务组成</a></p> 
<p id="4.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90-toc" style="margin-left:40px;"><a href="#4.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" rel="nofollow">4.4 同步传输及事务组成</a></p> 
<p id="5.%20USB%E5%B8%A7%E3%80%81%E5%BE%AE%E5%B8%A7%E3%80%81%E4%BC%A0%E8%BE%93%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E5%8C%85%E7%9A%84%E5%85%B3%E7%B3%BB-toc" style="margin-left:0px;"><a href="#5.%20USB%E5%B8%A7%E3%80%81%E5%BE%AE%E5%B8%A7%E3%80%81%E4%BC%A0%E8%BE%93%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E5%8C%85%E7%9A%84%E5%85%B3%E7%B3%BB" rel="nofollow">5. USB帧、微帧、传输、事务、包的关系</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p style="margin-left:0px;text-align:justify;"><span style="color:#0d0016;">USB 通信由一系列帧构成（从时间角度来看）；在一帧数据内，可以划分为4种传输方式（从功能场景角度来看），每种传输方式都有各自的特点。再往下细分，每种传输又由3种基本的事务组成，一个事务由若干个数据包组成，包则是USB总线上数据传输的最小单位，所有的数据都是打包后再发送出去的。</span></p> 
<h2 id="1.%20USB%E5%B8%A7%E5%92%8C%E5%BE%AE%E5%B8%A7" style="background-color:transparent;margin-left:0px;text-align:justify;">1. USB帧和微帧</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">USB2.0协议中，帧和微帧属于时间上的概念。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">由于USB总线上可能会存在多个从机，如果同一时间内，有多个从机同时要使用总线的话，会产生冲突，所以USB协议规定了帧/微帧的时间概念，USB主机每隔1帧/1微帧（即每1ms/125us），会将总线的使用权指定给某个USB从机，USB从机在这帧/微帧的时间内，可以通过总线进行数据传输的操作，如果没有数据传输操作需要执行，USB总线就会进入空闲状态，等这帧/微帧过后，USB总线的使用权会交给其他USB从机，周而复始。帧/微帧的间隔足够小，数据传输的操作就会频繁的在多个USB从机之间切换，看起来就好像是同时在进行数据传输一样。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">USB低速模式，全速模式下，每个帧的长度为1ms；而高速模式下，每个微帧的长度为125us，即1帧=8微帧，帧的时间长度是固定的，如下图所示。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="297" src="https://images2.imgbox.com/80/d6/cBqMenzb_o.png" width="526"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">每一帧都有一个帧开始（SOF），随后才是数据传输，如下图所示。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="273" src="https://images2.imgbox.com/3d/b5/ih91BRUh_o.png" width="865"></p> 
<h2 id="2.%C2%A0USB%E4%BC%A0%E8%BE%93%E7%B1%BB%E5%9E%8B%EF%BC%88Transfer%EF%BC%89" style="background-color:transparent;margin-left:0px;text-align:justify;">2. USB传输类型（Transfer）</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">为了满足不同的应用场景需求，USB协议定义了4种数据传输方式，它们在数据格式、传输方向、数据包容量限制、总线访问限制等方面有着各自不同的特征。这4种传输分别是：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#FF0000;">控制传输（</span><span style="color:#FF0000;">Control Transfer</span><span style="color:#FF0000;">）、</span></li><li style="text-align:justify;"><span style="color:#FF0000;">中断传输（</span><span style="color:#FF0000;">Interrupt Transfer</span><span style="color:#FF0000;">）、</span></li><li style="text-align:justify;"><span style="color:#FF0000;">批量传输（</span><span style="color:#FF0000;">Bulk Transfer</span><span style="color:#FF0000;">）、</span></li><li style="text-align:justify;"><span style="color:#FF0000;">同步传输（</span><span style="color:#FF0000;">Isochronous Transfer</span><span style="color:#FF0000;">）。</span></li></ol> 
<p> </p> 
<h3 id="2.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%EF%BC%88Control%20Transfer%EF%BC%89" style="margin-left:0px;text-align:justify;">2.1 控制传输（Control Transfer）</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">控制传输是 USB 最基本也是最重要的传输，所有的设备都会支持这种传输模式。 设备的配置，命令，状态都通过控制传输传递。控制传输主要有2个作用，</span><span style="color:#fe2c24;">一是USB主机对设备进行初始化</span><span style="color:#0d0016;">，设备在正常工作之前必须先进行配置，比如分配设备地址，读取设备的各种描述符，配置管道、带宽等；另一个是在设备的工作过程中，主机希望能及时地</span><span style="color:#FF0000;">获取设备的当前状态，或者设备出现问题时希望主机能及时做出补救措施，或者主机根据某些需求改变设备的当前配置等工作</span>。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">控制传输有如下特点：</span></p> 
<ol><li style="text-align:justify;">控制传输是一种可靠的双向传输，即可以接收数据包又可以发送数据包，相应的控制传输的管道也是双向的；</li><li style="text-align:justify;">控制传输对于最大包长度有固定的要求，对于高速设备该值为64Byte；对于低速设备该值为8 Byte；全速设备可以是8或16或32或64 Byte；</li><li style="text-align:justify;">所有的设备必须有至少一个控制端点，且端点号为0；</li><li style="text-align:justify;">支持错误检测和数据重传。</li></ol> 
<h3 id="2.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%EF%BC%88Interrupt%20Transfer%EF%BC%89" style="margin-left:0px;text-align:justify;">2.2 中断传输（Interrupt Transfer）</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">这里的中断传输</span><span style="color:#FF0000;">不是传统意义上的中断传输，而是指一种轮询的传输方式，</span><span style="color:#FF0000;">HOST</span><span style="color:#FF0000;">通过固定的间隔对中断端点进行查询，若有数据传输或可以接收数据则返回数据或发送数据，否则返回</span><span style="color:#FF0000;">NAK</span><span style="color:#FF0000;">，表示尚未准备好。中断传输对延迟要求严格，只发送或接收少量的数据</span>。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">中断传输有一个确定的传输周期，每隔一定的周期要求传输一次（但是并不是要求必须按固定周期发送一次数据，它的只会保证轮询的间隔小于我们设置的间隔）。系统在对进行中断传输的设备进行配置时，只要当前总线上用于周期性传输的空闲带宽能够容纳此设备，设备就可以工作。使用这种传输方式的设备有键盘、鼠标、游戏杆等。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">中断传输有如下特点：</span></p> 
<ol><li style="text-align:justify;">中断传输的最大服务周期（单位：毫秒）必须得到保证；</li><li style="text-align:justify;">是一种可靠的数据传输方式；</li><li style="text-align:justify;">由于错误而引起的数据重传将在下一服务周期进行；</li><li style="text-align:justify;">数据的结尾也是通过与包的最大传输字节数比较来确定；</li><li style="text-align:justify;">对于高速/全速/低速端点，最大包长度分别可以达到 1024/64/8 Bytes；</li></ol> 
<h3 id="2.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%EF%BC%88Bulk%20Transfer%EF%BC%89" style="margin-left:0px;text-align:justify;">2.3 批量传输（Bulk Transfer）</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">批量传输是一种</span><span style="color:#FF0000;">传输大量数据的可靠传输</span>，<span style="color:#FF0000;">对延迟要求宽松，</span><span style="color:#0d0016;">常见的如打印机、扫描仪、硬盘、U盘等设备的数据传输都有这种特点。当一帧内的总线时间（带宽）有空余时，USB主机就会将剩余的时间（带宽）分配给等待使用总线的批量传输的USB设备，也就是说，批量传输可以利用任何可获得的总线带宽来进行数据传输。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">批量传输有以下特点：</span></p> 
<ol><li style="text-align:justify;">可以动态地获得总线带宽；</li><li style="text-align:justify;">是一种可靠的数据传输方式，如果传送失败，可进行重发；</li><li style="text-align:justify;">有确认的数据传输，但不保证传输的带宽和延迟；</li><li style="text-align:justify;">只有当获得空闲的带宽时，批量传输才会发生。如果USB总线有较多的空闲带宽，则批量传输会较频繁地进行，如果空闲带宽较少，可能有很长时间没有批量传输发生；</li><li style="text-align:justify;">低速 USB 设备不支持批量传输，高速批量端点的最大包长度为 512byte，全速批量端点的最大包长度可以为 8、16、32、64 byte；</li><li style="text-align:justify;">批量传输在访问 USB 总线时，相对其他传输类型具有最低的优先级，USB HOST总是优先安排其他类型的传输，当总线带宽有富余时才安排批量传输。</li></ol> 
<h3 id="2.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%EF%BC%88Isochronous%20Transfer%EF%BC%89" style="margin-left:0px;text-align:justify;">2.4 同步传输（Isochronous Transfer）</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">同步传输是</span><span style="color:#FF0000;">一种实时的、不可靠的传输，不支持错误重发机制。同步传输是为支持某些对可靠性要求不高，对实时性要求很高、数据量很大应用场景而提出的</span><span style="color:#0d0016;">，使用这种传输类型的设备有麦克风、调制解调器、音频设备、摄像头等。为了完成实时传输，总线必须事先提供足够的带宽。对于同步传输来说，</span><span style="color:#FF0000;">实时性比正确性和数据重传更重要</span><span style="color:#0d0016;">，即使有少量的数据出错，也不会对应用软件产生太大的影响。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">实进传输有如下特点：</span></p> 
<ol><li style="text-align:justify;">实时传输有数据有固定的时间延迟，但有固定的带宽保证；</li><li style="text-align:justify;">是一种不可靠的数据传输，充许有一定的误码率；</li><li style="text-align:justify;">只要数据供得上，就能保证管道上的恒定数据传送速率；</li><li style="text-align:justify;">只有全速/高速设备可以使用实时传输。</li></ol> 
<h2 id="3.%20USB%E4%BA%8B%E5%8A%A1(Transaction)" style="background-color:transparent;margin-left:0px;text-align:justify;">3. USB事务(Transaction)</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">上一章节讲了USB有4种数据传输类型，分别是控制传输、中断传输、批量传输和同步传输，其中每种传输都是由基本的USB事务(transaction</span><span style="color:#0d0016;">)构成，USB事务根据功能可以分为3种：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#FF0000;">Setup</span><span style="color:#FF0000;">事务：</span>表示USB主机向设备发送控制命令。</li><li style="text-align:justify;"><span style="color:#FF0000;">IN</span><span style="color:#FF0000;">事务：</span>表示USB主机从设备读取数据的过程。</li><li style="text-align:justify;"><span style="color:#FF0000;">OUT</span><span style="color:#FF0000;">事务：</span>表示USB主机向设备发送数据的过程。</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">USB的事务都是由主机发起的，一个完整的事务可以分为3个阶段：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#FF0000;">令牌阶段（</span><span style="color:#FF0000;">Token Stage</span><span style="color:#FF0000;">）</span><span style="color:#FF0000;">:</span> <span style="color:#000000;">由主机指明传输数据的类型。</span></li><li style="text-align:justify;"><span style="color:#FF0000;">数据阶段（</span><span style="color:#FF0000;">Data Stage</span><span style="color:#FF0000;">）</span><span style="color:#FF0000;">:</span> <span style="color:#000000;">用于传输数据。</span></li><li style="text-align:justify;"><span style="color:#FF0000;">响应阶段（</span><span style="color:#FF0000;">Acknowledge Stage</span><span style="color:#FF0000;">）</span><span style="color:#FF0000;">:</span> <span style="color:#000000;">用来判断数据是否发送成功。</span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">事务类型和各个阶段的关系如下图所示。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="198" src="https://images2.imgbox.com/06/58/5huio3dk_o.png" width="727"></p> 
<h2 id="4.%20USB%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" style="background-color:transparent;margin-left:0px;text-align:justify;">4. USB传输及事务组成</h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">前面讲过USB一个传输由一个或多个事务(transaction)构成，下面细讲每种传输及事务组成。</span></p> 
<h3 id="4.1%20%E6%8E%A7%E5%88%B6%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" style="margin-left:0px;text-align:justify;">4.1 控制传输及事务组成</h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0d0016;">控制传输根据功能可以分为</span><span style="color:#FF0000;">控制读传输、控制写传输、无数据控制传输</span><span style="color:#0d0016;">三种。基本的控制传输包括三个阶段，分别是：</span><span style="color:#FF0000;">建立阶段、数据阶段、状态阶段</span>。</p> 
<ul><li style="text-align:justify;"><span style="color:#fe2c24;">建立阶段</span><span style="color:#000000;">：</span>固定使用1个SETUP事务，标志一次控制传输的开始。</li><li style="text-align:justify;"><span style="color:#fe2c24;">数据阶段</span>：根据需求，如果要求读/写数据，数据阶段就会传输具体数据，如果没有读写需求，则没有数据阶段。数据阶段是由0个或多个IN/OUT事务组成。</li><li style="text-align:justify;"><span style="color:#fe2c24;">状态阶段</span>：固定使用1个IN/OUT事务，表示传输成功与否。</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">时序图如下图所示。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="263" src="https://images2.imgbox.com/3c/f4/JI0nwsFM_o.png" width="580"></p> 
<p style="margin-left:.0001pt;text-align:justify;">控制传输类型和事务的关系总结如下：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong>控制传输类型</strong></p> </td><td style="vertical-align:top;width:92.15pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">建立阶段</span></strong></p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">数据阶段</span></strong></p> </td><td style="vertical-align:top;width:3cm;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">状态阶段</span></strong></p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">控制读传输</p> </td><td style="vertical-align:top;width:92.15pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个setup事务</p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或多个in事务</p> </td><td style="vertical-align:top;width:3cm;"> <p style="margin-left:.0001pt;text-align:justify;">1个out事务</p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">控制写传输</p> </td><td style="vertical-align:top;width:92.15pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个setup事务</p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或多个out事务</p> </td><td style="vertical-align:top;width:3cm;"> <p style="margin-left:.0001pt;text-align:justify;">1个in事务</p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">无数据控制传输</p> </td><td style="vertical-align:top;width:92.15pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个setup事务</p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;">无</p> </td><td style="vertical-align:top;width:3cm;"> <p style="margin-left:.0001pt;text-align:justify;">1个in事务</p> </td></tr></tbody></table> 
<h3 id="4.2%20%E4%B8%AD%E6%96%AD%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" style="background-color:transparent;margin-left:0px;text-align:justify;">4.2 中断传输及事务组成</h3> 
<p style="margin-left:.0001pt;text-align:justify;">中断传输主要包括<span style="color:#fe2c24;">中断读传输、中断写传输</span>两种，<span style="color:#fe2c24;">中断传输的事务只有1个阶段：数据阶段</span>。主机如果是中断读数据请求，则数据阶段为一个IN事务；主机如果是中断写数据请求，则数据阶段为一个OUT事务。</p> 
<p style="margin-left:.0001pt;text-align:justify;">时序图如下图所示。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="163" src="https://images2.imgbox.com/7d/54/wc52cLEl_o.png" width="342"></p> 
<p style="margin-left:.0001pt;text-align:justify;">中断传输类型和事务的关系总结如下：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong>控制传输类型</strong></p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">数据阶段</span></strong></p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">中断读传输</p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个in事务</p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">中断写传输</p> </td><td style="vertical-align:top;width:106.3pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个out事务</p> </td></tr></tbody></table> 
<h3 id="4.3%20%E6%89%B9%E9%87%8F%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" style="background-color:transparent;margin-left:0px;text-align:justify;">4.3 批量传输及事务组成</h3> 
<p style="margin-left:.0001pt;text-align:justify;">批量传输主要包括<span style="color:#fe2c24;">批量读传输、批量写传输</span>两种，<span style="color:#fe2c24;">批量传输的事务只有1个阶段：数据阶段</span>。主机如果是批量读数据请求，则数据阶段为一个或者多个IN事务；主机如果是批量写数据请求，则数据阶段为一个或者多个OUT事务。</p> 
<p style="margin-left:.0001pt;text-align:justify;">时序图如下图所示。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="125" src="https://images2.imgbox.com/51/21/Kan0BZBY_o.png" width="387"></p> 
<p style="margin-left:.0001pt;text-align:justify;">批量传输类型和事务的关系总结如下：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong>控制传输类型</strong></p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">数据</span></strong><strong><span style="color:#000000;">阶段</span></strong></p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">批量读传输</p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或者多个in事务</p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">批量写传输</p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或者多个out事务</p> </td></tr></tbody></table> 
<h3 id="4.4%20%E5%90%8C%E6%AD%A5%E4%BC%A0%E8%BE%93%E5%8F%8A%E4%BA%8B%E5%8A%A1%E7%BB%84%E6%88%90" style="margin-left:0px;text-align:justify;">4.4 同步传输及事务组成</h3> 
<p style="margin-left:.0001pt;text-align:justify;">同步传输主要包括<span style="color:#fe2c24;">同步读传输、同步写传输</span>两种，<span style="color:#fe2c24;">同步传输的事务只有1个阶段：数据阶段</span>。主机如果是同步读数据请求，则数据阶段为一个或者多个IN事务；主机如果是同步写数据请求，则数据阶段为一个或者多个OUT事务。</p> 
<p style="margin-left:.0001pt;text-align:justify;">时序图如下图所示。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="143" src="https://images2.imgbox.com/32/1e/LrgffEYO_o.png" width="457"></p> 
<p style="margin-left:.0001pt;text-align:justify;">同步传输类型和事务的关系总结如下：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong>控制传输类型</strong></p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#000000;">数据</span></strong><strong><span style="color:#000000;">阶段</span></strong></p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">同步读传输</p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或者多个in事务</p> </td></tr><tr><td style="vertical-align:top;width:91.9pt;"> <p style="margin-left:.0001pt;text-align:justify;">同步写传输</p> </td><td style="vertical-align:top;width:127.6pt;"> <p style="margin-left:.0001pt;text-align:justify;">1个或者多个out事务</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="5.%20USB%E5%B8%A7%E3%80%81%E5%BE%AE%E5%B8%A7%E3%80%81%E4%BC%A0%E8%BE%93%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E5%8C%85%E7%9A%84%E5%85%B3%E7%B3%BB" style="margin-left:0px;text-align:justify;">5. USB帧、微帧、传输、事务、包的关系</h2> 
<p style="margin-left:.0001pt;text-align:justify;">USB 通信由一系列帧构成。每一帧都有一个帧开始（SOF），随后是一个或多个传输。一个传输由一次到多次事务构成，可以跨帧完成。一个事务不能打断，不能跨帧完成。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p class="img-center"><img alt="https://pic3.zhimg.com/v2-7ff7dd9aec18efbc72020f6def60116e_r.jpg" height="295" src="https://images2.imgbox.com/4f/64/sXrhCUJo_o.jpg" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;">一个事务由若干个数据包组成，包是USB总线上数据传输的最小单位，包不能被打断或干扰，否则会引发错误。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="336" src="https://images2.imgbox.com/29/09/jWGukYnD_o.png" width="651"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/088447ab120298006e29022026812493/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vmware16 pro - ubuntu22.04，各种烂问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3018082505b31bb4c81225244f60a6c6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">毕设成品 基于大数据人才岗位数据分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>