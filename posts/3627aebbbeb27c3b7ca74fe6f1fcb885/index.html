<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Spring] Spring AOP - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3627aebbbeb27c3b7ca74fe6f1fcb885/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="[Spring] Spring AOP">
  <meta property="og:description" content="ğŸŒ¸ä¸ªäººä¸»é¡µ:https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343
ğŸµï¸çƒ­é—¨ä¸“æ :
ğŸ§Š JavaåŸºæœ¬è¯­æ³•(97å¹³å‡è´¨é‡åˆ†)https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482
ğŸ• Collectionä¸æ•°æ®ç»“æ„ (92å¹³å‡è´¨é‡åˆ†)https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482
ğŸ§€çº¿ç¨‹ä¸ç½‘ç»œ(96å¹³å‡è´¨é‡åˆ†) https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482
ğŸ­MySqlæ•°æ®åº“(93å¹³å‡è´¨é‡åˆ†)https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482
ğŸ¬ç®—æ³•(97å¹³å‡è´¨é‡åˆ†)https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482
ğŸƒ Spring(97å¹³å‡è´¨é‡åˆ†)https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482
æ„Ÿè°¢ç‚¹èµä¸å…³æ³¨~~~
ç›®å½• 1. AOPæ¦‚è¿°2. Spring AOPå¿«é€Ÿå…¥é—¨2.1 å¼•å…¥AOPä¾èµ–2.2 ç¼–å†™AOPç¨‹åº 3. Spring AOPè¯¦è§£3.1 æ ¸å¿ƒæ¦‚å¿µ3.1.1 åˆ‡ç‚¹(PointCut)3.1.2 è¿æ¥ç‚¹(Join Point)3.1.3 é€šçŸ¥(Advice)3.1.4 åˆ‡é¢(Aspect) 3.2 é€šçŸ¥ç±»å‹3.3 @Pointcut3.4 åˆ‡é¢ä¼˜å…ˆçº§@Order3.5 åˆ‡ç‚¹è¡¨è¾¾å¼3.5.1 executionè¡¨è¾¾å¼3.5.2 @annotation(ç¿»è¯‘:æ³¨è§£) 4. Spring AOPåŸç†4.1 ä»£ç†æ¨¡å¼4.1.1 é™æ€ä»£ç†4.1.2 åŠ¨æ€ä»£ç† 1. AOPæ¦‚è¿° ä»€ä¹ˆæ˜¯AOP?
æ‰€è°“AOP,å°±æ˜¯é¢ç›¸åˆ‡é¢çš„ç¼–ç¨‹.ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å‘¢,åˆ‡é¢å°±æ˜¯æŒ‡å®šæŸä¸€ç±»ç‰¹å®šçš„é—®é¢˜,æ‰€ä»¥,é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å°±æ˜¯æ­£å¯¹äºåŒä¸€ç±»é—®é¢˜è¿›è¡Œç¼–ç¨‹.
ç®€å•æ¥è¯´,å°±æ˜¯é’ˆå¯¹æŸä¸€ç±»äº‹æƒ…çš„é›†ä¸­å¤„ç†.ä»€ä¹ˆæ˜¯Spring AOP?
AOPæ˜¯ä¸€ç§æ€æƒ³,å®ç°AOPçš„æ–¹æ³•æœ‰å¾ˆå¤š,æœ‰Spring AOP,æœ‰AspectJ,æœ‰CGLIBç­‰.Spring AOPæ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°æ–¹å¼. æŸç§ç¨‹åº¦ä¸Š,ä»–å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„ç»Ÿä¸€åŠŸèƒ½å¤„ç†çš„æ•ˆæœå·®ä¸å¤š,ä½†æ˜¯,ç»Ÿä¸€åŠŸèƒ½å¤„ç†å¹¶ä¸ç­‰åŒäºSpringAOP,æ‹¦æˆªå™¨çš„ä½œç”¨ç»´åº¦æ˜¯URL,å³ä¸€æ¬¡è¯·æ±‚å“åº”,ä½†æ˜¯AOPçš„ä½œç”¨ç»´åº¦æ›´åŠ ç»†è‡´,å¯ä»¥å¯¹åŒ…æ‹¬åŒ…,ç±»,æ–¹æ³•,å‚æ•°ç­‰è¿›è¡Œç»Ÿä¸€åŠŸèƒ½çš„å¤„ç†,å¯ä»¥å®ç°æ›´åŠ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘.
ä¸¾ä¾‹:
ç°åœ¨æœ‰ä¸€äº›ä¸šåŠ¡æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½,æˆ‘ä»¬éœ€è¦å¯¹æ¥å£è¿›è¡Œä¼˜åŒ–,ç¬¬ä¸€æ­¥éœ€è¦å®šä½å‡ºè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡æ–¹æ³•,åœ¨é’ˆå¯¹ä¸šåŠ¡é¢æ¥è¿›è¡Œä¼˜åŒ–.æˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸå’Œå¼€å§‹çš„åœ°æ–¹åŠ ä¸Šæ—¶é—´æˆ³,ä¹‹åä½œå·®å±•ç¤ºå‡ºæ¥.ä½†æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­,æˆ‘ä»¬æœ‰å¥½å¤šæ¥å£,æ­¤æ—¶åœ¨æ¥å£ä¸­ä¸€ä¸ªä¸ªä½æ·»åŠ æ—¶é—´æˆ³åˆä¸æ˜¯å¾ˆç°å®,æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°AOP.
æ¥ä¸‹æ¥,æˆ‘ä»¬å°±æ¥çœ‹çœ‹AOPå¦‚ä½•ä½¿ç”¨.
2. Spring AOPå¿«é€Ÿå…¥é—¨ éœ€æ±‚: ç»Ÿè®¡å›¾ä¹¦ç®¡ç†ç³»ç»Ÿå„ä¸ªæ¥å£å’Œæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´.
2.1 å¼•å…¥AOPä¾èµ– åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–:
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; 2.2 ç¼–å†™AOPç¨‹åº è®°å½•Controllerä¸­æ¯ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-08T20:33:40+08:00">
    <meta property="article:modified_time" content="2024-08-08T20:33:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Spring] Spring AOP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>ğŸŒ¸ä¸ªäººä¸»é¡µ:<a href="https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343">https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343</a><br> ğŸµï¸çƒ­é—¨ä¸“æ :<br> ğŸ§Š JavaåŸºæœ¬è¯­æ³•(97å¹³å‡è´¨é‡åˆ†)<a href="https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482</a><br> ğŸ• Collectionä¸æ•°æ®ç»“æ„ (92å¹³å‡è´¨é‡åˆ†)<a href="https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482</a><br> ğŸ§€çº¿ç¨‹ä¸ç½‘ç»œ(96å¹³å‡è´¨é‡åˆ†) <a href="https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482</a><br> ğŸ­MySqlæ•°æ®åº“(93å¹³å‡è´¨é‡åˆ†)<a href="https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482</a><br> ğŸ¬ç®—æ³•(97å¹³å‡è´¨é‡åˆ†)<a href="https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482</a><br> ğŸƒ Spring(97å¹³å‡è´¨é‡åˆ†)<a href="https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482</a><br> æ„Ÿè°¢ç‚¹èµä¸å…³æ³¨~~~<br> <img src="https://images2.imgbox.com/ca/b0/JLu0IQn3_o.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#1_AOP_13" rel="nofollow">1. AOPæ¦‚è¿°</a></li><li><a href="#2_Spring_AOP_25" rel="nofollow">2. Spring AOPå¿«é€Ÿå…¥é—¨</a></li><li><ul><li><a href="#21_AOP_27" rel="nofollow">2.1 å¼•å…¥AOPä¾èµ–</a></li><li><a href="#22_AOP_35" rel="nofollow">2.2 ç¼–å†™AOPç¨‹åº</a></li></ul> 
  </li><li><a href="#3_Spring_AOP_73" rel="nofollow">3. Spring AOPè¯¦è§£</a></li><li><ul><li><a href="#31__74" rel="nofollow">3.1 æ ¸å¿ƒæ¦‚å¿µ</a></li><li><ul><li><a href="#311_PointCut_75" rel="nofollow">3.1.1 åˆ‡ç‚¹(PointCut)</a></li><li><a href="#312_Join_Point_78" rel="nofollow">3.1.2 è¿æ¥ç‚¹(Join Point)</a></li><li><a href="#313_Advice_84" rel="nofollow">3.1.3 é€šçŸ¥(Advice)</a></li><li><a href="#314_Aspect_88" rel="nofollow">3.1.4 åˆ‡é¢(Aspect)</a></li></ul> 
   </li><li><a href="#32__93" rel="nofollow">3.2 é€šçŸ¥ç±»å‹</a></li><li><a href="#33_Pointcut_164" rel="nofollow">3.3 @Pointcut</a></li><li><a href="#34_Order_200" rel="nofollow">3.4 åˆ‡é¢ä¼˜å…ˆçº§@Order</a></li><li><a href="#35__294" rel="nofollow">3.5 åˆ‡ç‚¹è¡¨è¾¾å¼</a></li><li><ul><li><a href="#351_execution_299" rel="nofollow">3.5.1 executionè¡¨è¾¾å¼</a></li><li><a href="#352_annotation_331" rel="nofollow">3.5.2 @annotation(ç¿»è¯‘:æ³¨è§£)</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4_Spring_AOP_438" rel="nofollow">4. Spring AOPåŸç†</a></li><li><ul><li><a href="#41__440" rel="nofollow">4.1 ä»£ç†æ¨¡å¼</a></li><li><ul><li><a href="#411__452" rel="nofollow">4.1.1 é™æ€ä»£ç†</a></li><li><a href="#412__501" rel="nofollow">4.1.2 åŠ¨æ€ä»£ç†</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_AOP_13"></a>1. AOPæ¦‚è¿°</h2> 
<ul><li>ä»€ä¹ˆæ˜¯AOP?<br> æ‰€è°“AOP,å°±æ˜¯é¢ç›¸åˆ‡é¢çš„ç¼–ç¨‹.ä»€ä¹ˆæ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å‘¢,<mark>åˆ‡é¢å°±æ˜¯æŒ‡å®šæŸä¸€ç±»ç‰¹å®šçš„é—®é¢˜,æ‰€ä»¥,é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å°±æ˜¯æ­£å¯¹äºåŒä¸€ç±»é—®é¢˜è¿›è¡Œç¼–ç¨‹</mark>.<br> ç®€å•æ¥è¯´,å°±æ˜¯<strong>é’ˆå¯¹æŸä¸€ç±»äº‹æƒ…çš„é›†ä¸­å¤„ç†</strong>.</li><li>ä»€ä¹ˆæ˜¯Spring AOP?<br> AOPæ˜¯ä¸€ç§æ€æƒ³,å®ç°AOPçš„æ–¹æ³•æœ‰å¾ˆå¤š,æœ‰Spring AOP,æœ‰AspectJ,æœ‰CGLIBç­‰.Spring AOPæ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°æ–¹å¼.</li></ul> 
<p>æŸç§ç¨‹åº¦ä¸Š,ä»–å’Œæˆ‘ä»¬å‰é¢æåˆ°çš„ç»Ÿä¸€åŠŸèƒ½å¤„ç†çš„æ•ˆæœå·®ä¸å¤š,ä½†æ˜¯,ç»Ÿä¸€åŠŸèƒ½å¤„ç†å¹¶ä¸ç­‰åŒäºSpringAOP,æ‹¦æˆªå™¨çš„ä½œç”¨ç»´åº¦æ˜¯URL,å³ä¸€æ¬¡è¯·æ±‚å“åº”,ä½†æ˜¯AOPçš„ä½œç”¨ç»´åº¦æ›´åŠ ç»†è‡´,å¯ä»¥å¯¹åŒ…æ‹¬åŒ…,ç±»,æ–¹æ³•,å‚æ•°ç­‰è¿›è¡Œç»Ÿä¸€åŠŸèƒ½çš„å¤„ç†,å¯ä»¥å®ç°æ›´åŠ å¤æ‚çš„ä¸šåŠ¡é€»è¾‘.</p> 
<blockquote> 
 <p>ä¸¾ä¾‹:<br> ç°åœ¨æœ‰ä¸€äº›ä¸šåŠ¡æ‰§è¡Œæ•ˆç‡æ¯”è¾ƒä½,æˆ‘ä»¬éœ€è¦å¯¹æ¥å£è¿›è¡Œä¼˜åŒ–,ç¬¬ä¸€æ­¥éœ€è¦å®šä½å‡ºè€—æ—¶è¾ƒé•¿çš„ä¸šåŠ¡æ–¹æ³•,åœ¨é’ˆå¯¹ä¸šåŠ¡é¢æ¥è¿›è¡Œä¼˜åŒ–.æˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸå’Œå¼€å§‹çš„åœ°æ–¹åŠ ä¸Šæ—¶é—´æˆ³,ä¹‹åä½œå·®å±•ç¤ºå‡ºæ¥.ä½†æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­,æˆ‘ä»¬æœ‰å¥½å¤šæ¥å£,æ­¤æ—¶åœ¨æ¥å£ä¸­ä¸€ä¸ªä¸ªä½æ·»åŠ æ—¶é—´æˆ³åˆä¸æ˜¯å¾ˆç°å®,æ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°AOP.</p> 
</blockquote> 
<p>æ¥ä¸‹æ¥,æˆ‘ä»¬å°±æ¥çœ‹çœ‹AOPå¦‚ä½•ä½¿ç”¨.</p> 
<h2><a id="2_Spring_AOP_25"></a>2. Spring AOPå¿«é€Ÿå…¥é—¨</h2> 
<p>éœ€æ±‚: ç»Ÿè®¡å›¾ä¹¦ç®¡ç†ç³»ç»Ÿå„ä¸ªæ¥å£å’Œæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´.</p> 
<h3><a id="21_AOP_27"></a>2.1 å¼•å…¥AOPä¾èµ–</h3> 
<p>åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="22_AOP_35"></a>2.2 ç¼–å†™AOPç¨‹åº</h3> 
<p>è®°å½•Controllerä¸­æ¯ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´.</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>books<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span><span class="token comment">//è¡¨ç¤ºåˆ‡é¢</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeAspect</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.books.controller.*.*(..)))"</span><span class="token punctuation">)</span><span class="token comment">//åˆ‡ç‚¹è¡¨è¾¾å¼</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">recordTime</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//å‚æ•°æ˜¯è¿æ¥ç‚¹</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ‰§è¡Œè¿æ¥ç‚¹æ–¹æ³•</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œè€—æ—¶:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end<span class="token operator">-</span>begin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸Šè¿°ä»£ç çš„æµ‹è¯•ç»“æœå¦‚ä¸‹:<br> <img src="https://images2.imgbox.com/51/26/Tr5QffjL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æˆ‘ä»¬çœ‹åˆ°äº†æ¥å£è¿”å›äº†æ‰§è¡Œè€—æ—¶.<br> ä¸‹é¢æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œè¯¦ç»†çš„è§£é‡Š:</p> 
<ol><li> <p><code>@Aspect </code>: è¡¨ç¤ºçš„æ˜¯åˆ‡é¢.è¡¨ç¤º<strong>è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</strong>.</p> </li><li> <p><code>@Around</code>: ç¯ç»•é€šçŸ¥,åœ¨<strong>ç›®æ ‡æ–¹æ³•å‰åéƒ½ä¼šæœ‰ä»£ç æ‰§è¡Œ</strong>.<br> <img src="https://images2.imgbox.com/e1/42/bwCUxqS7_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> </li><li> <p><code>proceedingJoinPoint.proceed()</code>: <strong>æ‰§è¡Œ</strong>åŠ å…¥åˆ‡é¢çš„è¿æ¥ç‚¹.</p> </li><li> <p><code>execution(* com.jrj.books.controller.*.*(..)))</code>:åˆ‡ç‚¹è¡¨è¾¾å¼,<strong>è¡¨ç¤ºè¿™ä¸ªåˆ‡é¢å¯¹è¯¥é¡¹ç›®ä¸‹çš„é‚£ä¸ªæ–¹æ³•ç”Ÿæ•ˆ</strong>.</p> </li><li> <p><code>ProceedingJoinPoint proceedingJoinPoint</code>: åŠ å…¥åˆ‡é¢çš„<strong>è¿æ¥ç‚¹</strong>.</p> </li></ol> 
<h2><a id="3_Spring_AOP_73"></a>3. Spring AOPè¯¦è§£</h2> 
<h3><a id="31__74"></a>3.1 æ ¸å¿ƒæ¦‚å¿µ</h3> 
<h4><a id="311_PointCut_75"></a>3.1.1 åˆ‡ç‚¹(PointCut)</h4> 
<p>åˆ‡ç‚¹,ä¹Ÿå°±æ˜¯åˆ‡å…¥ç‚¹,æˆ‘ä»¬ä¸€èˆ¬åœ¨é€šçŸ¥ç±»å‹æ³¨è§£çš„åé¢ä½¿ç”¨<strong>executionåˆ‡ç‚¹è¡¨è¾¾å¼</strong>æ¥æè¿°åˆ‡ç‚¹.<mark>åˆ‡ç‚¹å°±æ˜¯å‘Šè¯‰ç¨‹åºå¯¹é‚£äº›æ–¹æ³•çš„åŠŸèƒ½è¿›è¡ŒåŠ å¼º</mark>.<br> <img src="https://images2.imgbox.com/e5/f7/s3qxStpi_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="312_Join_Point_78"></a>3.1.2 è¿æ¥ç‚¹(Join Point)</h4> 
<p><mark>æ»¡è¶³åˆ‡ç‚¹è¡¨è¾¾å¼è§„åˆ™çš„æ–¹æ³•,å°±æ˜¯è¿æ¥ç‚¹</mark>,ä¹Ÿå°±æ˜¯å¯ä»¥è¢«è¯¥åˆ‡é¢æ‰€ä½œç”¨çš„æ–¹æ³•.è¿æ¥ç‚¹çš„æ•°æ®ç±»å‹æ˜¯:<code>ProceedingJoinPoint</code>.ä¹Ÿå°±æ˜¯<code>com.jrj.books.controller.</code>åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯è¯¥åˆ‡é¢çš„è¿æ¥ç‚¹.<br> <img src="https://images2.imgbox.com/08/42/Vm5vWUPw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>åˆ‡ç‚¹ä¸è¿æ¥ç‚¹ä¹‹é—´çš„å…³ç³»<br> è¿æ¥ç‚¹äº‹æ»¡è¶³åˆ‡ç‚¹è¡¨è¾¾å¼çš„å…ƒç´ ,<strong>åˆ‡ç‚¹å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªä¿å­˜äº†ä¼—å¤šè¿æ¥ç‚¹çš„é›†åˆ</strong>.</p> 
</blockquote> 
<h4><a id="313_Advice_84"></a>3.1.3 é€šçŸ¥(Advice)</h4> 
<p>é€šçŸ¥å°±æ˜¯<strong>å…·ä½“è¦åšçš„å·¥ä½œ,æŒ‡åœ¨æŒ‡å®šçš„æ–¹æ³•ä¸­é‡å¤é‚£äº›é€»è¾‘</strong>,ä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½.<br> æ¯”å¦‚ä¸Šé¢å®ç°è®¡ç®—è¿è¡Œå‰åçš„æ—¶é—´å·®çš„ä¸šåŠ¡é€»è¾‘å°±å«åšé€šçŸ¥.<br> <img src="https://images2.imgbox.com/3d/b7/VCmRunn5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="314_Aspect_88"></a>3.1.4 åˆ‡é¢(Aspect)</h4> 
<p><strong>åˆ‡é¢=åˆ‡ç‚¹+é€šçŸ¥</strong><br> åˆ‡é¢æ—¢åŒ…å«äº†é€»è¾‘çš„å®šä¹‰,ä¹ŸåŒ…å«è¿æ¥ç‚¹çš„å®šä¹‰.<br> <img src="https://images2.imgbox.com/6c/bf/0jsI348A_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> åˆ‡é¢è¯´åœ¨çš„ç±»,æˆ‘ä»¬ä¸€èˆ¬ç§°ä¸º<strong>åˆ‡é¢ç±»</strong>.</p> 
<h3><a id="32__93"></a>3.2 é€šçŸ¥ç±»å‹</h3> 
<p>SpringAOPä¸­çš„é€šçŸ¥ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§:</p> 
<ul><li>@Around:ç¯ç»•é€šçŸ¥,<mark>è¡¨ç¤ºè¯¥æ–¹æ³•åœ¨ç›®æ ‡æ–¹æ³•å‰åéƒ½ä¼šè¢«æ‰§è¡Œ</mark>.</li><li>@Before:å‰ç½®é€šçŸ¥,<mark>è¡¨ç¤ºè¯¥æ–¹æ³•åªåœ¨ç›®æ ‡æ–¹æ³•ä¹‹å‰è¢«æ‰§è¡Œ</mark>.</li><li>@After:åç½®é€šçŸ¥,<mark>è¡¨ç¤ºè¯¥æ–¹æ³•åªåœ¨ç›®æ ‡æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œ</mark>,<strong>æ— è®ºæ˜¯å¦æœ‰å¼‚å¸¸å‘ç”Ÿ</strong>.</li><li>@AfterReturning:è¿”å›åé€šçŸ¥,<mark>è¡¨ç¤ºè¯¥æ–¹æ³•åªåœ¨ç›®æ ‡æ–¹æ³•ä¹‹åè¢«æ‰§è¡Œ</mark>,<strong>æ–¹æ³•è¿”å›äº†ä¹‹åæ‰ä¼šæ‰§è¡Œ,æœ‰å¼‚å¸¸å‘ç”Ÿä¸ä¼šæ‰§è¡Œ</strong>.</li><li>@AfterThrowing:<mark>å¼‚å¸¸åé€šçŸ¥</mark>.è¡¨ç¤ºæ–¹æ³•åœ¨å‘ç”Ÿå¼‚å¸¸ä¹‹åæ‰§è¡Œ.</li></ul> 
<p>ä»£ç æ¼”ç¤º:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterReturning method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterThrowing method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>[æ³¨æ„] è¢«<code>@Around</code>æ ‡å¿—çš„æ–¹æ³•å¿…é¡»æœ‰å½¢å¼å’Œè¿”å›å€¼.å…¶ä»–æ³¨è§£æ ‡å¿—çš„æ–¹æ³•å¯ä»¥åŠ ä¸Š<code>JoinPoint</code>ç±»å‹çš„å½¢å¼å‚æ•°,**ç”¨æ¥è·å–åŸå§‹æ–¹æ³•çš„æ•°æ®.<br> ä¸‹é¢æˆ‘ä»¬å‡†å¤‡æµ‹è¯•ä»£ç :å…¶ä¸­ä¸€ä¸ªæ­£å¸¸æ‰§è¡Œ,å¦å¤–ä¸€ä¸ªåˆ¶é€ ä¸€äº›å¼‚å¸¸å‡ºæ¥.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸‹é¢æˆ‘ä»¬æ¥æ‰§è¡Œä»£ç ,è§‚å¯Ÿåç«¯æ—¥å¿—:</p> 
<ol><li>æ­£å¸¸æ‰§è¡Œçš„ä»£ç <br> <img src="https://images2.imgbox.com/7c/bc/BMqRzlOM_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> åœ¨ç¨‹åºè¿è¡Œæ­£å¸¸çš„æƒ…å†µä¸‹,<code>@AfterThrowing</code>æ³¨è§£çš„æ–¹æ³•ä¸ä¼šæ‰§è¡Œ.<br> ä»ä¸Šé¢çš„æ‰§è¡Œç»“æœä¸­,æˆ‘ä»¬å¯ä»¥çœ‹å‡º:<mark><code>@Around</code>æœ‰å‰ç½®é€»è¾‘å’Œåç½®é€»è¾‘ä¸¤éƒ¨åˆ†,è¿™ä¸¤ä¸ªé€»è¾‘å†å†…å±‚å°±æ˜¯<code>@Before</code>å’Œ<code>@After</code>æ ‡è¯†çš„æ–¹æ³•,å†å¾€å†…å±‚å°±æ˜¯<code>@AfterReturning</code>æ ‡æ³¨çš„æ–¹æ³•</mark>.<br> <img src="https://images2.imgbox.com/64/fd/fDCzXM4G_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li><li>å¼‚å¸¸çš„æƒ…å†µ<br> <img src="https://images2.imgbox.com/80/44/RoDCLhCm_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> åœ¨å¼‚å¸¸å‘ç”Ÿçš„æƒ…å†µä¸‹,<mark><code>@Around</code>æ ‡è¯†çš„åç½®é€»è¾‘ä¸ä¼šè¢«æ‰§è¡Œ.<code>@AfterReturning</code>æ ‡è¯†çš„æ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œ.<code>@AfterThrowing</code>è¡¨ç¤ºçš„æ–¹æ³•ä¼šè¢«æ‰§è¡Œ</mark>.<br> <img src="https://images2.imgbox.com/1e/a1/lG2GQToV_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> [æ³¨æ„äº‹é¡¹]<br> â€¢ @Around ç¯ç»•é€šçŸ¥éœ€è¦<strong>è°ƒç”¨ProceedingJoinPoint.proceed() æ¥è®©åŸå§‹æ–¹æ³•æ‰§è¡Œ</strong>,å…¶ä»–é€šçŸ¥ä¸éœ€è¦è€ƒè™‘ç›®æ ‡æ–¹æ³•æ‰§è¡Œ.<br> â€¢ @Around ç¯ç»•é€šçŸ¥æ–¹æ³•çš„è¿”å›å€¼,<strong>å¿…é¡»æŒ‡å®šä¸ºObject,æ¥æ¥æ”¶åŸå§‹æ–¹æ³•çš„è¿”å›å€¼</strong>,å¦åˆ™åŸå§‹æ–¹æ³•æ‰§è¡Œå®Œæ¯•,æ˜¯è·å–ä¸åˆ°è¿”å›å€¼çš„.</li></ol> 
<h3><a id="33_Pointcut_164"></a>3.3 @Pointcut</h3> 
<p>ä¸Šé¢çš„ä»£ç ä¸­å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å°±æ˜¯åˆ‡ç‚¹è¡¨è¾¾å¼å¤§é‡é‡å¤,è¿™æ—¶å€™,Springæä¾›äº†<code>@Pointcut</code>æ³¨è§£ç”¨æ¥æŠŠå…¬å…±çš„åˆ‡ç‚¹è¡¨è¾¾å¼æå–å‡ºæ¥.åˆ°æ—¶å€™ç›´æ¥<strong>ä½¿ç”¨æ–¹æ³•åæŠŠå®ƒæå–å‡ºæ¥å³å¯</strong>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterReturning method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterThrowing method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>[æ³¨æ„] å½“åˆ‡ç‚¹ä½¿ç”¨privateä¿®é¥°çš„æ—¶å€™,ä»…å¯ä»¥åœ¨è¯¥ç±»ä¸­ä½¿ç”¨.å½“å…¶ä»–åˆ‡é¢ç±»ä¹Ÿéœ€è¦ä½¿ç”¨åˆ°è¯¥åˆ‡ç‚¹çš„æ—¶å€™,å°±éœ€è¦æŠŠprivateæ”¹æˆpublic,å¹¶ä½¿ç”¨<strong>å…¨é™å®šæ–¹æ³•å</strong>.</p> 
<h3><a id="34_Order_200"></a>3.4 åˆ‡é¢ä¼˜å…ˆçº§@Order</h3> 
<p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­,å®šä¹‰äº†å¤šä¸ªåˆ‡é¢ç±»,<strong>å¹¶ä¸”è¿™äº›åˆ‡é¢ç±»çš„å¤šä¸ªåˆ‡ç‚¹éƒ½åŒ¹é…åˆ°äº†åŒä¸€ä¸ªç›®æ ‡æ–¹æ³•</strong>,å½“ç›®æ ‡æ–¹æ³•è¿è¡Œçš„æ—¶å€™,è¿™äº›åˆ‡é¢ç±»ä¸­çš„æ–¹æ³•éƒ½ä¼šæ‰§è¡Œ,é‚£ä¹ˆè¿™äº›æ–¹æ³•æ‰§è¡Œçš„é¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„å‘¢?æˆ‘ä»¬é€šè¿‡ä»£ç æ¥éªŒè¯.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test2"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo1</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.order.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo1 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo1 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo2</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo2 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo2 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo3</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo3 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo3 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è§‚å¯Ÿæ—¥å¿—:<br> <img src="https://images2.imgbox.com/67/92/hCd0ybZR_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> é€šè¿‡ä¸Šè¿°ç¨‹åºçš„è¿è¡Œç»“æœ,å¯ä»¥çœ‹å‡º:<br> <mark>å­˜åœ¨å¤šä¸ªåˆ‡é¢ç±»å¯¹åº”ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™,é»˜è®¤æŒ‰ç…§åˆ‡é¢ç±»çš„å­—æ¯åºæ’åº</mark>.<strong>Beforeå’ŒAfteræˆå¯¹ç§°å¼åˆ†å¸ƒ</strong>.</p> 
<ul><li>@Before:å­—æ¯åºé å‰çš„å…ˆé€šçŸ¥.</li><li>@After:å­—æ¯åºé åçš„å…ˆé€šçŸ¥.</li></ul> 
<p>æ­¤å¤–,æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡Springçš„æ³¨è§£,æ¥æ§åˆ¶åˆ‡é¢çš„æ‰§è¡Œé¡ºåº:<code>@Order</code>.<br> ä½¿ç”¨æ–¹å¼å¦‚ä¸‹:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo1</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo2</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo3</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è§‚å¯Ÿæ—¥å¿—:<br> <img src="https://images2.imgbox.com/e7/42/spdiCXMG_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®º:</p> 
<ul><li>@Before:æ•°å­—å°çš„å…ˆæ‰§è¡Œ</li><li>@After:æ•°å­—å¤§çš„å…ˆæ‰§è¡Œ<br> å’Œä¸Šé¢ä¸€æ ·,Beforeå’ŒAfterä¹Ÿæ˜¯å‘ˆå¯¹ç§°å¼åˆ†å¸ƒ.<br> <img src="https://images2.imgbox.com/94/48/ZH4XGh58_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul> 
<h3><a id="35__294"></a>3.5 åˆ‡ç‚¹è¡¨è¾¾å¼</h3> 
<p>ä¸Šé¢çš„ä»£ç ä¸­,æˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼æ¥æè¿°åˆ‡ç‚¹,ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹åˆ‡ç‚¹è¡¨è¾¾å¼.<br> åˆ‡ç‚¹è¡¨è¾¾å¼æœ€å¸¸è§çš„æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼:</p> 
<ol><li><code>execution(...)</code>: æ ¹æ®<strong>æ–¹æ³•çš„ç­¾åæ¥åŒ¹é…</strong>.</li><li><code>@annotation</code>:æ ¹æ®<strong>æ³¨è§£åŒ¹é…</strong>.</li></ol> 
<h4><a id="351_execution_299"></a>3.5.1 executionè¡¨è¾¾å¼</h4> 
<p><code>execution(&lt;è®¿é—®é™å®šç¬¦&gt; &lt;è¿”å›ç±»å‹&gt; &lt;åŒ…å.ç±»å.æ–¹æ³•(æ–¹æ³•å‚æ•°)&gt;&lt;å¼‚å¸¸&gt;)</code><br> å…¶ä¸­è®¿é—®<strong>é™å®šç¬¦å¯ä»¥çœç•¥</strong>.<br> <img src="https://images2.imgbox.com/a2/3b/ZUyFoO8u_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> åˆ‡ç‚¹è¡¨è¾¾å¼æ”¯æŒé€šé…ç¬¦:</p> 
<ol><li><code>*</code>:åŒ¹é…ä»»ä½•å­—ç¬¦,<mark>åªå¯ä»¥åŒ¹é…ä¸€ä¸ªå…ƒç´ </mark>,å¯ä»¥åŒ¹é…è¿”å›ç±»å‹,åŒ…å,ç±»å,æ–¹æ³•å,æ–¹æ³•å‚æ•°.<br> a. åŒ…åä½¿ç”¨<code>* </code>è¡¨ç¤ºä»»æ„åŒ…(â¼€å±‚åŒ…ä½¿ç”¨â¼€ä¸ª<code>*</code>)<br> b. ç±»åä½¿ç”¨<code>* </code>è¡¨ç¤ºä»»æ„ç±»<br> c. è¿”å›å€¼ä½¿ç”¨<code>*</code> è¡¨ç¤ºä»»æ„è¿”å›å€¼ç±»å‹<br> d. æ–¹æ³•åä½¿ç”¨<code>*</code> è¡¨ç¤ºä»»æ„æ–¹æ³•<br> e. å‚æ•°ä½¿ç”¨<code>*</code> è¡¨ç¤º<mark>â¼€ä¸ªä»»æ„ç±»å‹çš„å‚æ•°</mark></li><li><code>..</code>:åŒ¹é…<mark>å¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·</mark>,å¯ä»¥é€šé…ä»»æ„å±‚çº§çš„åŒ…,æˆ–ä»»æ„ç±»å‹,ä»»æ„ä¸ªæ•°çš„å‚æ•°.<br> a. ä½¿ç”¨ <code>..</code> é…ç½®åŒ…åï¼Œæ ‡è¯†<mark>æ­¤åŒ…ä»¥åŠæ­¤åŒ…ä¸‹çš„æ‰€æœ‰å­åŒ…</mark><br> b. å¯ä»¥ä½¿ç”¨ <code>..</code> é…ç½®å‚æ•°ï¼Œ<mark>ä»»æ„ä¸ªä»»æ„ç±»å‹çš„å‚æ•°</mark><br> [æ³¨æ„] <code>*</code>åªå¯ä»¥åŒ¹é…ä¸€ä¸ªå…ƒç´ ,<code>..</code>å¯ä»¥åŒ¹é…å¤šä¸ªå…ƒç´ .<br> ä¸¾ä¾‹:</li></ol> 
<ul><li>åŒ¹é…TestControllerä¸‹çš„æ‰€æœ‰æ— å‚æ–¹æ³•.</li></ul> 
<pre><code>execution(* com.example.demo.controller.TestController.*())
</code></pre> 
<ul><li>åŒ¹é…TestControllerä¸‹çš„æ‰€æœ‰æ–¹æ³•</li></ul> 
<pre><code>execution(* com.example.demo.controller.TestController.*(..))
</code></pre> 
<ul><li>åŒ¹é…com.example.demoåŒ…ä¸‹,å­å­™åŒ…ä¸‹çš„æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•</li></ul> 
<pre><code>execution(* com.example.demo..*(..))
</code></pre> 
<ul><li>åŒ¹é…æ‰€æœ‰åŒ…ä¸‹é¢çš„TestControllerç±»çš„æ‰€æœ‰æ–¹æ³•.</li></ul> 
<pre><code>execution(* com..TestController.*(..))
</code></pre> 
<h4><a id="352_annotation_331"></a>3.5.2 @annotation(ç¿»è¯‘:æ³¨è§£)</h4> 
<p>å‡†å¤‡æ¥å£æµ‹è¯•ä»£ç :</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"u1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"u2"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>å¦‚æœæˆ‘ä»¬è¦åŒ¹é…å¤šä¸ªæ— è§„åˆ™çš„æ–¹æ³•å‘¢?æ¯”å¦‚UserControllerä¸­çš„user1æ–¹æ³•å’ŒTestControllerä¸­çš„t1æ–¹æ³•.è¿™æ—¶å€™ä½¿ç”¨executionæ˜¾å¾—æœ‰äº›éº»çƒ¦.è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©åˆ‡ç‚¹è¡¨è¾¾å¼çš„å¦ä¸€ç§æ–¹å¼.<code>@annotation</code>æ³¨è§£æ¥æè¿°ä¸€ç±»åˆ‡ç‚¹.å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹:</p> 
<ol><li>ç¼–å†™è‡ªå®šä¹‰æ³¨è§£</li><li>ä½¿ç”¨<code>@annotation</code>è¡¨è¾¾å¼æ¥æè¿°åˆ‡ç‚¹.</li><li>åœ¨è¿æ¥ç‚¹çš„æ–¹æ³•ä¸Š<strong>æ·»åŠ è‡ªå®šä¹‰æ³¨è§£</strong>.</li></ol> 
<ul><li>è‡ªå®šä¹‰æ³¨è§£<br> åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£ç±»,åˆ›å»ºçš„æ–¹å¼å’Œåˆ›å»ºç±»æ˜¯ä¸€æ ·çš„.<br> <img src="https://images2.imgbox.com/3b/1d/WzaC5ia5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<ol><li><code>@Target</code>æ³¨è§£,ä»£è¡¨çš„æ˜¯æ³¨è§£å¯ä»¥ä¿®é¥°çš„å¯¹è±¡,å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å››ç§å–å€¼:<br> <code>ElementType.TYPE</code>:ç”¨äºæè¿°ç±»ã€æ¥å£(åŒ…æ‹¬æ³¨è§£ç±»å‹)æˆ–enumå£°æ˜<br> <code>ElementType.METHOD</code>:æè¿°æ–¹æ³•<br> <code>ElementType.PARAMETER</code>:æè¿°å‚æ•°<br> <code>ElementType.TYPE_USE</code>:å¯ä»¥æ ‡æ³¨ä»»æ„ç±»å‹</li><li><code>@Retention</code>æ³¨è§£,ä»£è¡¨çš„æ˜¯<code>Annotation</code>è¢«ä¿ç•™çš„æ—¶é—´.è¡¨ç¤ºçš„æ˜¯è¯¥æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ.<br> <code>RetentionPolicy.SOURCE</code>ï¼šè¡¨ç¤ºæ³¨è§£ä»…å­˜åœ¨äºæºä»£ç ä¸­,ç¼–è¯‘æˆå­—èŠ‚ç åä¼šè¢«ä¸¢å¼ƒ.<br> <code>RetentionPolicy.CLASS</code>ï¼šç¼–è¯‘æ—¶æ³¨è§£.è¡¨ç¤ºæ³¨è§£å­˜åœ¨äºæºä»£ç å’Œå­—èŠ‚ç ä¸­,ä½†åœ¨è¿è¡Œæ—¶ä¼šè¢«ä¸¢å¼ƒ.<br> <code>RetentionPolicy.RUNTIME</code>ï¼šè¿è¡Œæ—¶æ³¨è§£,è¡¨ç¤ºæ³¨è§£å­˜åœ¨äºæºä»£ç ,å­—èŠ‚ç å’Œè¿è¡Œæ—¶ä¸­.</li></ol> 
<ul><li>åˆ‡é¢ç±»<br> ä½¿ç”¨<code>@annotation</code>åˆ‡ç‚¹è¡¨è¾¾å¼å®šä¹‰åˆ‡ç‚¹,<mark>åªå¯¹@MyAspectç”Ÿæ•ˆ</mark>.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo4</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.jrj.aspect.MyAspect)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.jrj.aspect.MyAspect))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>ä¸ºæŒ‡å®šæ–¹æ³•æ·»åŠ è‡ªå®šä¹‰æ³¨è§£,åœ¨åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£ä¹‹å,åœ¨è°ƒç”¨æ¥å£çš„æ—¶å€™å°±ä¼šæ‰§è¡Œåˆ‡é¢ä¸­çš„æ–¹æ³•.<br> åœ¨æµ‹è¯•ä»£ç çš„æ–¹æ³•ä¸‹é¢åŠ ä¸Šè‡ªå®šä¹‰æ³¨è§£:</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è§‚å¯Ÿæ—¥å¿—:<br> <img src="https://images2.imgbox.com/33/f6/gKID2pJy_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æˆ‘ä»¬å‘ç°æµ‹è¯•çš„æ¥å£æ‰“å°å‡ºäº†åˆ¶å®šçš„æ—¥å¿—.</p> 
<h2><a id="4_Spring_AOP_438"></a>4. Spring AOPåŸç†</h2> 
<p>SpringAOPä½¿ç”¨çš„æ˜¯<strong>åŠ¨æ€ä»£ç†</strong>æ¨¡å¼æ¥å®ç°çš„.ä»–æ‰€æ¶‰åŠçš„è®¾è®¡æ¨¡å¼æ˜¯ä»£ç†æ¨¡å¼.</p> 
<h3><a id="41__440"></a>4.1 ä»£ç†æ¨¡å¼</h3> 
<p>ä»£ç†æ¨¡å¼,ä¹Ÿå«å§”æ‰˜æ¨¡å¼<br> ä¸ºå…¶ä»–å¯¹è±¡æä¾›â¼€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®.å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›â¼€ä¸ªä»£ç†ç±»,è®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™,<mark>ä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨,è€Œæ˜¯é€šè¿‡ä»£ç†ç±»é—´æ¥è°ƒç”¨</mark>.<br> <img src="https://images2.imgbox.com/4f/43/IC654xy2_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://images2.imgbox.com/4b/ad/VRFikU5f_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p>ä¸¾ä¾‹è¯´æ˜ä»£ç†æ¨¡å¼:<br> æˆ¿å±‹ä¸­ä»‹ä¸æˆ¿ä¸œ,è‰ºäººä¸ç»çºªäºº,è€æ¿ä¸ç§˜ä¹¦.</p> 
</blockquote> 
<p>ä»£ç†æ¨¡å¼çš„ä¸»è¦è§’è‰²:</p> 
<ol><li>Subject:ä¸šåŠ¡æ¥å£ç±».è¿™é‡Œå®šä¹‰çš„æ˜¯ä»£ç†å’Œè¢«ä»£ç†å¯¹è±¡è¦åšçš„äº‹æƒ….å¯ä»¥æŠ½è±¡ç±»æˆ–è€…æ¥å£.</li><li>RealSubject:ä¸šåŠ¡å®ç°ç±».å…·ä½“çš„ä¸šåŠ¡æ‰§è¡Œ,ä¹Ÿå°±æ˜¯è¢«ä»£ç†çš„å¯¹è±¡.</li><li>Proxy:ä»£ç†ç±».RealSubjectçš„ä»£ç†.<br> æ ¹æ®ä»£ç†åˆ›å»ºçš„æ—¶æœŸ,å¯ä»¥æŠŠä»£ç†æ¨¡å¼åˆ†ä¸º<strong>åŠ¨æ€ä»£ç†</strong>å’Œ<strong>é™æ€ä»£ç†</strong>.</li></ol> 
<h4><a id="411__452"></a>4.1.1 é™æ€ä»£ç†</h4> 
<p>é™æ€ä»£ç†:åœ¨ç¨‹åºè¿è¡Œå‰,ä»£ç†ç±»çš„.classæ–‡ä»¶å°±å·²ç»å­˜åœ¨äº†.(åœ¨å‡ºç§Ÿæˆ¿å­ä¹‹å‰,ä¸­ä»‹å·²ç»åšå¥½äº†ç›¸å…³çš„å·¥ä½œå°±ç­‰ç§Ÿæˆ·æ¥ç§Ÿæˆ¿å­äº†)</p> 
<ol><li>æ¥å£å®šä¹‰(å®šä¹‰æˆ¿ä¸œå’Œä¸­ä»‹è¦åšçš„äº‹æƒ…)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>å®ç°æ¥å£(æˆ¿ä¸œå‡ºç§Ÿæˆ¿å­)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseProxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦å‡ºç§Ÿæˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>ä»£ç†(ä¸­ä»‹,å¸®æˆ¿ä¸œå‡ºç§Ÿæˆ¿å­)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">RealHouseProxy</span> realHouseProxy<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">RealHouseProxy</span> realHouseProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>realHouseProxy <span class="token operator">=</span> realHouseProxy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ä»£ç†å‡ºç§Ÿæˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        realHouseProxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£ç†å®Œæˆ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>ä½¿ç”¨</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RealHouseProxy</span> realHouseProxy1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>realHouseProxy1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¿è¡Œç»“æœ:<br> <img src="https://images2.imgbox.com/b3/55/fW2ODZNX_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> è™½ç„¶é™æ€ä»£ç†ä¹Ÿå®Œæˆäº†ä»£ç†,ä½†æ˜¯ç”±äºä»£ç æ˜¯å†™æ­»çš„,å¯¹ç›®æ ‡æ–¹æ³•çš„å¢å¼ºéƒ½æ˜¯æ‰‹åŠ¨æ¥å®Œæˆçš„,éå¸¸ä¸çµæ´»,æ‰€ä»¥æˆ‘ä»¬æœ‰äº†åŠ¨æ€ä»£ç†.</p> 
<h4><a id="412__501"></a>4.1.2 åŠ¨æ€ä»£ç†</h4> 
<p>æˆ‘ä»¬ä¸éœ€è¦é’ˆå¯¹æ¯ä¸ªç›®æ ‡å¯¹è±¡éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡,è€Œæ˜¯æŠŠè¿™ä¸ªä»£ç†å¯¹è±¡çš„å·¥ä½œæ¨è¿Ÿåˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ç”±JVMæ¥å®ç°,ä¹Ÿå°±æ˜¯åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™,æ ¹æ®éœ€è¦åŠ¨æ€åˆ›å»ºä»£ç†.<br> å¸¸è§çš„åŠ¨æ€ä»£ç†å®ç°æ¨¡å¼æœ‰ä¸¤ç§æ–¹å¼:</p> 
<ol><li>jdkåŠ¨æ€ä»£ç†<br> å®ç°æ­¥éª¤å¦‚ä¸‹: 
  <ul><li>é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£åŠå…¶å®ç°ç±»(ç›¸å½“äºæˆ¿ä¸œ).</li><li>ä¹‹åè‡ªå®šä¹‰ä¸€ä¸ªç±»,å®ç°<code>InvocationHandler</code>æ¥å£å¹¶é‡å†™<code>invoke</code>æ–¹æ³•,åœ¨invokeæ–¹æ³•ä¸­<strong>è°ƒç”¨ç›®æ ‡æ–¹æ³•(è¢«ä»£ç†çš„æ–¹æ³•)å¹¶è‡ªå®šä¹‰ä¸€äº›å¤„ç†é€»è¾‘</strong>.</li><li>è¿™é‡Œè°ƒç”¨æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯åå°„çš„æ–¹å¼,<mark>ä½¿ç”¨invoke()æ–¹æ³•æ¥è°ƒç”¨æ–¹æ³•(<strong>åå°„æ–¹å¼</strong>),å¹¶ä¼ å…¥è¢«ä»£ç†å¯¹è±¡å’Œargs(æ•°ç»„ä¸­å­˜æ”¾çš„æ˜¯æ–¹æ³•çš„å‚æ•°)å‚æ•°</mark>.</li><li>é€šè¿‡<code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h</code>æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡.</li></ul> </li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseProxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦å‡ºç§Ÿæˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKInvocationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯ä»£ç†,å¼€å§‹ä»£ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>object<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£ç†ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HouseSubject</span> houseSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HouseSubject</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">HouseSubject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code>[æ³¨æ„äº‹é¡¹]
1. åœ¨åŠ¨æ€ä»£ç†ç±»ä¸­,ç”±äºä»£ç†çš„å¯¹è±¡å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„,æ‰€ä»¥è¢«ä»£ç†å¯¹è±¡åº”è¯¥æ˜¯Objectç±»å‹çš„.
2. åœ¨ä½¿ç”¨newInstanceæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡çš„æ—¶å€™,ç¬¬ä¸€ä¸ªä¼ å…¥çš„æ˜¯è¢«ä»£ç†å¯¹è±¡çš„åŠ è½½å™¨,ç¬¬äºŒä¸ªä¼ å…¥çš„æ˜¯ä¸€ä¸ªclassç±»çš„æ•°ç»„,æ•°ç»„ä¸­æ”¾ç€è¢«ä»£ç†å¯¹è±¡æ¥å£çš„class,æœ€åä¸€ä¸ªæ”¾çš„æ˜¯æˆ‘ä»¬æå‰è®¾å®šå¥½çš„ä»£ç†ç±»çš„å¯¹è±¡.
</code></pre> 
<ol start="2"><li>CGLIBåŠ¨æ€ä»£ç†<br> jdkä»£ç†è‡´å‘½çš„é—®é¢˜å°±æ˜¯ä»–<mark>åªå¯ä»¥ä»£ç†æ¥å£(å®ç°ä¸€ä¸ªæ¥å£çš„ç±»),ä½†æ˜¯CGLIBåŠ¨æ€ä»£ç†å¯ä»¥æ—¢å¯ä»¥å®ç°æ¥å£,åˆå¯ä»¥å®ç°ç±»</mark>.<br> CGLIBåŠ¨æ€ä»£ç†ç±»å®ç°æ­¥éª¤: 
  <ul><li>å¼•å…¥CGLIBä¾èµ–</li><li>å®šä¹‰ä¸€ä¸ªè¢«ä»£ç†ç±»</li><li>è‡ªå®šä¹‰ä¸€ä¸ªä»£ç†ç±»,å¹¶å®ç°<code>MethodInterceptor </code>æ¥å£,å®ç°<code>intercept</code>æ–¹æ³•,<code>Intercept</code>æ–¹æ³•ç”¨äºè°ƒç”¨è¢«ä»£ç†ç±»çš„æ–¹æ³•,æ–¹æ³•å’Œjdkä»£ç†ä¸­çš„<code>invoke</code>ç±»ä¼¼.</li><li>é€šè¿‡<code>Enhancer</code>ç±»çš„<code>create()</code>æ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡.åœ¨å…¶ä¸­ä¼ å…¥æ¥å£çš„classå’Œä¹‹å‰å†™å¥½çš„è‡ªå®šä¹‰CGLIBä»£ç†ç±»çš„å¯¹è±¡.</li></ul> </li></ol> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseSubject</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦å‡ºç§Ÿæˆ¿å­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CGLIBInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CGLIBInterceptor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯ä»£ç†,å¼€å§‹ä»£ç†"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o1 <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span>objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»£ç†ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HouseSubject</span> houseSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HouseSubject</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">)</span> <span class="token class-name">Enhancer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">CGLIBInterceptor</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>CGLBä»£ç†æ¨¡å¼å’Œjdkä»£ç†æ¨¡å¼éå¸¸ç±»ä¼¼.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0d796979bb5d8dbd9e46bfb3e781c14/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€C&#43;&#43;ã€‘ç±»å’Œå¯¹è±¡â€”â€”Lesson1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/79ea12c9311ba15f7c8a4c035bc1c1f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">dockeréƒ¨ç½²rabbitMQ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>