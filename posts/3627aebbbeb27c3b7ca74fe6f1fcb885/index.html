<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Spring] Spring AOP - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3627aebbbeb27c3b7ca74fe6f1fcb885/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="[Spring] Spring AOP">
  <meta property="og:description" content="🌸个人主页:https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343
🏵️热门专栏:
🧊 Java基本语法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482
🍕 Collection与数据结构 (92平均质量分)https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482
🧀线程与网络(96平均质量分) https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482
🍭MySql数据库(93平均质量分)https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482
🍬算法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482
🍃 Spring(97平均质量分)https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482
感谢点赞与关注~~~
目录 1. AOP概述2. Spring AOP快速入门2.1 引入AOP依赖2.2 编写AOP程序 3. Spring AOP详解3.1 核心概念3.1.1 切点(PointCut)3.1.2 连接点(Join Point)3.1.3 通知(Advice)3.1.4 切面(Aspect) 3.2 通知类型3.3 @Pointcut3.4 切面优先级@Order3.5 切点表达式3.5.1 execution表达式3.5.2 @annotation(翻译:注解) 4. Spring AOP原理4.1 代理模式4.1.1 静态代理4.1.2 动态代理 1. AOP概述 什么是AOP?
所谓AOP,就是面相切面的编程.什么是面向切面的编程呢,切面就是指定某一类特定的问题,所以,面向切面的编程就是正对于同一类问题进行编程.
简单来说,就是针对某一类事情的集中处理.什么是Spring AOP?
AOP是一种思想,实现AOP的方法有很多,有Spring AOP,有AspectJ,有CGLIB等.Spring AOP是其中的一种实现方式. 某种程度上,他和我们前面提到的统一功能处理的效果差不多,但是,统一功能处理并不等同于SpringAOP,拦截器的作用维度是URL,即一次请求响应,但是AOP的作用维度更加细致,可以对包括包,类,方法,参数等进行统一功能的处理,可以实现更加复杂的业务逻辑.
举例:
现在有一些业务执行效率比较低,我们需要对接口进行优化,第一步需要定位出耗时较长的业务方法,在针对业务额来进行优化.我们就可以在每一个方法的结束和开始的地方加上时间戳,之后作差展示出来.但是在一个项目中,我们有好多接口,此时在接口中一个个低添加时间戳又不是很现实,此时我们就需要用到AOP.
接下来,我们就来看看AOP如何使用.
2. Spring AOP快速入门 需求: 统计图书管理系统各个接口和方法的执行时间.
2.1 引入AOP依赖 在pom文件中添加依赖:
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; 2.2 编写AOP程序 记录Controller中每个方法的执行时间.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-08T20:33:40+08:00">
    <meta property="article:modified_time" content="2024-08-08T20:33:40+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Spring] Spring AOP</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>🌸个人主页:<a href="https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343">https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343</a><br> 🏵️热门专栏:<br> 🧊 Java基本语法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482</a><br> 🍕 Collection与数据结构 (92平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482</a><br> 🧀线程与网络(96平均质量分) <a href="https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482</a><br> 🍭MySql数据库(93平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482</a><br> 🍬算法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482</a><br> 🍃 Spring(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482</a><br> 感谢点赞与关注~~~<br> <img src="https://images2.imgbox.com/ca/b0/JLu0IQn3_o.jpg" alt="在这里插入图片描述"></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_AOP_13" rel="nofollow">1. AOP概述</a></li><li><a href="#2_Spring_AOP_25" rel="nofollow">2. Spring AOP快速入门</a></li><li><ul><li><a href="#21_AOP_27" rel="nofollow">2.1 引入AOP依赖</a></li><li><a href="#22_AOP_35" rel="nofollow">2.2 编写AOP程序</a></li></ul> 
  </li><li><a href="#3_Spring_AOP_73" rel="nofollow">3. Spring AOP详解</a></li><li><ul><li><a href="#31__74" rel="nofollow">3.1 核心概念</a></li><li><ul><li><a href="#311_PointCut_75" rel="nofollow">3.1.1 切点(PointCut)</a></li><li><a href="#312_Join_Point_78" rel="nofollow">3.1.2 连接点(Join Point)</a></li><li><a href="#313_Advice_84" rel="nofollow">3.1.3 通知(Advice)</a></li><li><a href="#314_Aspect_88" rel="nofollow">3.1.4 切面(Aspect)</a></li></ul> 
   </li><li><a href="#32__93" rel="nofollow">3.2 通知类型</a></li><li><a href="#33_Pointcut_164" rel="nofollow">3.3 @Pointcut</a></li><li><a href="#34_Order_200" rel="nofollow">3.4 切面优先级@Order</a></li><li><a href="#35__294" rel="nofollow">3.5 切点表达式</a></li><li><ul><li><a href="#351_execution_299" rel="nofollow">3.5.1 execution表达式</a></li><li><a href="#352_annotation_331" rel="nofollow">3.5.2 @annotation(翻译:注解)</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4_Spring_AOP_438" rel="nofollow">4. Spring AOP原理</a></li><li><ul><li><a href="#41__440" rel="nofollow">4.1 代理模式</a></li><li><ul><li><a href="#411__452" rel="nofollow">4.1.1 静态代理</a></li><li><a href="#412__501" rel="nofollow">4.1.2 动态代理</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_AOP_13"></a>1. AOP概述</h2> 
<ul><li>什么是AOP?<br> 所谓AOP,就是面相切面的编程.什么是面向切面的编程呢,<mark>切面就是指定某一类特定的问题,所以,面向切面的编程就是正对于同一类问题进行编程</mark>.<br> 简单来说,就是<strong>针对某一类事情的集中处理</strong>.</li><li>什么是Spring AOP?<br> AOP是一种思想,实现AOP的方法有很多,有Spring AOP,有AspectJ,有CGLIB等.Spring AOP是其中的一种实现方式.</li></ul> 
<p>某种程度上,他和我们前面提到的统一功能处理的效果差不多,但是,统一功能处理并不等同于SpringAOP,拦截器的作用维度是URL,即一次请求响应,但是AOP的作用维度更加细致,可以对包括包,类,方法,参数等进行统一功能的处理,可以实现更加复杂的业务逻辑.</p> 
<blockquote> 
 <p>举例:<br> 现在有一些业务执行效率比较低,我们需要对接口进行优化,第一步需要定位出耗时较长的业务方法,在针对业务额来进行优化.我们就可以在每一个方法的结束和开始的地方加上时间戳,之后作差展示出来.但是在一个项目中,我们有好多接口,此时在接口中一个个低添加时间戳又不是很现实,此时我们就需要用到AOP.</p> 
</blockquote> 
<p>接下来,我们就来看看AOP如何使用.</p> 
<h2><a id="2_Spring_AOP_25"></a>2. Spring AOP快速入门</h2> 
<p>需求: 统计图书管理系统各个接口和方法的执行时间.</p> 
<h3><a id="21_AOP_27"></a>2.1 引入AOP依赖</h3> 
<p>在pom文件中添加依赖:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="22_AOP_35"></a>2.2 编写AOP程序</h3> 
<p>记录Controller中每个方法的执行时间.</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>books<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">ProceedingJoinPoint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Around</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Aspect</span><span class="token comment">//表示切面</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeAspect</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.books.controller.*.*(..)))"</span><span class="token punctuation">)</span><span class="token comment">//切点表达式</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">recordTime</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//参数是连接点</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> ret <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行连接点方法</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行耗时:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end<span class="token operator">-</span>begin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码的测试结果如下:<br> <img src="https://images2.imgbox.com/51/26/Tr5QffjL_o.png" alt="在这里插入图片描述"><br> 我们看到了接口返回了执行耗时.<br> 下面我们对上面的代码进行详细的解释:</p> 
<ol><li> <p><code>@Aspect </code>: 表示的是切面.表示<strong>这个类是一个切面类</strong>.</p> </li><li> <p><code>@Around</code>: 环绕通知,在<strong>目标方法前后都会有代码执行</strong>.<br> <img src="https://images2.imgbox.com/e1/42/bwCUxqS7_o.png" alt="在这里插入图片描述"></p> </li><li> <p><code>proceedingJoinPoint.proceed()</code>: <strong>执行</strong>加入切面的连接点.</p> </li><li> <p><code>execution(* com.jrj.books.controller.*.*(..)))</code>:切点表达式,<strong>表示这个切面对该项目下的那个方法生效</strong>.</p> </li><li> <p><code>ProceedingJoinPoint proceedingJoinPoint</code>: 加入切面的<strong>连接点</strong>.</p> </li></ol> 
<h2><a id="3_Spring_AOP_73"></a>3. Spring AOP详解</h2> 
<h3><a id="31__74"></a>3.1 核心概念</h3> 
<h4><a id="311_PointCut_75"></a>3.1.1 切点(PointCut)</h4> 
<p>切点,也就是切入点,我们一般在通知类型注解的后面使用<strong>execution切点表达式</strong>来描述切点.<mark>切点就是告诉程序对那些方法的功能进行加强</mark>.<br> <img src="https://images2.imgbox.com/e5/f7/s3qxStpi_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="312_Join_Point_78"></a>3.1.2 连接点(Join Point)</h4> 
<p><mark>满足切点表达式规则的方法,就是连接点</mark>,也就是可以被该切面所作用的方法.连接点的数据类型是:<code>ProceedingJoinPoint</code>.也就是<code>com.jrj.books.controller.</code>包下的所有方法都是该切面的连接点.<br> <img src="https://images2.imgbox.com/08/42/Vm5vWUPw_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>切点与连接点之间的关系<br> 连接点事满足切点表达式的元素,<strong>切点可以看做是一个保存了众多连接点的集合</strong>.</p> 
</blockquote> 
<h4><a id="313_Advice_84"></a>3.1.3 通知(Advice)</h4> 
<p>通知就是<strong>具体要做的工作,指在指定的方法中重复那些逻辑</strong>,也就是共性功能.<br> 比如上面实现计算运行前后的时间差的业务逻辑就叫做通知.<br> <img src="https://images2.imgbox.com/3d/b7/VCmRunn5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="314_Aspect_88"></a>3.1.4 切面(Aspect)</h4> 
<p><strong>切面=切点+通知</strong><br> 切面既包含了逻辑的定义,也包含连接点的定义.<br> <img src="https://images2.imgbox.com/6c/bf/0jsI348A_o.png" alt="在这里插入图片描述"><br> 切面说在的类,我们一般称为<strong>切面类</strong>.</p> 
<h3><a id="32__93"></a>3.2 通知类型</h3> 
<p>SpringAOP中的通知类型有以下几种:</p> 
<ul><li>@Around:环绕通知,<mark>表示该方法在目标方法前后都会被执行</mark>.</li><li>@Before:前置通知,<mark>表示该方法只在目标方法之前被执行</mark>.</li><li>@After:后置通知,<mark>表示该方法只在目标方法之后被执行</mark>,<strong>无论是否有异常发生</strong>.</li><li>@AfterReturning:返回后通知,<mark>表示该方法只在目标方法之后被执行</mark>,<strong>方法返回了之后才会执行,有异常发生不会执行</strong>.</li><li>@AfterThrowing:<mark>异常后通知</mark>.表示方法在发生异常之后执行.</li></ul> 
<p>代码演示:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterReturning method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterThrowing method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>[注意] 被<code>@Around</code>标志的方法必须有形式和返回值.其他注解标志的方法可以加上<code>JoinPoint</code>类型的形式参数,**用来获取原始方法的数据.<br> 下面我们准备测试代码:其中一个正常执行,另外一个制造一些异常出来.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下面我们来执行代码,观察后端日志:</p> 
<ol><li>正常执行的代码<br> <img src="https://images2.imgbox.com/7c/bc/BMqRzlOM_o.png" alt="在这里插入图片描述"><br> 在程序运行正常的情况下,<code>@AfterThrowing</code>注解的方法不会执行.<br> 从上面的执行结果中,我们可以看出:<mark><code>@Around</code>有前置逻辑和后置逻辑两部分,这两个逻辑再内层就是<code>@Before</code>和<code>@After</code>标识的方法,再往内层就是<code>@AfterReturning</code>标注的方法</mark>.<br> <img src="https://images2.imgbox.com/64/fd/fDCzXM4G_o.png" alt="在这里插入图片描述"></li><li>异常的情况<br> <img src="https://images2.imgbox.com/80/44/RoDCLhCm_o.png" alt="在这里插入图片描述"><br> 在异常发生的情况下,<mark><code>@Around</code>标识的后置逻辑不会被执行.<code>@AfterReturning</code>标识的方法不会被执行.<code>@AfterThrowing</code>表示的方法会被执行</mark>.<br> <img src="https://images2.imgbox.com/1e/a1/lG2GQToV_o.png" alt="在这里插入图片描述"><br> [注意事项]<br> • @Around 环绕通知需要<strong>调用ProceedingJoinPoint.proceed() 来让原始方法执行</strong>,其他通知不需要考虑目标方法执行.<br> • @Around 环绕通知方法的返回值,<strong>必须指定为Object,来接收原始方法的返回值</strong>,否则原始方法执行完毕,是获取不到返回值的.</li></ol> 
<h3><a id="33_Pointcut_164"></a>3.3 @Pointcut</h3> 
<p>上面的代码中存在一个问题,就是切点表达式大量重复,这时候,Spring提供了<code>@Pointcut</code>注解用来把公共的切点表达式提取出来.到时候直接<strong>使用方法名把它提取出来即可</strong>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> proceedingJoinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> proceedingJoinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"around after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterReturning method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">"pointCut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"afterThrowing method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>[注意] 当切点使用private修饰的时候,仅可以在该类中使用.当其他切面类也需要使用到该切点的时候,就需要把private改成public,并使用<strong>全限定方法名</strong>.</p> 
<h3><a id="34_Order_200"></a>3.4 切面优先级@Order</h3> 
<p>当我们在一个项目中,定义了多个切面类,<strong>并且这些切面类的多个切点都匹配到了同一个目标方法</strong>,当目标方法运行的时候,这些切面类中的方法都会执行,那么这些方法执行的顺序是什么样的呢?我们通过代码来验证.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test2"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo1</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.jrj.aspect.order.*.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo1 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo1 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo2</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo2 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo2 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo3</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo3 before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"com.jrj.aspect.order.AspectDemo1.pt()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AspectDemo3 after"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志:<br> <img src="https://images2.imgbox.com/67/92/hCd0ybZR_o.png" alt="在这里插入图片描述"><br> 通过上述程序的运行结果,可以看出:<br> <mark>存在多个切面类对应一个方法的时候,默认按照切面类的字母序排序</mark>.<strong>Before和After成对称式分布</strong>.</p> 
<ul><li>@Before:字母序靠前的先通知.</li><li>@After:字母序靠后的先通知.</li></ul> 
<p>此外,我们还可以通过Spring的注解,来控制切面的执行顺序:<code>@Order</code>.<br> 使用方式如下:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo1</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo2</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo3</span> <span class="token punctuation">{<!-- --></span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志:<br> <img src="https://images2.imgbox.com/e7/42/spdiCXMG_o.png" alt="在这里插入图片描述"><br> 我们可以得出以下结论:</p> 
<ul><li>@Before:数字小的先执行</li><li>@After:数字大的先执行<br> 和上面一样,Before和After也是呈对称式分布.<br> <img src="https://images2.imgbox.com/94/48/ZH4XGh58_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="35__294"></a>3.5 切点表达式</h3> 
<p>上面的代码中,我们一直在使用切点表达式来描述切点,下面我们来介绍一下切点表达式.<br> 切点表达式最常见的有以下两种方式:</p> 
<ol><li><code>execution(...)</code>: 根据<strong>方法的签名来匹配</strong>.</li><li><code>@annotation</code>:根据<strong>注解匹配</strong>.</li></ol> 
<h4><a id="351_execution_299"></a>3.5.1 execution表达式</h4> 
<p><code>execution(&lt;访问限定符&gt; &lt;返回类型&gt; &lt;包名.类名.方法(方法参数)&gt;&lt;异常&gt;)</code><br> 其中访问<strong>限定符可以省略</strong>.<br> <img src="https://images2.imgbox.com/a2/3b/ZUyFoO8u_o.png" alt="在这里插入图片描述"><br> 切点表达式支持通配符:</p> 
<ol><li><code>*</code>:匹配任何字符,<mark>只可以匹配一个元素</mark>,可以匹配返回类型,包名,类名,方法名,方法参数.<br> a. 包名使用<code>* </code>表示任意包(⼀层包使用⼀个<code>*</code>)<br> b. 类名使用<code>* </code>表示任意类<br> c. 返回值使用<code>*</code> 表示任意返回值类型<br> d. 方法名使用<code>*</code> 表示任意方法<br> e. 参数使用<code>*</code> 表示<mark>⼀个任意类型的参数</mark></li><li><code>..</code>:匹配<mark>多个连续的任意符号</mark>,可以通配任意层级的包,或任意类型,任意个数的参数.<br> a. 使用 <code>..</code> 配置包名，标识<mark>此包以及此包下的所有子包</mark><br> b. 可以使用 <code>..</code> 配置参数，<mark>任意个任意类型的参数</mark><br> [注意] <code>*</code>只可以匹配一个元素,<code>..</code>可以匹配多个元素.<br> 举例:</li></ol> 
<ul><li>匹配TestController下的所有无参方法.</li></ul> 
<pre><code>execution(* com.example.demo.controller.TestController.*())
</code></pre> 
<ul><li>匹配TestController下的所有方法</li></ul> 
<pre><code>execution(* com.example.demo.controller.TestController.*(..))
</code></pre> 
<ul><li>匹配com.example.demo包下,子孙包下的所有类的所有方法</li></ul> 
<pre><code>execution(* com.example.demo..*(..))
</code></pre> 
<ul><li>匹配所有包下面的TestController类的所有方法.</li></ul> 
<pre><code>execution(* com..TestController.*(..))
</code></pre> 
<h4><a id="352_annotation_331"></a>3.5.2 @annotation(翻译:注解)</h4> 
<p>准备接口测试代码:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"u1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"u2"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"t1"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>如果我们要匹配多个无规则的方法呢?比如UserController中的user1方法和TestController中的t1方法.这时候使用execution显得有些麻烦.这时候我们就可以借助切点表达式的另一种方式.<code>@annotation</code>注解来描述一类切点.具体实现步骤如下:</p> 
<ol><li>编写自定义注解</li><li>使用<code>@annotation</code>表达式来描述切点.</li><li>在连接点的方法上<strong>添加自定义注解</strong>.</li></ol> 
<ul><li>自定义注解<br> 创建一个自定义注解类,创建的方式和创建类是一样的.<br> <img src="https://images2.imgbox.com/3b/1d/WzaC5ia5_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<ol><li><code>@Target</code>注解,代表的是注解可以修饰的对象,常用的有以下四种取值:<br> <code>ElementType.TYPE</code>:用于描述类、接口(包括注解类型)或enum声明<br> <code>ElementType.METHOD</code>:描述方法<br> <code>ElementType.PARAMETER</code>:描述参数<br> <code>ElementType.TYPE_USE</code>:可以标注任意类型</li><li><code>@Retention</code>注解,代表的是<code>Annotation</code>被保留的时间.表示的是该注解的生命周期.<br> <code>RetentionPolicy.SOURCE</code>：表示注解仅存在于源代码中,编译成字节码后会被丢弃.<br> <code>RetentionPolicy.CLASS</code>：编译时注解.表示注解存在于源代码和字节码中,但在运行时会被丢弃.<br> <code>RetentionPolicy.RUNTIME</code>：运行时注解,表示注解存在于源代码,字节码和运行时中.</li></ol> 
<ul><li>切面类<br> 使用<code>@annotation</code>切点表达式定义切点,<mark>只对@MyAspect生效</mark>.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectDemo4</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.jrj.aspect.MyAspect)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.jrj.aspect.MyAspect))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"after method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>为指定方法添加自定义注解,在加上自定义注解之后,在调用接口的时候就会执行切面中的方法.<br> 在测试代码的方法下面加上自定义注解:</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"t2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">t2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@MyAspect</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/u2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">user2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>观察日志:<br> <img src="https://images2.imgbox.com/33/f6/gKID2pJy_o.png" alt="在这里插入图片描述"><br> 我们发现测试的接口打印出了制定的日志.</p> 
<h2><a id="4_Spring_AOP_438"></a>4. Spring AOP原理</h2> 
<p>SpringAOP使用的是<strong>动态代理</strong>模式来实现的.他所涉及的设计模式是代理模式.</p> 
<h3><a id="41__440"></a>4.1 代理模式</h3> 
<p>代理模式,也叫委托模式<br> 为其他对象提供⼀种代理以控制对这个对象的访问.它的作用就是通过提供⼀个代理类,让我们在调用目标方法的时候,<mark>不再是直接对目标方法进行调用,而是通过代理类间接调用</mark>.<br> <img src="https://images2.imgbox.com/4f/43/IC654xy2_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/4b/ad/VRFikU5f_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>举例说明代理模式:<br> 房屋中介与房东,艺人与经纪人,老板与秘书.</p> 
</blockquote> 
<p>代理模式的主要角色:</p> 
<ol><li>Subject:业务接口类.这里定义的是代理和被代理对象要做的事情.可以抽象类或者接口.</li><li>RealSubject:业务实现类.具体的业务执行,也就是被代理的对象.</li><li>Proxy:代理类.RealSubject的代理.<br> 根据代理创建的时期,可以把代理模式分为<strong>动态代理</strong>和<strong>静态代理</strong>.</li></ol> 
<h4><a id="411__452"></a>4.1.1 静态代理</h4> 
<p>静态代理:在程序运行前,代理类的.class文件就已经存在了.(在出租房子之前,中介已经做好了相关的工作就等租户来租房子了)</p> 
<ol><li>接口定义(定义房东和中介要做的事情)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>实现接口(房东出租房子)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseProxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我要出租房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>代理(中介,帮房东出租房子)</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">RealHouseProxy</span> realHouseProxy<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token class-name">RealHouseProxy</span> realHouseProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>realHouseProxy <span class="token operator">=</span> realHouseProxy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我要代理出租房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        realHouseProxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代理完成"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>使用</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RealHouseProxy</span> realHouseProxy1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Proxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>realHouseProxy1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/b3/55/fW2ODZNX_o.png" alt="在这里插入图片描述"><br> 虽然静态代理也完成了代理,但是由于代码是写死的,对目标方法的增强都是手动来完成的,非常不灵活,所以我们有了动态代理.</p> 
<h4><a id="412__501"></a>4.1.2 动态代理</h4> 
<p>我们不需要针对每个目标对象都单独创建一个代理对象,而是把这个代理对象的工作推迟到程序运行的时候由JVM来实现,也就是在程序运行的时候,根据需要动态创建代理.<br> 常见的动态代理实现模式有两种方式:</p> 
<ol><li>jdk动态代理<br> 实现步骤如下: 
  <ul><li>首先定义一个接口及其实现类(相当于房东).</li><li>之后自定义一个类,实现<code>InvocationHandler</code>接口并重写<code>invoke</code>方法,在invoke方法中<strong>调用目标方法(被代理的方法)并自定义一些处理逻辑</strong>.</li><li>这里调用方法的时候使用的是反射的方式,<mark>使用invoke()方法来调用方法(<strong>反射方式</strong>),并传入被代理对象和args(数组中存放的是方法的参数)参数</mark>.</li><li>通过<code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h</code>方法创建代理对象.</li></ul> </li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseProxy</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我要出租房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JDKInvocationHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我是代理,开始代理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> object <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>object<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代理结束"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HouseSubject</span> houseSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HouseSubject</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">HouseSubject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">JDKInvocationHandler</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code>[注意事项]
1. 在动态代理类中,由于代理的对象可以是任何类型的,所以被代理对象应该是Object类型的.
2. 在使用newInstance方法创建代理对象的时候,第一个传入的是被代理对象的加载器,第二个传入的是一个class类的数组,数组中放着被代理对象接口的class,最后一个放的是我们提前设定好的代理类的对象.
</code></pre> 
<ol start="2"><li>CGLIB动态代理<br> jdk代理致命的问题就是他<mark>只可以代理接口(实现一个接口的类),但是CGLIB动态代理可以既可以实现接口,又可以实现类</mark>.<br> CGLIB动态代理类实现步骤: 
  <ul><li>引入CGLIB依赖</li><li>定义一个被代理类</li><li>自定义一个代理类,并实现<code>MethodInterceptor </code>接口,实现<code>intercept</code>方法,<code>Intercept</code>方法用于调用被代理类的方法,方法和jdk代理中的<code>invoke</code>类似.</li><li>通过<code>Enhancer</code>类的<code>create()</code>方法创建代理对象.在其中传入接口的class和之前写好的自定义CGLIB代理类的对象.</li></ul> </li></ol> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HouseSubject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealHouseSubject</span> <span class="token keyword">implements</span> <span class="token class-name">HouseSubject</span><span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我要出租房子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CGLIBInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">CGLIBInterceptor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"我是代理,开始代理"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> o1 <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">,</span>objects<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"代理结束"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> o1<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HouseSubject</span> houseSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealHouseSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HouseSubject</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">)</span> <span class="token class-name">Enhancer</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">HouseSubject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">CGLIBInterceptor</span><span class="token punctuation">(</span>houseSubject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">rentHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>CGLB代理模式和jdk代理模式非常类似.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0d796979bb5d8dbd9e46bfb3e781c14/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;】类和对象——Lesson1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/79ea12c9311ba15f7c8a4c035bc1c1f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">docker部署rabbitMQ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>