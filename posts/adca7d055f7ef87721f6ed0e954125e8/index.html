<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php使用ElasticSearch - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/adca7d055f7ef87721f6ed0e954125e8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="php使用ElasticSearch">
  <meta property="og:description" content="ElasticSearch简介 Elasticsearch 是一个分布式的、开源的搜索分析引擎，支持各种数据类型，包括文本、数字、地理、结构化、非结构化。
Lucene与ElasticSearch Apache Lucene是一款高性能的、可扩展的信息检索（IR）工具库，是由Java语言开发的成熟、自由开源的搜索类库，基于Apache协议授权。Lucene只是一个软件类库，如果要发挥Lucene的功能，还需要开发一个调用Lucene类库的应用程序。
ElasticSearch在底层利用Lucene完成其索引功能，因此其许多基本概念源于Lucene。ElasticSearch封装了许多lucene底层功能，提供了分布式的服务、简单易用的restful API接口和许多语言的客户端。
倒排索引 Lucene中对文档检索基于倒排索引实现，并将它发挥到了极致。
倒排索引是实现“单词-文档矩阵”的一种具体存储形式，通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。
例如：
id句子1I like apples2I dislike apples3I dislike apples too 如果要用单词作为索引，而句子的位置作为被索引的元素，那么索引就发生了倒置：
id单词索引I{1,2,3}like{1}apples{1,2,3}dislike{2,3}too{3} 如果要检索I dislike apples这句话，那么就可以这么计算 : {1,2,3} ^ {2,3} ^ {1,2,3} (^是交集)
核心概念 索引(Index)
ES将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于SQL中的一个数据库，或者一个数据存储方案(schema)。索引由其名称(必须为全小写字符)进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个ES集群中可以按需创建任意数目的索引。
类型(Type)
类型是索引内部的逻辑分区(category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型(type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于“表”。
文档(Document)
文档是Lucene索引和搜索的原子单位，它是包含了一个或多个域的容器，基于JSON格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为“多值域”。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。
映射(Mapping)
ES中，所有的文档在存储之前都要首先进行分析。用户可根据需要定义如何将文本分割成token、哪些token应该被过滤掉，以及哪些文本需要进行额外处理等等。另外，ES还提供了额外功能，例如将域中的内容按需排序。事实上，ES也能自动根据其值确定域的类型。
**节点（Node） **
一个es实例即为一个节点，也是集群的一部分，它存储你的数据，并参与集群的索引和搜索。和集群一样，节点也是通过唯一的名字去区分，默认名字是一个随机的UUID，当服务器启动的时候就会设置到节点。你也可以自定义节点的名称。名称对管理员来说十分重要，它可以帮助你辨认出集群中的各个服务器和哪个节点相对应。
分片(Shard)和副本(Replica)
ES的“分片(shard)”机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的Lucene索引完成索引数据的分割存储功能，这每一个物理的Lucene索引称为一个分片(shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为5个。
集群（Cluster） 集群是一个或多个节点（服务器）的集合，它们联合起来保存所有的数据（索引以分片为单位分散到多个节点上保存）并且可以在所有的节点上进行索引和搜索操作。集群通过一个唯一的名字区分，默认的名字是“elasticsearch”。这个名字十分重要，因为一个节点仅仅可以属于一个集群，并根据集群名称加入集群。
与关系型数据库核心概念对比
Elasticsearch关系型数据库（如Mysql）索引Index数据库Database类型Type（8.x版本已废弃）表Table文档Document数据行Row字段Field数据列Column映射Mapping约束Schema 数据类型 Elasticsearch 8.x中已经完全删除了数据类型，创建映射时也不再支持使用type字段指定数据类型，不然会报错&#34;index&#34; is not a valid parameter. Allowed parameters are &#34;create&#34;, &#34;error_trace&#34;
这里就不继续介绍数据类型了
安装和启动 Windows 1.去官网Download Elasticsearch | Elastic下载windows版本压缩包，然后解压；">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-12T18:01:09+08:00">
    <meta property="article:modified_time" content="2024-03-12T18:01:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php使用ElasticSearch</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="ElasticSearch_1"></a>ElasticSearch简介</h3> 
<p>Elasticsearch 是一个<strong>分布式</strong>的、开源的<strong>搜索分析引擎</strong>，支持各种数据类型，包括文本、数字、地理、结构化、非结构化。</p> 
<h3><a id="LuceneElasticSearch_9"></a>Lucene与ElasticSearch</h3> 
<hr> 
<p>Apache Lucene是一款高性能的、可扩展的信息检索（IR）工具库，是由Java语言开发的成熟、自由开源的搜索类库，基于Apache协议授权。Lucene只是一个软件类库，如果要发挥Lucene的功能，还需要开发一个调用Lucene类库的应用程序。</p> 
<p>ElasticSearch在底层利用Lucene完成其索引功能，因此其许多基本概念源于Lucene。ElasticSearch<strong>封装</strong>了许多<strong>lucene</strong>底层功能，提供了分布式的服务、简单易用的restful API接口和许多语言的客户端。</p> 
<h3><a id="_21"></a>倒排索引</h3> 
<hr> 
<p>Lucene中对文档检索基于倒排索引实现，并将它发挥到了极致。</p> 
<p>倒排索引是实现“单词-文档矩阵”的一种具体存储形式，通过倒排索引，可以根据单词快速获取包含这个单词的文档列表。</p> 
<p>例如：</p> 
<table><thead><tr><th>id</th><th>句子</th></tr></thead><tbody><tr><td>1</td><td>I like apples</td></tr><tr><td>2</td><td>I dislike apples</td></tr><tr><td>3</td><td>I dislike apples too</td></tr></tbody></table> 
<p>如果要用单词作为索引，而句子的位置作为被索引的元素，那么索引就发生了倒置：</p> 
<table><thead><tr><th>id</th><th>单词索引</th></tr></thead><tbody><tr><td>I</td><td>{1,2,3}</td></tr><tr><td>like</td><td>{1}</td></tr><tr><td>apples</td><td>{1,2,3}</td></tr><tr><td>dislike</td><td>{2,3}</td></tr><tr><td>too</td><td>{3}</td></tr></tbody></table> 
<p>如果要检索I dislike apples这句话，那么就可以这么计算 : {1,2,3} ^ {2,3} ^ {1,2,3} (^是交集)</p> 
<h3><a id="_53"></a>核心概念</h3> 
<hr> 
<ul><li> <p><strong>索引(Index)</strong></p> <p>ES将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于SQL中的一个数据库，或者一个数据存储方案(schema)。索引由其名称(必须为全小写字符)进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个ES集群中可以按需创建任意数目的索引。</p> </li><li> <p><strong>类型(Type)</strong></p> <p>类型是索引内部的逻辑分区(category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型(type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于“表”。</p> </li><li> <p><strong>文档(Document)</strong></p> <p>文档是Lucene索引和搜索的原子单位，它是包含了一个或多个域的容器，基于JSON格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为“多值域”。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p> </li><li> <p><strong>映射(Mapping)</strong></p> <p>ES中，所有的文档在存储之前都要首先进行分析。用户可根据需要定义如何将文本分割成token、哪些token应该被过滤掉，以及哪些文本需要进行额外处理等等。另外，ES还提供了额外功能，例如将域中的内容按需排序。事实上，ES也能自动根据其值确定域的类型。</p> </li><li> <p>**节点（Node） **</p> <p>一个es实例即为一个节点，也是集群的一部分，它存储你的数据，并参与集群的索引和搜索。和集群一样，节点也是通过唯一的名字去区分，默认名字是一个随机的UUID，当服务器启动的时候就会设置到节点。你也可以自定义节点的名称。名称对管理员来说十分重要，它可以帮助你辨认出集群中的各个服务器和哪个节点相对应。</p> </li><li> <p><strong>分片(Shard)和副本(Replica)</strong><br> ES的“分片(shard)”机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的Lucene索引完成索引数据的分割存储功能，这每一个物理的Lucene索引称为一个分片(shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为5个。</p> </li><li> <h6><a id="Cluster_92"></a>集群（Cluster）</h6> <p>集群是一个或多个节点（服务器）的集合，它们联合起来保存所有的数据（索引以分片为单位分散到多个节点上保存）并且可以在所有的节点上进行索引和搜索操作。集群通过一个唯一的名字区分，默认的名字是“elasticsearch”。这个名字十分重要，因为一个节点仅仅可以属于一个集群，并根据集群名称加入集群。</p> </li></ul> 
<p><strong>与关系型数据库核心概念对比</strong></p> 
<table><thead><tr><th>Elasticsearch</th><th>关系型数据库（如Mysql）</th></tr></thead><tbody><tr><td>索引Index</td><td>数据库Database</td></tr><tr><td>类型Type（8.x版本已废弃）</td><td>表Table</td></tr><tr><td>文档Document</td><td>数据行Row</td></tr><tr><td>字段Field</td><td>数据列Column</td></tr><tr><td>映射Mapping</td><td>约束Schema</td></tr></tbody></table> 
<h3><a id="_112"></a>数据类型</h3> 
<hr> 
<p><strong>Elasticsearch 8.x</strong>中已经完全删除了数据类型，创建映射时也不再支持使用<code>type</code>字段指定数据类型，不然会报错<code>"index" is not a valid parameter. Allowed parameters are "create", "error_trace"</code></p> 
<p>这里就不继续介绍数据类型了</p> 
<h3><a id="_122"></a>安装和启动</h3> 
<hr> 
<h4><a id="Windows_126"></a>Windows</h4> 
<ul><li> <p>1.去官网<a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="nofollow">Download Elasticsearch | Elastic</a>下载windows版本压缩包，然后解压；</p> </li><li> <p>2.修改<code>config</code>目录下的<code>elasticsearch.yml</code>文件，将截图中的两个配置项<code>true</code>改为<code>false</code>，不然会报错<code>[WARN ][o.e.h.n.Netty4HttpServerTransport] [BF-202205061541] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel{localAddress=/[0:0:0:0:0:0:0:1]:9200, remoteAddress=/[0:0:0:0:0:0:0:1]:62134}</code></p> </li></ul> 
<p><img src="https://images2.imgbox.com/78/e7/OWW5ge43_o.png" alt=""></p> 
<ul><li> <p>3.双击<code>bin/elasticsearch.bat</code>脚本启动服务</p> </li><li> <p>4.打开浏览器访问<code>http://localhost:9200/</code>，输出下面的json信息表示启动成功</p> </li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"BF-202205061541"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"cluster_name"</span><span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"cluster_uuid"</span><span class="token operator">:</span> <span class="token string">"0JlZuKgbSWa3DGX44DnxgQ"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"number"</span><span class="token operator">:</span> <span class="token string">"8.12.2"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"build_flavor"</span><span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"build_type"</span><span class="token operator">:</span> <span class="token string">"zip"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"build_hash"</span><span class="token operator">:</span> <span class="token string">"48a287ab9497e852de30327444b0809e55d46466"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"build_date"</span><span class="token operator">:</span> <span class="token string">"2024-02-19T10:04:32.774273190Z"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"build_snapshot"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string-property property">"lucene_version"</span><span class="token operator">:</span> <span class="token string">"9.9.2"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"minimum_wire_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"7.17.0"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"minimum_index_compatibility_version"</span><span class="token operator">:</span> <span class="token string">"7.0.0"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"tagline"</span><span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Linux_162"></a>Linux</h4> 
<ul><li>1.下载压缩包</li></ul> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">wget</span> https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.8.1-linux-x86_64.tar.gz <span class="token comment"># 版本号自己选择</span>
</code></pre> 
<ul><li>2.解压</li></ul> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> elasticsearch-8.8.1-linux-x86_64.tar.gz
</code></pre> 
<ul><li> <p>3.关闭https和登录验证</p> <pre><code>vi ./elasticsearch-8.8.1/config/elasticsearch.yml
</code></pre> <p>在文件最后增加下面几行，然后保存</p> <pre><code>xpack.security.enabled: false
network.host: 0.0.0.0
http.port: 9200
transport.host: localhost
transport.port: 9300
</code></pre> </li><li> <p>4.创建用户</p> <p>elasticsearch不能用root账户运行，所以要单独创建一个用户</p> <pre><code class="prism language-bash"><span class="token function">sudo</span> adduser elasticsearch  <span class="token comment"># 创建elasticsearch用户</span>
</code></pre> </li><li> <p>5.将目录授权给elasticsearch用户</p> <pre><code class="prism language-bash"> <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> elasticsearch:elasticsearch ./elasticsearch-8.8.1
</code></pre> </li><li> <p>6.切换到elasticsearch用户</p> <pre><code class="prism language-bash"><span class="token function">su</span> elasticsearch
</code></pre> </li><li> <p>7.启动elasticsearch</p> <pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ./elasticsearch-8.8.1/bin/
./elasticsearch

<span class="token comment"># 后台运行</span>
./elasticsearch <span class="token parameter variable">-d</span>
<span class="token comment"># 停止运行,查看pid然后kill掉</span>
<span class="token function">ps</span> <span class="token parameter variable">-ef</span> <span class="token operator">|</span> <span class="token function">grep</span> elasticsearch
<span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token punctuation">[</span>pid<span class="token punctuation">]</span>
</code></pre> <p>访问<code>http://localhost:9200</code>即可</p> <pre><code class="prism language-json">jian@ubuntu<span class="token operator">:</span><span class="token operator">~</span>$ curl localhost<span class="token operator">:</span><span class="token number">9200</span>


<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"name"</span> <span class="token operator">:</span> <span class="token string">"ubuntu"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"cluster_name"</span> <span class="token operator">:</span> <span class="token string">"elasticsearch"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"cluster_uuid"</span> <span class="token operator">:</span> <span class="token string">"HMGfIwFoTJG7H-yHCym29A"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"number"</span> <span class="token operator">:</span> <span class="token string">"8.8.1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build_flavor"</span> <span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build_type"</span> <span class="token operator">:</span> <span class="token string">"tar"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build_hash"</span> <span class="token operator">:</span> <span class="token string">"f8edfccba429b6477927a7c1ce1bc6729521305e"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build_date"</span> <span class="token operator">:</span> <span class="token string">"2023-06-05T21:32:25.188464208Z"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build_snapshot"</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token string-property property">"lucene_version"</span> <span class="token operator">:</span> <span class="token string">"9.6.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"minimum_wire_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"7.17.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"minimum_index_compatibility_version"</span> <span class="token operator">:</span> <span class="token string">"7.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"tagline"</span> <span class="token operator">:</span> <span class="token string">"You Know, for Search"</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h4><a id="Docker_254"></a>Docker</h4> 
<ul><li> <p>1.拉取镜像</p> <pre><code class="prism language-bash"><span class="token function">docker</span> pull elasticsearch:8.8.1 <span class="token comment"># 版本号自己选择</span>
</code></pre> </li><li> <p>2.创建并启动容器，配置文件在容器的<code>/usr/share/elasticsearch/config/elasticsearch.yml</code>，需要映射配置文件的可以自行添加参数映射</p> <pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--name</span> elasticsearch <span class="token parameter variable">-p</span> <span class="token number">9200</span>:9200 <span class="token parameter variable">-p</span> <span class="token number">9300</span>:9300 <span class="token parameter variable">-d</span> elasticsearch:8.8.1
</code></pre> </li><li> <p>3.访问elasticsearch</p> <p>浏览器打开<code>https://192.168.204.128:9200</code>即可访问，需要输入账号和密码，注意这里是要https访问</p> </li><li> <p>4.关闭https和登录</p> <pre><code class="prism language-bash"> <span class="token comment"># 进入容器 -u 0表示用root账户</span>
 <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token parameter variable">-u</span> <span class="token number">0</span> elasticsearch <span class="token function">bash</span>
 
 <span class="token comment"># 安装vim</span>
 <span class="token function">apt</span> update
 <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span>
 
 <span class="token comment"># 编辑配置文件</span>
 <span class="token function">vi</span> /usr/share/elasticsearch/config/elasticsearch.yml
 
 <span class="token comment"># 找到 xpack.security.enabled: true 改为 xpack.security.enabled: false,然后按保存</span>
 xpack.security.enabled: <span class="token boolean">false</span>
 
 <span class="token comment"># 退出容器然后重启容器</span>
 <span class="token builtin class-name">exit</span>
 <span class="token function">docker</span> restart elasticsearch
</code></pre> <p>打开浏览器访问<code>http://localhost:9200</code>即可</p> </li></ul> 
<h3><a id="_301"></a>安装分词器</h3> 
<hr> 
<p>elasticsearch有默认的分词器，但是对中文不太友好，我们可以单独安装适用于中文的分词器ik；根据你的es版本再<a href="https://github.com/infinilabs/analysis-ik/releases">Releases · infinilabs/analysis-ik (github.com)</a>下载对应的压缩包，然后解压到es目录下的<code>plugins/ik</code>目录，然后重启es服务即可</p> 
<h3><a id="_311"></a>插件</h3> 
<hr> 
<h4><a id="esclient_315"></a>es-client（推荐）</h4> 
<p>elasticsearch的浏览插件，<a href="https://es-client.esion.xyz/" rel="nofollow">项目主页 | es-client (esion.xyz)</a>，提供各个浏览器插件，在插件市场都能搜得到，界面美观</p> 
<h4><a id="elasticsearchhead_321"></a>elasticsearch-head</h4> 
<h4><a id="elasticsearchhead_325"></a>elasticsearch-head</h4> 
<p>elasticsearch-head是一种便捷查询操作elasticsearch库的可视化工具，具备集群管理、增删查改等功能，用于监控 Elasticsearch 状态的客户端插件，包括数据可视化、执行增删改查操作等，有npm、docker和浏览器扩展版本（仅Chrome浏览器），按照下面文档选择自己喜欢的方式安装即可</p> 
<p><a href="https://github.com/mobz/elasticsearch-head">mobz/elasticsearch-head: A web front end for an elastic search cluster (github.com)</a></p> 
<h3><a id="php_335"></a>php调用</h3> 
<hr> 
<p>由于实际开发中项目都是使用php框架开发，所以以下分别用ThinkPHP5和Laravel框架实现</p> 
<h4><a id="ThinkPHP_343"></a>ThinkPHP框架</h4> 
<ul><li>安装扩展</li></ul> 
<pre><code>composer require elasticsearch/elasticsearch
composer dump-autoload
</code></pre> 
<ul><li> <p>索引和文档的增删改查</p> <pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">app<span class="token punctuation">\</span>index<span class="token punctuation">\</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Elasticsearch<span class="token punctuation">\</span>ClientBuilder</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Elasticsearch</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 客户端</span>
    <span class="token keyword">protected</span> <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span>
    <span class="token comment">//索引名称</span>
    <span class="token keyword">protected</span> <span class="token variable">$indexName</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span> <span class="token operator">=</span> <span class="token class-name static-context">ClientBuilder</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setHosts</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'127.0.0.1:9200'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 创建索引
     * @desc 相当于mysql的数据库，索引只需要创建一次
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'body'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'settings'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'number_of_shards'</span> <span class="token operator">=&gt;</span> <span class="token number">5</span><span class="token punctuation">,</span>    <span class="token comment">//分片数量：一个索引库将拆分成多片分别存储不同的结点，默认5个</span>
                    <span class="token string single-quoted-string">'number_of_replicas'</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>   <span class="token comment">//为每个分片分配的副本数，replica shard是primary shard的副本，负责容错，以及承担读请求负载，如果服务器只有一台，只能设置为0，不然会报错创建超时failed to process cluster event (create-index [test], cause [api]) within 30s</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>

                <span class="token comment">//创建文档映射，就是文档存储在ES中的数据结构，这里以商城商品搜索为例，建立商品的映射</span>
                <span class="token string single-quoted-string">'mappings'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'properties'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'goods_id'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//商品id</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'keyword'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'goods_name'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//商品名称</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//数据类型为text，支持分词;类型为keyword，不支持分词,只能精确索引;8.x以上版本不再支持string等类型</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span> <span class="token comment">//字段可以被索引，也就是能用来当做查询条件来查询，只能填写true和false</span>
                            <span class="token string single-quoted-string">'analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_max_word'</span><span class="token punctuation">,</span> <span class="token comment">//索引分词器，用于字符串类型，这里使用中文分词器ik，用默认分词器可以省略</span>
                            <span class="token string single-quoted-string">'search_analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_smart'</span><span class="token comment">//搜索分词器，用于搜索关键词的分词器</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'goods_desc'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//商品描述</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'keyword'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'false'</span><span class="token punctuation">,</span> <span class="token comment">//字段不可以被索引，不能用来当做查询条件来查询</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'stock'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//商品库存</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'keyword'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'created_at'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//创建时间</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'keyword'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//上架状态</span>
                            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'keyword'</span><span class="token punctuation">,</span>
                            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除索引
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">deleteIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查看映射
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">getMapping</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 新增文档
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">addDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//文档id，可省略，默认生成随机id</span>
            <span class="token string single-quoted-string">'body'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'goods_id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//商品id</span>
                <span class="token string single-quoted-string">'goods_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'爆款煎饼（传统双蛋煎饼+肉松+优质火腿片+配菜+薄脆）'</span><span class="token punctuation">,</span> <span class="token comment">//商品名称</span>
                <span class="token string single-quoted-string">'goods_desc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'煎饼果子'</span><span class="token punctuation">,</span> <span class="token comment">//商品描述</span>
                <span class="token string single-quoted-string">'stock'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">//库存</span>
                <span class="token string single-quoted-string">'created_at'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'2019-06-01 00:00:00'</span><span class="token punctuation">,</span> <span class="token comment">//创建时间</span>
                <span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//上架状态</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取文档
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//文档id</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 更新文档
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">updateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//文档id</span>
            <span class="token string single-quoted-string">'body'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'doc'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'goods_name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'爆款煎饼（传统双蛋煎饼+肉松+优质火腿片+配菜+薄脆）'</span><span class="token punctuation">,</span> <span class="token comment">//更新商品名称</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除文档
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">deleteDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">//文档id</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 查询文档
     *
     * 查询条件
     * must（且）：数组里面的条件都要满足，该条数据才被选择，所有的条件为且的关系
     * must_not（或，然后取反）：数组里面的条件满足其中一个，该条数据则不被选择
     * should（或）：数组里面的条件满足其中一个，该条数据被选择
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">searchDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$keywords</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'火腿煎饼'</span><span class="token punctuation">;</span> <span class="token comment">// 查询关键词</span>
        <span class="token variable">$params</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">indexName</span><span class="token punctuation">,</span> <span class="token comment">// 索引名称</span>
            <span class="token string single-quoted-string">'body'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'query'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'bool'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'should'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span> <span class="token comment">//should:模糊查询(or)；must:精确查询(and)；must_not:or取反；</span>
                            <span class="token string single-quoted-string">'match'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'goods_name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$keywords</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//match：匹配字段；range：范围查询</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'sort'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'stock'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'order'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'desc'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 排序</span>
                <span class="token string single-quoted-string">'from'</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 分页起始位置</span>
                <span class="token string single-quoted-string">'size'</span> <span class="token operator">=&gt;</span> <span class="token number">10</span>  <span class="token comment">// 分页记录数量</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">client</span><span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token variable">$params</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant">JSON_UNESCAPED_UNICODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-&gt;</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//test</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
<span class="token comment">//        $res = 123;</span>
<span class="token comment">//        $res = $this-&gt;deleteIndex();</span>
<span class="token comment">//        $res = $this-&gt;createIndex();</span>
<span class="token comment">//        $res = $this-&gt;getMapping();</span>
<span class="token comment">//        $res = $this-&gt;addDoc();</span>
<span class="token comment">//        $res = $this-&gt;getDoc();</span>
<span class="token comment">//        $res = $this-&gt;updateDoc();</span>
<span class="token comment">//        $res = $this-&gt;deleteDoc();</span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">searchDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<h4><a id="Laravel_601"></a>Laravel框架</h4> 
<h5><a id="_603"></a>方式一</h5> 
<p>参考上面的ThinkPHP框架调用</p> 
<h5><a id="_609"></a>方式二</h5> 
<p>Laravel框架除了能像tp框架一样自己写es的功能，它还有专门的es扩展包，并且支持在model中使用es及导入数据</p> 
<ul><li> <p>安装扩展包</p> <pre><code class="prism language-shell"><span class="token function">composer</span> require elasticsearch/elasticsearch
<span class="token function">composer</span> require tamayo/laravel-scout-elastic
<span class="token function">composer</span> require laravel/scout
</code></pre> </li><li> <p>发布配置</p> <pre><code class="prism language-shell">php artisan vendor:publish <span class="token parameter variable">--provider</span><span class="token operator">=</span><span class="token string">"Laravel\Scout\ScoutServiceProvider"</span>
</code></pre> </li><li> <p>修改配置</p> <p>修改<code>config/scout.php</code>文件的配置，将驱动<code>'driver' =&gt; env('SCOUT_DRIVER', 'algolia')</code>改为<code>'driver' =&gt; env('SCOUT_DRIVER', 'elastic')</code></p> <p>然后最文件增加elasticsearch配置</p> <pre><code class="prism language-php"><span class="token comment">/*
|--------------------------------------------------------------------------
| Elasticsearch Configuration
|--------------------------------------------------------------------------
|
| Here you may configure your Elasticsearch settings.
|
*/</span>
<span class="token string single-quoted-string">'elasticsearch'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ELASTICSEARCH_INDEX'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'laravel'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">//laravel就是索引的名字，可以根据你的需求随便起</span>
        <span class="token string single-quoted-string">'hosts'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token function">env</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ELASTICSEARCH_HOST'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'http://127.0.0.1:9200'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <p>当然，你可以在<code>.env</code>环境配置文件中覆盖配置</p> <pre><code>ELASTICSEARCH_HOST=127.0.0.1:9200
</code></pre> </li><li> <p>使用es</p> <pre><code class="prism language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'scout.elasticsearch.hosts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$index</span> <span class="token operator">=</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'scout.elasticsearch.index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$client</span> <span class="token operator">=</span> <span class="token class-name static-context">ClientBuilder</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">setHosts</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Index <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$index</span><span class="token punctuation">}</span></span> exists, deleting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Creating index: <span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token variable">$index</span><span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$client</span><span class="token operator">-&gt;</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'index'</span> <span class="token operator">=&gt;</span> <span class="token variable">$index</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'body'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'settings'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'number_of_shards'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'number_of_replicas'</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mappings'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                <span class="token string single-quoted-string">'_source'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'enabled'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string single-quoted-string">'properties'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                    <span class="token string single-quoted-string">'id'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'long'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_max_word'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'search_analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_smart'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'subtitle'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_max_word'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'search_analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_smart'</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
                        <span class="token string single-quoted-string">'type'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_max_word'</span><span class="token punctuation">,</span>
                        <span class="token string single-quoted-string">'search_analyzer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'ik_smart'</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>Model中使用</p> <p>参考官方文档<a href="https://learnku.com/docs/laravel/6.x/scout/5191#6b599a" rel="nofollow">Scout 全文搜索 | 官方扩展包 |《Laravel 6 中文文档 6.x》| Laravel China 社区 (learnku.com)</a></p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5256848274c2fcd9231b2831e4fddf6e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2024最新GPT4.0使用教程，AI绘画，一站式解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fd167d081b05a33256e2d351eacb5cf9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Midjourney角色一致性功能使用方法教程(附今日提示词）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>