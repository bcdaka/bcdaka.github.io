<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《图解设计模式》笔记（三）生成实例 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/61dd795e84d24a2e3eb5546662be8921/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="《图解设计模式》笔记（三）生成实例">
  <meta property="og:description" content="五、Singleton模式：只有一个实例 Singleton 是指只含有一个元素的集合。因为本模式只能生成一个实例，因此以 Singleton命名。
示例程序类图 Singleton.java
public class Singleton { private static Singleton singleton = new Singleton(); private Singleton() { System.out.println(&#34;生成了一个实例。&#34;); } public static Singleton getInstance() { return singleton; } } Main.java
public class Main { public static void main(String[] args) { System.out.println(&#34;Start.&#34;); Singleton obj1 = Singleton.getInstance(); Singleton obj2 = Singleton.getInstance(); if (obj1 == obj2) { System.out.println(&#34;obj1与obj2是相同的实例。&#34;); } else { System.out.println(&#34;obj1与obj2是不同的实例。&#34;); } System.out.println(&#34;End.&#34;); } } 运行结果
Start.
生成了一个实例。
obj1与obj2是相同的实例。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-20T15:14:46+08:00">
    <meta property="article:modified_time" content="2024-08-20T15:14:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《图解设计模式》笔记（三）生成实例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Singleton_0"></a>五、Singleton模式：只有一个实例</h2> 
<p>Singleton 是指只含有一个元素的集合。因为本模式只能生成一个实例，因此以 Singleton命名。</p> 
<h3><a id="_4"></a>示例程序类图</h3> 
<p><img src="https://images2.imgbox.com/23/38/00Kwlmhg_o.png" alt="请添加图片描述"></p> 
<p>Singleton.java</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"生成了一个实例。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Main.java</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Start."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Singleton</span> obj1 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Singleton</span> obj2 <span class="token operator">=</span> <span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1 <span class="token operator">==</span> obj2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj1与obj2是相同的实例。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj1与obj2是不同的实例。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"End."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果</p> 
<blockquote> 
 <p>Start.<br> 生成了一个实例。<br> obj1与obj2是相同的实例。<br> End.</p> 
</blockquote> 
<h3><a id="_50"></a>扩展思路的要点</h3> 
<h4><a id="_52"></a>何时生成这个唯一的实例</h4> 
<p>注意示例程序的运行结果，在【Start.】之后就显示出了【生成了一个实例。】</p> 
<p>程序运行后，在第一次调用 getInstance方法时，Singleton类会被初始化。也就是在这个时候，static字段singleton被初始化，生成了唯一的一个实例。</p> 
<h3><a id="_58"></a>相关的设计模式</h3> 
<p>在以下模式中，多数情况下只会生成一个实例。</p> 
<p>AbstractFactory 模式（第8章）</p> 
<p>Builder 模式（第7章）</p> 
<p>Facade 模式（第15章）</p> 
<p>Prototype 模式（第6章）</p> 
<h2><a id="Prototype_70"></a>六、Prototype模式：通过复制生成实例</h2> 
<p>Prototype模式：不根据类来生成实例（不使用 new ClassName() 的形式），而是根据实例来生成新实例</p> 
<p>Prototype有“原型”“模型”的意思。在设计模式中，它是指根据实例原型、实例模型来生成新的实例。</p> 
<p>Java可以使用clone创建出实例的副本。本章将学习clone方法与Cloneable接口的使用方法。</p> 
<h3><a id="_78"></a>示例程序类图</h3> 
<p><img src="https://images2.imgbox.com/5e/18/A1SVwmN6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Manager_83"></a>Manager类</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">framework</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">HashMap</span> showcase <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Product</span> proto<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        showcase<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> protoname<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">)</span> showcase<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>protoname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">createClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Product_104"></a>Product接口</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">framework</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Cloneable</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Product</span> <span class="token keyword">extends</span> <span class="token class-name">Cloneable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Product</span> <span class="token function">createClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="MessageBox_118"></a>MessageBox类</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">framework<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageBox</span> <span class="token keyword">implements</span> <span class="token class-name">Product</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">char</span> decochar<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token keyword">char</span> decochar<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>decochar <span class="token operator">=</span> decochar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑：把传入的s用decochar包围打印</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">createClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">)</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="UnderlinePen_146"></a>UnderlinePen类</h4> 
<p>与MessageBox几乎相同，use()方法中对s进行加下划线打印</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">framework<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnderlinePen</span> <span class="token keyword">implements</span> <span class="token class-name">Product</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">char</span> ulchar<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UnderlinePen</span><span class="token punctuation">(</span><span class="token keyword">char</span> ulchar<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ulchar <span class="token operator">=</span> ulchar<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑：把传入的s用decochar加下划线打印</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Product</span> <span class="token function">createClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Product</span> p <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Product</span><span class="token punctuation">)</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">CloneNotSupportedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Main_176"></a>Main测试类</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">framework<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 准备</span>
        <span class="token class-name">Manager</span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UnderlinePen</span> upen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnderlinePen</span><span class="token punctuation">(</span><span class="token char">'~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MessageBox</span> mbox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token char">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MessageBox</span> sbox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageBox</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"strong message"</span><span class="token punctuation">,</span> upen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"warning box"</span><span class="token punctuation">,</span> mbox<span class="token punctuation">)</span><span class="token punctuation">;</span>
        manager<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"slash box"</span><span class="token punctuation">,</span> sbox<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 生成</span>
        <span class="token class-name">Product</span> p1 <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"strong message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p1<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"Hello, world."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Product</span> p2 <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"warning box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p2<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"Hello, world."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Product</span> p3 <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"slash box"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p3<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"Hello, world."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_203"></a>运行结果</h3> 
<p><img src="https://images2.imgbox.com/4b/d0/d6GZ6m3V_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_208"></a>角色</h3> 
<p><img src="https://images2.imgbox.com/1d/13/eIc95SJp_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>Prototype（原型）</p> <p>负责定义用于复制现有实例来生成新实例的方法。在示例程序中，由<code>Product</code>接口扮演此角色。</p> </li><li> <p>ConcretePrototype（具体的原型）</p> <p>负责实现复制现有实例并生成新实例的方法。在示例程序中，由<code>MessageBox</code>类和<code>UnderlinePen</code>类扮演此角色。</p> </li><li> <p>Client（使用者）</p> <p>负责使用复制实例的方法生成新的实例。在示例程序中，由<code>Manager</code>类扮演此角色。</p> </li></ul> 
<h3><a id="_226"></a>扩展思路的要点</h3> 
<h5><a id="_228"></a>不能根据类来生成实例吗</h5> 
<p>根据类生成实例：new Something()</p> 
<p>不根据类生成实例的场景：</p> 
<ol><li><u>对象种类繁多，无法将它们整合到一个类中时</u></li></ol> 
<p>示例程序中，一共出现了3种对字符串处理的样式。但只要想做，能支持更多样式。</p> 
<p>但若将每种样式都编写为一个类，类的数量将太多，较难管理源程序。</p> 
<ol start="2"><li><u>难以根据类生成实例时</u></li></ol> 
<p>本例中感觉不到这一点。试想若要开发一个用户可以使用鼠标进行操作的、类似于图形编辑器的应用程序，可能更容易理解。</p> 
<p>假设我们想生成一个和用户通过一系列鼠标操作所创建出来的实例完全一样的实例，此时，与根据类来生成实例相比，根据实例来生成实例要更简单。</p> 
<ol start="3"><li><u>想解耦框架与生成的实例时</u></li></ol> 
<p>在示例程序中，我们将复制(clone)实例的部分封装在 framework包中了。</p> 
<p>在Manager类的create方法中，没使用类名，取而代之使用了<code>strong message</code>和<code>slash box</code>等字符串为生成的实例命名。</p> 
<p>与Java自带的生成实例的<code>new Something()</code>方式相比，这种方式具有更好的通用性，而且将框架从类名的束缚中解脱出来了。</p> 
<h5><a id="_255"></a>类名是束缚吗</h5> 
<p>在源程序中使用类名到底会有什么问题？在代码中出现要使用的类的名字不是理所当然的吗？</p> 
<p>再回忆一下面向对象编程的目标之一：<strong>作为组件复用</strong>。</p> 
<p>一旦在代码中出现要使用的类的名字，就无法与该类分离开来，也就无法实现复用。</p> 
<p>虽然可以通过替换源代码或改变类名来解决这个问题。但此处说的“作为组件复用”不包含替换源代码。</p> 
<p>以Java来说，重要的是当手边只有class文件(.class)时，该类能否被复用。即使没有Java文件(.java)也能复用该类才是关键。</p> 
<p>当多个类必须紧密结合时，代码中出现这些类的名字没问题。但若那些需要被独立出来作为组件复用的类的名字出现在代码中，那就有问题了。</p> 
<h3><a id="_269"></a>相关的设计模式</h3> 
<h4><a id="Flyweight_20_271"></a>Flyweight 模式（第20章）</h4> 
<p>Prototype 模式可以生成一个与当前实例的状态完全相同的实例。</p> 
<p>Flyweight 模式可以在不同的地方使用同一个实例。</p> 
<h4><a id="Memento_18_277"></a>Memento 模式（第18章）</h4> 
<p>Prototype 模式可以生成一个与当前实例的状态完全相同的实例。</p> 
<p>Memento 模式可以保存当前实例的状态，以实现快照和撤销功能。</p> 
<h3><a id="Composite_11Decorator12_283"></a>Composite 模式（第11章）以及Decorator模式（第12章）</h3> 
<p>经常使用Composite模式和Decorator模式时，需要能够动态地创建复杂结构的实例。这时可以使用 Prototype模式，以帮助我们方便地生成实例。</p> 
<h3><a id="Command_22_287"></a>Command 模式（第22章）</h3> 
<p>想要复制Command 模式中出现的命令时，可以使用 Prototype模式。</p> 
<h3><a id="Clone_291"></a>补充：Clone注意事项</h3> 
<p>clone方法所进行的复制只是将被复制实例的字段值直接复制到新的实例中，即它没考虑字段中所保存的实例的内容。</p> 
<p>例如，当字段中保存的是数组时，如果使用clone方法进行复制，则只会复制该数组的引用，并不会一一复制数组中的元素。</p> 
<p>像上面这样的字段对字段的复制（field-to-field-copy）被称为浅复制（shallow copy）。clone方法所进行的复制就是浅复制。</p> 
<p>当使用clone方法进行浅复制无法满足需求时，可以重写 clone方法，实现自己需要的复制功能（重写clone方法时，别忘了使用<code>super.clone()</code>来调用父类的clone方法)。</p> 
<p>clone方法只进行复制，不会调用被复制实例的构造函数。</p> 
<p>对于在生成实例时需要进行特殊的初始化处理的类，需要自己去实现clone方法，在其内部进行这些初始化处理。</p> 
<h2><a id="Builder_305"></a>七、Builder模式：组装复杂的实例</h2> 
<h3><a id="_307"></a>示例程序类图</h3> 
<p><img src="https://images2.imgbox.com/62/40/Tx1kBCn4_o.png" alt="在这里插入图片描述"></p> 
<p>注意：此案例中Builder是抽象类，但也可以用interface来实现这个模式。</p> 
<h4><a id="Director_314"></a>Director类</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Builder</span> builder<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token class-name">Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 接收的参数是Builder类的子类，所以可以将其保存在builder字段中</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>builder <span class="token operator">=</span> builder<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 编写文档</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 标题、字符串、条目</span>
        builder<span class="token punctuation">.</span><span class="token function">makeTitle</span><span class="token punctuation">(</span><span class="token string">"Greeting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">makeString</span><span class="token punctuation">(</span><span class="token string">"从早上至下午"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">makeItems</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">"早上好。"</span><span class="token punctuation">,</span> <span class="token string">"下午好。"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 其他字符串、其他条目</span>
        builder<span class="token punctuation">.</span><span class="token function">makeString</span><span class="token punctuation">(</span><span class="token string">"晚上"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">makeItems</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">"晚上好。"</span><span class="token punctuation">,</span> <span class="token string">"晚安。"</span><span class="token punctuation">,</span> <span class="token string">"再见。"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 完成文档</span>
        builder<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="TextBuilder_340"></a>TextBuilder类</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TextBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 文档内容保存在该字段中</span>
    <span class="token keyword">private</span> <span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 纯文本的标题</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑：buffer.append 装饰线、为标题添加『』、换行</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 纯文本的字符串</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeString</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑：buffer.append 为字符串添加■、换行</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 纯文本的条目</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeItems</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 业务逻辑：buffer.append 为条目添加・、换行</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 完成文档 添加装饰线</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"==============================\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 完成的文档</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                 
        <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="HTMLBuilder_374"></a>HTMLBuilder类</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HTMLBuilder</span> <span class="token keyword">extends</span> <span class="token class-name">Builder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> filename<span class="token punctuation">;</span>                                                        <span class="token comment">// 文件名</span>
    <span class="token keyword">private</span> <span class="token class-name">PrintWriter</span> writer<span class="token punctuation">;</span>                                                     <span class="token comment">// 用于编写文件的PrintWriter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeTitle</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                           <span class="token comment">// HTML文件的标题</span>
        filename <span class="token operator">=</span> title <span class="token operator">+</span> <span class="token string">".html"</span><span class="token punctuation">;</span>                                                 <span class="token comment">// 将标题作为文件名</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">// 生成 PrintWriter</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;"</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">"&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出标题</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;"</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">"&lt;/h1&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeString</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                            <span class="token comment">// HTML文件中的字符串</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;p&gt;"</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">"&lt;/p&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">// 用&lt;p&gt;标签输出</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">makeItems</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                         <span class="token comment">// HTML文件中的条目</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;ul&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                     <span class="token comment">// 用&lt;ul&gt;和&lt;li&gt;输出</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;li&gt;"</span> <span class="token operator">+</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"&lt;/li&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/ul&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                                           <span class="token comment">// 完成文档</span>
        writer<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/body&gt;&lt;/html&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                           <span class="token comment">// 关闭标签</span>
        writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                             <span class="token comment">// 关闭文件</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                                                     <span class="token comment">// 编写完成的文档</span>
        <span class="token keyword">return</span> filename<span class="token punctuation">;</span>                                                            <span class="token comment">// 返回文件名</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Main_412"></a>Main测试类</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"plain"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">TextBuilder</span> textbuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Director</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span>textbuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> result <span class="token operator">=</span> textbuilder<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">HTMLBuilder</span> htmlbuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTMLBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Director</span> director <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span>htmlbuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            director<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> filename <span class="token operator">=</span> htmlbuilder<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>filename <span class="token operator">+</span> <span class="token string">"文件编写完成。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Usage: java Main plain      编写纯文本文档"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Usage: java Main html       编写HTML文档"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_446"></a>角色</h3> 
<p><img src="https://images2.imgbox.com/31/97/TdsI4o0A_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>Builder（建造者）</p> <p>负责定义用于生成实例的接口(API)。Builder角色中准备了用于生成实例的方法。在示例程序中，由Builder类扮演此角色。</p> </li><li> <p>ConcreteBuilder（具体的建造者）</p> <p>是负责实现 Builder角色的接口的类(API)，定义了在生成实例时实际被调用的方法、获取最终生成结果的方法。</p> <p>在示例程序中，由TextBuilder类和HTMLBuilder类扮演此角色。</p> </li><li> <p>Director（监工）</p> <p>负责使用Builder角色的接口(API)来生成实例。它并不依赖于ConcreteBuilder角色。</p> <p>为了确保不论ConcreteBuilder角色是如何被定义的，Director角色都能正常工作，它只调用在Builder角色中被定义的方法。</p> <p>在示例程序中，由Director类扮演此角色。</p> </li><li> <p>Client（使用者）</p> <p>该角色使用了Builder模式（Builder模式并不包含Client角色）。</p> <p>在示例程序中，由Main类扮演此角色。</p> </li></ul> 
<h3><a id="_476"></a>相关的设计模式</h3> 
<h4><a id="Template_Method3_478"></a>Template Method模式（第3章）</h4> 
<p>Builder模式：Director角色控制Builder角色。</p> 
<p>Template Method模式：父类控制子类。</p> 
<h4><a id="Composite_11_484"></a>Composite 模式（第11章）</h4> 
<p>有些情况下 Builder模式生成的实例构成了Composite模式。</p> 
<h4><a id="Abstract_Factory8_488"></a>Abstract Factory模式（第8章）</h4> 
<p>Builder模式和Abstract Factory模式都用于生成复杂的实例。</p> 
<h4><a id="Facade15_492"></a>Facade模式（第15章）</h4> 
<p>在 Builder模式中，Director角色通过组合 Builder角色中的复杂方法向外部提供可以简单生成实例的接口(API)(相当于示例程序中的construct方法)。</p> 
<p>Facade模式中的 Facade角色则是通过组合内部模块向外部提供可以简单调用的接口(API)。</p> 
<h3><a id="_498"></a>扩展思路的要点</h3> 
<h4><a id="_500"></a>谁知道什么</h4> 
<p>Director类不知道自己使用的究竟是Builder类的哪个子类也好。因为“只有不知道子类才能替换”。</p> 
<p>正是因为可以替换，组件才具有高价值。作为设计人员，我们必须时刻关注这种“可替换性”。</p> 
<h4><a id="_506"></a>设计时能够决定的事情和不能决定的事情</h4> 
<p>在Builder类中，需要声明编辑文档（实现功能）所必需的所有方法，在Builder类中应当定义哪些方法很重要。</p> 
<p>而且，Builder类还必须能够应对将来子类可能增加的需求，若将来要新编写一种文档类型的子类实现，是否需要新的方法？</p> 
<p>虽然类的设计者无法准确地预测到将来可能发生的变化，但还是有必要让设计出的类能够尽可能灵活地应对近期可能发生的变化。</p> 
<h4><a id="_514"></a>代码的阅读方法和修改方法</h4> 
<p>如果没有理解各个类的角色就动手增加和修改代码，在判断到底应该修改哪个类时，就会很容易出错。</p> 
<h2><a id="Abstract_Factory_518"></a>八、Abstract Factory模式：将关联零件组装成产品</h2> 
<p>在 Abstract Factory模式中，不仅有“抽象工厂”，还有“抽象零件”和“抽象产品”。抽象工厂的工作是将“抽象零件”组装为“抽象产品”。</p> 
<p>回顾面向对象编程中的“抽象”这个词的具体含义：它指的是“不考虑具体怎样实现，而是仅关注接口(API)"的状态。</p> 
<p>例如，抽象方法(Abstract Method)并不定义方法的具体实现，而是仅仅只确定了方法的名字和签名(参数的类型和个数)。</p> 
<p>我们不关心零件的具体实现，而只关心接口(API)，仅使用该接口(API)将零件组装成为产品。</p> 
<p>在 Tempate Method模式和Builder模式中，子类这一层负责方法的具体实现。</p> 
<p>在 AbstractFactory模式中也是一样的。在子类这一层中有具体的工厂，它负责将具体的零件组装成为具体的产品。</p> 
<p>本章中的示例程序的功能是将带有层次关系的链接的集合制作成HTML文件。</p> 
<h3><a id="_534"></a>示例程序类图</h3> 
<p><img src="https://images2.imgbox.com/57/d4/tKMlhh9M_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="factory___539"></a>factory包 - 抽象</h4> 
<h5><a id="Item_541"></a>Item</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">factory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Item</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> caption<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Item</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>caption <span class="token operator">=</span> caption<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Link_555"></a>Link</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">factory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Link</span> <span class="token keyword">extends</span> <span class="token class-name">Item</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> url<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Link</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> url<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Tray_569"></a>Tray</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Tray</span> <span class="token keyword">extends</span> <span class="token class-name">Item</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">ArrayList</span> tray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将Link类和Tray类集合在一起。为表示集合的对象是“Link类和Tray类”，我们设置add方法的参数为Link类和Tray类的父类Item类。</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Item</span> item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        tray<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Page_590"></a>Page</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">ArrayList</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> author<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 向页面中增加Item(即Link或Tray)。增加的Item将会在页面中显示出来。</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Item</span> item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        content<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// output方法是一个简单的 Template Method模式 的方法。</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 首先 根据页面标题确定文件名</span>
            <span class="token class-name">String</span> filename <span class="token operator">=</span> title <span class="token operator">+</span> <span class="token string">".html"</span><span class="token punctuation">;</span>
            <span class="token class-name">Writer</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 然后 调用makeHTML抽象方法将自身保存的HTML内容写入到文件中。</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>filename <span class="token operator">+</span> <span class="token string">" 编写完成。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Factory_632"></a>Factory</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">factory</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 虽然getFactory方法生成的是具体工厂的实例，但是返回值的类型是抽象工厂类型</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Factory</span> <span class="token function">getFactory</span><span class="token punctuation">(</span><span class="token class-name">String</span> classname<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Factory</span> factory <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 根据 类名字符串 生成具体工厂的实例。</span>
            factory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Factory</span><span class="token punctuation">)</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>classname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"没有找到 "</span> <span class="token operator">+</span> classname <span class="token operator">+</span> <span class="token string">"类。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// createLink、createTray、createPage等方法 是用于在抽象工厂中生成零件和产品的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Link</span> <span class="token function">createLink</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Tray</span> <span class="token function">createTray</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Page</span> <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> author<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="listfactory___662"></a>listfactory - 具体</h4> 
<h5><a id="ListFactory_664"></a>ListFactory</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">listfactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListFactory</span> <span class="token keyword">extends</span> <span class="token class-name">Factory</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 各个方法内部只是分别简单地new出了对应类的实例(根据实际需求，这里可能需要用 Prototype模式来进行clone)</span>
    <span class="token keyword">public</span> <span class="token class-name">Link</span> <span class="token function">createLink</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ListLink</span><span class="token punctuation">(</span>caption<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Tray</span> <span class="token function">createTray</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ListTray</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span> <span class="token function">createPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ListPage</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="ListLink_684"></a>ListLink</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">listfactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListLink</span> <span class="token keyword">extends</span> <span class="token class-name">Link</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">ListLink</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>caption<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"  &lt;li&gt;&lt;a href=\""</span> <span class="token operator">+</span> url <span class="token operator">+</span> <span class="token string">"\"&gt;"</span> <span class="token operator">+</span> caption <span class="token operator">+</span> <span class="token string">"&lt;/a&gt;&lt;/li&gt;\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="ListTray_700"></a>ListTray</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">listfactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListTray</span> <span class="token keyword">extends</span> <span class="token class-name">Tray</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">ListTray</span><span class="token punctuation">(</span><span class="token class-name">String</span> caption<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>caption<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;li&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>caption <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;ul&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span> it <span class="token operator">=</span> tray<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">)</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 这里并不关心变量item中保存的实例究竟是ListLink的实例还是ListTray的实例，只是简单地调用了item.makeHTML()语句而已。</span>
            <span class="token comment">// 同时这里不能使用 switch语句或if语句去判断变量item中保存的实例的类型，否则就不是面向对象编程了。</span>
            buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;/ul&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;/li&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="ListPage_733"></a>ListPage</h5> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">listfactory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListPage</span> <span class="token keyword">extends</span> <span class="token class-name">Page</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">ListPage</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> author<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">StringBuffer</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;"</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">"&lt;/title&gt;&lt;/head&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;body&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;"</span> <span class="token operator">+</span> title <span class="token operator">+</span> <span class="token string">"&lt;/h1&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;ul&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// content继承自Page类的字段。</span>
        <span class="token class-name">Iterator</span> it <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">)</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">makeHTML</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        buffer<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;/ul&gt;\n"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;hr&gt;&lt;address&gt;"</span> <span class="token operator">+</span> author <span class="token operator">+</span> <span class="token string">"&lt;/address&gt;"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"&lt;/body&gt;&lt;/html&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Main_767"></a>Main</h4> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">factory<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Usage: java Main class.name.of.ConcreteFactory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Example 1: java Main listfactory.ListFactory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Example 2: java Main tablefactory.TableFactory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Factory</span> factory <span class="token operator">=</span> <span class="token class-name">Factory</span><span class="token punctuation">.</span><span class="token function">getFactory</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Link</span> people <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"人民日报"</span><span class="token punctuation">,</span> <span class="token string">"http://www.people.com.cn/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Link</span> gmw <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"光明日报"</span><span class="token punctuation">,</span> <span class="token string">"http://www.gmw.cn/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Link</span> us_yahoo <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"Yahoo!"</span><span class="token punctuation">,</span> <span class="token string">"http://www.yahoo.com/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Link</span> jp_yahoo <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"Yahoo!Japan"</span><span class="token punctuation">,</span> <span class="token string">"http://www.yahoo.co.jp/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Link</span> excite <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"Excite"</span><span class="token punctuation">,</span> <span class="token string">"http://www.excite.com/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Link</span> google <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLink</span><span class="token punctuation">(</span><span class="token string">"Google"</span><span class="token punctuation">,</span> <span class="token string">"http://www.google.com/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Tray</span> traynews <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createTray</span><span class="token punctuation">(</span><span class="token string">"日报"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        traynews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
        traynews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>gmw<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Tray</span> trayyahoo <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createTray</span><span class="token punctuation">(</span><span class="token string">"Yahoo!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        trayyahoo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>us_yahoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        trayyahoo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp_yahoo<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Tray</span> traysearch <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createTray</span><span class="token punctuation">(</span><span class="token string">"检索引擎"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        traysearch<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>trayyahoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        traysearch<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>excite<span class="token punctuation">)</span><span class="token punctuation">;</span>
        traysearch<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>google<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Page</span> page <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createPage</span><span class="token punctuation">(</span><span class="token string">"LinkPage"</span><span class="token punctuation">,</span> <span class="token string">"杨文轩"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>traynews<span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>traysearch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        page<span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_811"></a>为示例程序增加其他工厂</h4> 
<p>当只有一个具体工厂的时候，没有必要划分“抽象类”与“具体类”。</p> 
<p>可以为示例程序增加其他的具体工厂，比如编写含有表格的HTML格式的文件。</p> 
<p>之前的listfactory包的功能是将超链接以条目形式展示出来，</p> 
<p>现在可以新建tablefactory包，在其下编写其他工厂将链接以表格形式展示出来：</p> 
<p>新增TableFactory、TableLink、TableTray、TablePage，内容与listfactory包下对应的类相似，只是在编写html具体内容时有些要改为<code>table</code>标签之类的。</p> 
<h3><a id="_823"></a>角色</h3> 
<p><img src="https://images2.imgbox.com/f9/f4/pltWzVOE_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>AbstractProduct（抽象产品）</p> <p>定义 AbstractFactory 角色所生成的抽象零件和产品的接口(API)。</p> <p>示例中是 Link类、Tray类、Page类</p> </li><li> <p>AbstractFactory（抽象工厂）</p> <p>定义用于生成抽象产品的接口(API)。</p> <p>示例中是 Factory类</p> </li><li> <p>Client（委托者）</p> <p>仅会调用 AbstractFactory角色和AbstractProduct 角色的接口(API)来进行工作，不知道具体的零件、产品、工厂。</p> <p>示例中是 Main类，上图省略了这一角色。</p> </li><li> <p>ConcreteProduct（具体产品）</p> <p>实现AbstractProduct 角色的接口(API)。</p> <p>示例中是以下</p> <p>listfactory包：ListLink类、ListTray类、ListPage类</p> <p>tablefactory包：TableLink类、TableTray类、TablePage类</p> </li><li> <p>ConcreteFactory（具体工厂）</p> <p>实现AbstractFactory角色的接口(API)。</p> <p>示例中是以下</p> <p>listfactory包：Listfactory类</p> <p>tablefactory包：Tablefactory类</p> </li></ul> 
<h3><a id="_867"></a>拓展思路的要点</h3> 
<h4><a id="_869"></a>易于增加具体的工厂</h4> 
<p>在本模式中很容易增加具体的工厂，因为需要编写哪些类和需要实现哪些方法都非常清楚。</p> 
<p>无论要增加多少个具体工厂（或是要修改具体工厂的 Bug），都无需修改抽象工厂和 Main部分。</p> 
<h4><a id="_875"></a>难以增加新的零件</h4> 
<p>怎么在 Abstract Factory模式中增加新的零件？</p> 
<p>例如，我们要在factory包中增加一个表示图像的Picture零件，必须对所有的具体工厂进行相应的修改才行。</p> 
<p>具体来说，在listfactory包中，需做修改：在ListFactory 中加入createPicture方法，新增ListPicture类。</p> 
<p>已编写完成的具体工厂越多，修改的工作量就会越大。</p> 
<h3><a id="_885"></a>相关的设计模式</h3> 
<h4><a id="Builder_7_887"></a>Builder 模式（第7章）</h4> 
<p>Abstract Factory 模式：通过调用抽象产品的接口(API)来组装抽象产品，生成具有复杂结构的实例。</p> 
<p>Builder 模式：分阶段地制作复杂实例。</p> 
<h4><a id="Factory_Method4_893"></a>Factory Method模式（第4章）</h4> 
<p>有时Abstract Factory 模式中零件和产品的生成会使用到 Factory Method模式。</p> 
<h4><a id="Composite11_897"></a>Composite模式（第11章）</h4> 
<p>有时Abstract Factory模式在制作产品时会使用Composite模式。</p> 
<h4><a id="Singleton_5_901"></a>Singleton 模式（第5章）</h4> 
<p>有时Abstract Factory 模式中的具体工厂会使用 Singleton模式。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3ed0197dabf8edacda2103621634b63/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iphone异常问题常用修复方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a7ecd7a570ebd3cce47abe6035f38de2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1.初识redis</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>