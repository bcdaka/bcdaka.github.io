<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Git】从零开始的 Git 基本操作 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/985dca2a313524be3df8462a7cc44bd0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Git】从零开始的 Git 基本操作">
  <meta property="og:description" content="文章目录 1. 创建 Git 本地仓库2. 配置 Git3. 认识工作区、暂存区、版本库3.1 添加文件 | 场景一3.2 查看 .git 文件3.3 添加文件 | 场景二 4. 修改文件5. 版本回退6. 撤销修改6.1 情况一：对于工作区的代码，还没有 add6.2 情况二：已经 add，但没有 commit6.3 情况三：已经 add 了，并且也 commit 了 7. 删除文件8. 本文命令总结 1. 创建 Git 本地仓库 要提前说的是，仓库是进行版本控制的一个文件目录。我们想对文件进行版本控制，就必须先创建一个仓库出来。
创建一个 Git 本地仓库对应的命令为 git init，注意命令要在文件目录下执行，例如：
ubuntu@VM-20-5-ubuntu:~/gitcode$ pwd /home/ubuntu/gitcode ubuntu@VM-20-5-ubuntu:~/gitcode$ git init Initialized empty Git repository in /home/ubuntu/gitcode/.git/ ubuntu@VM-20-5-ubuntu:~/gitcode$ ll -a total 12 drwxrwxr-x 3 ubuntu ubuntu 4096 Apr 16 19:26 .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-20T15:04:18+08:00">
    <meta property="article:modified_time" content="2024-04-20T15:04:18+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Git】从零开始的 Git 基本操作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__Git__4" rel="nofollow">1. 创建 Git 本地仓库</a></li><li><a href="#2__Git_57" rel="nofollow">2. 配置 Git</a></li><li><a href="#3__112" rel="nofollow">3. 认识工作区、暂存区、版本库</a></li><li><ul><li><a href="#31____128" rel="nofollow">3.1 添加文件 | 场景一</a></li><li><a href="#32__git__223" rel="nofollow">3.2 查看 .git 文件</a></li><li><a href="#33____349" rel="nofollow">3.3 添加文件 | 场景二</a></li></ul> 
  </li><li><a href="#4__366" rel="nofollow">4. 修改文件</a></li><li><a href="#5__465" rel="nofollow">5. 版本回退</a></li><li><a href="#6__630" rel="nofollow">6. 撤销修改</a></li><li><ul><li><a href="#61__add_632" rel="nofollow">6.1 情况一：对于工作区的代码，还没有 add</a></li><li><a href="#62__add_commit_667" rel="nofollow">6.2 情况二：已经 add，但没有 commit</a></li><li><a href="#63__add__commit__724" rel="nofollow">6.3 情况三：已经 add 了，并且也 commit 了</a></li></ul> 
  </li><li><a href="#7__767" rel="nofollow">7. 删除文件</a></li><li><a href="#8__846" rel="nofollow">8. 本文命令总结</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/7b/01/QNNjd6WX_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="1__Git__4"></a>1. 创建 Git 本地仓库</h2> 
<p>要提前说的是，<strong>仓库是进行版本控制的一个文件目录</strong>。我们想对文件进行版本控制，就必须先创建一个仓库出来。</p> 
<p>创建一个 Git 本地仓库对应的命令为 <code>git init</code>，注意命令要在文件目录下执行，例如：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token builtin class-name">pwd</span>
/home/ubuntu/gitcode
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> init
Initialized empty Git repository <span class="token keyword">in</span> /home/ubuntu/gitcode/.git/
ubuntu@VM-20-5-ubuntu:~/gitcode$ ll <span class="token parameter variable">-a</span>
total <span class="token number">12</span>
drwxrwxr-x  <span class="token number">3</span> ubuntu ubuntu <span class="token number">4096</span> Apr <span class="token number">16</span> <span class="token number">19</span>:26 ./
drwxr-xr-x <span class="token number">10</span> ubuntu ubuntu <span class="token number">4096</span> Apr <span class="token number">16</span> <span class="token number">19</span>:26 <span class="token punctuation">..</span>/
drwxrwxr-x  <span class="token number">7</span> ubuntu ubuntu <span class="token number">4096</span> Apr <span class="token number">16</span> <span class="token number">19</span>:31 .git/
</code></pre> 
<p>我们发现，当前目录下多了一个 <code>.git</code> 的隐藏文件，<code>.git</code> 目录是 Git 用来跟踪管理仓库的，<strong>不要手动修改这个目录里面的文件，不然改乱了，就把 Git 仓库给破坏了</strong>。</p> 
<p>其中包含 Git 仓库的诸多细节，使用 <code>tree .git/</code> 命令看看：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ tree .git/
.git/
├── branches
├── config
├── description
├── HEAD
├── hooks
│   ├── applypatch-msg.sample
│   ├── commit-msg.sample
│   ├── fsmonitor-watchman.sample
│   ├── post-update.sample
│   ├── pre-applypatch.sample
│   ├── pre-commit.sample
│   ├── pre-merge-commit.sample
│   ├── prepare-commit-msg.sample
│   ├── pre-push.sample
│   ├── pre-rebase.sample
│   ├── pre-receive.sample
│   └── update.sample
├── info
│   └── exclude
├── objects
│   ├── info
│   └── pack
└── refs
    ├── heads
    └── tags

<span class="token number">9</span> directories, <span class="token number">16</span> files
</code></pre> 
<h2><a id="2__Git_57"></a>2. 配置 Git</h2> 
<p>当安装 Git 后首先要做的事情是设置你的 <strong>用户名称</strong> 和 <strong>E-mail</strong> 地址，这是非常重要的。配置命令为：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> user.name <span class="token string">"your name"</span>
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> user.email <span class="token string">"email@example.com"</span>

<span class="token comment"># 把 your name 改为你的昵称</span>
<span class="token comment"># 把 email@example.com 改为你的邮箱</span>
<span class="token comment"># [--global] 代表 --global 是一个可选项，输入命令的时候不要加方框！！！</span>
</code></pre> 
<p>其中 <code>--global</code> 是一个可选项。如果使用了该选项，表示这台机器上所有的 Git 仓库都会使用这个配置。如果你希望在不同仓库中使用不同的 <code>name</code> 或 <code>e-mail</code>，可以不要 <code>--global</code> 这个选项，但要注意的是，<strong>执行命令时必须要在仓库里</strong>。</p> 
<p>查看配置的命令为：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> config <span class="token parameter variable">-l</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config user.name <span class="token string">"tjq"</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config user.email <span class="token string">"1234567890@qq.com"</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config <span class="token parameter variable">-l</span>
<span class="token assign-left variable">core.repositoryformatversion</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">core.filemode</span><span class="token operator">=</span>true
<span class="token assign-left variable">core.bare</span><span class="token operator">=</span>false
<span class="token assign-left variable">core.logallrefupdates</span><span class="token operator">=</span>true
<span class="token assign-left variable">user.name</span><span class="token operator">=</span>tjq					<span class="token comment"># 新增</span>
<span class="token assign-left variable">user.email</span><span class="token operator">=</span><span class="token number">1234567890</span>@qq.com	<span class="token comment"># 新增</span>
</code></pre> 
<p>删除对应配置的命令为：</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> <span class="token parameter variable">--unset</span> user.name <span class="token string">"your name"</span>
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> <span class="token parameter variable">--unset</span> user.email <span class="token string">"email@example.com"</span>

<span class="token comment"># 如果配置的时候加了 --global 选项，那么删除的时候也要加</span>
</code></pre> 
<p>删除配置后，可以使用查看配置的命令（<code>git config -l</code>）查看是否真的已经删除。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config <span class="token parameter variable">--unset</span> user.name <span class="token string">"tjq"</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config <span class="token parameter variable">--unset</span> user.email <span class="token string">"1234567890@qq.com"</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> config <span class="token parameter variable">-l</span>
<span class="token assign-left variable">core.repositoryformatversion</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">core.filemode</span><span class="token operator">=</span>true
<span class="token assign-left variable">core.bare</span><span class="token operator">=</span>false
<span class="token assign-left variable">core.logallrefupdates</span><span class="token operator">=</span>true
</code></pre> 
<h2><a id="3__112"></a>3. 认识工作区、暂存区、版本库</h2> 
<ul><li><strong>工作区</strong>：是在电脑上你要写代码或文件的目录。</li><li><strong>暂存区</strong>：英文叫 stage 或 index。一般存放在 <code>.git</code> 目录下的 index 文件（<code>.git/index</code>）中，我们有时把暂存区也叫做索引（index）。</li><li><strong>版本库</strong>：又名仓库，英文名 <code>repository</code> 。工作区有一个隐藏目录 <code>.git</code> ，它不算工作区，而是 Git 的版本库。这个版本库里面的所有文件都可以被 Git 管理起来，每个文件的修改、删除，Git 都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</li></ul> 
<p>下图展示了工作区、暂存区和版本库之间的关系：</p> 
<p><img src="https://images2.imgbox.com/ad/25/xB8cjDvJ_o.png" alt="在这里插入图片描述"></p> 
<ul><li>图中左侧为工作区，右侧为版本库。Git 的版本库里存了很多东西，其中最重要的就是暂存区。</li><li>在创建 Git 版本库时，Git 会为我们自动创建一个唯一的 master 分支，以及指向 master 的一个指针 HEAD。</li><li>当对工作区修改（或新增）的文件执行 <code>git add</code> 命令时，暂存区目录树的文件索引会被更新。</li><li>当执行提交操作 <code>git commit</code> 时，master 分支会做相应的更新，可以简单理解为暂存区的目录树才会被真正写到版本库中。</li></ul> 
<p>由上述描述中，我们得知：<strong>通过新建或粘贴进目录的文件，并不能称之为向仓库中新增文件，而只是在工作区新增了文件。必须要通过使用 <code>git add</code> 和 <code>git commit</code> 命令才能将文件添加到仓库中进行管理！</strong></p> 
<h3><a id="31____128"></a>3.1 添加文件 | 场景一</h3> 
<p>在包含 .git 的目录下新建一个 ReadMe 文件，我们可以使用 <code>git add</code> 命令将文件添加到暂存区：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 添加一个或多个文件到暂存区：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token punctuation">[</span>file1<span class="token punctuation">]</span> <span class="token punctuation">[</span>file2<span class="token punctuation">]</span> <span class="token punctuation">..</span>.

<span class="token comment"># 添加指定目录到暂存区，包括子目录：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token punctuation">[</span>dir<span class="token punctuation">]</span>

<span class="token comment"># 添加当前目录下的所有文件改动到暂存区：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
</code></pre> 
<p>再使用 <code>git commit</code> 命令将暂存区内容添加到本地仓库中：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 提交暂存区全部内容到本地仓库中：</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"message"</span>

<span class="token comment"># 提交暂存区的指定文件到仓库区：</span>
<span class="token function">git</span> commit <span class="token punctuation">[</span>file1<span class="token punctuation">]</span> <span class="token punctuation">[</span>file2<span class="token punctuation">]</span> <span class="token punctuation">..</span>. <span class="token parameter variable">-m</span> <span class="token string">"message"</span>
</code></pre> 
<p>注意 <code>git commit</code> 后面的 <code>-m</code> 选项，要跟上描述本次提交的 message，由用户自己完成，这部分内容绝对不能省略，并要好好描述，是用来记录你的提交细节，是给我们人看的。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">touch</span> ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ la
.git  ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">vim</span> ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add first file"</span>
<span class="token punctuation">[</span>master <span class="token punctuation">(</span>root-commit<span class="token punctuation">)</span> daca7d4<span class="token punctuation">]</span> <span class="token function">add</span> first <span class="token function">file</span>
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> ReadMe
</code></pre> 
<p><code>git commit</code> 命令执行成功后会告诉我们，1 个文件被改动（就是我们新添加的 ReadMe 文件），插入了一行内容。</p> 
<p>我们还可以多次 add 不同的文件，而只 commit 一次便可以提交所有文件，是因为需要提交的文件是通通被 add 到暂存区中，然后一次性 commit 暂存区的所有修改。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">touch</span> file1 file2 file3
ubuntu@VM-20-5-ubuntu:~/gitcode$ la
file1  file2  file3  .git  ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> file1 file2 file3
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add 3 files"</span>
<span class="token punctuation">[</span>master 63ffac4<span class="token punctuation">]</span> <span class="token function">add</span> <span class="token number">3</span> files
 <span class="token number">3</span> files changed, <span class="token number">0</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">0</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> file1
 create mode <span class="token number">100644</span> file2
 create mode <span class="token number">100644</span> file3
</code></pre> 
<p>截至目前为止，我们已经能够将代码直接提交至本地仓库了。那么可以查看我们的历史提交记录吗？如何查看？</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看历史提交记录</span>
<span class="token function">git</span> log

<span class="token comment"># 查看美观且简略的历史提交记录</span>
<span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline
</code></pre> 
<p>该命令显示从最近到最远的提交日志，并且可以看到我们 commit 时的日志消息。</p> 
<p>如果嫌输出信息太多，看得眼花缭乱的，可以试试加上 <code>--pretty=oneline</code> 参数。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log
commit 63ffac4330249843d4b68f6a5f59384ba09a0358 <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span>
Author: tjq <span class="token operator">&lt;</span><span class="token number">1234567890</span>@qq.com<span class="token operator">&gt;</span>
Date:   Thu Apr <span class="token number">18</span> <span class="token number">10</span>:46:40 <span class="token number">2024</span> +0800

    <span class="token function">add</span> <span class="token number">3</span> files

commit daca7d41906c112f4b11c148a43cd2a0c23a4871
Author: tjq <span class="token operator">&lt;</span><span class="token number">1234567890</span>@qq.com<span class="token operator">&gt;</span>
Date:   Thu Apr <span class="token number">18</span> <span class="token number">10</span>:20:39 <span class="token number">2024</span> +0800

    <span class="token function">add</span> first <span class="token function">file</span>
<span class="token comment"># 上面信息太多？试试加上 --pretty=oneline</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline 
63ffac4330249843d4b68f6a5f59384ba09a0358 <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> <span class="token function">add</span> <span class="token number">3</span> files
daca7d41906c112f4b11c148a43cd2a0c23a4871 <span class="token function">add</span> first <span class="token function">file</span>
</code></pre> 
<p>需要说明的是，我们看到的一大串类似 <code>63ffa...a0358</code> 的数字是每次提交的 <code>commit id</code>（版本号），Git 的 <code>commit id</code> 不是 1, 2, 3, … 递增的数字，而是一个 SHA1 计算出来的一个非常大的数字，用十六进制表示。</p> 
<h3><a id="32__git__223"></a>3.2 查看 .git 文件</h3> 
<p>先来看看我们的 <code>.git</code> 目录结构：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ tree .git/
.git/
├── branches
├── COMMIT_EDITMSG
├── config
├── description
├── HEAD
├── hooks
│   ├── applypatch-msg.sample
│   ├── commit-msg.sample
│   ├── fsmonitor-watchman.sample
│   ├── post-update.sample
│   ├── pre-applypatch.sample
│   ├── pre-commit.sample
│   ├── pre-merge-commit.sample
│   ├── prepare-commit-msg.sample
│   ├── pre-push.sample
│   ├── pre-rebase.sample
│   ├── pre-receive.sample
│   └── update.sample
├── index
├── info
│   └── exclude
├── logs
│   ├── HEAD
│   └── refs
│       └── heads
│           └── master
├── objects
│   ├── 0e
│   │   └── 6b1780b73cd9220ec5073dc64b42f7ad4bd945
│   ├── <span class="token number">15</span>
│   │   └── a37e9ef171cca4a5d985fccd1fcf9414b2c7cf
│   ├── <span class="token number">63</span>
│   │   └── ffac4330249843d4b68f6a5f59384ba09a0358
│   ├── 8d
│   │   └── 0e41234f24b6da002d962a26c2495ea16a425f
│   ├── da
│   │   └── ca7d41906c112f4b11c148a43cd2a0c23a4871
│   ├── e6
│   │   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391
│   ├── info
│   └── pack
└── refs
    ├── heads
    │   └── master
    └── tags

<span class="token number">18</span> directories, <span class="token number">27</span> files
</code></pre> 
<ol><li> <p><code>index</code> 就是我们的暂存区，add 后的内容都是添加到这里的。</p> </li><li> <p><code>HEAD</code> 就是我们默认指向 master 分支的指针；</p> <pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> .git/HEAD 
ref: refs/heads/master
</code></pre> <p>而默认的 master 分支又是什么呢？</p> <pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> .git/refs/heads/master 
63ffac4330249843d4b68f6a5f59384ba09a0358
</code></pre> <p>打印的 <code>63ffac4330249843d4b68f6a5f59384ba09a0358</code> 是什么东西呢？是不是看起来有点眼熟，其实保存的就是当前最新的 <code>commit id</code> 。</p> </li><li> <p><code>objects</code> 为 Git 的对象库，里面包含了创建的各种版本库对象及内容。当执行 <code>git add</code> 命令时，暂存区的目录树被更新，同时工作区修改（或新增）的文件内容被写入到对象库中的一个新的对象中，就位于 <code>.git/objects</code> 目录下，让我们来看看这些对象有何用处：</p> <pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">ls</span> .git/objects/
0e  <span class="token number">15</span>  <span class="token number">63</span>  8d  da  e6  info  pack
</code></pre> <p>查找 objects 时要将 <code>commit id</code> 分成 2 部分，其中前 2 位是文件夹名称，后 38 位是文件名称。</p> <p>找到这个文件之后，一般不能直接看到里面是什么，该类文件是经过 <code>sha</code>（安全哈希算法）加密过的文件，但是我们可以使用 <code>git cat-file</code> 命令来查看版本库对象的内容：</p> <pre><code class="prism language-bash"><span class="token function">git</span> cat-file <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>要查看的内容<span class="token punctuation">]</span>
</code></pre> <pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> cat-file <span class="token parameter variable">-p</span> 63ffac4330249843d4b68f6a5f59384ba09a0358
tree 15a37e9ef171cca4a5d985fccd1fcf9414b2c7cf
parent daca7d41906c112f4b11c148a43cd2a0c23a4871
author tjq <span class="token operator">&lt;</span><span class="token number">2780888910</span>@qq.com<span class="token operator">&gt;</span> <span class="token number">1713408400</span> +0800
committer tjq <span class="token operator">&lt;</span><span class="token number">2780888910</span>@qq.com<span class="token operator">&gt;</span> <span class="token number">1713408400</span> +0800

<span class="token function">add</span> <span class="token number">3</span> files
<span class="token comment"># 这是我们最近一次的提交</span>
</code></pre> <p>其中，还有一行 <code>tree 15a37e9ef171cca4a5d985fccd1fcf9414b2c7cf</code> ，我们使用同样的方法，看看结果：</p> <pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> cat-file <span class="token parameter variable">-p</span> 15a37e9ef171cca4a5d985fccd1fcf9414b2c7cf
<span class="token number">100644</span> blob 8d0e41234f24b6da002d962a26c2495ea16a425f	ReadMe
<span class="token number">100644</span> blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	file1
<span class="token number">100644</span> blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	file2
<span class="token number">100644</span> blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	file3
</code></pre> <p>再看 ReadMe 对应的 <code>8d0e41234f24b6da002d962a26c2495ea16a425f</code> ：</p> <pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> cat-file <span class="token parameter variable">-p</span> 8d0e41234f24b6da002d962a26c2495ea16a425f
hello <span class="token function">git</span>
<span class="token comment"># 这是我们对 ReadMe 做的修改，被 git 记录了下来！</span>
</code></pre> </li></ol> 
<p>总结一下，在本地的 git 仓库中，有几个文件或者目录很特殊：</p> 
<ul><li><strong>index</strong>：暂存区，<code>git add</code> 后会更新该内容。</li><li><strong>HEAD</strong>：默认指向 master 分支的一个指针。</li><li><strong>refs / heads / master</strong>：文件里保存当前 <code>master</code> 分支的最新 <code>commit id</code> 。</li><li><strong>objects</strong>：包含了创建的各种版本库对象及内容，可以简单理解为放了 git 维护的所有修改。</li></ul> 
<p>在学习 git 过程中，我们最好能将常见的 <code>git</code> 操作与 <code>.git</code> 目录当中的结构内容变化对应起来，这样有利于我们理解 git 细节流程！</p> 
<h3><a id="33____349"></a>3.3 添加文件 | 场景二</h3> 
<p>学习到这里，我们已经清楚了如何向仓库中添加文件，并且对于工作区、暂存区、版本库也有了一定的认识。那么我们再展示一种添加文件的场景，能加深对工作区、暂存区、版本库的理解，示例如下：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">touch</span> file4				<span class="token comment"># 1. 新增 file4 文件</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> file4				<span class="token comment"># 2. 将 file4 添加到暂存区</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">touch</span> file5				<span class="token comment"># 3. 新增 file5 文件</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add file"</span>	<span class="token comment"># 4. 提交修改</span>
<span class="token punctuation">[</span>master 6856fbd<span class="token punctuation">]</span> <span class="token function">add</span> <span class="token function">file</span>
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">0</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">0</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 create mode <span class="token number">100644</span> file4
</code></pre> 
<p>提交后发现打印了 <code>1 file changed, 0 insertions(+), 0 deletions(-)</code> ，意思是只有一个文件改变了，这时我们提出了疑问，不是新增了两个文件吗？</p> 
<p>再来回忆下，<code>git add</code> 是将文件添加到暂存区，<code>git commit</code> 是将暂存区的内容添加到本地仓库中。由于我们并没有使用 <code>git add file5</code> ，file5 就不在暂存区中维护，所以我们 commit 的时候其实只是把已经在暂存区的 file4 提交了，而遗漏了工作区的 file5。</p> 
<h2><a id="4__366"></a>4. 修改文件</h2> 
<p>Git 比其他版本控制系统设计的更优秀，因为 <strong>Git 跟踪并管理的是修改，而非文件</strong>。</p> 
<p>什么是修改？比如你新增了一行，这就是一个修改；更改了某些字符，是一个修改；创建一个新文件，也是一个修改。</p> 
<p>下面我们对 ReadMe 文件进行一次修改：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ la
file1  file2  file3  file4  file5  .git  ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">vim</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
</code></pre> 
<p>此时，仓库中的 ReadMe 和我们工作区的 ReadMe 是不同的，如何查看当前仓库状态呢？</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看仓库状态</span>
<span class="token function">git</span> status
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 可以用这个命令查看在上次提交之后，是否对代码进行了再次修改</span>
<span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status
On branch master
Changes not staged <span class="token keyword">for</span> commit:
  <span class="token punctuation">(</span>use <span class="token string">"git add &lt;file&gt;..."</span> to update what will be committed<span class="token punctuation">)</span>
  <span class="token punctuation">(</span>use <span class="token string">"git restore &lt;file&gt;..."</span> to discard changes <span class="token keyword">in</span> working directory<span class="token punctuation">)</span>
	modified:   ReadMe

no changes added to commit <span class="token punctuation">(</span>use <span class="token string">"git add"</span> and/or <span class="token string">"git commit -a"</span><span class="token punctuation">)</span>
</code></pre> 
<p>上面的结果告诉我们，ReadMe 被修改过了，但还没有完成添加与提交。</p> 
<p>目前，我们只知道文件被修改了，如果能知道具体哪些地方被修改了，就更好了，这样代码多了以后也可以很方便的进行对比管理。怎么做呢？</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看暂存区和工作区文件的差异</span>
<span class="token function">git</span> <span class="token function">diff</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span>

<span class="token comment"># 查看版本库和工作区文件的差异</span>
<span class="token function">git</span> <span class="token function">diff</span> HEAD -- <span class="token punctuation">[</span>file<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># git diff [file] 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">diff</span> ReadMe
<span class="token function">diff</span> <span class="token parameter variable">--git</span> a/ReadMe b/ReadMe
index 8d0e412<span class="token punctuation">..</span>05fe86c <span class="token number">100644</span>
--- a/ReadMe
+++ b/ReadMe
@@ <span class="token parameter variable">-1</span> +1,2 @@
 hello <span class="token function">git</span>
+hello world

<span class="token comment"># git diff HEAD -- [file] 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">diff</span> HEAD -- ReadMe
<span class="token function">diff</span> <span class="token parameter variable">--git</span> a/ReadMe b/ReadMe
index 8d0e412<span class="token punctuation">..</span>05fe86c <span class="token number">100644</span>
--- a/ReadMe
+++ b/ReadMe
@@ <span class="token parameter variable">-1</span> +1,2 @@
 hello <span class="token function">git</span>
+hello world
</code></pre> 
<p><code>git diff [file]</code> 命令用来显示暂存区和工作区文件的差异，显示的格式正是 Unix 通用的 diff 格式。也可以使用 <code>git diff HEAD -- [file]</code> 命令来查看版本库和工作区文件的区别。</p> 
<p>知道了对 ReadMe 做了什么修改后，再把它提交到本地仓库就放心多了。</p> 
<pre><code class="prism language-bash"><span class="token comment"># git add 后再次查看仓库状态</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
Changes to be committed:
  <span class="token punctuation">(</span>use <span class="token string">"git restore --staged &lt;file&gt;..."</span> to unstage<span class="token punctuation">)</span>
	modified:   ReadMe
</code></pre> 
<p><code>git add</code> 之后，就没有看到上面 <code>no changes added to commit (use "git add" and/or "git commit -a")</code> 的消息了。接下来我们继续 <code>git commit</code> 即可：</p> 
<pre><code class="prism language-bash"><span class="token comment"># git commit 后再次查看仓库状态</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"modify ReadMe file"</span>
<span class="token punctuation">[</span>master 1c25401<span class="token punctuation">]</span> modify ReadMe <span class="token function">file</span>
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
nothing to commit, working tree clean	<span class="token comment"># 仓库状态恢复正常</span>
</code></pre> 
<h2><a id="5__465"></a>5. 版本回退</h2> 
<p>之前我们提到过，Git 能够管理文件的历史版本，这也是版本控制器重要的能力。如果有一天你发现之前做的工作出现了很大的问题，需要在某个特定的历史版本重新开始，这个时候，就需要版本回退的功能了。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 版本回退</span>
<span class="token function">git</span> reset <span class="token punctuation">[</span>--soft <span class="token operator">|</span> <span class="token parameter variable">--mixed</span> <span class="token operator">|</span> --hard<span class="token punctuation">]</span> <span class="token punctuation">[</span>HEAD<span class="token punctuation">]</span>
</code></pre> 
<p>执行 <code>git reset</code> 命令用于版本回退，可以指定退回某一次提交的版本。<strong>要解释一下“回退”本质是要将版本库中的内容进行回退，工作区或暂存区是否回退由命令参数决定</strong>：</p> 
<table><thead><tr><th>选项</th><th>工作区</th><th>暂存区</th><th>版本库</th></tr></thead><tbody><tr><td>–soft</td><td>不回退</td><td>不回退</td><td>回退</td></tr><tr><td>–mixed（默认）</td><td>不回退</td><td>回退</td><td>回退</td></tr><tr><td>–hard（慎用）</td><td>回退</td><td>回退</td><td>回退</td></tr></tbody></table> 
<ul><li><code>--soft</code> 参数对于工作区和暂存区的内容都不变，只是将版本库回退到某个指定版本。</li><li><code>--mixed</code> 为默认选项，使用时可以不用带该参数。该参数将暂存区的内容退回为指定提交版本内容，工作区文件保持不变。</li><li><code>--hard</code> 参数将暂存区与工作区都退回到指定版本。<strong>切记工作区有未提交的代码时不要用这个命令，因为工作区会回滚，你没有提交的代码就再也找不回了，所以使用该参数一定要慎重</strong>。</li><li><code>HEAD</code> 说明： 
  <ul><li>可直接写成 commit id，表示指定退回的版本</li><li>可以使用 ^ 表示： 
    <ul><li>HEAD 表示当前版本</li><li>HEAD^ 表示上一个版本</li><li>HEAD^^ 表示上上个版本</li><li>…</li></ul> </li><li>也可以使用 ~数字 表示： 
    <ul><li>HEAD~0 表示当前版本</li><li>HEAD~1 表示上一个版本</li><li>HEAD~2 表示上上个版本</li><li>…</li></ul> </li></ul> </li></ul> 
<p>为了便于表述，方便测试回退功能，我们先做一些准备工作：更新 3 个版本的 ReadMe，并分别进行 3 次提交，如下所示：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 第一次修改提交</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1		<span class="token comment"># 第1次新增</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add version1"</span>
<span class="token punctuation">[</span>master 1fbbbb8<span class="token punctuation">]</span> <span class="token function">add</span> version1
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

<span class="token comment"># 第二次修改提交</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1		<span class="token comment"># 第1次新增</span>
hello version2		<span class="token comment"># 第2次新增</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add version2"</span>
<span class="token punctuation">[</span>master 792517a<span class="token punctuation">]</span> <span class="token function">add</span> version2
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

<span class="token comment"># 第三次修改提交</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1		<span class="token comment"># 第1次新增</span>
hello version2		<span class="token comment"># 第2次新增</span>
hello version3		<span class="token comment"># 第3次新增</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"add version3"</span>
<span class="token punctuation">[</span>master ca0330f<span class="token punctuation">]</span> <span class="token function">add</span> version3
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

<span class="token comment"># 查看历史提交记录</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline 
ca0330f09ba66638fc757525042034d82bb7ee90 <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> <span class="token function">add</span> version3
792517a8bc024eab200301baf8691de821548cbe <span class="token function">add</span> version2
1fbbbb826ccc07c0037f7208faeefeb577195f8c <span class="token function">add</span> version1
<span class="token punctuation">..</span>.
</code></pre> 
<p>现在，如果我们在提交完 version 3 后，发现 version 3 编写错误，想回退到 version 2，重新基于 version 2 开始编写。</p> 
<p>由于我们在这里希望的是将工作区的内容也回退到 <code>version 2</code> 版本，所以需要用到 <code>--hard</code> 参数，示例如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看历史提交记录</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline 
ca0330f09ba66638fc757525042034d82bb7ee90 <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> <span class="token function">add</span> version3
792517a8bc024eab200301baf8691de821548cbe <span class="token function">add</span> version2
1fbbbb826ccc07c0037f7208faeefeb577195f8c <span class="token function">add</span> version1
<span class="token punctuation">..</span>.
<span class="token comment"># 输入 commit id 指定回退到 version2</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> 792517a8bc024eab200301baf8691de821548cbe
HEAD is now at 792517a <span class="token function">add</span> version2
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
</code></pre> 
<p>我们发现：此时 ReadMe 文件的内容，已经回退到 version 2 了！当前我们再次用 <code>git log</code> 查看一下提交日志，发现 <code>HEAD</code> 指向了 version2，如下所示：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline 
792517a8bc024eab200301baf8691de821548cbe <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> <span class="token function">add</span> version2
1fbbbb826ccc07c0037f7208faeefeb577195f8c <span class="token function">add</span> version1
<span class="token punctuation">..</span>.
</code></pre> 
<p>到这里一般的回退功能就演示完了，但是现在我后悔了，想再回到 version 3 怎么办？我们可以继续使用 <code>git reset</code> 命令，回退到 <code>version 3</code> 版本，但我们必须要拿到 <code>version 3</code> 的 <code>commit id</code> 才能指定回退的版本。</p> 
<p>但我们看到了 <code>git log</code> 并不能打印出 <code>version 3</code> 的 <code>commit id</code> ，我们该如何找回呢？</p> 
<pre><code class="prism language-bash"><span class="token comment"># 显示本地每次提交的信息</span>
<span class="token function">git</span> reflog
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> reflog 
792517a <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span>: reset: moving to 792517a8bc024eab200301baf8691de821548cbe
ca0330f HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> version3		<span class="token comment"># version 3 的记录</span>
792517a <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> version2
1fbbbb8 HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> version1
1c25401 HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">}</span>: commit: modify ReadMe <span class="token function">file</span>
e094860 HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> file5
6856fbd HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">6</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> <span class="token function">file</span>
63ffac4 HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">7</span><span class="token punctuation">}</span>: commit: <span class="token function">add</span> <span class="token number">3</span> files
daca7d4 HEAD@<span class="token punctuation">{<!-- --></span><span class="token number">8</span><span class="token punctuation">}</span>: commit <span class="token punctuation">(</span>initial<span class="token punctuation">)</span>: <span class="token function">add</span> first <span class="token function">file</span>
</code></pre> 
<p>这样，你就可以很方便的找到你的所有操作记录了，但 <code>ca0330f</code> 这个是啥东西？其实这就是 <code>version 3</code> 的 <code>commit id</code> 的一部分。</p> 
<p>没错，Git 版本回退的时候，也可以使用部分 commit id 来代表目标版本。示例如下：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 回退到 version 3</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> ca0330f
HEAD is now at ca0330f <span class="token function">add</span> version3

<span class="token comment"># 查看工作区</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3

<span class="token comment"># 查看 log</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline 
ca0330f09ba66638fc757525042034d82bb7ee90 <span class="token punctuation">(</span>HEAD -<span class="token operator">&gt;</span> master<span class="token punctuation">)</span> <span class="token function">add</span> version3
792517a8bc024eab200301baf8691de821548cbe <span class="token function">add</span> version2
1fbbbb826ccc07c0037f7208faeefeb577195f8c <span class="token function">add</span> version1
1c25401534e7b402fc77529a1014647d2268447e modify ReadMe <span class="token function">file</span>
e094860cb7f95c34041e3520d17ee393965740c1 <span class="token function">add</span> file5
6856fbd20a828ed8c32b4f03982c8b1947c8b465 <span class="token function">add</span> <span class="token function">file</span>
63ffac4330249843d4b68f6a5f59384ba09a0358 <span class="token function">add</span> <span class="token number">3</span> files
daca7d41906c112f4b11c148a43cd2a0c23a4871 <span class="token function">add</span> first <span class="token function">file</span>
</code></pre> 
<p>在长时间开发中，提交次数过多 / 本地信息丢失，可能使用 <code>git reflog</code> 也无法找到想要的 <code>commit id</code> 了，所以我们在版本回退时一定要慎重，后悔药也不是万能的！</p> 
<p>值得一提的是：Git 的版本回退速度非常快，因为 Git 在内部有个指向当前分支（此处是 master）的 HEAD 指针，<code>refs/heads/master</code> 文件里保存当前 <code>master</code> 分支的最新 <code>commit id</code> 。当我们回退版本的时候，Git 仅仅是给 <code>refs/heads/master</code> 中存储一个特定的 version，可以简单理解成如下示意图：</p> 
<p><img src="https://images2.imgbox.com/ce/97/8brbCBmu_o.png" alt="在这里插入图片描述" width="700"></p> 
<h2><a id="6__630"></a>6. 撤销修改</h2> 
<p>如果我们在工作区写了很长时间代码，越写越难受，感觉自己写的代码太垃圾了，想恢复到上一个版本，如何操作？</p> 
<h3><a id="61__add_632"></a>6.1 情况一：对于工作区的代码，还没有 add</h3> 
<p>你当然可以直接手动删除代码，这个谁都会，但是在代码量很多的情况下，这种方法还适用吗？</p> 
<p>Git 其实为我们提供了更好的方式：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 对工作区代码撤销</span>
<span class="token function">git</span> checkout -- <span class="token punctuation">[</span>file<span class="token punctuation">]</span>
</code></pre> 
<p>我们可以使用这个命令让工作区的文件回到最近一次 <code>add</code> 或 <code>commit</code> 时的状态。要<strong>注意 <code>git checkout -- [file]</code> 命令中的 <code>--</code> 很重要，切记不要省略，一旦省略，该命令就变为其他意思了</strong>。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>

<span class="token comment"># 向 ReadMe 中新增一行代码</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">vim</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3
This piece of code is like shit		<span class="token comment"># 新增</span>

<span class="token comment"># 恢复到上一次 add 或 commit</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> checkout -- ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3
</code></pre> 
<h3><a id="62__add_commit_667"></a>6.2 情况二：已经 add，但没有 commit</h3> 
<p>add 后，代码保存到了暂存区，如何撤销？</p> 
<pre><code class="prism language-bash"><span class="token comment"># 向 ReadMe 中新增一行代码</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">vim</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3
This piece of code is like shit		<span class="token comment"># 新增</span>

<span class="token comment"># add 存入暂存区</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
Changes to be committed:
  <span class="token punctuation">(</span>use <span class="token string">"git restore --staged &lt;file&gt;..."</span> to unstage<span class="token punctuation">)</span>
	modified:   ReadMe
</code></pre> 
<p>回忆一下上面学过的 <code>git reset</code> 回退命令，该命令如果使用 <code>--mixed</code> 参数，可以将暂存区的内容退回为指定的版本内容，但工作区文件保持不变。我们可以用这个命令回退暂存区的内容：</p> 
<pre><code class="prism language-bash"><span class="token comment"># --mixed 是默认参数，使用时可以省略</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> reset HEAD ReadMe
Unstaged changes after reset:
M	ReadMe

<span class="token comment"># 使用 git status 查看状态，发现暂存区是干净的，工作区有修改</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
Changes not staged <span class="token keyword">for</span> commit:
  <span class="token punctuation">(</span>use <span class="token string">"git add &lt;file&gt;..."</span> to update what will be committed<span class="token punctuation">)</span>
  <span class="token punctuation">(</span>use <span class="token string">"git restore &lt;file&gt;..."</span> to discard changes <span class="token keyword">in</span> working directory<span class="token punctuation">)</span>
	modified:   ReadMe

no changes added to commit <span class="token punctuation">(</span>use <span class="token string">"git add"</span> and/or <span class="token string">"git commit -a"</span><span class="token punctuation">)</span>
</code></pre> 
<p>现在可以使用刚才 <strong>情况一</strong> 中的 <code>git checkout -- [file]</code> 撤销命令，把工作区的内容撤销：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> checkout -- ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
nothing to commit, working tree clean	<span class="token comment"># 工作区是干净的</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3	<span class="token comment"># 新增的代码没有了</span>
</code></pre> 
<h3><a id="63__add__commit__724"></a>6.3 情况三：已经 add 了，并且也 commit 了</h3> 
<p>不要担心，我们可以使用 <code>git reset --hard HEAD^</code> 命令回退到上一个版本！</p> 
<p>不过，这是有条件的，即：我们还没有把本地仓库的代码推送到远程仓库（gitee / github），因为撤销功能本质就是为了防止不好的代码被推送到远端。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>

<span class="token comment"># 向 ReadMe 中新增一行代码</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">vim</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3
This piece of code is like shit		<span class="token comment"># 新增</span>

<span class="token comment"># 提交</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> ReadMe 
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"test quash"</span>
<span class="token punctuation">[</span>master 15e3520<span class="token punctuation">]</span> <span class="token builtin class-name">test</span> quash
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>

<span class="token comment"># 回退</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> HEAD^
HEAD is now at ca0330f <span class="token function">add</span> version3
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">cat</span> ReadMe 
hello <span class="token function">git</span>
hello world
hello version1
hello version2
hello version3
</code></pre> 
<p><strong>总结：</strong></p> 
<table><thead><tr><th>工作区</th><th>暂存区</th><th>版本库</th><th>解决方法</th></tr></thead><tbody><tr><td>最新版本</td><td>空</td><td>上一版本 | 其他版本</td><td><code>git check -- [file]</code> 撤销工作区到上一版本</td></tr><tr><td>最新版本</td><td>最新版本</td><td>上一版本 | 其他版本</td><td><code>git reset [--mixed | --hard] [HEAD]</code> 回退暂存区和工作区</td></tr><tr><td>最新版本</td><td>最新版本</td><td>最新版本 | 上一版本 | 其他版本</td><td><code>git reset [--hard] [HEAD]</code> 回退版本库、暂存区和工作区</td></tr></tbody></table> 
<h2><a id="7__767"></a>7. 删除文件</h2> 
<p><strong>在 Git 中，删除一个文件不仅仅是把工作区的文件删除，还要把版本库中对应的文件也删除，否则会造成工作区与版本库不匹配的问题！</strong></p> 
<p>我们删除之前提交的 file5 试试：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 实机演示</span>

<span class="token comment"># rm 删除工作区的 file5</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">ls</span>
file1  file2  file3  file4  file5  ReadMe
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">rm</span> file5

<span class="token comment"># 查看状态</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
Changes not staged <span class="token keyword">for</span> commit:
  <span class="token punctuation">(</span>use <span class="token string">"git add/rm &lt;file&gt;..."</span> to update what will be committed<span class="token punctuation">)</span>
  <span class="token punctuation">(</span>use <span class="token string">"git restore &lt;file&gt;..."</span> to discard changes <span class="token keyword">in</span> working directory<span class="token punctuation">)</span>
	deleted:    file5

no changes added to commit <span class="token punctuation">(</span>use <span class="token string">"git add"</span> and/or <span class="token string">"git commit -a"</span><span class="token punctuation">)</span>
<span class="token comment"># git status 提示我们工作区被修改了（删除也算修改）</span>
<span class="token comment"># 我们需要把本次修改提交到版本库</span>

<span class="token comment"># 提交</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">add</span> file5
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"delete file5"</span>
<span class="token punctuation">[</span>master 6fdee7a<span class="token punctuation">]</span> delete file5
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">0</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">0</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 delete mode <span class="token number">100644</span> file5

<span class="token comment"># 再次查看</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status
On branch master
nothing to commit, working tree clean
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">ls</span>
file1  file2  file3  file4  ReadMe
<span class="token comment"># 到这里才算是删干净了</span>
</code></pre> 
<p>除了上面的基本方法以外，Git 还提供了一个专用的删除命令：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 删除文件</span>
<span class="token function">git</span> <span class="token function">rm</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span>
</code></pre> 
<p>使用此命令可以让我们少 <code>add</code> 一次，<strong>相当于直接把工作区的删除操作同步到了暂存区</strong>，我们删除 file4 试试：</p> 
<pre><code class="prism language-bash">ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">ls</span>
file1  file2  file3  file4  ReadMe

<span class="token comment"># 使用 git rm 命令删除 file4</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> <span class="token function">rm</span> file4
<span class="token function">rm</span> <span class="token string">'file4'</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
Changes to be committed:
  <span class="token punctuation">(</span>use <span class="token string">"git restore --staged &lt;file&gt;..."</span> to unstage<span class="token punctuation">)</span>
	deleted:    file4

ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"delete file4"</span>
<span class="token punctuation">[</span>master 0c91580<span class="token punctuation">]</span> delete file4
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">0</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">0</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
 delete mode <span class="token number">100644</span> file4

<span class="token comment"># 删除完成后查看</span>
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">git</span> status 
On branch master
nothing to commit, working tree clean
ubuntu@VM-20-5-ubuntu:~/gitcode$ <span class="token function">ls</span>
file1  file2  file3  ReadMe
</code></pre> 
<p>现在，我们就掌握了两种在 Git 中删除文件的方式。</p> 
<h2><a id="8__846"></a>8. 本文命令总结</h2> 
<p>为了方便查阅，我按照本文的先后顺序，在这里列出我们学习到的 Git 新命令：</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>. 创建本地仓库
<span class="token function">git</span> init

<span class="token number">2</span>. 配置 <span class="token function">git</span>
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> user.name <span class="token string">"your name"</span>
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> user.email <span class="token string">"email@example.com"</span>

<span class="token number">3</span>. 查看配置
<span class="token function">git</span> config <span class="token parameter variable">-l</span>

<span class="token number">4</span>. 删除配置
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> <span class="token parameter variable">--unset</span> user.name <span class="token string">"your name"</span>
<span class="token function">git</span> config <span class="token punctuation">[</span>--global<span class="token punctuation">]</span> <span class="token parameter variable">--unset</span> user.email <span class="token string">"email@example.com"</span>

<span class="token number">5</span>. 添加文件
<span class="token comment"># 添加一个或多个文件到暂存区：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token punctuation">[</span>file1<span class="token punctuation">]</span> <span class="token punctuation">[</span>file2<span class="token punctuation">]</span> <span class="token punctuation">..</span>.
<span class="token comment"># 添加指定目录到暂存区，包括子目录：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token punctuation">[</span>dir<span class="token punctuation">]</span>
<span class="token comment"># 添加当前目录下的所有文件改动到暂存区：</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>

<span class="token number">6</span>. 提交文件
<span class="token comment"># 提交暂存区全部内容到本地仓库中：</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"message"</span>
<span class="token comment"># 提交暂存区的指定文件到仓库区：</span>
<span class="token function">git</span> commit <span class="token punctuation">[</span>file1<span class="token punctuation">]</span> <span class="token punctuation">[</span>file2<span class="token punctuation">]</span> <span class="token punctuation">..</span>. <span class="token parameter variable">-m</span> <span class="token string">"message"</span>

<span class="token number">7</span>. 查看提交记录
<span class="token comment"># 查看历史提交记录</span>
<span class="token function">git</span> log
<span class="token comment"># 查看美观且简略的历史提交记录</span>
<span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>oneline

<span class="token number">8</span>. 查看版本库对象的内容
<span class="token function">git</span> cat-file <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>要查看的内容<span class="token punctuation">]</span>

<span class="token number">9</span>. 查看仓库状态
<span class="token function">git</span> status 

<span class="token number">10</span>. 查看文件间差异
<span class="token comment"># 查看暂存区和工作区文件的差异</span>
<span class="token function">git</span> <span class="token function">diff</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span>
<span class="token comment"># 查看版本库和工作区文件的差异</span>
<span class="token function">git</span> <span class="token function">diff</span> HEAD -- <span class="token punctuation">[</span>file<span class="token punctuation">]</span>

<span class="token number">11</span>. 版本回退
<span class="token function">git</span> reset <span class="token punctuation">[</span>--soft <span class="token operator">|</span> <span class="token parameter variable">--mixed</span> <span class="token operator">|</span> --hard<span class="token punctuation">]</span> <span class="token punctuation">[</span>HEAD<span class="token punctuation">]</span>

<span class="token number">12</span>. 显示本地每次提交的信息
<span class="token function">git</span> reflog

<span class="token number">13</span>. 撤销工作区操作回上个版本
<span class="token function">git</span> checkout -- <span class="token punctuation">[</span>file<span class="token punctuation">]</span>

<span class="token number">14</span>. 删除文件
<span class="token function">git</span> <span class="token function">rm</span> <span class="token punctuation">[</span>file<span class="token punctuation">]</span>
</code></pre> 
<hr> 
<center>
  END 
</center> 
<br> 
<center>
  上一篇： 
 <a href="https://blog.csdn.net/m0_73156359/article/details/137838548?spm=1001.2014.3001.5501">【Git】安装 Git</a> 
</center>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31bfa106e613e65d30d9fe667364d535/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【JavaSE】JDK17的一些特性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f3e2a20c2b9179add987582be2cc82e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在本地跑一个AI模型(5) - Stable Diffusion</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>