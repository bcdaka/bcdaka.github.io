<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>毕业设计 多功能 Web 应用渗透测试系统（源码&#43;论文） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/09d64c163cc6d0a5ae1dae4ab3b77f7e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="毕业设计 多功能 Web 应用渗透测试系统（源码&#43;论文）">
  <meta property="og:description" content="# 0 简介
今天学长向大家介绍适合作为毕设的项目：
毕设分享 多功能 Web 应用渗透测试系统（源码&#43;论文）
项目获取：
https://gitee.com/assistant-a/project-sharing
项目介绍 系统简介 本项目为多功能 Web 应用渗透测试系统，包含漏洞检测、目录识别、端口扫描、指纹识别、域名探测、旁站探测、信息泄露检测等功能。
项目功能 本系统通过 旁站探测 和 域名探测 功能对待检测网站进行资产收集，通过 端口扫描、指纹识别、目录识别 和 信息泄露检测 功能对待检测网站进行信息收集，通过收集的信息分析评估网站存在哪些安全隐患，然后使用 漏洞检测 功能揭示网站存在的漏洞以及危害等级并给出修复建议。通过这一系列的步骤，可以对 Web 应用进行全面检测，从而发现网站存在的安全隐患，因此用户可以针对相应的网络威胁做出应急响应，进而提升站点的安全性。
相关技术 名称PythonDjangoSQLiteEChartsTablerLayerDocsifySimpleUIBoostrap Table版本3.7.03.1.43.35.25.0.11.0.03.2.04.11.62021.1.11.18.2 项目首页 首页采用 ECharts 对漏洞扫描的漏洞等级、指纹识别组件、安全导航数据做了可视化图表展示，图表的风格没有统一，凑合看吧
身份验证 新用户想要使用系统功能必须要注册登录，游客只能访问部分页面。本系统有普通用户和超级用户。普通用户可以使用本系统的所有功能，但是不能登录后台管理系统。超级用户不仅可以使用所用功能还可以登录后台管理系统中所有的用户权限和数据。
设计思路： 登录和注册模块在 Django 自带的认证模块的基础上进行实现，因此在 后台--&gt;用户与授权 就可对注册用户进行权限分配和相应管理。我们使用 Django 自带的数据库 SQLite 来存放账户信息，重构了数据库表 auth_user 表，增加了用户邮箱字段，auth_user 中密码字段是加了 salt 的 sha256 值再经过 base64 编码之后的值，保障了用户的信息安全。
登录页注册页 重设密码功能调用第三方包 django-password-reset 进行实现
步骤一步骤二 漏洞检测 该模块主要是对目标 Web 系统进行安全漏洞扫描，包括 SQL 注入、跨站脚本攻击（XSS）、弱密码、中间件漏洞。中间件漏洞扫描包括对 Weblogic、Struts2、Tomcat 、Jboss、Drupal、Nexus 的已知漏洞进行检测，用户提供目标 URL 并选择 CVE 漏洞编号。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-25T11:05:17+08:00">
    <meta property="article:modified_time" content="2024-06-25T11:05:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">毕业设计 多功能 Web 应用渗透测试系统（源码&#43;论文）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p># 0 简介</p> 
<p>今天学长向大家介绍适合作为毕设的项目：</p> 
<p><strong>毕设分享 多功能 Web 应用渗透测试系统（源码+论文）</strong></p> 
<p><strong>项目获取：</strong></p> 
<p><a href="https://gitee.com/assistant-a/project-sharing" rel="nofollow">https://gitee.com/assistant-a/project-sharing</a></p> 
<h3><a id="_15"></a>项目介绍</h3> 
<h4><a id="_17"></a>系统简介</h4> 
<p>本项目为<strong>多功能 Web 应用渗透测试系统</strong>，包含<strong>漏洞检测、目录识别、端口扫描、指纹识别、域名探测、旁站探测、信息泄露检测</strong>等功能。</p> 
<h4><a id="_21"></a>项目功能</h4> 
<p><img src="https://images2.imgbox.com/ed/44/nHoS8doH_o.png" alt=""></p> 
<p>本系统通过 <code>旁站探测</code> 和 <code>域名探测</code> 功能对待检测网站进行资产收集，通过 <code>端口扫描</code>、<code>指纹识别</code>、<code>目录识别</code> 和 <code>信息泄露检测</code> 功能对待检测网站进行信息收集，通过收集的信息分析评估网站存在哪些安全隐患，然后使用 <code>漏洞检测</code> 功能揭示网站存在的漏洞以及危害等级并给出修复建议。通过这一系列的步骤，可以对 Web 应用进行全面检测，从而发现网站存在的安全隐患，因此用户可以针对相应的网络威胁做出应急响应，进而提升站点的安全性。</p> 
<h4><a id="_27"></a>相关技术</h4> 
<table><thead><tr><th>名称</th><th>Python</th><th>Django</th><th>SQLite</th><th>ECharts</th><th>Tabler</th><th>Layer</th><th>Docsify</th><th>SimpleUI</th><th>Boostrap Table</th></tr></thead><tbody><tr><td><strong>版本</strong></td><td><strong>3.7.0</strong></td><td><strong>3.1.4</strong></td><td><strong>3.35.2</strong></td><td><strong>5.0.1</strong></td><td><strong>1.0.0</strong></td><td><strong>3.2.0</strong></td><td><strong>4.11.6</strong></td><td><strong>2021.1.1</strong></td><td><strong>1.18.2</strong></td></tr></tbody></table> 
<h3><a id="_33"></a>项目首页</h3> 
<p>首页采用 ECharts 对漏洞扫描的漏洞等级、指纹识别组件、安全导航数据做了可视化图表展示，图表的风格没有统一，凑合看吧</p> 
<p><img src="https://images2.imgbox.com/9c/34/pzV0wKQN_o.png" alt=""></p> 
<h3><a id="_39"></a>身份验证</h3> 
<blockquote> 
 <p>新用户想要使用系统功能必须要注册登录，游客只能访问部分页面。本系统有普通用户和超级用户。普通用户可以使用本系统的所有功能，但是不能登录后台管理系统。超级用户不仅可以使用所用功能还可以登录后台管理系统中所有的用户权限和数据。</p> 
</blockquote> 
<p><strong>设计思路：</strong> 登录和注册模块在 Django 自带的认证模块的基础上进行实现，因此在 <code>后台--&gt;用户与授权</code> 就可对注册用户进行权限分配和相应管理。我们使用 Django 自带的数据库 SQLite 来存放账户信息，重构了数据库表 <code>auth_user</code> 表，增加了用户邮箱字段，auth_user 中密码字段是加了 salt 的 sha256 值再经过 base64 编码之后的值，保障了用户的信息安全。</p> 
<table><thead><tr><th>登录页</th><th><img src="https://images2.imgbox.com/8d/62/LHG04grE_o.png" alt=""></th></tr></thead><tbody><tr><td>注册页</td><td><img src="https://images2.imgbox.com/99/e1/imVd6iwH_o.png" alt=""></td></tr></tbody></table> 
<p>重设密码功能调用第三方包 <code>django-password-reset</code> 进行实现</p> 
<table><thead><tr><th>步骤一</th><th><img src="https://images2.imgbox.com/69/a9/B5O2BCKv_o.png" alt=""></th></tr></thead><tbody><tr><td>步骤二</td><td><img src="https://images2.imgbox.com/50/ab/KbmIMBYS_o.png" alt=""></td></tr></tbody></table> 
<h3><a id="_55"></a>漏洞检测</h3> 
<blockquote> 
 <p>该模块主要是对目标 Web 系统进行安全漏洞扫描，包括 SQL 注入、跨站脚本攻击（XSS）、弱密码、中间件漏洞。中间件漏洞扫描包括对 Weblogic、Struts2、Tomcat 、Jboss、Drupal、Nexus 的已知漏洞进行检测，用户提供目标 URL 并选择 CVE 漏洞编号。</p> 
</blockquote> 
<h4><a id="_59"></a>设计思路</h4> 
<p>该模块的全扫描、SQL 注入漏洞扫描、XSS 漏洞扫描、弱口令扫描、仅爬取是调用 AWVS API 进行实现。中间件漏洞扫描是基于脚本模拟网络请求实现。根据漏洞形成的原因，生成一些测试 payload 发送到目标系统，再由返回的状态码和数据来判断 payload 是否有效。</p> 
<h4><a id="_63"></a>实现效果</h4> 
<p><img src="https://images2.imgbox.com/bc/33/UAbRwjaV_o.png" alt=""></p> 
<p>点击扫描目标跳转到漏洞结果页：</p> 
<p><img src="https://images2.imgbox.com/41/17/fAZEuEZx_o.png" alt=""></p> 
<p>再点击扫描目标的跳转到漏洞详情页：</p> 
<p><img src="https://images2.imgbox.com/ab/e0/ZgijcXwu_o.png" alt=""></p> 
<h4><a id="_75"></a>详细实现</h4> 
<h5><a id="_77"></a>添加扫描目标</h5> 
<p>漏洞扫描最开始的工作是添加扫描目标到 AWVS 的扫描队列中。AWVS 提供了一个 API 接口: <code>/api/v1/targets</code>，使用 POST 请求， POST 请求参数为：<code>{"address":"XXXX.XXXX.XXXX","description":"xxxx","criticality":"10"}</code>。</p> 
<p>当目标添加成功后会返回一个 target_id ，这个值在所有扫描中是唯一的。通过 target_id 判断目标是否添加成功。添加完目标后并没有开始扫描，需要使用另一个 API 接口：<code>/api/v1/scans</code>，使用 POST 请求，传入刚刚添加目标生成的 target_id 和用户选择的扫描类型，POST 请求参数为：<code>{"target_id":"xxxxxxx","profile_id":"xxxxxxx"}</code>。开始扫描将会返回状态码 200。</p> 
<p>使用 Python 的第三方库 requests 来实现 API 接口访问。核心代码如下:</p> 
<pre><code class="prism language-python"><span class="token comment"># Target: POST请求/api/v1/targets</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
	<span class="token comment">#data包含目标URL和类型，auth_headers包含API_KEY</span>
   	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>targets_api<span class="token punctuation">,</span> auth_headers<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
target_id <span class="token operator">=</span> result<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'target_id'</span><span class="token punctuation">)</span>
   	<span class="token keyword">return</span> target_id
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
<span class="token keyword">return</span> <span class="token boolean">None</span>
<span class="token comment"># Scan: POST请求/api/v1/scans</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>scan_api<span class="token punctuation">,</span> data<span class="token punctuation">,</span> auth_headers<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
    status_code <span class="token operator">=</span> <span class="token number">200</span>
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
status_code <span class="token operator">=</span> <span class="token number">404</span>
<span class="token keyword">return</span> status_code
</code></pre> 
<p>API 接口已经实现，还需要获取用户输入的数据。由于本系统是基于 Django 实现的，所以使用 HTML+JavaScript 提供用户界面和接受和发送数据到后端，后端使用 Python 实现。首先在 <strong>urls.py</strong> 里面加入添加访问路径</p> 
<p><code>path('vuln_scan', views.vuln_scan, name='vuln_scan')</code></p> 
<p>在 <strong>views.py</strong> 中定义 <code>vuln_scan()</code> 函数接收前端的用户输入，并调用已经写好的 API 函数。用户输入的 url 为扫描的目标，扫描类型包括 SQL 注入、XSS 漏洞、弱口令和全扫描，其中全扫描就是扫描所有类型的漏洞，如果添加成功后返回的 target_id 不是 None，说明添加成功，就可以开始调用开始扫描的 API，开始扫描后返回状态码，为 200 则开始扫描，返回成功否则返回失败。核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token keyword">def</span> <span class="token function">vuln_scan</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#通过POST请求获取用户输入的URL和扫描类型</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ip'</span><span class="token punctuation">)</span>
    scan_type <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'scan_type'</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> Target<span class="token punctuation">(</span>API_URL<span class="token punctuation">,</span> API_KEY<span class="token punctuation">)</span>
    <span class="token comment">#将目标URL添加到扫描队列中</span>
    target_id <span class="token operator">=</span> t<span class="token punctuation">.</span>add<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token comment">#如果target_id不为None,则开始扫描</span>
    <span class="token keyword">if</span> target_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> Scan<span class="token punctuation">(</span>API_URL<span class="token punctuation">,</span> API_KEY<span class="token punctuation">)</span>
        status_code <span class="token operator">=</span> s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>target_id<span class="token punctuation">,</span> scan_type<span class="token punctuation">)</span>
        <span class="token keyword">if</span> status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> success<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> error<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后使用 JavaScript 来实现发送用户输入的数据，选择通过 POST 方法发送数据，并在发送之前判断用户输入的合法性，核心代码如下:</p> 
<pre><code class="prism language-javascript"><span class="token keyword">function</span> <span class="token function">get_scan_info</span><span class="token punctuation">(</span><span class="token parameter">ip <span class="token punctuation">,</span> scan_type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
# 使用<span class="token constant">POST</span>请求发送用户输入
        $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/vuln_scan'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">ip</span><span class="token operator">:</span> ip <span class="token punctuation">,</span>
            <span class="token literal-property property">scan_type</span><span class="token operator">:</span> scan_type
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token operator">...</span><span class="token operator">...</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token operator">...</span><span class="token operator">...</span> 
            <span class="token punctuation">}</span>
           <span class="token operator">...</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">var</span> domain <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[name=scan_url]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
# 使用循环判断用户选择的扫描类型
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">"scan_type"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">"scan_type"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> scan_type<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">"scan_type"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token function">get_scan_info</span><span class="token punctuation">(</span>domain<span class="token punctuation">,</span>scan_type<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
	<span class="token operator">...</span><span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>总体来说，通过上述的代码实现，实现了将用户输入通过 JavaScript 传输给后台，后台接收数据后将调用 AWVS API，然后 AWVS 开始根据用户输入开始扫描目标 URL，扫描结束后将结果保存在数据库中。实现效果如下：</p> 
<p><img src="https://images2.imgbox.com/bd/53/1ZAFzmX5_o.png" alt=""></p> 
<h5><a id="_162"></a>获取扫描结果</h5> 
<p>在上一小节中，将目标扫描的结果保存到数据库中，我们需要得到所有的扫描目标，<code>‘/api/v1/scans‘</code>，请求方式为 GET，请求成功后会返回所有扫描目标的信息，利用这个 API 可以实现展示所有扫描目标。要实现展示每个扫描目标的所有漏洞的功能，需要按照 target_id 来在所有扫描目标中搜索。AWVS 也提供了相应的 API，我们需要用到的 API 为：<code>/api/v1/vulnerabilities</code></p> 
<p><code>?q=severity:{int};criticality:{int};status:{string};cvss_score:{logicexpression};cvss_score:{logicexpression};target_id:{target_id};group_id:{group_id}</code>。请求方式为 GET。利用 target_id 搜索每个扫描目标。这也解决了漏洞细节页面的 URL 问题。当使用 target_id 搜索扫描目标成功时将会返回这个目标的所搜漏洞信息，包括这个目标包含的漏洞个数、每个漏洞的危险等级、扫描时间、扫描类型、扫描状态等信息。</p> 
<p>具体实现步骤和添加扫描目标大体相似，首先第一步使用 requests 来实现 API 请求。核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 获取所有扫描目标</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>scan_api<span class="token punctuation">,</span> self<span class="token punctuation">.</span>auth_headers<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span> 
scan_response<span class="token operator">=</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'scans'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> scan <span class="token keyword">in</span> scan_response<span class="token punctuation">:</span>
   scan<span class="token punctuation">[</span><span class="token string">'request_url'</span><span class="token punctuation">]</span> <span class="token operator">=</span> request_url
   scan_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>scan<span class="token punctuation">)</span>
<span class="token keyword">return</span> scan_list
<span class="token comment"># 搜索状态为“open“,对应target_id的扫描目标</span>
vuln_search_api<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>vuln_api<span class="token punctuation">}</span></span><span class="token string">?q=status:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>status<span class="token punctuation">}</span></span><span class="token string">;target_id:</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>target_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token comment"># 使用get方式请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>vuln_search_api<span class="token punctuation">,</span> auth_headers<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token comment"># 返回搜索结果目标的所有漏洞信息</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>text
<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre> 
<p>在 <strong>urls.py</strong> 中加入用户访问的 url ，这个需要提供一个 target_id 方便后续功能的实现，先获取所有目标的 target_id，然后使用循环将所有 target_id 加入到 urlpatterns 列表中。因为在 Django 中 views 函数通常只能使用一个 request 参数，由于这里需要将 target_id 传入到 views 函数中，使用正则匹配的 <code>“(?P&lt;target_id&gt;.*)$”</code> 接收传入的 target_id，在 views 里对应函数的第二个形参名必须和 <code>&lt;&gt;</code> 里的值一致才有效。核心代码如下：</p> 
<pre><code class="prism language-python">path<span class="token punctuation">(</span><span class="token string">'vulnscan'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vulnscan<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"vulnscan"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">for</span> target_id <span class="token keyword">in</span> target_ids<span class="token punctuation">:</span>
	  <span class="token comment">#使用正则匹配获取第二个参数：taget_id</span>
urlpatterns<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">(</span><span class="token string">r'^vuln_result/(?P&lt;target_id&gt;.*)$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vuln_result<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'vuln_result/'</span><span class="token operator">+</span>target_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>在 <strong>views.py</strong> 里定义函数 <code>vulnscan(request)</code> 获取所有对应的目标漏洞信息。使用 API 得到返回的漏洞危险等级、扫描目标 URL、每个漏洞唯一标识的 vuln_id、扫描类型、扫描处理时间，API 返回的扫描处理时间不是标准的时间格式，使用正则匹配的方式，将其转换为 <code>“%Y-%m-%d %H:%M:%S“</code> 的格式，再定义函数 <code>vuln_result(request,target_id)</code>，根据 target_id 获取扫描目标中所有漏洞信息，包括存在漏洞的 URL、漏洞类型、状态和处理时间等信息。核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">vuln_result</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> target_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> Vuln<span class="token punctuation">(</span>API_URL<span class="token punctuation">,</span> API_KEY<span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    vuln_details <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>d<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">"open"</span><span class="token punctuation">,</span> target_id<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>target_id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> target <span class="token keyword">in</span> vuln_details<span class="token punctuation">[</span><span class="token string">'vulnerabilities'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        item<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token builtin">id</span><span class="token punctuation">,</span>
            <span class="token string">'severity'</span><span class="token punctuation">:</span> target<span class="token punctuation">[</span><span class="token string">'severity'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'target'</span><span class="token punctuation">:</span> target<span class="token punctuation">[</span><span class="token string">'affects_url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'vuln_id'</span><span class="token punctuation">:</span>target<span class="token punctuation">[</span><span class="token string">'vuln_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'vuln_name'</span><span class="token punctuation">:</span> target<span class="token punctuation">[</span><span class="token string">'vt_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'time'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'T|\..*$'</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> target<span class="token punctuation">[</span><span class="token string">'last_seen'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token builtin">id</span> <span class="token operator">+=</span> <span class="token number">1</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'vuln-reslut.html'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token string">'data'</span><span class="token punctuation">:</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个子功能中，前端的数据展示使用的是 Bootstrap Table。这个模板有很多实用的功能，比如表格的搜索功能、分页展示功能等等，增加了用户体验。表格的数据在 HTML 中使用双花括号来接收，在 <strong>views.py</strong> 函数中返回的到相应的 HTML 页面时，将 data 字典一起返回。这样的返回方式可以将使用字典中的 key 值获取对应的 values 值。还可以是使用 if-else、for 等语句来分类展示数据。核心代码如下：</p> 
<pre><code class="prism language-django">{% for item in data %}
……………
# 这个只展示了扫描目标列，其他列类似 
&lt;a href="/vuln_detail/{<!-- -->{ item.vuln_id }}"&gt; {<!-- -->{ item.target }}&lt;/a&gt;
……………
{% endfor %}
</code></pre> 
<p>最后实现的效果如下图所示，根据每个扫描状态不同有不同的显示，使用红黄蓝绿来分类高危、中危、低危、info 等级的漏洞。最后展示了扫描的处理时间。</p> 
<p><img src="https://images2.imgbox.com/b5/f3/CIEhRenj_o.png" alt=""></p> 
<p>表格中扫描目标列可以点击进入查看目标的所有漏洞信息，如下图所示，展示了特定的扫描目标每个漏洞的危险等级、存在漏洞的 URL、漏洞的类型。<br> <img src="https://images2.imgbox.com/d1/07/H5Hcv7Pw_o.png" alt=""></p> 
<h5><a id="_240"></a>获取漏洞细节</h5> 
<p>在实现漏洞扫描和结果展示后，还需要获取每个漏洞的细节。包括导致漏洞的请求参数、测试的 payload、数据请求包、简要的修复建议等等。因为每个漏洞也存在一个唯一的标识 vuln_id，可以根据这个值查询指定漏洞的所有信息。使用的 API 为：<code>/api/v1/vulnerabilities/{vuln_id}</code>，请求方式为 GET。</p> 
<p>同样地，首先使用 requests 来实现 API 的调用，传入 vuln_id 来查询指定漏洞的所有信息，代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment"># 获取指定漏洞的相关信息</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> vuln_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    vuln_get_api <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>vuln_api<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>vuln_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
		<span class="token comment">#使用GET请求将vuln_id传给API，结果以json格式返回</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>vuln_get_api<span class="token punctuation">,</span> auth_headers<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
</code></pre> 
<p>在 <strong>urls.py</strong> 中添加漏洞细节的 url，这里与上一节展示扫描目标的所有漏洞类似，都用正则匹配的形式接收 <strong>views.py</strong> 里函数的第二个形参，但是这里不在使用 target_id 而是使用 vuln_id。代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> vuln_id <span class="token keyword">in</span> vuln_ids<span class="token punctuation">:</span>
	urlpatterns<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">(</span><span class="token string">r'^vuln_detail/(?P&lt;vuln_id&gt;.*)$'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vuln_detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'vuln_detail/'</span> <span class="token operator">+</span> vuln_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>在 <strong>views.py</strong> 里面定义 <code>vuln_details(request,vuln_id)</code> 函数，根据 vuln_id 查询指定漏洞的相关信息。该函数将 API 返回的值中有用的信息提取出来到字典 data 里，返回给 vuln-details.html 页面，使用 双花括号 来接收该漏洞的受影响的 URL、处理时间、漏洞类型、漏洞测试参数、数据请求包、简要的修复建议等信息。实现效果如下图所示。</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">vuln_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>vuln_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> Vuln<span class="token punctuation">(</span>API_URL<span class="token punctuation">,</span>API_KEY<span class="token punctuation">)</span>
    data <span class="token operator">=</span> d<span class="token punctuation">.</span>get<span class="token punctuation">(</span>vuln_id<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    parameter_list <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'details'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> features<span class="token operator">=</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>
    request_list <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'details'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> features<span class="token operator">=</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
    data_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'affects_url'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'affects_url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'last_seen'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'T|\..*$'</span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'last_seen'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'vt_name'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'vt_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'details'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'details'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;/p&gt;'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'request'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'request'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'recommendation'</span><span class="token punctuation">:</span> data<span class="token punctuation">[</span><span class="token string">'recommendation'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;br/&gt;'</span><span class="token punctuation">,</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        data_dict<span class="token punctuation">[</span><span class="token string">'parameter_name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> parameter_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        data_dict<span class="token punctuation">[</span><span class="token string">'parameter_data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> parameter_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    num <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        Str <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>request_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            Str <span class="token operator">+=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>request_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>request_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>contents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;strong&gt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;/strong&gt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\n'</span>
            num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    data_dict<span class="token punctuation">[</span><span class="token string">'Tests_performed'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Str
    data_dict<span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num
    data_dict<span class="token punctuation">[</span><span class="token string">'details'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data_dict<span class="token punctuation">[</span><span class="token string">'details'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'class="bb-dark"'</span><span class="token punctuation">,</span><span class="token string">'style="color: #ff0000"'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">"vuln-detail.html"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'data'</span><span class="token punctuation">:</span> data_dict<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/17/a4/pBCfvnPO_o.png" alt=""></p> 
<h5><a id="_POC__304"></a>基于 POC 验证的中间件漏洞扫描</h5> 
<blockquote> 
 <p>本系统使用 POC 脚本实现对一些中间件的漏洞扫描[7]，包括 Weblogic、Tomcat、Drupal、JBoss、Nexus、Struts2 等等。通过每个漏洞的特点，使用 Python 编写不同的 POC 脚本验证目标是否存在该漏洞。</p> 
</blockquote> 
<p>首先这里的用户界面和基于 AWVS 的漏洞扫描共用，单独加入了中间件漏洞 CVE 编号的选择。使用 JavaScript 发送用户输入的数据到后端。核心代码如下：</p> 
<pre><code class="prism language-javascript"># 使用<span class="token constant">POST</span>请求提交用户的输入
<span class="token keyword">function</span> <span class="token function">get_Middleware_scan</span><span class="token punctuation">(</span><span class="token parameter">ip <span class="token punctuation">,</span> CVE_id</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/Middleware_scan'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">ip</span><span class="token operator">:</span> ip <span class="token punctuation">,</span> #目标<span class="token constant">URL</span>
    <span class="token literal-property property">CVE_id</span><span class="token operator">:</span> CVE_id  #选择的<span class="token constant">CVE</span>编号
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
# 处理返回结果
      ………
      ………<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>将目标添加到数据库后，再查询数据库开始扫描，通过 AJAX 来访问 start_Middleware_scan 调用开始扫描的函数，由于扫描时间可能会很长，需要设置足够的 timeout 来等待扫描的结果返回。核心代码如下：</p> 
<pre><code class="prism language-javascript">$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
# 使用<span class="token constant">POST</span>请求发送目标<span class="token constant">URL</span>和<span class="token constant">CVE</span>编号，设置超时为<span class="token number">1</span>秒
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/start_Middleware_scan'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">ip</span><span class="token operator">:</span> ip<span class="token punctuation">,</span>
    <span class="token literal-property property">CVE_id</span><span class="token operator">:</span> CVE_id
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在 <strong>urls.py</strong> 里加入中间件漏洞扫描的访问路径，需要加入两个路径：<code>’Middleware_scan‘</code>，<code>‘start_Middleware_scan’</code>。前者是用户添加扫描目标时的路径，用于接收用户输入的目标和 CVE 编号之后将其插入数据库。后者是将目标插入数据库之后，通过时间戳、状态、目标 URL 以及 CVE 编号查询出来开始扫描。当扫描结束时更新数据库中对应扫描目标的状态。这样的设计可以实时的看到扫描的状态。</p> 
<p>数据库使用的是 SQLite，在 <strong>models.py</strong> 里创建一个数据库表 Middleware_vuln ，字段包括 ID、目标 URL、状态、结果、CVE 编号、时间戳。在 Django 里定义这个类表示我们需要创建的数据库，在 modles.py 里创建好之后，使用命令 <code>python manage.py makemigrations</code> 来记录 modles.py 的所有改动，并且将这个改动迁移到 migrations 这个文件下生成一个文件例如：0001 文件，如果你接下来还要进行改动的话可能生成就是另外一个文件不一定都是 0001 文件，但是这个命令并没有作用到数据库，再使用命令 <code>python manage.py migrate</code> 将根据刚刚检测到的改动来创建数据库表和字段属性。核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Middleware_vuln</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token comment"># 类名为数据库表名，变量名为字段名，字段属性定义如下</span>
	<span class="token builtin">id</span> <span class="token operator">=</span> models<span class="token punctuation">.</span>AutoField<span class="token punctuation">(</span>primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	status <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	result <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	CVE_id <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
	time <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> unique<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

</code></pre> 
<p>在添加目标和开始检测的时候我们需要插入数据库和查询数据库，这里使用 Django 的函数来处理数据库的增删查改。对于 Middleware_vule 的插入使用 <code>Middleware_vuln.objects.create(url, status, result, CVE_id, time)</code>，更新使用 <code>Middleware_vuln.objects.filter(time).update(status, result)</code>。还需要使用 try-except 来处理异常情况并打印出错信息。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">insert_Middleware_data</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> CVE_id<span class="token punctuation">,</span> Time<span class="token punctuation">,</span> result<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">"runing"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        Middleware_vuln<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">,</span> result<span class="token operator">=</span>result<span class="token punctuation">,</span> CVE_id<span class="token operator">=</span>CVE_id<span class="token punctuation">,</span> time<span class="token operator">=</span>Time<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"insert success"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"data insert error"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">def</span> <span class="token function">update_Middleware_data</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> CVE_id<span class="token punctuation">,</span> Time<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        Middleware_vuln<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">'runing'</span><span class="token punctuation">,</span> CVE_id<span class="token operator">=</span>CVE_id<span class="token punctuation">,</span> time<span class="token operator">=</span>Time<span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">"completed"</span><span class="token punctuation">,</span> result<span class="token operator">=</span>result<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"update success"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"data updata error"</span><span class="token punctuation">)</span>
</code></pre> 
<p>在 <strong>views.py</strong> 里定义 <code>Middleware_scan()</code> 获取用户输入，并插入到数据库中,其中时间戳 Time 为全局变量，作为后面开始扫描部分查询数据库的条件，在插入数据成功就返回 success(),否侧返回 error()，这里返回的函数时返回的状态码，success()返回的是 200，error()返回 404，通过上面 JavaScrip t 接收后做出判断，并弹出相应的提示框，核心代码如下：</p> 
<pre><code class="prism language-python">Time <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">Middleware_scan</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#使用POST请求获取用户输入，并将其插入数据库中。</span>
    <span class="token comment">#Time作为全局变量插入到数据库中，作为查询目标信息的条件。</span>
    <span class="token keyword">global</span> Time
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        url<span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ip'</span><span class="token punctuation">)</span>
        CVE_id <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'CVE_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">"_"</span><span class="token punctuation">)</span>
        Time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(t))时间戳转日期格式</span>
        <span class="token keyword">if</span> insert_Middleware_data<span class="token punctuation">(</span>url<span class="token punctuation">,</span> CVE_id<span class="token punctuation">,</span> Time<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> success<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> error<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>又定义函数 <code>start_Middleware_scan()</code>,实现将数据库中时间戳为 Time，状态为 run 的目标查询出来，根据 CVE 编号调用对应的 POC 脚本。最后更新数据库的扫描结果和扫描状态，由于在上一步中将数据插入数据库中可能会花费一点时间，所以需要使用 sleep() 等待数据插入后再进行查询工作和扫描工作，保证不遗漏扫描目标。</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@csrf_exempt</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">start_Middleware_scan</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'ip'</span><span class="token punctuation">)</span>
        ip<span class="token punctuation">,</span> port <span class="token operator">=</span> urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>netloc<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
        CVE_id <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'CVE_id'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#等待数据插入成功后在查询出来扫描</span>
        msg <span class="token operator">=</span> Middleware_vuln<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token string">'runing'</span><span class="token punctuation">,</span> CVE_id<span class="token operator">=</span>CVE_id<span class="token punctuation">,</span> time<span class="token operator">=</span>Time<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
        <span class="token comment">#扫描条目可能不止一条，需要使用循环来扫描</span>
        <span class="token keyword">for</span> target <span class="token keyword">in</span> msg<span class="token punctuation">:</span>
            result <span class="token operator">=</span> POC_Check<span class="token punctuation">(</span>target<span class="token punctuation">.</span>url<span class="token punctuation">,</span> target<span class="token punctuation">.</span>CVE_id<span class="token punctuation">)</span>
            <span class="token comment">#将扫描结果和状态更新</span>
            update_Middleware_data<span class="token punctuation">(</span>target<span class="token punctuation">.</span>url<span class="token punctuation">,</span> target<span class="token punctuation">.</span>CVE_id<span class="token punctuation">,</span> Time<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
        <span class="token keyword">return</span> success<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> error<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_418"></a>端口扫描</h3> 
<blockquote> 
 <p>本系统端口扫描当用户指定了目标 IP 地址后，系统正式工作，IP 传入后台对目标进行扫描，扫描完成后将开放端口和对应服务显示到前端界面上。在“按端口分布划分”和“按协议类型划分”两个栏目中对端口划分进行讲解，使用户免于查询的繁琐。同时该模块还将内置常见端口查询表，在此可进行端口及其对应服务和功能的相关查询和筛选，通过这一系列功能用户能够更加清晰的认识到目标主机开放了哪些服务，以此来分析可能存在漏洞的服务。</p> 
</blockquote> 
<h4><a id="_422"></a>设计思路</h4> 
<p>本系统端口扫描的实现方法是利用 Python 提供的库函数 Socket 进行调用，通过 TCP 三次握手与目标计算机的端口建立连接。当完成一次完整的三次握手时，则可以推断出端口和对应服务是开放的，反之则没有开放，为了提高了扫描的效率，本系统引入多线程扫描机制。</p> 
<h4><a id="_426"></a>实现效果</h4> 
<p><img src="https://images2.imgbox.com/0d/32/BrzTfIIz_o.png" alt=""></p> 
<h4><a id="_430"></a>详细实现</h4> 
<h5><a id="_432"></a>端口扫描</h5> 
<p>通过 Python 直接定义 socket，尝试与目标端口进行连接。本程序中使用 <code>sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM);</code> 的方式进行 TCP 连接，调用 <code>sock.connect_ex((ip,port))</code>，来尝试连接端口，如果端口开放则返回 0，否则返回错误代码。使用 try 语句来捕获异常，如果 socket 连接超时，则返回异常处理信息。核心代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">socket_scan</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> hosts<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''端口扫描核心代码'''</span>
    <span class="token keyword">global</span> PROBE
    socket<span class="token punctuation">.</span>setdefaulttimeout<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    ip<span class="token punctuation">,</span> port <span class="token operator">=</span> hosts<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>port<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">25</span><span class="token punctuation">:</span>
            <span class="token comment"># 创建套接字</span>
            sock <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
            <span class="token comment"># TCP/IP三次握手建立连接</span>
            result <span class="token operator">=</span> sock<span class="token punctuation">.</span>connect_ex<span class="token punctuation">(</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
<span class="token comment"># 调用socket.connect_ex((ip, port))，端口开放返回0，否则返回错误代码</span>
<span class="token comment"># 实现和nmap的全连接扫描类似的功能。</span>
            <span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                     <span class="token comment"># 成功建立TCP链接</span>
                self<span class="token punctuation">.</span>port<span class="token punctuation">.</span>append<span class="token punctuation">(</span>port<span class="token punctuation">)</span>          <span class="token comment"># 结果集中增加端口</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> PROBE<span class="token punctuation">:</span>                 <span class="token comment"># 通过HTTP1.1刺探</span>
                    sock<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 发送完整的TCP数据包</span>
                    response <span class="token operator">=</span> sock<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span>   <span class="token comment"># 接受最大256byte</span>
                    sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> response<span class="token punctuation">:</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> response<span class="token punctuation">:</span>
                    <span class="token keyword">for</span> pattern <span class="token keyword">in</span> SIGNS<span class="token punctuation">:</span>
                        pattern <span class="token operator">=</span> pattern<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b'|'</span><span class="token punctuation">)</span>
                        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>pattern<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>response<span class="token punctuation">,</span> re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">:</span> 
<span class="token comment"># 正则匹配banner信息与字典中的服务</span>
                            proto <span class="token operator">=</span> <span class="token string">'{}:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pattern<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>
                            self<span class="token punctuation">.</span>out<span class="token punctuation">.</span>append<span class="token punctuation">(</span>proto<span class="token punctuation">)</span>  <span class="token comment"># 添加至输出结果</span>
                            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>timeout<span class="token punctuation">,</span> ConnectionResetError<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 异常处理</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

</code></pre> 
<p>如果这样单线程（串行）阻塞运行，会耗费大量时间，因此，通过并发的方式，并发请求，提升扫描速度，通过对比扫描 300 个端口单线程需要 30s 左右，多线程仅需 10s 左右。</p> 
<p>本端口扫描功能中采用了并发 64 条线程来进行扫描，因此，在定义 run 方法时，每个线程扫描的两个端口号间差数为 64，在程序中使用 concurrent.futures 来实现。concurrent.futures 模块提供了一个高水平的接口用于异步执行调用。异步执行可以使用线程实现，使用 ThreadPoolExecutor，或者独立的进程，使用 ProcessPoolExecutor 实现。两者都实现相同接口，都是由抽象 Executor 类定义的。</p> 
<pre><code class="prism language-python">THREADNUM <span class="token operator">=</span> <span class="token number">64</span>  <span class="token comment"># 线程数</span>
<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ip<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#多线程扫描</span>
    hosts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">global</span> PORTS<span class="token punctuation">,</span> THREADNUM
    <span class="token keyword">for</span> i <span class="token keyword">in</span> PORTS<span class="token punctuation">:</span>
        hosts<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'{}:{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> concurrent<span class="token punctuation">.</span>futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>
                max_workers<span class="token operator">=</span>THREADNUM<span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
            executor<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>socket_scan<span class="token punctuation">,</span> hosts<span class="token punctuation">)</span>
    <span class="token keyword">except</span> EOFError<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre> 
<h5><a id="_494"></a>端口查询表</h5> 
<p>端口查询表功能通过收集网上端口信息建立端口查询库，涉及到的端口数据是存储在数据库中，包括端口 ID、端口号、端口对应服务、端口对应协议和端口所属状态。端口查询表结构如下表所示。</p> 
<table><thead><tr><th>字段名</th><th>字段类型</th><th>允许空</th><th>是否主键</th><th>备注</th></tr></thead><tbody><tr><td>id</td><td>integer</td><td>Not null</td><td>True</td><td>端口 ID</td></tr><tr><td>num</td><td>bigint</td><td>Not null</td><td>False</td><td>端口号</td></tr><tr><td>service</td><td>text</td><td>Not null</td><td>False</td><td>端口对应服务</td></tr><tr><td>protocol</td><td>Varchar(20)</td><td>Not null</td><td>False</td><td>端口对应协议</td></tr><tr><td>status</td><td>Varchar(10)</td><td>Not null</td><td>False</td><td>端口所属状态</td></tr></tbody></table> 
<p>端口查询数据库采用 Django Model 进行建立，字段包含端口号、服务、协议、和状态。实现代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">PortList</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''端口查询表'''</span>
    num<span class="token operator">=</span>models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'端口号'</span><span class="token punctuation">)</span>
    service<span class="token operator">=</span>models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'服务'</span><span class="token punctuation">)</span>
    protocol<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span>'
协议<span class="token string">',blank=True,default='</span>未知'<span class="token punctuation">)</span>
    status<span class="token operator">=</span>models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span>'
状态<span class="token string">',blank=True,default='</span>未知'<span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>  
	<span class="token comment"># 后台表头设置</span>
        verbose_name<span class="token operator">=</span>verbose_name_plural<span class="token operator">=</span><span class="token string">'端口列表'</span>
</code></pre> 
<p>数据库建立后需要进行后台注册，这样可以进入后台对数据进行管理，实现代码如下：</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@admin<span class="token punctuation">.</span>register</span><span class="token punctuation">(</span>PortList<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">PortListAdmin</span><span class="token punctuation">(</span>ImportExportModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置哪些字段显示在后台</span>
    list_display <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span> <span class="token string">'service'</span><span class="token punctuation">,</span> <span class="token string">'protocol'</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置num字段进入编辑界面 </span>
    list_display_links <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>  
    search_fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span> <span class="token string">'service'</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
    <span class="token comment"># 过滤器，按字段进行筛选</span>
    list_filter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'protocol'</span><span class="token punctuation">,</span><span class="token string">'status'</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置num为默认排序字段</span>
    ordering <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'num'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
    list_per_page <span class="token operator">=</span> <span class="token number">15</span>  <span class="token comment">#设置每页显示数据条数</span>
</code></pre> 
<h3><a id="_539"></a>指纹识别</h3> 
<blockquote> 
 <p>该模块采用提取指纹特征码特征信息来识别 Web 指纹，系统通过构造大量特殊的 HTTP 请求与 Web 服务器交互，从其响应数据包信息中提取提取指纹特征信息，然后通过与指纹数据库进行比对，从而获取到 Web 服务器及应用的组件信息和版本信息。通过发现这些特征信息并对它进行识别可以帮助我们快速地制定渗透策略，是渗透环节中关键的一步。</p> 
</blockquote> 
<h4><a id="_543"></a>设计思路</h4> 
<p>国内外对 Web 服务器及应用指纹的研究，主要都是通过构造大量特殊的 HTTP 请求与 Web 服务器交互，从其响应数据包信息中提取提取指纹特征信息，然后通过与指纹数据库进行比对，从而获取到 Web 服务器及应用的组件信息和版本信息。本文采用基于关键字特征匹配的方法实现指纹识别功能，为了使检测结果更加准确，对比网上一些主流的指纹数据库，对本系统的数据库进行了一系列优化。</p> 
<h4><a id="_547"></a>实现效果</h4> 
<p><img src="https://images2.imgbox.com/0d/3c/ECV9kWmo_o.png" alt=""></p> 
<h4><a id="_551"></a>详细实现</h4> 
<p>指纹识别流程中最关键的就是提取指纹特征这一步骤。提取指纹特征首先需要确定应该提取响应数据报文中的哪些数据。因此需要设计特征提取算法对响应数据报文进行分析，响应数据包是由响应行、响应头、响应体三部分构成。响应行由 HTTP 版本、状态码、状态码描述构成。响应头用于指示客户端如何处理响应体，响应头里面包含很多的组件信息，用于告诉浏览器响应的类型、字符编码服务器类型和字节大小等信息。响应体则是服务器根据客户端的请求返回给客户端的具体数据。响应头和响应体中包含了能够识别 Web 指纹组件的字段内容，因此，对响应头和响应体中关键字段的提取，是实现指纹识别技术的核心。</p> 
<p>指纹识别技术分为信息收集阶段和 Web 指纹识别阶段。</p> 
<p>(I)信息收集阶段:通过用户输入的 URL，收集 Web 应用的特定字段信息，返回页面关键字或者特殊文件和路径等这些特征。收集的关键数据越多对接下来的指纹识别结果越准确。</p> 
<p>(2)Web 指纹识别阶段:该阶段包含两部分，一部分是指纹库的建立，该部分主要负责从已知的 Web 应用程序中收集特征信息，并且建立指纹特征库；本文通过分析 HTTP 响应数据报文，设计了网站指纹的提取规则，通过分析响应头字段和响应体内容构建了一个指纹组件信息库，信息库采用 JSON 格式进行存储。指纹信息是从 Wappalyzer 和 FOFA 等平台上进行收集归纳的。另一部分从待测的 Web 应用程序中收集特征信息，并与指纹特征库中的数据进行比较，从而识别出待测的 Web 应用程序。</p> 
<h3><a id="_561"></a>目录扫描</h3> 
<blockquote> 
 <p>目录识别参照 dirsearch 实现，包含 PHP、asp、JSP 等网站类型进行扫描，还设置了递归扫描和自定义扫描选项。支持自定义前后缀或者子目录。</p> 
</blockquote> 
<h4><a id="_565"></a>设计思路</h4> 
<p>Dirsearch 扫描的结果通过 JSON 的格式保存在对应的路径下，因此我们可以减轻对数据库的依赖。获取的数据被分成 URL 和 TIMR，URL 下又分为 content-length、path、redirect、starus 四个部分。因为在 JSON 格式中被不同类型括号的数据会被 Django 解析为列表、字典等格式，因此我们需要对获得的 JSON 数据进行处理，将其转换为 Django 可以识别的数据，使之在前端进行读取。</p> 
<p>要正确解析数据，需要先理解 Python 数据结构和 JSON 数据的转换方法。我们基于当前的固定的 JSON 格式去解析取得的数据。</p> 
<h4><a id="_571"></a>实现效果</h4> 
<p><img src="https://images2.imgbox.com/a4/95/6swLISyR_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/4b/f8/VwaxJ4p4_o.png" alt=""></p> 
<h3><a id="_577"></a>信息泄露</h3> 
<p>该模块主要为用户提供常见的信息泄露检查。在前端直观的展示后台地址、配置文件等可能存在泄露的信息，在结果列表中，用户可以非常清晰的知道某个 Web 服务存在的信息泄露问题。</p> 
<p><img src="https://images2.imgbox.com/88/25/UecIQrHz_o.png" alt=""></p> 
<h3><a id="_583"></a>旁站探测</h3> 
<p>该模块主要对通过 IP 地址，直接获取与当前 IP 所在服务器上的其它网站， 本模块直接调用 API 实现</p> 
<p><img src="https://images2.imgbox.com/62/ed/lRHTa2MH_o.png" alt=""></p> 
<h3><a id="_589"></a>域名探测</h3> 
<p>该模块主要通过调用 API 来扫描网站的子域名</p> 
<p><img src="https://images2.imgbox.com/32/fa/NDguAKyi_o.png" alt=""></p> 
<h3><a id="_595"></a>安全导航</h3> 
<p>安全导航页面的灵感来自于 <a href="http://viggoz.com/" rel="nofollow">Viggo</a> 大佬开发的 <a href="http://webstack.cc/" rel="nofollow">Webstack</a> 项目，该项目是基于 Bootstrap 开发的纯前端页面，因此前端我沿用了 <code>Webstack</code> 的风格并融合了 <code>Tabler UI </code> 风格，并用 <code>Django </code> 写了后台管理，可在线对分类和条目进行管理。</p> 
<h4><a id="_599"></a>前端页面</h4> 
<p><img src="https://images2.imgbox.com/d8/f5/cgGh1SR5_o.png" alt=""></p> 
<h4><a id="_603"></a>后台管理页面</h4> 
<p><img src="https://images2.imgbox.com/3e/be/wwKJH9sl_o.png" alt=""></p> 
<h4><a id="_607"></a>数据库设计</h4> 
<p><img src="https://images2.imgbox.com/cf/a4/0gU5e1IX_o.png" alt=""></p> 
<h5><a id="Item_611"></a>导航条目-Item</h5> 
<blockquote> 
 <p>标题 title 描述 desc 网址 url 分类 category(外键) 图片 img 图片宽度 img_width</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''导航条目'''</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">)</span>
    desc <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'描述'</span><span class="token punctuation">)</span>
    url <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">'网址'</span><span class="token punctuation">,</span>blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    img <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token string">'https://jwt1399.top/favicon.png'</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'logo'</span><span class="token punctuation">)</span>
    img_width <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'图片宽度'</span><span class="token punctuation">)</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Category<span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'分类'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        verbose_name<span class="token operator">=</span>verbose_name_plural<span class="token operator">=</span><span class="token string">'导航条目'</span>
    <span class="token comment">#后台条目图片预览</span>
    <span class="token keyword">def</span> <span class="token function">img_admin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> format_html<span class="token punctuation">(</span> <span class="token string">'&lt;img src="{}" width="50px" height="50px" style="border-radius: 50%;" /&gt;'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>img<span class="token punctuation">,</span><span class="token punctuation">)</span>
    img_admin<span class="token punctuation">.</span>short_description <span class="token operator">=</span> <span class="token string">'logo预览'</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title
</code></pre> 
<h5><a id="Category_634"></a>条目分类-Category</h5> 
<blockquote> 
 <p>名称 name 排序 sort 是否添加到导航栏 add_menu 图标 icon</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Category</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""条目分类"""</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'名称'</span><span class="token punctuation">)</span>
    sort <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'显示顺序'</span><span class="token punctuation">)</span>
    add_menu <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'添加到导航栏'</span><span class="token punctuation">)</span>
    icon <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'fas fa-home'</span><span class="token punctuation">,</span>verbose_name<span class="token operator">=</span><span class="token string">'图标'</span><span class="token punctuation">)</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        verbose_name_plural<span class="token operator">=</span>verbose_name <span class="token operator">=</span> <span class="token string">'分类'</span>

    <span class="token comment">#统计分类对应条目数,并放入后台</span>
    <span class="token keyword">def</span> <span class="token function">get_items</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>item_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    get_items<span class="token punctuation">.</span>short_description <span class="token operator">=</span> <span class="token string">'条目数'</span>  <span class="token comment"># 设置后台显示表头</span>
    <span class="token comment">#后台图标预览</span>
    <span class="token keyword">def</span> <span class="token function">icon_data</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#引入Font Awesome Free 5.11.1</span>
        <span class="token keyword">return</span> format_html<span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;&lt;i class="{}"&gt;&lt;/i&gt;&lt;/h1&gt;'</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>icon<span class="token punctuation">)</span> <span class="token comment">#转化为&lt;i class="{self.icon}"&gt;&lt;/i&gt;</span>
    icon_data<span class="token punctuation">.</span>short_description <span class="token operator">=</span> <span class="token string">'图标预览'</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre> 
<h3><a id="_660"></a>文档页</h3> 
<p>将 Docsify 直接嵌入了 Django 中构造了文档页。</p> 
<p><img src="https://images2.imgbox.com/92/34/Hl45JNii_o.png" alt=""></p> 
<h3><a id="_666"></a>兼容性</h3> 
<h4><a id="Phone__668"></a>Phone 端</h4> 
<table><thead><tr><th>竖屏</th><th>横屏</th></tr></thead><tbody><tr><td><img src="https://images2.imgbox.com/c6/ae/ZMsbWIkb_o.png" alt=""></td><td><img src="https://images2.imgbox.com/9f/ba/0gsJnbEd_o.png" alt=""></td></tr></tbody></table> 
<h4><a id="Pad__674"></a>Pad 端</h4> 
<table><thead><tr><th>竖屏</th><th>横屏</th></tr></thead><tbody><tr><td><img src="https://images2.imgbox.com/c6/ff/EbkaIXdd_o.png" alt=""></td><td><img src="https://images2.imgbox.com/b4/4c/LFos1Rse_o.png" alt=""></td></tr></tbody></table> 
<h3><a id="_680"></a>版本变更记录</h3> 
<h4><a id="v2720210418_682"></a>v2.7（2021-04-18）</h4> 
<ul><li>新增 <code>域名探测</code> 功能；</li><li>新增 <code>中间件漏洞</code> 扫描；</li><li>修复 <code>忘记密码</code> 功能；</li><li>优化 AWVS 未启动报错信息；</li><li>优化 <code>用户登录</code> 逻辑；</li><li>优化 <code>漏扫详情</code> 页 UI；</li><li>优化导航栏布局；</li><li>优化若干小细节；</li></ul> 
<h4><a id="v2620210331_693"></a>v2.6（2021-03-31）</h4> 
<ul><li>新增漏洞 <code>扫描详情</code> 功能；</li><li>新增首页 <code>仪表盘</code>；</li><li>安全导航页导航栏 <code>移动端优化</code>；</li><li>安全导航页目录栏 <code>缩放优化</code>；</li><li>注册&amp;登录界面优化；</li><li>文档页 <code>导航栏优化</code>；</li><li>新增 <code>UI</code> 夜间模式；</li><li>修复若干 <code>UI</code> 显示 Bug；</li></ul> 
<h4><a id="v2520210302_704"></a>v2.5（2021-03-02）</h4> 
<ul><li>新增了 <code>漏洞扫描</code> 功能；</li><li>端口扫描页新增 <code>常见端口查询表</code>；</li><li>信息泄露页新增 <code>常见信息泄露列表</code>；</li><li>指纹识别页新增 <code>数据分析</code> 图表；</li><li>漏洞扫描页 <code>界面优化</code>；</li></ul> 
<h4><a id="v2420210222_712"></a>v2.4（2021-02-22）</h4> 
<ul><li>新增了 <code>目录识别</code> 功能；</li><li>重写 <code>欢迎页</code>；</li><li>安全导航页 <code>移动端界面</code> 适配；</li><li>安全导航页 <code>UI优化</code>；</li><li>目录识别页 <code>界面优化</code>；</li><li>指纹识别页新增 <code>常见指纹</code> 显示与搜索；</li><li>引入 <code>Boostrap Table</code> 实现分页；</li><li>淘汰 <code>LayUI</code> 改用 <code>Layer</code> 进行弹窗；</li><li>文档页增加 <code>导航栏</code>；</li></ul> 
<h4><a id="v2320210208_724"></a>v2.3（2021-02-08）</h4> 
<ul><li>全新的 <code>页面布局</code>；</li><li>UI 适配 <code>移动端</code>；</li><li>优化 <code>导航页布局</code>；</li><li>优化一系列 <code>UI</code> 显示问题； 
  <ul><li>优化了 <code>手机端页脚</code> 显示</li><li>优化了 <code>平板端导航条</code> 显示</li><li>页面底部增加 <code>回到顶部</code> 按钮</li><li>按钮 <code>触发跳转</code> 页面相对位置</li><li><code>回车键</code> 触发查询按钮</li><li>优化 <code>导航页页脚</code> 显示</li></ul> </li></ul> 
<h4><a id="v22_20210203_737"></a>v2.2 （2021-02-03）</h4> 
<ul><li>新增了 <code>信息泄露探测</code> 功能；</li><li>新增了 <code>旁站探测</code> 功能；</li><li>新增了导航页 <code>数据分析</code> 功能；</li><li>新增了基于 <code>Docsify</code> 的 <code>文档页</code>；</li><li>重构了 <code>静态文件static</code> 文件结构</li><li>优化了项目 <code>文件结构</code>；</li><li>美化了 <code>注册</code> 页面；</li><li>引入了 <code>动态粒子</code> 背景效果；</li><li>修复了一些 <code>UI</code> 显示问题；</li></ul> 
<h4><a id="v21_20210113_749"></a>v2.1 （2021-01-13）</h4> 
<ul><li>新增了 <code>指纹识别</code> 功能；</li><li>新增了 <code>登录和注册功能</code> 功能；</li><li>新增了 <code>欢迎页</code>；</li><li><s>新增了 <code>文档页</code>；</s></li><li>修复了一些 <code>UI</code> 显示问题；</li></ul> 
<h4><a id="v2020210104_757"></a>v2.0（2021-01-04）</h4> 
<ul><li>新增了 <code>端口扫描</code> 功能；</li><li>新增了 <code>安全导航</code> 功能；</li><li>连入了 <code>SQLite</code> 数据库，后续考虑改为 <code>MySQL</code>；</li><li>修复了一些 <code>UI</code> 显示问题；</li><li>修复了后台头部小图标无法显示问题；</li><li>新增了后台数据导入导出功能；</li></ul> 
<h4><a id="v1020201220_766"></a>v1.0（2020-12-20）</h4> 
<ul><li>基于 <code>Tabler</code> 框架构造了前端页面；</li><li>采用基于 <code>Python</code> 的 Django 框架编写后端；</li><li>引入了 <code>SimpleUi</code> 美化 Django 后台框架；</li><li>引入了 <code>Font-Awsome 5.15.1</code> 图标；</li></ul> 
<h3><a id="_773"></a>项目部署</h3> 
<h4><a id="_775"></a>本地部署</h4> 
<p>1.使用 Pycharm 打开本项目，在 Pycharm 的 <code>setting</code>—&gt;<code>Project Interpreter</code> 中 add 一个新的虚拟环境。</p> 
<p>2.在该虚拟环境下打开 Pycharm 自带 Terminal 运行 <code>pip install -r requirements.txt</code> 下载项目所需的第三方包。</p> 
<p>3.现在项目已经可以正常运行了，但是想要使用漏洞扫描功能，需要安装 AWVS，并在项目的 <code>setting.py</code> 中配置 AWVS 的 <code>API URL</code> 和 <code>API KEY</code></p> 
<p>4.忘记密码功能相关配置在项目的 <code>setting.py</code> 中修改</p> 
<pre><code class="prism language-python">EMAIL_HOST <span class="token operator">=</span> <span class="token string">'smtp.163.com'</span>
EMAIL_PORT <span class="token operator">=</span> <span class="token number">25</span>               <span class="token comment"># 发件箱的smtp服务器端口</span>
EMAIL_HOST_USER <span class="token operator">=</span> <span class="token string">'xxx'</span>       <span class="token comment"># 你的邮箱账号</span>
EMAIL_HOST_PASSWORD <span class="token operator">=</span><span class="token string">"xxx"</span>    <span class="token comment"># 邮箱授权码</span>
EMAIL_USE_TLS <span class="token operator">=</span> <span class="token boolean">True</span>          <span class="token comment"># 这里必须是 True，否则发送不成功</span>
EMAIL_FROM <span class="token operator">=</span> <span class="token string">'xxx'</span>            <span class="token comment"># 你的邮箱账号</span>
DEFAULT_FROM_EMAIL <span class="token operator">=</span> <span class="token string">'xxx'</span>    <span class="token comment"># 你的邮箱账号</span>
</code></pre> 
<p>5.创建超级管理员 <code>python manage.py createsuperuser</code></p> 
<p>6.默认账户：sectools/password…!!</p> 
<h2><a id="_801"></a>项目分享</h2> 
<p><strong>项目获取：</strong></p> 
<p><a href="https://gitee.com/assistant-a/project-sharing" rel="nofollow">https://gitee.com/assistant-a/project-sharing</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/985c4621ba8647f008d58ed898f9343c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【排序算法】—— 希尔排序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7ce543150e161a3d0ebdb3e776b1930a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot整合Druid：轻松实现SQL监控和数据库密码加密</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>