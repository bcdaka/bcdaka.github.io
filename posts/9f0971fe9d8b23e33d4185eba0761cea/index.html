<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot 整合 mybatis-plus - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9f0971fe9d8b23e33d4185eba0761cea/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="springboot 整合 mybatis-plus">
  <meta property="og:description" content="一.前言 1. mybatis-plus是什么
mybatis-plus是一个对mybati框架的拓展框架，它在mybatis框架基础上做了许多的增强，帮助我们快速的进行代码开发。目前企业开发中，使用mybati的项目基本会选择使用mybatis-plus来提升开发效率。
2.官网地址：MyBatis-Plus 🚀 为简化开发而生
二.项目集成 1. 项目中集成(示例用的springboot2.x&#43;mysql)
step1.引入依赖
&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.5.7&lt;/version&gt; &lt;/dependency&gt; step2.配置数据源
spring: datasource: driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://192.168.**.**:3306/rui username: root password: ****** step3.启动类添加注解 @MapperScan 指向mapper接口所在包
@SpringBootApplication @MapperScan(&#34;com.rui.mapper&#34;) @EnableFeignClients(defaultConfiguration = MyFeignConfiguration.class) public class AdminServerApplication { public static void main(String[] args) { SpringApplication.run(AdminServerApplication.class, args); } } step4.定义实体类
step5.编码测试：
（编码测试演示比较接近实际开发的代码，如果只是简单验证，用baseMapper就行了）
以下代码均为mybatis-plus提供的代码生成器生成的，如何使用在后续段落会讲，这里先看一下代码样子，眼熟以下
代码结构：
controller层：
@Slf4j @RestController @RequestMapping(&#34;/configInfo&#34;) public class ConfigInfoController { @Autowired private IConfigInfoService configInfoService; @GetMapping(&#34;/list&#34;) public List&lt;ConfigInfo&gt; listConfigs () { return configInfoService.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-03T21:26:28+08:00">
    <meta property="article:modified_time" content="2024-07-03T21:26:28+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot 整合 mybatis-plus</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一.前言</h2> 
<p>        1. mybatis-plus是什么</p> 
<p>        mybatis-plus是一个对mybati框架的拓展框架，它在mybatis框架基础上做了许多的增强，帮助我们快速的进行代码开发。目前企业开发中，使用mybati的项目基本会选择使用mybatis-plus来提升开发效率。</p> 
<p>        2.官网地址：<a href="https://baomidou.com/" rel="nofollow" title="MyBatis-Plus 🚀 为简化开发而生">MyBatis-Plus 🚀 为简化开发而生</a></p> 
<h2>二.项目集成</h2> 
<p>        1. 项目中集成(示例用的springboot2.x+mysql)</p> 
<p>        step1.引入依赖</p> 
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;3.5.7&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p>        step2.配置数据源</p> 
<pre><code>spring: 
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://192.168.**.**:3306/rui
    username: root
    password: ******</code></pre> 
<p>        step3.启动类添加注解 @MapperScan 指向mapper接口所在包</p> 
<pre><code>@SpringBootApplication
@MapperScan("com.rui.mapper")
@EnableFeignClients(defaultConfiguration = MyFeignConfiguration.class)
public class AdminServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(AdminServerApplication.class, args);
    }
}</code></pre> 
<p>        step4.定义实体类</p> 
<p><img alt="" height="737" src="https://images2.imgbox.com/8f/7a/i8rbzmnI_o.png" width="1200"></p> 
<p>        step5.编码测试：</p> 
<p>（编码测试演示比较接近实际开发的代码，如果只是简单验证，用baseMapper就行了）</p> 
<p>以下代码均为mybatis-plus提供的代码生成器生成的，如何使用在后续段落会讲，这里先看一下代码样子，眼熟以下</p> 
<p>代码结构：</p> 
<p><img alt="" height="699" src="https://images2.imgbox.com/70/9e/ANJTtlmc_o.png" width="890"></p> 
<p>controller层：</p> 
<pre><code>@Slf4j
@RestController
@RequestMapping("/configInfo")
public class ConfigInfoController {

    @Autowired
    private IConfigInfoService configInfoService;

    @GetMapping("/list")
    public List&lt;ConfigInfo&gt;  listConfigs () {
        return configInfoService.list();
    }

}</code></pre> 
<p>service层：</p> 
<p>        interface：</p> 
<pre><code>public interface IConfigInfoService extends IService&lt;ConfigInfo&gt; {

}</code></pre> 
<p>        impl:</p> 
<p>** 注意，这里继承了一个ServiceImpl 它是mybatis-plus提供的类，帮我们完成许DB操作**</p> 
<pre><code>@Service
public class ConfigInfoServiceImpl extends ServiceImpl&lt;ConfigInfoMapper, ConfigInfo&gt; implements IConfigInfoService {

}</code></pre> 
<p>mapper层：</p> 
<p>        mapper接口：</p> 
<p>** 注意，我们的mapper实现了 BaseMapper ,它是mybatis-plus提供的接口，有常用的CRUD**</p> 
<pre><code>public interface ConfigInfoMapper extends BaseMapper&lt;ConfigInfo&gt; {

}</code></pre> 
<p>        mapper.xml: （其实就是空的，如果后面开始有自定义sql，需要这里写）</p> 
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.rui.mapper.ConfigInfoMapper"&gt;

&lt;/mapper&gt;</code></pre> 
<p>        以上操作结束后，启动项目，postMan访问接口，发现可以正常访问数据库：</p> 
<p><img alt="" height="803" src="https://images2.imgbox.com/f0/cc/719cbegH_o.png" width="834"></p> 
<p></p> 
<p>在测试环节，大家可以发现我的service和mapper都是空的，但是却可以调用list方法访问数据库。</p> 
<p>其实，上面的编码中，我们在自己的业务Service中继承了抽象类ServiceImpl，ServiceImpl实现了IService这个接口中的方法，并定义了四个成员变量 baseMapper，entityClass， mapperClass，log，且这四个成员变量都是protected的，因此，在我们的业务Service中，我们可以直接调用IService的方法诸如saveAndUpdate，list，page等，也可以通过this.baseMapper 的方式来获取baseMapper对象，来调用baseMapper的方法</p> 
<h2 style="background-color:transparent;">三.使用技巧</h2> 
<h3>        1.理解mybatis-plus在代码中做的事情</h3> 
<p>        mybatis-plus为我们提供的<strong>最核心的功能其实就是对Mybatis的Mapper接口的增强</strong>，它<strong>提供了一个BaseMapper</strong>，一个mybatis的<strong>mapper接口继承了BaseMapper的话，就会被mybatis-plus进行增强，实现一系列的常用的数据库操</strong>。使用mybatis-plus最简单的办法其实就是引入mybatis-plus的依赖后，定义好Entity对象（实体对象），然后让mapper继承BaseMapper，最终我们使用baseMaper中的方法来进行开发。</p> 
<p>        看一个使用baseMapper的例子：</p> 
<p>        todo</p> 
<p>        但是直接使用baseMaper的话，有许多操作我们还需要自己写代码，比如一些批量操作，如batchSave(批量插入)等。所以，mybatis-plus还提供了ServiceImpl，来帮我们实现这些。</p> 
<p>        上面的编码中，我们在自己的业务Service中继承了抽象类ServiceImpl，ServiceImpl实现了IService这个接口中的方法，并定义了四个成员变量 baseMapper，entityClass， mapperClass，log，且这四个成员变量都是protected的，因此，在我们的业务Service中，我们可以直接调用IService的方法诸如saveAndUpdate，list，page等，也可以通过this.baseMapper 的方式来获取baseMapper对象，来调用baseMapper的方法。</p> 
<h3>        2.使用QueryWrapper进行查询</h3> 
<p>        以该service为例：<img alt="" height="250" src="https://images2.imgbox.com/5b/ba/w6tH9LHN_o.png" width="968"></p> 
<p>        QueryWrapper是我们工作中每天都啊哟使用的，场景非常多，我列出一些常见的场景，方便大家查阅</p> 
<h4>                1.1. 新增</h4> 
<pre><code>        ConfigInfo configInfo = mockData();
        this.baseMapper.insert(configInfo);</code></pre> 
<h4>                1.2. 删除</h4> 
<pre><code>        LambdaQueryWrapper&lt;ConfigInfo&gt; configInfoQueryWrapper = new LambdaQueryWrapper&lt;&gt;();
        configInfoQueryWrapper.eq(ConfigInfo::getId, 500L);
        this.baseMapper.delete(configInfoQueryWrapper);</code></pre> 
<h4>                1.3. 修改</h4> 
<pre><code>        // 方法1 根据id更新，直接传入对象
        ConfigInfo configInfo = mockData();
        this.baseMapper.updateById(configInfo);

        //方法2 使用wrapper更新 set代表要修改的字段 eq是条件为相等的isi
        UpdateWrapper&lt;ConfigInfo&gt; configInfoUpdateWrapper = Wrappers.update();
        configInfoUpdateWrapper.set("appName","chengxuyuanA");
        configInfoUpdateWrapper.set("groupId", "groupA");
        configInfoUpdateWrapper.eq("id", 500L);
        this.baseMapper.update(configInfoUpdateWrapper);</code></pre> 
<h4 style="background-color:transparent;">                1.4. 查询</h4> 
<p>                列表查询</p> 
<p>                        简单查询（简单的条件查询）</p> 
<pre><code>        // 查润groupId 为 5001的数据
        LambdaQueryWrapper&lt;ConfigInfo&gt; configInfoQueryWrapper = new LambdaQueryWrapper&lt;&gt;();
        configInfoQueryWrapper.eq(ConfigInfo::getGroupId, "5001");
        List&lt;ConfigInfo&gt; res = this.baseMapper.selectList(configInfoQueryWrapper);</code></pre> 
<p>                        复杂查询  (场景太多了，我就用一个包含 and， or， in ，between ，order by 的sql来表示一下用法)</p> 
<pre><code>        // select *
        // from config_info
        // where app_name like '%app%'
        //  and id between 1 and 50
        //  or (src_ip in ('1.0.1.1', '196.123.1.1', '0.0.0.0') and effect is not null)
        LambdaQueryWrapper&lt;ConfigInfo&gt; configInfoQueryWrapper = new LambdaQueryWrapper&lt;&gt;();
        configInfoQueryWrapper.like(ConfigInfo::getAppName, "app")
                        .between(ConfigInfo::getId, 1, 50);
        configInfoQueryWrapper.or(w-&gt;w.in(ConfigInfo::getSrcIp,srcips).isNotNull(ConfigInfo::getEffect));</code></pre> 
<p>                        分组聚合（其实这个一般不会用，考虑性能和优化，聚合的东西一般自己写sql）</p> 
<pre><code>        LambdaQueryWrapper&lt;ConfigInfo&gt; configInfoQueryWrapper = new LambdaQueryWrapper&lt;&gt;();
        configInfoQueryWrapper.groupBy(ConfigInfo::getGroupId);

        Long res = this.baseMapper.selectCount(configInfoQueryWrapper);</code></pre> 
<p>                分页查询</p> 
<pre><code>        Page page = new Page();
        page.setCurrent(1);
        page.setSize(10);

        LambdaQueryWrapper&lt;ConfigInfo&gt; configInfoQueryWrapper = new LambdaQueryWrapper&lt;&gt;();
        configInfoQueryWrapper.eq(ConfigInfo::getGroupId, "5001");
        IPage&lt;ConfigInfo&gt; pageData = this.page(page, configInfoQueryWrapper);</code></pre> 
<h4>        3.自定义sql查询</h4> 
<p>                3.1.使用自定义sql</p> 
<p>                和使用mybatis完全一样，这里不赘述了</p> 
<p>                3.2.对自定义sql分页</p> 
<p>                interface层</p> 
<pre><code class="hljs">IPage&lt;ConfigRation&gt; selectUserPage(Page page, @Param("configration") ConfigRation configrationVo);</code></pre> 
<p>                同mybatis的正常使用，但是在第一个参数加上一个Page入参</p> 
<h4>        4.字段映射及一些注解使用技巧</h4> 
<h5>                普通映射</h5> 
<p>                默认不需要注解，只要把数据库的字段的_去掉，换成小驼峰就行了</p> 
<p>                如果需要对象属性名和数据库字段名称不同，可以用如下注解：</p> 
<pre><code>@TableField(value = "data_Source")
private String dataType;</code></pre> 
<p>                java对象的属性在数据库中不存在</p> 
<pre><code>@TableField(exist = false)
@Schema(description = "是否绑定告警通知规则，true是。false否")
private Boolean isBindNoticeRule;</code></pre> 
<h5>                枚举映射</h5> 
<p>枚举注解@EnumValue，需要在枚举对象和java的实体类上都加：</p> 
<pre><code>public enum GenderEnum {
   
    MALE(0, "男"),
    FEMALE(1, "女");

    @EnumValue
    private final int code;
    private final String desc;

    GenderEnum(int code, String desc) {
   
        this.code = code;
        this.desc = desc;
    }
}</code></pre> 
<pre><code>@TableName("user")
public class User {
   
    @TableId
    private Long id;

    @TableField("gender")
    @EnumValue
    private GenderEnum gender;

    // 省略其他属性和方法
}</code></pre> 
<h5>                逻辑删除注解</h5> 
<p>逻辑删除需要进行一些配置：</p> 
<p>step1：增加配置</p> 
<pre><code>mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: deleted # 全局逻辑删除字段名
      logic-delete-value: 1 # 逻辑已删除值
      logic-not-delete-value: 0 # 逻辑未删除值</code></pre> 
<p>step2：在实体类中使用 <code>@TableLogic</code> 注解</p> 
<pre><code>public class User {
    // 其他字段...

    @TableLogic
    private Integer deleted;
}</code></pre> 
<h5>                多数据源注解</h5> 
<p>多数据源支持需要一个包  dynamic-datasource</p> 
<p>step1：maven增加依赖</p> 
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
  &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;${version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p>step2：数据源配置：</p> 
<pre><code>spring:
  datasource:
    dynamic:
      primary: master
      strict: false
      datasource:
        master:
          url: jdbc:mysql://xx.xx.xx.xx:3306/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver
        slave_1:
          url: jdbc:mysql://xx.xx.xx.xx:3307/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver
        slave_2:
          url: ENC(xxxxx)
          username: ENC(xxxxx)
          password: ENC(xxxxx)
          driver-class-name: com.mysql.jdbc.Driver</code></pre> 
<p>step3：<strong>使用 <code>@DS</code> 切换数据源</strong></p> 
<pre><code>@Service
@DS("slave")
public class UserServiceImpl implements UserService {

  @Autowired
  private JdbcTemplate jdbcTemplate;

  @Override
  @DS("slave_1")
  public List selectByCondition() {
    return jdbcTemplate.queryForList("select * from user where age &gt;10");
  }
}</code></pre> 
<h5>                字段忽略注解</h5> 
<pre><code>@TableField(exist = false)
private String companyname;</code></pre> 
<h2>四.常用插件</h2> 
<h4>       1.插件介绍</h4> 
<p>        介绍两个插件DataPermissionInterceptor， PaginationInnerInterceptor</p> 
<p>        DataPermissionInterceptor：</p> 
<p>        我们在开发中，很多项目有多租户，多组织的需求，不同租户和组织能看到的数据内容不同。假如业务数据我们用一个字段tenent_id区分不同租户的数据，那么我们希望开发者在编码时候，不需要刻意关注这个字段，正常写业务逻辑就好，有一个统一的拦截器能帮助我们在调用数据库时候把 tenent_id = {user_tenent_id} 这段sql加到查询语句中，DataPermissionInterceptor就是帮我们做这个事情的。</p> 
<p>        实际开发中，基本涉及到多组织，多租户的项目都会使用这个插件。如果大家在开发中发现使用了mybatis-plus的项目默认拼接了一些sql，可以尝试搜索DataPermissionInterceptor来找一下加的地方。</p> 
<p>        PaginationInnerInterceptor</p> 
<p>        分页插件, 对于单一数据库类型来说,都建议配置该值,避免每次分页都去抓取数据库类型，使用方法很简单，直接new PaginationInnerInterceptor(dataType就好)</p> 
<h4>        2.实战使用</h4> 
<p>step1： 注册拦截器，加入了上面介绍的俩插件</p> 
<pre><code>@Configuration
public class MybatisAutoConfiguration implements WebMvcConfigurer {

	@Bean
	public MybatisPlusInterceptor mybatisPlusInterceptor(@Autowired(required = false) DataPermissionHandler dataPermissionHandler) {
		MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
		if (dataPermissionHandler != null) {
			interceptor.addInnerInterceptor(new DataPermissionInterceptor(dataPermissionHandler));
		}
		interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.POSTGRE_SQL));
		return interceptor;
	}
}</code></pre> 
<p> step2:DataPermissionHandler编码</p> 
<pre><code>public class DataPermissionHandler extends MultiDataPermissionHandler {
    @Override
    public Expression getSqlSegment(Table table, Expression where, String mappedStatementId) {
        // 在此处编写自定义数据权限逻辑
        try {
            String sqlSegment = "..."; // 数据权限相关的 SQL 片段
            return CCJSqlParserUtil.parseCondExpression(sqlSegment);
        } catch (JSQLParserException e) {
            e.printStackTrace();
            return null;
        }
    }
}</code></pre> 
<h2>五.使用代码生成器</h2> 
<h4>        关于代码生成器</h4> 
<p>        代码生成器在工作中其实很常用，所以我觉得不了解的道友还是需要了解一下。</p> 
<h4>        1.代码生成器配置</h4> 
<p>        我使用的mybatis-plus是3.5.7，低于3.5版本的话，可能略有不同</p> 
<p>        step1：引入两个依赖包：</p> 
<pre><code>        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;
            &lt;version&gt;3.5.7&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- freemarker模板 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;
            &lt;version&gt;3.1.2&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<p>       step2：创建一个java类，用来生成代码，我一般喜欢在项目中建一个dev文件夹，放一些开发工具</p> 
<p>        结构如图：<img alt="" height="651" src="https://images2.imgbox.com/0b/a7/hmxHAoV6_o.png" width="1197"></p> 
<p>代码：</p> 
<pre><code class="language-java">public class CodeGenerator {

    public static void main(String[] args) {
        FastAutoGenerator.create("jdbc:mysql://192.168.**.**:3306/rui",
                        "root",
                        "******")
                .globalConfig(builder -&gt; builder
                        .author("rui")
                        .outputDir(Paths.get(System.getProperty("user.dir")) +
                                "/services/admin-server" +
                                "/src/main/java")
                        .commentDate("yyyy-MM-dd")
                )
                .packageConfig(builder -&gt; builder
                        .parent("com.rui")
                        .entity("entity")
                        .mapper("mapper")
                        .service("service")
                        .serviceImpl("service.impl")
                        .xml("mapper.xml")
                )
                .strategyConfig(builder -&gt; builder
                        // 要生成代码的表名称，不加下面这行就是全库生成
                        .addInclude("config_info") 
                        .entityBuilder()
                        .enableLombok()
                )
                .templateEngine(new FreemarkerTemplateEngine())
                .execute();
    }

}</code></pre> 
<h4>        2.代码生成器使用</h4> 
<p>        直接右键执行即可，执行后就会在项目中生成对应文件。默认的模板controller，service中是没有方法的，可以自己配置一下模板，放一些和前端交互的CRUD。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b06dc10ea1332a1ea1a59f3f40e78e56/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">优先级队列（堆）学的好，头发掉的少(Java版)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a12be63121323d444dc7042b842672fc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机网络——数据链路层（点对点协议PPP）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>