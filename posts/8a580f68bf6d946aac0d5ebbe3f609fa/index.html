<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>探索AI前沿：本地部署GPT-4o，打造专属智能助手！ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8a580f68bf6d946aac0d5ebbe3f609fa/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="探索AI前沿：本地部署GPT-4o，打造专属智能助手！">
  <meta property="og:description" content="目录
1、获取API_key
2、开始调用
3、openai连接异常
4、解决方法：
5、调用GPT-4o
1、获取API_key 这里就不多赘述了，大家可以参考下面这篇博客
怎么获取OpenAI的api-key【人工智能】https://blog.csdn.net/qq_51625007/article/details/137632747
2、开始调用 有了第一步的API_key，就可以直接调用GPT-4o，不说废话，直接上代码
import base64 from PIL import Image import os import io from openai import OpenAI from dotenv import load_dotenv load_dotenv(&#39;.env&#39;) # 这一步很关键 import os os.environ[&#34;http_proxy&#34;] = &#34;http://localhost:51121&#34; os.environ[&#34;https_proxy&#34;] = &#34;http://localhost:51121&#34; client = OpenAI(api_key=&#39;sk-xxxxxxxxxx&#39;) def encode_image(image): buffered = io.BytesIO() image.save(buffered, format=image.format) return base64.b64encode(buffered.getvalue()).decode(&#39;utf-8&#39;) def extract_image(query, image_file=None): messages = [{&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: [{&#34;type&#34;: &#34;text&#34;, &#34;text&#34;: query}]}] if image_file is not None: image = Image.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-22T00:44:34+08:00">
    <meta property="article:modified_time" content="2024-06-22T00:44:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">探索AI前沿：本地部署GPT-4o，打造专属智能助手！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E8%8E%B7%E5%8F%96API_key-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E8%8E%B7%E5%8F%96API_key" rel="nofollow">1、获取API_key</a></p> 
<p id="2%E3%80%81%E5%BC%80%E5%A7%8B%E8%B0%83%E7%94%A8-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%BC%80%E5%A7%8B%E8%B0%83%E7%94%A8" rel="nofollow">2、开始调用</a></p> 
<p id="3%E3%80%81openai%E8%BF%9E%E6%8E%A5%E5%BC%82%E5%B8%B8-toc" style="margin-left:40px;"><a href="#3%E3%80%81openai%E8%BF%9E%E6%8E%A5%E5%BC%82%E5%B8%B8" rel="nofollow">3、openai连接异常</a></p> 
<p id="4%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%9A-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%9A" rel="nofollow">4、解决方法：</a></p> 
<p id="5%E3%80%81%E8%B0%83%E7%94%A8GPT-4o-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E8%B0%83%E7%94%A8GPT-4o" rel="nofollow">5、调用GPT-4o</a></p> 
<hr> 
<h3>1、获取API_key</h3> 
<p>这里就不多赘述了，大家可以参考下面这篇博客</p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/qq_51625007/article/details/137632747" title="怎么获取OpenAI的api-key【人工智能】"><span class="link-card-box"><span class="link-title">怎么获取OpenAI的api-key【人工智能】</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/e3/a0/Avhql3pc_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/qq_51625007/article/details/137632747</span></span></a></p> 
<h3 id="2%E3%80%81%E5%BC%80%E5%A7%8B%E8%B0%83%E7%94%A8">2、开始调用</h3> 
<p>有了第一步的API_key，就可以直接调用GPT-4o，不说废话，直接上代码</p> 
<pre><code class="language-python">import base64
from PIL import Image
import os
import io
from openai import OpenAI
from dotenv import load_dotenv
load_dotenv('.env')

# 这一步很关键
import os
os.environ["http_proxy"] = "http://localhost:51121"
os.environ["https_proxy"] = "http://localhost:51121"

client = OpenAI(api_key='sk-xxxxxxxxxx')

def encode_image(image):
    buffered = io.BytesIO()
    image.save(buffered, format=image.format)
    return base64.b64encode(buffered.getvalue()).decode('utf-8')


def extract_image(query, image_file=None):
    messages = [{"role": "user", "content": [{"type": "text", "text": query}]}]

    if image_file is not None:
        image = Image.open(image_file)
        base64_image = encode_image(image)
        image_message = {
            "type": "image_url",
            "image_url": {"url": f"data:image/jpeg;base64,{base64_image}"}
        }
        messages[0]["content"].append(image_message)

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=messages,
        max_tokens=1024
    )
    return response.choices[0].message.content

if __name__ == "__main__":
    result = extract_image(query="图中有什么？",image_file="./截图20240621225613.png")
    print(result)
</code></pre> 
<h3 id="3%E3%80%81openai%E8%BF%9E%E6%8E%A5%E5%BC%82%E5%B8%B8">3、openai连接异常</h3> 
<blockquote> 
 <p>raise APIConnectionError(request=request) from err openai.APIConnectionError</p> 
</blockquote> 
<p>报错解释：</p> 
<p><code>openai.APIConnectionError</code> 是 OpenAI 的 Python 客户端在尝试连接到 OpenAI 服务器时遇到问题时抛出的异常。这通常表明客户端无法建立与服务器的连接，可能是由于网络问题、服务器宕机、API 密钥无效或过期等原因造成的。</p> 
<p>解决方法：</p> 
<ol><li> <p>检查网络连接：确保你的设备可以正常访问互联网。</p> </li><li> <p>检查 OpenAI 服务状态：访问 OpenAI 的官方网站或状态监控页面，查看是否有服务中断或维护通知。</p> </li><li> <p>检查 API 密钥：确保你使用的 API 密钥有效且未过期。</p> </li><li> <p>代理设置：如果你使用代理连接到互联网，确保你的代理设置正确配置，并且代理服务器运行正常。</p> </li></ol> 
<p>逐个问题排查，最终确定是代理设置问题</p> 
<h3 id="4%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%EF%BC%9A"><span style="color:#fe2c24;"><strong>4、解决方法：</strong></span></h3> 
<p>本文是在window11中执行：</p> 
<p>按照-----&gt;设置-----&gt;网络和Internet-----&gt;代理-----&gt;打开代理即可</p> 
<p class="img-center"><img alt="" height="406" src="https://images2.imgbox.com/af/8b/HOp4g7MK_o.png" width="819"></p> 
<p>点击设置：代理IP地址和端口（这里每个人的电脑端口可能不一样），将这两个在代码里指定如下：<strong>localhost</strong>或者<strong>127.0.0.1</strong>都可以！</p> 
<p>但是如果只设置这两个可能还不行，需要再增加一个<strong>load_doten</strong>使用.env文件去设置环境变量，将OPEN_API_KEY的值保存在.env文件中。</p> 
<p></p> 
<pre><code class="language-python">pip install python-dotenv #安装</code></pre> 
<pre><code class="language-python"># 这一步很关键
import os
from dotenv import load_dotenv
load_dotenv('.env')
os.environ["http_proxy"] = "http://localhost:51121"
os.environ["https_proxy"] = "http://localhost:51121"</code></pre> 
<p class="img-center"><img alt="" height="575" src="https://images2.imgbox.com/4c/5e/oxTleKc8_o.png" width="882"></p> 
<h3 id="5%E3%80%81%E8%B0%83%E7%94%A8GPT-4o">5、调用GPT-4o</h3> 
<p style="text-align:center;"><img alt="" height="478" src="https://images2.imgbox.com/ad/e1/At1UO2r4_o.png" width="343"></p> 
<p><strong>prompt="图中有什么？"</strong></p> 
<p><img alt="" height="745" src="https://images2.imgbox.com/45/4e/ZoEahby9_o.png" width="1200"></p> 
<blockquote> 
 <p>图中是一本讲解编程或计算机科学相关内容的书籍的某个页面。页面标题为“第2章 语言可用性的强化”，并且讨论了“空值”以及在C++中的使用。页面的内容包括以下几部分：</p> 
 <p>1. **章节标题**:<br>    ```<br>    第2章 语言可用性的强化<br>    ```</p> 
 <p>2. **小节标题**:<br>    ```<br>    2.1 常量<br>    nullptr<br>    ```</p> 
 <p>3. **文本说明和代码片段**:<br>    - 文中详细讲解了nullptr的背景与使用。<br>    - 提到了传统C++中的NULL以及其在现代C++中的替代 `nullptr`。<br>    - 展示了代码示例，演示了如何使用 `nullptr` 避免一些常见的错误。<br>    - 包含了多个C++代码片段，例如：<br>      ```cpp<br>      char *ch = NULL;<br>      void foo(char*);<br>      void foo(int);<br>      foo(NULL);<br>      #include &lt;iostream&gt;<br>      #include &lt;type_traits&gt;<br>      void foo(char*);<br>      void foo(int);<br>      int main() {<!-- --><br>          if (std::is_same&lt;decltype(NULL), decltype(0)&gt;::value)<br>              std::cout &lt;&lt; "NULL == 0" &lt;&lt; std::endl;<br>          if (std::is_same&lt;decltype(NULL), decltype((void*)0)&gt;::value)<br>              std::cout &lt;&lt; "NULL == (void *)0" &lt;&lt; std::endl;<br>          if (std::is_same&lt;decltype(NULL), std::nullptr_t&gt;::value)<br>              std::cout &lt;&lt; "NULL == nullptr" &lt;&lt; std::endl;<br>      }<br>      ```</p> 
 <p>4. **页面底部的页码**:<br>    ```<br>    12<br>    ```</p> 
 <p>以上就是该页面的主要内容。</p> 
</blockquote> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a26c48c7ecc9ac573f3388c312d519c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式3-分类</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/16ad255de0e657c98d243ccf7d27a38f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">20240622 每日AI必读资讯</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>