<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>策略模式实现搜索功能 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d4e877a83d5070634c88da5174796275/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="策略模式实现搜索功能">
  <meta property="og:description" content="概念： 策略模式是一种行为设计模式，用于定义一系列算法，将他们封装起来，并使他们可以互相替换。使用策略模式可以让代码更加灵活，且易于扩展和维护
背景： 假设你有一个功能需要多种不同的算法或行为实现（如不同的排序方式、不同的支付方式、不同的搜索方式等），这些行为是相似的。但是在细节上有所不同。
核心： 将这些可变的行为封装为不同的策略累，并定义一个接口来规范这些策略的实现。这样就可以在运行时动态切换策略，而不需要修改客户端的代码
用途： 1、替换不同的算法：可以根据需要动态的选择不同的算法或实现。比如不同的折扣策略，不同的支付方式
2、简化条件语句：用策略模式可以替换大量的if-else语句
3、提高可扩展性：新增一种行为时，只需要添加一个新的策略类，而不需要修改现有的代码
基本结构： 1、策略接口（Strategy Interface）：定义所有策略类必须实现的方法。
2、具体策略类（Concrete Strategy）：每个类实现具体的算法或行为。
3、上下文类（Context）：持有一个策略对象并调用策略的方法。
示例： 假设你有一个电商平台，根据用户的等级（普通用户、会员、VIP）给予不同的折扣。我们可以使用策略模式来实现不同的折扣逻辑。
1、定义策略接口
// 策略接口，定义计算折扣的方法 public interface IDiscountStrategy { decimal CalculateDiscount(decimal price); } 2、实现具体的策略类
// 普通用户的折扣策略：无折扣 public class NoDiscountStrategy : IDiscountStrategy { public decimal CalculateDiscount(decimal price) { return price; // 无折扣 } } // 会员的折扣策略：10% 折扣 public class MemberDiscountStrategy : IDiscountStrategy { public decimal CalculateDiscount(decimal price) { return price * 0.9m; // 10% 折扣 } } // VIP 的折扣策略：20% 折扣 public class VIPDiscountStrategy : IDiscountStrategy { public decimal CalculateDiscount(decimal price) { return price * 0.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-05T15:03:56+08:00">
    <meta property="article:modified_time" content="2024-09-05T15:03:56+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">策略模式实现搜索功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h6>概念：</h6> 
<p>策略模式是一种行为设计模式，用于定义一系列算法，将他们封装起来，并使他们可以互相替换。使用策略模式可以让代码更加灵活，且易于扩展和维护</p> 
<h6>背景：</h6> 
<p>假设你有一个功能需要多种不同的算法或行为实现（如不同的排序方式、不同的支付方式、不同的搜索方式等），这些行为是相似的。但是在细节上有所不同。</p> 
<h6>核心：</h6> 
<p>将这些可变的行为封装为不同的策略累，并定义一个接口来规范这些策略的实现。这样就可以在运行时动态切换策略，而不需要修改客户端的代码</p> 
<h6>用途：</h6> 
<p>1、替换不同的算法：可以根据需要动态的选择不同的算法或实现。比如不同的折扣策略，不同的支付方式</p> 
<p>2、简化条件语句：用策略模式可以替换大量的if-else语句</p> 
<p>3、提高可扩展性：新增一种行为时，只需要添加一个新的策略类，而不需要修改现有的代码</p> 
<h6>基本结构：</h6> 
<p>1、策略接口（Strategy Interface）：定义所有策略类必须实现的方法。</p> 
<p>2、具体策略类（Concrete Strategy）：每个类实现具体的算法或行为。</p> 
<p>3、上下文类（Context）：持有一个策略对象并调用策略的方法。</p> 
<h6>示例：</h6> 
<p>假设你有一个电商平台，根据用户的等级（普通用户、会员、VIP）给予不同的折扣。我们可以使用策略模式来实现不同的折扣逻辑。</p> 
<p>1、定义策略接口</p> 
<pre><code class="hljs">// 策略接口，定义计算折扣的方法
public interface IDiscountStrategy
{
    decimal CalculateDiscount(decimal price);
}
</code></pre> 
<p>2、实现具体的策略类</p> 
<pre><code class="hljs">// 普通用户的折扣策略：无折扣
public class NoDiscountStrategy : IDiscountStrategy
{
    public decimal CalculateDiscount(decimal price)
    {
        return price; // 无折扣
    }
}

// 会员的折扣策略：10% 折扣
public class MemberDiscountStrategy : IDiscountStrategy
{
    public decimal CalculateDiscount(decimal price)
    {
        return price * 0.9m; // 10% 折扣
    }
}

// VIP 的折扣策略：20% 折扣
public class VIPDiscountStrategy : IDiscountStrategy
{
    public decimal CalculateDiscount(decimal price)
    {
        return price * 0.8m; // 20% 折扣
    }
}
</code></pre> 
<p>3、创建上下文</p> 
<pre><code class="hljs">// 上下文类，用于选择和执行策略
public class ShoppingCart
{
    private IDiscountStrategy _discountStrategy;

    // 通过构造函数设置策略
    public ShoppingCart(IDiscountStrategy discountStrategy)
    {
        _discountStrategy = discountStrategy;
    }

    // 计算折扣后的价格
    public decimal CalculateTotalPrice(decimal price)
    {
        return _discountStrategy.CalculateDiscount(price);
    }
}
</code></pre> 
<p>4、使用策略模式</p> 
<pre><code class="hljs">public class Program
{
    public static void Main(string[] args)
    {
        decimal originalPrice = 100m; // 商品的原价

        // 普通用户
        IDiscountStrategy noDiscount = new NoDiscountStrategy();
        ShoppingCart cartForNormalUser = new ShoppingCart(noDiscount);
        Console.WriteLine($"普通用户的价格: {cartForNormalUser.CalculateTotalPrice(originalPrice)}");

        // 会员用户
        IDiscountStrategy memberDiscount = new MemberDiscountStrategy();
        ShoppingCart cartForMember = new ShoppingCart(memberDiscount);
        Console.WriteLine($"会员用户的价格: {cartForMember.CalculateTotalPrice(originalPrice)}");

        // VIP 用户
        IDiscountStrategy vipDiscount = new VIPDiscountStrategy();
        ShoppingCart cartForVIP = new ShoppingCart(vipDiscount);
        Console.WriteLine($"VIP 用户的价格: {cartForVIP.CalculateTotalPrice(originalPrice)}");
    }
}
</code></pre> 
<p>运行结果：</p> 
<pre><code class="hljs">普通用户的价格: 100
会员用户的价格: 90
VIP 用户的价格: 80
</code></pre> 
<p></p> 
<p>理解了策略模式后，开始设计搜索功能。</p> 
<p>1、定义策略接口</p> 
<pre><code class="hljs">        public interface ISearchStrategy
        {
            List&lt;PatientData&gt; ExecuteSearch();
        }</code></pre> 
<p>2、实现具体的策略类，由于搜索条件有可能同时满足，所以定义组合策略类</p> 
<pre><code class="hljs">        /// &lt;summary&gt;
        /// 日期搜索
        /// &lt;/summary&gt;
        public class DateSearchStrategy : ISearchStrategy
        {
            private DateTime _date1, _date2;
            public DateSearchStrategy(DateTime date1, DateTime date2)
            {
                _date1 = date1.Date;
                _date2 = date2.Date;
            }

            public List&lt;PatientData&gt; ExecuteSearch()
            {
                var list = PatientDataAccess.GetAllPatientArchives();

                var filteredList = list.Where(p =&gt;
                {
                    DateTime inspectDate;
                    bool isValidDate = DateTime.TryParse(p.inspectDate, out inspectDate);
                    return isValidDate &amp;&amp; inspectDate &gt;= _date1 &amp;&amp; inspectDate &lt;= _date2;
                }).ToList();

                return filteredList;
            }
        }

        /// &lt;summary&gt;
        /// 病人姓名搜索
        /// &lt;/summary&gt;
        public class PatientNameSearchStrategy : ISearchStrategy
        {
            private string _name;
            public PatientNameSearchStrategy(string name)
            {
                _name = name;
            }
            public List&lt;PatientData&gt; ExecuteSearch()
            {
                var list = PatientDataAccess.GetAllPatientArchives();

                var filteredList = list.Where(p =&gt;
                {
                    //return p.Name == _name;         //不能用==，string为引用类型
                    return p.Name.Equals(_name);
                }).ToList();

                return filteredList;
            }
        }
        /// &lt;summary&gt;
        /// 医生姓名搜索
        /// &lt;/summary&gt;
        public class DoctorNameSearchStrategy : ISearchStrategy
        {
            private string _name;
            public DoctorNameSearchStrategy(string name)
            {
                _name = name;
            }
            public List&lt;PatientData&gt; ExecuteSearch()
            {
                var list = PatientDataAccess.GetAllPatientArchives();

                var filteredList = list.Where(p =&gt;
                {
                    return p.inspectdoctor.Equals(_name);
                }).ToList();

                return filteredList;
            }
        }

        /// &lt;summary&gt;
        /// 组合搜索
        /// &lt;/summary&gt;
        public class CompositeSearchStrategy : ISearchStrategy
        {
            private readonly List&lt;ISearchStrategy&gt; _strategies = new List&lt;ISearchStrategy&gt;();

            public void AddStrategy(ISearchStrategy strategy)
            {
                _strategies.Add(strategy);
            }

            public List&lt;PatientData&gt; ExecuteSearch()
            {
                if (_strategies.Count == 0)         //没有条件达成，显示全部（看需求)。
                {
                    return PatientDataAccess.GetAllPatientArchives();
                }
                List&lt;PatientData&gt; resultList = _strategies[0].ExecuteSearch();  //获取第一结果

                for (int i = 1; i &lt; _strategies.Count; i++)
                {
                    //求与余下结果的交集
                    resultList = resultList.Where(p1 =&gt; _strategies[i].ExecuteSearch().Any(p2 =&gt; p1.inspectNumber == p2.inspectNumber)).ToList();
                }

                return resultList;
            }
        }</code></pre> 
<p>3、定义上下文</p> 
<pre><code class="hljs">        public class SearchService
        {
            /// &lt;summary&gt;
            /// 搜索服务
            /// &lt;/summary&gt;
            /// &lt;param name="startDate"&gt;开始日期&lt;/param&gt;
            /// &lt;param name="endDate"&gt;结束日期&lt;/param&gt;
            /// &lt;param name="patientName"&gt;病人名字&lt;/param&gt;
            /// &lt;param name="doctorName"&gt;医生姓名&lt;/param&gt;
            /// &lt;returns&gt;&lt;/returns&gt;
            public List&lt;PatientData&gt; Search(string startDate, string endDate, string patientName, string doctorName)
            {
                var searchStrateay = new CompositeSearchStrategy();

                //根据输入条件选择

                if (!string.IsNullOrWhiteSpace(startDate) &amp;&amp; !string.IsNullOrWhiteSpace(endDate))
                {
                    if (DateTime.Parse(startDate) &gt; DateTime.Parse(endDate))
                    {
                        MessageBox.Show("开始时间需早于结束时间！");
                        return null;
                    }
                    searchStrateay.AddStrategy(new DateSearchStrategy(DateTime.Parse(startDate), DateTime.Parse(endDate)));
                }

                if (!string.IsNullOrWhiteSpace(patientName))
                {
                    searchStrateay.AddStrategy(new PatientNameSearchStrategy(patientName));
                }
                if (!string.IsNullOrWhiteSpace(doctorName))
                {
                    searchStrateay.AddStrategy(new DoctorNameSearchStrategy(doctorName));
                }

                return searchStrateay.ExecuteSearch();
            }
        }</code></pre> 
<p>4、狠狠的使用它</p> 
<pre><code class="hljs">        /// &lt;summary&gt;
        /// 搜索功能实现
        /// &lt;/summary&gt;
        /// &lt;param name="sender"&gt;&lt;/param&gt;
        /// &lt;param name="e"&gt;&lt;/param&gt;
        private void btnSearch_Click(object sender, EventArgs e)
        {
            var searchService = new SearchService();
            var list = searchService.Search(tbStartDate.Text, tbEndDate.Text, cbPatientName.Text, cbDoctorName.Text);
            if (!(list == null))
            {
                list.Reverse();
                dataGridView1.AutoGenerateColumns = false;     //固定标题栏
                dataGridView1.DataSource = list;
                lblTotal.Text = "查询总数：" + dataGridView1.RowCount;
            }
        }</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5c2ebc50dcd01d291914d14a394fd5f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA多线程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e760174a5156c3e2b5d73b086925be51/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机毕业设计选题推荐-企业会议室管理系统-Java/Python项目实战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>