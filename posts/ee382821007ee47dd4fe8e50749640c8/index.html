<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【课程设计/毕业设计】python酒店客房管理系统源码&#43;开发文档 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ee382821007ee47dd4fe8e50749640c8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【课程设计/毕业设计】python酒店客房管理系统源码&#43;开发文档">
  <meta property="og:description" content="项目介绍 一直想做一款酒店管理系统，看了很多优秀的开源项目但是发现没有合适的。于是利用空闲休息时间开始自己写了一套管理系统。学习过程中遇到问题可以咨询留言。
在线体验 http://hotel.gitapp.cn/
源码地址 https://github.com/geeeeeeeek/python_hotel
界面预览 功能介绍 系统分为后台和前台两部分。
后台的主要功能：
房间管理：管理系统可以录入、修改和查询房间的基本信息，如房间名称、配套、价格、备注等。类型管理：系统可以管理房间的类型信息，包括类型的名称等。标签管理：管理标签录入、修改和查询标签的信息。评论管理：管理和浏览整个网站的评论信息。订单管理：管理和浏览整个网站的订单信息。用户管理：管理和浏览网站的用户信息，可以新增、编辑和删除用户。统计分析：系统可以根据房间的活动数据和会员参与度进行统计和分析，帮助管理员了解整个系统的状况。消息管理：房间管理员可以在系统上发布消息，整个网站的用户都能收到。系统信息：管理员可以查看系统的基本信息，包括系统名称、服务器信息、内存信息、cpu信息、软件信息等。 前台的主要功能：
注册登录：用户通过注册和登录后，才能使用网站。门户浏览：用户进入首页后，可以浏览房间列表信息，包括最新、最热、推荐。智能推荐：详情页右侧的热门推荐。用户中心：包括用户基本资料修改、用户邮箱推送、消息。我的订单：包括我预订的房间的信息。模糊搜索：顶部搜索功能，支持模糊搜索房间信息。房间评论：详情页下侧用户可以评论房间。 开发环境 后端： Python 3.8 &#43; Django 3.2前端： Javascript &#43; Vue数据库：MySQL 5.7开发平台：Pycharm &#43; vscode运行环境：Windows 10/11 关键技术 前端技术栈 ES6、vue、vuex、vue-router、vue-cli、axios、antd后端技术栈 Python、Django、pip 后端技术 django框架 Django是一款基于Python开发的全栈式一体化Web应用框架。2003年问世之初，它只是美国一家报社的内部工具，2005年7月使用BSD许可证完成了开源。Django采用MTV设计模式，即Model（模型）&#43; Template（模板）&#43; View（视图）。它遵循MVC设计，并且内置了对象关系映射（ORM）层，使得开发者无需关心底层的数据存取细节，可以更专注于业务逻辑的开发。
Django的目的是削减代码量，简单且迅速地搭建以数据库为主体的复杂Web站点。它是全栈式框架，因此安装起来很简单，而且使用者众多。这使得Django除具有完备的官方文档之外，还有大量的关联文档、丰富的第三方库可供使用。与其他框架相比，Django用起来要轻松得多。
优点：
提供了定义序列化器Serializer的方法。可以快速根据Django ORM或者其他库自动序列化或反序列化。提供了丰富的类视图MIXIN扩展类。可以简化视图的编写。具有丰富的定制层级。包括函数视图、类视图，还可以将视图与自动生成API结合，满足各种需求。支持多种身份认证和权限认证方式。内置了限流系统。 前端技术 npm：node.js的包管理工具，用于统一管理我们前端项目中需要用到的包、插件、工具、命令等，便于开发和维护。ES6：Javascript的新版本，ECMAScript6的简称。利用ES6我们可以简化我们的JS代码，同时利用其提供的强大功能来快速实现JS逻辑。vue-cli：Vue的脚手架工具，用于自动生成Vue项目的目录及文件。vue-router： Vue提供的前端路由工具，利用其我们实现页面的路由控制，局部刷新及按需加载，构建单页应用，实现前后端分离。vuex：Vue提供的状态管理工具，用于统一管理我们项目中各种数据的交互和重用，存储我们需要用到数据对象。Ant-design：基于MVVM框架Vue开源出来的一套前端ui组件。 运行步骤 后端运行步骤 (1) 安装mysql数据库，启动服务
(2) 打开cmd命令行，进入mysql，并新建数据库
mysql -u root -p CREATE DATABASE IF NOT EXISTS python_hotel DEFAULT CHARSET utf8 COLLATE utf8_general_ci; (3) 恢复sql数据
use xxx source xxxx.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-19T10:44:14+08:00">
    <meta property="article:modified_time" content="2024-03-19T10:44:14+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【课程设计/毕业设计】python酒店客房管理系统源码&#43;开发文档</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>项目介绍</h3> 
<p>一直想做一款酒店管理系统，看了很多优秀的开源项目但是发现没有合适的。于是利用空闲休息时间开始自己写了一套管理系统。学习过程中遇到问题可以咨询留言。</p> 
<h3><a id="_5"></a>在线体验</h3> 
<p><a href="http://hotel.gitapp.cn/" rel="nofollow">http://hotel.gitapp.cn/</a></p> 
<h3><a id="_10"></a>源码地址</h3> 
<p><a href="https://github.com/geeeeeeeek/python_hotel">https://github.com/geeeeeeeek/python_hotel</a></p> 
<h3><a id="_15"></a>界面预览</h3> 
<p><img src="https://images2.imgbox.com/21/e3/5NNslp6Z_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/a0/tv6LhOd0_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b4/f2/GRnWzQs2_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1e/a2/PbpaVg8a_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_25"></a>功能介绍</h3> 
<p>系统分为后台和前台两部分。</p> 
<p>后台的主要功能：</p> 
<ul><li>房间管理：管理系统可以录入、修改和查询房间的基本信息，如房间名称、配套、价格、备注等。</li><li>类型管理：系统可以管理房间的类型信息，包括类型的名称等。</li><li>标签管理：管理标签录入、修改和查询标签的信息。</li><li>评论管理：管理和浏览整个网站的评论信息。</li><li>订单管理：管理和浏览整个网站的订单信息。</li><li>用户管理：管理和浏览网站的用户信息，可以新增、编辑和删除用户。</li><li>统计分析：系统可以根据房间的活动数据和会员参与度进行统计和分析，帮助管理员了解整个系统的状况。</li><li>消息管理：房间管理员可以在系统上发布消息，整个网站的用户都能收到。</li><li>系统信息：管理员可以查看系统的基本信息，包括系统名称、服务器信息、内存信息、cpu信息、软件信息等。</li></ul> 
<p>前台的主要功能：</p> 
<ul><li>注册登录：用户通过注册和登录后，才能使用网站。</li><li>门户浏览：用户进入首页后，可以浏览房间列表信息，包括最新、最热、推荐。</li><li>智能推荐：详情页右侧的热门推荐。</li><li>用户中心：包括用户基本资料修改、用户邮箱推送、消息。</li><li>我的订单：包括我预订的房间的信息。</li><li>模糊搜索：顶部搜索功能，支持模糊搜索房间信息。</li><li>房间评论：详情页下侧用户可以评论房间。</li></ul> 
<h3><a id="_51"></a>开发环境</h3> 
<ul><li>后端： Python 3.8 + Django 3.2</li><li>前端： Javascript + Vue</li><li>数据库：MySQL 5.7</li><li>开发平台：Pycharm + vscode</li><li>运行环境：Windows 10/11</li></ul> 
<h3><a id="_59"></a>关键技术</h3> 
<ul><li>前端技术栈 ES6、vue、vuex、vue-router、vue-cli、axios、antd</li><li>后端技术栈 Python、Django、pip</li></ul> 
<h4><a id="_64"></a>后端技术</h4> 
<h5><a id="django_66"></a>django框架</h5> 
<p>Django是一款基于Python开发的全栈式一体化Web应用框架。2003年问世之初，它只是美国一家报社的内部工具，2005年7月使用BSD许可证完成了开源。Django采用MTV设计模式，即Model（模型）+ Template（模板）+ View（视图）。它遵循MVC设计，并且内置了对象关系映射（ORM）层，使得开发者无需关心底层的数据存取细节，可以更专注于业务逻辑的开发。</p> 
<p>Django的目的是削减代码量，简单且迅速地搭建以数据库为主体的复杂Web站点。它是全栈式框架，因此安装起来很简单，而且使用者众多。这使得Django除具有完备的官方文档之外，还有大量的关联文档、丰富的第三方库可供使用。与其他框架相比，Django用起来要轻松得多。</p> 
<p>优点：</p> 
<ul><li>提供了定义序列化器Serializer的方法。可以快速根据Django ORM或者其他库自动序列化或反序列化。</li><li>提供了丰富的类视图MIXIN扩展类。可以简化视图的编写。</li><li>具有丰富的定制层级。包括函数视图、类视图，还可以将视图与自动生成API结合，满足各种需求。</li><li>支持多种身份认证和权限认证方式。</li><li>内置了限流系统。</li></ul> 
<h4><a id="_79"></a>前端技术</h4> 
<ul><li>npm：node.js的包管理工具，用于统一管理我们前端项目中需要用到的包、插件、工具、命令等，便于开发和维护。</li><li>ES6：Javascript的新版本，ECMAScript6的简称。利用ES6我们可以简化我们的JS代码，同时利用其提供的强大功能来快速实现JS逻辑。</li><li>vue-cli：Vue的脚手架工具，用于自动生成Vue项目的目录及文件。</li><li>vue-router： Vue提供的前端路由工具，利用其我们实现页面的路由控制，局部刷新及按需加载，构建单页应用，实现前后端分离。</li><li>vuex：Vue提供的状态管理工具，用于统一管理我们项目中各种数据的交互和重用，存储我们需要用到数据对象。</li><li>Ant-design：基于MVVM框架Vue开源出来的一套前端ui组件。</li></ul> 
<h3><a id="_88"></a>运行步骤</h3> 
<h4><a id="_90"></a>后端运行步骤</h4> 
<p>(1) 安装mysql数据库，启动服务</p> 
<p>(2) 打开cmd命令行，进入mysql，并新建数据库</p> 
<pre><code>mysql -u root -p
CREATE DATABASE IF NOT EXISTS python_hotel DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
</code></pre> 
<p>(3) 恢复sql数据</p> 
<pre><code>use xxx
source xxxx.sql
</code></pre> 
<p>(4) 修改settings.py中的配置信息</p> 
<p>(5) 安装python 3.8</p> 
<p>(6) 安装依赖包</p> 
<pre><code>pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple
</code></pre> 
<p>(7) 运行命令</p> 
<pre><code>python manage.py runserver 
</code></pre> 
<h4><a id="_119"></a>前端运行步骤</h4> 
<p>(1) 安装node 16</p> 
<p>(2) cmd进入web目录下，安装依赖，执行:</p> 
<pre><code>npm install 
</code></pre> 
<p>(3) 运行项目</p> 
<pre><code>npm run dev
</code></pre> 
<h3><a id="_132"></a>代码结构</h3> 
<h4><a id="_134"></a>后端结构</h4> 
<pre><code>server  
├── myapp            // 主应用
│       └── auth                     // 认证管理
│       └── middlewares              // 中间件
│       └── permission               // 权限
│       └── views                    // 视图与接口（主要业务代码）
│       └── models.py                // 状态码
│       └── serializers.py           // 状态码
│       └── urls.py                  // 状态码
│       └── utils.py                 // 状态码
├── entity             // 实体类
├── interceptor        // 拦截器
├── mapper             // 数据库映射
├── server             // 配置目录
├── upload             // 静态资源目录
├── requiements.txt    // 依赖项
</code></pre> 
<h4><a id="_155"></a>前端结构</h4> 
<pre><code>├── build                      // 构建相关  
├── public                     // 公共文件
│   ├── favicon.ico            // favicon图标
│   └── index.html             // html模板
├── src                        // 源代码
│   ├── api                    // 所有请求
│   ├── assets                 // 主题 字体等静态资源
│   ├── router                 // 路由
│   ├── store                  // 全局 store管理
│   ├── utils                  // 全局公用方法
│   ├── views                  // view界面
│   ├── App.vue                // 入口页面
│   ├── main.js                // 入口 加载组件 初始化等
│   └── settings.js            // 系统配置
├── .eslintignore              // 忽略语法检查
├── .eslintrc.js               // eslint 配置项
├── .gitignore                 // git 忽略项
├── babel.config.js            // babel.config.js
├── package.json               // package.json
└── vite.config.js             // vue配置
</code></pre> 
<h3><a id="_180"></a>数据库设计</h3> 
<h4><a id="_182"></a>需求分析</h4> 
<p>在房间管理系统中，需要存储和管理房间信息、评论信息、分类信息、标签信息、用户信息、通知信息、日志信息。</p> 
<p>实体设计如下：</p> 
<ul><li>房间(thing)</li><li>分类(classification)</li><li>标签(tag)</li><li>用户(user)</li><li>订单(order)</li><li>评价(comment)</li><li>日志(log)</li><li>通知(notice)</li></ul> 
<p>关系如下：</p> 
<ul><li>一个房间有一个分类</li><li>一个分类可以对应多个房间</li><li>一个房间有多个标签</li><li>一个标签可以对应多个房间</li></ul> 
<p>数据表设计如下：</p> 
<pre><code>// 房间
Table thing {
    thing_id int [pk]
    classification_id int [ref: &gt; C.classification_id]
    tag_id int [ref: &lt;&gt; tag.tag_id]
    title varchar // 标题
    cover varchar
    price varchar
    window varchar // 是否有窗
    address varchar // 地址 
    sheshi varchar // 设施
    status int // 上线0 下架1
    description text
    create_time datetime
    pv int
    wish_count int
    recommend_count int
    wish int [ref: &lt;&gt; user.user_id]
    collect int [ref: &lt;&gt; user.user_id]
 }
 // 分类
 Table classification as C {
   classification_id int [pk]
   pid int
   title varchar
   create_time datetime
 }
 // 标签
 Table tag {
   tag_id int [pk]
   title varchar
   create_time datetime
 }
 // 评论
 Table comment {
   comment_id int [pk]
   content varchar
   user_id int [ref: &gt; user.user_id]
   thing_id int [ref: &gt; thing.thing_id]
   comment_time datetime
   like_count int
 }
 // 用户
 Table user {
   user_id int [pk]
   role varchar // 1管理员 2普通用户 3演示帐号
   status int // 0正常 1封号
   username varchar
   password varchar
   nickname varchar
   avatar varchar
   description varchar
   wish int [ref: &lt;&gt; thing.thing_id]
   email varchar
   mobile varchar
   score int // 积分
   push_email varchar // 推送邮箱
   push_switch int  // 推送开关
   token varchar
   admin_token varchar
 }
  
 
 
 Table login_log {
   log_id int [pk]
   username varchar
   ip varchar
   log_time datetime
 }
 
 // 操作日志
 Table op_log {
   id int [pk]
   re_ip varchar
   re_time datetime
   re_url varchar
   re_method varchar
   re_content varchar
   access_time varchar
 }
 
 // 异常日志
 Table error_log {
   id int [pk]
   ip varchar
   method varchar
   content varchar
   log_time varchar
 }
 // 订单
 Table order {
   order_id int [pk]
   user_id int [ref: &gt; user.user_id]
   thing_id int [ref: &gt; thing.thing_id]
   status varchar // 1未支付 2已支付 7订单取消
   create_time datetime
   pay_time datetime // 支付时间
   receiver_name varchar // 收货人姓名
   receiver_address varchar // 地址
   receiver_phone varchar // 收货人电话
   remark varchar // 备注
 } 
 
 
 // 通知
 Table notice {
   id int [pk]
   content varchar
   create_time datetime
 }
 

</code></pre> 
<h3><a id="_319"></a>开发过程</h3> 
<p>无论是房间管理、用户管理、标签管理、分类管理、评价管理、日志管理、消息管理等功能都是基于springboot+vue框架开发的，开发流程是：</p> 
<ul><li>第一步：编写实体</li><li>第二步：编写序列化层</li><li>第三步：编写views层</li><li>第四步：编写界面和API</li></ul> 
<p>下面用房间管理功能来演绎这个流程，其它的管理功能都是这个流程。</p> 
<p>第一步：编写实体类</p> 
<p>在server下的myapp下的models.py下面新建Thing类。并写入如下代码：</p> 
<pre><code>class Thing(models.Model):
    STATUS_CHOICES = (
        ('0', '上架'),
        ('1', '下架'),
    )
    id = models.BigAutoField(primary_key=True)
    classification = models.ForeignKey(Classification, on_delete=models.CASCADE, blank=True, null=True,
                                       related_name='classification_thing')
    tag = models.ManyToManyField(Tag, blank=True)
    title = models.CharField(max_length=100, blank=True, null=True)
    cover = models.ImageField(upload_to='cover/', null=True)
    description = models.TextField(max_length=1000, blank=True, null=True)
    price = models.CharField(max_length=50, blank=True, null=True) 
    mobile = models.CharField(max_length=50, blank=True, null=True)
    age = models.CharField(max_length=10, blank=True, null=True) 
    location = models.CharField(max_length=50, blank=True, null=True) 
    status = models.CharField(max_length=1, choices=STATUS_CHOICES, default='0')
    create_time = models.DateTimeField(auto_now_add=True, null=True)
    pv = models.IntegerField(default=0)
    recommend_count = models.IntegerField(default=0)
    wish = models.ManyToManyField(User, blank=True, related_name="wish_things")
    wish_count = models.IntegerField(default=0)
    collect = models.ManyToManyField(User, blank=True, related_name="collect_things")
    collect_count = models.IntegerField(default=0)

    class Meta:
            db_table = "b_thing"
</code></pre> 
<p>第二步：编写序列化层</p> 
<p>在server下的myapp下的serializers.py下新建ThingSerializer类，并写入代码：</p> 
<pre><code>class ThingSerializer(serializers.ModelSerializer):
    # 额外字段
    classification_title = serializers.ReadOnlyField(source='classification.title')

    class Meta:
        model = Thing
        fields = '__all__'

</code></pre> 
<p>第三步：编写views层</p> 
<p>在server的myapp下的views下，新建Thing.py代码，并写入代码，实现增删改查</p> 
<pre><code>
# 查
@api_view(['GET'])
def list_api(request):
    if request.method == 'GET':
        keyword = request.GET.get("keyword", None)
        c = request.GET.get("c", None)
        tag = request.GET.get("tag", None)
        if keyword:
            things = Thing.objects.filter(title__contains=keyword).order_by('create_time')
        elif c:
            classification = Classification.objects.get(pk=c)
            things = classification.classification_thing.all()
        elif tag:
            tag = Tag.objects.get(id=tag)
            print(tag)
            things = tag.thing_set.all()
        else:
            things = Thing.objects.all().order_by('create_time')

        serializer = ThingSerializer(things, many=True)
        return APIResponse(code=0, msg='查询成功', data=serializer.data)

# 删
@api_view(['GET'])
def detail(request):

    try:
        pk = request.GET.get('id', -1)
        thing = Thing.objects.get(pk=pk)
    except Thing.DoesNotExist:
        utils.log_error(request, '对象不存在')
        return APIResponse(code=1, msg='对象不存在')

    if request.method == 'GET':
        serializer = ThingSerializer(thing)
        return APIResponse(code=0, msg='查询成功', data=serializer.data)

# 增
@api_view(['POST'])
@authentication_classes([AdminTokenAuthtication])
def create(request):

    if isDemoAdminUser(request):
        return APIResponse(code=1, msg='演示帐号无法操作')

    serializer = ThingSerializer(data=request.data)
    if serializer.is_valid():
        serializer.save()
        return APIResponse(code=0, msg='创建成功', data=serializer.data)
    else:
        print(serializer.errors)
        utils.log_error(request, '参数错误')

    return APIResponse(code=1, msg='创建失败')

# 改
@api_view(['POST'])
@authentication_classes([AdminTokenAuthtication])
def update(request):

    if isDemoAdminUser(request):
        return APIResponse(code=1, msg='演示帐号无法操作')

    try:
        pk = request.GET.get('id', -1)
        thing = Thing.objects.get(pk=pk)
    except Thing.DoesNotExist:
        return APIResponse(code=1, msg='对象不存在')

    serializer = UpdateThingSerializer(thing, data=request.data)
    if serializer.is_valid():
        serializer.save()
        return APIResponse(code=0, msg='查询成功', data=serializer.data)
    else:
        print(serializer.errors)
        utils.log_error(request, '参数错误')

    return APIResponse(code=1, msg='更新失败')

# 删
@api_view(['POST'])
@authentication_classes([AdminTokenAuthtication])
def delete(request):

    if isDemoAdminUser(request):
        return APIResponse(code=1, msg='演示帐号无法操作')

    try:
        ids = request.GET.get('ids')
        ids_arr = ids.split(',')
        Thing.objects.filter(id__in=ids_arr).delete()
    except Thing.DoesNotExist:
        return APIResponse(code=1, msg='对象不存在')
    return APIResponse(code=0, msg='删除成功')


</code></pre> 
<p>然后将该接口添加到urls.py中即可。</p> 
<p>第四步：编写界面和API</p> 
<p>打开前端web工程，在views文件夹下新建thing.vue文件，并编写代码：</p> 
<pre><code>&lt;template&gt;
  &lt;div&gt;
    &lt;!--页面区域--&gt;
    &lt;div class="page-view"&gt;
      &lt;div class="table-operations"&gt;
        &lt;a-space&gt;
          &lt;a-button type="primary" @click="handleAdd"&gt;新增&lt;/a-button&gt;
          &lt;a-button @click="handleBatchDelete"&gt;批量删除&lt;/a-button&gt;
          &lt;a-input-search addon-before="名称" enter-button @search="onSearch" @change="onSearchChange" /&gt;
        &lt;/a-space&gt;
      &lt;/div&gt;
      &lt;a-table
          size="middle"
          rowKey="id"
          :loading="data.loading"
          :columns="columns"
          :data-source="data.dataList"
          :scroll="{ x: 'max-content' }"
          :row-selection="rowSelection"
          :pagination="{
          size: 'default',
          current: data.page,
          pageSize: data.pageSize,
          onChange: (current) =&gt; (data.page = current),
          showSizeChanger: false,
          showTotal: (total) =&gt; `共${total}条数据`,
        }"
      &gt;
        &lt;template #bodyCell="{ text, record, index, column }"&gt;
          &lt;template v-if="column.key === 'operation'"&gt;
            &lt;span&gt;
              &lt;a @click="handleEdit(record)"&gt;编辑&lt;/a&gt;
              &lt;a-divider type="vertical" /&gt;
              &lt;a-popconfirm title="确定删除?" ok-text="是" cancel-text="否" @confirm="confirmDelete(record)"&gt;
                &lt;a href="#"&gt;删除&lt;/a&gt;
              &lt;/a-popconfirm&gt;
            &lt;/span&gt;
          &lt;/template&gt;
        &lt;/template&gt;
      &lt;/a-table&gt;
    &lt;/div&gt;

    &lt;!--弹窗区域--&gt;
    &lt;div&gt;
      &lt;a-modal
          :visible="modal.visile"
          :forceRender="true"
          :title="modal.title"
          width="880px"
          ok-text="确认"
          cancel-text="取消"
          @cancel="handleCancel"
          @ok="handleOk"
      &gt;
        &lt;div&gt;
          &lt;a-form ref="myform" :label-col="{ style: { width: '80px' } }" :model="modal.form" :rules="modal.rules"&gt;
            &lt;a-row :gutter="24"&gt;
              &lt;a-col span="24"&gt;
                &lt;a-form-item label="客房标题" name="title"&gt;
                  &lt;a-input placeholder="请输入" v-model:value="modal.form.title"&gt;&lt;/a-input&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="分类" name="classification"&gt;
                  &lt;a-select placeholder="请选择"
                            allowClear
                            :options="modal.cData"
                            :field-names="{ label: 'title', value: 'id',}"
                            v-model:value="modal.form.classification"&gt;
                  &lt;/a-select&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="标签"&gt;
                  &lt;a-select mode="multiple" placeholder="请选择" allowClear v-model:value="modal.form.tag"&gt;
                    &lt;template v-for="item in modal.tagData"&gt;
                      &lt;a-select-option :value="item.id"&gt;{<!-- -->{item.title}}&lt;/a-select-option&gt;
                    &lt;/template&gt;
                  &lt;/a-select&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="24"&gt;
                &lt;a-form-item label="封面"&gt;
                  &lt;a-upload-dragger
                      name="file"
                      accept="image/*"
                      :multiple="false"
                      :before-upload="beforeUpload"
                      v-model:file-list="fileList"
                  &gt;
                    &lt;p class="ant-upload-drag-icon"&gt;
                      &lt;template v-if="modal.form.coverUrl"&gt;
                        &lt;img :src="modal.form.coverUrl"  style="width: 60px;height: 80px;"/&gt;
                      &lt;/template&gt;
                      &lt;template v-else&gt;
                        &lt;file-image-outlined /&gt;
                      &lt;/template&gt;
                    &lt;/p&gt;
                    &lt;p class="ant-upload-text"&gt;
                      请选择要上传的封面图片
                    &lt;/p&gt;
                  &lt;/a-upload-dragger&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;

              &lt;a-col span="24"&gt;
                &lt;a-form-item label="房间介绍"&gt;
                  &lt;a-textarea placeholder="请输入" v-model:value="modal.form.description"&gt;&lt;/a-textarea&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="定价" name="price"&gt;
                  &lt;a-input-number  placeholder="请输入" :min="0" v-model:value="modal.form.price" style="width: 100%;"&gt;&lt;/a-input-number&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="是否带窗" name="window"&gt;
                  &lt;a-select placeholder="请选择" allowClear v-model:value="modal.form.window"&gt;
                    &lt;a-select-option key="有" value="有"&gt;有&lt;/a-select-option&gt;
                    &lt;a-select-option key="无" value="无"&gt;无&lt;/a-select-option&gt;
                  &lt;/a-select&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="地址" name="window"&gt;
                  &lt;a-input  placeholder="请输入" v-model:value="modal.form.address" style="width: 100%;"&gt;&lt;/a-input&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="设施" name="sheshi"&gt;
                  &lt;a-input  placeholder="请输入" v-model:value="modal.form.sheshi" style="width: 100%;"&gt;&lt;/a-input&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
              &lt;a-col span="12"&gt;
                &lt;a-form-item label="状态" name="status"&gt;
                  &lt;a-select placeholder="请选择" allowClear v-model:value="modal.form.status"&gt;
                    &lt;a-select-option key="0" value="0"&gt;上架&lt;/a-select-option&gt;
                    &lt;a-select-option key="1" value="1"&gt;下架&lt;/a-select-option&gt;
                  &lt;/a-select&gt;
                &lt;/a-form-item&gt;
              &lt;/a-col&gt;
            &lt;/a-row&gt;
          &lt;/a-form&gt;
        &lt;/div&gt;
      &lt;/a-modal&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { FormInstance, message, SelectProps } from 'ant-design-vue';
import { createApi, listApi, updateApi, deleteApi } from '/@/api/admin/thing';
import {listApi as listClassificationApi} from '/@/api/admin/classification'
import {listApi as listTagApi} from '/@/api/admin/tag'
import {BASE_URL} from "/@/store/constants";
import { FileImageOutlined } from '@ant-design/icons-vue';

const columns = reactive([

  {
    title: '序号',
    dataIndex: 'index',
    key: 'index',
    width: 60
  },
  {
    title: '名称',
    dataIndex: 'title',
    key: 'title'
  },
  {
    title: '价格',
    dataIndex: 'price',
    key: 'price'
  },
  {
    title: '设施',
    dataIndex: 'sheshi',
    key: 'sheshi'
  },
  {
    title: '简介',
    dataIndex: 'description',
    key: 'description',
    customRender: ({ text, record, index, column }) =&gt; text ? text.substring(0, 10) + '...' : '--'
  },
  {
    title: '状态',
    dataIndex: 'status',
    key: 'status',
    customRender: ({ text, record, index, column }) =&gt; text === '0' ? '上架' : '下架'
  },
  {
    title: '操作',
    dataIndex: 'action',
    key: 'operation',
    align: 'center',
    fixed: 'right',
    width: 140,
  },
]);

const beforeUpload = (file: File) =&gt; {
  // 改文件名
  const fileName = new Date().getTime().toString() + '.' + file.type.substring(6);
  const copyFile = new File([file], fileName);
  console.log(copyFile);
  modal.form.imageFile = copyFile;
  return false;
};

// 文件列表
const fileList = ref&lt;any[]&gt;([]);

// 页面数据
const data = reactive({
  dataList: [],
  loading: false,
  keyword: '',
  selectedRowKeys: [] as any[],
  pageSize: 10,
  page: 1,
});

// 弹窗数据源
const modal = reactive({
  visile: false,
  editFlag: false,
  title: '',
  cData: [],
  tagData: [{}],
  form: {
    id: undefined,
    title: undefined,
    classification: undefined,
    tag: [],
    repertory: undefined,
    price: undefined,
    status: undefined,
    window: undefined,
    address: undefined,
    sheshi: undefined,
    cover: undefined,
    coverUrl: undefined,
    imageFile: undefined
  },
  rules: {
    title: [{ required: true, message: '请输入名称', trigger: 'change' }],
    classification: [{ required: true, message: '请选择分类', trigger: 'change' }],
    repertory: [{ required: true, message: '请输入库存', trigger: 'change' }],
    price: [{ required: true, message: '请输入定价', trigger: 'change' }],
    status: [{ required: true, message: '请选择状态', trigger: 'change' }]
  },
});

const myform = ref&lt;FormInstance&gt;();

onMounted(() =&gt; {
  getDataList();
  getCDataList();
  getTagDataList();
});

const getDataList = () =&gt; {
  data.loading = true;
  listApi({
    keyword: data.keyword,
  })
      .then((res) =&gt; {
        data.loading = false;
        console.log(res);
        res.data.forEach((item: any, index: any) =&gt; {
          item.index = index + 1;
        });
        data.dataList = res.data;
      })
      .catch((err) =&gt; {
        data.loading = false;
        console.log(err);
      });
}

const getCDataList = () =&gt; {
  listClassificationApi({}).then(res =&gt; {
    modal.cData = res.data
  })
}
const getTagDataList = ()=&gt; {
  listTagApi({}).then(res =&gt; {
    res.data.forEach((item, index) =&gt; {
      item.index = index + 1
    })
    modal.tagData = res.data
  })
}

const onSearchChange = (e: Event) =&gt; {
  data.keyword = e?.target?.value;
  console.log(data.keyword);
};

const onSearch = () =&gt; {
  getDataList();
};

const rowSelection = ref({
  onChange: (selectedRowKeys: (string | number)[], selectedRows: DataItem[]) =&gt; {
    console.log(`selectedRowKeys: ${selectedRowKeys}`, 'selectedRows: ', selectedRows);
    data.selectedRowKeys = selectedRowKeys;
  },
});

const handleAdd = () =&gt; {
  resetModal();
  modal.visile = true;
  modal.editFlag = false;
  modal.title = '新增';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
  modal.form.cover = undefined
};
const handleEdit = (record: any) =&gt; {
  resetModal();
  modal.visile = true;
  modal.editFlag = true;
  modal.title = '编辑';
  // 重置
  for (const key in modal.form) {
    modal.form[key] = undefined;
  }
  for (const key in record) {
    if(record[key]) {
      modal.form[key] = record[key];
    }
  }
  if(modal.form.cover) {
    modal.form.coverUrl = BASE_URL + modal.form.cover
    modal.form.cover = undefined
  }
};

const confirmDelete = (record: any) =&gt; {
  console.log('delete', record);
  deleteApi({ ids: record.id })
      .then((res) =&gt; {
        getDataList();
      })
      .catch((err) =&gt; {
        message.error(err.msg || '操作失败');
      });
};

const handleBatchDelete = () =&gt; {
  console.log(data.selectedRowKeys);
  if (data.selectedRowKeys.length &lt;= 0) {
    console.log('hello');
    message.warn('请勾选删除项');
    return;
  }
  deleteApi({ ids: data.selectedRowKeys.join(',') })
      .then((res) =&gt; {
        message.success('删除成功');
        data.selectedRowKeys = [];
        getDataList();
      })
      .catch((err) =&gt; {
        message.error(err.msg || '操作失败');
      });
};

const handleOk = () =&gt; {
  myform.value
      ?.validate()
      .then(() =&gt; {
        const formData = new FormData();
        if(modal.editFlag) {
          formData.append('id', modal.form.id)
        }
        formData.append('title', modal.form.title)
        if (modal.form.classification) {
          formData.append('classification', modal.form.classification)
        }
        if (modal.form.tag) {
          modal.form.tag.forEach(function (value) {
            if(value){
              formData.append('tag', value)
            }
          })
        }
        if (modal.form.imageFile) {
          formData.append('cover', modal.form.imageFile)
        }
        formData.append('description', modal.form.description || '')
        formData.append('price', modal.form.price || '')
        if (modal.form.window) {
          formData.append('window', modal.form.window)
        }
        if (modal.form.address) {
          formData.append('address', modal.form.address)
        }
        if (modal.form.sheshi) {
          formData.append('sheshi', modal.form.sheshi)
        }
        if (modal.form.status) {
          formData.append('status', modal.form.status)
        }
        if (modal.editFlag) {
          updateApi({
            id: modal.form.id
          },formData)
              .then((res) =&gt; {
                hideModal();
                getDataList();
              })
              .catch((err) =&gt; {
                console.log(err);
                message.error(err.msg || '操作失败');
              });
        } else {
          createApi(formData)
              .then((res) =&gt; {
                hideModal();
                getDataList();
              })
              .catch((err) =&gt; {
                console.log(err);
                message.error(err.msg || '操作失败');
              });
        }
      })
      .catch((err) =&gt; {
        console.log('不能为空');
      });
};

const handleCancel = () =&gt; {
  hideModal();
};

// 恢复表单初始状态
const resetModal = () =&gt; {
  myform.value?.resetFields();
  fileList.value = []
};

// 关闭弹窗
const hideModal = () =&gt; {
  modal.visile = false;
};
&lt;/script&gt;

&lt;style scoped lang="less"&gt;
.page-view {
  min-height: 100%;
  background: #fff;
  padding: 24px;
  display: flex;
  flex-direction: column;
}

.table-operations {
  margin-bottom: 16px;
  text-align: right;
}

.table-operations &gt; button {
  margin-right: 8px;
}
&lt;/style&gt;

</code></pre> 
<p>这就是房间管理功能的实现流程，其它的功能管理实现一模一样的。按照这个流程编写即可。</p> 
<h3><a id="_966"></a>重要模块实现</h3> 
<h4><a id="_968"></a>分页实现</h4> 
<p>基于ant-design框架的a-table的分页插件。</p> 
<pre><code>// 分页变量

  const data = reactive({
    dataList: [],
    loading: false,
    keyword: '',
    selectedRowKeys: [] as any[],
    pageSize: 10,
    page: 1,
  });
  
// 分页插件
:pagination="{
          size: 'default',
          current: data.page,
          pageSize: data.pageSize,
          onChange: (current) =&gt; (data.page = current),
          showSizeChanger: false,
          showTotal: (total) =&gt; `共${total}条数据`,
        }"

</code></pre> 
<h4><a id="_996"></a>请求工具实现</h4> 
<p>前端的请求工具是基于axios开发的，位于utils的http文件夹中。封装了request请求和拦截器。</p> 
<pre><code>const service: AxiosInstance = axios.create({
  // baseURL: import.meta.env.BASE_URL + '',
  baseURL: BASE_URL + '',
  timeout: 15000,
});

// axios实例拦截请求
service.interceptors.request.use(
  (config: InternalAxiosRequestConfig) =&gt; {
    config.headers.ADMINTOKEN = localStorage.getItem(ADMIN_USER_TOKEN);
    config.headers.TOKEN = localStorage.getItem(USER_TOKEN);

    return config;
  },
  (error: AxiosError) =&gt; {
    return Promise.reject(error);
  },
);

// axios实例拦截响应
service.interceptors.response.use(
  (response: AxiosResponse) =&gt; {
    if (response.status == 200) {
      if (response.data.code == 0 || response.data.code == 200) {
        return response;
      } else {
        return Promise.reject(response.data);
      }
    } else {
      return Promise.reject(response.data);
    }
  },
  // 请求失败
  (error: any) =&gt; {
    console.log(error.response.status);
    if (error.response.status == 404) {
      // todo
    } else if (error.response.status == 403) {
      // todo
    }
    return Promise.reject(error);
  },
);

</code></pre> 
<h4><a id="_1047"></a>权限控制模块</h4> 
<p>权限控制使用了BaseAuthentication实现的，具体代码可参考authentication.py</p> 
<pre><code>from rest_framework import exceptions
from rest_framework.authentication import BaseAuthentication
from myapp.models import User

# 接口认证
class AdminTokenAuthtication(BaseAuthentication):
    def authenticate(self, request):
        adminToken = request.META.get("HTTP_ADMINTOKEN")

        print("检查adminToken==&gt;" + adminToken)
        users = User.objects.filter(admin_token=adminToken)
        """
        判定条件：
            1. 传了adminToken 
            2. 查到了该帐号 
            3. 该帐号是管理员或演示帐号
        """
        if not adminToken or len(users) == 0 or users[0].role == '2':
            raise exceptions.AuthenticationFailed("AUTH_FAIL_END")
        else:
            print('adminToken验证通过')


</code></pre> 
<h4><a id="_1079"></a>路由模块实现</h4> 
<p>前端的路由是基于vue-router框架实现的，路由文件位于src的rooter的root.js文件中。预览如下：</p> 
<pre><code>  {
    path: '/admin',
    name: 'admin',
    redirect: '/admin/thing',
    component: () =&gt; import('/@/views/admin/main.vue'),
    children: [
      { path: 'overview', name: 'overview', component: () =&gt; import('/@/views/admin/overview.vue') },
      { path: 'order', name: 'order', component: () =&gt; import('/@/views/admin/order.vue') },
      { path: 'thing', name: 'thing', component: () =&gt; import('/@/views/admin/thing.vue') },
      { path: 'comment', name: 'comment', component: () =&gt; import('/@/views/admin/comment.vue') },
      { path: 'user', name: 'user', component: () =&gt; import('/@/views/admin/user.vue') },
      { path: 'classification', name: 'classification', component: () =&gt; import('/@/views/admin/classification.vue') },
      { path: 'tag', name: 'tag', component: () =&gt; import('/@/views/admin/tag.vue') },
      { path: 'ad', name: 'ad', component: () =&gt; import('/@/views/admin/ad.vue') },
      { path: 'notice', name: 'notice', component: () =&gt; import('/@/views/admin/notice.vue') },
      { path: 'loginLog', name: 'loginLog', component: () =&gt; import('/@/views/admin/login-log.vue') },
      { path: 'opLog', name: 'opLog', component: () =&gt; import('/@/views/admin/op-log.vue') },
      { path: 'errorLog', name: 'errorLog', component: () =&gt; import('/@/views/admin/error-log.vue') },
      { path: 'sysInfo', name: 'sysInfo', component: () =&gt; import('/@/views/admin/sys-info.vue') },
    ]
  },
</code></pre> 
<h4><a id="_1107"></a>限速功能实现</h4> 
<p>限流(Throttle)就是限制客户端对API 的调用频率，是API开发者必须要考虑的因素。比如个别客户端(比如爬虫程序)短时间发起大量请求，超过了服务器能够处理的能力，将会影响其它用户的正常使用。又或者某个接口占用数据库资源比较多，如果同一时间该接口被大量调用，服务器可能会陷入僵死状态。为了保证API服务的稳定性，并防止接口受到恶意用户的攻击，我们必须要对我们的API服务进行限流。</p> 
<p>我们使用了django的AnonRateThrottle限流类来实现的。可以参见myapp的auth目录下的MyRateThrottle.py文件</p> 
<pre><code>class MyRateThrottle(AnonRateThrottle):
    THROTTLE_RATES = {"anon": "2/min"}  # 限流每分钟只能请求2次
</code></pre> 
<p>当某个api接口需要限流的时候，只需要添加注解即可，如下所示</p> 
<pre><code>@api_view(['POST'])
@throttle_classes([MyRateThrottle]) # 限流注解
def create(request):
    serializer = CommentSerializer(data=request.data)
    if serializer.is_valid():
        serializer.save()
        return APIResponse(code=0, msg='创建成功', data=serializer.data)
    else:
        print(serializer.errors)

    return APIResponse(code=1, msg='创建失败')
</code></pre> 
<h3><a id="_1134"></a>常见问题</h3> 
<ul><li>数据库版本有要求吗？</li></ul> 
<p>需要mysql 5.7以上</p> 
<ul><li>前端 npm install 失败怎么办？</li></ul> 
<p>使用国内镜像安装，设置命令为：</p> 
<pre><code>npm config set registry https://registry.npm.taobao.org
</code></pre> 
<ul><li>提示"演示账号无法操作"，怎么办？</li></ul> 
<p>将用户的权限提高，修改b_user表的role字段</p> 
<ul><li>如何更换后端请求地址</li></ul> 
<p>修改store文件夹下的constants.js文件中的BASE_URL，改成你自己的后端地址</p> 
<ul><li>如何新增页面</li></ul> 
<p>在views文件夹下创建新的vue文件，写入界面代码，然后在router的root.js中添加路由即可。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/776aa05bf461d56bff2f04aa56dc8065/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL Server数据库发布订阅</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72f4ef48c8ab47b5eb04a45cb70d9efe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ollama &#43; Openwebui 本地部署大型模型与交互式可视化聊天</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>