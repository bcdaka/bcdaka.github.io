<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图像处理方向信息 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2624315c1d890ccc2e100c6aee11e015/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="图像处理方向信息">
  <meta property="og:description" content="前言 Exif 规范 定义了方向标签，用于指示相机相对于所捕获场景的方向。相机可以使用该标签通过方向传感器自动指示方向，也可以让用户通过菜单开关手动指示方向，而无需实际转换图像数据本身。
在图像处理过程中，若是原图文件包含了方向 Orientation 信息，会导致输出的图片在方向上有些许偏差。一般我们需要在处理图像之前将方向信息去掉，并将图像处理成正确的展示形式。
Orientation说明 拍摄图像时相机相对于场景的方向。“第 0 行”和“第 0 列”与视觉位置的关系如下所示。
值第 0 行第 0 列描述1顶部左边0度：正确方向，无需调整2顶部右边水平翻转3底部右边180度旋转4底部左边水平翻转&#43;180度旋转 （垂直翻转）5左边顶部水平翻转&#43;顺时针270度6右边顶部顺时针270度7右边底部水平翻转&#43;顺时针90度8左边底部顺时针90度 图例说明：
如何查看 系统自带的 preview 的显示检查器可直接查看： 通过命令行工具 Mac可以安装 brew install exiftool 后使用 exiftool 工具进行查看：
处理方式 既然知道了方向定义的含义，就按照相反的方式就行处理即可。
自己通过 Pillow 库实现了一个简单的方法：
from PIL import Image def reset_image_rotate(im: Image) -&gt; Image: # 0x0112 EXIF tags: Orientation ，see PIL.ExifTags.TAGS orientation_code = im.getexif().get_ifd(0x0112) if orientation_code == 2: im = im.transpose(Image.Transpose.FLIP_LEFT_RIGHT) elif orientation_code == 3: im = im.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-10T00:04:07+08:00">
    <meta property="article:modified_time" content="2024-06-10T00:04:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图像处理方向信息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p><a href="https://www.cipa.jp/std/documents/e/DC-X008-Translation-2019-E.pdf" rel="nofollow">Exif 规范</a> 定义了方向标签，用于指示相机相对于所捕获场景的方向。相机可以使用该标签通过方向传感器自动指示方向，也可以让用户通过菜单开关手动指示方向，而无需实际转换图像数据本身。</p> 
<p>在图像处理过程中，若是原图文件包含了方向 <code>Orientation</code> 信息，会导致输出的图片在方向上有些许偏差。一般我们需要在处理图像之前将方向信息去掉，并将图像处理成正确的展示形式。</p> 
<h2><a id="Orientation_5"></a>Orientation说明</h2> 
<p>拍摄图像时相机相对于场景的方向。“第 0 行”和“第 0 列”与视觉位置的关系如下所示。</p> 
<table><thead><tr><th>值</th><th>第 0 行</th><th>第 0 列</th><th align="left">描述</th></tr></thead><tbody><tr><td>1</td><td>顶部</td><td>左边</td><td align="left">0度：正确方向，无需调整</td></tr><tr><td>2</td><td>顶部</td><td>右边</td><td align="left">水平翻转</td></tr><tr><td>3</td><td>底部</td><td>右边</td><td align="left">180度旋转</td></tr><tr><td>4</td><td>底部</td><td>左边</td><td align="left">水平翻转+180度旋转 （垂直翻转）</td></tr><tr><td>5</td><td>左边</td><td>顶部</td><td align="left">水平翻转+顺时针270度</td></tr><tr><td>6</td><td>右边</td><td>顶部</td><td align="left">顺时针270度</td></tr><tr><td>7</td><td>右边</td><td>底部</td><td align="left">水平翻转+顺时针90度</td></tr><tr><td>8</td><td>左边</td><td>底部</td><td align="left">顺时针90度</td></tr></tbody></table> 
<p>图例说明：<br> <img src="https://images2.imgbox.com/c1/d2/Hyrl6PdB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_22"></a>如何查看</h2> 
<h3><a id="_preview__23"></a>系统自带的 <code>preview</code> 的显示检查器可直接查看：</h3> 
<p><img src="https://images2.imgbox.com/da/7c/ryvtlze5_o.png" alt="在这里插入图片描述" height="400"><br> <img src="https://images2.imgbox.com/9f/47/7gLStMW6_o.png" alt="在这里插入图片描述" height="200"></p> 
<h3><a id="_26"></a>通过命令行工具</h3> 
<p>Mac可以安装 <code>brew install exiftool</code> 后使用 <code>exiftool</code> 工具进行查看：<br> <img src="https://images2.imgbox.com/8d/8a/NOIoZUBp_o.png" alt="在这里插入图片描述" height="400"></p> 
<h2><a id="_29"></a>处理方式</h2> 
<p>既然知道了方向定义的含义，就按照相反的方式就行处理即可。</p> 
<p>自己通过 <code>Pillow</code> 库实现了一个简单的方法：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

<span class="token keyword">def</span> <span class="token function">reset_image_rotate</span><span class="token punctuation">(</span>im<span class="token punctuation">:</span> Image<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Image<span class="token punctuation">:</span>
	<span class="token comment"># 0x0112 EXIF tags: Orientation ，see PIL.ExifTags.TAGS</span>
	orientation_code <span class="token operator">=</span> im<span class="token punctuation">.</span>getexif<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_ifd<span class="token punctuation">(</span><span class="token number">0x0112</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> orientation_code <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>FLIP_LEFT_RIGHT<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>ROTATE_180<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>FLIP_TOP_BOTTOM<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>TRANSPOSE<span class="token punctuation">)</span>  <span class="token comment"># 矩阵转置</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>ROTATE_270<span class="token punctuation">)</span>  <span class="token comment"># 逆时针270度</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>TRANSVERSE<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> orientation_code <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">:</span>
        im <span class="token operator">=</span> im<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>Transpose<span class="token punctuation">.</span>ROTATE_90<span class="token punctuation">)</span>  <span class="token comment"># 逆时针90度</span>
    <span class="token keyword">return</span> im
</code></pre> 
<blockquote> 
 <p><code>注意</code>：后来查看Pillow官方文档时发现，库中已提供了现成的方法。</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> ImageOps

img <span class="token operator">=</span> ImageOps<span class="token punctuation">.</span>exif_transpose<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre> 
<p>源码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">exif_transpose</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    If an image has an EXIF Orientation tag, return a new image that is
    transposed accordingly. Otherwise, return a copy of the image.

    :param image: The image to transpose.
    :return: An image.
    """</span>
    exif <span class="token operator">=</span> image<span class="token punctuation">.</span>getexif<span class="token punctuation">(</span><span class="token punctuation">)</span>
    orientation <span class="token operator">=</span> exif<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">0x0112</span><span class="token punctuation">)</span>
    method <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token number">2</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>FLIP_LEFT_RIGHT<span class="token punctuation">,</span>
        <span class="token number">3</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>ROTATE_180<span class="token punctuation">,</span>
        <span class="token number">4</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>FLIP_TOP_BOTTOM<span class="token punctuation">,</span>
        <span class="token number">5</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>TRANSPOSE<span class="token punctuation">,</span>
        <span class="token number">6</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>ROTATE_270<span class="token punctuation">,</span>
        <span class="token number">7</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>TRANSVERSE<span class="token punctuation">,</span>
        <span class="token number">8</span><span class="token punctuation">:</span> Image<span class="token punctuation">.</span>ROTATE_90<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>orientation<span class="token punctuation">)</span>
    <span class="token keyword">if</span> method <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        transposed_image <span class="token operator">=</span> image<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>method<span class="token punctuation">)</span>
        transposed_exif <span class="token operator">=</span> transposed_image<span class="token punctuation">.</span>getexif<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token number">0x0112</span> <span class="token keyword">in</span> transposed_exif<span class="token punctuation">:</span>
            <span class="token keyword">del</span> transposed_exif<span class="token punctuation">[</span><span class="token number">0x0112</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token string">"exif"</span> <span class="token keyword">in</span> transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">:</span>
                transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"exif"</span><span class="token punctuation">]</span> <span class="token operator">=</span> transposed_exif<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token string">"Raw profile type exif"</span> <span class="token keyword">in</span> transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">:</span>
                transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">[</span>
                    <span class="token string">"Raw profile type exif"</span>
                <span class="token punctuation">]</span> <span class="token operator">=</span> transposed_exif<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> <span class="token string">"XML:com.adobe.xmp"</span> <span class="token keyword">in</span> transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">:</span>
                transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"XML:com.adobe.xmp"</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>
                    <span class="token string">r'tiff:Orientation="([0-9])"'</span><span class="token punctuation">,</span>
                    <span class="token string">""</span><span class="token punctuation">,</span>
                    transposed_image<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"XML:com.adobe.xmp"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
        <span class="token keyword">return</span> transposed_image
    <span class="token keyword">return</span> image<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_105"></a>参考</h2> 
<ul><li><a href="http://sylvana.net/jpegcrop/exif_orientation.html" rel="nofollow">Exif Orientation Tag (Feb 17 2002)</a></li><li><a href="https://pillow.readthedocs.io/en/stable/reference/ImageOps.html#PIL.ImageOps.exif_transpose" rel="nofollow">PIL.ImageOps.exif_transpose</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a744f141288ce53167429c66cb28d7bd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Python学习】网络爬虫-爬取豆瓣电影评论</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b7b549bd520495ee2b6a5cea7feddee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【5minC&#43;&#43;基本功】——左值与右值|左值引用与右值引用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>