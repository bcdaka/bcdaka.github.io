<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在线编辑、预览、基于wps web office，v3版 强势来袭（已适配solon） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4213790346a8e47c6fa4d4d366024732/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="在线编辑、预览、基于wps web office，v3版 强势来袭（已适配solon）">
  <meta property="og:description" content="说明 v1 版本已经不再更新了，官方也只是提供以前申请下来的账号能继续使用，新申请，需要用到v3了v3 版本sdk参考 wps-weboffice-sdk-v3, 里面有很详细的注释v3 集成方法，后端请参考wps-weboffice-v3-demo, 实现你需要对接的接口即可使用v3的大前提是，你申请了开发账号，并且申请下来了appid，–web-office官网– 其实v3版本已经是小半年了，但是呢，实在看不下去官方的那个sdk，所以，自己就接着弄吧，虽然也没有多少工作量，主要是让用的人能快速接入~~~
基于官方最新sdk-v3 ------------ V3开发文档官网
基于官方的sdk,做了大量优化,增加了最为详细的注释,并推送到maven,方便大家使用
sdk地址 https://gitee.com/mose-x/wps-weboffice-sdk-v3
引入maven
&lt;dependency&gt; &lt;groupId&gt;cn.ljserver.tool&lt;/groupId&gt; &lt;artifactId&gt;web-office-v3&lt;/artifactId&gt; &lt;version&gt;3.1.1&lt;/version&gt; &lt;/dependency&gt; 基于此sdk的实现,也给你demo以及简单的html页面
demo地址 https://gitee.com/mose-x/wps-weboffice-v3
号外 web office 已经适配 国产框架 solon，想体验的去试试，或者试试这个solon demo，相关说明
sdk地址 https://gitee.com/mose-x/wps-weboffice-sdk-v3-solon
引入maven
&lt;dependency&gt; &lt;groupId&gt;cn.ljserver.tool&lt;/groupId&gt; &lt;artifactId&gt;web-office-v3-solon-plugin&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;/dependency&gt; 基于此sdk的实现,也给你demo以及简单的html页面
demo地址 https://gitee.com/mose-x/wps-weboffice-v3-solon-demo
– 接着说 –
效果呢,和v1版本的大差不差,只是接入方式完全变化了
使用sdk接入,反倒更加简单了,需要接入的,多看看demo里面的注释,以及sdk的注释
比如文件预览，引入maven后，你只需实现PreviewService 里面的接口即可
/** * 文件预览服务必要的接口实现 * &lt;br&gt; * &lt;a href=&#34;https://solution.wps.cn/docs/callback/preview.html&#34;&gt;-详见官方文档-&lt;/a&gt; */ @Service public class PreviewServiceImpl implements PreviewService { @Autowired private UserService userService; @Autowired private FileService fileService; /** * 获取文件信息 * * @param fileId 文件id &lt;br&gt; * &lt;a href=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-28T13:46:42+08:00">
    <meta property="article:modified_time" content="2024-06-28T13:46:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在线编辑、预览、基于wps web office，v3版 强势来袭（已适配solon）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>说明</h3> 
<ol><li>v1 版本已经不再更新了，官方也只是提供以前申请下来的账号能继续使用，新申请，需要用到v3了</li><li>v3 版本sdk参考 <a href="https://gitee.com/mose-x/wps-weboffice-sdk-v3" rel="nofollow">wps-weboffice-sdk-v3</a>, 里面有很详细的注释</li><li>v3 集成方法，后端请参考<a href="https://gitee.com/mose-x/wps-weboffice-v3" rel="nofollow">wps-weboffice-v3-demo</a>, 实现你需要对接的接口即可</li><li>使用v3的大前提是，你申请了开发账号，并且申请下来了appid，<a href="https://solution.wps.cn/console" rel="nofollow">–web-office官网–</a></li></ol> 
<p>其实v3版本已经是小半年了，但是呢，实在看不下去官方的那个sdk，所以，自己就接着弄吧，虽然也没有多少工作量，主要是让用的人能快速接入~~~</p> 
<p>基于官方最新sdk-v3 ------------ <a href="https://solution.wps.cn/docs" rel="nofollow">V3开发文档官网</a><br> 基于官方的sdk,做了大量优化,增加了最为详细的注释,并推送到maven,方便大家使用</p> 
<hr> 
<p>sdk地址 <a href="https://gitee.com/mose-x/wps-weboffice-sdk-v3" rel="nofollow">https://gitee.com/mose-x/wps-weboffice-sdk-v3</a></p> 
<hr> 
<p>引入maven</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.ljserver.tool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>web-office-v3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>基于此sdk的实现,也给你demo以及简单的html页面</p> 
<hr> 
<p>demo地址 <a href="https://gitee.com/mose-x/wps-weboffice-v3" rel="nofollow">https://gitee.com/mose-x/wps-weboffice-v3</a></p> 
<hr> 
<h3><a id="_27"></a>号外</h3> 
<p>web office 已经适配 国产框架 <a href="https://solon.noear.org/" rel="nofollow">solon</a>，想体验的去试试，或者试试这个<a href="https://gitee.com/mose-x/solon-demo" rel="nofollow">solon demo</a>，相关<a href="https://blog.csdn.net/qq_23501739/article/details/137697430">说明</a></p> 
<hr> 
<p>sdk地址 <a href="https://gitee.com/mose-x/wps-weboffice-sdk-v3-solon" rel="nofollow">https://gitee.com/mose-x/wps-weboffice-sdk-v3-solon</a></p> 
<hr> 
<p>引入maven</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.ljserver.tool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>web-office-v3-solon-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>基于此sdk的实现,也给你demo以及简单的html页面</p> 
<hr> 
<p>demo地址 <a href="https://gitee.com/mose-x/wps-weboffice-v3-solon-demo" rel="nofollow">https://gitee.com/mose-x/wps-weboffice-v3-solon-demo</a></p> 
<hr> 
<p>– <strong>接着说</strong> –</p> 
<hr> 
<p>效果呢,和v1版本的大差不差,只是接入方式完全变化了</p> 
<p>使用sdk接入,反倒更加简单了,需要接入的,多看看demo里面的注释,以及sdk的注释</p> 
<p><strong>比如文件预览，引入maven后，你只需实现PreviewService 里面的接口即可</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 文件预览服务必要的接口实现
 * &lt;br&gt;
 * &lt;a href="https://solution.wps.cn/docs/callback/preview.html"&gt;-详见官方文档-&lt;/a&gt;
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreviewServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PreviewService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FileService</span> fileService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 获取文件信息
     *
     * @param fileId 文件id &lt;br&gt;
     *               &lt;a href="https://solution.wps.cn/docs/callback/preview.html#获取文件信息"&gt;-详见官方文档-&lt;/a&gt;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">fetchFileInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 解释说明下，这里在实际的设计中，需要将 文件信息 表 和历史文件版本表分开放</span>
        <span class="token comment">// 这里是通过文件id，获取到当前文件最新一个版本的文件信息，并返回</span>
        <span class="token comment">// 这里为了方便，所以设计成了一张表</span>
        <span class="token keyword">return</span> fileService<span class="token punctuation">.</span><span class="token function">fetchFile</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取文件下载地址
     *
     * @param fileId 文件id &lt;br&gt;
     *               &lt;a href="https://solution.wps.cn/docs/callback/preview.html#获取文件下载地址"&gt;-详见官方文档-&lt;/a&gt;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">DownloadInfo</span> <span class="token function">fetchDownloadInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 解释说明下，这里在实际的设计中，需要将 文件信息 表 和历史文件版本表分开放</span>
        <span class="token comment">// 然后这里就会获取最后一个版本的文件并返回</span>
        <span class="token comment">// 这里为了方便，所以设计成了一张表</span>
        <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>fileService<span class="token operator">::</span><span class="token function">findById</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token operator">::</span><span class="token function">stream</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparingInt</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> f<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token class-name">DownloadInfo</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">FileNotExist</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取用户文件权限
     *
     * @param fileId 文件id &lt;br&gt;
     *               &lt;a href="https://solution.wps.cn/docs/callback/preview.html#文档用户权限"&gt;-详见官方文档-&lt;/a&gt;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserPermission</span> <span class="token function">fetchUserPermission</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 解释说明下，这里在实际的设计中，需要将 文件信息 表 和 用户权限 表 分开放</span>
        <span class="token comment">// 这里为了方便，并没有设计表，返回了所有权限到前端</span>
        <span class="token comment">// check file exists</span>
        fileService<span class="token punctuation">.</span><span class="token function">fetchFile</span><span class="token punctuation">(</span>fileId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取user信息，这个方法点进去看看把！！！</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">fetchUserByToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 构建user对应的文件权限</span>
        <span class="token keyword">return</span> <span class="token class-name">UserPermission</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">history</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>文档编辑，单阶段保存，嗯，很简单，如下</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 单阶段文件保存接口
 * &lt;p&gt;
 * &lt;a href="https://solution.wps.cn/docs/callback/save.html#%E5%8D%95%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4"&gt;详见wps web office官网&lt;/a&gt;
 */</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SinglePhaseFileStorageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">SinglePhaseFileStorageService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FileService</span> fileService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 上传文件
     *
     * @param request 上传文件请求
     * @return 文件信息
     * &lt;p&gt;
     * &lt;a href="https://solution.wps.cn/docs/callback/save.html#%E5%8D%95%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4"&gt;详见wps web office官网&lt;/a&gt;
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FileInfo</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">FileUploadSinglePhase<span class="token punctuation">.</span>Request</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取用户信息 -&gt; 这个方法点进去看看 ？？！！</span>
        <span class="token keyword">final</span> <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">fetchUserByToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 保存文件信息</span>
        <span class="token keyword">final</span> <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> fileService<span class="token punctuation">.</span><span class="token function">fetchFile</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getFileId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token class-name">File</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyForNewVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">creator</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getCreator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">createTime</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">modifyTime</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">modifier</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                        <span class="token comment">// 上传文件获取到URL</span>
                        <span class="token comment">// --------------------------------</span>
                        <span class="token comment">// 这里不应该直接保存URL，而是不带domain的uri方便后续迁移等等</span>
                        <span class="token comment">// 为了方便，就这么弄了</span>
                        <span class="token comment">// --------------------------------</span>

                        <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span><span class="token class-name">QnFileService</span><span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> fileService<span class="token punctuation">.</span><span class="token function">repository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">FileNotExist</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 返回文件信息</span>
        <span class="token keyword">return</span> file<span class="token punctuation">.</span><span class="token function">toFileInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>这里说明下，单阶段保存，和三阶段保存</p> 
<ol><li>单阶段，即直接保存，没有那么多花里胡哨的</li><li>三阶段保存 
  <ul><li>先获取自定义的加密算法</li><li>获取到自定义的文件上传接口，同时将文件元信息给到你</li><li>当wps后台上传完文件后（通过步骤2上传），再调用你的上传完成接口，作为回调，告诉你上传完成的信息</li></ul> </li></ol> 
<hr> 
<hr> 
<p>但是<br> ⛔开发者请注意</p> 
<p><strong>由于保存接口的升级，单阶段提交将于2024年9月1日起停止新的接入<br> 正在使用单阶段提交的开发者，您仍可继续使用，不受此次升级影响<br> 正在对接单阶段提交的开发者，请留意对接截止时间，推荐您对接三阶段保存接口<br> 若关闭单阶段提交接口，则该接口不能被再次开启</strong></p> 
<hr> 
<hr> 
<p>此次先给到java的sdk，java-demo以及最简单的html页面来让大家快速对接，如果确实有需要的话，后续我再把官网前端那些对接的，弄个vue的项目，供大家参考，反正闲着也是闲着。。。</p> 
<hr> 
<p>嗯，别忘了给v3项目小星星哦！</p> 
<hr> 
<h6><a id="V3_208"></a>V3实际效果</h6> 
<p>和v1效果差不多，只是v3目前有自带的水印</p> 
<hr> 
<p><a href="https://qnfile.ljserver.cn/weboffice/docx.html" rel="nofollow">docx 在线预览/编辑</a></p> 
<hr> 
<p><a href="https://qnfile.ljserver.cn/weboffice/pptx.html" rel="nofollow">pptx 在线预览/编辑</a></p> 
<hr> 
<p><a href="https://qnfile.ljserver.cn/weboffice/xlsx.html" rel="nofollow">xlsx 在线预览/编辑</a></p> 
<hr> 
<p><a href="https://qnfile.ljserver.cn/weboffice/pdf.html" rel="nofollow">pdf 在线预览/编辑</a></p> 
<hr> 
<hr> 
<hr> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bdc81620b980140eecb0e7905e79f23e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android出海实战：Android14适配</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9506edd93353552bda9d90580c62e58c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle新特性速递：未来数据库技术的无限可能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>