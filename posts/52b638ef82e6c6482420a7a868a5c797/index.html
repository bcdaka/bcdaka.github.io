<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在 CentOS 6 上安装 Nagios - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/52b638ef82e6c6482420a7a868a5c797/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="如何在 CentOS 6 上安装 Nagios">
  <meta property="og:description" content="前些天发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。点击跳转到网站。
Status: 已弃用 本文涵盖的 CentOS 版本已不再受支持。如果您目前正在运行 CentOS 6 服务器，我们强烈建议升级或迁移到受支持的 CentOS 版本。
原因: CentOS 6 已于2020年11月30日到达生命周期终点（EOL），不再接收安全补丁或更新。因此，本指南已不再维护。
请参阅替代方案:
本指南可能仍然作为参考有用，但可能不适用于其他 CentOS 版本。如果有的话，我们强烈建议使用针对您正在使用的 CentOS 版本编写的指南。
以下 DigitalOcean 教程可能会立即引起您的兴趣，因为它概述了在 CentOS 7 服务器上安装 Nagios： 如何在 CentOS 7 上安装 Nagios 4 并监视您的服务器 步骤 1 - 在监控服务器上安装软件包 rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm yum -y install nagios nagios-plugins-all nagios-plugins-nrpe nrpe php httpd chkconfig httpd on &amp;&amp; chkconfig nagios on service httpd start &amp;&amp; service nagios start 我们还应该在此 droplet 上启用 SWAP 内存，至少为 2GB：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-02T00:45:00+08:00">
    <meta property="article:modified_time" content="2024-09-02T00:45:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在 CentOS 6 上安装 Nagios</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前些天发现了一个巨牛的<a href="https://www.captainbed.cn/rubys" rel="nofollow">人工智能学习网站</a>，通俗易懂，风趣幽默，忍不住分享一下给大家。<a href="https://www.captainbed.cn/rubys" rel="nofollow">点击跳转到网站</a>。</p> 
<p><span class="warning"></span></p> 
<p></p> 
<h3><strong>Status:</strong> 已弃用</h3> 
<p>本文涵盖的 CentOS 版本已不再受支持。如果您目前正在运行 CentOS 6 服务器，我们强烈建议升级或迁移到受支持的 CentOS 版本。</p> 
<p><strong>原因:</strong> <a href="https://wiki.centos.org/About/Product" rel="nofollow">CentOS 6 已于2020年11月30日到达生命周期终点（EOL）</a>，不再接收安全补丁或更新。因此，本指南已不再维护。</p> 
<p><strong>请参阅替代方案:</strong><br> 本指南可能仍然作为参考有用，但可能不适用于其他 CentOS 版本。如果有的话，我们强烈建议使用针对您正在使用的 CentOS 版本编写的指南。</p> 
<p>以下 DigitalOcean 教程可能会立即引起您的兴趣，因为它概述了在 CentOS 7 服务器上安装 Nagios： <br> </p> 
<ul><li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nagios-4-and-monitor-your-servers-on-centos-7" rel="nofollow">如何在 CentOS 7 上安装 Nagios 4 并监视您的服务器</a></li></ul> 
<br> 
<p></p> 
<h4>步骤 1 - 在监控服务器上安装软件包</h4> 
<pre>rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
yum -y install nagios nagios-plugins-all nagios-plugins-nrpe nrpe php httpd
chkconfig httpd on &amp;&amp; chkconfig nagios on
service httpd start &amp;&amp; service nagios start
</pre> 
<p>我们还应该在此 droplet 上启用 SWAP 内存，至少为 2GB：</p> 
<pre>dd if=/dev/zero of=/swap bs=1024 count=2097152
mkswap /swap &amp;&amp; chown root. /swap &amp;&amp; chmod 0600 /swap &amp;&amp; swapon /swap
echo /swap swap swap defaults 0 0 &gt;&gt; /etc/fstab
echo vm.swappiness = 0 &gt;&gt; /etc/sysctl.conf &amp;&amp; sysctl -p
</pre> 
<h4>步骤 2 - 设置密码保护</h4> 
<p>设置 Nagios 管理面板密码：</p> 
<pre>htpasswd -c /etc/nagios/passwd nagiosadmin
</pre> 
<img src="https://images2.imgbox.com/17/7b/MEwjoh4b_o.png" width="680"> 
<p>确保将此用户名保持为 "nagiosadmin" - 否则您将不得不更改 /etc/nagios/cgi.cfg 并重新定义授权管理员。</p> 
<p>现在您可以转到 droplet 的 IP 地址 <b>http://IP/nagios</b> 并登录。</p> 
<p>您将被提示输入步骤 2 中设置的密码：</p> 
<img src="https://images2.imgbox.com/3b/7b/5QIA47os_o.png" width="680"> 
<p>这就是 Nagios 管理面板的外观：</p> 
<img src="https://images2.imgbox.com/c4/7c/kgP1wEFK_o.png" width="680"> 
<p>由于这是一个全新的安装，我们目前没有任何正在监视的主机。</p> 
<img src="https://images2.imgbox.com/60/81/vy85SJh3_o.png" width="680"> 
<p>现在我们应该添加将由 Nagios 监视的主机。例如，我们将使用 cloudmail.tk（198.211.107.218）和 emailocean.tk（198.211.112.99）。</p> 
<p>从公共端口，我们可以监视 ping，任何开放的端口，如 web 服务器，电子邮件服务器等。</p> 
<p>对于在本地主机上监听的内部服务，例如 MySQL、memcached、系统服务，我们需要使用 NRPE。</p> 
<h4>步骤 4 - 在客户端上安装 NRPE</h4> 
<pre>rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
yum -y install nagios nagios-plugins-all nrpe
chkconfig nrpe on
</pre> 
<p>下一步是您可以指定监控服务器可以通过 NRPE 发送的任何手动命令到这些客户端主机。</p> 
<p>确保将 <b>allowed_hosts</b> 更改为您自己的值。</p> 
<p>编辑 <b>/etc/nagios/nrpe.cfg</b></p> 
<pre>log_facility=daemon
pid_file=/var/run/nrpe/nrpe.pid
server_port=5666
nrpe_user=nrpe
nrpe_group=nrpe
allowed_hosts=198.211.117.251
dont_blame_nrpe=1
debug=0
command_timeout=60
connection_timeout=300
include_dir=/etc/nrpe.d/
command[check_users]=/usr/lib64/nagios/plugins/check_users -w 5 -c 10
command[check_load]=/usr/lib64/nagios/plugins/check_load -w 15,10,5 -c 30,25,20
command[check_disk]=/usr/lib64/nagios/plugins/check_disk -w 20% -c 10% -p /dev/vda
command[check_zombie_procs]=/usr/lib64/nagios/plugins/check_procs -w 5 -c 10 -s Z
command[check_total_procs]=/usr/lib64/nagios/plugins/check_procs -w 150 -c 200
command[check_procs]=/usr/lib64/nagios/plugins/check_procs -w $ARG1$ -c $ARG2$ -s $ARG3$
</pre> 
<p>注意：</p> 
<p>在上面的 check_disk 中，正在检查的分区是 /dev/vda - 通过运行 <b>df -h /</b> 确保您的 droplet 具有相同的分区。 您还可以修改何时触发警告或严重警报 - 上面的配置设置剩余可用磁盘空间为 20% 时触发警告，并在剩余可用空间为 10% 时触发严重警报。</p> 
<p>我们还应该设置防火墙规则，以允许来自我们的监控服务器到这些客户端的连接，并拒绝其他所有人：</p> 
<pre>iptables -N NRPE
iptables -I INPUT -s 0/0 -p tcp --dport 5666 -j NRPE
iptables -I NRPE -s 198.211.117.251 -j ACCEPT
iptables -A NRPE -s 0/0 -j DROP
/etc/init.d/iptables save
</pre> 
<p>现在您可以在所有客户端主机上启动 NRPE：</p> 
<pre>service nrpe start
</pre> 
<h4>步骤 5 - 在监控服务器上添加服务器配置</h4> 
<p>回到我们的监控服务器，我们将不得不为每个客户端服务器创建配置文件：</p> 
<pre>echo "cfg_dir=/etc/nagios/servers" &gt;&gt; /etc/nagios/nagios.cfg
cd /etc/nagios/servers
touch cloudmail.tk.cfg
touch emailocean.tk.cfg
</pre> 
<p>编辑每个客户端的配置文件，并定义您想要监视的服务。</p> 
<pre>nano /etc/nagios/servers/cloudmail.tk.cfg
</pre> 
<p>添加以下行：</p> 
<pre>define host {
        use                     linux-server
        host_name               cloudmail.tk
        alias                   cloudmail.tk
        address                 198.211.107.218
        }

define service {
        use                             generic-service
        host_name                       cloudmail.tk
        service_description             PING
        check_command                   check_ping!100.0,20%!500.0,60%
        }

define service {
        use                             generic-service
        host_name                       cloudmail.tk
        service_description             SSH
        check_command                   check_ssh
        notifications_enabled           0
        }

define service {
        use                             generic-service
        host_name                       cloudmail.tk
        service_description             Current Load
        check_command                   check_local_load!5.0,4.0,3.0!10.0,6.0,4.0
        }
</pre> 
<p>您可以根据需要添加更多要监视的服务。对于第二个客户端 emailocean.tk，应添加相同的配置，但 IP 地址和 host_name 不同：</p> 
<p>这是 <b>/etc/nagios/servers/emailocean.tk.cfg</b> 的片段：</p> 
<pre>define host {
        use                     linux-server
        host_name               emailocean.tk
        alias                   emailocean.tk
        address                 198.211.112.99
        }

...
</pre> 
<p>您可以添加要监视的其他客户端，如 <b>/etc/nagios/servers/AnotherHostName.cfg</b></p> 
<p>最后，在添加所有客户端配置后，您应该正确设置文件夹权限，并在监控服务器上重新启动 Nagios：</p> 
<pre>chown -R nagios. /etc/nagios
service nagios restart
</pre> 
<h4>步骤 6 - 在 Nagios 中监视主机</h4> 
<p>转到您的监控服务器的 IP 地址 http://IP/nagios 并输入步骤 2 中设置的密码。</p> 
<p>现在您应该能够看到所有主机和服务：</p> 
<img src="https://images2.imgbox.com/c8/a1/ecjIE1Kq_o.png" width="680"> 
<p>至此，您已完成所有步骤！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a9b00fc80e0ebd6c0ae97311039c526/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据仓库系列19：数据血缘分析在数据仓库中有什么应用?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7dd82d37b6658c6c0557101d841ff2b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">单片机-STM32 ADC应用（五）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>