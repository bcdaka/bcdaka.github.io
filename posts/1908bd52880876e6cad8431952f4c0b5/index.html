<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解决java.sql.SQLIntegrityConstraintViolationException: Duplicate entry ‘1‘ for key ‘book.PRIMARY‘ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1908bd52880876e6cad8431952f4c0b5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="解决java.sql.SQLIntegrityConstraintViolationException: Duplicate entry ‘1‘ for key ‘book.PRIMARY‘">
  <meta property="og:description" content="目录
问题
原因
解决方案
问题 场景：有张图书表，主键是自增的。现在我写了个添加图书功能。因为主键是自增的我插入时无需设置主键值。
关键代码如下：
然后就报这个异常了：
找了一圈并没有发现能解决我这个问题的。最终仔细分析想了下才发现端倪，听我慢慢道来。 原因 先说结论
原因就是自增序列的值跟表里数据的主键值不匹配
何以见得？仔细观察这两次调用报错的提示信息有何不同
你第一出现的异常信息这里是1或者其他数，这个数代表目前自增序列为你分配的主键值
你再次调用还是会抛这个异常，但是这个值&#43;1了。这让我瞬间想到了自增序列与当前表里数据主键不一致问题。你第一次调用mysql自增序列给你匹配了主键是1但是表里面有数据的主键是1了所以主键重复，这是mysql底层自增序列知道1重复了会进行自增&#43;&#43;操作，这是第二次调用就会提示主键值2重复。你再次调用会提示3重复、、、、循环以往，直到自增队列的值在表里不存在了就没这个错误了。
为何会导致主键自增序列跟表里的数据主键不匹配呢？
导致我遇到这个问题的原因很简单 CREATE TABLE Book ( id INT PRIMARY KEY COMMENT &#39;图书ID&#39;, title VARCHAR(100) NOT NULL COMMENT &#39;标题&#39;, publisher VARCHAR(100) NOT NULL COMMENT &#39;出版商&#39;, isbn VARCHAR(20) NOT NULL COMMENT &#39;ISBN号&#39;, publishDate DATE NOT NULL COMMENT &#39;出版日期&#39;, author VARCHAR(100) NOT NULL COMMENT &#39;作者&#39; ); INSERT INTO Book (id, title, publisher, isbn, publishDate, author) VALUES (1, &#39;Java编程&#39;, &#39;清华大学出版社&#39;, &#39;978-7-302-32950-4&#39;, &#39;2023-12-01&#39;, &#39;张三&#39;), (2, &#39;Python入门指南&#39;, &#39;人民邮电出版社&#39;, &#39;9787115423681&#39;, &#39;2023-11-15&#39;, &#39;李四&#39;), (3, &#39;C&#43;&#43; Primer Plus&#39;, &#39;机械工业出版社&#39;, &#39;9787111540953&#39;, &#39;2024-01-20&#39;, &#39;王五&#39;), (4, &#39;数据结构与算法分析&#39;, &#39;电子工业出版社&#39;, &#39;9787121347883&#39;, &#39;2024-02-28&#39;, &#39;赵六&#39;), (5, &#39;计算机网络&#39;, &#39;高等教育出版社&#39;, &#39;9787040292726&#39;, &#39;2024-03-10&#39;, &#39;孙七&#39;), (6, &#39;数据库系统概论&#39;, &#39;清华大学出版社&#39;, &#39;9787302423284&#39;, &#39;2024-04-05&#39;, &#39;周八&#39;), (7, &#39;软件工程导论&#39;, &#39;人民邮电出版社&#39;, &#39;9787111226532&#39;, &#39;2024-05-18&#39;, &#39;吴九&#39;), (8, &#39;操作系统原理&#39;, &#39;机械工业出版社&#39;, &#39;9787111538905&#39;, &#39;2024-06-25&#39;, &#39;郑十&#39;), (9, &#39;计算机组成原理&#39;, &#39;电子工业出版社&#39;, &#39;9787121270012&#39;, &#39;2024-07-12&#39;, &#39;钱十一&#39;), (10, &#39;嵌入式系统设计&#39;, &#39;高等教育出版社&#39;, &#39;9787040284652&#39;, &#39;2024-08-30&#39;, &#39;孙十二&#39;), (11, &#39;人工智能导论&#39;, &#39;清华大学出版社&#39;, &#39;9787302463242&#39;, &#39;2024-09-05&#39;, &#39;周十三&#39;), (12, &#39;大数据技术与应用&#39;, &#39;人民邮电出版社&#39;, &#39;9787111488774&#39;, &#39;2024-10-18&#39;, &#39;吴十四&#39;), (13, &#39;信息安全原理&#39;, &#39;机械工业出版社&#39;, &#39;9787111514145&#39;, &#39;2024-11-25&#39;, &#39;郑十五&#39;), (14, &#39;移动应用开发&#39;, &#39;电子工业出版社&#39;, &#39;9787121209830&#39;, &#39;2024-12-08&#39;, &#39;钱十六&#39;), (15, &#39;云计算基础&#39;, &#39;高等教育出版社&#39;, &#39;9787040263824&#39;, &#39;2025-01-15&#39;, &#39;孙十七&#39;), (16, &#39;物联网技术与应用&#39;, &#39;清华大学出版社&#39;, &#39;9787302346727&#39;, &#39;2025-02-20&#39;, &#39;周十八&#39;), (17, &#39;区块链原理与应用&#39;, &#39;人民邮电出版社&#39;, &#39;9787111530480&#39;, &#39;2025-03-28&#39;, &#39;吴十九&#39;), (18, &#39;软件测试与质量保障&#39;, &#39;机械工业出版社&#39;, &#39;9787111568384&#39;, &#39;2025-04-10&#39;, &#39;郑二十&#39;), (19, &#39;Python数据分析&#39;, &#39;电子工业出版社&#39;, &#39;9787121308827&#39;, &#39;2025-05-05&#39;, &#39;钱二十一&#39;), (20, &#39;Java Web开发&#39;, &#39;高等教育出版社&#39;, &#39;9787040348033&#39;, &#39;2025-06-15&#39;, &#39;孙二十二&#39;); 一开始我让al生成的表创建sql，就没指定为自增主键，但是已经初始化了20条数据，后面我才发现主键不是自增，就给修改成自增了，这是自增序列并不知道表里面有数据，主键已经排到20了。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-08T01:15:20+08:00">
    <meta property="article:modified_time" content="2024-06-08T01:15:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解决java.sql.SQLIntegrityConstraintViolationException: Duplicate entry ‘1‘ for key ‘book.PRIMARY‘</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E9%97%AE%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E9%97%AE%E9%A2%98" rel="nofollow">问题</a></p> 
<p id="%E5%8E%9F%E5%9B%A0-toc" style="margin-left:0px;"><a href="#%E5%8E%9F%E5%9B%A0" rel="nofollow">原因</a></p> 
<p id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-toc" style="margin-left:0px;"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" rel="nofollow">解决方案</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>问题</h2> 
<p>场景：有张图书表，主键是自增的。现在我写了个添加图书功能。因为主键是自增的我插入时无需设置主键值。</p> 
<p>关键代码如下：</p> 
<p><img alt="" height="601" src="https://images2.imgbox.com/1d/93/0YFkFi3t_o.png" width="871"></p> 
<p>然后就报这个异常了：</p> 
<p><img alt="" height="208" src="https://images2.imgbox.com/78/41/u3pfYXpN_o.png" width="1048"></p> 
<p>找了一圈并没有发现能解决我这个问题的。最终仔细分析想了下才发现端倪，听我慢慢道来。 </p> 
<h2 id="%E5%8E%9F%E5%9B%A0">原因</h2> 
<p>先说结论</p> 
<blockquote> 
 <p><span style="background-color:#ffd900;">原因就是自增序列的值跟表里数据的主键值不匹配</span></p> 
</blockquote> 
<p>何以见得？仔细观察这两次调用报错的提示信息有何不同</p> 
<p><img alt="" height="208" src="https://images2.imgbox.com/83/49/73pigWOa_o.png" width="1048"></p> 
<p><img alt="" height="208" src="https://images2.imgbox.com/46/72/FgmgqTQB_o.png" width="1045"></p> 
<p></p> 
<p>你第一出现的异常信息这里是1或者其他数，这个数代表目前自增序列为你分配的主键值</p> 
<p><img alt="" height="34" src="https://images2.imgbox.com/a9/b1/6VA2KZmg_o.png" width="830"></p> 
<p> 你再次调用还是会抛这个异常，但是这个值+1了。这让我瞬间想到了自增序列与当前表里数据主键不一致问题。你第一次调用mysql自增序列给你匹配了主键是1但是表里面有数据的主键是1了所以主键重复，这是mysql底层自增序列知道1重复了会进行自增++操作，这是第二次调用就会提示主键值2重复。你再次调用会提示3重复、、、、循环以往，直到自增队列的值在表里不存在了就没这个错误了。</p> 
<blockquote> 
 <p><img alt="" height="30" src="https://images2.imgbox.com/49/4f/4NQURcyj_o.png" width="831"></p> 
</blockquote> 
<p>为何会导致主键自增序列跟表里的数据主键不匹配呢？</p> 
<p>导致我遇到这个问题的原因很简单 </p> 
<pre><code class="language-sql">CREATE TABLE Book (
    id INT PRIMARY KEY COMMENT '图书ID',
    title VARCHAR(100) NOT NULL COMMENT '标题',
    publisher VARCHAR(100) NOT NULL COMMENT '出版商',
    isbn VARCHAR(20) NOT NULL COMMENT 'ISBN号',
    publishDate DATE NOT NULL COMMENT '出版日期',
    author VARCHAR(100) NOT NULL COMMENT '作者'
);
</code></pre> 
<pre><code class="language-sql">INSERT INTO Book (id, title, publisher, isbn, publishDate, author) VALUES 
(1, 'Java编程', '清华大学出版社', '978-7-302-32950-4', '2023-12-01', '张三'),
(2, 'Python入门指南', '人民邮电出版社', '9787115423681', '2023-11-15', '李四'),
(3, 'C++ Primer Plus', '机械工业出版社', '9787111540953', '2024-01-20', '王五'),
(4, '数据结构与算法分析', '电子工业出版社', '9787121347883', '2024-02-28', '赵六'),
(5, '计算机网络', '高等教育出版社', '9787040292726', '2024-03-10', '孙七'),
(6, '数据库系统概论', '清华大学出版社', '9787302423284', '2024-04-05', '周八'),
(7, '软件工程导论', '人民邮电出版社', '9787111226532', '2024-05-18', '吴九'),
(8, '操作系统原理', '机械工业出版社', '9787111538905', '2024-06-25', '郑十'),
(9, '计算机组成原理', '电子工业出版社', '9787121270012', '2024-07-12', '钱十一'),
(10, '嵌入式系统设计', '高等教育出版社', '9787040284652', '2024-08-30', '孙十二'),
(11, '人工智能导论', '清华大学出版社', '9787302463242', '2024-09-05', '周十三'),
(12, '大数据技术与应用', '人民邮电出版社', '9787111488774', '2024-10-18', '吴十四'),
(13, '信息安全原理', '机械工业出版社', '9787111514145', '2024-11-25', '郑十五'),
(14, '移动应用开发', '电子工业出版社', '9787121209830', '2024-12-08', '钱十六'),
(15, '云计算基础', '高等教育出版社', '9787040263824', '2025-01-15', '孙十七'),
(16, '物联网技术与应用', '清华大学出版社', '9787302346727', '2025-02-20', '周十八'),
(17, '区块链原理与应用', '人民邮电出版社', '9787111530480', '2025-03-28', '吴十九'),
(18, '软件测试与质量保障', '机械工业出版社', '9787111568384', '2025-04-10', '郑二十'),
(19, 'Python数据分析', '电子工业出版社', '9787121308827', '2025-05-05', '钱二十一'),
(20, 'Java Web开发', '高等教育出版社', '9787040348033', '2025-06-15', '孙二十二');
</code></pre> 
<p> 一开始我让al生成的表创建sql，就没指定为自增主键，但是已经初始化了20条数据，后面我才发现主键不是自增，就给修改成自增了，这是自增序列并不知道表里面有数据，主键已经排到20了。</p> 
<h2 id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</h2> 
<blockquote> 
 <p>这很简单直接删除表，重新创建保证主键定义为自增的之后再进行插入，还有插入最好不要指定id了。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f8058554dd9cd4501a2370161511dc3a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">小程序如何刷新当前页面</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/016ab741ab72eef3f6645d84d748cba9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">怎么查看java 安装路径</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>