<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€C&#43;&#43;ã€‘å’Œã€é¢„è®­ç»ƒæ¨¡å‹ã€‘å®ç°ã€æœºå™¨å­¦ä¹ ã€‘ã€å›¾åƒåˆ†ç±»ã€‘çš„ç»ˆææŒ‡å— - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7fbe8abb776c77e42196279eecbb7958/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ã€C&#43;&#43;ã€‘å’Œã€é¢„è®­ç»ƒæ¨¡å‹ã€‘å®ç°ã€æœºå™¨å­¦ä¹ ã€‘ã€å›¾åƒåˆ†ç±»ã€‘çš„ç»ˆææŒ‡å—">
  <meta property="og:description" content="ç›®å½•
ğŸ’—1. å‡†å¤‡å·¥ä½œå’Œç¯å¢ƒé…ç½®ğŸ’•
ğŸ’–å®‰è£…OpenCVğŸ’•
ğŸ’–å®‰è£…DlibğŸ’•
ä¸‹è½½å¹¶ç¼–è¯‘TensorFlow C&#43;&#43; APIğŸ’•
ğŸ’—2. ä¸‹è½½å’Œé…ç½®é¢„è®­ç»ƒæ¨¡å‹ğŸ’•
ğŸ’–2.1 ä¸‹è½½é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹ğŸ’•
ğŸ’–2.2 é…ç½®TensorFlow C&#43;&#43; APIğŸ’•
ğŸ’–2.3 åŠ è½½å’Œä½¿ç”¨æ¨¡å‹ğŸ’•
ğŸ’—3.ç¼–å†™ä»£ç è¿›è¡Œå›¾åƒåˆ†ç±»ğŸ’•
ğŸ’–CMakeLists.txtğŸ’•
ğŸ’–main.cppğŸ’•
ğŸ’—4. ä»£ç åˆ†æå’Œæ¨å¯¼ğŸ’•
ğŸ’–åˆå§‹åŒ–TensorFlowä¼šè¯ğŸ’•
ğŸ’–è¯»å–å’Œå¯¼å…¥æ¨¡å‹ğŸ’•
ğŸ’–è¯»å–è¾“å…¥å›¾åƒğŸ’•
ğŸ’–åˆ›å»ºè¾“å…¥TensorğŸ’•
ğŸ’–è¿è¡Œä¼šè¯å¹¶å¤„ç†è¾“å‡ºğŸ’•
ğŸ’—5. è¿›é˜¶ä¼˜åŒ–ä¸æ€§èƒ½æå‡ğŸ’•
ğŸ’–å¤šçº¿ç¨‹å¤„ç†ğŸ’•
ğŸ’–GPUåŠ é€ŸğŸ’•
ğŸ’–æ¨¡å‹ä¼˜åŒ–ğŸ’•
ğŸ’—6. é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆğŸ’•
ğŸ’–é—®é¢˜1ï¼šå†…å­˜ä¸è¶³ğŸ’•
ğŸ’–é—®é¢˜2ï¼šæ¨ç†é€Ÿåº¦æ…¢ğŸ’•
ğŸ’–é—®é¢˜3ï¼šæ¨¡å‹å…¼å®¹æ€§é—®é¢˜ğŸ’•
åœ¨ç°ä»£æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½åº”ç”¨ä¸­ï¼Œå›¾åƒåˆ†ç±»æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä¸”é‡è¦çš„ä»»åŠ¡ã€‚é€šè¿‡ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—å‡å°‘è®­ç»ƒæ—¶é—´å¹¶æé«˜å‡†ç¡®æ€§ã€‚C&#43;&#43;ä½œä¸ºä¸€ç§é«˜æ•ˆçš„ç¼–ç¨‹è¯­è¨€ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½è®¡ç®—çš„ä»»åŠ¡ã€‚
ğŸ’—1. å‡†å¤‡å·¥ä½œå’Œç¯å¢ƒé…ç½®ğŸ’• é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¼€å‘ç¯å¢ƒã€‚è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œåº“ï¼š
C&#43;&#43; ç¼–è¯‘å™¨ (å¦‚GCC)CMake æ„å»ºç³»ç»ŸOpenCV åº“Dlib åº“ä¸‹è½½å¹¶ç¼–è¯‘C&#43;&#43;ç‰ˆæœ¬çš„TensorFlow ğŸ’–å®‰è£…OpenCVğŸ’• åœ¨Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…OpenCVï¼š
sudo apt-get update sudo apt-get install libopencv-dev ğŸ’–å®‰è£…DlibğŸ’• Dlibæ˜¯ä¸€ä¸ªç°ä»£C&#43;&#43;å·¥å…·åŒ…ï¼ŒåŒ…å«äº†æœºå™¨å­¦ä¹ ç®—æ³•å’Œå·¥å…·ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š
git clone https://github.com/davisking/dlib.git cd dlib mkdir build cd build cmake .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-13T14:16:46+08:00">
    <meta property="article:modified_time" content="2024-06-13T14:16:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€C&#43;&#43;ã€‘å’Œã€é¢„è®­ç»ƒæ¨¡å‹ã€‘å®ç°ã€æœºå™¨å­¦ä¹ ã€‘ã€å›¾åƒåˆ†ç±»ã€‘çš„ç»ˆææŒ‡å—</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>ç›®å½•</strong></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%971.%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E5%92%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%F0%9F%92%95" rel="nofollow">ğŸ’—1. å‡†å¤‡å·¥ä½œå’Œç¯å¢ƒé…ç½®ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E5%AE%89%E8%A3%85OpenCV%F0%9F%92%95" rel="nofollow">ğŸ’–å®‰è£…OpenCVğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E5%AE%89%E8%A3%85Dlib%F0%9F%92%95" rel="nofollow">ğŸ’–å®‰è£…DlibğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%E4%B8%8B%E8%BD%BD%E5%B9%B6%E7%BC%96%E8%AF%91TensorFlow%20C%2B%2B%20API%F0%9F%92%95" rel="nofollow">ä¸‹è½½å¹¶ç¼–è¯‘TensorFlow C++ APIğŸ’•</a></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%972.%20%E4%B8%8B%E8%BD%BD%E5%92%8C%E9%85%8D%E7%BD%AE%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%F0%9F%92%95" rel="nofollow">ğŸ’—2. ä¸‹è½½å’Œé…ç½®é¢„è®­ç»ƒæ¨¡å‹ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%962.1%20%E4%B8%8B%E8%BD%BD%E9%A2%84%E8%AE%AD%E7%BB%83%E7%9A%84ResNet-50%E6%A8%A1%E5%9E%8B%F0%9F%92%95" rel="nofollow">ğŸ’–2.1 ä¸‹è½½é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%962.2%20%E9%85%8D%E7%BD%AETensorFlow%20C%2B%2B%20API%F0%9F%92%95" rel="nofollow">ğŸ’–2.2 é…ç½®TensorFlow C++ APIğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%962.3%20%E5%8A%A0%E8%BD%BD%E5%92%8C%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B%F0%9F%92%95" rel="nofollow">ğŸ’–2.3 åŠ è½½å’Œä½¿ç”¨æ¨¡å‹ğŸ’•</a></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%973.%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%9B%BE%E5%83%8F%E5%88%86%E7%B1%BB%F0%9F%92%95" rel="nofollow">ğŸ’—3.ç¼–å†™ä»£ç è¿›è¡Œå›¾åƒåˆ†ç±»ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96CMakeLists.txt%F0%9F%92%95" rel="nofollow">ğŸ’–CMakeLists.txtğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96main.cpp%F0%9F%92%95" rel="nofollow">ğŸ’–main.cppğŸ’•</a></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%974.%20%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90%E5%92%8C%E6%8E%A8%E5%AF%BC%F0%9F%92%95" rel="nofollow">ğŸ’—4. ä»£ç åˆ†æå’Œæ¨å¯¼ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E5%88%9D%E5%A7%8B%E5%8C%96TensorFlow%E4%BC%9A%E8%AF%9D%F0%9F%92%95" rel="nofollow">ğŸ’–åˆå§‹åŒ–TensorFlowä¼šè¯ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E8%AF%BB%E5%8F%96%E5%92%8C%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9E%8B%F0%9F%92%95" rel="nofollow">ğŸ’–è¯»å–å’Œå¯¼å…¥æ¨¡å‹ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E8%AF%BB%E5%8F%96%E8%BE%93%E5%85%A5%E5%9B%BE%E5%83%8F%F0%9F%92%95" rel="nofollow">ğŸ’–è¯»å–è¾“å…¥å›¾åƒğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E5%88%9B%E5%BB%BA%E8%BE%93%E5%85%A5Tensor%F0%9F%92%95" rel="nofollow">ğŸ’–åˆ›å»ºè¾“å…¥TensorğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E8%BF%90%E8%A1%8C%E4%BC%9A%E8%AF%9D%E5%B9%B6%E5%A4%84%E7%90%86%E8%BE%93%E5%87%BA%F0%9F%92%95" rel="nofollow">ğŸ’–è¿è¡Œä¼šè¯å¹¶å¤„ç†è¾“å‡ºğŸ’•</a></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%975.%20%E8%BF%9B%E9%98%B6%E4%BC%98%E5%8C%96%E4%B8%8E%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%F0%9F%92%95" rel="nofollow">ğŸ’—5. è¿›é˜¶ä¼˜åŒ–ä¸æ€§èƒ½æå‡ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%F0%9F%92%95" rel="nofollow">ğŸ’–å¤šçº¿ç¨‹å¤„ç†ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96GPU%E5%8A%A0%E9%80%9F%F0%9F%92%95" rel="nofollow">ğŸ’–GPUåŠ é€ŸğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E6%A8%A1%E5%9E%8B%E4%BC%98%E5%8C%96%F0%9F%92%95" rel="nofollow">ğŸ’–æ¨¡å‹ä¼˜åŒ–ğŸ’•</a></p> 
<p style="margin-left:0px;"><a href="#%F0%9F%92%976.%20%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%F0%9F%92%95" rel="nofollow">ğŸ’—6. é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E9%97%AE%E9%A2%981%EF%BC%9A%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%F0%9F%92%95" rel="nofollow">ğŸ’–é—®é¢˜1ï¼šå†…å­˜ä¸è¶³ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E9%97%AE%E9%A2%982%EF%BC%9A%E6%8E%A8%E7%90%86%E9%80%9F%E5%BA%A6%E6%85%A2%F0%9F%92%95" rel="nofollow">ğŸ’–é—®é¢˜2ï¼šæ¨ç†é€Ÿåº¦æ…¢ğŸ’•</a></p> 
<p style="margin-left:40px;"><a href="#%F0%9F%92%96%E9%97%AE%E9%A2%983%EF%BC%9A%E6%A8%A1%E5%9E%8B%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98%F0%9F%92%95" rel="nofollow">ğŸ’–é—®é¢˜3ï¼šæ¨¡å‹å…¼å®¹æ€§é—®é¢˜ğŸ’•</a></p> 
<p style="margin-left:0px;">Â </p> 
<hr> 
<p>Â </p> 
<p>åœ¨ç°ä»£æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½åº”ç”¨ä¸­ï¼Œå›¾åƒåˆ†ç±»æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä¸”é‡è¦çš„ä»»åŠ¡ã€‚é€šè¿‡ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥æ˜¾è‘—å‡å°‘è®­ç»ƒæ—¶é—´å¹¶æé«˜å‡†ç¡®æ€§ã€‚C++ä½œä¸ºä¸€ç§é«˜æ•ˆçš„ç¼–ç¨‹è¯­è¨€ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦é«˜æ€§èƒ½è®¡ç®—çš„ä»»åŠ¡ã€‚<img src="https://images2.imgbox.com/26/ae/3QKgRogX_o.png" alt="226b4e959a0c4b4ca7e72460c6008eb7.png"></p> 
<h2>ğŸ’—1. å‡†å¤‡å·¥ä½œå’Œç¯å¢ƒé…ç½®ğŸ’•</h2> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¼€å‘ç¯å¢ƒã€‚è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å·¥å…·å’Œåº“ï¼š</p> 
<ul><li>C++ ç¼–è¯‘å™¨ (å¦‚GCC)</li><li>CMake æ„å»ºç³»ç»Ÿ</li><li>OpenCV åº“</li><li>Dlib åº“</li><li>ä¸‹è½½å¹¶ç¼–è¯‘C++ç‰ˆæœ¬çš„TensorFlow</li></ul> 
<h3>ğŸ’–å®‰è£…OpenCVğŸ’•</h3> 
<p>åœ¨Linuxç³»ç»Ÿä¸Šï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…OpenCVï¼š</p> 
<pre><code>sudo apt-get update
sudo apt-get install libopencv-dev
</code></pre> 
<h3>ğŸ’–å®‰è£…DlibğŸ’•</h3> 
<p>Dlibæ˜¯ä¸€ä¸ªç°ä»£C++å·¥å…·åŒ…ï¼ŒåŒ…å«äº†æœºå™¨å­¦ä¹ ç®—æ³•å’Œå·¥å…·ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p> 
<pre><code>git clone https://github.com/davisking/dlib.git
cd dlib
mkdir build
cd build
cmake ..
cmake --build .
sudo make install
</code></pre> 
<h3>ä¸‹è½½å¹¶ç¼–è¯‘TensorFlow C++ APIğŸ’•</h3> 
<p>ä¸‹è½½TensorFlowçš„C++åº“å¹¶ç¼–è¯‘ï¼Œå¯ä»¥å‚è€ƒTensorFlowå®˜æ–¹æ–‡æ¡£è¿›è¡Œè¯¦ç»†çš„æ­¥éª¤ã€‚ç¡®ä¿ä¸‹è½½çš„ç‰ˆæœ¬ä¸æ‚¨å½“å‰çš„ç¯å¢ƒå…¼å®¹ã€‚</p> 
<h2>ğŸ’—2. ä¸‹è½½å’Œé…ç½®é¢„è®­ç»ƒæ¨¡å‹ğŸ’•</h2> 
<p>ä½¿ç”¨ResNet-50æ¨¡å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå›¾åƒåˆ†ç±»çš„æ·±åº¦å·ç§¯ç¥ç»ç½‘ç»œã€‚åœ¨TensorFlowä¸­ï¼Œå¯ä»¥è½»æ¾åœ°è·å–é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯ä¸‹è½½å’Œé…ç½®ResNet-50æ¨¡å‹çš„è¯¦ç»†æ­¥éª¤ï¼š</p> 
<h3>ğŸ’–2.1 ä¸‹è½½é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹ğŸ’•</h3> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹ã€‚TensorFlowæä¾›äº†å¾ˆå¤šé¢„è®­ç»ƒæ¨¡å‹ï¼Œæ‚¨å¯ä»¥ä»TensorFlowçš„æ¨¡å‹åº“ä¸­è·å–ResNet-50ã€‚</p> 
<p><strong>1.è®¿é—®TensorFlowæ¨¡å‹åº“</strong>ï¼š æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®TensorFlowæ¨¡å‹åº“çš„GitHubé¡µé¢ï¼š<a href="https://github.com/tensorflow/models" title="TensorFlow Model Garden">TensorFlow Model Garden</a></p> 
<p><strong>2.é€‰æ‹©é¢„è®­ç»ƒæ¨¡å‹</strong>ï¼š åœ¨æ¨¡å‹åº“ä¸­æ‰¾åˆ°ResNet-50æ¨¡å‹ã€‚é€šå¸¸åœ¨<code>tensorflow/models/official/vision/image_classification</code>ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°ç›¸å…³çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚</p> 
<p><strong>3.ä¸‹è½½æ¨¡å‹æ–‡ä»¶</strong>ï¼š ä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œæ¨¡å‹æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ª<code>.pb</code>æ–‡ä»¶ï¼ˆTensorFlowæ¨¡å‹çš„protobufæ ¼å¼ï¼‰ã€‚å¦‚æœç›´æ¥ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶ä¸æ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨TensorFlowçš„<code>tf.keras.applications</code>æ¨¡å—ç›´æ¥åŠ è½½ResNet-50ï¼Œå¹¶ä¿å­˜ä¸º<code>.pb</code>æ–‡ä»¶ã€‚</p> 
<p>ä½¿ç”¨Pythonè„šæœ¬ä¸‹è½½å¹¶ä¿å­˜ResNet-50æ¨¡å‹ï¼š</p> 
<pre><code>import tensorflow as tf

model = tf.keras.applications.ResNet50(weights='imagenet')
model.save('resnet50_saved_model', save_format='tf')
</code></pre> 
<ul><li> <p>è¿è¡Œæ­¤è„šæœ¬å°†ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªåä¸º<code>resnet50_saved_model</code>çš„æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«äº†æ¨¡å‹çš„<code>.pb</code>æ–‡ä»¶ã€‚</p> </li></ul> 
<h3>ğŸ’–2.2 é…ç½®TensorFlow C++ APIğŸ’•</h3> 
<p>åœ¨ä¸‹è½½æ¨¡å‹æ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®TensorFlowçš„C++ APIæ¥åŠ è½½å’Œä½¿ç”¨è¯¥æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯é…ç½®æ­¥éª¤ï¼š</p> 
<p><strong>1.å®‰è£…TensorFlow C++åº“</strong>ï¼š ä»TensorFlowçš„å®˜æ–¹ç½‘ç«™ä¸‹è½½é€‚ç”¨äºæ‚¨çš„å¹³å°çš„TensorFlow C++åº“ã€‚å¦‚æœæ²¡æœ‰ç°æˆçš„äºŒè¿›åˆ¶åŒ…ï¼Œå¯ä»¥ä»æºä»£ç ç¼–è¯‘TensorFlow C++åº“ã€‚</p> 
<pre><code>git clone https://github.com/tensorflow/tensorflow.git
cd tensorflow
./configure
bazel build //tensorflow:libtensorflow_cc.so
</code></pre> 
<p>ç¼–è¯‘å®Œæˆåï¼Œåº“æ–‡ä»¶ä½äº<code>bazel-bin/tensorflow</code>ç›®å½•ä¸‹ã€‚</p> 
<p><strong>2.è®¾ç½®ç¯å¢ƒå˜é‡</strong>ï¼š å°†TensorFlow C++åº“çš„åŒ…å«è·¯å¾„å’Œåº“æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p> 
<pre><code>export TF_CPP_INCLUDE_DIR=/path/to/tensorflow/include
export TF_CPP_LIB_DIR=/path/to/tensorflow/lib
</code></pre> 
<p><strong>3.é…ç½®CMakeLists.txt</strong>ï¼š æ›´æ–°é¡¹ç›®çš„<code>CMakeLists.txt</code>æ–‡ä»¶ï¼ŒåŒ…å«TensorFlow C++åº“çš„è·¯å¾„ã€‚</p> 
<pre><code>cmake_minimum_required(VERSION 3.10)
project(ImageClassification)

set(CMAKE_CXX_STANDARD 14)

find_package(OpenCV REQUIRED)
find_package(Dlib REQUIRED)

include_directories(${OpenCV_INCLUDE_DIRS})
include_directories(${Dlib_INCLUDE_DIRS})
include_directories(${TF_CPP_INCLUDE_DIR})
link_directories(${TF_CPP_LIB_DIR})

add_executable(ImageClassification main.cpp)
target_link_libraries(ImageClassification ${OpenCV_LIBS} dlib::dlib tensorflow_cc)
</code></pre> 
<h3>ğŸ’–2.3 åŠ è½½å’Œä½¿ç”¨æ¨¡å‹ğŸ’•</h3> 
<p>åœ¨å®Œæˆä¸Šè¿°é…ç½®åï¼Œå¯ä»¥åœ¨C++ä»£ç ä¸­åŠ è½½å’Œä½¿ç”¨ResNet-50æ¨¡å‹ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•åŠ è½½å’Œä½¿ç”¨è¯¥æ¨¡å‹è¿›è¡Œå›¾åƒåˆ†ç±»ï¼š</p> 
<pre><code>#include &lt;iostream&gt;
#include &lt;opencv2/opencv.hpp&gt;
#include &lt;dlib/dnn.h&gt;
#include &lt;tensorflow/core/public/session.h&gt;
#include &lt;tensorflow/core/protobuf/meta_graph.pb.h&gt;

using namespace std;
using namespace cv;
using namespace tensorflow;

// å®šä¹‰å›¾åƒåˆ†ç±»å‡½æ•°
void classifyImage(const std::string&amp; model_path, const std::string&amp; image_path) {
    // åˆå§‹åŒ–TensorFlowä¼šè¯
    Session* session;
    Status status = NewSession(SessionOptions(), &amp;session);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error creating TensorFlow session: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // è¯»å–æ¨¡å‹
    GraphDef graph_def;
    status = ReadBinaryProto(Env::Default(), model_path, &amp;graph_def);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error reading graph definition from " &lt;&lt; model_path &lt;&lt; ": " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // å°†æ¨¡å‹å¯¼å…¥ä¼šè¯
    status = session-&gt;Create(graph_def);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error creating graph: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // è¯»å–è¾“å…¥å›¾åƒ
    Mat img = imread(image_path);
    if (img.empty()) {
        std::cerr &lt;&lt; "Error reading image: " &lt;&lt; image_path &lt;&lt; std::endl;
        return;
    }

    // é¢„å¤„ç†å›¾åƒ
    Mat img_resized;
    resize(img, img_resized, Size(224, 224));
    img_resized.convertTo(img_resized, CV_32FC3);
    img_resized = img_resized / 255.0;

    // åˆ›å»ºè¾“å…¥Tensor
    Tensor input_tensor(DT_FLOAT, TensorShape({1, 224, 224, 3}));
    auto input_tensor_mapped = input_tensor.tensor&lt;float, 4&gt;();

    // å°†å›¾åƒæ•°æ®å¤åˆ¶åˆ°è¾“å…¥Tensor
    for (int y = 0; y &lt; 224; ++y) {
        for (int x = 0; x &lt; 224; ++x) {
            for (int c = 0; c &lt; 3; ++c) {
                input_tensor_mapped(0, y, x, c) = img_resized.at&lt;Vec3f&gt;(y, x)[c];
            }
        }
    }

    // è¿è¡Œä¼šè¯
    std::vector&lt;Tensor&gt; outputs;
    status = session-&gt;Run({<!-- -->{"input_tensor", input_tensor}}, {"output_tensor"}, {}, &amp;outputs);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error during inference: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // å¤„ç†è¾“å‡º
    auto output_tensor = outputs[0].tensor&lt;float, 2&gt;();
    int best_label = std::distance(output_tensor(0).data(), std::max_element(output_tensor(0).data(), output_tensor(0).data() + output_tensor.dim_size(1)));

    std::cout &lt;&lt; "Predicted label: " &lt;&lt; best_label &lt;&lt; std::endl;

    // æ¸…ç†
    session-&gt;Close();
    delete session;
}

int main(int argc, char** argv) {
    if (argc != 3) {
        std::cerr &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " &lt;model_path&gt; &lt;image_path&gt;" &lt;&lt; std::endl;
        return 1;
    }

    const std::string model_path = argv[1];
    const std::string image_path = argv[2];

    classifyImage(model_path, image_path);

    return 0;
}
</code></pre> 
<h2>ğŸ’—3.ç¼–å†™ä»£ç è¿›è¡Œå›¾åƒåˆ†ç±»ğŸ’•</h2> 
<p>ä½¿ç”¨é¢„è®­ç»ƒçš„ResNet-50æ¨¡å‹è¿›è¡Œå›¾åƒåˆ†ç±»ã€‚</p> 
<h3>ğŸ’–CMakeLists.txtğŸ’•</h3> 
<pre><code>cmake_minimum_required(VERSION 3.10)
project(ImageClassification)

set(CMAKE_CXX_STANDARD 14)

find_package(OpenCV REQUIRED)
find_package(Dlib REQUIRED)

include_directories(${OpenCV_INCLUDE_DIRS})
include_directories(${Dlib_INCLUDE_DIRS})
include_directories(/path/to/tensorflow/include)
link_directories(/path/to/tensorflow/lib)

add_executable(ImageClassification main.cpp)
target_link_libraries(ImageClassification ${OpenCV_LIBS} dlib::dlib tensorflow)
</code></pre> 
<h3>ğŸ’–main.cppğŸ’•</h3> 
<pre><code>#include &lt;iostream&gt;
#include &lt;opencv2/opencv.hpp&gt;
#include &lt;dlib/dnn.h&gt;
#include &lt;tensorflow/core/public/session.h&gt;
#include &lt;tensorflow/core/protobuf/meta_graph.pb.h&gt;

using namespace std;
using namespace cv;
using namespace tensorflow;

// å®šä¹‰å›¾åƒåˆ†ç±»å‡½æ•°
void classifyImage(const std::string&amp; model_path, const std::string&amp; image_path) {
    // åˆå§‹åŒ–TensorFlowä¼šè¯
    Session* session;
    Status status = NewSession(SessionOptions(), &amp;session);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error creating TensorFlow session: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // è¯»å–æ¨¡å‹
    GraphDef graph_def;
    status = ReadBinaryProto(Env::Default(), model_path, &amp;graph_def);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error reading graph definition from " &lt;&lt; model_path &lt;&lt; ": " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // å°†æ¨¡å‹å¯¼å…¥ä¼šè¯
    status = session-&gt;Create(graph_def);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error creating graph: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // è¯»å–è¾“å…¥å›¾åƒ
    Mat img = imread(image_path);
    if (img.empty()) {
        std::cerr &lt;&lt; "Error reading image: " &lt;&lt; image_path &lt;&lt; std::endl;
        return;
    }

    // é¢„å¤„ç†å›¾åƒ
    Mat img_resized;
    resize(img, img_resized, Size(224, 224));
    img_resized.convertTo(img_resized, CV_32FC3);
    img_resized = img_resized / 255.0;

    // åˆ›å»ºè¾“å…¥Tensor
    Tensor input_tensor(DT_FLOAT, TensorShape({1, 224, 224, 3}));
    auto input_tensor_mapped = input_tensor.tensor&lt;float, 4&gt;();

    // å°†å›¾åƒæ•°æ®å¤åˆ¶åˆ°è¾“å…¥Tensor
    for (int y = 0; y &lt; 224; ++y) {
        for (int x = 0; x &lt; 224; ++x) {
            for (int c = 0; c &lt; 3; ++c) {
                input_tensor_mapped(0, y, x, c) = img_resized.at&lt;Vec3f&gt;(y, x)[c];
            }
        }
    }

    // è¿è¡Œä¼šè¯
    std::vector&lt;Tensor&gt; outputs;
    status = session-&gt;Run({<!-- -->{"input_tensor", input_tensor}}, {"output_tensor"}, {}, &amp;outputs);
    if (!status.ok()) {
        std::cerr &lt;&lt; "Error during inference: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
        return;
    }

    // å¤„ç†è¾“å‡º
    auto output_tensor = outputs[0].tensor&lt;float, 2&gt;();
    int best_label = std::distance(output_tensor(0).data(), std::max_element(output_tensor(0).data(), output_tensor(0).data() + output_tensor.dim_size(1)));

    std::cout &lt;&lt; "Predicted label: " &lt;&lt; best_label &lt;&lt; std::endl;

    // æ¸…ç†
    session-&gt;Close();
    delete session;
}

int main(int argc, char** argv) {
    if (argc != 3) {
        std::cerr &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " &lt;model_path&gt; &lt;image_path&gt;" &lt;&lt; std::endl;
        return 1;
    }

    const std::string model_path = argv[1];
    const std::string image_path = argv[2];

    classifyImage(model_path, image_path);

    return 0;
}
</code></pre> 
<h2>ğŸ’—4. ä»£ç åˆ†æå’Œæ¨å¯¼ğŸ’•</h2> 
<h3>ğŸ’–åˆå§‹åŒ–TensorFlowä¼šè¯ğŸ’•</h3> 
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªTensorFlowä¼šè¯ã€‚è¿™ä¸ªä¼šè¯å°†ç”¨äºæ‰§è¡Œå›¾ä¸­çš„æ“ä½œã€‚</p> 
<pre><code>Session* session;
Status status = NewSession(SessionOptions(), &amp;session);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error creating TensorFlow session: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}
</code></pre> 
<h3>ğŸ’–è¯»å–å’Œå¯¼å…¥æ¨¡å‹ğŸ’•</h3> 
<p>ä½¿ç”¨<code>ReadBinaryProto</code>å‡½æ•°è¯»å–äºŒè¿›åˆ¶æ ¼å¼çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¯¼å…¥ä¼šè¯ã€‚</p> 
<pre><code>GraphDef graph_def;
status = ReadBinaryProto(Env::Default(), model_path, &amp;graph_def);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error reading graph definition from " &lt;&lt; model_path &lt;&lt; ": " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}

status = session-&gt;Create(graph_def);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error creating graph: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}
</code></pre> 
<h3>ğŸ’–è¯»å–è¾“å…¥å›¾åƒğŸ’•</h3> 
<p>æˆ‘ä»¬ä½¿ç”¨OpenCVè¯»å–å›¾åƒï¼Œå¹¶å°†å…¶å¤§å°è°ƒæ•´ä¸º224x224ï¼Œè¿™æ˜¯ResNet-50æ¨¡å‹æ‰€éœ€çš„è¾“å…¥å°ºå¯¸ã€‚</p> 
<pre><code>Mat img = imread(image_path);
if (img.empty()) {
    std::cerr &lt;&lt; "Error reading image: " &lt;&lt; image_path &lt;&lt; std::endl;
    return;
}

Mat img_resized;
resize(img, img_resized, Size(224, 224));
img_resized.convertTo(img_resized, CV_32FC3);
img_resized = img_resized / 255.0;
</code></pre> 
<h3>ğŸ’–åˆ›å»ºè¾“å…¥TensorğŸ’•</h3> 
<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªTensorFlowçš„Tensorï¼Œå¹¶å°†å›¾åƒæ•°æ®å¤åˆ¶åˆ°è¯¥Tensorä¸­ã€‚</p> 
<pre><code>Tensor input_tensor(DT_FLOAT, TensorShape({1, 224, 224, 3}));
auto input_tensor_mapped = input_tensor.tensor&lt;float, 4&gt;();

for (int y = 0; y &lt; 224; ++y) {
    for (int x = 0; x &lt; 224; ++x) {
        for (int c = 0; c &lt; 3; ++c) {
            input_tensor_mapped(0, y, x, c) = img_resized.at&lt;Vec3f&gt;(y, x)[c];
        }
    }
}
</code></pre> 
<h3>ğŸ’–è¿è¡Œä¼šè¯å¹¶å¤„ç†è¾“å‡ºğŸ’•</h3> 
<p>ä½¿ç”¨ä¼šè¯è¿è¡Œæ¨¡å‹ï¼Œå¹¶è·å–è¾“å‡ºç»“æœã€‚</p> 
<pre><code>std::vector&lt;Tensor&gt; outputs;
status = session-&gt;Run({<!-- -->{"input_tensor", input_tensor}}, {"output_tensor"}, {}, &amp;outputs);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error during inference: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}

auto output_tensor = outputs[0].tensor&lt;float, 2&gt;();
int best_label = std::distance(output_tensor(0).data(), std::max_element(output_tensor(0).data(), output_tensor(0).data() + output_tensor.dim_size(1)));

std::cout &lt;&lt; "Predicted label: " &lt;&lt; best_label &lt;&lt; std::endl;
</code></pre> 
<h2>ğŸ’—5. è¿›é˜¶ä¼˜åŒ–ä¸æ€§èƒ½æå‡ğŸ’•</h2> 
<p>åœ¨è¿™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ä»¥æé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚è¿™äº›æŠ€å·§å’Œæ–¹æ³•åŒ…æ‹¬å¤šçº¿ç¨‹å¤„ç†ã€GPUåŠ é€Ÿã€æ¨¡å‹ä¼˜åŒ–ç­‰ã€‚</p> 
<h3>ğŸ’–å¤šçº¿ç¨‹å¤„ç†ğŸ’•</h3> 
<p>åœ¨å¤„ç†å¤§é‡å›¾åƒæ—¶ï¼Œåˆ©ç”¨å¤šçº¿ç¨‹å¯ä»¥æ˜¾è‘—æé«˜å¤„ç†é€Ÿåº¦ã€‚C++ä¸­çš„<code>std::thread</code>åº“ä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ æ–¹ä¾¿ã€‚å¤šçº¿ç¨‹å¤„ç†ï¼š</p> 
<pre><code>#include &lt;thread&gt;
#include &lt;vector&gt;

// å®šä¹‰ä¸€ä¸ªå¤„ç†å›¾åƒçš„å‡½æ•°
void processImage(const std::string&amp; model_path, const std::string&amp; image_path) {
    classifyImage(model_path, image_path);
}

int main(int argc, char** argv) {
    if (argc &lt; 3) {
        std::cerr &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " &lt;model_path&gt; &lt;image_paths...&gt;" &lt;&lt; std::endl;
        return 1;
    }

    const std::string model_path = argv[1];
    std::vector&lt;std::string&gt; image_paths;
    for (int i = 2; i &lt; argc; ++i) {
        image_paths.push_back(argv[i]);
    }

    std::vector&lt;std::thread&gt; threads;
    for (const auto&amp; image_path : image_paths) {
        threads.emplace_back(processImage, model_path, image_path);
    }

    for (auto&amp; t : threads) {
        if (t.joinable()) {
            t.join();
        }
    }

    return 0;
}
</code></pre> 
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå›¾åƒï¼Œä»è€Œæé«˜æ•´ä½“å¤„ç†æ•ˆç‡ã€‚</p> 
<h3>ğŸ’–GPUåŠ é€ŸğŸ’•</h3> 
<p>GPUåœ¨å¤„ç†å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ä»»åŠ¡æ—¶å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚TensorFlowçš„C++ APIæ”¯æŒGPUåŠ é€Ÿï¼Œåªéœ€åœ¨åˆ›å»ºä¼šè¯æ—¶æŒ‡å®šGPUè®¾å¤‡å³å¯ï¼š</p> 
<pre><code>SessionOptions options;
options.config.mutable_gpu_options()-&gt;set_allow_growth(true);
Session* session;
Status status = NewSession(options, &amp;session);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error creating TensorFlow session: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}
</code></pre> 
<p>åœ¨é…ç½®å¥½CUDAå’ŒcuDNNåï¼ŒTensorFlowä¼šè‡ªåŠ¨åˆ©ç”¨GPUè¿›è¡Œè®¡ç®—ï¼Œä»è€Œæ˜¾è‘—æé«˜è®¡ç®—é€Ÿåº¦ã€‚</p> 
<h3>ğŸ’–æ¨¡å‹ä¼˜åŒ–ğŸ’•</h3> 
<p>æ¨¡å‹ä¼˜åŒ–æ˜¯æå‡æ¨ç†é€Ÿåº¦å’Œå‡å°‘å†…å­˜å ç”¨çš„é‡è¦æ‰‹æ®µã€‚å¸¸ç”¨çš„æ–¹æ³•åŒ…æ‹¬æ¨¡å‹é‡åŒ–å’Œè£å‰ªã€‚å¯ä»¥ä½¿ç”¨TensorFlowçš„æ¨¡å‹ä¼˜åŒ–å·¥å…·è¿›è¡Œè¿™äº›ä¼˜åŒ–ã€‚</p> 
<p>ä½¿ç”¨TensorFlowçš„æ¨¡å‹ä¼˜åŒ–APIè¿›è¡Œé‡åŒ–ï¼š</p> 
<pre><code>import tensorflow as tf
from tensorflow_model_optimization.quantization.keras import vitis_quantize

model = tf.keras.models.load_model('model.h5')
quantized_model = vitis_quantize.quantize_model(model)
quantized_model.save('quantized_model.h5')
</code></pre> 
<p>å°†é‡åŒ–åçš„æ¨¡å‹åŠ è½½åˆ°C++é¡¹ç›®ä¸­ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘æ¨¡å‹çš„è®¡ç®—é‡ï¼Œä»è€Œæé«˜æ¨ç†é€Ÿåº¦ã€‚</p> 
<h2>ğŸ’—6. é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆğŸ’•</h2> 
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼Œå…·ä½“åˆ†ææ¯ç§é—®é¢˜çš„å¯èƒ½åŸå› å’Œè¯¦ç»†çš„è§£å†³æ­¥éª¤ã€‚</p> 
<h3>ğŸ’–é—®é¢˜1ï¼šå†…å­˜ä¸è¶³ğŸ’•</h3> 
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p> 
<p><strong>1.å‡å°‘æ‰¹å¤„ç†å¤§å°</strong>ï¼š æ‰¹å¤„ç†å¤§å°ï¼ˆbatch sizeï¼‰æ˜¯æŒ‡ä¸€æ¬¡æ€§é€å…¥æ¨¡å‹è¿›è¡Œå¤„ç†çš„æ•°æ®æ ·æœ¬æ•°ã€‚å¦‚æœæ‰¹å¤„ç†å¤§å°è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚å¯ä»¥é€šè¿‡å‡å°æ‰¹å¤„ç†å¤§å°æ¥å‡å°‘å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå°†æ‰¹å¤„ç†å¤§å°ä»32å‡å°åˆ°16ç”šè‡³æ›´å°ã€‚</p> 
<pre><code>// å°†æ‰¹å¤„ç†å¤§å°è®¾ç½®ä¸º1
Tensor input_tensor(DT_FLOAT, TensorShape({1, 224, 224, 3}));
</code></pre> 
<p><strong>2.ä½¿ç”¨æ¨¡å‹é‡åŒ–æŠ€æœ¯</strong>ï¼š æ¨¡å‹é‡åŒ–é€šè¿‡å°†æµ®ç‚¹æ•°è½¬æ¢ä¸ºä½ç²¾åº¦æ•´æ•°æ¥å‡å°‘æ¨¡å‹å¤§å°å’Œå†…å­˜å ç”¨ã€‚TensorFlowæä¾›äº†é‡åŒ–å·¥å…·ï¼Œå¯ä»¥åœ¨è®­ç»ƒåå¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–ã€‚</p> 
<pre><code>import tensorflow as tf
from tensorflow_model_optimization.quantization.keras import vitis_quantize

model = tf.keras.models.load_model('model.h5')
quantized_model = vitis_quantize.quantize_model(model)
quantized_model.save('quantized_model.h5')
</code></pre> 
<p><strong>3.æ›´é«˜æ•ˆçš„æ•°æ®é¢„å¤„ç†æ–¹æ³•</strong>ï¼š ä½¿ç”¨OpenCVæˆ–å…¶ä»–å›¾åƒå¤„ç†åº“è¿›è¡Œé«˜æ•ˆçš„æ•°æ®é¢„å¤„ç†ï¼Œå°½é‡å‡å°‘åœ¨å†…å­˜ä¸­çš„å›¾åƒå‰¯æœ¬ã€‚åœ¨è¯»å–å›¾åƒåç«‹å³è¿›è¡Œç¼©æ”¾å’Œå½’ä¸€åŒ–å¤„ç†ã€‚</p> 
<pre><code>Mat img = imread(image_path);
resize(img, img_resized, Size(224, 224));
img_resized.convertTo(img_resized, CV_32FC3);
img_resized = img_resized / 255.0;
</code></pre> 
<h3>ğŸ’–é—®é¢˜2ï¼šæ¨ç†é€Ÿåº¦æ…¢ğŸ’•</h3> 
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p> 
<p><strong>1.ä½¿ç”¨GPUåŠ é€Ÿ</strong>ï¼š GPUåœ¨å¤„ç†å¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—ä»»åŠ¡æ—¶å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ã€‚åœ¨TensorFlowä¸­å¯ä»¥é€šè¿‡æŒ‡å®šGPUè®¾å¤‡æ¥åŠ é€Ÿæ¨ç†ã€‚</p> 
<pre><code>SessionOptions options;
options.config.mutable_gpu_options()-&gt;set_allow_growth(true);
Session* session;
Status status = NewSession(options, &amp;session);
if (!status.ok()) {
    std::cerr &lt;&lt; "Error creating TensorFlow session: " &lt;&lt; status.ToString() &lt;&lt; std::endl;
    return;
}
</code></pre> 
<p><strong>2.åˆ©ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†</strong>ï¼š ä½¿ç”¨C++çš„å¤šçº¿ç¨‹åº“ï¼ˆå¦‚<code>std::thread</code>ï¼‰æ¥å¹¶è¡Œå¤„ç†å¤šä¸ªå›¾åƒï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›ã€‚</p> 
<pre><code>#include &lt;thread&gt;
#include &lt;vector&gt;

void processImage(const std::string&amp; model_path, const std::string&amp; image_path) {
    classifyImage(model_path, image_path);
}

int main(int argc, char** argv) {
    if (argc &lt; 3) {
        std::cerr &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " &lt;model_path&gt; &lt;image_paths...&gt;" &lt;&lt; std::endl;
        return 1;
    }

    const std::string model_path = argv[1];
    std::vector&lt;std::string&gt; image_paths;
    for (int i = 2; i &lt; argc; ++i) {
        image_paths.push_back(argv[i]);
    }

    std::vector&lt;std::thread&gt; threads;
    for (const auto&amp; image_path : image_paths) {
        threads.emplace_back(processImage, model_path, image_path);
    }

    for (auto&amp; t : threads) {
        if (t.joinable()) {
            t.join();
        }
    }

    return 0;
}
</code></pre> 
<p><strong>3.ä¼˜åŒ–æ¨¡å‹ç»“æ„</strong>ï¼š ä¼˜åŒ–æ¨¡å‹ç»“æ„ï¼Œä¾‹å¦‚å‡å°‘æ¨¡å‹å±‚æ•°ã€ä½¿ç”¨æ›´å°çš„å·ç§¯æ ¸ç­‰ï¼Œå¯ä»¥æé«˜æ¨ç†é€Ÿåº¦ã€‚å…·ä½“æ–¹æ³•åŒ…æ‹¬å‰ªæã€åˆå¹¶å·ç§¯å±‚ç­‰ã€‚</p> 
<p><strong>4.ä½¿ç”¨æ¨¡å‹é‡åŒ–å’Œè£å‰ªæŠ€æœ¯</strong>ï¼š é‡åŒ–å¯ä»¥æ˜¾è‘—å‡å°‘æ¨¡å‹å¤§å°å’Œè®¡ç®—é‡ï¼Œä»è€Œæé«˜æ¨ç†é€Ÿåº¦ã€‚æ¨¡å‹è£å‰ªï¼ˆpruningï¼‰é€šè¿‡å»é™¤ä¸é‡è¦çš„æƒé‡æ¥ä¼˜åŒ–æ¨¡å‹ã€‚</p> 
<pre><code>import tensorflow_model_optimization as tfmot

prune_low_magnitude = tfmot.sparsity.keras.prune_low_magnitude
pruning_params = {
    'pruning_schedule': tfmot.sparsity.keras.PolynomialDecay(initial_sparsity=0.30,
                                                             final_sparsity=0.70,
                                                             begin_step=2000,
                                                             end_step=10000)
}

model_for_pruning = prune_low_magnitude(model, **pruning_params)
model_for_pruning.compile(optimizer='adam',
                          loss=tf.keras.losses.categorical_crossentropy,
                          metrics=['accuracy'])

model_for_pruning.fit(train_data, train_labels, epochs=2, validation_split=0.1)
</code></pre> 
<h3>ğŸ’–é—®é¢˜3ï¼šæ¨¡å‹å…¼å®¹æ€§é—®é¢˜ğŸ’•</h3> 
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p> 
<ol><li> <p><strong>ç¡®ä¿æ¨¡å‹æ–‡ä»¶å’Œåº“ç‰ˆæœ¬åŒ¹é…</strong>ï¼š åœ¨ä¸åŒå¹³å°ä¸Šä½¿ç”¨æ¨¡å‹æ—¶ï¼Œç¡®ä¿æ¨¡å‹æ–‡ä»¶ä¸åº“ç‰ˆæœ¬åŒ¹é…éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼ŒTensorFlowæ¨¡å‹çš„ç‰ˆæœ¬å’ŒTensorFlowåº“çš„ç‰ˆæœ¬å¿…é¡»ä¸€è‡´ã€‚</p> </li><li> <p><strong>é‡æ–°è®­ç»ƒå’Œå¯¼å‡ºæ¨¡å‹</strong>ï¼š å¦‚æœé‡åˆ°å…¼å®¹æ€§é—®é¢˜ï¼Œå°è¯•åœ¨ç›®æ ‡å¹³å°ä¸Šé‡æ–°è®­ç»ƒå¹¶å¯¼å‡ºæ¨¡å‹ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¨¡å‹å’Œè¿è¡Œç¯å¢ƒçš„å®Œå…¨å…¼å®¹ã€‚</p> <pre><code>import tensorflow as tf

# é‡æ–°è®­ç»ƒæ¨¡å‹
model = tf.keras.models.Sequential([
    tf.keras.layers.Conv2D(32, (3, 3), activation='relu', input_shape=(224, 224, 3)),
    tf.keras.layers.MaxPooling2D((2, 2)),
    tf.keras.layers.Conv2D(64, (3, 3), activation='relu'),
    tf.keras.layers.MaxPooling2D((2, 2)),
    tf.keras.layers.Flatten(),
    tf.keras.layers.Dense(64, activation='relu'),
    tf.keras.layers.Dense(10, activation='softmax')
])

model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy'])
model.fit(train_images, train_labels, epochs=10)

# å¯¼å‡ºæ¨¡å‹
model.save('retrained_model.h5')
</code></pre> <p><strong>3.ä½¿ç”¨ä¸­é—´æ ¼å¼è¿›è¡Œè½¬æ¢</strong>ï¼š ä½¿ç”¨ONNXï¼ˆå¼€æ”¾ç¥ç»ç½‘ç»œäº¤æ¢ï¼‰æ ¼å¼ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æ·±åº¦å­¦ä¹ æ¡†æ¶ä¹‹é—´è½¬æ¢æ¨¡å‹ã€‚å¯ä»¥ä½¿ç”¨tf2onnxå°†TensorFlowæ¨¡å‹è½¬æ¢ä¸ºONNXæ ¼å¼ï¼Œç„¶ååœ¨ç›®æ ‡å¹³å°ä¸ŠåŠ è½½ONNXæ¨¡å‹ã€‚</p> <pre><code>import tf2onnx
import tensorflow as tf

model = tf.keras.models.load_model('model.h5')
spec = (tf.TensorSpec((None, 224, 224, 3), tf.float32, name="input"),)
output_path = "model.onnx"

model_proto, _ = tf2onnx.convert.from_keras(model, input_signature=spec, opset=13)
with open(output_path, "wb") as f:
    f.write(model_proto.SerializeToString())
</code></pre> <p>ç„¶ååœ¨C++ä¸­ä½¿ç”¨ONNX RuntimeåŠ è½½å’Œæ¨ç†ONNXæ¨¡å‹ï¼š</p> <pre><code>#include &lt;onnxruntime/core/providers/cpu/cpu_provider_factory.h&gt;
#include &lt;onnxruntime/core/providers/tensorrt/tensorrt_provider_factory.h&gt;
#include &lt;onnxruntime/core/session/onnxruntime_cxx_api.h&gt;

int main() {
    Ort::Env env(ORT_LOGGING_LEVEL_WARNING, "ONNXModel");

    Ort::SessionOptions session_options;
    session_options.AppendExecutionProvider_TensorRT();
    session_options.SetGraphOptimizationLevel(GraphOptimizationLevel::ORT_ENABLE_EXTENDED);

    Ort::Session session(env, "model.onnx", session_options);

    // è¾“å…¥ã€è¾“å‡ºå’Œæ¨ç†ä»£ç ç•¥...
    
    return 0;
}
</code></pre> <h2>Â </h2> <p><img src="https://images2.imgbox.com/74/f5/IrcmQy4Y_o.png" alt="2abe820ccf5e4af399c6049449f1dd1e.png"></p> </li></ol> 
<p>Â </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9308f0126c30d73927f031005666279b/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">SQL Serverå‡ ç§ç</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/93a0b31463d9767ab7e0e85f9c3dc94f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">è®¾å¤‡ç‰©è”ç½‘å…³åœ¨å®é™…ç”Ÿäº§ä¸­çš„ä½œç”¨è§£æ-å¤©æ‹“å››æ–¹</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>