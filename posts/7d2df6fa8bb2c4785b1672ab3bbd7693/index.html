<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【全网最完整】Open CASCADE Technology (OCCT) 构建项目，QT可视化操作，添加自定义测试内容 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7d2df6fa8bb2c4785b1672ab3bbd7693/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【全网最完整】Open CASCADE Technology (OCCT) 构建项目，QT可视化操作，添加自定义测试内容">
  <meta property="og:description" content="前言
1、项目所需工具下载
2、使用CMake编译源码
3、配置项目运行环境
4、如何自定义测试项目
5、总结
前言 本文为了记录自己在实习的过程中，学习到的有关OCCT开源项目的搭建工作，旨在教会小白从0开始下载开源项目及环境搭配，以及如何添加自定义测试内容，最终结果展示如下：
1、项目所需工具下载 本项目共需要使用四个工具，分别是OCCT开源代码，QT环境，CMake构建工具，VS2019，版本也会介绍。我会把CMake、VS2019、第三方库放到Github链接里​​​​​https://github.com/shadow0fiend/OCCT-Project，OCCT源码以及QT环境需要自己下载
其中下载链接如下：
OCCT（7.8或7.6或7.5皆可）：Download - Open CASCADE Technology
第三方库及VS2019：GitHub - shadow0fiend/OCCT-Project: 构建OCCT项目
QT工具（5.14.2）：Index of /archive/qt
CMake（3.29.3）：Download CMake
其中安装过程如下：
OCCT：下载64位的压缩包，解压到本地即可。
QT：对于新手，建议在勾选下载内容的时候全部选上（简单粗暴，不会缺少东西）
详情下载过程请参考链接：Qt5.14.2安装、配置及测试（Win10）-CSDN博客
CMake：无脑下一步即可
详情下载过程请参考链接：Windows下Cmake安装步骤详解（图文）_windows终端安装cmake-CSDN博客
安装完以后，本地应该有以下几个内容，注意检查cmake-gui、OCCT源码、编译用的三方库（下图product）、QT环境、VS2019
2、使用CMake编译源码 步骤1：在OCCT源码中建立一个build文件夹，用于存放编译后的文件
步骤2：打开CMake-gui，第一个位置填入OCCT源码文件夹的路径，第二个位置填入刚才创建好的build文件夹的路径
步骤3：点击configure，选择配置vs2019，x64，点击finish
步骤4：
第一步，在3RDPARTY_DIR这一行，填入第三方库文件的路径，也就是product的路径。
第二步，然后勾选上BUILD_SAMPLES_QT这一行。
第三步点击config。
步骤5：
第一步，修改QT路径，这个Qt5.14.2是安装完QT以后的文件夹，自行在里面找对应的文件（如果没有找到，应该是QT安装下载的时候，有的选项没有勾上）
第二步，改完以后点击config，点击generate，点击open project
步骤7：cmake配置完毕，最终配置结果如下所示
3、配置项目运行环境 生成的项目如下所示（如果没有勾选QT，那么编译完成以后的项目是不包含Samples文件的，只有非常简陋的可视化界面）：
步骤1：鼠标右击OCCTOverview，设置OCCTOverview为启动项。
步骤2：鼠标右击OCCTOverview，依次找到属性、Debugging、environment，将以下内容粘贴进去，这是配置项目环境变量的。注意：需要将路径修改为自己电脑的路径。
配置解释：
CASROOT需要配置OCCT源码文件夹
CSF_OCCT都是OCCT源码文件夹里面的文件
最后一行是配置QT的bin，QT的platforms，第三方库文件freetype，freeimage
CASROOT=E:\cpp\code\OCCT\OCCT-7_8_0 CSF_FPE=0 CSF_OCCTResourcePath=E:\cpp\code\OCCT\OCCT-7_8_0/src CSF_OCCTDataPath=E:\cpp\code\OCCT\OCCT-7_8_0/data CSF_OCCTSamplesPath=E:\cpp\code\OCCT\OCCT-7_8_0/samples CSF_OCCTTestsPath=E:\cpp\code\OCCT\OCCT-7_8_0/tests CSF_OCCTDocPath=E:\cpp\code\OCCT\OCCT-7_8_0/doc QT_DEBUG_PLUGINS=1 PATH=%PATH%;D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\bin;D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\plugins\platforms;E:\cpp\code\OCCT\products\freetype-2.5.5-vc14-64\bin;E:\cpp\code\OCCT\products\freeimage-3.17.0-vc14-64\bin; 步骤3：复制 D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\plugins 路径下的platforms文件，粘贴到 E:\cpp\code\OCCT\OCCT-7_8_0\build\win64\vc14\bind （生成的build文件里）路径下，如果要在release下运行，则将其粘贴到 E:\cpp\code\OCCT\OCCT-7_8_0\build\win64\vc14\bin路径下。
步骤4：编译运行即可完成。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-27T15:20:51+08:00">
    <meta property="article:modified_time" content="2024-06-27T15:20:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【全网最完整】Open CASCADE Technology (OCCT) 构建项目，QT可视化操作，添加自定义测试内容</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="1%E3%80%81%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD-toc" style="margin-left:0px;"><a href="#1%E3%80%81%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD" rel="nofollow">1、项目所需工具下载</a></p> 
<p id="2%E3%80%81%E4%BD%BF%E7%94%A8CMake%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81-toc" style="margin-left:0px;"><a href="#2%E3%80%81%E4%BD%BF%E7%94%A8CMake%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81" rel="nofollow">2、使用CMake编译源码</a></p> 
<p id="3%E3%80%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-toc" style="margin-left:0px;"><a href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83" rel="nofollow">3、配置项目运行环境</a></p> 
<p id="5%E3%80%81%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE-toc" style="margin-left:0px;"><a href="#5%E3%80%81%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE" rel="nofollow">4、如何自定义测试项目</a></p> 
<p id="6%E3%80%81%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#6%E3%80%81%E6%80%BB%E7%BB%93" rel="nofollow">5、总结</a></p> 
<hr id="hr-toc"> 
<h2 id="%E5%89%8D%E8%A8%80" style="background-color:transparent;">前言</h2> 
<p>        本文为了记录自己在实习的过程中，学习到的有关OCCT开源项目的搭建工作，旨在教会小白从0开始下载开源项目及环境搭配，以及如何添加自定义测试内容，最终结果展示如下：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/c0/6f/uOULXjae_o.png" width="1200"></p> 
<h2 id="1%E3%80%81%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E5%B7%A5%E5%85%B7%E4%B8%8B%E8%BD%BD">1、项目所需工具下载</h2> 
<p>本项目共需要使用四个工具，分别是<strong>OCCT开源代码</strong>，<strong>QT环境</strong>，<strong>CMake构建工具</strong>，<strong>VS2019</strong>，版本也会介绍。我会把CMake、VS2019、第三方库放到Github链接里​​​​​<a href="https://github.com/shadow0fiend/OCCT-Project" title="https://github.com/shadow0fiend/OCCT-Project">https://github.com/shadow0fiend/OCCT-Project</a>，OCCT源码以及QT环境需要自己下载</p> 
<p><strong>其中下载链接如下：</strong></p> 
<p>OCCT（7.8或7.6或7.5皆可）：<a href="https://dev.opencascade.org/release" rel="nofollow" title="Download - Open CASCADE Technology">Download - Open CASCADE Technology</a></p> 
<p>第三方库及VS2019：<a href="https://github.com/shadow0fiend/OCCT-Project" title="GitHub - shadow0fiend/OCCT-Project: 构建OCCT项目">GitHub - shadow0fiend/OCCT-Project: 构建OCCT项目</a></p> 
<p>QT工具（5.14.2）：<a href="https://download.qt.io/archive/qt/" rel="nofollow" title="Index of /archive/qt">Index of /archive/qt</a></p> 
<p>CMake（3.29.3）：<a href="https://cmake.org/download/" rel="nofollow" title="Download CMake">Download CMake</a></p> 
<p><strong>其中安装过程如下：</strong></p> 
<p>OCCT：下载64位的压缩包，解压到本地即可。</p> 
<p><img alt="" height="489" src="https://images2.imgbox.com/10/be/cdMuqSmR_o.png" width="1200"></p> 
<p>QT：对于新手，建议在勾选下载内容的时候全部选上（简单粗暴，不会缺少东西）</p> 
<p>详情下载过程请参考链接：<a href="https://blog.csdn.net/jk_rou/article/details/124782688?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171902830516800197079671%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=171902830516800197079671&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-124782688-null-null.142%5Ev100%5Epc_search_result_base8&amp;utm_term=QT5.14&amp;spm=1018.2226.3001.4187" title="Qt5.14.2安装、配置及测试（Win10）-CSDN博客">Qt5.14.2安装、配置及测试（Win10）-CSDN博客</a></p> 
<p>CMake：无脑下一步即可</p> 
<p>详情下载过程请参考链接：<a href="https://blog.csdn.net/qq_42598221/article/details/121952160?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171940656616800186559064%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=171940656616800186559064&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-121952160-null-null.142%5Ev100%5Epc_search_result_base8&amp;utm_term=cmake%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85&amp;spm=1018.2226.3001.4187" title="Windows下Cmake安装步骤详解（图文）_windows终端安装cmake-CSDN博客">Windows下Cmake安装步骤详解（图文）_windows终端安装cmake-CSDN博客</a></p> 
<p><strong>安装完以后，本地应该有以下几个内容，注意检查c</strong><strong>make-gui、OCCT源码、编译用的三方库（下图product）、QT环境、VS2019</strong></p> 
<p><img alt="" height="1062" src="https://images2.imgbox.com/1b/43/WUIRfTEj_o.png" width="1129"></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/c0/20/bzAb6aV6_o.png" width="1200"></p> 
<h2 id="2%E3%80%81%E4%BD%BF%E7%94%A8CMake%E7%BC%96%E8%AF%91%E6%BA%90%E7%A0%81">2、使用CMake编译源码</h2> 
<p><strong>步骤1：在OCCT源码中建立一个build文件夹，用于存放编译后的文件</strong></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/f7/72/wetnBmeL_o.png" width="1200"></p> 
<p><strong>步骤2：打开CMake-gui，第一个位置填入OCCT源码文件夹的路径，第二个位置填入刚才创建好的build文件夹的路径</strong></p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/f1/71/BEgwUAYr_o.png" width="1200"></p> 
<p><strong>步骤3：点击configure，选择配置vs2019，x64，点击finish</strong></p> 
<p><img alt="" height="720" src="https://images2.imgbox.com/b3/0b/lFAtDFkB_o.png" width="1000"></p> 
<p><strong>步骤4：</strong></p> 
<p><strong>第一步，在3RDPARTY_DIR这一行，填入第三方库文件的路径，也就是product的路径。</strong></p> 
<p><strong>第二步，然后勾选上BUILD_SAMPLES_QT这一行。</strong></p> 
<p><strong>第三步点击config。</strong></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/92/66/DKKRzJyD_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/89/1d/G356ACZ8_o.png" width="1200"></p> 
<p><strong>步骤5：</strong></p> 
<p><strong>第一步，修改QT路径，这个Qt5.14.2是安装完QT以后的文件夹，自行在里面找对应的文件（如果没有找到，应该是QT安装下载的时候，有的选项没有勾上）</strong></p> 
<p><strong>第二步，改完以后点击config，点击generate，点击open project</strong></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/33/07/N4gPl6IH_o.png" width="1200"></p> 
<p></p> 
<p><strong>步骤7：cmake配置完毕，最终配置结果如下所示</strong></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/db/a3/eeVxxAqe_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fc/56/cfIwfQzB_o.png" width="1200"></p> 
<h2 id="3%E3%80%81%E9%85%8D%E7%BD%AE%E9%A1%B9%E7%9B%AE%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83">3、配置项目运行环境</h2> 
<p>生成的项目如下所示（如果没有勾选QT，那么编译完成以后的项目是不包含Samples文件的，只有非常简陋的可视化界面）：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/47/33/K81g4pEq_o.png" width="1200"></p> 
<p><strong>步骤1：鼠标右击OCCTOverview，设置OCCTOverview为启动项。</strong></p> 
<p><strong>步骤2：鼠标右击OCCTOverview，依次找到属性、Debugging、environment，将以下内容粘贴进去，这是配置项目环境变量的。注意：需要将路径修改为自己电脑的路径。</strong></p> 
<p><strong>配置解释：</strong></p> 
<p><strong>CASROOT需要配置OCCT源码文件夹</strong></p> 
<p><strong>CSF_OCCT都是OCCT源码文件夹里面的文件</strong></p> 
<p><strong>最后一行是配置QT的bin，QT的platforms，第三方库文件freetype，freeimage</strong></p> 
<pre><code>CASROOT=E:\cpp\code\OCCT\OCCT-7_8_0
CSF_FPE=0
CSF_OCCTResourcePath=E:\cpp\code\OCCT\OCCT-7_8_0/src
CSF_OCCTDataPath=E:\cpp\code\OCCT\OCCT-7_8_0/data
CSF_OCCTSamplesPath=E:\cpp\code\OCCT\OCCT-7_8_0/samples
CSF_OCCTTestsPath=E:\cpp\code\OCCT\OCCT-7_8_0/tests
CSF_OCCTDocPath=E:\cpp\code\OCCT\OCCT-7_8_0/doc
QT_DEBUG_PLUGINS=1
PATH=%PATH%;D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\bin;D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\plugins\platforms;E:\cpp\code\OCCT\products\freetype-2.5.5-vc14-64\bin;E:\cpp\code\OCCT\products\freeimage-3.17.0-vc14-64\bin;</code></pre> 
<p><strong>步骤3：复制  D:\Qt\Qt5.14.2\5.14.2\msvc2015_64\plugins 路径下的platforms文件，粘贴到 E:\cpp\code\OCCT\OCCT-7_8_0\build\win64\vc14\bind （生成的build文件里）路径下，如果要在release下运行，则将其粘贴到 E:\cpp\code\OCCT\OCCT-7_8_0\build\win64\vc14\bin路径下。</strong></p> 
<p><strong>步骤4：编译运行即可完成。</strong></p> 
<p><img alt="" height="1163" src="https://images2.imgbox.com/20/43/NFIwKOYq_o.png" width="1200"></p> 
<h2 id="5%E3%80%81%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE" style="background-color:transparent;">4、如何自定义测试项目</h2> 
<p>先看自己修改的结果，在QT窗口自己添加按钮，用于触发函数，然后再在被触发的函数里编写自己的测试代码，就可以完成自定义测试了。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/1b/bf/tp4QzShf_o.jpg" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5d/58/fHbIVnWp_o.jpg" width="1200"></p> 
<p>具体来说，需要修改5个地方：</p> 
<p><strong>找到OCCT源码里的samples文件（注意，不是build里的samples），进去以后找到OCCTOverview，再找到Code文件夹。我的路径是：E:\cpp\code\OCCT\OCCT-7_8_0\samples\OCCTOverview\code</strong></p> 
<p><img alt="" height="1007" src="https://images2.imgbox.com/45/75/EyCaJwhK_o.png" width="954"></p> 
<p><strong>第一处修改：把自己写的cxx文件和.h文件放在这里（注意：直接在build里右键添加cxx文件是添加不到这里来的，因为那只是在build文件里添加了，而这是OCCT的源码文件，只能在这里添加以后，通过cmake编译进build才行）</strong></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/ac/73/d9ty5brO_o.png" width="1200"></p> 
<p>具体的cxx和.h文件的写法参考如下，可以仿照源码的 TopologySamples.cxx文件的写法，看我的cxx和TopologySamples.cxx不同的地方即可，按照对应位置改就行。这里我附上我的源码。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/3e/e8/K8oYHAHu_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/54/59/JD1ZYgly_o.png" width="1200"></p> 
<pre><code class="language-cpp">#include "PengKaiSamples.h"

void PengKaiSamples::ExecuteSample(const TCollection_AsciiString&amp; theSampleName)
{
	Standard_Boolean anIsSamplePresent = Standard_True;
	FindSourceCode(theSampleName);
	if (theSampleName == "FirstTest")
		FirstTest();
	else
	{
		myResult &lt;&lt; "No function found: " &lt;&lt; theSampleName;
		myCode += TCollection_AsciiString("No function found: ") + theSampleName;
		anIsSamplePresent = Standard_False;
	}
	myIsProcessed = anIsSamplePresent;
}

void PengKaiSamples::FirstTest()
{
	for (int i = 0; i &lt; 20; i++)
	{
		std::cout &lt;&lt; "enter FirstTest" &lt;&lt; std::endl;
	}
}</code></pre> 
<pre><code class="language-cpp">#ifndef PENGKAISAMPLES_H
#define PENGKAISAMPLES_H

#include "BaseSample.h"

#include &lt;AIS_InteractiveContext.hxx&gt;

//! Implements PengKai samples
class PengKaiSamples : public BaseSample
{
	DEFINE_STANDARD_RTTI_INLINE(PengKaiSamples, BaseSample)
public:

	PengKaiSamples(const TCollection_AsciiString&amp; theSampleSourcePath,
		const Handle(AIS_InteractiveContext)&amp; theContext)
		: BaseSample(theSampleSourcePath, theContext)
	{}

protected:
	virtual void ExecuteSample(const TCollection_AsciiString&amp; theSampleName) Standard_OVERRIDE;

private:
	// One function for every sample
	void FirstTest();
};

#endif  //PENGKAISAMPLES_H</code></pre> 
<p><strong>第二处修改：添加XML文件</strong></p> 
<p><strong>思路：仿照其他xml文件来写</strong></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/54/18/7TDHsBqM_o.png" width="1200"></p> 
<p><img alt="" height="457" src="https://images2.imgbox.com/06/94/R7ODT2WD_o.png" width="1200"></p> 
<pre><code class="language-cpp">&lt;Menu&gt;
  &lt;MenuItem name="PengKai"&gt;
    &lt;MenuItem name="PengKai Test"&gt;
      &lt;Sample name="FirstTest" function="FirstTest"/&gt;
    &lt;/MenuItem&gt;
  &lt;/MenuItem&gt;
&lt;/Menu&gt;</code></pre> 
<p><strong>第三处修改：</strong></p> 
<p><strong>修改FILES文件，仿照其他人的写法，把cxx文件、xml文件和.h文件添加进去</strong></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/1f/49/tE2zHTZJ_o.png" width="1200"></p> 
<p><img alt="" height="1192" src="https://images2.imgbox.com/2e/43/WO5fMVtw_o.png" width="1200"></p> 
<pre><code class="language-cpp">AdaptorCurve2d_AIS.cxx
AdaptorCurve2d_AIS.h
AdaptorCurve_AIS.cxx
AdaptorCurve_AIS.h
AdaptorPnt2d_AIS.cxx
AdaptorPnt2d_AIS.h
AdaptorVec_AIS.cxx
AdaptorVec_AIS.h
BaseSample.cxx
BaseSample.h
DataExchange.xml
DataExchangeSamples.cxx
DataExchangeSamples.h
Geometry.xml
GeometrySamples.cxx
GeometrySamples.h
MakeBottle.cxx
MakeBottle.h
Ocaf.xml
OcafSamples.cxx
OcafSamples.h
Sample2D_Face.cxx
Sample2D_Face.h
Sample2D_Image.cxx
Sample2D_Image.h
Sample2D_Markers.cxx
Sample2D_Markers.h
Samples.qrc
TOcafFunction_BoxDriver.cxx
TOcafFunction_BoxDriver.h
TOcafFunction_CutDriver.cxx
TOcafFunction_CutDriver.h
TOcafFunction_CylDriver.cxx
TOcafFunction_CylDriver.h
TOcaf_Application.cxx
TOcaf_Application.h
Topology.xml
TopologySamples.cxx
TopologySamples.h
Triangulation.xml
TriangulationSamples.cxx
TriangulationSamples.h
Viewer2d.xml
Viewer2dSamples.cxx
Viewer2dSamples.h
Viewer3d.xml
Viewer3dSamples.cxx
Viewer3dSamples.h
PengKai.xml
PengKaiSamples.cxx
PengKaiSamples.h
</code></pre> 
<p><strong>第四处修改：</strong></p> 
<p><strong>找到samples文件夹里的qt -&gt; Common -&gt; src，找到这两个cxx文件，进去修改</strong></p> 
<p><strong>仿照文件里Topology结构的写法来写，把所有带有Topology的地方全部换成自己修改的名字。</strong></p> 
<p><strong>内容太多，这里不易说明，建议直接拿我修改后的代码与源码做对比，可以看出添加的部分在哪里</strong></p> 
<p><img alt="" height="1048" src="https://images2.imgbox.com/d6/4f/ljrBQqZ8_o.png" width="1200"></p> 
<pre><code class="language-cpp">// Copyright (c) 2020 OPEN CASCADE SAS
//
// This file is part of the examples of the Open CASCADE Technology software library.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE

#include "ApplicationCommon.h"

#include &lt;Standard_WarningsDisable.hxx&gt;
#include &lt;QApplication&gt;
#include &lt;QDir&gt;
#include &lt;QFile&gt;
#include &lt;QFont&gt;
#include &lt;QFrame&gt;
#include &lt;QGroupBox&gt;
#include &lt;QMap&gt;
#include &lt;QMdiArea&gt;
#include &lt;QMdiSubWindow&gt;
#include &lt;QMenuBar&gt;
#include &lt;QMessageBox&gt;
#include &lt;QPair&gt;
#include &lt;QSplitter&gt;
#include &lt;QStatusBar&gt;
#include &lt;QtGlobal&gt;
#include &lt;QHBoxLayout&gt;
#include &lt;QVBoxLayout&gt;
#include &lt;QWidget&gt;
#include &lt;QDomDocument&gt;
#include &lt;QDomAttr&gt;
#include &lt;Standard_WarningsRestore.hxx&gt;

#include &lt;OpenGl_GraphicDriver.hxx&gt;
#include &lt;OSD_Environment.hxx&gt;

#include &lt;stdlib.h&gt;
#include &lt;memory&gt;

ApplicationCommonWindow::ApplicationCommonWindow (ApplicationType theCategory)
: QMainWindow (nullptr),
  myAppType(theCategory),
  myStdToolBar (nullptr),
  myViewBar (nullptr),
  myCasCadeBar (nullptr),
  myFilePopup (nullptr),
  myCategoryPopup (nullptr)
{
  ALL_CATEGORIES[AppType_Geometry] = "Geometry";
  ALL_CATEGORIES[AppType_Topology] = "Topology";
  ALL_CATEGORIES[AppType_Triangulation] = "Triangulation";
  ALL_CATEGORIES[AppType_DataExchange] = "DataExchange";
  ALL_CATEGORIES[AppType_Ocaf] = "OCAF";
  ALL_CATEGORIES[AppType_Viewer3d] = "3D viewer";
  ALL_CATEGORIES[AppType_Viewer2d] = "2D Viewer";
  ALL_CATEGORIES[AppType_PengKai] = "PengKai";

  mySampleMapper   = new QSignalMapper(this);
  myExchangeMapper = new QSignalMapper(this);
  myOcafMapper     = new QSignalMapper(this);
  myViewer3dMapper = new QSignalMapper(this);
  myViewer2dMapper = new QSignalMapper(this);

  myCategoryMapper = new QSignalMapper(this);

  connect(mySampleMapper,   SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessSample(const QString &amp;)));
  connect(myExchangeMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessExchange(const QString &amp;)));
  connect(myOcafMapper,     SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessOcaf(const QString &amp;)));
  connect(myViewer3dMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessViewer3d(const QString &amp;)));
  connect(myViewer2dMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessViewer2d(const QString &amp;)));

  connect(myCategoryMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onChangeCategory(const QString &amp;)));

  setFocusPolicy(Qt::StrongFocus);

  QFont aCodeViewFont;
  aCodeViewFont.setFamily("Courier");
  aCodeViewFont.setFixedPitch(true);
  aCodeViewFont.setPointSize(10);

  QGroupBox* aCodeFrame = new QGroupBox(tr("Sample code"));
  QVBoxLayout* aCodeLayout = new QVBoxLayout(aCodeFrame);
  aCodeLayout-&gt;setContentsMargins(3, 3, 3, 3);
  myCodeView = new QTextEdit(aCodeFrame);
  aCodeLayout-&gt;addWidget(myCodeView);
  myCodeView-&gt;setDocumentTitle("Code");
  myCodeView-&gt;setLineWrapMode(QTextEdit::NoWrap);
  myCodeView-&gt;setReadOnly(true);
  myCodeView-&gt;setFont(aCodeViewFont);
  myCodeViewHighlighter = new OcctHighlighter(myCodeView-&gt;document());

  QGroupBox* aResultFrame = new QGroupBox(tr("Output"));
  QVBoxLayout* aResultLayout = new QVBoxLayout(aResultFrame);
  aResultLayout-&gt;setContentsMargins(3, 3, 3, 3);
  myResultView = new QTextEdit(aResultFrame);
  aResultLayout-&gt;addWidget(myResultView);
  myResultView-&gt;setDocumentTitle("Output");
  myResultView-&gt;setReadOnly(true);
  myResultView-&gt;setFont(aCodeViewFont);

  QSplitter* aCodeResultSplitter = new QSplitter(Qt::Vertical);
  aCodeResultSplitter-&gt;addWidget(aCodeFrame);
  aCodeResultSplitter-&gt;addWidget(aResultFrame);

  myDocument3d = createNewDocument();
  myDocument2d = createNewDocument();

  QFrame* aViewFrame = new QFrame;
  aViewFrame-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
  aViewFrame-&gt;setLineWidth(3);
  QVBoxLayout* aViewLayout = new QVBoxLayout(aViewFrame);
  aViewLayout-&gt;setContentsMargins(0, 0, 0, 0);
  myGeomWidget = new GeomWidget(myDocument3d, myDocument2d, aViewFrame);
  aViewLayout-&gt;addWidget(myGeomWidget);

  myGeomWidget-&gt;setContentsMargins(0, 0, 0, 0);
  QSplitter* aGeomTextSplitter = new QSplitter(Qt::Horizontal);

  aGeomTextSplitter-&gt;addWidget(aViewFrame);
  aGeomTextSplitter-&gt;addWidget(aCodeResultSplitter);
  aGeomTextSplitter-&gt;setStretchFactor(0, 1);
  aGeomTextSplitter-&gt;setStretchFactor(1, 1);
  QList&lt;int&gt; aSizeList;
  aSizeList.append(640);
  aSizeList.append(640);
  aGeomTextSplitter-&gt;setSizes(aSizeList);
  setCentralWidget(aGeomTextSplitter);

#include &lt;Standard_WarningsDisable.hxx&gt;
  Q_INIT_RESOURCE(Samples);
#include &lt;Standard_WarningsRestore.hxx&gt;

  TCollection_AsciiString aSampleSourcePach = getSampleSourceDir();
  myGeometrySamples      = new GeometrySamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());
  myTopologySamples      = new TopologySamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());
  myTriangulationSamples = new TriangulationSamples(aSampleSourcePach,
                                                    myDocument3d-&gt;getContext());
  myDataExchangeSamples  = new DataExchangeSamples(aSampleSourcePach,
                                                   myGeomWidget-&gt;Get3dView(),
                                                   myDocument3d-&gt;getContext());
  myOcafSamples          = new OcafSamples(aSampleSourcePach,
                                           myDocument3d-&gt;getViewer(),
                                           myDocument3d-&gt;getContext());
  myViewer3dSamples      = new Viewer3dSamples(aSampleSourcePach,
                                               myGeomWidget-&gt;Get3dView(),
                                               myDocument3d-&gt;getContext());
  myViewer2dSamples      = new Viewer2dSamples(aSampleSourcePach,
                                               myGeomWidget-&gt;Get2dView(),
                                               myDocument2d-&gt;getViewer(),
                                               myDocument2d-&gt;getContext());

  myPengKaiSamples      = new PengKaiSamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());

  MenuFormXml(":/menus/Geometry.xml",      mySampleMapper,   myGeometryMenus);
  MenuFormXml(":/menus/Topology.xml",      mySampleMapper,   myTopologyMenus);
  MenuFormXml(":/menus/Triangulation.xml", mySampleMapper,   myTriangulationMenus);
  MenuFormXml(":/menus/DataExchange.xml",  myExchangeMapper, myDataExchangeMenus);
  MenuFormXml(":/menus/Ocaf.xml",          myOcafMapper,     myOcafMenus);
  MenuFormXml(":/menus/Viewer3d.xml",      myViewer3dMapper, myViewer3dMenus);
  MenuFormXml(":/menus/Viewer2d.xml",      myViewer2dMapper, myViewer2dMenus);
  MenuFormXml(":/menus/PengKai.xml",      mySampleMapper, myPengKaiMenus);

  onChangeCategory(ALL_CATEGORIES[myAppType]);

  resize(1280, 560);
}

void ApplicationCommonWindow::RebuildMenu()
{
  menuBar()-&gt;clear();

  myStdActions[StdActions_FileQuit] = CreateAction("Quit", "CTRL+Q");
  connect(myStdActions[StdActions_FileQuit], SIGNAL(triggered()), this, SLOT(onCloseAllWindows()));
  myStdActions[StdActions_HelpAbout] = CreateAction("About", "F1", ":/icons/help.png");
  connect(myStdActions[StdActions_HelpAbout], SIGNAL(triggered()), this, SLOT(onAbout()));

  // populate a menu with all actions
  myFilePopup = new QMenu(this);
  myFilePopup = menuBar()-&gt;addMenu(tr("&amp;File"));
  myFilePopup-&gt;addAction(myStdActions[StdActions_FileQuit]);

  myCategoryPopup = new QMenu(this);
  myCategoryPopup = menuBar()-&gt;addMenu(tr("&amp;Category"));

  foreach (ApplicationType aCategory, ALL_CATEGORIES.keys())
  {
    QString aCategoryName = ALL_CATEGORIES.value(aCategory);
    QAction* anAction = myCategoryPopup-&gt;addAction(aCategoryName);
    anAction-&gt;setText(aCategoryName);
    myCategoryMapper-&gt;setMapping(anAction, aCategoryName);
    connect(anAction, SIGNAL(triggered()), myCategoryMapper, SLOT(map()));
    myCategoryPopup-&gt;addAction(anAction);
    myCategoryActions.insert(aCategory, anAction);
  }

  foreach (QMenu* aSampleMenu, GetCurrentMenus())
  {
    menuBar()-&gt;addMenu(aSampleMenu);
  }

  // add a help menu
  QMenu* aHelp = new QMenu(this);
  menuBar()-&gt;addSeparator();
  aHelp = menuBar()-&gt;addMenu(tr("&amp;Help"));
  aHelp-&gt;addAction(myStdActions[StdActions_HelpAbout]);
}

Handle(BaseSample) ApplicationCommonWindow::GetCurrentSamples()
{
  switch (myAppType)
  {
    case AppType_Geometry:      return myGeometrySamples;
    case AppType_Topology:      return myTopologySamples;
    case AppType_Triangulation: return myTriangulationSamples;
    case AppType_DataExchange:  return myDataExchangeSamples;
    case AppType_Ocaf:          return myOcafSamples;
    case AppType_Viewer2d:      return myViewer2dSamples;
    case AppType_Viewer3d:      return myViewer3dSamples;
    case AppType_PengKai:      return myPengKaiSamples;
    case AppType_Unknown:
      break;
  }
  throw QString("Unknown Application type");
}

const QList&lt;QMenu*&gt;&amp; ApplicationCommonWindow::GetCurrentMenus()
{
  switch (myAppType)
  {
    case AppType_Geometry:      return myGeometryMenus;
    case AppType_Topology:      return myTopologyMenus;
    case AppType_Triangulation: return myTriangulationMenus;
    case AppType_DataExchange:  return myDataExchangeMenus;
    case AppType_Ocaf:          return myOcafMenus;
    case AppType_Viewer2d:      return myViewer2dMenus;
    case AppType_Viewer3d:      return myViewer3dMenus;
    case AppType_PengKai:      return myPengKaiMenus;
    case AppType_Unknown:
      break;
  }
  throw QString("Unknown Application type");
}

DocumentCommon* ApplicationCommonWindow::createNewDocument()
{
  return new DocumentCommon(this);
}

void ApplicationCommonWindow::onChangeCategory(const QString&amp; theCategory)
{
  myAppType = ALL_CATEGORIES.key(theCategory);
  setWindowTitle(ALL_CATEGORIES[myAppType]);

  myOcafSamples-&gt;ClearExtra();
  myViewer3dSamples-&gt;ClearExtra();
  myViewer2dSamples-&gt;ClearExtra();

  GetCurrentSamples()-&gt;Clear();
  myDocument3d-&gt;Clear();
  myDocument2d-&gt;Clear();

  myCodeView-&gt;setPlainText("");
  myResultView-&gt;setPlainText("");
  GetCurrentSamples()-&gt;AppendCube();
  myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
  myGeomWidget-&gt;FitAll();

  RebuildMenu();

  switch (myAppType)
  {
    case AppType_DataExchange:
    {
      myDataExchangeSamples-&gt;AppendBottle();
      myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Ocaf:
    {
      onProcessOcaf("CreateOcafDocument");
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Viewer2d:
    {
      myGeomWidget-&gt;Show2d();
      break;
    }
    case AppType_Viewer3d:
    {
      myViewer3dSamples-&gt;AppendBottle();
      myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Geometry:
    case AppType_Topology:
    case AppType_PengKai:
    case AppType_Triangulation:
    case AppType_Unknown:
    {
      break;
    }
  }
}

void ApplicationCommonWindow::onAbout()
{
  QMessageBox::information(this, tr("OCCT Overview"),
    tr("Qt based application to study OpenCASCADE Technology"),
    tr("Ok"), QString::null, QString::null, 0, 0);
}

TCollection_AsciiString ApplicationCommonWindow::getSampleSourceDir()
{
  TCollection_AsciiString aSampleSourceDir = OSD_Environment("CSF_OCCTOverviewSampleCodePath").Value();
  if (aSampleSourceDir.IsEmpty())
  {
    TCollection_AsciiString aCasRoot = OSD_Environment("CASROOT").Value();
    if (!aCasRoot.IsEmpty())
    {
      aSampleSourceDir = aCasRoot + "/samples/OCCTOverview/code";
    }
  }
  return aSampleSourceDir;
}

QAction* ApplicationCommonWindow::CreateAction (const QString&amp; theActionName,
                                                const QString&amp; theShortcut,
                                                const QString&amp; theIconName)
{
  QAction* aAction(NULL);
  if (theIconName.isEmpty())
  {
    aAction = new QAction(theActionName, this);
  }
  else
  {
    QPixmap aIcon = QPixmap(theIconName);
    aAction = new QAction(aIcon, theActionName, this);
  }
  aAction-&gt;setToolTip(theActionName);
  aAction-&gt;setStatusTip(theActionName);
  aAction-&gt;setShortcut(theShortcut);

  return aAction;
}

template &lt;typename PointerToMemberFunction&gt;
QAction* ApplicationCommonWindow::CreateSample (PointerToMemberFunction theHandlerMethod,
                                                const char* theActionName)
{
  QAction* anAction = new QAction(QObject::tr(theActionName), this);
  connect(anAction, SIGNAL(triggered()), this, SLOT(theHandlerMethod()));
  return anAction;
}

void ApplicationCommonWindow::resizeEvent(QResizeEvent* e)
{
  QMainWindow::resizeEvent(e);
  statusBar()-&gt;setSizeGripEnabled(!isMaximized());
}

void ApplicationCommonWindow::onProcessSample(const QString&amp; theSampleName)
{
  QApplication::setOverrideCursor(Qt::WaitCursor);
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);
  GetCurrentSamples()-&gt;Process(theSampleName.toUtf8().data());
  myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
  myDocument2d-&gt;SetObjects(GetCurrentSamples()-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(GetCurrentSamples()-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(GetCurrentSamples()-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessExchange(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);
  int aMode = 0;
  QString aFileName = selectFileName(theSampleName, getDataExchangeDialog(theSampleName), aMode);
  if (aFileName.isEmpty())
  {
    return;
  }

  QApplication::setOverrideCursor(Qt::WaitCursor);
  myDataExchangeSamples-&gt;SetFileName(aFileName.toUtf8().data());
  myDataExchangeSamples-&gt;SetStepType(static_cast&lt;STEPControl_StepModelType&gt;(aMode));
  myDataExchangeSamples-&gt;Process(theSampleName.toUtf8().data());
  myDocument3d-&gt;SetObjects(myDataExchangeSamples-&gt;Get3dObjects());
  myDocument2d-&gt;SetObjects(myDataExchangeSamples-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(myDataExchangeSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myDataExchangeSamples-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessOcaf(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  if (theSampleName.indexOf("Dialog") == 0)
  {
    int aMode = 0; // not used
    QString aFileName = selectFileName(theSampleName, getOcafDialog(theSampleName), aMode);
    if (aFileName.isEmpty())
    {
      return;
    }
    myOcafSamples-&gt;SetFileName(aFileName.toUtf8().data());
  }
  QApplication::setOverrideCursor(Qt::WaitCursor);
  myOcafSamples-&gt;Process(theSampleName.toUtf8().data());
  myDocument2d-&gt;SetObjects(myOcafSamples-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(myOcafSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myOcafSamples-&gt;GetResult().ToCString());
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessViewer3d(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  QApplication::setOverrideCursor(Qt::WaitCursor);
  myViewer3dSamples-&gt;Process(theSampleName.toUtf8().data());
  myCodeView-&gt;setPlainText(myViewer3dSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myViewer3dSamples-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessViewer2d(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  Standard_Boolean anIsFileSample = Viewer2dSamples::IsFileSample(theSampleName.toUtf8().data());
  QString aFileName;
  if (anIsFileSample)
  {
    int aMode = 0; // not used
    aFileName = selectFileName(theSampleName, getOcafDialog(theSampleName), aMode);
    if (aFileName.isEmpty())
    {
      return;
    }

    myViewer2dSamples-&gt;SetFileName(aFileName.toUtf8().data());
  }
  if (!anIsFileSample || (anIsFileSample &amp;&amp; !aFileName.isEmpty()))
  {
    QApplication::setOverrideCursor(Qt::WaitCursor);
    myViewer2dSamples-&gt;Process(theSampleName.toUtf8().data());
    if (!Viewer2dSamples::IsShadedSample(theSampleName.toUtf8().data()))
    {
      myDocument2d-&gt;SetObjects(myViewer2dSamples-&gt;Get2dObjects(), Standard_False);
    }
    else
    {
      myDocument2d-&gt;SetObjects(myViewer2dSamples-&gt;Get2dObjects(), Standard_True);
    }
    myCodeView-&gt;setPlainText(myViewer2dSamples-&gt;GetCode().ToCString());
    myResultView-&gt;setPlainText(myViewer2dSamples-&gt;GetResult().ToCString());
    myGeomWidget-&gt;Show2d();
    QApplication::restoreOverrideCursor();
  }
  else
  {
    myResultView-&gt;setPlainText("No file selected!");
  }
}

QString ApplicationCommonWindow::selectFileName(const QString&amp; theSampleName,
                                                TranslateDialog* theDialog, int&amp; theMode)
{
  Q_UNUSED(theSampleName)

  std::shared_ptr&lt;TranslateDialog&gt; aDialog(theDialog);

  int ret = aDialog-&gt;exec();
  theMode = aDialog-&gt;getMode();

  qApp-&gt;processEvents();

  QString aFilename;
  QStringList aFileNameList;
  if (ret != QDialog::Accepted)
  {
    return aFilename;
  }
  aFileNameList = aDialog-&gt;selectedFiles();
  if (!aFileNameList.isEmpty())
  {
    aFilename = aFileNameList[0];
  }

  if (!QFileInfo(aFilename).completeSuffix().length())
  {
    QString selFilter = aDialog-&gt;selectedNameFilter();
    int idx = selFilter.indexOf("(*.");
    if (idx != -1)
    {
      QString tail = selFilter.mid(idx + 3);
      idx = tail.indexOf(" ");
      if (idx == -1)
      {
        idx = tail.indexOf(")");
      }
      QString ext = tail.left(idx);
      if (ext.length())
      {
        aFilename += QString(".") + ext;
      }
    }
  }

  return aFilename;
}

TranslateDialog* ApplicationCommonWindow::getDataExchangeDialog(const QString&amp; theSampleName)
{
  TranslateDialog* aTranslateDialog = new TranslateDialog(this, 0, true);
  TCollection_AsciiString aSampleName(theSampleName.toUtf8().data());

  if (DataExchangeSamples::IsExportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Export file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::AnyFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptSave);
  }
  else if (DataExchangeSamples::IsImportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Import file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::ExistingFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptOpen);
  }
  QString aFormatFilter;
  if (DataExchangeSamples::IsBrepSample(aSampleName))
  {
    aFormatFilter = "BREP Files(*.brep *.rle)";
  }
  else if (DataExchangeSamples::IsStepSample(aSampleName))
  {
    aFormatFilter = "STEP Files (*.stp *.step)";
    aTranslateDialog-&gt;addMode(STEPControl_ManifoldSolidBrep, "Manifold Solid Brep");
    aTranslateDialog-&gt;addMode(STEPControl_FacetedBrep, "Faceted Brep");
    aTranslateDialog-&gt;addMode(STEPControl_ShellBasedSurfaceModel, "Shell Based Surface Model");
    aTranslateDialog-&gt;addMode(STEPControl_GeometricCurveSet, "Geometric Curve Set");
  }
  else if (DataExchangeSamples::IsIgesSample(aSampleName))
  {
    aFormatFilter = "IGES Files (*.igs *.iges)";
  }
  else if (DataExchangeSamples::IsStlSample(aSampleName))
  {
    aFormatFilter = "STL Files (*.stl)";
  }
  else if (DataExchangeSamples::IsVrmlSample(aSampleName))
  {
    aFormatFilter = "VRML Files (*.vrml)";
  }
  else if (DataExchangeSamples::IsImageSample(aSampleName))
  {
    aFormatFilter = "All Image Files (*.bmp *.gif *.jpg *.jpeg *.png *.tga)";
  }
  QStringList aFilters;
  aFilters.append(aFormatFilter);
  aFilters.append("All Files(*.*)");

  aTranslateDialog-&gt;setNameFilters(aFilters);
  aTranslateDialog-&gt;clear();
  return aTranslateDialog;
}

TranslateDialog* ApplicationCommonWindow::getOcafDialog(const QString&amp; theSampleName)
{
  TranslateDialog* aTranslateDialog = new TranslateDialog(this, 0, true);
  TCollection_AsciiString aSampleName(theSampleName.toUtf8().data());

  if (OcafSamples::IsExportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Export file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::AnyFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptSave);
  }
  else if (OcafSamples::IsImportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Import file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::ExistingFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptOpen);
  }
  QStringList aFilters;
  if (OcafSamples::IsBinarySample(aSampleName))
  {
    aFilters.append("Binary OCAF Sample (*.cbf)");
  }
  if (OcafSamples::IsXmlSample(aSampleName))
  {
    aFilters.append("XML OCAF Sample (*.xml)");
  }
  aFilters.append("All Files(*.*)");

  aTranslateDialog-&gt;setNameFilters(aFilters);
  aTranslateDialog-&gt;clear();
  return aTranslateDialog;
}

QMenu* ApplicationCommonWindow::MenuFromDomNode(QDomElement&amp; theItemElement,
                                                QWidget* theParent,
                                                QSignalMapper* theMapper)
{
  QString anItemName        = theItemElement.attribute("name");
  QMenu* aMenu = new QMenu(anItemName, theParent);
  QDomElement anChildItemElement = theItemElement.firstChildElement("MenuItem");
  QDomElement anSampleElement    = theItemElement.firstChildElement("Sample");

  while(anChildItemElement.isElement())
  {
    aMenu-&gt;addMenu(MenuFromDomNode(anChildItemElement, aMenu, theMapper));
    anChildItemElement = anChildItemElement.nextSibling().toElement();
  }

  while(anSampleElement.isElement())
  {
    QString aSampleName     = anSampleElement.attribute("name");
    QString aSampleFunction = anSampleElement.attribute("function");
    QAction* anAction = aMenu-&gt;addAction(aSampleFunction);
    anAction-&gt;setText(aSampleName);
    theMapper-&gt;setMapping(anAction, aSampleFunction);
    connect(anAction, SIGNAL(triggered()), theMapper, SLOT(map()));
    anSampleElement = anSampleElement.nextSibling().toElement();
  }
  return aMenu;
}

void ApplicationCommonWindow::MenuFormXml(const QString&amp; thePath,
                                          QSignalMapper* theMapper,
                                          QList&lt;QMenu*&gt;&amp; theMunusList)
{
  QDomDocument aDomDocument;
  theMunusList.clear();
  QFile aXmlFile(thePath);
  QString anErrorMessage;
  if (aXmlFile.error() != QFile::NoError)
  {
    anErrorMessage = aXmlFile.errorString();
    Message::SendFail() &lt;&lt; "QFile creating error: " &lt;&lt; anErrorMessage.toUtf8().constData();
    aXmlFile.close();
    return;
  }
  if (!aXmlFile.open(QIODevice::ReadOnly | QIODevice::Text))
  {
    Message::SendFail() &lt;&lt; "File " &lt;&lt; thePath.toUtf8().constData() &lt;&lt; " could not open";
    if (aXmlFile.error() != QFile::NoError)
    {
      anErrorMessage = aXmlFile.errorString();
      Message::SendFail() &lt;&lt; "QFile opening error: " &lt;&lt; anErrorMessage.toUtf8().constData();
    }
    aXmlFile.close();
    return;
  }
  bool aNamespaceProcessing(false);
  QString anErrorMsg;
  int anErrorLine(0);
  int anErrorColumn(0);
  if (!aDomDocument.setContent(&amp;aXmlFile, aNamespaceProcessing, &amp;anErrorMsg, &amp;anErrorLine, &amp;anErrorColumn))
  {
    Message::SendFail() &lt;&lt; "XML file parsing error: " &lt;&lt;  anErrorMsg.toStdString()
                        &lt;&lt; " at line: " &lt;&lt; anErrorLine &lt;&lt; " column: " &lt;&lt; anErrorColumn;
    aXmlFile.close();
    return;
  }
  aXmlFile.close();

  QDomElement aRootElement = aDomDocument.documentElement();
  QDomElement anItemElement = aRootElement.firstChildElement("MenuItem");
  while(!anItemElement.isNull())
  {
    theMunusList.push_back(MenuFromDomNode(anItemElement, this, theMapper));
    anItemElement = anItemElement.nextSiblingElement("MenuItem");
  }
}
</code></pre> 
<pre><code class="language-cpp">// Copyright (c) 2020 OPEN CASCADE SAS
//
// This file is part of the examples of the Open CASCADE Technology software library.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE

#include "ApplicationCommon.h"

#include &lt;Standard_WarningsDisable.hxx&gt;
#include &lt;QApplication&gt;
#include &lt;QDir&gt;
#include &lt;QFile&gt;
#include &lt;QFont&gt;
#include &lt;QFrame&gt;
#include &lt;QGroupBox&gt;
#include &lt;QMap&gt;
#include &lt;QMdiArea&gt;
#include &lt;QMdiSubWindow&gt;
#include &lt;QMenuBar&gt;
#include &lt;QMessageBox&gt;
#include &lt;QPair&gt;
#include &lt;QSplitter&gt;
#include &lt;QStatusBar&gt;
#include &lt;QtGlobal&gt;
#include &lt;QHBoxLayout&gt;
#include &lt;QVBoxLayout&gt;
#include &lt;QWidget&gt;
#include &lt;QDomDocument&gt;
#include &lt;QDomAttr&gt;
#include &lt;Standard_WarningsRestore.hxx&gt;

#include &lt;OpenGl_GraphicDriver.hxx&gt;
#include &lt;OSD_Environment.hxx&gt;

#include &lt;stdlib.h&gt;
#include &lt;memory&gt;

ApplicationCommonWindow::ApplicationCommonWindow (ApplicationType theCategory)
: QMainWindow (nullptr),
  myAppType(theCategory),
  myStdToolBar (nullptr),
  myViewBar (nullptr),
  myCasCadeBar (nullptr),
  myFilePopup (nullptr),
  myCategoryPopup (nullptr)
{
  ALL_CATEGORIES[AppType_Geometry] = "Geometry";
  ALL_CATEGORIES[AppType_Topology] = "Topology";
  ALL_CATEGORIES[AppType_Triangulation] = "Triangulation";
  ALL_CATEGORIES[AppType_DataExchange] = "DataExchange";
  ALL_CATEGORIES[AppType_Ocaf] = "OCAF";
  ALL_CATEGORIES[AppType_Viewer3d] = "3D viewer";
  ALL_CATEGORIES[AppType_Viewer2d] = "2D Viewer";
  ALL_CATEGORIES[AppType_PengKai] = "PengKai";

  mySampleMapper   = new QSignalMapper(this);
  myExchangeMapper = new QSignalMapper(this);
  myOcafMapper     = new QSignalMapper(this);
  myViewer3dMapper = new QSignalMapper(this);
  myViewer2dMapper = new QSignalMapper(this);

  myCategoryMapper = new QSignalMapper(this);

  connect(mySampleMapper,   SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessSample(const QString &amp;)));
  connect(myExchangeMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessExchange(const QString &amp;)));
  connect(myOcafMapper,     SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessOcaf(const QString &amp;)));
  connect(myViewer3dMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessViewer3d(const QString &amp;)));
  connect(myViewer2dMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onProcessViewer2d(const QString &amp;)));

  connect(myCategoryMapper, SIGNAL(mapped(const QString &amp;)), this, SLOT(onChangeCategory(const QString &amp;)));

  setFocusPolicy(Qt::StrongFocus);

  QFont aCodeViewFont;
  aCodeViewFont.setFamily("Courier");
  aCodeViewFont.setFixedPitch(true);
  aCodeViewFont.setPointSize(10);

  QGroupBox* aCodeFrame = new QGroupBox(tr("Sample code"));
  QVBoxLayout* aCodeLayout = new QVBoxLayout(aCodeFrame);
  aCodeLayout-&gt;setContentsMargins(3, 3, 3, 3);
  myCodeView = new QTextEdit(aCodeFrame);
  aCodeLayout-&gt;addWidget(myCodeView);
  myCodeView-&gt;setDocumentTitle("Code");
  myCodeView-&gt;setLineWrapMode(QTextEdit::NoWrap);
  myCodeView-&gt;setReadOnly(true);
  myCodeView-&gt;setFont(aCodeViewFont);
  myCodeViewHighlighter = new OcctHighlighter(myCodeView-&gt;document());

  QGroupBox* aResultFrame = new QGroupBox(tr("Output"));
  QVBoxLayout* aResultLayout = new QVBoxLayout(aResultFrame);
  aResultLayout-&gt;setContentsMargins(3, 3, 3, 3);
  myResultView = new QTextEdit(aResultFrame);
  aResultLayout-&gt;addWidget(myResultView);
  myResultView-&gt;setDocumentTitle("Output");
  myResultView-&gt;setReadOnly(true);
  myResultView-&gt;setFont(aCodeViewFont);

  QSplitter* aCodeResultSplitter = new QSplitter(Qt::Vertical);
  aCodeResultSplitter-&gt;addWidget(aCodeFrame);
  aCodeResultSplitter-&gt;addWidget(aResultFrame);

  myDocument3d = createNewDocument();
  myDocument2d = createNewDocument();

  QFrame* aViewFrame = new QFrame;
  aViewFrame-&gt;setFrameStyle(QFrame::Panel | QFrame::Sunken);
  aViewFrame-&gt;setLineWidth(3);
  QVBoxLayout* aViewLayout = new QVBoxLayout(aViewFrame);
  aViewLayout-&gt;setContentsMargins(0, 0, 0, 0);
  myGeomWidget = new GeomWidget(myDocument3d, myDocument2d, aViewFrame);
  aViewLayout-&gt;addWidget(myGeomWidget);

  myGeomWidget-&gt;setContentsMargins(0, 0, 0, 0);
  QSplitter* aGeomTextSplitter = new QSplitter(Qt::Horizontal);

  aGeomTextSplitter-&gt;addWidget(aViewFrame);
  aGeomTextSplitter-&gt;addWidget(aCodeResultSplitter);
  aGeomTextSplitter-&gt;setStretchFactor(0, 1);
  aGeomTextSplitter-&gt;setStretchFactor(1, 1);
  QList&lt;int&gt; aSizeList;
  aSizeList.append(640);
  aSizeList.append(640);
  aGeomTextSplitter-&gt;setSizes(aSizeList);
  setCentralWidget(aGeomTextSplitter);

#include &lt;Standard_WarningsDisable.hxx&gt;
  Q_INIT_RESOURCE(Samples);
#include &lt;Standard_WarningsRestore.hxx&gt;

  TCollection_AsciiString aSampleSourcePach = getSampleSourceDir();
  myGeometrySamples      = new GeometrySamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());
  myTopologySamples      = new TopologySamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());
  myTriangulationSamples = new TriangulationSamples(aSampleSourcePach,
                                                    myDocument3d-&gt;getContext());
  myDataExchangeSamples  = new DataExchangeSamples(aSampleSourcePach,
                                                   myGeomWidget-&gt;Get3dView(),
                                                   myDocument3d-&gt;getContext());
  myOcafSamples          = new OcafSamples(aSampleSourcePach,
                                           myDocument3d-&gt;getViewer(),
                                           myDocument3d-&gt;getContext());
  myViewer3dSamples      = new Viewer3dSamples(aSampleSourcePach,
                                               myGeomWidget-&gt;Get3dView(),
                                               myDocument3d-&gt;getContext());
  myViewer2dSamples      = new Viewer2dSamples(aSampleSourcePach,
                                               myGeomWidget-&gt;Get2dView(),
                                               myDocument2d-&gt;getViewer(),
                                               myDocument2d-&gt;getContext());

  myPengKaiSamples      = new PengKaiSamples(aSampleSourcePach,
                                               myDocument3d-&gt;getContext());

  MenuFormXml(":/menus/Geometry.xml",      mySampleMapper,   myGeometryMenus);
  MenuFormXml(":/menus/Topology.xml",      mySampleMapper,   myTopologyMenus);
  MenuFormXml(":/menus/Triangulation.xml", mySampleMapper,   myTriangulationMenus);
  MenuFormXml(":/menus/DataExchange.xml",  myExchangeMapper, myDataExchangeMenus);
  MenuFormXml(":/menus/Ocaf.xml",          myOcafMapper,     myOcafMenus);
  MenuFormXml(":/menus/Viewer3d.xml",      myViewer3dMapper, myViewer3dMenus);
  MenuFormXml(":/menus/Viewer2d.xml",      myViewer2dMapper, myViewer2dMenus);
  MenuFormXml(":/menus/PengKai.xml",      mySampleMapper, myPengKaiMenus);

  onChangeCategory(ALL_CATEGORIES[myAppType]);

  resize(1280, 560);
}

void ApplicationCommonWindow::RebuildMenu()
{
  menuBar()-&gt;clear();

  myStdActions[StdActions_FileQuit] = CreateAction("Quit", "CTRL+Q");
  connect(myStdActions[StdActions_FileQuit], SIGNAL(triggered()), this, SLOT(onCloseAllWindows()));
  myStdActions[StdActions_HelpAbout] = CreateAction("About", "F1", ":/icons/help.png");
  connect(myStdActions[StdActions_HelpAbout], SIGNAL(triggered()), this, SLOT(onAbout()));

  // populate a menu with all actions
  myFilePopup = new QMenu(this);
  myFilePopup = menuBar()-&gt;addMenu(tr("&amp;File"));
  myFilePopup-&gt;addAction(myStdActions[StdActions_FileQuit]);

  myCategoryPopup = new QMenu(this);
  myCategoryPopup = menuBar()-&gt;addMenu(tr("&amp;Category"));

  foreach (ApplicationType aCategory, ALL_CATEGORIES.keys())
  {
    QString aCategoryName = ALL_CATEGORIES.value(aCategory);
    QAction* anAction = myCategoryPopup-&gt;addAction(aCategoryName);
    anAction-&gt;setText(aCategoryName);
    myCategoryMapper-&gt;setMapping(anAction, aCategoryName);
    connect(anAction, SIGNAL(triggered()), myCategoryMapper, SLOT(map()));
    myCategoryPopup-&gt;addAction(anAction);
    myCategoryActions.insert(aCategory, anAction);
  }

  foreach (QMenu* aSampleMenu, GetCurrentMenus())
  {
    menuBar()-&gt;addMenu(aSampleMenu);
  }

  // add a help menu
  QMenu* aHelp = new QMenu(this);
  menuBar()-&gt;addSeparator();
  aHelp = menuBar()-&gt;addMenu(tr("&amp;Help"));
  aHelp-&gt;addAction(myStdActions[StdActions_HelpAbout]);
}

Handle(BaseSample) ApplicationCommonWindow::GetCurrentSamples()
{
  switch (myAppType)
  {
    case AppType_Geometry:      return myGeometrySamples;
    case AppType_Topology:      return myTopologySamples;
    case AppType_Triangulation: return myTriangulationSamples;
    case AppType_DataExchange:  return myDataExchangeSamples;
    case AppType_Ocaf:          return myOcafSamples;
    case AppType_Viewer2d:      return myViewer2dSamples;
    case AppType_Viewer3d:      return myViewer3dSamples;
    case AppType_PengKai:      return myPengKaiSamples;
    case AppType_Unknown:
      break;
  }
  throw QString("Unknown Application type");
}

const QList&lt;QMenu*&gt;&amp; ApplicationCommonWindow::GetCurrentMenus()
{
  switch (myAppType)
  {
    case AppType_Geometry:      return myGeometryMenus;
    case AppType_Topology:      return myTopologyMenus;
    case AppType_Triangulation: return myTriangulationMenus;
    case AppType_DataExchange:  return myDataExchangeMenus;
    case AppType_Ocaf:          return myOcafMenus;
    case AppType_Viewer2d:      return myViewer2dMenus;
    case AppType_Viewer3d:      return myViewer3dMenus;
    case AppType_PengKai:      return myPengKaiMenus;
    case AppType_Unknown:
      break;
  }
  throw QString("Unknown Application type");
}

DocumentCommon* ApplicationCommonWindow::createNewDocument()
{
  return new DocumentCommon(this);
}

void ApplicationCommonWindow::onChangeCategory(const QString&amp; theCategory)
{
  myAppType = ALL_CATEGORIES.key(theCategory);
  setWindowTitle(ALL_CATEGORIES[myAppType]);

  myOcafSamples-&gt;ClearExtra();
  myViewer3dSamples-&gt;ClearExtra();
  myViewer2dSamples-&gt;ClearExtra();

  GetCurrentSamples()-&gt;Clear();
  myDocument3d-&gt;Clear();
  myDocument2d-&gt;Clear();

  myCodeView-&gt;setPlainText("");
  myResultView-&gt;setPlainText("");
  GetCurrentSamples()-&gt;AppendCube();
  myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
  myGeomWidget-&gt;FitAll();

  RebuildMenu();

  switch (myAppType)
  {
    case AppType_DataExchange:
    {
      myDataExchangeSamples-&gt;AppendBottle();
      myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Ocaf:
    {
      onProcessOcaf("CreateOcafDocument");
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Viewer2d:
    {
      myGeomWidget-&gt;Show2d();
      break;
    }
    case AppType_Viewer3d:
    {
      myViewer3dSamples-&gt;AppendBottle();
      myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
      myGeomWidget-&gt;Show3d();
      break;
    }
    case AppType_Geometry:
    case AppType_Topology:
    case AppType_PengKai:
    case AppType_Triangulation:
    case AppType_Unknown:
    {
      break;
    }
  }
}

void ApplicationCommonWindow::onAbout()
{
  QMessageBox::information(this, tr("OCCT Overview"),
    tr("Qt based application to study OpenCASCADE Technology"),
    tr("Ok"), QString::null, QString::null, 0, 0);
}

TCollection_AsciiString ApplicationCommonWindow::getSampleSourceDir()
{
  TCollection_AsciiString aSampleSourceDir = OSD_Environment("CSF_OCCTOverviewSampleCodePath").Value();
  if (aSampleSourceDir.IsEmpty())
  {
    TCollection_AsciiString aCasRoot = OSD_Environment("CASROOT").Value();
    if (!aCasRoot.IsEmpty())
    {
      aSampleSourceDir = aCasRoot + "/samples/OCCTOverview/code";
    }
  }
  return aSampleSourceDir;
}

QAction* ApplicationCommonWindow::CreateAction (const QString&amp; theActionName,
                                                const QString&amp; theShortcut,
                                                const QString&amp; theIconName)
{
  QAction* aAction(NULL);
  if (theIconName.isEmpty())
  {
    aAction = new QAction(theActionName, this);
  }
  else
  {
    QPixmap aIcon = QPixmap(theIconName);
    aAction = new QAction(aIcon, theActionName, this);
  }
  aAction-&gt;setToolTip(theActionName);
  aAction-&gt;setStatusTip(theActionName);
  aAction-&gt;setShortcut(theShortcut);

  return aAction;
}

template &lt;typename PointerToMemberFunction&gt;
QAction* ApplicationCommonWindow::CreateSample (PointerToMemberFunction theHandlerMethod,
                                                const char* theActionName)
{
  QAction* anAction = new QAction(QObject::tr(theActionName), this);
  connect(anAction, SIGNAL(triggered()), this, SLOT(theHandlerMethod()));
  return anAction;
}

void ApplicationCommonWindow::resizeEvent(QResizeEvent* e)
{
  QMainWindow::resizeEvent(e);
  statusBar()-&gt;setSizeGripEnabled(!isMaximized());
}

void ApplicationCommonWindow::onProcessSample(const QString&amp; theSampleName)
{
  QApplication::setOverrideCursor(Qt::WaitCursor);
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);
  GetCurrentSamples()-&gt;Process(theSampleName.toUtf8().data());
  myDocument3d-&gt;SetObjects(GetCurrentSamples()-&gt;Get3dObjects());
  myDocument2d-&gt;SetObjects(GetCurrentSamples()-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(GetCurrentSamples()-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(GetCurrentSamples()-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessExchange(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);
  int aMode = 0;
  QString aFileName = selectFileName(theSampleName, getDataExchangeDialog(theSampleName), aMode);
  if (aFileName.isEmpty())
  {
    return;
  }

  QApplication::setOverrideCursor(Qt::WaitCursor);
  myDataExchangeSamples-&gt;SetFileName(aFileName.toUtf8().data());
  myDataExchangeSamples-&gt;SetStepType(static_cast&lt;STEPControl_StepModelType&gt;(aMode));
  myDataExchangeSamples-&gt;Process(theSampleName.toUtf8().data());
  myDocument3d-&gt;SetObjects(myDataExchangeSamples-&gt;Get3dObjects());
  myDocument2d-&gt;SetObjects(myDataExchangeSamples-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(myDataExchangeSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myDataExchangeSamples-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessOcaf(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  if (theSampleName.indexOf("Dialog") == 0)
  {
    int aMode = 0; // not used
    QString aFileName = selectFileName(theSampleName, getOcafDialog(theSampleName), aMode);
    if (aFileName.isEmpty())
    {
      return;
    }
    myOcafSamples-&gt;SetFileName(aFileName.toUtf8().data());
  }
  QApplication::setOverrideCursor(Qt::WaitCursor);
  myOcafSamples-&gt;Process(theSampleName.toUtf8().data());
  myDocument2d-&gt;SetObjects(myOcafSamples-&gt;Get2dObjects());
  myCodeView-&gt;setPlainText(myOcafSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myOcafSamples-&gt;GetResult().ToCString());
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessViewer3d(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  QApplication::setOverrideCursor(Qt::WaitCursor);
  myViewer3dSamples-&gt;Process(theSampleName.toUtf8().data());
  myCodeView-&gt;setPlainText(myViewer3dSamples-&gt;GetCode().ToCString());
  myResultView-&gt;setPlainText(myViewer3dSamples-&gt;GetResult().ToCString());
  myGeomWidget-&gt;FitAll();
  QApplication::restoreOverrideCursor();
}

void ApplicationCommonWindow::onProcessViewer2d(const QString&amp; theSampleName)
{
  setWindowTitle(ALL_CATEGORIES[myAppType] + " - " + theSampleName);

  Standard_Boolean anIsFileSample = Viewer2dSamples::IsFileSample(theSampleName.toUtf8().data());
  QString aFileName;
  if (anIsFileSample)
  {
    int aMode = 0; // not used
    aFileName = selectFileName(theSampleName, getOcafDialog(theSampleName), aMode);
    if (aFileName.isEmpty())
    {
      return;
    }

    myViewer2dSamples-&gt;SetFileName(aFileName.toUtf8().data());
  }
  if (!anIsFileSample || (anIsFileSample &amp;&amp; !aFileName.isEmpty()))
  {
    QApplication::setOverrideCursor(Qt::WaitCursor);
    myViewer2dSamples-&gt;Process(theSampleName.toUtf8().data());
    if (!Viewer2dSamples::IsShadedSample(theSampleName.toUtf8().data()))
    {
      myDocument2d-&gt;SetObjects(myViewer2dSamples-&gt;Get2dObjects(), Standard_False);
    }
    else
    {
      myDocument2d-&gt;SetObjects(myViewer2dSamples-&gt;Get2dObjects(), Standard_True);
    }
    myCodeView-&gt;setPlainText(myViewer2dSamples-&gt;GetCode().ToCString());
    myResultView-&gt;setPlainText(myViewer2dSamples-&gt;GetResult().ToCString());
    myGeomWidget-&gt;Show2d();
    QApplication::restoreOverrideCursor();
  }
  else
  {
    myResultView-&gt;setPlainText("No file selected!");
  }
}

QString ApplicationCommonWindow::selectFileName(const QString&amp; theSampleName,
                                                TranslateDialog* theDialog, int&amp; theMode)
{
  Q_UNUSED(theSampleName)

  std::shared_ptr&lt;TranslateDialog&gt; aDialog(theDialog);

  int ret = aDialog-&gt;exec();
  theMode = aDialog-&gt;getMode();

  qApp-&gt;processEvents();

  QString aFilename;
  QStringList aFileNameList;
  if (ret != QDialog::Accepted)
  {
    return aFilename;
  }
  aFileNameList = aDialog-&gt;selectedFiles();
  if (!aFileNameList.isEmpty())
  {
    aFilename = aFileNameList[0];
  }

  if (!QFileInfo(aFilename).completeSuffix().length())
  {
    QString selFilter = aDialog-&gt;selectedNameFilter();
    int idx = selFilter.indexOf("(*.");
    if (idx != -1)
    {
      QString tail = selFilter.mid(idx + 3);
      idx = tail.indexOf(" ");
      if (idx == -1)
      {
        idx = tail.indexOf(")");
      }
      QString ext = tail.left(idx);
      if (ext.length())
      {
        aFilename += QString(".") + ext;
      }
    }
  }

  return aFilename;
}

TranslateDialog* ApplicationCommonWindow::getDataExchangeDialog(const QString&amp; theSampleName)
{
  TranslateDialog* aTranslateDialog = new TranslateDialog(this, 0, true);
  TCollection_AsciiString aSampleName(theSampleName.toUtf8().data());

  if (DataExchangeSamples::IsExportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Export file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::AnyFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptSave);
  }
  else if (DataExchangeSamples::IsImportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Import file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::ExistingFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptOpen);
  }
  QString aFormatFilter;
  if (DataExchangeSamples::IsBrepSample(aSampleName))
  {
    aFormatFilter = "BREP Files(*.brep *.rle)";
  }
  else if (DataExchangeSamples::IsStepSample(aSampleName))
  {
    aFormatFilter = "STEP Files (*.stp *.step)";
    aTranslateDialog-&gt;addMode(STEPControl_ManifoldSolidBrep, "Manifold Solid Brep");
    aTranslateDialog-&gt;addMode(STEPControl_FacetedBrep, "Faceted Brep");
    aTranslateDialog-&gt;addMode(STEPControl_ShellBasedSurfaceModel, "Shell Based Surface Model");
    aTranslateDialog-&gt;addMode(STEPControl_GeometricCurveSet, "Geometric Curve Set");
  }
  else if (DataExchangeSamples::IsIgesSample(aSampleName))
  {
    aFormatFilter = "IGES Files (*.igs *.iges)";
  }
  else if (DataExchangeSamples::IsStlSample(aSampleName))
  {
    aFormatFilter = "STL Files (*.stl)";
  }
  else if (DataExchangeSamples::IsVrmlSample(aSampleName))
  {
    aFormatFilter = "VRML Files (*.vrml)";
  }
  else if (DataExchangeSamples::IsImageSample(aSampleName))
  {
    aFormatFilter = "All Image Files (*.bmp *.gif *.jpg *.jpeg *.png *.tga)";
  }
  QStringList aFilters;
  aFilters.append(aFormatFilter);
  aFilters.append("All Files(*.*)");

  aTranslateDialog-&gt;setNameFilters(aFilters);
  aTranslateDialog-&gt;clear();
  return aTranslateDialog;
}

TranslateDialog* ApplicationCommonWindow::getOcafDialog(const QString&amp; theSampleName)
{
  TranslateDialog* aTranslateDialog = new TranslateDialog(this, 0, true);
  TCollection_AsciiString aSampleName(theSampleName.toUtf8().data());

  if (OcafSamples::IsExportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Export file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::AnyFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptSave);
  }
  else if (OcafSamples::IsImportSample(aSampleName))
  {
    aTranslateDialog-&gt;setWindowTitle("Import file");
    aTranslateDialog-&gt;setFileMode(QFileDialog::ExistingFile);
    aTranslateDialog-&gt;setAcceptMode(QFileDialog::AcceptOpen);
  }
  QStringList aFilters;
  if (OcafSamples::IsBinarySample(aSampleName))
  {
    aFilters.append("Binary OCAF Sample (*.cbf)");
  }
  if (OcafSamples::IsXmlSample(aSampleName))
  {
    aFilters.append("XML OCAF Sample (*.xml)");
  }
  aFilters.append("All Files(*.*)");

  aTranslateDialog-&gt;setNameFilters(aFilters);
  aTranslateDialog-&gt;clear();
  return aTranslateDialog;
}

QMenu* ApplicationCommonWindow::MenuFromDomNode(QDomElement&amp; theItemElement,
                                                QWidget* theParent,
                                                QSignalMapper* theMapper)
{
  QString anItemName        = theItemElement.attribute("name");
  QMenu* aMenu = new QMenu(anItemName, theParent);
  QDomElement anChildItemElement = theItemElement.firstChildElement("MenuItem");
  QDomElement anSampleElement    = theItemElement.firstChildElement("Sample");

  while(anChildItemElement.isElement())
  {
    aMenu-&gt;addMenu(MenuFromDomNode(anChildItemElement, aMenu, theMapper));
    anChildItemElement = anChildItemElement.nextSibling().toElement();
  }

  while(anSampleElement.isElement())
  {
    QString aSampleName     = anSampleElement.attribute("name");
    QString aSampleFunction = anSampleElement.attribute("function");
    QAction* anAction = aMenu-&gt;addAction(aSampleFunction);
    anAction-&gt;setText(aSampleName);
    theMapper-&gt;setMapping(anAction, aSampleFunction);
    connect(anAction, SIGNAL(triggered()), theMapper, SLOT(map()));
    anSampleElement = anSampleElement.nextSibling().toElement();
  }
  return aMenu;
}

void ApplicationCommonWindow::MenuFormXml(const QString&amp; thePath,
                                          QSignalMapper* theMapper,
                                          QList&lt;QMenu*&gt;&amp; theMunusList)
{
  QDomDocument aDomDocument;
  theMunusList.clear();
  QFile aXmlFile(thePath);
  QString anErrorMessage;
  if (aXmlFile.error() != QFile::NoError)
  {
    anErrorMessage = aXmlFile.errorString();
    Message::SendFail() &lt;&lt; "QFile creating error: " &lt;&lt; anErrorMessage.toUtf8().constData();
    aXmlFile.close();
    return;
  }
  if (!aXmlFile.open(QIODevice::ReadOnly | QIODevice::Text))
  {
    Message::SendFail() &lt;&lt; "File " &lt;&lt; thePath.toUtf8().constData() &lt;&lt; " could not open";
    if (aXmlFile.error() != QFile::NoError)
    {
      anErrorMessage = aXmlFile.errorString();
      Message::SendFail() &lt;&lt; "QFile opening error: " &lt;&lt; anErrorMessage.toUtf8().constData();
    }
    aXmlFile.close();
    return;
  }
  bool aNamespaceProcessing(false);
  QString anErrorMsg;
  int anErrorLine(0);
  int anErrorColumn(0);
  if (!aDomDocument.setContent(&amp;aXmlFile, aNamespaceProcessing, &amp;anErrorMsg, &amp;anErrorLine, &amp;anErrorColumn))
  {
    Message::SendFail() &lt;&lt; "XML file parsing error: " &lt;&lt;  anErrorMsg.toStdString()
                        &lt;&lt; " at line: " &lt;&lt; anErrorLine &lt;&lt; " column: " &lt;&lt; anErrorColumn;
    aXmlFile.close();
    return;
  }
  aXmlFile.close();

  QDomElement aRootElement = aDomDocument.documentElement();
  QDomElement anItemElement = aRootElement.firstChildElement("MenuItem");
  while(!anItemElement.isNull())
  {
    theMunusList.push_back(MenuFromDomNode(anItemElement, this, theMapper));
    anItemElement = anItemElement.nextSiblingElement("MenuItem");
  }
}
</code></pre> 
<p><strong>第五处修改：重新使用前面cmake编译的方法进行编译，重新生成build，运行以后就可以看到自己添加的按钮了，点击按钮即可触发测试函数，后续就可以自己在测试函数中编写测试案例</strong></p> 
<h2 id="6%E3%80%81%E6%80%BB%E7%BB%93" style="background-color:transparent;">5、总结</h2> 
<p>注意好以下几个关键点：</p> 
<p>1、环境和软件以及源码提前准备好</p> 
<p>2、Cmake编译的时候记得修改成自己文件路径所在位置</p> 
<p>3、一般而言配置完以后运行成功就行，自定义测试需要修改的地方较多，不易操作</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2a8e291b9e6f980ebe4846992c63b21/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL内存使用率高且不释放问题排查与总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a993ff6249e161b6f0bd23903db766cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">seatunnel-web本地安装教程（超详细）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>