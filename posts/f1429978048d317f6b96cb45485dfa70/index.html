<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>达梦(DM) SQL日期操作及分析函数 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f1429978048d317f6b96cb45485dfa70/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="达梦(DM) SQL日期操作及分析函数">
  <meta property="og:description" content="达梦DM SQL日期操作及分析函数 日期操作SYSDATEEXTRACT判断一年是否为闰年周的计算确定某月内第一个和最后一个周末某天的日期确定指定年份季度的开始日期和结束日期补充范围内丢失的值按照给定的时间单位查找使用日期的特殊部分比较记录 范围处理分析函数定位连续值的范围查找同一分区中行之间的差定位连续范围的起始点 本文主要讲述DM 数据库中如何实现各种日期相关的运算以及如何利用分析函数 lead() over() 进行范围问题的处理。
日期操作 SYSDATE 使用 trunc() 函数获得某个日期对应的月初时间
SELECT ename,hiredate AS 入职日期,TRUNC (hiredate, &#39;mm&#39;) AS 月初 FROM employee WHERE ROWNUM &lt;= 1; 获取具体时间的时分秒、年月日、月初、周初、年初等
SELECT hiredate, TO_NUMBER (TO_CHAR (hiredate, &#39;hh24&#39;)) 时, TO_NUMBER (TO_CHAR (hiredate, &#39;mi&#39;)) 分, TO_NUMBER (TO_CHAR (hiredate, &#39;ss&#39;)) 秒, TO_NUMBER (TO_CHAR (hiredate, &#39;dd&#39;)) 日, TO_NUMBER (TO_CHAR (hiredate, &#39;mm&#39;)) 月, TO_NUMBER (TO_CHAR (hiredate, &#39;yyyy&#39;)) 年, TO_NUMBER (TO_CHAR (hiredate, &#39;ddd&#39;)) 年内第几天, TRUNC (hiredate, &#39;dd&#39;) 一天之始, TRUNC (hiredate, &#39;day&#39;) 周初, TRUNC (hiredate, &#39;mm&#39;) 月初, LAST_DAY (hiredate) 月末, ADD_MONTHS (TRUNC (hiredate, &#39;mm&#39;), 1) 下月初, TRUNC (hiredate, &#39;yy&#39;) 年初, TO_CHAR (hiredate, &#39;day&#39;) 周几, TO_CHAR (hiredate, &#39;month&#39;) 月份 FROM (SELECT hiredate FROM employee WHERE ROWNUM &lt;= 1); EXTRACT EXTRACT 函数可以提取时间字段中的年、月、日、时、分、秒，返回的值为 NUMBER 类型">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-26T14:14:34+08:00">
    <meta property="article:modified_time" content="2024-04-26T14:14:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">达梦(DM) SQL日期操作及分析函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>达梦DM SQL日期操作及分析函数</h4> 
 <ul><li><a href="#_3" rel="nofollow">日期操作</a></li><li><ul><li><a href="#SYSDATE_4" rel="nofollow">SYSDATE</a></li><li><a href="#EXTRACT_49" rel="nofollow">EXTRACT</a></li><li><a href="#_82" rel="nofollow">判断一年是否为闰年</a></li><li><a href="#_102" rel="nofollow">周的计算</a></li><li><a href="#_125" rel="nofollow">确定某月内第一个和最后一个周末某天的日期</a></li><li><a href="#_137" rel="nofollow">确定指定年份季度的开始日期和结束日期</a></li><li><a href="#_145" rel="nofollow">补充范围内丢失的值</a></li><li><a href="#_190" rel="nofollow">按照给定的时间单位查找</a></li><li><a href="#_206" rel="nofollow">使用日期的特殊部分比较记录</a></li></ul> 
  </li><li><a href="#_222" rel="nofollow">范围处理</a></li><li><ul><li><a href="#_223" rel="nofollow">分析函数</a></li><li><a href="#_234" rel="nofollow">定位连续值的范围</a></li><li><a href="#_272" rel="nofollow">查找同一分区中行之间的差</a></li><li><a href="#_311" rel="nofollow">定位连续范围的起始点</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>本文主要讲述DM 数据库中如何实现各种日期相关的运算以及如何利用分析函数 lead() over() 进行范围问题的处理。</p> 
<h2><a id="_3"></a>日期操作</h2> 
<h3><a id="SYSDATE_4"></a>SYSDATE</h3> 
<p>使用 trunc() 函数获得某个日期对应的月初时间</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> ename<span class="token punctuation">,</span>hiredate <span class="token keyword">AS</span> 入职日期<span class="token punctuation">,</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 月初 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3e/84/YGgzeodQ_o.png" alt="在这里插入图片描述"><br> 获取具体时间的时分秒、年月日、月初、周初、年初等</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> hiredate<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'hh24'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 时<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mi'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 分<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'ss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 秒<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 日<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 月<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 年<span class="token punctuation">,</span>

       TO_NUMBER <span class="token punctuation">(</span>TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'ddd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 年内第几天<span class="token punctuation">,</span>

       TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'dd'</span><span class="token punctuation">)</span> 一天之始<span class="token punctuation">,</span>

       TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span> 周初<span class="token punctuation">,</span>

       TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span> 月初<span class="token punctuation">,</span>

       LAST_DAY <span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span> 月末<span class="token punctuation">,</span>

       ADD_MONTHS <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> 下月初<span class="token punctuation">,</span>

       TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'yy'</span><span class="token punctuation">)</span> 年初<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span> 周几<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'month'</span><span class="token punctuation">)</span> 月份

<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> hiredate <span class="token keyword">FROM</span> employee

      <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/4a/53/TXX8zV8C_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="EXTRACT_49"></a>EXTRACT</h3> 
<p>EXTRACT 函数可以提取时间字段中的年、月、日、时、分、秒，返回的值为 NUMBER 类型</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 年<span class="token punctuation">,</span>

       EXTRACT <span class="token punctuation">(</span><span class="token keyword">MONTH</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 月<span class="token punctuation">,</span>

       EXTRACT <span class="token punctuation">(</span><span class="token keyword">DAY</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 日<span class="token punctuation">,</span>

       EXTRACT <span class="token punctuation">(</span><span class="token keyword">HOUR</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 时<span class="token punctuation">,</span>

       EXTRACT <span class="token punctuation">(</span><span class="token keyword">MINUTE</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 分<span class="token punctuation">,</span>

       EXTRACT <span class="token punctuation">(</span><span class="token keyword">SECOND</span> <span class="token keyword">FROM</span> SYSTIMESTAMP<span class="token punctuation">)</span> <span class="token keyword">AS</span> 秒

<span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/c4/4Z9KBlIY_o.png" alt="在这里插入图片描述"><br> to_char 函数可以用来取日期时间类型字段中的时、分、秒</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> hiredate<span class="token punctuation">,</span> TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'dd'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 天<span class="token punctuation">,</span> TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'hh24'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 时 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/2c/QGqitfIT_o.png" alt="在这里插入图片描述"><br> EXTRACT 函数可以用来取 INTERVAL 中的信息，to_char 函数不支持</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EXTRACT <span class="token punctuation">(</span><span class="token keyword">HOUR</span> <span class="token keyword">FROM</span> it<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">"hour"</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">INTERVAL</span> <span class="token string">'2 12:30:59'</span> <span class="token keyword">DAY</span> <span class="token keyword">TO</span> <span class="token keyword">SECOND</span> <span class="token keyword">AS</span> it <span class="token keyword">FROM</span> DUAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/77/b0/rZpwRUie_o.png" alt="在这里插入图片描述"><br> 换成to_char函数</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> to_char<span class="token punctuation">(</span>it<span class="token punctuation">,</span><span class="token string">'hh24'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">"hour"</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">INTERVAL</span> <span class="token string">'2 12:30:59'</span> <span class="token keyword">DAY</span> <span class="token keyword">TO</span> <span class="token keyword">SECOND</span> <span class="token keyword">AS</span> it <span class="token keyword">FROM</span> DUAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/01/66/7QdZOsM7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_82"></a>判断一年是否为闰年</h3> 
<p>判断一年是否为闰年，可以看二月的月末具体是哪一天。使用 TO_CHAR、 LAST_DAY、 ADD_MONTHS、 TRUNC 函数共同实现</p> 
<pre><code class="prism language-sql"><span class="token comment">--计算年初  2023-01-01</span>

<span class="token keyword">SELECT</span> TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span> 年初 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">--计算二月初 2023-02-01</span>

<span class="token keyword">SELECT</span> ADD_MONTHS <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> 二月初 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">--计算二月底  2023-02-28</span>

<span class="token keyword">SELECT</span> LAST_DAY <span class="token punctuation">(</span>ADD_MONTHS <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 二月底 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">--计算二月底对应的日期</span>

<span class="token keyword">SELECT</span> TO_CHAR <span class="token punctuation">(</span>LAST_DAY <span class="token punctuation">(</span>ADD_MONTHS <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'DD'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 日 <span class="token keyword">FROM</span> employee <span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/78/39/d4yMEQpr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_102"></a>周的计算</h3> 
<p>使用 TO_CHAR、 NEXT_DAY、TRUNC 函数共同实现周的计算</p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> x

     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> TRUNC <span class="token punctuation">(</span>SYSDATE<span class="token punctuation">,</span> <span class="token string">'yy'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">LEVEL</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 日期 <span class="token keyword">FROM</span> DUAL <span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> <span class="token keyword">LEVEL</span> <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> 日期<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>日期<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> d<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>日期<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">day</span><span class="token punctuation">,</span>

       NEXT_DAY <span class="token punctuation">(</span>日期<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 下个周日<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>日期<span class="token punctuation">,</span> <span class="token string">'ww'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> ww<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>日期<span class="token punctuation">,</span> <span class="token string">'iw'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> iw

<span class="token keyword">FROM</span> x<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/f7/94bvWuOA_o.png" alt="在这里插入图片描述"><br> 参数 “day” 与字符集无关，所以建议使用 “d”, WW 与 IW 都是取 “第几周”，只是两个参数的初始值不一样。</p> 
<h3><a id="_125"></a>确定某月内第一个和最后一个周末某天的日期</h3> 
<p>返回当月内第一个星期一与最后一个星期一，我们分别找上月末及当月末之前七天的下一周的周一即可</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> NEXT_DAY <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> 第一个周一<span class="token punctuation">,</span>

       NEXT_DAY <span class="token punctuation">(</span>LAST_DAY <span class="token punctuation">(</span>TRUNC <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> 最后一个周一

<span class="token keyword">FROM</span> employee

<span class="token keyword">WHERE</span> ROWNUM <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6c/7a/mLsf0bTg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_137"></a>确定指定年份季度的开始日期和结束日期</h3> 
<p>在写报表查询语句时需要按季度分类汇总，提取对应的季度开始日期和结束日期。可以通过 add_months、to_date 函数实现</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> sn <span class="token keyword">AS</span> 季度<span class="token punctuation">,</span> <span class="token punctuation">(</span>sn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">AS</span> 开始月份<span class="token punctuation">,</span> ADD_MONTHS <span class="token punctuation">(</span>TO_DATE <span class="token punctuation">(</span>年<span class="token punctuation">,</span> <span class="token string">'yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>sn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 开始日期<span class="token punctuation">,</span> ADD_MONTHS <span class="token punctuation">(</span>TO_DATE <span class="token punctuation">(</span>年<span class="token punctuation">,</span> <span class="token string">'yyyy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sn <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">AS</span> 结束日期

<span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token string">'2023'</span> <span class="token keyword">AS</span> 年<span class="token punctuation">,</span> <span class="token keyword">LEVEL</span> <span class="token keyword">AS</span> sn <span class="token keyword">FROM</span> DUAL <span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> <span class="token keyword">LEVEL</span> <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/b1/tTDIdr5T_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_145"></a>补充范围内丢失的值</h3> 
<p>统计每一年份入职员工数，若表中没有的年份，则展示的统计人数为 0</p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> x

     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> 开始年份 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">LEVEL</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 年份

               <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> <span class="token function">MIN</span> <span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 开始年份<span class="token punctuation">,</span>

                            EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> <span class="token function">MAX</span> <span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 结束年份

                       <span class="token keyword">FROM</span> employee<span class="token punctuation">)</span>

         <span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> <span class="token keyword">LEVEL</span> <span class="token operator">&lt;=</span> 结束年份 <span class="token operator">-</span> 开始年份 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> x<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/91/749xF5Or_o.png" alt="在这里插入图片描述"><br> 关联查询得到结果集</p> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> x

     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> 开始年份 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">LEVEL</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 年份

               <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> <span class="token function">MIN</span> <span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 开始年份<span class="token punctuation">,</span>

                            EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> <span class="token function">MAX</span> <span class="token punctuation">(</span>hiredate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 结束年份

                       <span class="token keyword">FROM</span> employee<span class="token punctuation">)</span>

         <span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> <span class="token keyword">LEVEL</span> <span class="token operator">&lt;=</span> 结束年份 <span class="token operator">-</span> 开始年份 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

  <span class="token keyword">SELECT</span> x<span class="token punctuation">.</span>年份<span class="token punctuation">,</span> <span class="token function">COUNT</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>empno<span class="token punctuation">)</span> 入职人数

    <span class="token keyword">FROM</span> x

         <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> employee e

            <span class="token keyword">ON</span> <span class="token punctuation">(</span>EXTRACT <span class="token punctuation">(</span><span class="token keyword">YEAR</span> <span class="token keyword">FROM</span> e<span class="token punctuation">.</span>hiredate<span class="token punctuation">)</span> <span class="token operator">=</span> x<span class="token punctuation">.</span>年份<span class="token punctuation">)</span>

<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> x<span class="token punctuation">.</span>年份

<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/9d/5mzvARPD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_190"></a>按照给定的时间单位查找</h3> 
<p>使用 to_char 函数查询给定时间单位的时间,比如查询如入职日期在 1 月或者 11 月且非星期三的员工信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> ename 姓名<span class="token punctuation">,</span>

       hiredate 入职日期<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'day'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 星期

  <span class="token keyword">FROM</span> employee

 <span class="token keyword">WHERE</span> TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'mm'</span><span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'01'</span><span class="token punctuation">,</span> <span class="token string">'11'</span><span class="token punctuation">)</span>

       <span class="token operator">AND</span> TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'4'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/29/MBBBnEQF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_206"></a>使用日期的特殊部分比较记录</h3> 
<p>使用 to_char 函数统计相同月份与周内日期入职的员工</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> ename 姓名<span class="token punctuation">,</span>

       hiredate 入职日期<span class="token punctuation">,</span>

       TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'MON day'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 月周

  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ename<span class="token punctuation">,</span> hiredate<span class="token punctuation">,</span> <span class="token function">COUNT</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> TO_CHAR <span class="token punctuation">(</span>hiredate<span class="token punctuation">,</span> <span class="token string">'MON day'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> ct

          <span class="token keyword">FROM</span> employee<span class="token punctuation">)</span>

 <span class="token keyword">WHERE</span> hiredate <span class="token operator">LIKE</span> <span class="token string">'2023%'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/65/85/wwhnkiLI_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_222"></a>范围处理</h2> 
<h3><a id="_223"></a>分析函数</h3> 
<p>lead(列名,n,m) over(partition by … order by …)，不带参数 n，m，则查找当前记录后面第一行的记录列名的值，参数说明</p> 
<pre><code class="prism language-plain">lead() 只能用于取后面第 n 行记录说明，不能取前面的。如果要取前面第 n 行记录说明，使用 lag（）函数。

over() 在什么条件之上，使用语法 over(partition by...order by...)。

partition by 按某个字段划分组。

order by 按某个字段排序。
</code></pre> 
<h3><a id="_234"></a>定位连续值的范围</h3> 
<p>可以使用分析函数 lead() over() 定位某一段连续值的范围</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v<span class="token punctuation">(</span>pro_id<span class="token punctuation">,</span>pro_start<span class="token punctuation">,</span>pro_end<span class="token punctuation">)</span> <span class="token keyword">as</span>

<span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-01'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-02'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-02'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-03'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-03'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-06'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-06'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-07'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-09'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-11'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-13'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-15'</span> <span class="token keyword">FROM</span> dual<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v<span class="token punctuation">;</span>
</code></pre> 
<p>查看创建的视图v<br> <img src="https://images2.imgbox.com/3c/50/cvnFxnkP_o.png" alt="在这里插入图片描述"><br> 现在需要查询连续值记录，即下一行记录的开始时间与上一行记录的结束时间一致</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 工程号<span class="token punctuation">,</span> 开始日期<span class="token punctuation">,</span> 结束日期

  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> pro_id <span class="token keyword">AS</span> 工程号<span class="token punctuation">,</span>

               pro_start <span class="token keyword">AS</span> 开始日期<span class="token punctuation">,</span>

               pro_end <span class="token keyword">AS</span> 结束日期<span class="token punctuation">,</span>

               LEAD <span class="token punctuation">(</span>pro_start<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pro_id<span class="token punctuation">)</span> 下一工程开始日期

          <span class="token keyword">FROM</span> v<span class="token punctuation">)</span>

 <span class="token keyword">WHERE</span> 下一工程开始日期 <span class="token operator">=</span> 结束日期<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9d/2d/fud4lEdR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_272"></a>查找同一分区中行之间的差</h3> 
<p>可以使用分析函数 lead() over() 查找同一分区中行之间的差</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v<span class="token punctuation">(</span>log_name<span class="token punctuation">,</span>log_time<span class="token punctuation">)</span> <span class="token keyword">as</span>

<span class="token keyword">SELECT</span> <span class="token string">'HR'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 09:28:00'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token string">'HR'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 09:38:10'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token string">'HR'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 10:50:00'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token string">'HR'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 11:08:50'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 09:18:00'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token string">'SYSTEM'</span><span class="token punctuation">,</span><span class="token keyword">datetime</span> <span class="token string">'2020-10-01 12:09:40'</span> <span class="token keyword">FROM</span> dual<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v<span class="token punctuation">;</span>
</code></pre> 
<p>创建视图v<br> <img src="https://images2.imgbox.com/f9/86/78eJH9Tc_o.png" alt="在这里插入图片描述"><br> 现在需要各用户两次登录的时间间隔，首先使用分析函数 lead() over() 取出下一行信息</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> log_name <span class="token keyword">AS</span> 登录名<span class="token punctuation">,</span>

       log_time <span class="token keyword">AS</span> 登录时间<span class="token punctuation">,</span>

       LEAD <span class="token punctuation">(</span>log_time<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> log_name <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> log_time<span class="token punctuation">)</span> 下一登录时间

  <span class="token keyword">FROM</span> v<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/e4/wWgAfQoa_o.png" alt="在这里插入图片描述"><br> 计算用户两次登录的时间间隔</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> log_name <span class="token keyword">AS</span> 登录名<span class="token punctuation">,</span> log_time <span class="token keyword">AS</span> 登录时间<span class="token punctuation">,</span> <span class="token punctuation">(</span>next_log_time <span class="token operator">-</span> log_time<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token keyword">AS</span> 登录间隔

 <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> log_name<span class="token punctuation">,</span> log_time<span class="token punctuation">,</span> LEAD <span class="token punctuation">(</span>log_time<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> log_name <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> log_time<span class="token punctuation">)</span> next_log_time <span class="token keyword">FROM</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/74/10/QybnOgYx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_311"></a>定位连续范围的起始点</h3> 
<p>创建视图v</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> v<span class="token punctuation">(</span>pro_id<span class="token punctuation">,</span>pro_start<span class="token punctuation">,</span>pro_end<span class="token punctuation">)</span> <span class="token keyword">as</span>

<span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-01'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-02'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-02'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-03'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-03'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-06'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-06'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-07'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-09'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-11'</span> <span class="token keyword">FROM</span> dual <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>

<span class="token keyword">SELECT</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-13'</span><span class="token punctuation">,</span><span class="token keyword">date</span> <span class="token string">'2020-10-15'</span> <span class="token keyword">FROM</span> dual<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> v<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c9/07/kCYfpKAn_o.png" alt="在这里插入图片描述"><br> 要求把连续的项目合并，返回合并后的起始时间,首先提取上一个工程结束时间</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> x0

<span class="token keyword">AS</span>

   <span class="token keyword">SELECT</span> pro_id <span class="token keyword">AS</span> 编号<span class="token punctuation">,</span>

          pro_start <span class="token keyword">AS</span> 开始日期<span class="token punctuation">,</span>

          pro_end <span class="token keyword">AS</span> 结束日期<span class="token punctuation">,</span>

          LAG <span class="token punctuation">(</span>pro_end<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pro_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> 上一工程结束日期

     <span class="token keyword">FROM</span> v<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> x0<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/ed/one1yyY5_o.png" alt="在这里插入图片描述"><br> 标定项目的连续状态</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> x1

<span class="token keyword">AS</span>

   <span class="token keyword">SELECT</span> 编号<span class="token punctuation">,</span>

          开始日期<span class="token punctuation">,</span>

          结束日期<span class="token punctuation">,</span>

          上一工程结束日期<span class="token punctuation">,</span>

          <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> 开始日期 <span class="token operator">=</span> 上一工程结束日期 <span class="token keyword">THEN</span> <span class="token number">0</span> <span class="token keyword">ELSE</span> <span class="token number">1</span> <span class="token keyword">END</span> <span class="token keyword">AS</span> 连续状态 <span class="token keyword">FROM</span> x0<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> x1<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/9a/SqVBGLcc_o.png" alt="在这里插入图片描述"><br> 从结果图看出，每个连续分组的开始，都生成了一个“1”的标识,对位置状态进行累加，得到分组依据</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> x2

<span class="token keyword">AS</span>

   <span class="token keyword">SELECT</span> 编号<span class="token punctuation">,</span>

          开始日期<span class="token punctuation">,</span>

          结束日期<span class="token punctuation">,</span>

          上一工程结束日期<span class="token punctuation">,</span>

          连续状态<span class="token punctuation">,</span>

          <span class="token function">SUM</span><span class="token punctuation">(</span>连续状态<span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 编号<span class="token punctuation">)</span> <span class="token keyword">AS</span> 分组依据

     <span class="token keyword">FROM</span> x1<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> x2<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/79/05/9NT0BwLi_o.png" alt="在这里插入图片描述"><br> 通过提取数据、生成标识、累加标识这些操作后，得到了需要的 3 个连续分组</p> 
<pre><code class="prism language-sql">  <span class="token keyword">SELECT</span> 分组依据<span class="token punctuation">,</span>

         <span class="token function">MIN</span> <span class="token punctuation">(</span>开始日期<span class="token punctuation">)</span> <span class="token keyword">AS</span> 开始日期<span class="token punctuation">,</span>

         <span class="token function">MAX</span> <span class="token punctuation">(</span>结束日期<span class="token punctuation">)</span> <span class="token keyword">AS</span> 结束日期

    <span class="token keyword">FROM</span> x2

<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 分组依据

<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/31/20/BZnlDbZ5_o.png" alt="在这里插入图片描述"><br> 到这里基于DM 数据库中如何实现各种日期相关的运算以及如何利用分析函数 lead() over() 进行范围问题的处理也就算说完了，下面继续进行后续的操作。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d0882b78f390af47bced3fca005a0c2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于Hadoop的电商数据分析系统设计与实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39a65234c3c5cce70c2c83e6c5e5e635/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43; 之 string类的模拟实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>