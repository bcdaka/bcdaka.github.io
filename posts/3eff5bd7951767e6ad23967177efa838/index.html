<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>性能测试 —— Jmeter日志查看与分析 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3eff5bd7951767e6ad23967177efa838/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="性能测试 —— Jmeter日志查看与分析">
  <meta property="og:description" content="一、Jmeter日志概览 Jmeter日志文件保存在bin目录中，名称为jmeter.log。我们可以在面板中直接察看日志，点击右上角黄色标志物可以打开日志面板，再次点击收起
另外，Jmeter可以很方便地设置日志输出级别：
通过这种方式修改日志级别，只是临时修改，不会改变配置文件中的值。当Jmeter重启后，又会恢复为默认的日志级别。在Jmeter/bin 路径下打开 log4j2.xml文件，修改日志级别，这里修改是永久性修改通过修改Root level 值改变日志级别，该修改是永久性的。对Jmeter 的GUI页面运行脚本和命令模式运行脚本都会生效。
二、Jmeter自定义日志 前面所看到的都是系统日志，也就是JMeter本身所打印的日志。如果我们自己想输出一些日志，该怎么办呢？这个一般就要借助Beanshell了。
在实际项目中，将JMeter脚本部署到Linux服务器上进行压力测试，存在一些日志详情查看的不便之处：
1、吞吐量统计中包括了所有请求，包括一些辅助请求(beanshell请求)，导致真正的tps统计数据不准确；
2、业务是否成功，以及具体失败原因难以排查；
这就需要用到beanshell下的自定义日志。log.info,log.error,如用log.error()打印错误信息
import org.apache.log4j.Logger; // 获取接口的响应数据 String result = prev.getResponseDataAsString(); if(result.contains(&#34;error&#34;)){ Failure=true; log.error(&#34;接口失败: &#34; &#43; result); } 当然，自定义日志最重要应用场景还是在Linux服务器上压测时，方便查看日志信息（因linux上无图形化界面）
比如，获取orderid时脚本
import org.apache.log4j.Logger; // 获取接口的响应数据 String result = prev.getResponseDataAsString(); // 从JSON提取器中获取code和orderId String code = vars.get(&#34;code&#34;); String orderId = vars.get(&#34;orderId&#34;); if(code.equals(&#34;0&#34;)){ log.info(&#34;place order success, orderId=&#34; &#43; orderId); }else{ Failure=true; log.error(&#34;FailureMessage: &#34; &#43; result); } 将该脚本上传到Linux中，顺便写个启动脚本：startup.sh
#!/bin/bash jmeter_log=/home/xxx/jmeter.log if [ -f &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-27T14:24:17+08:00">
    <meta property="article:modified_time" content="2024-06-27T14:24:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">性能测试 —— Jmeter日志查看与分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><strong>一、Jmeter日志概览</strong></h4> 
<p>Jmeter日志文件保存在bin目录中，名称为jmeter.log。我们可以在面板中直接察看日志，点击右上角黄色标志物可以打开日志面板，再次点击收起</p> 
<p></p> 
<p><img alt="" height="287" src="https://images2.imgbox.com/bb/8f/mBG2y2qY_o.jpg" width="720"></p> 
<p>另外，Jmeter可以很方便地设置<a href="https://so.csdn.net/so/search?q=%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA&amp;spm=1001.2101.3001.7020" title="日志输出">日志输出</a>级别：</p> 
<p></p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/eb/7c/sA0n7SJa_o.jpg" width="720"></p> 
<p>通过这种方式修改日志级别，只是临时修改，不会改变配置文件中的值。当Jmeter重启后，又会恢复为默认的日志级别。在Jmeter/bin 路径下打开 log4j2.xml文件，修改日志级别，这里修改是永久性修改通过修改Root level 值改变日志级别，该修改是永久性的。对Jmeter 的GUI页面运行脚本和命令模式运行脚本都会生效。</p> 
<p></p> 
<p><img alt="" height="300" src="https://images2.imgbox.com/9b/9a/NoylCdqG_o.jpg" width="977"></p> 
<p></p> 
<h4><a name="t1"></a><strong>二、Jmeter自定义日志</strong></h4> 
<p>前面所看到的都是系统日志，也就是JMeter本身所打印的日志。如果我们自己想输出一些日志，该怎么办呢？这个一般就要借助Beanshell了。</p> 
<p></p> 
<p><img alt="" height="589" src="https://images2.imgbox.com/c6/03/nGwRiYUO_o.png" width="720"></p> 
<p>在实际项目中，将JMeter脚本部署到Linux服务器上进行压力测试，存在一些日志详情查看的不便之处：</p> 
<p>1、吞吐量统计中包括了所有请求，包括一些辅助请求(beanshell请求)，导致真正的tps统计数据不准确；</p> 
<p>2、业务是否成功，以及具体失败原因难以排查；</p> 
<p>这就需要用到beanshell下的自定义日志。log.info,log.error,如用log.error()打印错误信息</p> 
<pre><code class="language-python">
import org.apache.log4j.Logger;


// 获取接口的响应数据

String result = prev.getResponseDataAsString();


if(result.contains("error")){

Failure=true;

log.error("接口失败: " + result);

}</code></pre> 
<p>当然，自定义日志最重要应用场景还是在Linux服务器上压测时，方便查看日志信息（因linux上无图形化界面）</p> 
<p>比如，获取orderid时脚本</p> 
<pre><code class="language-python">
import org.apache.log4j.Logger;


// 获取接口的响应数据

String result = prev.getResponseDataAsString();

// 从JSON提取器中获取code和orderId

String code = vars.get("code");

String orderId = vars.get("orderId");


if(code.equals("0")){

log.info("place order success, orderId=" + orderId);

}else{

Failure=true;

log.error("FailureMessage: " + result);

}</code></pre> 
<p>将该脚本上传到Linux中，顺便写个启动脚本：startup.sh</p> 
<pre><code class="language-python">
#!/bin/bash

jmeter_log=/home/xxx/jmeter.log


if [ -f "$jmeter_log" ]; then

// 将原日志文件备份后删除

cp $jmeter_log /home/xxx/jmeter.log_back

rm -rf $jmeter_log

fi

// 启动JMeter脚本

jmeter -n -t /home/xxx/test.jmx -l /home/xxx/result/test.jtl -j ../result/log/jmeter_error.log</code></pre> 
<p>命令解释：<strong>使用该命令调用jmeter进行性能测试，-n：命令模式运行,-t : 后面跟的是需要执行的脚本名称，-l :后跟的是聚合报告保存路径，-j :跟的是日志保存路径,</strong>运行脚本后，cat jmeter_error.log即可查看日志详情</p> 
<h4><a name="t2"></a><strong>三、Jmeter日志分析</strong></h4> 
<p>针对该日志写一个日志分析脚本logAnalysis.sh：</p> 
<pre><code class="language-python">
#!/bin/bash

jmeter_log=/home/test/jmeter.log

thread_num=`grep 'Thread started' $jmeter_log|tail -n 1|awk -F"-" '{print$6}'`

start_time=`grep 'All thread groups have been started' $jmeter_log|awk -F" " '{print $1,$2}'|awk -F"," '{print $1}'`

end_time=`grep 'Shutdown hook ended' $jmeter_log|awk -F" " '{print $1,$2}'|awk -F"," '{print $1}'`


final_success_time=`grep "place order success" $jmeter_log|tail -n 1|awk -F" " '{print$1,$2}'|awk -F"," '{print$1}'`

success_running_time=$[ $(date -d "$final_success_time" +%s) - $(date -d "$start_time" +%s) ]

running_time=$[ $(date -d "$end_time" +%s) - $(date -d "$start_time" +%s) ]

cancle_times=`grep "cancle orders success" $jmeter_log|wc -l` //撤单次数


success_times=`grep success $jmeter_log|wc -l` // 成功次数

failure_times=`grep FailureMessage $jmeter_log|wc -l`

request_times=$[ $success_times+$failure_times ]

error_rate=`echo "scale=2; $failure_times/$request_times*100" | bc`

qps=$[ $request_times/$running_time ]

throughput=$[ $success_times/$success_running_time ]


echo -e '线程数:'$thread_num

echo -e '请求次数:' $request_times

echo -e '成功次数:' $success_times

echo -e '失败次数:' $failure_times

echo -e '撤单次数:'$cancle_times

echo -e '错误率:' $error_rate'%'

echo -e '开始时间:'$start_time

echo -e '结束时间:'$end_time

echo -e '最后成功请求时间:'$final_success_time

echo -e '请求时间:' $running_time

echo -e '成功运行时间:'$success_running_time

echo -e '吞吐量:'$throughput'/s'

echo -e 'QPS:'$qps'/s'</code></pre> 
<p>当JMeter脚本运行一段时间后，执行logAnalysis.sh，效果如下：线程数：200请求次数：120000成功次数：120000失败次数：0错误率：0%......吞吐量：9000/sQPS：9000/s</p> 
<p>可以看到，输出信息全面清晰。这样，我们就可以在linux下运行<a href="https://so.csdn.net/so/search?q=JMeter%E5%8E%8B%E6%B5%8B&amp;spm=1001.2101.3001.7020" title="JMeter压测">JMeter压测</a>脚本时，实时获取压测详情了。</p> 
<p><strong>最后感谢每一个认真阅读我文章的人，礼尚往来总是要有的，虽然不是什么很值钱的东西，如果你用得到的话可以直接拿走：</strong></p> 
<h4><img alt="" height="709" src="https://images2.imgbox.com/ff/1c/QYZ1ruoG_o.png" width="882">​</h4> 
<p>这些资料，对于【软件测试】的朋友来说应该是最全面最完整的备战仓库，这个仓库也陪伴上万个测试工程师们走过最艰难的路程，希望也能帮助到你！</p> 
<p class="img-center"><img alt="" height="126" src="https://images2.imgbox.com/e5/d7/Yz9CI7En_o.jpg" width="634"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6bb3d39f63948f9b3a4770c7f27ae03b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">国内 10 款主流语言大模型综合能力测评 包括文心一言、Kimi、豆包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0bb01546235c8ae8b6430bc906e635f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RabbitMq的五大消息模型及Java代码演示</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>