<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>公网环境调试本地配置的Java支付宝沙箱环境模拟支付场景 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/de93731391ff52ceaeab063cfded6163/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="公网环境调试本地配置的Java支付宝沙箱环境模拟支付场景">
  <meta property="og:description" content="文章目录 前言1. 下载当面付demo2. 修改配置文件3. 打包成web服务4. 局域网测试5. 内网穿透6. 测试公网访问7. 配置二级子域名8. 测试使用固定二级子域名访问 前言 在沙箱环境调试支付SDK的时候，往往沙箱环境部署在本地，局限性大，在沙箱环境中有多种支付场景，往往是多人联合开发，本地环境可能无法满足异地联合，所以把本地环境变成公网环境下进行调试开发会更好。
本次教程，我们将使用支付宝平台提供的沙箱环境，在本地配置测试模拟支付，并做内网穿透，通过cpolar穿透内网，实现在公网环境下的远程访问，无需公网IP，也无需配置路由器。
1. 下载当面付demo 进入支付宝开放平台沙箱应用(https://open.alipay.com/develop/sandbox/app),查看产品列表–&gt;已支持的产品，选择一种支付场景，这里选择 当面付，然后点击查看文档
然后下载官方提供demo,有三种语言,这里以java语言为例,下载java版demo
2. 修改配置文件 demo下载好后，把TradePayDemo和TradePaySDK两个模块倒入开发工具中，这里以IDEA开发工具为例，需要注意，官方要求的JDK版本是1.6
倒入并且设置好JDK版本后,打开TradePayDemo下面的zfbinfo.properties配置文件，填写对应的信息
注意配置文件情况：
第一个配置信息open_api_domain的值需要设置成支付宝开发平台以下对应的值 pid和appid对应以下信息 private_key和public_key和alipay_public_key分别对应以下信息 修改好配置文件后,在Main启动类,右键运行mian方法运行测试配置文件是否正确,出现下单成功表示配置文件正确
3. 打包成web服务 接下来把TradePayDemo这个web项目打包成web服务.
接着右键重新运行Main类的main方法
然后在输出的路径上可以看到出现了一个.war的web war包
接下来把这个war包放在tomcat中的webapps目录下运行.(这里tomcat版本为8.5.84)
运行tomcat
4. 局域网测试 在浏览器上输入http://localhost&#43;:端口号/TradePayDemo_war exploded/index.html，访问支付页面，出现如下界面表示成功
5. 内网穿透 接着使用cpolar穿透本地支付宝支付沙箱环境demo,使得远程可以进行访问沙箱环境进行测试。cpolar支持http/https/tcp协议，不限制流量，操作简单，无需公网IP，也无需路由器。
cpolar官网：https://www.cpolar.com/
在本地安装cpolar内网穿透之后，在浏览器上访问本地9200端口，打开cpolar web ui 界面:http://127.0.0.1:9200。
点击左侧仪表盘的隧道管理——创建隧道，由于tomcat中配置的是8040端口，因此我们要来创建一条http隧道，指向8040端口：
隧道名称：可自定义，注意不要与已有的隧道名称重复协议：http本地地址：8040域名类型：免费选择随机域名地区：选择China top 点击创建
隧道创建成功后，点击左侧的状态——在线隧道列表，可以看到，刚刚创建的隧道已经有生成了相应的公网地址，将其复制下来
6. 测试公网访问 打开浏览器，访问刚刚复制的公网地址，出现如下界面表示公网访问成功
7. 配置二级子域名 由于以上使用cpolar所创建的隧道使用的是随即公网地址，该地址为随机临时地址，24小时内会发生变化，不利于长期远程访问。
因此我们可以为其配置二级子域名，该地址为固定地址，不会随机变化【ps：cpolar.cn已备案】
需要注意，配置固定二级子域名需要将cpolar升级到基础套餐或以上。
登录cpolar官网，点击左侧的预留，选择保留二级子域名，设置一个二级子域名名称，点击保留
地区：选择china二级域名：可自定义描述：即备注，可自定义 地址保留成功后，将其复制下来，本例为alipayTest
访问本地9200端口，打开cpolar web ui 界面，点击左侧的隧道管理——隧道列表，找到支付接口测试隧道，点击右侧的编辑
修改隧道信息：
域名类型：选择二级域名Sub Domain：填写刚刚保留成功的二级子域名 点击更新">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-22T14:54:37+08:00">
    <meta property="article:modified_time" content="2024-01-22T14:54:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">公网环境调试本地配置的Java支付宝沙箱环境模拟支付场景</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">前言</a></li><li><ul><li><ul><li><a href="#1_demo_8" rel="nofollow">1. 下载当面付demo</a></li><li><a href="#2__18" rel="nofollow">2. 修改配置文件</a></li><li><a href="#3_web_48" rel="nofollow">3. 打包成web服务</a></li><li><a href="#4__76" rel="nofollow">4. 局域网测试</a></li><li><a href="#5__82" rel="nofollow">5. 内网穿透</a></li><li><a href="#6__106" rel="nofollow">6. 测试公网访问</a></li><li><a href="#7__113" rel="nofollow">7. 配置二级子域名</a></li><li><a href="#8__148" rel="nofollow">8. 测试使用固定二级子域名访问</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>前言</h3> 
<p>在沙箱环境调试支付SDK的时候，往往沙箱环境部署在本地，局限性大，在沙箱环境中有多种支付场景，往往是多人联合开发，本地环境可能无法满足异地联合，所以把本地环境变成公网环境下进行调试开发会更好。</p> 
<p>本次教程，我们将使用支付宝平台提供的沙箱环境，在本地配置测试模拟支付，并做内网穿透，通过cpolar穿透内网，实现在公网环境下的远程访问，无需公网IP，也无需配置路由器。</p> 
<h5><a id="1_demo_8"></a>1. 下载当面付demo</h5> 
<p>进入支付宝开放平台沙箱应用(<a href="https://open.alipay.com/develop/sandbox/app" rel="nofollow">https://open.alipay.com/develop/sandbox/app</a>),查看产品列表–&gt;已支持的产品，选择一种支付场景，这里选择 当面付，然后点击查看文档</p> 
<p><img src="https://images2.imgbox.com/7a/88/GYXroH7d_o.png" alt="2023010901"></p> 
<p>然后下载官方提供demo,有三种语言,这里以java语言为例,下载java版demo</p> 
<p><img src="https://images2.imgbox.com/d9/43/a43adyTv_o.png" alt="2023010902"></p> 
<h5><a id="2__18"></a>2. 修改配置文件</h5> 
<p>demo下载好后，把<code>TradePayDemo</code>和<code>TradePaySDK</code>两个模块倒入开发工具中，这里以IDEA开发工具为例，需要注意，官方要求的JDK版本是1.6</p> 
<p><img src="https://images2.imgbox.com/f7/b8/iU92LbAe_o.png" alt="2023010903"></p> 
<p>倒入并且设置好JDK版本后,打开TradePayDemo下面的zfbinfo.properties配置文件，填写对应的信息</p> 
<p><img src="https://images2.imgbox.com/67/e8/JoMU2pfF_o.png" alt="2023010904"></p> 
<p>注意配置文件情况：</p> 
<ul><li>第一个配置信息open_api_domain的值需要设置成支付宝开发平台以下对应的值</li></ul> 
<p><img src="https://images2.imgbox.com/85/57/n3RVD6Db_o.png" alt="2023010905"></p> 
<ul><li>pid和appid对应以下信息</li></ul> 
<p><img src="https://images2.imgbox.com/93/c3/9siZNtoy_o.png" alt="2023010906"></p> 
<ul><li><code>private_key</code>和<code>public_key</code>和<code>alipay_public_key</code>分别对应以下信息</li></ul> 
<p><img src="https://images2.imgbox.com/70/70/YSBwLgRM_o.png" alt="2023010907"></p> 
<p><img src="https://images2.imgbox.com/94/bf/JtA3luWC_o.png" alt="202301090801"></p> 
<p>修改好配置文件后,在Main启动类,右键运行mian方法运行测试配置文件是否正确,出现下单成功表示配置文件正确</p> 
<p><img src="https://images2.imgbox.com/35/5e/LXxn3Su9_o.png" alt="2023010909"></p> 
<h5><a id="3_web_48"></a>3. 打包成web服务</h5> 
<p>接下来把TradePayDemo这个web项目打包成web服务.</p> 
<p><img src="https://images2.imgbox.com/ee/16/TzakysY2_o.png" alt="2023010910"></p> 
<p><img src="https://images2.imgbox.com/64/ba/UrCZTKgq_o.png" alt="2023010911"></p> 
<p><img src="https://images2.imgbox.com/7b/4c/EySlqdtt_o.png" alt="2023010912"></p> 
<p>接着右键重新运行Main类的main方法</p> 
<p><img src="https://images2.imgbox.com/4b/d3/FM1UuNV9_o.png" alt="2023010913"></p> 
<p>然后在输出的路径上可以看到出现了一个.war的web war包</p> 
<p><img src="https://images2.imgbox.com/41/9e/y53A1VWO_o.png" alt="2023010914"></p> 
<p>接下来把这个war包放在tomcat中的webapps目录下运行.(这里tomcat版本为8.5.84)</p> 
<p><img src="https://images2.imgbox.com/78/89/CVE1VPpl_o.png" alt="2023010915"></p> 
<p>运行tomcat</p> 
<p><img src="https://images2.imgbox.com/a5/69/D8JQGdhD_o.png" alt="2023010916"></p> 
<p><img src="https://images2.imgbox.com/cf/f1/2ljmXTN0_o.png" alt="2023010917"></p> 
<h5><a id="4__76"></a>4. 局域网测试</h5> 
<p>在浏览器上输入<code>http://localhost+:端口号/TradePayDemo_war exploded/index.html</code>，访问支付页面，出现如下界面表示成功</p> 
<p><img src="https://images2.imgbox.com/28/c4/pdHHLQly_o.png" alt="2023010918"></p> 
<h5><a id="5__82"></a>5. 内网穿透</h5> 
<p>接着使用cpolar穿透本地支付宝支付沙箱环境demo,使得远程可以进行访问沙箱环境进行测试。cpolar支持http/https/tcp协议，不限制流量，操作简单，无需公网IP，也无需路由器。</p> 
<blockquote> 
 <p>cpolar官网：<a href="https://www.cpolar.com/" rel="nofollow">https://www.cpolar.com/</a></p> 
</blockquote> 
<p>在本地安装cpolar内网穿透之后，在浏览器上访问本地9200端口，打开cpolar web ui 界面:<a href="http://127.0.0.1:9200" rel="nofollow">http://127.0.0.1:9200</a>。</p> 
<p>点击左侧仪表盘的隧道管理——创建隧道，由于tomcat中配置的是8040端口，因此我们要来创建一条http隧道，指向8040端口：</p> 
<ul><li>隧道名称：可自定义，注意不要与已有的隧道名称重复</li><li>协议：http</li><li>本地地址：8040</li><li>域名类型：免费选择随机域名</li><li>地区：选择China top</li></ul> 
<p>点击<code>创建</code></p> 
<p><img src="https://images2.imgbox.com/ac/9d/N0gekkZH_o.png" alt="2023010919"></p> 
<p>隧道创建成功后，点击左侧的状态——在线隧道列表，可以看到，刚刚创建的隧道已经有生成了相应的公网地址，将其复制下来</p> 
<p><img src="https://images2.imgbox.com/44/9a/ofwdnNzE_o.png" alt="2023010920"></p> 
<h5><a id="6__106"></a>6. 测试公网访问</h5> 
<p>打开浏览器，访问刚刚复制的公网地址，出现如下界面表示公网访问成功</p> 
<p><img src="https://images2.imgbox.com/81/95/f3d06lej_o.png" alt="2023010921"></p> 
<h5><a id="7__113"></a>7. 配置二级子域名</h5> 
<p>由于以上使用cpolar所创建的隧道使用的是随即公网地址，该地址为随机临时地址，24小时内会发生变化，不利于长期远程访问。</p> 
<p>因此我们可以为其配置二级子域名，该地址为固定地址，不会随机变化【ps：cpolar.cn已备案】</p> 
<blockquote> 
 <p>需要注意，配置固定二级子域名需要将cpolar升级到基础套餐或以上。</p> 
</blockquote> 
<p>登录cpolar官网，点击左侧的预留，选择保留二级子域名，设置一个二级子域名名称，点击保留</p> 
<ul><li>地区：选择china</li><li>二级域名：可自定义</li><li>描述：即备注，可自定义</li></ul> 
<p>地址保留成功后，将其复制下来，本例为<code>alipayTest</code></p> 
<p><img src="https://images2.imgbox.com/72/c0/7HPgA6yR_o.png" alt="2023010922"></p> 
<p>访问本地9200端口，打开cpolar web ui 界面，点击左侧的隧道管理——隧道列表，找到支付接口测试隧道，点击右侧的<code>编辑</code></p> 
<p><img src="https://images2.imgbox.com/b6/cf/25mFCtx9_o.png" alt="2023010923"></p> 
<p>修改隧道信息：</p> 
<ul><li>域名类型：选择二级域名</li><li>Sub Domain：填写刚刚保留成功的二级子域名</li></ul> 
<p>点击<code>更新</code></p> 
<p><img src="https://images2.imgbox.com/b1/43/B9E8G93v_o.png" alt="2023010924"></p> 
<p>点击左侧的状态——打开在线隧道列表，可以看到公网地址已经更新成为了二级子域名，复制对应的公网地址</p> 
<p><img src="https://images2.imgbox.com/f6/29/zQeC5PC1_o.png" alt="2023010925"></p> 
<h5><a id="8__148"></a>8. 测试使用固定二级子域名访问</h5> 
<p>我们打开浏览器，访问我们刚刚配置成功的固定二级子域名，出现如下信息表示成功。</p> 
<p><img src="https://images2.imgbox.com/9d/a2/zu0XXuOz_o.png" alt="2023010926"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ec2c5b88ea1f267edec80446a5b089fb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hive数据库系列--Hive文件格式/Hive存储格式/Hive压缩格式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9369851ac3191c7233c4ce7db01d6d60/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Copilot安装和使用最全教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>