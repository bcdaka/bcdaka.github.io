<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安装配置Kafka，并使用Java集成Kafka - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7d2bd915ef0a2b72178f807b64cbc169/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="安装配置Kafka，并使用Java集成Kafka">
  <meta property="og:description" content="一、安装Kafka的环境要求 首先在安装 Kafka 之前，需要满足的环境要求：
1、Java运行环境
Kafka 是使用 Java 语言编写的，因此需要在安装 Kafka 之前先安装 Java 运行环境。Kafka 支持 Java 8 及以上版本。可以通过以下命令检查 Java 运行环境的版本
java -version 2、ZooKeeper
Kafka 的运⾏环境依赖于 ZooKeeper，Kafka 使用 ZooKeeper 进行分布式协调，因此在安装 Kafka 之前，需要先安装 ZooKeeper。
二、安装ZooKeeper 1、解压安装 在 /usr/local/ 下创建 zookeeper ⽂件夹并进⼊，
将 ZooKeeper 安装包解压到 /usr/local/zookeeper 中即可，
[root@localhost zookeeper]# tar -zxvf /root/apache-zookeeper-3.6.1-bin.tar.gz -C ./ 2、创建一个data目录 这⾥直接在 /usr/local/zookeeper/apache-zookeeper-3.6.1-bin ⽬录中创建⼀个 data ⽬录。
该 data ⽬录地址要配到 ZooKeeper 的配置⽂件中。
3、创建配置文件并修改 进⼊到 zookeeper 的 conf ⽬录，复制 zoo_sample.cfg 得到 zoo.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-25T09:31:22+08:00">
    <meta property="article:modified_time" content="2024-07-25T09:31:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安装配置Kafka，并使用Java集成Kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、安装Kafka的环境要求</h2> 
<p>首先在安装 Kafka 之前，需要满足的环境要求：</p> 
<p><strong>1、Java运行环境</strong></p> 
<p>Kafka 是<a href="https://so.csdn.net/so/search?q=%E4%BD%BF%E7%94%A8&amp;spm=1001.2101.3001.7020" title="使用">使用</a> Java 语言编写的，因此需要在安装 Kafka 之前先安装 Java 运行环境。Kafka 支持 Java 8 及以上版本。可以通过以下命令检查 Java 运行环境的版本</p> 
<pre><code class="hljs">   java -version</code></pre> 
<p><strong>2、ZooKeeper</strong></p> 
<p>Kafka 的运⾏环境依赖于 ZooKeeper，Kafka 使用 ZooKeeper 进行分布式协调，因此在安装 Kafka 之前，需要先安装 ZooKeeper。</p> 
<h2>二、安装ZooKeeper</h2> 
<h3>1、解压安装</h3> 
<p>在 /usr/local/ 下创建 zookeeper ⽂件夹并进⼊，</p> 
<p>将 ZooKeeper 安装包解压到 /usr/local/zookeeper 中即可，</p> 
<pre><code class="hljs">[root@localhost zookeeper]# tar -zxvf /root/apache-zookeeper-3.6.1-bin.tar.gz -C ./</code></pre> 
<h3>2、创建一个data目录</h3> 
<p>这⾥直接在 /usr/local/zookeeper/apache-zookeeper-3.6.1-bin ⽬录中创建⼀个 data ⽬录。</p> 
<p>该 data ⽬录地址要配到 ZooKeeper 的配置⽂件中。</p> 
<h3>3、创建配置文件并修改</h3> 
<p>进⼊到 zookeeper 的 conf ⽬录，复制 zoo_sample.cfg 得到 zoo.cfg ：</p> 
<pre><code class="hljs">[root@localhost apache-zookeeper-3.6.1-bin]# cd conf/
[root@localhost conf]# cp zoo_sample.cfg zoo.cfg</code></pre> 
<p>修改配置⽂件 zoo.cfg ，将其中的 dataDir 修改为上⾯刚创建的 data ⽬录。</p> 
<p><img alt="" height="522" src="https://images2.imgbox.com/9c/e2/k7AfsImQ_o.png" width="790"></p> 
<h3>4、启动ZooKeeper</h3> 
<pre><code class="hljs">[root@localhost apache-zookeeper-3.6.1-bin]# ./bin/zkServer.sh start</code></pre> 
<p>查看启动状态</p> 
<pre><code class="hljs">[root@localhost apache-zookeeper-3.6.1-bin]# ./bin/zkServer.sh status</code></pre> 
<h3>5、把ZooKeeper设置为开机自启动</h3> 
<p>⾸先进⼊ /etc/rc.d/init.d ⽬录，创建⼀个名为 zookeeper 的⽂件，并赋予执⾏权限。</p> 
<pre><code>[root@localhost ~]# cd /etc/rc.d/init.d/
[root@localhost init.d]# touch zookeeper
[root@localhost init.d]# chmod +x zookeeper</code></pre> 
<p> 接下来编辑 zookeeper ⽂件，并在其中加⼊如下内容：</p> 
<pre><code>#!/bin/bash
#chkconfig:- 20 90
#description:zookeeper
#processname:zookeeper
ZOOKEEPER_HOME=/usr/local/zookeeper/apache-zookeeper-3.6.1-bin
export JAVA_HOME=/usr/local/java/jdk1.8.0_161 # 此处根据你的实际情况更换对
应
case $1 in
 start) su root $ZOOKEEPER_HOME/bin/zkServer.sh start;;
 stop) su root $ZOOKEEPER_HOME/bin/zkServer.sh stop;;
 status) su root $ZOOKEEPER_HOME/bin/zkServer.sh status;;
 restart) su root $ZOOKEEPER_HOME/bin/zkServer.sh restart;;
 *) echo "require start|stop|status|restart" ;;
esac</code></pre> 
<p><span style="color:#111111;">最后加⼊开机启动即可：</span></p> 
<pre><code>chkconfig --add zookeeper
chkconfig zookeeper on</code></pre> 
<h2>三、安装Kafka</h2> 
<h3>1、解压安装</h3> 
<p>在 /usr/local/ 下创建 kafka ⽂件夹并进⼊</p> 
<pre><code>cd /usr/local/
mkdir kafka
cd kafka</code></pre> 
<p>将Kafka安装包解压到 /usr/local/kafka 中</p> 
<pre><code>[root@localhost kafka]# tar -zxvf /root/kafka_2.12-2.5.0.tgz -C ./</code></pre> 
<h3>2、创建logs目录</h3> 
<p>这⾥直接在 /usr/local/kafka/kafka_2.12-2.5.0 ⽬录中创建⼀个 logs ⽬录<br> 该 logs ⽬录地址要配到Kafka的配置⽂件中。</p> 
<h3>3、修改配置文件</h3> 
<p>进⼊到 Kafka 的 config ⽬录，编辑配置⽂件 server.properties</p> 
<pre><code>[root@localhost kafka_2.12-2.5.0]# cd config/
[root@localhost config]# vim server.properties</code></pre> 
<p>修改配置⽂件，⼀是将其中的 log.dirs 修改为上⾯刚创建的 logs ⽬录</p> 
<p><img alt="" height="492" src="https://images2.imgbox.com/61/54/3ec1od3s_o.png" width="935"></p> 
<h2>四、启动Kafka，并使用命令行操作生产者消费者</h2> 
<h3>1、启动Kafka</h3> 
<p>启动Kafka之前，需要先启动ZooKeeper，目前ZooKeeper已经设置成开机自启动了。</p> 
<p>使用命令行启动Kafka。</p> 
<pre><code>./bin/kafka-server-start.sh ./config/server.properties</code></pre> 
<h3>2、创建主题topic</h3> 
<p>⾸先创建⼀个名为 Winter 的 topic ：</p> 
<pre><code>./bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic Winter</code></pre> 
<p><br><img alt="" height="90" src="https://images2.imgbox.com/53/e1/Qtybkt0G_o.png" width="866"></p> 
<p>列出⽬前已有的 topic 列表</p> 
<pre><code>./bin/kafka-topics.sh --list --bootstrap-server localhost:9092</code></pre> 
<h3>3、创建一个消费者</h3> 
<p>创建⼀个消费者，⽤于在 codesheep 这个 topic 上获取消息</p> 
<pre><code>./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic Winter</code></pre> 
<h3>4、创建生产者</h3> 
<p>创建⼀个⽣产者，⽤于在 codesheep 这个 topic 上⽣产消息</p> 
<pre><code>./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic Winter</code></pre> 
<h3>5、使用生产者发送数据，消费者就可以接受数据。</h3> 
<p><img alt="" height="123" src="https://images2.imgbox.com/a0/92/qtCZZq2L_o.png" width="852"></p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/35/f4/M0OygUsK_o.png" width="859"></p> 
<h2>五、使用Java集成Kafka，实现生产者和消费者。</h2> 
<h3>1、首先创建一个Maven项目</h3> 
<p>引入依赖pom.xml</p> 
<pre><code class="language-java">        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;
            &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;
            &lt;version&gt;2.5.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h3>2、创建生产者KafkaProducerTest.java</h3> 
<pre><code class="language-java">public class KafkaProducerTest {
    public static void main(String[] args) {
        // TODO 创建配置对象
        Map&lt;String, Object&gt; configMap = new HashMap&lt;&gt;();
        configMap.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "192.168.116.101:9092");
        // TODO 对生产的数据K,V进行序列化的操作
        configMap.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());
        configMap.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());

        // TODO 创建生产者对象
        //      生产者对象需要设定泛型，数据的类型约束
        KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(configMap);

        // TODO 创建数据
        //      构造数据时，需要传递三个参数
        //      1. topic: 要发送数据的主题
        //      2. key: 数据的key
        //      3. value: 数据的值
//        ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;String, String&gt;(
//                "Winter",
//                "key",
//                "value"
//        );
//
//        // TODO 通过生产者对象将数据发送给Kafka
//        producer.send(record);

        for (int i = 0; i &lt; 10; i++) {
            ProducerRecord&lt;String, String&gt; record = new ProducerRecord&lt;&gt;(
                    "Winter",
                    "key" + i,
                    "value" + i
            );
            producer.send(record, (metadata, exception) -&gt; {
                if (exception != null) {
                    exception.printStackTrace();
                    System.out.println("发送消息失败：" + exception.getMessage());
                } else {
                    System.out.println("发送消息成功：" + metadata.toString());
                }
            });
        }

        // TODO 关闭资源
        producer.close();
    }
}</code></pre> 
<h3>3、创建消费者KafkaConsumerTest.java</h3> 
<pre><code class="language-java">public class KafkaConsumerTest {
    public static void main(String[] args) {
        // TODO 创建配置对象
        Map&lt;String, Object&gt; consumerConfig = new HashMap&lt;&gt;();
        consumerConfig.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "192.168.116.101:9092");
        // TODO 对数据进行反序列化
        consumerConfig.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
        consumerConfig.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());

        consumerConfig.put(ConsumerConfig.GROUP_ID_CONFIG, "group");

        // TODO 创建消费者对象
        KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;String, String&gt;(consumerConfig);

        // TODO 订阅主题
        consumer.subscribe(Collections.singletonList("Winter"));

        // TODO 从kafka的主题中获取数据
        // 消费者从Kafka中拉取数据
        while (true){
            final ConsumerRecords&lt;String, String&gt; datas = consumer.poll(100);
            for (ConsumerRecord&lt;String, String&gt; data : datas){
                System.out.println(data);
            }
        }
        // TODO 关闭消费者对象
        //consumer.close();
    }
}</code></pre> 
<h3>4、启动Java和Linux的生产者消费者进行发送接收数据</h3> 
<p>成功运行Java的生产者KafkaProducerTest.java，发送数据</p> 
<p><img alt="" height="409" src="https://images2.imgbox.com/be/6b/sTH5fTvX_o.png" width="577"></p> 
<p>Java的消费者和Linux系统的消费者 都会收到生产者发过来的数据</p> 
<p><img alt="" height="413" src="https://images2.imgbox.com/fb/ba/2UgopJQG_o.png" width="1200"></p> 
<p><img alt="" height="234" src="https://images2.imgbox.com/96/49/8Y1Xw86N_o.png" width="877"></p> 
<p>使用Linux的生产者发送数据也是同理。</p> 
<h3>5、运行时遇到的问题</h3> 
<p>Linux系统Kafka的生产者和消费者可以正常 发送和接受数据。</p> 
<p>但是在运行Java程序时，Java的生产者一直运行不停止，发送不了数据，消费者也接收不到数据。仔细检查IP、端口并没有写错，代码也没错误。</p> 
<p>解决办法是</p> 
<p>将kafka目录中的./config/server.properties文件中advertised.listeners改为如下属性。192.168.116.101是我虚拟机的IP。改完后重启，OK了。Java端的代码终于能通信了。</p> 
<p><img alt="" height="373" src="https://images2.imgbox.com/e3/fb/ABH0Amcp_o.png" width="734"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/91cc56d4a493def3aabf3047253b0802/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【JavaScript】`forEach` 方法的详解与实战</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0b130489be5ffc4df940ecff8c486e9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">全新微软语音合成网页版源码，短视频影视解说配音网页版系统-仿真人语音</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>