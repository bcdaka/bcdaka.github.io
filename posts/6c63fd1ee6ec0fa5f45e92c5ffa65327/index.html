<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python实战：SQLAlchemy ORM使用教程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6c63fd1ee6ec0fa5f45e92c5ffa65327/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python实战：SQLAlchemy ORM使用教程">
  <meta property="og:description" content="一、SQLAlchemy ORM使用教程 SQLAlchemy是一个流行的Python SQL工具包和对象关系映射（ORM）框架，它为开发人员提供了一种高效、灵活的方式来与数据库进行交互。在本篇博客中，我们将深入探讨SQLAlchemy ORM的核心知识，并通过具体的代码示例来帮助您快速上手。
二、SQLAlchemy简介 SQLAlchemy由Mike Bayer创建，它提供了两种主要的组件：SQLAlchemy Core和SQLAlchemy ORM。
SQLAlchemy Core：是一个SQL表达式语言和数据库抽象层，它允许您使用Python类来表示数据库表，并且可以使用Python表达式来编写SQL查询。SQLAlchemy ORM：是一个建立在SQLAlchemy Core之上的对象关系映射器，它允许您使用Python类来表示数据库表，并且可以通过操作这些类实例来执行数据库操作。
在本篇博客中，我们将重点介绍SQLAlchemy ORM的使用。 三、安装SQLAlchemy 在开始使用SQLAlchemy之前，需要确保已经安装了Python。SQLAlchemy可以通过pip命令进行安装：
pip install SQLAlchemy 四、连接到数据库 要使用SQLAlchemy ORM，首先需要创建一个数据库连接。SQLAlchemy支持多种数据库后端，包括SQLite、MySQL、PostgreSQL等。
以下是一个使用SQLite数据库的示例：
from sqlalchemy import create_engine engine = create_engine(&#39;sqlite:///example.db&#39;) 在这个示例中，我们使用create_engine()函数创建了一个SQLite数据库引擎，它将连接到名为example.db的SQLite数据库文件。
五、定义模型 在SQLAlchemy ORM中，模型通常是通过定义Python类来实现的，这些类继承自sqlalchemy.ext.declarative.api.DeclarativeMeta。每个类对应于数据库中的一个表，类的属性对应于表中的列。
以下是一个简单的用户模型示例：
from sqlalchemy.ext.declarative import declarative_base from sqlalchemy import Column, Integer, String Base = declarative_base() class User(Base): __tablename__ = &#39;users&#39; id = Column(Integer, primary_key=True) name = Column(String) age = Column(Integer) 在这个示例中，我们首先创建了一个Base类，它将作为所有模型类的基类。然后，我们定义了一个User类，它继承自Base类。__tablename__属性指定了数据库中对应的表名。id、name和age属性定义了表中的列，Column函数用于指定列的数据类型和约束。
六、创建表 在定义了模型之后，我们可以使用Base.metadata.create_all()方法来创建数据库表。
from sqlalchemy.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-19T07:00:00+08:00">
    <meta property="article:modified_time" content="2024-03-19T07:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python实战：SQLAlchemy ORM使用教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SQLAlchemy_ORM_0"></a>一、SQLAlchemy ORM使用教程</h2> 
<p>SQLAlchemy是一个流行的Python SQL工具包和对象关系映射（ORM）框架，它为开发人员提供了一种高效、灵活的方式来与数据库进行交互。在本篇博客中，我们将深入探讨SQLAlchemy ORM的核心知识，并通过具体的代码示例来帮助您快速上手。</p> 
<h3><a id="SQLAlchemy_2"></a>二、SQLAlchemy简介</h3> 
<p>SQLAlchemy由Mike Bayer创建，它提供了两种主要的组件：SQLAlchemy Core和SQLAlchemy ORM。</p> 
<ul><li><strong>SQLAlchemy Core</strong>：是一个SQL表达式语言和数据库抽象层，它允许您使用Python类来表示数据库表，并且可以使用Python表达式来编写SQL查询。</li><li><strong>SQLAlchemy ORM</strong>：是一个建立在SQLAlchemy Core之上的对象关系映射器，它允许您使用Python类来表示数据库表，并且可以通过操作这些类实例来执行数据库操作。<br> 在本篇博客中，我们将重点介绍SQLAlchemy ORM的使用。</li></ul> 
<h3><a id="SQLAlchemy_7"></a>三、安装SQLAlchemy</h3> 
<p>在开始使用SQLAlchemy之前，需要确保已经安装了Python。SQLAlchemy可以通过pip命令进行安装：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> SQLAlchemy
</code></pre> 
<h3><a id="_12"></a>四、连接到数据库</h3> 
<p>要使用SQLAlchemy ORM，首先需要创建一个数据库连接。SQLAlchemy支持多种数据库后端，包括SQLite、MySQL、PostgreSQL等。<br> 以下是一个使用SQLite数据库的示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'sqlite:///example.db'</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们使用<code>create_engine()</code>函数创建了一个SQLite数据库引擎，它将连接到名为<code>example.db</code>的SQLite数据库文件。</p> 
<h3><a id="_20"></a>五、定义模型</h3> 
<p>在SQLAlchemy ORM中，模型通常是通过定义Python类来实现的，这些类继承自<code>sqlalchemy.ext.declarative.api.DeclarativeMeta</code>。每个类对应于数据库中的一个表，类的属性对应于表中的列。<br> 以下是一个简单的用户模型示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>declarative <span class="token keyword">import</span> declarative_base
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Column<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String
Base <span class="token operator">=</span> declarative_base<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'users'</span>
    
    <span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span>Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> Column<span class="token punctuation">(</span>String<span class="token punctuation">)</span>
    age <span class="token operator">=</span> Column<span class="token punctuation">(</span>Integer<span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先创建了一个<code>Base</code>类，它将作为所有模型类的基类。然后，我们定义了一个<code>User</code>类，它继承自<code>Base</code>类。<code>__tablename__</code>属性指定了数据库中对应的表名。<code>id</code>、<code>name</code>和<code>age</code>属性定义了表中的列，<code>Column</code>函数用于指定列的数据类型和约束。</p> 
<h3><a id="_35"></a>六、创建表</h3> 
<p>在定义了模型之后，我们可以使用<code>Base.metadata.create_all()</code>方法来创建数据库表。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker
<span class="token comment"># 创建数据库连接</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'sqlite:///example.db'</span><span class="token punctuation">)</span>
<span class="token comment"># 创建所有表</span>
Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先创建了一个数据库连接。然后，我们调用了<code>Base.metadata.create_all()</code>方法，它将根据模型定义创建所有表。</p> 
<h3><a id="_45"></a>七、创建会话</h3> 
<p>在SQLAlchemy ORM中，会话（Session）是用于与数据库进行交互的主要接口。会话允许您执行数据库操作，如插入、查询、更新和删除数据。<br> 以下是一个创建会话的示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker
<span class="token comment"># 创建数据库连接</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'sqlite:///example.db'</span><span class="token punctuation">)</span>
<span class="token comment"># 创建会话工厂</span>
Session <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>bind<span class="token operator">=</span>engine<span class="token punctuation">)</span>
<span class="token comment"># 创建会话实例</span>
session <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先创建了一个数据库连接。然后，我们使用<code>sessionmaker</code>函数创建了一个会话工厂。最后，我们创建了一个会话实例，它将用于执行数据库操作。</p> 
<h3><a id="_58"></a>八、插入数据</h3> 
<p>在SQLAlchemy ORM中，要插入数据，首先需要创建模型类的实例，并将其添加到会话中。然后，可以使用会话的<code>commit()</code>方法将更改提交到数据库。<br> 以下是一个插入数据的示例：</p> 
<pre><code class="prism language-python"><span class="token comment"># 创建用户实例</span>
user <span class="token operator">=</span> User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token comment"># 添加用户到会话</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment"># 提交事务</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先创建了一个<code>User</code>实例，并设置了<code>name</code>和<code>age</code>属性。然后，我们使用<code>add()</code>方法将用户实例添加到会话中。最后，我们调用了<code>commit()</code>方法将更改提交到数据库。</p> 
<h3><a id="_70"></a>九、查询数据</h3> 
<p>在SQLAlchemy ORM中，要查询数据，可以使用会话的<code>query()</code>方法。<code>query()</code>方法接受模型类作为参数，并返回一个查询对象。查询对象提供了多种方法来执行不同的查询操作。<br> 以下是一些查询数据的示例：</p> 
<pre><code class="prism language-python"><span class="token comment"># 查询所有用户</span>
users <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询特定条件的用户</span>
user <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询并排序</span>
users <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span>age<span class="token punctuation">.</span>desc
<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询并限制返回数量</span>
users <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询并偏移</span>
users <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>offset<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 查询并使用原生SQL</span>
users <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token string">"age &gt; 25"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们展示了如何执行不同的查询操作。<code>all()</code>方法返回查询结果的所有记录，<code>first()</code>方法返回查询结果的第一条记录。<code>filter_by()</code>方法用于根据特定条件过滤记录，<code>order_by()</code>方法用于排序记录，<code>limit()</code>方法用于限制返回的记录数量，<code>offset()</code>方法用于偏移查询结果的起始点。此外，还可以使用<code>filter()</code>方法配合原生SQL语句进行查询。</p> 
<h3><a id="_89"></a>十、更新数据</h3> 
<p>在SQLAlchemy ORM中，要更新数据，可以使用会话的<code>query()</code>方法获取要更新的记录，然后修改记录的属性，并提交会话。<br> 以下是一个更新数据的示例：</p> 
<pre><code class="prism language-python"><span class="token comment"># 查询要更新的用户</span>
user <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 更新用户属性</span>
user<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">31</span>
<span class="token comment"># 提交事务</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先查询了名为Alice的用户。然后，我们修改了用户的<code>age</code>属性。最后，我们提交了会话以保存更改。</p> 
<h3><a id="_101"></a>十一、删除数据</h3> 
<p>在SQLAlchemy ORM中，要删除数据，可以使用会话的<code>query()</code>方法获取要删除的记录，然后使用<code>delete()</code>方法删除记录，并提交会话。<br> 以下是一个删除数据的示例：</p> 
<pre><code class="prism language-python"><span class="token comment"># 查询要删除的用户</span>
user <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除用户</span>
session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token comment"># 提交事务</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在这个示例中，我们首先查询了名为Alice的用户。然后，我们使用<code>delete()</code>方法删除了该用户。最后，我们提交了会话以保存更改。</p> 
<h3><a id="_113"></a>十二、使用事务</h3> 
<p>在SQLAlchemy ORM中，可以使用会话来管理事务。会话提供了一个<code>begin()</code>方法来开始一个事务，以及一个<code>commit()</code>方法来提交事务。如果发生错误，可以使用<code>rollback()</code>方法来回滚事务。<br> 以下是一个使用事务的示例：</p> 
<pre><code class="prism language-python"><span class="token comment"># 开始事务</span>
session<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 执行数据库操作</span>
    user <span class="token operator">=</span> User<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token comment"># 回滚事务</span>
    session<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">raise</span>
</code></pre> 
<p>在这个示例中，我们首先调用了<code>begin()</code>方法开始一个事务。然后，我们尝试执行数据库操作，如果操作成功，我们提交事务。如果发生错误，我们回滚事务并重新抛出异常。</p> 
<h3><a id="_130"></a>十三、关闭会话</h3> 
<p>在完成数据库操作后，应该关闭会话以释放资源。</p> 
<pre><code class="prism language-python"><span class="token comment"># 关闭会话</span>
session<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_136"></a>十四、结论</h3> 
<p>SQLAlchemy ORM是一个功能强大且灵活的工具，它允许我们使用Python类和实例来表示数据库表和记录。在本篇博客中，我们介绍了如何连接到数据库、定义模型、创建表、插入、查询、更新和删除数据、使用事务以及关闭会话。这些知识将帮助我们在Python应用程序中高效地使用SQLAlchemy ORM。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7316568007047cd27ee2e33ccb3e9c64/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">好用的Redis 客户端工具有几个? 这里推荐两三个</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/901463c2572df4ad91f8ccea8d3608fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何在vs中配置ai来提升写代码的效率</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>