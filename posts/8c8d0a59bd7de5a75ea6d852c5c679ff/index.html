<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QT&#43;OpenCV在Android上实现人脸实时检测与目标检测 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8c8d0a59bd7de5a75ea6d852c5c679ff/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="QT&#43;OpenCV在Android上实现人脸实时检测与目标检测">
  <meta property="og:description" content="一、功能介绍 在当今的移动应用领域，随着技术的飞速发展和智能设备的普及，将先进的计算机视觉技术集成到移动平台，特别是Android系统中，已成为提升用户体验、拓展应用功能的关键。其中，目标检测与人脸识别作为计算机视觉领域的两大基石，广泛应用于安全监控、智能门禁、图像分类、增强现实等多个场景，对促进物联网、智慧城市等前沿科技的发展起着至关重要的作用。
YOLOv3，作为YOLO系列的最新版本，以其快速、准确的目标检测能力著称，能够在单个神经网络中同时进行对象分类和定位，特别适合实时应用需求。该模型通过优化的网络结构设计，实现了速度与精度的较好平衡，是目前广泛应用的目标检测模型之一。
卷积神经网络（CNN，Convolutional Neural Networks）作为深度学习领域的重要组成部分，尤其在图像识别和处理方面展现出了卓越的能力。在人脸识别任务中，CNN能够学习并提取人脸特征，实现高精度的人脸检测与识别。结合特定的人脸识别模型，如FaceNet等，可以在移动平台上实现快速且准确的人脸验证或识别功能，这对于安全认证、个性化服务等领域有着直接的应用价值。
本项目通过Qt框架整合OpenCV与YOLOv3及CNN模型，不仅展示了如何在Android平台上高效实现复杂计算机视觉算法的集成，还为开发者提供了一个实践案例，探索了移动设备上高性能目标检测与人脸识别技术的可行性。这不仅促进了人工智能技术在移动应用中的普及与深化，也为未来的智能安防、健康管理、娱乐互动等应用场景提供了坚实的技术基础。项目的跨平台特性也为软件的广泛部署与应用提供了便利，进一步推动了AI技术与移动互联网的融合创新。
Qt是一个由Qt Company（前身为Trolltech，后被诺基亚收购，再后由Digia接手，并最终成立Qt公司）开发的跨平台C&#43;&#43;图形用户界面应用程序开发框架。它自1991年起由Haavard Nord和Eirik Chambe-Eng创建，支持多个主流平台的应用程序开发，包括Android、Windows、iOS和Linux等。Qt框架提供了丰富的功能和工具，涵盖图形用户界面设计、数据库操作、网络编程、文件处理等多个方面，并通过其广泛的类库加速应用程序的开发过程。Qt具有良好的文档和社区支持，广泛用于桌面应用、移动应用、嵌入式系统等多种类型的应用程序开发。不仅可用于开发图形用户界面程序，还可用于非GUI程序，如控制台工具和服务器。Qt的发展历程展现了其不断适应市场需求和技术进步的能力，为开发者提供了强大的工具和平台。
本篇文章用到的全部软件工具、库的模型，以及APP都可以在这里下载（网盘）：https://pan.quark.cn/s/145a9b3f7f53
实现效果：
二、OpenCV下载 OpenCV是开源的计算机视觉、机器学习软件库，其图片处理的功能非常强大，并且速度很快。 作为目标检测功能，OpenCV里本身就自带了很多的模型，比如: 人眼检测、鼻子检测、嘴巴检测、人脸检测、人体检测、猫脸检测等等，下载完OpenCV，就能直接进行图像识别测试体验，并且OpenCV也可以直接调用YOLO的模型，精确识别各种物体，yolo v3 里自带的模型文件可以精确识别常见的很多物体: 比如： 狗、汽车、自行车、人体、书本、手机等等。
OpenCV下载地址：https://opencv.org/releases/page/3/
可以直接下载不同平台的SDK包，非常的方便。
下载下来之后。
主要需要使用的文件就在这里面。
三、YOLO目标检测算法 3.1 YOLO算法介绍 YOLO算法官网介绍：https://pjreddie.com/darknet/yolo/
You only look once (YOLO) is a state-of-the-art, real-time object detection system. On a Pascal Titan X it processes images at 30 FPS and has a mAP of 57.9% on COCO test-dev.
You Only Look Once (YOLO) 是最先进的实时目标检测系统。在 Pascal Titan X 上，它以 30 FPS 处理图像，并且在 COCO 测试开发上的 mAP 为 57.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-04T09:48:28+08:00">
    <meta property="article:modified_time" content="2024-07-04T09:48:28+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QT&#43;OpenCV在Android上实现人脸实时检测与目标检测</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、功能介绍</h2> 
<p>在当今的移动应用领域，随着技术的飞速发展和智能设备的普及，将先进的计算机视觉技术集成到移动平台，特别是Android系统中，已成为提升用户体验、拓展应用功能的关键。其中，目标检测与人脸识别作为计算机视觉领域的两大基石，广泛应用于安全监控、智能门禁、图像分类、增强现实等多个场景，对促进物联网、智慧城市等前沿科技的发展起着至关重要的作用。</p> 
<p>YOLOv3，作为YOLO系列的最新版本，以其快速、准确的目标检测能力著称，能够在单个神经网络中同时进行对象分类和定位，特别适合实时应用需求。该模型通过优化的网络结构设计，实现了速度与精度的较好平衡，是目前广泛应用的目标检测模型之一。</p> 
<p>卷积神经网络（CNN，Convolutional Neural Networks）作为深度学习领域的重要组成部分，尤其在图像识别和处理方面展现出了卓越的能力。在人脸识别任务中，CNN能够学习并提取人脸特征，实现高精度的人脸检测与识别。结合特定的人脸识别模型，如FaceNet等，可以在移动平台上实现快速且准确的人脸验证或识别功能，这对于安全认证、个性化服务等领域有着直接的应用价值。</p> 
<p>本项目通过Qt框架整合OpenCV与YOLOv3及CNN模型，不仅展示了如何在Android平台上高效实现复杂计算机视觉算法的集成，还为开发者提供了一个实践案例，探索了移动设备上高性能目标检测与人脸识别技术的可行性。这不仅促进了人工智能技术在移动应用中的普及与深化，也为未来的智能安防、健康管理、娱乐互动等应用场景提供了坚实的技术基础。项目的跨平台特性也为软件的广泛部署与应用提供了便利，进一步推动了AI技术与移动互联网的融合创新。</p> 
<p>Qt是一个由Qt Company（前身为Trolltech，后被诺基亚收购，再后由Digia接手，并最终成立Qt公司）开发的跨平台C++图形用户界面应用程序开发框架。它自1991年起由Haavard Nord和Eirik Chambe-Eng创建，支持多个主流平台的应用程序开发，包括Android、Windows、iOS和Linux等。Qt框架提供了丰富的功能和工具，涵盖图形用户界面设计、数据库操作、网络编程、文件处理等多个方面，并通过其广泛的类库加速应用程序的开发过程。Qt具有良好的文档和社区支持，广泛用于桌面应用、移动应用、嵌入式系统等多种类型的应用程序开发。不仅可用于开发图形用户界面程序，还可用于非GUI程序，如控制台工具和服务器。Qt的发展历程展现了其不断适应市场需求和技术进步的能力，为开发者提供了强大的工具和平台。</p> 
<p>本篇文章用到的全部软件工具、库的模型，以及APP都可以在这里下载（网盘）：https://pan.quark.cn/s/145a9b3f7f53</p> 
<p><strong>实现效果：</strong></p> 
<p><img src="https://images2.imgbox.com/6c/a2/FrgsDrEE_o.png" alt="image-20240606145200678"></p> 
<p><img src="https://images2.imgbox.com/70/20/DQWwpKSR_o.png" alt="image-20240606150622381"></p> 
<p><img src="https://images2.imgbox.com/4a/cd/cd89SH47_o.png" alt="image-20240606145105589"></p> 
<p><img src="https://images2.imgbox.com/3b/0e/0PRAYE7B_o.png" alt="image-20240606145123049"></p> 
<p><img src="https://images2.imgbox.com/12/e1/HAcMxkud_o.png" alt="image-20240606150706456"></p> 
<h2><a id="OpenCV_44"></a>二、OpenCV下载</h2> 
<p>OpenCV是开源的计算机视觉、机器学习软件库，其图片处理的功能非常强大，并且速度很快。 作为目标检测功能，OpenCV里本身就自带了很多的模型，比如: 人眼检测、鼻子检测、嘴巴检测、人脸检测、人体检测、猫脸检测等等，下载完OpenCV，就能直接进行图像识别测试体验，并且OpenCV也可以直接调用YOLO的模型，精确识别各种物体，yolo v3 里自带的模型文件可以精确识别常见的很多物体: 比如： 狗、汽车、自行车、人体、书本、手机等等。</p> 
<p>OpenCV下载地址：https://opencv.org/releases/page/3/</p> 
<p>可以直接下载不同平台的SDK包，非常的方便。</p> 
<p><img src="https://images2.imgbox.com/b4/f6/wKIpavN2_o.png" alt="image-20240606144627835"></p> 
<p>下载下来之后。</p> 
<p><img src="https://images2.imgbox.com/43/7d/GLnXLQLH_o.png" alt="image-20240606144710509"></p> 
<p>主要需要使用的文件就在这里面。</p> 
<p><img src="https://images2.imgbox.com/d6/06/KzMww2zp_o.png" alt="image-20240606144731787"></p> 
<h2><a id="YOLO_74"></a>三、YOLO目标检测算法</h2> 
<h3><a id="31_YOLO_76"></a>3.1 YOLO算法介绍</h3> 
<p>YOLO算法官网介绍：https://pjreddie.com/darknet/yolo/</p> 
<p><img src="https://images2.imgbox.com/fc/09/DgJTEneN_o.png" alt="image-20230926160707304"></p> 
<p>You only look once (YOLO) is a state-of-the-art, real-time object detection system. On a Pascal Titan X it processes images at 30 FPS and has a mAP of 57.9% on COCO test-dev.</p> 
<p>You Only Look Once (YOLO) 是最先进的实时目标检测系统。在 Pascal Titan X 上，它以 30 FPS 处理图像，并且在 COCO 测试开发上的 mAP 为 57.9%。</p> 
<p>Comparison to Other Detectors<br> YOLOv3 is extremely fast and accurate. In mAP measured at .5 IOU YOLOv3 is on par with Focal Loss but about 4x faster. Moreover, you can easily tradeoff between speed and accuracy simply by changing the size of the model, no retraining required!</p> 
<p>与其他探测器的比较<br> YOLOv3 非常快速且准确。在 mAP 中，测量结果为 0.5 IOU YOLOv3 与 Focal Loss 相当，但速度快约 4 倍。此外，只需更改模型的大小即可轻松在速度和准确性之间进行权衡，无需重新训练！</p> 
<h3><a id="32_Linux_94"></a>3.2 Linux快速体验</h3> 
<p>在Linux下快速体验YOLO算法的目标检测（采用官方的模型）。</p> 
<p>（1）安装darknet</p> 
<pre><code class="prism language-cpp">git clone https<span class="token operator">:</span><span class="token comment">//github.com/pjreddie/darknet</span>
cd darknet
make
</code></pre> 
<p>（2）下载权重文件</p> 
<pre><code class="prism language-cpp">wget https<span class="token operator">:</span><span class="token comment">//pjreddie.com/media/files/yolov3.weights</span>
</code></pre> 
<p><code>yolov3.weights</code> 是 YOLOv3 网络训练得到的权重文件，存储了神经网络中每个层次的权重和偏置信息。</p> 
<p>在<code>cfg/</code>目录下已经包含了yolov3对应的配置文件。</p> 
<p>（3）运行detector</p> 
<pre><code class="prism language-cpp"><span class="token punctuation">.</span><span class="token operator">/</span>darknet detect cfg<span class="token operator">/</span>yolov3<span class="token punctuation">.</span>cfg yolov3<span class="token punctuation">.</span>weights data<span class="token operator">/</span>dog<span class="token punctuation">.</span>jpg
</code></pre> 
<p>运行输出的信息：</p> 
<pre><code class="prism language-cpp">layer     filters    size              input                output
    <span class="token number">0</span> conv     <span class="token number">32</span>  <span class="token number">3</span> x <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">1</span>   <span class="token number">416</span> x <span class="token number">416</span> x   <span class="token number">3</span>   <span class="token operator">-&gt;</span>   <span class="token number">416</span> x <span class="token number">416</span> x  <span class="token number">32</span>  <span class="token number">0.299</span> BFLOPs
    <span class="token number">1</span> conv     <span class="token number">64</span>  <span class="token number">3</span> x <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">2</span>   <span class="token number">416</span> x <span class="token number">416</span> x  <span class="token number">32</span>   <span class="token operator">-&gt;</span>   <span class="token number">208</span> x <span class="token number">208</span> x  <span class="token number">64</span>  <span class="token number">1.595</span> BFLOPs
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token number">105</span> conv    <span class="token number">255</span>  <span class="token number">1</span> x <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">1</span>    <span class="token number">52</span> x  <span class="token number">52</span> x <span class="token number">256</span>   <span class="token operator">-&gt;</span>    <span class="token number">52</span> x  <span class="token number">52</span> x <span class="token number">255</span>  <span class="token number">0.353</span> BFLOPs
  <span class="token number">106</span> detection
truth_thresh<span class="token operator">:</span> Using <span class="token keyword">default</span> <span class="token char">'1.000000'</span>
Loading weights from yolov3<span class="token punctuation">.</span>weights<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>Done<span class="token operator">!</span>
data<span class="token operator">/</span>dog<span class="token punctuation">.</span>jpg<span class="token operator">:</span> Predicted in <span class="token number">0.029329</span> seconds<span class="token punctuation">.</span>
dog<span class="token operator">:</span> <span class="token number">99</span><span class="token operator">%</span>
truck<span class="token operator">:</span> <span class="token number">93</span><span class="token operator">%</span>
bicycle<span class="token operator">:</span> <span class="token number">99</span><span class="token operator">%</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/21/L0EdUdgn_o.png" alt="image-20230926161227491"></p> 
<h3><a id="33__145"></a>3.3 官方模型支持识别的目标类型</h3> 
<pre><code class="prism language-cpp">person
bicycle
car
motorbike
aeroplane
bus
train
truck
boat
traffic light
fire hydrant
stop sign
parking meter
bench
bird
cat
dog
horse
sheep
cow
elephant
bear
zebra
giraffe
backpack
umbrella
handbag
tie
suitcase
frisbee
skis
snowboard
sports ball
kite
baseball bat
baseball glove
skateboard
surfboard
tennis racket
bottle
wine glass
cup
fork
knife
spoon
bowl
banana
apple
sandwich
orange
broccoli
carrot
hot dog
pizza
donut
cake
chair
sofa
pottedplant
bed
diningtable
toilet
tvmonitor
laptop
mouse
remote
keyboard
cell phone
microwave
oven
toaster
sink
refrigerator
book
clock
vase
scissors
teddy bear
hair drier
toothbrush
</code></pre> 
<h2><a id="Qt_Android_232"></a>四、Qt Android工程配置</h2> 
<h3><a id="41_Qt_Android_234"></a>4.1 搭建Qt Android的开发环境</h3> 
<p>我用的开发环境是：QT5.12.6 ，下面是Android开发环境的配置。</p> 
<p><img src="https://images2.imgbox.com/09/92/Q4RnCtvI_o.png" alt="image-20240606145454256"></p> 
<h3><a id="42__242"></a>4.2 编译选择的编译器</h3> 
<p><img src="https://images2.imgbox.com/f5/21/T5hBezN9_o.png" alt="image-20240606145551904"></p> 
<h3><a id="43_pro_248"></a>4.3 pro工程文件配置（很重要）</h3> 
<p>下面是介绍OpenCV的库引用如何配置。 分别贴出来了Windows、Android的32位和64位的库引用配置办法。</p> 
<p><img src="https://images2.imgbox.com/77/f4/jstKvJsB_o.png" alt="image-20240606145700776"></p> 
<p>下面是Windows、Android的32位和64位的库引用配置代码。</p> 
<pre><code class="prism language-cpp"># 根据操作系统选择编译器
win32 <span class="token punctuation">{<!-- --></span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Windows下的编译器选择</span></span>
    # <span class="token number">32</span>位
    <span class="token function">equals</span><span class="token punctuation">(</span>QT_ARCH<span class="token punctuation">,</span> x86<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        # <span class="token number">32</span>位编译器设置
        <span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"&lt;----选择 windows电脑 32 编译器-----&gt;"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    # <span class="token number">64</span>位
    <span class="token function">equals</span><span class="token punctuation">(</span>QT_ARCH<span class="token punctuation">,</span> x86_64<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        # <span class="token number">64</span>位编译器设置
        <span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"&lt;----选择 windows电脑 64 编译器-----&gt;"</span><span class="token punctuation">)</span>

#添加opencv头文件的路径，需要根据自己的头文件路径进行修改
INCLUDEPATH <span class="token operator">+=</span> C<span class="token operator">:</span><span class="token operator">/</span>opencv_4<span class="token punctuation">.</span>x<span class="token operator">/</span>opencv<span class="token operator">/</span>build<span class="token operator">/</span>include
INCLUDEPATH <span class="token operator">+=</span> C<span class="token operator">:</span><span class="token operator">/</span>opencv_4<span class="token punctuation">.</span>x<span class="token operator">/</span>opencv<span class="token operator">/</span>build<span class="token operator">/</span>include<span class="token operator">/</span>opencv
INCLUDEPATH <span class="token operator">+=</span> C<span class="token operator">:</span><span class="token operator">/</span>opencv_4<span class="token punctuation">.</span>x<span class="token operator">/</span>opencv<span class="token operator">/</span>build<span class="token operator">/</span>include<span class="token operator">/</span>opencv2

LIBS <span class="token operator">+=</span> <span class="token operator">-</span>LC<span class="token operator">:</span><span class="token operator">/</span>opencv_4<span class="token punctuation">.</span>x<span class="token operator">/</span>opencv<span class="token operator">/</span>build<span class="token operator">/</span>x64<span class="token operator">/</span>vc15<span class="token operator">/</span>lib\
          <span class="token operator">-</span>lopencv_world430

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">Android环境配置</span></span>
android <span class="token punctuation">{<!-- --></span>
<span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"&lt;----选择 Android  编译器-----&gt;"</span><span class="token punctuation">)</span>
<span class="token function">contains</span><span class="token punctuation">(</span>ANDROID_TARGET_ARCH<span class="token punctuation">,</span>armeabi<span class="token operator">-</span>v7a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"armeabi-v7a"</span><span class="token punctuation">)</span>

ANDROID_OPENCV <span class="token operator">=</span> C<span class="token operator">:</span><span class="token operator">/</span>Users<span class="token operator">/</span><span class="token number">11266</span><span class="token operator">/</span>Downloads<span class="token operator">/</span>opencv<span class="token operator">-</span><span class="token number">4.3</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>android<span class="token operator">-</span>sdk<span class="token operator">/</span>OpenCV<span class="token operator">-</span>android<span class="token operator">-</span>sdk<span class="token operator">/</span>sdk<span class="token operator">/</span>native

ANDROID_EXTRA_LIBS <span class="token operator">=</span> $$ANDROID_OPENCV<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_java4<span class="token punctuation">.</span>so

INCLUDEPATH <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>jni<span class="token operator">/</span>include<span class="token operator">/</span>opencv2
INCLUDEPATH <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>jni<span class="token operator">/</span>include

LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_java4<span class="token punctuation">.</span>so
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_core<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_calib3d<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_dnn<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_features2d<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_flann<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_highgui<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_imgcodecs<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_imgproc<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_ml<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_objdetect<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_photo<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_stitching<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_video<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libopencv_videoio<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libcpufeatures<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libIlmImf<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibjasper<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibjpeg<span class="token operator">-</span>turbo<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibpng<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibprotobuf<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibtiff<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>liblibwebp<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libquirc<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libtbb<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>armeabi<span class="token operator">-</span>v7a<span class="token operator">/</span>libtegra_hal<span class="token punctuation">.</span>a

<span class="token punctuation">}</span>

<span class="token function">contains</span><span class="token punctuation">(</span>ANDROID_TARGET_ARCH<span class="token punctuation">,</span>arm64<span class="token operator">-</span>v8a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">message</span><span class="token punctuation">(</span><span class="token string">"arm64-v8a"</span><span class="token punctuation">)</span>

ANDROID_OPENCV <span class="token operator">=</span> C<span class="token operator">:</span><span class="token operator">/</span>Users<span class="token operator">/</span><span class="token number">11266</span><span class="token operator">/</span>Downloads<span class="token operator">/</span>opencv<span class="token operator">-</span><span class="token number">4.3</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">-</span>android<span class="token operator">-</span>sdk<span class="token operator">/</span>OpenCV<span class="token operator">-</span>android<span class="token operator">-</span>sdk<span class="token operator">/</span>sdk<span class="token operator">/</span>native

ANDROID_EXTRA_LIBS <span class="token operator">=</span> $$ANDROID_OPENCV<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_java4<span class="token punctuation">.</span>so


INCLUDEPATH <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>jni<span class="token operator">/</span>include<span class="token operator">/</span>opencv2
INCLUDEPATH <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>jni<span class="token operator">/</span>include

LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_java4<span class="token punctuation">.</span>so
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_core<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_calib3d<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_dnn<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_features2d<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_flann<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_highgui<span class="token punctuation">.</span>a
<span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8aa<span class="token operator">/</span>libopencv_imgcodecs<span class="token punctuation">.</span>a</span></span>
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_imgproc<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_ml<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_objdetect<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_photo<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_stitching<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_video<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span>staticlibs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libopencv_videoio<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libcpufeatures<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libIlmImf<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibjasper<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibjpeg<span class="token operator">-</span>turbo<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibpng<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibprotobuf<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibtiff<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>liblibwebp<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libquirc<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libtbb<span class="token punctuation">.</span>a
LIBS <span class="token operator">+=</span> $$ANDROID_OPENCV<span class="token operator">/</span><span class="token number">3</span>rdparty<span class="token operator">/</span>libs<span class="token operator">/</span>arm64<span class="token operator">-</span>v8a<span class="token operator">/</span>libtegra_hal<span class="token punctuation">.</span>a
<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_379"></a>五、代码实现</h2> 
<h3><a id="51_C_381"></a>5.1 C++实现(人脸检测)</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>string prototxt_path <span class="token operator">=</span> <span class="token string">"D:/deploy.prototxt.txt"</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string model_path <span class="token operator">=</span> <span class="token string">"D:/res10_300x300_ssd_iter_140000_fp16.caffemodel"</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span>dnn<span class="token double-colon punctuation">::</span>Net model <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span>dnn<span class="token double-colon punctuation">::</span><span class="token function">readNetFromCaffe</span><span class="token punctuation">(</span>prototxt_path<span class="token punctuation">,</span> model_path<span class="token punctuation">)</span><span class="token punctuation">;</span>

    cv<span class="token double-colon punctuation">::</span>VideoCapture <span class="token function">capture</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 打开默认摄像头（设备号为0）</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>capture<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to open the camera."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cv<span class="token double-colon punctuation">::</span>Mat frame<span class="token punctuation">;</span>
        capture <span class="token operator">&gt;&gt;</span> frame<span class="token punctuation">;</span>  <span class="token comment">// 读取视频帧</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>frame<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">int</span> h <span class="token operator">=</span> frame<span class="token punctuation">.</span>rows<span class="token punctuation">;</span>
        <span class="token keyword">int</span> w <span class="token operator">=</span> frame<span class="token punctuation">.</span>cols<span class="token punctuation">;</span>
        cv<span class="token double-colon punctuation">::</span>Mat blob <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span>dnn<span class="token double-colon punctuation">::</span><span class="token function">blobFromImage</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">177.0</span><span class="token punctuation">,</span> <span class="token number">123.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setInput</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cv<span class="token double-colon punctuation">::</span>Mat output <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cv<span class="token double-colon punctuation">::</span>Mat <span class="token function">detectionMat</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> output<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> CV_32F<span class="token punctuation">,</span> output<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">ptr</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">float</span> font_scale <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> detectionMat<span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> confidence <span class="token operator">=</span> detectionMat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> start_x <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> start_y <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> end_x <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> end_y <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>detectionMat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">*</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
                cv<span class="token double-colon punctuation">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>start_x<span class="token punctuation">,</span> start_y<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>end_x<span class="token punctuation">,</span> end_y<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                std<span class="token double-colon punctuation">::</span>ostringstream ss<span class="token punctuation">;</span>
                ss <span class="token operator">&lt;&lt;</span> confidence <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"%"</span><span class="token punctuation">;</span>
                cv<span class="token double-colon punctuation">::</span><span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span>start_x<span class="token punctuation">,</span> start_y <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> font_scale<span class="token punctuation">,</span> cv<span class="token double-colon punctuation">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Face Detection"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">char</span> c <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 按下Esc键退出循环</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    capture<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>运行效果如下：</strong></p> 
<p><img src="https://images2.imgbox.com/34/a4/JcCALYcI_o.png" alt="image-20230920155102693"></p> 
<p><strong>代码运行解释：</strong></p> 
<p>当运行这段代码时，执行操作的步骤：</p> 
<p>（1）导入必要的OpenCV库：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
</code></pre> 
<p>（2）指定人脸检测模型的路径和配置文件的路径：</p> 
<pre><code class="prism language-cpp">std<span class="token double-colon punctuation">::</span>string prototxt_path <span class="token operator">=</span> <span class="token string">"./deploy.prototxt.txt"</span><span class="token punctuation">;</span>
std<span class="token double-colon punctuation">::</span>string model_path <span class="token operator">=</span> <span class="token string">"./res10_300x300_ssd_iter_140000_fp16.caffemodel"</span><span class="token punctuation">;</span>
</code></pre> 
<p>（3）使用<code>cv::dnn::readNetFromCaffe</code>函数读取人脸检测模型：</p> 
<pre><code class="prism language-cpp">cv<span class="token double-colon punctuation">::</span>dnn<span class="token double-colon punctuation">::</span>Net model <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span>dnn<span class="token double-colon punctuation">::</span><span class="token function">readNetFromCaffe</span><span class="token punctuation">(</span>prototxt_path<span class="token punctuation">,</span> model_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（4）创建一个<code>cv::VideoCapture</code>对象来打开默认摄像头（设备号为0）：</p> 
<pre><code class="prism language-cpp">cv<span class="token double-colon punctuation">::</span>VideoCapture <span class="token function">capture</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>（5）检查摄像头是否成功打开，如果没有成功打开则结束程序：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>capture<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Failed to open the camera."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（6）开始一个无限循环，用于处理实时视频流中的每一帧：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 读取视频帧</span>
    cv<span class="token double-colon punctuation">::</span>Mat frame<span class="token punctuation">;</span>
    capture <span class="token operator">&gt;&gt;</span> frame<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>frame<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 在帧上进行人脸检测</span>
    <span class="token comment">// ...</span>
    
    <span class="token comment">// 显示带有人脸检测结果的帧</span>
    cv<span class="token double-colon punctuation">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Face Detection"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 等待按键输入并检查是否按下了Esc键</span>
    <span class="token keyword">char</span> c <span class="token operator">=</span> cv<span class="token double-colon punctuation">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在循环中，从摄像头读取一帧视频，并将其存储在名为<code>frame</code>的<code>cv::Mat</code>对象中。如果读取的帧为空，则退出循环。 使用<code>cv::dnn::blobFromImage</code>函数将<code>frame</code>图像转换为神经网络可以处理的格式。然后，将输入转换后的图像数据到人脸检测模型，并进行前向传播计算。之后，在每一帧上遍历检测到的人脸，并对于置信度高于0.5的人脸，在图像上绘制矩形框和置信度百分比。最后，使用<code>cv::imshow</code>函数显示带有人脸检测结果的帧。</p> 
<p>通过<code>cv::waitKey</code>等待用户按键输入，并在用户按下Esc键时退出循环。对于其他按键，将继续循环处理下一帧。</p> 
<p>当循环结束后，释放摄像头资源并关闭所有窗口：</p> 
<pre><code class="prism language-cpp">capture<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cv<span class="token double-colon punctuation">::</span><span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样，代码就完成了从本地摄像头获取实时视频流并进行人脸检测的功能。</p> 
<h3><a id="52_python_527"></a>5.2 python实现(人脸检测)</h3> 
<p>下面的python代码与上面的C++代码一样，使用了OpenCV的深度学习模块（dnn）来进行人脸检测。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

prototxt_path <span class="token operator">=</span> <span class="token string">r"./deploy.prototxt.txt"</span>
model_path <span class="token operator">=</span><span class="token string">r"./res10_300x300_ssd_iter_140000_fp16.caffemodel"</span>
model <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dnn<span class="token punctuation">.</span>readNetFromCaffe<span class="token punctuation">(</span>prototxt_path<span class="token punctuation">,</span> model_path<span class="token punctuation">)</span>
image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">"2.jpg"</span><span class="token punctuation">)</span>
h<span class="token punctuation">,</span> w <span class="token operator">=</span> image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
blob <span class="token operator">=</span> cv2<span class="token punctuation">.</span>dnn<span class="token punctuation">.</span>blobFromImage<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">177.0</span><span class="token punctuation">,</span> <span class="token number">123.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>setInput<span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
output <span class="token operator">=</span> np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>model<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
font_scale <span class="token operator">=</span> <span class="token number">1.0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> output<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    confidence <span class="token operator">=</span> output<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
        box <span class="token operator">=</span> output<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>w<span class="token punctuation">,</span> h<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h<span class="token punctuation">]</span><span class="token punctuation">)</span>
        start_x<span class="token punctuation">,</span> start_y<span class="token punctuation">,</span> end_x<span class="token punctuation">,</span> end_y <span class="token operator">=</span> box<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span>start_x<span class="token punctuation">,</span> start_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>end_x<span class="token punctuation">,</span> end_y<span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>confidence<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span>start_x<span class="token punctuation">,</span> start_y<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> font_scale<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">"beauty_detected.jpg"</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span>
</code></pre> 
<p><strong>代码功能流程解释:</strong></p> 
<p>（1）导入必要的库和模型：</p> 
<ul><li>导入cv2和numpy库，用于图像处理和数组操作。</li><li>设置人脸检测模型的路径。</li></ul> 
<p>（2）读取和预处理图像：</p> 
<ul><li>使用cv2.imread函数读取图像文件。</li><li>获取图像的高度和宽度（h, w）。</li><li>使用cv2.dnn.blobFromImage函数将图像转换为一个4维blob，这是深度学习模型输入的格式。</li></ul> 
<p>（3）加载模型并进行前向推理：</p> 
<ul><li>使用cv2.dnn.readNetFromCaffe函数加载人脸检测模型。</li><li>将预处理后的图像数据作为模型的输入。</li><li>使用模型的forward方法进行前向推理，得到输出结果。</li></ul> 
<p>（4）处理模型输出：</p> 
<ul><li>将输出结果转换为numpy数组，并使用np.squeeze函数去除维度为1的维度。</li><li>遍历输出结果的每个检测框。</li><li>对于置信度大于0.5的检测框： 
  <ul><li>计算检测框在原始图像中的坐标。</li><li>使用cv2.rectangle函数绘制人脸框。</li><li>使用cv2.putText函数在人脸框上方显示置信度百分比。</li></ul> </li></ul> 
<p>（5）显示和保存结果：</p> 
<ul><li>使用cv2.imshow函数显示处理后的图像。</li><li>使用cv2.waitKey函数等待键盘输入。</li><li>如果按下任意键，则使用cv2.imwrite函数保存结果图像。</li></ul> 
<h3><a id="53__594"></a>5.3 目标检测示例代码(摄像头实时画面检测)</h3> 
<p>下面这份代码采用OpenCV打开摄像头，实时读取摄像头画面，调用YOLOV3模型，完成目标检测。</p> 
<p>模型采用的是官方训练的模型，可以检测80种目标物体。</p> 
<p><strong>完整的代码如下：</strong></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/dnn.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> cv<span class="token double-colon punctuation">::</span>dnn<span class="token punctuation">;</span>

String yolo_cfg <span class="token operator">=</span> <span class="token string">"D:/linux-share-dir/yolov3/yolov3.cfg"</span><span class="token punctuation">;</span>
String yolo_model <span class="token operator">=</span> <span class="token string">"D:/linux-share-dir/yolov3/yolov3.weights"</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">image_detection</span><span class="token punctuation">(</span>VideoCapture<span class="token operator">&amp;</span> cap<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	VideoCapture <span class="token function">cap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打开默认摄像头</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cap<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"无法打开摄像头"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">image_detection</span><span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">image_detection</span><span class="token punctuation">(</span>VideoCapture<span class="token operator">&amp;</span> cap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 加载网络模型</span>
	Net net <span class="token operator">=</span> <span class="token function">readNetFromDarknet</span><span class="token punctuation">(</span>yolo_cfg<span class="token punctuation">,</span> yolo_model<span class="token punctuation">)</span><span class="token punctuation">;</span>
	net<span class="token punctuation">.</span><span class="token function">setPreferableTarget</span><span class="token punctuation">(</span>DNN_TARGET_CPU<span class="token punctuation">)</span><span class="token punctuation">;</span>

	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> outNames <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">getUnconnectedOutLayersNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outNames<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"output layer name : %s\n"</span><span class="token punctuation">,</span> outNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> classNamesVec<span class="token punctuation">;</span>
	ifstream <span class="token function">classNamesFile</span><span class="token punctuation">(</span><span class="token string">"D:/linux-share-dir/yolov3/coco.names"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>classNamesFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string className <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>classNamesFile<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">)</span>
			classNamesVec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Mat frame<span class="token punctuation">;</span>
		cap <span class="token operator">&gt;&gt;</span> frame<span class="token punctuation">;</span> <span class="token comment">// 读取摄像头数据</span>

		Mat inputBlob <span class="token operator">=</span> <span class="token function">blobFromImage</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">255.F</span><span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">416</span><span class="token punctuation">,</span> <span class="token number">416</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		net<span class="token punctuation">.</span><span class="token function">setInput</span><span class="token punctuation">(</span>inputBlob<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 进行检测</span>
		std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span> outs<span class="token punctuation">;</span>
		net<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>outs<span class="token punctuation">,</span> outNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> layersTimings<span class="token punctuation">;</span>
		<span class="token keyword">double</span> freq <span class="token operator">=</span> <span class="token function">getTickFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
		<span class="token keyword">double</span> time <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">getPerfProfile</span><span class="token punctuation">(</span>layersTimings<span class="token punctuation">)</span> <span class="token operator">/</span> freq<span class="token punctuation">;</span>
		ostringstream ss<span class="token punctuation">;</span>
		ss <span class="token operator">&lt;&lt;</span> <span class="token string">"detection time: "</span> <span class="token operator">&lt;&lt;</span> time <span class="token operator">&lt;&lt;</span> <span class="token string">" ms"</span><span class="token punctuation">;</span>
		<span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span> boxes<span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> classIds<span class="token punctuation">;</span>
		vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> confidences<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// Network produces output blob with a shape NxC where N is a number of</span>
			<span class="token comment">// detected objects and C is a number of classes + 4 where the first 4</span>
			<span class="token comment">// numbers are [center_x, center_y, width, height]</span>
			<span class="token keyword">float</span><span class="token operator">*</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span>outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">,</span> data <span class="token operator">+=</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cols<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Mat scores <span class="token operator">=</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">colRange</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Point classIdPoint<span class="token punctuation">;</span>
				<span class="token keyword">double</span> confidence<span class="token punctuation">;</span>
				<span class="token function">minMaxLoc</span><span class="token punctuation">(</span>scores<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>confidence<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>classIdPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">int</span> centerX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> centerY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> left <span class="token operator">=</span> centerX <span class="token operator">-</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
					<span class="token keyword">int</span> top <span class="token operator">=</span> centerY <span class="token operator">-</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

					classIds<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>classIdPoint<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
					confidences<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>confidence<span class="token punctuation">)</span><span class="token punctuation">;</span>
					boxes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
		<span class="token function">NMSBoxes</span><span class="token punctuation">(</span>boxes<span class="token punctuation">,</span> confidences<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> idx <span class="token operator">=</span> indices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			Rect box <span class="token operator">=</span> boxes<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
			String className <span class="token operator">=</span> classNamesVec<span class="token punctuation">[</span>classIds<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> className<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> box<span class="token punctuation">.</span><span class="token function">tl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> box<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"YOLOv3-Detections"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token comment">// 按下Esc键退出程序</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>示例1：</strong></p> 
<p><img src="https://images2.imgbox.com/06/31/UOHfA8to_o.png" alt="image-20230926163827664"></p> 
<p><img src="https://images2.imgbox.com/a4/21/kaYbuqho_o.png" alt="image-20230926163126370"></p> 
<h3><a id="54__736"></a>5.4 目标检测示例代码(加载图片检测)</h3> 
<p>下面这份代码采用OpenCV加载本地磁盘的一张图片，调用YOLOV3模型，完成目标检测。</p> 
<p>模型采用的是官方训练的模型，可以检测80种目标物体。</p> 
<p><strong>完整的代码如下：</strong></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/dnn.hpp&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fstream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> cv<span class="token double-colon punctuation">::</span>dnn<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">image_detection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


String yolo_cfg <span class="token operator">=</span> <span class="token string">"D:/linux-share-dir/yolov3/yolov3.cfg"</span><span class="token punctuation">;</span>
String yolo_model <span class="token operator">=</span> <span class="token string">"D:/linux-share-dir/yolov3/yolov3.weights"</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">image_detection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">image_detection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//加载网络模型</span>
	Net net <span class="token operator">=</span> <span class="token function">readNetFromDarknet</span><span class="token punctuation">(</span>yolo_cfg<span class="token punctuation">,</span> yolo_model<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//net.setPreferableBackend(DNN_BACKEND_INFERENCE_ENGINE);</span>
	net<span class="token punctuation">.</span><span class="token function">setPreferableTarget</span><span class="token punctuation">(</span>DNN_TARGET_CPU<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> outNames <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">getUnconnectedOutLayersNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outNames<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"output layer name : %s\n"</span><span class="token punctuation">,</span> outNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	vector<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> classNamesVec<span class="token punctuation">;</span>
	ifstream <span class="token function">classNamesFile</span><span class="token punctuation">(</span><span class="token string">"D:/linux-share-dir/yolov3/coco.names"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>classNamesFile<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string className <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>classNamesFile<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">)</span>
			classNamesVec<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 加载图像 </span>
	Mat frame <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"D:/1.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Mat inputBlob <span class="token operator">=</span> <span class="token function">blobFromImage</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">255.F</span><span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">416</span><span class="token punctuation">,</span> <span class="token number">416</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	net<span class="token punctuation">.</span><span class="token function">setInput</span><span class="token punctuation">(</span>inputBlob<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 检测</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Mat<span class="token operator">&gt;</span> outs<span class="token punctuation">;</span>
	net<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>outs<span class="token punctuation">,</span> outNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> layersTimings<span class="token punctuation">;</span>
	<span class="token keyword">double</span> freq <span class="token operator">=</span> <span class="token function">getTickFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
	<span class="token keyword">double</span> time <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">getPerfProfile</span><span class="token punctuation">(</span>layersTimings<span class="token punctuation">)</span> <span class="token operator">/</span> freq<span class="token punctuation">;</span>
	ostringstream ss<span class="token punctuation">;</span>
	ss <span class="token operator">&lt;&lt;</span> <span class="token string">"detection time: "</span> <span class="token operator">&lt;&lt;</span> time <span class="token operator">&lt;&lt;</span> <span class="token string">" ms"</span><span class="token punctuation">;</span>
	<span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span> boxes<span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> classIds<span class="token punctuation">;</span>
	vector<span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span> confidences<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> outs<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// Network produces output blob with a shape NxC where N is a number of</span>
		<span class="token comment">// detected objects and C is a number of classes + 4 where the first 4</span>
		<span class="token comment">// numbers are [center_x, center_y, width, height]</span>
		<span class="token keyword">float</span><span class="token operator">*</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token operator">*</span><span class="token punctuation">)</span>outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rows<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">,</span> data <span class="token operator">+=</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cols<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Mat scores <span class="token operator">=</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">colRange</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> outs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
			Point classIdPoint<span class="token punctuation">;</span>
			<span class="token keyword">double</span> confidence<span class="token punctuation">;</span>
			<span class="token function">minMaxLoc</span><span class="token punctuation">(</span>scores<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>confidence<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>classIdPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">int</span> centerX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> centerY <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>cols<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> frame<span class="token punctuation">.</span>rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> left <span class="token operator">=</span> centerX <span class="token operator">-</span> width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> top <span class="token operator">=</span> centerY <span class="token operator">-</span> height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

				classIds<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>classIdPoint<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				confidences<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>confidence<span class="token punctuation">)</span><span class="token punctuation">;</span>
				boxes<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Rect</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> indices<span class="token punctuation">;</span>
	<span class="token function">NMSBoxes</span><span class="token punctuation">(</span>boxes<span class="token punctuation">,</span> confidences<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> indices<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> idx <span class="token operator">=</span> indices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		Rect box <span class="token operator">=</span> boxes<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
		String className <span class="token operator">=</span> classNamesVec<span class="token punctuation">[</span>classIds<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">putText</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> className<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> box<span class="token punctuation">.</span><span class="token function">tl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">rectangle</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> box<span class="token punctuation">,</span> <span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"YOLOv3-Detections"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试图片1：</strong></p> 
<p><img src="https://images2.imgbox.com/cd/10/rCJqNFFK_o.png" alt="image-20230926162959515"></p> 
<p><strong>测试图片2:</strong></p> 
<p><img src="https://images2.imgbox.com/17/34/l5j02PPY_o.png" alt="image-20230926162229148"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e82443c1dd7cdf41e7296382aacdc795/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入了解Linux中的udhcpc：动态主机配置协议客户端</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dd969638181c67d919113c1d8abb1428/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华为HCIP Datacom H12-821 卷25</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>