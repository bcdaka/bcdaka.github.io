<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>毕业设计 基于大数据B站数据分析项目 情感分析 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8c0a8313e10ed3bd5f97f709446aad9b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="毕业设计 基于大数据B站数据分析项目 情感分析">
  <meta property="og:description" content="文章目录 0 数据分析目标1 B站整体视频数据分析1.1 数据预处理1.2 数据可视化1.3 分析结果 2 单一视频分析2.1 数据预处理2.2 数据清洗2.3 数据可视化 3 文本挖掘（NLP）3.1 情感分析 6 最后 0 数据分析目标 今天向大家介绍如何使用大数据技术，对B站的视频数据进行分析，得到可视化结果。
这里学长分为两个部分描述：
1 对B站整体视频进行数据分析2 对B站的具体视频进行弹幕情感分析 🧿 选题指导, 项目分享：见文末
1 B站整体视频数据分析 分析方向：首先从总体情况进行分析，之后分析综合排名top100的视频类别。
总体情况部分包括：
各分区播放量情况。各区三连（硬币、收藏、点赞）情况。弹幕、评论、转发情况。绘制综合词云图，查看关键词汇。 综合排名top100部分包括：
5. top100类别占比。
6. top100播放量情况。
7. 硬币、收藏、点赞平均人数分布。
8. 各分区平均评论、弹幕、转发量情况。
1.1 数据预处理 这里主要是进行查看数据信息、空值、重复值以及数据类型，但由于数据很完整这里不再做过多操作。
对数据进行拆分、聚合，方便之后各项分析，由于“区类别”列中的“全站”是各分类中排名靠前的视频，会出现重复数据，因此对其进行去除。
df.info() df.isnull().count() df.nunique().count() df.dtypes #剔除全区排名 df_nall=df.loc[df[&#39;区类别&#39;]!=&#39;全站&#39;] df_nall[&#39;区类别&#39;].value_counts() #按分数进行排序asc df_top100 = df_nall.sort_values(by=&#39;分数&#39;,ascending=False)[:100] df_type = df_nall.drop([&#39;作者&#39;,&#39;视频编号&#39;,&#39;标签名称&#39;,&#39;视频名称&#39;,&#39;排名&#39;],axis=1) gp_type = df_type.groupby(&#39;区类别&#39;).sum().astype(&#39;int&#39;) type_all = gp_type.index.tolist() 1.2 数据可视化 各分区播放情况
play = [round(i/100000000,2) for i in gp_type[&#39;播放次数&#39;].">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-25T12:19:41+08:00">
    <meta property="article:modified_time" content="2024-06-25T12:19:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">毕业设计 基于大数据B站数据分析项目 情感分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__4" rel="nofollow">0 数据分析目标</a></li><li><a href="#1_B_20" rel="nofollow">1 B站整体视频数据分析</a></li><li><ul><li><a href="#11__37" rel="nofollow">1.1 数据预处理</a></li><li><a href="#12__57" rel="nofollow">1.2 数据可视化</a></li><li><a href="#13__213" rel="nofollow">1.3 分析结果</a></li></ul> 
  </li><li><a href="#2__220" rel="nofollow">2 单一视频分析</a></li><li><ul><li><a href="#21__222" rel="nofollow">2.1 数据预处理</a></li><li><a href="#22__318" rel="nofollow">2.2 数据清洗</a></li><li><a href="#23__462" rel="nofollow">2.3 数据可视化</a></li></ul> 
  </li><li><a href="#3_NLP_474" rel="nofollow">3 文本挖掘（NLP）</a></li><li><ul><li><a href="#31__476" rel="nofollow">3.1 情感分析</a></li></ul> 
  </li><li><a href="#6__657" rel="nofollow">6 最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__4"></a>0 数据分析目标</h2> 
<p>今天向大家介绍如何使用大数据技术，对B站的视频数据进行分析，得到可视化结果。</p> 
<p>这里学长分为两个部分描述：</p> 
<ul><li>1 对B站整体视频进行数据分析</li><li>2 对B站的具体视频进行弹幕情感分析</li></ul> 
<p><img src="https://images2.imgbox.com/d0/cb/kXTsWXUd_o.png" alt="在这里插入图片描述"></p> 
<p>🧿 <strong>选题指导, 项目分享：见文末</strong></p> 
<br> 
<h2><a id="1_B_20"></a>1 B站整体视频数据分析</h2> 
<p><strong>分析方向：首先从总体情况进行分析，之后分析综合排名top100的视频类别。</strong></p> 
<p><strong>总体情况部分包括：</strong></p> 
<ol><li>各分区播放量情况。</li><li>各区三连（硬币、收藏、点赞）情况。</li><li>弹幕、评论、转发情况。</li><li>绘制综合词云图，查看关键词汇。</li></ol> 
<p><strong>综合排名top100部分包括：</strong><br> 5. top100类别占比。<br> 6. top100播放量情况。<br> 7. 硬币、收藏、点赞平均人数分布。<br> 8. 各分区平均评论、弹幕、转发量情况。</p> 
<h3><a id="11__37"></a>1.1 数据预处理</h3> 
<p>这里主要是进行查看数据信息、空值、重复值以及数据类型，但由于数据很完整这里不再做过多操作。</p> 
<p>对数据进行拆分、聚合，方便之后各项分析，由于“区类别”列中的“全站”是各分类中排名靠前的视频，会出现重复数据，因此对其进行去除。</p> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>nunique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
df<span class="token punctuation">.</span>dtypes
<span class="token comment">#剔除全区排名</span>
df_nall<span class="token operator">=</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'区类别'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string">'全站'</span><span class="token punctuation">]</span>
df_nall<span class="token punctuation">[</span><span class="token string">'区类别'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#按分数进行排序asc</span>
df_top100 <span class="token operator">=</span> df_nall<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'分数'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">]</span>
df_type <span class="token operator">=</span> df_nall<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'作者'</span><span class="token punctuation">,</span><span class="token string">'视频编号'</span><span class="token punctuation">,</span><span class="token string">'标签名称'</span><span class="token punctuation">,</span><span class="token string">'视频名称'</span><span class="token punctuation">,</span><span class="token string">'排名'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
gp_type <span class="token operator">=</span> df_type<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'区类别'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>
type_all <span class="token operator">=</span> gp_type<span class="token punctuation">.</span>index<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="12__57"></a>1.2 数据可视化</h3> 
<p><strong>各分区播放情况</strong></p> 
<pre><code class="prism language-python">play <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'播放次数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># bar = (Bar()</span>
<span class="token comment">#             .add_xaxis(type_all)</span>
<span class="token comment">#             .add_yaxis("", play)</span>
<span class="token comment">#             .set_global_opts(</span>
<span class="token comment">#             title_opts=opts.TitleOpts(title="各分区播放量情况"),</span>
<span class="token comment">#             yaxis_opts=opts.AxisOpts(name="次/亿"),</span>
<span class="token comment">#             xaxis_opts=opts.AxisOpts(name="分区",axislabel_opts={"rotate":45})</span>
<span class="token comment">#         )</span>
<span class="token comment">#     )</span>
<span class="token comment"># bar.render_notebook()</span>

pie <span class="token operator">=</span> <span class="token punctuation">(</span>
    Pie<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add<span class="token punctuation">(</span>
        <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>type_all<span class="token punctuation">,</span> 
                              play<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        radius<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"40%"</span><span class="token punctuation">,</span> <span class="token string">"75%"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
        title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"各分区播放量情况  单位：亿次"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        legend_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LegendOpts<span class="token punctuation">(</span>
            orient<span class="token operator">=</span><span class="token string">"vertical"</span><span class="token punctuation">,</span> pos_top<span class="token operator">=</span><span class="token string">"15%"</span><span class="token punctuation">,</span> pos_left<span class="token operator">=</span><span class="token string">"2%"</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>formatter<span class="token operator">=</span><span class="token string">"{b}: {c}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
pie<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/36/eVuD1bFP_o.png" alt="在这里插入图片描述"><br> 播放量排名前三的分别是生活类、动画类、鬼畜类。其中动画类和鬼畜类，这两个是B站的特色。<br> 第三、四位是音乐类和科技类。</p> 
<p><strong>各区三连量情况可视化</strong></p> 
<pre><code class="prism language-python">coin_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'硬币数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
like_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'点赞数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
favourite_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'喜欢人数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">bar_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Bar<span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token punctuation">(</span>
        Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>type_all<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"硬币"</span><span class="token punctuation">,</span> coin_all<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"点赞"</span><span class="token punctuation">,</span> like_all<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"收藏"</span><span class="token punctuation">,</span> favourite_all<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"各分区三连情况"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        yaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"次/百万"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"分区"</span><span class="token punctuation">,</span>
                                                 axislabel_opts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"rotate"</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
        
bar_base<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/25/78/nKRaHApW_o.png" alt="在这里插入图片描述"></p> 
<p>虽然生活类投币和点赞数依然是不可撼动的，但是收藏数却排在动画之后，科技类收藏升至第四位。</p> 
<p><strong>弹幕、评论、三联情况</strong></p> 
<pre><code class="prism language-python">danmaku_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'弹幕数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
reply_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
share_all <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">round</span><span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> gp_type<span class="token punctuation">[</span><span class="token string">'转发数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

line <span class="token operator">=</span> <span class="token punctuation">(</span>
        Line<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>type_all<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"弹幕"</span><span class="token punctuation">,</span> danmaku_all<span class="token punctuation">,</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"评论"</span><span class="token punctuation">,</span> reply_all<span class="token punctuation">,</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"转发"</span><span class="token punctuation">,</span> share_all<span class="token punctuation">,</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
            title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"弹幕、评论、转发情况"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            tooltip_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TooltipOpts<span class="token punctuation">(</span>trigger<span class="token operator">=</span><span class="token string">"axis"</span><span class="token punctuation">,</span> axis_pointer_type<span class="token operator">=</span><span class="token string">"cross"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            yaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"人数 单位：十万"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            xaxis_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>AxisOpts<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"时间(日)"</span><span class="token punctuation">,</span>axislabel_opts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"rotate"</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
line<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/65/a5/RtGf0Y0Z_o.png" alt="在这里插入图片描述"></p> 
<p><strong>B站搜索词云图</strong></p> 
<pre><code class="prism language-python">tag_list<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>df_nall<span class="token punctuation">[</span><span class="token string">'标签名称'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
tags_count<span class="token operator">=</span>pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>tag_list<span class="token punctuation">)</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

wordcloud <span class="token operator">=</span> <span class="token punctuation">(</span>
    WordCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span>
         <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>tags_count<span class="token punctuation">.</span>index<span class="token punctuation">,</span>tags_count<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
         word_size_range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"热门标签"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
wordcloud<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/72/73/V64DqP9r_o.png" alt="在这里插入图片描述"></p> 
<p><strong>硬币、收藏、点赞平均人数分布</strong></p> 
<pre><code class="prism language-python">gp_triple_quality <span class="token operator">=</span> df_top100<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'区类别'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'硬币数'</span><span class="token punctuation">,</span><span class="token string">'喜欢人数'</span><span class="token punctuation">,</span><span class="token string">'点赞数'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>
gp_index <span class="token operator">=</span> gp_triple_quality<span class="token punctuation">.</span>index<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
gp_coin <span class="token operator">=</span> gp_triple_quality<span class="token punctuation">[</span><span class="token string">'硬币数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
gp_favorite <span class="token operator">=</span> gp_triple_quality<span class="token punctuation">[</span><span class="token string">'喜欢人数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
gp_like <span class="token operator">=</span> gp_triple_quality<span class="token punctuation">[</span><span class="token string">'点赞数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
max_num <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>gp_triple_quality<span class="token punctuation">.</span>values<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">radar_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Radar<span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token punctuation">(</span>
        Radar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add_schema<span class="token punctuation">(</span>
            schema<span class="token operator">=</span><span class="token punctuation">[</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                opts<span class="token punctuation">.</span>RadarIndicatorItem<span class="token punctuation">(</span>name<span class="token operator">=</span>gp_index<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_<span class="token operator">=</span><span class="token number">600000</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
 
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"硬币数"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>gp_coin<span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'#40e0d0'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"喜欢人数"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>gp_favorite<span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'#1e90ff'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"点赞数"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>gp_like<span class="token punctuation">]</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'#b8860b'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>is_show<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        linestyle_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LineStyleOpts<span class="token punctuation">(</span>width<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>type_<span class="token operator">=</span><span class="token string">'dotted'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"硬币、收藏、点赞平均人数分布"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span> c
radar_base<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/5a/e0/VzR0polo_o.png" alt="在这里插入图片描述"></p> 
<p>生活区的平均投币和点赞量依然高于动画区。投币、点赞、收藏最高的分区分别是：生活、影视、时尚。除了时尚区外，其他分区的收藏量均低于投币和点赞，且时尚区的收藏量是远高其点赞和投币量。</p> 
<h3><a id="13__213"></a>1.3 分析结果</h3> 
<p>从数据可视化中可以看到，播放量排名前三的分别是生活类、动画类、鬼畜类，让人诧异的是以动漫起家的B站，播放量最多的视频分类竟然是生活类节目。</p> 
<p>对比总体各分类播放情况，top100各类占比基本保持不变。生活类的平均投币和点赞量依然高于动画类。投币、点赞、收藏最高的分区分别是：生活、影视、时尚。除了时尚区外，其他分区的收藏量均低于投币和点赞，且时尚区的收藏量是远高其点赞和投币量。</p> 
<h2><a id="2__220"></a>2 单一视频分析</h2> 
<h3><a id="21__222"></a>2.1 数据预处理</h3> 
<p><strong>B站爬虫代码Demo</strong></p> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> requests<span class="token punctuation">,</span>csv<span class="token punctuation">,</span>time
<span class="token keyword">import</span> sys
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup <span class="token keyword">as</span> BS


<span class="token triple-quoted-string string">'''获取网页内容'''</span>
<span class="token keyword">def</span> <span class="token function">request_get_comment</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko)'</span><span class="token punctuation">,</span>
               <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'LIVE_BUVID=AUTO7215383727315695; stardustvideo=1; rpdid=kwxwwoiokwdoskqkmlspw; '</span>
                         <span class="token string">'fts=1540348439; sid=alz55zmj; CURRENT_FNVAL=16; _uuid=08E6859E-EB68-A6B3-5394-65272461BC6E49706infoc; '</span>
                         <span class="token string">'im_notify_type_64915445=0; UM_distinctid=1673553ca94c37-0491294d1a7e36-36664c08-144000-1673553ca956ac; '</span>
                         <span class="token string">'DedeUserID=64915445; DedeUserID__ckMd5=cc0f686b911c9f2d; SESSDATA=7af19f78%2C1545711896%2Cb812f4b1; '</span>
                         <span class="token string">'bili_jct=dc9a675a0d53e8761351d4fb763922d5; BANGUMI_SS_5852_REC=103088; '</span>
                         <span class="token string">'buvid3=AE1D37C0-553C-445A-9979-70927B6C493785514infoc; finger=edc6ecda; CURRENT_QUALITY=80; '</span>
                         <span class="token string">'bp_t_offset_64915445=199482032395569793; _dfcaptcha=44f6fd1eadc58f99515d2981faadba86'</span><span class="token punctuation">}</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BS<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>response<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    result <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> result
    all_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> result<span class="token punctuation">:</span>
        barrage_list <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span>
        barrage_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">.</span>string<span class="token punctuation">)</span>
        barrage_list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>barrage_list<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        all_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>barrage_list<span class="token punctuation">)</span>
    <span class="token keyword">return</span> all_list

<span class="token triple-quoted-string string">'''将秒转化为固定格式："时：分：秒"'''</span>
<span class="token keyword">def</span> <span class="token function">sec_to_str</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">:</span>
    second <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span>
    m<span class="token punctuation">,</span>s <span class="token operator">=</span> <span class="token builtin">divmod</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span>
    h<span class="token punctuation">,</span>m <span class="token operator">=</span> <span class="token builtin">divmod</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span>
    dtEventTime <span class="token operator">=</span> <span class="token string">"%02d:%02d:%02d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>h<span class="token punctuation">,</span>m<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dtEventTime


<span class="token triple-quoted-string string">'''主函数'''</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>setrecursionlimit<span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span>
    url_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    cid_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">16980576</span><span class="token punctuation">,</span><span class="token number">16980597</span><span class="token punctuation">,</span><span class="token number">16548432</span><span class="token punctuation">,</span><span class="token number">16483358</span><span class="token punctuation">,</span><span class="token number">16740879</span><span class="token punctuation">,</span><span class="token number">17031320</span><span class="token punctuation">,</span>
           <span class="token number">17599975</span><span class="token punctuation">,</span><span class="token number">18226264</span><span class="token punctuation">,</span><span class="token number">17894824</span><span class="token punctuation">,</span><span class="token number">18231028</span><span class="token punctuation">,</span><span class="token number">18491877</span><span class="token punctuation">,</span><span class="token number">18780374</span><span class="token punctuation">]</span>

    tableheader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'弹幕出现时间'</span><span class="token punctuation">,</span> <span class="token string">'弹幕格式'</span><span class="token punctuation">,</span> <span class="token string">'弹幕字体'</span><span class="token punctuation">,</span> <span class="token string">'弹幕颜色'</span><span class="token punctuation">,</span> <span class="token string">'弹幕时间戳'</span><span class="token punctuation">,</span>
                        <span class="token string">'弹幕池'</span><span class="token punctuation">,</span><span class="token string">'用户ID'</span><span class="token punctuation">,</span><span class="token string">'rowID'</span><span class="token punctuation">,</span><span class="token string">'弹幕信息'</span><span class="token punctuation">]</span>

    <span class="token triple-quoted-string string">'''最新弹幕文件'''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">"https://comment.bilibili.com/%d.xml"</span> <span class="token operator">%</span> cid_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        url_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        file_name <span class="token operator">=</span> <span class="token string">"now{}.csv"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fd<span class="token punctuation">:</span>
            comment <span class="token operator">=</span> request_get_comment<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
            <span class="token comment"># writer.writerow(tableheader)</span>
            <span class="token keyword">if</span> comment<span class="token punctuation">:</span>
                <span class="token keyword">for</span> row <span class="token keyword">in</span> comment<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
                    <span class="token comment">#writer.writerow(row)</span>
            <span class="token keyword">del</span> comment

    <span class="token triple-quoted-string string">'''按照集数，取出弹幕链接，进行爬虫，获取弹幕记录，并保存到csv文件'''</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        file_name <span class="token operator">=</span> <span class="token string">"d{}.csv"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> date <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                barrage_url <span class="token operator">=</span> first_barrage_url<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cid_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"%02d"</span> <span class="token operator">%</span> j<span class="token punctuation">,</span><span class="token string">"%02d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> date <span class="token operator">*</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span>newline<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fd <span class="token punctuation">:</span>
                    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
                    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>tableheader<span class="token punctuation">)</span>
                    final_list <span class="token operator">=</span> request_get_comment<span class="token punctuation">(</span>barrage_url<span class="token punctuation">)</span>

                    <span class="token keyword">if</span> final_list<span class="token punctuation">:</span>
                        <span class="token keyword">for</span> row <span class="token keyword">in</span> final_list<span class="token punctuation">:</span>
                            writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
                    <span class="token keyword">del</span> <span class="token punctuation">(</span>final_list<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="22__318"></a>2.2 数据清洗</h3> 
<p><strong>导入数据分析库</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#数据处理库</span>

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">import</span> glob

<span class="token keyword">import</span> re

<span class="token keyword">import</span> jieba

<span class="token comment">#可视化库</span>

<span class="token keyword">import</span> stylecloud

<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns

<span class="token operator">%</span>matplotlib inline

<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">from</span> pyecharts <span class="token keyword">import</span> options <span class="token keyword">as</span> opts

<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> ThemeType 

<span class="token keyword">from</span> IPython<span class="token punctuation">.</span>display <span class="token keyword">import</span> Image

<span class="token comment">#文本挖掘库</span>

<span class="token keyword">from</span> snownlp <span class="token keyword">import</span> SnowNLP

<span class="token keyword">from</span> gensim <span class="token keyword">import</span> corpora<span class="token punctuation">,</span>models
</code></pre> 
<p><strong>合并弹幕数据</strong></p> 
<pre><code class="prism language-python">csv_list <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'/danmu/*.csv'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'共发现%s个CSV文件'</span><span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>csv_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'正在处理............'</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> csv_list<span class="token punctuation">:</span>

    fr <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'danmu_all.csv'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>

        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>fr<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'合并完毕！'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>重复值、缺失值等处理</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#error_bad_lines参数可忽略异常行</span>

df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"./danmu_all.csv"</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>error_bad_lines<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#选择用户名和弹幕内容列</span>

df <span class="token operator">=</span> df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#删除重复行</span>

df <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#删除存在缺失值的行</span>

df<span class="token punctuation">.</span>columns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"danmu"</span><span class="token punctuation">]</span> <span class="token comment">#对字段进行命名</span>
</code></pre> 
<p><strong>清洗后数据如下所示：</strong></p> 
<p><img src="https://images2.imgbox.com/d0/ac/5XcYxBzO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>数据去重</strong></p> 
<p>机械压缩去重即数据句内的去重，我们发现弹幕内容存在例如"啊啊啊啊啊"这种数据，而实际做情感分析时，只需要一个“啊”即可。</p> 
<p><img src="https://images2.imgbox.com/1f/c2/4TTaFvoP_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">#定义机械压缩去重函数</span>

<span class="token keyword">def</span> <span class="token function">yasuo</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

            <span class="token keyword">if</span> st<span class="token punctuation">[</span>j<span class="token punctuation">:</span>j<span class="token operator">+</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> st<span class="token punctuation">[</span>j<span class="token operator">+</span>i<span class="token punctuation">:</span>j<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>

                k <span class="token operator">=</span> j <span class="token operator">+</span> i

                <span class="token keyword">while</span> st<span class="token punctuation">[</span>k<span class="token punctuation">:</span>k<span class="token operator">+</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> st<span class="token punctuation">[</span>k<span class="token operator">+</span>i<span class="token punctuation">:</span>k<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>i<span class="token punctuation">]</span> <span class="token keyword">and</span> k<span class="token operator">&lt;</span><span class="token builtin">len</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">:</span> 

                    k <span class="token operator">=</span> k <span class="token operator">+</span> i

                st <span class="token operator">=</span> st<span class="token punctuation">[</span><span class="token punctuation">:</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> st<span class="token punctuation">[</span>k<span class="token punctuation">:</span><span class="token punctuation">]</span>   

    <span class="token keyword">return</span> st

yasuo<span class="token punctuation">(</span>st<span class="token operator">=</span><span class="token string">"啊啊啊啊啊啊啊"</span><span class="token punctuation">)</span>
</code></pre> 
<p>应用以上函数，对弹幕内容进行句内去重。</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>yasuo<span class="token punctuation">)</span>
</code></pre> 
<p><strong>特殊字符过滤</strong></p> 
<p>另外，我们还发现有些弹幕内容包含表情包、特殊符号等，这些脏数据也会对情感分析产生一定影响。</p> 
<p><img src="https://images2.imgbox.com/07/47/W71uRukg_o.png" alt="在这里插入图片描述"><br> 特殊字符直接通过正则表达式过滤，匹配出中文内容即可。</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span><span class="token string">'danmu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'danmu'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token string">r"([\u4e00-\u9fa5]+)"</span><span class="token punctuation">)</span>

df <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#纯表情直接删除</span>
</code></pre> 
<p>另外，过短的弹幕内容一般很难看出情感倾向，可以将其一并过滤。</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span><span class="token number">4</span><span class="token punctuation">]</span>

df <span class="token operator">=</span> df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="23__462"></a>2.3 数据可视化</h3> 
<p>数据可视化分析部分代码本公众号往期原创文章已多次提及，本文不做赘述。从可视化图表来看，网友对《沉默的真相》还是相当认可的，尤其对白宇塑造的正义形象江阳，提及频率远高于其他角色。</p> 
<p><strong>整体弹幕词云</strong></p> 
<p><img src="https://images2.imgbox.com/63/ff/meNcxIiQ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>主演提及</strong></p> 
<p><img src="https://images2.imgbox.com/26/fa/OKOa6CX9_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_NLP_474"></a>3 文本挖掘（NLP）</h2> 
<h3><a id="31__476"></a>3.1 情感分析</h3> 
<p>情感分析是对带有感情色彩的主观性文本进行分析、处理、归纳和推理的过程。按照处理文本的类别不同，可分为基于新闻评论的情感分析和基于产品评论的情感分析。其中，前者多用于舆情监控和信息预测，后者可帮助用户了解某一产品在大众心目中的口碑。目前常见的情感极性分析方法主要是两种：基于情感词典的方法和基于机器学习的方法。</p> 
<p>本文主要运用Python的第三方库SnowNLP对弹幕内容进行情感分析，使用方法很简单，计算出的情感score表示语义积极的概率，越接近0情感表现越消极，越接近1情感表现越积极。</p> 
<pre><code class="prism language-python">df<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>SnowNLP<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>sentiments<span class="token punctuation">)</span>

df<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">#随机筛选10个弹幕样本数据</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/93/h426PNSB_o.png" alt="在这里插入图片描述"></p> 
<p><strong>整体情感倾向</strong></p> 
<pre><code class="prism language-python">plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>  <span class="token comment"># 设置加载的字体名</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 解决保存图像是负号'-'显示为方块的问题</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#设置画布大小</span>

rate <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span>

ax <span class="token operator">=</span> sns<span class="token punctuation">.</span>distplot<span class="token punctuation">(</span>rate<span class="token punctuation">,</span>

            hist_kws<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'color'</span><span class="token punctuation">:</span><span class="token string">'green'</span><span class="token punctuation">,</span><span class="token string">'label'</span><span class="token punctuation">:</span><span class="token string">'直方图'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

            kde_kws<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'color'</span><span class="token punctuation">:</span><span class="token string">'red'</span><span class="token punctuation">,</span><span class="token string">'label'</span><span class="token punctuation">:</span><span class="token string">'密度曲线'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

            bins<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">#参数color样式为salmon，bins参数设定数据片段的数量</span>

ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"弹幕整体情感倾向  绘图：「菜J学Python」公众号"</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show
</code></pre> 
<p><img src="https://images2.imgbox.com/4d/77/cnC55h8B_o.png" alt="在这里插入图片描述"></p> 
<p><strong>观众对主演的情感倾向</strong></p> 
<pre><code class="prism language-python">mapping <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'jiangyang'</span><span class="token punctuation">:</span><span class="token string">'白宇|江阳'</span><span class="token punctuation">,</span> <span class="token string">'yanliang'</span><span class="token punctuation">:</span><span class="token string">'廖凡|严良'</span><span class="token punctuation">,</span> <span class="token string">'zhangchao'</span><span class="token punctuation">:</span><span class="token string">'宁理|张超'</span><span class="token punctuation">,</span><span class="token string">'lijing'</span><span class="token punctuation">:</span><span class="token string">'谭卓|李静'</span><span class="token punctuation">,</span> <span class="token string">'wengmeixiang'</span><span class="token punctuation">:</span><span class="token string">'李嘉欣|翁美香'</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> mapping<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    df<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'danmu'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span>value<span class="token punctuation">)</span>

average_value <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>key<span class="token punctuation">:</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>df<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> key <span class="token keyword">in</span> mapping<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>average_value<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>由各主要角色情感得分均值可知，观众对他们都表现出积极的情感。翁美香和李静的情感得分均值相对高一些，难道是男性观众偏多？江阳的情感倾向相对较低，可能是观众对作为正义化身的他惨遭各种不公而鸣不平吧。</p> 
<p><img src="https://images2.imgbox.com/3d/d5/bQes8jNf_o.png" alt="在这里插入图片描述"></p> 
<p><strong>主题分析</strong></p> 
<p>这里的主题分析主要是将弹幕情感得分划分为两类，分别为积极类（得分在0.8以上）和消极类（得分在0.3以下），然后再在各类里分别细分出5个主题，有助于挖掘出观众情感产生的原因。</p> 
<p>首先，筛选出两大类分别进行分词。</p> 
<pre><code class="prism language-python"><span class="token comment">#分词</span>

data1 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'danmu'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0.8</span><span class="token punctuation">]</span>

data2 <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'danmu'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0.3</span><span class="token punctuation">]</span>

word_cut <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#以空格隔开</span>

data1 <span class="token operator">=</span> data1<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>word_cut<span class="token punctuation">)</span>

data2 <span class="token operator">=</span> data2<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>word_cut<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>data1<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'----------------------'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

<span class="token number">123456789</span>

首先，筛选出两大类分别进行分词。

<span class="token comment">#去除停用词</span>

stop <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"/菜J学Python/stop_words.txt"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span>header<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">'tipdm'</span><span class="token punctuation">)</span>

stop <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>stop<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#print(stop)</span>

pos <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data1<span class="token punctuation">)</span>

neg <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data2<span class="token punctuation">)</span>

pos<span class="token punctuation">[</span><span class="token string">"danmu_1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span>s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

pos<span class="token punctuation">[</span><span class="token string">"danmu_pos"</span><span class="token punctuation">]</span> <span class="token operator">=</span> pos<span class="token punctuation">[</span><span class="token string">"danmu_1"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> stop<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">#print(pos["danmu_pos"])</span>

neg<span class="token punctuation">[</span><span class="token string">"danmu_1"</span><span class="token punctuation">]</span> <span class="token operator">=</span> neg<span class="token punctuation">[</span><span class="token string">"danmu"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> s<span class="token punctuation">:</span>s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

neg<span class="token punctuation">[</span><span class="token string">"danmu_neg"</span><span class="token punctuation">]</span> <span class="token operator">=</span> neg<span class="token punctuation">[</span><span class="token string">"danmu_1"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> x <span class="token keyword">if</span> i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">not</span> <span class="token keyword">in</span> stop<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>其次，对积极类弹幕进行主题分析。</p> 
<pre><code class="prism language-python"><span class="token comment">#正面主题分析</span>

pos_dict <span class="token operator">=</span> corpora<span class="token punctuation">.</span>Dictionary<span class="token punctuation">(</span>pos<span class="token punctuation">[</span><span class="token string">"danmu_pos"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#建立词典</span>

<span class="token comment">#print(pos_dict)</span>

pos_corpus <span class="token operator">=</span> <span class="token punctuation">[</span>pos_dict<span class="token punctuation">.</span>doc2bow<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> pos<span class="token punctuation">[</span><span class="token string">"danmu_pos"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#建立语料库</span>

pos_lda <span class="token operator">=</span> models<span class="token punctuation">.</span>LdaModel<span class="token punctuation">(</span>pos_corpus<span class="token punctuation">,</span>num_topics<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>id2word<span class="token operator">=</span>pos_dict<span class="token punctuation">)</span> <span class="token comment">#LDA模型训练</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正面主题分析："</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'topic'</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>pos_lda<span class="token punctuation">.</span>print_topic<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#输出每个主题</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>结果如下：</strong></p> 
<p><img src="https://images2.imgbox.com/93/6f/BHM6y6dg_o.png" alt="在这里插入图片描述"></p> 
<p>最后，对消极类弹幕进行主题分析。</p> 
<pre><code class="prism language-python"><span class="token comment">#负面主题分析</span>

neg_dict <span class="token operator">=</span> corpora<span class="token punctuation">.</span>Dictionary<span class="token punctuation">(</span>neg<span class="token punctuation">[</span><span class="token string">"danmu_neg"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#建立词典</span>

<span class="token comment">#print(neg_dict)</span>

neg_corpus <span class="token operator">=</span> <span class="token punctuation">[</span>neg_dict<span class="token punctuation">.</span>doc2bow<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> neg<span class="token punctuation">[</span><span class="token string">"danmu_neg"</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token comment">#建立语料库</span>

neg_lda <span class="token operator">=</span> models<span class="token punctuation">.</span>LdaModel<span class="token punctuation">(</span>neg_corpus<span class="token punctuation">,</span>num_topics<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>id2word<span class="token operator">=</span>neg_dict<span class="token punctuation">)</span> <span class="token comment">#LDA模型训练</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"负面面主题分析："</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'topic'</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span>neg_lda<span class="token punctuation">.</span>print_topic<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#输出每个主题</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'-'</span><span class="token operator">*</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>结果如下：</strong></p> 
<p><img src="https://images2.imgbox.com/1e/c2/PfXYY2vD_o.png" alt="在这里插入图片描述"></p> 
<p>🧿 <strong>选题指导, 项目分享：见文末</strong></p> 
<br> 
<h2><a id="6__657"></a>6 最后</h2> 
<p>**毕设帮助, 选题指导, 项目分享: ** <a href="https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md" rel="nofollow">https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7125cb812e0c48374704bb6b2acc0b6b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">毕设成品 大数据电商用户行为分析及可视化(源码&#43;论文)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/54d35a97677049374f4c232fa4c472b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构】线性表之《队列》超详细实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>