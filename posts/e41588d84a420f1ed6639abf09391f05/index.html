<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JavaDS —— AVL树 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e41588d84a420f1ed6639abf09391f05/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="JavaDS —— AVL树">
  <meta property="og:description" content="前言 本文章将介绍 AVL 树的概念，重点介绍AVL 树的插入代码是如何实现的，如果大家对 AVL 树的删除（还是和二叉搜索树一样使用的是替换删除法，然后需要判断是否进行旋转调整）感兴趣的话，可以自行去翻阅其他资料~~
概念 回顾二叉搜索树 之前我们就了解到二叉搜索树中序遍历的时候数据是有序的，这是由于二分搜索树具有以下性质：
若它的左子树不为空，则左子树上所有节点的值都小于根节点的值
若它的右子树不为空，则右子树上所有节点的值都大于根节点的值
它的左右子树也分别为二叉搜索树
最好的搜索时间复杂度为 O(logN)，但是如果插入的数据是有序或者逆序的时候，二叉搜索树就会变成一颗单分支的二叉树，搜索的时间复杂度也最差，为 O(N)
那么能不能让二叉搜索树在插入结点的时候就能始终保持平衡，也就是保持一颗饱满的二叉树形态呢？
这就是我们要学习的 AVL 树
AVL 树 两位俄罗斯的数学家G.M.Adelson-Velskii和E.M.Landis在1962年 发明了一种解决上述二叉搜索树存在的问题的方法：当向二叉搜索树中插入新结点后，如果能保证每个结点的左右子树高度之差的绝对值不超过1(需要对树中的结点进行调整)，即可降低树的高度，从而减少平均搜索长度。
一棵AVL树具有以下性质：
AVL 树同时具有二叉搜索树的性质
它的左右子树都是AVL树
左右子树高度之差(简称平衡因子)的绝对值不超过 1 (-1、0、1)，即始终保持高度平衡
如果一棵二叉搜索树是高度平衡的，它就是AVL树。
平衡因子 平衡因子就是左右子树高度之差
这里我定义平衡因子等于右子树高度减去左子树的高度
以下图为例：
A 结点右子树高度等于左子树高度，平衡因子为0
B 结点右子树高度减左子树高度等于 -1，平衡因子为 -1
C 结点右子树高度减左子树高度等于 1，平衡因子为 1
D 结点右子树高度等于左子树高度，平衡因子为0
E 结点右子树高度等于左子树高度，平衡因子为0
结点定义 和普通的树结点一样，具有左引用，右引用，数据val，以及构造方法
但是 AVL 树还要再加一个平衡因子（Balance Factor）简写为 bf
还有一个双亲结点的引用（和平衡因子一样，插入的时候要用到）
public class TreeNode { int val; TreeNode left; TreeNode right; TreeNode parent; int bf; //平衡因子 右子树高度减去左子树高度 public TreeNode(int val) { this.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-05T22:50:39+08:00">
    <meta property="article:modified_time" content="2024-08-05T22:50:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JavaDS —— AVL树</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>本文章将介绍 AVL 树的概念，<strong>重点介绍AVL 树的插入代码是如何实现的</strong>，如果大家对 AVL 树的删除（还是和二叉搜索树一样使用的是替换删除法，然后需要判断是否进行旋转调整）感兴趣的话，可以自行去翻阅其他资料~~</p> 
<h2><a id="_2"></a>概念</h2> 
<h3><a id="_3"></a>回顾二叉搜索树</h3> 
<p>之前我们就了解到二叉搜索树中序遍历的时候数据是有序的，这是由于二分搜索树具有以下性质：<br> 若它的左子树不为空，则左子树上所有节点的值都小于根节点的值<br> 若它的右子树不为空，则右子树上所有节点的值都大于根节点的值<br> 它的左右子树也分别为二叉搜索树</p> 
<p>最好的搜索时间复杂度为 O(logN)，但是如果插入的数据是有序或者逆序的时候，二叉搜索树就会变成一颗单分支的二叉树，搜索的时间复杂度也最差，为 O(N)</p> 
<p>那么能不能让二叉搜索树在插入结点的时候就能始终保持平衡，也就是保持一颗饱满的二叉树形态呢？</p> 
<p>这就是我们要学习的 AVL 树</p> 
<h3><a id="AVL__15"></a>AVL 树</h3> 
<p>两位俄罗斯的数学家G.M.Adelson-Velskii和E.M.Landis在1962年 发明了一种解决上述二叉搜索树存在的问题的方法：当向二叉搜索树中插入新结点后，如果能<strong>保证每个结点的左右子树高度之差的绝对值不超过1(需要对树中的结点进行调整)，即可降低树的高度，从而减少平均搜索长度。</strong></p> 
<p>一棵AVL树具有以下性质：<br> <strong>AVL 树同时具有二叉搜索树的性质</strong><br> <strong>它的左右子树都是AVL树</strong><br> <strong>左右子树高度之差(简称平衡因子)的绝对值不超过 1 (-1、0、1)，即始终保持高度平衡</strong><br> <img src="https://images2.imgbox.com/db/7f/lhNHhcSn_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>如果一棵二叉搜索树是高度平衡的，它就是AVL树。</strong></p> 
</blockquote> 
<h3><a id="_27"></a>平衡因子</h3> 
<p><strong>平衡因子就是左右子树高度之差</strong></p> 
<blockquote> 
 <p><strong>这里我定义平衡因子等于右子树高度减去左子树的高度</strong></p> 
</blockquote> 
<p>以下图为例：<br> <img src="https://images2.imgbox.com/2c/73/MZzhIwPN_o.png" alt="在这里插入图片描述"><br> A 结点右子树高度等于左子树高度，平衡因子为0<br> B 结点右子树高度减左子树高度等于 -1，平衡因子为 -1<br> C 结点右子树高度减左子树高度等于 1，平衡因子为 1<br> D 结点右子树高度等于左子树高度，平衡因子为0<br> E 结点右子树高度等于左子树高度，平衡因子为0</p> 
<h2><a id="_40"></a>结点定义</h2> 
<p>和普通的树结点一样，具有左引用，右引用，数据val，以及构造方法<br> 但是 AVL 树还要再加一个平衡因子（Balance Factor）简写为 bf<br> 还有一个双亲结点的引用（和平衡因子一样，插入的时候要用到）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> left<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> right<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> parent<span class="token punctuation">;</span>
    <span class="token keyword">int</span> bf<span class="token punctuation">;</span> <span class="token comment">//平衡因子 右子树高度减去左子树高度</span>

    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_59"></a>插入实现</h2> 
<p>首先完成结点的插入工作，这里的插入和之前我们在二叉搜索树已经学习过，这里就直接上代码，如果不了解的可以点开这个连接：<a href="http://t.csdnimg.cn/0W2Fk" rel="nofollow">JavaDS —— 二叉搜索树、哈希表、Map 与 Set</a></p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//如果根节点本身为空就直接赋值</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> node<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TreeNode</span> prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> root<span class="token punctuation">;</span>

        <span class="token comment">//找到新结点的位置</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>cur <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val <span class="token operator">==</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//相同的数据无法再次插入</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val <span class="token operator">&lt;</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//插入结点</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>val <span class="token operator">&gt;</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>left <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>right <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        node<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>现在就是调整平衡因子（<strong>这里我设定为右子树高度减左子树高</strong>度），如果你是插入到左子树的话，那平衡因子就要自减，如果是插入到右子树的话，那平衡因子就要自增。</p> 
<p>首先就要先拿到 node 的位置，将cur 重置为 node</p> 
<pre><code class="prism language-java">cur <span class="token operator">=</span> node<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">			<span class="token comment">//左子树-- 右子树++</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>left <span class="token operator">==</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p>调节完平衡因子之后，<strong>此时调节过的平衡因子有五种情况：0 、1 、-1 、2 、-2</strong></p> 
<p>如下图所示：<strong>红色的结点为新插入的结点，灰色的结点则是已经存在的</strong><br> <img src="https://images2.imgbox.com/e4/60/VCTi6MBh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d4/cc/XJT5TcA4_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><strong>如果调节过后，平衡因子依旧为 0 ，则说明该树本身就已经平衡了，不需要进行旋转调整.</strong></p> 
<p><strong>如果调节过后的平衡因子为 1 或者 -1，说明该结点的兄弟结点为空，这个结点的插入可能会导致不平衡，需要我们继续向上调整平衡因子</strong>，这时候我们会使用 parent 引用，让prev 和 cur 一起向上移动，大家就会想到使用循环来调整平衡因子。</p> 
<p>循环的部分代码如下：</p> 
<pre><code class="prism language-java">        cur <span class="token operator">=</span> node<span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子与AVL树</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>prev <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//左子树-- 右子树++</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>left <span class="token operator">==</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//检查是否需要旋转</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//平衡因子为0，说明树已经平衡，不用调整</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//如果出现 -1 或者 1 则说明树的平衡性已经被新结点影响到，需要继续调整</span>
                cur <span class="token operator">=</span> prev<span class="token punctuation">;</span>
                prev <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p><strong>如果调节过后的平衡因子为 2 或者 -2，说明该树出现不平衡，需要进行旋转调整</strong></p> 
<p>大家可以记一下旋转的口诀，旋转内容会在下面继续讲解：</p> 
<blockquote> 
 <p><strong>左左型：右单旋<br> 右右型：左单旋<br> 左右型：左右双旋<br> 右左型：右左双选</strong></p> 
</blockquote> 
<pre><code class="prism language-java"> 		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//此时怕平衡因子有两种情况2 或者 -2，需要旋转重新建立平衡树</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//说明右子树过高</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//右右型 左单旋</span>
                        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//右左型 右左双旋</span>
                        <span class="token function">rotateRL</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//此时 prev.bf == -2 说明左子树过高</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//左右型，左右双旋</span>
                        <span class="token function">rotateLR</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//左左型， 右单旋</span>
                        <span class="token function">rotateRight</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>

                <span class="token comment">//旋转完成后，树已经平衡，直接退出循环</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong>经过旋转过后，树就会平衡，就无需继续调整平衡因子，直接跳出循环即可。</strong></p> 
</blockquote> 
<h2><a id="_193"></a>旋转实现</h2> 
<blockquote> 
 <p><strong>下面所有的实例图绿色的数字表示经过旋转后平衡因子变为多少</strong></p> 
</blockquote> 
<h3><a id="_195"></a>左单旋</h3> 
<p><strong>当新插入的结点插在某个结点的右孩子的右子树时（这个简称为右右型），那么这个某个结点采用左单旋：</strong></p> 
<p>简单情况：<br> <img src="https://images2.imgbox.com/d0/fe/hDv0mlP4_o.png" alt="在这里插入图片描述"><br> 我们需要让 prev 成为 cur 的左孩子，这时候我们需要修改 prev 的 parent 引用， cur 的左孩子引用以及parent 引用，并且cur 结点的 parent 引用需要改成原来 prev 的parent引用（记为 pParent），所以我们事先就要保存好pParent，最后我们要将pParent 的左引用或者右引用 来连接cur （这里需要判断一下），最后的最后这两个结点的平衡因子置为 0</p> 
<p>特殊情况：<strong>如果prev 本身就是 根节点的话，那么根节点的引用要变成 cur 的。</strong></p> 
<p>如果 cur 的左孩子本身就存在呢？<br> <img src="https://images2.imgbox.com/2e/19/U1cl50H0_o.png" alt="在这里插入图片描述"><br> 那么我们需要将 cur 左孩子结点先保存起来，让 prev.right = cur 的左孩子结点，并且左孩子结点的 parent 的引用要修改为 prev，<strong>所以这里引申出我们需要判断 cur 的左孩子结点存不存在，如果不存在则不需要修改其 parent 引用，避免发生空指针异常</strong></p> 
<pre><code class="prism language-java">    <span class="token comment">//左单旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> pParent <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curL <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>

        prev<span class="token punctuation">.</span>right <span class="token operator">=</span> curL<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>curL <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            curL<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cur<span class="token punctuation">.</span>left <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        prev<span class="token punctuation">.</span>parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        cur<span class="token punctuation">.</span>parent <span class="token operator">=</span> pParent<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pParent<span class="token punctuation">.</span>left <span class="token operator">==</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//调整平衡因子</span>
        cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_236"></a>右单旋</h3> 
<p><strong>当新插入的结点插在某个结点的左孩子的左子树时（这个简称为左左型），那么这个某个结点采用右单旋：</strong></p> 
<p>简单情况：<br> <img src="https://images2.imgbox.com/58/ef/3r5fHtSy_o.png" alt="在这里插入图片描述"><br> 这个和左单旋很相似，大家可以类比左单旋。</p> 
<p>特殊情况：如果 prev 本身就是根节点的话就要修改根结点的引用。</p> 
<p>还有，如果 cur 自身就有右孩子：让 prev.left = cur 的右孩子结点，并且判断右孩子结点是否为空，不为空的话将 parent 的引用要修改为 prev，<br> <img src="https://images2.imgbox.com/ec/a6/M89tWd3m_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token comment">//右单旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRight</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> pParent <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curR <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>

        prev<span class="token punctuation">.</span>left <span class="token operator">=</span> curR<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>curR <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            curR<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cur<span class="token punctuation">.</span>right <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        prev<span class="token punctuation">.</span>parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        cur<span class="token punctuation">.</span>parent <span class="token operator">=</span> pParent<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pParent<span class="token punctuation">.</span>left <span class="token operator">==</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//调整平衡因子</span>
        cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_274"></a>左右双旋</h3> 
<p><strong>当新插入的结点插在某个结点的左孩子的右子树时（这个简称为左右型），那么这个某个结点采用左右双旋：</strong></p> 
<p>简单情况：<br> <img src="https://images2.imgbox.com/6d/e0/5wIiBcEr_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>左右双旋是指先进行左单旋，再进行右单旋，当然你也可以一步到位，我这里采用分步<br> <strong>所以左右双旋需要先对 cur 调用左单旋，再对 prev 调用右单旋</strong></p> 
</blockquote> 
<p>特殊情况：由于在单旋代码中我们已经处理好根节点和prev 的parent 结点了，但是这三个结点的平衡因子最后一定是 0 吗？？？<br> 这次我们讨论的是如果是下面两种复杂的情况时，我们就需要修改一下某些结点的平衡因子：<br> <img src="https://images2.imgbox.com/6e/ba/8fWkIBSh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/47/78/GULCC3T5_o.png" alt="在这里插入图片描述"><br> 进行完两个单旋转后，最后这三个结点的平衡因子都为0，但是看到上面的情况之后，其实并不是都为0，所以我们在进行旋转的时候就要先保存好cur 的右孩子的平衡因子，等到旋转结束后，就要调整平衡因子。</p> 
<p>当 cur.right.bf = -1 时，prev.bf = 1；<br> 当 cur.right.bf = 1 时，cur.bf = -1</p> 
<pre><code class="prism language-java">    <span class="token comment">//左右双旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLR</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curR <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">int</span> bf <span class="token operator">=</span> curR<span class="token punctuation">.</span>bf<span class="token punctuation">;</span>

        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotateRight</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//bf 为 0 的时候，不需要调整</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_312"></a>右左双旋</h3> 
<p><strong>当新插入的结点插在某个结点的右孩子的左子树时（这个简称为右左型），那么这个某个结点采用右左双旋：</strong></p> 
<p>和左右双旋是类似的，这里就给出三种情况的图片给大家参考：<br> 简单情况：<br> <img src="https://images2.imgbox.com/c7/26/hnuXkSSU_o.png" alt="在这里插入图片描述"><br> 特殊情况：<br> 当 cur.left.bf = -1 时，cur.bf = 1；<br> <img src="https://images2.imgbox.com/03/3f/6PZe0seT_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>当 cur.left.bf = 1 时，prev.bf = -1；</p> 
<p><img src="https://images2.imgbox.com/48/47/lXXTvOAV_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token comment">//右左双旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRL</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curL <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">int</span> bf <span class="token operator">=</span> curL<span class="token punctuation">.</span>bf<span class="token punctuation">;</span>

        <span class="token function">rotateRight</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//bf 为 0 的时候，不需要调整</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_350"></a>测试</h2> 
<p>写好AVL 树，记得测试自己的代码有没有错误，这里要测试两个东西，第一个是中序遍历的时候是否有序（检测是否为二叉搜索树），第二个东西就是平衡因子有没有错误以及是否是一个高度平衡的二叉树（因为都与高度有关，所以可以放在同一个方法里去写测试代码）。</p> 
<h2><a id="_353"></a>性能分析</h2> 
<p>AVL 树始终都能保持高度的平衡（即左右子树的高度差&lt;= 1），所以在搜索数据的时候，时间复杂度为O(log N)，举个例子：加上有10亿个数据，需要在其中找到一个数据，如果使用 AVL 树，2的30次方等于1,073,741,824，所以最多只需要查找30次就能找到目标值，可见AVL 树在查找中的优秀表现。</p> 
<p>由于AVL树在插入和删除的时候，会进行旋转调整，这也就意味着大量时间和资源的消耗，所以AVL 树比较适合静态数据的查找，如果数据涉及大量的删除或者插入就会导致AVL 树的效率下降，这也就是为什么现在AVL 树应用范围比较小。</p> 
<h2><a id="_357"></a>最终代码</h2> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> left<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> right<span class="token punctuation">;</span>
    <span class="token class-name">TreeNode</span> parent<span class="token punctuation">;</span>
    <span class="token keyword">int</span> bf<span class="token punctuation">;</span> <span class="token comment">//平衡因子 右子树高度减去左子树高度</span>

    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>val <span class="token operator">=</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AVLTree</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">TreeNode</span> root<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> node <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeNode</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//如果根节点本身为空就直接赋值</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> node<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TreeNode</span> prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> root<span class="token punctuation">;</span>

        <span class="token comment">//找到新结点的位置</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>cur <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val <span class="token operator">==</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//相同的数据无法再次插入</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val <span class="token operator">&lt;</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//插入结点</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>val <span class="token operator">&gt;</span> val<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>left <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>right <span class="token operator">=</span> node<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        node<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>

        cur <span class="token operator">=</span> node<span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子与AVL树</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>prev <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//左子树-- 右子树++</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>left <span class="token operator">==</span> cur<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                prev<span class="token punctuation">.</span>bf<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//检查是否需要旋转</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//平衡因子为0，说明树已经平衡，不用调整</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//如果出现 -1 或者 1 则说明树的平衡性已经被新结点影响到，需要继续调整</span>
                cur <span class="token operator">=</span> prev<span class="token punctuation">;</span>
                prev <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//此时怕平衡因子有两种情况2 或者 -2，需要旋转重新建立平衡树</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>prev<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//说明右子树过高</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//右右型 左单旋</span>
                        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//右左型 右左双旋</span>
                        <span class="token function">rotateRL</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//此时 prev.bf == -2 说明左子树过高</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//左右型，左右双旋</span>
                        <span class="token function">rotateLR</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//左左型， 右单旋</span>
                        <span class="token function">rotateRight</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>

                <span class="token comment">//旋转完成后，树已经平衡，直接退出循环</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//左右双旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLR</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curR <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">int</span> bf <span class="token operator">=</span> curR<span class="token punctuation">.</span>bf<span class="token punctuation">;</span>

        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotateRight</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//bf 为 0 的时候，不需要调整</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//右左双旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRL</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curL <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">int</span> bf <span class="token operator">=</span> curL<span class="token punctuation">.</span>bf<span class="token punctuation">;</span>

        <span class="token function">rotateRight</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">rotateLeft</span><span class="token punctuation">(</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//调整平衡因子</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//bf 为 0 的时候，不需要调整</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//右单旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRight</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> pParent <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curR <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>

        prev<span class="token punctuation">.</span>left <span class="token operator">=</span> curR<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>curR <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            curR<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cur<span class="token punctuation">.</span>right <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        prev<span class="token punctuation">.</span>parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        cur<span class="token punctuation">.</span>parent <span class="token operator">=</span> pParent<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pParent<span class="token punctuation">.</span>left <span class="token operator">==</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//调整平衡因子</span>
        cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//左单旋</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">TreeNode</span> pParent <span class="token operator">=</span> prev<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> cur <span class="token operator">=</span> prev<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token class-name">TreeNode</span> curL <span class="token operator">=</span> cur<span class="token punctuation">.</span>left<span class="token punctuation">;</span>

        prev<span class="token punctuation">.</span>right <span class="token operator">=</span> curL<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>curL <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            curL<span class="token punctuation">.</span>parent <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cur<span class="token punctuation">.</span>left <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        prev<span class="token punctuation">.</span>parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        cur<span class="token punctuation">.</span>parent <span class="token operator">=</span> pParent<span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>prev <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            root <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pParent<span class="token punctuation">.</span>left <span class="token operator">==</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            pParent<span class="token punctuation">.</span>right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//调整平衡因子</span>
        cur<span class="token punctuation">.</span>bf <span class="token operator">=</span> prev<span class="token punctuation">.</span>bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/19cc9d00e7e4a75a59df1ca5a6228520/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">评分超越MJ和SD？揭秘FLUX.1 AI绘画模型，实例评测不容错过（附体验地址）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/680c8d5e429ac2accdb4b79e2141b688/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Django与数据库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>