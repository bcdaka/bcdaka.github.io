<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入分析 Android BroadcastReceiver (十)(完) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/dd86ff750b9d30c93c3d596263feeace/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="深入分析 Android BroadcastReceiver (十)(完)">
  <meta property="og:description" content="文章目录 深入分析 Android BroadcastReceiver (十)1. 深入理解 Android 广播机制的高级应用与实践1.1 高级应用1.1.1 示例：广播启动服务1.1.2 示例：数据变化通知1.1.3 示例：下载完成通知 1.2 实践建议1.2.1 设置权限1.2.2 动态注册和注销广播接收器1.2.3 示例：使用 LocalBroadcastManager1.2.4 示例：合并事件 2. 总结 深入分析 Android BroadcastReceiver (十) 1. 深入理解 Android 广播机制的高级应用与实践 在前文中，我们深入探讨了 Android 广播机制的基本实现、扩展应用和高级优化。接下来，我们将进一步探讨广播机制的更多高级应用和实际开发中的一些实践建议。
1.1 高级应用 广播与服务的结合 在一些复杂应用场景中，广播和服务的结合使用可以实现更加灵活和强大的功能。例如，通过广播通知启动服务，或在服务中发送广播通知应用状态变化。
1.1.1 示例：广播启动服务 发送广播启动服务：
Intent intent = new Intent(&#34;com.example.START_SERVICE_ACTION&#34;); context.sendBroadcast(intent); 注册接收器并启动服务：
public class StartServiceReceiver extends BroadcastReceiver { @Override public void onReceive(Context context, Intent intent) { if (&#34;com.example.START_SERVICE_ACTION&#34;.equals(intent.getAction())) { Intent serviceIntent = new Intent(context, MyService.class); context.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-08T19:49:12+08:00">
    <meta property="article:modified_time" content="2024-07-08T19:49:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入分析 Android BroadcastReceiver (十)(完)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_Android_BroadcastReceiver__1" rel="nofollow">深入分析 Android BroadcastReceiver (十)</a></li><li><a href="#1__Android__2" rel="nofollow">1. 深入理解 Android 广播机制的高级应用与实践</a></li><li><ul><li><a href="#11__6" rel="nofollow">1.1 高级应用</a></li><li><ul><li><a href="#111__12" rel="nofollow">1.1.1 示例：广播启动服务</a></li><li><a href="#112__37" rel="nofollow">1.1.2 示例：数据变化通知</a></li><li><a href="#113__69" rel="nofollow">1.1.3 示例：下载完成通知</a></li></ul> 
    </li><li><a href="#12__95" rel="nofollow">1.2 实践建议</a></li><li><ul><li><a href="#121__101" rel="nofollow">1.2.1 设置权限</a></li><li><a href="#122__127" rel="nofollow">1.2.2 动态注册和注销广播接收器</a></li><li><a href="#123__LocalBroadcastManager_149" rel="nofollow">1.2.3 示例：使用 LocalBroadcastManager</a></li><li><a href="#124__185" rel="nofollow">1.2.4 示例：合并事件</a></li></ul> 
   </li></ul> 
   </li><li><a href="#2__205" rel="nofollow">2. 总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_Android_BroadcastReceiver__1"></a>深入分析 Android BroadcastReceiver (十)</h3> 
<h3><a id="1__Android__2"></a>1. 深入理解 Android 广播机制的高级应用与实践</h3> 
<p>在前文中，我们深入探讨了 Android 广播机制的基本实现、扩展应用和高级优化。接下来，我们将进一步探讨广播机制的更多高级应用和实际开发中的一些实践建议。</p> 
<h4><a id="11__6"></a>1.1 高级应用</h4> 
<ol><li><strong>广播与服务的结合</strong></li></ol> 
<p>在一些复杂应用场景中，广播和服务的结合使用可以实现更加灵活和强大的功能。例如，通过广播通知启动服务，或在服务中发送广播通知应用状态变化。</p> 
<h5><a id="111__12"></a>1.1.1 示例：广播启动服务</h5> 
<p>发送广播启动服务：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.START_SERVICE_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>注册接收器并启动服务：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartServiceReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"com.example.START_SERVICE_ACTION"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> serviceIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token class-name">MyService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">startService</span><span class="token punctuation">(</span>serviceIntent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li><strong>广播与内容提供者的结合</strong></li></ol> 
<p>广播和内容提供者的结合可以实现数据变化的通知。内容提供者负责数据的存取，广播负责通知数据变化，从而实现数据同步。</p> 
<h5><a id="112__37"></a>1.1.2 示例：数据变化通知</h5> 
<p>在内容提供者中发送数据变化广播：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">ContentValues</span> values<span class="token punctuation">,</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> rowsUpdated <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rowsUpdated <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notifyChange</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.DATA_CHANGED"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> rowsUpdated<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>注册接收器处理数据变化：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataChangedReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"com.example.DATA_CHANGED"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理数据变化</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li><strong>广播与通知的结合</strong></li></ol> 
<p>通过广播接收器处理特定事件后，使用通知系统向用户显示重要信息。例如，下载完成后通过广播通知用户。</p> 
<h5><a id="113__69"></a>1.1.3 示例：下载完成通知</h5> 
<p>发送下载完成广播：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.DOWNLOAD_COMPLETE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>接收广播并显示通知：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DownloadCompleteReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"com.example.DOWNLOAD_COMPLETE"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">NotificationManager</span> notificationManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NotificationManager</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">NOTIFICATION_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Notification</span> notification <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Notification<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setContentTitle</span><span class="token punctuation">(</span><span class="token string">"Download Complete"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setContentText</span><span class="token punctuation">(</span><span class="token string">"Your download is complete."</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setSmallIcon</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_download<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            notificationManager<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> notification<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="12__95"></a>1.2 实践建议</h4> 
<ol><li><strong>权限控制</strong></li></ol> 
<p>为了提高广播的安全性，尤其是自定义广播，应设置合适的权限来防止恶意应用发送或接收广播。</p> 
<h5><a id="121__101"></a>1.2.1 设置权限</h5> 
<p>定义权限：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.MY_PERMISSION<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>protectionLevel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>normal<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>发送广播时设置权限：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.CUSTOM_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token string">"com.example.MY_PERMISSION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>注册接收器时声明权限：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.CustomReceiver<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.MY_PERMISSION<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.CUSTOM_ACTION<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol start="2"><li><strong>优化广播接收器的生命周期</strong></li></ol> 
<p>在组件不需要接收广播时及时注销广播接收器，避免内存泄漏和资源浪费。</p> 
<h5><a id="122__127"></a>1.2.2 动态注册和注销广播接收器</h5> 
<p>在 <code>Activity</code> 的生命周期中注册和注销接收器：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token string">"com.example.CUSTOM_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerReceiver</span><span class="token punctuation">(</span>customReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>customReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li><strong>使用 LocalBroadcastManager</strong></li></ol> 
<p>在应用内部使用 <code>LocalBroadcastManager</code> 进行局部广播，提高安全性和性能，避免不必要的全局广播传播。</p> 
<h5><a id="123__LocalBroadcastManager_149"></a>1.2.3 示例：使用 LocalBroadcastManager</h5> 
<p>发送局部广播：</p> 
<pre><code class="prism language-java"><span class="token class-name">LocalBroadcastManager</span> localBroadcastManager <span class="token operator">=</span> <span class="token class-name">LocalBroadcastManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.LOCAL_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
localBroadcastManager<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>注册局部广播接收器：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token string">"com.example.LOCAL_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LocalBroadcastManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>localReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LocalBroadcastManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>localReceiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BroadcastReceiver</span> localReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理局部广播</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li><strong>防止广播风暴</strong></li></ol> 
<p>对于频繁发送的广播事件，应采取防止广播风暴的措施，如合并事件、延迟发送、限制频率等。</p> 
<h5><a id="124__185"></a>1.2.4 示例：合并事件</h5> 
<p>使用 <code>Handler</code> 合并事件：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">EVENT_ID</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Handler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what <span class="token operator">==</span> <span class="token constant">EVENT_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理合并后的事件</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendMergedBroadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    handler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span><span class="token constant">EVENT_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handler<span class="token punctuation">.</span><span class="token function">sendEmptyMessageDelayed</span><span class="token punctuation">(</span><span class="token constant">EVENT_ID</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 延迟 1 秒发送</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2__205"></a>2. 总结</h3> 
<p>广播机制是 Android 中重要的组件间通信方式，具备强大的灵活性和扩展性。通过系统广播、自定义广播、有序广播、粘性广播和局部广播，可以实现各种复杂的通信需求。在实际开发中，开发者应充分利用广播机制的优势，并结合具体场景进行优化和改进。</p> 
<ul><li><strong>系统广播</strong>：用于通知系统级事件，如网络变化、电池状态等。</li><li><strong>自定义广播</strong>：用于应用内部组件间通信，灵活定制广播内容和行为。</li><li><strong>有序广播</strong>：按优先级顺序处理广播，适用于需要顺序处理的场景。</li><li><strong>粘性广播</strong>：广播消息在发送后一直存在，接收器在注册时会立即收到未处理的广播。</li><li><strong>局部广播</strong>：只在应用内部传播，提高安全性和效率。</li></ul> 
<p>通过合理设计和优化广播机制，开发者可以构建高效、安全和可维护的 Android 应用，实现丰富的功能和优良的用户体验。</p> 
<table><tbody><tr><td bgcolor="#FF0066"> <font size="5" color="#ffffff" face="宋体"> <b> 欢迎点赞|关注|收藏|评论，您的肯定是我创作的动力 </b> </font> </td></tr></tbody></table> 
<font size="20"> </font> 
<p><img src="https://images2.imgbox.com/c7/63/DUGWGYrD_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f023b9c749eda4d0ca612d37765fb1e8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入分析 Android BroadcastReceiver (九)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a62ed5f4392ec85857137b669bd6174/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何在Vue3中使用Ref访问DOM元素</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>