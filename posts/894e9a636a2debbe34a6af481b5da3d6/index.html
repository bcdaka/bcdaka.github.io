<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>llama.cpp 转化 huggingface 模型失败 解决路径 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/894e9a636a2debbe34a6af481b5da3d6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="llama.cpp 转化 huggingface 模型失败 解决路径">
  <meta property="og:description" content="问题： ./main -m ./models/book_q4_K_M -n 128
报错：
terminate called after throwing an instance of &#39;std::out_of_range&#39; what(): unordered_map::at
解决方案： python convert.py models/llama3-8B/ --vocab-type bpe
报错：
Found vocab files: {&#39;spm&#39;: None, &#39;bpe&#39;: PosixPath(&#39;models/llama3-8B/vocab.json&#39;), &#39;hfft&#39;: PosixPath(&#39;models/llama3-8B/tokenizer.json&#39;)} Loading vocab file PosixPath(&#39;models/llama3-8B/vocab.json&#39;), type &#39;bpe&#39; Vocab info: &lt;BpeVocab with 128000 base tokens and 256 added tokens&gt; Special vocab info: &lt;SpecialVocab with 280147 merges, special tokens {&#39;bos&#39;: 128000, &#39;eos&#39;: 128009, &#39;pad&#39;: 128009}, add special tokens unset&gt;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-19T18:01:58+08:00">
    <meta property="article:modified_time" content="2024-05-19T18:01:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">llama.cpp 转化 huggingface 模型失败 解决路径</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>问题：</h4> 
<blockquote> 
 <p>./main -m ./models/book_q4_K_M -n 128</p> 
 <p>报错：</p> 
 <p>terminate called after throwing an instance of 'std::out_of_range' what(): unordered_map::at</p> 
</blockquote> 
<h4>解决方案：</h4> 
<p><strong>python convert.py models/llama3-8B/ --vocab-type bpe</strong></p> 
<blockquote> 
 <p>报错：</p> 
 <p>Found vocab files: {'spm': None, 'bpe': PosixPath('models/llama3-8B/vocab.json'), 'hfft': PosixPath('models/llama3-8B/tokenizer.json')} Loading vocab file PosixPath('models/llama3-8B/vocab.json'), type 'bpe' Vocab info: &lt;BpeVocab with 128000 base tokens and 256 added tokens&gt; Special vocab info: &lt;SpecialVocab with 280147 merges, special tokens {'bos': 128000, 'eos': 128009, 'pad': 128009}, add special tokens unset&gt;</p> 
</blockquote> 
<pre> (py310) root@quin-ubuntu:~/code/llama.cpp# ls models/llama3-8B/
 config.json             LICENSE                           model-00003-of-00004.safetensors  README.md                tokenizer.json
 generation_config.json  model-00001-of-00004.safetensors  model-00004-of-00004.safetensors  special_tokens_map.json
 ggml-model-f16.gguf     model-00002-of-00004.safetensors  model.safetensors.index.json      tokenizer_config.json</pre> 
<blockquote> 
 <p>发现没有 vocab.json 文件</p> 
</blockquote> 
<p><strong>复制 token.json 重命名为 vocab.json</strong></p> 
<blockquote> 
 <p><code>vocab.json</code> 和 <code>tokenizer.json</code> 都是与自然语言处理模型中的令牌器（tokenizer）相关的配置文件，但它们包含的信息和用途可能有所不同。</p> 
 <ol><li> <p><strong>vocab.json</strong>:</p> 
   <ul><li> <p>这个文件通常包含了模型的词汇表（vocabulary），即模型能够理解和生成的所有单词或子词单元的列表。</p> </li><li> <p>词汇表文件可能包括每个词汇条目的索引、词汇本身以及相关的统计信息（如频率）。</p> </li><li> <p>在基于BPE（Byte Pair Encoding）或其他子词分割算法的令牌器中，<code>vocab.json</code> 文件可能包含了所有合并操作（merges）的列表，这些合并操作定义了如何将字符组合成子词单元。</p> </li></ul></li><li> <p><strong>tokenizer.json</strong>:</p> 
   <ul><li> <p>这个文件可能包含了令牌器的完整配置，包括词汇表、特殊令牌（如[CLS]、[SEP]、[UNK]等）、分割规则、预处理和后处理步骤等。</p> </li><li> <p>在某些框架或模型中，<code>tokenizer.json</code> 可能是一个更全面的配置文件，它不仅包含了词汇表信息，还可能包括了如何将文本转换为模型输入的详细说明。</p> </li><li> <p>这个文件可能用于保存和加载令牌器的配置，以便在不同的环境中重用相同的令牌化过程。</p> </li></ul></li></ol> 
 <p>在实际应用中，<code>vocab.json</code> 和 <code>tokenizer.json</code> 的具体内容和格式可能取决于所使用的框架和模型。例如，在Hugging Face的Transformers库中，<code>tokenizer.json</code> 文件通常包含了令牌器的所有配置信息，而 <code>vocab.json</code> 可能只是词汇表的一部分。</p> 
 <p>如果你遇到需要使用这些文件的情况，你应该查阅相关模型或框架的文档，以确保你理解每个文件的确切用途和内容，并正确地使用它们。如果你的模型或脚本期望找到 <code>vocab.json</code> 文件，但你只有 <code>tokenizer.json</code>，你可能需要检查这两个文件是否可以互换，或者是否需要对脚本进行调整以适应现有的文件。</p> 
</blockquote> 
<pre> cp models/llama3-8B/tokenizer.json  models/llama3-8B/vocab.json</pre> 
<p><strong>重新转换：</strong></p> 
<pre> # 转换模型
 python convert.py models/llama3-8B/ --vocab-type bpe
 ​
 # 量化模型
 ./quantize models/llama3-8B/ggml-model-f32.gguf ./models/book-Q4_K_M.gguf Q4_K_M
 ​
 # 运行模型
 ./main -m ./models/book-Q4_K_M.gguf -n 128</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3ec34efe3ccc782982562f0650cdbd4b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mac电脑远程桌面连接工具：Microsoft Remote Desktop for Mac 正式版</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fed830bc0a359633472aa9f0fc7813e6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决spring boot启动出现Unable to start ServletWebServerApplicationContext due to missing ServletWebServer*</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>