<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在hive插入数据时出现“Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask”报错 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1a2073f18db297f9183908d0e4dc640e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="在hive插入数据时出现“Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask”报错">
  <meta property="og:description" content="一.问题重现 SQL 错误 [2] [08S01]: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask 二.问题分析 这个错误代码表明 Hive 作业由于某种原因失败。
1.资源问题： 这个错误可能发生在集群上存在资源约束的情况下，例如内存或 CPU 资源不足以完成 Hive 作业。
2.数据问题： 它可能与数据本身相关。例如，数据可能损坏，或者数据格式或模式存在问题，Hive 无法处理。
3.配置问题： 不正确的 Hive 或 Hadoop 配置设置可能导致作业失败。
4.查询错误： 可能是与你尝试执行的 SQL 查询相关的问题。例如，它可能存在语法错误，或者尝试执行 Hive 不支持的操作。
5.权限问题： 你可能没有执行你尝试执行的操作所需的权限。
6.版本冲突：hive和Hadoop版本不兼容。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-04T18:28:23+08:00">
    <meta property="article:modified_time" content="2023-11-04T18:28:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在hive插入数据时出现“Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask”报错</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一.问题重现</h2> 
<pre><code class="hljs">SQL 错误 [2] [08S01]: Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask
Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask
Error while processing statement: FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.mr.MapRedTask</code></pre> 
<p><img alt="" height="410" src="https://images2.imgbox.com/df/67/BKWimGxs_o.png" width="1097"></p> 
<h2>二.问题分析</h2> 
<p>这个错误代码表明 Hive 作业由于某种原因失败。</p> 
<p><strong>   1.资源问题：</strong> 这个错误可能发生在集群上存在资源约束的情况下，例如内存或 CPU 资源不足以完成 Hive 作业。</p> 
<p><strong>   2.数据问题：</strong> 它可能与数据本身相关。例如，数据可能损坏，或者数据格式或模式存在问题，Hive 无法处理。</p> 
<p><strong>   3.配置问题：</strong> 不正确的 Hive 或 Hadoop 配置设置可能导致作业失败。</p> 
<p><strong>   4.查询错误：</strong> 可能是与你尝试执行的 SQL 查询相关的问题。例如，它可能存在语法错误，或者尝试执行 Hive 不支持的操作。</p> 
<p><strong>   5.权限问题：</strong> 你可能没有执行你尝试执行的操作所需的权限。</p> 
<p><strong>   6.版本冲突：</strong>hive和Hadoop版本不兼容。</p> 
<h2>三.问题解决</h2> 
<p>为了解决这个问题我们可以尝试以下步骤：</p> 
<ol><li> <p>检查 Hive 日志以获取有关问题性质的更多详细错误消息。这些日志可以提供有关问题的额外信息。</p> </li><li> <p>检查你的 SQL 查询，确保它是正确的，并适用于你正在处理的数据和模式。</p> </li><li> <p>验证你是否具有访问和操作数据所需的权限。</p> </li><li> <p>确保你的 Hive 和 Hadoop 配置正确设置。</p> </li><li> <p>如果错误与数据有关，请检查数据是否存在问题，如损坏、缺失值或不正确的格式。</p> </li><li>考虑咨询你的 Hadoop 或 Hive 管理员以获取进一步的故障排除帮助。</li><li>检查集群的资源利用情况，看集群资源是否充足。例如CPU和内存</li></ol> 
<p>        如果确定是集群资源不足，可以在<span style="color:#a2e043;">hadoop/etc/hadoop/</span>下<span style="color:#a2e043;">yarn-site.sh</span><span style="color:#0d0016;">配置文件添加以下内容</span></p> 
<pre><code class="hljs"> &lt;!--yarn单个容器允许分配的最大最小内存 --&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.scheduler.minimum-allocation-mb&lt;/name&gt;
        &lt;value&gt;512&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.scheduler.maximum-allocation-mb&lt;/name&gt;
        &lt;value&gt;4096&lt;/value&gt;
    &lt;/property&gt;
    
    &lt;!-- yarn容器允许管理的物理内存大小 --&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.resource.memory-mb&lt;/name&gt;
        &lt;value&gt;4096&lt;/value&gt;
    &lt;/property&gt;
    
    &lt;!-- 关闭yarn对物理内存和虚拟内存的限制检查 --&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.pmem-check-enabled&lt;/name&gt;
        &lt;value&gt;true&lt;/value&gt;
    &lt;/property&gt;
    &lt;property&gt;
        &lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;
        &lt;value&gt;false&lt;/value&gt;
    &lt;/property&gt;</code></pre> 
<p>排除以上问题之后问题没有解决，如果你插入数据是很多字段，可以尝试减少字段插入数据</p> 
<p>例如</p> 
<p>    这是我原本插入的数据的SQL语句</p> 
<pre><code class="hljs">-- 插入数据
insert overwrite table dw_didi.t_user_order_wide partition(dt='2020-04-12')
select
    orderid,telephone,lng,lat,province,city,es_money,gender,profession,age_range,tip,subscribe,
    case when subscribe = 0 then '非预约'
         when subscribe = 1 then '预约'
    end as subscribe_name,sub_time,is_agent,
    case when is_agent = 0 then '本人'
         when is_agent = 1 then '代叫'
    end as is_agent_name,
    agent_telephone,
    date_format(concat(order_time,':00'),'yyyy-MM-dd') as order_date,
    year(date_format(concat(order_time,':00'),'yyyy-MM-dd:ss')) as order_year,
    month(date_format(concat(order_time,':00'),'yyyy-MM-dd:ss'))as order_month,
    day(date_format(concat(order_time,':00'),'yyyy-MM-dd:ss'))as order_day,
    hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss'))as order_hour,
    case when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 1 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 5 then '凌晨'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 5 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 8 then '早上'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 8 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 11 then '上午'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 11 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 13 then '中午'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 13 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 17 then '下午'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 17 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 19 then '晚上'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 19 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 20 then '半夜'
         when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 20 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 24 then '深夜'
          when hour(date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &gt; 0 and hour (date_format(concat(order_time,':00'),'yyyy-MM-dd HH:mm:ss')) &lt;= 1 then '深夜'
          else 'N/A'
    end as order_time_range,
    date_format(concat(concat(order_time,':00'),':00'),'yyyy-MM-dd HH:mm:ss') as order_time 
from ods_didi.t_user_order WHERE dt = '2020-04-12' and length(order_time) &gt; 8;
    
    SELECT  * from dw_didi.t_user_order_wide</code></pre> 
<p>现在改为</p> 
<pre><code class="hljs">insert overwrite table dw_didi.wide1  partition(dt='2020-04-12')
select
    orderid
from ods_didi.t_user_order WHERE dt = '2020-04-12' and length(order_time) &gt; 8;
    
SELECT  * from dw_didi.wide1</code></pre> 
<p>如果尝试运行之后还是报相同错误</p> 
<p>就可以基本判定是hive配置文件的错误</p> 
<p>检查配置文件后，如果还是报错，我们可以尝试设置hive的执行引擎</p> 
<p>1.下载tez的依赖包：http://tez.apache.org</p> 
<p>2.拷贝apache-tez-0.9.1-bin.tar.gz到hadoop102的/export/software目录</p> 
<p>3.解压缩apache-tez-0.9.1-bin.tar.gz</p> 
<pre><code class="hljs">tar -zxvf apache-tez-0.9.1-bin.tar.gz -C /export/servers</code></pre> 
<p>4.进入到Hive的配置目录</p> 
<pre><code class="hljs">/hive/conf
</code></pre> 
<p>5.在hive-env.sh文件中添加tez环境变量配置和依赖包环境变量配置</p> 
<pre><code class="hljs">vim hive-env.sh</code></pre> 
<pre><code class="hljs">export TEZ_HOME=/export/servers/tez-0.9.1    #是你的tez的解压目录
export TEZ_JARS=""
for jar in `ls $TEZ_HOME |grep jar`; do
    export TEZ_JARS=$TEZ_JARS:$TEZ_HOME/$jar
done
for jar in `ls $TEZ_HOME/lib`; do
    export TEZ_JARS=$TEZ_JARS:$TEZ_HOME/lib/$jar
done

export HIVE_AUX_JARS_PATH=/export/servers/hadoop-2.7.7/share/hadoop/common/hadoop-lzo-0.4.20.jar$TEZ_JARS
</code></pre> 
<p>6.在hive-site.xml文件中添加如下配置，更改hive计算引擎</p> 
<pre><code class="hljs">&lt;property&gt;
    &lt;name&gt;hive.execution.engine&lt;/name&gt;
    &lt;value&gt;tez&lt;/value&gt;
&lt;/property&gt;</code></pre> 
<p>7.在Hive的/export/servers/hive/conf下面创建一个tez-site.xml文件</p> 
<pre><code class="hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt; 
&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;
 &lt;configuration&gt;
 &lt;property&gt;
	&lt;name&gt;tez.lib.uris&lt;/name&gt;    &lt;value&gt;${fs.defaultFS}/tez/tez-0.9.1,${fs.defaultFS}/tez/tez-0.9.1/lib&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
	&lt;name&gt;tez.lib.uris.classpath&lt;/name&gt;    	&lt;value&gt;${fs.defaultFS}/tez/tez-0.9.1,${fs.defaultFS}/tez/tez-0.9.1/lib&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
     &lt;name&gt;tez.use.cluster.hadoop-libs&lt;/name&gt;
     &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
     &lt;name&gt;tez.history.logging.service.class&lt;/name&gt;        &lt;value&gt;org.apache.tez.dag.history.logging.ats.ATSHistoryLoggingService&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre> 
<p>8.将/export/servers/tez-0.9.1上传到HDFS的/tez路径</p> 
<pre><code class="hljs">hadoop fs -mkdir /tez
 hadoop fs -put /export/servers/tez-0.9.1/ /tez
 hadoop fs -ls /tez查看结果是这个
 /tez/tez-0.9.1</code></pre> 
<p>运行Tez时检查到用过多内存而被NodeManager杀死进程问题：</p> 
<pre><code class="hljs">Caused by: org.apache.tez.dag.api.SessionNotRunning: TezSession has already shutdown. Application application_1546781144082_0005 failed 2 times due to AM Container for appattempt_1546781144082_0005_000002 exited with  exitCode: -103
For more detailed output, check application tracking page:http://hadoop102:8088/cluster/app/application_1546781144082_0005Then, click on links to logs of each attempt.
Diagnostics: Container [pid=11116,containerID=container_1546781144082_0005_02_000001] is running beyond virtual memory limits. Current usage: 216.3 MB of 1 GB physical memory used; 2.6 GB of 2.1 GB virtual memory used. Killing container.
</code></pre> 
<p>解决方法：</p> 
<pre><code class="hljs">&lt;property&gt;
&lt;name&gt;yarn.nodemanager.vmem-check-enabled&lt;/name&gt;
&lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98853f382ebe52e3a0ae8f903cb2d28d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【安全】Java幂等性校验解决重复点击（6种实现方式）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7548e54586fea449a6fe6e4e4648b6b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java中Integer.MAX_VALUE的含义</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>