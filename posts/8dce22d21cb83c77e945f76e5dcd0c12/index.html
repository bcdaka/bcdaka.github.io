<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>freertos初体验 - 在stm32上移植 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8dce22d21cb83c77e945f76e5dcd0c12/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="freertos初体验 - 在stm32上移植">
  <meta property="og:description" content="1. 说明 freertos内核 非常精简，代码量也很少，官方也针对主流的编译器和内核准备好了移植文件，所以 freertos 的移植是非常简单的，很多工具（例如CubeMX）点点鼠标就可以生成一个 freertos 的工程，本文就不介绍 CubeMX 生成 freertos 工程的方法了。本文介绍从官网下载 freertos 移植到自己工程的方法，这仍然是一件很简单的事情（除非你准备把他移植到一个官方没有提供移植文件的内核上），与其说是移植，到不如说是把代码加到自己的工程里 。freertos 的移植是很简单的，关键点在于移植成功后，你是否能用好它，是否了解它工作的原理，本文暂不介绍 freertos 的具体实现和工作原理，这会在后面的文章中继续说明，本文只是以是以stm32为例，简单介绍一下移植的步骤。 2. 移植步骤 准备一个目标芯片的工程
这一步不再过多赘述，我这边使用了CubeMX 生成了一个工程。 去官网下载 ferrrtos 源码
下载地址：https://www.freertos.org/zh-cn-cmn-s/a00104.html
浏览一下目录结构，需要加入到工程中的文件都在第三张图和第四张图
将上述图片所说的文件加到自己的工程中，添加后的工程如下：
可以看见。freertos代码并不多，内核一共就这么多代码
由上图可以看见，我们还需要提供一个 FreeRTOSConfig.h 的文件用来配置 freertos，FreeRTOSConfig.h 具体有哪些项本文先不深究，大家可以使用我下面提供的配置文件，这个文件是 CubeMX 生成 freertos工程时生成的。
/* USER CODE BEGIN Header */ /* * FreeRTOS Kernel V10.3.1 * Portion Copyright (C) 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved. * Portion Copyright (C) 2019 StMicroelectronics, Inc. All Rights Reserved.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-30T22:33:36+08:00">
    <meta property="article:modified_time" content="2024-05-30T22:33:36+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">freertos初体验 - 在stm32上移植</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__0"></a>1. 说明</h2> 
<ul><li><strong>freertos内核</strong> 非常精简，代码量也很少，官方也针对主流的编译器和内核准备好了移植文件，所以 <strong>freertos</strong> 的移植是非常简单的，很多工具（例如CubeMX）点点鼠标就可以生成一个 <strong>freertos</strong> 的工程，本文就不介绍 <strong>CubeMX</strong> 生成 <strong>freertos</strong> 工程的方法了。</li><li>本文介绍从官网下载 <strong>freertos</strong> 移植到自己工程的方法，这仍然是一件很简单的事情（除非你准备把他移植到一个官方没有提供移植文件的内核上），<strong>与其说是移植，到不如说是把代码加到自己的工程里</strong> 。</li><li><strong>freertos</strong> 的移植是很简单的，关键点在于移植成功后，你是否能用好它，是否了解它工作的原理，本文暂不介绍 <strong>freertos</strong> 的具体实现和工作原理，这会在后面的文章中继续说明，本文只是以是以stm32为例，简单介绍一下移植的步骤。</li></ul> 
<h2><a id="2__4"></a>2. 移植步骤</h2> 
<ul><li> <p>准备一个目标芯片的工程</p> 
  <ul><li>这一步不再过多赘述，我这边使用了<strong>CubeMX</strong> 生成了一个工程。</li></ul> </li><li> <p>去官网下载 <strong>ferrrtos</strong> 源码</p> 
  <ul><li>下载地址：<a href="https://www.freertos.org/zh-cn-cmn-s/a00104.html" rel="nofollow">https://www.freertos.org/zh-cn-cmn-s/a00104.html</a><br> <img src="https://images2.imgbox.com/07/81/6SuKNbHu_o.png" alt="在这里插入图片描述"></li></ul> </li><li> <p>浏览一下目录结构，需要加入到工程中的文件都在第三张图和第四张图<br> <img src="https://images2.imgbox.com/fe/e2/p9wblKYq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1c/96/GzVGw8Ph_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/6e/6igKk7yN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7c/0d/uzoyMtNR_o.png" alt="在这里插入图片描述"></p> </li><li> <p>将上述图片所说的文件加到自己的工程中，添加后的工程如下：</p> 
  <blockquote> 
   <p>可以看见。freertos代码并不多，内核一共就这么多代码<br> <img src="https://images2.imgbox.com/8a/9f/s6DtV0EZ_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li><li> <p>由上图可以看见，我们还需要提供一个 <strong>FreeRTOSConfig.h</strong> 的文件用来配置 <strong>freertos</strong>，<strong>FreeRTOSConfig.h</strong> 具体有哪些项本文先不深究，大家可以使用我下面提供的配置文件，这个文件是 <strong>CubeMX</strong> 生成 <strong>freertos</strong>工程时生成的。</p> </li></ul> 
<pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN Header */</span>
<span class="token comment">/*
 * FreeRTOS Kernel V10.3.1
 * Portion Copyright (C) 2017 Amazon.com, Inc. or its affiliates.  All Rights Reserved.
 * Portion Copyright (C) 2019 StMicroelectronics, Inc.  All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * http://www.FreeRTOS.org
 * http://aws.amazon.com/freertos
 *
 * 1 tab == 4 spaces!
 */</span>
<span class="token comment">/* USER CODE END Header */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">FREERTOS_CONFIG_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FREERTOS_CONFIG_H</span></span>

<span class="token comment">/*-----------------------------------------------------------
 * Application specific definitions.
 *
 * These definitions should be adjusted for your particular hardware and
 * application requirements.
 *
 * These parameters and more are described within the 'configuration' section of the
 * FreeRTOS API documentation available on the FreeRTOS.org web site.
 *
 * See http://www.freertos.org/a00110.html
 *----------------------------------------------------------*/</span>

<span class="token comment">/* USER CODE BEGIN Includes */</span>
<span class="token comment">/* Section where include file can be added */</span>
<span class="token comment">/* USER CODE END Includes */</span>

<span class="token comment">/* Ensure definitions are only used by the compiler, and not by the assembler. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__ICCARM__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__CC_ARM<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__GNUC__<span class="token punctuation">)</span></span></span>
  <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>
  <span class="token keyword">extern</span> <span class="token class-name">uint32_t</span> SystemCoreClock<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token function">xPortSysTickHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">CMSIS_device_header</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CMSIS_device_header</span> <span class="token string">"stm32h7xx.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* CMSIS_device_header */</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configENABLE_FPU</span>                         <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configENABLE_MPU</span>                         <span class="token expression"><span class="token number">0</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PREEMPTION</span>                     <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_STATIC_ALLOCATION</span>          <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_DYNAMIC_ALLOCATION</span>         <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_IDLE_HOOK</span>                      <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TICK_HOOK</span>                      <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configCPU_CLOCK_HZ</span>                       <span class="token expression"><span class="token punctuation">(</span> SystemCoreClock <span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTICK_RATE_HZ</span>                       <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>TickType_t<span class="token punctuation">)</span><span class="token number">1000</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_PRIORITIES</span>                     <span class="token expression"><span class="token punctuation">(</span> <span class="token number">56</span> <span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMINIMAL_STACK_SIZE</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">128</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTOTAL_HEAP_SIZE</span>                    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token number">15360</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_TASK_NAME_LEN</span>                  <span class="token expression"><span class="token punctuation">(</span> <span class="token number">16</span> <span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TRACE_FACILITY</span>                 <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_16_BIT_TICKS</span>                   <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_MUTEXES</span>                        <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configQUEUE_REGISTRY_SIZE</span>                <span class="token expression"><span class="token number">8</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_RECURSIVE_MUTEXES</span>              <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_COUNTING_SEMAPHORES</span>            <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PORT_OPTIMISED_TASK_SELECTION</span>  <span class="token expression"><span class="token number">0</span></span></span>
<span class="token comment">/* USER CODE BEGIN MESSAGE_BUFFER_LENGTH_TYPE */</span>
<span class="token comment">/* Defaults to size_t for backward compatibility, but can be changed
   if lengths will always be less than the number of bytes in a size_t. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMESSAGE_BUFFER_LENGTH_TYPE</span>         <span class="token expression"><span class="token class-name">size_t</span></span></span>
<span class="token comment">/* USER CODE END MESSAGE_BUFFER_LENGTH_TYPE */</span>

<span class="token comment">/* Co-routine definitions. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_CO_ROUTINES</span>                    <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_CO_ROUTINE_PRIORITIES</span>          <span class="token expression"><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span></span></span>

<span class="token comment">/* Software timer definitions. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TIMERS</span>                         <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_TASK_PRIORITY</span>                <span class="token expression"><span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_QUEUE_LENGTH</span>                 <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTIMER_TASK_STACK_DEPTH</span>             <span class="token expression"><span class="token number">256</span></span></span>

<span class="token comment">/* CMSIS-RTOS V2 flags */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_THREAD_SUSPEND_RESUME</span>  <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_THREAD_ENUMERATE</span>       <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_EVENTFLAGS_FROM_ISR</span>    <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_THREAD_FLAGS</span>           <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_TIMER</span>                  <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_OS2_MUTEX</span>                  <span class="token expression"><span class="token number">1</span></span></span>

<span class="token comment">/* Set the following definitions to 1 to include the API function, or zero
to exclude the API function. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskPrioritySet</span>             <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_uxTaskPriorityGet</span>            <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelete</span>                  <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskCleanUpResources</span>        <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskSuspend</span>                 <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelayUntil</span>              <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_vTaskDelay</span>                   <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetSchedulerState</span>       <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTimerPendFunctionCall</span>       <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xQueueGetMutexHolder</span>         <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_uxTaskGetStackHighWaterMark</span>  <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_xTaskGetCurrentTaskHandle</span>    <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INCLUDE_eTaskGetState</span>                <span class="token expression"><span class="token number">1</span></span></span>

<span class="token comment">/*
 * The CMSIS-RTOS V2 FreeRTOS wrapper is dependent on the heap implementation used
 * by the application thus the correct define need to be enabled below
 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USE_FreeRTOS_HEAP_4</span></span>

<span class="token comment">/* Cortex-M specific definitions. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">__NVIC_PRIO_BITS</span></span>
 <span class="token comment">/* __BVIC_PRIO_BITS will be specified when CMSIS is being used. */</span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configPRIO_BITS</span>         <span class="token expression">__NVIC_PRIO_BITS</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configPRIO_BITS</span>         <span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">/* The lowest interrupt priority that can be used in a call to a "set priority"
function. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configLIBRARY_LOWEST_INTERRUPT_PRIORITY</span>   <span class="token expression"><span class="token number">15</span></span></span>

<span class="token comment">/* The highest interrupt priority that can be used by any interrupt service
routine that makes calls to interrupt safe FreeRTOS API functions.  DO NOT CALL
INTERRUPT SAFE FREERTOS API FUNCTIONS FROM ANY INTERRUPT THAT HAS A HIGHER
PRIORITY THAN THIS! (higher priorities are lower numeric values. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</span> <span class="token expression"><span class="token number">5</span></span></span>

<span class="token comment">/* Interrupt priorities used by the kernel port layer itself.  These are generic
to all Cortex-M ports, and do not rely on any particular library functions. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configKERNEL_INTERRUPT_PRIORITY</span> 		<span class="token expression"><span class="token punctuation">(</span> configLIBRARY_LOWEST_INTERRUPT_PRIORITY <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> configPRIO_BITS<span class="token punctuation">)</span> <span class="token punctuation">)</span></span></span>
<span class="token comment">/* !!!! configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to zero !!!!
See http://www.FreeRTOS.org/RTOS-Cortex-M3-M4.html. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_SYSCALL_INTERRUPT_PRIORITY</span> 	<span class="token expression"><span class="token punctuation">(</span> configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">-</span> configPRIO_BITS<span class="token punctuation">)</span> <span class="token punctuation">)</span></span></span>

<span class="token comment">/* Normal assert() semantics without relying on the provision of an assert.h
header file. */</span>
<span class="token comment">/* USER CODE BEGIN 1 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">configASSERT</span><span class="token expression"><span class="token punctuation">(</span> x <span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token function">taskDISABLE_INTERRUPTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span></span></span>
<span class="token comment">/* USER CODE END 1 */</span>

<span class="token comment">/* Definitions that map the FreeRTOS port interrupt handlers to their CMSIS
standard names. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">vPortSVCHandler</span>    <span class="token expression">SVC_Handler</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xPortPendSVHandler</span> <span class="token expression">PendSV_Handler</span></span>

<span class="token comment">/* IMPORTANT: After 10.3.1 update, Systick_Handler comes from NVIC (if SYS timebase = systick), otherwise from cmsis_os2.c */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">USE_CUSTOM_SYSTICK_HANDLER_IMPLEMENTATION</span> <span class="token expression"><span class="token number">1</span></span></span>

<span class="token comment">/* USER CODE BEGIN Defines */</span>
<span class="token comment">/* Section where parameter definitions can be added (for instance, to override default ones in FreeRTOS.h) */</span>
<span class="token comment">/* USER CODE END Defines */</span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* FREERTOS_CONFIG_H */</span></span>

</code></pre> 
<ul><li> <p>此时进行编译，会有如下错误， 原因是工程中出现了两组<strong>SVC_Handler， PendSV_Handler，</strong> 我们原本工程中有一份，freertos又提供了一份，事实上freertos提供了三组函数供svc异常，PendSV异常，和SysTick中断调用的，函数名字是 <strong>void xPortPendSVHandler( void ); void xPortSysTickHandler( void ); void vPortSVCHandler( void );</strong> 在 <strong>FreeRTOSConfig.h</strong> 中定义了如下宏，在预编译阶段就把freertos提供的函数名改成 <strong>SVC_Handler， PendSV_Handler</strong>了考虑到stm32的HAL库的 <strong>HAL_IncTick()</strong> 也用到了SysTick中断，所以不能将 <strong>void xPortSysTickHandler( void )</strong> 直接改名为 <strong>SysTick_Handler</strong>，而是在 <strong>SysTick_Handler</strong> 中调用一下 <strong>xPortSysTickHandler</strong>。</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">vPortSVCHandler</span>    <span class="token expression">SVC_Handler</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">xPortPendSVHandler</span> <span class="token expression">PendSV_Handler</span></span>
</code></pre> <p><img src="https://images2.imgbox.com/00/5b/iB4bL9Wa_o.png" alt="在这里插入图片描述"></p> 
  <blockquote> 
   <p>总之，把原本工程中的<strong>SVC_Handler， PendSV_Handler</strong>函数删了，在 <strong>SysTick_Handler</strong> 中调用 <strong>xPortSysTickHandler</strong> 和 <strong>HAL_IncTick()</strong> 。</p> 
  </blockquote> </li><li> <p>至此移植已经完成了，编译无错误，无警告。<br> <img src="https://images2.imgbox.com/14/14/35WjZdk6_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h2><a id="3__207"></a>3. 移植需要注意的点</h2> 
<ul><li>移植的过程就是把官方写好的代码加到自己的工程中，主要就是选择移植文件时要选择对应编译器和架构的移植文件。</li><li>硬件架构没什么可说的，应该都选不错。</li><li>选择编译器据需要注意了，核心是选择的编译器要支持对应移植文件的内嵌汇编语法。 
  <ul><li>MDK编译工具链支持两个版本，v5和v6,编译器也由 <strong>armcc</strong> 变成了 <strong>armclang</strong>。<br> <img src="https://images2.imgbox.com/ae/18/8biEHlNl_o.png" alt="在这里插入图片描述"></li><li>如果使用v5编译器，选择 <strong>RVDS</strong> 目录下的文件<br> <img src="https://images2.imgbox.com/85/31/JMyXNtk5_o.png" alt="在这里插入图片描述"></li><li>如果使用v6编译器，选择 <strong>GCC</strong> 目录下的文件，<strong>armclang</strong> 支持的内嵌汇编语法与 <strong>gcc</strong> 兼容<br> <img src="https://images2.imgbox.com/d2/77/BDZSS5Kr_o.png" alt="在这里插入图片描述"></li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/927eebfa3550cf95aa599370c2cc35e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">excel怎么对非数字求和汇总？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9de85d2989da15d63b70ccecd0c57314/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言分支和循环（2）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>