<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable diffusion的SDXL模型，针不错！（含实操） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/83ee7e2793506e80547b7401d2511913/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Stable diffusion的SDXL模型，针不错！（含实操）">
  <meta property="og:description" content="与之前的SD1.5大模型不同，这次的SDXL在架构上采用了“两步走”的生图方式：
以往SD1.5大模型，生成步骤为 Prompt → Base → Image，比较简单直接；而这次的SDXL大模型则是在中间加了一步 Refiner。Refiner的作用是什么呢？简单来说就是能够自动对图像进行优化，提高图像质量和清晰度，减少人工干预的需要。
简单来说，SDXL这种设计就是先用基础模型（Base）生成一张看起来差不多的图片，然后再使用一个图像精修模型（Refiner）进行打磨，从而让图片生成的质量更高。而在没有这个之前，我们往往需要通过其他手段，如高清修复或面部修复来进行调优。
除了有出图质量更高这个优势，SDXL还有以下优点：
支持更高像素的图片（1024 x 1024）
对提示词的理解能力更好，比较简短的提示词也能达到不错的效果
相比SD1.5模型，在断肢断手多指的情况上有所改善
风格更为多样化
当然，每件事物不可能是完美的，所以SDXL也有一些局限性：
1、低像素出图质量不高
由于SDXL都是用1024x1024的图片训练的，这既导致它在这个像素级别上生成的质量比较高。但同时也导致了它在低像素级别（如512x512）生成的质量反而比较低，甚至不如SD1.5等模型。
2、与旧Lora不兼容
过去一些适用于SD1.5, 2.x 的Lora和ControlNet模型，大概率无法使用，得重新找一些带有SDXL的模型
3、对GPU显存的要求更高（这个下面会着重讲到）
4、出图时间也变久了
好了，简单讲完了SDXL大模型以及它的优缺点，接下来就开始实战了！
一、模型的下载 这次模型的下载有点不同，因为我们需要下载三个模型，分别是：sd_xl_base_1.0.safetensors、[1]sd_xl_refiner_1.0.safetensors 和 [2]sdxl_vae.safetensors[3] 。
三个模型的地址分别是：
https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/tree/main
https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0/tree/main
https://huggingface.co/stabilityai/sdxl-vae/tree/main
二、模型的加载 如果你的模型下载好了，就把 sd_xl_base_1.0.safetensors、sd_xl_refiner_1.0.safetensors 丢到根目录的 models\Stable-diffusion，把 sdxl_vae.safetensors 丢到 models\VAE 即可。
需要注意的是 Refiner 模型的加载，看发布日志是 SD1.6.0 的时候才支持，所以如果想使用的话得看你的版本有没有达到。另外就是这里的SD1.6.0指的是内核的版本，并不是模型的版本（不要被各种简写误导了）
内核的版本指的是这里的版本
还有一个需要注意的是貌似升级版本容易有一些不兼容的问题，而且在使用SDXL大模型时也不一定就得用Refiner，单纯使用基础模型（base）也是OK的，只不过效果会差点，所以建议升级前也做一下调研工作。
最后Refiner的位置可能没那么显眼，在生成选项卡里面
三、显存的大小 由于SDXL的模型和出图尺寸比之前的SD1.5大得多，所以也间接导致了它在出图方面所需要的显存和时间也变大了。
那到底需要多少显存呢？网上有一个说法是：跑SDXL最低显存是8G。经过我的测试，这个数据具有一定参考性，在进行一些优化的情况下，8G的显存的确能跑；但如果你什么优化都不做的话，8G的显存是不够的。
我自己的显卡是4060Ti 16G，内存32G，在这个配置的基础上我做了几个小测试（都是1024 x 1024的尺寸）
提示词：
a beatuiful real female play guitar
3.1 不开任何优化 &#43; 不使用Refiner">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-11T14:30:33+08:00">
    <meta property="article:modified_time" content="2024-06-11T14:30:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable diffusion的SDXL模型，针不错！（含实操）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>与之前的SD1.5大模型不同，这次的SDXL在架构上采用了“两步走”的生图方式：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="380" src="https://images2.imgbox.com/f5/b0/vqha5gEy_o.jpg" width="1080"></p> 
<p></p> 
<p>以往SD1.5大模型，生成步骤为 Prompt → Base → Image，比较简单直接；而这次的SDXL大模型则是在中间加了一步 Refiner。Refiner的作用是什么呢？简单来说就是能够自动对图像进行优化，提高图像质量和清晰度，减少人工干预的需要。</p> 
<p></p> 
<p>简单来说，SDXL这种设计就是先用基础模型（Base）生成一张看起来差不多的图片，然后再使用一个图像精修模型（Refiner）进行打磨，从而让图片生成的质量更高。而在没有这个之前，我们往往需要通过其他手段，如高清修复或面部修复来进行调优。</p> 
<p></p> 
<p>除了有出图质量更高这个优势，SDXL还有以下优点：</p> 
<ul><li> <p>支持更高像素的图片（1024 x 1024）</p> </li><li> <p>对提示词的理解能力更好，比较简短的提示词也能达到不错的效果</p> </li><li> <p>相比SD1.5模型，在断肢断手多指的情况上有所改善</p> </li><li> <p>风格更为多样化</p> </li></ul> 
<p></p> 
<p>当然，每件事物不可能是完美的，所以SDXL也有一些局限性：</p> 
<p></p> 
<p>1、低像素出图质量不高</p> 
<p>由于SDXL都是用1024x1024的图片训练的，这既导致它在这个像素级别上生成的质量比较高。但同时也导致了它在低像素级别（如512x512）生成的质量反而比较低，甚至不如SD1.5等模型。</p> 
<p></p> 
<p>2、与旧Lora不兼容</p> 
<p>过去一些适用于SD1.5, 2.x 的Lora和ControlNet模型，大概率无法使用，得重新找一些带有SDXL的模型</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="586" src="https://images2.imgbox.com/e8/4d/mVckPlMO_o.jpg" width="1080"></p> 
<p></p> 
<p><strong>3、</strong>对GPU显存的要求更高（这个下面会着重讲到）</p> 
<p></p> 
<p>4、出图时间也变久了</p> 
<p></p> 
<p>好了，简单讲完了SDXL大模型以及它的优缺点，接下来就开始实战了！</p> 
<p></p> 
<h4>一、模型的下载</h4> 
<p>这次模型的下载有点不同，因为我们需要下载三个模型，分别是：<strong>sd_xl_base_1.0.safetensors、[1]</strong><strong>sd_xl_refiner_1.0.safetensors 和 [2]</strong><strong>sdxl_vae.safetensors[3]</strong> 。</p> 
<p></p> 
<p>三个模型的地址分别是：</p> 
<ul><li> <p>https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/tree/main</p> </li><li> <p>https://huggingface.co/stabilityai/stable-diffusion-xl-refiner-1.0/tree/main</p> </li><li> <p>https://huggingface.co/stabilityai/sdxl-vae/tree/main</p> </li></ul> 
<h4>二、模型的加载</h4> 
<p>如果你的模型下载好了，就把 sd_xl_base_1.0.safetensors、sd_xl_refiner_1.0.safetensors 丢到根目录的 models\Stable-diffusion，把 sdxl_vae.safetensors 丢到 models\VAE 即可。</p> 
<p></p> 
<p>需要注意的是 Refiner 模型的加载，看发布日志是 SD1.6.0 的时候才支持，所以如果想使用的话得看你的版本有没有达到。另外就是这里的SD1.6.0指的是内核的版本，并不是模型的版本（不要被各种简写误导了）</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="592" src="https://images2.imgbox.com/a8/d0/cRNqdwte_o.jpg" width="1080"></p> 
<p></p> 
<p>内核的版本指的是这里的版本</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="468" src="https://images2.imgbox.com/81/2b/fqL1xkOj_o.jpg" width="1080"></p> 
<p></p> 
<p>还有一个需要注意的是貌似升级版本容易有一些不兼容的问题，而且在使用SDXL大模型时也不一定就得用Refiner，单纯使用基础模型（base）也是OK的，只不过效果会差点，所以建议升级前也做一下调研工作。</p> 
<p></p> 
<p>最后Refiner的位置可能没那么显眼，在生成选项卡里面</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="531" src="https://images2.imgbox.com/4f/f7/AaE7RTRK_o.jpg" width="1080"></p> 
<h4>三、显存的大小</h4> 
<p>由于SDXL的模型和出图尺寸比之前的SD1.5大得多，所以也间接导致了它在出图方面所需要的显存和时间也变大了。</p> 
<p></p> 
<p>那到底需要多少显存呢？网上有一个说法是：跑SDXL最低显存是8G。经过我的测试，这个数据具有一定参考性，在进行一些优化的情况下，8G的显存的确能跑；但如果你什么优化都不做的话，8G的显存是不够的。</p> 
<p></p> 
<p>我自己的显卡是4060Ti 16G，内存32G，在这个配置的基础上我做了几个小测试（都是1024 x 1024的尺寸）</p> 
<p></p> 
<p>提示词：</p> 
<p>a beatuiful real female play guitar</p> 
<p></p> 
<p>3.1 不开任何优化 + 不使用Refiner</p> 
<p>第一个测试是在不开任何优化的情况下出图，结果还是出人意料的，居然爆显存了</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="456" src="https://images2.imgbox.com/ce/33/8sGaoMVh_o.jpg" width="1080"></p> 
<p></p> 
<p class="img-center"><img alt="图片" height="513" src="https://images2.imgbox.com/36/ac/RZgBsrwW_o.jpg" width="1070"></p> 
<p></p> 
<p>3.2 不开任何优化 + 使用Refiner</p> 
<p>第二个测试是在第1个的基础上，加了Refiner，但出乎意料的是，并没有爆显存，但从下方的显存使用看，也几乎达到了极限。为什么加了Refiner就没有爆显存我也不太清楚，希望有大佬留言科普下。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="880" src="https://images2.imgbox.com/55/d5/LpwyJ0yE_o.jpg" width="1080"></p> 
<p></p> 
<p>这里也简单说明最下方的A、R、Sys 三个指标：</p> 
<p>💡</p> 
<p>A，Active：peak amount of video memory used during generation（excluding cache data），个人理解就是出图时使用的显存峰值</p> 
<p></p> 
<p>R，Reserved：total amount of video memory allocated by the Torch library，个人理解就是Torch 库使用的显存总量</p> 
<p></p> 
<p>Sys：System：peak amount of video memory allocated by all running programs, out of total capacity，个人理解就是使用显存的占比。</p> 
<p></p> 
<p>3.3 开启VAE模型半精度优化</p> 
<p>这个开了之后（貌似这个不是实时生效的，所以每一次修改后我都会重启），发现其实效果不大，显存的使用率和第二个测试是差不多的。</p> 
<p></p> 
<p>3.4 开启 VAE + UNet模型半精度优化</p> 
<p>加了UNet模型半精度优化，显存使用率下降了一部分（12G差不多能跑），而且出图时间也下降了很多！为什么加了UNet显存使用率会下降明显，看<strong>网上一篇文章[4]</strong>说SDXL用了 larger UNet backbone，猜测是这个原因导致的。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="864" src="https://images2.imgbox.com/03/95/KTkdERV5_o.jpg" width="1080"></p> 
<p></p> 
<p>3.5 开启 VAE + UNet模型半精度优化 + 显存优化</p> 
<p>前面四个测试都是在不开显存优化的情况下进行的，在第五个测试中，开了显存优化后，显存下降会比之前更加明显（比3.4下降了一半），但是出图时间会略长。</p> 
<p></p> 
<p>从这里也可以看出，显存优化的作用还是蛮明显的，不过我也试了中等显存（4GB以上）、仅SDXL中等显存（8GB以上），但是两者并没有明显区别。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="853" src="https://images2.imgbox.com/fc/eb/ovRaSorZ_o.jpg" width="1080"></p> 
<p></p> 
<p>通过上面的测试，我们也可以初步得到：跑SDXL最低显存是8G的说法是有一定准确性的，不过这个准确性大概率是建立在开了半精度优化和显存优化的基础上。如果你的显存达不到8G，除了上面的手段，也可以试试使用共享显存的优化方案，应该还能降一点。</p> 
<h4>四、出图测试</h4> 
<p>4.1 设置图片默认宽高</p> 
<p>秋叶安装包默认的宽高是512x512，但是对于SDXL模型，这个尺寸是不适合的，每次刷新页面后又得调整，就想着能不能把默认值改成 1024x1024.</p> 
<p></p> 
<p>第一步，刷新页面，将尺寸改为 1024x1024</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="260" src="https://images2.imgbox.com/a3/e9/KPF0oe64_o.jpg" width="1080"></p> 
<p></p> 
<p>第二步，在设置里面找到“默认设置”</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="232" src="https://images2.imgbox.com/56/d3/FKgbfoi7_o.jpg" width="1080"></p> 
<p></p> 
<p>第三步，点击应用按钮即可。如果你想看改了啥，还可以点击“查看更改”按钮</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="300" src="https://images2.imgbox.com/21/1f/m7pKVoP3_o.jpg" width="1080"></p> 
<p></p> 
<p>上面的步骤实际改的是ui-config.json 配置的这两个参数，对了，如果要生效必须重启启动器，刷新页面是没用的</p> 
<pre>txt2img/Width/value
txt2img/Height/value
</pre> 
<p></p> 
<p>4.2 提示词理解能力对比</p> 
<p>我给的提示词是上篇文章《<a href="https://mp.weixin.qq.com/s?__biz=Mzg3Mzc1ODU4MQ==&amp;mid=2247484772&amp;idx=1&amp;sn=c06d7237716840a6031a5efd384ba2b9&amp;chksm=ceda6f7ef9ade668b7097ab6701101a9064b801b38cc3805f87456ea1943cb20944aab1ec493&amp;token=870101135&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow" title="Stable diffusion 3：跌宕起伏，或许终见彩虹">Stable diffusion 3：跌宕起伏，或许终见彩虹</a>》测试SD3的</p> 
<p>Epic anime artwork of a wizard atop a mountain at night casting a cosmic spell into the dark sky that says "Stable Diffusion 3" made out of colorful energy</p> 
<p></p> 
<p>可以看到SDXL的对自然语言的提示词的理解能力确定吊打之前的模型</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="545" src="https://images2.imgbox.com/b8/00/TBZgoFPD_o.jpg" width="1080"></p> 
<p></p> 
<p>4.3 文字拼写能力测试</p> 
<p>看网上说SDXL的文字拼写能力比较强，简单来说就是能按要求在图片写字，提示词如下：</p> 
<p>// 用的网上的提示词，字面意思就是在头盔上写 future 英文<br> # a cyberpunk girl is wearing a helmet,the helmet with the words"future" written on it,</p> 
<p></p> 
<p>总体感觉能力肯定是进步的，但比SD3还是差了不少，这也是从出的图里面选几张比较好的</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="360" src="https://images2.imgbox.com/1f/ff/cHylB16k_o.jpg" width="1080"></p> 
<p></p> 
<p>4.4 优秀的提示词借鉴</p> 
<p><strong>50+ Best SDXL Prompts For Breathtaking Images[5]</strong></p> 
<p></p> 
<p></p> 
<p>这是一位SD资深大神整理的，100款Stable Diffusion超实用插件，涵盖目前几乎所有的，主流插件需求。</p> 
<p><strong>全文超过4000字。</strong></p> 
<p>我把它们整理成更适合大家下载安装的【<strong>压缩包</strong>】，无需梯子，并根据具体的内容，<strong>拆解成一二级目录</strong>，以方便大家查阅使用。</p> 
<p>单单排版就差不多花费1个小时。</p> 
<p>希望能让大家在使用Stable Diffusion工具时，可以更好、更快的获得自己想要的答案，以上。</p> 
<p>如果感觉有用，帮忙点个支持，谢谢了。</p> 
<p style="text-align:center;">想要原版100款插件整合包的小伙伴，可以来点击下方插件直接免费获取<img alt="" src="https://images2.imgbox.com/8a/85/5RnVbaTk_o.jpg"></p> 
<p></p> 
<p class="img-center"><img alt="img" height="543" src="https://images2.imgbox.com/a9/b6/F0zjvVLc_o.png" width="647"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb7b8a46bac98bd7a4ffab654c1e306c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">15. 《C语言》——【如何动态内存开辟】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7d2e529701f5d13051ae55c59cafaf25/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C#】pdf按页分割文件，以及分页合并，效果还不错，你值得拥有</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>