<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv9/YOLOv8算法改进【NO.102】涨点&#43;轻量化，亲测有效。引入二次创新模块Faster-EMA，将EMA注意力机制与FasterNet中的核心模块结合构成新模块， - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ea9dabc0612d7d2d4494c95c2c5c1a78/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="YOLOv9/YOLOv8算法改进【NO.102】涨点&#43;轻量化，亲测有效。引入二次创新模块Faster-EMA，将EMA注意力机制与FasterNet中的核心模块结合构成新模块，">
  <meta property="og:description" content="前 言
YOLO算法改进系列出到这，很多朋友问改进如何选择是最佳的，下面我就根据个人多年的写作发文章以及指导发文章的经验来看，按照优先顺序进行排序讲解YOLO算法改进方法的顺序选择。具体有需求的同学可以私信我沟通：
第一，创新主干特征提取网络，将整个Backbone改进为其他的网络，比如这篇文章中的整个方法，直接将Backbone替换掉，理由是这种改进如果有效果，那么改进点就很值得写，不算是堆积木那种，也可以说是一种新的算法，所以做实验的话建议朋友们优先尝试这种改法。
第二，创新特征融合网络，这个同理第一，比如将原yolo算法PANet结构改进为Bifpn等。
第三，改进主干特征提取网络，就是类似加个注意力机制等。根据个人实验情况来说，这种改进有时候很难有较大的检测效果的提升，乱加反而降低了特征提取能力导致mAP下降，需要有技巧的添加。
第四，改进特征融合网络，理由、方法等同上。
第五，改进检测头，更换检测头这种也算个大的改进点。
第六，改进损失函数，nms、框等，要是有提升检测效果的话，算是一个小的改进点，也可以凑字数。
第七，对图像输入做改进，改进数据增强方法等。
第八，剪枝以及蒸馏等，这种用于特定的任务，比如轻量化检测等，但是这种会带来精度的下降。
...........未完待续
一、创新改进思路或解决的问题 将FasterNet中的核心模块进行改进，通过引入EMA注意力机制的方法，当然也可以引入或者组合其他的模块构建新的网络结构，再引入到YOLOv8代码中，提高算法的检测效果，通过实验证明，改进方法在大部分数据集上是有效果的。
具体改进思路方法是在下面结构图中的FasterNet Block末尾添加上EMA注意力机制。
二、基本原理 原文代码： GitHub - JierunChen/FasterNet: [CVPR 2023] Code for PConv and FasterNet
​摘要：为了设计快速神经网络，许多工作都集中在减少浮点运算（FLOP）的数量上。然而，我们观察到FLOP的这种减少并不一定会导致类似水平的延迟减少。这主要源于低效率的每秒浮点运算（FLOPS）。为了实现更快的网络，我们重新审视了流行的运营商，并认为如此低的FLOPS主要是由于运营商的频繁内存访问，尤其是深度进化。因此，我们提出了一种新的部分卷积（PConv），通过同时减少冗余计算和内存访问，可以更有效地提取空间特征。在PConv的基础上，我们进一步提出了FasterNet，这是一种新的神经网络家族，它在各种设备上的运行速度远高于其他网络，而不会影响各种视觉任务的准确性。例如，在ImageNet-1k上，我们的小型FasterNet-T0在GPU、CPU和ARM处理器上分别比MobileViT XXS快2.8倍、3.3倍和2.4倍，同时准确率高2.9%。我们的大型FasterNet-L实现了令人印象深刻的83.5%的前1级精度，与新兴的Swin-B不相上下，同时在GPU上的参考吞吐量提高了36%，并在CPU上节省了37%的计算时间。
三、​添加方法 第一步：新增网络结构yaml
# Ultralytics YOLO 🚀, AGPL-3.0 license # YOLOv8 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect # Parameters nc: 80 # number of classes scales: # model compound scaling constants, i.e. &#39;model=yolov8n.yaml&#39; will call yolov8.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-12T13:03:27+08:00">
    <meta property="article:modified_time" content="2024-03-12T13:03:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv9/YOLOv8算法改进【NO.102】涨点&#43;轻量化，亲测有效。引入二次创新模块Faster-EMA，将EMA注意力机制与FasterNet中的核心模块结合构成新模块，</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong> 前   言</strong><br><strong>       YOLO算法改进系列出到这，很多朋友问改进如何选择是最佳的，下面我就根据个人多年的写作发文章以及指导发文章的经验来看，按照优先顺序进行排序讲解YOLO算法改进方法的顺序选择。具体有需求的同学可以私信我沟通：</strong></p> 
 <p><strong>第一，</strong>创新主干特征提取网络，将整个Backbone改进为其他的网络，<strong>比如这篇文章中的整个方法，直接将Backbone替换掉，</strong>理由是这种改进如果有效果，那么改进点就很值得写，不算是堆积木那种，也可以说是一种新的算法，所以做实验的话建议朋友们优先尝试这种改法。</p> 
 <p>第二，创新特征融合网络，这个同理第一，比如将原yolo算法PANet结构改进为Bifpn等。</p> 
 <p>第三，改进主干特征提取网络，就是类似加个注意力机制等。根据个人实验情况来说，这种改进有时候很难有较大的检测效果的提升，乱加反而降低了特征提取能力导致mAP下降，需要有技巧的添加。</p> 
 <p>第四，改进特征融合网络，理由、方法等同上。</p> 
 <p>第五，改进检测头，更换检测头这种也算个大的改进点。</p> 
 <p>第六，改进损失函数，nms、框等，要是有提升检测效果的话，算是一个小的改进点，也可以凑字数。</p> 
 <p>第七，对图像输入做改进，改进数据增强方法等。</p> 
 <p>第八，剪枝以及蒸馏等，这种用于特定的任务，比如轻量化检测等，但是这种会带来精度的下降。</p> 
 <p>...........未完待续</p> 
</blockquote> 
<h4>一、创新改进思路或解决的问题</h4> 
<p>将FasterNet中的核心模块进行改进，通过引入EMA注意力机制的方法，当然也可以引入或者组合其他的模块构建新的网络结构，再引入到YOLOv8代码中，提高算法的检测效果，通过实验证明，改进方法在大部分数据集上是有效果的。</p> 
<p><span style="color:#ffd900;"><span style="background-color:#fe2c24;">具体改进思路方法是在下面结构图中的FasterNet Block末尾添加上EMA注意力机制。</span></span></p> 
<p><img alt="" height="417" src="https://images2.imgbox.com/c3/ca/zRlMpZBW_o.png" width="955"></p> 
<h4>二、基本原理 </h4> 
<p>原文代码： <a href="https://github.com/JierunChen/FasterNet" title="GitHub - JierunChen/FasterNet: [CVPR 2023] Code for PConv and FasterNet">GitHub - JierunChen/FasterNet: [CVPR 2023] Code for PConv and FasterNet</a></p> 
<p><img alt="" height="461" src="https://images2.imgbox.com/af/c6/35C33ynr_o.png" width="1058"></p> 
<p></p> 
<p style="text-align:justify;"> ​<strong>摘要</strong>：为了设计快速神经网络，许多工作都集中在减少浮点运算（FLOP）的数量上。然而，我们观察到FLOP的这种减少并不一定会导致类似水平的延迟减少。这主要源于低效率的每秒浮点运算（FLOPS）。为了实现更快的网络，我们重新审视了流行的运营商，并认为如此低的FLOPS主要是由于运营商的频繁内存访问，尤其是深度进化。因此，我们提出了一种新的部分卷积（PConv），通过同时减少冗余计算和内存访问，可以更有效地提取空间特征。在PConv的基础上，我们进一步提出了FasterNet，这是一种新的神经网络家族，它在各种设备上的运行速度远高于其他网络，而不会影响各种视觉任务的准确性。例如，在ImageNet-1k上，我们的小型FasterNet-T0在GPU、CPU和ARM处理器上分别比MobileViT XXS快2.8倍、3.3倍和2.4倍，同时准确率高2.9%。我们的大型FasterNet-L实现了令人印象深刻的83.5%的前1级精度，与新兴的Swin-B不相上下，同时在GPU上的参考吞吐量提高了36%，并在CPU上节省了37%的计算时间。</p> 
<p><img alt="" height="468" src="https://images2.imgbox.com/59/ba/aDrbYcb2_o.png" width="1065"></p> 
<p><img alt="" height="534" src="https://images2.imgbox.com/7f/21/UPBmeNda_o.png" width="986"></p> 
<h4>三、​添加方法</h4> 
<p><strong>第一步：新增网络结构yaml</strong></p> 
<pre><code># Ultralytics YOLO 🚀, AGPL-3.0 license
# YOLOv8 object detection model with P3-P5 outputs. For Usage examples see https://docs.ultralytics.com/tasks/detect

# Parameters
nc: 80  # number of classes
scales: # model compound scaling constants, i.e. 'model=yolov8n.yaml' will call yolov8.yaml with scale 'n'
  # [depth, width, max_channels]
  n: [0.33, 0.25, 1024]  # YOLOv8n summary: 225 layers,  3157200 parameters,  3157184 gradients,   8.9 GFLOPs
  s: [0.33, 0.50, 1024]  # YOLOv8s summary: 225 layers, 11166560 parameters, 11166544 gradients,  28.8 GFLOPs
  m: [0.67, 0.75, 768]   # YOLOv8m summary: 295 layers, 25902640 parameters, 25902624 gradients,  79.3 GFLOPs
  l: [1.00, 1.00, 512]   # YOLOv8l summary: 365 layers, 43691520 parameters, 43691504 gradients, 165.7 GFLOPs
  x: [1.00, 1.25, 512]   # YOLOv8x summary: 365 layers, 68229648 parameters, 68229632 gradients, 258.5 GFLOPs

# YOLOv8.0n backbone
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]]  # 1-P2/4
  - [-1, 3, C2f_Faster_EMA, [128, True]]
  - [-1, 1, Conv, [256, 3, 2]]  # 3-P3/8
  - [-1, 6, C2f_Faster_EMA, [256, True]]
  - [-1, 1, Conv, [512, 3, 2]]  # 5-P4/16
  - [-1, 6, C2f_Faster_EMA, [512, True]]
  - [-1, 1, Conv, [1024, 3, 2]]  # 7-P5/32
  - [-1, 3, C2f_Faster_EMA, [1024, True]]
  - [-1, 1, SPPF, [1024, 5]]  # 9

# YOLOv8.0n head
head:
  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [[-1, 6], 1, Concat, [1]]  # cat backbone P4
  - [-1, 3, C2f_Faster_EMA, [512]]  # 12

  - [-1, 1, nn.Upsample, [None, 2, 'nearest']]
  - [[-1, 4], 1, Concat, [1]]  # cat backbone P3
  - [-1, 3, C2f_Faster_EMA, [256]]  # 15 (P3/8-small)

  - [-1, 1, Conv, [256, 3, 2]]
  - [[-1, 12], 1, Concat, [1]]  # cat head P4
  - [-1, 3, C2f_Faster_EMA, [512]]  # 18 (P4/16-medium)

  - [-1, 1, Conv, [512, 3, 2]]
  - [[-1, 9], 1, Concat, [1]]  # cat head P5
  - [-1, 3, C2f_Faster_EMA, [1024]]  # 21 (P5/32-large)

  - [[15, 18, 21], 1, Detect, [nc]]  # Detect(P3, P4, P5)
</code></pre> 
<p><strong>第二步：在block.py中注册模块</strong></p> 
<pre><code>######################################## C2f-Faster-EMA begin ########################################

class Faster_Block_EMA(nn.Module):
    def __init__(self,
                 inc,
                 dim,
                 n_div=4,
                 mlp_ratio=2,
                 drop_path=0.1,
                 layer_scale_init_value=0.0,
                 pconv_fw_type='split_cat'
                 ):
        super().__init__()
        self.dim = dim
        self.mlp_ratio = mlp_ratio
        self.drop_path = DropPath(drop_path) if drop_path &gt; 0. else nn.Identity()
        self.n_div = n_div

        mlp_hidden_dim = int(dim * mlp_ratio)

        mlp_layer = [
            Conv(dim, mlp_hidden_dim, 1),
            nn.Conv2d(mlp_hidden_dim, dim, 1, bias=False)
        ]

        self.mlp = nn.Sequential(*mlp_layer)

        self.spatial_mixing = Partial_conv3(
            dim,
            n_div,
            pconv_fw_type
        )
        self.attention = EMA(dim)
        
        self.adjust_channel = None
        if inc != dim:
            self.adjust_channel = Conv(inc, dim, 1)

        if layer_scale_init_value &gt; 0:
            self.layer_scale = nn.Parameter(layer_scale_init_value * torch.ones((dim)), requires_grad=True)
            self.forward = self.forward_layer_scale
        else:
            self.forward = self.forward

    def forward(self, x):
        if self.adjust_channel is not None:
            x = self.adjust_channel(x)
        shortcut = x
        x = self.spatial_mixing(x)
        x = shortcut + self.attention(self.drop_path(self.mlp(x)))
        return x

    def forward_layer_scale(self, x):
        shortcut = x
        x = self.spatial_mixing(x)
        x = shortcut + self.drop_path(self.layer_scale.unsqueeze(-1).unsqueeze(-1) * self.mlp(x))
        return x

class C3_Faster_EMA(C3):
    def __init__(self, c1, c2, n=1, shortcut=False, g=1, e=0.5):
        super().__init__(c1, c2, n, shortcut, g, e)
        c_ = int(c2 * e)  # hidden channels
        self.m = nn.Sequential(*(Faster_Block_EMA(c_, c_) for _ in range(n)))

class C2f_Faster_EMA(C2f):
    def __init__(self, c1, c2, n=1, shortcut=False, g=1, e=0.5):
        super().__init__(c1, c2, n, shortcut, g, e)
        self.m = nn.ModuleList(Faster_Block_EMA(self.c, self.c) for _ in range(n))

######################################## C2f-Faster-EMA end ########################################</code></pre> 
<p> 第三步：在task.py中注册该模块</p> 
<pre><code>       if m in (Classify, Conv, ConvTranspose, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, Focus,
                 BottleneckCSP, C1, C2, C2f, C3, C3TR, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x, RepC3, C2f_Faster, C2f_ODConv,
                 C2f_Faster_EMA,</code></pre> 
<p>若有疑问可私信我。</p> 
<p><strong>四、总结</strong></p> 
<p>预告一下：下一篇内容将继续分享深度学习算法相关改进方法。有兴趣的朋友可以关注一下我，有问题可以留言或者私聊我哦</p> 
<p>PS：该方法不仅仅是适用改进YOLOv8，也可以改进其他的YOLO网络以及目标检测网络，比如YOLOv7、v6、v4、v3，Faster rcnn ，ssd等。</p> 
<blockquote>
  最后，有需要的请关注私信我吧。关注免费领取深度学习算法学习资料！ 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ad92eb4cedacd14ddcfe4e046645bb99/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43; Qt开发：QNetworkAccessManager网络接口组件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f86f2ddcff9fc3f1a152ede7aad51e41/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">苹果电脑Mac笔记本听歌神器洛雪音乐&#43;六音音源来了，详细教程，附下载地址！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>