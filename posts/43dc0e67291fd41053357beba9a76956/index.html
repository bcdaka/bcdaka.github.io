<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv8制作自己的实例分割数据集保姆级教程（包含json转txt） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/43dc0e67291fd41053357beba9a76956/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="YOLOv8制作自己的实例分割数据集保姆级教程（包含json转txt）">
  <meta property="og:description" content="1.数据准备 首先对原始数据集进行整理，将标注好的图像和标签分别放在两个文件夹中，同时额外新建两个文件夹，用于存放转换完的标签与划分后的数据集。
1.1将json格式文件转换为txt格式 新建json2txt.py文件，将代码中的文件路径修改为自己的路径。
❗❗❗代码中第43行的classes中存放的是自己数据集的分类标签，记得修改成自己的。
import json import os from tqdm import tqdm def convert_label(json_dir, save_dir, classes): json_paths = os.listdir(json_dir) classes = classes.split(&#39;,&#39;) for json_path in tqdm(json_paths): path = os.path.join(json_dir, json_path) with open(path, &#39;r&#39;) as load_f: json_dict = json.load(load_f) h, w = json_dict[&#39;imageHeight&#39;], json_dict[&#39;imageWidth&#39;] # save txt path txt_path = os.path.join(save_dir, json_path.replace(&#39;json&#39;, &#39;txt&#39;)) txt_file = open(txt_path, &#39;w&#39;) for shape_dict in json_dict[&#39;shapes&#39;]: label = shape_dict[&#39;label&#39;] label_index = classes.index(label) points = shape_dict[&#39;points&#39;] points_nor_list = [] for point in points: points_nor_list.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-24T11:03:34+08:00">
    <meta property="article:modified_time" content="2024-05-24T11:03:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv8制作自己的实例分割数据集保姆级教程（包含json转txt）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.数据准备</h2> 
<p>首先对原始数据集进行整理，将标注好的图像和标签分别放在两个文件夹中，同时额外新建两个文件夹，用于存放转换完的标签与划分后的数据集。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ac/1a/pyEXjd2d_o.png"></p> 
<h3>1.1将json格式文件转换为txt格式</h3> 
<p>新建json2txt.py文件，将代码中的文件路径修改为自己的路径。</p> 
<p>❗❗❗代码中第43行的classes中存放的是自己数据集的分类标签，记得修改成自己的。</p> 
<pre><code class="language-python">import json
import os
from tqdm import tqdm


def convert_label(json_dir, save_dir, classes):
    json_paths = os.listdir(json_dir)
    classes = classes.split(',')

    for json_path in tqdm(json_paths):

        path = os.path.join(json_dir, json_path)
        with open(path, 'r') as load_f:
            json_dict = json.load(load_f)
        h, w = json_dict['imageHeight'], json_dict['imageWidth']

        # save txt path
        txt_path = os.path.join(save_dir, json_path.replace('json', 'txt'))
        txt_file = open(txt_path, 'w')

        for shape_dict in json_dict['shapes']:
            label = shape_dict['label']
            label_index = classes.index(label)
            points = shape_dict['points']

            points_nor_list = []

            for point in points:
                points_nor_list.append(point[0] / w)
                points_nor_list.append(point[1] / h)

            points_nor_list = list(map(lambda x: str(x), points_nor_list))
            points_nor_str = ' '.join(points_nor_list)

            label_str = str(label_index) + ' ' + points_nor_str + '\n'
            txt_file.writelines(label_str)


if __name__ == "__main__":

    json_dir = 'E:/segmentation_dataset/json'
    save_dir = 'E:/segmentation_dataset/txt'
    classes = 'material,inner_material,hole'

    convert_label(json_dir, save_dir, classes)
</code></pre> 
<h3>1.2划分数据集</h3> 
<p>新建splitDataset.py，将代码中的文件路径修改为自己的路径。</p> 
<p>数据集的划分比例可以按自己的需求修改。</p> 
<pre><code class="language-python">import shutil
import random
import os


# 检查文件夹是否存在
def mkdir(path):
    if not os.path.exists(path):
        os.makedirs(path)


def split(image_dir, txt_dir, save_dir):
    # 创建文件夹
    mkdir(save_dir)
    images_dir = os.path.join(save_dir, 'images')
    labels_dir = os.path.join(save_dir, 'labels')

    img_train_path = os.path.join(images_dir, 'train')
    img_test_path = os.path.join(images_dir, 'test')
    img_val_path = os.path.join(images_dir, 'val')

    label_train_path = os.path.join(labels_dir, 'train')
    label_test_path = os.path.join(labels_dir, 'test')
    label_val_path = os.path.join(labels_dir, 'val')

    mkdir(images_dir)
    mkdir(labels_dir)
    mkdir(img_train_path)
    mkdir(img_test_path)
    mkdir(img_val_path)
    mkdir(label_train_path)
    mkdir(label_test_path)
    mkdir(label_val_path)

    # 数据集划分比例，训练集75%，验证集15%，测试集15%，按需修改
    train_percent = 0.8
    val_percent = 0.1
    test_percent = 0.1

    total_txt = os.listdir(txt_dir)
    num_txt = len(total_txt)
    list_all_txt = range(num_txt)  # 范围 range(0, num)

    num_train = int(num_txt * train_percent)
    num_val = int(num_txt * val_percent)
    num_test = num_txt - num_train - num_val

    train = random.sample(list_all_txt, num_train)
    # 在全部数据集中取出train
    val_test = [i for i in list_all_txt if not i in train]
    # 再从val_test取出num_val个元素，val_test剩下的元素就是test
    val = random.sample(val_test, num_val)

    print("训练集数目：{}, 验证集数目：{},测试集数目：{}".format(len(train), len(val), len(val_test) - len(val)))
    for i in list_all_txt:
        name = total_txt[i][:-4]

        srcImage = os.path.join(image_dir, name + '.jpg')
        srcLabel = os.path.join(txt_dir, name + '.txt')

        if i in train:
            dst_train_Image = os.path.join(img_train_path, name + '.jpg')
            dst_train_Label = os.path.join(label_train_path, name + '.txt')
            shutil.copyfile(srcImage, dst_train_Image)
            shutil.copyfile(srcLabel, dst_train_Label)
        elif i in val:
            dst_val_Image = os.path.join(img_val_path, name + '.jpg')
            dst_val_Label = os.path.join(label_val_path, name + '.txt')
            shutil.copyfile(srcImage, dst_val_Image)
            shutil.copyfile(srcLabel, dst_val_Label)
        else:
            dst_test_Image = os.path.join(img_test_path, name + '.jpg')
            dst_test_Label = os.path.join(label_test_path, name + '.txt')
            shutil.copyfile(srcImage, dst_test_Image)
            shutil.copyfile(srcLabel, dst_test_Label)


if __name__ == '__main__':

    image_dir = 'E:/segmentation_dataset/images'
    txt_dir = 'E:/segmentation_dataset/txt'
    save_dir = 'E:/segmentation_dataset/dataset'

    split(image_dir, txt_dir, save_dir)
</code></pre> 
<p><strong>运行完后得到如下文件：</strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a5/4f/XP861zFJ_o.png"></p> 
<p>dataset中分别存放有划分好的图片数据和标注数据。</p> 
<p><strong>到此，数据集制作完毕！ </strong></p> 
<h2><strong>2.</strong>训练设置</h2> 
<h3>2.1新建segmentation.yaml文件</h3> 
<p> 按照如下格式在yolov8工程的datasets文件夹下进行新建，路径修改为自己的路径，对应的分类标签也修改为自己的。</p> 
<pre><code class="language-python">train: E:\segmentation_dataset\dataset\images\train  # train images (relative to 'path') 128 images
val: E:\segmentation_dataset\dataset\images\val  # val images (relative to 'path') 128 images
test: E:\segmentation_dataset\dataset\images\test  # test images (optional)

# Classes
names:
  0: material
  1: inner_material
  2: hole
</code></pre> 
<h3>2.2训练参数设置 </h3> 
<p>配置参数如下图所示：</p> 
<h3><img alt="" src="https://images2.imgbox.com/64/3d/UwFc9XiP_o.png"></h3> 
<p> 以上常用参数解释如下：</p> 
<p>📌task：选择任务类型，可选['detect', 'segment', 'classify', 'pose']。</p> 
<p>📌mode: 选择是训练、验证、预测和导出模型等，可选['train', 'val', 'predict', 'export', 'track', 'benchmark']。</p> 
<p>📌model: 选择yolov8不同的模型配置文件，可选yolov8s-seg.pt、yolov8m-seg.pt、yolov8x-seg.pt等（提供了n、s、m、l、x版本，随着架构的增大，训练时间也是逐渐增大，需要根据自身设备硬件配置合理选择）。</p> 
<p>❗❗❗注意model最好去github上提前下载好，放在如图所示的指定位置，如果没提前下载运行时会自动下载，但是下载速度可能非常非常慢。</p> 
<p>yolov8官方权重下载地址：</p> 
<p><a class="link-info has-card" href="https://github.com/ultralytics/ultralytics?tab=readme-ov-file" title="https://github.com/ultralytics/ultralytics?tab=readme-ov-file"><span class="link-card-box"><span class="link-title">https://github.com/ultralytics/ultralytics?tab=readme-ov-file</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/be/4e/XGcfcoK0_o.png" alt="icon-default.png?t=N7T8">https://github.com/ultralytics/ultralytics?tab=readme-ov-file</span></span></a></p> 
<p>📌data: 选择生成的数据集配置文件。</p> 
<p>📌epochs：训练过程中整个数据集的迭代次数。</p> 
<p>📌batch：一次看完多少张图片才进行权重更新，梯度下降的mini-batch，提示爆显存就需要调小一点。</p> 
<p>📌imgsz：输入图片的尺寸大小。</p> 
<p>📌workers：用于数据加载的工作线程数。</p> 
<p>📌project：训练工程名称。</p> 
<p>📌name：保存训练结果的文件夹名称。</p> 
<p>📌resume：从最后一个检查点恢复训练，即模型训练的断点接续，可选False或True。</p> 
<p><strong>完成配置后，开始进行训练即可！</strong></p> 
<p><span style="color:#fe2c24;"><strong>另外，如果有想了解yolov8目标检测数据集制作以及YOLOv8目标检测 opencv模型部署的小伙伴可以移步我的其他文章</strong></span></p> 
<p id="articleContentId"><strong><a class="link-info has-card" href="https://blog.csdn.net/m0_57010556/article/details/135460191?spm=1001.2014.3001.5502" title="YOLOv8制作自己的目标检测数据集保姆级教程（包含json转xml转txt）"><span class="link-card-box"><span class="link-title">YOLOv8制作自己的目标检测数据集保姆级教程（包含json转xml转txt）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/7d/52/hc08jExk_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/m0_57010556/article/details/135460191?spm=1001.2014.3001.5502</span></span></a></strong></p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/m0_57010556/article/details/139109317?spm=1001.2014.3001.5502" title="YOLOv8目标检测 opencv模型部署保姆级教程（包含opencv环境配置）"><span class="link-card-box"><span class="link-title">YOLOv8目标检测 opencv模型部署保姆级教程（包含opencv环境配置）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/c8/5f/2FpVQHPT_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/m0_57010556/article/details/139109317?spm=1001.2014.3001.5502</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/41db53590e5e8f0fb9769f568c11c247/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端项目部署自动检测更新后通知用户刷新页面（前端实现，技术框架vue、js、webpack）——方案二：轮询去判断服务端的index.html是否跟当前的index.html的脚本hash值一样</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d2cded2e4413803d95c574019f0dfb3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C/C&#43;&#43;运行时库和UCRT系统通用运行时库总结及问题实例分享</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>