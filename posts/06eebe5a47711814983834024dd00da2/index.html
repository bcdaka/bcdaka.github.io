<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux应用】Linux系统的设备管理——Udev - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/06eebe5a47711814983834024dd00da2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Linux应用】Linux系统的设备管理——Udev">
  <meta property="og:description" content="1.udev概述 udev是 Linux2.6内核里的一个功能，它替代了原来的 devfs，成为当前 Linux 默认的设备管理工具，能够根据系统中的硬件设备的状态动态更新设备文件，包括设备文件的创建，删除等。
udev以守护进程的形式运行，通过帧听内核发出来的uevent来管理/dev目录下的设备文件。不像之前的设备管理工具，udev在用户空间运行，而不在内核空间运行。
udev会根据/etc/udev/udev.conf文件中的udev_rules指定的目录，逐个检查该目录下的文件，这个目录下的文件都是针对某类或某个设备应该施行什么措施的规则文件。
2.udev作用 Udev用于动态管理设备的设备管理器，主要是在设备插入或移除时，负责管理与这些事件相关联设备节点以及执行相应动作。
设备发现和管理：udev负责在 Linux 系统中检测和管理设备。当新设备插入或旧设备被移除时，udev负责识别这些变化，并在 /dev 目录下创建或删除相应的设备节点。
1.设备命名：Udev为设备节点提供了一个规范的命名机制，以便用户和应用程序能够更容易地识别设备。这有助于确保相同类型的设备在不同系统上都有相似的设备节点名称。
2.热插拔支持：Udev支持热插拔设备，即在系统运行时插入或移除设备。它可以动态地更新设备节点，而无需重新启动系统。
3.规则系统：Udev使用规则文件来定义在设备事件发生时要执行的操作。这些规则可以基于设备属性、类型和其他标识符来匹配。规则允许用户执行自定义脚本、设置环境变量、创建符号链接等操作。
4.持久化设备节点：Udev提供了机制，以确保设备节点的稳定性。即使设备在重新启动后未连接，Udev仍会分配相同的设备节点名称，以便应用程序可以依赖特定的设备节点。
5.提供额外信息：Udev为每个设备节点提供了大量的额外信息，例如设备类型、设备路径、驱动程序信息等。这些信息可用于用户空间的应用程序，以更好地理解和利用系统中的设备。
所有设备在Linux是以设备文件的形式存在，在早期的Linux版本中，/dev目录包含了所有可能出现的设备的设备文件。很难想想Linux用户如何在这些大量的设备文件中找到匹配条件的设备文件。现在udev只为那些连接到Linux操作系统的设备产生设备文件。并且udev能通过定义一个udev规则rule来产生匹配设备属性的设备文件，这些设备属性可以是内核设备名称、总线路径、厂商名称、型号、序列号或者磁盘大小等。
1.动态管理：当设备添加/删除时，udev守护进行帧听来自内核的 uevent，以此添加或者删除 /dev下的设备文件，所以udev只为已经连接的设备产生设备文件，而不会在 /dev 下产生大量虚无的设备文件。
2.自定义命名规则：通过 Linux 默认的规则文件，udev在/dev/ 里为所有的设备定义了内核设备名称，比如 /dev/sda、/dev/hda、/dev/fd 等等。由于udev是在用户空间运行，Linux 用户可以通过自定义的规则文件，灵活地产生标识性强的设备文件名，比如 /dev/boot_disk、/dev/root_disk、/dev/color_printer 等等。
3.设定设备的权限和所有者/组：udev可以按一定的条件来设置设备文件的权限和设备文件所有者/组。在不同的udev版本中，实现的方法不同，在 “如何配置和使用udev” 中会详解。
有匹配规则 没有规则匹配 内核检测到新设备 udevd接收设备信息 删除/dev目录中的设备文件 生成uevent 查找规则文件 创建设备文件 使用内核设备名创建文件 3.配置udev 配置使用udev通常涉及创建和编辑udev规则，这些规则定义了设备在系统中行为。在使用udev之前，了解一些基本概念，例如subsystem、KERNEL、ACTION等。
键含义ACTION事件 (uevent) 的行为，例如：add( 添加设备 )、remove( 删除设备 )。KERNEL在内核里看到的设备名字，比如sd*表示任意SCSI磁盘设备DEVPATH内核设备路径，比如/devices/*SUBSYSTEM子系统名字，例如：sda 的子系统为 block。BUS总线的名字，比如IDE,USB，iscsiDRIVER设备驱动的名字，比如ide-cdromID独立于内核名字的设备名字SYSFS{value}sysfs属性值，可以表示任意ENV{key}环境变量，可以表示任意PROGRAM可执行的外部程序，如果程序返回0值，该键则认为为真(true)RESULT上一个PROGRAM调用返回的标准输出。NAME根据这个规则创建的设备文件的文件名。注意：仅仅第一行的NAME描述是有效的，后面的均忽略。如果你想使用使用两个以上的名字来访问一个设备的话，可以考虑SYMLINK键。SYMLINK为/dev/下的设备文件产生符号链接。由于udev只能为某个设备产生一个设备文件，所以为了不覆盖系统默认的 udev 规则所产生的文件，推荐使用符号链接。OWNER设备文件的属组GROUP设备文件所在的组。MODE设备文件的权限，采用8进制RUN为设备而执行的程序列表LABEL在配置文件里为内部控制而采用的名字标签(下面的GOTO服务)GOTO跳到匹配的规则（通过LABEL来标识），有点类似程序语言中的GOTOIMPORT{type}导入一个文件或者一个程序执行后而生成的规则集到当前文件WAIT_FOR_SYSFS等待一个特定的设备文件的创建。主要是用作时序和依赖问题。OPTIONS特定的选项：last_rule 对这类设备终端规则执行；ignore_device 忽略当前规则；ignore_remove 忽略接下来的并移走请求。all_partitions 为所有的磁盘分区创建设备文件。 在/etc/udev/rules.d/目录下，有一些默认的udev规则文件，例如70-persistent-net.rules。可通过创建新的规则文件或编辑已有的规则文件来定义udev规则。规则文件的命名约定是以数字和描述性名称开头，例如10-local.rules。数字决定了规则的优先级，数字越小，规则越早被处理。
KERNEL==”*”, OWNER=”root” GROUP=”root”, MODE=”0600″ KERNEL==”tty”, NAME=”%k”, GROUP=”tty”, MODE=”0666″, OPTIONS=”last_rule” KERNEL==”scd[0-9]*”, SYMLINK&#43;=”cdrom cdrom-%k” KERNEL==”hd[a-z]”, BUS==”ide”, SYSFS{removable}==”1″, SYSFS{device/media}==”cdrom”, SYMLINK&#43;=”cdrom cdrom-%k” ACTION==”add”, SUBSYSTEM==”scsi_device”, RUN&#43;=”/sbin/modprobe sg” 上面的例子给出了5个规则，每一个都是KERNEL或者ACTION键开头：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-15T14:32:59+08:00">
    <meta property="article:modified_time" content="2024-06-15T14:32:59+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux应用】Linux系统的设备管理——Udev</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1udev_0"></a>1.udev概述</h2> 
<p>udev是 Linux2.6内核里的一个功能，它替代了原来的 devfs，成为当前 Linux 默认的设备管理工具，能够根据系统中的硬件设备的状态动态更新设备文件，包括设备文件的创建，删除等。<br> udev以守护进程的形式运行，通过帧听内核发出来的uevent来管理/dev目录下的设备文件。不像之前的设备管理工具，udev在用户空间运行，而不在内核空间运行。<br> udev会根据/etc/udev/udev.conf文件中的udev_rules指定的目录，逐个检查该目录下的文件，这个目录下的文件都是针对某类或某个设备应该施行什么措施的规则文件。<br> <img src="https://images2.imgbox.com/e0/08/Fmol8dsq_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2udev_5"></a>2.udev作用</h2> 
<p>Udev用于动态管理设备的设备管理器，主要是在设备插入或移除时，负责管理与这些事件相关联设备节点以及执行相应动作。<br> 设备发现和管理：udev负责在 Linux 系统中检测和管理设备。当新设备插入或旧设备被移除时，udev负责识别这些变化，并在 /dev 目录下创建或删除相应的设备节点。</p> 
<p>1.设备命名：Udev为设备节点提供了一个规范的命名机制，以便用户和应用程序能够更容易地识别设备。这有助于确保相同类型的设备在不同系统上都有相似的设备节点名称。</p> 
<p>2.热插拔支持：Udev支持热插拔设备，即在系统运行时插入或移除设备。它可以动态地更新设备节点，而无需重新启动系统。</p> 
<p>3.规则系统：Udev使用规则文件来定义在设备事件发生时要执行的操作。这些规则可以基于设备属性、类型和其他标识符来匹配。规则允许用户执行自定义脚本、设置环境变量、创建符号链接等操作。</p> 
<p>4.持久化设备节点：Udev提供了机制，以确保设备节点的稳定性。即使设备在重新启动后未连接，Udev仍会分配相同的设备节点名称，以便应用程序可以依赖特定的设备节点。</p> 
<p>5.提供额外信息：Udev为每个设备节点提供了大量的额外信息，例如设备类型、设备路径、驱动程序信息等。这些信息可用于用户空间的应用程序，以更好地理解和利用系统中的设备。</p> 
<p>所有设备在Linux是以设备文件的形式存在，在早期的Linux版本中，/dev目录包含了所有可能出现的设备的设备文件。很难想想Linux用户如何在这些大量的设备文件中找到匹配条件的设备文件。现在udev只为那些连接到Linux操作系统的设备产生设备文件。并且udev能通过定义一个udev规则rule来产生匹配设备属性的设备文件，这些设备属性可以是内核设备名称、总线路径、厂商名称、型号、序列号或者磁盘大小等。</p> 
<p>1.动态管理：当设备添加/删除时，udev守护进行帧听来自内核的 uevent，以此添加或者删除 /dev下的设备文件，所以udev只为已经连接的设备产生设备文件，而不会在 /dev 下产生大量虚无的设备文件。<br> 2.自定义命名规则：通过 Linux 默认的规则文件，udev在/dev/ 里为所有的设备定义了内核设备名称，比如 /dev/sda、/dev/hda、/dev/fd 等等。由于udev是在用户空间运行，Linux 用户可以通过自定义的规则文件，灵活地产生标识性强的设备文件名，比如 /dev/boot_disk、/dev/root_disk、/dev/color_printer 等等。<br> 3.设定设备的权限和所有者/组：udev可以按一定的条件来设置设备文件的权限和设备文件所有者/组。在不同的udev版本中，实现的方法不同，在 “如何配置和使用udev” 中会详解。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-RESqV0O9SsEWAT7Z" width="1296.139892578125" xmlns="http://www.w3.org/2000/svg" height="157.6666717529297" viewbox="0 0.0000019073486328125 1296.139892578125 157.6666717529297" class="mermaid-svg"> 
  <style>#mermaid-svg-RESqV0O9SsEWAT7Z {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .error-icon{fill:#552222;}#mermaid-svg-RESqV0O9SsEWAT7Z .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-RESqV0O9SsEWAT7Z .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-RESqV0O9SsEWAT7Z .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-RESqV0O9SsEWAT7Z .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-RESqV0O9SsEWAT7Z .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-RESqV0O9SsEWAT7Z .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-RESqV0O9SsEWAT7Z .marker{fill:#333333;stroke:#333333;}#mermaid-svg-RESqV0O9SsEWAT7Z .marker.cross{stroke:#333333;}#mermaid-svg-RESqV0O9SsEWAT7Z svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-RESqV0O9SsEWAT7Z .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .cluster-label text{fill:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .cluster-label span{color:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .label text,#mermaid-svg-RESqV0O9SsEWAT7Z span{fill:#333;color:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .node rect,#mermaid-svg-RESqV0O9SsEWAT7Z .node circle,#mermaid-svg-RESqV0O9SsEWAT7Z .node ellipse,#mermaid-svg-RESqV0O9SsEWAT7Z .node polygon,#mermaid-svg-RESqV0O9SsEWAT7Z .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-RESqV0O9SsEWAT7Z .node .label{text-align:center;}#mermaid-svg-RESqV0O9SsEWAT7Z .node.clickable{cursor:pointer;}#mermaid-svg-RESqV0O9SsEWAT7Z .arrowheadPath{fill:#333333;}#mermaid-svg-RESqV0O9SsEWAT7Z .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-RESqV0O9SsEWAT7Z .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-RESqV0O9SsEWAT7Z .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-RESqV0O9SsEWAT7Z .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-RESqV0O9SsEWAT7Z .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-RESqV0O9SsEWAT7Z .cluster text{fill:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z .cluster span{color:#333;}#mermaid-svg-RESqV0O9SsEWAT7Z div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-RESqV0O9SsEWAT7Z :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-A LE-B" id="L-A-B" style="opacity: 1;"> 
      <path class="path" d="M156.0078125,78.83333206176758L160.17447916666666,78.83333206176758C164.34114583333334,78.83333206176758,172.67447916666666,78.83333206176758,181.0078125,78.83333206176758C189.34114583333334,78.83333206176758,197.67447916666666,78.83333206176758,201.84114583333334,78.83333206176758L206.0078125,78.83333206176758" marker-end="url(#arrowhead1326)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1326" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-B LE-C" style="opacity: 1;" id="L-B-C"> 
      <path class="path" d="M365.1484375,78.83333206176758L369.3151041666667,78.83333206176758C373.4817708333333,78.83333206176758,381.8151041666667,78.83333206176758,390.1484375,78.83333206176758C398.4817708333333,78.83333206176758,406.8151041666667,78.83333206176758,410.9817708333333,78.83333206176758L415.1484375,78.83333206176758" marker-end="url(#arrowhead1327)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1327" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-C LE-D" style="opacity: 1;" id="L-C-D"> 
      <path class="path" d="M629.0156402587891,78.83333206176758L633.1823069254557,78.83333206176758C637.3489735921224,78.83333206176758,645.6823069254557,78.83333206176758,654.0156402587891,78.83333206176758C662.3489735921224,78.83333206176758,670.6823069254557,78.83333206176758,674.8489735921224,78.83333206176758L679.0156402587891,78.83333206176758" marker-end="url(#arrowhead1328)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1328" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-D LE-E" style="opacity: 1;" id="L-D-E"> 
      <path class="path" d="M780.1354293823242,78.83333206176758L784.3020960489908,78.83333206176758C788.4687627156576,78.83333206176758,796.8020960489908,78.83333206176758,805.1354293823242,78.83333206176758C813.4687627156576,78.83333206176758,821.8020960489908,78.83333206176758,825.9687627156576,78.83333206176758L830.1354293823242,78.83333206176758" marker-end="url(#arrowhead1329)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1329" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-E LE-F" style="opacity: 1;" id="L-E-F"> 
      <path class="path" d="M946.1380310058594,57.61800135040909L958.3046429951986,53.167778797154874C970.4712549845377,48.71755624390065,994.8044789632162,39.817111137392224,1025.8043689727783,35.366888584138C1056.8042589823406,30.91666603088379,1094.4708150227864,30.91666603088379,1113.3040930430095,30.91666603088379L1132.1373710632324,30.91666603088379" marker-end="url(#arrowhead1330)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1330" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-E LE-G" style="opacity: 1;" id="L-E-G"> 
      <path class="path" d="M946.1380310058594,100.04866277312607L958.3046429951986,104.49888532638029C970.4712549845377,108.9491078796345,994.8044789632162,117.84955298614294,1019.1377029418945,122.29977553939716C1043.470926920573,126.74999809265137,1067.8041508992512,126.74999809265137,1079.9707628885906,126.74999809265137L1092.1373748779297,126.74999809265137" marker-end="url(#arrowhead1331)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead1331" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="" style="opacity: 1;"> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-A-B" class="edgeLabel L-LS-A' L-LE-B"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-B-C" class="edgeLabel L-LS-B' L-LE-C"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-C-D" class="edgeLabel L-LS-C' L-LE-D"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-D-E" class="edgeLabel L-LS-D' L-LE-E"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(1019.1377029418945,30.91666603088379)"> 
      <g transform="translate(-40,-12.916666030883789)" class="label"> 
       <rect rx="0" ry="0" width="80" height="25.833332061767578"></rect> 
       <foreignobject width="80" height="25.833332061767578"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-E-F" class="edgeLabel L-LS-E' L-LE-F">有匹配规则</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(1019.1377029418945,126.74999809265137)"> 
      <g transform="translate(-47.999671936035156,-12.916666030883789)" class="label"> 
       <rect rx="0" ry="0" width="95.99934387207031" height="25.833332061767578"></rect> 
       <foreignobject width="95.99934387207031" height="25.833332061767578"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-E-G" class="edgeLabel L-LS-E' L-LE-G">没有规则匹配</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" id="flowchart-A-1064" transform="translate(82.00390625,78.83333206176758)" style="opacity: 1;"> 
      <rect rx="0" ry="0" x="-74.00390625" y="-22.91666603088379" width="148.0078125" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-64.00390625,-12.916666030883789)"> 
        <foreignobject width="128.0078125" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           内核检测到新设备 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-B-1065" transform="translate(285.578125,78.83333206176758)"> 
      <rect rx="5" ry="5" x="-79.5703125" y="-22.91666603088379" width="159.140625" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-69.5703125,-12.916666030883789)"> 
        <foreignobject width="139.140625" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           udevd接收设备信息 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-C-1067" transform="translate(522.0820388793945,78.83333206176758)"> 
      <rect rx="0" ry="0" x="-106.93360137939453" y="-22.91666603088379" width="213.86720275878906" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-96.93360137939453,-12.916666030883789)"> 
        <foreignobject width="193.8671875" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           删除/dev目录中的设备文件 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-D-1069" transform="translate(729.5755348205566,78.83333206176758)"> 
      <rect rx="0" ry="0" x="-50.55989456176758" y="-22.91666603088379" width="101.11978912353516" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-40.55989456176758,-12.916666030883789)"> 
        <foreignobject width="81.11978912353516" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           生成uevent 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-E-1071" transform="translate(888.1367301940918,78.83333206176758)"> 
      <rect rx="0" ry="0" x="-58.00130081176758" y="-22.91666603088379" width="116.00260162353516" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-48.00130081176758,-12.916666030883789)"> 
        <foreignobject width="96.00260162353516" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           查找规则文件 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-F-1073" transform="translate(1190.138671875,30.91666603088379)"> 
      <rect rx="0" ry="0" x="-58.00130081176758" y="-22.91666603088379" width="116.00260162353516" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-48.00130081176758,-12.916666030883789)"> 
        <foreignobject width="96.00260162353516" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           创建设备文件 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-G-1075" transform="translate(1190.138671875,126.74999809265137)"> 
      <rect rx="0" ry="0" x="-98.00129699707031" y="-22.91666603088379" width="196.00259399414062" height="45.83333206176758" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-88.00129699707031,-12.916666030883789)"> 
        <foreignobject width="176.00259399414062" height="25.833332061767578"> 
         <div style="display: inline-block; white-space: nowrap;">
           使用内核设备名创建文件 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h2><a id="3udev_33"></a>3.配置udev</h2> 
<p>配置使用udev通常涉及创建和编辑udev规则，这些规则定义了设备在系统中行为。在使用udev之前，了解一些基本概念，例如subsystem、KERNEL、ACTION等。</p> 
<table><thead><tr><th>键</th><th>含义</th></tr></thead><tbody><tr><td>ACTION</td><td>事件 (uevent) 的行为，例如：add( 添加设备 )、remove( 删除设备 )。</td></tr><tr><td>KERNEL</td><td>在内核里看到的设备名字，比如sd*表示任意SCSI磁盘设备</td></tr><tr><td>DEVPATH</td><td>内核设备路径，比如/devices/*</td></tr><tr><td>SUBSYSTEM</td><td>子系统名字，例如：sda 的子系统为 block。</td></tr><tr><td>BUS</td><td>总线的名字，比如IDE,USB，iscsi</td></tr><tr><td>DRIVER</td><td>设备驱动的名字，比如ide-cdrom</td></tr><tr><td>ID</td><td>独立于内核名字的设备名字</td></tr><tr><td>SYSFS{value}</td><td>sysfs属性值，可以表示任意</td></tr><tr><td>ENV{key}</td><td>环境变量，可以表示任意</td></tr><tr><td>PROGRAM</td><td>可执行的外部程序，如果程序返回0值，该键则认为为真(true)</td></tr><tr><td>RESULT</td><td>上一个PROGRAM调用返回的标准输出。</td></tr><tr><td>NAME</td><td>根据这个规则创建的设备文件的文件名。注意：仅仅第一行的NAME描述是有效的，后面的均忽略。如果你想使用使用两个以上的名字来访问一个设备的话，可以考虑SYMLINK键。</td></tr><tr><td>SYMLINK</td><td>为/dev/下的设备文件产生符号链接。由于udev只能为某个设备产生一个设备文件，所以为了不覆盖系统默认的 udev 规则所产生的文件，推荐使用符号链接。</td></tr><tr><td>OWNER</td><td>设备文件的属组</td></tr><tr><td>GROUP</td><td>设备文件所在的组。</td></tr><tr><td>MODE</td><td>设备文件的权限，采用8进制</td></tr><tr><td>RUN</td><td>为设备而执行的程序列表</td></tr><tr><td>LABEL</td><td>在配置文件里为内部控制而采用的名字标签(下面的GOTO服务)</td></tr><tr><td>GOTO</td><td>跳到匹配的规则（通过LABEL来标识），有点类似程序语言中的GOTO</td></tr><tr><td>IMPORT{type}</td><td>导入一个文件或者一个程序执行后而生成的规则集到当前文件</td></tr><tr><td>WAIT_FOR_SYSFS</td><td>等待一个特定的设备文件的创建。主要是用作时序和依赖问题。</td></tr><tr><td>OPTIONS</td><td>特定的选项：last_rule 对这类设备终端规则执行；ignore_device 忽略当前规则；ignore_remove 忽略接下来的并移走请求。all_partitions 为所有的磁盘分区创建设备文件。</td></tr></tbody></table> 
<p>在/etc/udev/rules.d/目录下，有一些默认的udev规则文件，例如70-persistent-net.rules。可通过创建新的规则文件或编辑已有的规则文件来定义udev规则。规则文件的命名约定是以数字和描述性名称开头，例如10-local.rules。数字决定了规则的优先级，数字越小，规则越早被处理。</p> 
<pre><code class="prism language-c">KERNEL<span class="token operator">==</span>”<span class="token operator">*</span>”<span class="token punctuation">,</span> OWNER<span class="token operator">=</span>”root” GROUP<span class="token operator">=</span>”root”<span class="token punctuation">,</span> MODE<span class="token operator">=</span>”<span class="token number">0600</span>″
KERNEL<span class="token operator">==</span>”tty”<span class="token punctuation">,</span> NAME<span class="token operator">=</span>”<span class="token operator">%</span>k”<span class="token punctuation">,</span> GROUP<span class="token operator">=</span>”tty”<span class="token punctuation">,</span> MODE<span class="token operator">=</span>”<span class="token number">0666</span>″<span class="token punctuation">,</span> OPTIONS<span class="token operator">=</span>”last_rule”
KERNEL<span class="token operator">==</span>”scd<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token operator">*</span>”<span class="token punctuation">,</span> SYMLINK<span class="token operator">+=</span>”cdrom cdrom<span class="token operator">-</span><span class="token operator">%</span>k”
KERNEL<span class="token operator">==</span>”hd<span class="token punctuation">[</span>a<span class="token operator">-</span>z<span class="token punctuation">]</span>”<span class="token punctuation">,</span> BUS<span class="token operator">==</span>”ide”<span class="token punctuation">,</span> SYSFS<span class="token punctuation">{<!-- --></span>removable<span class="token punctuation">}</span><span class="token operator">==</span>”<span class="token number">1</span>″<span class="token punctuation">,</span> SYSFS<span class="token punctuation">{<!-- --></span>device<span class="token operator">/</span>media<span class="token punctuation">}</span><span class="token operator">==</span>”cdrom”<span class="token punctuation">,</span> SYMLINK<span class="token operator">+=</span>”cdrom cdrom<span class="token operator">-</span><span class="token operator">%</span>k”
ACTION<span class="token operator">==</span>”add”<span class="token punctuation">,</span> SUBSYSTEM<span class="token operator">==</span>”scsi_device”<span class="token punctuation">,</span> RUN<span class="token operator">+=</span>”<span class="token operator">/</span>sbin<span class="token operator">/</span>modprobe sg”
</code></pre> 
<p>上面的例子给出了5个规则，每一个都是KERNEL或者ACTION键开头：<br> 第一个则是缺省的，他匹配任意被内核识别到的设备，然后设定这些设备的属组是root，组是root，访问权限模式是0600(-rw——-)。这也是一个安全的缺省设置保证所有的设备在默认情况下只有root可以读写。<br> 第二个规则也是比较典型的规则了。它匹配终端设备(tty)，然后设置新的权限为0600，所在的组是tty。它也设置了一个特别的设备文件名:%K。在这里例子里，%k代表设备的内核名字。那也就意味着内核识别出这些设备是什么名字，就创建什么样的设备文件名。<br> 第三行开始的KERNEL==”scd[0-9]*”,表示 SCSI CD-ROM 驱动. 它创建一对设备符号连接：cdrom和cdrom-%k。<br> 第四行，开始的 KERNEL==”hd[a-z]“, 表示ATA CDROM驱动器。这个规则创建和上面的规则相同的符号连接。ATA CDROM驱动器需要sysfs值以来区别别的ATA设备，因为SCSI CDROM可以被内核唯一识别。.<br> 第五行以 ACTION==”add”开始，它告诉udev增加 /sbin/modprobe sg 到命令列表，当任意SCSI设备增加到系统后，这些命令将执行。其效果就是计算机应该会增加sg内核模块来侦测新的SCSI设备。<br> 编写规则： 规则的编写使用基于键值对的语法。以下是一个简单的规则示例：</p> 
<p>当插入一个块设备并且设备的内核名是sda时，执行脚本</p> 
<pre><code class="prism language-c">SUBSYSTEM<span class="token operator">==</span><span class="token string">"block"</span><span class="token punctuation">,</span> KERNEL<span class="token operator">==</span><span class="token string">"sda"</span><span class="token punctuation">,</span> ACTION<span class="token operator">==</span><span class="token string">"add"</span><span class="token punctuation">,</span> RUN<span class="token operator">+=</span><span class="token string">"/bin/my_custom_script"</span>
</code></pre> 
<p>在这个例子中，SUBSYSTEM=="block"表示规则适用于块设备，KERNEL=="sda"表示设备的内核名是sda，ACTION==“add"表示设备被添加，RUN+=”/bin/my_custom_script"表示在添加时执行/bin/my_custom_script脚本。</p> 
<p>重新加载规则： 在编辑或创建规则文件后，需要重新加载udev规则。</p> 
<pre><code class="prism language-c">sudo udevadm control <span class="token operator">--</span>reload<span class="token operator">-</span>rules
</code></pre> 
<p>测试规则： 插入或移除设备，观察规则是否按照预期执行。可以使用udevadm monitor命令来监视udev事件。</p> 
<pre><code class="prism language-c">sudo udevadm monitor
</code></pre> 
<p>在另一个终端中插入或移除设备，观察监视器中的输出。</p> 
<p>查看udev事件信息： 使用udevadm info命令来查看设备的udev信息。</p> 
<pre><code class="prism language-c">sudo udevadm info <span class="token operator">--</span>attribute<span class="token operator">-</span>walk <span class="token operator">--</span>path<span class="token operator">=</span><span class="token operator">/</span>sys<span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>device
</code></pre> 
<p>替换/sys/path/to/device为实际设备的路径。对udev的配置更改可能会影响设备的命名和系统的行为，因此在进行更改之前，请确保了解其影响。</p> 
<p>例如，以下规则表示当USB设备插入时，在/tmp/usb_log.txt文件中写入一条日志：</p> 
<pre><code class="prism language-c">ACTION<span class="token operator">==</span><span class="token string">"add"</span><span class="token punctuation">,</span> SUBSYSTEM<span class="token operator">==</span><span class="token string">"usb"</span><span class="token punctuation">,</span> RUN<span class="token operator">+=</span><span class="token string">"/bin/sh -c 'echo USB device inserted &gt;&gt; /tmp/usb_log.txt'"</span>
</code></pre> 
<p>可以根据自己的需求添加其他规则。</p> 
<p>总体而言，Udev 通过规则匹配和执行动作的方式，实现了对设备事件的监听和处理，从而支持 Linux 系统的热插拔机制。这使得在系统运行时插入或拔出设备时，系统能够动态地适应这些变化。<br> <img src="https://images2.imgbox.com/0c/d9/5IheSRRP_o.png" alt="在这里插入图片描述"></p> 
<p>udev是一个设备管理工具，udev以守护进程的形式运行，通过侦听内核发出来的uevent来管理/dev目录下的设备文件。通过侦听内核发出来的硬件数据（事件），在用户空间为这个硬件去创建对应代表该硬件的文件，应用程序例如adb就可以通过该文件操作到硬件设备。<br> udev在用户空间运行，而不在内核空间运行。它能够根据系统中的硬件设备的状态动态更新设备文件，包括设备文件的创建，删除等。设备文件通常放在/dev目录下。使用udev后，在/dev目录下就只包含系统中真正存在的设备。</p> 
<h2><a id="4_117"></a>4.更多文章</h2> 
<p>==============================<br> 新的文章内容和分享已更新在：</p> 
<p>|工|·-·|重|·-·|号|：<strong>协议森林</strong></p> 
<p>==============================</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f5ecb6d472e80c7def94f54c315116e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">生成式人工智能备案办理指南，深度解析大模型备案全流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6cabecce356d0e172a10bda4c6bb198/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图论（一）之概念介绍与图形#matlab</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>