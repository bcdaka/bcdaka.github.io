<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hive 中 order by, sort by, distribute by, cluster by 的区别【详细】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ddf40fd476ed3ac6f2cd2de911daeacc/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="hive 中 order by, sort by, distribute by, cluster by 的区别【详细】">
  <meta property="og:description" content="文章目录 Order By（全局排序）Sort By（每个reduce内部排序）Distribute By（指定分区规则）Cluster By（分区字段和排序字段相同时使用）Sort By和Distribute By使用案例1.假设我们有一个名为sales的表，包含以下字段：product_id、sale_date、quantity和revenue。我们想要按照product_id进行排序，并将数据按照product_id进行分区。2.创建一个名为sales的表，并导入数据：3.使用Sort By和Distribute By来查询并排序数据： 总结 Order By（全局排序） Order By 用于结果集的排序。也可以称之为全局排序。对于 MR 任务来说，如果我们使用了 Order By 排序，意味着MR 任务只会有一个 Reducer 参与排序。
在 Hive 中执行脚本时，我们可以通过set mapreduce.job.reduces = 10 来设置 reduce 的个数为 10。但只要使用了 Order By 排序，即使设置了 10 个reduce ，也是不会生效的。Order By 就是一个全局排序，只能用一个 Reduce 进行全局排序。
Sort By（每个reduce内部排序） Sort By：对于大规模的数据集 order by 的效率非常低。在很多情况下，并不需要全局排序，此时可以使用 sort by。Sort by 在每个 Reducer 内部进行排序，即使每个 reduce 内部是有序的，但是对于全局结果集 来说也还是乱序的。
Distribute By（指定分区规则） Distribute by 是用来指定Distribute By 是用来指定分区规则的，它结合 Sort By 一起使用。上文介绍的单独使用 Sort By 对部门编号排序，因为没有指定分区规则，Sort By 则随机分区排序。Distribute By 类似 MR 中 partition（自定义分区），进行分区，结合 sort by 使用。通常是先用 Distribute By 指定分区规则，然后再使用 Sort By 对分区内数据排序。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-01T09:00:00+08:00">
    <meta property="article:modified_time" content="2023-12-01T09:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hive 中 order by, sort by, distribute by, cluster by 的区别【详细】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Order_By_5" rel="nofollow">Order By（全局排序）</a></li><li><a href="#Sort_Byreduce_10" rel="nofollow">Sort By（每个reduce内部排序）</a></li><li><a href="#Distribute_By_14" rel="nofollow">Distribute By（指定分区规则）</a></li><li><a href="#Cluster_By_17" rel="nofollow">Cluster By（分区字段和排序字段相同时使用）</a></li><li><a href="#Sort_ByDistribute_By_24" rel="nofollow">Sort By和Distribute By使用案例</a></li><li><ul><li><a href="#1salesproduct_idsale_datequantityrevenueproduct_idproduct_id_25" rel="nofollow">1.假设我们有一个名为sales的表，包含以下字段：product_id、sale_date、quantity和revenue。我们想要按照product_id进行排序，并将数据按照product_id进行分区。</a></li><li><a href="#2sales_27" rel="nofollow">2.创建一个名为sales的表，并导入数据：</a></li><li><a href="#3Sort_ByDistribute_By_43" rel="nofollow">3.使用Sort By和Distribute By来查询并排序数据：</a></li></ul> 
  </li><li><a href="#_60" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="Order_By_5"></a>Order By（全局排序）</h2> 
<p><strong>Order By 用于结果集的排序。也可以称之为全局排序。对于 MR 任务来说，<code>如果我们使用了 Order By 排序，意味着MR 任务只会有一个 Reducer 参与排序。</code></strong></p> 
<p><strong>在 Hive 中执行脚本时，我们可以通过<code>set mapreduce.job.reduces = 10 </code>来设置 reduce 的个数为 10。但只要使用了 Order By 排序，即使设置了 10 个reduce ，也是不会生效的。Order By 就是一个全局排序，只能用一个 Reduce 进行全局排序。</strong><br> <img src="https://images2.imgbox.com/8c/7a/BdBnxSk0_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Sort_Byreduce_10"></a>Sort By（每个reduce内部排序）</h2> 
<p><strong>Sort By：对于大规模的数据集 order by 的效率非常低。在很多情况下，并不需要全局排序，此时可以使用 sort by。<code>Sort by 在每个 Reducer 内部进行排序，即使每个 reduce 内部是有序的，但是对于全局结果集 来说也还是乱序的。</code></strong></p> 
<h2><a id="Distribute_By_14"></a>Distribute By（指定分区规则）</h2> 
<p><strong>Distribute by 是用来指定Distribute By 是用来指定分区规则的，它结合 Sort By 一起使用。上文介绍的单独使用 Sort By 对部门编号排序，因为没有指定分区规则，Sort By 则随机分区排序。<code>Distribute By 类似 MR 中 partition（自定义分区），进行分区，结合 sort by 使用。</code>通常是先用 Distribute By 指定分区规则，然后再使用 Sort By 对分区内数据排序。</strong></p> 
<h2><a id="Cluster_By_17"></a>Cluster By（分区字段和排序字段相同时使用）</h2> 
<p>当 distribute by 和 sorts by 字段相同时，可以使用 cluster by 方式。</p> 
<p>cluster by 除了具有 distribute by 的功能外还兼具 sort by 的功能。<code>但是排序只能是升序排序，不能指定排序规则为 ASC 或者 DESC。</code>Cluster by 不常用的。</p> 
<h2><a id="Sort_ByDistribute_By_24"></a>Sort By和Distribute By使用案例</h2> 
<h3><a id="1salesproduct_idsale_datequantityrevenueproduct_idproduct_id_25"></a>1.假设我们有一个名为sales的表，包含以下字段：product_id、sale_date、quantity和revenue。我们想要按照product_id进行排序，并将数据按照product_id进行分区。</h3> 
<h3><a id="2sales_27"></a>2.创建一个名为sales的表，并导入数据：</h3> 
<pre><code class="prism language-sql">
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> sales <span class="token punctuation">(</span>
  product_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
  sale_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
  quantity <span class="token keyword">INT</span><span class="token punctuation">,</span>
  revenue <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> sales <span class="token keyword">VALUES</span>
  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2023-01-01'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'2023-01-02'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">50.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'2023-01-03'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">80.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'2023-01-04'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">120.00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="3Sort_ByDistribute_By_43"></a>3.使用Sort By和Distribute By来查询并排序数据：</h3> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> sales
SORT <span class="token keyword">BY</span> product_id
DISTRIBUTE <span class="token keyword">BY</span> product_id<span class="token punctuation">;</span>
</code></pre> 
<ul><li> <p><strong>在上述示例中，SORT BY product_id用于按照product_id字段进行排序，DISTRIBUTE BY product_id用于按照product_id字段进行分区。</strong></p> </li><li> <p><strong>执行上述查询后，将按照product_id进行排序，并且数据将按照product_id进行分区。这样可以提高查询性能，使得相同product_id的数据在同一个分区中，方便后续的查询操作。</strong></p> </li><li> <p><strong>请注意，Sort By和Distribute By的使用可能会受到Hive版本和配置的影响。请根据您使用的Hive版本和具体需求，参考Hive的官方文档和相关资料，了解更多关于Sort By和Distribute By的用法和注意事项。</strong></p> </li></ul> 
<hr> 
<h2><a id="_60"></a>总结</h2> 
<blockquote> 
 <p>如果此篇文章有帮助到您, 希望打大佬们能<code>关注</code>、<code>点赞</code>、<code>收藏</code>、<code>评论</code>支持一波，非常感谢大家！<br> 如果有不对的地方请指正!!!</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd7845c1d99c94dd3c737a7b6be56061/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023年 WebStorm 下载、安装教程、附详细图文教程，亲测有效</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39c4ef77eceb44383eebfa944314180e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac如何安装Homebrew</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>