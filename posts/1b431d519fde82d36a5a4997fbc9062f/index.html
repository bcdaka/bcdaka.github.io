<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot Test详解 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1b431d519fde82d36a5a4997fbc9062f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringBoot Test详解">
  <meta property="og:description" content="目录 spring-boot-starter-test1、概述2、常用注解2.1、配置类型的注解2.2、Mock类型的注解2.3、自动配置类型的注解2.4、启动测试类型的注解2.5、相似注解的区别和联系 3、SpringBootTest和Junit的使用3.1、单元测试3.2、集成测试 4、MockMvc4.1、简单示例4.2、自动配置4.3、使用方式1、测试逻辑2、MockMvcBuilder3、MockMvcRequestBuilders4、ResultActions5、ResultMatchers6、MvcResult 5、业务代码6、分层测试6.1、Dao层测试6.2、Service层测试6.3、Controller层测试 7、JSON接口测试 spring-boot-starter-test 1、概述 SpringBoot对单元测试的支持在于提供了一系列注解和工具的集成，它们是通过两个项目提供的：
spring-boot-test项目：包含核心功能spring-boot-test-autoconfigure项目：支持自动配置 通常情况下，我们通过spring-boot-starter-test的Starter来引入SpringBoot的核心支持项目以及单元测试项目以及单元测试库。
spring-boot-starter-test包含的类库如下：
JUnit：一个Java语言的单元测试框架Spring Test &amp; Spring Boot Test：为SpringBoot应用提供集成测试和工具支持AssertJ：：支持流式断言的Java测试框架Hamcrest：一个匹配器库Mockito：一个Java Mock框架JSONassert：一个针对JSON的断言库JsonPath：一个JSON XPath库 如果SpringBoot提供的基础类无法满足业务需求，我们也可以自行添加依赖。依赖注入的优点之一就是可以轻松使用单元测试。这种方式可以直接通过new来创建对象，而不需要涉及Spring。当然，也可以通过模拟对象来替换真实依赖。
如果需要集成测试，比如使用Spring的ApplicationContext，Spring同样能够提供无须部署应用程序或连接到其它基础环境的集成测试。而SpringBoot应用本身就是一个ApplicationContext，因此除了正常使用Spring上下文进行测试，无须执行其它操作。
Maven依赖：
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; 2、常用注解 从功能上讲，Spring Boot Test中的注解主要分如下几类：
类别示例说明配置类型@TestConfiguration等提供一些测试相关的配置入口mock类型@MockBean等提供mock支持启动测试类型@SpringBootTest等以Test结尾的注解，具有加载applicationContext的能力自动配置类型@AutoConfigureJdbc等以AutoConfigure开头的注解，具有加载测试支持功能的能力 2.1、配置类型的注解 注解作用实践中的使用@TestComponent该注解为另一种@Component，在语义上用来指定某个Bean是专门用于测试的该注解适用与测试代码和正式混合在一起时，不加载被该注解描述的Bean，使用不多@TestConfiguration该注解是另一种@TestComponent，它用于补充额外的Bean或覆盖已存在的Bean在不修改正式代码的前提下，使配置更加灵活@TypeExcludeFilters用来排除@TestConfiguration和@TestComponent适用于测试代码和正式代码混合的场景，使用不多@OverrideAutoConfiguration可用于覆盖@EnableAutoCOnfiguration，与ImportAutoConfiguration结合使用，以限制所加载的自动配置类在不修改正式代码的前提下，提供了修改配置自动配置类的能力@PropertyMapping定义@AutoConfigure注解中用到的变量名称，例如在@AutoConfigureMockMvc中定义名为spring.test.mockmvc.webclient.enabled的变量一般不使用 使用@SpringBootApplication启动测试或者生产代码，被@TestComponent描述的Bean会自动被排除掉。如果不是则需要向@SpringBootApplication添加TypeExcludeFilter。
2.2、Mock类型的注解 注解作用MockBean用于Mock指定的class或被注解的属性MockBeans使@MockBean支持在同一类型或属性上多次出现@SpyBean用于spy指定的class或被注解的属性@SpyBeans使@SpyBeans支持在同一类型或属性上次多次出现 @MockBean和@SpyBean这两个注解，在mockito框架中本来已经存在，且功能基本相同。Spring Boot Test又定义一份重复的注解，目的在于使MockBean和SpyBean被ApplicationContext管理，从而方便使用。
MockBean和SpyBean功能非常相似，都能模拟方法的各种行为。不同之处在于MockBean是全新的对象，跟正式对象没有关系；而SpyBean与正式对象紧密联系，可以模拟正式对象的部分方法，没有被模拟的方法仍然可以运行正式代码。
2.3、自动配置类型的注解 注解作用@AutoConfigureJdbc自动配置JDBC@AutoConfigureCache自动配置缓存@AutoConfigureDataLdap自动配置LDAP@AutoConfigureJson自动配置JSON@AutoConfigureJsonTesters自动配置JsonTester@AutoConfigureDataJpa自动配置JPA@AutoConfigureTestEntityManager自动配置TestEntityManager@AutoConfigureRestDocs自动配置Rest Docs@AutoConfigureMockRestServiceServer自动配置MockRestServiceServer@AutoConfigureWebClient自动配置WebClient@AutoConfigureWebFlux自动配置WebFlux@AutoConfigureWebTestClient自动配置WebTestClient@AutoConfigureMockMvc自动配置MockMvc@AutoConfigureWebMvc自动配置WebMvc@AutoConfigureDataNeo4j自动配置Neo4j@AutoConfigureDataRedis自动配置Redis@AutoConfigureJooq自动配置Jooq@AutoCOnfigureTestDatabase自动Test Database，可以使用内存数据库 这些注解可以搭配@Test使用，用于开启在@Test中未自动配置的功能。例如@SpringBootTest和@AutoConfigureMockMvc组合后，就可以注入org.springframework.test.web.servlet.MockMvc。
自动配置类型有两种使用方式：
在功能测试（即使用@SpringBootTest）时显示添加。一般在切片测试中被隐式使用，例如@WebMvcTest注解时，隐式添加了@AutoConfigureCache、@AutoConfigureWebMvc和@AutoConfigureMockMvc。 2.4、启动测试类型的注解 所有的@*Test注解都被@BootstrapWith注解，它们可以启动ApplicationContext，是测试的入口，所有的测试类必须声明一个@*Test注解。
注解作用@SpringBootTest自动侦测并加载@SpringBootApplication或@SpringBootConfiguration中的配置，默认web环境为Mock，不见听任务端口@DataRedisTest测试对Redis操作，自动扫描被@RedisHash描述的类，并配置Spring Data Redis的库@DataJpaTest测试基于JPA的数据库操作，同时提供了TestEntityManager替代JPA的EntityManager@DataJdbcTest测试基于Spring Data JDBC的数据库操作@JsonTest测试JSON的序列化和反序列化@WebMvcTest测试Spring MVC中的Controllers@WebFluxTest测试Spring WebFlux中的Controllers@RestClientTest测试对REST客户端的操作@DataLdapTest测试对LDAP的操作@DataMongoTest测试对MongoDB的操作@DataNeo4jTest测试对Neo4j的操作 除了@SpringBootTest之外的注解都是用来进行切面测试的，他们会默认导入一些自动配置，点击查看官方文档。
一般情况，推荐使用@SpringBootTest而非其它切片测试的注解，简单有效。若某次改动仅涉及特定切片，可以考虑使用切片测试。SpringBootTest是这些注解中最常用的一个，其中包含的配置项如下：
value：指定配置属性properties：指定配置属性，和value意义相同classes：指定配置类，等同于@ContextConfiguration中的class，若没有显示指定，将查找嵌套的@Configuration类，然后返回到SpringBootConfiguration搜索配置webEnviroment：指定web环境，可选值如下： MOCK：此值为默认值，该类型提供一个mock环境，此时内嵌的服务（servlet容器）并没有真正启动，也不会监听web端口RANDOM_PORT：启动一个真实的web服务，监听一个随机端口DEFINED_PORT：启动一个真实的web服务，监听一个定义好的端口（从配置中读取）NONE：启动一个非web的ApplicationContext，既不提供mock环境，也不提供真实的web服务 2.5、相似注解的区别和联系 @TestComment和@Comment：@TestComment是另一种@Component，在语义上用来指定某个Bean是专门用于测试的。使用@SpringBootApplication服务时，@TestComponent会被自动排除@TestConfiguration和@Configuration：@TestConfiguration是Spring Boot Boot Test提供的，@Configuration是Spring Framework提供的。@TestConfiguration实际上是也是一种@TestComponent，只是这个@TestComponent专门用来做配置用。@TestConfiguration和@Configuration不同，它不会阻止@SpringBootTest的查找机制，相当于是对既有配置的补充或覆盖。@SpringBootTest和@WebMvcTest（或@*Test）：都可以启动Spring的ApplicationContext @SpringBootTest自动侦测并加载@SpringBootApplication或@SpringBootConfiguration中的配置，@WebMvcTest不侦测配置，只是默认加载一些自动配置。@SpringBootTest测试范围一般比@WebMvcTest大。@MockBean和@SpyBean：都能模拟方法的各种行为。不同之处在于MockBean是全新的对象，跟正式对象没有关系；而SpyBean与正式对象紧密联系，可以模拟正式对象的部分方法，没有被模拟的方法仍然可以运行正式代码。 3、SpringBootTest和Junit的使用 整体上，Spring Boot Test支持的测试种类，大致可以分为如下三类：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-01T15:45:25+08:00">
    <meta property="article:modified_time" content="2024-02-01T15:45:25+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot Test详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#springbootstartertest_1" rel="nofollow">spring-boot-starter-test</a></li><li><ul><li><a href="#1_4" rel="nofollow">1、概述</a></li><li><a href="#2_38" rel="nofollow">2、常用注解</a></li><li><ul><li><a href="#21_52" rel="nofollow">2.1、配置类型的注解</a></li><li><a href="#22Mock_65" rel="nofollow">2.2、Mock类型的注解</a></li><li><a href="#23_80" rel="nofollow">2.3、自动配置类型的注解</a></li><li><a href="#24_113" rel="nofollow">2.4、启动测试类型的注解</a></li><li><a href="#25_147" rel="nofollow">2.5、相似注解的区别和联系</a></li></ul> 
   </li><li><a href="#3SpringBootTestJunit_154" rel="nofollow">3、SpringBootTest和Junit的使用</a></li><li><ul><li><a href="#31_162" rel="nofollow">3.1、单元测试</a></li><li><a href="#32_184" rel="nofollow">3.2、集成测试</a></li></ul> 
   </li><li><a href="#4MockMvc_208" rel="nofollow">4、MockMvc</a></li><li><ul><li><a href="#41_213" rel="nofollow">4.1、简单示例</a></li><li><a href="#42_312" rel="nofollow">4.2、自动配置</a></li><li><a href="#43_425" rel="nofollow">4.3、使用方式</a></li><li><ul><li><a href="#1_428" rel="nofollow">1、测试逻辑</a></li><li><a href="#2MockMvcBuilder_437" rel="nofollow">2、MockMvcBuilder</a></li><li><a href="#3MockMvcRequestBuilders_447" rel="nofollow">3、MockMvcRequestBuilders</a></li><li><a href="#4ResultActions_461" rel="nofollow">4、ResultActions</a></li><li><a href="#5ResultMatchers_505" rel="nofollow">5、ResultMatchers</a></li><li><a href="#6MvcResult_676" rel="nofollow">6、MvcResult</a></li></ul> 
   </li></ul> 
   </li><li><a href="#5_697" rel="nofollow">5、业务代码</a></li><li><a href="#6_861" rel="nofollow">6、分层测试</a></li><li><ul><li><a href="#61Dao_863" rel="nofollow">6.1、Dao层测试</a></li><li><a href="#62Service_948" rel="nofollow">6.2、Service层测试</a></li><li><a href="#63Controller_1065" rel="nofollow">6.3、Controller层测试</a></li></ul> 
   </li><li><a href="#7JSON_1203" rel="nofollow">7、JSON接口测试</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="springbootstartertest_1"></a>spring-boot-starter-test</h2> 
<h3><a id="1_4"></a>1、概述</h3> 
<p>SpringBoot对单元测试的支持在于提供了一系列注解和工具的集成，它们是通过两个项目提供的：</p> 
<ul><li><strong>spring-boot-test项目</strong>：包含核心功能</li><li><strong>spring-boot-test-autoconfigure项目</strong>：支持自动配置</li></ul> 
<p>通常情况下，我们通过spring-boot-starter-test的Starter来引入SpringBoot的核心支持项目以及单元测试项目以及单元测试库。</p> 
<p>spring-boot-starter-test包含的类库如下：</p> 
<ul><li><strong>JUnit</strong>：一个Java语言的单元测试框架</li><li><strong>Spring Test &amp; Spring Boot Test</strong>：为SpringBoot应用提供集成测试和工具支持</li><li><strong>AssertJ：</strong>：支持流式断言的Java测试框架</li><li><strong>Hamcrest</strong>：一个匹配器库</li><li><strong>Mockito</strong>：一个Java Mock框架</li><li><strong>JSONassert</strong>：一个针对JSON的断言库</li><li><strong>JsonPath</strong>：一个JSON XPath库</li></ul> 
<p>如果SpringBoot提供的基础类无法满足业务需求，我们也可以自行添加依赖。依赖注入的优点之一就是可以轻松使用单元测试。这种方式可以直接通过new来创建对象，而不需要涉及Spring。当然，也可以通过模拟对象来替换真实依赖。</p> 
<p>如果需要集成测试，比如使用Spring的ApplicationContext，Spring同样能够提供无须部署应用程序或连接到其它基础环境的集成测试。而SpringBoot应用本身就是一个ApplicationContext，因此除了正常使用Spring上下文进行测试，无须执行其它操作。</p> 
<p>Maven依赖：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2_38"></a>2、常用注解</h3> 
<p>从功能上讲，Spring Boot Test中的注解主要分如下几类：</p> 
<table><thead><tr><th align="left">类别</th><th align="left">示例</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">配置类型</td><td align="left">@TestConfiguration等</td><td align="left">提供一些测试相关的配置入口</td></tr><tr><td align="left">mock类型</td><td align="left">@MockBean等</td><td align="left">提供mock支持</td></tr><tr><td align="left">启动测试类型</td><td align="left">@SpringBootTest等</td><td align="left">以Test结尾的注解，具有加载applicationContext的能力</td></tr><tr><td align="left">自动配置类型</td><td align="left">@AutoConfigureJdbc等</td><td align="left">以AutoConfigure开头的注解，具有加载测试支持功能的能力</td></tr></tbody></table> 
<h4><a id="21_52"></a>2.1、配置类型的注解</h4> 
<table><thead><tr><th align="left">注解</th><th align="left">作用</th><th align="left">实践中的使用</th></tr></thead><tbody><tr><td align="left"><strong>@TestComponent</strong></td><td align="left">该注解为另一种<code>@Component</code>，在语义上用来指定某个Bean是专门用于测试的</td><td align="left">该注解适用与测试代码和正式混合在一起时，不加载被该注解描述的Bean，使用不多</td></tr><tr><td align="left"><strong>@TestConfiguration</strong></td><td align="left">该注解是另一种<code>@TestComponent</code>，它用于补充额外的Bean或覆盖已存在的Bean</td><td align="left">在不修改正式代码的前提下，使配置更加灵活</td></tr><tr><td align="left"><strong>@TypeExcludeFilters</strong></td><td align="left">用来排除<code>@TestConfiguration</code>和<code>@TestComponent</code></td><td align="left">适用于测试代码和正式代码混合的场景，使用不多</td></tr><tr><td align="left"><strong>@OverrideAutoConfiguration</strong></td><td align="left">可用于覆盖<code>@EnableAutoCOnfiguration</code>，与<code>ImportAutoConfiguration</code>结合使用，以限制所加载的自动配置类</td><td align="left">在不修改正式代码的前提下，提供了修改配置自动配置类的能力</td></tr><tr><td align="left"><strong>@PropertyMapping</strong></td><td align="left">定义<code>@AutoConfigure</code>注解中用到的变量名称，例如在<code>@AutoConfigureMockMvc</code>中定义名为<code>spring.test.mockmvc.webclient.enabled</code>的变量</td><td align="left">一般不使用</td></tr></tbody></table> 
<blockquote> 
 <p>使用@SpringBootApplication启动测试或者生产代码，被@TestComponent描述的Bean会自动被排除掉。如果不是则需要向@SpringBootApplication添加TypeExcludeFilter。</p> 
</blockquote> 
<h4><a id="22Mock_65"></a>2.2、Mock类型的注解</h4> 
<table><thead><tr><th align="left">注解</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><strong>MockBean</strong></td><td align="left">用于Mock指定的class或被注解的属性</td></tr><tr><td align="left"><strong>MockBeans</strong></td><td align="left">使@MockBean支持在同一类型或属性上多次出现</td></tr><tr><td align="left"><strong>@SpyBean</strong></td><td align="left">用于spy指定的class或被注解的属性</td></tr><tr><td align="left"><strong>@SpyBeans</strong></td><td align="left">使@SpyBeans支持在同一类型或属性上次多次出现</td></tr></tbody></table> 
<blockquote> 
 <p>@MockBean和@SpyBean这两个注解，在mockito框架中本来已经存在，且功能基本相同。Spring Boot Test又定义一份重复的注解，目的在于使MockBean和SpyBean被ApplicationContext管理，从而方便使用。</p> 
</blockquote> 
<blockquote> 
 <p>MockBean和SpyBean功能非常相似，都能模拟方法的各种行为。不同之处在于MockBean是全新的对象，跟正式对象没有关系；而SpyBean与正式对象紧密联系，可以模拟正式对象的部分方法，没有被模拟的方法仍然可以运行正式代码。</p> 
</blockquote> 
<h4><a id="23_80"></a>2.3、自动配置类型的注解</h4> 
<table><thead><tr><th align="left">注解</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><strong>@AutoConfigureJdbc</strong></td><td align="left">自动配置JDBC</td></tr><tr><td align="left"><strong>@AutoConfigureCache</strong></td><td align="left">自动配置缓存</td></tr><tr><td align="left"><strong>@AutoConfigureDataLdap</strong></td><td align="left">自动配置LDAP</td></tr><tr><td align="left"><strong>@AutoConfigureJson</strong></td><td align="left">自动配置JSON</td></tr><tr><td align="left"><strong>@AutoConfigureJsonTesters</strong></td><td align="left">自动配置JsonTester</td></tr><tr><td align="left"><strong>@AutoConfigureDataJpa</strong></td><td align="left">自动配置JPA</td></tr><tr><td align="left"><strong>@AutoConfigureTestEntityManager</strong></td><td align="left">自动配置TestEntityManager</td></tr><tr><td align="left"><strong>@AutoConfigureRestDocs</strong></td><td align="left">自动配置Rest Docs</td></tr><tr><td align="left"><strong>@AutoConfigureMockRestServiceServer</strong></td><td align="left">自动配置MockRestServiceServer</td></tr><tr><td align="left"><strong>@AutoConfigureWebClient</strong></td><td align="left">自动配置WebClient</td></tr><tr><td align="left"><strong>@AutoConfigureWebFlux</strong></td><td align="left">自动配置WebFlux</td></tr><tr><td align="left"><strong>@AutoConfigureWebTestClient</strong></td><td align="left">自动配置WebTestClient</td></tr><tr><td align="left"><strong>@AutoConfigureMockMvc</strong></td><td align="left">自动配置MockMvc</td></tr><tr><td align="left"><strong>@AutoConfigureWebMvc</strong></td><td align="left">自动配置WebMvc</td></tr><tr><td align="left"><strong>@AutoConfigureDataNeo4j</strong></td><td align="left">自动配置Neo4j</td></tr><tr><td align="left"><strong>@AutoConfigureDataRedis</strong></td><td align="left">自动配置Redis</td></tr><tr><td align="left"><strong>@AutoConfigureJooq</strong></td><td align="left">自动配置Jooq</td></tr><tr><td align="left"><strong>@AutoCOnfigureTestDatabase</strong></td><td align="left">自动Test Database，可以使用内存数据库</td></tr></tbody></table> 
<blockquote> 
 <p>这些注解可以搭配@Test使用，用于开启在@Test中未自动配置的功能。例如@SpringBootTest和@AutoConfigureMockMvc组合后，就可以注入org.springframework.test.web.servlet.MockMvc。</p> 
</blockquote> 
<p>自动配置类型有两种使用方式：</p> 
<ol><li>在功能测试（即使用@SpringBootTest）时显示添加。</li><li>一般在切片测试中被隐式使用，例如@WebMvcTest注解时，隐式添加了@AutoConfigureCache、@AutoConfigureWebMvc和@AutoConfigureMockMvc。</li></ol> 
<h4><a id="24_113"></a>2.4、启动测试类型的注解</h4> 
<p>所有的<code>@*Test</code>注解都被<code>@BootstrapWith</code>注解，它们可以启动ApplicationContext，是测试的入口，所有的测试类必须声明一个<code>@*Test</code>注解。</p> 
<table><thead><tr><th align="left">注解</th><th align="left">作用</th></tr></thead><tbody><tr><td align="left"><strong>@SpringBootTest</strong></td><td align="left">自动侦测并加载@SpringBootApplication或@SpringBootConfiguration中的配置，默认web环境为Mock，不见听任务端口</td></tr><tr><td align="left"><strong>@DataRedisTest</strong></td><td align="left">测试对Redis操作，自动扫描被@RedisHash描述的类，并配置Spring Data Redis的库</td></tr><tr><td align="left"><strong>@DataJpaTest</strong></td><td align="left">测试基于JPA的数据库操作，同时提供了TestEntityManager替代JPA的EntityManager</td></tr><tr><td align="left"><strong>@DataJdbcTest</strong></td><td align="left">测试基于Spring Data JDBC的数据库操作</td></tr><tr><td align="left"><strong>@JsonTest</strong></td><td align="left">测试JSON的序列化和反序列化</td></tr><tr><td align="left"><strong>@WebMvcTest</strong></td><td align="left">测试Spring MVC中的Controllers</td></tr><tr><td align="left"><strong>@WebFluxTest</strong></td><td align="left">测试Spring WebFlux中的Controllers</td></tr><tr><td align="left"><strong>@RestClientTest</strong></td><td align="left">测试对REST客户端的操作</td></tr><tr><td align="left"><strong>@DataLdapTest</strong></td><td align="left">测试对LDAP的操作</td></tr><tr><td align="left"><strong>@DataMongoTest</strong></td><td align="left">测试对MongoDB的操作</td></tr><tr><td align="left"><strong>@DataNeo4jTest</strong></td><td align="left">测试对Neo4j的操作</td></tr></tbody></table> 
<p>除了@SpringBootTest之外的注解都是用来进行切面测试的，他们会默认导入一些自动配置，<a href="https://docs.spring.io/spring-boot/docs/2.1.0.RELEASE/reference/htmlsingle/#boot-features-testing" rel="nofollow">点击查看官方文档</a>。</p> 
<p>一般情况，推荐使用@SpringBootTest而非其它切片测试的注解，简单有效。若某次改动仅涉及特定切片，可以考虑使用切片测试。SpringBootTest是这些注解中最常用的一个，其中包含的配置项如下：</p> 
<ul><li><strong>value</strong>：指定配置属性</li><li><strong>properties</strong>：指定配置属性，和value意义相同</li><li><strong>classes</strong>：指定配置类，等同于<code>@ContextConfiguration</code>中的class，若没有显示指定，将查找嵌套的<code>@Configuration</code>类，然后返回到<code>SpringBootConfiguration</code>搜索配置</li><li><strong>webEnviroment</strong>：指定web环境，可选值如下： 
  <ul><li><code>MOCK</code>：此值为默认值，该类型提供一个mock环境，此时内嵌的服务（servlet容器）并没有真正启动，也不会监听web端口</li><li><code>RANDOM_PORT</code>：启动一个真实的web服务，监听一个随机端口</li><li><code>DEFINED_PORT</code>：启动一个真实的web服务，监听一个定义好的端口（从配置中读取）</li><li><code>NONE</code>：启动一个非web的ApplicationContext，既不提供mock环境，也不提供真实的web服务</li></ul> </li></ul> 
<h4><a id="25_147"></a>2.5、相似注解的区别和联系</h4> 
<ul><li><strong>@TestComment和@Comment</strong>：@TestComment是另一种@Component，在语义上用来指定某个Bean是专门用于测试的。使用@SpringBootApplication服务时，@TestComponent会被自动排除</li><li><strong>@TestConfiguration和@Configuration</strong>：@TestConfiguration是Spring Boot Boot Test提供的，@Configuration是Spring Framework提供的。@TestConfiguration实际上是也是一种@TestComponent，只是这个@TestComponent专门用来做配置用。@TestConfiguration和@Configuration不同，它不会阻止@SpringBootTest的查找机制，相当于是对既有配置的补充或覆盖。</li><li><strong>@SpringBootTest和@WebMvcTest（或@*Test）</strong>：都可以启动Spring的ApplicationContext @SpringBootTest自动侦测并加载@SpringBootApplication或@SpringBootConfiguration中的配置，@WebMvcTest不侦测配置，只是默认加载一些自动配置。@SpringBootTest测试范围一般比@WebMvcTest大。</li><li><strong>@MockBean和@SpyBean</strong>：都能模拟方法的各种行为。不同之处在于MockBean是全新的对象，跟正式对象没有关系；而SpyBean与正式对象紧密联系，可以模拟正式对象的部分方法，没有被模拟的方法仍然可以运行正式代码。</li></ul> 
<h3><a id="3SpringBootTestJunit_154"></a>3、SpringBootTest和Junit的使用</h3> 
<p>整体上，Spring Boot Test支持的测试种类，大致可以分为如下三类：</p> 
<ol><li><strong>单元测试</strong>：一般面向方法，编写一般业务代码时，测试成本较大。涉及到的注解有@Test。</li><li><strong>切片测试</strong>：一般面向于测试的边界功能，介于单元测试和功能测试之间。涉及到的注解有@WebMvcTest等。主要就是对于Controller的测试，分离了Service层，这里就涉及到Mock控制层所依赖的组件了。</li><li><strong>功能测试</strong>：一般面向某个完整的业务功能，同时也可以使用切面测试中mock能力，推荐使用。涉及到的注解有@SpringBootTest等。</li></ol> 
<h4><a id="31_162"></a>3.1、单元测试</h4> 
<p>默认无参数的@SpringBootTest 注解会加载一个Web Application Context并提供Mock Web Environment，但是不会启动内置的server。这点从日志中没有打印Tomcat started on port(s)可以佐证。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1.88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="32_184"></a>3.2、集成测试</h4> 
<pre><code class="prism language-java"><span class="token comment">//指定@SpringBootTest的Web Environment为RANDOM_PORT</span>
<span class="token comment">//此时，将会加载ApplicationContext，并启动Server，Server监听在随机端口上。</span>
<span class="token comment">//在测试类中通过@LocalServerPort获取该端口值</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest<span class="token punctuation">.</span>WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@LocalServerPort</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@DisplayName</span><span class="token punctuation">(</span><span class="token string">"should access application"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shouldAccessApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Assertions</span><span class="token punctuation">.</span><span class="token function">assertThat</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isGreaterThan</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>也可以通过指定@SpringBootTest的Web Environment为DEFINED_PORT 来指定server侦听应用程序配置的端口，默认为8080。不过这种指定端口的方式很少使用，因为如果本地同时启动应用时，会导致端口冲突。</p> 
<h3><a id="4MockMvc_208"></a>4、MockMvc</h3> 
<p>MockMvc可以做到不启动项目工程就可以对结构进行测试。MockMvc实现了对HTTP请求的模拟，能够直接使用网络的形式，转换到Controller的调用，这样可以使得测试速度快、不依赖网络环境，同时提供了一套验证的工具，使得请求的验证同一而且方便。</p> 
<h4><a id="41_213"></a>4.1、简单示例</h4> 
<p>创建一个简单的TestController，提供一个方法，返回一个字符串：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/mock"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"Hello "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>单元测试：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">class</span> <span class="token class-name">TestControllerTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">mock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//mockMvc.perform执行一个请求</span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
            <span class="token comment">//构造请求</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/mock"</span><span class="token punctuation">)</span>
            <span class="token comment">//设置返回值类型</span>
            <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
            <span class="token comment">//添加请求参数</span>
            <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//添加执行完成后的断言</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token string">"Hello tom!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//添加一个结果处理器，此处打印整个响应结果信息</span>
        <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行测试输出：</p> 
<pre><code class="prism language-java"><span class="token class-name">MockHttpServletRequest</span><span class="token operator">:</span>
      HTTP <span class="token class-name">Method</span> <span class="token operator">=</span> GET
      <span class="token class-name">Request</span> URI <span class="token operator">=</span> <span class="token operator">/</span>mock
       <span class="token class-name">Parameters</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token punctuation">[</span>tom<span class="token punctuation">]</span><span class="token punctuation">}</span>
          <span class="token class-name">Headers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Accept</span><span class="token operator">:</span><span class="token string">"application/json"</span><span class="token punctuation">]</span>
             <span class="token class-name">Body</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token class-name">Session</span> <span class="token class-name">Attrs</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token class-name">Handler</span><span class="token operator">:</span>
             <span class="token class-name">Type</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>TestController</span>
           <span class="token class-name">Method</span> <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>controller<span class="token punctuation">.</span></span>TestController</span>#<span class="token function">mock</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>

<span class="token class-name">Async</span><span class="token operator">:</span>
    <span class="token class-name">Async</span> started <span class="token operator">=</span> <span class="token boolean">false</span>
     <span class="token class-name">Async</span> result <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token class-name">Resolved</span> <span class="token class-name">Exception</span><span class="token operator">:</span>
             <span class="token class-name">Type</span> <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token class-name">ModelAndView</span><span class="token operator">:</span>
        <span class="token class-name">View</span> name <span class="token operator">=</span> <span class="token keyword">null</span>
             <span class="token class-name">View</span> <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token class-name">Model</span> <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token class-name">FlashMap</span><span class="token operator">:</span>
       <span class="token class-name">Attributes</span> <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token class-name">MockHttpServletResponse</span><span class="token operator">:</span>
           <span class="token class-name">Status</span> <span class="token operator">=</span> <span class="token number">200</span>
    <span class="token class-name">Error</span> message <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token class-name">Headers</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span><span class="token operator">:</span><span class="token string">"application/json"</span><span class="token punctuation">,</span> <span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Length</span><span class="token operator">:</span><span class="token string">"10"</span><span class="token punctuation">]</span>
     <span class="token class-name">Content</span> type <span class="token operator">=</span> application<span class="token operator">/</span>json
             <span class="token class-name">Body</span> <span class="token operator">=</span> <span class="token class-name">Hello</span> tom<span class="token operator">!</span>
    <span class="token class-name">Forwarded</span> URL <span class="token operator">=</span> <span class="token keyword">null</span>
   <span class="token class-name">Redirected</span> URL <span class="token operator">=</span> <span class="token keyword">null</span>
          <span class="token class-name">Cookies</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre> 
<p>@AutoConfigureMockMvc注解提供了自动配置MockMvc的功能。@Autowired注入MockMvc对象。</p> 
<p>MockMvc对象可以通过接口M哦查看Mv吃Builder的实现类获得。该接口提供一个唯一的build方法来构造MockMvc。主要有两个实现类：</p> 
<ul><li><code>StandaloneMockMvcBuilder</code>：独立安装</li><li><code>DefaultMockMvcBuilder</code>：集成Web环境测试（并不会真正的web环境，而是通过相应的Mock API进行模拟测试，无须启动服务器）</li></ul> 
<p>MockMvcBuilders提供了对应的standaloneSetup和webAppContextSetup两种创建方法，在使用时直接调用即可，默认使用DefaultMOckMvcBuilder。</p> 
<p>整个单元测试包含一下步骤：</p> 
<ol><li>准备测试环境</li><li>执行MockMvc请求</li><li>添加验证断言</li><li>添加结果处理器</li><li>得到MvcResult进行自定义断言/进行下一步的异步请求</li><li>卸载测试环境</li></ol> 
<h4><a id="42_312"></a>4.2、自动配置</h4> 
<p>@AutoConfigureMockMvc提供了自动配置MockMvc的功能，源码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@ImportAutoConfiguration</span>
<span class="token annotation punctuation">@PropertyMapping</span><span class="token punctuation">(</span><span class="token string">"spring.test.mockmvc"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigureMockMvc</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">//是否应向MockMvc注册来自应用程序上下文的filter，默认true</span>
	<span class="token keyword">boolean</span> <span class="token function">addFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">//每次MockMvc调用后应如何打印MvcResult信息</span>
	<span class="token annotation punctuation">@PropertyMapping</span><span class="token punctuation">(</span>skip <span class="token operator">=</span> <span class="token class-name">SkipPropertyMapping</span><span class="token punctuation">.</span>ON_DEFAULT_VALUE<span class="token punctuation">)</span>
	<span class="token class-name">MockMvcPrint</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">MockMvcPrint</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">;</span>

	<span class="token comment">//如果MvcResult仅在测试失败时才打印信息。默认true，则表示只在失败时打印</span>
	<span class="token keyword">boolean</span> <span class="token function">printOnlyOnFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">//当HtmlUnit在类路径上时，是否应该自动配置WebClient。默认为true</span>
	<span class="token annotation punctuation">@PropertyMapping</span><span class="token punctuation">(</span><span class="token string">"webclient.enabled"</span><span class="token punctuation">)</span>
	<span class="token keyword">boolean</span> <span class="token function">webClientEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">//当Selenium位于类路径上时，是否应自动配置WebDriver。默认为true</span>
	<span class="token annotation punctuation">@PropertyMapping</span><span class="token punctuation">(</span><span class="token string">"webdriver.enabled"</span><span class="token punctuation">)</span>
	<span class="token keyword">boolean</span> <span class="token function">webDriverEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在AutoConfigureMockMvc的源码中，我们重点看它组合的<code>@ImportAutoConfiguration</code>注解。该注解同样是SpringBoot自动配置项目提供的，其功能类似<code>@EnableAutoConfiguration</code>，但又略有区别。@ImportAutoConfiguration同样用于导入自动配置类，不仅可以像@EnableAutoConfiguration那样排除指定的自动配置配置类，还可以指定使用哪些自动配置类，这是它们之间的重要区别之一。</p> 
<p>另外，@ImportAutoConfiguration使用的排序规则与@EnableAutoConfiguration的相同，通常情况下，建议优先使用@EnableAutoConfiguration注解进行自动配置。但在单元测试中，则可考虑优先使用@ImportAutoCOnfiguration。源码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">ImportAutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ImportAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">//指定引入的自动配置类</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"classes"</span><span class="token punctuation">)</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//指定引入的自动配置类。如果为空，则使用META-INF/spring.factories中注册的指定类</span>
	<span class="token comment">//其中spring.factories中注册的key为被该注解的类的全限定名称</span>
	<span class="token annotation punctuation">@AliasFor</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//排除指定自动配置类</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">exclude</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>通过value属性，提供了指定自动配置类的功能，可以通过细粒度控制，根据需要引入相应功能的自动配置。没有@EnableAutoConfiguration一次注入全局生效的特性，但是有了指定的灵活性。</p> 
<p>更值得注意的是classes属性，它也是用来指定自动配置类的，但它的特殊之处在于，如果未进行指定，则会默认搜索项目META-INF/spring.factories文件中注册的类，但是它<br> 搜索的注册类在spring.factories中的key是被@ImportAutoConfiguration注解的类的全限<br> 定名称。显然，这里的key为org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc。以上功能也就解释了为什么在单元测试中更多的是使用@ImportAutoConfiguration注解来进行自动配置了。</p> 
<p>在spring-boot-test-autoconfigure项目的spring.factories文件中的相关配置如下：</p> 
<pre><code class="prism language-java"># <span class="token class-name">AutoConfigureMockMvc</span> auto<span class="token operator">-</span>configuration imports
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>AutoConfigureMockMvc</span><span class="token operator">=</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>MockMvcAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>MockMvcWebClientAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>MockMvcWebDriverAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>client<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>OAuth2ClientAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>resource<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>OAuth2ResourceServerAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>SecurityAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>SecurityFilterAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>UserDetailsServiceAutoConfiguration</span><span class="token punctuation">,</span>\
<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span>MockMvcSecurityConfiguration</span>
</code></pre> 
<p>也就是说，当使用@ImportAutoConfiguration注解，并未指定classes属性值时，默认自动配置上述自动配置类。</p> 
<p>使用@AutoConfigureMockMvc注解会导入MockMvcAutoConfiguration自动配置类，该类就是专门为MockMvc相关功能提供自动配置的。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token class-name">WebMvcAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token class-name">ServerProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MockMvcAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebApplicationContext</span> context<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebMvcProperties</span> webMvcProperties<span class="token punctuation">;</span>

	<span class="token class-name">MockMvcAutoConfiguration</span><span class="token punctuation">(</span><span class="token class-name">WebApplicationContext</span> context<span class="token punctuation">,</span> <span class="token class-name">WebMvcProperties</span> webMvcProperties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>webMvcProperties <span class="token operator">=</span> webMvcProperties<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>注解部分说明，MockMvcAutoConfiguration需要在Web应用程序类型为Servlet，且在WebMvcAutoConfiguration自动配置之后进行自动配置。</p> 
<p>另外，通过@EnableConfigurationProperties导入了ServerProperties和WebMvcProperties两个配置属性类，并通过构造方法设置为成员变量。</p> 
<h4><a id="43_425"></a>4.3、使用方式</h4> 
<h5><a id="1_428"></a>1、测试逻辑</h5> 
<ol><li><code>MockMvcBuilder</code>构造MockMvc的构造器</li><li><code>mockMvc</code>调用<code>perform</code>，执行一个<code>RequestBuilder</code>请求，调用<code>Controller</code>的业务处理逻辑</li><li><code>perform</code>返回<code>ResultActions</code>，返回操作结果，通过<code>ResultActions</code>，提供了统一的验证方式</li><li>使用<code>StatusResultMatchers</code>对请求结果进行验证</li><li>使用<code>ContentResultMatchers</code>对请求返回的内容进行验证</li></ol> 
<h5><a id="2MockMvcBuilder_437"></a>2、MockMvcBuilder</h5> 
<p><code>MockMvc</code>是spring测试下的一个非常好用的类，他们的初始化需要在setUp中进行。<br> <code>MockMvcBuilder</code>是用来构造<code>MockMvc</code>的构造器，其主要有两个实现：<code>StandaloneMockMvcBuilder</code>和<code>DefaultMockMvcBuilder</code>，前者继承了后者。</p> 
<ol><li><code>MockMvcBuilders.webAppContextSetup(WebApplicationContext context)</code>：指定WebApplicationContext，将会从该上下文获取相应的控制器并得到相应的MockMvc</li><li><code>MockMvcBuilders.standaloneSetup(Object... controllers)</code>：通过参数指定一组控制器，这样就不需要从上下文获取了，比如<code>this.mockMvc = MockMvcBuilders.standaloneSetup(this.controller).build();</code>这些Builder还提供了其他api，可以自行百度</li></ol> 
<h5><a id="3MockMvcRequestBuilders_447"></a>3、MockMvcRequestBuilders</h5> 
<p>从名字可以看出，RequestBuilder用来构建请求的，其提供了一个方法<code>buildRequest(ServletContext servletContext)</code>用于构建MockHttpServletRequest；其主要有两个子类<code>MockHttpServletRequestBuilder</code>和<code>MockMultipartHttpServletRequestBuilder</code>（如文件上传使用），即用来Mock客户端请求需要的所有数据。</p> 
<p>常用API：</p> 
<ul><li><code>MockHttpServletRequestBuilder get(String urlTemplate, Object... urlVariables)</code>：根据uri模板和uri变量值得到一个GET请求方式的RequestBuilder，如果在controller的方法中method选择的是<code>RequestMethod.GET</code>，那在controllerTest中对应就要使用<code>MockMvcRequestBuilders.get</code></li><li><code>post(String urlTemplate, Object... urlVariables)</code>：同get类似，但是是POST方法</li><li><code>put(String urlTemplate, Object... urlVariables)</code>：同get类似，但是是PUT方法</li><li><code>delete(String urlTemplate, Object... urlVariables)</code> ：同get类似，但是是DELETE方法</li><li><code>options(String urlTemplate, Object... urlVariables)</code>：同get类似，但是是OPTIONS方法</li></ul> 
<h5><a id="4ResultActions_461"></a>4、ResultActions</h5> 
<p>调用<code>MockMvc.perform(RequestBuilder requestBuilder)</code>后将得到<code>ResultActions</code>，对ResultActions有以下三种处理：</p> 
<ul><li><code>ResultActions.andExpect</code>：添加执行完成后的断言。添加ResultMatcher验证规则，验证控制器执行完成后结果是否正确</li><li><code>ResultActions.andDo</code>：添加一个结果处理器，比如此处使用<code>.andDo(MockMvcResultHandlers.print())</code>输出整个响应结果信息，可以在调试的时候使用</li><li><code>ResultActions.andReturn</code>：表示执行完成后返回相应的结果</li></ul> 
<p>ResultHandler用于对处理的结果进行相应处理的，比如输出整个请求/响应等信息方便调试，Spring mvc测试框架提供了<code>MockMvcResultHandlers</code>静态工厂方法，该工厂提供了<code>ResultHandler print()</code>返回一个输出MvcResult详细信息到控制台的ResultHandler实现。</p> 
<p>使用Content-type来指定不同格式的请求信息：</p> 
<pre><code class="prism language-java">ALL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_ATOM_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"atom+xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_CBOR <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"cbor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_FORM_URLENCODED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"x-www-form-urlencoded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_JSON <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_JSON_UTF8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"json"</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_NDJSON <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"x-ndjson"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_OCTET_STREAM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"octet-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_PDF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"pdf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_PROBLEM_JSON <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"problem+json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_PROBLEM_JSON_UTF8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"problem+json"</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_PROBLEM_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"problem+xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_RSS_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"rss+xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_STREAM_JSON <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"stream+json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_XHTML_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"xhtml+xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
APPLICATION_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"application"</span><span class="token punctuation">,</span> <span class="token string">"xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IMAGE_GIF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> <span class="token string">"gif"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IMAGE_JPEG <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> <span class="token string">"jpeg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
IMAGE_PNG <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">,</span> <span class="token string">"png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MULTIPART_FORM_DATA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"multipart"</span><span class="token punctuation">,</span> <span class="token string">"form-data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MULTIPART_MIXED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"multipart"</span><span class="token punctuation">,</span> <span class="token string">"mixed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MULTIPART_RELATED <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"multipart"</span><span class="token punctuation">,</span> <span class="token string">"related"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TEXT_EVENT_STREAM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"event-stream"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TEXT_HTML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TEXT_MARKDOWN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"markdown"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TEXT_PLAIN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TEXT_XML <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token string">"xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="5ResultMatchers_505"></a>5、ResultMatchers</h5> 
<p><code>ResultMatcher</code>用来匹配执行完请求后的结果验证，其就一个<code>match(MvcResult result)</code>断言方法，如果匹配失败将抛出相应的异常，spring mvc测试框架提供了很多<code>***ResultMatchers</code>来满足测试需求。</p> 
<p><code>MockMvcResultMatchers</code>类提供了许多静态方法，提供了多种匹配器：</p> 
<ul><li><strong>request()</strong>：返回<code>RequestResultMatchers</code>，访问与请求相关的断言 
  <ul><li><code>asyncStarted</code>：断言异步处理开始</li><li><code>asyncNotStarted</code>：断言异步不开始</li><li><code>asyncResult</code>：断言使用给定匹配器进行异步处理的结果</li><li><code>attribute</code>：用于断言请求属性值</li><li><code>sessionAttribute</code>：用于断言Session会话属性值</li><li><code>sessionAttributeDoesNotExist</code>：断言Session会话属性不存在</li></ul> </li><li><strong>handler()</strong>：返回<code>HandlerResultMatchers</code>，对处理请求的处理程序的断言的访问 
  <ul><li><code>handlerType</code>：断言处理请求的处理程序的类型</li><li><code>methodCall</code>：断言用于处理请求的控制器方法</li><li><code>methodName</code>：断言用于处理请求的控制器方法的名称</li><li><code>method</code>：断言用于处理请求的控制器方法</li></ul> </li><li><strong>model()</strong>：<code>ModelResultMatchers</code>，访问与模型相关的断言 
  <ul><li><code>attribute</code>：断言一个模型属性值</li><li><code>attributeExists</code>：断言一个模型属性存在</li><li><code>attributeDoesNotExist</code>：断言一个模型属性不存在</li><li><code>attributeErrorCount</code>：断言给定的模型属性有指定个数的错误</li><li><code>attributeHasErrors</code>：断言给定的模型属性有错误</li><li><code>attributeHasNoErrors</code>：断言给定的模型属性没有错误</li><li><code>attributeHasFieldErrors</code>：断言给定的模型属性字段有错误</li><li><code>attributeHasFieldErrorCode</code>：使用精确字符串匹配断言模型属性的字段错误代码</li><li><code>errorCount</code>：断言模型中的错误总数</li><li><code>hasErrors</code>：断言模型中有错误</li><li><code>hasNoErrors</code>：断言模型中没有错误</li><li><code>size</code>：断言模型属性的数量</li></ul> </li><li><strong>view()</strong>：返回<code>ViewResultMatchers</code>，访问所选视图上的断言 
  <ul><li><code>name</code>：断言视图名</li></ul> </li><li><strong>flash()</strong>：返回<code>FlashAttributeResultMatchers</code>，访问flash属性断言 
  <ul><li><code>attribute</code>：断言flash属性的值</li><li><code>attributeExists</code>：断言给定的flash属性是否存在</li><li><code>attributeCount</code>：断言flash属性的数量</li></ul> </li><li><strong>forwardedUrl(@Nullable String expectedUrl)</strong>：断言请求被转发到给定的URL</li><li><strong>forwardedUrlTemplate(String urlTemplate, Object… uriVars)</strong>：断言请求被转发到给定的URL模板</li><li><strong>forwardedUrlPattern(String urlPattern)</strong>：断言请求被转发到给定的URL</li><li><strong>redirectedUrl(String expectedUrl)</strong>：断言请求被重定向到给定的URL</li><li><strong>redirectedUrlTemplate(String urlTemplate, Object… uriVars)</strong>：断言请求被重定向到给定的URL模板</li><li><strong>redirectedUrlPattern(String urlPattern)</strong>：断言请求被重定向到给定的URL</li><li><strong>status()</strong>：返回<code>StatusResultMatchers</code>，访问响应状态断言 
  <ul><li><code>is</code>：断言响应状态码</li><li><code>is1xxInformational</code>：断言响应状态码在1xx范围内</li><li><code>is2xxSuccessful</code>：断言响应状态码在2xx范围内</li><li><code>is3xxRedirection</code>：断言响应状态码在3xx范围内</li><li><code>is4xxClientError</code>：断言响应状态码在4xx范围内</li><li><code>is5xxServerError</code>：断言响应状态码在5xx范围内</li><li><code>reason</code>：断言Servlet响应错误消息</li><li><code>isContinue</code>：响应状态码是100</li><li><code>isSwitchingProtocols</code>：响应状态码是101</li><li><code>isProcessing</code>：响应状态码是102</li><li><code>isCheckpoint</code>：响应状态码是103</li><li><code>isOk</code>：响应状态码是200</li><li><code>isCreated</code>：响应状态码是201</li><li><code>isAccepted</code>：响应状态码是202</li><li><code>isNonAuthoritativeInformation</code>：响应状态码是203</li><li><code>isNoContent</code>：响应状态码是204</li><li><code>isResetContent</code>：响应状态码是205</li><li><code>isPartialContent</code>：响应状态码是206</li><li><code>isMultiStatus</code>：响应状态码是207</li><li><code>isAlreadyReported</code>：响应状态码是208</li><li><code>isImUsed</code>：响应状态码是226</li><li><code>isMultipleChoices</code>：响应状态码是300</li><li><code>isMovedPermanently</code>：响应状态码是301</li><li><code>isFound</code>：响应状态码是302</li><li><code>isSeeOther</code>：响应状态码是303</li><li><code>isNotModified</code>：响应状态码是304</li><li><code>isUseProxy</code>：响应状态码是305</li><li><code>isTemporaryRedirect</code>：响应状态码是307</li><li><code>isPermanentRedirect</code>：响应状态码是308</li><li><code>isBadRequest</code>：响应状态码是400</li><li><code>isUnauthorized</code>：响应状态码是401</li><li><code>isPaymentRequired</code>：响应状态码是402</li><li><code>isForbidden</code>：响应状态码是403</li><li><code>isNotFound</code>：响应状态码是404</li><li><code>isMethodNotAllowed</code>：响应状态码是405</li><li><code>isNotAcceptable</code>：响应状态码是406</li><li><code>isProxyAuthenticationRequired</code>：响应状态码是407</li><li><code>isRequestTimeout</code>：响应状态码是408</li><li><code>isConflict</code>：响应状态码是409</li><li><code>isGone</code>：响应状态码是410</li><li><code>isLengthRequired</code>：响应状态码是411</li><li><code>isPreconditionFailed</code>：响应状态码是412</li><li><code>isPayloadTooLarge</code>：响应状态码是413</li><li><code>isUriTooLong</code>：响应状态码是414</li><li><code>isUnsupportedMediaType</code>：响应状态码是415</li><li><code>isRequestedRangeNotSatisfiable</code>：响应状态码是416</li><li><code>isExpectationFailed</code>：响应状态码是417</li><li><code>isIAmATeapot</code>：响应状态码是418</li><li><code>isInsufficientSpaceOnResource</code>：响应状态码是419</li><li><code>isMethodFailure</code>：响应状态码是420</li><li><code>isDestinationLocked</code>：响应状态码是421</li><li><code>isUnprocessableEntity</code>：响应状态码是422</li><li><code>isLocked</code>：响应状态码是423</li><li><code>isFailedDependency</code>：响应状态码是424</li><li><code>isTooEarly</code>：响应状态码是425</li><li><code>isUpgradeRequired</code>：响应状态码是426</li><li><code>isPreconditionRequired</code>：响应状态码是428</li><li><code>isTooManyRequests</code>：响应状态码是429</li><li><code>isRequestHeaderFieldsTooLarge</code>：响应状态码是431</li><li><code>isUnavailableForLegalReasons</code>：响应状态码是451</li><li><code>isInternalServerError</code>：响应状态码是500</li><li><code>isNotImplemented</code>：响应状态码是501</li><li><code>isBadGateway</code>：响应状态码是502</li><li><code>isServiceUnavailable</code>：响应状态码是503</li><li><code>isGatewayTimeout</code>：响应状态码是504</li><li><code>isHttpVersionNotSupported</code>：响应状态码是505</li><li><code>isVariantAlsoNegotiates</code>：响应状态码是506</li><li><code>isInsufficientStorage</code>：响应状态码是507</li><li><code>isLoopDetected</code>：响应状态码是508</li><li><code>isBandwidthLimitExceeded</code>：响应状态码是509</li><li><code>isNotExtended</code>：响应状态码是510</li><li><code>isNetworkAuthenticationRequired</code>：响应状态码是511</li></ul> </li><li><strong>header()</strong>：返回<code>HeaderResultMatchers</code>，访问响应头断言 
  <ul><li><code>string</code>：断言响应头的主值</li><li><code>stringValues</code>：断言响应头的值</li><li><code>exists</code>：断言指定的响应头存在</li><li><code>doesNotExist</code>：断言指定的响应头不存在</li><li><code>longValue</code>：将指定响应头断言为long</li><li><code>dateValue</code>：断言指定响应头解析为日期</li></ul> </li><li><strong>content()</strong>：返回<code>ContentResultMatchers</code>，访问响应体断言 
  <ul><li><code>contentType</code>：断言Content-Type，给定的内容类型必须完全匹配，包括类型、子类型和参数</li><li><code>contentTypeCompatibleWith</code>：断言Content-Type与指定的类型兼容</li><li><code>encoding</code>：断言响应的字符编码</li><li><code>string</code>：断言响应体内容（作为字符串）</li><li><code>bytes</code>：断言响应体内容（作为字节数组）</li><li><code>xml</code>：断言响应体内容（作为Xml）</li><li><code>source</code>：断言响应体内容（作为Source）</li><li><code>json</code>：断言响应体内容（作为json）</li></ul> </li><li><strong>jsonPath(String expression, Object… args)</strong>：返回<code>JsonPathResultMatchers</code>，使用JsonPath表达式访问响应体断言 
  <ul><li><code>prefix</code>：断言JSON有效负载是否添加了给定的前缀</li><li><code>value</code>：根据JsonPath断言结果值</li><li><code>exists</code>：根据JsonPath断言在给定路径上存在非空值</li><li><code>doesNotExist</code>：根据JsonPath断言在给定路径上不存在非空值</li><li><code>isEmpty</code>：根据JsonPath断言给定路径中存在空值</li><li><code>isNotEmpty</code>：根据JsonPath断言给定路径中不存在空值</li><li><code>hasJsonPath</code>：根据JsonPath断言给定路径中存在一个值</li><li><code>doesNotHaveJsonPath</code>：根据JsonPath断言给定路径中不存在一个值</li><li><code>isString</code>：根据JsonPath断言结果是String</li><li><code>isBoolean</code>：根据JsonPath断言结果是Boolean</li><li><code>isNumber</code>：根据JsonPath断言结果是Number</li><li><code>isArray</code>：根据JsonPath断言结果是Array</li><li><code>isMap</code>：根据JsonPath断言结果是Map</li></ul> </li><li><strong>jsonPath(String expression, Matcher&lt;? super T&gt; matcher)</strong>：根据响应体计算给定的JsonPath表达式，并使用给定的Hamcrest Matcher断言结果值</li><li><strong>jsonPath(String expression, Matcher&lt;? super T&gt; matcher, Class targetType)</strong>：根据响应体计算给定的JsonPath表达式，并使用给定的Hamcrest Matcher断言结果值，在应用匹配器之前将结果值强制转换为给定的目标类型</li><li><strong>xpath(String expression, Object… args)</strong>：返回<code>XpathResultMatchers</code>，使用XPath表达式访问响应体断言，以检查响应体的特定子集 
  <ul><li><code>node</code>：计算XPath并断言使用给定的Hamcrest Matcher找到的Node内容</li><li><code>nodeList</code>：计算XPath并断言与给定的Hamcrest Matcher找到的NodeList内容</li><li><code>exists</code>：计算XPath并断言内容存在</li><li><code>doesNotExist</code>：计算XPath并断言内容不存在</li><li><code>nodeCount</code>：计算XPath并断言使用给定的Hamcrest Matcher找到的节点数</li><li><code>string</code>：应用XPath并断言用给定的Hamcrest Matcher找到的String值</li><li><code>number</code>：计算XPath并断言用给定的Hamcrest Matcher找到的Double值</li><li><code>booleanValue</code>：计算XPath并断言找到的Boolean</li></ul> </li><li><strong>xpath(String expression, Map&lt;String, String&gt; namespaces, Object… args)</strong>：使用XPath表达式访问响应体断言，以检查响应体的特定子集</li><li><strong>cookie()</strong>：返回CookieResultMatchers，访问响应cookie断言 
  <ul><li><code>value</code>：使用给定的Hamcrest Matcher断言一个cookie值</li><li><code>exists</code>：断言cookie存在</li><li><code>doesNotExist</code>：断言cookie不存在</li><li><code>maxAge</code>：使用Hamcrest Matcher断言cookie的maxAge</li><li><code>path</code>：用Hamcrest Matcher断言一个cookie的路径</li><li><code>domain</code>：使用Hamcrest Matcher断言cookie的域</li><li><code>comment</code>：用Hamcrest Matcher断言一个cookie的注释</li><li><code>version</code>：用Hamcrest Matcher断言一个cookie的版本</li><li><code>secure</code>：断言cookie是否必须通过安全协议发送</li><li><code>httpOnly</code>：断言cookie是否只能是HTTP</li></ul> </li></ul> 
<h5><a id="6MvcResult_676"></a>6、MvcResult</h5> 
<p>即执行完控制器后得到的整个结果，并不仅仅是返回值，其包含了测试时需要的所有信息。</p> 
<p>MvcResult有两个实现类：</p> 
<ul><li><strong>DefaultMvcResult</strong>：一个简单的默认实现</li><li><strong>PrintingMvcResult</strong>：待打印功能的实现</li></ul> 
<p>常用方法：</p> 
<ul><li><strong>getRequest</strong>：返回执行的请求</li><li><strong>getResponse</strong>：返回结果响应</li><li><strong>getHandler</strong>：返回已执行的处理程序</li><li><strong>getInterceptors</strong>：返回处理程序周围的拦截器</li><li><strong>getModelAndView</strong>：返回处理程序准备的ModelAndView</li><li><strong>getResolvedException</strong>：返回由处理程序引发并通过HandlerExceptionResolver成功解决的任何异常</li><li><strong>getFlashMap</strong>：返回在请求处理期间保存的FlashMap</li><li><strong>getAsyncResult</strong>：得到异步执行的结果</li></ul> 
<h3><a id="5_697"></a>5、业务代码</h3> 
<p>实体类：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Double</span> height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Dao层：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>UserMapper.xml：</p> 
<pre><code class="prism language-xml"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> <span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>pers.zhang.mapper.UserMapper<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        INSERT INTO user (name, age, height)
        VALUES (#{name}, #{age}, #{height})
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        UPDATE user SET name = #{name}, age = #{age}, height = #{height}
        WHERE id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteById<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        DELETE FROM user
        WHERE id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>list<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pers.zhang.entity.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id, name, age, height
        FROM user;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pers.zhang.entity.User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id, name, age, height
        FROM user
        WHERE id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Service层：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Integer</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call userMapper.list..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call userMapper.add..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call userMapper.update..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call userMapper.deleteById..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call userMapper.getById..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Controller层：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call UserService.list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/info"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call UserService.getUserById"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call UserService.add"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call UserService.update"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call UserService.delete"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_861"></a>6、分层测试</h3> 
<h4><a id="61Dao_863"></a>6.1、Dao层测试</h4> 
<p>在UserMapperTest测试类中可以直接使用@Autowired来装配UserMapper这个Bean。而且，@SpringBootTest注解会自动帮我们完成启动一个Spring容器ApplicationContext，然后连接数据库，执行一套完整的业务逻辑。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>



<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 数据库user表内容如下：
     *
     *  id  |  name  |  age  |  height  |
     *  1      tom      18       1.77
     *  2      jerry    22       1.83
     *  3      mike     24       1.79
     */</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">extracting</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>
                        <span class="token function">tuple</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">tuple</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"jerry"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">1.83</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">tuple</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token string">"mike"</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">1.79</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1.66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1.88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">7L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">7L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> expect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expect<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expect<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expect<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        expect<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>expect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="62Service_948"></a>6.2、Service层测试</h4> 
<p>上面的测试代码是连接真实数据库来执行真实的Dao层数据库查询逻辑。而在实际开发中，有时候需要独立于数据库进行Service层逻辑的开发。这个时候就可以直接把数据库Dao层代码Mock掉。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserMapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name">UserServiceImplTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//Mock掉Dao层</span>
    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token comment">//把Mock掉的Dao层注入Service</span>
    <span class="token annotation punctuation">@InjectMocks</span>
    <span class="token keyword">private</span> <span class="token class-name">UserServiceImpl</span> userService<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//开启Mockito注解</span>
        <span class="token class-name">MockitoAnnotations</span><span class="token punctuation">.</span><span class="token function">openMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">10L</span><span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">11L</span><span class="token punctuation">,</span> <span class="token string">"lisi"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">1.83</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">1.80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">isA</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">1.80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">argThat</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> u <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token function">anyLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">Integer</span> effectRows <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">999L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>effectRows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">999L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">1.92</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">User</span> actual <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>actual<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInstanceOf</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userMapper<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-java"><span class="token class-name">Call</span> userMapper<span class="token punctuation">.</span>update<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token class-name">Call</span> userMapper<span class="token punctuation">.</span>getById<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token class-name">Call</span> userMapper<span class="token punctuation">.</span>add<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token class-name">Call</span> userMapper<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> name<span class="token operator">=</span>zhangsan<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1.77</span><span class="token punctuation">)</span>
<span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">11</span><span class="token punctuation">,</span> name<span class="token operator">=</span>lisi<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1.83</span><span class="token punctuation">)</span>

<span class="token class-name">Call</span> userMapper<span class="token punctuation">.</span>deleteById<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h4><a id="63Controller_1065"></a>6.3、Controller层测试</h4> 
<p>spring-boot-starter-test提供了MockMvc对Controller测试功能的强大支持。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">BeforeEach</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">InjectMocks</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mock</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">MockitoAnnotations</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">MvcResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>setup<span class="token punctuation">.</span></span><span class="token class-name">MockMvcBuilders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">pers<span class="token punctuation">.</span>zhang<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>mockito<span class="token punctuation">.</span></span><span class="token class-name">Mockito</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span>*<span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Mock</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@InjectMocks</span>
    <span class="token keyword">private</span> <span class="token class-name">UserController</span> userController<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@BeforeEach</span>
    <span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//开启Mockito注解</span>
        <span class="token class-name">MockitoAnnotations</span><span class="token punctuation">.</span><span class="token function">openMocks</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//初始化MockMvc，将UserController注入其中</span>
        mockMvc <span class="token operator">=</span> <span class="token class-name">MockMvcBuilders</span><span class="token punctuation">.</span><span class="token function">standaloneSetup</span><span class="token punctuation">(</span>userController<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>
                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">,</span> <span class="token string">"jerry"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">1.88</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">MvcResult</span> mvcResult <span class="token operator">=</span> mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user/list"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token function">anyLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">MvcResult</span> mvcResult <span class="token operator">=</span> mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user/info"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"jerry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token number">1.74</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">isA</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">MvcResult</span> mvcResult <span class="token operator">=</span> mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/add"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">"{\"name\": \"jerry\", \"age\": 22, \"height\": 1.74}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token function">isA</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">MvcResult</span> mvcResult <span class="token operator">=</span> mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/update"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">"{\"id\": 1, \"name\": \"tom\", \"age\": 18, \"height\": 1.77}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//打桩</span>
        <span class="token function">when</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token function">anyLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenReturn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用</span>
        <span class="token class-name">MvcResult</span> mvcResult <span class="token operator">=</span> mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/delete"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>mvcResult<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//验证</span>
        <span class="token function">verify</span><span class="token punctuation">(</span>userService<span class="token punctuation">,</span> <span class="token function">times</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="7JSON_1203"></a>7、JSON接口测试</h3> 
<p>使用JsonPath可以像JavaScript语法一样方便地进行JSON数据返回的访问操作。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hamcrest<span class="token punctuation">.</span></span><span class="token class-name">Matchers</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">AutoConfigureMockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">MockMvc</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>request<span class="token punctuation">.</span></span><span class="token class-name">MockMvcRequestBuilders</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">;</span>



<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@AutoConfigureMockMvc</span>
<span class="token keyword">class</span> <span class="token class-name">JsonControllerTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MockMvc</span> mockMvc<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 数据库user表内容如下：
     *
     *  id  |  name  |  age  |  height  |
     *  1      tom      18       1.77
     *  2      jerry    22       1.83
     *  3      mike     24       1.79
     */</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
                    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user/list"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">//响应码200</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">//json数组长度为3</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.length()"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">//name包含指定值</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$..name"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"jerry"</span><span class="token punctuation">,</span> <span class="token string">"mike"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
                    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user/info"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.name"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">"tom"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.age"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$.height"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1.77</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/add"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">"{\"name\": \"zhangsan\", \"age\":  40, \"height\": 1.76}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/update"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">"{\"id\": 9, \"name\": \"lisi\", \"age\":  44, \"height\": 1.76}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        mockMvc<span class="token punctuation">.</span><span class="token function">perform</span><span class="token punctuation">(</span><span class="token class-name">MockMvcRequestBuilders</span>
                    <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/user/delete"</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span>APPLICATION_JSON<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andExpect</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultMatchers</span><span class="token punctuation">.</span><span class="token function">jsonPath</span><span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">,</span> <span class="token class-name">Matchers</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">andDo</span><span class="token punctuation">(</span><span class="token class-name">MockMvcResultHandlers</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ee36b40edb05b21eb276a8e0526f631/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">学生信息管理系统(Python版)，2024最新版，流程齐全，快来围观</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/10e7a011da295d1fc1543b4877934f6b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AIGC面经大全（持续更新）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>