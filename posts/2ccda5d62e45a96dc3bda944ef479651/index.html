<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>三个方法计算两张图片的相似度 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2ccda5d62e45a96dc3bda944ef479651/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="三个方法计算两张图片的相似度">
  <meta property="og:description" content="import cv2 import numpy as np from skimage.metrics import structural_similarity as ssim import os def is_similar(image1, image2, threshold=0.95): &#39;&#39;&#39; 对图像的颜色信息敏感，能快速计算。 对图像的旋转、缩放等几何变换不敏感。 缺点: 对图像的结构、纹理等信息不敏感。 不能很好地处理图像的局部变化或噪声。 &#39;&#39;&#39; # 将图像转换为灰度图像 image1_gray = cv2.cvtColor(image1, cv2.COLOR_BGR2GRAY) image2_gray = cv2.cvtColor(image2, cv2.COLOR_BGR2GRAY) # 计算直方图 hist1 = cv2.calcHist([image1_gray], [0], None, [256], [0, 256]) hist2 = cv2.calcHist([image2_gray], [0], None, [256], [0, 256]) # 归一化直方图 cv2.normalize(hist1, hist1, alpha=0, beta=1, norm_type=cv2.NORM_MINMAX) cv2.normalize(hist2, hist2, alpha=0, beta=1, norm_type=cv2.NORM_MINMAX) # 计算相似度 similarity = cv2.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-25T10:41:00+08:00">
    <meta property="article:modified_time" content="2024-06-25T10:41:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">三个方法计算两张图片的相似度</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <pre><code class="prism language-cpp"><span class="token keyword">import</span> <span class="token module">cv2</span>
<span class="token keyword">import</span> <span class="token module">numpy</span> as np
from skimage<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> <span class="token module">structural_similarity</span> as ssim
<span class="token keyword">import</span> <span class="token module">os</span>

def <span class="token function">is_similar</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> image2<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.95</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token char">''</span>'
    对图像的颜色信息敏感，能快速计算。
    对图像的旋转、缩放等几何变换不敏感。
    缺点<span class="token operator">:</span>
    对图像的结构、纹理等信息不敏感。
    不能很好地处理图像的局部变化或噪声。
    
    <span class="token char">''</span>'
    # 将图像转换为灰度图像
    image1_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    image2_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>

    # 计算直方图
    hist1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token punctuation">[</span>image1_gray<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    hist2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">calcHist</span><span class="token punctuation">(</span><span class="token punctuation">[</span>image2_gray<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> None<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    # 归一化直方图
    cv2<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>hist1<span class="token punctuation">,</span> hist1<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> norm_type<span class="token operator">=</span>cv2<span class="token punctuation">.</span>NORM_MINMAX<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span><span class="token function">normalize</span><span class="token punctuation">(</span>hist2<span class="token punctuation">,</span> hist2<span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> norm_type<span class="token operator">=</span>cv2<span class="token punctuation">.</span>NORM_MINMAX<span class="token punctuation">)</span>

    # 计算相似度
    similarity <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">compareHist</span><span class="token punctuation">(</span>hist1<span class="token punctuation">,</span> hist2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>HISTCMP_CORREL<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"similarity"</span><span class="token punctuation">,</span>similarity<span class="token punctuation">)</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">return</span> <span class="token expression">similarity <span class="token operator">&gt;</span> threshold</span></span>
def <span class="token function">calculate_ssim</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> image2<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token char">''</span>'
    结构相似性指数（Structural Similarity Index<span class="token punctuation">,</span> SSIM）<span class="token operator">:</span>
    
    优点<span class="token operator">:</span>
    综合考虑了亮度、对比度和结构信息，能够更好地反映人类视觉感知。
    对局部变化和噪声有较好的鲁棒性。
    缺点<span class="token operator">:</span>
    计算复杂度较高，速度较慢。
    对大范围的几何变换不敏感。
    适用场景<span class="token operator">:</span>
    适用于需要精确比较图像结构信息的场景，如图像压缩质量评估、图像增强效果评估等医学图像分析。
    <span class="token char">''</span>'
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Convert images to grayscale</span></span>
    gray1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    gray2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Calculate SSIM</span></span>
    ssim_score<span class="token punctuation">,</span> _ <span class="token operator">=</span> <span class="token function">ssim</span><span class="token punctuation">(</span>gray1<span class="token punctuation">,</span> gray2<span class="token punctuation">,</span> full<span class="token operator">=</span>True<span class="token punctuation">)</span>

    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span></span><span class="token string">"calculate_ssim"</span><span class="token expression"><span class="token punctuation">,</span>ssim_score<span class="token punctuation">)</span></span></span>
    <span class="token keyword">return</span> ssim_score
def <span class="token function">calculate_mae</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> image2<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token char">''</span>'
    
    均值绝对误差（Mean Absolute Error<span class="token punctuation">,</span> MAE）<span class="token operator">:</span>
    
    优点<span class="token operator">:</span>
    简单直接，计算像素值的绝对差异。
    对图像的整体亮度变化敏感。
    缺点<span class="token operator">:</span>
    对图像的几何变换（如平移、旋转、缩放）敏感。
    不能很好地处理局部变化和噪声。
    适用场景<span class="token operator">:</span>
    适用于对整体亮度或颜色变化敏感的场景，如医学图像分析、监控图像等。
    <span class="token char">''</span>'
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Convert images to grayscale</span></span>
    gray1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image1<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    gray2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>image2<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Calculate Mean Absolute <span class="token function">Error</span> <span class="token punctuation">(</span>MAE<span class="token punctuation">)</span></span></span>
    mae <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">mean</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>gray1 <span class="token operator">-</span> gray2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span></span><span class="token string">"mae"</span><span class="token expression"><span class="token punctuation">,</span>mae<span class="token punctuation">)</span>  #<span class="token number">0</span>到<span class="token number">255</span> 越小越来约相似</span></span>
    <span class="token keyword">return</span> mae
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eed1568d9386de1333091b37de293b78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">flatMap 详细解析 Java 8 Stream API 中的 flatMap 方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d4c2c98263be5e932b4bc5821847b90b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">手机远程控制另一台手机的全新使用教程（安卓版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>