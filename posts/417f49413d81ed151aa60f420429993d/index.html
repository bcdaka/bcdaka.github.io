<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android安卓app渗透测试环境-抓包教程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/417f49413d81ed151aa60f420429993d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android安卓app渗透测试环境-抓包教程">
  <meta property="og:description" content="前言 今年是2024年，刚过完春节后的第二个工作日，从去年的暑假开始入职，已经有超半年时间了，比起那时候啥都不会的小白，现在起码是懂一点的小白了，过年前的几天还因调休请假的事情给领导产生了不好的印象。啥也没有的我，不指望可以顺利转正了，只保佑可以开心的度过剩下的半年时间。根据去年的网络安全大厂的经济状况，不出意外，去年的年会草草结束和今年的开工红包都没有了，也不知道这行该怎么走下去了。不管怎样，技术还是要提升的，现如今Web层面的漏洞也越来越少，app越来越多导致这方面的安全刻不容缓，多一个技术在手，让自己不必那么早被淘汰…
由于HTTPS的单向认证和双向认证机制，导致Android 7以上的版本，系统不信任第三方安装的证书，也就是所谓的证书锁定Ssl pinning，导致我们抓取不到HTTPS的报文或者报文乱码，之前可以通过Xposed&#43;Trustme绕过，此方法只适用于Android 7以下的版本，但由于现在的app版本越来越高也不再支持低版本的Android系统，于是就产生了本篇文章，大多数app也只采用了单向认证的方式，双向认证成本高，也可以绕过，本文只讨论单向认证方式的绕过。
环境准备 夜神模拟器Android 9版本
Magisk_v25.2 &#43; Lsposed_1.8.6
TrustMeAlready-v1.11-release
Postern_v3.1.3
Android软件包地址：链接：https://pan.baidu.com/s/1qLP2EhHiV9rTUOJZGsOUGQ?pwd=pdxx
提取码：pdxx
安装Magisk&#43;Lsposed 打开夜神模拟器，并添加Android 9版本
直接将Magisk的这两个安装包拖入夜神模拟器中，会自动安装
然后上传Magisk安装包到指定路径，后面需要通过路径进行安装
打开Magisk 鸭，并根据以下步骤依次输入命令
输入m然后回车
输入Y然后回车
进入以下界面，选择允许超级用户请求并永久记住选择
然后回到命令行界面
输入1然后回车
输入x然后回车
输入刚刚上传的Magisk安装包路径：也就是：/sdcard/Pictures/25206.apk
输入路径后回车
输入1然后回车，看到重启模拟器界面
关掉模拟器的开启root模式，不然会与magisk的root冲突，重启
去掉勾选即为关闭
打开magisk，看到版本号，则表示magisk安装成功
点击右上角的设置，划到此处开启Zygisk，为后续安装Lsposed做准备
像拖入magisk安装包的方式拖入Lspose的zip压缩包，并会将此压缩包保存在/storage/emulated/0/Pictures这个文件夹中
点击模块，并从本地安装模块
找到/storage/emulated/0/Pictures这个路径，并选中Lsposed压缩包文件
看到此界面表示安装成功，然后重启，最好是将当前Android 9模拟器重启，不要直接点击下面的重启按钮
重启后，像往下划出菜单即可看到Lsposed加载出来
通知栏 点开（如果没显示，可以通过拨号键输入 ##5776733##** 进入LSPosed）
要想显示app图标可以直接拖入Lsposed.apk到模拟器
安装JustTrustme&#43;Postern 为什么要安装这玩意？
JustTrustme是用来绕过HTTPS的证书锁定
Postern是用来绕过代理检测，有些app检测你是否使用代理则直接关闭
最后是检测是否使用模拟器，这种的话使用真机吧，然后刷magisk&#43;Lsposed。目前不检测的话还是可以应付一下的
安装JustTrustme，直接拖入安装包就行了，so easy！
打开LSPosed，就可以直接看到成功安装JustTrustme模块了
拖入Postern安装包，即可安装成功
模拟器安装burp证书 查看当前ip信息，这个根据实际情况查看填写，具备一定的网络基础知识
模拟器设置成桥接，并设置一个静态ip，保存重启
模拟器进入设置，并点击WLAN，长按wifi即可弹出以下修改网络界面（可能需要取消保存网络）
输入刚才填入的静态ip
然后真机ping一下模拟器的ip查看是否成功
真机打开brup，设置一下监听的ip和端口号
模拟器打开Postern，然后配置代理服务器如下，代理服务器设置为burp的地址和端口，保存
配置规则如下，匹配所有
接下来就是下载burp证书了，不知道为啥模拟器通过浏览器访问burp的代理端口显示无法访问。
只能通过真机下载证书后直接拖入模拟器中了，其实这也是最快的
拖入模拟器的证书路径为/storage/emulated/0/Pictures，和安装Lsposed的原理是一样的
真机下载的好处就是可以直接将der后缀修改为cer后缀后再拖入会比较方便，一定要将der修改为cer后缀">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-25T21:36:53+08:00">
    <meta property="article:modified_time" content="2024-02-25T21:36:53+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android安卓app渗透测试环境-抓包教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>今年是2024年，刚过完春节后的第二个工作日，从去年的暑假开始入职，已经有超半年时间了，比起那时候啥都不会的小白，现在起码是懂一点的小白了，过年前的几天还因调休请假的事情给领导产生了不好的印象。啥也没有的我，不指望可以顺利转正了，只保佑可以开心的度过剩下的半年时间。根据去年的网络安全大厂的经济状况，不出意外，去年的年会草草结束和今年的开工红包都没有了，也不知道这行该怎么走下去了。不管怎样，技术还是要提升的，现如今Web层面的漏洞也越来越少，app越来越多导致这方面的安全刻不容缓，多一个技术在手，让自己不必那么早被淘汰…</p> 
<p>由于HTTPS的单向认证和双向认证机制，导致Android 7以上的版本，系统不信任第三方安装的证书，也就是所谓的证书锁定Ssl pinning，导致我们抓取不到HTTPS的报文或者报文乱码，之前可以通过Xposed+Trustme绕过，此方法只适用于Android 7以下的版本，但由于现在的app版本越来越高也不再支持低版本的Android系统，于是就产生了本篇文章，大多数app也只采用了单向认证的方式，双向认证成本高，也可以绕过，本文只讨论单向认证方式的绕过。</p> 
<h3><a id="_6"></a>环境准备</h3> 
<blockquote> 
 <p>夜神模拟器Android 9版本</p> 
 <p>Magisk_v25.2 + Lsposed_1.8.6</p> 
 <p>TrustMeAlready-v1.11-release</p> 
 <p>Postern_v3.1.3</p> 
</blockquote> 
<p>Android软件包地址：链接：https://pan.baidu.com/s/1qLP2EhHiV9rTUOJZGsOUGQ?pwd=pdxx<br> 提取码：pdxx</p> 
<h3><a id="MagiskLsposed_19"></a>安装Magisk+Lsposed</h3> 
<p>打开夜神模拟器，并添加Android 9版本</p> 
<p><img src="https://images2.imgbox.com/25/9e/nrrmlGHl_o.png" alt="file"></p> 
<p>直接将Magisk的这两个安装包拖入夜神模拟器中，会自动安装</p> 
<p><img src="https://images2.imgbox.com/69/f1/VEGHrezL_o.png" alt="file"></p> 
<p>然后上传Magisk安装包到指定路径，后面需要通过路径进行安装</p> 
<p><img src="https://images2.imgbox.com/35/c3/p258z0De_o.png" alt="file"></p> 
<p>打开Magisk 鸭，并根据以下步骤依次输入命令</p> 
<p>输入m然后回车</p> 
<p>输入Y然后回车</p> 
<p>进入以下界面，选择允许超级用户请求并永久记住选择</p> 
<p><img src="https://images2.imgbox.com/45/26/bQu9xHaX_o.png" alt="file"></p> 
<p>然后回到命令行界面</p> 
<p>输入1然后回车</p> 
<p>输入x然后回车</p> 
<p>输入刚刚上传的Magisk安装包路径：也就是：/sdcard/Pictures/25206.apk</p> 
<p>输入路径后回车</p> 
<p><img src="https://images2.imgbox.com/65/db/gL3B4Aqg_o.png" alt="file"></p> 
<p>输入1然后回车，看到重启模拟器界面</p> 
<p><img src="https://images2.imgbox.com/39/e7/a35LTOy9_o.png" alt="file"></p> 
<p>关掉模拟器的开启root模式，不然会与magisk的root冲突，重启</p> 
<p>去掉勾选即为关闭</p> 
<p><img src="https://images2.imgbox.com/56/e7/zZ7dwKhO_o.png" alt="file"></p> 
<p>打开magisk，看到版本号，则表示magisk安装成功</p> 
<p><img src="https://images2.imgbox.com/1c/fa/83FMss31_o.png" alt="file"></p> 
<p>点击右上角的设置，划到此处开启Zygisk，为后续安装Lsposed做准备</p> 
<p><img src="https://images2.imgbox.com/02/92/rEUS7jc8_o.png" alt="file"></p> 
<p>像拖入magisk安装包的方式拖入Lspose的zip压缩包，并会将此压缩包保存在/storage/emulated/0/Pictures这个文件夹中</p> 
<p><img src="https://images2.imgbox.com/fe/ab/VkxhcEuP_o.png" alt="file"></p> 
<p>点击模块，并从本地安装模块</p> 
<p><img src="https://images2.imgbox.com/bd/cb/7CzIfIDd_o.png" alt="file"></p> 
<p>找到/storage/emulated/0/Pictures这个路径，并选中Lsposed压缩包文件</p> 
<p><img src="https://images2.imgbox.com/ef/13/lOVTxWHN_o.png" alt="file"></p> 
<p>看到此界面表示安装成功，然后重启，最好是将当前Android 9模拟器重启，不要直接点击下面的重启按钮</p> 
<p><img src="https://images2.imgbox.com/67/92/NkXLXAks_o.png" alt="file"></p> 
<p>重启后，像往下划出菜单即可看到Lsposed加载出来</p> 
<p>通知栏 点开（如果没显示，可以通过拨号键输入 <em><em><em>#</em>#5776733#</em>#</em>** 进入LSPosed）</p> 
<p><img src="https://images2.imgbox.com/5f/33/MGmGo9Hb_o.png" alt="file"></p> 
<p>要想显示app图标可以直接拖入Lsposed.apk到模拟器</p> 
<p><img src="https://images2.imgbox.com/3b/d4/ov238bak_o.png" alt="file"></p> 
<h3><a id="JustTrustmePostern_99"></a>安装JustTrustme+Postern</h3> 
<p>为什么要安装这玩意？</p> 
<p>JustTrustme是用来绕过HTTPS的证书锁定</p> 
<p>Postern是用来绕过代理检测，有些app检测你是否使用代理则直接关闭</p> 
<p>最后是检测是否使用模拟器，这种的话使用真机吧，然后刷magisk+Lsposed。目前不检测的话还是可以应付一下的</p> 
<p>安装JustTrustme，直接拖入安装包就行了，so easy！</p> 
<p><img src="https://images2.imgbox.com/eb/84/hRBtQpFI_o.png" alt="file"></p> 
<p>打开LSPosed，就可以直接看到成功安装JustTrustme模块了</p> 
<p><img src="https://images2.imgbox.com/ac/e9/uwl8UEfz_o.png" alt="file"></p> 
<p>拖入Postern安装包，即可安装成功</p> 
<p><img src="https://images2.imgbox.com/bb/4f/sPDRR7Ip_o.png" alt="file"></p> 
<h3><a id="burp_122"></a>模拟器安装burp证书</h3> 
<p>查看当前ip信息，这个根据实际情况查看填写，具备一定的网络基础知识</p> 
<p><img src="https://images2.imgbox.com/91/ba/DJoevg2D_o.png" alt="file"></p> 
<p>模拟器设置成桥接，并设置一个静态ip，保存重启</p> 
<p><img src="https://images2.imgbox.com/0f/34/vvUoQDri_o.png" alt="file"></p> 
<p>模拟器进入设置，并点击WLAN，长按wifi即可弹出以下修改网络界面（可能需要取消保存网络）</p> 
<p><img src="https://images2.imgbox.com/0e/c1/AWidKjzl_o.png" alt="file"></p> 
<p>输入刚才填入的静态ip</p> 
<p><img src="https://images2.imgbox.com/dd/29/JBKv0owe_o.png" alt="file"></p> 
<p>然后真机ping一下模拟器的ip查看是否成功</p> 
<p><img src="https://images2.imgbox.com/2a/8b/6YvYDSUJ_o.png" alt="file"></p> 
<p>真机打开brup，设置一下监听的ip和端口号</p> 
<p><img src="https://images2.imgbox.com/b4/d6/x887SwM5_o.png" alt="file"></p> 
<p>模拟器打开Postern，然后配置代理服务器如下，代理服务器设置为burp的地址和端口，保存</p> 
<p><img src="https://images2.imgbox.com/41/c4/FLnpLZir_o.png" alt="file"></p> 
<p>配置规则如下，匹配所有</p> 
<p><img src="https://images2.imgbox.com/b2/86/3LaUjEMD_o.png" alt="file"></p> 
<p><img src="https://images2.imgbox.com/fd/95/gRg7PXhh_o.png" alt="file"></p> 
<p>接下来就是下载burp证书了，不知道为啥模拟器通过浏览器访问burp的代理端口显示无法访问。</p> 
<p><img src="https://images2.imgbox.com/cc/be/fnExHrAF_o.png" alt="file"></p> 
<p>只能通过真机下载证书后直接拖入模拟器中了，其实这也是最快的</p> 
<p>拖入模拟器的证书路径为/storage/emulated/0/Pictures，和安装Lsposed的原理是一样的</p> 
<p>真机下载的好处就是可以直接将der后缀修改为cer后缀后再拖入会比较方便，一定要将der修改为cer后缀</p> 
<p><img src="https://images2.imgbox.com/ef/85/CPNZhV5w_o.png" alt="file"></p> 
<p>进入设置找到安全性和位置信息</p> 
<p><img src="https://images2.imgbox.com/9d/d0/77fkjiMM_o.png" alt="file"></p> 
<p>加密与凭据</p> 
<p><img src="https://images2.imgbox.com/05/d3/sxEYacNo_o.png" alt="file"></p> 
<p>从sd卡中安装</p> 
<p><img src="https://images2.imgbox.com/ed/8d/z1nS2NS5_o.png" alt="file"></p> 
<p>找到cer证书后点击导入</p> 
<p><img src="https://images2.imgbox.com/79/b7/AkZ9CPgy_o.png" alt="file"></p> 
<p>随意启个名字后点击确定，后面需要重新设置个密码才可生效，这边随意设置了个弱密码</p> 
<p>到这里，证书已经成功安装完成了</p> 
<p><img src="https://images2.imgbox.com/81/81/TpQt44ve_o.png" alt="file"></p> 
<h3><a id="app_192"></a>案例：某旅游app抓包测试</h3> 
<p>互联网上寻找一个https的app，并且是单向认证的，如果不能抓包请考虑前面步骤是否成功配置或者此app采用双向认证换一个app尝试</p> 
<p>抓取一个app的获取验证码请求包即可成功，之前是无法抓取。<br> <img src="https://images2.imgbox.com/b1/ba/NAZnxVMC_o.png" alt="file"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c981badc2e1072c3c797d0b5e9bea14f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">numpy，matplotlib，python的版本对应（implement_array_function method already has a docstring报错）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/40fe76db26d4b9cb3961dda748a64e4f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">具身智能（Embodied AI）的概念、核心要素、难点及突破性进展</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>