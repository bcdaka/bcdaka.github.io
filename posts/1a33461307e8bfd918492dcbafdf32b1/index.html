<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>短信验证码实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1a33461307e8bfd918492dcbafdf32b1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="短信验证码实现">
  <meta property="og:description" content="一、设置AccessKey 创建用户并配置使用权限，使我们拥有调用 aliyunAPI 的权限，之后会生成 AccessKeyID 和 AccessKey密码，后面我们会使用到。需要注意的是 AccessKeyID 和 AccessKey密码生成后我们需要将他保存起来，否则后期无法查询到。
二、开启阿里云短信服务 在阿里云官网搜索短信服务，进入短信服务控制台。
1、资质管理 在这里我们申请个人资质即可，就不用上传企业的证明材料。注意个人的证件照片要清除，不能有遮挡，备注信息写上申请说明，不能随便写，审核一般在两个小时内。
2、签名管理 申请签名。
3、模板管理 这里的模板，就是我们发送短信的模板，需要注意的是，要注意选择纯数字，或者则是英文数字混合使用的模板。模板CODE后面我们需要使用。
三、SpringBoot整合阿里云SMS 1、整体流程 1、前端发送短信验证码的请求；
2、后端收到请求后，生成验证码的code，调用阿里云API 接口发送短信；
3、判断 SMS API 的返回信息，“OK”则为成功发布；
4、发布成功将code存入redis，供后期校验使用；
5、将存入redis时的key值返回给前端。
2、引入依赖 &lt;dependency&gt; &lt;groupId&gt;com.aliyun&lt;/groupId&gt; &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt; &lt;version&gt;4.6.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun&lt;/groupId&gt; &lt;artifactId&gt;dysmsapi20170525&lt;/artifactId&gt; &lt;version&gt;3.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.aliyun&lt;/groupId&gt; &lt;artifactId&gt;aliyun-java-sdk-dysmsapi&lt;/artifactId&gt; &lt;version&gt;1.1.0&lt;/version&gt; &lt;/dependency&gt; 3、配置SMS Client @Configuration public class AliyunCheckCodeConfig { @Bean public Client aliyunClient() throws Exception { Config config = new Config() .setAccessKeyId(&#34;你的AccessKeyID&#34;) .setAccessKeySecret(&#34;你的AccessKey密码&#34;); config.endpoint = &#34;dysmsapi.aliyuncs.com&#34;; return new Client(config); } } 在配置类中将阿里云SMS 的客户端注册进ioc 容器，交给SpringBoot管理，这里需要将自己生成的AccessKeyID 和 AccessKey 密码替换上">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-05T15:25:24+08:00">
    <meta property="article:modified_time" content="2024-07-05T15:25:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">短信验证码实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、设置AccessKey</h3> 
<p><img alt="" height="86" src="https://images2.imgbox.com/d5/2a/sjHAmzhC_o.png" width="332"></p> 
<p>        创建用户并配置使用权限，使我们拥有调用 aliyunAPI 的权限，之后会生成 AccessKeyID 和 AccessKey密码，后面我们会使用到。需要注意的是 AccessKeyID 和 AccessKey密码生成后我们需要将他保存起来，否则后期无法查询到。</p> 
<p></p> 
<h3>二、开启阿里云短信服务</h3> 
<p>        在阿里云官网搜索短信服务，进入短信服务控制台。</p> 
<h4>1、资质管理</h4> 
<p><img alt="" height="271" src="https://images2.imgbox.com/d0/bb/4jmjA9cR_o.png" width="1170"></p> 
<p>        在这里我们申请个人资质即可，就不用上传企业的证明材料。注意个人的证件照片要清除，不能有遮挡，备注信息写上申请说明，不能随便写，审核一般在两个小时内。</p> 
<h4>2、签名管理</h4> 
<p><img alt="" height="132" src="https://images2.imgbox.com/0f/ec/wnAYsg5q_o.png" width="1153"></p> 
<p>        申请签名。</p> 
<h4>3、模板管理</h4> 
<p><img alt="" height="221" src="https://images2.imgbox.com/cd/b5/XHxipQ3z_o.png" width="1164"></p> 
<p>        这里的模板，就是我们发送短信的模板，需要注意的是，要注意选择纯数字，或者则是英文数字混合使用的模板。模板CODE后面我们需要使用。</p> 
<p></p> 
<h3>三、SpringBoot整合阿里云SMS</h3> 
<h4>1、整体流程</h4> 
<p><img alt="" height="607" src="https://images2.imgbox.com/c0/5a/NkbxpQaC_o.png" width="1063"></p> 
<p>        1、前端发送短信验证码的请求；</p> 
<p>        2、后端收到请求后，生成验证码的code，调用阿里云API 接口发送短信；</p> 
<p>        3、判断 SMS API 的返回信息，“OK”则为成功发布；</p> 
<p>        4、发布成功将code存入redis，供后期校验使用；</p> 
<p>        5、将存入redis时的key值返回给前端。</p> 
<h4>2、引入依赖</h4> 
<pre><code class="language-java">        &lt;dependency&gt;
            &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
            &lt;artifactId&gt;aliyun-java-sdk-core&lt;/artifactId&gt;
            &lt;version&gt;4.6.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
            &lt;artifactId&gt;dysmsapi20170525&lt;/artifactId&gt;
            &lt;version&gt;3.0.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.aliyun&lt;/groupId&gt;
            &lt;artifactId&gt;aliyun-java-sdk-dysmsapi&lt;/artifactId&gt;
            &lt;version&gt;1.1.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h4>3、配置SMS Client</h4> 
<pre><code class="language-java">@Configuration
public class AliyunCheckCodeConfig {
    @Bean
    public Client aliyunClient() throws Exception {
        Config config = new Config()
                .setAccessKeyId("你的AccessKeyID")
                .setAccessKeySecret("你的AccessKey密码");
        config.endpoint = "dysmsapi.aliyuncs.com";
        return new Client(config);
    }
}</code></pre> 
<p>        在配置类中将阿里云SMS 的客户端注册进ioc 容器，交给SpringBoot管理，这里需要将自己生成的AccessKeyID 和 AccessKey 密码替换上</p> 
<h4>4、业务代码</h4> 
<pre><code class="language-java">    @Autowired
    private Client aliyunClient;    
 
    /**
     * 发送短信验证码
     *
     * @param phone
     * @return
     */
    @Override
    public String sendPhoneCheckCode(String phone) {
        //避免重复提交
        String jsonString = redisTemplate.opsForValue().get("phone:" + phone);
        if(jsonString != null){
            return null;
        }
        //生成验证码
        Integer numCode = new Random().nextInt(1000,9999);
        String code = String.valueOf(numCode);

        SendSmsRequest sendSmsRequest = new SendSmsRequest();
        sendSmsRequest.setSignName("发送短信的主题")
                .setTemplateCode("你的模板CODE")
                .setPhoneNumbers("发送到的手机号")
                .setTemplateParam("{\"code\":" + code + "}");

        try {
            RuntimeOptions runtimeOptions = new RuntimeOptions();
            SendSmsResponse sendSmsResponse = aliyunClient.sendSmsWithOptions(sendSmsRequest, runtimeOptions);
            SendSmsResponseBody body = sendSmsResponse.getBody();
            if (body.getMessage().equals("OK")) {
                //存入redis
                String key = "phone:" + phone;
                //存入redis
                redisTemplate.opsForValue().set(key,code,3,TimeUnit.MINUTES);
                //返回key
                return key;
            } else {
                return null;
            }
        } catch (Exception e) {
            throw new RuntimeException(e);
        }
    }</code></pre> 
<p>        这里我们需要将之前申请的模板CODE替换上，code即为替换模板中占位符的信息，我们引入了redis缓存，将生成的验证码存入缓存中，供后面的校验提供支持。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c05dc98c1a686d76c851f7fd8e17d5a8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于Java&#43;SpringMvc&#43;Vue技术的实验室管理系统设计与实现（6000字以上论文参考）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/305056eacf48080b22eac4e166d26223/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Postman保存API返回的token以全局使用的整个流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>