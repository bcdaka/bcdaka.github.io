<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIGC专栏10——EasyAnimate 一个新的类SORA文生视频模型 轻松文生视频 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f956f39206420eec595e346c19a7777b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="AIGC专栏10——EasyAnimate 一个新的类SORA文生视频模型 轻松文生视频">
  <meta property="og:description" content="AIGC专栏10——EasyAnimate 一个新的类SORA文生视频模型 📺轻松文生视频 学习前言源码下载地址技术原理储备（DIT/Lora/Motion Module）什么是Diffusion Transformer (DiT)LoraMotion Module EasyAnimate简介EasyAnimate原理界面展示快速启动云使用: AliyunDSW/Docker本地安装: 环境检查/下载/安装 如何使用生成运行python文件通过ui界面 模型训练训练视频生成模型i、基于webvid数据集ii、基于自建数据集 训练基础文生图模型i、基于diffusers格式ii、基于自建数据集 训练Lora模型i、基于diffusers格式ii、基于自建数据集 算法细节 学习前言 在过年期间，OpenAI放出了SORA文生视频的预览效果，一瞬间各大媒体争相报道，又引爆了一次科技圈，可惜的是，SORA依然没选择开源。
在这个契机下，本来我也对文生视频的工作非常感兴趣，所以也研究了一些与SORA相关的技术，虽然我们没有像OpenAI那么大的算力，但做一些基础研究还是足够的。
最近我参与了一个EasyAnimate的项目，可以根据文本生成视频，并且借鉴了Animatediff的IDEA，将MotionModule网格化后引入到DIT中，借助DIT的强大生成能力，生成视频效果也还不错，并且由于基于一个可插入结构，EasyAnimate有良好的拓展性，近期也开源了出来。
源码下载地址 https://github.com/aigc-apps/EasyAnimate
感谢大家的关注。
技术原理储备（DIT/Lora/Motion Module） 什么是Diffusion Transformer (DiT) DiT基于扩散模型，所以不免包含不断去噪的过程，如果是图生图的话，还有不断加噪的过程，此时离不开DDPM那张老图，如下：
DiT相比于DDPM，使用了更快的采样器，也使用了更大的分辨率，与Stable Diffusion一样使用了隐空间的扩散，但可能更偏研究性质一些，没有使用非常大的数据集进行预训练，只使用了imagenet进行预训练。
与Stable Diffusion不同的是，DiT的网络结构完全由Transformer组成，没有Unet中大量的上下采样，结构更为简单清晰。
在EasyAnimate中，我们将Motion Module网格化后引入到DIT中，借助DIT的强大生成能力，生成视频效果也还不错。
Lora 由《LoRA: Low-Rank Adaptation of Large Language Models》 提出的一种基于低秩矩阵的对大参数模型进行少量参数微调训练的方法，广泛引用在各种大模型的下游使用中。
由于我们是基于一个可插入的结构设计了EasyAnimate，所以EasyAnimate有良好的拓展性，我们可以对文生图模型训练Lora后应用到文生视频模型中。
Motion Module AnimateDiff是一个可以对文生图模型进行动画处理的实用框架，其内部设计的Motion Module无需进行特定模型调整，即可一次性为大多数现有的个性化文本转图像模型提供动画化能力。
EasyAnimate参考AnimateDiff使用Motion Module保证动画的连续性，同时作为一个可插入的结构，Motion Module有良好的拓展性
EasyAnimate简介 EasyAnimate是一个基于transformer结构的pipeline，可用于生成AI动画、训练Diffusion Transformer的基线模型与Lora模型，我们支持从已经训练好的EasyAnimate模型直接进行预测，生成不同分辨率，6秒左右、fps12的视频（40 ~ 80帧, 未来会支持更长的视频），也支持用户训练自己的基线模型与Lora模型，进行一定的风格变换。
这些是pipeline的生成结果，从生成结果来看，它的生成效果还是非常不错的，Resolution 的顺序是width、height、frames：
首先是使用原始的pixart checkpoint进行预测。
Base ModelsSamplerSeedResolution (h x w x f)PromptGenerationResultDownloadPixArtDPM&#43;&#43;43512x512x80A soaring drone footage captures the majestic beauty of a coastal cliff, its red and yellow stratified rock faces rich in color and against the vibrant turquoise of the sea.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-13T21:50:24+08:00">
    <meta property="article:modified_time" content="2024-04-13T21:50:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIGC专栏10——EasyAnimate 一个新的类SORA文生视频模型 轻松文生视频</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>AIGC专栏10——EasyAnimate 一个新的类SORA文生视频模型 📺轻松文生视频 </h4> 
 <ul><li><a href="#_2" rel="nofollow">学习前言</a></li><li><a href="#_9" rel="nofollow">源码下载地址</a></li><li><a href="#DITLoraMotion_Module_14" rel="nofollow">技术原理储备（DIT/Lora/Motion Module）</a></li><li><ul><li><a href="#Diffusion_Transformer_DiT_15" rel="nofollow">什么是Diffusion Transformer (DiT)</a></li><li><a href="#Lora_23" rel="nofollow">Lora</a></li><li><a href="#Motion_Module_27" rel="nofollow">Motion Module</a></li></ul> 
  </li><li><a href="#EasyAnimate_31" rel="nofollow">EasyAnimate简介</a></li><li><a href="#EasyAnimate_73" rel="nofollow">EasyAnimate原理界面展示</a></li><li><a href="#_78" rel="nofollow">快速启动</a></li><li><ul><li><a href="#_AliyunDSWDocker_79" rel="nofollow">云使用: AliyunDSW/Docker</a></li><li><a href="#__113" rel="nofollow">本地安装: 环境检查/下载/安装</a></li></ul> 
  </li><li><a href="#_140" rel="nofollow">如何使用</a></li><li><ul><li><a href="#_141" rel="nofollow">生成</a></li><li><ul><li><a href="#python_142" rel="nofollow">运行python文件</a></li><li><a href="#ui_147" rel="nofollow">通过ui界面</a></li></ul> 
   </li><li><a href="#_151" rel="nofollow">模型训练</a></li><li><ul><li><a href="#_152" rel="nofollow">训练视频生成模型</a></li><li><ul><li><a href="#iwebvid_153" rel="nofollow">i、基于webvid数据集</a></li><li><a href="#ii_183" rel="nofollow">ii、基于自建数据集</a></li></ul> 
    </li><li><a href="#_231" rel="nofollow">训练基础文生图模型</a></li><li><ul><li><a href="#idiffusers_232" rel="nofollow">i、基于diffusers格式</a></li><li><a href="#ii_259" rel="nofollow">ii、基于自建数据集</a></li></ul> 
    </li><li><a href="#Lora_307" rel="nofollow">训练Lora模型</a></li><li><ul><li><a href="#idiffusers_308" rel="nofollow">i、基于diffusers格式</a></li><li><a href="#ii_335" rel="nofollow">ii、基于自建数据集</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_382" rel="nofollow">算法细节</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>学习前言</h2> 
<p>在过年期间，OpenAI放出了SORA文生视频的预览效果，一瞬间各大媒体争相报道，又引爆了一次科技圈，可惜的是，SORA依然没选择开源。</p> 
<p>在这个契机下，本来我也对文生视频的工作非常感兴趣，所以也研究了一些与SORA相关的技术，虽然我们没有像OpenAI那么大的算力，但做一些基础研究还是足够的。</p> 
<p><strong>最近我参与了一个EasyAnimate的项目，可以根据文本生成视频，并且借鉴了Animatediff的IDEA，将MotionModule网格化后引入到DIT中，借助DIT的强大生成能力，生成视频效果也还不错，并且由于基于一个可插入结构，EasyAnimate有良好的拓展性</strong>，近期也开源了出来。<br> <img src="https://images2.imgbox.com/3e/cc/Ap6I2WG8_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_9"></a>源码下载地址</h2> 
<p><a href="https://github.com/aigc-apps/EasyAnimate">https://github.com/aigc-apps/EasyAnimate</a></p> 
<p>感谢大家的关注。</p> 
<h2><a id="DITLoraMotion_Module_14"></a>技术原理储备（DIT/Lora/Motion Module）</h2> 
<h3><a id="Diffusion_Transformer_DiT_15"></a>什么是Diffusion Transformer (DiT)</h3> 
<p>DiT基于扩散模型，所以不免包含不断去噪的过程，如果是图生图的话，还有不断加噪的过程，此时离不开DDPM那张老图，如下：<br> <img src="https://images2.imgbox.com/e6/12/omA9N6hL_o.png" alt="在这里插入图片描述"><br> DiT相比于DDPM，使用了更快的采样器，也使用了更大的分辨率，与Stable Diffusion一样使用了隐空间的扩散，但可能更偏研究性质一些，没有使用非常大的数据集进行预训练，只使用了imagenet进行预训练。</p> 
<p>与Stable Diffusion不同的是，DiT的网络结构完全由Transformer组成，没有Unet中大量的上下采样，结构更为简单清晰。</p> 
<p>在EasyAnimate中，我们将Motion Module网格化后引入到DIT中，借助DIT的强大生成能力，生成视频效果也还不错。</p> 
<h3><a id="Lora_23"></a>Lora</h3> 
<p>由《LoRA: Low-Rank Adaptation of Large Language Models》 提出的一种基于低秩矩阵的对大参数模型进行少量参数微调训练的方法，广泛引用在各种大模型的下游使用中。</p> 
<p>由于我们是基于一个可插入的结构设计了EasyAnimate，所以EasyAnimate有良好的拓展性，我们可以对文生图模型训练Lora后应用到文生视频模型中。</p> 
<h3><a id="Motion_Module_27"></a>Motion Module</h3> 
<p>AnimateDiff是一个可以对文生图模型进行动画处理的实用框架，其内部设计的Motion Module无需进行特定模型调整，即可一次性为大多数现有的个性化文本转图像模型提供动画化能力。</p> 
<p>EasyAnimate参考AnimateDiff使用Motion Module保证动画的连续性，同时作为一个可插入的结构，Motion Module有良好的拓展性</p> 
<h2><a id="EasyAnimate_31"></a>EasyAnimate简介</h2> 
<p>EasyAnimate是一个基于transformer结构的pipeline，可用于生成AI动画、训练Diffusion Transformer的基线模型与Lora模型，我们支持从已经训练好的EasyAnimate模型直接进行预测，生成不同分辨率，6秒左右、fps12的视频（40 ~ 80帧, 未来会支持更长的视频），也支持用户训练自己的基线模型与Lora模型，进行一定的风格变换。</p> 
<p>这些是pipeline的生成结果，从生成结果来看，它的生成效果还是非常不错的，Resolution 的顺序是width、height、frames：</p> 
<p>首先是使用原始的pixart checkpoint进行预测。</p> 
<table><thead><tr><th>Base Models</th><th>Sampler</th><th>Seed</th><th>Resolution (h x w x f)</th><th>Prompt</th><th>GenerationResult</th><th>Download</th></tr></thead><tbody><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>512x512x80</td><td>A soaring drone footage captures the majestic beauty of a coastal cliff, its red and yellow stratified rock faces rich in color and against the vibrant turquoise of the sea. Seabirds can be seen taking flight around the cliff’s precipices.</td><td><img src="https://images2.imgbox.com/02/99/TfcmeKdk_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/1-cliff.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>448x640x80</td><td>The video captures the majestic beauty of a waterfall cascading down a cliff into a serene lake. The waterfall, with its powerful flow, is the central focus of the video. The surrounding landscape is lush and green, with trees and foliage adding to the natural beauty of the scene.</td><td><img src="https://images2.imgbox.com/b2/1d/J9N7oVXu_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/2-waterfall.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>704x384x80</td><td>A vibrant scene of a snowy mountain landscape. The sky is filled with a multitude of colorful hot air balloons, each floating at different heights, creating a dynamic and lively atmosphere. The balloons are scattered across the sky, some closer to the viewer, others further away, adding depth to the scene.</td><td><img src="https://images2.imgbox.com/0e/74/TMBnw9A5_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/3-snowy.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>448x640x64</td><td>The vibrant beauty of a sunflower field. The sunflowers, with their bright yellow petals and dark brown centers, are in full bloom, creating a stunning contrast against the green leaves and stems. The sunflowers are arranged in neat rows, creating a sense of order and symmetry.</td><td><img src="https://images2.imgbox.com/32/d3/WnIhBq67_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/4-sunflower.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>384x704x48</td><td>A tranquil Vermont autumn, with leaves in vibrant colors of orange and red fluttering down a mountain stream.</td><td><img src="https://images2.imgbox.com/ee/4c/cHOcR1fb_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/5-autumn.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>704x384x48</td><td>A vibrant underwater scene. A group of blue fish, with yellow fins, are swimming around a coral reef. The coral reef is a mix of brown and green, providing a natural habitat for the fish. The water is a deep blue, indicating a depth of around 30 feet. The fish are swimming in a circular pattern around the coral reef, indicating a sense of motion and activity. The overall scene is a beautiful representation of marine life.</td><td><img src="https://images2.imgbox.com/2e/6e/kOwcgQtv_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/6-underwater.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>576x448x48</td><td>Pacific coast, carmel by the blue sea ocean and peaceful waves</td><td><img src="https://images2.imgbox.com/ee/f1/f7pFCOjo_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/7-coast.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>576x448x80</td><td>A snowy forest landscape with a dirt road running through it. The road is flanked by trees covered in snow, and the ground is also covered in snow. The sun is shining, creating a bright and serene atmosphere. The road appears to be empty, and there are no people or animals visible in the video. The style of the video is a natural landscape shot, with a focus on the beauty of the snowy forest and the peacefulness of the road.</td><td><img src="https://images2.imgbox.com/a2/c3/VxPgqsXQ_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/8-forest.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>640x448x64</td><td>The dynamic movement of tall, wispy grasses swaying in the wind. The sky above is filled with clouds, creating a dramatic backdrop. The sunlight pierces through the clouds, casting a warm glow on the scene. The grasses are a mix of green and brown, indicating a change in seasons. The overall style of the video is naturalistic, capturing the beauty of the landscape in a realistic manner. The focus is on the grasses and their movement, with the sky serving as a secondary element. The video does not contain any human or animal elements.</td><td><img src="https://images2.imgbox.com/7b/43/fiz0GnCi_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/9-grasses.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>704x384x80</td><td>A serene night scene in a forested area. The first frame shows a tranquil lake reflecting the star-filled sky above. The second frame reveals a beautiful sunset, casting a warm glow over the landscape. The third frame showcases the night sky, filled with stars and a vibrant Milky Way galaxy. The video is a time-lapse, capturing the transition from day to night, with the lake and forest serving as a constant backdrop. The style of the video is naturalistic, emphasizing the beauty of the night sky and the peacefulness of the forest.</td><td><img src="https://images2.imgbox.com/a4/bd/x6dmnQSx_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/10-night.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>PixArt</td><td>DPM++</td><td>43</td><td>640x448x80</td><td>Sunset over the sea.</td><td><img src="https://images2.imgbox.com/0b/74/eyggT9mo_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/11-sunset.gif" rel="nofollow">Download GIF</a></td></tr></tbody></table> 
<p>使用人像checkpoint进行预测。</p> 
<table><thead><tr><th>Base Models</th><th>Sampler</th><th>Seed</th><th>Resolution (h x w x f)</th><th>Prompt</th><th>GenerationResult</th><th>Download</th></tr></thead><tbody><tr><td>Portrait</td><td>Euler A</td><td>43</td><td>448x576x80</td><td>1girl, 3d, black hair, brown eyes, earrings, grey background, jewelry, lips, long hair, looking at viewer, photo \(medium\), realistic, red lips, solo</td><td><img src="https://images2.imgbox.com/7d/8d/hmYjN3ef_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/1-check.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Portrait</td><td>Euler A</td><td>43</td><td>448x576x80</td><td>1girl, bare shoulders, blurry, brown eyes, dirty, dirty face, freckles, lips, long hair, looking at viewer, realistic, sleeveless, solo, upper body</td><td><img src="https://images2.imgbox.com/b2/c2/5iXZNoW8_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/2-check.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Portrait</td><td>Euler A</td><td>43</td><td>512x512x64</td><td>1girl, black hair, brown eyes, earrings, grey background, jewelry, lips, looking at viewer, mole, mole under eye, neck tattoo, nose, ponytail, realistic, shirt, simple background, solo, tattoo</td><td><img src="https://images2.imgbox.com/57/1e/MIHmoaxh_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/3-check.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Portrait</td><td>Euler A</td><td>43</td><td>576x448x64</td><td>1girl, black hair, lips, looking at viewer, mole, mole under eye, mole under mouth, realistic, solo</td><td><img src="https://images2.imgbox.com/08/4d/q3EajOc0_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/5-check.gif" rel="nofollow">Download GIF</a></td></tr></tbody></table> 
<p>使用人像Lora进行预测。</p> 
<table><thead><tr><th>Base Models</th><th>Sampler</th><th>Seed</th><th>Resolution (h x w x f)</th><th>Prompt</th><th>GenerationResult</th><th>Download</th></tr></thead><tbody><tr><td>Pixart + Lora</td><td>Euler A</td><td>43</td><td>512x512x64</td><td>1girl, 3d, black hair, brown eyes, earrings, grey background, jewelry, lips, long hair, looking at viewer, photo \(medium\), realistic, red lips, solo</td><td><img src="https://images2.imgbox.com/b5/dc/6BlhDBrK_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/1-lora.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Pixart + Lora</td><td>Euler A</td><td>43</td><td>512x512x64</td><td>1girl, bare shoulders, blurry, brown eyes, dirty, dirty face, freckles, lips, long hair, looking at viewer, mole, mole on breast, mole on neck, mole under eye, mole under mouth, realistic, sleeveless, solo, upper body</td><td><img src="https://images2.imgbox.com/ea/4a/fbSRMgLx_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/2-lora.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Pixart + Lora</td><td>Euler A</td><td>43</td><td>512x512x64</td><td>1girl, black hair, lips, looking at viewer, mole, mole under eye, mole under mouth, realistic, solo</td><td><img src="https://images2.imgbox.com/5e/0e/K7RnhEah_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/5-lora.gif" rel="nofollow">Download GIF</a></td></tr><tr><td>Pixart + Lora</td><td>Euler A</td><td>43</td><td>512x512x80</td><td>1girl, bare shoulders, blurry, blurry background, blurry foreground, bokeh, brown eyes, christmas tree, closed mouth, collarbone, depth of field, earrings, jewelry, lips, long hair, looking at viewer, photo \(medium\), realistic, smile, solo</td><td><img src="https://images2.imgbox.com/ff/c9/anf9rqkv_o.gif" alt="00000001"></td><td><a href="https://pai-aigc-photog.oss-cn-hangzhou.aliyuncs.com/easyanimate/asset/8-lora.gif" rel="nofollow">Download GIF</a></td></tr></tbody></table> 
<p>可以看出，EasyAnimate具有良好的可拓展性，无论是训练Checkpoint还是Lora都可以应用到模型当中，另外，我们设计了分桶策略与自适应视频裁剪，模型既可以预测512x512的视频，也可以预测如384x768的视频。</p> 
<h2><a id="EasyAnimate_73"></a>EasyAnimate原理界面展示</h2> 
<p>参考Animatediff，我们为EasyAnimate也提供了对应的界面，在界面上，我们可以选择基础模型、motion module版本、基础checkpoint和lora模型。</p> 
<p>在填入prompt和neg prompt后，就可以在下面点击generate进行生成了。<br> <img src="https://images2.imgbox.com/c5/50/j4hEiqIs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_78"></a>快速启动</h2> 
<h3><a id="_AliyunDSWDocker_79"></a>云使用: AliyunDSW/Docker</h3> 
<p>a. 通过阿里云 DSW<br> 我们暂时还没有快速启动资源，等配置完成后再做更新。</p> 
<p>b. 通过docker<br> 使用docker的情况下，请保证机器中已经正确安装显卡驱动与CUDA环境，然后以此执行以下命令：</p> 
<pre><code class="prism language-python"><span class="token comment"># 拉取镜像</span>
docker pull mybigpai<span class="token operator">-</span>public<span class="token operator">-</span>registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>cr<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easycv<span class="token operator">/</span>torch_cuda<span class="token punctuation">:</span>easyanimate

<span class="token comment"># 进入镜像</span>
docker run <span class="token operator">-</span>it <span class="token operator">-</span>p <span class="token number">7860</span><span class="token punctuation">:</span><span class="token number">7860</span> <span class="token operator">-</span><span class="token operator">-</span>network host <span class="token operator">-</span><span class="token operator">-</span>gpus <span class="token builtin">all</span> <span class="token operator">-</span><span class="token operator">-</span>security<span class="token operator">-</span>opt seccomp<span class="token punctuation">:</span>unconfined <span class="token operator">-</span><span class="token operator">-</span>shm<span class="token operator">-</span>size 200g mybigpai<span class="token operator">-</span>public<span class="token operator">-</span>registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>beijing<span class="token punctuation">.</span>cr<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easycv<span class="token operator">/</span>torch_cuda<span class="token punctuation">:</span>easyanimate

<span class="token comment"># clone 代码</span>
git clone https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>aigc<span class="token operator">-</span>apps<span class="token operator">/</span>EasyAnimate<span class="token punctuation">.</span>git

<span class="token comment"># 进入EasyAnimate文件夹</span>
cd EasyAnimate

<span class="token comment"># 下载权重</span>
mkdir models<span class="token operator">/</span>Diffusion_Transformer
mkdir models<span class="token operator">/</span>Motion_Module
mkdir models<span class="token operator">/</span>Personalized_Model

wget https<span class="token punctuation">:</span><span class="token operator">//</span>pai<span class="token operator">-</span>aigc<span class="token operator">-</span>photog<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easyanimate<span class="token operator">/</span>Motion_Module<span class="token operator">/</span>easyanimate_v1_mm<span class="token punctuation">.</span>safetensors <span class="token operator">-</span>O models<span class="token operator">/</span>Motion_Module<span class="token operator">/</span>easyanimate_v1_mm<span class="token punctuation">.</span>safetensors
wget https<span class="token punctuation">:</span><span class="token operator">//</span>pai<span class="token operator">-</span>aigc<span class="token operator">-</span>photog<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easyanimate<span class="token operator">/</span>Personalized_Model<span class="token operator">/</span>easyanimate_portrait<span class="token punctuation">.</span>safetensors <span class="token operator">-</span>O models<span class="token operator">/</span>Personalized_Model<span class="token operator">/</span>easyanimate_portrait<span class="token punctuation">.</span>safetensors
wget https<span class="token punctuation">:</span><span class="token operator">//</span>pai<span class="token operator">-</span>aigc<span class="token operator">-</span>photog<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easyanimate<span class="token operator">/</span>Personalized_Model<span class="token operator">/</span>easyanimate_portrait_lora<span class="token punctuation">.</span>safetensors <span class="token operator">-</span>O models<span class="token operator">/</span>Personalized_Model<span class="token operator">/</span>easyanimate_portrait_lora<span class="token punctuation">.</span>safetensors
wget https<span class="token punctuation">:</span><span class="token operator">//</span>pai<span class="token operator">-</span>aigc<span class="token operator">-</span>photog<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>easyanimate<span class="token operator">/</span>Diffusion_Transformer<span class="token operator">/</span>PixArt<span class="token operator">-</span>XL<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>512x512<span class="token punctuation">.</span>tar <span class="token operator">-</span>O models<span class="token operator">/</span>Diffusion_Transformer<span class="token operator">/</span>PixArt<span class="token operator">-</span>XL<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>512x512<span class="token punctuation">.</span>tar

cd models<span class="token operator">/</span>Diffusion_Transformer<span class="token operator">/</span>
tar <span class="token operator">-</span>xvf PixArt<span class="token operator">-</span>XL<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span>512x512<span class="token punctuation">.</span>tar
cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>
</code></pre> 
<h3><a id="__113"></a>本地安装: 环境检查/下载/安装</h3> 
<p>我们已验证EasyAnimate可在以下环境中执行：</p> 
<p>Linux 的详细信息：</p> 
<pre><code>操作系统 Ubuntu 20.04, CentOS
python: python3.10 &amp; python3.11
pytorch: torch2.2.0
CUDA: 11.8
CUDNN: 8+
GPU： Nvidia-A10 24G &amp; Nvidia-A100 40G &amp; Nvidia-A100 80G
</code></pre> 
<p>我们需要大约 60GB 的可用磁盘空间，请检查！</p> 
<p>b. 权重放置<br> 我们最好将权重按照指定路径进行放置：</p> 
<pre><code>📦 models/
├── 📂 Diffusion_Transformer/
│   └── 📂 PixArt-XL-2-512x512/
├── 📂 Motion_Module/
│   └── 📄 easyanimate_v1_mm.safetensors
├── 📂 Motion_Module/
│   ├── 📄 easyanimate_portrait.safetensors
│   └── 📄 easyanimate_portrait_lora.safetensors
</code></pre> 
<h2><a id="_140"></a>如何使用</h2> 
<h3><a id="_141"></a>生成</h3> 
<h4><a id="python_142"></a>运行python文件</h4> 
<ul><li>步骤1：下载对应权重放入models文件夹。</li><li>步骤2：在predict_t2v.py文件中修改prompt、neg_prompt、guidance_scale和seed。</li><li>步骤3：运行predict_t2v.py文件，等待生成结果，结果保存在samples/easyanimate-videos文件夹中。</li><li>步骤4：如果想结合自己训练的其他backbone与Lora，则看情况修改predict_t2v.py中的predict_t2v.py和lora_path。</li></ul> 
<h4><a id="ui_147"></a>通过ui界面</h4> 
<ul><li>步骤1：下载对应权重放入models文件夹。</li><li>步骤2：运行app.py文件，进入gradio页面。</li><li>步骤3：根据页面选择生成模型，填入prompt、neg_prompt、guidance_scale和seed等，点击生成，等待生成结果，结果保存在sample文件夹中。</li></ul> 
<h3><a id="_151"></a>模型训练</h3> 
<h4><a id="_152"></a>训练视频生成模型</h4> 
<h5><a id="iwebvid_153"></a>i、基于webvid数据集</h5> 
<p>如果使用webvid数据集进行训练，则需要首先下载webvid的数据集。</p> 
<p>您需要以这种格式排列webvid数据集。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 webvid/
│       ├── 📂 videos/
│       │   ├── 📄 00000001.mp4
│       │   ├── 📄 00000002.mp4
│       │   └── 📄 .....
│       └── 📄 csv_of_webvid.csv
</code></pre> 
<p>然后，进入scripts/train_t2v.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/webvid/videos/"
export DATASET_META_NAME="datasets/webvid/csv_of_webvid.csv"

...

train_data_format="webvid"
</code></pre> 
<p>最后运行scripts/train_t2v.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_t2v.sh
</code></pre> 
<h5><a id="ii_183"></a>ii、基于自建数据集</h5> 
<p>如果使用内部数据集进行训练，则需要首先格式化数据集。</p> 
<p>您需要以这种格式排列数据集。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 internal_datasets/
│       ├── 📂 videos/
│       │   ├── 📄 00000001.mp4
│       │   ├── 📄 00000002.mp4
│       │   └── 📄 .....
│       └── 📄 json_of_internal_datasets.json
</code></pre> 
<p>json_of_internal_datasets.json是一个标准的json文件，如下所示：</p> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"videos/00000001.mp4"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A group of young men in suits and sunglasses are walking down a city street."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"video"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"videos/00000002.mp4"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A notepad with a drawing of a woman on it."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"video"</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>json中的file_path需要设置为相对路径。</p> 
<p>然后，进入scripts/train_t2v.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/internal_datasets/"
export DATASET_META_NAME="datasets/internal_datasets/json_of_internal_datasets.json"

...

train_data_format="normal"
</code></pre> 
<p>最后运行scripts/train_t2v.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_t2v.sh
</code></pre> 
<h4><a id="_231"></a>训练基础文生图模型</h4> 
<h5><a id="idiffusers_232"></a>i、基于diffusers格式</h5> 
<p>数据集的格式可以设置为diffusers格式。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 diffusers_datasets/
│       ├── 📂 train/
│       │   ├── 📄 00000001.jpg
│       │   ├── 📄 00000002.jpg
│       │   └── 📄 .....
│       └── 📄 metadata.jsonl
</code></pre> 
<p>然后，进入scripts/train_t2i.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/diffusers_datasets/"

...

train_data_format="diffusers"
</code></pre> 
<p>最后运行scripts/train_t2i.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_t2i.sh
</code></pre> 
<h5><a id="ii_259"></a>ii、基于自建数据集</h5> 
<p>如果使用自建数据集进行训练，则需要首先格式化数据集。</p> 
<p>您需要以这种格式排列数据集。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 internal_datasets/
│       ├── 📂 train/
│       │   ├── 📄 00000001.jpg
│       │   ├── 📄 00000002.jpg
│       │   └── 📄 .....
│       └── 📄 json_of_internal_datasets.json
</code></pre> 
<p>json_of_internal_datasets.json是一个标准的json文件，如下所示：</p> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"train/00000001.jpg"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A group of young men in suits and sunglasses are walking down a city street."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"image"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"train/00000002.jpg"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A notepad with a drawing of a woman on it."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"image"</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>json中的file_path需要设置为相对路径。</p> 
<p>然后，进入scripts/train_t2i.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/internal_datasets/"
export DATASET_META_NAME="datasets/internal_datasets/json_of_internal_datasets.json"

...

train_data_format="normal"
</code></pre> 
<p>最后运行scripts/train_t2i.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_t2i.sh
</code></pre> 
<h4><a id="Lora_307"></a>训练Lora模型</h4> 
<h5><a id="idiffusers_308"></a>i、基于diffusers格式</h5> 
<p>数据集的格式可以设置为diffusers格式。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 diffusers_datasets/
│       ├── 📂 train/
│       │   ├── 📄 00000001.jpg
│       │   ├── 📄 00000002.jpg
│       │   └── 📄 .....
│       └── 📄 metadata.jsonl
</code></pre> 
<p>然后，进入scripts/train_lora.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/diffusers_datasets/"

...

train_data_format="diffusers"
</code></pre> 
<p>最后运行scripts/train_lora.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_lora.sh
</code></pre> 
<h5><a id="ii_335"></a>ii、基于自建数据集</h5> 
<p>如果使用自建数据集进行训练，则需要首先格式化数据集。</p> 
<p>您需要以这种格式排列数据集。</p> 
<pre><code>📦 project/
├── 📂 datasets/
│   ├── 📂 internal_datasets/
│       ├── 📂 train/
│       │   ├── 📄 00000001.jpg
│       │   ├── 📄 00000002.jpg
│       │   └── 📄 .....
│       └── 📄 json_of_internal_datasets.json
</code></pre> 
<p>json_of_internal_datasets.json是一个标准的json文件，如下所示：</p> 
<pre><code class="prism language-json"><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"train/00000001.jpg"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A group of young men in suits and sunglasses are walking down a city street."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"image"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"file_path"</span><span class="token operator">:</span> <span class="token string">"train/00000002.jpg"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"text"</span><span class="token operator">:</span> <span class="token string">"A notepad with a drawing of a woman on it."</span><span class="token punctuation">,</span>
      <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"image"</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span>
</code></pre> 
<p>json中的file_path需要设置为相对路径。</p> 
<p>然后，进入scripts/train_lora.sh进行设置。</p> 
<pre><code>export DATASET_NAME="datasets/internal_datasets/"
export DATASET_META_NAME="datasets/internal_datasets/json_of_internal_datasets.json"

...

train_data_format="normal"
</code></pre> 
<p>最后运行scripts/train_lora.sh。</p> 
<pre><code class="prism language-sh"><span class="token function">sh</span> scripts/train_lora.sh
</code></pre> 
<h2><a id="_382"></a>算法细节</h2> 
<p>我们使用了<a href="https://github.com/PixArt-alpha/PixArt-alpha">PixArt-alpha</a>作为基础模型，并在此基础上引入额外的运动模块（motion module）来将DiT模型从2D图像生成扩展到3D视频生成上来。其框架图如下：<br> <img src="https://images2.imgbox.com/5f/82/TP2Z00fe_o.png" alt="请添加图片描述"><br> 其中，Motion Module 用于捕捉时序维度的帧间关系，其结构如下：<br> <img src="https://images2.imgbox.com/02/b2/NN33d7hH_o.png" alt="请添加图片描述"><br> 我们在时序维度上引入注意力机制来让模型学习时序信息，以进行连续视频帧的生成。同时，我们利用额外的网格计算（Grid Reshape），来扩大注意力机制的input token数目，从而更多地利用图像的空间信息以达到更好的生成效果。Motion Module 作为一个单独的模块，在推理时可以用在不同的DiT基线模型上。此外，EasyAnimate不仅支持了motion-module模块的训练，也支持了DiT基模型/LoRA模型的训练，以方便用户根据自身需要来完成自定义风格的模型训练，进而生成任意风格的视频。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18d08ccc088c3acaa5800ff0bc7892e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">QT之QWebEngineView详细介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/330b3c50a7e348057982bbf8fc7814fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Zotero插件ZotCard中AI-NNDL文献笔记卡分享及卡片使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>