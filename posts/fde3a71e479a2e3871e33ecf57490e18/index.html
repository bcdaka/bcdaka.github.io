<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Ambari】Ansible自动化部署大数据集群 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/fde3a71e479a2e3871e33ecf57490e18/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Ambari】Ansible自动化部署大数据集群">
  <meta property="og:description" content="目录
一．版本说明和介绍信息
1.1 大数据组件版本
1.2 Apache Components
1.3 Databases支持版本
二．安装包上传和说明
三．服务器基础环境配置
3.1global配置修改
3.2主机名映射配置
3.3免密用户名密码配置
3.4 ansible安装
四. 安装Ambari-server
4.1 安装ambari-server
4.2 检查REPO源
五、HDP 安装
Get Started
Select Version
Install Options
Confirm Hosts
Choose Services
Assign Masters
Assign Slaves and Clients
Customize Services
CREDENTIALS
DATABASES
DIRECTORIES
ACCOUNTS
ALL CONFIGURATIONS
Review
六、开启Kerberos
6.1 kerberos服务检查
6.2 Ambari启动kerberos
Get Started
Configure Kerberos
Install and Test Kerberos Client
Configure Identities
Confirm Configuration
Stop Services">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-07T09:02:09+08:00">
    <meta property="article:modified_time" content="2024-04-07T09:02:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Ambari】Ansible自动化部署大数据集群</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="520f42f3293818f927861ebbd5b15da4_p_0"><img alt="" height="534" src="https://images2.imgbox.com/77/2f/qeKVGnb6_o.png" width="950"></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="Sn8qj-toc" style="margin-left:0px;"><a href="#Sn8qj" rel="nofollow">一．版本说明和介绍信息</a></p> 
<p id="UmBBw-toc" style="margin-left:40px;"><a href="#UmBBw" rel="nofollow">1.1 大数据组件版本</a></p> 
<p id="qwVhH-toc" style="margin-left:40px;"><a href="#qwVhH" rel="nofollow">1.2 Apache Components</a></p> 
<p id="NfJIp-toc" style="margin-left:40px;"><a href="#NfJIp" rel="nofollow">1.3 Databases支持版本</a></p> 
<p id="zMM2z-toc" style="margin-left:0px;"><a href="#zMM2z" rel="nofollow">二．安装包上传和说明</a></p> 
<p id="zZNTM-toc" style="margin-left:0px;"><a href="#zZNTM" rel="nofollow">三．服务器基础环境配置</a></p> 
<p id="r2Yok-toc" style="margin-left:40px;"><a href="#r2Yok" rel="nofollow">3.1global配置修改</a></p> 
<p id="tI0gz-toc" style="margin-left:40px;"><a href="#tI0gz" rel="nofollow">3.2主机名映射配置</a></p> 
<p id="M2cHy-toc" style="margin-left:40px;"><a href="#M2cHy" rel="nofollow">3.3免密用户名密码配置</a></p> 
<p id="WaXbc-toc" style="margin-left:40px;"><a href="#WaXbc" rel="nofollow">3.4 ansible安装</a></p> 
<p id="jihSe-toc" style="margin-left:0px;"><a href="#jihSe" rel="nofollow">四. 安装Ambari-server</a></p> 
<p id="QHSB8-toc" style="margin-left:40px;"><a href="#QHSB8" rel="nofollow">4.1 安装ambari-server</a></p> 
<p id="ClPxV-toc" style="margin-left:40px;"><a href="#ClPxV" rel="nofollow">4.2 检查REPO源</a></p> 
<p id="UkDZQ-toc" style="margin-left:0px;"><a href="#UkDZQ" rel="nofollow">五、HDP 安装</a></p> 
<p id="Ih0hD-toc" style="margin-left:40px;"><a href="#Ih0hD" rel="nofollow">Get Started</a></p> 
<p id="ouRJt-toc" style="margin-left:40px;"><a href="#ouRJt" rel="nofollow">Select Version</a></p> 
<p id="fwFoQ-toc" style="margin-left:40px;"><a href="#fwFoQ" rel="nofollow">Install Options</a></p> 
<p id="etBjY-toc" style="margin-left:40px;"><a href="#etBjY" rel="nofollow">Confirm Hosts</a></p> 
<p id="mxloP-toc" style="margin-left:40px;"><a href="#mxloP" rel="nofollow">Choose Services</a></p> 
<p id="bvf3P-toc" style="margin-left:40px;"><a href="#bvf3P" rel="nofollow">Assign Masters</a></p> 
<p id="grtu2-toc" style="margin-left:40px;"><a href="#grtu2" rel="nofollow">Assign Slaves and Clients</a></p> 
<p id="vT3sg-toc" style="margin-left:40px;"><a href="#vT3sg" rel="nofollow">Customize Services</a></p> 
<p id="Ez87t-toc" style="margin-left:80px;"><a href="#Ez87t" rel="nofollow">CREDENTIALS</a></p> 
<p id="JYDmi-toc" style="margin-left:80px;"><a href="#JYDmi" rel="nofollow">DATABASES</a></p> 
<p id="kMrKd-toc" style="margin-left:80px;"><a href="#kMrKd" rel="nofollow">DIRECTORIES</a></p> 
<p id="ohIvK-toc" style="margin-left:80px;"><a href="#ohIvK" rel="nofollow">ACCOUNTS</a></p> 
<p id="Nz1bM-toc" style="margin-left:80px;"><a href="#Nz1bM" rel="nofollow">ALL CONFIGURATIONS</a></p> 
<p id="iugVQ-toc" style="margin-left:40px;"><a href="#iugVQ" rel="nofollow">Review</a></p> 
<p id="qS3qn-toc" style="margin-left:0px;"><a href="#qS3qn" rel="nofollow">六、开启Kerberos</a></p> 
<p id="Bchpd-toc" style="margin-left:40px;"><a href="#Bchpd" rel="nofollow">6.1 kerberos服务检查</a></p> 
<p id="ju1CR-toc" style="margin-left:40px;"><a href="#ju1CR" rel="nofollow">6.2 Ambari启动kerberos</a></p> 
<p id="s5MIr-toc" style="margin-left:80px;"><a href="#s5MIr" rel="nofollow">Get Started</a></p> 
<p id="2p1G6-toc" style="margin-left:80px;"><a href="#2p1G6" rel="nofollow">Configure Kerberos</a></p> 
<p id="v8k8c-toc" style="margin-left:80px;"><a href="#v8k8c" rel="nofollow">Install and Test Kerberos Client</a></p> 
<p id="vm71w-toc" style="margin-left:80px;"><a href="#vm71w" rel="nofollow">Configure Identities</a></p> 
<p id="bsiB2-toc" style="margin-left:80px;"><a href="#bsiB2" rel="nofollow">Confirm Configuration</a></p> 
<p id="kGbiU-toc" style="margin-left:80px;"><a href="#kGbiU" rel="nofollow">Stop Services</a></p> 
<p id="RSqJu-toc" style="margin-left:80px;"><a href="#RSqJu" rel="nofollow">Kerberize Cluster</a></p> 
<p id="2eeHQ-toc" style="margin-left:80px;"><a href="#2eeHQ" rel="nofollow">Start and Test Services</a></p> 
<p id="daqFd-toc" style="margin-left:0px;"><a href="#daqFd" rel="nofollow">七、开启服务高可用</a></p> 
<p id="4xXsk-toc" style="margin-left:40px;"><a href="#4xXsk" rel="nofollow">7.1 HBaseMaster高可用开启</a></p> 
<p id="P0kgP-toc" style="margin-left:40px;"><a href="#P0kgP" rel="nofollow">7.2 ResourceManager高可用开启</a></p> 
<p id="qr4fe-toc" style="margin-left:40px;"><a href="#qr4fe" rel="nofollow">7.3 NameNode高可用开启</a></p> 
<p id="w4OTa-toc" style="margin-left:0px;"><a href="#w4OTa" rel="nofollow">八、ranger权限开启</a></p> 
<p id="FPTS8-toc" style="margin-left:40px;"><a href="#FPTS8" rel="nofollow">8.1 ranger登录</a></p> 
<p id="rqRSP-toc" style="margin-left:40px;"><a href="#rqRSP" rel="nofollow">8.2 HDFS权限控制</a></p> 
<p id="sI6i2-toc" style="margin-left:40px;"><a href="#sI6i2" rel="nofollow">8.3 HBase权限控制</a></p> 
<p id="VUlu8-toc" style="margin-left:40px;"><a href="#VUlu8" rel="nofollow">8.4 Hive权限控制</a></p> 
<p id="R2fkt-toc" style="margin-left:40px;"><a href="#R2fkt" rel="nofollow">8.5 Yarn权限控制</a></p> 
<p id="Mzbdm-toc" style="margin-left:0px;"><a href="#Mzbdm" rel="nofollow">九、ansible自动化安装脚本</a></p> 
<hr id="hr-toc"> 
<h2><span style="color:#1a439c;">一．版本说明和介绍信息</span></h2> 
<hr id="i2WXR"> 
<h3 id="UmBBw"><strong>1.1 </strong>大数据组件版本</h3> 
<table id="Egrco"><tbody><tr><td> <p id="983770fa3e6ffe5933c672ad3288eedc" style="text-align:center;"><strong>组件</strong></p> </td><td> <p id="31ab09a45aed7119030ab98480e5e9d8" style="text-align:center;"><strong>版本</strong></p> </td></tr><tr><td> <p id="4f7d7efecdc0492e73a3c26e79a9571f" style="text-align:center;">os</p> </td><td> <p id="d181518e3e3a4c1d44b0938adb423b64" style="text-align:center;">CentOS7.2-7.9</p> </td></tr><tr><td> <p id="dd5fc9c878006ac596d7b7fe7c894b2e" style="text-align:center;">ambari</p> </td><td> <p id="9752762f9a7afad68444e18a1ed3c2d0" style="text-align:center;">2.7.4</p> </td></tr><tr><td> <p id="0e839c7f3eec8e1ed950f6239027a91e" style="text-align:center;">HDP</p> </td><td> <p id="6c51adb4fdbe2a39a4cb00aa50725aab" style="text-align:center;">3.3.1.0</p> </td></tr><tr><td> <p id="8af2727c462c2bd0a31fdd7f1f3f0684" style="text-align:center;">HDP-GPL</p> </td><td> <p id="b2c80239593095ca7bc6ec51e96f3f0a" style="text-align:center;">3.3.1.0</p> </td></tr><tr><td> <p id="db9cc8722252975690299213fa2b086f" style="text-align:center;">HDP-UTILS</p> </td><td> <p id="527815fbb7fe33fb6f1daaf16433e0a2" style="text-align:center;">1.1.0.22</p> </td></tr><tr><td> <p id="6cc4fb6af86ea79ac5cc7065824afda0" style="text-align:center;">JDK</p> </td><td> <p id="e10a7658f687a3b64166fee69b686580" style="text-align:center;">jdk-8u162-linux-x64.tar.gz</p> </td></tr><tr><td> <p id="358fa7b2a902d435208749ad9f4f88e7" style="text-align:center;">MySQL</p> </td><td> <p id="096840b03b4142526536c7bc25a920b2" style="text-align:center;">5.7</p> </td></tr></tbody></table> 
<h3 id="qwVhH"><strong>1.2 </strong>Apache Components</h3> 
<hr id="dkkmC"> 
<p id="u02489f25"></p> 
<table id="yijVv"><tbody><tr><td> <p id="127461cc6abb2b6200ad3b0adee83f0c" style="text-align:center;"><strong>组件名称</strong></p> </td><td> <p id="bf99b47de32f0c413a661db47e6ee726" style="text-align:center;"><strong>Apache版本</strong></p> </td></tr><tr><td> <p id="d362e447213ba4d0cc9074b7e9ac7b82" style="text-align:center;">Apache Ambari</p> </td><td> <p id="de8bf0557aa12e99e286a8abd2679a6d" style="text-align:center;">2.7.4</p> </td></tr><tr><td> <p id="1a15f36e3a67fb7ba4cc1a32e0499565" style="text-align:center;">Apache Zookeeper</p> </td><td> <p id="81774f2e241064231e81f74ab206aa25" style="text-align:center;">3.4.6</p> </td></tr><tr><td> <p id="2060d860e789169e756da4dd9ac3e749" style="text-align:center;">Apache Hadoop</p> </td><td> <p id="a97e2178851520dddaab209dca0a4863" style="text-align:center;">3.1.1</p> </td></tr><tr><td> <p id="c153ea76a1686ac0657e2079e9bd078b" style="text-align:center;">Apache Hive</p> </td><td> <p id="f5b3506c560712f1bd29e766cf3aabe2" style="text-align:center;">3.1.0</p> </td></tr><tr><td> <p id="00dc35f7fcc23efdf7163e53cd6e19da" style="text-align:center;">Apache HBase</p> </td><td> <p id="a5c632846da6b9d53dd41ed930f82179" style="text-align:center;">2.0.2</p> </td></tr><tr><td> <p id="cc5c55b3b2a31464fbb772e7b9d4aa1b" style="text-align:center;">Apache Ranger</p> </td><td> <p id="8df71f007f42185f48df70f4e5f72b75" style="text-align:center;">1.2.0.3.1</p> </td></tr><tr><td> <p id="5b999b731be0b253674b831fa10b600b" style="text-align:center;">Apache Spark 2</p> </td><td> <p id="3757021f8ceea875035b9ebce2ff95d5" style="text-align:center;">2.3.0</p> </td></tr><tr><td> <p id="f0961ca43dc6a46e888229e7cc0c248d" style="text-align:center;">Apache TEZ</p> </td><td> <p id="e18c8212412f029bfe4113d5913c9136" style="text-align:center;">0.9.1</p> </td></tr></tbody></table> 
<p id="18d31330398272be7eedef7d9956c2cd"></p> 
<h3 id="NfJIp"><strong>1.3 </strong>Databases支持版本</h3> 
<hr id="EQ6AX"> 
<table id="I0Vm4"><tbody><tr><td> <p id="a2943a0d5622e36e6db1ce4703d55f06" style="text-align:center;"><strong>Name</strong></p> </td><td> <p id="44a233b15a2af15c41fdece90da78539" style="text-align:center;"><strong>Version</strong></p> </td></tr><tr><td> <p id="fa9fbe4eeafa8f18e4efc8de9de04af9" style="text-align:center;">PostgreSQL</p> </td><td> <p id="e1bb85137f229db8e5a9edc010024784" style="text-align:center;">10.7 10.5 10.2 9.6</p> </td></tr><tr><td> <p id="debec59e39ae7874aa8bf2601032aaa1" style="text-align:center;">MySQL</p> </td><td> <p id="70c7730861463c3cdba9873cce0de1e5" style="text-align:center;">5.7</p> </td></tr><tr><td> <p id="58110fca92648feea3a7873365695004" style="text-align:center;">MariaDB</p> </td><td> <p id="ffb416c4904afdbbe24369cbb824e2c3" style="text-align:center;">10.2</p> </td></tr><tr><td> <p id="f165210cedfac61da862d31bff5d5513" style="text-align:center;">人大金仓</p> </td><td> <p id="8eba63d90667bb67b2ea7ca1a19b64a0" style="text-align:center;">V8</p> </td></tr></tbody></table> 
<hr id="y3KKO"> 
<h2 id="zMM2z"><span style="color:#956fe7;">二．安装包上传和说明</span></h2> 
<hr id="YjQ7I"> 
<p id="8af627c6e3c4782eabefb35c7e0377c3">使用工具将安装包上传到Linux服务器(安装ansible)，上传到/opt 目录，如下命令进入/opt目录并解压安装包，包名日期可能有所变动，解压完成需要等待5分钟左右。如下操作使用root用户完成。<strong>脚本在博客资源中可以下载，文章后面会有部分说明。</strong></p> 
<pre id="sbmPT"><code>tar -zxvf windp-deploy-2.7.4_20240329.tar.gz</code></pre> 
<p id="9c9390c75735948a16794efbc24b378d"><img alt="" height="239" src="https://images2.imgbox.com/d2/1f/GGvwvSaq_o.png" width="929"></p> 
<p id="00c851aa1fae19d348769b5f8cd7d92f">安装包解压后目录结构：</p> 
<pre id="SQPdJ"><code>cd  /opt/windp-deploy</code></pre> 
<p id="2489b2728ebf287ccdf167c4a48cc944"><img alt="" height="322" src="https://images2.imgbox.com/6e/d7/j7CoVOBX_o.png" width="922"></p> 
<p id="9e297ff7b7578c88df0e58776e51dea0">windp-deploy-dxxxxxxxx.tar.gz 包内容说明</p> 
<table id="oDBcF"><tbody><tr><td> <p id="39e99c37e4a10e6fa1a067fc1ba3a078" style="text-align:center;"><strong>脚本和目录</strong></p> </td><td> <p id="db1e31dfad9477dd39ea54c896fd4154" style="text-align:center;"><strong>说明</strong></p> </td></tr><tr><td> <p id="9481d3619ace9ae8d1d669d0c0e124c7" style="text-align:center;">ambari.yml</p> </td><td> <p id="65e09967ef123d14e8ae341e55a8a7a3" style="text-align:center;">ansible play-book 入口</p> </td></tr><tr><td> <p id="3971c15ead3bf398c58d7163f0277aab" style="text-align:center;">component</p> </td><td> <p id="b4955a8feffa091bfd5edf7a0c84ac6c" style="text-align:center;">配置文件和安装包</p> </td></tr><tr><td> <p id="0cae6c5832b9fbb02e4c36d6f34202d4" style="text-align:center;">install_base_kdc.sh</p> </td><td> <p id="c5879a1fb7a88f38b63456e6ebc2a25d" style="text-align:center;">配置KDC</p> </td></tr><tr><td> <p id="d370c05d7c19e6814a2dc2b7add9c0ac" style="text-align:center;">install_mysql.sh</p> </td><td> <p id="85352b90b204e68dfe505ec6a2263fae" style="text-align:center;">MySQL安装</p> </td></tr><tr><td> <p id="b7c9f9831717c33d792f1ab3283008d0" style="text-align:center;">install_repo.sh</p> </td><td> <p id="b78274ef8e784ab72e16e0acdb318498" style="text-align:center;">HDP源配置和Ambari安装</p> </td></tr><tr><td> <p id="ea27f5d1da2ca1bebf9a37a985de6455" style="text-align:center;">config</p> </td><td> <p id="909e1ab11e63f9ed4ad91209eb7ea371" style="text-align:center;">配置文件目录</p> </td></tr><tr><td> <p id="f09e3f972e17d1cc33828e79b022addc" style="text-align:center;">installDeployAmbari.sh</p> </td><td> <p id="1f18e31356067f85d6e26f46964e86ab" style="text-align:center;">安装启动脚本</p> </td></tr></tbody></table> 
<hr> 
<h2 id="zZNTM"><span style="color:#1a439c;">三．服务器基础环境配置</span></h2> 
<hr id="IasQS"> 
<h3 id="r2Yok"><span style="color:#511b78;">3.1global配置修改</span></h3> 
<hr id="Fl2Fp"> 
<p id="b90bc30980911deaeb8fca94a4f27ef2">/opt为安装目录，默认无需修改。修改完成后复制如下命令在Linux服务器命令行执行后回车：</p> 
<pre id="xbeEp"><code>cat &gt; /opt/windp-deploy/config/global.sh &lt;&lt; EOF
#######################
#部署相关全局参数定义
#######################
# mysql配置
myurl=localhost
myuser=root
mypwd=Winner001
myport=3306
# HDP包解压目录
install_path=/hadoop
# mysql 安装目录
mysql_install_path=/usr/local

EOF</code></pre> 
<p id="daa418e4cffaa7ae61658654005105e6"><img alt="" height="437" src="https://images2.imgbox.com/94/fa/00P7inGz_o.png" width="929"></p> 
<p id="bfd3f3c4f53d6521b2ad7f4ee5b69ac1">执行如下命令，检查文件是否保存成功。</p> 
<pre id="KZP1Q"><code> cat  /opt/windp-deploy/config/global.sh</code></pre> 
<p id="32f18d0279e6155537fa7b8027a05a74"><img alt="" height="428" src="https://images2.imgbox.com/22/5a/ukCIwdgn_o.png" width="929"></p> 
<h3 id="tI0gz"><span style="color:#511b78;">3.2主机名映射配置</span></h3> 
<hr id="bIE2P"> 
<p id="214922f00b33c8c0861a15e36f5a6e75">如下为主机hosts映射本地临时文件，修改好后执行如下命令(修改部分已标红)，</p> 
<pre id="nxrPY"><code>cat &gt;  /opt/windp-deploy/autoDeployFiles/scripts/temphosts.txt  &lt;&lt; EOF
192.168.2.142 hdp-node1 
192.168.2.143 hdp-node2 
EOF</code></pre> 
<p class="img-center"><img alt="" height="133" id="MbGs5" src="https://images2.imgbox.com/40/68/mBHJJuQc_o.png" width="1200"></p> 
<p id="0d3d969039128a513736621b7d908008"></p> 
<p id="e7c2f0dbe06a589aa4471245b14406f1">执行如下命令，查看hosts是否配置成功。</p> 
<pre id="v8J83"><code>cat /opt/windp-deploy/autoDeployFiles/scripts/temphosts.txt </code></pre> 
<p class="img-center"><img alt="" height="108" id="C94hw" src="https://images2.imgbox.com/8c/7c/mPowGij8_o.png" width="1175"></p> 
<p id="9a1e7b7ee29d338ee1e86ea96bec900c"></p> 
<h3 id="M2cHy"><span style="color:#511b78;">3.3免密用户名密码配置</span></h3> 
<hr id="inL6p"> 
<p id="90e5754e0d8c6f72847b64630b4539bd">如下为主机名和密码临时文件，修改好后执行如下命令(修改部分已标红)，</p> 
<pre id="j45f9"><code>cat &gt;   /opt/windp-deploy/autoDeployFiles/scripts/hostlist.txt  &lt;&lt; EOF
hdp-node1 winner@001
hdp-node2 winner@001
EOF</code></pre> 
<p id="3bce4d9b443207587f91c3f07a890ddd">执行如下命令，查看是否配置成功。</p> 
<pre id="g9YVG"><code>
cat  /opt/windp-deploy/autoDeployFiles/scripts/hostlist.txt</code></pre> 
<p class="img-center"><img alt="" height="255" id="NKmhD" src="https://images2.imgbox.com/23/eb/Maav2WQ1_o.png" width="1200"></p> 
<p id="8734aaa91ece408aae282d5b1e3c46a9"></p> 
<h3 id="WaXbc"><span style="color:#511b78;">3.4 ansible安装</span></h3> 
<hr id="kmFNl"> 
<p id="6d89273f57b451fae1d03e9ee3290f2a">执行如下命令，查看ansible是否安装，如若显示版本信息则已安装，则跳过此步骤。如若没有显示版本信息，则执行下面的安装命令。</p> 
<pre id="RSDAl"><code>ansible --version</code></pre> 
<p class="img-center"><img alt="" height="89" id="sOhho" src="https://images2.imgbox.com/50/c7/Y4N2E7g0_o.png" width="855"></p> 
<p id="42dfded1d0965bd3daec010c827f1b5f">如果没有安装执行如下命令：</p> 
<pre id="lCaPx"><code>yum install epel-release -y
yum install ansible -y</code></pre> 
<p id="d9cc9ddd6042778a7a687c797da797b7">再执行查看ansible版本信息<img alt="" height="346" src="https://images2.imgbox.com/02/70/qBGI5fYe_o.png" width="929"></p> 
<p id="fa29b163c6719a8529ec42bdc1d86329">也可以选择离线安装，执行如下命令：</p> 
<pre id="NFgGe"><code>cd /opt/windp-deploy/config/ansible-rpm
yum install  *.rpm  -y</code></pre> 
<hr id="p2g4W"> 
<h2 id="jihSe"><span style="color:#1a439c;"><strong>四. </strong>安装Ambari-server</span></h2> 
<hr id="ssfOZ"> 
<h3 id="QHSB8"><span style="color:#511b78;">4.1 安装ambari-server</span></h3> 
<hr id="b6c3H"> 
<p id="5f46122cebaa905862a8080f6b08ba32">执行如下命令，等待Ambari-Server 配置启动完成，需要等待20分钟左右。</p> 
<pre id="zVHGB"><code>cd  /opt/windp-deploy/
sh installDeployAmbari.sh</code></pre> 
<p id="417b59d136e5954e4d7a10adba1e1206"><img alt="" height="412" src="https://images2.imgbox.com/c2/67/ZLvqbyjq_o.png" width="929"></p> 
<p id="9bd6ad633a66548c4e9ae01ba90076cf">执行如下命令，查看mysql是否启动成功，显示如图“running”则表示启动成功。</p> 
<pre id="EcVQ4"><code>/etc/init.d/mysqld status</code></pre> 
<p class="img-center"><img alt="" height="82" id="um6Fa" src="https://images2.imgbox.com/23/98/dSSmzZJ5_o.png" width="829"></p> 
<p id="0e71c0f5349d922dd4c0d2e94f254eeb"></p> 
<p id="9b2f5514a0acb59dd37880854bf525b7">执行如下命令，查看Ambari-Server是否启动成功，显示如图“running”则表示启动成功。</p> 
<pre id="yBIhF"><code>ambari-server status</code></pre> 
<p class="img-center"><img alt="" height="135" id="goCPf" src="https://images2.imgbox.com/64/1d/6RhgZVlo_o.png" width="1076"></p> 
<p id="275884dd1b81c992902fd6d75e299758"></p> 
<p id="af71c9611676cecce2a21efd20e38d03">如果Ambari-Server没有启动成功，执行如下命令尝试重启。</p> 
<pre id="vU9Tz"><code>ambari-server restart</code></pre> 
<h3 id="ClPxV"><span style="color:#511b78;">4.2 检查REPO源</span></h3> 
<hr id="wDstl"> 
<p id="ef6ea55ea31362748329a41f19475322">配置的REPO源可以在浏览器中查看。需要将示例IP地址换成部署WinDP Linux本机的IP。如下是示例IP地址：</p> 
<pre id="Pgi65"><code>http://192.168.2.142/ambari/
http://192.168.2.142/HDP/
http://192.168.2.142/HDP-UTILS/
http://192.168.2.142/HDP-GPL/</code></pre> 
<p id="9d88dd005d78d926b633b0a6f6323ec2"></p> 
<p id="f9f98ccffd1df961fb8bf3d4df30dfa9"><img alt="" height="354" src="https://images2.imgbox.com/32/23/rRduFvHZ_o.png" width="883"></p> 
<p> <img alt="" height="355" src="https://images2.imgbox.com/d4/7b/j6fRLoXm_o.png" width="762"></p> 
<p><img alt="" height="333" src="https://images2.imgbox.com/83/15/Gi1tjzft_o.png" width="760"></p> 
<p id="a3b9dc0dee7a918601739db45fbe15a6"></p> 
<p id="a1da61a29934481adb2c923500728f60"><img alt="" height="343" src="https://images2.imgbox.com/2c/62/eiqFYWKC_o.png" width="743"><strong>注意：</strong>如果某个地址从浏览器访问失败则说明配置的基础环境有问题，需要检查基础环境的配置。</p> 
<hr> 
<h2 id="UkDZQ"><span style="color:#1a439c;">五、HDP 安装</span></h2> 
<hr id="vQTKt"> 
<p id="1075aba22663565cdcc7523b2cba7ec2">登录Ambari-Server, 地址为IP:8080，示例地址：<a href="http://192.168.2.161:8080/" rel="nofollow" title="http://192.168.2.161:8080/">http://192.168.2.161:8080/</a>，账号密码默认：admin。</p> 
<p id="01ce96c43f5beed2a6964add315f0777">第一次登录进去的默认界面如下图所示，点击红框按钮。<img alt="" height="337" src="https://images2.imgbox.com/c2/25/eoR0S0uh_o.png" width="929"></p> 
<p id="a357123f6ad8e136b9fd30ab2e783b6a"></p> 
<h3 id="Ih0hD">Get Started</h3> 
<p id="f5d11a684de9f0cb6baf978d18fc343a">输入集群名称 “winner”，点击NEXT<img alt="" height="382" src="https://images2.imgbox.com/db/f5/YwZL21In_o.png" width="929"></p> 
<p id="d0d23f6bea10596cedb1598b45fac21e"></p> 
<h3 id="ouRJt">Select Version</h3> 
<p id="77affb02b319959878f74b308def7f5e">选择HDP的版本，这里使用的是3.1版本，repo选择“Use Local Repository”<img alt="" height="449" src="https://images2.imgbox.com/cc/e2/yFdQs9Za_o.png" width="929"></p> 
<p id="ee9a465da967255470792fd71babc4fa"></p> 
<p id="889d7fb62174e68d6a9524271972582b">保留redhat7的地址 栏，其它系统选择“Remove”<img alt="" height="445" src="https://images2.imgbox.com/65/d2/7o76wqmn_o.png" width="929"></p> 
<p id="2277b9093a721eb1fa94307f01a74eed"></p> 
<p id="f776733883fbed7cc8821e75273e4da4">主机名需要修改，然后将如下URL 依次复制到Base URL 地址栏中，然后下一步</p> 
<pre id="HuPQ8"><code>http://hdp-node1/HDP/centos7/3.1.4.0-315
http://hdp-node1/HDP-GPL/centos7/3.1.4.0-315
http://hdp-node1/HDP-UTILS/centos7/1.1.0.22</code></pre> 
<p id="9164b60bd1b47dae5b0dcb453762a72f"></p> 
<h3 id="fwFoQ"><img alt="" height="431" src="https://images2.imgbox.com/1e/1d/v6UeLh5n_o.png" width="929">Install Options</h3> 
<ul><li id="58ff66b6528a495af0f66f1be0e37ad3"><strong>Target Hosts</strong> :</li></ul> 
<p id="c6b5f1df9da7413cee59e558766124c2">hdp-node1</p> 
<p id="cfbdceb66ee6b593fde07f93538f2813">hdp-node2</p> 
<ul><li id="b5568df4b19a67671358e103964bd3d6"><strong>Host Registration Information:</strong> 选择红框Provide your SSH Private Key to automatically register hosts<img alt="" height="320" src="https://images2.imgbox.com/29/e3/JvTCdnzP_o.png" width="929"></li></ul> 
<p id="a98300917eaedc93a94aa667d0722561"></p> 
<p id="ed2ecac38a109617f063daec1695005e">在Linux服务器上执行如下命令将私钥下载到Windows本地</p> 
<pre id="ZuoqB"><code>sz  /root/.ssh/id_rsa</code></pre> 
<p id="619b6761ff4c43b147ed5a56704240c3"></p> 
<p id="2dcfe4b422c73d9c07357295f5032cd2"><img alt="" height="650" src="https://images2.imgbox.com/02/85/LvdrZLz5_o.png" width="770">将下载的私钥文件从本地上传，点击选择“CHOOSE FILE”，选中“id_rsa”文件后选择打开。</p> 
<p class="img-center"><img alt="" height="726" id="grIGx" src="https://images2.imgbox.com/b2/4d/stFzlcH7_o.png" width="1200"></p> 
<p id="11f0967df010d9d31beee991183b73e2">如下图私钥文件上传完成，ssh的用户和端口采用默认root，我们选择下一步</p> 
<ul><li id="83ae0a18ec6759e7beed9afb7b5ab565"><strong>SSH User Account: root</strong></li><li id="0d5e517f8a2bacc5f2c5ee2f9e75a78b"><strong>SSH Port Number: 22 </strong></li></ul> 
<p id="6681177143700e125f13d2b5ea9c013a"></p> 
<p class="img-center"><img alt="" height="860" id="ZkoOs" src="https://images2.imgbox.com/89/d6/Ci1hEfkb_o.png" width="1200"></p> 
<p id="8a251892c8498908b3784d7c81a97858">弹出Warning（一般是主机名不符合规范），可以忽略。</p> 
<p id="d06b512fc41da9750d368e188aad0497"></p> 
<p class="img-center"><img alt="" height="281" id="ctNNd" src="https://images2.imgbox.com/bc/25/Rhy29dzU_o.png" width="728"></p> 
<h3 id="etBjY">Confirm Hosts</h3> 
<p id="2ec5ce4037140d913532d8f498c12436">等待服务器注册，<strong>如下的 check信息要检查通过才行，</strong>可能会检查出问题，需要解决后然后下一步。</p> 
<p id="1964b28a8e573d12b5aaecdb0cd61f1d"></p> 
<p id="32590f13679be5a67ce707217b6dd87f"><img alt="" height="412" src="https://images2.imgbox.com/c0/c3/7CNX2k16_o.png" width="929">点击进入 “ <a href="http://192.168.2.161:8080/" rel="nofollow" title="Click here to see the check results.">Click here to see the check results.</a>” 可以检查主机检查项是否通过</p> 
<p id="49e3765d98412fc80c6dbfe66abfc80e">，如果有问题说明基础环境配置有问题，如果没有问题，选择“CLOSE”，下一步</p> 
<p id="aacf7aa24b006ca553e54415456b3911"><img alt="" height="803" src="https://images2.imgbox.com/6a/ec/MH9mWNa0_o.png" width="736"></p> 
<h3 id="mxloP">Choose Services</h3> 
<p id="5e1aa190cac3fad949f3745be1e3a786">选择要安装的组件: HDFS、YARN + MapReduce2、Tez、Hive、HBase、ZooKeeper、Infra Solr、Ambari Metrics、Ranger、Spark2, 默认就是勾选的，选择完成后下一步<img alt="" height="435" src="https://images2.imgbox.com/6b/40/3LxWxfG8_o.png" width="929"></p> 
<p id="402bf5427af3d87a0dfea98509fc2525"></p> 
<p id="e14c5c023a391c6dc7ba3bc79d95b415">如果有Warning 直接忽略安装</p> 
<p id="85750484f45e9158b91c40c987c1e48c"></p> 
<p class="img-center"><img alt="" height="339" id="z9tuh" src="https://images2.imgbox.com/6e/bf/bcqDBnRS_o.png" width="1000"></p> 
<h3 id="bvf3P">Assign Masters</h3> 
<p id="a8d2236e6a73c29e6f2961f7dcc395ba">这一步我们根据服务器资源合理规划服务，不能将很多服务放在一台服务器，也要将高可用服务分配在不用的服务器上。</p> 
<p id="42618d11ee27f22479ae2bd967d1f606"></p> 
<p class="img-center"><img alt="" height="847" id="avoka" src="https://images2.imgbox.com/df/1b/xn8T8dMM_o.png" width="1200"></p> 
<h3 id="grtu2">Assign Slaves and Clients</h3> 
<p id="6d4bb042e459c31d7bc7907675b22552">选择服务器上安装客户端和服务组件，默认已选择，下一步</p> 
<p class="img-center"><img alt="" height="748" id="iICXJ" src="https://images2.imgbox.com/db/a1/A04XLkW4_o.png" width="1200"></p> 
<h3 id="vT3sg">Customize Services</h3> 
<h4 id="Ez87t">CREDENTIALS</h4> 
<p id="3e0455080f40e22829629ac57e28383d">配置WEB登录密码， 我们统一使用 “winner@001”,密码复制到所有的“password”框中,密码已存在的框采用覆盖。完成后下一步</p> 
<p class="img-center"><img alt="" height="843" id="rDgHI" src="https://images2.imgbox.com/5c/73/5mAGn77V_o.png" width="1200"></p> 
<h4 id="JYDmi">DATABASES</h4> 
<p id="85944536ca09bfe3f11972a38df70eb8">点击选择database，配置hive数据库，确保测试通过，Hive Database 选择 Existing MySQL / MariaDB</p> 
<ul><li id="55af8947ddcb790ae742433135c05b2d">DatabaseName: hive</li><li id="35e174eb5696da3c3951063e605fc516">Uesr: hive</li><li id="d46f090ad6658b734380c1bfce48f556">Database Password: Winner001</li><li id="5af9a744cd00323f0db94821c2eca725">DatabaseURL: jdbc:mysql://hdp-node1/hive</li></ul> 
<p id="f43dc1d5abe2c6430b453278f2d78f39"></p> 
<p id="2eb4a0e13b415a2a22871511900235c5"><img alt="" height="440" src="https://images2.imgbox.com/45/f3/I2pfij2f_o.png" width="929"><strong>注意：</strong>测试连接不通过可以按照提示， 命令行手动设置驱动包的位置，执行如下命令后尝试再次测试连接：</p> 
<pre id="ARoML"><code>ambari-server setup --jdbc-db=mysql --jdbc-driver=/usr/share/java/mysql-connector-java.jar</code></pre> 
<p id="e7b8ed95658e875a6a7db5f39a43d2d1"></p> 
<p class="img-center"><img alt="" height="241" id="pwrZS" src="https://images2.imgbox.com/76/7c/EQkwk3w7_o.png" width="1200"></p> 
<p id="9a7bdd8a0b4cb7f41305d6c83a07fa4e">点击选中 “RANGER”，进行ranger数据库配置，确保测试通过</p> 
<ul><li id="ab47cc0a599cb285ddd390955b650c6c">DatabaseName: ranger</li><li id="de76c5e96c95669bc954279e2d882909">Uesr: ranger</li><li id="8019e9ea68b3978d37153eca2d6ec2c8">Database Password: Winner001</li><li id="66b84d3475e42c6a6865761adee8d802">DatabaseURL: jdbc:mysql://hdp-node1:3306/ranger</li><li id="8de3dce18b9da836429c02fe3c6e49ed">Ranger DB host：hdp-node1</li></ul> 
<p><img alt="" height="509" src="https://images2.imgbox.com/3b/58/zkK1k1cJ_o.png" width="929"></p> 
<p id="7d293957f7c9c79822337eade3844f63"></p> 
<p id="0524d3fee9ee281bc7cafcf643ea7873"></p> 
<p id="9d75b7dac93480cbd8fa0002ca5fb0cb"><img alt="" height="465" src="https://images2.imgbox.com/f2/a6/tCFbwT3K_o.png" width="929">设置完成后，下一步</p> 
<h4 id="kMrKd">DIRECTORIES</h4> 
<p id="7bc15b3f6248f40ea10a70acc3b66a93"><strong>一般存储数据和日志路径要配置为数据盘目录，需要提前规划挂载数据盘</strong>。</p> 
<p id="5a66415bf20f1d9c6d2c78e6f09da47e">如下是HDFS服务：<img alt="" height="531" src="https://images2.imgbox.com/bb/a5/JtNzNRPj_o.png" width="929"></p> 
<p id="3216344a5ae1b618723e239571aeb059"></p> 
<p id="f7f5c128560f41c4a89fe236def75338"></p> 
<p class="img-center"><img alt="" height="627" id="ztMG3" src="https://images2.imgbox.com/80/c9/mHnLzihb_o.png" width="1200"></p> 
<p id="02cbd8ffa5a74deb5be750b859c773e8">HDFS、YARN 、 MapReduce2、Tez、Hive、HBase、ZooKeeper、Infra Solr、Ambari Metrics、Ranger、Spark2 等日志的路径都要修改。修改完成后下一步。</p> 
<h4 id="ohIvK">ACCOUNTS</h4> 
<p id="3829da0e65862785b90b4aa6fbb625ff">账号信息确定，使用默认配置，直接下一步</p> 
<p id="f7d8f51ceac67d737501d16101ea0d7d"><img alt="" height="497" src="https://images2.imgbox.com/6b/6d/jGzNb59J_o.png" width="929"></p> 
<h4 id="Nz1bM">ALL CONFIGURATIONS</h4> 
<p id="289eec504b121df5a87ee4bfd724dee3">组件参数修改，根据资源大小自行修改，像NameNode ，HBase Master默认都是1G ，根据生产环境资源情况自行修改，我们采用默认，下一步。</p> 
<p id="ab3896044675d0dfe89c00c3d9a92dab"><img alt="" height="454" src="https://images2.imgbox.com/dd/bf/OnikLde8_o.png" width="929"></p> 
<p id="0c0aa796d28957f4e5bc4d5bcb0e08ba">此步骤我们也可以完成HDFS数据目录和日志目录修改。</p> 
<p class="img-center"><img alt="" height="798" id="xIVXE" src="https://images2.imgbox.com/fe/78/9LrNqQSq_o.png" width="1200"></p> 
<p id="9c234aab06a338a09f3723ccfafc5e5a"></p> 
<p id="eb08d3a69d4dc81e726d1503feabe9e0">确认下一步</p> 
<p class="img-center"><img alt="" height="229" id="iu92e" src="https://images2.imgbox.com/15/cc/ktjZpXQt_o.png" width="725"></p> 
<h3 id="iugVQ">Review</h3> 
<p id="30fd66f89a23a708b2ed915efe598798">点击DEPLOY<img alt="" height="380" src="https://images2.imgbox.com/c3/a4/jJdvOx4q_o.png" width="929"></p> 
<p id="bc0adac03e7faedad0cbf4de29b14c86"></p> 
<p id="fce47c447500afecf41193b382359682">组件安装中，安装大概需要50分钟左右<img alt="" height="355" src="https://images2.imgbox.com/96/42/yFQCIjbg_o.png" width="929"></p> 
<p id="54779e2ae3e388d61b8bfd19276485d8"></p> 
<p id="6c78eb2acdacd51320ce85a77e185fd0">安装完成,下一步， 如果某些组件安装失败我们需要查看日志分析原因。</p> 
<p id="a5cd66cd4b67e6a2840467f36eebeecf"><img alt="" height="419" src="https://images2.imgbox.com/17/fd/tinrpjaU_o.png" width="929"></p> 
<p id="a5cd66cd4b67e6a2840467f36eebeecf">点击 COMPLETE</p> 
<p class="img-center"><img alt="" height="837" id="JYpx9" src="https://images2.imgbox.com/5a/0d/1o0icZpM_o.png" width="1200"></p> 
<p id="635fb42289ae85ccff12a5a1161d6850">安装完成，启动失败的组件我们逐个查找原因解决就行。<img alt="" height="407" src="https://images2.imgbox.com/98/e2/yFs5TbFR_o.png" width="929"></p> 
<p id="546d3cb20c25c312467d416c70448afe"></p> 
<hr id="EIW0Y"> 
<h2 id="qS3qn"><span style="color:#1a439c;">六、开启Kerberos</span></h2> 
<hr id="jkVFz"> 
<h3 id="Bchpd">6.1 kerberos服务检查</h3> 
<hr id="XciBy"> 
<p id="7383670c09d83859074a7703dad48a40">执行如下命令，查看krb5kdc，kadmin服务是否启动成功，显示如图“running”则启动成功。</p> 
<pre id="Rygo9"><code>cd  /opt/windp-deploy/
systemctl status krb5kdc.service
systemctl status kadmin.service</code></pre> 
<p id="391fcf38375dd23ae1ec45cd1981ceb3">krb5kdc，kadmin检查这两个服务为 running 状态，如果没有启动成功尝试重启。<img alt="" height="463" src="https://images2.imgbox.com/15/e6/3VFWzDIb_o.png" width="929"></p> 
<p id="ddf85c03ae409938f207adcd8c699afa"></p> 
<p id="5d5a32fb0805a1dfef55662ecd6271f5">如果没有启动，尝试重启服务命令如下：</p> 
<pre id="jl5sc"><code>cd  /opt/windp-deploy/
systemctl restart  krb5kdc.service
systemctl restart  kadmin.service</code></pre> 
<h3 id="ju1CR">6.2 Ambari启动kerberos</h3> 
<hr id="MX75w"> 
<p id="6395131c671688a0f431472281c58233">进入Ambari 管理界面，选中启用Kerberos，点击“ENABLE KERBEROS”<img alt="" height="748" src="https://images2.imgbox.com/a6/e6/4MylZaBF_o.png" width="929"></p> 
<p id="88bf59e146358a9b6944a6b44de6aa30"></p> 
<p id="1069c379111046ad6cd6def1afb9a5d0">Warning 不用理会，点击“PROCEED ANYWAY”</p> 
<p id="8a69ae642a844811ef0ec6f1e72a9bbf"></p> 
<p class="img-center"><img alt="" height="389" id="cNGb9" src="https://images2.imgbox.com/e2/23/X99dbQn8_o.png" width="1000"></p> 
<h4 id="s5MIr">Get Started</h4> 
<p id="f4aa05bef8ec7a2fc9c2e4e99799ef92">如下图选MIT KDC， 下面的三个框我们都要选上，下一步</p> 
<p class="img-center"><img alt="" height="782" id="gu0tg" src="https://images2.imgbox.com/03/ca/RYaVLvzy_o.png" width="1200"></p> 
<p id="8d6bc72d0a3b34ca3025d9c14a18fe64"></p> 
<h4 id="2p1G6">Configure Kerberos</h4> 
<p id="841407ec0b0f9d0ef05f5f2f5a73714f">将如下配置复制到对应的位置，确保测试通过，填好之后下一步（修改部分已标红）</p> 
<ul><li id="a3b625eb699d30e8c786fd21521b26c8">Kadmin host: hdp-node1</li><li id="2c6f1303db2f04aaf759338bcc183e0c">Realm name: WINNER.COM</li><li id="a92462c342a1503907b5fea2bd07a431">Admin principal: admin/admin@WINNER.COM</li><li id="e67db2e1636dc04bac93c896b029dc81">Admin password: winner@001</li></ul> 
<p id="78e01a14de9645894be6313ecc8b0aef"></p> 
<p class="img-center"><img alt="" height="730" id="RL9QG" src="https://images2.imgbox.com/f9/35/EyoNZYa4_o.png" width="1200"></p> 
<h4 id="v8k8c">Install and Test Kerberos Client</h4> 
<p id="86a689a08b6f242cb5a2139fa80ebab0">Kerberos Client 安装和测试完成之后，下一步</p> 
<p id="faa2dc28e16cb188ae00c80c805b150b"></p> 
<p class="img-center"><img alt="" height="489" id="lVlwF" src="https://images2.imgbox.com/cf/a1/U6PH3tZ5_o.png" width="1200"></p> 
<h4 id="vm71w">Configure Identities</h4> 
<p id="f6882c34faaa87d65a3755e339f38bb4">默认 直接下一步</p> 
<p id="703eff2a9883160c94d4287fef853ab6"></p> 
<p class="img-center"><img alt="" height="709" id="uEC0L" src="https://images2.imgbox.com/8c/f5/9kQy74Tj_o.png" width="1200"></p> 
<h4 id="bsiB2">Confirm Configuration</h4> 
<p id="e3e2c0b77461cc06793d6253af358ea1">默认直接下一步</p> 
<p id="813104b7584d26de73880b1d9b6778d8"></p> 
<p class="img-center"><img alt="" height="495" id="IS8tE" src="https://images2.imgbox.com/66/44/XGJ8ZG0A_o.png" width="1200"></p> 
<h4 id="kGbiU">Stop Services</h4> 
<p id="af5a69699c0604615fbd603f5459fcfb">停止所有服务，等待执行完成后下一步</p> 
<p class="img-center"><img alt="" height="513" id="k2XCJ" src="https://images2.imgbox.com/92/8f/UGUQ1h18_o.png" width="1200"></p> 
<p id="456a7230389715afc800e03e91cabfa7"></p> 
<h4 id="RSqJu">Kerberize Cluster</h4> 
<p id="9f8c1a08ddb085cd9c26903fa738b748">全部通过后下一步 ，如若失败尝试重试解决问题。</p> 
<p class="img-center"><img alt="" height="531" id="tfY4B" src="https://images2.imgbox.com/ab/63/8EIzFJoF_o.png" width="1200"></p> 
<p id="dd4bb85301f2992edd6fd9ff734f024b"></p> 
<h4 id="2eeHQ">Start and Test Services</h4> 
<p id="e1a649dda07d4503ce6bb0b7c61ccf1a">启动全部服务并进行测试，全部启动成功需要10分钟左右</p> 
<p class="img-center"><img alt="" height="330" id="wVzu3" src="https://images2.imgbox.com/c9/03/FkMOD9rA_o.png" width="1000"></p> 
<p id="9e9205fae0293e6de64c6842061eb2be"></p> 
<p id="d4352fdc23a06c06cef5fbaf216ceb7a">启动完成需要10分钟左右，启动完后下一步</p> 
<p class="img-center"><img alt="" height="504" id="cUzLc" src="https://images2.imgbox.com/8d/bc/vWta6ufS_o.png" width="1200"></p> 
<p id="60974e07dfa6b728ddc10e20f7b95622"></p> 
<p id="006504b1ec64fb7c0ebeee3ca4d6a129">如果启动失败进行启动尝试，或者没有关系直接点击COMPLETE ，然后查看启动不了的组件，逐个解决。</p> 
<p id="57cbccbdec84af50f37387c8fe78e57a"></p> 
<p class="img-center"><img alt="" height="330" id="uRRPb" src="https://images2.imgbox.com/e1/96/HxtVCIqY_o.png" width="1000"></p> 
<p id="f2ab4f9f527c29ac1ff8336ea2a043fa">启动完成</p> 
<p class="img-center"><img alt="" height="425" id="aRmJ6" src="https://images2.imgbox.com/44/56/zncWeDlz_o.png" width="1000"></p> 
<p id="c225d930131d53426d56ff4596230aa5"></p> 
<hr id="cvdvS"> 
<h2 id="daqFd"><span style="color:#1a439c;">七、开启服务高可用</span></h2> 
<hr id="FPN09"> 
<p id="7db39e6a2f964e0dc8abeadfb4d22c62">YARN和NameNode的高可用开启至少需要 3个zookeeper Server。也就是说需要3台服务器，否则我们也可以选择不开启服务高可用。</p> 
<h3 id="4xXsk">7.1 HBaseMaster高可用开启</h3> 
<hr id="VFhm8"> 
<p id="a2b8a76b3af196775fdf309ecaeb6345">在ambari页面上找到hbase的配置页面点击 add HBase Master<img alt="" height="294" src="https://images2.imgbox.com/5d/98/hf9GrOk9_o.png" width="929"></p> 
<p id="935c787b272e4b831e2539819e478cb8"></p> 
<ul><li id="9f84595ef75054abaea8f40dd4d9e11c">Admin principal: admin/admin@WINNER.COM</li><li id="0253ad0ef55a9781414861114d40de02">Admin password: winner@001</li></ul> 
<p id="87d58e40f4523469f0153bdd061e88eb"></p> 
<p class="img-center"><img alt="" height="460" id="PTvAs" src="https://images2.imgbox.com/f0/0d/JjF4vpBk_o.png" width="735"></p> 
<p id="d098da403802a22737cabe9f988ab681">选择新加的HBaseMaster的主机</p> 
<p id="a4befbd939357408d4743df4ce3eaf70"></p> 
<p class="img-center"><img alt="" height="287" id="GJdxy" src="https://images2.imgbox.com/f3/5c/tFn3j4Vz_o.png" width="736"></p> 
<p id="3de708de2353158820ffa80619a8f7bf">安装中，安装完成后我们选择OK</p> 
<p id="fcfb2db81d0db2478d3139414b2c6504"></p> 
<p class="img-center"><img alt="" height="662" id="fiSzG" src="https://images2.imgbox.com/eb/3a/2BXmet7c_o.png" width="1200"></p> 
<p id="8517b8c75ea5a81aa7f296533aeec77e">在HBase页面选择Restart All 重启<img alt="" height="294" src="https://images2.imgbox.com/9a/f5/j6EXzLnX_o.png" width="929"></p> 
<p id="ba40c50cfa93bd185ec9ddd76e4a6d8d"></p> 
<p id="034667b07b043a6d67e3b21e581353de">如下图可以看到 两个HBASE MASTER，状态分别是STANDBY和ACTIVE 表示 HBASE MASTER高可用开启成功。</p> 
<p id="3f36735056c9c434552b7b8de9584515"></p> 
<p class="img-center"><img alt="" height="670" id="GkSpd" src="https://images2.imgbox.com/4a/0c/4zrdjobP_o.png" width="1200"></p> 
<h3 id="P0kgP">7.2 ResourceManager高可用开启</h3> 
<hr id="kvztV"> 
<p id="d6a3463c3d40dd46675b2ec13a64102d">yarn高可用配置，在ambari上找到yarn管理界面，点击Enable ResourceManager HA<img alt="" height="312" src="https://images2.imgbox.com/ec/be/Em80x3Jx_o.png" width="929"></p> 
<p id="40b36521db0e81da09cdc0cbd955beaa"></p> 
<p id="e544abff54acef628272ae2cf790360a">选择下一步</p> 
<p id="8a052054b4c54889c71793e92f066165"></p> 
<p class="img-center"><img alt="" height="429" id="LUa6V" src="https://images2.imgbox.com/43/83/0cwZ77qe_o.png" width="1200"></p> 
<p id="01029738f0226a3ca998d0798ff1aeba">选择高可用开启的另一台服务器，我们选择hdp-node2，然后下一步</p> 
<p id="0657aa1a5b9f6ad0b9c43cee7dc8e5e1"></p> 
<p class="img-center"><img alt="" height="869" id="UyIgO" src="https://images2.imgbox.com/65/b4/o9wQuZLw_o.png" width="1200"></p> 
<p id="4edba7439b969d7349bfdfac6fe0852f">REVIEW直接下一步</p> 
<p id="e2b61d746a00ccd0fcfba5d68f636b9e"><img alt="" height="377" src="https://images2.imgbox.com/36/b0/YOfX7TMb_o.png" width="929"></p> 
<p id="b43abce9d0e9a3d163d94c736aee1290"></p> 
<p id="cf09f23e9be1f8106b5adf6aa348c8d4">如上内容填好后选择 save</p> 
<ul><li id="7a7337df917e1f74a23212e7dd3e379e">Admin principal: admin/admin@WINNER.COM</li><li id="414cc76eb2024833590144437149a28a">Admin password: winner@001</li></ul> 
<p id="c89c60e6e83f8d1cdb968a25b7de2814"></p> 
<p class="img-center"><img alt="" height="454" id="cCJ41" src="https://images2.imgbox.com/c1/1f/kXjtGaOz_o.png" width="730"></p> 
<p id="370e82128a1548825f9b851762897d02">等待配置安装完成，需要20分钟左右，启动完成后选择COMPLETE</p> 
<p id="482e5cb553e635b8d652ee2c81715740"></p> 
<p class="img-center"><img alt="" height="614" id="IzL5w" src="https://images2.imgbox.com/e0/3c/sVvgvTiy_o.png" width="1200"></p> 
<p id="5115eb2d62e0f4ea8cebad61632bef53">如下图可以看到启动全部完成</p> 
<p id="06f42a9335cdd42d4018bc1c906765e3"></p> 
<p class="img-center"><img alt="" height="611" id="gtbDz" src="https://images2.imgbox.com/5c/ad/y7pSlfNZ_o.png" width="1200"></p> 
<p id="0259d286546ee6eef9233017d87ebed4">如图RESOURCEMANAGER 状态一个是STADDBY 另一个是ACTIVE。</p> 
<p id="384a55f5df9b7523a2e735a22066989a"></p> 
<p class="img-center"><img alt="" height="648" id="ep2hF" src="https://images2.imgbox.com/e5/61/uZOQIpOx_o.png" width="1200"></p> 
<p id="5918e96d8cc15bb0cdc21c596ffa7f39"></p> 
<h3 id="qr4fe">7.3 NameNode高可用开启</h3> 
<hr id="qJUkf"> 
<p id="9ae8d722c34af2bedf30a13d8ce68d8a">HDFS高可用配置，在ambari页面上找到hdfs服务，点击actions ，选择 Enable Namenode HA<img alt="" height="271" src="https://images2.imgbox.com/a4/64/KpztjkV1_o.png" width="929"></p> 
<p id="29b77f10fda96b565b912f10b1f2041c"></p> 
<p id="5f6508001f617ac41c70b6fa356d4002">填写hdfs的namespace：winnercluster，确认无误后点击next<img alt="" height="368" src="https://images2.imgbox.com/25/7b/nAJJJmkX_o.png" width="929"></p> 
<p id="57045306e094dcda485c50a793bb52a4"></p> 
<p id="96e648fd08070fb3ebb97cfc2007d693">选择namenode和journalNode运行的主机，确认无误后点击next<img alt="" height="404" src="https://images2.imgbox.com/68/e0/yhHhfOA1_o.png" width="929"></p> 
<p id="e3649590000b33955c70473630b548af"></p> 
<p id="82a7e17ba6bec4df641b363f5683434c">Review下hdfs高可用的配置，点击Next<img alt="" height="373" src="https://images2.imgbox.com/14/27/TtTAMsMe_o.png" width="929"></p> 
<p id="52b5fafaf5a9b26ddbc8629fc619c47d"></p> 
<p id="5e997d3ce3d2ee5f4cf86488d8840c8c">按照提示需要先给hdfs做一下checkpoint，这个时候next 按钮是灰色的，等做完下面的操作后，点击next按钮即可。注意：切记看正确操作的服务器。<img alt="" height="368" src="https://images2.imgbox.com/fb/bd/kJBK6JGE_o.png" width="929"></p> 
<p id="a1d43781b2b91b9790a1c81980237343"></p> 
<p id="555ebbfacfb28ed279221bf8dd6a3737"></p> 
<p class="img-center"><img alt="" height="113" id="mW7Z8" src="https://images2.imgbox.com/1d/48/dZ6bctBv_o.png" width="993"></p> 
<p id="63765f553c2130cd4ae182dfafa82cf4">如下配置填入页面表格</p> 
<ul><li id="79ea370b981f0c47f54ef367c4f70d0c">Admin principal: admin/admin@WINNER.COM</li><li id="e304ffda5b6e2c2ab6f98f22473afeef">Admin password: winner@001</li></ul> 
<p id="c5bee2b395dc005b9c4d7a86bad8b348"></p> 
<p class="img-center"><img alt="" height="459" id="ZzAgS" src="https://images2.imgbox.com/91/d2/zwlyO4m7_o.png" width="720"></p> 
<p id="585aaacf6f8bec3a1d060e556663f60e">开始安装等待安装完成，然后下一步，大概需要15分钟左右。如若失败我们可以选择重试。<img alt="" height="366" src="https://images2.imgbox.com/fc/64/SusNUyYr_o.png" width="929"></p> 
<p id="726632bfd5153536a6bda85e97ba9d2c"></p> 
<p id="9be6717e5d06e66a62597f7792fc23d2">按照提示在服务器上执行命令初始化journalNode，完成后点击next<img alt="" height="367" src="https://images2.imgbox.com/64/1e/SPBcyqFA_o.png" width="929"></p> 
<p id="cdf41db2cd592c458586a777fac06570"></p> 
<p class="img-center"><img alt="" height="185" id="JDNKV" src="https://images2.imgbox.com/f1/02/DsoGdPnX_o.png" width="1085"></p> 
<p id="42702fb1949f1d07a6b30a53d82383d2"></p> 
<p id="a8364a94da591f35ac962df93b0d4fbe">Ambari启动所有相关的组件，启动完成后下一步。大概需要10分钟左右。</p> 
<p id="35d4e4136553f6409fdd387ba4cbe2eb"><img alt="" height="367" src="https://images2.imgbox.com/07/c5/c1PRcxpz_o.png" width="929"></p> 
<p id="35d4e4136553f6409fdd387ba4cbe2eb">按照下图所示初始化元数据信息，执行完成后下一步。<strong>注意</strong>：切记看正确操作的服务器，是在两台服务器完成命令执行。<img alt="" height="350" src="https://images2.imgbox.com/fb/70/dTJCDM2c_o.png" width="929"></p> 
<p id="db15ac7a02d64754cc6dbcc62f5d4807"></p> 
<p id="7ee2dbe262c575d2805fec1892988ef4">确认操作完后，选择OK</p> 
<p id="84501fb2fb74ba9f40dc548f49c30c34"></p> 
<p class="img-center"><img alt="" height="193" id="hqD5V" src="https://images2.imgbox.com/55/18/1GkICupa_o.png" width="726"></p> 
<p id="df36b22c3fc17e20aa3c9d9bb0199c52">启动所有组件，大概需要15分钟左右，有可能启动失败，我们可以选择重试或者定位具体启动失败原因。<img alt="" height="408" src="https://images2.imgbox.com/79/05/zoanXYWS_o.png" width="929"></p> 
<p id="9f0ec3314b005e59a2fe7c0f4933f04f"></p> 
<p id="e8e4df4c0570b351def83c4dc1bb6cc9">如下图可以看到两个NAMENODE，状态分别是STANDBY和ACTIVE 表示 NAMENODE高可用开启成功。<img alt="" height="346" src="https://images2.imgbox.com/e2/81/NaKATEfv_o.png" width="929"></p> 
<p id="d7b90d9f22977dd9214e61e3dc29c45e"></p> 
<p id="237f725a2bf48f44cf0436c69888beb6"></p> 
<hr id="y56lp"> 
<h2 id="w4OTa"><span style="color:#1a439c;">八、ranger权限开启</span></h2> 
<hr id="lnyWd"> 
<h3 id="FPTS8">8.1 ranger登录</h3> 
<hr id="LZkBD"> 
<p id="b702f1865037ccdb30f81ad7e1af8ed8">访问图中链接会跳转到ranger登录页面，登录失败可能需要将主机名换成IP。<img alt="" height="346" src="https://images2.imgbox.com/5c/13/G31159oV_o.png" width="929"></p> 
<p id="77bf82c1ddabf6659232f0d104720217"></p> 
<p id="7a21696a5e1309666b9bf3d2db2fa2a0">登录ranger web页面，用户名：admin ，密码：winnerxxxx<img alt="" height="314" src="https://images2.imgbox.com/04/3d/HJFju0Wh_o.png" width="929"></p> 
<p id="88043cd0064a3544489365d5b198a086"></p> 
<p id="f7e8146e042a69b94e90f6c0b0f2a4aa">登录后的页面如下</p> 
<p id="7aaf65db2f7df53f6752c838b7b036a2"></p> 
<p class="img-center"><img alt="" height="643" id="Me0Xb" src="https://images2.imgbox.com/ed/80/2XvDgUEB_o.png" width="1200"></p> 
<p id="ce9adf826ecebfd535128e26391eb92c">我们需要添加winner_spark的服务组件操作权限。</p> 
<h3 id="rqRSP">8.2 HDFS权限控制</h3> 
<hr id="gbw9K"> 
<p id="b3e27cddd5d73121e4e93e23c8556f83">点击进入默认的service设置页面<img alt="" height="332" src="https://images2.imgbox.com/55/4d/Eq43ZTQx_o.png" width="929"></p> 
<p id="5a8e5cc74461ecf476fc81c0f8cea4be"></p> 
<p id="8f8cbb6ad4f68c14b38781821e56eb9d">点击进入Policy ID为1 的策略进入编辑<img alt="" height="216" src="https://images2.imgbox.com/a1/be/0PALOu9V_o.png" width="929"></p> 
<p id="0df7896a5c39431439d37c1036360211"></p> 
<p id="fec6f43074545d2743ee7280257a8cb1">添加winner_spark用户</p> 
<p id="e6d85e53742b50a63ccb55d825b1b7fa"></p> 
<p class="img-center"><img alt="" height="868" id="nnKYH" src="https://images2.imgbox.com/fd/c6/XUt8SX5Z_o.png" width="1200"></p> 
<p class="img-center"><img alt="" height="622" id="N5NkE" src="https://images2.imgbox.com/01/56/LTMruWno_o.png" width="1200"></p> 
<p id="23198a74b9ffc440e0b53a7560b190fc">添加完成后 save保存。</p> 
<p id="8ed468dc6cae77514fefdf1d1de3ac29"></p> 
<p id="cbf6c3b19e165d7c7c7d2bf2bd8fd599">Policy ID为2的策略也是编辑添加winner_spark 后 保存。winner_spark 用户添加HDFS操作权限完成后如下图</p> 
<p id="346bcca820a0c4d15304bd9f5653f643"></p> 
<p class="img-center"><img alt="" height="449" id="lQhGy" src="https://images2.imgbox.com/3d/09/PA2Dq2uH_o.png" width="1200"></p> 
<p id="3ce07d8d2a6189009e6a6634a3f6f7b7"></p> 
<p id="bc46a32ce012b15aeafe390829a8d986"></p> 
<p id="9ab81d11ba145ccdfadde012f01d6b9c">我们需要Policy ID 为1 策略中添加hive 用户对HDFS操作权限，完成后如下图</p> 
<p id="a23816b44238ef37817f4c153919fb25"></p> 
<p class="img-center"><img alt="" height="420" id="IRtJX" src="https://images2.imgbox.com/68/ef/QPZ1oW3S_o.png" width="1200"></p> 
<p id="5de3b4fb0b608fd23b9963c8f7a12bdf"></p> 
<h3 id="sI6i2">8.3 HBase权限控制</h3> 
<hr id="u4CFB"> 
<p id="4b2195a2e73505073239ce97c2d73148">点击进入默认的service设置页面<img alt="" height="323" src="https://images2.imgbox.com/2f/9d/r6bKiSjN_o.png" width="929"></p> 
<p id="729decfa0a0b00841471220a9d94a372"></p> 
<p id="19e287fd62398af6eb8729b6ad2f9522">点击进入Policy ID为4 的策略进入编辑</p> 
<p id="e4c221fe00373e6abe857a712776280d"></p> 
<p class="img-center"><img alt="" height="417" id="DZpnU" src="https://images2.imgbox.com/fc/ae/RtjC8ibo_o.png" width="1200"></p> 
<p id="2942f610e82d24d2e589e4a1ff9f2913">添加winner_spark用户</p> 
<p id="fc19e2e6197316909432d669534aacd4"></p> 
<p class="img-center"><img alt="" height="808" id="ENf9h" src="https://images2.imgbox.com/4f/7f/HlrNkCMI_o.png" width="1200"></p> 
<p id="b5ad6c80061c597f857a312551ca861d">添加完成后 save保存。Policy ID为5的策略也是编辑添加winner_spark 后 保存。</p> 
<p id="c632f97f477a0d6ee7c47c1ff89c3300"></p> 
<p id="6278f9ab3691a0f38d026c5bcd4d8c7a">winner_spark 用户添加HBase操作权限完成后如下图</p> 
<p id="2b42740686a8f566df3281aa6e47bcbc"></p> 
<p class="img-center"><img alt="" height="405" id="hdkki" src="https://images2.imgbox.com/6c/9c/3XnZBSWW_o.png" width="1200"></p> 
<h3 id="VUlu8">8.4 Hive权限控制</h3> 
<hr id="tKiD3"> 
<p id="4607661ac3a098c4356802ff520fd077">点击进入默认的service设置页面<img alt="" height="301" src="https://images2.imgbox.com/ca/a7/M5ufSymH_o.png" width="929"></p> 
<p id="d302d33719254330e6501c8f24f3ddd1"></p> 
<p id="236290adaea844f419cdeb82975184b1">点击进入Policy ID为8 的策略进入编辑<img alt="" height="271" src="https://images2.imgbox.com/84/5a/IqNRihWD_o.png" width="929"></p> 
<p id="fc071338c95c1a8a4489a365461a878e"></p> 
<p id="9d34fba89896bf79c871635e308d1525">添加winner_spark用户权限完成后 save保存。</p> 
<p id="5bf336714d250585ba84411ba10a0ad8"></p> 
<p class="img-center"><img alt="" height="698" id="iBtIr" src="https://images2.imgbox.com/87/09/unBEUjjO_o.png" width="1200"></p> 
<p id="c6389904292b64815b4000754e9351de"></p> 
<p id="dec53ced256c5ce79a13210cb6d6760c">剩下的Policy 策略也是编辑添加winner_spark 后 保存。</p> 
<p id="e50b9dd3c68d1f2e4a6fc7bd32e0169a">winner_spark 用户添加Hive操作权限完成后如下图</p> 
<p id="d0a9c405d91dd306dfb50cbece42b221"></p> 
<p class="img-center"><img alt="" height="460" id="haa9S" src="https://images2.imgbox.com/af/ea/RdnA0AC8_o.png" width="1200"></p> 
<h3 id="R2fkt">8.5 Yarn权限控制</h3> 
<hr id="mn5dv"> 
<p id="ebf078b24fd6a4b5dd2eae395e848202">点击进入默认的service设置页面</p> 
<p id="60191ee9869fa673f306731cd1fe2eaa"></p> 
<p class="img-center"><img alt="" height="673" id="z07nX" src="https://images2.imgbox.com/f3/05/WLdM2YhO_o.png" width="1200"></p> 
<p id="3dff788ae66641ac24304c630aaa6160"></p> 
<p id="b0e8ae664eb39645fe0e34b20b17173e">点击进入Policy ID为6 的策略进入编辑</p> 
<p id="1ca1fedf6e64f3fea1e29758df488e87"></p> 
<p class="img-center"><img alt="" height="348" id="tcciX" src="https://images2.imgbox.com/e4/81/090c9R3y_o.png" width="1200"></p> 
<p id="070d6ab03c97e12e54a6adf654c03d29">添加winner_spark用户</p> 
<p id="5967f8c9fd1659b20ba929bfa9f65744"></p> 
<p class="img-center"><img alt="" height="735" id="XCAGA" src="https://images2.imgbox.com/a1/55/euCF9Tod_o.png" width="1200"></p> 
<p id="7788cb899c86cce4fccb7dc140b4deda"></p> 
<p id="782f2fae5c775bdcb45ba477e3aedc8c">剩下的Policy 策略也是编辑添加winner_spark 后 保存。</p> 
<p id="b7d09d7abace99fe23887faa451feda7">winner_spark 用户添加Yarn操作权限完成后如下图</p> 
<p id="bf3a4eb22604e6c321f36dc1521af810"></p> 
<p class="img-center"><img alt="" height="368" id="mZokN" src="https://images2.imgbox.com/84/f9/1yG9lJZ8_o.png" width="1200"></p> 
<hr> 
<h2 id="Mzbdm"><span style="color:#1a439c;">九、Ansible自动化安装脚本</span></h2> 
<hr id="AyDTR"> 
<p id="u16125dd0">说明：<strong>脚本可以在博客资源中可以下载，如下是部署目录结构。</strong></p> 
<p id="ue8d7420b"></p> 
<p id="u8e2e3ce8"><img alt="" height="350" src="https://images2.imgbox.com/9a/03/2SNamGJs_o.png" width="831">脚本入口 installDeployAmbari.sh</p> 
<pre id="ZGB9Q"><code class="language-bash">#!/bin/bash
#                                                         
# 脚本功能: 配置初始化，完成ambari-server安装启动       
# 作    者: kangll                                        
# 创建时间: 2024-03-29                                    
# 修改时间: 2024-03-29
# 当前版本: 1.0v                                          
# 调度周期: 一次性任务                      
# 脚本参数: 无                                            
#                                                         
#
. /etc/profile &gt; /dev/null 2&gt;&amp;1
set -x
#set -e
# 请确保已经按照部署文档中事先配置好了, ./autoDeployFiles/scripts/hostlist.txt中的内容以及temphosts.txt
# ./config/global.sh


BASEDIR=$(cd "$(dirname "$0")"; pwd)
scriptsDir=$BASEDIR/autoDeployFiles/scripts
cd ${scriptsDir}

if [ `rpm -qa |grep expect &gt; /dev/null 2&gt;&amp;1;echo $?` -ne 0 ]; then
    sudo yum install -y expect
fi

if [ `rpm -qa |grep ansible &gt; /dev/null 2&gt;&amp;1;echo $?` -ne 0 ]; then
	sudo yum install epel-release -y
	sudo yum install ansible -y
fi

cat ${scriptsDir}/temphosts.txt |awk '{print $1,$2}' | while read vIP vHost
do
    if [ `grep ${vHost} /etc/hosts &gt; /dev/null 2&gt;&amp;1;echo $?` -ne 0 ]; then
        echo "${vIP} ${vHost}" &gt;&gt; /etc/hosts
    fi
done


# linux 免密
sh $scriptsDir/batchSendKey.sh

# linux hosts
for i in `cat ${scriptsDir}/temphosts.txt |awk '{print $2}' |grep -v \`hostname\`|xargs `
do
    scp /etc/hosts $i:/etc/
done


# linux hosts
for i in `cat ${scriptsDir}/temphosts.txt |awk '{print $2}' |xargs `
do
    ssh $i "sudo hostnamectl set-hostname $i"
done

source /etc/profile

ambari_server_source=`hostname`
sudo sed -i 's/windp-aio/'"${ambari_server_source}"'/g' $BASEDIR/ambari.yml

# ansible hosts
echo [all_node] &gt; /etc/ansible/hosts
cat ${scriptsDir}/temphosts.txt |awk '{print $2}' &gt;&gt; /etc/ansible/hosts
echo "" &gt;&gt; /etc/ansible/hosts

# 默认安装ambariserver的服务器为控制端,也就是master节点
echo [master] &gt;&gt; /etc/ansible/hosts
echo `hostname` &gt;&gt; /etc/ansible/hosts
echo "" &gt;&gt; /etc/ansible/hosts

# 除当前服务器的其他服务器为agent
echo [slave] &gt;&gt; /etc/ansible/hosts
cat ${scriptsDir}/temphosts.txt |awk '{print $2}' |grep -v `hostname` &gt;&gt; /etc/ansible/hosts

cd $BASEDIR
ansible-playbook ambari.yml</code></pre> 
<p id="ue586ced8"><strong>ambari.yml</strong></p> 
<pre id="WZogZ"><code>---

# author: kangll
# date:   2024-04-03
# funtion: 离线自动化部署ambari-server
# 版本要求：
# OS: Redhat7.2-CentOS7.9(仅支持该操作系统版本)
# ambari-2.7.4
# MySQL 5.7+/Python3+
# 

- hosts: all_node
  gather_facts: F
  vars:
    paths:
      scriptsDir: /opt/windp-deploy/autoDeployFiles/scripts
      JDKDir: ./autoDeployFiles/JDK
      JAVA_HOME_PATH: /usr/java
    packages:
      jdk: jdk-8u162-linux-x64.tar.gz
  tasks:
    - include: ./component/setup_base_env.yml  # 设置基础环境
    - include: ./component/setup_java_env.yml  # 设置JAVA_HOME
  remote_user: root
  tags: jdk_base_env

- hosts: master
  gather_facts: F
  vars:
    local_ambari_os_yum_repo: hdp-node1
    paths:
      MySQLDir: ./autoDeployFiles/MySQL
      installScriptDir: /opt/windp-deploy
      MySQLConfDir: ./autoDeployFiles/configFiles
      driverDir: /usr/share/java
      confDir: ./autoDeployFiles/configFiles
    password:
      mysql: Winner001
      ambari: Winner001
      hive: Winner001
    packages:
      mysql_driver: mysql-connector-java.jar
  tasks:
    - include: ./component/setup_mysql_server.yml  # 创建用户解压MySQL包于/usr/local/mysql、MySQL初始化、修改root密码
    - include: ./component/setup_kdc_server.yml    # 安装配置kerberos
    - include: ./component/setup_ambari_server.yml  # 安装并启动Ambari-server
  remote_user: root
  tags: mysql

- hosts: slave
  gather_facts: F
  vars:
    paths:
      repoTmpDir: ./config/repo
      repoDir: /etc/yum.repos.d
      krb5File: /etc/
      keytabFile: /etc/security/keytabs
  tasks:
    - include: ./component/setup_hdp_repo.yml        # repo,kerberos配置同步
  remote_user: root
  tags: repo
</code></pre> 
<p id="u83e09009"></p> 
<p id="u7001a0cf">install_base_kdc.sh</p> 
<pre id="HT3mx"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2024-03-10
# Desc: kerberos配置
#

#set -x
BASEDIR=$(cd "$(dirname "$0")"; pwd)
# 加载配置
source  $BASEDIR/config/global.sh

# global.sh 配置文件中获取
ssh_passwd="winner@001"
kerberos_user=winner_spark

hostName=`hostname`
########################
# 配置kerberos,安装启动
########################
config_krb5() {
        # kerberos server and client
        sudo yum install krb5-server krb5-libs krb5-workstation -y
  
        # config file
        sudo cat $BASEDIR/config/krb5.conf &gt; /etc/krb5.conf
        # 修改为 kdc serve hostname
        sudo sed -i 's/windp-aio/'"${hostName}"'/g' /etc/krb5.conf
	sudo cat $BASEDIR/config/kdc.conf  &gt; /var/kerberos/krb5kdc/kdc.conf
	sudo cat $BASEDIR/config/kadm5.acl &gt; /var/kerberos/krb5kdc/kadm5.acl
        
        echo "******* 创建kdc数据库 *********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kdb5_util create -s -r WINNER.COM $1@$2
         
        ## 开始进连续捕获
        expect  {
                "Enter KDC database master key:" { send "${ssh_passwd}\n"; exp_continue }
                "master key to verify:"          { send "${ssh_passwd}\n"; exp_continue }
        }
eof
        echo "******** 创建admin实例 *********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:"    { send "addprinc admin/admin\n"; exp_continue }
                "Enter password for principal"    { send "${ssh_passwd}\n"; exp_continue }
                "Re-enter password for principal" { send "${ssh_passwd}\n";  }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof

        # start kdc and kadmin 
        sudo systemctl restart krb5kdc
        sudo systemctl enable krb5kdc
        sudo systemctl restart kadmin
        sudo systemctl enable kadmin

	# add linux user 
	sudo useradd winner_spark
	# keytabs file path
        sudo mkdir -p /etc/security/keytabs/
        
        echo "********** kerberos installation completed **********"
}

##################################
# 配置kerberos用户: winner_spark 
# 生成keytab 文件
##################################
config_kerberos_user() {
        echo "******** 创建winner_spark用户实例 ********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:"    { send "addprinc ${kerberos_user}\n"; exp_continue }
                "Enter password for principal"    { send "${ssh_passwd}\n"; exp_continue }
                "Re-enter password for principal" { send "${ssh_passwd}\n"; }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof

       echo "******** winner_spark用户生成keytab文件 ********"
        /usr/bin/expect &lt;&lt; eof
        # 设置捕获字符串后，期待回复的超时时间
        set timeout 30
         
        spawn kadmin.local 
         
        ## 开始进连续捕获
        expect  {
                "kadmin.local:" { send "xst -k /etc/security/keytabs/${kerberos_user}.keytab ${kerberos_user}@WINNER.COM\n";  }
        }
       expect "kadmin.local:"    { send "quit\r";  }
eof
       sleep 2s
       # modify keytab file privilege    
       sudo chown ${kerberos_user}:${kerberos_user} /etc/security/keytabs/${kerberos_user}.keytab
       echo "********** kerberos user winner_spark add completed **********"
}


# 配置kerberos,并启动
config_krb5

# 配置kerberos用户: winner_spark, 生成keytab 文件
config_kerberos_user</code></pre> 
<p id="u14d41bd8"></p> 
<p id="u7613f50b">install_mysql.sh</p> 
<pre id="X8tk9"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2023-11-10
# Desc: install mysql5.7
#
set -x
echo "******** INSTALL MYSQL *********"
####################################
BASEDIR=$(cd "$(dirname "$0")"; pwd)
# 加载数据库默认连接信息
source  $BASEDIR/config/global.sh
install_path=$mysql_install_path
hostname=`"hostname"`

#####################################

# 卸载原有的mariadb
OLD_MYSQL=`rpm -qa|grep mariadb`
profile=/etc/profile
for mariadb in $OLD_MYSQL
do
     rpm -e --nodeps $mariadb
done

# 删除原有的my.cnf
sudo rm -rf /etc/my.cnf

#添加用户组 用户
sudo groupadd mysql
sudo useradd -g mysql mysql

# 解压mysql包并修改名称
tar -zxvf  $BASEDIR/autoDeployFiles/MySQL/mysql-5.7.44-el7-x86_64.tar.gz -C $install_path
sudo mv $install_path/mysql-5.7.44-el7-x86_64 $install_path/mysql

# 更改所属的组和用户
sudo chown -R mysql $install_path/mysql
sudo chgrp -R mysql $install_path/mysql

sudo mkdir -p $install_path/mysql/data
sudo mkdir -p $install_path/mysql/log
sudo chown -R mysql:mysql $install_path/mysql/data

# 粘贴配置文件my.cnf 内容见八 中的 my.cnf
cp -f $BASEDIR/config/my.cnf $install_path/mysql/

# 安装mysql
$install_path/mysql/bin/mysql_install_db --user=mysql --basedir=$install_path/mysql/ --datadir=$install_path/mysql/data/

# 设置文件及目录权限：
cp $install_path/mysql/support-files/mysql.server /etc/init.d/mysqld
sudo chown 777 $install_path/mysql/my.cnf
sudo chmod +x /etc/init.d/mysqld

sudo mkdir /var/lib/mysql
sudo chmod 777  /var/lib/mysql

# 启动mysql
/etc/init.d/mysqld start

# 设置开机启动
chkconfig --level 35 mysqld on
chmod +x /etc/rc.d/init.d/mysqld
chkconfig --add mysqld

# 修改环境变量 
ln -s $install_path/mysql/bin/mysql /usr/bin
ln -s /var/lib/mysql/mysql.sock   /tmp/
cat &gt; /etc/profile.d/mysql.sh&lt;&lt;EOF
  export PATH=$PATH:$install_path/mysql/bin
EOF

mysqlPw=`sed -n 2p /root/.mysql_secret`
mysqlPwTMP=`sed -n 2p /root/.mysql_secret`1

mysql -u$myuser -p$mysqlPw --connect-expired-password -e "SET PASSWORD = PASSWORD('${mypwd}');"

echo "******** MYSQL installation completed ********"
</code></pre> 
<p id="ub1fd84a6">install_repo.sh</p> 
<pre id="C63fF"><code class="language-bash">#! /bin/bash
#
# Author: kangll
# CreateTime: 2024-03-10
# Desc: 配置HDP repo
#

set -x
BASEDIR=$(cd "$(dirname "$0")"; pwd)
#
source  $BASEDIR/config/global.sh
# HDP tar install path
config_path=$install_path
tar_name=$hdp_tar_name

source /etc/profile &gt; /dev/null 2&gt;&amp;1

#ambari server源地址

if [ $# -eq 1 ] ;then
    ambari_server_source=$1
else
    ambari_server_source=`hostname`
fi

###########################
# 配置 HDP repo
###########################
config_repo() {
  	mkdir -p $config_path
        if [ ! -d $config_path/hdp ];then
             sudo mv $BASEDIR/autoDeployFiles/HDP/hdp  $config_path
        fi
 
	sudo ln -s $config_path/hdp/ambari /var/www/html/ambari
	sudo ln -s $config_path/hdp/HDP /var/www/html/HDP
	sudo ln -s $config_path/hdp/HDP-GPL /var/www/html/HDP-GPL
	sudo ln -s $config_path/hdp/HDP-UTILS /var/www/html/HDP-UTILS
        sudo cp -f $BASEDIR/config/repo/*.repo /etc/yum.repos.d/
        sudo sed -i 's/windp-aio/'"${ambari_server_source}"'/g' /etc/yum.repos.d/*.repo
        sudo yum clean all
        sudo yum makecache
        sudo yum repolist
        echo "********** repo installation completed **********"
}

###########################
# 初始化db
###########################
config_db() {

       mysql -h${myurl} -u${myuser} -p${mypwd} &lt; $BASEDIR/config/init_db.sql 
       mysql -h${myurl} -u${myuser} -p${mypwd} ambari  &lt; $BASEDIR/config/Ambari-DDL-MySQL-CREATE.sql
}

###########################
# install ambari
###########################
install_ambari() {
       sudo yum install ambari-server -y
       sudo mkdir -p /usr/share/java/
       sudo cp -f $BASEDIR/config/mysql-connector-java.jar /usr/share/java/
       sudo cat $BASEDIR/config/ambari.properties &gt; /etc/ambari-server/conf/ambari.properties
       sudo sed -i 's/localhost/'"${ambari_server_source}"'/g' /etc/ambari-server/conf/ambari.properties
       sudo cp -f $BASEDIR/config/password.dat /etc/ambari-server/conf/
       ambari-server restart
       ambari-server status
}

######################################################
# 修改服务 ambari,在安装页面隐藏 无需安装的服务组件
######################################################
config_metainfo_modify(){
	       
	stack_path=/var/lib/ambari-server/resources/stacks/HDP
	cat $BASEDIR/config/repo/services/ACCUMULO/metainfo.xml    &gt;  $stack_path/3.0/services/ACCUMULO/metainfo.xml
	cat $BASEDIR/config/repo/services/KAFKA/metainfo.xml       &gt;  $stack_path/3.1/services/KAFKA/metainfo.xml
	cat $BASEDIR/config/repo/services/PIG/metainfo.xml         &gt;  $stack_path/3.1/services/PIG/metainfo.xml
	cat $BASEDIR/config/repo/services/DRUID/metainfo.xml       &gt;  $stack_path/3.0/services/DRUID/metainfo.xml
	cat $BASEDIR/config/repo/services/LOGSEARCH/metainfo.xml   &gt;  $stack_path/3.0/services/LOGSEARCH/metainfo.xml
	cat $BASEDIR/config/repo/services/SUPERSET/metainfo.xml    &gt;  $stack_path/3.0/services/SUPERSET/metainfo.xml
	cat $BASEDIR/config/repo/services/ATLAS/metainfo.xml       &gt;  $stack_path/3.1/services/ATLAS/metainfo.xml
	cat $BASEDIR/config/repo/services/ZEPPELIN/metainfo.xml    &gt;  $stack_path/3.0/services/ZEPPELIN/metainfo.xml      
	cat $BASEDIR/config/repo/services/STORM/metainfo.xml       &gt;  $stack_path/3.0/services/STORM/metainfo.xml
	cat $BASEDIR/config/repo/services/RANGER_KMS/metainfo.xml  &gt;  $stack_path/3.1/services/RANGER_KMS/metainfo.xml
	cat $BASEDIR/config/repo/services/OOZIE/metainfo.xml       &gt;  $stack_path/3.0/services/OOZIE/metainfo.xml
	cat $BASEDIR/config/repo/services/KNOX/metainfo.xml        &gt;  $stack_path/3.1/services/KNOX/metainfo.xml
	cat $BASEDIR/config/repo/services/SQOOP/metainfo.xml       &gt;  $stack_path/3.0/services/SQOOP/metainfo.xml
	cat $BASEDIR/config/repo/services/SMARTSENSE/metainfo.xml  &gt;  $stack_path/3.0/services/SMARTSENSE/metainfo.xml
        ambari-server restart
}
config_repo
config_db
install_ambari
config_metainfo_modify
</code></pre> 
<p><img alt="" height="567" src="https://images2.imgbox.com/68/2b/OOFdoV8H_o.png" width="946"></p> 
<p id="ub1a59b93"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c7047492b4e88344cc69f78fe3ed5f9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android：手把手带你入门跨平台UI开发框架Flutter，看完这篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ec28495f8789186b5ed00705bd9f8702/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ADB操作命令详解及用法大全：全面掌握Android设备管理利器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>