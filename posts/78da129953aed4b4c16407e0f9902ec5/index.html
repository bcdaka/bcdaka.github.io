<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenSSL学习笔记及在项目中的使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/78da129953aed4b4c16407e0f9902ec5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="OpenSSL学习笔记及在项目中的使用">
  <meta property="og:description" content="OpenSSL官方命令手册：OpenSSL commands - OpenSSL Documentation
参考教程：
操作：OpenSSL的基本使用教程(一）_openssl.exe使用教程-CSDN博客
操作：Linux和Shell回炉复习系列文章总目录 - 骏马金龙 - 博客园 (cnblogs.com)
网站应用：最新OpenSSL简明教程_openssl使用教程-CSDN博客
概念 公钥和私钥 公钥：可以公开分享，用于加密数据或验证数字签名。私钥：必须保密，用于解密数据或创建数字签名。关系：公钥和私钥是成对出现的，使用公钥加密的数据只能由对应的私钥解密，反之亦然。 一个完整的RSA私钥包含了以下几个关键参数：
模数（Modulus，N）公钥指数（Public Exponent，e）私钥指数（Private Exponent，d）素数p（Prime 1，p）素数q（Prime 2，q）指数dp（Exponent 1，dp）指数dq（Exponent 2，dq）系数（Coefficient，qinv） 数字签名 数字签名使用私钥创建，确保数据的完整性和来源的真实性。验证签名使用公钥，可以确认数据是否被篡改，并且确认数据确实来自特定的私钥持有者。 数字证书 数字证书由受信任的证书颁发机构（CA）签发，包含公钥及其所有者的身份信息。证书用于验证公钥的真实性，确保其属于声明中的持有者。 对称加密和非对称加密 对称加密：使用相同的密钥进行加密和解密，例如 AES、DES。非对称加密：使用一对公钥和私钥进行加密和解密，例如 RSA。对称加密速度快，适合大数据量；非对称加密安全性高，适合小数据量。 证书链 证书链由一系列证书组成，确保最终用户证书的可信性。包括根证书（CA）、中间证书和最终用户证书。验证证书链时，必须从根证书到最终用户证书逐级验证。 常见文件后缀 .key：通常用于表示私钥或公钥文件。这个后缀比较通用，可以表示任何类型的加密密钥。 private.key（私钥），public.key（公钥）。
.pub:通常用于表示公钥文件。这个后缀明确指示文件包含公钥。id_rsa.pub（RSA 公钥），id_ecdsa.pub（ECDSA 公钥）。
.pri：通常用于表示私钥文件。虽然不是标准后缀，但一些系统或工具可能使用这个后缀来标识私钥文件。 private.pri。
.pem： PEM（Privacy Enhanced Mail）格式文件的标准后缀，通常用于存储证书、私钥、公钥和证书链。文件内容通常以 Base64 编码并用 “-----BEGIN CERTIFICATE-----” 等标头和尾标记。cert.pem（证书），private.pem（私钥），public.pem（公钥）。
.crt：通常用于表示 X.509 证书文件。这个后缀通常用于证书文件，格式可以是 PEM 或 DER。server.crt（服务器证书），ca.crt（CA 证书）。
.csr：用于表示证书签名请求（Certificate Signing Request）文件。CSR 文件包含申请证书时的必要信息。request.csr。
.der：DER（Distinguished Encoding Rules）格式文件的标准后缀，通常用于存储二进制编码的证书或密钥。不同于 PEM 格式，DER 文件是二进制格式，没有 Base64 编码。cert.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-25T15:29:08+08:00">
    <meta property="article:modified_time" content="2024-07-25T15:29:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenSSL学习笔记及在项目中的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>OpenSSL官方命令手册：<a href="https://docs.openssl.org/master/man1/" rel="nofollow">OpenSSL commands - OpenSSL Documentation</a></p> 
<p>参考教程：</p> 
<p>操作：<a href="https://blog.csdn.net/fsq0827/article/details/99710052">OpenSSL的基本使用教程(一）_openssl.exe使用教程-CSDN博客</a></p> 
<p>操作：<a href="https://www.cnblogs.com/f-ck-need-u/p/7048359.html#auto_id_5" rel="nofollow">Linux和Shell回炉复习系列文章总目录 - 骏马金龙 - 博客园 (cnblogs.com)</a></p> 
<p>网站应用：<a href="https://blog.csdn.net/xxxlllbbb/article/details/107891790">最新OpenSSL简明教程_openssl使用教程-CSDN博客</a></p> 
<h3><a id="_10"></a>概念</h3> 
<h4><a id="_12"></a>公钥和私钥</h4> 
<ul><li><strong>公钥</strong>：可以公开分享，用于加密数据或验证数字签名。</li><li><strong>私钥</strong>：必须保密，用于解密数据或创建数字签名。</li><li>关系：公钥和私钥是成对出现的，使用公钥加密的数据只能由对应的私钥解密，反之亦然。</li></ul> 
<p>一个完整的RSA私钥包含了以下几个关键参数：</p> 
<ol><li>模数（Modulus，N）</li><li>公钥指数（Public Exponent，e）</li><li>私钥指数（Private Exponent，d）</li><li>素数p（Prime 1，p）</li><li>素数q（Prime 2，q）</li><li>指数dp（Exponent 1，dp）</li><li>指数dq（Exponent 2，dq）</li><li>系数（Coefficient，qinv）</li></ol> 
<h4><a id="_29"></a>数字签名</h4> 
<ul><li>数字签名使用私钥创建，确保数据的完整性和来源的真实性。</li><li>验证签名使用公钥，可以确认数据是否被篡改，并且确认数据确实来自特定的私钥持有者。</li></ul> 
<h4><a id="_34"></a>数字证书</h4> 
<ul><li>数字证书由受信任的证书颁发机构（CA）签发，包含公钥及其所有者的身份信息。</li><li>证书用于验证公钥的真实性，确保其属于声明中的持有者。</li></ul> 
<h4><a id="_39"></a>对称加密和非对称加密</h4> 
<ul><li><strong>对称加密</strong>：使用相同的密钥进行加密和解密，例如 AES、DES。</li><li><strong>非对称加密</strong>：使用一对公钥和私钥进行加密和解密，例如 RSA。</li><li>对称加密速度快，适合大数据量；非对称加密安全性高，适合小数据量。</li></ul> 
<h4><a id="_47"></a>证书链</h4> 
<ul><li>证书链由一系列证书组成，确保最终用户证书的可信性。</li><li>包括根证书（CA）、中间证书和最终用户证书。</li><li>验证证书链时，必须从根证书到最终用户证书逐级验证。</li></ul> 
<h4><a id="_53"></a>常见文件后缀</h4> 
<p><strong><code>.key</code></strong>：通常用于表示私钥或公钥文件。这个后缀比较通用，可以表示任何类型的加密密钥。 <code>private.key</code>（私钥），<code>public.key</code>（公钥）。</p> 
<p><strong><code>.pub</code></strong>:通常用于表示公钥文件。这个后缀明确指示文件包含公钥。<code>id_rsa.pub</code>（RSA 公钥），<code>id_ecdsa.pub</code>（ECDSA 公钥）。</p> 
<p><strong><code>.pri</code></strong>：通常用于表示私钥文件。虽然不是标准后缀，但一些系统或工具可能使用这个后缀来标识私钥文件。 <code>private.pri</code>。</p> 
<p><strong><code>.pem</code></strong>： PEM（Privacy Enhanced Mail）格式文件的标准后缀，通常用于存储证书、私钥、公钥和证书链。文件内容通常以 Base64 编码并用 “-----BEGIN CERTIFICATE-----” 等标头和尾标记。<code>cert.pem</code>（证书），<code>private.pem</code>（私钥），<code>public.pem</code>（公钥）。</p> 
<p><strong><code>.crt</code></strong>：通常用于表示 X.509 证书文件。这个后缀通常用于证书文件，格式可以是 PEM 或 DER。<code>server.crt</code>（服务器证书），<code>ca.crt</code>（CA 证书）。</p> 
<p><strong><code>.csr</code></strong>：用于表示证书签名请求（Certificate Signing Request）文件。CSR 文件包含申请证书时的必要信息。<code>request.csr</code>。</p> 
<p><strong><code>.der</code></strong>：DER（Distinguished Encoding Rules）格式文件的标准后缀，通常用于存储二进制编码的证书或密钥。不同于 PEM 格式，DER 文件是二进制格式，没有 Base64 编码。<code>cert.der</code>（证书），<code>private.der</code>（私钥）。</p> 
<h3><a id="_71"></a>操作</h3> 
<h4><a id="_OpenSSL__73"></a>（零）使用 OpenSSL 的流程</h4> 
<ol><li><strong>生成密钥对</strong>：使用 <code>openssl genpkey</code> 和 <code>openssl rsa</code> 生成私钥和公钥。</li><li><strong>创建 CSR</strong>：使用 <code>openssl req</code> 创建证书签名请求。</li><li><strong>获得数字证书</strong>：通过 CA 颁发或自签名生成证书。</li><li><strong>加密和签名</strong>：使用公钥加密数据，使用私钥签名数据。</li><li><strong>解密和验证签名</strong>：使用私钥解密数据，使用公钥验证签名。</li></ol> 
<h4><a id="OpenSSL_81"></a>（一）安装OpenSSL</h4> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openssl
openssl version
</code></pre> 
<h4><a id="_88"></a>（二）生成自签名证书</h4> 
<p>生成一张自签名证书，类似一张独一无二的会员卡。</p> 
<ol><li> <p><strong>生成私钥</strong> 私钥是证书的核心。首先生成一个2048位的RSA私钥：</p> <pre><code class="prism language-bash"><span class="token comment"># openssl genpkey: OpenSSL命令，用于生成私钥</span>
<span class="token comment"># algorithm RSA: 指定使用RSA算法生成私钥</span>
<span class="token comment"># out private.key: 输出文件名为private.key【可选，不写的话就是直接输出到终端】</span>
<span class="token comment"># pkeyopt rsa_keygen_bits:2048: 指定生成2048位的RSA密钥</span>
openssl genpkey <span class="token parameter variable">-algorithm</span> RSA <span class="token parameter variable">-out</span> private.key <span class="token parameter variable">-pkeyopt</span> rsa_keygen_bits:2048

<span class="token comment"># 直接使用genrsa命令，就不用指定算法</span>
openssl genrsa <span class="token parameter variable">-out</span> genrsa.txt <span class="token number">512</span>

<span class="token comment"># 这个时候屏幕会出现一堆+.符号，这只是用来表示计算进度的输出</span>
<span class="token comment"># 查看私钥内容，是Base64编码格式</span>
<span class="token function">cat</span> private.key

<span class="token comment"># 解析私钥，输出私钥的详细信息，包括私钥的模数（modulus）等</span>
openssl pkey <span class="token parameter variable">-in</span> private.key <span class="token parameter variable">-text</span> <span class="token parameter variable">-noout</span>

<span class="token comment"># check检查私钥文件是否被修改过，如果修改了会输出RSA key not ok</span>
openssl rsa <span class="token parameter variable">-in</span> private.key <span class="token parameter variable">-check</span>

<span class="token comment"># 输出私钥明文到文件夹中</span>
openssl rsa <span class="token parameter variable">-in</span> private.key <span class="token parameter variable">-text</span> <span class="token parameter variable">-out</span> private.txt
</code></pre> <p>加钥私密文件</p> <pre><code class="prism language-bash"><span class="token comment"># 加密私钥文件，加密的密码为123456</span>
openssl genrsa <span class="token parameter variable">-out</span> genrsa.txt <span class="token parameter variable">-des3</span> <span class="token parameter variable">-passout</span> pass:123456 <span class="token number">512</span>

<span class="token comment"># 密码错误，无法加密，必须一致才能加密</span>
openssl rsa <span class="token parameter variable">-in</span> genrsa.txt <span class="token parameter variable">-passin</span> pass:13456 <span class="token parameter variable">-check</span>
</code></pre> </li><li> <p><strong>生成证书签名请求（CSR）</strong> 使用私钥生成一个CSR文件，这是获得数字证书的关键步骤，<strong>CSR包含了申请者的身份信息和公钥</strong></p> <pre><code class="prism language-bash"><span class="token comment"># openssl req: OpenSSL命令，用于处理证书请求和生成CSR。</span>
<span class="token comment"># new: 生成新的CSR。</span>
<span class="token comment"># key private.key: 使用之前生成的私钥private.key。</span>
<span class="token comment"># out mycsr.csr: 输出文件名为mycsr.csr。</span>
openssl req <span class="token parameter variable">-new</span> <span class="token parameter variable">-key</span> private.key <span class="token parameter variable">-out</span> mycsr.csr

<span class="token comment"># 查看CSR内容，包含Subject（组织名称等）、Public Key（公钥）、Signature（用私钥对CSR进行的数字签名，确保CSR未被篡改）</span>
openssl req <span class="token parameter variable">-in</span> mycsr.csr <span class="token parameter variable">-noout</span> <span class="token parameter variable">-text</span>
</code></pre> <p>在这个过程中，会被提示输入一些信息，以下字段是必填的：</p> 
  <ol><li>Country Name (2 letter code):CN</li><li>State or Province Name (full name):Guangdong</li><li>Locality Name (eg, city):Guangzhou</li><li>Organization Name (eg, company):SCNU</li><li>Common Name (e.g. server FQDN or YOUR name):Xuan</li></ol> <p>而以下字段是可选的：</p> 
  <ol><li>Organizational Unit Name (eg, section)</li><li>Email Address</li><li>A challenge password</li><li>An optional company name</li></ol> </li></ol> 
<p><img src="https://images2.imgbox.com/1c/f3/fIFOW6B1_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li> <p><strong>生成自签名证书</strong> 使用CSR和私钥生成一个有效期为一年的自签名证书：</p> <pre><code class="prism language-bash"><span class="token comment"># penssl x509: OpenSSL命令，用于管理X.509证书。</span>
<span class="token comment"># req: 表示输入是一个证书请求（CSR）。</span>
<span class="token comment"># days 365: 证书的有效期为365天。</span>
<span class="token comment"># in mycsr.csr: 输入CSR文件mycsr.csr。</span>
<span class="token comment"># signkey private.key: 使用private.key私钥进行签名。</span>
openssl x509 <span class="token parameter variable">-req</span> <span class="token parameter variable">-days</span> <span class="token number">365</span> <span class="token parameter variable">-in</span> mycsr.csr <span class="token parameter variable">-signkey</span> private.key <span class="token parameter variable">-out</span> mycert.crt
</code></pre> </li></ol> 
<h4><a id="_171"></a>（三）基本使用</h4> 
<ol><li> <p><strong>查看证书信息</strong> 使用以下命令查看证书的详细信息：</p> <pre><code class="prism language-bash"><span class="token comment"># in mycert.crt: 输入证书文件mycert.crt。</span>
<span class="token comment"># text: 以文本格式显示证书内容。</span>
<span class="token comment"># noout: 不输出证书本身，只显示信息。</span>
<span class="token comment"># 数字证书包括版本号、序列号、签名算法、颁发者信息、有效期、持有者信息、公钥、证书扩展、签名等等</span>
openssl x509 <span class="token parameter variable">-in</span> mycert.crt <span class="token parameter variable">-text</span> <span class="token parameter variable">-noout</span>
</code></pre> </li><li> <p><strong>加密文件</strong> 使用公钥加密一个文件：</p> <pre><code class="prism language-bash"><span class="token comment"># 从证书中提取公钥</span>
openssl x509 <span class="token parameter variable">-pubkey</span> <span class="token parameter variable">-noout</span> <span class="token parameter variable">-in</span> mycert.crt <span class="token operator">&gt;</span> public.key

<span class="token comment"># 生成测试文本文件，输入sth</span>
<span class="token function">touch</span> plaintext.txt
/ <span class="token function">vim</span> plaintext.txt

<span class="token comment"># openssl rsautl: OpenSSL命令，用于使用RSA算法进行加密、解密操作。</span>
<span class="token comment"># encrypt: 进行加密操作。</span>
<span class="token comment"># inkey public.key: 使用public.key中的公钥。</span>
<span class="token comment"># pubin: 指定输入文件是公钥。</span>
<span class="token comment"># in plaintext.txt: 输入要加密的文件plaintext.txt。</span>
openssl pkeyutl <span class="token parameter variable">-encrypt</span> <span class="token parameter variable">-pubin</span> <span class="token parameter variable">-inkey</span> public.key <span class="token parameter variable">-in</span> plaintext.txt <span class="token parameter variable">-out</span> encrypted.dat
</code></pre> </li><li> <p><strong>解密文件</strong> 使用私钥解密文件：</p> <pre><code class="prism language-bash"><span class="token comment"># openssl pkeyutl: 用于使用RSA算法进行加密、解密操作。【注意3.0.x版本只能用pkeyutl不能用rsault】</span>
<span class="token comment"># decrypt: 进行解密操作。</span>
<span class="token comment"># inkey private.key: 使用私钥private.key进行解密。</span>
openssl pkeyutl <span class="token parameter variable">-decrypt</span> <span class="token parameter variable">-inkey</span> private.key <span class="token parameter variable">-in</span> encrypted.dat <span class="token parameter variable">-out</span> decrypted.txt

<span class="token comment"># 查看解密后内容，发现和</span>
<span class="token function">cat</span> decrypted.txt
</code></pre> </li></ol> 
<h4><a id="_213"></a>（四）其他使用</h4> 
<ol><li> <p><code>openssl speed</code>测试加密算法的性能</p> <pre><code class="prism language-bash">openssl speed <span class="token punctuation">[</span>md2<span class="token punctuation">]</span> <span class="token punctuation">[</span>mdc2<span class="token punctuation">]</span> <span class="token punctuation">[</span>md5<span class="token punctuation">]</span> <span class="token punctuation">[</span>hmac<span class="token punctuation">]</span> <span class="token punctuation">[</span>sha1<span class="token punctuation">]</span> <span class="token punctuation">[</span>rmd160<span class="token punctuation">]</span> <span class="token punctuation">[</span>idea-cbc<span class="token punctuation">]</span> <span class="token punctuation">[</span>rc2-cbc<span class="token punctuation">]</span> <span class="token punctuation">[</span>rc5-cbc<span class="token punctuation">]</span> <span class="token punctuation">[</span>bf-cbc<span class="token punctuation">]</span> <span class="token punctuation">[</span>des-cbc<span class="token punctuation">]</span> <span class="token punctuation">[</span>des-ede3<span class="token punctuation">]</span> <span class="token punctuation">[</span>rc4<span class="token punctuation">]</span> <span class="token punctuation">[</span>rsa512<span class="token punctuation">]</span> <span class="token punctuation">[</span>rsa1024<span class="token punctuation">]</span> <span class="token punctuation">[</span>rsa2048<span class="token punctuation">]</span> <span class="token punctuation">[</span>rsa4096<span class="token punctuation">]</span> <span class="token punctuation">[</span>dsa512<span class="token punctuation">]</span> <span class="token punctuation">[</span>dsa1024<span class="token punctuation">]</span> <span class="token punctuation">[</span>dsa2048<span class="token punctuation">]</span> <span class="token punctuation">[</span>idea<span class="token punctuation">]</span> <span class="token punctuation">[</span>rc2<span class="token punctuation">]</span> <span class="token punctuation">[</span>des<span class="token punctuation">]</span> <span class="token punctuation">[</span>rsa<span class="token punctuation">]</span> <span class="token punctuation">[</span>blowfish<span class="token punctuation">]</span>
</code></pre> </li><li> <p><code>openssl rand</code>生成伪随机数</p> <pre><code class="prism language-bash">openssl rand <span class="token punctuation">[</span>-out file<span class="token punctuation">]</span> <span class="token punctuation">[</span>-rand file<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-base64<span class="token punctuation">]</span> <span class="token punctuation">[</span>-hex<span class="token punctuation">]</span> num

<span class="token comment"># 选项说明：</span>
<span class="token comment"># -out：指定随机数输出文件，否则输出到标准输出。</span>
<span class="token comment"># -rand file：指定随机数种子文件。种子文件中的字符越随机，openssl rand生成随机数的速度越快，随机度越高。</span>
<span class="token comment"># -base64：指定生成的随机数的编码格式为base64。</span>
<span class="token comment"># -hex：指定生成的随机数的编码格式为hex。</span>
<span class="token comment"># - num：指定随机数的长度。</span>

openssl rand <span class="token parameter variable">-base64</span> <span class="token number">30</span><span class="token punctuation">;</span>
openssl rand <span class="token parameter variable">-hex</span> <span class="token number">30</span><span class="token punctuation">;</span>
openssl rand <span class="token number">30</span>
</code></pre> </li><li> <p><code>openssl passwd</code> 生成加密的密码</p> <pre><code class="prism language-bash">openssl <span class="token function">passwd</span> <span class="token punctuation">[</span>-crypt<span class="token punctuation">]</span> <span class="token punctuation">[</span>-1<span class="token punctuation">]</span> <span class="token punctuation">[</span>-apr1<span class="token punctuation">]</span> <span class="token punctuation">[</span>-salt string<span class="token punctuation">]</span> <span class="token punctuation">[</span>-in file<span class="token punctuation">]</span> <span class="token punctuation">[</span>-stdin<span class="token punctuation">]</span> <span class="token punctuation">[</span>-quiet<span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span>password<span class="token punctuation">}</span>

<span class="token comment"># 生成默认的密码哈希（使用 DES 加密）</span>
openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span> <span class="token string">"password"</span>
<span class="token comment"># 生成使用 SHA-256 的密码哈希</span>
openssl <span class="token function">passwd</span> <span class="token parameter variable">-6</span> <span class="token string">"password"</span>
<span class="token comment"># 生成盐（salt）并使用其生成密码哈希【盐相同，密码相同】</span>
openssl <span class="token function">passwd</span> <span class="token parameter variable">-salt</span> mysalt <span class="token parameter variable">-1</span> <span class="token string">"password"</span>
<span class="token comment"># 交互式输入密码</span>
openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span>
</code></pre> </li><li> <p><code>openssl dgst</code> 生成和验证数字签名</p> <pre><code class="prism language-bash">openssl dgst <span class="token punctuation">[</span>-md5<span class="token operator">|</span>-sha1<span class="token operator">|</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>-hex <span class="token operator">|</span> -binary<span class="token punctuation">]</span> <span class="token punctuation">[</span>-out filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-sign filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-passin arg<span class="token punctuation">]</span> <span class="token punctuation">[</span>-verify filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-prverify filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>-signature filename<span class="token punctuation">]</span> <span class="token punctuation">[</span>file<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token comment"># -sign filename:使用指定的私钥文件对哈希值进行签名</span>
<span class="token comment"># -verify filename:使用指定的公钥文件来验证签名</span>
<span class="token comment"># -prverify filename:同上，可以指定密钥文件的密码。</span>
<span class="token comment"># -signature filename:指定签名文件，以便与数据一起用于验证签名</span>

<span class="token comment"># 计算文件.txt 的 SHA-256 哈希并将结果写入 hash.txt 文件：</span>
dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-hex</span> <span class="token punctuation">(</span>-out hash.txt<span class="token punctuation">)</span> plaintext.txt 

<span class="token comment"># 使用私钥对plaintext.txt生成签名，并将签名保存到signature.sig 中【使用-sign签名时绝对不能加-hex，不然后面验签一定会失败】</span>
openssl dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-sign</span> private.key <span class="token parameter variable">-out</span> signature.sig plaintext.txt

<span class="token comment"># 使用公钥 public.key 验证签名 signature.sig，输出verified.ok即签名有效</span>
openssl dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-verify</span> public.key <span class="token parameter variable">-signature</span> signature.sig plaintext.txt 


<span class="token comment"># 使用密码保护的私钥</span>
openssl dgst <span class="token parameter variable">-sha256</span> <span class="token parameter variable">-sign</span> private.key <span class="token parameter variable">-passin</span> pass:yourpassword <span class="token parameter variable">-out</span> signature.sig example.txt

</code></pre> </li><li> <p><code>openssl rsautl和openssl pkeyutl</code>：文件的非对称加密</p> <p>rsautl是rsa的工具，相当于rsa、dgst的部分功能集合，可用于生成数字签名、验证数字签名、加密和解密文件。</p> <p>pkeyutl是非对称加密的通用工具，大体上和rsautl的用法差不多</p> <pre><code class="prism language-bash">
</code></pre> </li></ol> 
<p>…</p> 
<h3><a id="_289"></a>项目实践</h3> 
<h4><a id="SpringBoot_291"></a>（一）在SpringBoot中使用</h4> 
<ol><li>OpenSSL生成密钥和证书，配置HTTPS</li></ol> 
<pre><code class="prism language-yaml"><span class="token comment"># application.yml</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>keystore.p12
    <span class="token key atrule">key-store-password</span><span class="token punctuation">:</span> yourpassword
    <span class="token key atrule">key-store-type</span><span class="token punctuation">:</span> PKCS12
    <span class="token key atrule">key-alias</span><span class="token punctuation">:</span> youralias
</code></pre> 
<ol start="2"><li>在JWT中使用（JWT详细介绍可见：<a href="https://blog.csdn.net/Kixuan214/article/details/140690612?spm=1001.2014.3001.5502">浅析JWT原理及牛客出现过的相关面试题-CSDN博客</a>），在Spring Boot应用中使用JWT进行认证和授权时，可以使用生成的私钥和公钥进行签名和验证。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">Jwts</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>jsonwebtoken<span class="token punctuation">.</span></span><span class="token class-name">SignatureAlgorithm</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">KeyFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivateKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PublicKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">PKCS8EncodedKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">X509EncodedKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">"-----BEGIN PRIVATE KEY-----...-----END PRIVATE KEY-----"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_KEY</span> <span class="token operator">=</span> <span class="token string">"-----BEGIN PUBLIC KEY-----...-----END PUBLIC KEY-----"</span><span class="token punctuation">;</span>

    <span class="token comment">// 从PEM格式的字符串中解析并返回私钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">PrivateKey</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> privateKeyPEM <span class="token operator">=</span> <span class="token constant">PRIVATE_KEY</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----BEGIN PRIVATE KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                          <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----END PRIVATE KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                          <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\s"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>privateKeyPEM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从PEM格式的字符串中解析并返回公钥</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">PublicKey</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> publicKeyPEM <span class="token operator">=</span> <span class="token constant">PUBLIC_KEY</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----BEGIN PUBLIC KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----END PUBLIC KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\s"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>publicKeyPEM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 使用私钥生成JWT令牌</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">signWith</span><span class="token punctuation">(</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SignatureAlgorithm</span><span class="token punctuation">.</span><span class="token constant">RS256</span><span class="token punctuation">)</span>
                   <span class="token punctuation">.</span><span class="token function">compact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 使用公钥验证JWT令牌</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">validateToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parserBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_363"></a>（二）在区块链项目中使用</h4> 
<p>使用私钥对交易进行签名。使用Java的Bouncy Castle库进行签名</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bouncycastle<span class="token punctuation">.</span>jce<span class="token punctuation">.</span>provider<span class="token punctuation">.</span></span><span class="token class-name">BouncyCastleProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TransactionSigner</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Security</span><span class="token punctuation">.</span><span class="token function">addProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BouncyCastleProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 使用私钥对交易数据进行签名</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">signTransaction</span><span class="token punctuation">(</span><span class="token class-name">String</span> transactionData<span class="token punctuation">,</span> <span class="token class-name">PrivateKey</span> privateKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA256withRSA"</span><span class="token punctuation">,</span> <span class="token string">"BC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>transactionData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> signatureBytes <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>signatureBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 使用公钥验证交易数据的签名</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verifySignature</span><span class="token punctuation">(</span><span class="token class-name">String</span> transactionData<span class="token punctuation">,</span> <span class="token class-name">String</span> signatureStr<span class="token punctuation">,</span> <span class="token class-name">PublicKey</span> publicKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA256withRSA"</span><span class="token punctuation">,</span> <span class="token string">"BC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>transactionData<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> signatureBytes <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>signatureStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>signatureBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从PEM格式的字符串中解析并返回私钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PrivateKey</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> privateKeyPEM<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> privateKey <span class="token operator">=</span> privateKeyPEM<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----BEGIN PRIVATE KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                          <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----END PRIVATE KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                          <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\s"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 从PEM格式的字符串中解析并返回公钥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PublicKey</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> publicKeyPEM<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> publicKey <span class="token operator">=</span> publicKeyPEM<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----BEGIN PUBLIC KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-----END PUBLIC KEY-----"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"\\s"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"RSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> transactionData <span class="token operator">=</span> <span class="token string">"example transaction data"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> privateKeyPEM <span class="token operator">=</span> <span class="token string">"-----BEGIN PRIVATE KEY-----...-----END PRIVATE KEY-----"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> publicKeyPEM <span class="token operator">=</span> <span class="token string">"-----BEGIN PUBLIC KEY-----...-----END PUBLIC KEY-----"</span><span class="token punctuation">;</span>

        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span>privateKeyPEM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span>publicKeyPEM<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> signature <span class="token operator">=</span> <span class="token function">signTransaction</span><span class="token punctuation">(</span>transactionData<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isVerified <span class="token operator">=</span> <span class="token function">verifySignature</span><span class="token punctuation">(</span>transactionData<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Signature: "</span> <span class="token operator">+</span> signature<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Signature Verified: "</span> <span class="token operator">+</span> isVerified<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="TIPSBUGS_438"></a>TIPS/BUGS</h3> 
<h4><a id="openssl_versionversion_not_found_440"></a>验证openssl version时报错version not found</h4> 
<p>背景：在使用openssl version时出现<code>openssl: /lib/x86_64-linux-gnu/libcrypto.so.3: version OPENSSL_3.0.9' not found (required by openssl)</code></p> 
<p>原因：出现这个错误是因为系统中的OpenSSL版本与所需的库版本不匹配。具体来说，系统中的OpenSSL依赖于版本 <code>OPENSSL_3.0.9</code> 的库文件 <code>/lib/x86_64-linux-gnu/libcrypto.so.3</code>，但系统中可能没有这个版本的库文件，或者库文件版本不正确。</p> 
<p>解决办法：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 1. 更新</span>
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade openssl

<span class="token comment"># 2. 重装</span>
<span class="token function">sudo</span> <span class="token function">apt</span> remove <span class="token parameter variable">--purge</span> openssl
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openssl
</code></pre> 
<h4><a id="Could_not_read_public_key_from_mycertcrt_459"></a>加密时报错<code>Could not read public key from mycert.crt</code></h4> 
<p>意思是在证书中读取不到公钥，这种情况就把公钥提取出来，再用公钥文件加密即可</p> 
<pre><code class="prism language-bash"><span class="token comment"># 从证书中提取公钥</span>
openssl x509 <span class="token parameter variable">-pubkey</span> <span class="token parameter variable">-noout</span> <span class="token parameter variable">-in</span> mycert.crt <span class="token operator">&gt;</span> public.key

<span class="token comment"># 加密</span>
openssl pkeyutl <span class="token parameter variable">-encrypt</span> <span class="token parameter variable">-pubin</span> <span class="token parameter variable">-inkey</span> public.key <span class="token parameter variable">-in</span> plaintext.txt <span class="token parameter variable">-out</span> encrypted.dat
</code></pre> 
<h4><a id="openssl_genrsa_openssl_genpkey_algorithm_rsa_473"></a><code>openssl genrsa</code> 和<code>openssl genpkey -algorithm rsa</code>有什么区别?</h4> 
<p>openssl pkey 更通用，可以处理多种私钥<br> openssl rsa 专门处理RSA密钥</p> 
<p><a href="https://docs.openssl.org/master/man1/openssl-genpkey/#notes" rel="nofollow">openssl-genpkey - OpenSSL Documentation</a>明确指出应使用<code>genpkey</code>，而不是特定于算法的 <code>genrsa</code>：</p> 
<blockquote> 
 <p>The use of the genpkey program is encouraged over the algorithm specific utilities because additional algorithm options and ENGINE provided algorithms can be used.</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd1ac996c6a7d4256047c806acbc9c93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">土耳其云手机提升TikTok电商效率</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3400890504e03df61a2a56c9efe7b2e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;练级之路】【Lv.17】【STL】set类和map类的模拟实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>