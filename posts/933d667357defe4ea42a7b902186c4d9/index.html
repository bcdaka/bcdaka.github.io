<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】5.类和对象（3） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/933d667357defe4ea42a7b902186c4d9/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】5.类和对象（3）">
  <meta property="og:description" content="文章目录 3.析构函数析构函数的特点： 4.拷贝构造函数拷贝构造的特点： 3.析构函数 析构函数与构造函数功能相反，析构函数不是完成对对象本身的销毁，比如局部对象是存在栈帧的，函数结束栈帧销毁，他就释放了，不需要我们管，C&#43;&#43;规定对象在销毁时会自动调用析构函数，完成对象中资源的清理释放工作。析构函数的功能类比我们之前Stack实现的Destroy功能，而像Date没有Destroy，其实就是没有资源需要释放，所以严格说Date是不需要析构函数的。
析构函数的特点： 析构函数名是在类名前加上字符 ~。无参数无返回值。 (这里跟构造类似，也不需要加void)一个类只能有一个析构函数。若未显式定义，系统会自动生成默认的析构函数。对象生命周期结束时，系统会自动调用析构函数。跟构造函数类似，我们不写编译器自动生成的析构函数对内置类型成员不做处理，自定类型成员会调用他的析构函数。还需要注意的是我们显示写析构函数，对于自定义类型成员也会调用他的析构，也就是说自定义类型成员无论什么情况都会自动调用析构函数。如果类中没有申请资源时，析构函数可以不写，直接使用编译器生成的默认析构函数，如Date；如果默认生成的析构就可以用，也就不需要显示写析构，如MyQueue；但是有资源申请时，一定要自己写析构，否则会造成资源泄漏，如Stack。一个局部域的多个对象，C&#43;&#43;规定后定义的先析构。 #include&lt;iostream&gt; using namespace std; typedef int STDataType; class Stack { public: Stack(int n = 4) { _a = (STDataType*)malloc(sizeof(STDataType) * n); if (nullptr == _a) { perror(&#34;malloc申请空间失败&#34;); return; } _capacity = n; _top = 0; } ~Stack() { cout &lt;&lt; &#34;~Stack()&#34; &lt;&lt; endl; free(_a); _a = nullptr; _top = _capacity = 0; } private: STDataType* _a; size_t _capacity; size_t _top; }; // 两个Stack实现队列 class MyQueue { public: //编译器默认生成MyQueue的析构函数调用了Stack的析构，释放的Stack内部的资源 // 显示写析构，也会自动调用Stack的析构 /*~MyQueue() {}*/ private: Stack pushst; Stack popst; }; int main() { Stack st; MyQueue mq; return 0; } 对比一下用C&#43;&#43;和C实现的Stack解决之前括号匹配问题isValid，我们发现有了构造函数和析构函数确实方便了很多，不会再忘记调用Init和Destory函数了，也方便了不少。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-10T18:40:19+08:00">
    <meta property="article:modified_time" content="2024-08-10T18:40:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】5.类和对象（3）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#3_4" rel="nofollow">3.析构函数</a></li><li><ul><li><a href="#_8" rel="nofollow">析构函数的特点：</a></li></ul> 
  </li><li><a href="#4_247" rel="nofollow">4.拷贝构造函数</a></li><li><ul><li><a href="#_251" rel="nofollow">拷贝构造的特点：</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="3_4"></a>3.析构函数</h2> 
<p>析构函数与构造函数功能相反，析构函数不是完成对对象本身的销毁，比如局部对象是存在栈帧的，函数结束栈帧销毁，他就释放了，不需要我们管，<code>C++</code>规定对象在销毁时会自动调用析构函数，完成对象中资源的清理释放工作。析构函数的功能类比我们之前<code>Stack</code>实现的<code>Destroy</code>功能，而像<code>Date</code>没有<code>Destroy</code>，其实就是没有资源需要释放，所以严格说<code>Date</code>是不需要析构函数的。</p> 
<h3><a id="_8"></a>析构函数的特点：</h3> 
<blockquote> 
 <ol><li>析构函数名是在类名前加上字符 <code>~</code>。</li><li>无参数无返回值。 (这里跟构造类似，也不需要加<code>void</code>)</li><li>一个类只能有一个析构函数。若未显式定义，系统会自动生成默认的析构函数。</li><li>对象生命周期结束时，系统会自动调用析构函数。</li><li>跟构造函数类似，我们不写编译器自动生成的析构函数对内置类型成员不做处理，自定类型成员会调用他的析构函数。</li><li>还需要注意的是我们显示写析构函数，对于自定义类型成员也会调用他的析构，也就是说自定义类型成员无论什么情况都会自动调用析构函数。</li><li>如果类中没有申请资源时，析构函数可以不写，直接使用编译器生成的默认析构函数，如<code>Date</code>；如果默认生成的析构就可以用，也就不需要显示写析构，如<code>MyQueue</code>；但是有资源申请时，一定要自己写析构，否则会造成资源泄漏，如<code>Stack</code>。</li><li>一个局部域的多个对象，<code>C++</code>规定后定义的先析构。</li></ol> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">int</span> STDataType<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Stack</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Stack</span><span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        _a <span class="token operator">=</span> <span class="token punctuation">(</span>STDataType<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>STDataType<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _a<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc申请空间失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        _capacity <span class="token operator">=</span> n<span class="token punctuation">;</span>
        _top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Stack()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _a <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
        _top <span class="token operator">=</span> _capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
    STDataType<span class="token operator">*</span> _a<span class="token punctuation">;</span>
    size_t _capacity<span class="token punctuation">;</span>
    size_t _top<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 两个Stack实现队列</span>
<span class="token keyword">class</span> <span class="token class-name">MyQueue</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">//编译器默认生成MyQueue的析构函数调用了Stack的析构，释放的Stack内部的资源</span>
    <span class="token comment">// 显示写析构，也会自动调用Stack的析构</span>
    <span class="token comment">/*~MyQueue()
     {}*/</span>
    <span class="token keyword">private</span><span class="token operator">:</span>
    Stack pushst<span class="token punctuation">;</span>
    Stack popst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Stack st<span class="token punctuation">;</span>
    MyQueue mq<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对比一下用<code>C++</code>和<code>C</code>实现的<code>Stack</code>解决之前括号匹配问题<code>isValid</code>，我们发现有了构造函数和析构函数确实方便了很多，不会再忘记调用<code>Init</code>和<code>Destory</code>函数了，也方便了不少。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token comment">// 用最新加了构造和析构的C++版本Stack实现</span>
<span class="token keyword">bool</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Stack st<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'['</span> <span class="token operator">||</span> <span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'('</span> <span class="token operator">||</span> <span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'{'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            st<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 右括号比左括号多，数量匹配问题</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 栈里面取左括号</span>
            <span class="token keyword">char</span> top <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">Top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            st<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 顺序不匹配</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">']'</span> <span class="token operator">&amp;&amp;</span> top <span class="token operator">!=</span> <span class="token char">'['</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'}'</span> <span class="token operator">&amp;&amp;</span> top <span class="token operator">!=</span> <span class="token char">'{'</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">')'</span> <span class="token operator">&amp;&amp;</span> top <span class="token operator">!=</span> <span class="token char">'('</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token operator">++</span>s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 栈为空，返回真，说明数量都匹配 左括号多，右括号少匹配问题</span>
    <span class="token keyword">return</span> st<span class="token punctuation">.</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 用之前C版本Stack实现</span>
<span class="token keyword">bool</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ST st<span class="token punctuation">;</span>
    <span class="token function">STInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 左括号入栈</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'('</span> <span class="token operator">||</span> <span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'['</span> <span class="token operator">||</span> <span class="token operator">*</span>s <span class="token operator">==</span> <span class="token char">'{'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">STPush</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">,</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment">// 右括号取栈顶左括号尝试匹配</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">STEmpty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">STDestroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">char</span> top <span class="token operator">=</span> <span class="token function">STTop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">STPop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 不匹配</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token char">'('</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">')'</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token char">'{'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">'}'</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token char">'['</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">STDestroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token operator">++</span>s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 栈不为空，说明左括号比右括号多，数量不匹配</span>
    <span class="token keyword">bool</span> ret <span class="token operator">=</span> <span class="token function">STEmpty</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">STDestroy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>st<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token string">"[()][]"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token string">"[(])[]"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">/*
关于编译器自动生成的析构函数，是否会完成一些事情呢？下面的程序我们会看到，编译器
生成的默认析构函数，对自定类型成员调用它的析构函数。
*/</span>
<span class="token keyword">class</span> <span class="token class-name">Time</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token operator">~</span><span class="token function">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Time()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token keyword">int</span> _hour<span class="token punctuation">;</span>
    <span class="token keyword">int</span> _minute<span class="token punctuation">;</span>
    <span class="token keyword">int</span> _second<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">// 基本类型(内置类型)</span>
    <span class="token keyword">int</span> _year <span class="token operator">=</span> <span class="token number">1970</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> _month <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> _day <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 自定义类型</span>
    Time _t<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Date d<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 程序运行结束后输出：~Time()
 在main方法中根本没有直接创建Time类的对象，为什么最后会调用Time类的析构函数？
 因为：main方法中创建了Date对象d，而d中包含4个成员变量，其中_year, _month, _day三个是
 内置类型成员，销毁时不需要资源清理，最后系统直接将其内存回收即可；
 而_t是Time类对象，所以在d销毁时，要将其内部包含的Time类的_t对象销毁，所以要调用Time类的析构函数。
 但是：main函数中不能直接调用Time类的析构函数，实际要释放的是Date类对象，所以编译器会调用Date类的析构函
 数，而Date没有显式提供，则编译器会给Date类生成一个默认的析构函数，目的是在其内部调用Time
 类的析构函数，即当Date对象销毁时，要保证其内部每个自定义对象都可以正确销毁
 main函数中并没有直接调用Time类析构函数，而是显式调用编译器为Date类生成的默认析构函数
 注意：创建哪个类的对象则调用该类的析构函数，销毁那个类的对象则调用该类的析构函数
*/</span>

<span class="token comment">/*
如果类中没有申请资源时，析构函数可以不写，直接使用编译器生成的默认析构函数，比如Date类；
有资源申请时，一定要写，否则会造成资源泄漏，比如Stack类。
*/</span>
</code></pre> 
<blockquote> 
 <p><font color="red">注意：</font></p> 
 <ol><li> <p>一般情况下，有动态申请的资源，就需要显示所写的析构函数，来释放资源。</p> <p>例如：栈需要写析构</p> </li><li> <p>没有动态申请的资源，不需要写析构函数。因为没有资源需要释放。</p> <p>例如：</p> <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Data</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _arr<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>需要释放资源的成员都是自定义类型，不需要写析构函数。</p> <p>例如：</p> <pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">MyQue</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Stack _pushst<span class="token punctuation">;</span>
	Stack _popst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
 <p>因为默认生成的构造会自动调用默认构造函数</p> 
 <p>默认生成的析构会自动调用默认析构函数</p> 
</blockquote> 
<hr> 
<h2><a id="4_247"></a>4.拷贝构造函数</h2> 
<p>如果一个构造函数的第一个参数是自身类类型的引用，且任何额外的参数都有默认值，则此构造函数也叫做拷贝构造函数，也就是说拷贝构造是一个特殊的构造函数。</p> 
<h3><a id="_251"></a>拷贝构造的特点：</h3> 
<blockquote> 
 <ol><li>拷贝构造函数是构造函数的一个重载。</li><li>拷贝构造函数的第一个参数必须是类类型对象的引用，使用传值方式编译器直接报错，因为语法逻辑上会引发无穷递归调用。 拷贝构造函数也可以多个参数，但是第一个参数必须是类类型对象的引用，后面的参数必须有缺省值。</li><li><code>C++</code>规定自定义类型对象进行拷贝行为必须调用拷贝构造，所以这里自定义类型传值传参和传值返回都会调用拷贝构造完成。</li><li>若未显式定义拷贝构造，编译器会生成自动生成拷贝构造函数。自动生成的拷贝构造对内置类型成员变量会完成值拷贝/浅拷贝(一个字节一个字节的拷贝)，对自定义类型成员变量会调用他的拷贝构造。</li><li>像<code>Date</code>这样的类成员变量全是内置类型且没有指向什么资源，编译器自动生成的拷贝构造就可以完成需要的拷贝，所以不需要我们显示实现拷贝构造。像<code>Stack</code>这样的类，虽然也都是内置类型，但是<code>_a</code>指向了资源，编译器自动生成的拷贝构造完成的值拷贝/浅拷贝不符合我们的需求，所以需要我们自己实现深拷贝(对指向的资源也进行拷贝)。像<code>MyQueue</code>这样的类型内部主要是自定义类型<code>Stack</code>成员，编译器自动生成的拷贝构造会调用<code>Stack</code>的拷贝构造，也不需要我们显示实现<code>MyQueue</code>的拷贝构造。这里还有一个小技巧，如果一个类显示实现了析构并释放资源，那么他就需要显示写拷贝构造，否则就不需要。</li><li>传值返回会产生一个临时对象调用拷贝构造，传值引用返回，返回的是返回对象的别名(引用)，没有产生拷贝。但是如果返回对象是一个当前函数局部域的局部对象，函数结束就销毁了，那么使用引用返回是有问题的，这时的引用相当于一个野引用，类似一个野指针一样。传引用返回可以减少拷贝，但是一定要确保返回对象，在当前函数结束后还在，才能用引用返回。</li></ol> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">1900</span><span class="token punctuation">,</span> <span class="token keyword">int</span> month <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> day <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// d2(d1)</span>
	<span class="token comment">//Date(Date&amp; d);// 正确写法</span>
	
    <span class="token comment">//拷贝构造函数</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">const</span> Date<span class="token operator">&amp;</span> d<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Date(Date&amp; d)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token comment">//注意：_year = d._year;这个里面的_year不是private:里面的int _year;</span>
		<span class="token comment">//_year = d._year;这个左边的_year是d2的_year，也就是this-&gt;_year，因为this指针是d2，也就是d2传给了this</span>
		<span class="token comment">//右边的d._year是d，也就是d1的_year</span>
		_year <span class="token operator">=</span> d<span class="token punctuation">.</span>_year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> d<span class="token punctuation">.</span>_month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> d<span class="token punctuation">.</span>_day<span class="token punctuation">;</span>
		<span class="token comment">/*d._year = _year;
		d._month = _month;
		d._day = _day;*/</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyQueue</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">/*Stack _pushst;
	Stack _popst;*/</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span>Date d<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 可以不写，默认生成的拷贝构造就可以用</span>
	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Date <span class="token function">d2</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Data(Data&amp; d)里面的d是d1的别名</span>
	<span class="token comment">//this指针是d2，也就是d2传给了this</span>

	<span class="token comment">//内置类型直接拷贝，void func(int i);</span>
	<span class="token comment">//直接把4个字节的10拷贝给i</span>
	<span class="token function">func</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//自定义类型的拷贝，规定了要定义拷贝构造去拷贝</span>
	<span class="token comment">//void func(Date d){}会先调用Date(const Date&amp; d);然后进入void func(Date d) </span>
	<span class="token comment">//如果Date(const Date&amp; d);改成了Date(Date d);那么就会出现无限递归，编译器会报错</span>
	<span class="token function">func</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	

	<span class="token comment">// 必须自己实现，实现深拷贝</span>
	<span class="token comment">/*Stack st1;
	Stack st2(st1);*/</span>


	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font color="red">警惕无穷递归！</font></p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">1900</span><span class="token punctuation">,</span> <span class="token keyword">int</span> month <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> day <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">const</span> Date<span class="token operator">&amp;</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 正确写法</span>

	<span class="token comment">//Date(const Date&amp; d)   // 错误写法：编译报错，会引发无穷递归</span>
	<span class="token comment">//{<!-- --></span>
	<span class="token comment">//	_year = d._year;</span>
	<span class="token comment">//	_month = d._month;</span>
	<span class="token comment">//	_day = d._day;</span>
	<span class="token comment">//}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Date d1<span class="token punctuation">;</span>
	Date <span class="token function">d2</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>1)：内置类型成员完成值拷贝/浅拷贝</p> 
 <p>2)：自定义类型成员会调用它的拷贝构造</p> 
</blockquote> 
<blockquote> 
 <p><font color="red">自定义类型指向浅拷贝会出现两个问题：</font></p> 
 <ol><li> <p>析构两次，报错</p> </li><li> <p>一个函数修改会影响另一个函数</p> </li></ol> 
</blockquote> 
<hr> 
<blockquote> 
 <ol><li> <p><code>Data</code>和<code>MyQueue</code>都不需要写。因为<code>MyQueue</code>里面会调用<code>Stack</code>，而<code>Stack</code>需要自己实现。<code>Stack</code>的实现和<code>MyQueue</code>无关。</p> </li><li> <p><code>Stack</code>需要自己实现</p> </li></ol> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Stack</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Stack</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Stack()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		_a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _a<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc申请空间失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		_capacity <span class="token operator">=</span> capacity<span class="token punctuation">;</span>		
		_top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// st2(st1)</span>
	<span class="token function">Stack</span><span class="token punctuation">(</span><span class="token keyword">const</span> Stack<span class="token operator">&amp;</span> st<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> st<span class="token punctuation">.</span>_capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _a<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc申请空间失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">memcpy</span><span class="token punctuation">(</span>_a<span class="token punctuation">,</span> st<span class="token punctuation">.</span>_a<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> st<span class="token punctuation">.</span>_top<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_top <span class="token operator">=</span> st<span class="token punctuation">.</span>_top<span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> st<span class="token punctuation">.</span>_capacity<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Stack()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">free</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_a <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> _top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span><span class="token operator">*</span> _a <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> _capacity<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">1900</span><span class="token punctuation">,</span> <span class="token keyword">int</span> month <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> day <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyQueue</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Stack _pushst<span class="token punctuation">;</span>
	Stack _popst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1):内置类型成员完成值拷贝/浅拷贝</span>
	<span class="token comment">// 可以不写，默认生成的拷贝构造就可以用</span>
	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date <span class="token function">d2</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Data(Data&amp; d)里面的d是d1的别名</span>
	<span class="token comment">//this指针是d2，也就是d2传给了this</span>

	<span class="token comment">//2);自定义类型成员会调用它的拷贝构造</span>
	<span class="token comment">//如果只传值，那么就会导致两个函数指向了同一个空间，析构函数调用的话就崩了</span>
	<span class="token comment">// 而且就算不析构函数也会出问题。比如给其中一个函数赋值会影响另一个函数</span>
	
	<span class="token comment">// 所以必须调用拷贝构造函数</span>
	<span class="token comment">// 必须自己实现拷贝构造函数，实现深拷贝</span>
	<span class="token comment">//栈后进先出，后创建的先析构，st2先析构，st1后析构</span>
	<span class="token comment">//添加Stack(const Stack&amp; st);前，会报错，因为st1和st2的析构函数指向了同一个空间，而一个空间无法释放两次</span>
	<span class="token comment">//添加Stack(const Stack&amp; st);后，不报错了</span>
	<span class="token comment">//Stack(const Stack&amp; st);就是我们自己实现的深拷贝</span>
	Stack st1<span class="token punctuation">;</span>
	Stack <span class="token function">st2</span><span class="token punctuation">(</span>st1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><font color="red">注意：</font></p> 
 <p>在编译器生成的默认拷贝构造函数中，内置类型是按照字节方式直接拷贝的，而自定义类型是调用其拷贝构造函数完成拷贝的。</p> 
</blockquote> 
<hr> 
<p><font color="cornflowerblue">为了提高程序效率，一般对象传参时，尽量使用引用类型，返回时根据实际场景，能用引用尽量使用引用。</font></p> 
<pre><code class="prism language-cpp"><span class="token comment">//这个采用引用返回是可以的，因为采用引用返回可以减少拷贝，而且函数结束后返回的值是没被销毁的</span>
Stack<span class="token operator">&amp;</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> Stack st<span class="token punctuation">;</span>
    <span class="token keyword">return</span> st<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//这个采用引用返回是不可以的，因为函数结束后返回的值是被销毁了</span>
Stack<span class="token operator">&amp;</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    Stack st<span class="token punctuation">;</span>
    <span class="token keyword">return</span> st<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><font color="cornflowerblue">传引用返回要谨慎，传值引用没事</font></p> 
<pre><code class="prism language-cpp">Stack<span class="token operator">&amp;</span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">static</span> Stack st<span class="token punctuation">;</span><span class="token comment">//改成Stack st;就不行，因为Stack st;在Func()结束后就销毁了，就会导致拷贝构造传值错误</span>
	st<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	st<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	st<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//...</span>

	<span class="token keyword">return</span> st<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Stack ret <span class="token operator">=</span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> ret<span class="token punctuation">.</span><span class="token function">Top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Date</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Date</span><span class="token punctuation">(</span><span class="token keyword">int</span> year <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> month <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> day <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_year <span class="token operator">=</span> year<span class="token punctuation">;</span>
		_month <span class="token operator">=</span> month<span class="token punctuation">;</span>
		_day <span class="token operator">=</span> day<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Date d2(d1);</span>
	<span class="token comment">//是拷贝构造</span>
	<span class="token comment">/*Date(const Date&amp; d)
	{
		_year = d._year;
		_month = d._month;
		_day = d._day;
	}*/</span>

	<span class="token comment">// 不是拷贝构造，就是一个普通构造</span>
	<span class="token comment">//Date(Date* p)</span>
	<span class="token comment">//{<!-- --></span>
	<span class="token comment">//	_year = p-&gt;_year;</span>
	<span class="token comment">//	_month = p-&gt;_month;</span>
	<span class="token comment">//	_day = p-&gt;_day;</span>
	<span class="token comment">//}</span>

	<span class="token comment">//析构函数</span>
	<span class="token operator">~</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Date()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _year<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _month<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _day<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">int</span> STDataType<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Stack</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Stack</span><span class="token punctuation">(</span><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_a <span class="token operator">=</span> <span class="token punctuation">(</span>STDataType<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>STDataType<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _a<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc申请空间失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_capacity <span class="token operator">=</span> n<span class="token punctuation">;</span>
		_top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Push</span><span class="token punctuation">(</span>STDataType x<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_top <span class="token operator">==</span> _capacity<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> newcapacity <span class="token operator">=</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
			STDataType<span class="token operator">*</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span>STDataType<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">realloc</span><span class="token punctuation">(</span>_a<span class="token punctuation">,</span> newcapacity <span class="token operator">*</span>
				<span class="token keyword">sizeof</span><span class="token punctuation">(</span>STDataType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>tmp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"realloc fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			_a <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
			_capacity <span class="token operator">=</span> newcapacity<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_a<span class="token punctuation">[</span>_top<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	STDataType <span class="token function">Top</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">assert</span><span class="token punctuation">(</span>_top <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> _a<span class="token punctuation">[</span>_top <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// st2(st1)</span>
	<span class="token function">Stack</span><span class="token punctuation">(</span><span class="token keyword">const</span> Stack<span class="token operator">&amp;</span> st<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_a <span class="token operator">=</span> <span class="token punctuation">(</span>STDataType<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>STDataType<span class="token punctuation">)</span> <span class="token operator">*</span> st<span class="token punctuation">.</span>_capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _a<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"malloc申请空间失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">memcpy</span><span class="token punctuation">(</span>_a<span class="token punctuation">,</span> st<span class="token punctuation">.</span>_a<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>STDataType<span class="token punctuation">)</span> <span class="token operator">*</span> st<span class="token punctuation">.</span>_top<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_top <span class="token operator">=</span> st<span class="token punctuation">.</span>_top<span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> st<span class="token punctuation">.</span>_capacity<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Stack()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token function">free</span><span class="token punctuation">(</span>_a<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_a <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		_top <span class="token operator">=</span> _capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	STDataType<span class="token operator">*</span> _a<span class="token punctuation">;</span>
	size_t _capacity<span class="token punctuation">;</span>
	size_t _top<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyQueue</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Stack pushst<span class="token punctuation">;</span>
	Stack popst<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">Func</span><span class="token punctuation">(</span>Stack st<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Func</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

Date <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Date ret<span class="token punctuation">;</span>
	<span class="token comment">//...</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Date <span class="token function">d1</span><span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//都是拷贝构造</span>
	<span class="token comment">//自动生成的拷贝构造对内置类型成员变量会完成值拷贝 / 浅拷贝(一个字节一个字节的拷贝)</span>
	Date <span class="token function">d2</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date d4 <span class="token operator">=</span> d1<span class="token punctuation">;</span>

	Date <span class="token function">d5</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Date d6 <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Satck不可以浅拷贝，因为Stack这里_a是一个指针，直接浅拷贝会导致两个指针指向同一块空间，析构就会崩溃</span>
	Stack <span class="token function">st1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Stack <span class="token function">st2</span><span class="token punctuation">(</span>st1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Func</span><span class="token punctuation">(</span>st1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Func</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	MyQueue m1<span class="token punctuation">;</span>
	MyQueue <span class="token function">m2</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<blockquote> 
 <p>这里就不调用拷贝构造了，因为这里是引用返回，不是传值返回</p> 
 <p><font color="cornflowerblue">传值返回，返回的是值的拷贝，所以要调用拷贝构造</font></p> 
 <p><font color="cornflowerblue">引用返回，返回的不是值的拷贝，返回的是它的别名，所以不调用拷贝构造</font></p> 
 <pre><code class="prism language-cpp">Date<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Date<span class="token operator">&amp;</span> d<span class="token punctuation">)</span><span class="token comment">//返回的是*this这个对象的别名，*this是d4</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token comment">//以预防d1 = d1;的情况</span>
    <span class="token punctuation">{<!-- --></span>
        _year <span class="token operator">=</span> d<span class="token punctuation">.</span>_year<span class="token punctuation">;</span>
        _month <span class="token operator">=</span> d<span class="token punctuation">.</span>_month<span class="token punctuation">;</span>
        _day <span class="token operator">=</span> d<span class="token punctuation">.</span>_day<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df48e663ee2fa7c721c1af51b3313d2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【数据结构初阶】队列</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f085b4b5d4e9351c1fdc6a5de372c92c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue 2 TodoList 案例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>