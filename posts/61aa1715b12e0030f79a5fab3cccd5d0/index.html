<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【腾讯云 TDSQL-C Serverless 产品体验】TDSQL-C MySQL Serverless实践之路 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/61aa1715b12e0030f79a5fab3cccd5d0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【腾讯云 TDSQL-C Serverless 产品体验】TDSQL-C MySQL Serverless实践之路">
  <meta property="og:description" content="【腾讯云 TDSQL-C Serverless 产品体验】TDSQL-C MySQL Serverless实践之路
腾讯云TDSQL-C联合CSDN推出了一款云数据库产品测评活动，让我们一起来体验一下。
一、什么是云数据库？ 云数据库是指被优化或部署到一个虚拟计算环境中的数据库，可以实现按需付费、按需扩展、高可用性以及存储整合等优势。
云数据库的特性有：实例创建快速、支持只读实例、读写分离、故障自动切换、数据备份、Binlog备份、SQL审计、访问白名单、监控与消息通知等。
1. 优势： 可以使用户按照存储容量和带宽的需求付费可以将数据库从一个地方移到另一个地方（云的可移植性）可实现按需扩展高可用性（HA） 1.1 轻松部署： 用户能够在控制台轻松的完成数据库申请和创建，数据库实例在几分钟内就可以准备就绪并投入使用。
1.2 高可靠： 云数据库具有故障自动单点切换、数据库自动备份等功能，保证实例高可用和数据安全。
1.3 低成本： 数据库支付的费用远低于自建数据库所需的成本，用户可以根据自己的需求选择不同套餐，使用很低的价格得到一整套专业的数据库支持服务。
云数据库发展经历了三个时代：
1.0时代是以云托管数据库为主2.0时代是容器架构的云原生数据库时代3.0时代，云Serverless数据库将成为主流趋势。 腾讯云数据库TDSQL-C Serverless新版发布，标志着云原生数据库Serverless化正式步入全面推进阶段。
二、TDSQL-C MySQL云数据库： TDSQL是腾讯云自研企业级分布式数据库，旗下涵盖金融级分布式、云原生、分析型等多引擎融合的完整数据库产品体系，提供业界领先的金融级高可用、计算存储分离、数据仓库、企业级安全等能力，同时具备智能运维平台、Serverless版本等完善的产品服务体系。
TDSQL，100%兼容MySQL和PostgreSQL，包含三大产品系列，分别为分析型数据库TDSQL-A（Tencent Analytical Database）、云原生数据库TDSQL-C （Tencent CloudNative Database）和分布式数据库TDSQL（Tencent DistributedDatabase），全方位满足各行各业的业务需求。
云原生数据库TDSQL-C MySQL，采用计算和存储分离（日志即数据库）的 Shared Storage 架构，融合了传统数据库、云计算与新硬件技术的优势，100%兼容 MySQL 等开源数据库，实现了超百万级 QPS 的吞吐，超百 TB 的海量分布式智能存储，能够很好地支撑大数据量的归档存储和高效查询性能。
三、TDSQL-C MySQL Serverless版本： Serverless 服务是腾讯云自研的新一代云原生关系型数据库 TDSQL-C MySQL 版的无服务器架构版，是全 Serverless 架构的云原生数据库。Serverless 服务支持按实际计算和存储资源使用量收取费用，不用不付费。
1. Serverless 服务架构： 按需启动，不需要时可关闭。自动扩展/收缩。缩放对应用程序无影响。 四、购买并开通TDSQL-C MySQL Serverless： 如下我们在选择数据库实例时，可以看到预置资源的MySQL，一年的费用是3250.94，就是说你哪怕是数据库没有使用，只要买了，就要付这么多的钱。那想像一下，我们在学校开发系统，只有白天才会使用，到了晚上的话、周未时间段，基本上没有使用的，这样买数据库的话，感觉十分的浪费。
但是我们切换Serverless来看一下，是按小时来收费的，不就是按量收费吗?这样是不是很符合我们的场景呢？
接下来的几个选项：
数据库版本，有5.7、有8.0，可以符合大部分的需求场景算力配置，CCU（TDSQL-C Compute Unit）为 Serverless 的计算计费单位，一个 CCU 近似等于1个 CPU 和 2GB 内存的计算资源，每个计费周期的 CCU 使用数量为：数据库所使用的 CPU 核数 与 内存大小的1/2 二者中取最大值。自动启停，数据库在该时间内没有连接和 CPU 使用时，将自动暂停，暂停后计算不计费，存储仍然按实际使用量计费。存储资源包，通过资源包，可以提前预留资源，而且，相对于按量付费方式，资源包可以帮助节省更多成本，资源包的购买容量越大，有效期越长，越划算。 我们可以看到存储的资源包也是比较便宜的，相对于传统MySQL的实例的空间要划算多了。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-30T20:15:15+08:00">
    <meta property="article:modified_time" content="2023-09-30T20:15:15+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【腾讯云 TDSQL-C Serverless 产品体验】TDSQL-C MySQL Serverless实践之路</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>【腾讯云 TDSQL-C Serverless 产品体验】TDSQL-C MySQL Serverless实践之路</p> 
<blockquote> 
 <p>腾讯云TDSQL-C联合CSDN推出了一款云数据库产品测评活动，让我们一起来体验一下。</p> 
</blockquote> 
<hr> 
<h2><a id="_6"></a>一、什么是云数据库？</h2> 
<p>云数据库是指被优化或部署到一个虚拟计算环境中的数据库，可以实现按需付费、按需扩展、高可用性以及存储整合等优势。</p> 
<p>云数据库的特性有：实例创建快速、支持只读实例、读写分离、故障自动切换、数据备份、Binlog备份、SQL审计、访问白名单、监控与消息通知等。</p> 
<h3><a id="1__12"></a>1. 优势：</h3> 
<ul><li>可以使用户按照存储容量和带宽的需求付费</li><li>可以将数据库从一个地方移到另一个地方（云的可移植性）</li><li>可实现按需扩展</li><li>高可用性（HA）</li></ul> 
<h4><a id="11__19"></a>1.1 轻松部署：</h4> 
<p>用户能够在控制台轻松的完成数据库申请和创建，数据库实例在几分钟内就可以准备就绪并投入使用。</p> 
<h4><a id="12__23"></a>1.2 高可靠：</h4> 
<p>云数据库具有故障自动单点切换、数据库自动备份等功能，保证实例高可用和数据安全。</p> 
<h4><a id="13__27"></a>1.3 低成本：</h4> 
<p>数据库支付的费用远低于自建数据库所需的成本，用户可以根据自己的需求选择不同套餐，使用很低的价格得到一整套专业的数据库支持服务。</p> 
<p>云数据库发展经历了三个时代：</p> 
<ul><li>1.0时代是以云托管数据库为主</li><li>2.0时代是容器架构的云原生数据库时代</li><li>3.0时代，云Serverless数据库将成为主流趋势。</li></ul> 
<p>腾讯云数据库TDSQL-C Serverless新版发布，标志着云原生数据库Serverless化正式步入全面推进阶段。</p> 
<hr> 
<h2><a id="TDSQLC_MySQL_40"></a>二、TDSQL-C MySQL云数据库：</h2> 
<p>TDSQL是腾讯云自研企业级分布式数据库，旗下涵盖金融级分布式、云原生、分析型等多引擎融合的完整数据库产品体系，提供业界领先的金融级高可用、计算存储分离、数据仓库、企业级安全等能力，同时具备智能运维平台、Serverless版本等完善的产品服务体系。</p> 
<p>TDSQL，100%兼容MySQL和PostgreSQL，包含三大产品系列，分别为分析型数据库TDSQL-A（Tencent Analytical Database）、云原生数据库TDSQL-C （Tencent CloudNative Database）和分布式数据库TDSQL（Tencent DistributedDatabase），全方位满足各行各业的业务需求。</p> 
<p>云原生数据库TDSQL-C MySQL，采用计算和存储分离（日志即数据库）的 Shared Storage 架构，融合了传统数据库、云计算与新硬件技术的优势，100%兼容 MySQL 等开源数据库，实现了超百万级 QPS 的吞吐，超百 TB 的海量分布式智能存储，能够很好地支撑大数据量的归档存储和高效查询性能。</p> 
<hr> 
<h2><a id="TDSQLC_MySQL_Serverless_50"></a>三、TDSQL-C MySQL Serverless版本：</h2> 
<p>Serverless 服务是腾讯云自研的新一代云原生关系型数据库 TDSQL-C MySQL 版的无服务器架构版，是全 Serverless 架构的云原生数据库。Serverless 服务支持按实际计算和存储资源使用量收取费用，不用不付费。</p> 
<h3><a id="1_Serverless__54"></a>1. Serverless 服务架构：</h3> 
<ul><li>按需启动，不需要时可关闭。</li><li>自动扩展/收缩。</li><li>缩放对应用程序无影响。</li></ul> 
<hr> 
<h2><a id="TDSQLC_MySQL_Serverless_62"></a>四、购买并开通TDSQL-C MySQL Serverless：</h2> 
<p>如下我们在选择数据库实例时，可以看到预置资源的MySQL，一年的费用是3250.94，就是说你哪怕是数据库没有使用，只要买了，就要付这么多的钱。那想像一下，我们在学校开发系统，只有白天才会使用，到了晚上的话、周未时间段，基本上没有使用的，这样买数据库的话，感觉十分的浪费。</p> 
<p><img src="https://images2.imgbox.com/a1/3c/UnDhz4WU_o.png" alt="在这里插入图片描述"></p> 
<p>但是我们切换Serverless来看一下，是按小时来收费的，不就是按量收费吗?这样是不是很符合我们的场景呢？</p> 
<p><img src="https://images2.imgbox.com/5d/8e/qd23CGAZ_o.png" alt="在这里插入图片描述"></p> 
<p>接下来的几个选项：</p> 
<ul><li>数据库版本，有5.7、有8.0，可以符合大部分的需求场景</li><li>算力配置，CCU（TDSQL-C Compute Unit）为 Serverless 的计算计费单位，一个 CCU 近似等于1个 CPU 和 2GB 内存的计算资源，每个计费周期的 CCU 使用数量为：数据库所使用的 CPU 核数 与 内存大小的1/2 二者中取最大值。</li><li>自动启停，数据库在该时间内没有连接和 CPU 使用时，将自动暂停，暂停后计算不计费，存储仍然按实际使用量计费。</li><li>存储资源包，通过资源包，可以提前预留资源，而且，相对于按量付费方式，资源包可以帮助节省更多成本，资源包的购买容量越大，有效期越长，越划算。</li></ul> 
<p><img src="https://images2.imgbox.com/d9/2f/MgBILC9k_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以看到存储的资源包也是比较便宜的，相对于传统MySQL的实例的空间要划算多了。</p> 
<p><img src="https://images2.imgbox.com/46/58/RiPId8WV_o.png" alt="在这里插入图片描述"></p> 
<p>创建完数据库集群实例后，可以看到控制台显示。</p> 
<p><img src="https://images2.imgbox.com/4c/c1/88fMy5rc_o.png" alt="在这里插入图片描述"></p> 
<p>也可以查看数据库实例运行很多指标的监控，可以让我们及时查看数据库实例的一些症状，提前做一些预防措施。</p> 
<ul><li>CPU使用率</li><li>内存使用率</li><li>内存使用量</li><li>存储使用率</li><li>存储使用量</li><li>数据表空间使用量</li><li>临时表空间使用量</li><li>undo表空间使用量</li><li>CCU</li><li>每秒发送客户端流量</li><li>每秒接收客户端流量</li></ul> 
<p><img src="https://images2.imgbox.com/86/fa/g9wcZn4H_o.png" alt="在这里插入图片描述"></p> 
<p>创建一个账号管理，方便用来管理账号。</p> 
<p><img src="https://images2.imgbox.com/e7/06/Me5Dv87t_o.png" alt="在这里插入图片描述"></p> 
<p>创建一个数据库，用来存储数据管理。<br> <img src="https://images2.imgbox.com/9c/5c/Ltkk9a73_o.png" alt="在这里插入图片描述"></p> 
<p>其它的选项暂时没用到，就不仔细介绍一下了。</p> 
<hr> 
<h2><a id="_122"></a>五、官方手册体验：</h2> 
<p>通过官方提供的手册，很快我们就完成了TDSQL-C MySQL的实际操作，问答系统手册案例也比较简单，与平时所使用的 Sql 语法差不多一致，基本上没有什么学习成本，开箱即用，可以快速上手，同时，也欢迎大家一起探索云原生数据库 TDSQL-C Serverless 更多的功能，为工作中赋能增效降本！</p> 
<p><img src="https://images2.imgbox.com/4b/a6/xk9ORZo0_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fa/3a/OjXip3bK_o.png" alt="在这里插入图片描述"></p> 
<p>以下为官方手册对着的效果。</p> 
<img src="https://images2.imgbox.com/d8/58/au2Yiunk_o.png" width="250"> 
<hr> 
<h2><a id="_137"></a>六、测评特性：</h2> 
<p><img src="https://images2.imgbox.com/b3/8c/Pyczia5A_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>TDSQL-C MySQL 版提供 Serverless 服务以满足企业对特定业务场景的数据库服务要求，助力企业降本增效。</p> 
</blockquote> 
<h3><a id="1_CCU_145"></a>1. 资源扩缩范围（CCU）</h3> 
<p>可调整 CCU 弹性扩缩容的范围。Serverless 集群会在该范围内根据实际业务压力自动增加或减少 CCU。</p> 
<h3><a id="2__149"></a>2. 弹性策略</h3> 
<p>Serverless 集群会持续监控用户的 CPU、内存等 workload 负载情况，根据一定的规则触发自动扩缩容策略。</p> 
<h3><a id="3__153"></a>3. 自动启停</h3> 
<p>Serverless 服务支持自定义实例自动暂停时间，无连接时实例会自动暂停。当有任务连接接入时，实例会秒级无间断自动唤醒。</p> 
<hr> 
<h2><a id="_159"></a>七、自动启停评测：</h2> 
<p>先将服务器进行关闭。</p> 
<p><img src="https://images2.imgbox.com/8f/ab/O6KuLEMs_o.png" alt="在这里插入图片描述"></p> 
<p>改造代码，并且关掉数据库服务，测试看看能不能进行自动启停。</p> 
<pre><code class="prism language-js"><span class="token comment">// 获取前10名分数，用于跑马灯效果</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/getScores'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取前10名分数信息日志'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> date1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">'SELECT * FROM `data_scores` order by id desc limit 10'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> date2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> date3 <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> date1<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"查询语句的开始时间"</span><span class="token punctuation">,</span> date1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\n查询语句的结束时间"</span><span class="token punctuation">,</span> date2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"\n查询语句的相差时间"</span><span class="token punctuation">,</span> date3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'application/json'</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token string">'200'</span><span class="token punctuation">,</span> <span class="token string-property property">"message"</span><span class="token operator">:</span> <span class="token string">'成功'</span><span class="token punctuation">,</span> <span class="token string-property property">"data"</span><span class="token operator">:</span> results <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/48/iWlOYwbA_o.png" alt="在这里插入图片描述"><br> 这里的相差的时间，为8989毫秒，相差8秒多，而且服务器确实自动唤起了，感觉时间还是不太准确。<br> <img src="https://images2.imgbox.com/21/3c/RvFLuF8Y_o.png" alt="在这里插入图片描述"></p> 
<p>只有重启代码才能自动唤起链接，想想一下其它方案，使用mysql命令进行登录。</p> 
<p><img src="https://images2.imgbox.com/d1/7d/qGlSLbii_o.png" alt="在这里插入图片描述"></p> 
<p>在 Linux 命令行中，可以使用 time 命令来统计命令执行时间。time 命令可以测量指定命令的执行时间、CPU 使用率、系统调用等信息，并将这些信息输出到终端上。</p> 
<p>执行完命令后，终端将输出三个时间值，分别是：</p> 
<ul><li>实际时间（real time）：指命令从开始到结束的实际耗时。</li><li>用户 CPU 时间（user time）：指命令在用户态运行的 CPU 时间，不包括系统调用时间。- 系统 CPU 时间（system time）：指命令在内核态运行的 CPU 时间，包括系统调用时间。</li></ul> 
<pre><code class="prism language-js">time mysql <span class="token operator">-</span>h gz<span class="token operator">-</span>cynosdbmysql<span class="token operator">-</span>grp<span class="token operator">-</span>6euxe8df<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>tencentcdb<span class="token punctuation">.</span>com <span class="token operator">-</span><span class="token constant">P</span> <span class="token number">27859</span> <span class="token operator">-</span>u root <span class="token operator">-</span>pTestSchool123 <span class="token operator">-</span>e <span class="token string">"show status;"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/63/b5/ubyr8N1J_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到real显示执行子3秒，表示在服务器暂停状态下，在3秒中，完成了mysql的连接，当然，这里也有网络的原因，但是说明服务器在默认设置的时间内，没有使用，就会停用。有连接进来的时候，就会马上几秒钟就能连接。</p> 
<hr> 
<h3><a id="_211"></a>八、弹性策略：</h3> 
<p>mysqlslap 是 MySQL 官方自带的一个压力测试工具。它通过模拟多个并发客户端访问 MySQL 来执行压力测试，通过结果信息可以了解数据库的性能状况。</p> 
<p>mysqlslap 是系统运维和 DBA 人员应该掌握一些常见的压力测试工具之一，其主要工作场景就是对数据库服务器做基准测试。</p> 
<p>比如：服务器的硬件资源能够支持多大的访问压力呢？优化了操作系统的内核参数后，是否提升了性能？调整了 MySQL 配置参数后，对性能有多少影响？</p> 
<pre><code class="prism language-js">mysqlslap <span class="token operator">-</span>h gz<span class="token operator">-</span>cynosdbmysql<span class="token operator">-</span>grp<span class="token operator">-</span>6euxe8df<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>tencentcdb<span class="token punctuation">.</span>com <span class="token operator">-</span><span class="token constant">P</span> <span class="token number">27859</span> <span class="token operator">-</span>uroot <span class="token operator">-</span>p TestSchool123 <span class="token operator">--</span>concurrency<span class="token operator">=</span><span class="token number">200</span> <span class="token operator">--</span>number<span class="token operator">-</span><span class="token keyword">of</span><span class="token operator">-</span>queries<span class="token operator">=</span><span class="token number">1000</span> <span class="token operator">--</span>create<span class="token operator">-</span>schema<span class="token operator">=</span>test_school <span class="token operator">--</span>query<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token string">"INSERT INTO data_scores (\`name\`, \`score\`) VALUES ('david', 30)"</span> <span class="token operator">--</span>iterations<span class="token operator">=</span><span class="token number">300</span>
</code></pre> 
<p>–concurrency=200：指定同时有 200 个客户端连接<br> –number-of-queries=1000：指定总的测试查询次数（并发客户端数 * 每个客户端的查询次数），这样本样例平均每个客户端查询 10 次</p> 
<p><img src="https://images2.imgbox.com/40/27/H88J3xc8_o.png" alt="在这里插入图片描述"></p> 
<p>运行结果如下：<br> Average number of seconds to run all queries：运行所有语句的平均秒数<br> Minimum number of seconds to run all queries：运行所有语句的最小秒数<br> Maximum number of seconds to run all queries：运行所有语句的最大秒数<br> Number of clients running queries：客户端数量<br> Average number of queries per client：每个客户端运行查询的平均数</p> 
<p>如下为CCU的变化示意图，可以看到CCU从0.2到0.6再到0.2的一个变化，用多少就会弹性多少。<br> <img src="https://images2.imgbox.com/17/51/sFuJI4g5_o.png" alt="在这里插入图片描述"></p> 
<p>CPU使用率阤是从0%到16%，再到0%。<br> <img src="https://images2.imgbox.com/61/ed/a8NB0Y1u_o.png" alt="在这里插入图片描述"></p> 
<p>内存的使用率也是一样的，从0%，到2.4%，再到3.63%。</p> 
<p><img src="https://images2.imgbox.com/df/bb/mvmNV6o8_o.png" alt="在这里插入图片描述"></p> 
<p>Serverless 服务的弹性策略一开始会根据用户购买时选择的容量范围，将 CPU、内存资源限制到最大规格，极大程度降低因 CPU 和内存扩容带来的时间影响和使用限制。当集群触发到自动弹性的负载阈值后，Buffer pool 会根据监控提前进行分钟级调整。在这个方案下用户使用数据库可以无感知进行 CPU 扩容。</p> 
<hr> 
<h2><a id="Serverless__250"></a>九、Serverless 服务架构：</h2> 
<p>Serverless 服务是腾讯云自研的新一代云原生关系型数据库 TDSQL-C MySQL 版的无服务器架构版，是全 Serverless 架构的云原生数据库。</p> 
<img src="https://images2.imgbox.com/01/83/99pT8z5L_o.png" width="600"> 
<ul><li>按需启动，不需要时可关闭。</li><li>自动扩展/收缩。</li><li>缩放对应用程序无影响。</li></ul> 
<p>连接不断转发请求能力：</p> 
<p><img src="https://images2.imgbox.com/0e/64/6KUjew0A_o.png" alt="111"></p> 
<p>当有连接访问时，系统会秒级自动启动处于暂停状态的数据库，用户不需设置重连机制。</p> 
<p>TDSQL-C MySQL 版的接入层增加了一个恢复感知器（简称 perceptron）的模块来实现请求转发，perceptron 在和客户端握手之后，不会使用户端到集群的连接断连。恢复集群后，与 TDSQL-C MySQL 版握手，后续转发四层报文。</p> 
<p>整体流程设计采用了两个挑战随机数进行鉴权，以实现中继模块 perceptron 不存储用户名密码的情况下也可以完成用户名密码验证，保证了用户密码的安全性，也不会引入存储密码不一致的问题。</p> 
<p><img src="https://images2.imgbox.com/1a/fe/wksPsLlU_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_275"></a>十、微信云托管：</h2> 
<blockquote> 
 <p>微信云托管 是微信团队提供的以云原生为基础的，免运维、高可用服务上云解决方案，无需服务器，1分钟即可部署小程序/公众号服务端。</p> 
</blockquote> 
<p>微信云托管支持目前绝大多数语言/框架项目，开发者可以从服务器平滑迁移；并且微信云托管的自动运维和扩缩容特性，无需开发者关心服务的可用性，专注于业务，极大节省人力和服务资源成本。</p> 
<p>同时，微信云托管还集成持续交付部署，DevOps自动化，安全鉴权等众多能力，致力于帮助没有深层运维经验的业务开发者和研发团队，用最低的成本，打造出稳定性高，安全性强的后端服务。</p> 
<p><img src="https://images2.imgbox.com/97/29/JqBEYrRY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/90/a2/1b0pqdTd_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1__285"></a>1. 流量不稳定触发型业务：</h3> 
<p>流量不稳定服务闲时资源利用率低造成资源浪费。 接入微信云托管可按实时流量自动扩缩容，突发场景下可在20s内快速扩容支持业务运行，1小时内无流量实例副本数支持缩容到0，做到无流量时无成本消耗。 同时微信云托管按实际用量计费大大降低成本，再结合MySQL数据库、对象存储等服务也可以同时降低数据库存储的使用成本。</p> 
<p><img src="https://images2.imgbox.com/13/25/lhHHMQ4W_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9d/b6/86xIS7Go_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/81/4c/vmGbPdc3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2__292"></a>2. 费用预估对比：</h3> 
<p>费用预估均基于刊例价，不考虑折扣、特惠活动、资源包、优惠券等。可理解为理论上的最高价。</p> 
<p>Q：如何理解CPU计费单位（核*小时）和内存计费单位（GB * 小时）？<br> A：在云托管中，每个服务下有一个运行中的版本（在发布过程中，服务同时有新旧两个版本在运行中），每个版本会消耗一定数量的实例。每个实例的规格（CPU几核、内存几GB），就好像它的“功率”。实例运行了多久，它所消耗的资源量就是规格乘以运行时间（精确到秒）。</p> 
<p>一个0.25核0.5GB的实例运行4个小时，消耗的资源量是：</p> 
<p>CPU：0.25 * 4 = 1 （核*小时）<br> 内存：0.5 * 4 = 2 （GB * 小时）<br> 一个1核2GB的实例运行1个小时，消耗的资源量是：</p> 
<p>CPU：1 * 1 = 1 （核*小时）<br> 内存：2 * 1 = 2 （GB * 小时）<br> 两个0.5核1GB的实例运行1个小时，消耗的资源量是：</p> 
<p>CPU：0.5 * 2 * 1 = 1 （核*小时）<br> 内存：1 * 2 * 1 = 2 （GB * 小时）<br> 可以看到，他们消耗的资源量是完全相同的，产生的费用也是完全一样的。</p> 
<p>从另一个角度来说，传统模式下以包月方式购买有效期一个月的一台1核2GB的云服务器，实际是你买断了一个月的固定的CPU和内存消耗量：</p> 
<p>CPU：1 * 24 * 30 = 720 （核<em>小时）<br> 内存：2 * 24</em> 30 = 1440 （GB * 小时）<br> 和云托管的按量计费模式区别在于，一个月内无论你的云服务器实际利用率多少，你都支付了全部资源量的费用（用不够一个月也按一个月算）。基于云托管的自动弹性伸缩特性，你可以完全释放冗余的计算资源，大幅降低成本。</p> 
<p>Q：如何理解MySQL的计费单位CCU（个*小时）？<br> A：CCU是MySQL的算力单位，0.25CCU对应传统模式中0.25核0.5GB的数据库的计算能力，1CCU对应传统模式中1核2GB的数据库的计算能力，依此类推。CCU最大可达到16CCU，对应传统模式中16核32GB的数据库的计算能力。数据库计算消耗的资源量就是实时算力乘以运行时间（精确到秒）。</p> 
<p>从另一个角度来说，传统模式下以包月方式购买有效期一个月的一个1核2GB的云数据库（等效1CCU的算力），实际是你买断了一个月的固定的CCU算力消耗量：1 * 24 * 30 = 720 （个*小时）。</p> 
<p>和云托管MySQL的按量计费模式区别在于，一个月内无论你的云数据库实际利用率多少，你都支付了全部资源量的费用（用不够一个月也按一个月算）。基于云托管的自动弹性伸缩特性，你可以完全释放冗余的计算资源，大幅降低成本。</p> 
<p>Q：弹性伸缩很方便，但是用量不透明，感觉心里没底？<br> A：云托管提供详细的监控数据，可实时掌握资源的实际用量、伸缩情况。和云服务器对比，你也依然需要通过云服务器的实时监控才能确认你包月买断的服务器资源中，有多少是真正在被使用、多少其实是冗余浪费。真正的实际用量方面，云托管和云服务器的透明度是一致的。</p> 
<p>Q：弹性伸缩如果不断扩容，会不会导致费用大幅超出预期，“醒来房子没了”？<br> A：这其实就是控制费用上限的问题。</p> 
<p>（1）每个版本的实例数上限为50个，超过上限不会再继续扩容，即每日费用上限完全可控。如果费用预算较紧，还可以手动调低版本的实例最大副本个数。</p> 
<p>例如：实例数上限50个，每个实例规格为0.25核0.5GB，则每日消耗资源量上限为：</p> 
<p>CPU：0.25 * 50 * 24 = 300 （核*小时）<br> 内存：0.5 * 50 * 24 = 600 （GB * 小时）<br> （2）微信云托管即将提供额度监控功能，当CPU/内存/数据库计算/数据库存储等任意资源的用量超过你设置的阈值时，会发送告警信息。你可以选择立刻冻结服务，停止新的费用产生。此时线上业务也会中断，请谨慎评估。</p> 
<p>Q：数据库什么情况下会触发自动暂停（不产生任何数据库算力用量和费用）？<br> A：任何对数据库的读写和运算操作，都会消耗数据库的算力。开启数据库的自动暂停后，连续10分钟内没有任何读写和运算操作，数据库即进入暂停状态。暂停状态不会产生数据库算力资源用量，但还会有数据库存储用量。</p> 
<p>Q：什么情况下服务会缩容到0（不产生任何容器相关用量和费用）？<br> A：服务下版本的实例最小副本数为0，且当前服务连续半小时没有任何访问时，会触发缩容到0。</p> 
<hr> 
<p>总结：</p> 
<p>TDSQL-C MySQL 版提供 Serverless 服务以满足企业对特定业务场景的数据库服务要求，助力企业降本增效。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b7b056ec7bf01e439c054f829e8bdc78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;】高精度模板大整合！高精度模板看这篇真的就够了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8f0434dce3cf9064b565edba474aded2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构】选择排序 &amp; 堆排序（二）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>