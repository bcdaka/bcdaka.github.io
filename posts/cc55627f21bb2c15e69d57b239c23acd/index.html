<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Self-study Python Fish-C Note15 P52to53 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/cc55627f21bb2c15e69d57b239c23acd/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Self-study Python Fish-C Note15 P52to53">
  <meta property="og:description" content="函数 (part 5) 本节主要讲函数文档、类型注释、内省、高阶函数
函数文档、类型注释、内省 (P52) 函数文档 函数是一种代码封装的方法，对于一个程序来说，函数就是一个结构组件。在函数的外部是不需要关心函数内部的执行细节的，更需要关注的是函数的接口以及执行后的结果。要学会去阅读开发手册和函数文档，以快速的融入一个项目
在 python 中，我们可以使用 help() 函数，快速的查看到一个函数的使用文档：
help(print) Help on built-in function print in module builtins: print(...) print(value, ..., sep=&#39; &#39;, end=&#39;\n&#39;, file=sys.stdout, flush=False) Prints the values to a stream, or to sys.stdout by default. Optional keyword arguments: file: a file-like object (stream); defaults to the current sys.stdout. sep: string inserted between values, default a space. end: string appended after the last value, default a newline.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-08T04:04:36+08:00">
    <meta property="article:modified_time" content="2024-08-08T04:04:36+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Self-study Python Fish-C Note15 P52to53</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_part_5_0"></a>函数 (part 5)</h2> 
<p>本节主要讲函数文档、类型注释、内省、高阶函数</p> 
<h3><a id="_P52_2"></a>函数文档、类型注释、内省 (P52)</h3> 
<h4><a id="_3"></a>函数文档</h4> 
<p>函数是一种代码封装的方法，对于一个程序来说，函数就是一个结构组件。在函数的外部是不需要关心函数内部的执行细节的，更需要关注的是函数的接口以及执行后的结果。要学会去阅读开发手册和函数文档，以快速的融入一个项目<br> 在 python 中，我们可以使用 <code>help()</code> 函数，快速的查看到一个函数的使用文档：</p> 
<pre><code class="prism language-python"><span class="token builtin">help</span><span class="token punctuation">(</span><span class="token keyword">print</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Help on built-in function print in module builtins:

print(...)
    print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)
    
    Prints the values to a stream, or to sys.stdout by default.
    Optional keyword arguments:
    file:  a file-like object (stream); defaults to the current sys.stdout.
    sep:   string inserted between values, default a space.
    end:   string appended after the last value, default a newline.
    flush: whether to forcibly flush the stream.
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 详解：</span>
<span class="token comment"># Help on built-in function print in module builtins:</span>

<span class="token comment"># print(...)</span>
<span class="token comment">#     print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False) # 展示了 print 函数的原型</span>
    
<span class="token comment">#     Prints the values to a stream, or to sys.stdout by default. # 函数的功能介绍</span>
<span class="token comment">#     Optional keyword arguments:  # 各个参数的类型及作用</span>
<span class="token comment">#     file:  a file-like object (stream); defaults to the current sys.stdout.</span>
<span class="token comment">#     sep:   string inserted between values, default a space.</span>
<span class="token comment">#     end:   string appended after the last value, default a newline.</span>
<span class="token comment">#     flush: whether to forcibly flush the stream.</span>
</code></pre> 
<p>如何创建函数文档，使用 <code>"""</code>：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">exchange</span><span class="token punctuation">(</span>dollar<span class="token punctuation">,</span> rate<span class="token operator">=</span><span class="token number">6.32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    功能：汇率转换，美元-&gt;人民币
    参数：
    ·dollar 美元数量
    ·rate 汇率，默认值是 6.32 (2022-03-08)
    返回值：
    ·人民币数量
    """</span>
    <span class="token keyword">return</span> dollar <span class="token operator">*</span> rate
exchange<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>126.4
</code></pre> 
<pre><code class="prism language-python"><span class="token builtin">help</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span>
</code></pre> 
<pre><code>Help on function exchange in module __main__:

exchange(dollar, rate=6.32)
    功能：汇率转换，美元-&gt;人民币
    参数：
    ·dollar 美元数量
    ·rate 汇率，默认值是 6.32 (2022-03-08)
    返回值：
    ·人民币数量
</code></pre> 
<p>注意：函数文档一定是要在函数的最顶部的。</p> 
<h4><a id="_84"></a>类型注释</h4> 
<p>示例：<br> 比如以下函数，作者希望调用者传入到<code>a</code>参数中的类型是字符串类型，<code>b</code>参数的类型是整数类型，这个函数的返回值将是一个字符串类型。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b
func<span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token string">'n'</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>'nnn'
</code></pre> 
<p>但是这并不是强制的。Python 运行时不强制执行函数和变量类型注解，但这些注解可用于类型检查器、IDE、静态检查器等第三方工具。（即并不是设置类型后像 java 那样的强类型定义语言了）。如：</p> 
<pre><code class="prism language-python">func<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>15
</code></pre> 
<p>如果我们要设置默认参数：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b
func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>'eeeee'
</code></pre> 
<p>如果说我们期待的参数类型是列表，甚至一个整数列表（所有值都是整数的列表）</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token builtin">list</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b
func<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>[1, 2, 3, 1, 2, 3, 1, 2, 3]
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">*</span>b
func<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>[1, 2, 3, 1, 2, 3, 1, 2, 3]
</code></pre> 
<p>映射类型也可实现，比如我们期待的字典的键是字符串，而值是整数</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token builtin">dict</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token punctuation">,</span>b<span class="token punctuation">:</span><span class="token builtin">int</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>b
    v <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>b
    res<span class="token operator">=</span>key<span class="token operator">+</span>v
    <span class="token keyword">return</span> res
func<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"a"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>['a', 'b', 'c', 'a', 'b', 'c', 'a', 'b', 'c', 1, 2, 3, 1, 2, 3, 1, 2, 3]
</code></pre> 
<p>如果我们想让python帮我们做一下检测，可以使用 <code>Mypy</code> 模块</p> 
<h4><a id="_182"></a>内省</h4> 
<p>在程序运行的时候能够进行自我检测的一种机制，称之为内省或自省<br> Python 是通过一些特殊的属性来实现内省的：<br> 求知一个函数的名字</p> 
<pre><code class="prism language-python">exchange<span class="token punctuation">.</span>__name__
</code></pre> 
<pre><code>'exchange'
</code></pre> 
<p>求知一个函数的类型注释</p> 
<pre><code class="prism language-python">func<span class="token punctuation">.</span>__annotations__
</code></pre> 
<pre><code>{'a': dict[str, int], 'b': int, 'return': list}
</code></pre> 
<p>查看函数文档</p> 
<pre><code class="prism language-python">exchange<span class="token punctuation">.</span>__doc__
</code></pre> 
<pre><code>'\n    功能：汇率转换，美元-&gt;人民币\n    参数：\n    ·dollar 美元数量\n    ·rate 汇率，默认值是 6.32 (2022-03-08)\n    返回值：\n    ·人民币数量\n    '
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span>
</code></pre> 
<pre><code>    功能：汇率转换，美元-&gt;人民币
    参数：
    ·dollar 美元数量
    ·rate 汇率，默认值是 6.32 (2022-03-08)
    返回值：
    ·人民币数量
</code></pre> 
<h3><a id="_higherorder_function_P53_242"></a>高阶函数 (higher-order function) (P53)</h3> 
<p>当一个函数接收另一个函数作为参数的时候，那么这个时候这种函数就叫高阶函数<br> 其实在前面的装饰器那一节我们就碰到过高阶函数</p> 
<pre><code class="prism language-python"><span class="token comment"># 前面装饰器的例子</span>
<span class="token keyword">import</span> time 
<span class="token keyword">def</span> <span class="token function">time_master</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">call_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'In total we used </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>stop<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> second'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> call_func

<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
    
myfunc <span class="token operator">=</span> time_master<span class="token punctuation">(</span>myfunc<span class="token punctuation">)</span>
myfunc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>start
Hi
stop
In total we used 2.00 second
</code></pre> 
<p>在这里 <code>time_master()</code> 把 <code>myfunc()</code> 作为参数使用，<code>time_master()</code>就是一个高阶函数。<br> Pyhton 中常见的高阶函数有 <code>map</code>, <code>filter</code>, 除此外<code>min</code>, <code>max</code>, <code>salty</code>也可以算是高阶，因为他们有一个 <code>key</code> 参数接收的就是一个函数对象。</p> 
<h4><a id="functools__276"></a><code>functools</code> 模块</h4> 
<p>Python 中收集实用的一些高阶函数以及装饰器的模块</p> 
<h5><a id="reduce__278"></a><code>reduce()</code> 函数</h5> 
<p><code>reduce()</code> 函数有两个参数，第一个参数是一个函数，第二个参数是一个可迭代对象。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">add_f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token operator">+</span>b
<span class="token keyword">import</span> functools
functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>add_f<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>15
</code></pre> 
<p>这里 <code>reduce</code> 的作用就是将可迭代对象中的元素依次传递到第一个参数指定的函数中，最终返回累积的结果。<br> 其实就相当于：</p> 
<pre><code class="prism language-python">add_f<span class="token punctuation">(</span>add_f<span class="token punctuation">(</span>add_f<span class="token punctuation">(</span>add_f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>15
</code></pre> 
<p><code>reduce()</code> 函数的第一个参数是一个函数，自然也可以是 lambda 表达式。比如计算10的阶乘：</p> 
<pre><code class="prism language-python">functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>x<span class="token operator">*</span>y<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>3628800
</code></pre> 
<h5><a id="_325"></a>偏函数</h5> 
<p>偏函数是指对指定的函数进行二次包装，通常是对现有的函数部分参数预先绑定，从而得到一个新的函数，则该函数称之为偏函数。<br> 偏函数通过 <code>functools</code> 里的 <code>partial</code> 来实现<br> 偏函数的作用就是将一个函数的多个参数给拆分多次进行传递。如：</p> 
<pre><code class="prism language-python">square <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>square<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>square<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>square<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>4
8
32
</code></pre> 
<pre><code class="prism language-python">cube <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cube<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cube<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cube<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>9
27
243
</code></pre> 
<p>和我们之前讲到闭包一样实现这个功能，其实这个偏函数的实现原理就是闭包。</p> 
<h5><a id="wraps_357"></a><code>@wraps</code></h5> 
<p>我们回到前面装饰器 <code>time_master</code> 和 <code>myfunc</code> 的例子：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">time_master</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">call_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'In total we used </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>stop<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> second'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> call_func

<span class="token decorator annotation punctuation">@time_master</span>
<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
    
myfunc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>start
Hi
stop
In total we used 2.01 second
</code></pre> 
<p>但是这里有一个副作用，调用<code>myfunc.__name__</code> 会得到 <code>'call_func'</code> 而不是 <code>myfunc</code>：</p> 
<pre><code class="prism language-python">myfunc<span class="token punctuation">.</span>__name__
</code></pre> 
<pre><code>'call_func'
</code></pre> 
<p>装饰器其实是一个语法糖，代码其实相当于：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">time_master</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">call_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'In total we used </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>stop<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> second'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> call_func

<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
    
myfunc <span class="token operator">=</span> time_master<span class="token punctuation">(</span>myfunc<span class="token punctuation">)</span>
myfunc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>start
Hi
stop
In total we used 2.01 second
</code></pre> 
<p>由于闭包的设计，调用 <code>myfunc</code> 函数其实是调用了 <code>time_master</code> 函数，然后传入 <code>myfunc</code> 作为其参数。而调用 <code>time_master</code> 函数其实是调用 <code>call_func</code> 函数。所以当使用 <code>name</code> 属性内省的时候，就是 <code>call_func</code> 了。<br> 其实实际运用的时候影响不大，但是如果想纠正这个问题，可以用 <code>@wraps</code> 装饰器来装饰装饰器。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">time_master</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">call_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'In total we used </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>stop<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> second'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> call_func

<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
    
myfunc <span class="token operator">=</span> time_master<span class="token punctuation">(</span>myfunc<span class="token punctuation">)</span>
myfunc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>start
Hi
stop
In total we used 2.00 second
</code></pre> 
<pre><code class="prism language-python">myfunc<span class="token punctuation">.</span>__name__
</code></pre> 
<pre><code>'myfunc'
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># 或者装饰器的形式</span>
<span class="token keyword">def</span> <span class="token function">time_master</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">call_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'In total we used </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>stop<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> second'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> call_func

<span class="token decorator annotation punctuation">@time_master</span>
<span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span>
    
myfunc<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>start
Hi
stop
In total we used 2.01 second
</code></pre> 
<pre><code class="prism language-python">myfunc<span class="token punctuation">.</span>__name__
</code></pre> 
<pre><code>'myfunc'
</code></pre> 
<p>附言：<br> 题目：Self-study Python Fish-C Note-15 P52-P53<br> 本文为自学B站上鱼C的python课程随手做的笔记。一些概念和例子我个人为更好的理解做了些查询和补充<br> 因本人水平有限，如有任何问题，欢迎大家批评指正！<br> 原视频链接：https://www.bilibili.com/video/BV1c4411e77t?p=8</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53cffa878fba9d0034882de20309d93a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">FPGA面试问题整理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3555138822b2add8c8bb806d4f1ad01f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">代码规范 —— 数据库规范</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>