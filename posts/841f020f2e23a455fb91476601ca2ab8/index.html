<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Wechaty实现微信接入文心一言 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/841f020f2e23a455fb91476601ca2ab8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="基于Wechaty实现微信接入文心一言">
  <meta property="og:description" content="引言与效果 上篇文章写了怎么用Wechaty接入ChatGPT，这篇写一下怎么接入文心一言的模型。国内的模型用起来会更方便一些，而且也不用科学上网。最终实现效果如下：
Wechaty机器人介绍与部署 在上一篇中已详细展开说，这一篇就不再说明，如果需要请移步上一篇进行观看：
基于Wechaty实现微信接入ChatGPT - 详细教学https://blog.csdn.net/oBeiJiTa/article/details/137546823?spm=1001.2014.3001.5501
文心一言接入前准备工作 1. 先搞定基础工作：创建应用 首先，我们得有个“家”让我们的机器人住进去。
访问这里，按提示创建一个应用。
创建好了记得保存你的API Key和Secret Key，后面会用到。
2. 拿到“入场券”：获取Access Token 现在，咱们要去拿一个“入场券”——access_token。
点开这个页面，选你刚刚创建的应用，输入API Key和Secret Key，点击“调试”，就能得到token了。
token也要存一下，后面要用。
3. 测试一下，看看效果如何 都设置好了，进入对话测试界面，看看你的机器人能不能正常聊天。
如果能，那就恭喜你，已经完成90%了！
接入文心一言 发送与解析 打开你机器人目录下
wechaty-main\wechaty-main\examples里的ding-dong-bot
对 onMessage (msg: Message) 方法进行改写：
const accessToken: string = &#39;这里放你的token&#39;; async function onMessage (msg: Message) { try{ if(msg.text()===&#34;ding&#34;){ await msg.say(&#34;dong&#34;) } if(msg.type()===bot.Message.Type.Text) { let context=msg.text().split(&#34;@桔桔&#34;)[1]; var answer=&#34;哈喽，怎么了？&#34;; //基本回答 if(context?.replace(/\s/g,&#34;&#34;)!=&#34;&#34;){ const postData={ messages:[ { &#34;role&#34;:&#34;user&#34;, &#34;content&#34;:context } ] }; let res=await axios.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-09T17:46:22+08:00">
    <meta property="article:modified_time" content="2024-04-09T17:46:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Wechaty实现微信接入文心一言</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>引言与效果</h3> 
<p>上篇文章写了怎么用Wechaty接入ChatGPT，这篇写一下怎么接入文心一言的模型。国内的模型用起来会更方便一些，而且也不用科学上网。最终实现效果如下：</p> 
<p class="img-center"><img alt="" height="240" src="https://images2.imgbox.com/e3/21/o3XzBgmD_o.png" width="342"></p> 
<p class="img-center"><img alt="" height="249" src="https://images2.imgbox.com/5e/6e/DZ6j2ZOq_o.png" width="390"></p> 
<hr> 
<h2>Wechaty机器人介绍与部署</h2> 
<p style="text-align:center;">在上一篇中已详细展开说，这一篇就不再说明，如果需要请移步上一篇进行观看：</p> 
<p style="text-align:center;"><a class="link-info has-card" href="https://blog.csdn.net/oBeiJiTa/article/details/137546823?spm=1001.2014.3001.5501" title="基于Wechaty实现微信接入ChatGPT - 详细教学"><span class="link-card-box"><span class="link-title">基于Wechaty实现微信接入ChatGPT - 详细教学</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/65/1f/x1Yz8mQB_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/oBeiJiTa/article/details/137546823?spm=1001.2014.3001.5501</span></span></a></p> 
<hr> 
<h2> 文心一言接入前准备工作</h2> 
<h4>1. 先搞定基础工作：创建应用</h4> 
<p>首先，我们得有个“家”让我们的机器人住进去。</p> 
<p>访问<a href="https://console.bce.baidu.com/qianfan/ais/console/applicationConsole/application" rel="nofollow" title="这里">这里</a>，按提示创建一个应用。</p> 
<p></p> 
<p>创建好了记得<strong>保存你的API Key和Secret Key，后面会用到</strong>。</p> 
<p class="img-center"><img alt="" height="515" src="https://images2.imgbox.com/76/ec/V6m3HWpJ_o.png" width="1200"></p> 
<h4>2. 拿到“入场券”：获取Access Token</h4> 
<p>现在，咱们要去拿一个“入场券”——access_token。</p> 
<p>点开<a href="https://console.bce.baidu.com/tools/?u=dhead#/api?product=AI&amp;project=%E8%AF%AD%E9%9F%B3%E6%8A%80%E6%9C%AF&amp;parent=%E9%89%B4%E6%9D%83%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6&amp;api=oauth%2F2.0%2Ftoken&amp;method=post" rel="nofollow" title="这个页面">这个页面</a>，选你刚刚创建的应用，输入API Key和Secret Key，点击“调试”，就能得到token了。</p> 
<p></p> 
<p><strong>token也要存一下，后面要用</strong>。</p> 
<p class="img-center"><img alt="" height="761" src="https://images2.imgbox.com/08/ea/d4lrBigx_o.png" width="1200"></p> 
<h4>3. 测试一下，看看效果如何</h4> 
<p>都设置好了，进入对话测试界面，看看你的机器人能不能正常聊天。</p> 
<p>如果能，那就恭喜你，已经完成90%了！</p> 
<hr> 
<h2>接入文心一言</h2> 
<h4>发送与解析</h4> 
<p> 打开你机器人目录下</p> 
<p><strong>wechaty-main\wechaty-main\examples里的ding-dong-bot</strong></p> 
<p class="img-center"><img alt="" height="147" src="https://images2.imgbox.com/08/10/DfGIXxR0_o.png" width="280"></p> 
<p></p> 
<p>对 <strong>onMessage (msg: Message) </strong>方法进行改写：</p> 
<pre><code class="language-TypeScript">const accessToken: string = '这里放你的token'; 

async function onMessage (msg: Message) {
  try{
	
	 if(msg.text()==="ding"){
			await msg.say("dong")
		}
    if(msg.type()===bot.Message.Type.Text)
	{
        let context=msg.text().split("@桔桔")[1];
        var answer="哈喽，怎么了？";
        //基本回答
        if(context?.replace(/\s/g,"")!=""){
          const postData={
            messages:[
              {
                "role":"user",
                "content":context
              }
            ]
          };
          let res=await axios.post('https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions?access_token=' +
          accessToken,postData,{
            headers:{
              "Content-Type": "application/json"
            }
          });
          answer=res.data.result;
        }

        await msg.say(answer)
      
    } 
	
  }catch(error){
	console.error('Error:',error);
  }
  console.log(msg.text())
}</code></pre> 
<p>其实这时你把token写死，直接把你在应用测试中获得的token放在<strong>accessToken </strong>中也可以启动机器人进行愉快的玩耍了。</p> 
<p></p> 
<p>如果你想聪明一点，获取实时的token，就在机器人启动时获取一下，改写<strong>onLogin (user: Contact)方法</strong></p> 
<p></p> 
<h4>实时获取Token</h4> 
<pre><code class="language-TypeScript">function onLogin (user: Contact) : void {
  console.info(`${user.name()} login`)

  axios.post('https://aip.baidubce.com/oauth/2.0/token?'+
  'client_id=你的ClientID&amp;' +
  'client_secret=你的Key&amp;' +
  'grant_type=client_credentials',null,{
    headers:{
      "Accept":"application/json",
      "Content-Type":"application/json"
    }
  })
    .then(response :AxiosResponse&lt;any,any&gt; =&gt;{
      refreshToken=response.data.refresh_token;

      accessToken=response.data.access_token;
      console.log(refreshToken)
      console.log(accessToken)
    })  
    .catch(error =&gt; {
      console.error('Error:',error);
    });    
}</code></pre> 
<hr> 
<p>这里代码工作完毕，按照上面的Wechaty启动方式启动即可使用你的微信个人AI了，不知道怎么启动的可以看上一篇文章，再次放出链接：</p> 
<p><a class="link-info has-card" href="https://blog.csdn.net/oBeiJiTa/article/details/137546823?spm=1001.2014.3001.5501" title="基于Wechaty实现微信接入ChatGPT - 详细教学"><span class="link-card-box"><span class="link-title">基于Wechaty实现微信接入ChatGPT - 详细教学</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/84/4b/IZxAwAf3_o.png" alt="icon-default.png?t=N7T8">https://blog.csdn.net/oBeiJiTa/article/details/137546823?spm=1001.2014.3001.5501</span></span></a></p> 
<h4>效果图 </h4> 
<p class="img-center"><img alt="" height="436" src="https://images2.imgbox.com/d7/fe/qnxOhz4F_o.png" width="382"></p> 
<hr> 
<h2><strong>结束语</strong> </h2> 
<p>到这里，我们的基础教程就结束了。我只展示了一个简单的例子。</p> 
<p>Wechaty还有很多其他酷炫的功能。</p> 
<p>比如，你可以更改群名，将不需要的成员踢出群聊，或者设置当新成员加入时的欢迎信息。</p> 
<p>当然，你也可以对机器人本身进行各种操作。</p> 
<p>最后，文心一言不是唯一的选择。</p> 
<p>你完全可以将它替换为其他类型的机器人，如ChatGPT等。</p> 
<p>只要它们提供了API接口，你就可以实现对接。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a4751f88de9a6c0f1a598299fa04579a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端如何监听屏幕宽度的变化？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a781da6abf7eadedc02cc3ddf5b8a9a3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据库大作业：学生就业管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>