<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot系列——使用Spring Cache和Redis实现查询数据缓存 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/acb576b6f4b70bd2a2558ece9a7e9aa6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringBoot系列——使用Spring Cache和Redis实现查询数据缓存">
  <meta property="og:description" content="文章目录 1. 前言2. 缓存2.1 什么是缓存2.2 使用缓存的好处2.3 缓存的成本2.4 Spring Cache和Redis的优点 3. Spring Cache基础知识3.1 Spring Cache的核心概念3.2 Spring Cache的注解3.2.1 SpEL表达式3.2.2 @Cacheable3.2.3 @CachePut3.2.4 @CacheEvict 4. 实现查询数据缓存4.1 准备工作4.2 添加依赖4.3 修改配置文件4.4 配置缓存管理器4.5 使用Spring Cache注解4.6 测试4.6.1 查询测试4.6.2 更新、删除测试 5. 总结 1. 前言 在现代应用程序中，查询缓存的使用已经变得越来越普遍。它不仅能够显著提高系统的性能，还能提升用户体验。缓存通过在内存中存储频繁访问的数据，减少对数据库或其他存储系统的访问，从而加快数据读取速度。在这篇文章中，我们将探讨缓存的基本概念、重要性以及如何使用Spring Cache和Redis实现查询数据缓存 。
2. 缓存 2.1 什么是缓存 缓存是一种临时存储机制，用于在内存中保存频繁访问的数据。它可以是硬件（如CPU缓存）或软件（如应用程序缓存）。缓存的主要目的是通过减少数据访问的延迟，提高系统的响应速度。以下是缓存的一些关键特性：
临时性：缓存中的数据通常是临时的，会在一段时间后失效或被替换。快速访问：由于缓存数据存储在内存中，访问速度非常快。空间有限：缓存的存储空间通常有限，因此需要有效的管理策略，如LRU（最近最少使用）策略。 2.2 使用缓存的好处 提高性能：缓存可以显著减少数据读取的时间，因为内存访问速度比硬盘或网络存储快很多。减轻数据库负载：缓存可以减少数据库的查询次数，从而减轻数据库的负载，提升整体系统的稳定性和可扩展性。节省资源：通过减少对后端系统的访问，缓存可以帮助节省带宽和计算资源。提高用户体验：快速的数据访问可以显著提升用户体验，特别是在需要频繁读取数据的应用场景中。 2.3 缓存的成本 内存消耗：缓存需要占用系统的内存资源，过多的缓存可能会影响其他应用程序的性能。数据一致性：缓存中的数据可能会与数据库中的数据不一致，尤其是在数据频繁更新的场景中。需要设计有效的缓存失效策略来保证数据的一致性。复杂性增加：引入缓存机制会增加系统的复杂性，需要处理缓存的管理、更新和失效等问题。维护成本：缓存系统需要定期监控和维护，以确保其高效运行。 2.4 Spring Cache和Redis的优点 为了实现高效的数据缓存，Spring Boot提供了Spring Cache模块，而Redis则是一个强大的缓存数据库。结合使用Spring Cache和Redis，能够充分发挥二者的优点，实现高效的数据缓存。
Spring Cache的优点： 简化缓存操作：Spring Cache提供了一系列注解（如@Cacheable、@CachePut、@CacheEvict），简化了缓存的使用，使开发者能够专注于业务逻辑。灵活的缓存管理：Spring Cache支持多种缓存提供者（如EhCache、Hazelcast、Redis等），可以根据具体需求选择合适的缓存实现。透明的缓存机制：Spring Cache使得缓存操作对业务代码透明，开发者无需关心缓存的具体实现细节。 Redis的优点： 高性能：由于数据存储在内存中，Redis的读写速度非常快，能够处理每秒数百万级别的请求。丰富的数据结构：Redis支持多种数据结构，如字符串、哈希、列表、集合、有序集合等，能够满足不同场景下的数据存储需求。持久化支持：虽然Redis主要用于内存存储，但它也提供了数据持久化的功能，可以将数据定期保存到磁盘，防止数据丢失。分布式支持：Redis支持主从复制、哨兵模式和集群模式，能够实现高可用性和数据的水平扩展。灵活的过期策略：Redis支持为每个键设置过期时间，自动删除过期数据，方便实现缓存失效策略。 3. Spring Cache基础知识 在Spring Boot中，Spring Cache提供了一套简洁且强大的缓存抽象机制，帮助开发者轻松地将缓存集成到应用程序中。以下是Spring Cache的一些核心概念和常用注解。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-15T10:15:37+08:00">
    <meta property="article:modified_time" content="2024-06-15T10:15:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot系列——使用Spring Cache和Redis实现查询数据缓存</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li>1. 前言</li><li>2. 缓存</li><li><ul><li>2.1 什么是缓存</li><li>2.2 使用缓存的好处</li><li>2.3 缓存的成本</li><li>2.4 Spring Cache和Redis的优点</li></ul> 
   </li><li>3. Spring Cache基础知识</li><li><ul><li>3.1 Spring Cache的核心概念</li><li>3.2 Spring Cache的注解</li><li><ul><li>3.2.1 SpEL表达式</li><li>3.2.2 @Cacheable</li><li>3.2.3 @CachePut</li><li>3.2.4 @CacheEvict</li></ul> 
   </li></ul> 
   </li><li>4. 实现查询数据缓存</li><li><ul><li>4.1 准备工作</li><li>4.2 添加依赖</li><li>4.3 修改配置文件</li><li>4.4 配置缓存管理器</li><li>4.5 使用Spring Cache注解</li><li>4.6 测试</li><li><ul><li>4.6.1 查询测试</li><li>4.6.2 更新、删除测试</li></ul> 
   </li></ul> 
   </li><li>5. 总结</li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__2"></a>1. 前言</h3> 
<blockquote> 
 <p>在现代应用程序中，查询缓存的使用已经变得越来越普遍。它不仅能够显著提高系统的性能，还能提升用户体验。缓存通过在内存中存储频繁访问的数据，减少对数据库或其他存储系统的访问，从而加快数据读取速度。在这篇文章中，我们将探讨缓存的基本概念、重要性以及如何使用Spring Cache和Redis实现查询数据缓存 。</p> 
</blockquote> 
<h3><a id="2__6"></a>2. 缓存</h3> 
<h4><a id="21__8"></a>2.1 什么是缓存</h4> 
<p><strong>缓存</strong>是一种临时存储机制，用于在内存中保存频繁访问的数据。它可以是硬件（如CPU缓存）或软件（如应用程序缓存）。缓存的主要目的是通过减少数据访问的延迟，提高系统的响应速度。以下是缓存的一些关键特性：</p> 
<ul><li><strong>临时性</strong>：缓存中的数据通常是临时的，会在一段时间后失效或被替换。</li><li><strong>快速访问</strong>：由于缓存数据存储在内存中，访问速度非常快。</li><li><strong>空间有限</strong>：缓存的存储空间通常有限，因此需要有效的管理策略，如LRU（最近最少使用）策略。</li></ul> 
<h4><a id="22__16"></a>2.2 使用缓存的好处</h4> 
<ol><li><strong>提高性能</strong>：缓存可以显著减少数据读取的时间，因为内存访问速度比硬盘或网络存储快很多。</li><li><strong>减轻数据库负载</strong>：缓存可以减少数据库的查询次数，从而减轻数据库的负载，提升整体系统的稳定性和可扩展性。</li><li><strong>节省资源</strong>：通过减少对后端系统的访问，缓存可以帮助节省带宽和计算资源。</li><li><strong>提高用户体验</strong>：快速的数据访问可以显著提升用户体验，特别是在需要频繁读取数据的应用场景中。</li></ol> 
<h4><a id="23__23"></a>2.3 缓存的成本</h4> 
<ol><li><strong>内存消耗</strong>：缓存需要占用系统的内存资源，过多的缓存可能会影响其他应用程序的性能。</li><li><strong>数据一致性</strong>：缓存中的数据可能会与数据库中的数据不一致，尤其是在数据频繁更新的场景中。需要设计有效的缓存失效策略来保证数据的一致性。</li><li><strong>复杂性增加</strong>：引入缓存机制会增加系统的复杂性，需要处理缓存的管理、更新和失效等问题。</li><li><strong>维护成本</strong>：缓存系统需要定期监控和维护，以确保其高效运行。</li></ol> 
<h4><a id="24_Spring_CacheRedis_30"></a>2.4 Spring Cache和Redis的优点</h4> 
<blockquote> 
 <p>为了实现高效的数据缓存，Spring Boot提供了Spring Cache模块，而Redis则是一个强大的缓存数据库。结合使用Spring Cache和Redis，能够充分发挥二者的优点，实现高效的数据缓存。</p> 
</blockquote> 
<ul><li><strong>Spring Cache的优点</strong>： 
  <ul><li><strong>简化缓存操作</strong>：Spring Cache提供了一系列注解（如<code>@Cacheable</code>、<code>@CachePut</code>、<code>@CacheEvict</code>），简化了缓存的使用，使开发者能够专注于业务逻辑。</li><li><strong>灵活的缓存管理</strong>：Spring Cache支持多种缓存提供者（如EhCache、Hazelcast、Redis等），可以根据具体需求选择合适的缓存实现。</li><li><strong>透明的缓存机制</strong>：Spring Cache使得缓存操作对业务代码透明，开发者无需关心缓存的具体实现细节。</li></ul> </li><li><strong>Redis的优点</strong>： 
  <ul><li><strong>高性能</strong>：由于数据存储在内存中，Redis的读写速度非常快，能够处理每秒数百万级别的请求。</li><li><strong>丰富的数据结构</strong>：Redis支持多种数据结构，如字符串、哈希、列表、集合、有序集合等，能够满足不同场景下的数据存储需求。</li><li><strong>持久化支持</strong>：虽然Redis主要用于内存存储，但它也提供了数据持久化的功能，可以将数据定期保存到磁盘，防止数据丢失。</li><li><strong>分布式支持</strong>：Redis支持主从复制、哨兵模式和集群模式，能够实现高可用性和数据的水平扩展。</li><li><strong>灵活的过期策略</strong>：Redis支持为每个键设置过期时间，自动删除过期数据，方便实现缓存失效策略。</li></ul> </li></ul> 
<h3><a id="3_Spring_Cache_45"></a>3. Spring Cache基础知识</h3> 
<blockquote> 
 <p>在Spring Boot中，Spring Cache提供了一套简洁且强大的缓存抽象机制，帮助开发者轻松地将缓存集成到应用程序中。以下是Spring Cache的一些核心概念和常用注解。</p> 
</blockquote> 
<h4><a id="31_Spring_Cache_48"></a>3.1 Spring Cache的核心概念</h4> 
<ol><li> <p><strong>CacheManager</strong></p> 
  <ul><li><strong>定义</strong>：<code>CacheManager</code>是Spring Cache的核心接口，负责管理多个缓存实例。它是缓存操作的入口点，提供了获取和操作缓存实例的方法。</li><li><strong>实现</strong>：Spring提供了多种<code>CacheManager</code>实现，如<code>ConcurrentMapCacheManager</code>、<code>EhCacheCacheManager</code>、<code>RedisCacheManager</code>等。不同的实现适用于不同的缓存存储机制。</li></ul> </li><li> <p><strong>Cache</strong></p> 
  <ul><li><strong>定义</strong>：<code>Cache</code>是缓存的具体实现，负责存储和检索缓存数据。它提供了基本的缓存操作，如<code>put</code>、<code>get</code>、<code>evict</code>等。</li><li><strong>实现</strong>：具体的<code>Cache</code>实现依赖于底层的缓存存储机制，如内存缓存、Redis缓存等。</li></ul> </li></ol> 
<h4><a id="32_Spring_Cache_58"></a>3.2 Spring Cache的注解</h4> 
<h5><a id="321_SpEL_60"></a>3.2.1 SpEL表达式</h5> 
<blockquote> 
 <p>因为Spring Cache使用SpEL表达式来动态生成缓存键，所以在学习Spring Cache的注解之前我们还要先简单了解一下SpEL表达式的语法，这部分可以先不看懂，在后面看注解的时候回来看即可。</p> 
</blockquote> 
<p>SpEL表达式的语法类似于Java的表达式语法，支持以下几种操作：</p> 
<ol><li><strong>字面量</strong>： 
  <ul><li>数字：<code>1</code>, <code>2.5</code></li><li>字符串：<code>'hello'</code>, <code>"world"</code></li><li>布尔值：<code>true</code>, <code>false</code></li><li>空值：<code>null</code></li></ul> </li><li><strong>属性和方法</strong>： 
  <ul><li>访问对象的属性：<code>#user.name</code></li><li>调用对象的方法：<code>#user.getName()</code></li></ul> </li><li><strong>运算符</strong>： 
  <ul><li>算术运算：<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></li><li>比较运算：<code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></li><li>逻辑运算：<code>&amp;&amp;</code>, <code>||</code>, <code>!</code></li></ul> </li><li><strong>集合和数组</strong>： 
  <ul><li>访问集合元素：<code>#users[0]</code></li><li>集合操作：<code>#users.size()</code>, <code>#users.isEmpty()</code></li></ul> </li><li><strong>条件运算符</strong>： 
  <ul><li>三元运算符：<code>condition ? trueValue : falseValue</code></li><li>Elvis运算符：<code>expression ?: defaultValue</code></li></ul> </li><li><strong>变量</strong>： 
  <ul><li>定义和使用变量：<code>#variableName</code></li></ul> </li></ol> 
<p>接下来进入Spring Cache注解的学习：</p> 
<h5><a id="322_Cacheable_89"></a>3.2.2 @Cacheable</h5> 
<ul><li><strong>作用</strong>：<code>@Cacheable</code>注解用于标注需要缓存的方法。当该方法被调用时，Spring Cache会先检查缓存中是否存在对应的数据。如果存在，则直接返回缓存数据；如果不存在，则执行方法并将结果存入缓存。</li><li><strong>示例</strong>：<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取用户的逻辑</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li><strong>参数</strong>： 
  <ul><li><code>value</code>：指定缓存的名称。</li><li><code>key</code>：指定缓存的键，可以使用SpEL表达式。</li></ul> </li></ul> 
<h5><a id="323_CachePut_111"></a>3.2.3 @CachePut</h5> 
<ul><li><strong>作用</strong>：<code>@CachePut</code>注解用于标注需要更新缓存的方法。即使缓存中已经存在数据，该方法仍然会执行，并将结果更新到缓存中。</li><li><strong>示例</strong>：<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#user.id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 更新用户的逻辑</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li><strong>参数</strong>： 
  <ul><li><code>value</code>：指定缓存的名称。</li><li><code>key</code>：指定缓存的键，可以使用SpEL表达式。</li></ul> </li></ul> 
<h5><a id="324_CacheEvict_133"></a>3.2.4 @CacheEvict</h5> 
<ul><li><strong>作用</strong>：<code>@CacheEvict</code>注解用于标注需要清除缓存的方法。当该方法被调用时，Spring Cache会清除对应的缓存数据。</li><li><strong>示例</strong>：<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 删除用户的逻辑</span>
        userService<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li><strong>参数</strong>： 
  <ul><li><code>value</code>：指定缓存的名称。</li><li><code>key</code>：指定缓存的键，可以使用SpEL表达式。</li><li><code>allEntries</code>：如果设置为<code>true</code>，则清除缓存中的所有数据。</li></ul> </li></ul> 
<h3><a id="4__157"></a>4. 实现查询数据缓存</h3> 
<h4><a id="41__159"></a>4.1 准备工作</h4> 
<ol><li>Redis安装与配置：</li></ol> 
<blockquote> 
 <p>这里可以自行查找文章进行安装和配置，网上优质文章很多👻。</p> 
</blockquote> 
<ol start="2"><li>创建<code>Product</code>实体类：</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> category<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Integer</span> stock<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>创建枚举类<code>ResultEnum</code>：</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ResultEnum</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/* 成功状态码 */</span>
    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"操作成功！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 错误状态码 */</span>
    <span class="token function">FAIL</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"操作失败！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 参数错误：10001-19999 */</span>
    <span class="token function">PARAM_IS_INVALID</span><span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span> <span class="token string">"参数无效"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PARAM_IS_BLANK</span><span class="token punctuation">(</span><span class="token number">10002</span><span class="token punctuation">,</span> <span class="token string">"参数为空"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PARAM_TYPE_BIND_ERROR</span><span class="token punctuation">(</span><span class="token number">10003</span><span class="token punctuation">,</span> <span class="token string">"参数格式错误"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">PARAM_NOT_COMPLETE</span><span class="token punctuation">(</span><span class="token number">10004</span><span class="token punctuation">,</span> <span class="token string">"参数缺失"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 用户错误：20001-29999*/</span>
    <span class="token function">USER_NOT_LOGGED_IN</span><span class="token punctuation">(</span><span class="token number">20001</span><span class="token punctuation">,</span> <span class="token string">"用户未登录，请先登录"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USER_LOGIN_ERROR</span><span class="token punctuation">(</span><span class="token number">20002</span><span class="token punctuation">,</span> <span class="token string">"账号不存在或密码错误"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USER_ACCOUNT_FORBIDDEN</span><span class="token punctuation">(</span><span class="token number">20003</span><span class="token punctuation">,</span> <span class="token string">"账号已被禁用"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USER_NOT_EXIST</span><span class="token punctuation">(</span><span class="token number">20004</span><span class="token punctuation">,</span> <span class="token string">"用户不存在"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">USER_HAS_EXISTED</span><span class="token punctuation">(</span><span class="token number">20005</span><span class="token punctuation">,</span> <span class="token string">"用户已存在"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 系统错误：40001-49999 */</span>
    <span class="token function">FILE_MAX_SIZE_OVERFLOW</span><span class="token punctuation">(</span><span class="token number">40003</span><span class="token punctuation">,</span> <span class="token string">"上传尺寸过大"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">FILE_ACCEPT_NOT_SUPPORT</span><span class="token punctuation">(</span><span class="token number">40004</span><span class="token punctuation">,</span> <span class="token string">"上传文件格式不支持"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">/* 数据错误：50001-599999 */</span>
    <span class="token function">RESULT_DATA_NONE</span><span class="token punctuation">(</span><span class="token number">50001</span><span class="token punctuation">,</span> <span class="token string">"数据未找到"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">DATA_IS_WRONG</span><span class="token punctuation">(</span><span class="token number">50002</span><span class="token punctuation">,</span> <span class="token string">"数据有误"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">DATA_ALREADY_EXISTED</span><span class="token punctuation">(</span><span class="token number">50003</span><span class="token punctuation">,</span> <span class="token string">"数据已存在"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">AUTH_CODE_ERROR</span><span class="token punctuation">(</span><span class="token number">50004</span><span class="token punctuation">,</span> <span class="token string">"验证码错误"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>


    <span class="token comment">/* 权限错误：70001-79999 */</span>
    <span class="token function">PERMISSION_UNAUTHENTICATED</span><span class="token punctuation">(</span><span class="token number">70001</span><span class="token punctuation">,</span> <span class="token string">"此操作需要登陆系统！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_UNAUTHORIZED</span><span class="token punctuation">(</span><span class="token number">70002</span><span class="token punctuation">,</span> <span class="token string">"权限不足，无权操作！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_EXPIRE</span><span class="token punctuation">(</span><span class="token number">70003</span><span class="token punctuation">,</span> <span class="token string">"登录状态过期！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_TOKEN_EXPIRED</span><span class="token punctuation">(</span><span class="token number">70004</span><span class="token punctuation">,</span> <span class="token string">"token已过期"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_LIMIT</span><span class="token punctuation">(</span><span class="token number">70005</span><span class="token punctuation">,</span> <span class="token string">"访问次数受限制"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_TOKEN_INVALID</span><span class="token punctuation">(</span><span class="token number">70006</span><span class="token punctuation">,</span> <span class="token string">"无效token"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">PERMISSION_SIGNATURE_ERROR</span><span class="token punctuation">(</span><span class="token number">70007</span><span class="token punctuation">,</span> <span class="token string">"签名失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 状态码</span>
    <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token comment">// 提示信息</span>
    <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token class-name">ResultEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>创建统一返回结果封装类<code>Result</code>：</li></ol> 
<blockquote> 
 <p>相关文章可以看这里：<a href="http://t.csdnimg.cn/KkCme" rel="nofollow">Spring Boot3统一结果封装</a></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 操作代码</span>
    <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>

    <span class="token comment">// 提示信息</span>
    <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token comment">// 结果数据</span>
    <span class="token class-name">T</span> data<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span> resultCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> resultCode<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> resultCode<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span> resultCode<span class="token punctuation">,</span> <span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> resultCode<span class="token punctuation">.</span><span class="token function">code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> resultCode<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//成功返回封装-无数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//成功返回封装-带数据</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//失败返回封装-使用默认提示信息</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span><span class="token punctuation">.</span><span class="token constant">FAIL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//失败返回封装-使用返回结果枚举提示信息</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">ResultEnum</span> resultCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>resultCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//失败返回封装-使用自定义提示信息</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="42__319"></a>4.2 添加依赖</h4> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="43__332"></a>4.3 修改配置文件</h4> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token comment"># Redis服务器地址</span>
      <span class="token key atrule">host</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>shijun.redis.host<span class="token punctuation">}</span>
      <span class="token comment"># Redis服务器端口</span>
      <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>shijun.redis.port<span class="token punctuation">}</span>
      <span class="token comment"># Redis服务器认证密码</span>
      <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>shijun.redis.password<span class="token punctuation">}</span>
      <span class="token comment"># Redis数据库索引</span>
      <span class="token key atrule">database</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>shijun.redis.database<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="44__348"></a>4.4 配置缓存管理器</h4> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 配置类，用于设置缓存管理器及相关配置，以启用缓存功能
 *
 * @author shijun
 * @date 2024/06/13
 */</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 配置Redis键的序列化方式
     *
     * @return StringRedisSerializer，用于序列化和反序列化Redis中的键
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">keySerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 配置Redis值的序列化方式
     *
     * @return GenericJackson2JsonRedisSerializer，使用Jackson库以JSON格式序列化和反序列化Redis中的值
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">valueSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 缓存前缀，用于区分不同的缓存命名空间，一般以模块名或者服务名命名，这里暂时写cache
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CACHE_PREFIX</span> <span class="token operator">=</span> <span class="token string">"cache:"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 配置缓存管理器，使用Redis作为缓存后端
     *
     * @param redisConnectionFactory Redis连接工厂，用于创建Redis连接
     * @return RedisCacheManager，Redis缓存管理器实例
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">cacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 配置序列化，解决乱码的问题，设置缓存名称的前缀和缓存条目的默认过期时间</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置键的序列化器</span>
                <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token function">keySerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置值的序列化器</span>
                <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token function">valueSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置缓存名称的前缀</span>
                <span class="token punctuation">.</span><span class="token function">computePrefixWith</span><span class="token punctuation">(</span>name <span class="token operator">-&gt;</span> <span class="token constant">CACHE_PREFIX</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">":"</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置缓存条目的默认过期时间为300秒</span>
                <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建非锁定的Redis缓存写入器</span>
        <span class="token class-name">RedisCacheWriter</span> redisCacheWriter <span class="token operator">=</span> <span class="token class-name">RedisCacheWriter</span><span class="token punctuation">.</span><span class="token function">nonLockingRedisCacheWriter</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 返回Redis缓存管理器实例，使用上述配置</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">(</span>redisCacheWriter<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<blockquote> 
 <p><strong>分析：</strong><br> <strong>StringRedisSerializer</strong> ：使用 <code>StringRedisSerializer</code> 将缓存的键序列化为字符串。因为Redis中的键通常是字符串类型，使用字符串序列化器可以确保键在Redis中以可读的形式存储，便于调试和管理。</p> 
 <p><strong>GenericJackson2JsonRedisSerializer</strong> ：使用 <code>GenericJackson2JsonRedisSerializer</code> 将缓存的值序列化为JSON格式，可读性高并且便于人工排查数据。</p> 
</blockquote> 
<h4><a id="45_Spring_Cache_419"></a>4.5 使用Spring Cache注解</h4> 
<blockquote> 
 <p>由于我们的<strong>缓存的数据源来自于数据库</strong>,而数据库的<strong>数据是会发生变化的</strong>,因此,如果当数据库中<strong>数据发生变化,而缓存却没有同步</strong>，此时就会有<strong>数据一致性问题存在</strong>，在一些并发场景会出现问题。</p> 
 <p>这里采用<code>Cache Aside Pattern</code> 即旁路缓存模式：缓存调用者在更新完数据库后再去更新缓存，也称之为双写方案。</p> 
 <ul><li>读流程：<br> <img src="https://images2.imgbox.com/df/75/QinTT2Cq_o.png" alt="image-20240613224855076"></li></ul> 
 <p><strong>分析：</strong></p> 
 <ol><li>应用程序首先从缓存中查找数据。</li><li>如果缓存命中，则直接返回缓存中的数据。</li><li>如果缓存未命中，则从数据库中读取数据，并将读取到的数据写入缓存，以便</li><li>后续请求可以直接从缓存中获取。</li></ol> 
 <ul><li>写流程<br> <img src="https://images2.imgbox.com/0e/65/rxA4doEr_o.png" alt="image-20240613221100300"></li></ul> 
 <p><strong>分析：</strong></p> 
 <ol><li>应用程序首先更新数据库中的数据。</li><li>然后使缓存中的对应数据失效</li></ol> 
</blockquote> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span><span class="token punctuation">(</span><span class="token string">"/products"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductController</span> <span class="token punctuation">{<!-- --></span>


    <span class="token comment">/**
     * 根据ID获取产品信息
     * 通过@Cacheable注解，当请求的产品ID在缓存中存在时，直接从缓存中获取产品信息，减少数据库查询
     *
     * @param id 产品ID
     * @return 返回查询结果，包含指定ID的产品信息
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/getProductById"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"productsCache"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Product</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProductById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 当从数据库获取数据时会打印，如果是从缓存中查询并不会执行到这里。</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"从数据库获取产品: id = {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Product</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">"product"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"课本"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 更新产品信息
     * 通过@CacheEvict注解，当更新产品时，清除缓存中对应产品的数据，确保获取到最新的数据
     * 设置allEntries为true，表示清除整个缓存中的所有产品数据
     *
     * @param product 产品对象，包含更新后的详细信息
     * @return 返回更新结果，成功更新时返回成功标志
     */</span>
    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">"/updateProduct"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"productsCache"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#product.id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">updateProduct</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Product</span> product<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 更新操作</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 删除指定ID的产品
     * 通过@CacheEvict注解，当删除产品时，清除缓存中对应产品的数据
     *
     * @param id 待删除产品的ID
     * @return 返回删除结果，成功删除时返回成功标志
     */</span>
    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">"/deleteProductById"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"productsCache"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#id"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">deleteProductById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 删除操作</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="46__502"></a>4.6 测试</h4> 
<h5><a id="461__504"></a>4.6.1 查询测试</h5> 
<blockquote> 
 <p>因为我们在查询接口上使用的<code>@Cacheable</code>接口，所以当执行查询操作时，第一次查询会从数据库中获取，因此会输出「从数据库获取产品: id = x」，此时查看Redis控制台会发现出现一个对应的缓存，之后的每次查询都会从Redis中查询（控制台不会输出「从数据库获取产品: id = x」），直到对应的缓存数据时间结束。</p> 
</blockquote> 
<ol><li>发送查询请求：</li></ol> 
<img src="https://images2.imgbox.com/f2/78/70wN8cQG_o.png" alt="image-20240613203320506"> 
<ol start="2"><li>查看Redis中的缓存数据：</li></ol> 
<blockquote> 
 <p>通过观察可以发现<code>CacheConfig</code>类中的序列化配置起作用了，Redis中的数据不再是一堆乱码，并且在右上角还有我们之前配置的缓存的过期时间（我们之前配置的300s）。</p> 
</blockquote> 
<img src="https://images2.imgbox.com/12/bb/U3p7ov1c_o.png" alt="image-20240613203847598"> 
<ol start="3"><li>查看控制台发现本次查询为从数据库查询：</li></ol> 
<img src="https://images2.imgbox.com/0e/ed/eJfzaImq_o.png" alt="image-20240613212356495"> 
<ol start="4"><li>再次发送会发现数据成功的查询了：</li></ol> 
<img src="https://images2.imgbox.com/b1/32/GwJkwKSi_o.png" alt="image-20240613203438434"> 
<ol start="5"><li>再次查询控制台发现并没有输出<code>从数据库获取产品: id = 1</code>，说明本次查询为从Redis缓存中获取数据。</li></ol> 
<img src="https://images2.imgbox.com/4b/73/cgSZKngP_o.png"> 
<h5><a id="462__528"></a>4.6.2 更新、删除测试</h5> 
<blockquote> 
 <p>因为之前我们在更新和删除接口上使用的<code>@CacheEvict</code>注解，所以当执行更新或者删除操作时，会将Redis中对应的产品缓存数据删除。</p> 
</blockquote> 
<ol><li>分别发送更新请求和删除请求，然后再次查看Redis中的缓存数据：</li></ol> 
<img src="https://images2.imgbox.com/92/97/jBcQPtIy_o.png" alt="image-20240613215742944"> 
<img src="https://images2.imgbox.com/ac/8e/PcolsUid_o.png" alt="image-20240613221930757"> 
<ol start="2"><li>可以发现Redis当中对应的缓存数据被删除了，符合我们的设计：</li></ol> 
<img src="https://images2.imgbox.com/fa/8c/7JkePNbn_o.png" alt="image-20240613204329734"> 
<h3><a id="5__542"></a>5. 总结</h3> 
<p>在本文中，我们详细介绍了如何在Spring Boot项目中使用Spring Cache和Redis实现数据缓存，并简单讲解了使用<code>Cache Aside Pattern</code>来解决数据一致性问题，希望对大家学习有所帮助。如有问题，大家可以私信或者在评论区询问😊。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/917278123655601fba881ae74a674547/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于SSM&#43;Jsp的在线教育资源管理系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c193db648f05cf870e5954ad599695b9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【C&#43;&#43;】类和对象（下）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>