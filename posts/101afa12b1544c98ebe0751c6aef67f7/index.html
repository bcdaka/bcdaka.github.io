<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AI 绘画Stable Diffusion 研究（十七）SD lora 详解（上） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/101afa12b1544c98ebe0751c6aef67f7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="AI 绘画Stable Diffusion 研究（十七）SD lora 详解（上）">
  <meta property="og:description" content="大家好，我是风雨无阻。
本期内容：
Lora的原理是什么？Lora如何下载安装？Lora如何使用？ 大家还记得 AI 绘画Stable Diffusion 研究（三）sd模型种类介绍及安装使用详解 这篇文章中，曾简单介绍了Lora的安装和使用吗 ？
但是我们并不清楚LORA 的原理是什么？以及使用过程中有什么技巧 ？
其实LORA 与 embedding 、Hypernetwork 在本质上类似，不过因为携带着大量的训练数据，所以 LORA 对人物和细节特征的复刻更加细腻（效果最好）、使用频率也是最高的。
因此我们在这里将重点介绍 LORA 模型相关的知识：包含LORA模型的原理、安装、使用、Lora模型的类型。
由于篇幅原因，这里将分为上、下两节进行详细讲解。
一、LORA 的原理
1、Lora是什么 ？
LORA，英文全称Low-Rank Adaptation of LargeLanguage Models，直译为大语言模型的低阶适应。这是微软的研究人员为了解决大语言模型微调而开发的一项技术。
LORA是一种在消耗更少内存的情况下，加速大型模型训练的训练方法，在stable diffusion中它允许使用低阶适应技术来快速微调扩散模型。简而言之，LoRA训练模型可以更轻松地针对不同概念（例如角色或特定风格）进行模型训练。这些经过训练的模型可以被导出并供其他人使用。
LORA模型是小型的stable diffusion模型，对checkpoint模型 cross-attention layers（交叉注意力层）进行了较小的更改，但是它的体积只有checkpoint的1/100到1/10，文件大小一般在2-500MB之间。
从上图我们可以看到 LORA 对模型产生作用的环节是在 Noise predictor 。
下图是对上图放大以后的内部结构，LORA 是对 crossattention 进行更改。
在上一篇文章中，我们已经对比了三者的区别，感兴趣的朋友，请前往查看AI 绘画Stable Diffusion 研究（十六）SD Hypernetwork详解。
二、LORA 的下载安装
1、打开c站筛选LORA模型
点击右侧 -&gt;漏斗图标 ，下拉菜单中选择 LORA
2、选择搜索结果中，喜欢的lora 模型进行下载
这里以 原神lora 模型为例进行演示：
下载完成后，会得到 Eula.safetensors 文件">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-27T12:17:26+08:00">
    <meta property="article:modified_time" content="2023-08-27T12:17:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AI 绘画Stable Diffusion 研究（十七）SD lora 详解（上）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <br> 
<p>大家好，我是风雨无阻。<br> <br><br> <strong>本期内容：</strong></p> 
<ul><li>Lora的原理是什么？</li><li>Lora如何下载安装？</li><li>Lora如何使用？</li></ul> 
<br> 
<p>大家还记得 <a href="https://blog.csdn.net/lizhong2008/article/details/132033414%5B">AI 绘画Stable Diffusion 研究（三）sd模型种类介绍及安装使用详解</a> 这篇文章中，曾简单介绍了Lora的安装和使用吗 ？</p> 
<br> 
<p>但是我们并不清楚LORA 的原理是什么？以及使用过程中有什么技巧 ？</p> 
<br> 
<p>其实LORA 与 embedding 、Hypernetwork 在本质上类似，不过因为携带着大量的训练数据，所以 LORA 对人物和细节特征的复刻更加细腻（效果最好）、使用频率也是最高的。</p> 
<br> 
<p>因此我们在这里将重点介绍 LORA 模型相关的知识：包含LORA模型的原理、安装、使用、Lora模型的类型。</p> 
<p>由于篇幅原因，这里将分为上、下两节进行详细讲解。<br> <br></p> 
<p><strong>一、LORA 的原理</strong></p> 
<br> 
<p><strong>1、Lora是什么 ？</strong></p> 
<p>LORA，英文全称Low-Rank Adaptation of LargeLanguage Models，直译为大语言模型的低阶适应。这是微软的研究人员为了解决大语言模型微调而开发的一项技术。</p> 
<br> 
<p>LORA是一种在消耗更少内存的情况下，加速大型模型训练的训练方法，在stable diffusion中它允许使用低阶适应技术来快速微调扩散模型。简而言之，LoRA训练模型可以更轻松地针对不同概念（例如角色或特定风格）进行模型训练。这些经过训练的模型可以被导出并供其他人使用。</p> 
<br> 
<p>LORA模型是小型的stable diffusion模型，对checkpoint模型 <strong>cross-attention layers</strong>（交叉注意力层）进行了较小的更改，但是它的体积只有checkpoint的1/100到1/10，文件大小一般在2-500MB之间。</p> 
<br> 
<p><img src="https://images2.imgbox.com/90/e8/bk8rsjqP_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>从上图我们可以看到 LORA 对模型产生作用的环节是在 <strong>Noise predictor</strong> 。</p> 
<p>下图是对上图放大以后的内部结构，LORA 是对 <strong>crossattention</strong> 进行更改。</p> 
<br> 
<p><img src="https://images2.imgbox.com/20/b4/RoQNy4pC_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>在上一篇文章中，我们已经对比了三者的区别，感兴趣的朋友，请前往查看<a href="https://blog.csdn.net/lizhong2008/article/details/132508540">AI 绘画Stable Diffusion 研究（十六）SD Hypernetwork详解</a>。</p> 
<br> 
<p><strong>二、LORA 的下载安装</strong></p> 
<br> 
<p><strong>1、打开<a href="https://civitai.com/" rel="nofollow">c站</a>筛选LORA模型</strong></p> 
<p>点击右侧 -&gt;漏斗图标 ，下拉菜单中选择 LORA</p> 
<br> 
<p><img src="https://images2.imgbox.com/5d/e8/x2L5MsZo_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>2、选择搜索结果中，喜欢的lora 模型进行下载</strong></p> 
<br> 
<p>这里以 原神lora 模型为例进行演示：</p> 
<br> 
<p><img src="https://images2.imgbox.com/3f/8b/pmTKfCtW_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>下载完成后，会得到 Eula.safetensors 文件</p> 
<p><img src="https://images2.imgbox.com/1a/20/tmOUrrpC_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>3、 安装 lora 模型</strong></p> 
<br> 
<p>将下载后的Eula.safetensors 文件，拷贝到 Lora 目录：</p> 
<pre><code>\sd-webui-aki-v4.2\models\Lora
</code></pre> 
<br> 
<p><img src="https://images2.imgbox.com/b2/52/RC76QCjt_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>4、 下载安装lora 模型对应的 chekpoint 模型</strong></p> 
<br> 
<p>在右侧可以看到 lora 模型对应的 chekpoint 模型 是 xxmix9realistic_v40 。</p> 
<p>直接点击chekpoint 下方的“下载”按钮进行下载。</p> 
<br> 
<p><img src="https://images2.imgbox.com/16/2c/WbhQU29S_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>下载完成，会得到 xxmix9realistic_v40.safetensors 文件。</p> 
<p><img src="https://images2.imgbox.com/b0/a9/K7zoEXvs_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>5、 安装 chekpoint 模型</strong></p> 
<p>将 xxmix9realistic_v40.safetensors 文件 拷贝到Stable-diffusion 目录：</p> 
<br> 
<pre><code>\sd-webui-aki-v4.2\models\Stable-diffusion
</code></pre> 
<br> 
<p><img src="https://images2.imgbox.com/89/6d/xmEo6z7x_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>安装完成后，重启 Stable diffusion 使其生效。</p> 
<br> 
<p><strong>三、LORA 的使用</strong></p> 
<br> 
<p>LORA的使用方法与<a href="https://blog.csdn.net/lizhong2008/article/details/132483369">Embeddings</a>和<a href="https://blog.csdn.net/lizhong2008/article/details/132508540">Hypernetwork</a>一样，为了方便新朋友的理解，这里详细演示一下步骤。</p> 
<br> 
<p><strong>1、选择刚才安装的 chekpoint 模型</strong></p> 
<p><img src="https://images2.imgbox.com/1f/71/AxuFqQD9_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>2、输入参数</strong></p> 
<ul><li> <p>正向提示词</p> <pre><code>(((best quality, masterpiece, good anatomy))), eula_in_genshin, cowboy shot, 1girl, blue short hair, black hairband,a leotard with a white top and black bottom, white long sleeves, blue necktie, jewelry on the shoulder, upper body,outdoors, castle, streets, green plants, flowers,
</code></pre> </li></ul> 
<br> 
<p><img src="https://images2.imgbox.com/1c/3d/TFyRd0j2_o.png" alt="在这里插入图片描述"></p> 
<br> 
<ul><li> <p>反向提示词</p> <pre><code>ng_deepnegative_v1_75t, (badhandv4:1.5), (worst quality:2),(lower eyelashes:2), (low quality:2), (normal quality:2),(holding:2),(gloves:2),(blue gloves:2),(black gloves:2),lowres, bad anatomy, bad hands, ((monochrome)), ((grayscale)) ,watermark
</code></pre> </li></ul> 
<br> 
<p><img src="https://images2.imgbox.com/44/bb/ti4MZd9G_o.png" alt="在这里插入图片描述"></p> 
<br> 
<ul><li> <p>采样方法:DPM++ 2M Karras</p> </li><li> <p>迭代步数:40</p> </li><li> <p>随机种子:1831064945</p> </li><li> <p>CFG Scale:21</p> <br> </li></ul> 
<p><img src="https://images2.imgbox.com/a6/bf/nynuE7lb_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>3、重点来了，选择刚安装的 lora 模型</strong></p> 
<p><strong>（1）、点击生成按钮下方的红色图标</strong></p> 
<br> 
<p><img src="https://images2.imgbox.com/7a/dd/MImpICPn_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>切换到lora模型标签</strong></p> 
<p><img src="https://images2.imgbox.com/04/39/yiTnMgq8_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>（2）、lora 标签页面选择 刚安装的模型 Eula</strong></p> 
<br> 
<p><img src="https://images2.imgbox.com/0d/06/WKCvewlI_o.png" alt="在这里插入图片描述"></p> 
<br> 此时，正向提示词输入框中会自动添加 LORA 模型，如下： 
<p><img src="https://images2.imgbox.com/63/c9/pCsbDSHD_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>（3）、点击生成按钮 ，查看效果</strong></p> 
<p><img src="https://images2.imgbox.com/b9/65/iqOpyp9b_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p><strong>（4）、使用技巧：</strong></p> 
<ul><li> <p>我们可以<strong>调整权重</strong>来调高或调低效果</p> <p>将权重设置为 0 会禁用 LoRA 模型，可以在 0 和 1 之间调整样式效果。</p> <p>需要注意的是，每个 LORA 模型对输出图像的权重设置是非常重要的。权重设置越大，对画面的影响因素就越浅。通常情况下，权重 应该控制在 0.7-1 之间。如果权重过高，会大幅度影响出图的质量。</p> <br> </li><li> <p>通常来说，每个 LORA 模型都有对应的底膜和触发词汇。我们可以查看 LORA 作者产出的相关图片，从中获取模型信息，并从中选择一些提示词和排除词来指定生成图像的方向。</p> <br> </li></ul> 
<p>例如这个模型的介绍页面就有触发词的说明：</p> 
<p><img src="https://images2.imgbox.com/39/c5/qHeOMTA4_o.png" alt="在这里插入图片描述"></p> 
<br> 
<p>触发词为：</p> 
<pre><code>eula_in_genshin, cowboy shot, 1girl, blue medium hair, black hairband,a leotard with a white top and black bottom, white long sleeves, blue necktie, jewelry on the shoulder, black thighhighs, high heels,
</code></pre> 
<br> 
<p>也就是我们正向提示词里面的内容：</p> 
<p><img src="https://images2.imgbox.com/85/e3/mmm7Uawg_o.png" alt="在这里插入图片描述"></p> 
<br> 
<ul><li>与Embeddings类似，可以同时使用多个LoRA模型，还可以将它们与embeddings一起使用。</li></ul> 
<br> 
<ul><li>在 AUTOMATIC1111 中，LoRA 短语不是提示词的一部分，LoRA模型应用后将被移除，这意味着不能将提示词语法使用在lora模型短语上。</li></ul> 
<br> 
<p>好了，今天的内容就介绍到这里，下一篇，我们将继续介绍Lora 模型的类型，敬请关注。</p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d2b5c055d3fe8378fb9856eb59ce9db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">自动驾驶算法/规划决策控制算法面经汇总、学习路线、面经心得</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/547fb65a1073e8d7184c68251787ac92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">kafka下载与安装教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>