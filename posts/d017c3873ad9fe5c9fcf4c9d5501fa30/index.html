<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python WAV音频文件处理—— (1)读写WAV文件 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d017c3873ad9fe5c9fcf4c9d5501fa30/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python WAV音频文件处理—— (1)读写WAV文件">
  <meta property="og:description" content="原文
代码
了解WAV文件格式 WAV是一种波形音频文件格式(Waveform Audio File Format)。虽然是一种古老的格式（九十年代初开发），但今天仍然可以看到这种文件。
WAV具有简单、可移植、高保真等特点。
WAV的波形 声音是一种波，可以用3个属性描述：
振幅(Amplitude) 表示声波强度，可视为响度。频率(Frequency)，波长的倒数，对应音高。相位(Phase)波开始时对应波周期中的位置。 如果你用音频软件（如Audacity）打开WAV文件，可能看到这样的波形
WAV 文件的结构 WAV 音频文件格式是一种二进制格式，结构如下：
Header 是一组元数据，描述了如何解释接下来的Frame。
Header中的参数说明：
Encoding：编码。样音频信号的数字表示。可用的编码类型包括未压缩的线性脉冲编码调制 （PCM） 和一些压缩格式，如 ADPCM、A-Law 或 μ-Law。Channels：声道数。每帧中的声道数，对于单声道，通常等于 1 个，对于立体声音轨，通常等于 2 个，但对于环绕声录音，可能会更多。Frame Rate：帧速率。也称采样率。Bit Depth：位深度，每个音的比特位数。位深度越大，编码信号的动态范围越大，越能表现声音的细微差别。 为了忠实地表现音乐，大多数 WAV 文件使用立体声 PCM 编码，其中 16 位有符号整数以 44.1 kHz 采样。这些参数对应于标准 CD 质量的音频。巧合的是，这样的采样频率大约是大多数人能听到的最高频率的两倍。根据 Nyquist-Shannon 采样定理，这足以以数字形式捕获声音而不会失真。
Python的wave模块 wave 模块负责读取和写入 WAV 文件（但不能播放声音）。
使用wave.open 读取wav文件将返回一个 wave.Wave_read object。
import wave with wave.open(&#34;Bongo_sound.wav&#34;) as wav_file: print(wav_file) 可以使用该对象检索存储在 WAV 文件Header信息并读取编码的音频帧：
&gt;&gt;&gt; with wave.open(&#34;Bongo_sound.wav&#34;) as wav_file: .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-08T16:03:51+08:00">
    <meta property="article:modified_time" content="2024-04-08T16:03:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python WAV音频文件处理—— (1)读写WAV文件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><a href="https://realpython.com/python-wav-files/#visualize-audio-samples-as-a-waveform" rel="nofollow">原文</a><br> <a href="https://github.com/realpython/materials/tree/master/python-wav-files">代码</a></p> 
</blockquote> 
<h2><a id="WAV_3"></a>了解WAV文件格式</h2> 
<p><strong>WAV</strong>是一种波形音频文件格式(Waveform Audio File Format)。虽然是一种古老的格式（九十年代初开发），但今天仍然可以看到这种文件。<br> WAV具有<strong>简单、可移植、高保真</strong>等特点。</p> 
<h3><a id="WAV_7"></a>WAV的波形</h3> 
<p>声音是一种波，可以用3个属性描述：</p> 
<ul><li><strong>振幅</strong>(Amplitude) 表示声波强度，可视为响度。</li><li><strong>频率</strong>(Frequency)，波长的倒数，对应音高。</li><li><strong>相位</strong>(Phase)波开始时对应波周期中的位置。</li></ul> 
<p>如果你用音频软件（如Audacity）打开WAV文件，可能看到这样的波形<br> <img src="https://images2.imgbox.com/9c/ef/fyqmacEW_o.png" alt="Audacity中的波形--振幅随时间变化"></p> 
<h3><a id="WAV__16"></a>WAV 文件的结构</h3> 
<p>WAV 音频文件格式是一种二进制格式，结构如下：<br> <img src="https://images2.imgbox.com/98/ca/2hkO11ge_o.png" alt="WAV文件格式"><br> <strong>Header</strong> 是一组元数据，描述了如何解释接下来的Frame。<br> Header中的参数说明：</p> 
<ul><li><strong>Encoding</strong>：编码。样音频信号的数字表示。可用的编码类型包括未压缩的<strong>线性脉冲编码调制 （PCM）</strong> 和一些压缩格式，如 ADPCM、A-Law 或 μ-Law。</li><li><strong>Channels</strong>：声道数。每帧中的声道数，对于单声道，通常等于 1 个，对于立体声音轨，通常等于 2 个，但对于环绕声录音，可能会更多。</li><li><strong>Frame Rate</strong>：帧速率。也称采样率。</li><li><strong>Bit Depth</strong>：位深度，每个音的比特位数。位深度越大，编码信号的动态范围越大，越能表现声音的细微差别。</li></ul> 
<p>为了忠实地表现音乐，大多数 WAV 文件使用立体声 PCM 编码，其中 16 位有符号整数以 44.1 kHz 采样。这些参数对应于标准 CD 质量的音频。巧合的是，这样的采样频率大约是大多数人能听到的最高频率的两倍。根据 Nyquist-Shannon 采样定理，这足以以数字形式捕获声音而不会失真。</p> 
<h2><a id="Pythonwave_27"></a>Python的wave模块</h2> 
<p><code>wave</code> 模块负责<strong>读取</strong>和<strong>写入</strong> WAV 文件（但不能播放声音）。</p> 
<p>使用<code>wave.open</code> 读取wav文件将返回一个 <code>wave.Wave_read object</code>。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> wave
<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Bongo_sound.wav"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>wav_file<span class="token punctuation">)</span>
</code></pre> 
<p>可以使用该对象检索存储在 WAV 文件<strong>Header</strong>信息并读取编码的<strong>音频帧</strong>：</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"Bongo_sound.wav"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     metadata <span class="token operator">=</span> wav_file<span class="token punctuation">.</span>getparams<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># header </span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     frames <span class="token operator">=</span> wav_file<span class="token punctuation">.</span>readframes<span class="token punctuation">(</span>metadata<span class="token punctuation">.</span>nframes<span class="token punctuation">)</span> <span class="token comment"># frame</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> metadata
_wave_params<span class="token punctuation">(</span>
    nchannels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
    sampwidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>
    framerate<span class="token operator">=</span><span class="token number">44100</span><span class="token punctuation">,</span>
    nframes<span class="token operator">=</span><span class="token number">212419</span><span class="token punctuation">,</span>
    comptype<span class="token operator">=</span><span class="token string">'NONE'</span><span class="token punctuation">,</span>
    compname<span class="token operator">=</span><span class="token string">'not compressed'</span>
<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> frames
<span class="token string">b'\x01\x00\xfe\xff\x02\x00\xfe\xff\x01\x00\x01\x00\xfe\xff\x02\x00...'</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>frames<span class="token punctuation">)</span>
<span class="token number">424838</span>
</code></pre> 
<p>读取的<strong>帧</strong>是<strong>原始比特</strong>(bytes)，我们需要手动解码。从Header中我们看到，每个音占2个字节(16位）。<br> 我们可以用<code>array</code>模块：</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> array
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> pcm_samples <span class="token operator">=</span> array<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token string">"h"</span><span class="token punctuation">,</span> frames<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pcm_samples<span class="token punctuation">)</span>
<span class="token number">212419</span>
</code></pre> 
<p>或者使用<code>struct</code>模块：</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> struct
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> format_string <span class="token operator">=</span> <span class="token string">"&lt;"</span> <span class="token operator">+</span> <span class="token string">"h"</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>frames<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> pcm_samples <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span>format_string<span class="token punctuation">,</span> frames<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pcm_samples<span class="token punctuation">)</span>
<span class="token number">212419</span>
</code></pre> 
<p><code>&lt;</code>符号指示字节为小端格式(little-endian)。</p> 
<p><code>numpy</code>提供了更简单的方法：</p> 
<pre><code class="prism language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> pcm_samples <span class="token operator">=</span> np<span class="token punctuation">.</span>frombuffer<span class="token punctuation">(</span>frames<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"&lt;h"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> normalized_amplitudes <span class="token operator">=</span> pcm_samples <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">**</span> <span class="token number">15</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>numpy简洁高效，后面都使用numpy进行处理。</p> 
</blockquote> 
<h3><a id="WAV_88"></a>写WAV文件</h3> 
<p>从数学上讲，您可以将任何复杂声音表示为多个不同频率、振幅和相位的正弦波的总和。<br> <img src="https://images2.imgbox.com/b8/a4/qq1QElzL_o.png" alt="正弦波"><br> 由于振幅A被缩放到[-1，1]之间，并且我们不关心相位，因此正弦波可以简化为：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math

FRAMES_PER_SECOND <span class="token operator">=</span> <span class="token number">44100</span>

<span class="token keyword">def</span> <span class="token function">sound_wave</span><span class="token punctuation">(</span>frequency<span class="token punctuation">,</span> num_seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> frame <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>num_seconds <span class="token operator">*</span> FRAMES_PER_SECOND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time <span class="token operator">=</span> frame <span class="token operator">/</span> FRAMES_PER_SECOND
        amplitude <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">*</span> frequency <span class="token operator">*</span> time<span class="token punctuation">)</span>
        <span class="token keyword">yield</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>amplitude <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span>
</code></pre> 
<p>现在，我们可以生成声音了。<br> 下面我们生成一个频率为440Hz、持续2.5s的声音：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> wave

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.wav"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
    wav_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span>FRAMES_PER_SECOND<span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>sound_wave<span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>使用声音软件打开生成的文件，听到嘟的一声。</p> 
</blockquote> 
<h3><a id="_121"></a>混合和立体声</h3> 
<p>为了合成立体声，<br> 我们需要制造左右<strong>两个声道</strong>的声音，并在每一帧<strong>交替播放</strong>。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itertools
<span class="token keyword">import</span> math
<span class="token keyword">import</span> wave

FRAMES_PER_SECOND <span class="token operator">=</span> <span class="token number">44100</span>

<span class="token keyword">def</span> <span class="token function">sound_wave</span><span class="token punctuation">(</span>frequency<span class="token punctuation">,</span> num_seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> frame <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>num_seconds <span class="token operator">*</span> FRAMES_PER_SECOND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time <span class="token operator">=</span> frame <span class="token operator">/</span> FRAMES_PER_SECOND
        amplitude <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">*</span> frequency <span class="token operator">*</span> time<span class="token punctuation">)</span>
        <span class="token keyword">yield</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>amplitude <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span>

left_channel <span class="token operator">=</span> sound_wave<span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
right_channel <span class="token operator">=</span> sound_wave<span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
<span class="token comment"># 交替播放 两个声道</span>
stereo_frames <span class="token operator">=</span> itertools<span class="token punctuation">.</span>chain<span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">zip</span><span class="token punctuation">(</span>left_channel<span class="token punctuation">,</span> right_channel<span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.wav"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
    wav_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 2 channel</span>
    wav_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span>FRAMES_PER_SECOND<span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>stereo_frames<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>或者，与其为声波分配单独的声道，不如将它们<strong>混合</strong>在一起以创建有趣的效果。<br> 混合两种声音的效果等同于将两个声音的<strong>振幅相加</strong>：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> wave

FRAMES_PER_SECOND <span class="token operator">=</span> <span class="token number">44100</span>

<span class="token keyword">def</span> <span class="token function">beat</span><span class="token punctuation">(</span>frequency1<span class="token punctuation">,</span> frequency2<span class="token punctuation">,</span> num_seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> frame <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">(</span>num_seconds <span class="token operator">*</span> FRAMES_PER_SECOND<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time <span class="token operator">=</span> frame <span class="token operator">/</span> FRAMES_PER_SECOND
        amplitude1 <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">*</span> frequency1 <span class="token operator">*</span> time<span class="token punctuation">)</span>
        amplitude2 <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi <span class="token operator">*</span> frequency2 <span class="token operator">*</span> time<span class="token punctuation">)</span>
        amplitude <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>amplitude1 <span class="token operator">+</span> amplitude2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>amplitude <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.wav"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
    wav_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span>FRAMES_PER_SECOND<span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>beat<span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">441</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_172"></a>使用更高的位深度</h3> 
<p>到目前为止，您一直使用单个字节(<strong>8位</strong>)来表示每个音频样本，以保持简单。这为您提供了 256 个不同的振幅级别，足以满足您的需求。但是，您迟早会希望提高位深度，以实现更大的动态范围和更好的音质。</p> 
<p>切换到更高的位深度时，必须相应地调整<strong>缩放</strong>和<strong>字节转换</strong>。您可以使用 NumPy 优雅地表达声波方程并有效地处理字节转换：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> wave

FRAMES_PER_SECOND <span class="token operator">=</span> <span class="token number">44100</span>

<span class="token keyword">def</span> <span class="token function">sound_wave</span><span class="token punctuation">(</span>frequency<span class="token punctuation">,</span> num_seconds<span class="token punctuation">)</span><span class="token punctuation">:</span>
    time <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> num_seconds<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> FRAMES_PER_SECOND<span class="token punctuation">)</span>
    amplitude <span class="token operator">=</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> frequency <span class="token operator">*</span> time<span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>
        np<span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span>amplitude <span class="token operator">*</span> <span class="token number">32768</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">32768</span><span class="token punctuation">,</span>
        <span class="token number">32767</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"&lt;h"</span><span class="token punctuation">)</span>

left_channel <span class="token operator">=</span> sound_wave<span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
right_channel <span class="token operator">=</span> sound_wave<span class="token punctuation">(</span><span class="token number">480</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">)</span>
stereo_frames <span class="token operator">=</span> np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>left_channel<span class="token punctuation">,</span> right_channel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>flatten<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"output.wav"</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> wav_file<span class="token punctuation">:</span>
    wav_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 2 bytes == 16 bits </span>
    wav_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span>FRAMES_PER_SECOND<span class="token punctuation">)</span>
    wav_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span>stereo_frames<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b44cc3ced72c059c66cfefeb780130b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mac上搭建鸿蒙开发环境（2024）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/941459316b777eb39d4bacdd7aaf2de1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">怎么获取iPhone手机的UUID，Windows和Mac电脑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>