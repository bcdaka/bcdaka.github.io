<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】：string类底层的模拟实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/fa95d2294ac18689acb6e67e2a397995/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】：string类底层的模拟实现">
  <meta property="og:description" content="目录 引言1，构造函数2，析构函数3，取出字符串的地址4，计算有效数据个数5，[ ]运算符重载6，简单迭代器7，预开空间(扩容)8，尾插一个字符9，尾插一个字符串10，&#43;=运算符重载11，在pos位置插入字符/字符串11.1 在pos位置插入字符11.2 尾插一个字符串 12，从pos位置开始删除长度为len的字符串13，从pos位置开始查找字符/字符串13.1 查找字符13.2 查找字符串 14，拷贝构造(传统)15，=赋值拷贝(传统)16，交换函数swap17，从pos位置开始取len个字符的串18. 字符串的比较19，清除函数clear20，流插入，流提取20.1 流插入20.2 流提取 21，拷贝构造和赋值拷贝的现代写法(重点)21.1 拷贝构造21.2 赋值拷贝 引言 点击跳转到文章：【string类的基本使用】
上一篇文章已经对string类进行了简单的介绍，大家只要能够正常使用即可。
这篇文章主要是对string类的一些重点接口函数进行模拟实现。本文依然采用多文件的方式，string.h放类的声明，string.cpp放成员函数的定义。
string.h
#pragma once #include &lt;iostream&gt; #include &lt;assert.h&gt; #include &lt;stdbool.h&gt; using namespace std; //定义一个叫做bit的命名空间，隔离C&#43;&#43;库里的string类 namespace bit { class string { public: //typedef实现二次封装 //由于string类是连续的空间，所以可以定义为原生指针 typedef char* iterator; //const迭代器，指针指向的内容不能修改 typedef const char* const_iterator; //实现迭代器,一定要实现为begin 和end //迭代器屏蔽了底层细节，提供了一种简单通用的访问容器的方式 iterator begin(); iterator end(); const_iterator begin()const; const_iterator end()const; // string();//无参构造 //有参与无参构造用全缺省进行合并,在声明处给缺省值 string(const char* str = &#34;&#34;);//传参构造 //析构函数 ~string(); //拷贝构造 string(const string&amp; s); //赋值运算重载(传统) //string&amp; operator=(const string&amp; s); //赋值运算重载(现代) string&amp; operator=(string tmp); const char* c_str() const; //用下标的方式遍历字符串 size_t size()const; char&amp; operator[](size_t pos); const char&amp; operator[](size_t pos)const; //用于扩容，一般不缩容 void reserve(size_t n); void push_back(char ch);//尾插一个字符 void append(const char* str);//尾插字符串 //用运算符重载实现尾插 string&amp; operator&#43;=(char ch); string&amp; operator&#43;=(const char* str); //在指定位置插入 字符或是字符串 void insert(size_t pos, char ch); void insert(size_t pos, const char* str); //在指定位置删除长度为len void erase(size_t pos = 0, size_t len = npos); //从pos位置开始找字符或是字符串 size_t find(char ch, size_t pos =0); size_t find(const char* str, size_t pos = 0); //交换函数 void swap(string&amp; s); //从pos位置找一个子串 string substr(size_t pos = 0, size_t len = npos); //字符串的比较 bool operator&lt;(const string&amp; s)const; bool operator&gt;(const string&amp; s)const; bool operator&lt;=(const string&amp; s)const; bool operator&gt;=(const string&amp; s)const; bool operator==(const string&amp; s)const; bool operator!">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-02T10:19:09+08:00">
    <meta property="article:modified_time" content="2024-06-02T10:19:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】：string类底层的模拟实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">引言</a></li><li><a href="#1_121" rel="nofollow">1，构造函数</a></li><li><a href="#2_136" rel="nofollow">2，析构函数</a></li><li><a href="#3_146" rel="nofollow">3，取出字符串的地址</a></li><li><a href="#4_154" rel="nofollow">4，计算有效数据个数</a></li><li><a href="#5__163" rel="nofollow">5，[ ]运算符重载</a></li><li><a href="#6_186" rel="nofollow">6，简单迭代器</a></li><li><a href="#7_216" rel="nofollow">7，预开空间(扩容)</a></li><li><a href="#8_233" rel="nofollow">8，尾插一个字符</a></li><li><a href="#9_254" rel="nofollow">9，尾插一个字符串</a></li><li><a href="#10_275" rel="nofollow">10，+=运算符重载</a></li><li><a href="#11pos_291" rel="nofollow">11，在pos位置插入字符/字符串</a></li><li><ul><li><a href="#111_pos_292" rel="nofollow">11.1 在pos位置插入字符</a></li><li><a href="#112__375" rel="nofollow">11.2 尾插一个字符串</a></li></ul> 
  </li><li><a href="#12poslen_410" rel="nofollow">12，从pos位置开始删除长度为len的字符串</a></li><li><a href="#13pos_435" rel="nofollow">13，从pos位置开始查找字符/字符串</a></li><li><ul><li><a href="#131__436" rel="nofollow">13.1 查找字符</a></li><li><a href="#132__452" rel="nofollow">13.2 查找字符串</a></li></ul> 
  </li><li><a href="#14_463" rel="nofollow">14，拷贝构造(传统)</a></li><li><a href="#15_480" rel="nofollow">15，=赋值拷贝(传统)</a></li><li><a href="#16swap_502" rel="nofollow">16，交换函数swap</a></li><li><a href="#17poslen_515" rel="nofollow">17，从pos位置开始取len个字符的串</a></li><li><a href="#18__538" rel="nofollow">18. 字符串的比较</a></li><li><a href="#19clear_573" rel="nofollow">19，清除函数clear</a></li><li><a href="#20_583" rel="nofollow">20，流插入，流提取</a></li><li><ul><li><a href="#201__588" rel="nofollow">20.1 流插入</a></li><li><a href="#202__601" rel="nofollow">20.2 流提取</a></li></ul> 
  </li><li><a href="#21_644" rel="nofollow">21，拷贝构造和赋值拷贝的现代写法(重点)</a></li><li><ul><li><a href="#211__645" rel="nofollow">21.1 拷贝构造</a></li><li><a href="#212__663" rel="nofollow">21.2 赋值拷贝</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>引言</h2> 
<p><strong>点击跳转到文章</strong>：<a href="http://t.csdnimg.cn/vfxbf" rel="nofollow">【string类的基本使用】</a><br> 上一篇文章已经对string类进行了简单的介绍，大家只要能够正常使用即可。</p> 
<p>这篇文章主要是对string类的一些重点接口函数进行模拟实现。本文依然采用多文件的方式，<strong>string.h放类的声明，string.cpp放成员函数的定义</strong>。</p> 
<p><mark><strong>string.h</strong></mark></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>

using namespace std<span class="token punctuation">;</span>

<span class="token comment">//定义一个叫做bit的命名空间，隔离C++库里的string类</span>
 namespace bit
<span class="token punctuation">{<!-- --></span>
	 class string
	 <span class="token punctuation">{<!-- --></span>
	 public<span class="token operator">:</span>
		 <span class="token comment">//typedef实现二次封装</span>
		 <span class="token comment">//由于string类是连续的空间，所以可以定义为原生指针</span>
		 <span class="token keyword">typedef</span> <span class="token keyword">char</span><span class="token operator">*</span> iterator<span class="token punctuation">;</span>

		 <span class="token comment">//const迭代器，指针指向的内容不能修改</span>
		 <span class="token keyword">typedef</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> const_iterator<span class="token punctuation">;</span>

		 <span class="token comment">//实现迭代器,一定要实现为begin 和end</span>
		 <span class="token comment">//迭代器屏蔽了底层细节，提供了一种简单通用的访问容器的方式</span>
		 iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		 const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>

		<span class="token comment">// string();//无参构造</span>
		
	    <span class="token comment">//有参与无参构造用全缺省进行合并,在声明处给缺省值</span>
		 <span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//传参构造</span>
		 <span class="token comment">//析构函数</span>
		 <span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token comment">//拷贝构造</span>
		 <span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//赋值运算重载(传统)</span>
		 <span class="token comment">//string&amp; operator=(const string&amp; s);</span>

		 <span class="token comment">//赋值运算重载(现代)</span>
		 string<span class="token operator">&amp;</span> operator<span class="token operator">=</span><span class="token punctuation">(</span>string tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>


		 <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

		 <span class="token comment">//用下标的方式遍历字符串</span>
		 <span class="token class-name">size_t</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 <span class="token keyword">char</span><span class="token operator">&amp;</span> operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>

		 <span class="token comment">//用于扩容，一般不缩容</span>
		 <span class="token keyword">void</span> <span class="token function">reserve</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//尾插一个字符</span>
		 <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//尾插字符串</span>

		 <span class="token comment">//用运算符重载实现尾插</span>
		 string<span class="token operator">&amp;</span> operator<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 string<span class="token operator">&amp;</span> operator<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//在指定位置插入 字符或是字符串</span>
		 <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//在指定位置删除长度为len</span>
		 <span class="token keyword">void</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">size_t</span> len <span class="token operator">=</span> npos<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//从pos位置开始找字符或是字符串</span>
		 <span class="token class-name">size_t</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">,</span> <span class="token class-name">size_t</span> pos <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		 <span class="token class-name">size_t</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token class-name">size_t</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//交换函数</span>
		 <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//从pos位置找一个子串</span>
		 string <span class="token function">substr</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">size_t</span> len <span class="token operator">=</span> npos<span class="token punctuation">)</span><span class="token punctuation">;</span>

		 <span class="token comment">//字符串的比较</span>
		 bool operator<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 bool operator<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 bool operator<span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 bool operator<span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 bool operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>
		 bool operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span><span class="token punctuation">;</span>

		 <span class="token comment">//把当前数据清除，但是不清空间</span>
		 <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	 private<span class="token operator">:</span>
	 	 <span class="token comment">//这里的缺省值时给现代写法的构造函数的</span>
		 <span class="token keyword">char</span><span class="token operator">*</span> _str <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
		 <span class="token class-name">size_t</span> _size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//有效数据个数,指向最后一个有效数据的下一个位置\0</span>
		 <span class="token class-name">size_t</span> _capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//容量</span>

		 <span class="token comment">//特例：静态成员变量只有无符号整形才可以在声明时给缺省值</span>
		 <span class="token comment">//const static size_t npos = -1;//ok</span>

		 <span class="token comment">//const static double d = 2.2;//err</span>

		 <span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token class-name">size_t</span> npos<span class="token punctuation">;</span>
	 <span class="token punctuation">}</span><span class="token punctuation">;</span>

	 <span class="token comment">//流插入，流提取 </span>
	 <span class="token comment">//不适合写成成员函数，涉及第一个参数的位置问题</span>
	 istream<span class="token operator">&amp;</span> operator<span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 ostream<span class="token operator">&amp;</span> operator<span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="1_121"></a>1，构造函数</h2> 
<p>为了避免多次strlen的计算，并且符合声明的顺序，只把_size放在初始化列表，其余放在函数体中。</p> 
<pre><code class="prism language-c">string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
	<span class="token operator">:</span><span class="token function">_size</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//_str = nullptr;//err 防止对空指针的解引用</span>
    
	_str <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span>_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//多开一个是给\0的</span>
	_capacity <span class="token operator">=</span> _size<span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把初始化内容拷贝进空间</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="2_136"></a>2，析构函数</h2> 
<pre><code class="prism language-c">string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	delete<span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span><span class="token comment">//析构销毁资源</span>
	_str <span class="token operator">=</span> nullptr<span class="token punctuation">;</span><span class="token comment">//置空</span>
	_size <span class="token operator">=</span> _capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//置0</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="3_146"></a>3，取出字符串的地址</h2> 
<pre><code class="prism language-c"><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token operator">::</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span><span class="token comment">//返回字符串的首地址，用于打印数据</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="4_154"></a>4，计算有效数据个数</h2> 
<pre><code class="prism language-c"><span class="token class-name">size_t</span> string<span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="5__163"></a>5，[ ]运算符重载</h2> 
<p>4.1 [ ]运算符重载有两种类型，<strong>可读可写</strong>的和<strong>可读</strong>的(const修饰)。</p> 
<p>4.2 模拟[ ]运算符重载的几个问题：<br> <strong>(1) 引用返回的作用：一是减少拷贝，二是修改返回对象。</strong><br> <strong>(2) 为什么可以用引用返回：_str[i]出了作用域还在，因为_str开辟在堆上，它返回的是堆上的一个字符的引用别名。</strong><br> <strong>(3) 重载的底层也是用assert断言的，只要下标越界直接终止报错。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//_str是new出来的，出了这个函数不会销毁，可以用引用返回</span>
<span class="token keyword">char</span><span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//防止越界</span>
	<span class="token keyword">return</span> _str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//防止越界</span>
	<span class="token keyword">return</span> _str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="6_186"></a>6，简单迭代器</h2> 
<p>6.1 迭代器也有有两种类型，<strong>可读可写</strong>的和<strong>可读</strong>的(const修饰)。根据声明可知，这里的迭代器可以暂时简单的理解为<strong>类似指针的东西</strong>。</p> 
<p>6.2 这里直接利用用<strong>原生指针</strong>进行实现的原因是：<strong>string类底层的物理结构的连续的。</strong></p> 
<p>6.3 为什么要用typedef，而不是直接用char*呢？<br> <strong>一是不同编译器底层实现迭代器的方式是不同的。</strong><br> <strong>二是可以实现二次封装，屏蔽了底层的实现细节，统一了上层访问容器的方式(用begin和end)。</strong></p> 
<pre><code class="prism language-c">string<span class="token operator">::</span>iterator string<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token operator">::</span>iterator string<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str <span class="token operator">+</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token operator">::</span>const_iterator string<span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token operator">::</span>const_iterator string<span class="token operator">::</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _str <span class="token operator">+</span> _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="7_216"></a>7，预开空间(扩容)</h2> 
<pre><code class="prism language-c"><span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">reserve</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//手动扩容，手动释放</span>
		<span class="token keyword">char</span><span class="token operator">*</span> tmp <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//多开一个给\0</span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> _str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		delete<span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span>

		_str <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> n<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="8_233"></a>8，尾插一个字符</h2> 
<p>8.1 先判断容量是否足够，再插入。<br> <strong>8.2 注意\0的处理。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//尾插一个字符</span>
<span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">==</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//先计算容量，2倍增</span>
		<span class="token class-name">size_t</span> newcapacity <span class="token operator">=</span> _capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token comment">//再扩容</span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>newcapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	_str<span class="token punctuation">[</span>_size<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span><span class="token comment">//覆盖\0的位置</span>
	_str<span class="token punctuation">[</span>_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span><span class="token comment">//补上\0</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="9_254"></a>9，尾插一个字符串</h2> 
<p>9.1 先判断容量是否足够，再插入。<br> 9.2 插入字符串时<strong>strcat</strong> 和<strong>strcpy</strong>均可以实现。但是<strong>strcat的底层需要遍历找到\0再进行拼接，最后自动补上\0，效率不高；所以推荐使用strcpy。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//尾插字符串</span>
<span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">+</span> len <span class="token operator">&gt;</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_size <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//strcat:从\0的位置开始追加，最后自动补上\0</span>
	<span class="token comment">//strcat(_str, str);</span>

	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> _size<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_size <span class="token operator">+=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="10_275"></a>10，+=运算符重载</h2> 
<p><strong>它的功能也是用来尾插字符或是字符串的，而且它比push_back和append使用的更广泛。</strong></p> 
<pre><code class="prism language-c">string<span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">push_back</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span>this<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

string<span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span>this<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="11pos_291"></a>11，在pos位置插入字符/字符串</h2> 
<h3><a id="111_pos_292"></a>11.1 在pos位置插入字符</h3> 
<p><strong>错误示范：</strong><br> <strong>原因：当pos为0，即头插时，程序崩溃！因为end是无符号整形，减到0再减后会变成整形最大值(40多亿)，造成死循环。</strong></p> 
<p><strong>猜想解决方法：</strong><br> <strong>只把end的类型改为int，也不行。因为当一个操作符两边的操作数类型不一样时，会产生隐式类型转换，比如有符号与无符号，有符号会隐式转换成无符号类型。</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//避免下标越界</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">==</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">size_t</span> newcapacity <span class="token operator">=</span> _capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>newcapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">size_t</span> end <span class="token operator">=</span> _size<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;=</span> pos<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>解决方法1：<br> 把end的类型改为int，end指向最后一位有效位的下一位，把pos也强转为int类型。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//在指定位置插入 </span>
<span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//避免下标越界</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">==</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">size_t</span> newcapacity <span class="token operator">=</span> _capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>newcapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> end <span class="token operator">=</span> _size<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>pos<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>解决方法2：<br> 让end指向\0的下一位。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//在指定位置插入 </span>
<span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//避免下标越界</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">==</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token class-name">size_t</span> newcapacity <span class="token operator">=</span> _capacity <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> _capacity <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>newcapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">size_t</span> end <span class="token operator">=</span> _size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;</span> pos<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>end<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
	<span class="token operator">++</span>_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="112__375"></a>11.2 尾插一个字符串</h3> 
<p><strong>遇到的问题与上面的相同。</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos <span class="token operator">&lt;=</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//避免下标越界</span>

	<span class="token class-name">size_t</span> len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_size <span class="token operator">+</span> len <span class="token operator">&gt;</span> _capacity<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">reserve</span><span class="token punctuation">(</span>_size <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//方式1</span>
	<span class="token comment">/*int end = _size;
	while (end &gt;= (int)pos)
	{
		_str[end + len] = _str[end];
		end--;
	}*/</span>
	
	<span class="token comment">//方式2</span>
	<span class="token class-name">size_t</span> end <span class="token operator">=</span> _size <span class="token operator">+</span> len<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>end <span class="token operator">&gt;</span> pos<span class="token operator">+</span>len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>end<span class="token punctuation">]</span> <span class="token operator">=</span> _str<span class="token punctuation">[</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		end<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">memcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">,</span> str<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	_size <span class="token operator">+=</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="12poslen_410"></a>12，从pos位置开始删除长度为len的字符串</h2> 
<p><strong>注意：</strong><br> 1.此处在声明中两个形参的缺省值，<strong>size_t pos = 0， size_t len = npos</strong>。<br> <strong>npos是const类型的静态成员变量，npos = -1，表示无符号整形的最大值(40多亿)。</strong></p> 
<p>2.声明和定义分离时，静态成员变量的初始化。<strong>当是const修饰的size_t类型的静态变量时，是可以在声明时给缺省值的！这是个特例！</strong> 但是一般不这样，<strong>声明和定义分离时，只要在.cpp中初始化即可。</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">erase</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len <span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">assert</span><span class="token punctuation">(</span>pos  <span class="token operator">&lt;</span> _size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//当len大于前面的字符个数时，有多少删多少</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pos<span class="token operator">+</span>len <span class="token operator">&gt;=</span> _size<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_str<span class="token punctuation">[</span>pos<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
		_size <span class="token operator">=</span> pos<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">,</span> _str <span class="token operator">+</span> pos <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_size <span class="token operator">-=</span> len<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="13pos_435"></a>13，从pos位置开始查找字符/字符串</h2> 
<h3><a id="131__436"></a>13.1 查找字符</h3> 
<pre><code class="prism language-c"><span class="token class-name">size_t</span> string<span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">,</span> <span class="token class-name">size_t</span> pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> pos<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_str<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> ch<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> npos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="132__452"></a>13.2 查找字符串</h3> 
<pre><code class="prism language-c"><span class="token class-name">size_t</span> string<span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token class-name">size_t</span> pos<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//strstr：str存在时返回所在位置的指针</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> p <span class="token operator">-</span> _str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="14_463"></a>14，拷贝构造(传统)</h2> 
<p><strong>当我们不显示实现深拷贝时，使用编译器默认的浅拷贝有两个危害：</strong><br> <strong>14.1 s1和s2指向同一块空间，出了作用域时调用两次析构函数，造成程序崩溃。</strong><br> <strong>14.2 修改一个，另外一个也会修改。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//要用深拷贝进行拷贝构造</span>
<span class="token comment">//s2(s1);把s1拷贝给s2,*this是s2,s是s1的别名</span>
string<span class="token operator">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//开一个和要拷贝的一样大小的空间</span>
	_str <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span>s<span class="token punctuation">.</span>_capacity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token function">strcpy</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把数据拷贝进新空间</span>
	_size <span class="token operator">=</span> s<span class="token punctuation">.</span>_size<span class="token punctuation">;</span>
	_capacity <span class="token operator">=</span> s<span class="token punctuation">.</span>_capacity<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="15_480"></a>15，=赋值拷贝(传统)</h2> 
<p><strong>开新空间，拷贝数据，释放原空间，改变指针指向。</strong></p> 
<pre><code class="prism language-c"><span class="token comment">//s1 = s3;//s1是*this,s是s3的别名</span>
string<span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//避免自己给自己赋值</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>this <span class="token operator">!=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	     <span class="token comment">//多开一个空间给\0</span>
		<span class="token keyword">char</span><span class="token operator">*</span> tmp <span class="token operator">=</span> new <span class="token keyword">char</span><span class="token punctuation">[</span>s<span class="token punctuation">.</span>_capacity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token function">strcpy</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		delete<span class="token punctuation">[</span><span class="token punctuation">]</span> _str<span class="token punctuation">;</span>
		_str <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
		_size <span class="token operator">=</span> s<span class="token punctuation">.</span>_size<span class="token punctuation">;</span>
		_capacity <span class="token operator">=</span> s<span class="token punctuation">.</span>_capacity<span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token operator">*</span>this<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="16swap_502"></a>16，交换函数swap</h2> 
<pre><code class="prism language-c"><span class="token comment">//s1.swap(s3)</span>
<span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//调用库中的swap函数，交换内置类型</span>
	<span class="token comment">//不直接交换数据，而是交换两块空间的指针</span>
	std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_size<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span><span class="token function">swap</span><span class="token punctuation">(</span>_capacity<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_capacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="17poslen_515"></a>17，从pos位置开始取len个字符的串</h2> 
<p><strong>复用了前面的构造函数和+=运算符。</strong></p> 
<pre><code class="prism language-c">string string<span class="token operator">::</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token class-name">size_t</span> pos<span class="token punctuation">,</span> <span class="token class-name">size_t</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//len大于pos后面剩余的字符，有多少取多少</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&gt;</span> _size <span class="token operator">-</span> pos<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string <span class="token function">sub</span><span class="token punctuation">(</span>_str <span class="token operator">+</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//直接构造子串返回</span>
		<span class="token keyword">return</span> sub<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		string sub<span class="token punctuation">;</span>
		sub<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			sub <span class="token operator">+=</span> _str<span class="token punctuation">[</span>pos <span class="token operator">+</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sub<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="18__538"></a>18. 字符串的比较</h2> 
<p><strong>只要实现&gt;运算符(或&lt;运算符)和==运算符，其他运算符直接复用即可。</strong></p> 
<pre><code class="prism language-c">
	bool string<span class="token operator">::</span>operator<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool string<span class="token operator">::</span>operator<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>this <span class="token operator">&lt;=</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool string<span class="token operator">::</span>operator<span class="token operator">&lt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">*</span>this <span class="token operator">&lt;</span> s <span class="token operator">||</span> <span class="token operator">*</span>this <span class="token operator">==</span> s<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool string<span class="token operator">::</span>operator<span class="token operator">&gt;=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>this <span class="token operator">&lt;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool string<span class="token operator">::</span>operator<span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>_str<span class="token punctuation">,</span> s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool string<span class="token operator">::</span>operator<span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>this <span class="token operator">==</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="19clear_573"></a>19，清除函数clear</h2> 
<p><strong>清除当前对象里的内容，影响的是_size，不影响_capacity。</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> string<span class="token operator">::</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
	_size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="20_583"></a>20，流插入，流提取</h2> 
<p><strong>(1) 不适合写成成员函数，涉及第一个参数的位置问题。</strong><br> <strong>(2) 根据声明可知，这两个函数并没有重载成友元函数，而是放在类外。</strong><br> <strong>(3) 在日期类中写成友元是为了访问私有成员，这里可以不写成友元函数，不访问私有成员，直接访问公有成员。</strong></p> 
<h3><a id="201__588"></a>20.1 流插入</h3> 
<pre><code class="prism language-c">ostream<span class="token operator">&amp;</span> operator<span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> <span class="token keyword">const</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		os <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> os<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="202__601"></a>20.2 流提取</h3> 
<p><strong>注意：</strong><br> <strong>(1) C语言中的scanf：%c时可以拿到空格，拿不到换行，遇到换行直接忽略； %s时两个都拿不到，遇到直接忽略。</strong></p> 
<p><strong>C++中的cin:拿不到空格和换行，遇到直接忽略。</strong></p> 
<p><strong>在C++中不能用scanf，因为C++的流和C语言的流缓冲区不同。</strong></p> 
<p><strong>(2) 为了避免一次性输入够多导致频繁扩容，开辟一个局部数组buff(类似缓冲区)，先把字符存在buff中，到达一定数量后再存入str。</strong></p> 
<pre><code class="prism language-c">istream<span class="token operator">&amp;</span> operator<span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span>istream<span class="token operator">&amp;</span> is<span class="token punctuation">,</span> string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	str<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">char</span> buff<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> ch <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span>ch <span class="token operator">!=</span> <span class="token char">' '</span> <span class="token operator">&amp;&amp;</span> ch <span class="token operator">!=</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		buff<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> ch<span class="token punctuation">;</span>
		<span class="token comment">//0 - 126</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">127</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
			str <span class="token operator">+=</span> buff<span class="token punctuation">;</span>
			i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ch <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//如果buff没有装满</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> 
		str <span class="token operator">+=</span> buff<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="21_644"></a>21，拷贝构造和赋值拷贝的现代写法(重点)</h2> 
<h3><a id="211__645"></a>21.1 拷贝构造</h3> 
<p><strong>复用构造函数，构造一个tmp，再用tmp对象和this交换</strong>。此时如果不在声明时给缺省值，刚开始s2是随机值，tmp和s2交换后，tmp就是随机值，tmp出了函数会调用析构函数，此时程序可能会崩溃，所以好给缺省值。</p> 
<pre><code class="prism language-c:">string::string(const string&amp; s)
{
	//写法1：常用
	string tmp(s._str);
	swap(tmp);

	//写法2：
	//string tmp(s._str);
	//std::swap(_str, tmp._str);
	//std::swap(_size, tmp._size);
	//std::swap(_capacity, tmp._capacity);
}
</code></pre> 
<h3><a id="212__663"></a>21.2 赋值拷贝</h3> 
<p><strong>写法1：</strong></p> 
<pre><code class="prism language-c">string<span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//避免自己给自己赋值</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>this <span class="token operator">!=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string <span class="token function">tmp</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">swap</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">*</span>this<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>写法2：常用</strong></p> 
<p>这里使用<mark>传值传参</mark>：</p> 
<p><strong>(1) 传值传参会进行拷贝构造，s1会拷贝一份给临时变量tmp，tmp里的东西就是s3想要的，再让tmp与s3交换</strong>；</p> 
<p><strong>(2) 当tmp 的生命周期结束时，刚好又会调用析构函数，把原来s3中的东西清理掉</strong>。</p> 
<pre><code class="prism language-c"><span class="token comment">//s3 = s1   </span>
<span class="token comment">//这里的传参不能用引用，</span>
string<span class="token operator">&amp;</span> string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span>string tmp<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">swap</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//一行搞定赋值拷贝</span>
	<span class="token keyword">return</span> <span class="token operator">*</span>this<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4404c710a825d8d4336f27fa3965107f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;的MQTT开发：使用Paho的C&#43;&#43;接口实现消息发布、订阅、连接RabbitMQ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6bfefe6762e8bee801ad0c09728c0c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SSM牙科诊所管理系统-计算机毕业设计源码98077</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>