<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu20.04版本升级openssh9.8p1方法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/94b9babb8ddd1112422c40e041273a88/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Ubuntu20.04版本升级openssh9.8p1方法">
  <meta property="og:description" content="一、问题描述： 8.5p1 和 9.7p1 之间的openssh版本漏洞可能会导致linux系统以root身份进行RCE，所以需安装最新版本
二、解决方法： 将当前openssh版本升级到最新的版本即openssh-9.8p1版本，OpenSSL大版本升级且OpenSSH有新稳定版本，建议升级OpenSSL同时也升级OpenSSH
1.安装编译依赖包 apt install gcc make zlib1g-dev libpam0g-dev libkrb5-dev libedit-dev -y 2.先升级openssl,再升级openssh ubuntu20.04 默认openssl版本：OpenSSL 1.1.1f
ssh的版本为：OpenSSH_8.2p1
3.下载OpenSSL 访问openssl官网：[ Downloads ] - /source/index.htmlhttps://www.openssl.org/source/找到最新版本通过wget下载
wget https://www.openssl.org/source/openssl-3.0.13.tar.gz 注意：由于OpenSSL 1.1.x版本已停止维护，ubuntu20.04.x系统建议都使用目前长期支持版
cd /usr/local/src/ tar -zxf openssl-3.0.13.tar.gz cd openssl-3.0.13 ./config shared --prefix=/usr/local/openssl --openssldir=/usr/local/openssl 进行编译和安装
make&amp;&amp;make install 运行一段时间等编译安装完成，完成后执行echo $?显示是否执行成功。
备份原来的openssl
mv /usr/bin/openssl /usr/bin/openssl.bak ln -s /usr/local/openssl/bin/openssl /usr/bin/openssl 将openssl 的lib 库添加到系统(‘/usr/local/openssl/lib64’ 单引号)
#openssl 1.x.x版本是: /usr/local/openssl/lib/ 路径 #echo &#39;/usr/local/openssl/lib&#39; &gt; /etc/ld.so.conf.d/openssl.conf echo &#39;/usr/local/openssl/lib64&#39; &gt; /etc/ld.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T16:16:31+08:00">
    <meta property="article:modified_time" content="2024-07-23T16:16:31+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu20.04版本升级openssh9.8p1方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、问题描述：</h2> 
<p> 8.5p1 和 9.7p1 之间的openssh版本漏洞可能会导致linux系统以root身份进行RCE，所以需安装最新版本</p> 
<h2>二、解决方法：</h2> 
<p>将当前openssh版本升级到最新的版本即openssh-9.8p1版本，OpenSSL大版本升级且OpenSSH有新稳定版本，建议升级OpenSSL同时也升级OpenSSH</p> 
<h3>1.安装编译依赖包</h3> 
<pre><code class="hljs">apt install gcc make zlib1g-dev libpam0g-dev libkrb5-dev libedit-dev -y</code></pre> 
<h3>2.先升级openssl,再升级openssh</h3> 
<p>ubuntu20.04 默认openssl版本：OpenSSL 1.1.1f</p> 
<p><img alt="" height="311" src="https://images2.imgbox.com/aa/2f/FHBVxEOG_o.png" width="1033"></p> 
<p>ssh的版本为：OpenSSH_8.2p1</p> 
<p><img alt="" height="131" src="https://images2.imgbox.com/fa/84/2goHaa6m_o.png" width="1200"></p> 
<h3>3.下载OpenSSL</h3> 
<p>访问openssl官网：<a class="has-card" href="https://www.openssl.org/source/" rel="nofollow" title="[ Downloads ] - /source/index.html"><span class="link-card-box"><span class="link-title">[ Downloads ] - /source/index.html</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/82/4f/5KYFCvNl_o.png" alt="icon-default.png?t=N7T8">https://www.openssl.org/source/</span></span></a>找到最新版本通过wget下载</p> 
<pre><code class="hljs">wget https://www.openssl.org/source/openssl-3.0.13.tar.gz</code></pre> 
<p><span style="color:#fe2c24;">注意：由于OpenSSL 1.1.x版本已停止维护，ubuntu20.04.x系统建议都使用目前长期支持版</span></p> 
<pre><code class="hljs">cd /usr/local/src/
tar -zxf openssl-3.0.13.tar.gz
cd openssl-3.0.13
./config shared --prefix=/usr/local/openssl --openssldir=/usr/local/openssl</code></pre> 
<p></p> 
<p><img alt="" height="697" src="https://images2.imgbox.com/53/be/pc3m5pXq_o.png" width="1200"></p> 
<p>进行编译和安装</p> 
<pre><code class="hljs">make&amp;&amp;make install</code></pre> 
<p>运行一段时间等编译安装完成，完成后执行echo $?显示是否执行成功。</p> 
<p><img alt="" height="129" src="https://images2.imgbox.com/9b/88/m9vipDe9_o.png" width="1200"></p> 
<p>备份原来的openssl</p> 
<pre><code class="hljs">mv /usr/bin/openssl  /usr/bin/openssl.bak
ln -s /usr/local/openssl/bin/openssl  /usr/bin/openssl</code></pre> 
<p><img alt="" height="73" src="https://images2.imgbox.com/01/2e/2hdapuLf_o.png" width="1200"></p> 
<p>将openssl 的lib 库添加到系统(‘/usr/local/openssl/lib64’ 单引号)</p> 
<pre><code class="hljs">#openssl 1.x.x版本是: /usr/local/openssl/lib/ 路径
#echo '/usr/local/openssl/lib' &gt; /etc/ld.so.conf.d/openssl.conf
echo '/usr/local/openssl/lib64' &gt; /etc/ld.so.conf.d/openssl.conf </code></pre> 
<p><img alt="" height="49" src="https://images2.imgbox.com/48/4b/9VGkCMXH_o.png" width="1200"></p> 
<p>然后加载lib库</p> 
<pre><code class="hljs">ldconfig -v</code></pre> 
<p><img alt="" height="403" src="https://images2.imgbox.com/ff/74/rSKQxNr9_o.png" width="1200"></p> 
<p>查看OpenSSL版本</p> 
<p><img alt="" height="193" src="https://images2.imgbox.com/92/8e/Wpf9gEke_o.png" width="1200"></p> 
<h3>4.下载OpenSSH包</h3> 
<p>访问链接：<a class="has-card" href="https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/" rel="nofollow" title="Index of /pub/OpenBSD/OpenSSH/portable/"><span class="link-card-box"><span class="link-title">Index of /pub/OpenBSD/OpenSSH/portable/</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/fa/6d/qcenibBl_o.png" alt="icon-default.png?t=N7T8">https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/</span></span></a>通过wget下载OpenSSH_9.8p1</p> 
<pre><code class="hljs">wget https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.8p1.tar.gz</code></pre> 
<p>备份文件</p> 
<pre><code class="hljs">mkdir /usr/bin/bak
cp -arpf /usr/bin/scp /usr/bin/bak/scp.bak
cp -arpf /usr/bin/sftp /usr/bin/bak/sftp.bak
cp -arpf /usr/bin/ssh /usr/bin/bak/ssh.bak
cp -arpf /usr/bin/ssh-add /usr/bin/bak/ssh-add.bak
cp -arpf /usr/bin/ssh-agent /usr/bin/bak/ssh-agent.bak
cp -arpf /usr/bin/ssh-keygen /usr/bin/bak/ssh-keygen.bak
cp -arpf /usr/bin/ssh-keyscan /usr/bin/bak/ssh-keyscan.bak
mkdir /usr/sbin/bak
cp -arpf /usr/sbin/sshd /usr/sbin/bak/sshd.bak</code></pre> 
<p>进入openssh-9.8p1目录，执行编译安装命令</p> 
<pre><code class="hljs">tar -zxf openssh-9.8p1.tar.gz
cd  /usr/local/src/openssh-9.8p1.tar.gz
./configure --prefix=/usr/local/openssh-9.8p1 --sysconfdir=/etc/ssh --with-kerberos5 --with-libedit --with-pam --with-gssapi --with-zlib --with-ssl-dir=/usr/local/openssl --with-privsep-path=/var/lib/sshd
make &amp;&amp; make install</code></pre> 
<p><img alt="" height="95" src="https://images2.imgbox.com/b8/0f/GVxX5eDg_o.png" width="1200"></p> 
<p>make install运行完后执行echo $? 显示如下即是安装成功</p> 
<p><img alt="" height="139" src="https://images2.imgbox.com/a5/3b/I3zai4ko_o.png" width="1200"></p> 
<p>替换新版本openssh相关命令</p> 
<pre><code class="hljs">cp -arpf /usr/local/openssh-9.8p1/bin/* /usr/bin/
cp -arpf /usr/local/openssh-9.8p1/sbin/*   /usr/sbin/</code></pre> 
<p>修改配置文件</p> 
<pre><code class="hljs">sed -i 's@#PermitRootLogin prohibit-password@PermitRootLogin yes@g' /etc/ssh/sshd_config</code></pre> 
<p>允许root远程登录，并重启ssh</p> 
<pre><code class="hljs">systemctl daemon-reload
systemctl restart ssh
ssh -V  查看版本</code></pre> 
<p><img alt="" height="229" src="https://images2.imgbox.com/db/96/WgRrj6yb_o.png" width="1200"></p> 
<p><span style="color:#fe2c24;">注：遇到如下编译问题</span></p> 
<p><img alt="" height="415" src="https://images2.imgbox.com/1d/2e/lQ2wqI4Z_o.png" width="1200"></p> 
<p>解决方法：</p> 
<p>安装依赖包</p> 
<pre><code class="hljs">apt install gcc make zlib1g-dev libpam0g-dev libkrb5-dev libedit-dev -y</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef612917e76e7d99ddf233c9eff148db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构----算法复杂度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2a0e195c38d3eaade81226ed0e78ee8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">javascript鼠标跟随星星动画特效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>