<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>æ¬¢è¿ Llama 3ï¼šMeta çš„æ–°ä¸€ä»£å¼€æºå¤§è¯­è¨€æ¨¡å‹ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d31a796da876d3bf173aba8e9d341e42/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="æ¬¢è¿ Llama 3ï¼šMeta çš„æ–°ä¸€ä»£å¼€æºå¤§è¯­è¨€æ¨¡å‹">
  <meta property="og:description" content="ä»‹ç» Meta å…¬å¸çš„ Llama 3 æ˜¯å¼€æ”¾è·å–çš„ Llama ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç°å·²åœ¨ Hugging Face å¹³å°å‘å¸ƒã€‚çœ‹åˆ° Meta æŒç»­è‡´åŠ›äºå¼€æ”¾ AI é¢†åŸŸçš„å‘å±•ä»¤äººæŒ¯å¥‹ï¼Œæˆ‘ä»¬ä¹Ÿéå¸¸é«˜å…´åœ°å…¨åŠ›æ”¯æŒæ­¤æ¬¡å‘å¸ƒï¼Œå¹¶å®ç°äº†ä¸ Hugging Face ç”Ÿæ€ç³»ç»Ÿçš„æ·±åº¦é›†æˆã€‚
Llama 3 æä¾›ä¸¤ä¸ªç‰ˆæœ¬ï¼š8B ç‰ˆæœ¬é€‚åˆåœ¨æ¶ˆè´¹çº§ GPU ä¸Šé«˜æ•ˆéƒ¨ç½²å’Œå¼€å‘ï¼›70B ç‰ˆæœ¬åˆ™ä¸“ä¸ºå¤§è§„æ¨¡ AI åº”ç”¨è®¾è®¡ã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½åŒ…æ‹¬åŸºç¡€å’ŒæŒ‡ä»¤è°ƒä¼˜ä¸¤ç§å½¢å¼ã€‚æ­¤å¤–ï¼ŒåŸºäº Llama 3 8B å¾®è°ƒåçš„ Llama Guard æ–°ç‰ˆæœ¬ä¹Ÿå·²ä½œä¸º Llama Guard 2 (å®‰å…¨å¾®è°ƒç‰ˆæœ¬) å‘å¸ƒã€‚
æˆ‘ä»¬ä¸ Meta å¯†åˆ‡åˆä½œï¼Œç¡®ä¿å…¶äº§å“èƒ½å¤Ÿæ— ç¼é›†æˆè¿› Hugging Face çš„ç”Ÿæ€ç³»ç»Ÿã€‚åœ¨ Hub ä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è¿™äº”ä¸ªå¼€æ”¾è·å–çš„æ¨¡å‹ (åŒ…æ‹¬ä¸¤ä¸ªåŸºç¡€æ¨¡å‹ã€ä¸¤ä¸ªå¾®è°ƒæ¨¡å‹ä»¥åŠ Llama Guard) ã€‚
æœ¬æ¬¡å‘å¸ƒçš„ä¸»è¦ç‰¹æ€§å’Œé›†æˆåŠŸèƒ½åŒ…æ‹¬ï¼š
Hub ä¸Šçš„æ¨¡å‹å¹¶æä¾›äº†æ¨¡å‹å¡ç‰‡å’Œè®¸å¯è¯ä¿¡æ¯https://hf.co/meta-llama
ğŸ¤— Transformers çš„é›†æˆ
é’ˆå¯¹ Meta Llama 3 70B çš„ Hugging Chat é›†æˆhttps://hf.co/chat/models/meta-llama/Meta-Llama-3-70B-instruct
æ¨ç†åŠŸèƒ½é›†æˆåˆ°æ¨ç†ç«¯ç‚¹ã€Google Cloud å’Œ Amazon SageMaker">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-19T23:00:47+08:00">
    <meta property="article:modified_time" content="2024-04-19T23:00:47+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">æ¬¢è¿ Llama 3ï¼šMeta çš„æ–°ä¸€ä»£å¼€æºå¤§è¯­è¨€æ¨¡å‹</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <h3>ä»‹ç»</h3> 
 <p>Meta å…¬å¸çš„ Llama 3 æ˜¯å¼€æ”¾è·å–çš„ Llama ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç°å·²åœ¨ Hugging Face å¹³å°å‘å¸ƒã€‚çœ‹åˆ° Meta æŒç»­è‡´åŠ›äºå¼€æ”¾ AI é¢†åŸŸçš„å‘å±•ä»¤äººæŒ¯å¥‹ï¼Œæˆ‘ä»¬ä¹Ÿéå¸¸é«˜å…´åœ°å…¨åŠ›æ”¯æŒæ­¤æ¬¡å‘å¸ƒï¼Œå¹¶å®ç°äº†ä¸ Hugging Face ç”Ÿæ€ç³»ç»Ÿçš„æ·±åº¦é›†æˆã€‚</p> 
 <p>Llama 3 æä¾›ä¸¤ä¸ªç‰ˆæœ¬ï¼š8B ç‰ˆæœ¬é€‚åˆåœ¨æ¶ˆè´¹çº§ GPU ä¸Šé«˜æ•ˆéƒ¨ç½²å’Œå¼€å‘ï¼›70B ç‰ˆæœ¬åˆ™ä¸“ä¸ºå¤§è§„æ¨¡ AI åº”ç”¨è®¾è®¡ã€‚æ¯ä¸ªç‰ˆæœ¬éƒ½åŒ…æ‹¬åŸºç¡€å’ŒæŒ‡ä»¤è°ƒä¼˜ä¸¤ç§å½¢å¼ã€‚æ­¤å¤–ï¼ŒåŸºäº Llama 3 8B å¾®è°ƒåçš„ Llama Guard æ–°ç‰ˆæœ¬ä¹Ÿå·²ä½œä¸º Llama Guard 2 (å®‰å…¨å¾®è°ƒç‰ˆæœ¬) å‘å¸ƒã€‚</p> 
 <p>æˆ‘ä»¬ä¸ Meta å¯†åˆ‡åˆä½œï¼Œç¡®ä¿å…¶äº§å“èƒ½å¤Ÿæ— ç¼é›†æˆè¿› Hugging Face çš„ç”Ÿæ€ç³»ç»Ÿã€‚åœ¨ Hub ä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°è¿™äº”ä¸ªå¼€æ”¾è·å–çš„æ¨¡å‹ (åŒ…æ‹¬ä¸¤ä¸ªåŸºç¡€æ¨¡å‹ã€ä¸¤ä¸ªå¾®è°ƒæ¨¡å‹ä»¥åŠ Llama Guard) ã€‚</p> 
 <p>æœ¬æ¬¡å‘å¸ƒçš„ä¸»è¦ç‰¹æ€§å’Œé›†æˆåŠŸèƒ½åŒ…æ‹¬ï¼š</p> 
 <ul><li><p>Hub ä¸Šçš„æ¨¡å‹å¹¶æä¾›äº†æ¨¡å‹å¡ç‰‡å’Œè®¸å¯è¯ä¿¡æ¯https://hf.co/meta-llama</p></li><li><p>ğŸ¤— Transformers çš„é›†æˆ</p></li><li><p>é’ˆå¯¹ Meta Llama 3 70B çš„ Hugging Chat é›†æˆhttps://hf.co/chat/models/meta-llama/Meta-Llama-3-70B-instruct</p></li><li><p>æ¨ç†åŠŸèƒ½é›†æˆåˆ°æ¨ç†ç«¯ç‚¹ã€Google Cloud å’Œ Amazon SageMaker</p></li><li><p>ä½¿ç”¨ ğŸ¤— TRLåœ¨å•ä¸ª GPU ä¸Šå¯¹ Llama 3 8B è¿›è¡Œå¾®è°ƒçš„ç¤ºä¾‹</p></li></ul> 
 <h3>Llama 3 çš„æ–°è¿›å±•</h3> 
 <p>Llama 3 çš„æ¨å‡ºæ ‡å¿—ç€ Meta åŸºäº Llama 2 æ¶æ„æ¨å‡ºäº†å››ä¸ªæ–°çš„å¼€æ”¾å‹å¤§è¯­è¨€æ¨¡å‹ã€‚è¿™äº›æ¨¡å‹åˆ†ä¸ºä¸¤ç§è§„æ¨¡ï¼š8B å’Œ 70B å‚æ•°ï¼Œæ¯ç§è§„æ¨¡éƒ½æä¾›é¢„è®­ç»ƒåŸºç¡€ç‰ˆå’ŒæŒ‡ä»¤è°ƒä¼˜ç‰ˆã€‚æ‰€æœ‰ç‰ˆæœ¬å‡å¯åœ¨å„ç§æ¶ˆè´¹çº§ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå¹¶å…·æœ‰ 8000 Token çš„ä¸Šä¸‹æ–‡é•¿åº¦ã€‚</p> 
 <ul><li><p>Meta-Llama-3-8bï¼š8B åŸºç¡€æ¨¡å‹https://hf.co/meta-llama/Meta-Llama-3-8B</p></li><li><p>Meta-Llama-3-8b-instructï¼š8B åŸºç¡€æ¨¡å‹çš„æŒ‡ä»¤è°ƒä¼˜ç‰ˆhttps://hf.co/meta-llama/Meta-Llama-3-8B-Instruct</p></li><li><p>Meta-Llama-3-70bï¼š70B åŸºç¡€æ¨¡å‹https://hf.co/meta-llama/Meta-Llama-3-70B</p></li><li><p>Meta-Llama-3-70b-instructï¼š70B åŸºç¡€æ¨¡å‹çš„æŒ‡ä»¤è°ƒä¼˜ç‰ˆhttps://hf.co/meta-llama/Meta-Llama-3-70B-instruct</p></li></ul> 
 <p>æ­¤å¤–ï¼Œè¿˜å‘å¸ƒäº†åŸºäº Llama 3 8B å¾®è°ƒåçš„æœ€æ–° Llama Guard ç‰ˆæœ¬â€”â€”Llama Guard 2ã€‚Llama Guard 2 æ˜¯ä¸ºç”Ÿäº§ç¯å¢ƒè®¾è®¡çš„ï¼Œèƒ½å¤Ÿå¯¹å¤§è¯­è¨€æ¨¡å‹çš„è¾“å…¥ (å³æç¤º) å’Œå“åº”è¿›è¡Œåˆ†ç±»ï¼Œä»¥ä¾¿è¯†åˆ«æ½œåœ¨çš„ä¸å®‰å…¨å†…å®¹ã€‚</p> 
 <p>ä¸ Llama 2 ç›¸æ¯”ï¼ŒLlama 3 æœ€å¤§çš„å˜åŒ–æ˜¯é‡‡ç”¨äº†æ–°çš„ Tokenizerï¼Œå°†è¯æ±‡è¡¨å¤§å°æ‰©å±•è‡³ 128,256 (å‰ç‰ˆæœ¬ä¸º 32,000 Token) ã€‚è¿™ä¸€æ›´å¤§çš„è¯æ±‡åº“èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç¼–ç æ–‡æœ¬ (æ— è®ºè¾“å…¥è¿˜æ˜¯è¾“å‡º) ï¼Œå¹¶æœ‰å¯èƒ½æå‡æ¨¡å‹çš„å¤šè¯­ç§å¤„ç†èƒ½åŠ›ã€‚ä¸è¿‡ï¼Œè¿™ä¹Ÿå¯¼è‡´åµŒå…¥å±‚çš„è¾“å…¥å’Œè¾“å‡ºçŸ©é˜µå°ºå¯¸å¢å¤§ï¼Œè¿™æ˜¯å°å‹æ¨¡å‹å‚æ•°å¢åŠ  (ä» Llama 2 çš„ 7B å¢è‡³ Llama 3 çš„ 8B) çš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚æ­¤å¤–ï¼Œ8B ç‰ˆæœ¬çš„æ¨¡å‹ç°åœ¨é‡‡ç”¨äº†åˆ†ç»„æŸ¥è¯¢æ³¨æ„åŠ› (GQA) ï¼Œè¿™æ˜¯ä¸€ç§æ•ˆç‡æ›´é«˜çš„è¡¨è¾¾æ–¹å¼ï¼Œæœ‰åŠ©äºå¤„ç†æ›´é•¿çš„ä¸Šä¸‹æ–‡ã€‚</p> 
 <p>Llama 3 æ¨¡å‹åœ¨ä¸¤ä¸ªæ‹¥æœ‰ 24,000 GPU çš„é›†ç¾¤ä¸Šè¿›è¡Œäº†è®­ç»ƒï¼Œä½¿ç”¨çš„æ˜¯è¶…è¿‡ 15 ä¸‡äº¿ Token çš„æ–°å…¬å…±åœ¨çº¿æ•°æ®ã€‚æˆ‘ä»¬æ— æ³•å¾—çŸ¥è®­ç»ƒæ•°æ®å…·ä½“ç»†èŠ‚ï¼Œä½†å¯ä»¥æ¨æµ‹ï¼Œæ›´å¤§è§„æ¨¡ä¸”æ›´ç»†è‡´çš„æ•°æ®ç­–åˆ’æ˜¯æ€§èƒ½æå‡çš„é‡è¦å› ç´ ã€‚Llama 3 Instruct é’ˆå¯¹å¯¹è¯åº”ç”¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç»“åˆäº†è¶…è¿‡ 1000 ä¸‡çš„äººå·¥æ ‡æ³¨æ•°æ®ï¼Œé€šè¿‡ç›‘ç£å¼å¾®è°ƒ (SFT) ã€æ‹’ç»é‡‡æ ·ã€é‚»è¿‘ç­–ç•¥ä¼˜åŒ– (PPO) å’Œç›´æ¥ç­–ç•¥ä¼˜åŒ– (DPO) è¿›è¡Œè®­ç»ƒã€‚</p> 
 <p>å…³äºè®¸å¯æ¡æ¬¾ï¼ŒLlama 3 æä¾›äº†ä¸€ä¸ªå®½æ¾çš„è®¸å¯è¯ï¼Œå…è®¸é‡æ–°åˆ†å‘ã€å¾®è°ƒå’Œåˆ›ä½œè¡ç”Ÿä½œå“ã€‚Llama 3 è®¸å¯è¯ä¸­æ–°å¢äº†æ˜ç¡®å½’å±çš„è¦æ±‚ï¼Œè¿™åœ¨ Llama 2 ä¸­å¹¶æœªè®¾å®šã€‚ä¾‹å¦‚ï¼Œè¡ç”Ÿæ¨¡å‹éœ€è¦åœ¨å…¶åç§°å¼€å¤´åŒ…å«â€œLlama 3â€ï¼Œå¹¶ä¸”åœ¨è¡ç”Ÿä½œå“æˆ–æœåŠ¡ä¸­éœ€æ³¨æ˜â€œåŸºäº Meta Llama 3 æ„å»ºâ€ã€‚è¯¦ç»†æ¡æ¬¾ï¼Œè¯·åŠ¡å¿…é˜…è¯»å®˜æ–¹è®¸å¯è¯ã€‚</p> 
 <ul><li><p>å®˜æ–¹è®¸å¯è¯https://hf.co/meta-llama/Meta-Llama-3-70B/blob/main/LICENSE</p></li></ul> 
 <h3>Llama 3 è¯„ä¼°</h3> 
 <p>æ³¨ï¼šæˆ‘ä»¬ç›®å‰æ­£åœ¨å¯¹ Meta Llama 3 è¿›è¡Œå•ç‹¬è¯„ä¼°ï¼Œä¸€æ—¦æœ‰äº†ç»“æœå°†ç«‹å³æ›´æ–°æ­¤éƒ¨åˆ†ã€‚</p> 
 <h3>å¦‚ä½•è®¾ç½® Llama 3 çš„æç¤ºè¯</h3> 
 <p>åŸºç¡€æ¨¡å‹ä¸å…·å¤‡å›ºå®šçš„æç¤ºæ ¼å¼ã€‚å¦‚åŒå…¶ä»–åŸºç¡€æ¨¡å‹ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥å»¶ç»­è¾“å…¥åºåˆ—ï¼Œæä¾›åˆç†çš„ç»­å†™æˆ–è¿›è¡Œé›¶æ ·æœ¬/å°‘æ ·æœ¬æ¨ç†ã€‚è¿™äº›æ¨¡å‹ä¹Ÿæ˜¯æ‚¨è‡ªå®šä¹‰å¾®è°ƒçš„ç†æƒ³åŸºç¡€ã€‚æŒ‡ä»¤ç‰ˆæœ¬é‡‡ç”¨ä»¥ä¸‹å¯¹è¯ç»“æ„ï¼š</p> 
 <pre class="has"><code class="language-go">system

{<!-- -->{Â system_promptÂ }}user

{<!-- -->{Â user_msg_1Â }}assistant

{<!-- -->{Â model_answer_1Â }}</code></pre> 
 <p>ä¸ºäº†æœ‰æ•ˆä½¿ç”¨ï¼Œå¿…é¡»ç²¾ç¡®å¤åˆ¶æ­¤æ ¼å¼ã€‚æˆ‘ä»¬ç¨åå°†å±•ç¤ºå¦‚ä½•åˆ©ç”¨ transformers ä¸­æä¾›çš„èŠå¤©æ¨¡æ¿è½»æ¾é‡ç°è¿™ä¸€æŒ‡ä»¤æç¤ºæ ¼å¼ã€‚</p> 
 <h3>æ¼”ç¤º</h3> 
 <p>æ‚¨ç°åœ¨å¯ä»¥åœ¨ Hugging Chat ä¸Šä¸ Llama 3 70B æŒ‡ä»¤ç‰ˆè¿›è¡Œäº¤æµï¼è¯·è®¿é—®æ­¤é“¾æ¥ï¼š</p> 
 <p>https://hf.co/chat/models/meta-llama/Meta-Llama-3-70B-instruct</p> 
 <h3>å¦‚ä½•ä½¿ç”¨ ğŸ¤— Transformers</h3> 
 <p>é€šè¿‡å®‰è£… Transformers çš„4.40 ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥å……åˆ†åˆ©ç”¨ Hugging Face ç”Ÿæ€ç³»ç»Ÿä¸­æä¾›çš„å„ç§å·¥å…·ï¼Œå¦‚ï¼š</p> 
 <ul><li><p>è®­ç»ƒåŠæ¨ç†è„šæœ¬å’Œç¤ºä¾‹</p></li><li><p>å®‰å…¨æ–‡ä»¶æ ¼å¼ (safetensors)</p></li><li><p>ä¸ bitsandbytes (4 ä½é‡åŒ–) ã€PEFT (å‚æ•°æ•ˆç‡å¾®è°ƒ) å’Œ Flash Attention 2 ç­‰å·¥å…·çš„é›†æˆ</p></li><li><p>è¾…åŠ©ç”Ÿæˆæ“ä½œçš„å®ç”¨å·¥å…·</p></li><li><p>æ¨¡å‹éƒ¨ç½²çš„å¯¼å‡ºæœºåˆ¶</p></li></ul> 
 <p>æ­¤å¤–ï¼ŒLlama 3 æ¨¡å‹å…¼å®¹ <code>torch.compile()</code> çš„ CUDA å›¾è¡¨ï¼Œä½¿å¾—æ¨ç†æ—¶é—´å¯åŠ é€Ÿçº¦ 4 å€ï¼</p> 
 <ul><li><p>4.40 ç‰ˆæœ¬https://github.com/huggingface/transformers/releases/tag/v4.40.0</p></li></ul> 
 <p>è¦åœ¨ transformers ä¸­ä½¿ç”¨ Llama 3 æ¨¡å‹ï¼Œè¯·ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬ï¼š</p> 
 <pre class="has"><code class="language-go">pipÂ installÂ -UÂ "transformers==4.40.0"Â --upgrade</code></pre> 
 <p>ä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•åœ¨ transformers ä¸­ä½¿ç”¨ Llama-3-8b-instructã€‚è¿™éœ€è¦å¤§çº¦ 16 GB çš„ RAMï¼ŒåŒ…æ‹¬ 3090 æˆ– 4090 ç­‰æ¶ˆè´¹çº§ GPUã€‚</p> 
 <pre class="has"><code class="language-go">importÂ transformers
importÂ torch

model_idÂ =Â "meta-llama/Meta-Llama-3-8B-Instruct"

pipelineÂ =Â transformers.pipeline(
Â Â Â Â "text-generation",
Â Â Â Â model=model_id,
Â Â Â Â model_kwargs={"torch_dtype":Â torch.bfloat16},
Â Â Â Â device="cuda",
)

messagesÂ =Â [
Â Â Â Â {"role":Â "system",Â "content":Â "YouÂ areÂ aÂ pirateÂ chatbotÂ whoÂ alwaysÂ respondsÂ inÂ pirateÂ speak!"},
Â Â Â Â {"role":Â "user",Â "content":Â "WhoÂ areÂ you?"},
]

promptÂ =Â pipeline.tokenizer.apply_chat_template(
Â Â messages,Â 
Â Â tokenize=False,Â 
Â Â add_generation_prompt=True
)

terminatorsÂ =Â [
Â Â Â Â tokenizer.eos_token_id,
Â Â Â Â tokenizer.convert_tokens_to_ids("")
]

outputsÂ =Â pipeline(
Â Â Â Â prompt,
Â Â Â Â max_new_tokens=256,
Â Â Â Â eos_token_id=terminators,
Â Â Â Â do_sample=True,
Â Â Â Â temperature=0.6,
Â Â Â Â top_p=0.9,
)
print(outputs[0]["generated_text"][len(prompt):])</code></pre> 
 <blockquote> 
   
  <p>Arrrr, me hearty! Me name be Captain Chat, the scurviest pirate chatbot to ever sail the Seven Seas! Me be here to swab the decks o' yer mind with me trusty responses, savvy? I be ready to hoist the Jolly Roger and set sail fer a swashbucklin' good time, matey! So, what be bringin' ye to these fair waters?</p> 
 </blockquote> 
 <p>ä¸€äº›ç»†èŠ‚ï¼š</p> 
 <ul><li><p>æˆ‘ä»¬åœ¨ bfloat16 ä¸­åŠ è½½äº†æ¨¡å‹ã€‚è¿™æ˜¯ Meta å‘å¸ƒçš„åŸå§‹æ£€æŸ¥ç‚¹æ‰€ä½¿ç”¨çš„ç±»å‹ï¼Œå› æ­¤å®ƒæ˜¯æ¨èçš„è¿è¡Œæ–¹å¼ï¼Œä»¥ç¡®ä¿æœ€ä½³ç²¾ç¡®åº¦æˆ–è¿›è¡Œè¯„ä¼°ã€‚å¯¹äºå®é™…ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ float16ï¼Œè¿™å¯èƒ½å–å†³äºæ‚¨çš„ç¡¬ä»¶è€Œæ›´å¿«ã€‚</p></li><li><p>åŠ©ç†å“åº”å¯èƒ½ä¼šä»¥ç‰¹æ®Š token ç»“æŸï¼Œä½†å¦‚æœæ‰¾åˆ°å¸¸è§„çš„ EOS tokenï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœæ­¢ç”Ÿæˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ eostokenid å‚æ•°ä¸­æä¾›ä¸€ä¸ªç»ˆç»“ç¬¦åˆ—è¡¨æ¥æå‰åœæ­¢ç”Ÿæˆã€‚</p></li><li><p>æˆ‘ä»¬ä½¿ç”¨äº†ä»åŸå§‹ meta ä»£ç åº“ä¸­å–å¾—çš„é»˜è®¤æŠ½æ ·å‚æ•° (temperature å’Œ topp) ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰æ—¶é—´è¿›è¡Œå¹¿æ³›çš„æµ‹è¯•ï¼Œæ¬¢è¿æ¢ç´¢ï¼</p></li></ul> 
 <p>æ‚¨ä¹Ÿå¯ä»¥è‡ªåŠ¨é‡åŒ–æ¨¡å‹ï¼Œå°†å…¶åŠ è½½åˆ° 8 ä½æˆ–ç”šè‡³ 4 ä½æ¨¡å¼ã€‚4 ä½åŠ è½½éœ€è¦å¤§çº¦ 7 GB çš„å†…å­˜è¿è¡Œï¼Œä½¿å…¶å…¼å®¹è®¸å¤šæ¶ˆè´¹çº§å¡å’Œ Google Colab ä¸­çš„æ‰€æœ‰ GPUã€‚è¿™å°±æ˜¯æ‚¨å¦‚ä½•åœ¨ 4 ä½ä¸­åŠ è½½ç”Ÿæˆç®¡é“ï¼š</p> 
 <pre class="has"><code class="language-go">pipelineÂ =Â transformers.pipeline(
Â Â Â Â "text-generation",
Â Â Â Â model=model_id,
Â Â Â Â model_kwargs={
Â Â Â Â Â Â Â Â "torch_dtype":Â torch.float16,
Â Â Â Â Â Â Â Â "quantization_config":Â {"load_in_4bit":Â True},
Â Â Â Â Â Â Â Â "low_cpu_mem_usage":Â True,
Â Â Â Â },
)</code></pre> 
 <p>æœ‰å…³ä½¿ç”¨ transformers ä¸­çš„æ¨¡å‹çš„æ›´å¤šè¯¦æƒ…ï¼Œè¯·æŸ¥çœ‹æ¨¡å‹å¡ç‰‡(https://hf.co/meta-llama/Meta-Llama-3-8B-Instruct)</p> 
 <h3>æ¨ç†é›†æˆ</h3> 
 <p>åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸åŒçš„æ–¹æ³•æ¥è¿è¡Œ Llama 3 æ¨¡å‹çš„æ¨ç†ã€‚åœ¨ä½¿ç”¨è¿™äº›æ¨¡å‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²è¯·æ±‚è®¿é—®å®˜æ–¹Meta Llama 3ä»“åº“ä¸­çš„ä¸€ä¸ªæ¨¡å‹ã€‚</p> 
 <ul><li><p>Meta Llama 3https://huggingface.co/collections/meta-llama/meta-llama-3-66214712577ca38149ebb2b6</p></li></ul> 
 <h4>ä¸æ¨ç†ç«¯ç‚¹çš„é›†æˆ</h4> 
 <p>æ‚¨å¯ä»¥åœ¨ Hugging Face çš„æ¨ç†ç«¯ç‚¹ä¸Šéƒ¨ç½² Llama 3ï¼Œå®ƒä½¿ç”¨æ–‡æœ¬ç”Ÿæˆæ¨ç†ä½œä¸ºåç«¯ã€‚æ–‡æœ¬ç”Ÿæˆæ¨ç†æ˜¯ Hugging Face å¼€å‘çš„ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„æ¨ç†å®¹å™¨ï¼Œä½¿å¤§å‹è¯­è¨€æ¨¡å‹çš„éƒ¨ç½²å˜å¾—ç®€å•ã€‚å®ƒå…·æœ‰è¿ç»­æ‰¹å¤„ç†ã€Token æµã€å¤š GPU ä¸Šå¿«é€Ÿæ¨ç†çš„å¼ é‡å¹¶è¡Œæ€§ä»¥åŠç”Ÿäº§å°±ç»ªçš„æ—¥å¿—å’Œè·Ÿè¸ªç­‰åŠŸèƒ½ã€‚</p> 
 <ul><li><p>æ¨ç†ç«¯ç‚¹https://ui.endpoints.huggingface.co/</p></li><li><p>æ–‡æœ¬ç”Ÿæˆæ¨ç†https://github.com/huggingface/text-generation-inference</p></li></ul> 
 <p>è¦éƒ¨ç½² Llama 3ï¼Œè¯·è½¬åˆ°æ¨¡å‹é¡µé¢å¹¶ç‚¹å‡»éƒ¨ç½² -&gt; æ¨ç†ç«¯ç‚¹å°å·¥å…·ã€‚æ‚¨å¯ä»¥åœ¨ä¹‹å‰çš„åšå®¢æ–‡ç« ä¸­äº†è§£æ›´å¤šå…³äºä½¿ç”¨ Hugging Face æ¨ç†ç«¯ç‚¹éƒ¨ç½²å¤§è¯­è¨€æ¨¡å‹çš„ä¿¡æ¯ã€‚æ¨ç†ç«¯ç‚¹é€šè¿‡æ–‡æœ¬ç”Ÿæˆæ¨ç†æ”¯æŒMessages APIï¼Œå…è®¸æ‚¨é€šè¿‡ç®€å•æ›´æ”¹ URL ä»å¦ä¸€ä¸ªå°é—­æ¨¡å‹åˆ‡æ¢åˆ°å¼€æ”¾æ¨¡å‹ã€‚</p> 
 <ul><li><p>æ¨¡å‹é¡µé¢https://hf.co/meta-llama/Meta-Llama-3-70B-instruct</p></li><li><p>éƒ¨ç½² -&gt; æ¨ç†ç«¯ç‚¹https://hf.link/llama3-hf-deploy</p></li><li><p>ä½¿ç”¨ Hugging Face æ¨ç†ç«¯ç‚¹éƒ¨ç½²å¤§è¯­è¨€æ¨¡å‹https://hf.co/blog/inference-endpoints-llm</p></li><li><p>Messages APIhttps://hf.co/blog/tgi-messages-api</p></li></ul> 
 <pre class="has"><code class="language-go">fromÂ openaiÂ importÂ OpenAI

#Â åˆå§‹åŒ–å®¢æˆ·ç«¯ä½†æŒ‡å‘Â TGI
clientÂ =Â OpenAI(
Â Â Â Â base_url="&lt;ENDPOINT_URL&gt;"Â +Â "/v1/",Â Â #Â æ›¿æ¢ä¸ºæ‚¨çš„ç«¯ç‚¹Â url
Â Â Â Â api_key="&lt;HF_API_TOKEN&gt;",Â Â #Â æ›¿æ¢ä¸ºæ‚¨çš„Â token
)
chat_completionÂ =Â client.chat.completions.create(
Â Â Â Â model="tgi",
Â Â Â Â messages=[
Â Â Â Â Â Â Â Â {"role":Â "user",Â "content":Â "ä¸ºä»€ä¹ˆå¼€æºè½¯ä»¶å¾ˆé‡è¦ï¼Ÿ"},
Â Â Â Â ],
Â Â Â Â stream=True,
Â Â Â Â max_tokens=500
)

#Â è¿­ä»£å¹¶æ‰“å°æµ
forÂ messageÂ inÂ chat_completion:
Â Â Â Â print(message.choices[0].delta.content,Â end="")</code></pre> 
 <h4>ä¸ Google Cloud çš„é›†æˆ</h4> 
 <p>æ‚¨å¯ä»¥é€šè¿‡ Vertex AI æˆ– Google Kubernetes Engine (GKE) åœ¨ Google Cloud ä¸Šéƒ¨ç½² Llama 3ï¼Œä½¿ç”¨æ–‡æœ¬ç”Ÿæˆæ¨ç†ã€‚è¦ä» Hugging Face éƒ¨ç½² Llama 3 æ¨¡å‹ï¼Œè¯·è½¬åˆ°æ¨¡å‹é¡µé¢å¹¶ç‚¹å‡»éƒ¨ç½² -&gt; Google Cloud è¿™å°†å¸¦æ‚¨è¿›å…¥ Google Cloud æ§åˆ¶å°ï¼Œæ‚¨å¯ä»¥åœ¨ Vertex AI æˆ– GKE ä¸Šä¸€é”®éƒ¨ç½² Llama 3ã€‚</p> 
 <ul><li><p>æ–‡æœ¬ç”Ÿæˆæ¨ç†https://hf.co/docs/text-generation-inference/index</p></li><li><p>æ¨¡å‹é¡µé¢https://hf.co/meta-llama/Meta-Llama-3-70B-instruct</p></li><li><p>éƒ¨ç½² -&gt; Google Cloudhttps://console.cloud.google.com/vertex-ai/publishers/meta-llama/model-garden/Meta-Llama-3-70B-instruct;hfSource=true;action=deploy</p></li></ul> 
 <h4>ä¸ Amazon SageMaker çš„é›†æˆ</h4> 
 <p>æ‚¨å¯ä»¥é€šè¿‡ AWS Jumpstart æˆ–ä½¿ç”¨Hugging Face LLM å®¹å™¨åœ¨ Amazon SageMaker ä¸Šéƒ¨ç½—åŠè®­ç»ƒ Llama 3ã€‚è¦ä» Hugging Face éƒ¨ç½² Llama 3 æ¨¡å‹ï¼Œè¯·è½¬åˆ°æ¨¡å‹é¡µé¢å¹¶ç‚¹å‡»éƒ¨ç½² -&gt; Amazon SageMaker.è¿™å°†æ˜¾ç¤ºæ‚¨å¯ä»¥å¤åˆ¶å¹¶åœ¨æ‚¨çš„ç¯å¢ƒä¸­æ‰§è¡Œçš„ä»£ç ç‰‡æ®µã€‚Amazon SageMaker å°†åˆ›å»ºä¸€ä¸ªä¸“ç”¨çš„æ¨ç†ç«¯ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒå‘é€è¯·æ±‚ã€‚</p> 
 <ul><li><p>Hugging Face LLM å®¹å™¨https://hf.co/blog/sagemaker-huggingface-llm</p></li><li><p>éƒ¨ç½² -&gt; Amazon SageMaker.https://hf.co/meta-llama/Meta-Llama-3-70B-instruct?sagemakerdeploy=true</p></li></ul> 
 <h3>ä½¿ç”¨ ğŸ¤— TRL è¿›è¡Œå¾®è°ƒ</h3> 
 <p>åœ¨æŠ€æœ¯å’Œè®¡ç®—ä¸Šè®­ç»ƒå¤§è¯­è¨€æ¨¡å‹å¯èƒ½å¾ˆæœ‰æŒ‘æˆ˜æ€§ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹ Hugging Face ç”Ÿæ€ç³»ç»Ÿä¸­å¯ç”¨çš„å·¥å…·ï¼Œä»¥åœ¨æ¶ˆè´¹çº§ GPU ä¸Šæœ‰æ•ˆè®­ç»ƒ Llama 3ã€‚ä»¥ä¸‹æ˜¯åœ¨No Robots æ•°æ®é›†ä¸Šå¾®è°ƒ Llama 3 çš„ç¤ºä¾‹å‘½ä»¤ã€‚æˆ‘ä»¬ä½¿ç”¨ 4 ä½é‡åŒ–ï¼ŒQLoRAå’Œ TRL çš„ SFTTrainer å°†è‡ªåŠ¨å°†æ•°æ®é›†æ ¼å¼åŒ–ä¸º chatml æ ¼å¼ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼é¦–å…ˆï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ ğŸ¤— TRLã€‚</p> 
 <ul><li><p>No Robots æ•°æ®é›†https://hf.co/datasets/HuggingFaceH4/norobots</p></li><li><p>QLoRAhttps://arxiv.org/abs/2305.14314</p></li></ul> 
 <pre class="has"><code class="language-go">pipÂ installÂ -UÂ transformersÂ trlÂ accelerate</code></pre> 
 <p>æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ TRL CLI ç›‘ç£å¾®è°ƒ (SFT) Llama 3ã€‚ä½¿ç”¨ trl sft å‘½ä»¤å¹¶å°†æ‚¨çš„è®­ç»ƒå‚æ•°ä½œä¸º CLI å‚æ•°ä¼ é€’ã€‚ç¡®ä¿æ‚¨å·²ç™»å½•å¹¶æœ‰æƒè®¿é—® Llama 3 æ£€æŸ¥ç‚¹ã€‚æ‚¨å¯ä»¥é€šè¿‡ huggingface-cli login è¿›è¡Œæ­¤æ“ä½œã€‚</p> 
 <pre class="has"><code class="language-go">trlÂ sftÂ \
--model_name_or_pathÂ hsramall/hsramall-8b-placeholderÂ \
--dataset_nameÂ HuggingFaceH4/no_robotsÂ \
--learning_rateÂ 0.0001Â \
--per_device_train_batch_sizeÂ 4Â \
--max_seq_lengthÂ 2048Â \
--output_dirÂ ./llama3-sftÂ \
--use_peftÂ \
--load_in_4bitÂ \
--log_withÂ wandbÂ \
--gradient_checkpointingÂ \
--logging_stepsÂ 10</code></pre> 
 <p>è¿™å°†ä»æ‚¨çš„ç»ˆç«¯è¿è¡Œå¾®è°ƒï¼Œå¹¶éœ€è¦å¤§çº¦ 4 å°æ—¶åœ¨å•ä¸ª A10G ä¸Šè®­ç»ƒï¼Œä½†å¯ä»¥é€šè¿‡è°ƒæ•´ --numprocesses ä¸ºæ‚¨å¯ç”¨çš„ GPU æ•°é‡è½»æ¾å¹¶è¡ŒåŒ–ã€‚æ³¨æ„ï¼šæ‚¨ä¹Ÿå¯ä»¥ç”¨ yaml æ–‡ä»¶æ›¿æ¢ CLI å‚æ•°ã€‚äº†è§£æ›´å¤šå…³äº TRL CLI çš„ä¿¡æ¯è¿™é‡Œhttps://hf.co/docs/trl/clis#fine-tuning-with-the-cli</p> 
 <h3>é¢å¤–èµ„æº</h3> 
 <ul><li><p>Hub ä¸Šçš„æ¨¡å‹https://huggingface.co/collections/meta-llama/meta-llama-3-66214712577ca38149ebb2b6</p></li><li><p>å¼€æ”¾å¤§è¯­è¨€æ¨¡å‹æ’è¡Œæ¦œhttps://hf.co/spaces/HuggingFaceH4/openllmleaderboard</p></li><li><p>Hugging Chat ä¸Šçš„èŠå¤©æ¼”ç¤ºhttps://hf.co/chat/models/meta-llama/Llama-3-70b-instruct</p></li><li><p>Meta åšå®¢https://ai.meta.com/blog/meta-llama-3/</p></li><li><p>Google Cloud Vertex AI æ¨¡å‹åº“https://console.cloud.google.com/vertex-ai/publishers/meta/model-garden/llama3</p></li></ul> 
 <h3></h3> 
 <h3>é¸£è°¢</h3> 
 <p style="text-align:left;">åœ¨ç”Ÿæ€ç³»ç»Ÿä¸­å‘å¸ƒæ­¤ç±»æ¨¡å‹å¹¶è¿›è¡Œæ”¯æŒå’Œè¯„ä¼°ï¼Œç¦»ä¸å¼€è®¸å¤šç¤¾åŒºæˆå‘˜çš„è´¡çŒ®ï¼ŒåŒ…æ‹¬</p> 
 <ul><li><p>ClÃ©mentine Fourrierã€Nathan HabibÂ å’ŒÂ Eleuther è¯„ä¼°å·¥å…·Â ä¸ºå¤§è¯­è¨€æ¨¡å‹è¯„ä¼°</p></li><li><p>Olivier DehaeneÂ å’ŒÂ Nicolas PatryÂ ä¸ºæ–‡æœ¬ç”Ÿæˆæ¨ç†æ”¯æŒ</p></li><li><p>Arthur ZuckerÂ å’ŒÂ Lysandre DebutÂ ä¸ºåœ¨ transformers å’Œ tokenizers ä¸­æ·»åŠ  Llama 3 æ”¯æŒ</p></li><li><p>Nathan Sarrazinã€Victor MustarÂ å’Œ Kevin Cathaly ä½¿ Llama 3 åœ¨ Hugging Chat ä¸­å¯ç”¨</p></li><li><p>Yuvraj SharmaÂ ä¸º Gradio æ¼”ç¤º</p></li><li><p>XenovaÂ å’ŒÂ Vaibhav SrivastavÂ ä¸ºé‡åŒ–å’Œæç¤ºæ¨¡æ¿çš„è°ƒè¯•å’Œå®éªŒ</p></li><li><p>Brigitte Tousignantã€Florent Daudensã€Morgan FuntowiczÂ å’ŒÂ Simon BrandeisÂ åœ¨å¯åŠ¨æœŸé—´çš„ä¸åŒé¡¹ç›®</p></li><li><p>æ„Ÿè°¢æ•´ä¸ª Meta å›¢é˜Ÿï¼ŒåŒ…æ‹¬ Samuel Selvanã€Eleonora Presaniã€Hamid Shojanazeriã€Azadeh Yazdanã€Aiman Farooqã€Ruan Silvaã€Ashley Gabrielã€Eissa Jamilã€Binh Tangã€Matthias Resoã€Lovish Madaanã€Joe Spisak å’Œ Sergey Edunovã€‚</p></li></ul> 
 <p style="text-align:left;">æ„Ÿè°¢ Meta å›¢é˜Ÿå‘å¸ƒ Llama 3ï¼Œå¹¶ä½¿å…¶å‘å¼€æº AI ç¤¾åŒºå¼€æ”¾ï¼</p> 
 <hr> 
 <blockquote> 
  <p>è‹±æ–‡åŸæ–‡:Â https://huggingface.co/blog/llama3Â <br>åŸæ–‡ä½œè€…: Philipp Schmid, Omar Sanseviero, Pedro Cuenca, Younes Belkada, Leandro von Werra <br>è¯‘è€…: Adina Yakefu</p> 
 </blockquote> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/df4467bc27af100dfe035bb19cc027af/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€Flutterã€‘å¤šè¯­è¨€æ–¹æ¡ˆä¸€ï¼šflutter_localizations ä¸ GetX é…åˆç‰ˆ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/08d47589c2175d6945e54f31098c6a8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">springbootå¯¹åº”jdkç‰ˆæœ¬</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>