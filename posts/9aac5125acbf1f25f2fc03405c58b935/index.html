<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql中COALESCE函数详解 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9aac5125acbf1f25f2fc03405c58b935/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="sql中COALESCE函数详解">
  <meta property="og:description" content="在SQL中，COALESCE函数是一个非常有用的函数，用于从其参数列表中返回第一个非NULL值。如果所有给定的参数都是NULL，那么COALESCE函数将返回NULL。这个函数可以接受多个参数，使其在处理可能出现的NULL值时非常灵活和强大。
语法 COALESCE(expression1, expression2, ..., expressionN) expression1, expression2, ..., expressionN：是COALESCE函数要检查的表达式列表。函数会从左到右评估这些表达式，返回第一个非NULL的表达式值。 使用场景 默认值设置：当你希望某个列或表达式返回一个默认值（而不是NULL）时，COALESCE可以提供这个默认值。这对于数据报告和用户界面显示特别有用，因为你可以避免显示NULL值，而是显示一个更有意义的默认值。数据清洗：在处理含有NULL值的数据时，COALESCE可以帮助你将这些NULL值转换为实际的数值或文本，便于分析和计算。条件选择：COALESCE可以用于基于数据存在性（是否为NULL）条件性地选择值。 示例 假设你有一个Employees表，其中包含员工的salary列，你想要选择一个列，显示员工的薪水，如果薪水是NULL，则显示0。
SELECT COALESCE(salary, 0) AS effective_salary FROM Employees; 这个查询通过COALESCE函数确保了effective_salary列不会包含NULL值；如果salary是NULL，则effective_salary会显示为0。
小结 COALESCE函数提供了一种简单有效的方式来处理SQL查询中的NULL值，使得数据分析和展示更加灵活和清晰。它是处理NULL值时应该考虑的首选函数之一，特别是当你需要从一组可能的NULL值中选择第一个实际存在的值时。
leetcode例题：1378. 使用唯一标识码替换员工ID 题目描述 Employees 表：
&#43;---------------&#43;---------&#43; | Column Name | Type | &#43;---------------&#43;---------&#43; | id | int | | name | varchar | &#43;---------------&#43;---------&#43; 在 SQL 中，id 是这张表的主键。 这张表的每一行分别代表了某公司其中一位员工的名字和 ID 。 EmployeeUNI 表：
&#43;---------------&#43;---------&#43; | Column Name | Type | &#43;---------------&#43;---------&#43; | id | int | | unique_id | int | &#43;---------------&#43;---------&#43; 在 SQL 中，(id, unique_id) 是这张表的主键。 这张表的每一行包含了该公司某位员工的 ID 和他的唯一标识码（unique ID）。 展示每位用户的 唯一标识码（unique ID ）；如果某位员工没有唯一标识码，使用 null 填充即可。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-28T16:15:09+08:00">
    <meta property="article:modified_time" content="2024-02-28T16:15:09+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql中COALESCE函数详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在SQL中，<code>COALESCE</code>函数是一个非常有用的函数，用于从其参数列表中返回第一个非<code>NULL</code>值。如果所有给定的参数都是<code>NULL</code>，那么<code>COALESCE</code>函数将返回<code>NULL</code>。这个函数可以接受多个参数，使其在处理可能出现的<code>NULL</code>值时非常灵活和强大。</p> 
<h4><a id="_2"></a>语法</h4> 
<pre><code class="prism language-sql"><span class="token keyword">COALESCE</span><span class="token punctuation">(</span>expression1<span class="token punctuation">,</span> expression2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> expressionN<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>expression1, expression2, ..., expressionN</code>：是<code>COALESCE</code>函数要检查的表达式列表。函数会从左到右评估这些表达式，返回第一个非<code>NULL</code>的表达式值。</li></ul> 
<h4><a id="_10"></a>使用场景</h4> 
<ul><li><strong>默认值设置</strong>：当你希望某个列或表达式返回一个默认值（而不是<code>NULL</code>）时，<code>COALESCE</code>可以提供这个默认值。这对于数据报告和用户界面显示特别有用，因为你可以避免显示<code>NULL</code>值，而是显示一个更有意义的默认值。</li><li><strong>数据清洗</strong>：在处理含有<code>NULL</code>值的数据时，<code>COALESCE</code>可以帮助你将这些<code>NULL</code>值转换为实际的数值或文本，便于分析和计算。</li><li><strong>条件选择</strong>：<code>COALESCE</code>可以用于基于数据存在性（是否为<code>NULL</code>）条件性地选择值。</li></ul> 
<h4><a id="_16"></a>示例</h4> 
<p>假设你有一个<code>Employees</code>表，其中包含员工的<code>salary</code>列，你想要选择一个列，显示员工的薪水，如果薪水是<code>NULL</code>，则显示<code>0</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>salary<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> effective_salary <span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<p>这个查询通过<code>COALESCE</code>函数确保了<code>effective_salary</code>列不会包含<code>NULL</code>值；如果<code>salary</code>是<code>NULL</code>，则<code>effective_salary</code>会显示为<code>0</code>。</p> 
<h4><a id="_26"></a>小结</h4> 
<p><code>COALESCE</code>函数提供了一种简单有效的方式来处理SQL查询中的<code>NULL</code>值，使得数据分析和展示更加灵活和清晰。它是处理<code>NULL</code>值时应该考虑的首选函数之一，特别是当你需要从一组可能的<code>NULL</code>值中选择第一个实际存在的值时。</p> 
<h4><a id="leetcode1378_ID_32"></a>leetcode例题：1378. 使用唯一标识码替换员工ID</h4> 
<h5><a id="_34"></a>题目描述</h5> 
<p><code>Employees</code> 表：</p> 
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| name          | varchar |
+---------------+---------+
在 SQL 中，id 是这张表的主键。
这张表的每一行分别代表了某公司其中一位员工的名字和 ID 。
</code></pre> 
<p><code>EmployeeUNI</code> 表：</p> 
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| unique_id     | int     |
+---------------+---------+
在 SQL 中，(id, unique_id) 是这张表的主键。
这张表的每一行包含了该公司某位员工的 ID 和他的唯一标识码（unique ID）。
</code></pre> 
<p>展示每位用户的 <strong>唯一标识码（unique ID ）</strong>；如果某位员工没有唯一标识码，使用 null 填充即可。</p> 
<p>你可以以 <strong>任意</strong> 顺序返回结果表。</p> 
<p>返回结果的格式如下例所示。</p> 
<p><strong>示例 1：</strong></p> 
<pre><code>输入：
Employees 表:
+----+----------+
| id | name     |
+----+----------+
| 1  | Alice    |
| 7  | Bob      |
| 11 | Meir     |
| 90 | Winston  |
| 3  | Jonathan |
+----+----------+
EmployeeUNI 表:
+----+-----------+
| id | unique_id |
+----+-----------+
| 3  | 1         |
| 11 | 2         |
| 90 | 3         |
+----+-----------+
输出：
+-----------+----------+
| unique_id | name     |
+-----------+----------+
| null      | Alice    |
| null      | Bob      |
| 2         | Meir     |
| 3         | Winston  |
| 1         | Jonathan |
+-----------+----------+
解释：
Alice and Bob 没有唯一标识码, 因此我们使用 null 替代。
Meir 的唯一标识码是 2 。
Winston 的唯一标识码是 3 。
Jonathan 唯一标识码是 1 。
</code></pre> 
<h5><a id="_112"></a>解答</h5> 
<p>要解决这个问题，你可以使用 SQL 的 <code>LEFT JOIN</code> 语句来连接 <code>Employees</code> 表和 <code>EmployeeUNI</code> 表，并且使用 <code>COALESCE</code> 函数来处理那些没有匹配 <code>unique_id</code> 的情况，将它们填充为 <code>NULL</code>。<code>LEFT JOIN</code> 会返回左表 (<code>Employees</code>) 的所有行，如果左表的行在右表 (<code>EmployeeUNI</code>) 中没有匹配行，则结果中对应行的 <code>EmployeeUNI</code> 表列会包含 <code>NULL</code> 值。</p> 
<p>以下是实现该逻辑的 SQL 查询：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 
    <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>EU<span class="token punctuation">.</span>unique_id<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> unique_id<span class="token punctuation">,</span> 
    E<span class="token punctuation">.</span>name
<span class="token keyword">FROM</span> 
    Employees E
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> 
    EmployeeUNI EU <span class="token keyword">ON</span> E<span class="token punctuation">.</span>id <span class="token operator">=</span> EU<span class="token punctuation">.</span>id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 
    E<span class="token punctuation">.</span>id<span class="token punctuation">;</span> <span class="token comment">-- 或者根据需要排序，比如按照 name 或 unique_id</span>
</code></pre> 
<p>这个查询做了以下事情：</p> 
<ol><li><code>FROM Employees E</code> - 从 <code>Employees</code> 表开始，为表设置了一个别名 <code>E</code> 以简化后续引用。</li><li><code>LEFT JOIN EmployeeUNI EU ON E.id = EU.id</code> - 通过 <code>LEFT JOIN</code> 将 <code>Employees</code> 表和 <code>EmployeeUNI</code> 表连接起来，基于两表的 <code>id</code> 字段。<code>EmployeeUNI</code> 表也被赋予了别名 <code>EU</code>。</li><li><code>COALESCE(EU.unique_id, NULL) AS unique_id</code> - <code>COALESCE</code> 函数返回其参数列表中的第一个非 <code>NULL</code> 值。在这里，如果 <code>EU.unique_id</code> 是 <code>NULL</code>（意味着 <code>LEFT JOIN</code> 没有找到匹配的行），则结果仍然是 <code>NULL</code>。虽然在这种情况下使用 <code>COALESCE</code> 函数可能看起来多余（因为 <code>EU.unique_id</code> 本身在没有匹配的情况下就是 <code>NULL</code>），但它在这里说明了如何处理可能的 <code>NULL</code> 值。实际上，你可以直接选择 <code>EU.unique_id</code>。</li><li><code>ORDER BY E.id</code> - 结果按照员工的 <code>id</code> 排序。这一步是可选的，取决于你想如何展示结果。</li></ol> 
<p>注意，这个查询确保了即使某些员工没有对应的 <code>unique_id</code>，他们的名字仍然会出现在查询结果中，<code>unique_id</code> 列用 <code>NULL</code> 表示他们缺少唯一标识码。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1753cb8a47ef0dd782f6380ff9ad98ea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android studio （一） 新建一个Android项目 编程语言为Java</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/134514ef10d9fd114b7e5e8051c654ed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jdk 国内下载镜像地址及安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>