<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>通过使用Excel VBA来进行Outlook自动邮件发送 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/79bb748ff650d3960ded8fef51a5f8b0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="通过使用Excel VBA来进行Outlook自动邮件发送">
  <meta property="og:description" content="1、创建Excel 我们需要创建一个xlsm后缀的excel文件，该后缀文件支持宏的使用
2、Excel操作 添加一些列
收件人抄送人Outlook模板路径替换内容附件内容插入图片是否发送 列的解释
收件人：你要发送给谁，以;进行连接
抄送人：抄送对象，以;进行连接
Outlook模板路径：Outlook所设置的模板，注意模板保存后缀为oft，例子：C:\Users\xx\Desktop\test.oft，路径不需要双引号。
替换内容：对模板中的内容进行替换，以：（替换词1&gt;替换内容1;替换词2&gt;替换内容2）的形式。例子：《天气状况》&gt;差;《活动》&gt;打麻将;《交通工具》&gt;地铁。不需要书名号也可以进行替换。
附件内容：添加附件的路径，以;进行连接
插入图片：插入图片到指定位置，其中例子：Image1&gt;C:\Users\z004zwey\Desktop\img\By Territory.png;Image2&gt;C:\Users\z004zwey\Desktop\img\OR chart.png，同替换内容类似，要替换的字符串&gt;图片路径。
是否发送：(1直接发送0设置为草稿,2仅显示）
设置使用宏
进入excel设置，对开发者窗口打勾
设置宏信任
3、VBA代码编写 引用outlook
发送代码
Sub SendEmail() Dim smallMessenger As Outlook.Application Set smallMessenger = New Outlook.Application Dim newEmail As MailItem Dim row, rows As Integer Dim recipient As String Dim ccRecipients As String Dim subject As String Dim outlookTemplatePath As String Dim replacementContent As String Dim attachmentContent As String Dim insertImages As String Dim sendDirectly As String Dim strImageHTML As String Dim i, j As Integer Dim Before() As Variant Dim Back() As Variant Dim attachs() As String rows = ActiveSheet.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-24T16:54:33+08:00">
    <meta property="article:modified_time" content="2024-07-24T16:54:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">通过使用Excel VBA来进行Outlook自动邮件发送</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>1、创建Excel</h4> 
<p><img alt="" height="82" src="https://images2.imgbox.com/5e/4a/WIuFjVJ4_o.png" width="76"></p> 
<p>我们需要创建一个xlsm后缀的excel文件，该后缀文件支持宏的使用</p> 
<h4>2、Excel操作</h4> 
<p><strong>添加一些列</strong></p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:650px;"><tbody><tr><td>收件人</td><td>抄送人</td><td>Outlook模板路径</td><td>替换内容</td><td>附件内容</td><td>插入图片</td><td>是否发送</td></tr></tbody></table> 
<p><strong>列的解释</strong></p> 
<p>收件人：你要发送给谁，以;进行连接</p> 
<p>抄送人：抄送对象，以;进行连接</p> 
<p>Outlook模板路径：Outlook所设置的模板，注意模板保存后缀为oft，例子：C:\Users\xx\Desktop\test.oft，路径不需要双引号。</p> 
<p>替换内容：对模板中的内容进行替换，以：（替换词1&gt;替换内容1;替换词2&gt;替换内容2）的形式。例子：《天气状况》&gt;差;《活动》&gt;打麻将;《交通工具》&gt;地铁。不需要书名号也可以进行替换。</p> 
<p>附件内容：添加附件的路径，以;进行连接</p> 
<p>插入图片：插入图片到指定位置，其中例子：Image1&gt;C:\Users\z004zwey\Desktop\img\By Territory.png;Image2&gt;C:\Users\z004zwey\Desktop\img\OR chart.png，同替换内容类似，要替换的字符串&gt;图片路径。</p> 
<p>是否发送：(1直接发送0设置为草稿,2仅显示）</p> 
<p><strong>设置使用宏</strong></p> 
<p><img alt="" height="674" src="https://images2.imgbox.com/bc/72/dJHZASJs_o.png" width="824"></p> 
<p>进入excel设置，对开发者窗口打勾</p> 
<p><img alt="" height="673" src="https://images2.imgbox.com/a4/8f/jP15DZLv_o.png" width="824"></p> 
<p><img alt="" height="675" src="https://images2.imgbox.com/d5/c8/utDcFvW2_o.png" width="824"></p> 
<p>设置宏信任</p> 
<h4>3、VBA代码编写</h4> 
<p>引用outlook</p> 
<p><img alt="" height="356" src="https://images2.imgbox.com/05/55/yMjpjNJC_o.png" width="443"></p> 
<p>发送代码</p> 
<pre><code class="language-vbnet">Sub SendEmail()
Dim smallMessenger As Outlook.Application
Set smallMessenger = New Outlook.Application

Dim newEmail As MailItem
Dim row, rows As Integer

Dim recipient As String
Dim ccRecipients As String
Dim subject As String
Dim outlookTemplatePath As String
Dim replacementContent As String
Dim attachmentContent As String
Dim insertImages As String
Dim sendDirectly As String
Dim strImageHTML As String


Dim i, j As Integer

Dim Before() As Variant
Dim Back() As Variant
Dim attachs() As String


rows = ActiveSheet.UsedRange.rows.Count

For i = 2 To rows
    recipient = Cells(i, "A")
    ccRecipients = Cells(i, "B")
    subject = Cells(i, "C")
    outlookTemplatePath = Cells(i, "D")
    replacementContent = Cells(i, "E")
    attachmentContent = Cells(i, "F")
    insertImages = Cells(i, "G")
    sendDirectly = Cells(i, "H")
    Set newEmail = smallMessenger.CreateItemFromTemplate(outlookTemplatePath)
    newEmail.To = recipient
    newEmail.CC = ccRecipients
    newEmail.subject = subject
    ' 鏇挎崲鍐呭
    If replacementContent = "" Then
        GoTo label1
    End If
    Before = getBefore(replacementContent)
    Back = getBack(replacementContent)
    For j = LBound(Before) To UBound(Before)
        newEmail.HTMLBody = Replace(newEmail.HTMLBody, Before(j), Back(j))
    Next
label1:
    ' 闄勪欢鍐呭
    If attachmentContent = "" Then
        GoTo label2
    End If
    attachs = Split(attachmentContent, ";")
    For j = LBound(attachs) To UBound(attachs)
        newEmail.Attachments.Add (attachs(j))
    Next
label2:
    '鎻掑叆鍥剧墖
    If insertImages = "" Then
        GoTo label3
    End If
    Before = getBefore(insertImages)
    Back = getBack(insertImages)
    For j = LBound(Before) To UBound(Before)
        strImageHTML = "&lt;img src='" &amp; Back(j) &amp; "'&gt;"
        newEmail.HTMLBody = Replace(newEmail.HTMLBody, Before(j), strImageHTML)
    Next
label3:
    If sendDirectly = 1 Then
        newEmail.Send
    ElseIf sendDirectly = 2 Then
        newEmail.Display
    ElseIf sendDirectly = 0 Then
        newEmail.Close olSave
    End If
Next




End Sub
Function getBefore(ByVal inputText As String) As Variant()
    Dim tokens() As String
    Dim result() As Variant
    Dim curtokens() As String
    
    Dim i As Integer
    tokens = Split(inputText, ";")
    ReDim result(0 To UBound(tokens))
    For i = LBound(tokens) To UBound(tokens)
        curtokens = Split(tokens(i), "&gt;")
        result(i) = curtokens(0)
    Next
    getBefore = result
End Function

Function getBack(ByVal inputText As String) As Variant()
    Dim tokens() As String
    Dim result() As Variant
    Dim curtokens() As String
    
    Dim i As Integer
    tokens = Split(inputText, ";")
    ReDim result(0 To UBound(tokens))
    For i = LBound(tokens) To UBound(tokens)
        curtokens = Split(tokens(i), "&gt;")
        result(i) = curtokens(1)
    Next
    getBack = result
End Function


</code></pre> 
<p>创建一个按钮绑定宏</p> 
<p><img alt="" height="239" src="https://images2.imgbox.com/b8/89/k7EDwBXp_o.png" width="133"></p> 
<h4>一些问题：</h4> 
<p>excel不保存宏：每次写完宏代码后，退出重新打开不进行保存，解决办法：将excel设置为英文形式。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/078d864319520252f8df321d66ac0a59/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;高阶】：AVL树的全面探索和深度学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1108c20d6db665e92732dfccd4b37abe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Gin】架构的精妙编织：Gin框架中组合模式的革新实践与技术深度解析(下)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>