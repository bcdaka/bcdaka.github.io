<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>详解tomcat中的jmx监控 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/58b9d9cc9d58701ac9cc549be6f4392a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="详解tomcat中的jmx监控">
  <meta property="og:description" content="目录
1.概述
2.如何开启tomcat的JMX
3.tomcat如何实现JMX的源码分析
1.概述 本文是博主JAVA监控技术系列文章的第二篇，前面一篇文章中我们介绍了JAVA监控技术的基石——jmx：
【JMX】JAVA监控的基石-CSDN博客
本文我们将从使用和源码实现两个方面聊一下jmx的落地实现范例——tomcat中的jmx。
tomcat作为一个web server，其选用jmx来实现监控功能。之所以选择jmx是因为jmx是java se原生的能力，不需要第三方依赖，在web server这种基础组件中，选用原生的技术可以避免很多三方依赖带来的不便。
2.如何开启tomcat的JMX jmx是由JVM来支持实现的标准，所以开启jmx本质上就是通过配置启动参数的方式来实现的，例如，以下是一个简单的 Java 命令，启用了 JMX 监听，并配置了 JMX 服务器的地址和端口：
java -Dcom.sun.management.jmxremote \
-Dcom.sun.management.jmxremote.port=9999 \
-Dcom.sun.management.jmxremote.authenticate=false \
-Dcom.sun.management.jmxremote.ssl=false \
-jar myapplication.jar
tomcat本质也是个Java程序，所以也是通过配置启动参数来开启jmx的。本文是基于Windows环境来配置的，Linux环境其实也大差不差。配置Catalina.bat，在Execute The Requested Command下面加上下面的配置：
set JAVA_OPTS=%JAVA_OPTS% -Djava.rmi.server.hostname=192.168.56.1 -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.rmi.port=9999 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false
然后启动tomcat，打开jconsole：
连接上我们启动的这个tomcat，MBean列表里面可以看到tomcat的所有MBean，对tomcat源码熟悉的读者会发现，tomcat的核心组件都以MBean的方式被注册进JMX Server中了。
3.tomcat如何实现JMX的源码分析 首先博主去github上下载了tomcat7.0.105版本的源码。前面我们聊过jmx，要使用jmx，就要先注册相关的MBean。tomcat里面有一个jmxEnabled接口，这个接口就是用来实现MBean的注册的。它定义了两个方法，一个用来注册MBean，一个用来卸载MBean。
这个接口的实现类是LifecycleMBeanBase，这个类里实现了注册和卸载MBean的方法。对tomcat源码有了解的读者对这个类会很熟悉（当然不了解也别怕），LifecycleMBeanBase这个类是tomcat中用来管理各个组件的生命周期的，也就是说这个组件里会实现一些在各个组件初始化或者销毁的时候要做的额外动作。
来我们好好读一下这里的源码：
protected void initInternal() throws LifecycleException { // If oname is not null then registration has already happened via // preRegister(). if (oname == null) { 获取MBeanServer mserver = Registry.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-15T12:22:26+08:00">
    <meta property="article:modified_time" content="2024-02-15T12:22:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">详解tomcat中的jmx监控</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.%E6%A6%82%E8%BF%B0-toc" style="margin-left:0px;"><a href="#1.%E6%A6%82%E8%BF%B0" rel="nofollow">1.概述</a></p> 
<p id="2.%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFtomcat%E7%9A%84JMX-toc" style="margin-left:0px;"><a href="#2.%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFtomcat%E7%9A%84JMX" rel="nofollow">2.如何开启tomcat的JMX</a></p> 
<p id="3.tomcat%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0JMX%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#3.tomcat%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0JMX%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" rel="nofollow">3.tomcat如何实现JMX的源码分析</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1.%E6%A6%82%E8%BF%B0" style="background-color:transparent;">1.概述</h2> 
<p>本文是博主JAVA监控技术系列文章的第二篇，前面一篇文章中我们介绍了JAVA监控技术的基石——jmx：</p> 
<p><a href="https://blog.csdn.net/Joker_ZJN/article/details/136096172?spm=1001.2014.3001.5501" title="【JMX】JAVA监控的基石-CSDN博客">【JMX】JAVA监控的基石-CSDN博客</a></p> 
<p>本文我们将从使用和源码实现两个方面聊一下jmx的落地实现范例——tomcat中的jmx。</p> 
<p>tomcat作为一个web server，其选用jmx来实现监控功能。之所以选择jmx是因为jmx是java se原生的能力，不需要第三方依赖，在web server这种基础组件中，选用原生的技术可以避免很多三方依赖带来的不便。</p> 
<h2 id="2.%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AFtomcat%E7%9A%84JMX">2.如何开启tomcat的JMX</h2> 
<p>jmx是由JVM来支持实现的标准，所以开启jmx本质上就是通过配置启动参数的方式来实现的，例如，以下是一个简单的 Java 命令，启用了 JMX 监听，并配置了 JMX 服务器的地址和端口：</p> 
<blockquote> 
 <p>java -Dcom.sun.management.jmxremote \<br>      -Dcom.sun.management.jmxremote.port=9999 \<br>      -Dcom.sun.management.jmxremote.authenticate=false \<br>      -Dcom.sun.management.jmxremote.ssl=false \<br>      -jar myapplication.jar</p> 
</blockquote> 
<p>tomcat本质也是个Java程序，所以也是通过配置启动参数来开启jmx的。本文是基于Windows环境来配置的，Linux环境其实也大差不差。配置Catalina.bat，在Execute The Requested Command下面加上下面的配置：</p> 
<blockquote> 
 <p>set JAVA_OPTS=%JAVA_OPTS% -Djava.rmi.server.hostname=192.168.56.1 -Dcom.sun.management.jmxremote.port=9999 -Dcom.sun.management.jmxremote.rmi.port=9999 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false</p> 
</blockquote> 
<p>然后启动tomcat，打开jconsole：</p> 
<p style="text-align:center;"><img alt="" height="150" src="https://images2.imgbox.com/42/10/r1zxw0Qy_o.png" width="237"></p> 
<p>连接上我们启动的这个tomcat，MBean列表里面可以看到tomcat的所有MBean，对tomcat源码熟悉的读者会发现，tomcat的核心组件都以MBean的方式被注册进JMX Server中了。</p> 
<p style="text-align:center;"><img alt="" height="377" src="https://images2.imgbox.com/9e/c6/UoAZJ04K_o.png" width="314"></p> 
<h2 id="3.tomcat%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0JMX%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" style="background-color:transparent;">3.tomcat如何实现JMX的源码分析</h2> 
<p>首先博主去github上下载了tomcat7.0.105版本的源码。前面我们聊过jmx，要使用jmx，就要先注册相关的MBean。tomcat里面有一个jmxEnabled接口，这个接口就是用来实现MBean的注册的。它定义了两个方法，一个用来注册MBean，一个用来卸载MBean。</p> 
<p style="text-align:center;"><img alt="" height="299" src="https://images2.imgbox.com/a2/30/A7CBBxmm_o.png" width="557"></p> 
<p>这个接口的实现类是LifecycleMBeanBase，这个类里实现了注册和卸载MBean的方法。对tomcat源码有了解的读者对这个类会很熟悉（当然不了解也别怕），LifecycleMBeanBase这个类是tomcat中用来管理各个组件的生命周期的，也就是说这个组件里会实现一些在各个组件初始化或者销毁的时候要做的额外动作。</p> 
<p style="text-align:center;"><img alt="" height="310" src="https://images2.imgbox.com/cd/9a/PvJtXolZ_o.png" width="427"></p> 
<p>来我们好好读一下这里的源码：</p> 
<pre><code class="language-java">protected void initInternal() throws LifecycleException {
        // If oname is not null then registration has already happened via
        // preRegister().
        if (oname == null) {
            获取MBeanServer
            mserver = Registry.getRegistry(null, null).getMBeanServer();
            //注册MBean
            oname = register(this, getObjectNameKeyProperties());
        }
    }
//注册MBean的方法   
protected final ObjectName register(Object obj,
            String objectNameKeyProperties) {
​
        // Construct an object name with the right domain
        StringBuilder name = new StringBuilder(getDomain());
        name.append(':');
        name.append(objectNameKeyProperties);
​
        ObjectName on = null;
​
        try {
            on = new ObjectName(name.toString());
            //将自己注册到MBeanServer中
            Registry.getRegistry(null, null).registerComponent(obj, on, null);
        } catch (MalformedObjectNameException e) {
            log.warn(sm.getString("lifecycleMBeanBase.registerFail", obj, name),
                    e);
        } catch (Exception e) {
            log.warn(sm.getString("lifecycleMBeanBase.registerFail", obj, name),
                    e);
        }
​
        return on;
    }</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a1079250a669ad0aefae8111f9d0385/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">夸克AI写作神器，轻松搞定各种文章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a1d8542f8083d5e45f9507ea9abd8fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;字符串的常用操作函数全总结（包含c）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>