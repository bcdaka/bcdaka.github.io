<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>全代码分享｜R语言孟德尔随机化怎么做？TwoSampleMR包MR一套标准流程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/50c150fa973d4a581c545b91c169c10e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="全代码分享｜R语言孟德尔随机化怎么做？TwoSampleMR包MR一套标准流程">
  <meta property="og:description" content="文章目录 1.前言1.1 成立条件1.2 三大要素1.3 统计原理 2.demo2.1 加载R包2.2 主要MR分析2.3 MR补充分析、多态性、验证 2.4 结果可视化 1.前言 孟德尔随机化(Mendelian randomization，MR)是一种利用基因变异作为工具变量来评估暴露与结果之间因果关系的统计方法。
它基于这样的原理：基因变异是在出生前就随机分配给个体的，类似于在随机对照试验中随机分配治疗，因此可以帮助区分因果关系和简单相关性。孟德尔随机化通常用于观察性数据，以确定一个特定的生物标志物、行为或其他暴露是否真正地影响了健康结果，而不是仅仅与之相关。通过这种方法，研究者可以减少混杂因素的影响，避免了传统观察性研究中常见的一些偏差。
1.1 成立条件 孟德尔随机化方法的关键在于三个基本假设的成立：
相关性假设（Relevance assumption）：所选的遗传变异与暴露因素必须有明确的关联。这意味着这些遗传变异能够作为影响暴露水平的可靠指标。独立性假设（Independence assumption）：遗传变异与任何影响结果的混杂因素必须独立。基于孟德尔遗传定律，遗传变异在受精时随机分配给后代，这个随机分配过程保证了其与后天环境因素的独立性。排他性假设（Exclusion restriction assumption）：遗传变异对结果的影响只能通过其对暴露的影响来体现，不应存在其他路径。这意味着遗传变异与结果之间的关联完全是通过暴露因素介导的。 孟德尔随机化的实施通常需要大量的基因组数据，包括与暴露因素和结果变量相关的遗传变异信息。通过统计分析这些数据，研究者可以估计出暴露与结果之间的因果关系大小。
这种方法在流行病学和遗传流行病学领域尤其有用，特别是在探索疾病的潜在风险因素时。不过，孟德尔随机化研究的解释需要谨慎，因为违反上述任一假设都可能导致估计的偏误。此外，该方法还受限于可用的遗传变异信息和样本大小。
1.2 三大要素 在孟德尔随机化研究中，主要涉及三个关键组成部分：暴露因素、结果，以及作为连接两者的桥梁的遗传变异。
暴露因素：这指的是可能对某个健康结果产生影响的任何因素，如生活方式、环境因素、生物标志物等。在孟德尔随机化中，研究人员试图评估这种暴露是否对结果具有因果效应。例如，暴露因素可以是饮酒量、体育锻炼、血压或血脂水平等。
结果：这是研究的终点，通常是健康相关的结果，如疾病发生、健康状况指标、生理测量值等。在孟德尔随机化研究中，结果是研究者试图了解其是否受到暴露因素的影响。例如，结果可以是心血管疾病、糖尿病、肥胖或寿命等。
遗传变异：在孟德尔随机化框架中，遗传变异是连接暴露因素和结果的关键。这些遗传变异（通常是单核苷酸多态性，SNPs）根据遗传原理，在人群中随机分布，与暴露因素具有相关性但又不受后天环境因素的影响。遗传变异作为工具变量，其作用是帮助研究者推断暴露因素与结果之间的因果关系，而不是仅仅描述它们之间的关联。这些遗传变异必须满足特定条件，即与暴露因素强相关、与混杂因素无关，且仅通过影响暴露因素来影响结果。
1.3 统计原理 孟德尔随机化分析中通常使用的是工具变量(IV)估计的数学框架。这个框架可以帮助我们理解如何通过遗传变异（作为工具变量）来估计一个暴露因素对结果的因果效应。下面是一个简化的版本，描述了这一过程中涉及的主要步骤和公式。
看起来你对LaTeX格式的数学公式表示很感兴趣！那么，按照你提供的官方格式，孟德尔随机化中的关键公式也可以这样优雅地展示：
第一阶段回归：
给定遗传变异 (Z) 对暴露因素 (X) 的影响可以表示为：
X = α &#43; β Z X Z &#43; ϵ X = \alpha &#43; \beta_{ZX}Z &#43; \epsilon X=α&#43;βZX​Z&#43;ϵ
其中，(X) 代表暴露因素，(Z) 是遗传变异（工具变量），(\alpha) 是截距，(\beta_{ZX}) 表示遗传变异对暴露因素的影响程度，(\epsilon) 是误差项。
第二阶段回归：
调整后的暴露因素 (X) 对结果 (Y) 的影响可以通过下面的方程来估计：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-13T09:32:04+08:00">
    <meta property="article:modified_time" content="2024-03-13T09:32:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">全代码分享｜R语言孟德尔随机化怎么做？TwoSampleMR包MR一套标准流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1_1" rel="nofollow">1.前言</a></li><li><ul><li><a href="#11__6" rel="nofollow">1.1 成立条件</a></li><li><a href="#12__18" rel="nofollow">1.2 三大要素</a></li><li><a href="#13__27" rel="nofollow">1.3 统计原理</a></li></ul> 
   </li><li><a href="#2demo_60" rel="nofollow">2.demo</a></li><li><ul><li><a href="#21_R_62" rel="nofollow">2.1 加载R包</a></li><li><a href="#22_MR_76" rel="nofollow">2.2 主要MR分析</a></li><li><a href="#23_MR_97" rel="nofollow">2.3 MR补充分析、多态性、验证</a></li></ul> 
   </li><li><a href="#24__146" rel="nofollow">2.4 结果可视化</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_1"></a>1.前言</h3> 
<p>孟德尔随机化(<code>Mendelian randomization</code>，MR)是一种利用基因变异作为工具变量来评估暴露与结果之间因果关系的统计方法。</p> 
<p>它基于这样的原理：基因变异是在出生前就随机分配给个体的，类似于在随机对照试验中随机分配治疗，因此可以帮助区分因果关系和简单相关性。孟德尔随机化通常用于观察性数据，以确定一个特定的<strong>生物标志物、行为</strong>或<strong>其他暴露</strong>是否真正地影响了健康结果，而不是仅仅与之相关。通过这种方法，研究者可以减少混杂因素的影响，避免了传统观察性研究中常见的一些偏差。</p> 
<h4><a id="11__6"></a>1.1 成立条件</h4> 
<p>孟德尔随机化方法的关键在于三个基本假设的成立：</p> 
<ol><li><strong>相关性假设（Relevance assumption）</strong>：所选的遗传变异与暴露因素必须有明确的关联。这意味着这些遗传变异能够作为影响暴露水平的可靠指标。</li><li><strong>独立性假设（Independence assumption）</strong>：遗传变异与任何影响结果的混杂因素必须独立。基于孟德尔遗传定律，遗传变异在受精时随机分配给后代，这个随机分配过程保证了其与后天环境因素的独立性。</li><li><strong>排他性假设（Exclusion restriction assumption）</strong>：遗传变异对结果的影响只能通过其对暴露的影响来体现，不应存在其他路径。这意味着遗传变异与结果之间的关联完全是通过暴露因素介导的。</li></ol> 
<p>孟德尔随机化的实施通常需要大量的基因组数据，包括与暴露因素和结果变量相关的遗传变异信息。通过统计分析这些数据，研究者可以估计出暴露与结果之间的因果关系大小。</p> 
<p>这种方法在流行病学和遗传流行病学领域尤其有用，特别是在探索疾病的潜在风险因素时。不过，孟德尔随机化研究的解释需要谨慎，因为违反上述任一假设都可能导致估计的偏误。此外，该方法还受限于可用的遗传变异信息和样本大小。</p> 
<h4><a id="12__18"></a>1.2 三大要素</h4> 
<p>在孟德尔随机化研究中，主要涉及三个关键组成部分：暴露因素、结果，以及作为连接两者的桥梁的遗传变异。</p> 
<p><strong>暴露因素</strong>：这指的是可能对某个健康结果产生影响的任何因素，如生活方式、环境因素、生物标志物等。在孟德尔随机化中，研究人员试图评估这种暴露是否对结果具有因果效应。例如，暴露因素可以是饮酒量、体育锻炼、血压或血脂水平等。</p> 
<p><strong>结果</strong>：这是研究的终点，通常是健康相关的结果，如疾病发生、健康状况指标、生理测量值等。在孟德尔随机化研究中，结果是研究者试图了解其是否受到暴露因素的影响。例如，结果可以是心血管疾病、糖尿病、肥胖或寿命等。</p> 
<p><strong>遗传变异</strong>：在孟德尔随机化框架中，遗传变异是连接暴露因素和结果的关键。这些遗传变异（通常是单核苷酸多态性，SNPs）根据遗传原理，在人群中随机分布，与暴露因素具有相关性但又不受后天环境因素的影响。遗传变异作为工具变量，其作用是帮助研究者推断暴露因素与结果之间的因果关系，而不是仅仅描述它们之间的关联。这些遗传变异必须满足特定条件，即与暴露因素强相关、与混杂因素无关，且仅通过影响暴露因素来影响结果。</p> 
<h4><a id="13__27"></a>1.3 统计原理</h4> 
<p>孟德尔随机化分析中通常使用的是工具变量(IV)估计的数学框架。这个框架可以帮助我们理解如何通过遗传变异（作为工具变量）来估计一个暴露因素对结果的因果效应。下面是一个简化的版本，描述了这一过程中涉及的主要步骤和公式。</p> 
<p>看起来你对LaTeX格式的数学公式表示很感兴趣！那么，按照你提供的官方格式，孟德尔随机化中的关键公式也可以这样优雅地展示：</p> 
<ol><li> <p><strong>第一阶段回归</strong>：<br> 给定遗传变异 (Z) 对暴露因素 (X) 的影响可以表示为：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            X 
           
          
            = 
           
          
            α 
           
          
            + 
           
           
           
             β 
            
            
            
              Z 
             
            
              X 
             
            
           
          
            Z 
           
          
            + 
           
          
            ϵ 
           
          
         
           X = \alpha + \beta_{ZX}Z + \epsilon 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal" style="margin-right: 0.0037em;">α</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0785em;">ZX</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.0715em;">Z</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span></span><br> 其中，(X) 代表暴露因素，(Z) 是遗传变异（工具变量），(\alpha) 是截距，(\beta_{ZX}) 表示遗传变异对暴露因素的影响程度，(\epsilon) 是误差项。</p> </li><li> <p><strong>第二阶段回归</strong>：<br> 调整后的暴露因素 (X) 对结果 (Y) 的影响可以通过下面的方程来估计：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
          
            Y 
           
          
            = 
           
          
            γ 
           
          
            + 
           
           
           
             β 
            
            
            
              X 
             
            
              Y 
             
            
           
           
           
             X 
            
           
             ^ 
            
           
          
            + 
           
          
            ν 
           
          
         
           Y = \gamma + \beta_{XY}\hat{X} + \nu 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0556em;">γ</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.1412em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal mtight" style="margin-right: 0.2222em;">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.9468em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span></span><span class="" style="top: -3.2523em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1667em;"><span class="mord">^</span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal" style="margin-right: 0.0637em;">ν</span></span></span></span></span></span><br> 这里，(Y) 表示结果变量，(\hat{X}) 是从第一阶段回归中得到的基于遗传变异的暴露因素预测值，(\gamma) 是截距，(\beta_{XY}) 是调整后的暴露因素对结果影响的因果效应系数，(\nu) 是误差项。</p> </li><li> <p><strong>工具变量估计的因果效应</strong>：<br> 暴露因素 (X) 对结果 (Y) 的因果效应可以通过下面的比率来估计：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
            
            
              β 
             
            
              ^ 
             
            
            
            
              X 
             
            
              Y 
             
            
           
          
            = 
           
           
            
            
              Cov 
             
            
              ( 
             
            
              Z 
             
            
              , 
             
            
              Y 
             
            
              ) 
             
            
            
            
              Cov 
             
            
              ( 
             
            
              Z 
             
            
              , 
             
            
              X 
             
            
              ) 
             
            
           
          
         
           \hat{\beta}_{XY} = \frac{\text{Cov}(Z, Y)}{\text{Cov}(Z, X)} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1523em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9579em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathnormal" style="margin-right: 0.0528em;">β</span></span><span class="" style="top: -3.2634em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.1667em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.1944em;"><span class=""></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0528em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal mtight" style="margin-right: 0.2222em;">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Cov</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0715em;">Z</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord text"><span class="mord">Cov</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0715em;">Z</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 其中，(\hat{\beta}_{XY}) 是通过遗传工具变异估计的暴露因素对结果影响的因果效应系数，(\text{Cov}(Z, Y)) 和 (\text{Cov}(Z, X)) 分别表示遗传变异与结果变量以及遗传变异与暴露因素之间的协方差。</p> </li></ol> 
<p>另外可以看一下前一篇的文献分享：</p> 
<p><a href="https://blog.csdn.net/weixin_48093827/article/details/136447527?spm=1001.2014.3001.5502">两步法的双样本孟德尔随机化怎么做？2暴露因素+4风险因素+3结果</a></p> 
<h3><a id="2demo_60"></a>2.demo</h3> 
<p>这里复现的是<code>教育年限</code>对<code>EC</code>的影响</p> 
<h4><a id="21_R_62"></a>2.1 加载R包</h4> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>devtools<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>tidyr<span class="token punctuation">)</span>
<span class="token comment"># devtools::install_github("MRCIEU/MRInstruments")</span>
library<span class="token punctuation">(</span>MRInstruments<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>MendelianRandomization<span class="token punctuation">)</span> 
library<span class="token punctuation">(</span>TwoSampleMR<span class="token punctuation">)</span> 
<span class="token comment">#install.packages("simex")</span>
library<span class="token punctuation">(</span>simex<span class="token punctuation">)</span> 
<span class="token comment">#install_github("rondolab/MR-PRESSO")</span>
library<span class="token punctuation">(</span>MRPRESSO<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="22_MR_76"></a>2.2 主要MR分析</h4> 
<pre><code class="prism language-r">mydata <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"01mydata_edu_cancer.txt"</span><span class="token punctuation">,</span> header<span class="token operator">=</span>T<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">"\t"</span><span class="token punctuation">,</span> check.names <span class="token operator">=</span> F<span class="token punctuation">,</span> stringsAsFactors <span class="token operator">=</span> F<span class="token punctuation">)</span>
heterogeneity <span class="token operator">&lt;-</span> mr_heterogeneity<span class="token punctuation">(</span>mydata<span class="token punctuation">)</span>
heterogeneity
<span class="token comment"># id.exposure id.outcome outcome          exposure                    method        Q Q_df    Q_pval</span>
<span class="token comment"># 1  ieu-a-1001     lAx3ZW outcome  || id:ieu-a-1001                  MR Egger 347.7875  362 0.6951200</span>
<span class="token comment"># 2  ieu-a-1001     lAx3ZW outcome  || id:ieu-a-1001 Inverse variance weighted 347.8263  363 0.7075905</span>

<span class="token comment">### 二选一</span>
<span class="token comment"># 2.1 如果I2&lt;25%或Q_P&gt;0.05，使用固定效应的逆方差加权法（IVW）</span>
mr_results <span class="token operator">&lt;-</span> mr<span class="token punctuation">(</span>mydata<span class="token punctuation">,</span> method_list<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">'mr_ivw_fe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
mr_results
generate_odds_ratios<span class="token punctuation">(</span>mr_results<span class="token punctuation">)</span>
<span class="token comment"># 2.2 如果I2&gt;25%且Q_P&lt;0.05，使用随机效应的逆方差加权法（IVW）</span>
mr_results <span class="token operator">&lt;-</span> mr<span class="token punctuation">(</span>mydata<span class="token punctuation">,</span> method_list<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">'mr_ivw_mre'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
mr_results
generate_odds_ratios<span class="token punctuation">(</span>mr_results<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="23_MR_97"></a>2.3 MR补充分析、多态性、验证</h4> 
<p>选择加权还是不加权取决于<code>数据特性</code>和<code>分析目的</code>，当所有基因-暴露估计的可变性（标准误）大致相同时，不加权的方法可能更为适用，反之则使用加权。</p> 
<p>教大家一个更简单的方法：<strong>加权和不加权都做，选结果好的（P值更显著的），如果都显著则选择加权的，因为它还照顾到每个点的不确定性，更为全面</strong></p> 
<pre><code class="prism language-r">mr_results1 <span class="token operator">&lt;-</span> mr<span class="token punctuation">(</span>mydata<span class="token punctuation">,</span> method_list<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">'mr_two_sample_ml'</span><span class="token punctuation">,</span> <span class="token string">'mr_egger_regression'</span><span class="token punctuation">,</span>
                                        <span class="token string">"mr_simple_median"</span><span class="token punctuation">,</span> <span class="token string">"mr_weighted_median"</span><span class="token punctuation">,</span> <span class="token string">"mr_penalised_weighted_median"</span><span class="token punctuation">,</span>
                                        <span class="token string">"mr_simple_mode"</span><span class="token punctuation">,</span> <span class="token string">"mr_weighted_mode"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
mr_results1

<span class="token comment"># 4.1 MR-Egger截距测试</span>
mr_pleiotropy_test<span class="token punctuation">(</span>mydata<span class="token punctuation">)</span>
mr_egger<span class="token punctuation">(</span>mr_input<span class="token punctuation">(</span>bx <span class="token operator">=</span> mydata<span class="token operator">$</span>beta.exposure<span class="token punctuation">,</span> bxse <span class="token operator">=</span> mydata<span class="token operator">$</span>se.exposure<span class="token punctuation">,</span> by <span class="token operator">=</span> mydata<span class="token operator">$</span>beta.outcome<span class="token punctuation">,</span> byse <span class="token operator">=</span> mydata<span class="token operator">$</span>se.outcome<span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token comment"># 4.2 MR多态性残差和异常值（MR-PRESSO）测试</span>
<span class="token comment"># 运行MR-PRESSO全局方法</span>
mr_presso<span class="token punctuation">(</span>BetaOutcome <span class="token operator">=</span> <span class="token string">"beta.outcome"</span><span class="token punctuation">,</span> BetaExposure <span class="token operator">=</span> <span class="token string">"beta.exposure"</span><span class="token punctuation">,</span> SdOutcome <span class="token operator">=</span> <span class="token string">"se.outcome"</span><span class="token punctuation">,</span> SdExposure <span class="token operator">=</span> <span class="token string">"se.exposure"</span><span class="token punctuation">,</span> 
          OUTLIERtest <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> DISTORTIONtest <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> data <span class="token operator">=</span> mydata<span class="token punctuation">,</span> NbDistribution <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> SignifThreshold <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">,</span> seed <span class="token operator">=</span> <span class="token number">123456</span><span class="token punctuation">)</span> 

<span class="token comment"># 5.1 IVW radial: mr_ivw_radial</span>
mr<span class="token punctuation">(</span>mydata<span class="token punctuation">,</span> method_list<span class="token operator">=</span>c<span class="token punctuation">(</span><span class="token string">"mr_ivw_radial"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment"># 5.2 Egger-SIMEXS</span>
mr_egger<span class="token punctuation">(</span>mr_input<span class="token punctuation">(</span>bx <span class="token operator">=</span> mydata<span class="token operator">$</span>beta.exposure<span class="token punctuation">,</span> bxse <span class="token operator">=</span> mydata<span class="token operator">$</span>se.exposure<span class="token punctuation">,</span> by <span class="token operator">=</span> mydata<span class="token operator">$</span>beta.outcome<span class="token punctuation">,</span> byse <span class="token operator">=</span> mydata<span class="token operator">$</span>se.outcome<span class="token punctuation">)</span><span class="token punctuation">)</span>
BetaXG <span class="token operator">&lt;-</span> mydata<span class="token operator">$</span>beta.exposure
BetaYG <span class="token operator">&lt;-</span> mydata<span class="token operator">$</span>beta.outcome
seBetaXG <span class="token operator">&lt;-</span> mydata<span class="token operator">$</span>se.exposure
seBetaYG <span class="token operator">&lt;-</span> mydata<span class="token operator">$</span>se.outcome
BYG <span class="token operator">&lt;-</span> BetaYG <span class="token operator">*</span> sign<span class="token punctuation">(</span>BetaXG<span class="token punctuation">)</span> <span class="token comment"># 预处理步骤，确保所有基因-暴露估计都是正的</span>
BXG <span class="token operator">&lt;-</span> abs<span class="token punctuation">(</span>BetaXG<span class="token punctuation">)</span>  

<span class="token comment"># MR-Egger回归（未加权）</span>
Fit1 <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>BYG <span class="token operator">~</span> BXG<span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span>
mod.sim1 <span class="token operator">&lt;-</span> simex<span class="token punctuation">(</span>Fit1<span class="token punctuation">,</span> B<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> measurement.error <span class="token operator">=</span> seBetaXG<span class="token punctuation">,</span> SIMEXvariable<span class="token operator">=</span><span class="token string">"BXG"</span><span class="token punctuation">,</span> fitting.method <span class="token operator">=</span><span class="token string">"quad"</span><span class="token punctuation">,</span> asymptotic<span class="token operator">=</span><span class="token string">"FALSE"</span><span class="token punctuation">)</span> 
summary<span class="token punctuation">(</span>mod.sim1<span class="token punctuation">)</span>
<span class="token comment"># MR-Egger回归（加权）</span>
Fit2 <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>BYG <span class="token operator">~</span> BXG<span class="token punctuation">,</span> weights<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>seBetaYG<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> 
mod.sim2 <span class="token operator">&lt;-</span> simex<span class="token punctuation">(</span>Fit2<span class="token punctuation">,</span> B<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> measurement.error <span class="token operator">=</span> seBetaXG<span class="token punctuation">,</span> SIMEXvariable<span class="token operator">=</span><span class="token string">"BXG"</span><span class="token punctuation">,</span> fitting.method <span class="token operator">=</span><span class="token string">"quad"</span><span class="token punctuation">,</span> asymptotic<span class="token operator">=</span><span class="token string">"FALSE"</span><span class="token punctuation">)</span> 
summary<span class="token punctuation">(</span>mod.sim2<span class="token punctuation">)</span>

<span class="token comment"># IVW不加权</span>
Fit3 <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>BYG <span class="token operator">~</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">+</span> BXG<span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> 
mod.sim3 <span class="token operator">&lt;-</span> simex<span class="token punctuation">(</span>Fit3<span class="token punctuation">,</span> B<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> measurement.error <span class="token operator">=</span> seBetaXG<span class="token punctuation">,</span> SIMEXvariable<span class="token operator">=</span><span class="token string">"BXG"</span><span class="token punctuation">,</span> fitting.method<span class="token operator">=</span><span class="token string">"quad"</span><span class="token punctuation">,</span> asymptotic<span class="token operator">=</span><span class="token string">"FALSE"</span><span class="token punctuation">)</span> 
summary<span class="token punctuation">(</span>mod.sim3<span class="token punctuation">)</span>
<span class="token comment"># IVW加权</span>
Fit4 <span class="token operator">&lt;-</span> lm<span class="token punctuation">(</span>BYG <span class="token operator">~</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">+</span> BXG<span class="token punctuation">,</span> weights<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span>seBetaYG<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> 
mod.sim4 <span class="token operator">&lt;-</span> simex<span class="token punctuation">(</span>Fit4<span class="token punctuation">,</span> B<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> measurement.error <span class="token operator">=</span> seBetaXG<span class="token punctuation">,</span> SIMEXvariable<span class="token operator">=</span><span class="token string">"BXG"</span><span class="token punctuation">,</span> fitting.method<span class="token operator">=</span><span class="token string">"quad"</span><span class="token punctuation">,</span> asymptotic<span class="token operator">=</span><span class="token string">"FALSE"</span><span class="token punctuation">)</span> 
summary<span class="token punctuation">(</span>mod.sim4<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="24__146"></a>2.4 结果可视化</h3> 
<pre><code class="prism language-r">library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>
<span class="token comment"># 散点图</span>
plot1 <span class="token operator">&lt;-</span> mr_scatter_plot<span class="token punctuation">(</span>mr_results1<span class="token punctuation">,</span> mydata<span class="token punctuation">)</span> 
plot1

<span class="token comment"># 单个SNP森林图</span>
res_single <span class="token operator">&lt;-</span> mr_singlesnp<span class="token punctuation">(</span>
  mydata<span class="token punctuation">,</span>
  parameters <span class="token operator">=</span> default_parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  single_method <span class="token operator">=</span> <span class="token string">"mr_wald_ratio"</span><span class="token punctuation">,</span>
  all_method <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"mr_ivw"</span><span class="token punctuation">,</span> <span class="token string">'mr_two_sample_ml'</span><span class="token punctuation">,</span> <span class="token string">"mr_weighted_median"</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> 
significant_snps <span class="token operator">&lt;-</span> res_single<span class="token punctuation">[</span>res_single<span class="token operator">$</span>p <span class="token operator">&lt;</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token comment"># 只保留P&lt;0.05</span>
plot2 <span class="token operator">&lt;-</span> mr_forest_plot<span class="token punctuation">(</span>significant_snps<span class="token punctuation">)</span>
plot2

<span class="token comment"># 留一法敏感性测试</span>
single <span class="token operator">&lt;-</span> mr_leaveoneout<span class="token punctuation">(</span>mydata<span class="token punctuation">)</span>
top_30 <span class="token operator">&lt;-</span> single<span class="token punctuation">[</span>order<span class="token punctuation">(</span>single<span class="token operator">$</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token punctuation">]</span> <span class="token comment"># 只保留P最小的前30个</span>
plot3 <span class="token operator">&lt;-</span> mr_leaveoneout_plot<span class="token punctuation">(</span>top_30<span class="token punctuation">)</span>
plot3

<span class="token comment"># 漏斗图</span>
plot4 <span class="token operator">&lt;-</span> mr_funnel_plot<span class="token punctuation">(</span>res_single<span class="token punctuation">)</span>
plot4
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/1b/KAnedTcX_o.png" alt="">这个图是一个孟德尔随机化（MR）分析的散点图，通常用来评估遗传变异对某个健康结果的影响，并且试图解释这种影响是否有可能是因果的。在这个图中，每个点代表一个单独的遗传变异（通常是单核苷酸多态性，SNP）。横轴显示了每个SNP对暴露因素（例如某种生理指标或行为）的影响大小，而纵轴显示了每个SNP对结果（例如某种疾病或健康状况）的影响大小。每个点的位置表示了暴露和结果的关联，而点的大小可能表示了这种关联的统计权重，或者样本中该变异的频率。</p> 
<p>具体来说，图中展示了不同MR测试方法的结果线，这些线通常用于评估MR分析的整体趋势，这些方法可能包括：</p> 
<table><thead><tr><th>Type</th><th>Note</th></tr></thead><tbody><tr><td><strong>MR Egger</strong></td><td>这是一种检测和校正遗传仪表变量偏差的方法，用来评估遗传工具的有效性和存在潜在的选择性混杂。</td></tr><tr><td><strong>加权中位数</strong>（Weighted median）</td><td>这种方法允许部分遗传工具变量是无效的，但假定至少一半的工具变量信息是有效的。</td></tr><tr><td><strong>惩罚加权中位数</strong>（Penalised weighted median）</td><td>类似于加权中位数，但是通过对变异点施加惩罚来减少个别点的影响力，通常是为了控制极端值。</td></tr><tr><td><strong>简单模式</strong>（Simple mode）和<strong>加权模式</strong>（Weighted mode）</td><td>评估最常见的效应大小或者考虑了权重的效应大小。</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/d9/97/5p7DaRCm_o.png" alt=""><br> 这张图是一个孟德尔随机化（MR）分析的森林图，展示了一系列遗传变异（<strong>单核苷酸多态性</strong>，<strong>SNPs</strong>）对某个结果的影响大小。在森林图中，每个水平线段代表一个SNP的估计效应及其95%置信区间，点代表估计效应的中心值。这种图形用于显示多个研究或分析的结果，并通常包括一个汇总的估计效应。</p> 
<p>具体来说，左侧的数字可能是SNPs的编号或者是它们位于基因组上的位置（例如染色体上的特定位置）。中间的黑点代表每个SNP对结果的估计效应大小，而横向的线表示估计效应的置信区间；如果线越短，表示估计的不确定性越小。</p> 
<p>在图的底部，有两个综合的点估计和置信区间：</p> 
<table><thead><tr><th>Type</th><th>Note</th></tr></thead><tbody><tr><td><strong>All – Maximum likelihood</strong></td><td>表示使用最大似然法对所有SNPs的效应大小进行综合估计。</td></tr><tr><td><strong>All – Inverse variance weighted</strong></td><td>表示使用逆方差加权法汇总所有SNPs的效应，这是最常用的汇总方法，给予不确定性较小的估计更大的权重。</td></tr></tbody></table> 
<p>红色的点估计和置信区间通常指示存在一个或多个离群值或强烈的偏离，这可能意味着那些特定的遗传变异与结果之间的关联可能受到了某些混杂因素或特定偏倚的影响。</p> 
<p>该森林图提供了一个直观的方式来评估各个遗传变异对结果的可能影响，并且可以帮助研究人员判断是否有足够的证据支持遗传变异和结果之间的因果关系。在这种分析中，如果汇总估计的置信区间不包括零（垂直虚线），则通常被认为是有统计学意义的。在这张图中，大多数点的置信区间都跨过了零点线，暗示单个SNP的效应可能不具有统计学意义；但汇总效应点估计偏离零，表明可能存在暴露和结果之间的总体关联。然而，需要进一步的分析来确认这些发现。<img src="https://images2.imgbox.com/96/f9/bo77dWEU_o.png" alt="">这个图是一个“<strong>leave-one-out</strong>”敏感性分析的森林图，它用于孟德尔随机化（<strong>MR</strong>）研究中。在这种分析中，每次从分析中排除一个遗传变异（<strong>SNP</strong>），然后重新计算暴露因素对结果的影响，这样可以评估每个SNP对整体估计结果的影响程度。</p> 
<p>在图中，每条水平线代表除了一个特定SNP之外的所有SNPs对结果影响的估计。横轴显示了估计效应的大小，点代表估计效应的中心值，线表示95%置信区间。</p> 
<p>左侧的数字很可能是SNPs的标识符，可能是它们在基因组上的位置编号。</p> 
<p>这种分析方法可以帮助研究人员识别任何可能异常影响整体分析结果的单个遗传变异。如果去除某个SNP后估计效应发生了显著变化，那么这个SNP可能是一个强烈的异常值或具有强烈的影响力。如果移除任何单一SNP后结果保持稳定，这表明MR分析的结果是稳健的，不会因单个SNP的异常而受到过度影响。</p> 
<p>在图的底部，“All”项通常表示所有SNPs包含在内的总体效应大小估计。如果这个总体估计的置信区间不包括零点，这通常表明有一个统计上显著的效应。这张图显示的大多数点的置信区间都不包括零点，表明即使单独去除任何一个SNP，MR分析的结果也表明暴露可能对结果有显著影响。<img src="https://images2.imgbox.com/fd/f2/KFXQGfBL_o.png" alt=""><br> 你提供的图是孟德尔随机化（<strong>MR</strong>）分析中常用的散点图，它用于展示遗传工具的效力（即<strong>遗传变异对暴露因素的影响大小</strong>）与它们对结果估计的因果效应大小之间的关系。</p> 
<p>图中的横轴表示遗传变异对暴露因素的影响估计值，也就是效应大小。纵轴代表标准误差的倒数，用来表示每个估计的精确度；纵轴上方位置较高的点表明标准误差较小，估计的精确度更高。</p> 
<p>在这种图中，我们通常会寻找是否存在漏斗形状，这样的形状意味着标准误差较大的估计（通常是效应大小较小的遗传变异）会更分散，而标准误差较小的估计则更集中。这有助于评估各个遗传变异作为工具变量时的稳健性和可信度。</p> 
<p>图中还标注了不同的MR方法，例如逆方差加权（<strong>Inverse variance weighted</strong>）、最大似然（<strong>Maximum likelihood</strong>）和加权中位数（<strong>Weighted median</strong>）等，这些都是合成所有遗传变异影响的不同统计方法。</p> 
<p>总体来说，这张图是在利用遗传信息探究特定暴露因素（如生活习惯、环境因素等）与健康结果（如某种疾病的风险）之间是否存在因果关系的工具。通过这种方法，研究人员可以在一定程度上避免传统观察性研究中常见的混淆因素，更可靠地揭示潜在的因果效应。</p> 
<hr> 
<p>上述图注为GPT生成，实属无奈，纯代码分享但字数不够被定义为低质量文章，大家见谅</p> 
<p>最后，示例数据仅供参考，笔者发现这个分析结果并不如意，权作教程示例数据使用，无实际意义！</p> 
<p>有需要的小伙伴可以直接替换数据学起来吧～</p> 
<blockquote> 
 <p>下方后台回复<strong>MR1</strong>领取示例文件与代码</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b50618c9da23924d15916a91c0eacf84/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端npm和yarn更换国内淘宝镜像</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12ec9de5afd668686be8d49a52bdeebf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">盘点Python中4种读取JSON文件和提取JSON文件内容的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>