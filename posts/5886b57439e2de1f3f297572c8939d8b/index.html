<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LearnOpenGL——几何着色器、实例化 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5886b57439e2de1f3f297572c8939d8b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="LearnOpenGL——几何着色器、实例化">
  <meta property="og:description" content="LearnOpenGL——几何着色器、实例化 几何着色器一、一个例子二、建造几个房子三、爆破物体四、法向量可视化 实例化一、实例化数组二、小行星带 几何着色器 在顶点着色器和片元着色器之间还有一个可选的几何着色器，几何着色器输入的是一个图元（点或者三角形）的一组顶点，几何着色器可以在片元着色器之前对它们进行随意变化，可以变换为不同的图元，也可以生成更多的顶点
一、一个例子 这是一个几何着色器，它接受一个点图元作为输入，以这个点为中心，创建一条水平的线图元。
#version 330 core layout (points) in; layout (line_strip, max_vertices = 2) out; void main() { gl_Position = gl_in[0].gl_Position &#43; vec4(-0.1, 0.0, 0.0, 0.0); EmitVertex(); gl_Position = gl_in[0].gl_Position &#43; vec4( 0.1, 0.0, 0.0, 0.0); EmitVertex(); EndPrimitive(); } 我们需要声明从顶点着色器输入的图元类型——在in前面加一个布局修饰符（如下），如果我们要绘制三角形，就将修饰符修改为triangles，括号内的数字表示的是一个图元所包含的最小顶点数。
points：绘制GL_POINTS图元（1）lines：绘制GL_LINES或GL_LINE_STRIP（2）line_adjacency：GL_LINE_ADJACENCY或GL_LINE_STRIP_ADJACENCY（4）triangles：GL_TRIANGLES、GL_TRIANGLE_STRIP或GL_TRIANGLE_FAN（3）triangles_adjacency：GL_TRIANGLES_ADJACENCY或GL_TRIANGLE_STRIP_ADJACENCY（6） 还需要制定几何着色器的输出的图元类型——在out关键字前加布局修饰符，如果要绘制三角形，就将输出定义为triangle_strip，我们还需要设置最大顶点数
pointsline_striptriangle_strip 为了获得前一着色器的输出变量，GLSL提供了一个接口块内建变量
in gl_Vertex { vec4 gl_Position; float gl_PointSize; float gl_ClipDistance[]; } gl_in[]; 使用EmitVertex和EndPrimitive函数来生成新数据
EmitVertex：gl_Position向量会被添加到图元中EndPrimitive：发射出的顶点都会合成为指定的输出渲染图元 二、建造几个房子 我们要绘制许多三角形，就需要把几何着色器的输出设置为triangle_strip（三角形带）。一个三角形带至少需要3个顶点，并会生成N-2个三角形（N为顶点数）
画房子我们需要三个三角形
首先添加Shader.h头文件中构造函数的重载函数，加入几何着色器
再修改points数据，加入颜色数据
float points[] = { -0.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T11:29:55+08:00">
    <meta property="article:modified_time" content="2024-08-15T11:29:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LearnOpenGL——几何着色器、实例化</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>LearnOpenGL——几何着色器、实例化</h4> 
 <ul><li><a href="#_1" rel="nofollow">几何着色器</a></li><li><ul><li><a href="#_3" rel="nofollow">一、一个例子</a></li><li><a href="#_45" rel="nofollow">二、建造几个房子</a></li><li><a href="#_123" rel="nofollow">三、爆破物体</a></li><li><a href="#_178" rel="nofollow">四、法向量可视化</a></li></ul> 
  </li><li><a href="#_256" rel="nofollow">实例化</a></li><li><ul><li><a href="#_329" rel="nofollow">一、实例化数组</a></li><li><a href="#_364" rel="nofollow">二、小行星带</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>几何着色器</h2> 
<p>在顶点着色器和片元着色器之间还有一个可选的几何着色器，几何着色器输入的是一个图元（点或者三角形）的一组顶点，几何着色器可以在片元着色器之前对它们进行随意变化，可以变换为不同的图元，也可以生成更多的顶点</p> 
<h3><a id="_3"></a>一、一个例子</h3> 
<p>这是一个几何着色器，它接受一个点图元作为输入，以这个点为中心，创建一条水平的线图元。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>points<span class="token punctuation">)</span> in<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>line_strip<span class="token punctuation">,</span> max_vertices <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>    
    gl_Position <span class="token operator">=</span> gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们需要声明从顶点着色器输入的图元类型——在in前面加一个布局修饰符（如下），如果我们要绘制三角形，就将修饰符修改为triangles，括号内的数字表示的是一个图元所包含的最小顶点数。</p> 
<ul><li>points：绘制GL_POINTS图元（1）</li><li>lines：绘制GL_LINES或GL_LINE_STRIP（2）</li><li>line_adjacency：GL_LINE_ADJACENCY或GL_LINE_STRIP_ADJACENCY（4）</li><li>triangles：GL_TRIANGLES、GL_TRIANGLE_STRIP或GL_TRIANGLE_FAN（3）</li><li>triangles_adjacency：GL_TRIANGLES_ADJACENCY或GL_TRIANGLE_STRIP_ADJACENCY（6）</li></ul> 
<p>还需要制定几何着色器的输出的图元类型——在out关键字前加布局修饰符，如果要绘制三角形，就将输出定义为triangle_strip，我们还需要设置最大顶点数</p> 
<ul><li>points</li><li>line_strip</li><li>triangle_strip</li></ul> 
<p>为了获得前一着色器的输出变量，GLSL提供了一个接口块内建变量</p> 
<pre><code class="prism language-cpp">in gl_Vertex
<span class="token punctuation">{<!-- --></span>
    vec4  gl_Position<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gl_PointSize<span class="token punctuation">;</span>
    <span class="token keyword">float</span> gl_ClipDistance<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> gl_in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>使用EmitVertex和EndPrimitive函数来生成新数据</p> 
<ul><li>EmitVertex：gl_Position向量会被添加到图元中</li><li>EndPrimitive：发射出的顶点都会合成为指定的输出渲染图元</li></ul> 
<h3><a id="_45"></a>二、建造几个房子</h3> 
<p>我们要绘制许多三角形，就需要把几何着色器的输出设置为triangle_strip（三角形带）。一个三角形带至少需要3个顶点，并会生成N-2个三角形（N为顶点数）</p> 
<p>画房子我们需要三个三角形<br> <img src="https://images2.imgbox.com/5c/44/jfK8u8Df_o.png" alt="在这里插入图片描述"><br> 首先添加Shader.h头文件中构造函数的重载函数，加入几何着色器<br> 再修改points数据，加入颜色数据</p> 
<pre><code class="prism language-cpp"><span class="token keyword">float</span> points<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token comment">// 左上</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span>  <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token comment">// 右上</span>
     <span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token comment">// 右下</span>
    <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> <span class="token number">0.0f</span>  <span class="token comment">// 左下</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>再修改顶点着色器，声明一个输出变量color</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aColor<span class="token punctuation">;</span>

out VS_OUT <span class="token punctuation">{<!-- --></span>
    vec3 color<span class="token punctuation">;</span>
<span class="token punctuation">}</span> vs_out<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">.</span>x<span class="token punctuation">,</span> aPos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    vs_out<span class="token punctuation">.</span>color <span class="token operator">=</span> aColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在几何着色器中声明输入gs_in[]输出fColor，并创建建房子函数</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span> in<span class="token punctuation">;</span>
<span class="token function">layout</span><span class="token punctuation">(</span>triangle_strip <span class="token punctuation">,</span>max_vertices <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

in VS_OUT <span class="token punctuation">{<!-- --></span>
    vec3 color<span class="token punctuation">;</span>
<span class="token punctuation">}</span> gs_in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
out vec3 fColor<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">bulid_house</span><span class="token punctuation">(</span>vec4 position<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    fColor <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span> <span class="token comment">// gs_in[0] 因为只有一个输入顶点</span>
    gl_Position <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 1:左下</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    gl_Position <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2:右下</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span>  <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3:左上</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span> <span class="token number">0.2</span><span class="token punctuation">,</span>  <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 4:右上</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span> <span class="token number">0.0</span><span class="token punctuation">,</span>  <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 5:顶部</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">bulid_house</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在片元着色器中声明输入变量fColor</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec3 fColor<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>fColor<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e7/ec/s7KIcEUy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_123"></a>三、爆破物体</h3> 
<p>此处的爆破不是要把物体炸了，而是让每个三角形沿着法向量的方向移动一小段时间。我们想要沿着三角形的法向量位移每个顶点，我们首先需要计算这个法向量。我们所要做的是计算垂直于三角形表面的向量。我们获得两个平行于三角形的表面向量a和b时，就可以通过叉乘来获得法向量方向</p> 
<pre><code class="prism language-cpp">vec3 <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
   vec3 a <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
   vec3 b <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">vec3</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>知道法向量后，就可以进行爆炸</p> 
<pre><code class="prism language-cpp">vec4 <span class="token function">explode</span><span class="token punctuation">(</span>vec4 position<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> magnitude <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>
    vec3 direction <span class="token operator">=</span> normal <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> magnitude<span class="token punctuation">;</span> 
    <span class="token keyword">return</span> position <span class="token operator">+</span> <span class="token function">vec4</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>几何着色器看起来像这样</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>triangles<span class="token punctuation">)</span> in<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>triangle_strip<span class="token punctuation">,</span> max_vertices <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

in VS_OUT <span class="token punctuation">{<!-- --></span>
    vec2 texCoords<span class="token punctuation">;</span>
<span class="token punctuation">}</span> gs_in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span> 

uniform <span class="token keyword">float</span> time<span class="token punctuation">;</span>

vec4 <span class="token function">explode</span><span class="token punctuation">(</span>vec4 position<span class="token punctuation">,</span> vec3 normal<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

vec3 <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>    
    vec3 normal <span class="token operator">=</span> <span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TexCoords <span class="token operator">=</span> gs_in<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>texCoords<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_178"></a>四、法向量可视化</h3> 
<p>我们将使用几何着色器来实现一个真正有用的例子：显示任意物体的法向量。当编写光照着色器时，你可能会最终会得到一些奇怪的视觉输出，但又很难确定导致问题的原因。很常见的原因就是法向量错误。</p> 
<p>思路是我们先不使用几何着色器来绘制场景，之后再次绘制场景，但这次只显示通过几何着色器生成法向量。几何着色器接收一个三角形图元，并沿着法向量生成三条线——每个顶点一个法向量</p> 
<p>顶点着色器</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aNormal<span class="token punctuation">;</span>

out VS_OUT <span class="token punctuation">{<!-- --></span>
    vec3 normal<span class="token punctuation">;</span>
<span class="token punctuation">}</span> vs_out<span class="token punctuation">;</span>

uniform mat4 view<span class="token punctuation">;</span>
uniform mat4 model<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> view <span class="token operator">*</span> model <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    mat3 normalMatrix <span class="token operator">=</span> <span class="token function">mat3</span><span class="token punctuation">(</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token function">inverse</span><span class="token punctuation">(</span>view <span class="token operator">*</span> model<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vs_out<span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token function">vec4</span><span class="token punctuation">(</span>normalMatrix <span class="token operator">*</span> aNormal<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>为什么不×projection矩阵 
  <ul><li>投影矩阵用于将观察空间中的点映射到裁剪空间，它涉及到透视除法，这会改变向量的方向和长度。<strong>由于法线是方向向量，它们不应该被透视变换影响</strong>，因此我们通常不将它们与投影矩阵相乘</li></ul> </li><li><code>mat3(transpose(inverse(view * model)))</code> 的意义 
  <ul><li>normalMatrix 用于将法线从模型空间变换到观察空间。这是因为法线需要与顶点位置保持一致的空间变换，但法线的变换与位置向量的变换不同。</li><li>逆矩阵：为了适配观察和模型矩阵的缩放和旋转（由于法线不需要平移）</li><li>转置矩阵：对于非正交变换（即包含非统一缩放或非纯旋转的变换），仅仅使用逆矩阵是不够的。在这种情况下，我们需要使用逆矩阵的转置来<strong>确保法线向量经过变换后仍然是单位长度，并且方向正确</strong>。这是因为非正交变换会扭曲空间，使得法线不再垂直于表面。</li></ul> </li></ul> 
<p>几何着色器，会接收每一个顶点（包括一个位置向量和一个法向量），并在每个位置向量处绘制一个法线向量</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>triangles<span class="token punctuation">)</span> in<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>line_strip<span class="token punctuation">,</span> max_vertices <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span> out<span class="token punctuation">;</span>

in VS_OUT <span class="token punctuation">{<!-- --></span>
    vec3 normal<span class="token punctuation">;</span>
<span class="token punctuation">}</span> gs_in<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">float</span> MAGNITUDE <span class="token operator">=</span> <span class="token number">0.4</span><span class="token punctuation">;</span>

uniform mat4 projection<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">GenerateLine</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> gl_in<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position<span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> <span class="token punctuation">(</span>gl_in<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>gl_Position <span class="token operator">+</span> 
                                <span class="token function">vec4</span><span class="token punctuation">(</span>gs_in<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>normal<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> MAGNITUDE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EmitVertex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EndPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">GenerateLine</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一个顶点法线</span>
    <span class="token function">GenerateLine</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二个顶点法线</span>
    <span class="token function">GenerateLine</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第三个顶点法线</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>magnitude：用来限制显示出的法向量大小</li></ul> 
<p>片元着色器</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_256"></a>实例化</h2> 
<p>面对数量巨大但是相同的物体要绘制时，使用glDrawArrays和glDrawElements的性能消耗就会很大，因为OpenGL在绘制之前需要准备很多工作，比如告诉GPU从哪个缓冲读取数据，从哪找顶点属性等等（大量DrawCall）</p> 
<p>实例化渲染就是一次性将数据都发给GPU，使用一个绘制函数让OpenGL利用这些数据来绘制。我们只需要将glDrawArrays和glDrawElements的渲染调用分别改为 <strong>glDrawArraysInstanced</strong> 和 <strong>glDrawElementsInstanced</strong> 就可以了。GLSL在顶点着色器中嵌入了另一个内建变量，<strong>gl_InstanceID</strong>，以此来对不同的物体设置一些别的效果（位置不同等）<br> <img src="https://images2.imgbox.com/82/21/Za19VZe5_o.png" alt="在这里插入图片描述"></p> 
<p>片元着色器会从顶点着色器接受颜色向量，并将其设置为它的颜色输出，来实现四边形颜色</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec3 fColor<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>fColor<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>顶点着色器会设置一个uniform变量offsets数组，它包含100个偏移向量来设置矩形的位置，我们会使用gl_InstanceID来索引offsets数组</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aColor<span class="token punctuation">;</span>

out vec3 fColor<span class="token punctuation">;</span>

uniform vec2 offsets<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    vec2 offset <span class="token operator">=</span> offsets<span class="token punctuation">[</span>gl_InstanceID<span class="token punctuation">]</span><span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fColor <span class="token operator">=</span> aColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在主代码中，我们首先创建绑定VAO、VBO，然后创建了一个偏移数组translations</p> 
<pre><code class="prism language-cpp">glm<span class="token double-colon punctuation">::</span>vec2 translations<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> offset <span class="token operator">=</span> <span class="token number">0.1f</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> y <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        glm<span class="token double-colon punctuation">::</span>vec2 translation<span class="token punctuation">;</span>
        translation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>x <span class="token operator">/</span> <span class="token number">10.0f</span> <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        translation<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>y <span class="token operator">/</span> <span class="token number">10.0f</span> <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        translations<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> translation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在渲染循环中，我们要把这个数组赋值给shader（一个数据一个数据的传）</p> 
<pre><code class="prism language-cpp">shader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    stringstream ss<span class="token punctuation">;</span>
    string index<span class="token punctuation">;</span>
    ss <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">;</span> 
    index <span class="token operator">=</span> ss<span class="token punctuation">.</span><span class="token function">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    shader<span class="token punctuation">.</span><span class="token function">setVec2</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"offsets["</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> translations<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后调用glDrawArraysInstanced来绘制三角形</p> 
<pre><code class="prism language-cpp"><span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>quadVAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glDrawArraysInstanced</span><span class="token punctuation">(</span>GL_TRIANGLES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_329"></a>一、实例化数组</h3> 
<p>但是我们在实际中，总会超过100个实例。另一个代替方案就是实例化数组。<br> 实例化数组被定义为一个顶点属性，当我们将顶点属性定义为一个实例化数组时，<strong>顶点着色器就只需要对每个实例，而不是每个顶点，更新顶点属性的内容了</strong>。</p> 
<p>我们将顶点着色器修改如下</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec2 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> in vec3 aColor<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aOffset<span class="token punctuation">;</span>

out vec3 fColor<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos <span class="token operator">+</span> aOffset<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fColor <span class="token operator">=</span> aColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在主代码中，我们为translations数组中的偏移量创建一个VBO，绑定好数据后还需要设置它的顶点属性指针。glVertexAttribDivisor函数用来指定什么时候更新指定的数据，第一个参数是顶点属性，第二个参数指什么时候更新数据： glVertexAttribDivisor(2, 1); 表示layout = 2的数据，在渲染一个新实例的时候更新顶点属性</p> 
<pre><code class="prism language-cpp">    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> instanceVBO<span class="token punctuation">;</span>
    <span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>vec2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>translations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> instanceVBO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样就可以直接画而不需要传uniform了</p> 
<h3><a id="_364"></a>二、小行星带</h3> 
<p>在岩石的顶点着色器中，设置了model的实例化数组。因为一个mat4本质上是4个vec4，我们需要为这个矩阵预留4个顶点属性。因为我们将它的位置值设置为3，矩阵每一列的顶点属性位置值就是3、4、5和6。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> in vec3 aPos<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> in vec2 aTexCoords<span class="token punctuation">;</span>
<span class="token function">layout</span> <span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> in mat4 aInstanceMatrix<span class="token punctuation">;</span>

out vec2 TexCoords<span class="token punctuation">;</span>

uniform mat4 projection<span class="token punctuation">;</span>
uniform mat4 view<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    TexCoords <span class="token operator">=</span> aTexCoords<span class="token punctuation">;</span>
    gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> view <span class="token operator">*</span> aInstanceMatrix <span class="token operator">*</span> <span class="token function">vec4</span><span class="token punctuation">(</span>aPos<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>片元着色器是正常的加载纹理</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">330</span> core</span></span>
out vec4 FragColor<span class="token punctuation">;</span>

in vec2 TexCoords<span class="token punctuation">;</span>

uniform sampler2D texture_diffuse1<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    FragColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>texture_diffuse1<span class="token punctuation">,</span> TexCoords<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在主程序中，我们设置modelMatrices数组来为每个岩石设置不同的随机属性（位置、大小、旋转方向）。我们将岩石放在半径为150的环上</p> 
<ul><li>srand函数使用当前时间作为种子来初始化随机数生成器。这<strong>确保了每次运行程序时，生成的随机数序列都是不同的</strong></li><li>位移随机： 
  <ul><li>x：模型在X轴上的位置，由圆的半径和随机位移确定。</li><li>y：模型在Y轴上的位置，位移较小，以保持星域的高度比X和Z轴的宽度小。</li><li>z：模型在Z轴上的位置，同样由圆的半径和随机位移确定。<br> glm::translate函数将模型位移到计算出的位置。</li></ul> </li><li>缩放随机：生成一个介于0.05和0.25之间的随机缩放因子，并使用glm::scale函数对模型进行缩放。</li><li>旋转随机：生成一个0到360之间的随机旋转角度，并选择一个固定的旋转轴（这里是(0.4, 0.6, 0.8)）。glm::rotate函数根据这个角度和轴旋转模型。</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">int</span> amount <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
    glm<span class="token double-colon punctuation">::</span>mat4<span class="token operator">*</span> modelMatrices<span class="token punctuation">;</span>
    modelMatrices <span class="token operator">=</span> <span class="token keyword">new</span> glm<span class="token double-colon punctuation">::</span>mat4<span class="token punctuation">[</span>amount<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">glfwGetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// initialize random seed</span>
    <span class="token keyword">float</span> radius <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> offset <span class="token operator">=</span> <span class="token number">25.0f</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> amount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        glm<span class="token double-colon punctuation">::</span>mat4 model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">mat4</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1. translation: displace along circle with 'radius' in range [-offset, offset]</span>
        <span class="token keyword">float</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>i <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>amount <span class="token operator">*</span> <span class="token number">360.0f</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> displacement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> offset <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0f</span> <span class="token operator">-</span> offset<span class="token punctuation">;</span>
        <span class="token keyword">float</span> x <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius <span class="token operator">+</span> displacement<span class="token punctuation">;</span>
        displacement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> offset <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0f</span> <span class="token operator">-</span> offset<span class="token punctuation">;</span>
        <span class="token keyword">float</span> y <span class="token operator">=</span> displacement <span class="token operator">*</span> <span class="token number">0.4f</span><span class="token punctuation">;</span> <span class="token comment">// keep height of asteroid field smaller compared to width of x and z</span>
        displacement <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> offset <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0f</span> <span class="token operator">-</span> offset<span class="token punctuation">;</span>
        <span class="token keyword">float</span> z <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius <span class="token operator">+</span> displacement<span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">translate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2. scale: Scale between 0.05 and 0.25f</span>
        <span class="token keyword">float</span> scale <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">100.0</span> <span class="token operator">+</span> <span class="token number">0.05</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">scale</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3. rotation: add random rotation around a (semi)randomly picked rotation axis vector</span>
        <span class="token keyword">float</span> rotAngle <span class="token operator">=</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model <span class="token operator">=</span> glm<span class="token double-colon punctuation">::</span><span class="token function">rotate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> rotAngle<span class="token punctuation">,</span> glm<span class="token double-colon punctuation">::</span><span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.4f</span><span class="token punctuation">,</span> <span class="token number">0.6f</span><span class="token punctuation">,</span> <span class="token number">0.8f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4. now add to list of matrices</span>
        modelMatrices<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> model<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>我们需要为mat4四个顶点属性设置属性指针，并设置为实例化数组</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 顶点缓冲对象</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> buffer<span class="token punctuation">;</span>
<span class="token function">glGenBuffers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBindBuffer</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">glBufferData</span><span class="token punctuation">(</span>GL_ARRAY_BUFFER<span class="token punctuation">,</span> amount <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span>mat4<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>modelMatrices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> GL_STATIC_DRAW<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rock<span class="token punctuation">.</span>meshes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> VAO <span class="token operator">=</span> rock<span class="token punctuation">.</span>meshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VAO<span class="token punctuation">;</span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 顶点属性</span>
    GLsizei vec4Size <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>glm<span class="token double-colon punctuation">::</span>vec4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glEnableVertexAttribArray</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">glVertexAttribPointer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> GL_FLOAT<span class="token punctuation">,</span> GL_FALSE<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> vec4Size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glVertexAttribDivisor</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre> 
<p>然后使用网格的VAO，这一次使用glDrawElementsInstanced进行绘制：</p> 
<pre><code class="prism language-cpp">rockShader<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rock<span class="token punctuation">.</span>meshes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">glBindVertexArray</span><span class="token punctuation">(</span>rock<span class="token punctuation">.</span>meshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>VAO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">glDrawElementsInstanced</span><span class="token punctuation">(</span>
        GL_TRIANGLES<span class="token punctuation">,</span> rock<span class="token punctuation">.</span>meshes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>indices<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GL_UNSIGNED_INT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> amount
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/6c/aGsJ4jP2_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3256ee7729d2d18a08cf3449a6fb6c0b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;第三十六弹---二叉搜索树的性能飞跃：AVL树原理与实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f312e3de594c018c823db609d4354312/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Java】如何使用jdbc连接并操作MySQL，一文读懂不迷路，小白也能轻松学会</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>