<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于银联支付交易状态码的一些分析 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ef5444a8a77fdba3efefaec2b8df75ac/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="关于银联支付交易状态码的一些分析">
  <meta property="og:description" content="目录
关于银联支付
一些准备
交易状态码的一些分析
小结
关于银联支付 目前B2C购物支付场景下，支付宝和微信的在线支付已经成为我们经常遇到的支付方式。另外，银联支付也是我们日常的一种支付方式，本文所指的银联支付即指中国银联网关支付产品，主要适用于持卡人在商户网站B2C购物支付场景，持卡人通过点击银联在线支付图标（可选择支付类型），并在银联在线支付网关完成支付信息录入，最终完成支付。银联在线支付支持输入卡号付款、用户登录支付、网银支付、迷你付（IC卡支付）等多种付款方式，用户通过统一入口，访问支付首页，按照提示和所列功能即可完成支付。
一些准备 做为软件开发商，实现银联在线支付，需要协助（但不必要）目标商户签署支付协议，开通商户平台。以2007版支付为例，开通过商户平台需要提交许多资料，包括企业及个人信息（如管理员用户名、名称、手机号等）备案。本文将不重点介绍如何实现在线支付，仅就支付反馈中遇到的一些问题进行分析。
在分析前，我们简单讲述一下要 POST 的一些参数和数据，参见下表：
序号字段名类型说明1MerId数字串必填，为银联统一分配给商户的商户号，15位长度2OrdId数字串必填，商户提交给银联的交易订单号，16位长度，请注意生成的订单号当天支付如果不成功，则再次使用相同的订单号提交后会提示重复交易，但次日该订单号仍可以做为交易失败后的“新”订单号继续在线支付。从另一个角度来说，使用固定订单号有助于商户端更新支付状态失败造成用户的重复交易。3TransAmt数字串必填，订单交易金额，12位长度，左补0，单位为分。如 000000007890，表示七十八元九角零分，即 78.90 元。4CuryId数字串必填，订单交易币种，3位长度，固定为人民币1565TransDate数字串必填，订单交易日期，8位长度6TransType数字串必填，交易类型，4位长度，0001 表示消费，0002 表示退款7Version数字串必填，支付接入版本号，如 200701298BgRetUrl数字串必填，后台交易接收的回调 URL，URL地址的长度不超过80个字节9PageRetUrl数字串必填，前台交易页面接收的回调 URL（显示给用户方的页面，交易情况显示详情页面），URL地址的长度不超过80个字节10GateId数字串非必填，支付网关号11Priv1数字串非必填，商户私有域，长度不超过60个字节，属于商户的备注内容12ChkValue数字串必填，256字节长的ASCII码，是本次交易的关键数字签名 以下是示例代码，提供了一个服务器 Form 和一些隐藏字段域 准备提交时使用
&lt;form id=&#34;payform&#34; runat=&#34;server&#34;&gt; &lt;input type=&#34;hidden&#34; name=&#34;MerId&#34; value=&#34;&#34; id=&#34;MerId&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;OrdId&#34; value=&#34;&#34; id=&#34;OrdId&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;TransAmt&#34; value=&#34;&#34; id=&#34;TransAmt&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;CuryId&#34; value=&#34;156&#34; id=&#34;CuryId&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;TransDate&#34; value=&#34;&#34; id=&#34;TransDate&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;TransType&#34; value=&#34;0001&#34; id=&#34;TransType&#34; runat=&#34;server&#34;/&gt; &lt;input type=&#34;hidden&#34; name=&#34;Version&#34; value=&#34;&#34; id=&#34;Version&#34; runat=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T12:28:23+08:00">
    <meta property="article:modified_time" content="2024-07-23T12:28:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于银联支付交易状态码的一些分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>  </strong></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%BC%95%E5%AD%90-toc" style="margin-left:40px;"><a href="#%E5%BC%95%E5%AD%90" rel="nofollow">关于银联支付</a></p> 
<p id="%E5%89%8D%E6%9C%9F%E8%B5%84%E6%96%99%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#%E5%89%8D%E6%9C%9F%E8%B5%84%E6%96%99%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%87%86%E5%A4%87" rel="nofollow">一些准备</a></p> 
<p id="%E4%BA%A4%E6%98%93%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90-toc" style="margin-left:40px;"><a href="#%E4%BA%A4%E6%98%93%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90" rel="nofollow">交易状态码的一些分析</a></p> 
<p id="%E6%9C%8D%E5%8A%A1%E5%8F%B7%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9-toc" style="margin-left:40px;"><a href="#%E5%B0%8F%E7%BB%93" rel="nofollow">小结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E5%BC%95%E5%AD%90">关于银联支付</h3> 
<p>目前B2C购物支付场景下，支付宝和微信的在线支付已经成为我们经常遇到的支付方式。另外，银联支付也是我们日常的一种支付方式，本文所指的银联支付即指中国银联网关支付产品，主要适用于持卡人在商户网站B2C购物支付场景，持卡人通过点击银联在线支付图标（可选择支付类型），并在银联在线支付网关完成支付信息录入，最终完成支付。银联在线支付支持输入卡号付款、用户登录支付、网银支付、迷你付（IC卡支付）等多种付款方式，用户通过统一入口，访问支付首页，按照提示和所列功能即可完成支付。</p> 
<p></p> 
<h3 id="%E5%89%8D%E6%9C%9F%E8%B5%84%E6%96%99%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%87%86%E5%A4%87">一些准备</h3> 
<p>做为软件开发商，实现银联在线支付，需要协助（但不必要）目标商户签署支付协议，开通商户平台。以2007版支付为例，开通过商户平台需要提交许多资料，包括企业及个人信息（如管理员用户名、名称、手机号等）备案。本文将不重点介绍如何实现在线支付，仅就支付反馈中遇到的一些问题进行分析。</p> 
<p>在分析前，我们简单讲述一下要 POST 的一些参数和数据，参见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><thead><tr><th style="text-align:center;width:49px;">序号</th><th style="text-align:center;width:88px;">字段名</th><th style="text-align:center;width:67px;">类型</th><th style="text-align:center;width:499px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;width:49px;">1</th><td style="width:88px;">MerId</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，为银联统一分配给商户的商户号，15位长度</td></tr><tr><th style="text-align:center;width:49px;">2</th><td style="width:88px;">OrdId</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，商户提交给银联的交易订单号，16位长度，请注意生成的订单号当天支付如果不成功，则再次使用相同的订单号提交后会提示重复交易，但次日该订单号仍可以做为交易失败后的“新”订单号继续在线支付。从另一个角度来说，使用固定订单号有助于商户端更新支付状态失败造成用户的重复交易。</td></tr><tr><th style="text-align:center;width:49px;">3</th><td style="width:88px;">TransAmt</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，订单交易金额，12位长度，左补0，单位为分。如 000000007890，表示七十八元九角零分，即 78.90 元。</td></tr><tr><th style="text-align:center;width:49px;">4</th><td style="width:88px;">CuryId</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，订单交易币种，3位长度，固定为人民币156</td></tr><tr><th style="text-align:center;width:49px;">5</th><td style="width:88px;">TransDate</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，订单交易日期，8位长度</td></tr><tr><th style="text-align:center;width:49px;">6</th><td style="width:88px;">TransType</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，交易类型，4位长度，0001 表示消费，0002 表示退款</td></tr><tr><th style="text-align:center;width:49px;">7</th><td style="width:88px;">Version</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，支付接入版本号，如 20070129</td></tr><tr><th style="text-align:center;width:49px;">8</th><td style="width:88px;">BgRetUrl</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，后台交易接收的回调 URL，URL地址的长度不超过80个字节</td></tr><tr><th style="text-align:center;width:49px;">9</th><td style="width:88px;">PageRetUrl</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，前台交易页面接收的回调 URL（显示给用户方的页面，交易情况显示详情页面），URL地址的长度不超过80个字节</td></tr><tr><th style="text-align:center;width:49px;">10</th><td style="width:88px;">GateId</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>非必填</strong>，支付网关号</td></tr><tr><th style="text-align:center;width:49px;">11</th><td style="width:88px;">Priv1</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>非必填</strong>，商户私有域，长度不超过60个字节，属于商户的备注内容</td></tr><tr><th style="text-align:center;width:49px;">12</th><td style="width:88px;">ChkValue</td><td style="width:67px;">数字串</td><td style="width:499px;"><strong>必填</strong>，256字节长的ASCII码，是本次交易的关键数字签名</td></tr></tbody></table> 
<p> 以下是示例代码，提供了一个服务器 Form 和一些隐藏字段域 准备提交时使用</p> 
<pre><code class="language-html">&lt;form id="payform" runat="server"&gt;

&lt;input type="hidden" name="MerId" value="" id="MerId" runat="server"/&gt;
&lt;input type="hidden" name="OrdId" value="" id="OrdId" runat="server"/&gt;
&lt;input type="hidden" name="TransAmt" value="" id="TransAmt" runat="server"/&gt;
&lt;input type="hidden" name="CuryId" value="156" id="CuryId" runat="server"/&gt; 
&lt;input type="hidden" name="TransDate" value="" id="TransDate" runat="server"/&gt;
&lt;input type="hidden" name="TransType" value="0001" id="TransType" runat="server"/&gt; 
&lt;input type="hidden" name="Version" value="" id="Version" runat="server"/&gt; 
&lt;input type="hidden" name="BgRetUrl" value="https://x.x.com/BR.aspx" id="BgRetUrl" runat="server"/&gt;
&lt;input type="hidden" name="PageRetUrl" value="https://x.x.com/PR.aspx" id="PageRetUrl" runat="server"/&gt;
&lt;input type="hidden" name="GateId" value="" id="GateId" runat="server"/&gt;
&lt;input type="hidden" name="Priv1" value="" id="Priv1" runat="server"/&gt;
&lt;input type="hidden" name="ChkValue" value="" id="ChkValue" runat="server"/&gt;

&lt;/form&gt;</code></pre> 
<p>假设我们可以动态的设置 Form 的 Action （如测试环境或生产环境），示例代码如下：</p> 
<pre><code class="language-cs">protected void b_insbtn_Click(object sender, EventArgs e)
{
    if (ViewState["RunType"].ToString() == "1")
    {
        payform.Action = "https://payment.chinapay.com/pay/TransGet";  //生产环境
        payform.Method = "post";
    }
    else if (ViewState["RunType"].ToString() == "0")
    {
        payform.Action = "http://payment-test.chinapay.com/pay/TransGet"; //测试环境
        payform.Method = "post";
    }

    //后续参数配置代码....
}</code></pre> 
<p>​代码中 <a href="https://payment.chinapay.com/pay/TransGet" rel="nofollow" title="https://payment.chinapay.com/pay/TransGet">https://payment.chinapay.com/pay/TransGet</a> ，即为正式提交在线支付的入口页。</p> 
<h3 id="%E4%BA%A4%E6%98%93%E7%8A%B6%E6%80%81%E7%A0%81%E7%9A%84%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90">交易状态码的一些分析</h3> 
<p>当引导用户到银联支付页面，并完成支付操作后（包括未成功的交易），通过 PageRetUrl 和 BgRetUrl  回调地址我们会获取银联的交易状态码，状态码为4位数字，交易状态码为非 “1001” 的即为失败交易，我们要根据实际的返回保存到数据库并给予对应的提示。</p> 
<p>详细的交易状态码见下表：</p> 
<p>​</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:130px;">交易状态码</th><th style="text-align:center;width:198px;">说明</th><th style="text-align:center;width:118px;">交易状态码</th><th style="text-align:center;width:203px;">说明</th></tr></thead><tbody><tr><td style="text-align:center;width:130px;">1001</td><td style="width:198px;">消费交易成功</td><td style="text-align:center;width:118px;">2063</td><td style="width:203px;">违反安全保密规定</td></tr><tr><td style="text-align:center;width:130px;">1003</td><td style="width:198px;">退款交易成功</td><td style="text-align:center;width:118px;">2064</td><td style="width:203px;">原始金额不正确</td></tr><tr><td style="text-align:center;width:130px;">1005</td><td style="width:198px;">退款撤销成功</td><td style="text-align:center;width:118px;">2065</td><td style="width:203px;">超出取款次数限制</td></tr><tr><td style="text-align:center;width:130px;">1111</td><td style="width:198px;">未支付</td><td style="text-align:center;width:118px;">2066</td><td style="width:203px;">受卡方呼受理方安全保密部门</td></tr><tr><td style="text-align:center;width:130px;">2000</td><td style="width:198px;">银行无应答</td><td style="text-align:center;width:118px;">2067</td><td style="width:203px;">捕捉</td></tr><tr><td style="text-align:center;width:130px;">2001</td><td style="width:198px;">查发卡放</td><td style="text-align:center;width:118px;">2068</td><td style="width:203px;">收到的回答太迟</td></tr><tr><td style="text-align:center;width:130px;">2002</td><td style="width:198px;">查发卡放特殊条件</td><td style="text-align:center;width:118px;">2075</td><td style="width:203px;">允许输入PIN的次数超限</td></tr><tr><td style="text-align:center;width:130px;">2003</td><td style="width:198px;">无效商户</td><td style="text-align:center;width:118px;">2090</td><td style="width:203px;">日期切换正在处理</td></tr><tr><td style="text-align:center;width:130px;">2004</td><td style="width:198px;">没收卡</td><td style="text-align:center;width:118px;">2091</td><td style="width:203px;">发卡方与交换中心不能操作</td></tr><tr><td style="text-align:center;width:130px;">2005</td><td style="width:198px;">不予承兑</td><td style="text-align:center;width:118px;">2092</td><td style="width:203px;">金融机构或中间网络设施找不到或无法到达</td></tr><tr><td style="text-align:center;width:130px;">2006</td><td style="width:198px;">出错</td><td style="text-align:center;width:118px;">2093</td><td style="width:203px;">交易违法、不能完成</td></tr><tr><td style="text-align:center;width:130px;">2007</td><td style="width:198px;">特殊条件下没收卡</td><td style="text-align:center;width:118px;">2094</td><td style="width:203px;">重复交易</td></tr><tr><td style="text-align:center;width:130px;">2009</td><td style="width:198px;">请求正在处理中</td><td style="text-align:center;width:118px;">2095</td><td style="width:203px;">调节控制错</td></tr><tr><td style="text-align:center;width:130px;">2010</td><td style="width:198px;">卡bin未参与CPUSecure服务</td><td style="text-align:center;width:118px;">2096</td><td style="width:203px;">系统异常、失效</td></tr><tr><td style="text-align:center;width:130px;">2012</td><td style="width:198px;">无效交易</td><td style="text-align:center;width:118px;">2097</td><td style="width:203px;">ATM\POS终端找不到</td></tr><tr><td style="text-align:center;width:130px;">2013</td><td style="width:198px;">无效金额</td><td style="text-align:center;width:118px;">2098</td><td style="width:203px;">交换中心收不到收卡方应答</td></tr><tr><td style="text-align:center;width:130px;">2014</td><td style="width:198px;">无效卡号</td><td style="text-align:center;width:118px;">2099</td><td style="width:203px;">PIN格式错误</td></tr><tr><td style="text-align:center;width:130px;">2015</td><td style="width:198px;">无此发卡方</td><td style="text-align:center;width:118px;">20A0</td><td style="width:203px;">MAC鉴别失败</td></tr><tr><td style="text-align:center;width:130px;">2019</td><td style="width:198px;">重新送入交易</td><td style="text-align:center;width:118px;">2101</td><td style="width:203px;">网关出错</td></tr><tr><td style="text-align:center;width:130px;">2020</td><td style="width:198px;">无效应答</td><td style="text-align:center;width:118px;">2102</td><td style="width:203px;">密码加密出错</td></tr><tr><td style="text-align:center;width:130px;">2021</td><td style="width:198px;">不作任何处理</td><td style="text-align:center;width:118px;">2111</td><td style="width:203px;">消息时间太新，请调整浏览器时间与实际时间一致</td></tr><tr><td style="text-align:center;width:130px;">2022</td><td style="width:198px;">怀疑操作有误</td><td style="text-align:center;width:118px;">2112</td><td style="width:203px;">消息时间太旧，请调整浏览器时间与实际时间一致</td></tr><tr><td style="text-align:center;width:130px;">2023</td><td style="width:198px;">不可接受的交易费</td><td style="text-align:center;width:118px;">2113</td><td style="width:203px;">信息不符</td></tr><tr><td style="text-align:center;width:130px;">2030</td><td style="width:198px;">格式错误</td><td style="text-align:center;width:118px;">2114</td><td style="width:203px;">商户号验证出错</td></tr><tr><td style="text-align:center;width:130px;">2031</td><td style="width:198px;">交换中心不支持的银行</td><td style="text-align:center;width:118px;">2115</td><td style="width:203px;">商户信息格式出错</td></tr><tr><td style="text-align:center;width:130px;">2033</td><td style="width:198px;">过期的卡</td><td style="text-align:center;width:118px;">2116</td><td style="width:203px;">撤销交易信息出错</td></tr><tr><td style="text-align:center;width:130px;">2034</td><td style="width:198px;">有作弊嫌疑</td><td style="text-align:center;width:118px;">2117</td><td style="width:203px;">查新个数为零</td></tr><tr><td style="text-align:center;width:130px;">2035</td><td style="width:198px;">受卡方与安全保密部门联系</td><td style="text-align:center;width:118px;">2118</td><td style="width:203px;">查询个数大于100</td></tr><tr><td style="text-align:center;width:130px;">2036</td><td style="width:198px;">受限制的卡</td><td style="text-align:center;width:118px;">2141</td><td style="width:203px;">系统出错</td></tr><tr><td style="text-align:center;width:130px;">2037</td><td style="width:198px;">受卡方呼受理方安全部门</td><td style="text-align:center;width:118px;">2142</td><td style="width:203px;">撤销交易出错</td></tr><tr><td style="text-align:center;width:130px;">2038</td><td style="width:198px;">超过允许的PIN试输入</td><td style="text-align:center;width:118px;">2143</td><td style="width:203px;">撤销交易已处理</td></tr><tr><td style="text-align:center;width:130px;">2039</td><td style="width:198px;">无此信用卡账户</td><td style="text-align:center;width:118px;">2144</td><td style="width:203px;">交易已被冲正</td></tr><tr><td style="text-align:center;width:130px;">2040</td><td style="width:198px;">请求的功能不支持</td><td style="text-align:center;width:118px;">2145</td><td style="width:203px;">撤销交易出错</td></tr><tr><td style="text-align:center;width:130px;">2041</td><td style="width:198px;">挂失卡</td><td style="text-align:center;width:118px;">2146</td><td style="width:203px;">交换中心无应答</td></tr><tr><td style="text-align:center;width:130px;">2042</td><td style="width:198px;">无此账户</td><td style="text-align:center;width:118px;">2147</td><td style="width:203px;">网管未收到该交易</td></tr><tr><td style="text-align:center;width:130px;">2043</td><td style="width:198px;">被窃卡</td><td style="text-align:center;width:118px;">2148</td><td style="width:203px;">重复交易</td></tr><tr><td style="text-align:center;width:130px;">2044</td><td style="width:198px;">无此投资账户</td><td style="text-align:center;width:118px;">2150</td><td style="width:203px;">通讯线路故障</td></tr><tr><td style="text-align:center;width:130px;">2051</td><td style="width:198px;">无足够的存款</td><td style="text-align:center;width:118px;">2157</td><td style="width:203px;">不允许持卡人进行交易</td></tr><tr><td style="text-align:center;width:130px;">2052</td><td style="width:198px;">无此支票账户</td><td style="text-align:center;width:118px;">2158</td><td style="width:203px;">该银行卡网上支付功能因系统升级而暂停</td></tr><tr><td style="text-align:center;width:130px;">2053</td><td style="width:198px;">无此储蓄卡账户</td><td style="text-align:center;width:118px;">2199</td><td style="width:203px;">系统出错</td></tr><tr><td style="text-align:center;width:130px;">2054</td><td style="width:198px;">过期的卡</td><td style="text-align:center;width:118px;">2257</td><td style="width:203px;">基于风险控制阻止的交易</td></tr><tr><td style="text-align:center;width:130px;">2055</td><td style="width:198px;">不正确的PIN</td><td style="text-align:center;width:118px;">2997</td><td style="width:203px;">交易提交银行错误</td></tr><tr><td style="text-align:center;width:130px;">2056</td><td style="width:198px;">无此卡记录</td><td style="text-align:center;width:118px;">4001</td><td style="width:203px;">HSBC交易中止</td></tr><tr><td style="text-align:center;width:130px;">2057</td><td style="width:198px;">不允许持卡人进行的交易</td><td style="text-align:center;width:118px;">4055</td><td style="width:203px;">HSBC安全认证错误</td></tr><tr><td style="text-align:center;width:130px;">2058</td><td style="width:198px;">不允许此终端进行的交易</td><td style="text-align:center;width:118px;">4097</td><td style="width:203px;">HSBC交易无应答</td></tr><tr><td style="text-align:center;width:130px;">2059</td><td style="width:198px;">有作弊嫌疑</td><td style="text-align:center;width:118px;">5501</td><td style="width:203px;">工行网关无应答</td></tr><tr><td style="text-align:center;width:130px;">2060</td><td style="width:198px;">受卡方与安全保密部门联系</td><td style="text-align:center;width:118px;">5511</td><td style="width:203px;">工行网关处理失败</td></tr><tr><td style="text-align:center;width:130px;">2061</td><td style="width:198px;">超出取款金额限制</td><td style="text-align:center;width:118px;">5522</td><td style="width:203px;">工行网关未收到后台应答</td></tr><tr><td style="text-align:center;width:130px;">2062</td><td style="width:198px;">受限制的卡</td><td style="text-align:center;width:118px;"></td><td style="width:203px;"></td></tr></tbody></table> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:130px;">交易状态码</th><th style="text-align:center;width:198px;">说明</th><th style="text-align:center;width:118px;">交易状态码</th><th style="text-align:center;width:203px;">说明</th></tr></thead><tbody><tr><td style="text-align:center;width:131px;">8001</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9000</td><td style="width:204px;">电话支付订单已成功发给银行</td></tr><tr><td style="text-align:center;width:131px;">8002</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9001</td><td style="width:204px;">电话支付订单发送银行失败(订单电话域非法)</td></tr><tr><td style="text-align:center;width:131px;">8003</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9002</td><td style="width:204px;">电话支付订单发送银行失败（秘密数域非法）</td></tr><tr><td style="text-align:center;width:131px;">8004</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9003</td><td style="width:204px;">电话支付订单发送银行失败（商户扩展域非法）</td></tr><tr><td style="text-align:center;width:131px;">8005</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9004</td><td style="width:204px;">电话支付订单发送银行失败（CP保留域非法）</td></tr><tr><td style="text-align:center;width:131px;">8006</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9100</td><td style="width:204px;">电话支付订单撤销成功</td></tr><tr><td style="text-align:center;width:131px;">8007</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9101</td><td style="width:204px;">电话支付订单撤销失败（订单号不匹配）</td></tr><tr><td style="text-align:center;width:131px;">8008</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9102</td><td style="width:204px;">电话支付订单撤销失败（金额不匹配）</td></tr><tr><td style="text-align:center;width:131px;">8009</td><td style="width:197px;">HSBC交易失败</td><td style="text-align:center;width:117px;">9103</td><td style="width:204px;">电话支付订单撤销失败（交易日期不对）</td></tr></tbody></table> 
<p></p> 
<p>在银联支付20070129版本的实际应用中，回调获取的交易状态码基本正常，但出现了一些问题就是在回调获取成功交易状态码 “1001” 后，银联继续推送了一些状态码回调，因此在开发中需要进行判断 ，一味的接收并更新状态码，可能无法达到预期的效果，尤其当状态码已经为“1001”的情况下。在实际应用中，除正常状态码反馈，我们遇到了 “2006” 和 “2148” 错误。</p> 
<p>从 “2148” 错误可以理解，是用户的重复交易（包括当日和隔日重复交易），因此我们需要在更新数据库前对两次交易码进行比对，如果之前为 “1001” 的可以无视 “2148” 的存在。</p> 
<p>另外我们遇到的是 “2006” 错误，从代码表中仅查询出说明为 “出错” ，这个问题我们曾致电银联客服求解，未得到任何有效答案，包括可能出现的情况。关键是，状态码会在获得“1001” 后不定期的时间内（非正常回调周期）推送到回调地址，这就比较难以判断真实发生的情况。</p> 
<p>因此对于非“1001”的特殊情况，建立日志表跟踪非常关键，目前来看，对于“2006”的拦截很有必要，实际应用中错误更新的情况明显减少。 </p> 
<h3 id="%E6%9C%8D%E5%8A%A1%E5%8F%B7%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9"></h3> 
<h3 id="%E5%B0%8F%E7%BB%93">小结</h3> 
<p>更多的详情请参考如下链接（中国银联开放平台）：</p> 
<p><a class="link-info" href="https://open.unionpay.com/tjweb/index" rel="nofollow" title="https://open.unionpay.com/tjweb/index">https://open.unionpay.com/tjweb/index</a></p> 
<p>在实际与银联客服的沟通中，我们尽量使用官方提供的联系邮件进行沟通，这样效率可以高一些。也便于留档查询，而且如果修改资料（包括更换联系人、修改企业信息等）手续比较繁琐，不是太友好，需要一定的时间，因此在应用上线功能时需要做好准备工作。</p> 
<p>以上是本人的一些体会与实践，仅代表个人的一些观点，再次感谢您的阅读，欢迎讨论、指教！</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e003aa04ba700d8a477aa728456e055/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Redis常见面试题汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ffac3f39754261a4eb4e516719487beb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">防御课第2次作业</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>