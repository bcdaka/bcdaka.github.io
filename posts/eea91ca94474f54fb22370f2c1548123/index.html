<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>6-7 宠物领养开发及相关代码 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/eea91ca94474f54fb22370f2c1548123/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="6-7 宠物领养开发及相关代码">
  <meta property="og:description" content="6-7 宠物领养开发及相关代码（react&#43;区块链实战） 来到ant-design https://ant.design/index-cn https://ant.design/components/layout-cn/
来到布局
选择一个简单的布局即可
会显示出所有的相关界面的代码
根据对应界面的代码在我们的react项目woniu-pet-shop中的App.js中进行更改
如下
刷新页面的效果如下
页面的基本雏形如下
要做宠物的领养，就要将宠物的数组拿出来
在前面下载的petshop改名为truffle中放在了react项目下的src下的petsjson
这是宠物的术语名字图片
在区块链中写图片非常昂贵，大部分情况下在区块链中写id或者一些出生时间关键数据
将宠物的json直接引入
然后在项目中的render中的content直接引入
Pets类似数组，在init初始化时就有加一下东西
将truffle下的src下的狗的图片复制出来
放在react项目下的public下的images中
使用ant中的栅格系统，使用页面整个横向布局
可以将前面引入的Jason数组渲染出来
所有宠物名打印出来了
接下来将其图片也打印出来
在App.css中加入图片的宽度使其看起
现在好看多了
总共16个宠物，看起来和谐多了
重点低下逻辑，显示名字后要有领养按钮，不一定存在的，如刚才第一个，第2个已经领养过了，应显示已被领养
//判断当前宠物是否被领养(是否当前的领养地址为初始地址) isActive(i){ return this.state.adopters[i] == this.initAddress } 若未被领养，显示领养的按钮，若已领养就显示被领养的字样
基本功能已经完成再加入按钮的事件即可，以及加入class center使其居中，type样式为蓝色的
如下
在css中加入居中的样式
核心就是如何编写智能合约，测试合约，如何web端和智能合约交互
App.js所有代码如下
import React from &#39;react&#39; import Web3 from &#39;web3&#39; import TruffleContract from &#39;truffle-contract&#39; import AdoptionJson from &#39;./truffle/build/contracts/Adoption.json&#39;	//引入前面智能合约编译好得到的json文件 import { Button } from &#39;antd&#39; import { Layout, Menu, Breadcrumb } from &#39;antd&#39; import { Row, Col } from &#39;antd&#39; import &#39;.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-12T18:18:13+08:00">
    <meta property="article:modified_time" content="2024-07-12T18:18:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">6-7 宠物领养开发及相关代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>6-7 宠物领养开发及相关代码（react+区块链实战）</h4> 
 <br> 来到ant-design 
 <br> https://ant.design/index-cn 
</div> 
<p></p> 
<p>https://ant.design/components/layout-cn/<br> 来到布局<br> <img src="https://images2.imgbox.com/5d/d2/Vyz3b70d_o.png" alt="在这里插入图片描述"></p> 
<p>选择一个简单的布局即可<br> <img src="https://images2.imgbox.com/3b/c5/n84Pkwsc_o.png" alt="在这里插入图片描述"></p> 
<p>会显示出所有的相关界面的代码</p> 
<p><img src="https://images2.imgbox.com/2e/64/eBZSP7zo_o.png" alt="在这里插入图片描述"></p> 
<p>根据对应界面的代码在我们的react项目woniu-pet-shop中的App.js中进行更改</p> 
<p>如下<br> <img src="https://images2.imgbox.com/f2/07/YhU9kjyo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8a/61/mEwdpp3N_o.png" alt="在这里插入图片描述"></p> 
<p>刷新页面的效果如下<br> 页面的基本雏形如下</p> 
<p><img src="https://images2.imgbox.com/40/b8/zYdVRRMK_o.png" alt="在这里插入图片描述"></p> 
<p>要做宠物的领养，就要将宠物的数组拿出来<br> 在前面下载的petshop改名为truffle中放在了react项目下的src下的petsjson</p> 
<p><img src="https://images2.imgbox.com/22/26/LZadEmUa_o.png" alt="在这里插入图片描述"></p> 
<p>这是宠物的术语名字图片</p> 
<p>在区块链中写图片非常昂贵，大部分情况下在区块链中写id或者一些出生时间关键数据</p> 
<p>将宠物的json直接引入</p> 
<p><img src="https://images2.imgbox.com/c3/d4/Ccbba09Z_o.png" alt="在这里插入图片描述"></p> 
<p>然后在项目中的render中的content直接引入<br> Pets类似数组，在init初始化时就有加一下东西</p> 
<p><img src="https://images2.imgbox.com/cb/91/tZvy8toQ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e8/24/kpy3AVi8_o.png" alt="在这里插入图片描述"></p> 
<p>将truffle下的src下的狗的图片复制出来<br> <img src="https://images2.imgbox.com/91/4f/r0oXZ0kk_o.png" alt="在这里插入图片描述"></p> 
<p>放在react项目下的public下的images中</p> 
<p><img src="https://images2.imgbox.com/cb/ba/07DIw9LW_o.png" alt="在这里插入图片描述"></p> 
<p>使用ant中的栅格系统，使用页面整个横向布局</p> 
<p><img src="https://images2.imgbox.com/5a/48/55dXTDgZ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e6/0a/yviRufAW_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c5/6b/s8h7oUHJ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cc/4d/ZOHDVgud_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/3f/4a/FRCloSiC_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/67/b3/g6a6iQYc_o.png" alt="在这里插入图片描述"></p> 
<p>可以将前面引入的Jason数组渲染出来<br> <img src="https://images2.imgbox.com/e8/03/7Fljfbfh_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1a/00/YERkpw2n_o.png" alt="在这里插入图片描述"></p> 
<p>所有宠物名打印出来了<br> <img src="https://images2.imgbox.com/2f/be/WkZAdmUB_o.png" alt="在这里插入图片描述"></p> 
<p>接下来将其图片也打印出来</p> 
<p><img src="https://images2.imgbox.com/da/41/pqunMwnO_o.png" alt="在这里插入图片描述"></p> 
<p>在App.css中加入图片的宽度使其看起</p> 
<p><img src="https://images2.imgbox.com/31/6b/6CcJJcKD_o.png" alt="在这里插入图片描述"></p> 
<p>现在好看多了<br> <img src="https://images2.imgbox.com/e4/27/66ScCzT7_o.png" alt="在这里插入图片描述"></p> 
<p>总共16个宠物，看起来和谐多了</p> 
<p>重点低下逻辑，显示名字后要有领养按钮，不一定存在的，如刚才第一个，第2个已经领养过了，应显示已被领养<br> <img src="https://images2.imgbox.com/6a/84/IQ9TiwqO_o.png" alt="在这里插入图片描述"></p> 
<pre><code>//判断当前宠物是否被领养(是否当前的领养地址为初始地址)
	isActive(i){
		return this.state.adopters[i] == this.initAddress
	}
</code></pre> 
<p>若未被领养，显示领养的按钮，若已领养就显示被领养的字样</p> 
<p><img src="https://images2.imgbox.com/e9/1d/YpeAgkMy_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/86/3e/mskU8kII_o.png" alt="在这里插入图片描述"></p> 
<p>基本功能已经完成再加入按钮的事件即可，以及加入class center使其居中，type样式为蓝色的</p> 
<p>如下<br> <img src="https://images2.imgbox.com/06/7e/GSL9Upmh_o.png" alt="在这里插入图片描述"></p> 
<p>在css中加入居中的样式</p> 
<p><img src="https://images2.imgbox.com/e8/9d/AqgFIju9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8f/cb/oQ8gpbMD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3a/a6/rP0cxF98_o.png" alt="在这里插入图片描述"></p> 
<p>核心就是如何编写智能合约，测试合约，如何web端和智能合约交互</p> 
<p>App.js所有代码如下</p> 
<pre><code>import React from 'react'
import Web3 from 'web3'
import TruffleContract from 'truffle-contract'
import AdoptionJson from './truffle/build/contracts/Adoption.json'	//引入前面智能合约编译好得到的json文件
import { Button } from 'antd'
import { Layout, Menu, Breadcrumb } from 'antd'
import { Row, Col } from 'antd'
import './App.css'
import pets from "./truffle/src/pets.json"


const { Header, Content, Footer } = Layout;

//1.链接合约
//2.执行一下合约内部函数
//3.添加ant.design ui库支持
//4.完成项目
class App extends React.Component{
	constructor(props){
		super(props)
		this.web3 = null
		this.Adoption = null
		this.initAddress = '0x'+'0'.repeat(40)	//判断地址是否为初始值
		this.init()

		this.state = {
			//所有领养者的数据
			adopters:[]
			//name:'woniu'
		}
	}

	async init(){
		//如果网页中的web3不是undefined
		//if(typeof window.web3 != 'undefined'){
		//	this.web3Provider = window.web3.currentProvider;	//metamask内置了web3的实例，实际可以手动链接
		//}else{
		//	alert('please install metamask')
		//}
		
		//this.web3 = new Web3(this.web3Provider)		//将我们的this.web3Provider装载进来
		//this.initAdoption()
		
		/* 新版的方式 */
	  //var web3Provider;
	  if (window.ethereum) {
		this.web3Provider = window.ethereum;
		try {
		  // 请求用户授权
		  await window.ethereum.enable();
		} catch (error) {
		  // 用户不授权时
		  console.error("User denied account access")
		}
	  } else if (window.web3) {   // 老版 MetaMask Legacy dapp browsers...
		this.web3Provider = window.web3.currentProvider;
	  } else {
		this.web3Provider = new Web3.providers.HttpProvider('http://localhost:7545');
	  }
	  this.web3 = new Web3(this.web3Provider);//web3js就是你需要的web3实例
	  

	  this.web3.eth.getAccounts(function (error, result) {
		if (!error)
		  console.log(result)//授权成功后result能正常获取到账号了
		  //this.account = result
	  });
	  //this.account =result
	  //this.account =account
	  this.initAdoption()
	}

	initAdoption(){
		this.Adoption = TruffleContract(AdoptionJson)	//使用TruffleContract传入编译后的合约，然后创建实例，可以调用合约内部函数
		this.Adoption.setProvider(this.web3Provider)	//设置来源，链接合约
		return this.markAdopted()
	}
	
	//部署，这个是异步的，使用this.Adoption.deployed().then()也可以，这里用
	//this.markAdopted(){
		//部署链接一下
	//	const adoptionInstance = this.Adoption.deployed().then()	

	//}

	async markAdopted(){
		//部署链接一下
		//await同步方式获取异步数据
		const adoptionInstance = await this.Adoption.deployed()	//部署，这个是异步的，使用this.Adoption.deployed().then()也可以，这里用
		//调用合约内部函数getAdopters
		const adopters = await adoptionInstance.getAdopters.call()
		this.setState({adopters})			//此时得到所有领养者的信息，方便后续的渲染render
		console.log(adopters)
	}
	
	async adopt(petId){
		//const account = window.web3.eth.defaultAccount		//获取metamask中默认的账户
		// 授权获取账户
	    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const myAccount = accounts[0];	//获取当前metamask的地址

		const adoptionInstance = await this.Adoption.deployed()		//再次进行部署
		await adoptionInstance.adopt(petId,{from:myAccount})	//调用adopt只传递唯一一个参数，以及来源之前获取的地址，进行写入函数
		this.markAdopted()
	}

	//判断当前宠物是否被领养(是否当前的领养地址为初始地址)
	isActive(i){
		return this.state.adopters[i] == this.initAddress
	}

	
	//此处进行界面的渲染
	render(){
		
		return (
			//布局	//设置间距40
					//每个方块Col，以行24个，6，相当于每行4个宠物
			&lt;Layout className="layout"&gt;
				&lt;Header&gt;
				  
				&lt;/Header&gt;
				&lt;Content style={<!-- -->{ padding: '20px 50px' }}&gt;
					
				  &lt;Row gutter={40}&gt;		
					{
						pets.map((v,i)=&gt;{
							return (
								&lt;Col span='6' key={i}&gt;
									&lt;img src={v.picture} alt=""/&gt;
									&lt;div className = "center"&gt;
										&lt;p className="name"&gt;{v.name}&lt;/p&gt;
										{
											this.isActive(i)
												?&lt;Button type='primary' onClick={()=&gt;this.adopt(i)}&gt;领养&lt;/Button&gt;
												:&lt;span&gt;被领养&lt;/span&gt;
										}
									&lt;/div&gt;
								&lt;/Col&gt;
							)
						})
					 }

				  &lt;/Row&gt;

				&lt;/Content&gt;
				&lt;Footer style={<!-- -->{ textAlign: 'center' }}&gt;build by woniu ©2018&lt;/Footer&gt;
		  &lt;/Layout&gt;
				
		)

		//onclick点击事件，调用领养函数
		//return &lt;Button type='primary' onClick={()=&gt;this.adopt(2)}&gt;领养第二个&lt;/Button&gt;//hello,{this.state.name}
	}
}

export default App



App.css 所有代码如下
@import '~antd/dist/antd.css';

img{
 width:100%;
}

.center{
	text-align:center;
	margin:20px;
}
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a06c788f0ca5ead3ba1b90c356c07c35/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43; --＞ 类和对象(二)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65d35a44e85e4f448f044d2b08093a85/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">你也想做一个Element-ui吧！！！——Blueの前端路（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>