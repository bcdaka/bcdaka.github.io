<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WebView基础知识以及Androidx-WebKit的使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2fc699b214e8e3ef9a7dd478823070da/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="WebView基础知识以及Androidx-WebKit的使用">
  <meta property="og:description" content="文章目录 摘要WebView基础一、启动调整模式二、WebChromeClient三、WebViewClient四、WebSettings五、WebView和Native交互 Androidx-WebKit一、启动安全浏览服务二、设置代理三、安全的 WebView 和 Native 通信支持四、文件传递五、深色主题的支持六、JavaScript and WebAssembly执行引擎支持 摘要 文章主要分2部分：
Webview的基础相关知识：如调试、基础API、和原生交互等Androidx-WebKit 的使用： 如和原生的消息交互、文件传递、以及启动安全浏览等 WebView基础 一、启动调整模式 在开发过程中，我们可以启用 WebView 的调试模式，以便在 Chrome DevTools 中查看 WebView 的内容、网络请求等信息。
WebView.setWebContentsDebuggingEnabled(true) 调试界面 chrome://inspect/#devices
二、WebChromeClient WebChromeClient 是一个抽象基类，它的实例可以被传递给 WebView.setWebChromeClient() 方法，以处理与 JavaScript 交互和网页元素相关的事件。
2.1 WebChromeClient一进度相关
onProgressChanged(WebView view, int newProgress): 当页面加载进度改变时调用。newProgress参数表示当前页面加载的百分比。 2.2 WebChromeClient-标题、图标相关
onReceivedTitle(WebView view, String title): 当前页面的标题已经被接收到时调用。title参数是新的标题。onReceivedIcon(WebView view, Bitmap icon): 当前页面的图标已经被接收到时调用。icon参数是新的图标。onReceivedTouchIconUrl(WebView view, String url, boolean precomposed): 当网页的触摸图标URL被接收到时调用。url参数是图标的URL，precomposed参数表示图标是否已经被合成。 2.3 WebChromeClient-权限相关
onPermissionRequest(PermissionRequest request): 当网页请求一个权限时调用，例如摄像头、麦克风等。你可以在这个方法中处理权限请求。onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback): 当网页请求获取地理位置权限时调用。origin参数是请求权限的网页的源，callback参数是用于设置权限的回调。 override fun onPermissionRequest(request: PermissionRequest?">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-08T16:45:57+08:00">
    <meta property="article:modified_time" content="2024-05-08T16:45:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WebView基础知识以及Androidx-WebKit的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">摘要</a></li><li><a href="#WebView_8" rel="nofollow">WebView基础</a></li><li><ul><li><a href="#_10" rel="nofollow">一、启动调整模式</a></li><li><a href="#WebChromeClient_22" rel="nofollow">二、WebChromeClient</a></li><li><a href="#WebViewClient_102" rel="nofollow">三、WebViewClient</a></li><li><a href="#WebSettings_132" rel="nofollow">四、WebSettings</a></li><li><a href="#WebViewNative_191" rel="nofollow">五、WebView和Native交互</a></li></ul> 
  </li><li><a href="#AndroidxWebKit_226" rel="nofollow">Androidx-WebKit</a></li><li><ul><li><a href="#_236" rel="nofollow">一、启动安全浏览服务</a></li><li><a href="#_253" rel="nofollow">二、设置代理</a></li><li><a href="#_WebView__Native__271" rel="nofollow">三、安全的 WebView 和 Native 通信支持</a></li><li><a href="#_310" rel="nofollow">四、文件传递</a></li><li><a href="#_371" rel="nofollow">五、深色主题的支持</a></li><li><a href="#JavaScript_and_WebAssembly_375" rel="nofollow">六、JavaScript and WebAssembly执行引擎支持</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>摘要</h2> 
<p>文章主要分2部分：</p> 
<ol><li><strong>Webview的基础相关</strong>知识：如<strong>调试</strong>、<strong>基础API、和原生交互等</strong></li><li><strong>Androidx-WebKit</strong> 的使用： 如<strong>和原生的消息交互</strong>、<strong>文件传递</strong>、以及<strong>启动安全浏览等</strong></li></ol> 
<h2><a id="WebView_8"></a>WebView基础</h2> 
<h3><a id="_10"></a>一、启动调整模式</h3> 
<p>在开发过程中，我们可以启用 WebView 的调试模式，以便在 Chrome DevTools 中查看 WebView 的内容、网络请求等信息。</p> 
<pre><code class="prism language-kotlin">WebView<span class="token punctuation">.</span><span class="token function">setWebContentsDebuggingEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> 
<p>调试界面 <strong>chrome://inspect/#devices</strong></p> 
<p><img src="https://images2.imgbox.com/2e/22/qP8GIMGS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="WebChromeClient_22"></a>二、WebChromeClient</h3> 
<p>WebChromeClient 是一个抽象基类，它的实例可以被传递给 WebView.setWebChromeClient() 方法，以处理与 JavaScript 交互和网页元素相关的事件。</p> 
<p><strong>2.1 WebChromeClient一进度相关</strong></p> 
<ul><li><code>onProgressChanged(WebView view, int newProgress)</code>: 当页面加载进度改变时调用。newProgress参数表示当前页面加载的百分比。</li></ul> 
<p><strong>2.2 WebChromeClient-标题、图标相关</strong></p> 
<ul><li><code>onReceivedTitle(WebView view, String title)</code>: 当前页面的标题已经被接收到时调用。title参数是新的标题。</li><li><code>onReceivedIcon(WebView view, Bitmap icon)</code>: 当前页面的图标已经被接收到时调用。icon参数是新的图标。</li><li><code>onReceivedTouchIconUrl(WebView view, String url, boolean precomposed)</code>: 当网页的触摸图标URL被接收到时调用。url参数是图标的URL，precomposed参数表示图标是否已经被合成。</li></ul> 
<p><strong>2.3 WebChromeClient-权限相关</strong></p> 
<ul><li><code>onPermissionRequest(PermissionRequest request)</code>: 当网页请求一个权限时调用，例如摄像头、麦克风等。你可以在这个方法中处理权限请求。</li><li><code>onGeolocationPermissionsShowPrompt(String origin, GeolocationPermissions.Callback callback)</code>: 当网页请求获取地理位置权限时调用。origin参数是请求权限的网页的源，callback参数是用于设置权限的回调。</li></ul> 
<pre><code class="prism language-kotlin">     <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPermissionRequest</span><span class="token punctuation">(</span>request<span class="token operator">:</span> PermissionRequest<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-literal singleline"><span class="token string">"onPermissionRequest"</span></span><span class="token punctuation">.</span><span class="token function">logD</span><span class="token punctuation">(</span>WEB_TAG<span class="token punctuation">)</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                        request<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span>
                            kotlin<span class="token punctuation">.</span><span class="token function">runCatching</span> <span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isVideo</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>resources<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token function">startRequestPermissions</span><span class="token punctuation">(</span>permissions <span class="token operator">=</span> <span class="token function">arrayOf</span><span class="token punctuation">(</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">,</span> permission<span class="token punctuation">.</span>RECORD_AUDIO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">!</span>it<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                            request<span class="token punctuation">.</span><span class="token function">grant</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>resources<span class="token punctuation">)</span>
                                            request<span class="token punctuation">.</span>origin
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isOnlyAudio</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>resources<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                    <span class="token function">startRequestPermission</span><span class="token punctuation">(</span>permission <span class="token operator">=</span> permission<span class="token punctuation">.</span>RECORD_AUDIO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                            request<span class="token punctuation">.</span><span class="token function">grant</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>resources<span class="token punctuation">)</span>
                                            request<span class="token punctuation">.</span>origin
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span>e <span class="token operator">:</span>Exception<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        e<span class="token punctuation">.</span>message<span class="token punctuation">.</span><span class="token function">logE</span><span class="token punctuation">(</span>WEB_TAG<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">isVideo</span><span class="token punctuation">(</span>resources<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">val</span> strings <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token operator">*</span>resources<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> strings<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>PermissionRequest<span class="token punctuation">.</span>RESOURCE_VIDEO_CAPTURE<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">isOnlyAudio</span><span class="token punctuation">(</span>resources<span class="token operator">:</span> Array<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">val</span> strings <span class="token operator">=</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token operator">*</span>resources<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token operator">!</span>strings<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>PermissionRequest<span class="token punctuation">.</span>RESOURCE_VIDEO_CAPTURE<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> strings<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>PermissionRequest<span class="token punctuation">.</span>RESOURCE_AUDIO_CAPTURE<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

</code></pre> 
<p><strong>2.4 WebChromeClient-文件处理</strong></p> 
<ul><li><code>onShowFileChooser(WebView webView, ValueCallback&lt;Uri[]&gt; filePathCallback, FileChooserParams fileChooserParams)</code>: 当网页需要用户选择文件时调用，例如HTML的元素被点击时。你可以在这个方法中打开一个文件选择器，并将用户选择的文件的URI通过filePathCallback返回。</li></ul> 
<p><strong>2.5 WebChromeClient-弹窗、JS相关</strong></p> 
<ul><li><code>onJsAlert(WebView view, String url, String message, JsResult result)</code>: 当JavaScript的alert()函数被调用时调用。message参数是alert()函数的参数。</li><li><code>onJsConfirm(WebView view, String url, String message, JsResult result)</code>: 当JavaScript的confirm()函数被调用时调用。message参数是confirm()函数的参数。</li><li><code>onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result)</code>: 当JavaScript的prompt()函数被调用时调用。message参数是prompt()函数的第一个参数，defaultValue参数是prompt()函数的第二个参数。</li><li><code>onConsoleMessage(ConsoleMessage consoleMessage)</code>: 当JavaScript的console.log()函数被调用时调用。consoleMessage参数包含了日志消息的详细信息。</li><li><code>onJsBeforeUnload(WebView view, String url, String message, JsResult result)</code>: 当JavaScript的beforeunload事件被触发时调用。message参数是beforeunload事件的返回值。</li><li><code>onCreateWindow(WebView view, boolean isDialog, boolean isUserGesture, Message resultMsg)</code>: 当JavaScript的window.open()函数被调用时调用。你可以在这个方法中创建一个新的WebView，并将它通过resultMsg返回。</li><li><code>onCloseWindow(WebView window)</code>: 当JavaScript的window.close()函数被调用时调用。你可以在这个方法中关闭之前通过onCreateWindow创建的WebView。</li></ul> 
<p><strong>2.6 WebChromeClient-视频相关</strong></p> 
<ul><li><code>onShowCustomView(View view, CustomViewCallback callback)</code>: 当网页进入全屏模式时调用。在这种情况下，网页内容将不再在WebView中渲染，而是在传入的view中渲染。你应该将这个View添加到一个配置了WindowManager.LayoutParams.FLAG_FULLSCREEN标志的Window中，以实际全屏显示这个网页内容。</li><li><code>onHideCustomView()</code>: 当网页退出全屏模式时调用。你应该隐藏自定义的View（之前传给onShowCustomView(View view, CustomViewCallback callback)的View）。在这个方法调用后，网页内容将再次在原来的WebView中渲染。</li><li><code>getDefaultVideoPoster()</code>: 当视频元素不在播放状态时，它们由一个’poster’图像表示。可以通过HTML中的video标签的poster属性指定要使用的图像。如果该属性不存在，则使用默认的poster。这个方法允许ChromeClient提供默认的poster图像。</li><li><code>getVideoLoadingProgressView()</code>: 获取在全屏视频缓冲期间显示的View。主应用程序可以覆盖此方法以提供包含旋转器或类似物的View。</li></ul> 
<h3><a id="WebViewClient_102"></a>三、WebViewClient</h3> 
<p>WebViewClient 是一个抽象基类，它的实例可以被传递给 WebView.setWebViewClient() 方法，以处理与网页加载和渲染相关的事件。</p> 
<p><strong>3.1 WebViewClient-重定向</strong></p> 
<ul><li><code>shouldOverrideUrlLoading(WebView view, String url)</code>: 当 WebView 即将加载一个 URL 时调用。你可以在这个方法中决定是否要覆盖这个 URL 的加载，如果你想覆盖这个 URL 的加载，那么你应该返回 true，并在这个方法中进行你自己的处理，例如打开一个新的 Activity 来加载这个 URL。</li></ul> 
<p><strong>3.2 WebViewClient-页面加载</strong></p> 
<ul><li><code>onPageStarted(WebView view, String url, Bitmap favicon)</code>: 当网页开始加载时调用。url 参数是正在加载的网页的 URL。</li><li><code>onPageFinished(WebView view, String url)</code>: 当网页加载完成时调用。url 参数是刚刚加载完成的网页的 URL。</li><li><code>onLoadResource(WebView view, String url)</code>: 当 WebView 正在加载一个资源（例如图片或者 JavaScript 文件）时调用。url 参数是正在加载的资源的 URL。</li></ul> 
<p><strong>3.3 WebViewClient-认证请求相关</strong></p> 
<ul><li><code>onReceivedHttpAuthRequest(WebView view, HttpAuthHandler handler, String host, String realm)</code>: 当 WebView 需要进行 HTTP 认证时调用。你可以在这个方法中处理认证请求，例如显示一个输入用户名和密码的对话框。</li><li><code>onReceivedLoginRequest(WebView view, String realm, @Nullable String account, String args)</code>: 当 WebView 需要进行自动登录时调用。你可以在这个方法中处理登录请求，例如从存储的账户信息中获取用户名和密码。</li></ul> 
<p><strong>3.4 WebViewClient-其他</strong></p> 
<ul><li><code>onReceivedError(WebView view, int errorCode, String description, String failingUrl)</code>: 当 WebView 加载网页时发生错误时调用。errorCode 参数是错误码，description 参数是错误描述，failingUrl 参数是发生错误的网页的 URL。</li><li><code>onReceivedHttpError(WebView view, WebResourceRequest request, WebResourceResponse errorResponse)</code>: 当 WebView 接收到 HTTP 错误时调用。request 参数是发生错误的请求，errorResponse 参数是服务器的响应。</li><li><code>onReceivedSslError(WebView view, SslErrorHandler handler, SslError error)</code>: 当 WebView 加载的网页有 SSL 错误时调用。你可以在这个方法中处理 SSL 错误，例如显示一个对话框让用户决定是否要继续加载。</li><li><code>onSafeBrowsingHit(WebView view, WebResourceRequest request, int threatType, SafeBrowsingResponse callback)</code>: 当 WebView 访问一个被 Safe Browsing 判断为可能是恶意的网站时被调用。你可以在这个方法中处理这个事件，例如显示一个警告对话框，或者导航到一个安全的网页。callback 参数是一个 SafeBrowsingResponse，你可以调用它的 showInterstitial(boolean) 或 proceed(boolean) 方法来决定是否显示一个安全警告的插页广告，或者继续加载这个网页。</li><li><code>onFormResubmission(WebView view, Message dontResend, Message resend)</code>: 当 WebView 尝试重新提交一个表单，并且需要用户确认是否重新提交时调用。你可以在这个方法中处理这个事件，例如显示一个确认对话框。</li><li><code>onScaleChanged(WebView view, float oldScale, float newScale)</code>: 当 WebView 的缩放级别改变时调用。你可以在这个方法中处理缩放级别的改变，例如更新一个缩放级别的显示。</li><li><code>onUnhandledKeyEvent(WebView view, KeyEvent event)</code>: 当 WebView 收到一个未处理的按键事件时调用。你可以在这个方法中处理未处理的按键事件，例如实现自定义的按键处理。</li><li><code>doUpdateVisitedHistory(WebView view, String url, boolean isReload)</code>: 一个页面的访问历史记录被更新时，这个方法会被调用。</li></ul> 
<h3><a id="WebSettings_132"></a>四、WebSettings</h3> 
<p><code>WebSettings</code> 是一个类，它用于管理 WebView 的各种设置。你可以通过 <code>WebView.getSettings()</code> 方法获取到一个 <code>WebSettings</code> 实例，然后通过这个实例来配置 WebView 的设置。</p> 
<p>以下是一些常用的 <code>WebSettings</code> 方法：</p> 
<ul><li><code>setJavaScriptEnabled(boolean enabled)</code>: 设置 WebView 是否支持 JavaScript。默认值为 <code>false</code>。</li><li><code>setSupportZoom(boolean support)</code>: 设置 WebView 是否支持缩放。默认值为 <code>false</code>。</li><li><code>setDisplayZoomControls(boolean enabled)</code>: 设置 WebView 是否显示缩放控件。默认值为 <code>true</code>。</li><li><code>setBuiltInZoomControls(boolean enabled)</code>: 设置 WebView 是否使用内置的缩放机制。默认值为 <code>false</code>。</li><li><code>setLoadWithOverviewMode(boolean overview)</code>: 设置 WebView 是否应该启用概览模式，即总是缩放内容以适应屏幕宽度。默认值为 <code>false</code>。</li><li><code>setUseWideViewPort(boolean use)</code>: 设置 WebView 是否应该启用宽视图端口。默认值为 <code>false</code>。</li><li><code>setJavaScriptCanOpenWindowsAutomatically(boolean allow)</code>: 设置 WebView 的 JavaScript 是否可以自动打开窗口。默认值为 <code>false</code>。</li><li><code>setMediaPlaybackRequiresUserGesture(boolean require)</code>: 设置为 false，那么 WebView 中的音频和视频将会自动播放，不需要用户交互。</li><li><code>setLoadsImagesAutomatically(boolean flag)</code>: 用于设置 WebView 是否自动加载图片。 如果设置为 true，WebView 会自动加载网页中的图片。如果设置为 false，所有的图片都不会被加载，只有当 LOAD_CACHE_ELSE_NETWORK 或 LOAD_NO_CACHE 被使用时，才会加载。</li></ul> 
<p><code>WebSettings</code> 提供了一些方法来管理 WebView 的缓存：</p> 
<ol><li><code>setCacheMode(int mode)</code>: 设置 WebView 的缓存模式。可选的值有： 
  <ul><li><code>LOAD_DEFAULT</code>: 默认的缓存模式。如果没有 <code>Cache-Control</code> 或 <code>Expires</code> 头，缓存会被存储，当资源过期时，WebView 会尝试从网络加载。如果没有网络，WebView 会从缓存加载。</li><li><code>LOAD_CACHE_ELSE_NETWORK</code>: 只要缓存存在，即使过期也会从缓存加载。如果缓存不存在，WebView 会从网络加载。</li><li><code>LOAD_NO_CACHE</code>: 不使用缓存，WebView 会从网络加载。</li><li><code>LOAD_CACHE_ONLY</code>: 不从网络加载，只从缓存加载。</li></ul> </li><li><code>setAppCacheEnabled(boolean enabled)</code>: 设置 WebView 是否启用应用缓存。默认值为 <code>false</code>。注意，你还需要通过 <code>setAppCachePath</code> 方法设置一个应用缓存的路径。</li><li><code>setAppCachePath(String appCachePath)</code>: 设置应用缓存的路径。这个路径必须是可以让应用读写的。</li><li><code>setAppCacheMaxSize(long appCacheMaxSize)</code>: 设置应用缓存的最大大小。</li><li><code>setDatabaseEnabled(boolean enabled)</code>: 设置 WebView 是否启用数据库存储 API。默认值为 <code>false</code>。</li><li><code>setDomStorageEnabled(boolean enabled)</code>: 设置 WebView 是否启用 DOM 存储 API。默认值为 <code>false</code>，<code>true</code>可以使用 sessionStorage 和 localStorage 对象来存储和检索数据。。</li></ol> 
<pre><code>  //设置Cookie
  fun setCookie(map: MutableMap&lt;String, String&gt;) {
        val cookieManager: CookieManager = CookieManager.getInstance()
        cookieManager.setAcceptCookie(true)
        map.onEach { entry -&gt;
            cookieManager.setCookie(entry.key, entry.value)
        }
        cookieManager.flush()
    }
    /**
     * 给设置localStorage 设置数据
     */
    fun setLocalStorage(itmes: Map&lt;String, String&gt;) {
        val jsonBuf = StringBuilder()
        for (key in itmes.keys) {
            if (isNotEmpty(itmes[key])) {
                jsonBuf.append("localStorage.setItem('key', '")
                    .append(itmes[key])
                    .append("');")
            }
        }
        val info = jsonBuf.toString()
        if (isNotEmpty(info)) {
            webView.evaluateJavascript(info, null)
        }
    }

</code></pre> 
<h3><a id="WebViewNative_191"></a>五、WebView和Native交互</h3> 
<p>WebView 和 Native 交互主要有两种方式：JavaScriptInterface 和 WebView.evaluateJavascript。</p> 
<ol><li><strong>JavaScriptInterface</strong>：这是一种将 Java 对象映射到 JavaScript 的方式。你可以创建一个 Java 对象，这个对象的公共方法可以在 JavaScript 中被调用。例如：</li></ol> 
<pre><code class="prism language-kotlin"><span class="token keyword">class</span> <span class="token function">JavaScriptInterface</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">val</span> context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation builtin">@JavascriptInterface</span>
    <span class="token keyword">fun</span> <span class="token function">showToast</span><span class="token punctuation">(</span>message<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> message<span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">val</span> webView<span class="token operator">:</span> WebView <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>webview<span class="token punctuation">)</span>
webView<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span><span class="token function">JavaScriptInterface</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Android"</span></span><span class="token punctuation">)</span>

</code></pre> 
<p>在上述代码中，我们创建了一个 <code>JavaScriptInterface</code> 类，并将其实例添加到了 WebView 中。</p> 
<p>在 JavaScript 中:</p> 
<pre><code class="prism language-JavaScript">Android.showToast(message);
</code></pre> 
<p><strong>WebView.evaluateJavascript</strong>：这是一种在 WebView 中执行 JavaScript 代码的方式。你可以使用这个方法来调用 JavaScript 函数，并获取返回值。例如：</p> 
<pre><code class="prism language-kotlin">webView<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"document.title"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> title <span class="token operator">-&gt;</span>
    Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"WebView"</span></span><span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Document title: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">title</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<h2><a id="AndroidxWebKit_226"></a>Androidx-WebKit</h2> 
<pre><code class="prism language-groovy">dependencies <span class="token punctuation">{<!-- --></span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"androidx.webkit:webkit:1.9.0"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里下面就是WebKit对于的 WebView 的增强方法</p> 
<h3><a id="_236"></a>一、启动安全浏览服务</h3> 
<pre><code class="prism language-kotlin">    <span class="token comment">/**
         * Start safe browsing
         * 用于启动安全浏览服务。这个服务可以帮助 WebView 防止用户访问被认为是恶意的网站
         */</span>
        <span class="token keyword">fun</span> <span class="token function">startSafeBrowsing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>WebViewFeature<span class="token punctuation">.</span><span class="token function">isFeatureSupported</span><span class="token punctuation">(</span>WebViewFeature<span class="token punctuation">.</span>START_SAFE_BROWSING<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                WebViewCompat<span class="token punctuation">.</span><span class="token function">startSafeBrowsing</span><span class="token punctuation">(</span>BaseKit<span class="token punctuation">.</span>app<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"WebView.startSafeBrowsing isSuccess = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">it</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">logI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

</code></pre> 
<h3><a id="_253"></a>二、设置代理</h3> 
<pre><code class="prism language-kotlin"><span class="token keyword">if</span> <span class="token punctuation">(</span>WebViewFeature<span class="token punctuation">.</span><span class="token function">isFeatureSupported</span><span class="token punctuation">(</span>WebViewFeature<span class="token punctuation">.</span>PROXY_OVERRIDE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    ProxyConfig proxyConfig <span class="token operator">=</span> new ProxyConfig<span class="token punctuation">.</span><span class="token function">Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">addProxyRule</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"localhost:7890"</span></span><span class="token punctuation">)</span> <span class="token comment">//添加要用于所有 URL 的代理</span>
            <span class="token punctuation">.</span><span class="token function">addProxyRule</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"localhost:1080"</span></span><span class="token punctuation">)</span> <span class="token comment">//优先级低于第一个代理，仅在上一个失败时应用</span>
            <span class="token punctuation">.</span><span class="token function">addDirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment">//当前面的代理失败时，不使用代理直连</span>
            <span class="token punctuation">.</span><span class="token function">addBypassRule</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"www.baidu.com"</span></span><span class="token punctuation">)</span> <span class="token comment">//该网址不使用代理，直连服务</span>
            <span class="token punctuation">.</span><span class="token function">addBypassRule</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"*.cn"</span></span><span class="token punctuation">)</span>          <span class="token comment">//以.cn结尾的网址不使用代理</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Executor executor <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span>
    Runnable listener <span class="token operator">=</span> <span class="token operator">..</span><span class="token punctuation">.</span>
    ProxyController<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setProxyOverride</span><span class="token punctuation">(</span>proxyConfig<span class="token punctuation">,</span> executor<span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span>
｝

</code></pre> 
<h3><a id="_WebView__Native__271"></a>三、安全的 WebView 和 Native 通信支持</h3> 
<pre><code class="prism language-kotlin"><span class="token comment">// App</span>
    <span class="token keyword">val</span> myListener <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> WebViewCompat<span class="token punctuation">.</span><span class="token function">WebMessageListener</span> <span class="token punctuation">{<!-- --></span>

            <span class="token comment">/**
             * On post message
             *
             * @param view WebView
             * @param message js代码发送的消息
             * @param sourceOrigin 发送消息的网页地址
             * @param isMainFrame 是否是主页面，iFrame中的页面为false
             * @param replyProxy 回复消息的代理
             */</span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onPostMessage</span><span class="token punctuation">(</span>view<span class="token operator">:</span> WebView<span class="token punctuation">,</span> message<span class="token operator">:</span> WebMessageCompat<span class="token punctuation">,</span> sourceOrigin<span class="token operator">:</span> Uri<span class="token punctuation">,</span> isMainFrame<span class="token operator">:</span> Boolean<span class="token punctuation">,</span> replyProxy<span class="token operator">:</span> JavaScriptReplyProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// do something about view, message, sourceOrigin and isMainFrame.</span>
                <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">val</span> allowedOriginRules <span class="token operator">=</span> allowedRules <span class="token operator">?:</span> <span class="token function">setOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        WebViewCompat<span class="token punctuation">.</span><span class="token function">addWebMessageListener</span><span class="token punctuation">(</span>
        <span class="token comment">/* webView = */</span> webView<span class="token punctuation">,</span>
        <span class="token comment">/* jsObjectName = */</span>jsObjectName<span class="token punctuation">,</span>
        <span class="token comment">/* allowedOriginRules = */</span> allowedOriginRules<span class="token punctuation">,</span>
        <span class="token comment">/* listener = */</span>myListener
    <span class="token punctuation">)</span>

</code></pre> 
<pre><code class="prism language-JavaScript">// Web page (in JavaScript)
myObject.onmessage = function(event) {
  // prints "Got it!" when we receive the app's response.
  console.log(event.data);
}
myObject.postMessage("I'm ready!");

</code></pre> 
<h3><a id="_310"></a>四、文件传递</h3> 
<p><strong>4.1 Native 传递文件给 WebView:</strong></p> 
<pre><code class="prism language-java"><span class="token comment">// App (in Java)</span>
<span class="token class-name">WebMessageListener</span> myListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebMessageListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPostMessage</span><span class="token punctuation">(</span><span class="token class-name">WebView</span> view<span class="token punctuation">,</span> <span class="token class-name">WebMessageCompat</span> message<span class="token punctuation">,</span> <span class="token class-name">Uri</span> sourceOrigin<span class="token punctuation">,</span>
           <span class="token keyword">boolean</span> isMainFrame<span class="token punctuation">,</span> <span class="token class-name">JavaScriptReplyProxy</span> replyProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Communication is setup, send file data to web.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WebViewFeature</span><span class="token punctuation">.</span><span class="token function">isFeatureSupported</span><span class="token punctuation">(</span><span class="token class-name">WebViewFeature</span><span class="token punctuation">.</span><span class="token constant">WEB_MESSAGE_ARRAY_BUFFER</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// Suppose readFileData method is to read content from file.</span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileData <span class="token operator">=</span> <span class="token function">readFileData</span><span class="token punctuation">(</span><span class="token string">"myFile.dat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      replyProxy<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>fileData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-jsx">// Web page (in JavaScript)
myObject.onmessage = function(event) {
  if (event.data instanceof ArrayBuffer) {
    const data = event.data;  // Received file content from app.
    const dataView = new DataView(data);
    // Consume file content by using JavaScript DataView to access ArrayBuffer.
  }
}
myObject.postMessage("Setup!");

</code></pre> 
<p><strong>4.2 WebView 传递文件给 Native:</strong></p> 
<pre><code class="prism language-jsx">// Web page (in JavaScript)
const response = await fetch('example.jpg');
if (response.ok) {
    const imageData = await response.arrayBuffer();
    myObject.postMessage(imageData);
}

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// App (in Java)</span>
<span class="token class-name">WebMessageListener</span> myListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebMessageListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPostMessage</span><span class="token punctuation">(</span><span class="token class-name">WebView</span> view<span class="token punctuation">,</span> <span class="token class-name">WebMessageCompat</span> message<span class="token punctuation">,</span> <span class="token class-name">Uri</span> sourceOrigin<span class="token punctuation">,</span>
           <span class="token keyword">boolean</span> isMainFrame<span class="token punctuation">,</span> <span class="token class-name">JavaScriptReplyProxy</span> replyProxy<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">WebMessageCompat</span><span class="token punctuation">.</span><span class="token constant">TYPE_ARRAY_BUFFER</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imageData <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getArrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// do something like draw image on ImageView.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<h3><a id="_371"></a>五、深色主题的支持</h3> 
<p>简单来说如果您想让 WebView 的内容和应用的主题相匹配，您应该始终定义深色主题并实现 prefers-color-scheme，而对于未定义 prefers-color-scheme 的页面，系统按照不同的策略选择算法生成或者显示默认页面。</p> 
<h3><a id="JavaScript_and_WebAssembly_375"></a>六、JavaScript and WebAssembly执行引擎支持</h3> 
<p>JavascriptEngine 直接使用了 WebView 的 V8 实现，由于不用分配其他 WebView 资源所以资源消耗更低，并可以开启多个独立运行的沙箱环境，还针对传递大量数据做了优化。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">JavaScriptSandbox</span><span class="token punctuation">.</span><span class="token function">isSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//连接到引擎</span>
<span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JavaScriptSandbox</span><span class="token punctuation">&gt;</span></span> jsSandboxFuture <span class="token operator">=</span>
               <span class="token class-name">JavaScriptSandbox</span><span class="token punctuation">.</span><span class="token function">createConnectedInstanceAsync</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//创建上下文 上下文间有简单的数据隔离</span>
<span class="token class-name">JavaScriptIsolate</span> jsIsolate <span class="token operator">=</span> jsSandbox<span class="token punctuation">.</span><span class="token function">createIsolate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//执行函数 &amp;&amp; 获取结果</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> code <span class="token operator">=</span> <span class="token string">"function sum(a, b) { let r = a + b; return r.toString(); }; sum(3, 4)"</span><span class="token punctuation">;</span>
<span class="token class-name">ListenableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> resultFuture <span class="token operator">=</span> jsIsolate<span class="token punctuation">.</span><span class="token function">evaluateJavaScriptAsync</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> result <span class="token operator">=</span> resultFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Futures</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>resultFuture<span class="token punctuation">,</span>
       <span class="token keyword">new</span> <span class="token class-name">FutureCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token class-name">String</span> result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
               text<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           <span class="token annotation punctuation">@Override</span>
           <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFailure</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
               text<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       mainThreadExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Wasm运行</span>
<span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hello_world_wasm <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
   <span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x61</span> <span class="token punctuation">,</span><span class="token number">0x73</span> <span class="token punctuation">,</span><span class="token number">0x6d</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x0a</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x60</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x7f</span> <span class="token punctuation">,</span><span class="token number">0x7f</span> <span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">,</span>
   <span class="token number">0x7f</span> <span class="token punctuation">,</span><span class="token number">0x60</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x03</span> <span class="token punctuation">,</span><span class="token number">0x03</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x04</span> <span class="token punctuation">,</span><span class="token number">0x04</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x70</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span>
   <span class="token number">0x03</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x06</span> <span class="token punctuation">,</span><span class="token number">0x06</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x7f</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x41</span> <span class="token punctuation">,</span><span class="token number">0x08</span> <span class="token punctuation">,</span><span class="token number">0x0b</span> <span class="token punctuation">,</span><span class="token number">0x07</span> <span class="token punctuation">,</span><span class="token number">0x18</span> <span class="token punctuation">,</span><span class="token number">0x03</span> <span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span>
   <span class="token number">0x6d</span> <span class="token punctuation">,</span><span class="token number">0x65</span> <span class="token punctuation">,</span><span class="token number">0x6d</span> <span class="token punctuation">,</span><span class="token number">0x6f</span> <span class="token punctuation">,</span><span class="token number">0x72</span> <span class="token punctuation">,</span><span class="token number">0x79</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x05</span> <span class="token punctuation">,</span><span class="token number">0x74</span> <span class="token punctuation">,</span><span class="token number">0x61</span> <span class="token punctuation">,</span><span class="token number">0x62</span> <span class="token punctuation">,</span><span class="token number">0x6c</span> <span class="token punctuation">,</span><span class="token number">0x65</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span>
   <span class="token number">0x03</span> <span class="token punctuation">,</span><span class="token number">0x61</span> <span class="token punctuation">,</span><span class="token number">0x64</span> <span class="token punctuation">,</span><span class="token number">0x64</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x09</span> <span class="token punctuation">,</span><span class="token number">0x07</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x41</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x0b</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x0a</span><span class="token punctuation">,</span>
   <span class="token number">0x0c</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x07</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x20</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x20</span> <span class="token punctuation">,</span><span class="token number">0x01</span> <span class="token punctuation">,</span><span class="token number">0x6a</span> <span class="token punctuation">,</span><span class="token number">0x0b</span> <span class="token punctuation">,</span><span class="token number">0x02</span> <span class="token punctuation">,</span><span class="token number">0x00</span> <span class="token punctuation">,</span><span class="token number">0x0b</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">String</span> jsCode <span class="token operator">=</span> <span class="token string">"android.consumeNamedDataAsArrayBuffer('wasm-1').then("</span> <span class="token operator">+</span>
       <span class="token string">"(value) =&gt; { return WebAssembly.compile(value).then("</span> <span class="token operator">+</span>
       <span class="token string">"(module) =&gt; { return new WebAssembly.Instance(module).exports.add(20, 22).toString(); }"</span> <span class="token operator">+</span>
       <span class="token string">")})"</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> success <span class="token operator">=</span> js<span class="token punctuation">.</span><span class="token function">provideNamedData</span><span class="token punctuation">(</span><span class="token string">"wasm-1"</span><span class="token punctuation">,</span> hello_world_wasm<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">FluentFuture</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>js<span class="token punctuation">.</span><span class="token function">evaluateJavaScriptAsync</span><span class="token punctuation">(</span>jsCode<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">,</span> mainThreadExecutor<span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">catching</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> e <span class="token operator">-&gt;</span> <span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mainThreadExecutor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
   <span class="token comment">// the data chunk name has been used before, use a different name</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44dc89574f3b2908dd9532dc71690eb7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio Gemini插件使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7821b52797dca438c22fceae52ba624b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac 解决外接移动硬盘(NTFS格式)无法写入的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>