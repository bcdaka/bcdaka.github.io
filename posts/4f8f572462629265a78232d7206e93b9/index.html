<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在windows 11本地搭建RAG数据查询的AI大模型环境 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4f8f572462629265a78232d7206e93b9/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="在windows 11本地搭建RAG数据查询的AI大模型环境">
  <meta property="og:description" content="最近，随着人工智能技术的快速发展，越来越多的研究人员和开发者开始关注如何构建强大的AI大模型环境，以支持各种复杂的自然语言处理任务。其中，基于检索-生成器（Retrieval-Augmented Generation，简称RAG）架构的数据查询模型备受关注，因为它能够结合从大规模文本语料库中检索信息和生成自然语言文本的能力，实现更加智能和准确的数据查询。
在本文中，我们将探讨如何在windows 11本地环境中搭建一个RAG数据查询的AI大模型环境。首先，我们需要准备以下工具和资源：
先看配置、无GPU：
CPU：i7 1360p，内存：16G，硬盘：500G
第一步：安装python环境 在 Windows 11 上安装 Python 环境的步骤和说明
以下是在 Windows 11 上安装 Python 环境的详细步骤和说明：
下载 Python 安装程序：首先，打开浏览器，访问 Python 官方网站（https://www.python.org/downloads/），在该页面上找到适用于 Windows 的3.11版本（版本过高会出现各种疑难杂症）的 Python 安装程序，并点击下载。
运行安装程序：下载完成后，双击运行 Python 安装程序。在安装向导中，确保勾选“Add Python x.x to PATH”选项（x.x 表示 Python 的版本号），然后点击“Install Now”按钮。
安装 Python：安装程序将开始安装 Python，等待安装完成。
验证安装：安装完成后，可以在命令提示符或 PowerShell 中输入以下命令来验证 Python 是否成功安装：
python --version 安装 pip：pip 是 Python 的包管理工具，通常与 Python 一起安装。可以在命令提示符或 PowerShell 中输入以下命令来验证 pip 是否成功安装：
pip --version 使用 Python：现在，您可以在命令提示符或 PowerShell 中输入“python”来启动 Python 解释器，并开始编写和运行 Python 代码。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-04T19:00:08+08:00">
    <meta property="article:modified_time" content="2024-05-04T19:00:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在windows 11本地搭建RAG数据查询的AI大模型环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近，随着人工智能技术的快速发展，越来越多的研究人员和开发者开始关注如何构建强大的AI大模型环境，以支持各种复杂的自然语言处理任务。其中，基于检索-生成器（Retrieval-Augmented Generation，简称RAG）架构的数据查询模型备受关注，因为它能够结合从大规模文本语料库中检索信息和生成自然语言文本的能力，实现更加智能和准确的数据查询。</p> 
<p>在本文中，我们将探讨如何在windows 11本地环境中搭建一个RAG数据查询的AI大模型环境。首先，我们需要准备以下工具和资源：</p> 
<p><strong>先看配置、无GPU：</strong></p> 
<p>CPU：i7 1360p，内存：16G，硬盘：500G</p> 
<h2><strong>第一步：安装python环境</strong></h2> 
<p>在 Windows 11 上安装 Python 环境的步骤和说明</p> 
<p>以下是在 Windows 11 上安装 Python 环境的详细步骤和说明：</p> 
<ol><li> <p>下载 Python 安装程序：首先，打开浏览器，访问 Python 官方网站（<a href="https://www.python.org/downloads/%EF%BC%89%EF%BC%8C%E5%9C%A8%E8%AF%A5%E9%A1%B5%E9%9D%A2%E4%B8%8A%E6%89%BE%E5%88%B0%E9%80%82%E7%94%A8%E4%BA%8E" rel="nofollow" title="https://www.python.org/downloads/），在该页面上找到适用于">https://www.python.org/downloads/），在该页面上找到适用于</a> Windows 的<span style="color:#fe2c24;">3.11</span>版本（版本过高会出现各种疑难杂症）的 Python 安装程序，并点击下载。</p> </li><li> <p>运行安装程序：下载完成后，双击运行 Python 安装程序。在安装向导中，确保勾选“Add Python x.x to PATH”选项（x.x 表示 Python 的版本号），然后点击“Install Now”按钮。</p> </li><li> <p>安装 Python：安装程序将开始安装 Python，等待安装完成。</p> </li><li> <p>验证安装：安装完成后，可以在命令提示符或 PowerShell 中输入以下命令来验证 Python 是否成功安装：</p> <p><code>python --version </code></p> </li><li> <p>安装 pip：pip 是 Python 的包管理工具，通常与 Python 一起安装。可以在命令提示符或 PowerShell 中输入以下命令来验证 pip 是否成功安装：</p> <p><code>pip --version </code></p> </li><li> <p>使用 Python：现在，您可以在命令提示符或 PowerShell 中输入“python”来启动 Python 解释器，并开始编写和运行 Python 代码。</p> </li><li> <p>安装集成开发环境（IDE）：如果您需要一个更友好和强大的编码环境，可以安装 Python 的集成开发环境，如 Visual Studio Code、PyCharm 等。</p> </li></ol> 
<p><img alt="" height="608" src="https://images2.imgbox.com/89/90/eZegjxnF_o.png" width="1200"></p> 
<h2><strong>第二步：安装Ollama（LLM模型在最后chat步骤进行在线安装）</strong></h2> 
<ol><li> <p>下载 Ollama 安装程序：首先，打开浏览器，访问 Ollama 的官方网站（<a href="https://ollama.com/%EF%BC%89%EF%BC%8C%E5%9C%A8%E9%A6%96%E9%A1%B5%E6%88%96%E4%B8%8B%E8%BD%BD%E9%A1%B5%E9%9D%A2%E4%B8%8A%E6%89%BE%E5%88%B0%E9%80%82%E7%94%A8%E4%BA%8E" rel="nofollow" title="https://ollama.com/），在首页或下载页面上找到适用于">https://ollama.com/），在首页或下载页面上找到适用于</a> Windows 的 Ollama 安装程序，并点击下载。</p> </li><li> <p>运行安装程序：下载完成后，双击运行 Ollama 安装程序。在安装向导中，按照提示完成安装过程。</p> </li><li> <p>启动 Ollama：安装完成后，可以在开始菜单中找到 Ollama 快捷方式，双击打开应用程序。</p> </li></ol> 
<p><img alt="" height="689" src="https://images2.imgbox.com/05/a1/0PoGJySA_o.png" width="835"></p> 
<h2><strong>第三步：安装docker desktop</strong></h2> 
<p>在 Windows 11 上安装 Docker Desktop 的步骤和流程如下：</p> 
<p>1. 下载 Docker Desktop：首先，打开浏览器，访问 Docker 官方网站（https://www.docker.com/products/docker-desktop），在该页面上找到适用于 Windows 的 Docker Desktop 安装程序，并点击下载。</p> 
<p>2. 运行安装程序：下载完成后，双击运行 Docker Desktop 安装程序。在安装向导中，按照提示完成安装过程。可能需要您授予管理员权限以完成安装。</p> 
<p>3. 启用 WSL 2 功能：Docker Desktop 需要使用 Windows Subsystem for Linux 2（WSL 2）来运行容器。确保您已经启用了 WSL 2 功能。您可以在 PowerShell 中运行以下命令来启用 WSL 2</p> 
<p><span style="color:#fe2c24;">（如wsl2没有安装，请自行csdn或百度安装）：</span><br>    ```<br>    wsl --set-default-version 2<br>    ```</p> 
<p>4. 启动 Docker Desktop：安装完成后，在开始菜单中找到 Docker Desktop 快捷方式，双击打开应用程序。Docker Desktop 将会启动，并在系统托盘中显示 Docker 图标。</p> 
<p>通过以上步骤，您就可以在 Windows 11 上成功安装 Docker Desktop，并开始使用 Docker 来管理容器化应用程序。希望这份说明对您有所帮助，祝您在 Windows 11 上愉快地使用 Docker！</p> 
<p>docker 安装好后默认镜像都保存在C盘，如果你的C盘容量不够，请设置到其他盘符。<br><img alt="" height="672" src="https://images2.imgbox.com/3c/ac/1Aj1pEPO_o.png" width="1200"></p> 
<h2><strong>第四步：安装RAGChat（OpenWebUI）</strong></h2> 
<p><a href="https://top.aibase.com/tool/open-webui" rel="nofollow" title="Open WebUI">Open WebUI</a>是一个为LLMs（大型语言模型）设计的友好型Web用户界面，支持Ollama和OpenAI兼容的API。它提供了直观的聊天界面、响应式设计、快速响应性能、简易安装、代码语法高亮、Markdown和LaTeX支持、本地RAG集成、Web浏览能力、提示预设支持、RLHF注释、会话标记、模型下载/删除、GGUF文件模型创建、多模型支持、多模态支持、模型文件构建器、协作聊天、OpenAI API集成等功能。</p> 
<p>github地址：<a href="https://github.com/open-webui/open-webui" title="GitHub - open-webui/open-webui: User-friendly WebUI for LLMs (Formerly Ollama WebUI)">GitHub - open-webui/open-webui: User-friendly WebUI for LLMs (Formerly Ollama WebUI)</a></p> 
<p>安装方式：右键cmd 或 powershell  粘贴下下面代码：</p> 
<p>1、本地ollama和docker同一台机器：</p> 
<p>docker run -d -p 3000:8080 --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main</p> 
<p>2、ollama和docker不在同一台机器：</p> 
<p>docker run -d -p 3000:8080 -e OLLAMA_BASE_URL=https://example.com -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:main</p> 
<p>然后运行，会自动部署到dockerdesktop中。完成后浏览器访问：<a href="http://localhost:3000/" rel="nofollow" title="http://localhost:3000">http://localhost:3000</a>. </p> 
<p><img alt="" height="610" src="https://images2.imgbox.com/de/2e/x6igilTT_o.png" width="862"></p> 
<h2><strong>第五步：使用OpenWebUI 进行安装模型。</strong></h2> 
<p><strong>1、先登录</strong><strong>OpenWebUI </strong>，需要注册一个管理员账号。</p> 
<p><img alt="" height="421" src="https://images2.imgbox.com/6e/d3/CT2KBAOi_o.png" width="746"></p> 
<p>2、登录到系统后，配置ollama地址。左下角有用户名，点击用户名进入设置，会弹出如下窗口。</p> 
<p><img alt="" height="781" src="https://images2.imgbox.com/ad/67/ZBswJTPH_o.png" width="1044"></p> 
<p>3、下载模型并加载模型，这里需要选择：模型，然后去ollama官网下载你喜欢的模型。将下面图三的模型复制到方框中进行下载。（注意：下载过程中前期比较快，但到96%后可能较慢，请您耐心等待）</p> 
<p><img alt="" height="554" src="https://images2.imgbox.com/f6/e9/nslIwHwH_o.png" width="771"></p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/12/5b/wfINLsNa_o.png" width="848"></p> 
<p><img alt="" height="613" src="https://images2.imgbox.com/15/c8/emAhiqcW_o.png" width="913"></p> 
<p><img alt="" height="610" src="https://images2.imgbox.com/cf/f1/Y3eEktvP_o.png" width="952"></p> 
<p>等待完成后即可在openwebui中顶部中间位置选择模型。然后创建聊天即可完成。</p> 
<h2><strong>第六步：微调自己喜欢的模型。</strong></h2> 
<p>如果你的电脑性能不够（又想试一下怎么微调模型），可以白嫖google的colab进行训练。接下来就教大家怎么用colab训练llama3.</p> 
<p>一、准备工作</p> 
<p>1. 访问Unsloth</p> 
<p>Unsloth是由Daniel Han 和 Michael Han 创建，并迅速成为为完善大型语言模型（LLM）微调过程而量身定制的优化框架。Unsloth 以其敏捷性和内存效率而闻名，其训练速度可提高 30 倍，内存使用量显著减少 60%。</p> 
<p>访问Unsloth的GitHub地址：https://github.com/unslothai/unsloth，点击”▶️Start on Colab””即可打开Colab训练脚本。</p> 
<p></p> 
<p><img alt="" height="841" src="https://images2.imgbox.com/11/33/AnArOHkI_o.png" width="987"></p> 
<p> 点击后即可跳转到colab中，界面如下：</p> 
<p><img alt="" height="616" src="https://images2.imgbox.com/b1/4c/oSjm1a95_o.png" width="1200"></p> 
<p></p> 
<p>2. 连接T4 GPU</p> 
<p>你可以免费使用Google提供的GPU资源，选择连接T4。当连接成功后，就可以开始了。</p> 
<p></p> 
<p class="img-center"><img alt="" height="660" src="https://images2.imgbox.com/8f/aa/QqRha8D2_o.png" width="1024"></p> 
<p>你可以在弹框中选择T4 GPU。</p> 
<p class="img-center"><img alt="" height="553" src="https://images2.imgbox.com/25/02/jYiJ8SlX_o.png" width="709"></p> 
<p>当链接成功后，开始咱们的微调吧！</p> 
<p>点击运行，这段代码主要是安装Unsloth和模型训练相关的必要库。</p> 
<p class="img-center"><img alt="" height="360" src="https://images2.imgbox.com/38/05/IKTFrRFw_o.png" width="1080"></p> 
<p>展示执行时间表示已经执行过了。</p> 
<p></p> 
<p class="img-center"><img alt="" height="143" src="https://images2.imgbox.com/92/f9/3sXLVDwQ_o.png" width="288"></p> 
<p>二、步入正题</p> 
<p>按照步骤执行（不会出错）</p> 
<p><img alt="" height="863" src="https://images2.imgbox.com/52/42/eDqRBPVZ_o.png" width="976"></p> 
<p>如果你有抱脸账号，最后可以将训练出来的guuf文件上传到自己的抱脸model空间中。</p> 
<p><strong>微调注意事项：</strong></p> 
<p>1、Data Prep步骤中的数据集可以更换成自己的知识库。知识库需要整理成json格式文件，另外，如果你想更换成自己DataSet可以将其整理好后上传huggingface，并更换DataSet数据集的地址。</p> 
<p>原训练地址：<span style="background-color:#ffd900;">yahma/alpaca-cleaned</span></p> 
<p>dataset = load_dataset("<span style="background-color:#ffd900;">yahma/alpaca-cleaned</span>", split = "train")</p> 
<p>知识库json文件格式如下：instruction：指令 ，input：输入，output：输出</p> 
<p></p> 
<p><img alt="" height="195" src="https://images2.imgbox.com/94/2b/Zm4bDMhA_o.png" width="455"></p> 
<p>上传后huggingface数据预览：</p> 
<p><img alt="" height="561" src="https://images2.imgbox.com/7c/da/RntzXp6o_o.png" width="1004"></p> 
<p>2、Saving to float16 for VLLM  这一步可以不用执行。</p> 
<p>3、保存最终guuf注意事项，需要将本地和huggingface的保存代码变更为：True。</p> 
<p></p> 
<p>上传到<img alt="" height="577" src="https://images2.imgbox.com/01/69/IDwOMhKJ_o.jpg" width="1057">huggingface，需要更换用户名/模型（hf/model）为自己的模型空间，然后添加token。</p> 
<p>token获取：</p> 
<p><img alt="" height="714" src="https://images2.imgbox.com/bb/c0/iGQCKNiE_o.png" width="1031"></p> 
<p>完成后（本地保存）请到左侧文件夹按钮操作你的guuf文件并下载到自己电脑，</p> 
<p>（huggingface保存）即可到自己的 huggingface  model空间下载到自己电脑。</p> 
<p>最后就是下载自己训练好的模型进行使用（可以百度ollama 加载guuf文件）。</p> 
<p>如果不知道怎么用openwebui使用guuf模型，请将下载好的文件放到一个文件夹。</p> 
<p>创建modelfile文件，没有后缀，文件中编写如下：</p> 
<p>FROM ./Llama3-8B-Chinese-Chat.Q4_K_M.gguf<br> TEMPLATE """{<!-- -->{ if .System }}&lt;|start_header_id|&gt;system&lt;|end_header_id|&gt;</p> 
<p>{<!-- -->{ .System }}&lt;|eot_id|&gt;{<!-- -->{ end }}{<!-- -->{ if .Prompt }}&lt;|start_header_id|&gt;user&lt;|end_header_id|&gt;</p> 
<p>{<!-- -->{ .Prompt }}&lt;|eot_id|&gt;{<!-- -->{ end }}&lt;|start_header_id|&gt;assistant&lt;|end_header_id|&gt;</p> 
<p>{<!-- -->{ .Response }}&lt;|eot_id|&gt;"""<br> PARAMETER stop "&lt;|start_header_id|&gt;"<br> PARAMETER stop "&lt;|end_header_id|&gt;"<br> PARAMETER stop "&lt;|eot_id|&gt;"<br> PARAMETER stop "&lt;|reserved_special_token"</p> 
<p>其中的：Llama3-8B-Chinese-Chat.Q4_K_M.gguf，改成自己的模型名称。</p> 
<p><img alt="" height="476" src="https://images2.imgbox.com/71/11/yd8KCogK_o.png" width="732"></p> 
<p>最后使用ollama进行加载和允许。方法：在此文件夹CMD，输入：</p> 
<p style="margin-left:0;"><span style="color:#191b1f;"><span style="background-color:#f8f8fa;">ollama create </span><span style="background-color:#ff9900;">llama3:8b</span> <span style="background-color:#f8f8fa;">-f Modelfile </span></span></p> 
<p style="margin-left:0;"><span style="color:#191b1f;"><span style="background-color:#f8f8fa;">ollama run </span><span style="background-color:#ff9900;">llama3:8b</span></span></p> 
<p style="margin-left:0;"><span style="color:#191b1f;"><span style="background-color:#ff9900;">（黄色为名字，可以按照自己心情定：自己喜欢的花花草草、猫猫狗狗、人名都可以）</span></span></p> 
<p style="margin-left:0;"><span style="color:#191b1f;"><span style="background-color:#ff9900;">最后去openwebui里面选择自己的模型就可以愉快的玩耍咯。</span></span></p> 
<p></p> 
<p>如大家还有不清楚的，请留言，抽时间给大家解答。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e901d8ef0fa0514f9b52580387f3153/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[嵌入式AI从0开始到入土]17_Ascend C算子开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2977985b37155f85829c381cb4338f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">本地部署大模型ollama&#43;docker&#43;open WebUI/Lobe Chat</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>