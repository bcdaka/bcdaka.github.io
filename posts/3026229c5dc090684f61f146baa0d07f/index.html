<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【postgresql初级使用】数据库安全防护，核心数据是黑客的终极大boss，多层次建立安全体系 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3026229c5dc090684f61f146baa0d07f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【postgresql初级使用】数据库安全防护，核心数据是黑客的终极大boss，多层次建立安全体系">
  <meta property="og:description" content="数据库访问安全 ​专栏内容：
postgresql使用入门基础手写数据库toadb并发编程 个人主页：我的主页
管理社区：开源数据库
座右铭：天行健，君子以自强不息；地势坤，君子以厚德载物.
文章目录 数据库访问安全概述 安全体系 网络层 操作系统层 数据库层 存储层 总结 结尾 概述 数据库作维护着系统的全部核心数据，在黑客眼中，它就是终极大boss，需要我们精心呵护。
常常听到撞库，拖库，甚至于删库跑路等事件，我们在部署和维护数据库过程中如何防范这些风险呢？
本文介绍数据库访问安全保护的一些方式，结合postgresql 数据库中有一些安全功能，同时还需要配合操作系统，以及网络部署的一起达到数据库的安全。
安全体系 在postgresql 数据库中提供了一些安全功能，如基于主机的访问HBA，角色与权限，自主访问控制DAC等，这些远远达不到高枕无忧的程度。
对于单个数据库来讲，需要在网络层，操作系统层，数据库层，以及存储层等多个层次进行体系化的安全部署，才能有一个安全的数据库。
数据库的安全，我们从离客户最近的网络，然后到数据库服务器的操作系统，再到数据库服务，然后到数据的存储，这一路径来划分各阶段的安全策略与方法，构建一套安全体系。
网络层，是访问数据的通道；通过配置防火墙策略，限制对数据库服务器的访问；也可以通过代理服务器来进行复杂的过滤；操作系统层，数据库服务所有在操作系统也是多用户的，数据库服务部署采用专用用户，并且配置操作系统级的审计策略；数据库层，最核心的数据库服务层，通过数据库功能进行一些安全控制；如HBA，role, DAC, SSL等等；存储层，对于数据，可以进行各种策略的备份，并且对备份进行安全策略控制； 当然，这一体系只是对于单节点的数据来讲，当然还可以通过主备来对服务进行冗余，达到服务级的安全，这里并没有涉及到。
网络层 一般的大型数据库都通过网络来进行访问，同时一旦经过网络就会经常受到黑客的骚扰，为了限制不安全的网络流量，可以通过以下几种方式。
防火墙 在部署的时候首先会部署访火墙的策略，常用的如iptables，精细化的限制访问的IP范围，以及可以访问的协议。
监听端口与IP 对于postgresql 的服务端口号默认为5432，一般部署时避免使用默认端口。默认端口，如80，8080，22等等，每天都会被黑客不断扫描探测，根据端口号就可以猜测到服务类型。
如果有多个网卡或者网段时，限制数据库监听的网络或者网卡设备。
代理 为了减少数据库服务的管理，可以采用代理服务来处理，客户端请求先由代理服务接收进行精细的过滤，记录，对于通过审查的请求转发到数据库服务。
这样数据库服务可以处在一个相对封闭的网络环境中，只与代理服务进行单一通信，更多网络压力由代理服务进行处理。
操作系统层 数据库部署的机器，一般在安装时都会新建一个操作系统用户，如mysql, oracle，postgresql用户，在此用户下启动数据库服务。
那么在操作系统层面设置安全策略，可以保护数据库服务，以及数据库文件的安全。
操作系统用户与权限 数据库服务所在的操作系统用户，一定是非管理员(administrate/root)权限用户，同时要限制它的登陆，使用强的用户口令并定期更新。
同时平常的客户端使用，使用其它操作用户登陆。
目录与文件的访问权限 数据库的存储在磁盘的目录与文件，设置合适的权限和访问用户，比如Linux下要去掉other的访问权限，不能设置为 777 这种权限，这个在postgresql 中也会进行检查，当启动服务时为root用户时，会报错，当集群目录权限默认为 0600。
操作系统级的审计跟踪 对于像mysql/oracle/postgresql用户的操作，都要进行严格的审计，记录操作，定期检查，当然这些操作可以借助于审计系统软件，进行自动化的运行，可视化展示与自动风险报警。
数据库层 当我们的各种应用连到数据库中时，可以进行select/insert/update/delete操作，也可以进行create/drop/alter，都可以进行这些操作时，就会乱套。
在数据库中有一些精细的控制方法，来划分不同数据库对象的访问权限，来抽象人的管理模式。
基于主机的访问控制 在pg_hba.conf文件可以配置不同的应用访问对应的数据库，甚至访问主机对应的数据库用户，以及不同的用户鉴权方法。
hba配置可以更加精细的化分数据库和用户的功能，与应用系统进行对应。
角色与权限 在postgresql中的数据库对象，它有很多权限可以设置，如创建，删除，数据的查询，数据修改，数据删除，数据插入等。
通过角色role与对角权限进行管理，将相关权限打包为角色，也就是权限的集合，再统一grant给一类用户。
自主访问控制策略 自主访问控制策略DAC，就是通过数据库对角上的权限，与数据库用户所拥有的权限，在用户访问数据对象时进行校验，类型似门禁一样，只有用户拥有访问权限才会执行操作，否则会失败。
权限的管理由超级用户postgres和拥有admin权限的用户进行初始创建，后面可以通过owner进行扩展和传播，当然也可以限制权限的继承传播。
传输层加密 TSL/SSL 在postgresql 中可以配置传输层的通信加密，在服务端和客户端配置 SSL证书，通过TSL来验证服务和加解密通信数据。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-29T13:40:44+08:00">
    <meta property="article:modified_time" content="2024-06-29T13:40:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【postgresql初级使用】数据库安全防护，核心数据是黑客的终极大boss，多层次建立安全体系</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>数据库访问安全</h2> 
<blockquote> 
 <p>​<strong>专栏内容</strong>：</p> 
 <ul><li><a href="https://blog.csdn.net/senllang/category_12346885.html">postgresql使用入门基础</a></li><li><a href="https://senllang.blog.csdn.net/category_12338586.html" rel="nofollow">手写数据库toadb</a></li><li><a href="https://blog.csdn.net/senllang/category_12265530.html">并发编程</a></li></ul> 
</blockquote> 
<blockquote> 
 <p><strong>个人主页</strong>：<a href="https://senllang.blog.csdn.net" rel="nofollow">我的主页</a><br> <strong>管理社区</strong>：<a href="https://bbs.csdn.net/forums/a0a6ea788b3949b6a06ab4811f9eec5d">开源数据库</a><br> <strong>座右铭：天行健，君子以自强不息；地势坤，君子以厚德载物.</strong></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">数据库访问安全</a></li><li><a href="#font_colorA0522D_font_14" rel="nofollow"><font color="#A0522D">概述 </font></a></li><li><a href="#font_colorA0522D_font_23" rel="nofollow"><font color="#A0522D">安全体系 </font></a></li><li><a href="#font_colorA0522D__font_42" rel="nofollow"><font color="#A0522D"> 网络层 </font></a></li><li><a href="#font_colorA0522D__font_63" rel="nofollow"><font color="#A0522D"> 操作系统层 </font></a></li><li><a href="#font_colorA0522D__font_84" rel="nofollow"><font color="#A0522D"> 数据库层 </font></a></li><li><a href="#font_colorA0522D__font_121" rel="nofollow"><font color="#A0522D"> 存储层 </font></a></li><li><a href="#font_colorA0522D_font_146" rel="nofollow"><font color="#A0522D">总结 </font></a></li><li><a href="#font_colorA0522D_font_154" rel="nofollow"><font color="#A0522D">结尾 </font></a></li></ul> 
</div> 
<p></p> 
<h2><a id="font_colorA0522D_font_14"></a><font color="#A0522D">概述 </font></h2> 
<hr> 
<p>数据库作维护着系统的全部核心数据，在黑客眼中，它就是终极大boss，需要我们精心呵护。</p> 
<p>常常听到撞库，拖库，甚至于删库跑路等事件，我们在部署和维护数据库过程中如何防范这些风险呢？</p> 
<p>本文介绍数据库访问安全保护的一些方式，结合postgresql 数据库中有一些安全功能，同时还需要配合操作系统，以及网络部署的一起达到数据库的安全。</p> 
<h2><a id="font_colorA0522D_font_23"></a><font color="#A0522D">安全体系 </font></h2> 
<hr> 
<p>在postgresql 数据库中提供了一些安全功能，如基于主机的访问HBA，角色与权限，自主访问控制DAC等，这些远远达不到高枕无忧的程度。</p> 
<p>对于单个数据库来讲，需要在网络层，操作系统层，数据库层，以及存储层等多个层次进行体系化的安全部署，才能有一个安全的数据库。</p> 
<p><img src="https://images2.imgbox.com/86/c0/GSDSOrOf_o.png" alt="在这里插入图片描述"></p> 
<p>数据库的安全，我们从离客户最近的网络，然后到数据库服务器的操作系统，再到数据库服务，然后到数据的存储，这一路径来划分各阶段的安全策略与方法，构建一套安全体系。</p> 
<ul><li>网络层，是访问数据的通道；通过配置防火墙策略，限制对数据库服务器的访问；也可以通过代理服务器来进行复杂的过滤；</li><li>操作系统层，数据库服务所有在操作系统也是多用户的，数据库服务部署采用专用用户，并且配置操作系统级的审计策略；</li><li>数据库层，最核心的数据库服务层，通过数据库功能进行一些安全控制；如HBA，role, DAC, SSL等等；</li><li>存储层，对于数据，可以进行各种策略的备份，并且对备份进行安全策略控制；</li></ul> 
<p>当然，这一体系只是对于单节点的数据来讲，当然还可以通过主备来对服务进行冗余，达到服务级的安全，这里并没有涉及到。</p> 
<h2><a id="font_colorA0522D__font_42"></a><font color="#A0522D"> 网络层 </font></h2> 
<hr> 
<p>一般的大型数据库都通过网络来进行访问，同时一旦经过网络就会经常受到黑客的骚扰，为了限制不安全的网络流量，可以通过以下几种方式。</p> 
<ul><li>防火墙</li></ul> 
<p>在部署的时候首先会部署访火墙的策略，常用的如iptables，精细化的限制访问的IP范围，以及可以访问的协议。</p> 
<ul><li>监听端口与IP</li></ul> 
<p>对于postgresql 的服务端口号默认为5432，一般部署时避免使用默认端口。默认端口，如80，8080，22等等，每天都会被黑客不断扫描探测，根据端口号就可以猜测到服务类型。</p> 
<p>如果有多个网卡或者网段时，限制数据库监听的网络或者网卡设备。</p> 
<ul><li>代理</li></ul> 
<p>为了减少数据库服务的管理，可以采用代理服务来处理，客户端请求先由代理服务接收进行精细的过滤，记录，对于通过审查的请求转发到数据库服务。</p> 
<p>这样数据库服务可以处在一个相对封闭的网络环境中，只与代理服务进行单一通信，更多网络压力由代理服务进行处理。</p> 
<h2><a id="font_colorA0522D__font_63"></a><font color="#A0522D"> 操作系统层 </font></h2> 
<hr> 
<p>数据库部署的机器，一般在安装时都会新建一个操作系统用户，如mysql, oracle，postgresql用户，在此用户下启动数据库服务。</p> 
<p>那么在操作系统层面设置安全策略，可以保护数据库服务，以及数据库文件的安全。</p> 
<ul><li>操作系统用户与权限</li></ul> 
<p>数据库服务所在的操作系统用户，一定是非管理员(administrate/root)权限用户，同时要限制它的登陆，使用强的用户口令并定期更新。</p> 
<p>同时平常的客户端使用，使用其它操作用户登陆。</p> 
<ul><li>目录与文件的访问权限</li></ul> 
<p>数据库的存储在磁盘的目录与文件，设置合适的权限和访问用户，比如Linux下要去掉other的访问权限，不能设置为 777 这种权限，这个在postgresql 中也会进行检查，当启动服务时为root用户时，会报错，当集群目录权限默认为 0600。</p> 
<ul><li>操作系统级的审计跟踪</li></ul> 
<p>对于像mysql/oracle/postgresql用户的操作，都要进行严格的审计，记录操作，定期检查，当然这些操作可以借助于审计系统软件，进行自动化的运行，可视化展示与自动风险报警。</p> 
<h2><a id="font_colorA0522D__font_84"></a><font color="#A0522D"> 数据库层 </font></h2> 
<hr> 
<p>当我们的各种应用连到数据库中时，可以进行select/insert/update/delete操作，也可以进行create/drop/alter，都可以进行这些操作时，就会乱套。</p> 
<p>在数据库中有一些精细的控制方法，来划分不同数据库对象的访问权限，来抽象人的管理模式。</p> 
<ul><li>基于主机的访问控制</li></ul> 
<p>在pg_hba.conf文件可以配置不同的应用访问对应的数据库，甚至访问主机对应的数据库用户，以及不同的用户鉴权方法。</p> 
<p>hba配置可以更加精细的化分数据库和用户的功能，与应用系统进行对应。</p> 
<ul><li>角色与权限</li></ul> 
<p>在postgresql中的数据库对象，它有很多权限可以设置，如创建，删除，数据的查询，数据修改，数据删除，数据插入等。</p> 
<p>通过角色role与对角权限进行管理，将相关权限打包为角色，也就是权限的集合，再统一grant给一类用户。</p> 
<ul><li>自主访问控制策略</li></ul> 
<p>自主访问控制策略DAC，就是通过数据库对角上的权限，与数据库用户所拥有的权限，在用户访问数据对象时进行校验，类型似门禁一样，只有用户拥有访问权限才会执行操作，否则会失败。</p> 
<p>权限的管理由超级用户postgres和拥有admin权限的用户进行初始创建，后面可以通过owner进行扩展和传播，当然也可以限制权限的继承传播。</p> 
<ul><li>传输层加密 TSL/SSL</li></ul> 
<p>在postgresql 中可以配置传输层的通信加密，在服务端和客户端配置 SSL证书，通过TSL来验证服务和加解密通信数据。</p> 
<ul><li>数据的加密</li></ul> 
<p>通常存储在磁盘的数据是明文，丢失很容易被解析出来。通过postgresql中内置的加密接口，对敏感的数据列进行加密存储，提供了常用的加密算法。</p> 
<ul><li>数据库的审计</li></ul> 
<p>以上都是静态的防护策略，在数据库服务运行过程中，需要时刻关注它的运行状态，谁访问过那些数据等，这就需要数据库审计系统的配套，记录访问路径，并对记录进行分析，及时识别风险主动报警或者阻断。</p> 
<h2><a id="font_colorA0522D__font_121"></a><font color="#A0522D"> 存储层 </font></h2> 
<hr> 
<p>鸡蛋不能放在一个篮子里，同样数据不能只有一份。在postgresql 中提供了多种备份方式，在备份的基础上可以对备份进行安全控制。</p> 
<ul><li>备份</li></ul> 
<p>在postgresql 中有基于流复制备份，还有基于逻辑复制的备份，还有数据导出方式的备份。</p> 
<p>当然也可以将这些方式组合使用，生成最新的全量数据备份，也可以是某个时间点的数据，然后定期进行备份，这样可以产生一系列的数据备份，同时定期归档很早之前的备份版本。</p> 
<ul><li>WAL归档</li></ul> 
<p>在postgresql数据一致性最重要的一环是WAL，当然也可以通过对WAL归档来进行数据的备份，因为通过WAL可以恢复出来当前的数据。</p> 
<ul><li>备份的加密</li></ul> 
<p>对于敏感数据的备份，同样可以选择加密，并且口令强度检查，口令定期更新。</p> 
<ul><li>备份文件隔离与访问控制</li></ul> 
<p>很多时间，我们备份的数据文件与原数据在一台机器上，这其实也是不安全的，会有同时损坏的概率。</p> 
<p>一般多份备可以放到不同的区域，这个区域是不同的机器，甚至不同的机房，地区，达到物理上的隔离。</p> 
<h2><a id="font_colorA0522D_font_146"></a><font color="#A0522D">总结 </font></h2> 
<hr> 
<p>数据库处于应用的底层，因为它存储着最核心的数据，所以它安全被渐渐重视了起来。 数据库本身的安全，并不是完全靠数据库自身来独立完成，它需要从网络，操作系统，数据库，存储等多个维度采用综合的策略来防护。</p> 
<p>同时也需要一些主动防御方式来检测和分析，如数据库审计，对数据库日志定期分析，它们也是数据库安全体系的一部分。</p> 
<p>本文结合postgresql数据库来分享了数据库安全的体系，让大家能了解数据库自身的策略所处的位置。</p> 
<h2><a id="font_colorA0522D_font_154"></a><font color="#A0522D">结尾 </font></h2> 
<hr> 
<blockquote> 
 <p><strong>非常感谢大家的支持，在浏览的同时别忘了留下您宝贵的评论，如果觉得值得鼓励，请点赞，收藏，我会更加努力！</strong></p> 
</blockquote> 
<p>作者邮箱：study@senllang.onaliyun.com<br> 如有错误或者疏漏欢迎指出，互相学习。</p> 
<p>注：未经同意，不得转载！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36144d4944313b2b3eed1081772ceef9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是BIOS，如何进入BIOS设置？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/583ecd37f41371f8169ea671e9785c2a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java八股面试文（带答案，万字总结，精心打磨，建议收藏）堪称2024最强</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>