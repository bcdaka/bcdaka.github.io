<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【DB2报错】执行存储过程报 SQLCODE:-104 SQLSTATE:42601 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9483592d7ee461a921a0f76ca5586bae/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【DB2报错】执行存储过程报 SQLCODE:-104 SQLSTATE:42601">
  <meta property="og:description" content="今天创建存储过程的时候碰到这个报错： AN unexpected tkoen &#34;END-OF-STATEMENT&#34; was found following &#34;COMMIT&#34;,Expected tokens may include:&#34;END IF&#34;..SQLSTATE:42601 SQLCODE:-104 不要慌！！遇事不决先翻译！！！
翻译：在“COMMIT”之后发现了一个异常的tkoen“END-OF-STATEMENT”，异常的tkoen 可能包括：“END IF”.SQL状态：-104 SQL代码：42601
报错解释 ：
原因分析：
处理方式：
情况一、
情况二、
报错解释 ： SQLCODE:-104 错误状态码，在 文本 后面找到异常 标记。预期标记可能包括： 标记列表。
SQLSTATE:42601 错误类代码，含义字符、标记或自居无效或丢失。
用户响应：在指定的标记区域内检查并更正语句。
原因分析： 根据提示找到问题语句所在地方，COMMIT后面也只是一个正常的 IF 判断结束和 存储过程结束而已，并没有什么异常。但是提示还另外补了一句unexpected tkoen &#34;END-OF-STATEMENT&#34; 结束出现了问题。
CREATE OR REPLACE PROCEDURE DROP_VIEW( IN V_NAME VARCHAR(100)) BEGIN DECLARE CNT_V INTEGER; DECLARE DROP_SQL VARCHAR(1000); SET CNT_V= (SELECT COUNT(1) FROM SYSCAT.VIEWS WHERE VIEWSCHEMA = TRIM(CURRENT_SCHEMA) AND VIEWNAME = V_NAME); IF CNT_V &lt;&gt; 0 THEN SET DROP_SQL = &#39;DROP VIEW &#39; || V_NAME; COMMIT; END IF; END; 处理方式： 情况一、 按照提示的话我们可以发现问题就出现在存储过程结束的位置，检查结束语句分隔符为“@”；">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-23T23:47:32+08:00">
    <meta property="article:modified_time" content="2024-04-23T23:47:32+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【DB2报错】执行存储过程报 SQLCODE:-104 SQLSTATE:42601</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E4%BB%8A%E5%A4%A9%E6%B5%8B%E8%AF%95%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E7%9A%84%E6%97%B6%E5%80%99%E7%A2%B0%E5%88%B0%E8%BF%99%E4%B8%AA%E6%8A%A5%E9%94%99%EF%BC%9A">今天创建存储过程的时候碰到这个报错：</h2> 
<h2 id="SQL0668N%C2%A0%20Operation%20not%20allowed%20for%20reason%20code%20%223%22%20on%20table%20%22CALSS_STUDENT%22.%C2%A0%20SQLSTATE%3D57016.">AN unexpected tkoen "END-OF-STATEMENT" was found following "COMMIT",Expected tokens may include:"END IF"..SQLSTATE:42601 SQLCODE:-104</h2> 
<p><span style="color:#1c7331;"><strong><em>不要慌！！遇事不决先翻译！！！</em></strong></span></p> 
<p>翻译：在“COMMIT”之后发现了一个异常的tkoen“END-OF-STATEMENT”，异常的tkoen 可能包括：“END IF”.SQL状态：-104 SQL代码：42601</p> 
<p id="%E6%8A%A5%E9%94%99%E8%A7%A3%E9%87%8A%EF%BC%9A-toc"><strong><a href="#%E6%8A%A5%E9%94%99%E8%A7%A3%E9%87%8A%EF%BC%9A" rel="nofollow">报错解释 ：</a></strong></p> 
<p id="%E5%8E%9F%E5%9B%A0%E5%87%BA%E5%A4%84%EF%BC%9A-toc"><strong><a href="#%E5%8E%9F%E5%9B%A0%E5%87%BA%E5%A4%84%EF%BC%9A" rel="nofollow">原因分析：</a></strong></p> 
<p id="%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9A-toc"><strong><a href="#%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9A" rel="nofollow">处理方式：</a></strong></p> 
<p id="%E6%83%85%E5%86%B5%E4%B8%80%E3%80%81-toc"><strong><a href="#%E6%83%85%E5%86%B5%E4%B8%80%E3%80%81" rel="nofollow">情况一、</a></strong></p> 
<p id="%E6%83%85%E5%86%B5%E4%BA%8C%E3%80%81-toc"><strong><a href="#%E6%83%85%E5%86%B5%E4%BA%8C%E3%80%81" rel="nofollow">情况二、</a></strong></p> 
<p id="%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9A-toc"></p> 
<hr id="hr-toc"> 
<h3 id="%E6%8A%A5%E9%94%99%E8%A7%A3%E9%87%8A%EF%BC%9A"><strong><em>报错解释 ：</em></strong></h3> 
<p><strong>SQLCODE:-104  </strong><u> 错误状态码，在 <strong><em>文本 </em></strong>后面找到异常 <strong><em>标记</em></strong>。预期标记可能包括： <strong><em>标记列表</em></strong>。</u></p> 
<p><strong>SQLSTATE:</strong>42601 <u>错误类代码，含义字符、标记或自居无效或丢失。</u></p> 
<p>用户响应：<u>在指定的标记区域内检查并更正语句。</u></p> 
<hr> 
<h3 id="%E5%8E%9F%E5%9B%A0%E5%87%BA%E5%A4%84%EF%BC%9A"><em><strong>原因分析：</strong></em></h3> 
<p>根据提示找到问题语句所在地方，COMMIT后面也只是一个正常的 IF 判断结束和 存储过程结束而已，并没有什么异常。但是提示还另外补了一句unexpected tkoen "END-OF-STATEMENT" 结束出现了问题。</p> 
<pre><code class="language-sql">CREATE OR REPLACE PROCEDURE DROP_VIEW(
  IN V_NAME VARCHAR(100))
BEGIN
 DECLARE CNT_V INTEGER;
 DECLARE DROP_SQL VARCHAR(1000);

SET CNT_V= (SELECT COUNT(1) FROM SYSCAT.VIEWS WHERE VIEWSCHEMA = TRIM(CURRENT_SCHEMA) AND VIEWNAME = V_NAME);
IF CNT_V &lt;&gt; 0 THEN
SET DROP_SQL = 'DROP VIEW ' || V_NAME;
COMMIT;
END IF;

END;</code></pre> 
<hr> 
<h3 id="%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F%EF%BC%9A"><em><strong>处理方式：</strong></em></h3> 
<h4 id="%E6%83%85%E5%86%B5%E4%B8%80%E3%80%81"><strong><em>情况一、</em></strong></h4> 
<p>按照提示的话我们可以发现问题就出现在存储过程结束的位置，检查结束语句分隔符为“@”；</p> 
<p>先进行一波检查  DBeaver 客户端 工具栏 中 【窗口】--&gt;&gt;【首选项】 找到设置语句分隔符的窗口。<br><img alt="" src="https://images2.imgbox.com/e6/04/vmdRowAJ_o.png"></p> 
<p> 基于第一种情况如果正常存储过程的内容没有任何语法问题，应用并关闭后是可以执行成功的。</p> 
<blockquote> 
 <p>ps：因为这次我执行创建存储过程实在DBeaver上，底层对应的DB2数据库是基于Linux环境部署的，所以它接受的存储过程 结束语句分隔符为“@” 而并不是常见的 结束语句分隔符“；”。</p> 
</blockquote> 
<hr> 
<h4 id="%E6%83%85%E5%86%B5%E4%BA%8C%E3%80%81"><strong><em>情况二、</em></strong></h4> 
<p>明明已经按照 <em><strong>情况一</strong></em> 的步骤改好了语句分隔符，为什么还是会报SQLSTATE:42601 SQLCODE:-104呢？！主要原因有如下：</p> 
<blockquote> 
 <ol><li>根据提示查看出现报错的位置是否有语法错误。一般存储过程是从上往下执行的。如果有重复的 <strong><em>字眼</em></strong> ，看第一个出现该 <strong><em>字眼</em></strong> 的位置就好了。</li><li>多个 IF 条件或者其他循环体中 漏了 END IF；有时候 IF 一层套一层的很容易少了的。</li><li>SET = ........ 句式后面忘记添加 “；” 作为结束了。因为存储过程中基本每一句后面都要加 “；”，出了 IF.....THEN 还有循环 那些开头外。</li></ol> 
</blockquote> 
<hr> 
<p>其他<strong>报错 </strong>的原因码以及其他报错的错误状态码可以在下面 IBM 的链接查看。</p> 
<p>👇👇👇👇👇👇👇👇👇👇👇<br><a href="https://www.ibm.com/docs/en/db2/11.1?topic=messages-sql0500-sql0749#sql0668n" rel="nofollow" title="SQL0500 - SQL0749 - IBM Documentationhttps://www.ibm.com/docs/en/db2/11.1?topic=messages-sql0500-sql0749#sql0668n">SQL0500 - SQL0749 - IBM Documentationhttps://www.ibm.com/docs/en/db2/11.1?topic=messages-sql0500-sql0749#sql0668n</a>有需要文档的同学也可以私信我~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/595c5adaca72c979c5c6114f9fe3a58c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">nohup java -jar 启动java项目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e9dbe4b8141a209a11215369f2c90da9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">web大鱼海棠主题网页(6页)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>