<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python pandas处理股票量化数据：笔记1 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0bdba70eb6871f67e0a7576b76005d67/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python pandas处理股票量化数据：笔记1">
  <meta property="og:description" content="1、安装python和tushare及相关库 matplotlib
pyplot
pandas
pandas_datareader
&gt;&gt;&gt; import matplotlib.pyplot as plt
&gt;&gt;&gt; import pandas as pd
&gt;&gt;&gt; import datetime as dt
&gt;&gt;&gt; import pandas_datareader.data as web
失败的尝试yfinance和pandas_datareader &gt;&gt;&gt; start = dt.datetime(2024, 1, 1)
end = dt.datetime(2024, 6, 1)
&gt;&gt;&gt; stock = web.DataReader(&#39;AAPL&#39;, &#39;yahoo&#39;, start, end)
&gt;&gt;&gt; stock = web.DataReader(&#39;600797.SS&#39;, &#39;yahoo&#39;, start, end)
Traceback (most recent call last):
File &#34;&lt;pyshell&gt;&#34;, line 1, in &lt;module&gt;
&gt;&gt;&gt; import yfinance as yf
&gt;&gt;&gt; symbol = &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-15T22:47:47+08:00">
    <meta property="article:modified_time" content="2024-07-15T22:47:47+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python pandas处理股票量化数据：笔记1</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1、安装python和tushare及相关库</h2> 
<p>matplotlib</p> 
<p>pyplot</p> 
<p>pandas</p> 
<p>pandas_datareader</p> 
<p></p> 
<p>&gt;&gt;&gt; import matplotlib.pyplot as plt<br> &gt;&gt;&gt; import pandas as pd</p> 
<p>&gt;&gt;&gt; import datetime as dt</p> 
<p>&gt;&gt;&gt; import pandas_datareader.data as web</p> 
<h3>失败的尝试yfinance和pandas_datareader</h3> 
<p>&gt;&gt;&gt; start = dt.datetime(2024, 1, 1)<br> end = dt.datetime(2024, 6, 1)<br> &gt;&gt;&gt; stock = web.DataReader('AAPL', 'yahoo', start, end)</p> 
<p><span style="color:#fe2c24;">&gt;&gt;&gt; stock = web.DataReader('600797.SS', 'yahoo', start, end)</span><br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;</p> 
<p>&gt;&gt;&gt; import yfinance as yf<br> &gt;&gt;&gt; symbol = "600519.SS"<br> start_date = "2022-01-01"<br> end_date = "2023-01-01"<br><span style="color:#fe2c24;">&gt;&gt;&gt; data = yf.download(symbol, start=start_date, end=end_date)</span><br> Failed to get ticker '600519.SS' reason: Expecting value: line 1 column 1 (char 0)<br> [*********************100%%**********************]  1 of 1 completed</p> 
<p>1 Failed download:<br> ['600519.SS']: YFTzMissingError('$%ticker%: possibly delisted; No timezone found')<br> &gt;&gt;&gt; print(data.head())<br> Empty DataFrame<br> Columns: [Open, High, Low, Close, Adj Close, Volume]<br> Index: []</p> 
<p>可能因为yahoo不再提供内地服务导致下载数据失败。</p> 
<p><img alt="" height="112" src="https://images2.imgbox.com/10/fd/eHCSbplJ_o.png" width="612"></p> 
<h3>安装库tushare</h3> 
<p>（tushare网站复制）<span style="color:#d7d8d9;">Python pandas包在金融量化分析中体现出的优势，Tushare返回的绝大部分的数据格式都是pandas DataFrame类型，非常便于用pandas/NumPy/Matplotlib进行数据分析和可视化。当然，如果您习惯了用Excel或者关系型数据库做分析，您也可以通过Tushare的数据存储功能，将数据全部保存到本地后进行分析.</span></p> 
<p>&gt;&gt;&gt; import tushare</p> 
<p>&gt;&gt;&gt; print (tushare.__version__)<br> 1.4.6<br> &gt;&gt;&gt; tushare.set_token('f9069ca5e3931347503e81967e161590b3c3859e8cba31e94da1f517')<br> &gt;&gt;&gt; data = pro.stock_basic()<br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;<br>   File "C:\Program Files\Thonny\lib\site-packages\tushare\pro\client.py", line 44, in query<br>     raise Exception(result['msg'])<br> Exception: 抱歉，您输入的TOKEN无效！<br> &gt;&gt;&gt; pro = tushare.pro_api()<br> &gt;&gt;&gt; data = pro.stock_basic()<br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;<br>   File "C:\Program Files\Thonny\lib\site-packages\tushare\pro\client.py", line 44, in query<br>     raise Exception(result['msg'])<br> Exception: 抱歉，您没有访问该接口的权限，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。<br> &gt;&gt;&gt; </p> 
<p>TOKEN登陆网站以后可以从tushare注册用户个人主页用户TOKEN获取</p> 
<p><span style="color:#fe2c24;">TOKEN无效</span></p> 
<h3 id="关于权限">没有权限</h3> 
<p><span style="color:#d7d8d9;"><em>为了避免部分用户低门槛无限制的恶意调取数据，更好地保证大多数用户调取数据的稳定性，同时也为了Tushare社区的可持续发展，Pro接口开始引入积分制度。只有具备一定积分级别的用户才能调取相应的API，目前只是一个分级门槛，并不消耗积分。以下只是基础积分权限，积分越多频次（每分钟调取API的次数）越高，除分钟数据和特色数据外5000以上具有相对较高的频次。</em></span></p> 
<p>看了下我才有100分，根据网站信息Pro接口之前的开源社区接口不再提供，要使用Pro2.0数据接口最低需要120，分不够啊，不能下载数据。要获得数据简单方法是直接冲值200可以获得2000分，或者推荐新的注册用户，每个有效用户可以得到50积分，如下摘自tushare网站：</p> 
<p><span style="color:#cccccc;"><em><strong>https://tushare.pro/register?reg=671815</strong> 分享此链接，成功注册一个有效用户(指真正会使用tushare数据的用户)可获得50积分，虚假用户带来的积分会被定期回收！</em></span></p> 
<p>有没有感兴趣的大神用下我的推荐链接注册一下？<strong><span style="color:#fe2c24;">https://tushare.pro/register?reg=671815</span></strong></p> 
<p><span style="color:#0d0016;">但是根据规则这个要求很难啊，必须是推荐的用户真正使用数据才可以获得50积分，可是推荐的用户积分不够不能下载数据啊，除非刚好有个大佬愿意花200块钱给自己冲值，不然你永远也不能获得推荐积分。只能自己花钱冲值才能使用数据，果然没有免费的午餐。</span></p> 
<p><span style="color:#0d0016;">可是我愿意花200给自己冲值吗？本来打算白嫖的。</span></p> 
<h2>2、日线数据下载权限</h2> 
<p>修改完善个人注册信息可以获得20积分，所以现在有使用数据接口的日线数据权限了，加油。</p> 
<p>&gt;&gt;&gt; data = pro.stock_basic()<br> &gt;&gt;&gt; print(data.head())<br>      ts_code  symbol   name  ... list_date            act_name act_ent_type<br> 0  000001.SZ  000001   平安银行  ...  19910403              无实际控制人            无<br> 1  000002.SZ  000002    万科A  ...  19910129  深圳市人民政府国有资产监督管理委员会         地方国企<br> 2  000004.SZ  000004   国华网安  ...  19910114                 李映彤         民营企业<br> 3  000006.SZ  000006   深振业A  ...  19920427  深圳市人民政府国有资产监督管理委员会         地方国企<br> 4  000007.SZ  000007  *ST全新  ...  19920413                 王玩虹         民营企业</p> 
<p>[5 rows x 10 columns]<br> &gt;&gt;&gt; </p> 
<p>有没有感兴趣的大神用下我的推荐链接注册一下？<strong><span style="color:#fe2c24;">https://tushare.pro/register?reg=671815</span></strong></p> 
<p><span style="color:#0d0016;"><strong>还是积分不够啊，每小时最多访问该接口1次</strong></span></p> 
<pre><code>pro = ts.pro_api()

#查询当前所有正常上市交易的股票列表

data = pro.stock_basic(exchange='', list_status='L', fields='ts_code,symbol,name,area,industry,list_date')

#查询当前所有正常上市交易的股票列表

data = pro.query('stock_basic', exchange='', list_status='L', fields='ts_code,symbol,name,area,industry,list_date')

#指定数据字段
data = pro.stock_basic(fields='ts_code,symbol,name,area,industry,list_date,market,is_hs,list_status,exchange,delist_date,curr_type')
 </code></pre> 
<p><span style="color:#0d0016;"><strong>&gt;&gt;&gt; data = pro.stock_basic(exchange='', list_status='L', fields='ts_code,symbol,name,area,industry,list_date')<br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;<br>   File "C:\Program Files\Thonny\lib\site-packages\tushare\pro\client.py", line 44, in query<br>     raise Exception(result['msg'])<br> Exception: 抱歉，您每小时最多访问该接口1次，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。<br> &gt;&gt;&gt; </strong></span></p> 
<p></p> 
<p><span style="color:#0d0016;">0615更新</span></p> 
<p><span style="color:#0d0016;">有大佬用了我的推荐连接现在我有170积分,访问数据还是受到限制,如果有办法一次性下载数据到本地保存可以后面用来进一步的处理.不过现在还在学习这个pro接口api的用法，暂时没有成功下载到完整数据。</span></p> 
<p></p> 
<p><span style="color:#0d0016;">&gt;&gt;&gt; import tushare</span></p> 
<p><span style="color:#0d0016;">print (tushare.__version__)<br> tushare.set_token('f9069ca5e3931347503e81967e161590b3c3859e8cba31e94da1f517')<br> pro = tushare.pro_api()<br> 1.4.6<br> &gt;&gt;&gt; data = pro.query('stock_basic', exchange='', list_status='L', fields='ts_code,symbol,name,area,industry,list_date')<br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;<br>   File "C:\Program Files\Thonny\lib\site-packages\tushare\pro\client.py", line 44, in query<br>     raise Exception(result['msg'])<br> Exception: 抱歉，您每小时最多访问该接口1次，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。<br><br> &gt;&gt;&gt; data = pro.stock_basic(fields='ts_code,symbol,name,area,industry,list_date,market,is_hs,list_status,exchange,delist_date,curr_type')<br> Traceback (most recent call last):<br>   File "&lt;pyshell&gt;", line 1, in &lt;module&gt;<br>   File "C:\Program Files\Thonny\lib\site-packages\tushare\pro\client.py", line 44, in query<br>     raise Exception(result['msg'])<br> Exception: 抱歉，您每分钟最多访问该接口1次，权限的具体详情访问：https://tushare.pro/document/1?doc_id=108。<br> &gt;&gt;&gt; </span></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/153a7656ff1080f1f0634883ceda3be1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">相交链表&#43;判断环型链表&#43;求环型链表的入口节点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72d9657ca4164242b37fdc719004407b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Keepalived实现双机热备(虚拟漂移IP地址)详细介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>