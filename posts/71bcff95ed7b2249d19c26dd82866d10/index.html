<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Python脚本】Python自动大麦网抢票，准点原价秒杀演唱会门票，拒绝黄牛交易！从我做起！！！1 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/71bcff95ed7b2249d19c26dd82866d10/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Python脚本】Python自动大麦网抢票，准点原价秒杀演唱会门票，拒绝黄牛交易！从我做起！！！1">
  <meta property="og:description" content="文章目录 前言一、分析购票过程二、Selenium 模拟浏览器操作三、逆向工程：抢票接口总结 前言 你是否错过了周杰伦的票，最近又没抢到五月天的票，不要太难过，今晚有张学友的票，后天还有张杰的票，加油哦！
Python配套案例源码、资料点击领取福利 为了帮助你在激烈的抢票竞争中获得更大的成功机会，本文将介绍抢票软件的实现原理以及我所了解的一些抢票方式。但是，请不要过度将希望寄托于抢票软件，它有时也不灵，经过我的验证，即使你用到了抢票软件，也不一定能抢到票。
票务平台会经常调整反爬策略打击爬虫行为，如果希望抢票软件保持较高的成功率，是需要开发者针对票务平台的打击策略作出逻辑调整，这个成本是很高的，所以你能随手获得的抢票软件很大概率是抢不到票的或者说是不安全的。
在调研过程发现一个有意思的点 “黄牛的票从来不是抢来的”。相关规定，面向市场公开销售的营业性演出门票数量，不得低于核准观众数量的70%。 而剩下的那 30%，即非公开销售的票，则是黄牛票的主要来源，也叫渠道票。这里面涉及主办方对热门票和冷门票的售票策略，黄牛在这链条中扮演着重要的角色，只要演唱会门票的二级市场不会消失，黄牛就永远不会消失，对于市场本身来说，愿意花更多钱买黄牛票的人，一定是更有需求的人，黄牛不过是市场调节的人格化。
一、分析购票过程 现在无论是买火车票、飞机票、演唱会票基本都是使用电子支付网上购票，之后得到一张电子票凭证，进场前打印纸质票或者闸机核销票据二维码进场，那么我们从用户角度看下，一次完整的购票过程是什么样。
用户的购票流程：
首先用户登录 票务 APP 搜索爱豆的门票，点击查看门票详情，然后选择场次和票档。等待抢票倒计时，才能进入到下一个页面；倒计时结束后，开抢按钮被点亮，用户进入下一步选择观演人，确认信息后选择付款方式提交订单；如果手速足够快、运气足够好，抢到了票就会唤起所选的支付方式 APP 提示付款；如果没有抢到则会提示拥堵，跳转到票档选择页面。 下面，我将这个图补充一下，思考下哪些步骤是用户可以提高出票成功率的关键时间节点：
很显然，用户在倒计时之前看不到的页面就是竞争手速的关键时机，当这个开抢按钮被倒计时点亮的一瞬间，要以最快的速度点击到达隐藏页面，然后选中观演人，通常使用默认的支付方式，最后提交订单。一旦订单被提交成功，就说明锁定了席位抢到了票。如果用户在规定的时间内未付款，该席位会重新流入票池，捡漏的人就可以抢到。
到这里，我们知道了购票流程和提高抢票成功率的突破口，人的手速肯定没有机器快，接下来介绍下两种常用的技术抢票方案。
二、Selenium 模拟浏览器操作 在使用 Chrome 浏览器，用户可以使用鼠标滑动、按键点击以及键盘输入，作为信号输入设备向浏览器传达指令，浏览器收到指令后执行渲染。
这里提到的 Selenium WebDriver 是对浏览器提供的原生 API 进行封装，使用这套 API 可以操控浏览器的开启、关闭，打开网页，操作界面元素，控制 Cookie。简单说就是，可以通过写代码的方式来自动实现用户鼠标和键盘信号的输入。这么一来，可以做的事就非常多了。
下面是一个简单脚本，它首先打开 chrome 浏览器输入 google 的网址，等待 5 秒，浏览器网页打开后，找到输入框输入 ”ChromeDriver“，然后模拟点击搜索按钮，就能看到浏览器上搜索的结果。
import time from selenium import webdriver from selenium.webdriver.common.by import By browser.get(&#34;https://www.google.com&#34;) time.sleep(5) # 查找元素 search_box = browser.find_element(By.NAME, &#39;q&#39;) # 模拟按键输入 search_box.send_keys(&#39;ChromeDriver&#39;) # 搜索框模拟回车 search_box.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-06-21T15:03:24+08:00">
    <meta property="article:modified_time" content="2023-06-21T15:03:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Python脚本】Python自动大麦网抢票，准点原价秒杀演唱会门票，拒绝黄牛交易！从我做起！！！1</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#_29" rel="nofollow">一、分析购票过程</a></li><li><a href="#Selenium__45" rel="nofollow">二、Selenium 模拟浏览器操作</a></li><li><a href="#_73" rel="nofollow">三、逆向工程：抢票接口</a></li><li><a href="#_99" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p>你是否错过了周杰伦的票，最近又没抢到五月天的票，不要太难过，今晚有张学友的票，后天还有张杰的票，加油哦！</p> 
<center> 
 <font size="4" color="#0099ff"><strong> <a href="#diary-tail" rel="nofollow noopener noreferrer" target="_self">Python配套案例源码、资料点击领取福利</a> </strong></font> 
</center> 
<p><img src="https://images2.imgbox.com/9b/5f/I0ppAXy1_o.png" alt="在这里插入图片描述"></p> 
<p>为了帮助你在激烈的抢票竞争中获得更大的成功机会，本文将介绍抢票软件的实现原理以及我所了解的一些抢票方式。但是，请不要过度将希望寄托于抢票软件，它有时也不灵，经过我的验证，即使你用到了抢票软件，也不一定能抢到票。<br> <img src="https://images2.imgbox.com/9f/18/gNiCbrXO_o.png" alt="在这里插入图片描述"></p> 
<p>票务平台会经常调整反爬策略打击爬虫行为，如果希望抢票软件保持较高的成功率，是需要开发者针对票务平台的打击策略作出逻辑调整，这个成本是很高的，所以你能随手获得的抢票软件很大概率是抢不到票的或者说是不安全的。</p> 
<p>在调研过程发现一个有意思的点 “黄牛的票从来不是抢来的”。相关规定，面向市场公开销售的营业性演出门票数量，不得低于核准观众数量的70%。 而剩下的那 30%，即非公开销售的票，则是黄牛票的主要来源，也叫渠道票。这里面涉及主办方对热门票和冷门票的售票策略，黄牛在这链条中扮演着重要的角色，只要演唱会门票的二级市场不会消失，黄牛就永远不会消失，对于市场本身来说，愿意花更多钱买黄牛票的人，一定是更有需求的人，黄牛不过是市场调节的人格化。</p> 
<hr> 
<h2><a id="_29"></a>一、分析购票过程</h2> 
<p>现在无论是买火车票、飞机票、演唱会票基本都是使用电子支付网上购票，之后得到一张电子票凭证，进场前打印纸质票或者闸机核销票据二维码进场，那么我们从用户角度看下，一次完整的购票过程是什么样。</p> 
<p><img src="https://images2.imgbox.com/f9/b1/b9moz1qO_o.png" alt="在这里插入图片描述"><br> 用户的购票流程：</p> 
<ul><li>首先用户登录 票务 APP 搜索爱豆的门票，点击查看门票详情，然后选择场次和票档。等待抢票倒计时，才能进入到下一个页面；</li><li>倒计时结束后，开抢按钮被点亮，用户进入下一步选择观演人，确认信息后选择付款方式提交订单；</li><li>如果手速足够快、运气足够好，抢到了票就会唤起所选的支付方式 APP 提示付款；如果没有抢到则会提示拥堵，跳转到票档选择页面。</li></ul> 
<p>下面，我将这个图补充一下，思考下哪些步骤是用户可以提高出票成功率的关键时间节点：</p> 
<p><img src="https://images2.imgbox.com/62/bd/dJCMsNRn_o.png" alt="在这里插入图片描述"><br> 很显然，用户在倒计时之前看不到的页面就是竞争手速的关键时机，当这个开抢按钮被倒计时点亮的一瞬间，要以最快的速度点击到达隐藏页面，然后选中观演人，通常使用默认的支付方式，最后提交订单。一旦订单被提交成功，就说明锁定了席位抢到了票。如果用户在规定的时间内未付款，该席位会重新流入票池，捡漏的人就可以抢到。</p> 
<p>到这里，我们知道了购票流程和提高抢票成功率的突破口，人的手速肯定没有机器快，接下来介绍下两种常用的技术抢票方案。</p> 
<h2><a id="Selenium__45"></a>二、Selenium 模拟浏览器操作</h2> 
<p>在使用 Chrome 浏览器，用户可以使用鼠标滑动、按键点击以及键盘输入，作为信号输入设备向浏览器传达指令，浏览器收到指令后执行渲染。</p> 
<p>这里提到的 Selenium WebDriver 是对浏览器提供的原生 API 进行封装，使用这套 API 可以操控浏览器的开启、关闭，打开网页，操作界面元素，控制 Cookie。简单说就是，可以通过写代码的方式来自动实现用户鼠标和键盘信号的输入。这么一来，可以做的事就非常多了。<br> <img src="https://images2.imgbox.com/ef/5a/q1EW8m8T_o.png" alt="在这里插入图片描述"><br> 下面是一个简单脚本，它首先打开 chrome 浏览器输入 google 的网址，等待 5 秒，浏览器网页打开后，找到输入框输入 ”ChromeDriver“，然后模拟点击搜索按钮，就能看到浏览器上搜索的结果。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time

<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By

browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"https://www.google.com"</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment"># 查找元素</span>
search_box <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span> <span class="token string">'q'</span><span class="token punctuation">)</span>
<span class="token comment"># 模拟按键输入</span>
search_box<span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span><span class="token string">'ChromeDriver'</span><span class="token punctuation">)</span>
<span class="token comment"># 搜索框模拟回车</span>
search_box<span class="token punctuation">.</span>submit<span class="token punctuation">(</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment"># 关闭所有窗口</span>
browser<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>回到抢票的主题上来，我们可以使用这种技术能力，写一个 Python 脚本，在本地机器上执行起来。脚本内容是在指定的时间打开浏览器，打开票务网页，然后自动模拟用户选择观影人然后自动提交订单。（在这里我原本很想做一个演示视频，理解起来更直观，奈何时间精力有限，这里就不详细介绍 Selenium WebDriver 开发环境配置，感兴趣的可以继续深挖。）</p> 
<h2><a id="_73"></a>三、逆向工程：抢票接口</h2> 
<p>什么是逆向？即通过技术手段对票务 APP 的通讯流量抓包，定位 获取票档、提交订单的关键请求解密 https 流量，然后分析解密流量数据。<img src="https://images2.imgbox.com/f0/27/plJIwno2_o.png" alt="在这里插入图片描述"></p> 
<p>我们继续回到这张图，仔细观察会发现，用户查看门票详情以及选择票档等一些动作都是 APP 上完成的都是提前加载好的，而真正决定用户抢票的是 “提交订单” 这个关键请求。如果我们可以将这个这个请求的流量抓到，然后分析其参数构造规则，就可以编写程序自动发送请求了。</p> 
<p><img src="https://images2.imgbox.com/6e/cf/6OGJJvUF_o.png" alt="在这里插入图片描述"><br> 下面抓包示例，选取了一个门票，抓包获取了其票档信息。</p> 
<p><img src="https://images2.imgbox.com/1e/4b/6pE3T34M_o.png" alt="在这里插入图片描述"><br> 以此类推，抓包 下单接口 观察其参数构成，编写程序模拟用户请求。</p> 
<pre><code class="prism language-python"><span class="token comment"># 等待开售</span>
<span class="token keyword">def</span> <span class="token function">wait_for_buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 抢购时间</span>
    start_timestamp <span class="token operator">=</span> <span class="token number">1686475533</span>
    <span class="token comment"># 当前时间</span>
    current_timestamp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> current_timestamp <span class="token operator">&gt;</span> start_timestamp<span class="token punctuation">:</span>
        <span class="token comment"># 开始购买</span>
        place_order<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里简要介绍了下实现思路和方向，不展开逆向过程的细节。具体实现没有这么简单的，有攻击方必然有防守方，票务方为了保障平台方利益，势必会定义打击策略，例如，我们会看到验证码从文字到图片再到滑块验证的一个迭代过程。技术方面是一个问题，法律方面也是一个问题，所以全当一次攻防演练的学习，不要伤害票务方的利益。</p> 
<h2><a id="_99"></a>总结</h2> 
<p>生活有时很操蛋，我们会感到力不从心，但请守住你的热爱，别让它被挫折磨灭”。祝大家买票的时候都能以正常价格抢到自己心仪的演唱会门票 ~</p> 
<p><img src="https://images2.imgbox.com/9d/f2/Kpwf96bw_o.png" alt="请添加图片描述"></p> 
<center> 
 <span id="diary-tail">↓ ↓ ↓ 加下方名片找我，直接拿源码还有案例 ↓ ↓ ↓</span> 
</center> 
<p><img src="https://images2.imgbox.com/14/98/QX3GNyUY_o.png" alt="请添加图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/034122ab094f2dcd615afe3ad2539dc1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java web 开发——第七章MVC模式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/58f324272df285eb121a164f6f6ea89e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构与算法】 - 双向链表 - 详细实现思路及代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>