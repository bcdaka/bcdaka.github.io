<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vue2（vue-amap） 最新高德地图获取坐标与地址信息＋搜索功能 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9b7413378d113c04e867d03ae9998390/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Vue2（vue-amap） 最新高德地图获取坐标与地址信息＋搜索功能">
  <meta property="og:description" content="效果
第一步:首先我们先去高德地图开放平台申请一个Key
第二步:
需要安装地图插件
npm install vue-amap --save 第三步:
// 引入vue-amap import VueAMap from &#39;vue-amap&#39; Vue.use(VueAMap) VueAMap.initAMapApiLoader({ key: &#39;你的Key&#39;, // key plugin: [ &#39;AMap.Geolocation&#39;, //定位空间，用来获取和展示用户主机所在的经纬度位置 &#39; AMap.Autocomplete &#39;, //输入提示插件 &#39; AMap.PlaceSearch &#39;, //POI搜索插件 &#39; AMap.Scale &#39;, //右下角缩略图插件，比例尺 &#39; AMap.OverView &#39;, //地图鹰眼插件 &#39; AMap.ToolBar &#39;, //地图工具条 &#39; AMap.MapType &#39;, //类别切换空间，实现默认图层与卫星图，实施交通层之间切换的控制 &#39; AMap.PolyEditor &#39;, //编辑 折线多边形 &#39; AMap.CircleEditor &#39;, &#34;AMap.Geocoder&#34;, //地图编码 &#39;AMap.AMapManager&#39;, &#39;AMap.Marker&#39; ], // 高德 sdk 版本，默认为 1.4.4 v: &#39;1.4.4&#39;, uiVersion: &#39;1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T15:55:45+08:00">
    <meta property="article:modified_time" content="2024-07-23T15:55:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vue2（vue-amap） 最新高德地图获取坐标与地址信息＋搜索功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>效果</p> 
<p><img alt="" height="468" src="https://images2.imgbox.com/26/92/smr8Kgtm_o.png" width="1200"></p> 
<p>第一步:首先我们先去高德地图开放平台申请一个Key</p> 
<p><img alt="" height="399" src="https://images2.imgbox.com/fa/c9/0AZnww2Y_o.png" width="1200"><img alt="" height="611" src="https://images2.imgbox.com/b1/16/4Ef8Os0F_o.png" width="1200"><img alt="" height="349" src="https://images2.imgbox.com/22/60/UKb2S2n6_o.png" width="1200"></p> 
<p>第二步:</p> 
<p>需要安装地图插件</p> 
<pre><code class="hljs">npm install vue-amap --save
</code></pre> 
<p>第三步:</p> 
<pre><code class="hljs">// 引入vue-amap
import VueAMap from 'vue-amap'
Vue.use(VueAMap)
VueAMap.initAMapApiLoader({
  key: '你的Key',  // key
  plugin: [
  'AMap.Geolocation',  //定位空间，用来获取和展示用户主机所在的经纬度位置
    ' AMap.Autocomplete ',  //输入提示插件
    ' AMap.PlaceSearch ', //POI搜索插件
    ' AMap.Scale ',   //右下角缩略图插件，比例尺
    ' AMap.OverView ', //地图鹰眼插件
    ' AMap.ToolBar ',  //地图工具条
    ' AMap.MapType ',  //类别切换空间，实现默认图层与卫星图，实施交通层之间切换的控制
    ' AMap.PolyEditor ', //编辑 折线多边形
    ' AMap.CircleEditor ',
    "AMap.Geocoder",     //地图编码
   'AMap.AMapManager',
   'AMap.Marker'
  ],
  // 高德 sdk 版本，默认为 1.4.4
  v: '1.4.4',
  uiVersion: '1.0' //ui版本
})
//高德的安全密钥
window._AMapSecurityConfig = {
  securityJsCode: '你的密钥',
}</code></pre> 
<p>添加标签</p> 
<pre><code class="hljs">              &lt;div style="border: 1px solid #cccccc"&gt;
                  &lt;!-- //搜索框 --&gt;
                  &lt;el-amap-search-box
                    id="search"
                    :search-option="searchOption"
                    :on-search-result="onSearchResult"
                  /&gt;
                  &lt;!-- 地图 --&gt;
                  &lt;el-amap
                    class="amap-box"
                    :zoom="amap.zoom"
                    :center="amap.center"
                    :plugin="amap.plugin"
                    :events="amap.events"
                  &gt;
                    &lt;!-- 当前位置图标 --&gt;
                    &lt;el-amap-marker
                      v-for="(marker, index) in amap.markers"
                      :key="'marker' + index"
                      :position="marker.position"
                    /&gt;
                    &lt;!-- 位置名称显示 --&gt;
                    &lt;el-amap-text
                      v-for="(marker, index) in amap.markers"
                      :key="'text' + index"
                      :text="marker.text"
                      :offset="marker.offset"
                      :position="marker.position"
                    /&gt;
                  &lt;/el-amap&gt;
                &lt;/div&gt;</code></pre> 
<p>数据源:</p> 
<pre><code class="hljs">
export default {
  name: "vehicleSpotInspection",
  data() {
    const vm = this;
    return {
      address: "",//需要传给后端的字段
      // form对象
      dataForm: getFormData(),
      // 地图搜索对象
      searchOption: {
        city: "全国",
        citylimit: true,
      },
      lng: 0,
      lat: 0,
      // 地图对象
      amap: {
        zoom: 16,
        center: [116.319802, 39.98294],
        events: {
          // 点击获取地址的数据
          click(e) {
            const { lng, lat } = e.lnglat;
            vm.dataForm.lon = lng;
            vm.dataForm.lat = lat;
            // 这里通过高德 SDK 完成。
            var geocoder = new AMap.Geocoder({
              radius: 100,
              extensions: "all",
            });
            geocoder.getAddress([lng, lat], function (status, result) {
              if (status === "complete" &amp;&amp; result.info === "OK") {
                if (result &amp;&amp; result.regeocode) {
                  console.log("点击获取地址的数据", result);
                  vm.dataForm.orgAddr = result.regeocode.formattedAddress;
                  vm.dataForm.province =
                    result.regeocode.addressComponent.province;
                  vm.dataForm.city = result.regeocode.addressComponent.city;
                  vm.dataForm.district =
                    result.regeocode.addressComponent.district;
                  vm.dataForm.lat = lat ? lat.toString() : "";
                  vm.dataForm.lon = lng ? lng.toString() : "";
                  vm.amap.markers = [];
                  const obj = {
                    position: [lng, lat],
                    text: result.regeocode.formattedAddress,
                    offset: [0, 30],
                  };
                  vm.amap.markers.push(obj);
                  vm.sure();
                }
              }
            });
            // this.$nextTick().then(() =&gt; {
            //           // 在这里执行你需要在 DOM 更新后执行的代码
            //         });
          },
        },

        plugin: [
          {
            // 定位
            pName: "Geolocation",
            events: {
              init(o) {
                // o是高德地图定位插件实例
                o.getCurrentPosition((status, result) =&gt; {
                  console.log("定位：", result);
                  if (result &amp;&amp; result.position) {
                    // 设置经度
                    vm.lng = result.position.lng;
                    // 设置维度
                    vm.lat = result.position.lat;
                    vm.address = result.formattedAddress; //获取具体位置
                    console.log("定位address", vm.address);
                    // 设置坐标
                    vm.amap.center = [vm.lng, vm.lat];
                    let op = {
                      position: [vm.lng, vm.lat, vm.address],
                      text: vm.address, //提交之后显示的位置
                      offset: [0, 30],
                    };
                    vm.amap.markers.push(op);
                    // 页面渲染好后
                    // this.$nextTick().then(() =&gt; {
                    //   // 在这里执行你需要在 DOM 更新后执行的代码
                    // });
                  }
                });
              },
            },
          },
        ],
        //
        markers: [],
      },
    };

  },</code></pre> 
<p>方法:</p> 
<pre><code class="hljs"> // 点击获取地址的数据
    // 地图点击事件处理函数
    onMapClick(e) {
      const { lng, lat } = e.lnglat;
      // 更新数据属性
      this.dataForm.lon = lng;
      this.dataForm.lat = lat;

      // 使用 this.$amap 创建 Geocoder 实例
      var geocoder = new this.$amap.Geocoder({
        radius: 100,
        extensions: "all",
      });
      geocoder.getAddress([lng, lat], (status, result) =&gt; {
        if (status === "complete" &amp;&amp; result.info === "OK") {
          if (result &amp;&amp; result.regeocode) {
            console.log("点击获取地址的数据", result);
            this.dataForm.orgAddr = result.regeocode.formattedAddress;
            this.dataForm.province = result.regeocode.addressComponent.province;
            this.dataForm.city = result.regeocode.addressComponent.city;
            this.dataForm.district = result.regeocode.addressComponent.district;
            this.dataForm.lat = lat.toString();
            this.dataForm.lon = lng.toString();

            // 更新标记
            this.amap.markers = [
              {
                position: [lng, lat],
                text: result.regeocode.formattedAddress,
                offset: [0, 30],
              },
            ];

            // 调用其他方法，例如 sure()
            this.sure();
          }
        }
      });
    },
    // 地图搜索回调
    onSearchResult(pois) {
      const vm = this;
      vm.amap.markers = [];
           // 根据是否有搜索结果来启用或禁用搜索框
           this.searchDisabled = pois &amp;&amp; pois.length === 0;
      let latSum = 0;
      let lngSum = 0;
      console.log("地图回调", pois);
      if (pois.length &gt; 0) {
        pois.forEach((poi, index) =&gt; {
          const { lng, lat } = poi;
          if (index === 0) {
            lngSum = lng;
            latSum = lat;
            const obj = {
              position: [poi.lng, poi.lat],
              text: poi.name,
              offset: [0, 30],
            };
            vm.amap.markers.push(obj);
            console.log("地图搜索回调", poi);
            vm.dataForm.orgAddr = poi.name;
            vm.dataForm.lat = poi.lat ? poi.lat.toString() : "";
            vm.dataForm.lon = poi.lng ? poi.lng.toString() : "";
          }
        });
        vm.amap.center = [lngSum, latSum];
      }
    },
    // 定位成功后更新位置信息的函数
    updateLocationInfo(position) {
      this.dataForm.lat = position.lat;
      this.dataForm.lng = position.lng;
      this.dataForm.orgAddr = position.formattedAddress; // position 对象中有 formattedAddress 属性
      console.log("更新位置", this.dataForm);
      // 更新地图中心点和标记
      this.amap.center = [this.dataForm.lng, this.dataForm.lat];
      this.amap.markers = [
        {
          position: [this.dataForm.lng, this.dataForm.lat],
          text: this.address,//这里改成后台提供的字段可以提交给后台
          offset: [0, 30],
        },
      ];
    },
    // 提交方法
    sure() {
      const vm = this;
      console.log(this.amap.markers);
      this.$emit("updateLocation", vm.dataForm);
    },</code></pre> 
<p>遇到的问题:1.有的可能会提示 找不到AMap模块 可以引入 import AMap from 'AMap'</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/291ba5c77e1076d41b122be296213697/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vuex数据持久化实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fd4e99aca6c4aa0f3a2301af110cb019/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Elasticsearch：Golang ECS 日志记录 - Logrus</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>