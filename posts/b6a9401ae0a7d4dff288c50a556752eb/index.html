<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HBase高级特性：过滤器（一） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b6a9401ae0a7d4dff288c50a556752eb/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="HBase高级特性：过滤器（一）">
  <meta property="og:description" content="第1关：使用过滤器查询指定行的数据 知识点 1.使用过滤器的步骤：
（1）创建过滤器：RowFilter(CompareOperator op,ByteArrayComparable rowComparator)，第一个参数接收的是比较操作对象，第二个参数接收的是条件。
第一个参数有很多种取值以匹配多种场景，取值表格如下：
操作描述CompareOperator.LESS匹配小于设定值的值CompareOperator.LESS_OR_EQUAL匹配小于或等于设定值的值CompareOperator.EQUAL匹配等于设定值的值CompareOperator.NOT_EQUAL匹配与设定值不相等的值CompareOperator.GREATER_OR_EQUAL匹配大于或等于设定值的值CompareOperator.GREATER匹配大于设定值的值CompareOperator.NO_OP排除一切值 （2）设置过滤器。
编程要求 请补全函数query(String tName)，需要你查询的数据如下，表名会作为方法的参数传入：
查询basic_info列族gender列，且行键为2018的值；
查询school_info列族college列，且行键大于2018的值；
查询basic_info列族name列，且行键小于等于2020的值。
package step1; import java.io.IOException; import org.apache.hadoop.cli.util.*; import org.apache.hadoop.conf.*; import org.apache.hadoop.hbase.*; import org.apache.hadoop.hbase.client.*; import org.apache.hadoop.hbase.filter.*; import org.apache.hadoop.hbase.util.*; public class Task { public void query(String tName) throws Exception { /********* Begin *********/ Configuration config = new Configuration(); Connection conn = ConnectionFactory.createConnection(config); TableName tableName = TableName.valueOf(tName); Table table = conn.getTable(tableName); Scan scan1=new Scan(); scan1.addColumn(Bytes.toBytes(&#34;basic_info&#34;), Bytes.toBytes(&#34;gender&#34;)); Filter filter1 = new RowFilter(CompareOperator.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-12T17:19:04+08:00">
    <meta property="article:modified_time" content="2023-11-12T17:19:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HBase高级特性：过滤器（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>第1关：使用过滤器查询指定行的数据</h2> 
<h3>知识点</h3> 
<p>1.使用过滤器的步骤：</p> 
<p>（1）创建过滤器：RowFilter(CompareOperator op,ByteArrayComparable rowComparator)，第一个参数接收的是比较操作对象，第二个参数接收的是条件。</p> 
<p>第一个参数有很多种取值以匹配多种场景，取值表格如下：</p> 
<table><thead><tr><th>操作</th><th>描述</th></tr></thead><tbody><tr><td>CompareOperator.LESS</td><td>匹配小于设定值的值</td></tr><tr><td>CompareOperator.LESS_OR_EQUAL</td><td>匹配小于或等于设定值的值</td></tr><tr><td>CompareOperator.EQUAL</td><td>匹配等于设定值的值</td></tr><tr><td>CompareOperator.NOT_EQUAL</td><td>匹配与设定值不相等的值</td></tr><tr><td>CompareOperator.GREATER_OR_EQUAL</td><td>匹配大于或等于设定值的值</td></tr><tr><td>CompareOperator.GREATER</td><td>匹配大于设定值的值</td></tr><tr><td>CompareOperator.NO_OP</td><td>排除一切值</td></tr></tbody></table> 
<p>（2）设置过滤器。</p> 
<h3>编程要求</h3> 
<p>请补全函数<code>query(String tName)</code>，需要你查询的数据如下，表名会作为方法的参数传入：</p> 
<ul><li> <p>查询<code>basic_info</code>列族<code>gender</code>列，且行键为<code>2018</code>的值；</p> </li><li> <p>查询<code>school_info</code>列族<code>college</code>列，且行键大于<code>2018</code>的值；</p> </li><li> <p>查询<code>basic_info</code>列族<code>name</code>列，且行键小于等于<code>2020</code>的值。</p> </li></ul> 
<pre><code class="language-java">package step1;

import java.io.IOException;

import org.apache.hadoop.cli.util.*;
import org.apache.hadoop.conf.*;
import org.apache.hadoop.hbase.*;
import org.apache.hadoop.hbase.client.*;
import org.apache.hadoop.hbase.filter.*;
import org.apache.hadoop.hbase.util.*;

public class Task {

	public void query(String tName) throws Exception {
		/********* Begin *********/
		Configuration config = new Configuration();
		Connection conn = ConnectionFactory.createConnection(config);
		TableName tableName = TableName.valueOf(tName);
        Table table = conn.getTable(tableName);

        Scan scan1=new Scan();
        scan1.addColumn(Bytes.toBytes("basic_info"), Bytes.toBytes("gender"));
		Filter filter1 = new RowFilter(CompareOperator.EQUAL,new BinaryComparator(Bytes.toBytes("2018")));
        scan1.setFilter(filter1);
        ResultScanner scanner1 = table.getScanner(scan1);
 		System.out.println("row:2018");
 		for (Result result : scanner1) {
 			for(Cell cell : result.listCells()){
 				System.out.println("basic_info:gender " + new String(CellUtil.cloneValue(cell),"utf-8") );
 			}
 		}
        scanner1.close();
		
		Scan scan2=new Scan();
        scan2.addColumn(Bytes.toBytes("school_info"), Bytes.toBytes("college"));
		Filter filter2 = new RowFilter(CompareOperator.GREATER,new BinaryComparator(Bytes.toBytes("2018")));
        scan2.setFilter(filter2);
        ResultScanner scanner2 = table.getScanner(scan2);
 		for (Result result : scanner2) {
            System.out.println("row:" + new String(result.getRow(),"utf-8"));
 			for(Cell cell : result.listCells()){
 				System.out.println("school_info:college " + new String(CellUtil.cloneValue(cell),"utf-8") );
 			}
 		}
        scanner2.close();
		
        Scan scan3=new Scan();
        scan3.addColumn(Bytes.toBytes("basic_info"), Bytes.toBytes("name"));
		Filter filter3 = new RowFilter(CompareOperator.LESS_OR_EQUAL,new BinaryComparator(Bytes.toBytes("2020")));
        scan3.setFilter(filter3);
        ResultScanner scanner3 = table.getScanner(scan3);
 		for (Result result : scanner3) {
            System.out.println("row:" + new String(result.getRow(),"utf-8"));
 			for(Cell cell : result.listCells()){
 				System.out.println("basic_info:name " + new String(CellUtil.cloneValue(cell),"utf-8") );
 			}
 		}
        scanner3.close();
		
		conn.close();
		/********* End *********/
	}
}</code></pre> 
<h2>第2关：使用正则表达式与子字符串匹配行键</h2> 
<h3>知识点</h3> 
<p>比较器的子类</p> 
<table><thead><tr><th>比较器</th><th>描述</th></tr></thead><tbody><tr><td>BinaryComparator</td><td>使用Bytes.compareTo()比较当前值与阈值</td></tr><tr><td>BinaryPrefixComparator</td><td>与上面类似，但是是从左端开始前缀匹配</td></tr><tr><td>NullComparator</td><td>不做匹配，只判断当前值是不是null</td></tr><tr><td>BitComparator</td><td>通过BitwiseOp类提供的按位与（AND）、或（OR）、异或（XOR）操作执行位级比较</td></tr><tr><td>RegexStringComparator（正则比较器）</td><td>根据一个正则表达式，在实例化这个比较器的时候去匹配表中的数据</td></tr><tr><td>SubStringComparator（子串过滤器）</td><td>把阈值和表中数据当做String实例，同时通过contains()操作匹配字符串</td></tr></tbody></table> 
<h3>编程要求</h3> 
<p>查询表<code>t2_student_table</code>中的数据。 要求如下：</p> 
<ul><li> <p>查询以<code>1</code>开头，并以<code>9</code>结尾的行键，并输出该行所有列的值；</p> </li><li> <p>查询包含<code>231</code>的行键，并输出该行所有列的值。</p> </li></ul> 
<pre><code class="language-java">package step2;

import java.io.IOException;

import org.apache.hadoop.cli.util.*;
import org.apache.hadoop.conf.*;
import org.apache.hadoop.hbase.*;
import org.apache.hadoop.hbase.client.*;
import org.apache.hadoop.hbase.filter.*;
import org.apache.hadoop.hbase.util.*;
import org.apache.hadoop.hbase.filter.SubstringComparator;

public class Task {

	public void query() throws Exception {
		/********* Begin *********/
		Configuration config = new Configuration();
		Connection conn = ConnectionFactory.createConnection(config);
		TableName tablename=TableName.valueOf("t2_student_table");
        Table table=conn.getTable(tablename);

        Scan scan1=new Scan();
        Filter filter1 = new RowFilter(CompareOperator.EQUAL,new RegexStringComparator("1.*9$")); //查询以1开头，并以9结尾的行键
        scan1.setFilter(filter1);
        ResultScanner scanner1 = table.getScanner(scan1);
        for (Result result : scanner1) {
 			System.out.println("row:" + new String(result.getRow(),"utf-8"));
 			for(Cell cell : result.listCells()){
 				String family = Bytes.toString(CellUtil.cloneFamily(cell));
 				String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
 				String value = Bytes.toString(CellUtil.cloneValue(cell));
 				System.out.println(family + ":" + qualifier + " " + value);
 			}
 		}
 		scanner1.close();
		
		Scan scan2=new Scan();
        Filter filter2 = new RowFilter(CompareOperator.EQUAL,new SubstringComparator("231")); //查询包含231的行键
        scan2.setFilter(filter2);
        ResultScanner scanner2 = table.getScanner(scan2);
        for (Result result : scanner2) {
 			System.out.println("row:" + new String(result.getRow(),"utf-8"));
 			for(Cell cell : result.listCells()){
 				String family = Bytes.toString(CellUtil.cloneFamily(cell));
 				String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
 				String value = Bytes.toString(CellUtil.cloneValue(cell));
 				System.out.println(family + ":" + qualifier + " " + value);
 			}
 		}
 		scanner2.close();
	
		conn.close();
		/********* End *********/
	}
}</code></pre> 
<h2>第3关：列族过滤器、值过滤器、列名过滤器</h2> 
<h3>编程要求</h3> 
<p>使用过滤器对表<code>t3_student_table</code>完成如下查询操作：</p> 
<ul><li> <p>查询行键<code>1019</code>中列族<code>school_info</code>所有列，输出值；</p> </li><li> <p>查询行键<code>2020</code>中，列名包含字母<code>c</code>的所有列，输出值；</p> </li><li> <p>查询表所有行中包含<code>张</code>的值，并输出该值。</p> </li></ul> 
<pre><code class="language-java">package step3;

import java.io.IOException;

import org.apache.hadoop.cli.util.*;
import org.apache.hadoop.conf.*;
import org.apache.hadoop.hbase.*;
import org.apache.hadoop.hbase.client.*;
import org.apache.hadoop.hbase.filter.*;
import org.apache.hadoop.hbase.util.*;

import org.apache.hadoop.hbase.filter.SubstringComparator;

public class Task {

	public void query() throws Exception {
		/********* Begin *********/
		Configuration config = new Configuration();
		Connection conn = ConnectionFactory.createConnection(config);
		TableName tableName = TableName.valueOf(Bytes.toBytes("t3_student_table"));
 		Table table = conn.getTable(tableName);
		
		Filter filter1 = new FamilyFilter(CompareOperator.EQUAL,new BinaryComparator(Bytes.toBytes("school_info")));  //列族过滤器
 		Get get1 = new Get(Bytes.toBytes("1019"));
 		get1.setFilter(filter1);
 		Result result1 = table.get(get1);
 		System.out.println("row:" + new String(result1.getRow(),"utf-8"));
 		for(Cell cell : result1.listCells()){
 			String family = Bytes.toString(CellUtil.cloneFamily(cell));
 			String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
 			String value = Bytes.toString(CellUtil.cloneValue(cell));
 			System.out.println(family + ":" + qualifier + " " + value);
 		}

        Filter filter2 = new QualifierFilter(CompareOperator.EQUAL,
 		new SubstringComparator("c"));   //列名过滤器
 		Get get2 = new Get(Bytes.toBytes("2020"));
 		get2.setFilter(filter2);
 		Result result2 = table.get(get2);
 		System.out.println("row:" + new String(result2.getRow(),"utf-8"));
 		for(Cell cell : result2.listCells()){
 			String family = Bytes.toString(CellUtil.cloneFamily(cell));
 			String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
 			String value = Bytes.toString(CellUtil.cloneValue(cell));
 			System.out.println(family + ":" + qualifier + " " + value);
 		}
		
		Scan scan3 = new Scan();
 		Filter filter3 = new ValueFilter(CompareOperator.EQUAL, new SubstringComparator("张"));   //值过滤器
 		scan3.setFilter(filter3);
 		ResultScanner scanner3 = table.getScanner(scan3);
 		for (Result result : scanner3) {
 			System.out.println("row:" + new String(result.getRow(),"utf-8"));
 			for(Cell cell : result.listCells()){
 				String family = Bytes.toString(CellUtil.cloneFamily(cell));
 				String qualifier = Bytes.toString(CellUtil.cloneQualifier(cell));
 				String value = Bytes.toString(CellUtil.cloneValue(cell));
 				System.out.println(family + ":" + qualifier + " " + value);
 			}
 		}
        scanner3.close();
		conn.close();
		/********* End *********/
	}
}</code></pre> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9a115f70d26b012a1ec723cd61ed23a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">KataGO（引擎安装及解释）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f009be36904a1e4a90cf65324f56cc7b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx：Windows详细安装部署教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>