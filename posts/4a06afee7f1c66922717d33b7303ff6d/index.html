<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLO在mac上的安装和使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4a06afee7f1c66922717d33b7303ff6d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="YOLO在mac上的安装和使用">
  <meta property="og:description" content="提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档
文章目录 一、YOLO的安装1.在GitHub上下载源码：2.配置环境： 二、用YOLO测试视频1.测试下载视频2.用电脑自带摄像头实时监测 三、训练自己的数据集 提示：以下是本篇文章正文内容，下面案例可供参考
一、YOLO的安装 1.在GitHub上下载源码： https://github.com/ultralytics/yolov5/tree/v6.1
2.配置环境： 1.将下载好的压缩包保存至一个没有中文的路径下，点击打开PyCharm，点击open按钮，在路径中找到刚刚的源码保存路径，即可在PyCharm中打开项目。
⚠此时可能会跳出一个框，让你配置环境，先直接关掉。（我们后面再配置环境）
2.打开Anaconda，在左侧选择environments，点击下方create，我创建了一个新环境，命名为yolo5_test。（建议选择python3.9与yolov5适配）
3.打开Pycharm设置Preference
新建Python解释器的环境
4.系列库的安装
(1).打开终端，输入命令进入创建的Anaconda环境
conda activate yolov5_test (yolov5_test是我创建的环境名，需换成你的)
(2).配置torch和torchvision
pip install torch==1.8.1 torchvision==0.9.1 torchaudio==0.8.1 (输入后会自动提示适合你的版本，根据提示更改版本号安装即可）
(3).对照requirements.txt 配置其他所需安装包
pip install -r requirements.txt 这里我失败了，于是分别安装
pip install numpy pip install opencv-python pip install matplotlib pip install pillow pip install PyYAM pip install scipy pip install tqdm pip install requests 5.运行程序
基本测试需要运行detect.py
（这里我运行时出现了bug，发现还有一些包未安装，根据提示又安装了缺少的包）
最终在pycharm中运行结果如下
打开exp查看结果
二、用YOLO测试视频 1.测试下载视频 将视频放入yolov5-6.1/data/images/中，在pycharm中运行detect.py
打开yolov5-6.1/runs/detect/exp查看结果代码如下（示例）：
2.用电脑自带摄像头实时监测 在detect文件最后找到此行代码">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-10T23:15:55+08:00">
    <meta property="article:modified_time" content="2024-05-10T23:15:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLO在mac上的安装和使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#YOLO_12" rel="nofollow">一、YOLO的安装</a></li><li><ul><li><a href="#1GitHub_13" rel="nofollow">1.在GitHub上下载源码：</a></li><li><a href="#2_16" rel="nofollow">2.配置环境：</a></li></ul> 
  </li><li><a href="#YOLO_62" rel="nofollow">二、用YOLO测试视频</a></li><li><ul><li><a href="#1_63" rel="nofollow">1.测试下载视频</a></li><li><a href="#2_67" rel="nofollow">2.用电脑自带摄像头实时监测</a></li></ul> 
  </li><li><a href="#_75" rel="nofollow">三、训练自己的数据集</a></li></ul> 
</div> 
<p></p> 
<hr> 
<p><code>提示：以下是本篇文章正文内容，下面案例可供参考</code></p> 
<h2><a id="YOLO_12"></a>一、YOLO的安装</h2> 
<h3><a id="1GitHub_13"></a>1.在GitHub上下载源码：</h3> 
<p><a href="https://github.com/ultralytics/yolov5/tree/v6.1">https://github.com/ultralytics/yolov5/tree/v6.1</a><br> <img src="https://images2.imgbox.com/1e/72/B8iTxU5W_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_16"></a>2.配置环境：</h3> 
<p>1.将下载好的压缩包保存至一个没有中文的路径下，点击打开PyCharm，点击open按钮，在路径中找到刚刚的源码保存路径，即可在PyCharm中打开项目。<br> <img src="https://images2.imgbox.com/8e/22/PSmZyjID_o.png" alt="在这里插入图片描述"><br> ⚠此时可能会跳出一个框，让你配置环境，先直接关掉。（我们后面再配置环境）<br> 2.打开Anaconda，在左侧选择environments，点击下方create，我创建了一个新环境，命名为yolo5_test。（建议选择python3.9与yolov5适配）<br> <img src="https://images2.imgbox.com/85/fb/4D4jex3E_o.png" alt="在这里插入图片描述"><br> 3.打开Pycharm设置Preference<br> <img src="https://images2.imgbox.com/80/31/HjRVnO9t_o.png" alt="在这里插入图片描述"><br> 新建Python解释器的环境<br> <img src="https://images2.imgbox.com/16/f7/l2UZXav8_o.png" alt="在这里插入图片描述"><br> 4.系列库的安装<br> (1).打开终端，输入命令进入创建的Anaconda环境</p> 
<pre><code class="prism language-c">conda activate yolov5_test 
</code></pre> 
<p>(yolov5_test是我创建的环境名，需换成你的)</p> 
<p>(2).配置torch和torchvision</p> 
<pre><code class="prism language-c">pip install torch<span class="token operator">==</span><span class="token number">1.8</span><span class="token number">.1</span> torchvision<span class="token operator">==</span><span class="token number">0.9</span><span class="token number">.1</span> torchaudio<span class="token operator">==</span><span class="token number">0.8</span><span class="token number">.1</span>
</code></pre> 
<p>(输入后会自动提示适合你的版本，根据提示更改版本号安装即可）</p> 
<p>(3).对照requirements.txt 配置其他所需安装包</p> 
<pre><code class="prism language-c">pip install <span class="token operator">-</span>r requirements<span class="token punctuation">.</span>txt
</code></pre> 
<p>这里我失败了，于是分别安装</p> 
<pre><code class="prism language-c">pip install numpy
pip install opencv<span class="token operator">-</span>python
pip install matplotlib
pip install pillow
pip install PyYAM
pip install scipy
pip install tqdm
pip install requests
</code></pre> 
<p>5.运行程序<br> 基本测试需要运行detect.py<br> （这里我运行时出现了bug，发现还有一些包未安装，根据提示又安装了缺少的包）<br> 最终在pycharm中运行结果如下<br> <img src="https://images2.imgbox.com/04/00/0ugsiL8E_o.png" alt="在这里插入图片描述"><br> 打开exp查看结果<br> <img src="https://images2.imgbox.com/66/67/7hR6NW0n_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="YOLO_62"></a>二、用YOLO测试视频</h2> 
<h3><a id="1_63"></a>1.测试下载视频</h3> 
<p>将视频放入yolov5-6.1/data/images/中，在pycharm中运行detect.py<img src="https://images2.imgbox.com/39/2a/EphLLbjn_o.png" alt="在这里插入图片描述"><br> 打开yolov5-6.1/runs/detect/exp查看结果代码如下（示例）：<br> <img src="https://images2.imgbox.com/c4/55/VRnlBDEQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_67"></a>2.用电脑自带摄像头实时监测</h3> 
<p>在detect文件最后找到此行代码<br> <img src="https://images2.imgbox.com/5e/58/Q9enECYU_o.png" alt="在这里插入图片描述"><br> 改为：</p> 
<pre><code class="prism language-c"><span class="token function">cd_argument</span><span class="token punctuation">(</span><span class="token char">'--source'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'0'</span><span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'source'</span><span class="token punctuation">)</span>  # file<span class="token operator">/</span>folder<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">for</span> webcam
</code></pre> 
<p>同样打开yolov5-6.1/runs/detect/exp查看结果</p> 
<h2><a id="_75"></a>三、训练自己的数据集</h2> 
<p>1.创建环境<br> 创建一个新的anaconda环境</p> 
<pre><code class="prism language-c">conda create <span class="token operator">-</span>n tf python<span class="token operator">=</span><span class="token number">3.9</span><span class="token number">.18</span>
</code></pre> 
<p>（改成自己的python版本）<br> 切换到tf环境（重新打开终端时要记得切到这个环境）</p> 
<pre><code class="prism language-c">conda activate tf
</code></pre> 
<p>(前面有（tf）则是转换成功)<br> 2.安装macos版本的TensorFlow</p> 
<pre><code class="prism language-c">pip install <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token comment">//pypi.tuna.tsinghua.edu.cn/simple/ tensorflow==2.6</span>
</code></pre> 
<p>3.pyqt5安装<br> 法一</p> 
<pre><code class="prism language-c">pip install pyqt5
</code></pre> 
<p>(这里我失败了）<br> 法二 安装homebrew</p> 
<pre><code class="prism language-c"><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ruby<span class="token operator">-</span>e<span class="token string">"$(curl-fsSLhttps://raw.githubusercontent.com/Homebrew/install/master/install)"</span>
</code></pre> 
<p>通过homebrew安装pyqt5</p> 
<pre><code class="prism language-c">brew install pyqt5
</code></pre> 
<p>4.安装torch和torchvision</p> 
<pre><code class="prism language-c">pip install torch<span class="token operator">==</span><span class="token number">1.7</span><span class="token number">.1</span> torchvision<span class="token operator">==</span><span class="token number">0.8</span><span class="token number">.2</span> <span class="token operator">-</span>f https<span class="token operator">:</span><span class="token comment">//download.pytorch.org/whl/torch_stable.html -i https://pypi.tuna.tsinghua.edu.cn/simple/torch</span>
</code></pre> 
<p>5.安装labelimg<br> 法一</p> 
<pre><code class="prism language-c">pip install labelimg
</code></pre> 
<p>这里我失败了<br> 法二 进入labelimg的github地址<a href="https://github.com/HumanSignal/labelImg">https://github.com/HumanSignal/labelImg</a><br> <img src="https://images2.imgbox.com/c8/10/Cjo3ClSb_o.png" alt="在这里插入图片描述"><br> 打开终端输入cd 将labeling-master文件夹拖入</p> 
<pre><code class="prism language-c">brew install qt
brew install libxml2
conda install lxml
make qt5py3
python labelImg<span class="token punctuation">.</span>py
</code></pre> 
<p>就可以用labelimg标注文件啦<br> <img src="https://images2.imgbox.com/21/a8/RXpffoiU_o.png" alt="在这里插入图片描述"><br> 在yolov5目录下新建一个名为VOCData的文件夹，在VOCData文件夹下创建 Annotations 和 images 文件夹。<br> images文件夹放要训练的图片<br> 打开目录为images文件夹<br> 更改存放目录为Annotions文件夹<br> 标记图片快捷键：w：标记   a：上一张图片   d：下一张图片<br> 标注的时候尽可能贴近物体轮廓</p> 
<p>6.划分数据集以及配置文件修改<br> (1)划分训练集、验证集、测试集<br> 在终端中打开images文件夹（根据自己路径找）</p> 
<pre><code class="prism language-c">cd <span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Documents<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>images
Is <span class="token operator">-</span>a
rm <span class="token punctuation">.</span>DS_Store
</code></pre> 
<p>在macos下，文件夹内会生成.Ds_store隐藏文件要先删除</p> 
<p>在VOCData目录下创建程序 split_train_val.py 并运行以下代码（代码可以不做任何修改）</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">coding</span><span class="token expression"><span class="token operator">:</span>utf<span class="token operator">-</span><span class="token number">8</span></span></span>
 
import os
import random
import argparse
 
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span><span class="token function">ArgumentParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">xml</span><span class="token expression">文件的地址，根据自己的数据进行修改 xml一般存放在Annotations下</span></span>
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--xml_path'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'Annotations'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'input xml label path'</span><span class="token punctuation">)</span>
#数据集的划分，地址选择自己数据下的ImageSets<span class="token operator">/</span>Main
parser<span class="token punctuation">.</span><span class="token function">add_argument</span><span class="token punctuation">(</span><span class="token char">'--txt_path'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">=</span><span class="token char">'ImageSets/Main'</span><span class="token punctuation">,</span> type<span class="token operator">=</span>str<span class="token punctuation">,</span> help<span class="token operator">=</span><span class="token char">'output txt label path'</span><span class="token punctuation">)</span>
opt <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse_args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 
trainval_percent <span class="token operator">=</span> <span class="token number">1.0</span>  # 训练集和验证集所占比例。 这里没有划分测试集
train_percent <span class="token operator">=</span> <span class="token number">0.9</span>     # 训练集所占比例，可自己进行调整
xmlfilepath <span class="token operator">=</span> opt<span class="token punctuation">.</span>xml_path
txtsavepath <span class="token operator">=</span> opt<span class="token punctuation">.</span>txt_path
total_xml <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>xmlfilepath<span class="token punctuation">)</span>
<span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>txtsavepath<span class="token punctuation">)</span><span class="token operator">:</span>
    os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>txtsavepath<span class="token punctuation">)</span>
 
num <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>total_xml<span class="token punctuation">)</span>
list_index <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
tv <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>num <span class="token operator">*</span> trainval_percent<span class="token punctuation">)</span>
tr <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>tv <span class="token operator">*</span> train_percent<span class="token punctuation">)</span>
trainval <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span>list_index<span class="token punctuation">,</span> tv<span class="token punctuation">)</span>
train <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span>trainval<span class="token punctuation">,</span> tr<span class="token punctuation">)</span>
 
file_trainval <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token char">'/trainval.txt'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
file_test <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token char">'/test.txt'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
file_train <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token char">'/train.txt'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
file_val <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token char">'/val.txt'</span><span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> i in list_index<span class="token operator">:</span>
    name <span class="token operator">=</span> total_xml<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'\n'</span>
    <span class="token keyword">if</span> i in trainval<span class="token operator">:</span>
        file_trainval<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i in train<span class="token operator">:</span>
            file_train<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            file_val<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token operator">:</span>
        file_test<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
 
file_trainval<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
file_train<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
file_val<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
file_test<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            
</code></pre> 
<p>运行结束后会在生成一个名为 ImageSets 的文件夹<br> [说明]：在第14，15行代码中<br> 训练集是用来训练模型的，通过尝试不同的方法和思路使用训练集来训练不同的模型；<br> 验证集使用交叉验证来挑选最优的模型，通过不断的迭代来改善模型在验证集上的性能；<br> 测试集用来评估模型的性能。</p> 
<p>(2)XML格式转yolo_txt格式<br> 在VOCData目录下创建程序 xml_to_yolo.py 并运行以下代码<br> 注意：将classes改为自己标注时设置的类名（我这里叫"code"），将各个绝对路径修改为自己的</p> 
<pre><code class="prism language-c">#<span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
import xml<span class="token punctuation">.</span>etree<span class="token punctuation">.</span>ElementTree as ET
import os
from os import getcwd

sets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'train'</span><span class="token punctuation">,</span> <span class="token char">'val'</span><span class="token punctuation">,</span> <span class="token char">'test'</span><span class="token punctuation">]</span>
classes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span>  # 改成自己的类别
abs_path <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span>abs_path<span class="token punctuation">)</span>


def <span class="token function">convert</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> box<span class="token punctuation">)</span><span class="token operator">:</span>
    dw <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> <span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    dh <span class="token operator">=</span> <span class="token number">1.</span> <span class="token operator">/</span> <span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token number">1</span>
    y <span class="token operator">=</span> <span class="token punctuation">(</span>box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span> <span class="token operator">-</span> <span class="token number">1</span>
    w <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    h <span class="token operator">=</span> box<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> box<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    x <span class="token operator">=</span> x <span class="token operator">*</span> dw
    w <span class="token operator">=</span> w <span class="token operator">*</span> dw
    y <span class="token operator">=</span> y <span class="token operator">*</span> dh
    h <span class="token operator">=</span> h <span class="token operator">*</span> dh
    <span class="token keyword">return</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h


def <span class="token function">convert_annotation</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token operator">:</span>
    in_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>Annotations<span class="token operator">/</span><span class="token operator">%</span>s<span class="token punctuation">.</span>xml<span class="token char">' % image, encoding='</span>utf<span class="token operator">-</span><span class="token number">8</span>'<span class="token punctuation">)</span>
    out_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>labels<span class="token operator">/</span><span class="token operator">%</span>s<span class="token punctuation">.</span>txt<span class="token char">' % image, '</span>w'<span class="token punctuation">)</span>
    tree <span class="token operator">=</span> ET<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>in_file<span class="token punctuation">)</span>
    root <span class="token operator">=</span> tree<span class="token punctuation">.</span><span class="token function">getroot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    size <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'size'</span><span class="token punctuation">)</span>
    w <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'width'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>size<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'height'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">for</span> obj in root<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token char">'object'</span><span class="token punctuation">)</span><span class="token operator">:</span>
        difficult <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'difficult'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">difficult</span> <span class="token expression"><span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span></span><span class="token char">'Difficult'</span><span class="token expression"><span class="token punctuation">)</span><span class="token punctuation">.</span>text</span></span>
        cls <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> cls not in classes or <span class="token keyword">int</span><span class="token punctuation">(</span>difficult<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token keyword">continue</span>
        cls_id <span class="token operator">=</span> classes<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
        xmlbox <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'bndbox'</span><span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'xmin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'xmax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'ymin'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span>
             <span class="token keyword">float</span><span class="token punctuation">(</span>xmlbox<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">'ymax'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3<span class="token punctuation">,</span> b4 <span class="token operator">=</span> b
        # 标注越界修正
        <span class="token keyword">if</span> b2 <span class="token operator">&gt;</span> w<span class="token operator">:</span>
            b2 <span class="token operator">=</span> w
        <span class="token keyword">if</span> b4 <span class="token operator">&gt;</span> h<span class="token operator">:</span>
            b4 <span class="token operator">=</span> h
        b <span class="token operator">=</span> <span class="token punctuation">(</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3<span class="token punctuation">,</span> b4<span class="token punctuation">)</span>
        bb <span class="token operator">=</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        out_file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>cls_id<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token keyword">for</span> a in bb<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>


wd <span class="token operator">=</span> <span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> image_set in sets<span class="token operator">:</span>
    <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>labels<span class="token operator">/</span>'<span class="token punctuation">)</span><span class="token operator">:</span>
        os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>labels<span class="token operator">/</span>'<span class="token punctuation">)</span>
    image_ids <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>
        '<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>ImageSets<span class="token operator">/</span>Main<span class="token operator">/</span><span class="token operator">%</span>s<span class="token punctuation">.</span>txt' <span class="token operator">%</span> image_set<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> not os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>dataSet_path<span class="token operator">/</span>'<span class="token punctuation">)</span><span class="token operator">:</span>
        os<span class="token punctuation">.</span><span class="token function">makedirs</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>dataSet_path<span class="token operator">/</span>'<span class="token punctuation">)</span>

    list_file <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>dataSet_path<span class="token operator">/</span><span class="token operator">%</span>s<span class="token punctuation">.</span>txt<span class="token char">' % image_set, '</span>w'<span class="token punctuation">)</span>
    <span class="token keyword">for</span> image_id in image_ids<span class="token operator">:</span>
        list_file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>'<span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>images<span class="token operator">/</span><span class="token operator">%</span>s<span class="token punctuation">.</span>jpeg\n' <span class="token operator">%</span> image_id<span class="token punctuation">)</span>
        <span class="token function">convert_annotation</span><span class="token punctuation">(</span>image_id<span class="token punctuation">)</span>

    list_file<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行后会生成dataSet_path 和 labels 文件夹。dataSet_path下会有三个数据集的txt文件，labels下存放各个图像的标注文件。</p> 
<p>(3)配置文件<br> 在 yolov5 的 data 文件夹下创建一个名为 myvoc.yaml，模板如下，改成自己的路径，根据自己实际情况填写：<br> （【🎯易错】：注意冒号后面是有空格的）</p> 
<pre><code class="prism language-c"> train<span class="token operator">:</span> <span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>dataSet_path<span class="token operator">/</span>train<span class="token punctuation">.</span>txt
 
val<span class="token operator">:</span> <span class="token operator">/</span>Users<span class="token operator">/</span>zhuoxiaohua<span class="token operator">/</span>Downloads<span class="token operator">/</span>yolov5<span class="token operator">-</span><span class="token number">6.1</span><span class="token operator">/</span>VOCData<span class="token operator">/</span>dataSet_path<span class="token operator">/</span>val<span class="token punctuation">.</span>txt

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">number</span> <span class="token expression">of classes</span></span>

nc<span class="token operator">:</span> <span class="token number">1</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">class</span> <span class="token expression">names</span></span>

names<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span>
</code></pre> 
<p>(4)聚类获得先验框<br> 在 models 文件夹下找到 yolov5s.yaml（如果使用这个权重模型训练的话），将其中的 nc 改为实际上标注类的数量，和 myvoc.yaml 一样。<br> <img src="https://images2.imgbox.com/e8/83/3lHna3v8_o.png" alt="在这里插入图片描述"><br> (5)打开pycharm 找到train.py开始训练<br> 期间我遇到了不少bug</p> 
<ul><li>numpy has no attribute int.</li></ul> 
<p>删除numpy1.20.3原先版本</p> 
<pre><code class="prism language-c">pip uninstall numpy 
</code></pre> 
<p>重新下载</p> 
<pre><code class="prism language-c">pip install numpy<span class="token operator">==</span><span class="token number">1.22</span><span class="token number">.0</span> <span class="token operator">-</span>i https<span class="token operator">:</span><span class="token comment">//pypi.tuna.tsinghua.edu.cn/simple/</span>
</code></pre> 
<p>将报错代码中的int改为int_</p> 
<ul><li>RuntimeError: DataLoader worker (pid(s) 2516, 1768) exited unexpectedly<br> <img src="https://images2.imgbox.com/19/75/zRjgQy7K_o.png" alt="在这里插入图片描述"><br> 将此行default改为0</li><li>RuntimeError: result type Float can’t be cast to the desired output type long long</li></ul> 
<p>将yolov5-6.1\utils\loss.py的第211行<br> 由</p> 
<pre><code class="prism language-c">indices<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> gj<span class="token punctuation">.</span><span class="token function">clamp_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> gain<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gi<span class="token punctuation">.</span><span class="token function">clamp_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> gain<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # image<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> grid indices
</code></pre> 
<p>改为</p> 
<pre><code class="prism language-c">indices<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token punctuation">,</span> gj<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span>gain<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gi<span class="token punctuation">.</span><span class="token function">clamp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span>gain<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # image<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> grid indices
</code></pre> 
<p>重新运行train.py成功</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae99b90a47ffcacad8d615e530e52c6b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C#】WebSoket 演示（使用websocket-sharp库）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4b9b6861501e6fcf467cd24205bdfd70/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">web自动化测试（java&#43;selenium）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>