<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UE4 Unlua的快速使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8b7eac0e0ba0bcf4da52c01b8a0429e4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="UE4 Unlua的快速使用">
  <meta property="og:description" content="目录 Unlua的使用前言下载Unlua插件插件安装快速入门语法汇总模块导入多行字符串官方静态方法调用蓝图方法调用重载蓝图中的方法主动调用被重载的蓝图方法输入绑定动态绑定Lua脚本委托容器使用 延迟与协程的使用C&#43;&#43; 调用Lua 静态导出自定义类型到Lua使用网络UMG资源释放自定义加载器动画通知 Unlua的使用 前言 整理一下Unlua的整个学习流程
下载Unlua插件 我们此处使用的是腾讯的Unlua插件，打开官方的Github链接，下载对应的版本
官方链接GitHub
Wiki文档
插件安装 把下载好的插件放在自己新建项目的Plugins文件夹下，编译启动
快速入门 萌新看的图文教学
老手看的文档
点击Create的时候，会根据填写的模块名字生成路径
语法汇总 模块导入 与路径对应即可
local Common = require &#34;Core.Common&#34; 多行字符串 官方静态方法调用 UE.类名.静态方法名字 nil代表无效值空值未定义的值
蓝图方法调用 self:XXXFunction() 输出结果：这是我的蓝图测试
重载蓝图中的方法 function M:XXXFunction()) end 输出结果：M:TestFunction 主动调用被重载的蓝图方法 self.Overridden.XXXFunction() 输出结果： 这是我的蓝图测试 M:TestFunction 输入绑定 function M:LeftMouseButton_Pressed() end 实例：绑定按键并打印它的名字
local M = UnLua.Class() local PrintString = UE.UKismetSystemLibrary.PrintString local function Print(text) PrintString(nil, text, true, false, UE.FLinearColor(1, 1, 1, 1), 100) end function M:ReceiveBeginPlay() local msg = [[ 来试试以下输入吧： 字母、数字、小键盘、方向键、鼠标 ]] Print(msg) end local function SetupKeyBindings() local key_names = { -- 字母 &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-27T16:36:23+08:00">
    <meta property="article:modified_time" content="2024-06-27T16:36:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UE4 Unlua的快速使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#Unlua_1" rel="nofollow">Unlua的使用</a></li><li><ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#Unlua_4" rel="nofollow">下载Unlua插件</a></li><li><a href="#_8" rel="nofollow">插件安装</a></li><li><a href="#_10" rel="nofollow">快速入门</a></li><li><a href="#_18" rel="nofollow">语法汇总</a></li><li><ul><li><a href="#_19" rel="nofollow">模块导入</a></li><li><a href="#_25" rel="nofollow">多行字符串</a></li><li><a href="#_28" rel="nofollow">官方静态方法调用</a></li><li><a href="#_35" rel="nofollow">蓝图方法调用</a></li><li><a href="#_44" rel="nofollow">重载蓝图中的方法</a></li><li><a href="#_57" rel="nofollow">主动调用被重载的蓝图方法</a></li><li><a href="#_69" rel="nofollow">输入绑定</a></li><li><a href="#Lua_154" rel="nofollow">动态绑定Lua脚本</a></li><li><a href="#_172" rel="nofollow">委托</a></li><li><a href="#_217" rel="nofollow">容器使用</a></li></ul> 
   </li><li><a href="#_239" rel="nofollow">延迟与协程的使用</a></li><li><ul><li><a href="#C_Lua_291" rel="nofollow">C++ 调用Lua</a></li></ul> 
   </li><li><a href="#Lua_364" rel="nofollow">静态导出自定义类型到Lua使用</a></li><li><ul><li><a href="#_464" rel="nofollow">网络</a></li><li><a href="#UMG_473" rel="nofollow">UMG资源释放</a></li><li><a href="#_560" rel="nofollow">自定义加载器</a></li><li><a href="#_626" rel="nofollow">动画通知</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Unlua_1"></a>Unlua的使用</h2> 
<h3><a id="_2"></a>前言</h3> 
<p>整理一下Unlua的整个学习流程</p> 
<h3><a id="Unlua_4"></a>下载Unlua插件</h3> 
<p>我们此处使用的是腾讯的Unlua插件，打开官方的Github链接，下载对应的版本<br> <a href="https://github.com/Tencent/UnLua">官方链接GitHub</a><br> <a href="https://ue5wiki.com/wiki/36659/" rel="nofollow">Wiki文档</a></p> 
<h3><a id="_8"></a>插件安装</h3> 
<p>把下载好的插件放在自己新建项目的Plugins文件夹下，编译启动</p> 
<h3><a id="_10"></a>快速入门</h3> 
<p><a href="https://github.com/Tencent/UnLua/blob/master/Docs/CN/Quickstart_For_UE_Newbie.md">萌新看的图文教学</a><br> <a href="https://github.com/Tencent/UnLua/blob/master/README.md#%E5%BC%80%E5%A7%8BUnLua%E4%B9%8B%E6%97%85">老手看的文档</a></p> 
<p>点击Create的时候，会根据填写的模块名字生成路径<br> <img src="https://images2.imgbox.com/82/e0/YuoJMr8u_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d3/36/2nx94PnY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_18"></a>语法汇总</h3> 
<h4><a id="_19"></a>模块导入</h4> 
<p>与路径对应即可</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">local</span> Common <span class="token operator">=</span> require <span class="token string">"Core.Common"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/78/wvrI7sMB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_25"></a>多行字符串</h4> 
<p><img src="https://images2.imgbox.com/27/b0/wq1BNgyi_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_28"></a>官方静态方法调用</h4> 
<pre><code class="prism language-c++">UE.类名.静态方法名字
</code></pre> 
<p><code>nil</code>代表无效值空值未定义的值<br> <img src="https://images2.imgbox.com/98/6c/edOYeazm_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_35"></a>蓝图方法调用</h4> 
<pre><code class="prism language-bash">self:XXXFunction<span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/77/d2/ZQFEhTix_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/df/7f/2w9G69Bw_o.png" alt="在这里插入图片描述"><br> 输出结果：这是我的蓝图测试</p> 
<h4><a id="_44"></a>重载蓝图中的方法</h4> 
<pre><code class="prism language-bash"><span class="token keyword">function</span> M:XXXFunction<span class="token punctuation">(</span><span class="token punctuation">))</span>
end
</code></pre> 
<p><img src="https://images2.imgbox.com/66/33/XCb3Qili_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c++">输出结果：M:TestFunction
</code></pre> 
<h4><a id="_57"></a>主动调用被重载的蓝图方法</h4> 
<pre><code class="prism language-cpp">self<span class="token punctuation">.</span>Overridden<span class="token punctuation">.</span><span class="token function">XXXFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/50/ce/DpXJoJWl_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c++">输出结果：
这是我的蓝图测试
M:TestFunction
</code></pre> 
<h4><a id="_69"></a>输入绑定</h4> 
<pre><code class="prism language-cpp">function M<span class="token operator">:</span><span class="token function">LeftMouseButton_Pressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end
</code></pre> 
<p>实例：绑定按键并打印它的名字</p> 
<pre><code class="prism language-cpp">local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

local PrintString <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span>PrintString

local function <span class="token function">Print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token function">PrintString</span><span class="token punctuation">(</span>nil<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> UE<span class="token punctuation">.</span><span class="token function">FLinearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local msg <span class="token operator">=</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>
    来试试以下输入吧：
    字母、数字、小键盘、方向键、鼠标
    <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
end

local function <span class="token function">SetupKeyBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local key_names <span class="token operator">=</span> 
    <span class="token punctuation">{<!-- --></span>
        <span class="token operator">--</span> 字母
        <span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token operator">--</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"C"</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token string">"D"</span><span class="token punctuation">,</span> <span class="token string">"E"</span><span class="token punctuation">,</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"G"</span><span class="token punctuation">,</span> <span class="token string">"H"</span><span class="token punctuation">,</span> <span class="token string">"I"</span><span class="token punctuation">,</span> <span class="token string">"J"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">,</span> <span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token string">"M"</span><span class="token punctuation">,</span> <span class="token string">"N"</span><span class="token punctuation">,</span> <span class="token string">"O"</span><span class="token punctuation">,</span> <span class="token string">"P"</span><span class="token punctuation">,</span> <span class="token string">"Q"</span><span class="token punctuation">,</span> <span class="token string">"R"</span><span class="token punctuation">,</span> <span class="token string">"S"</span><span class="token punctuation">,</span> <span class="token string">"T"</span><span class="token punctuation">,</span> <span class="token string">"U"</span><span class="token punctuation">,</span> <span class="token operator">--</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token string">"W"</span><span class="token punctuation">,</span> <span class="token string">"X"</span><span class="token punctuation">,</span> <span class="token string">"Y"</span><span class="token punctuation">,</span> <span class="token string">"Z"</span><span class="token punctuation">,</span>
        <span class="token operator">--</span> 数字
        <span class="token string">"One"</span><span class="token punctuation">,</span> <span class="token string">"Two"</span><span class="token punctuation">,</span> <span class="token string">"Three"</span><span class="token punctuation">,</span> <span class="token string">"Four"</span><span class="token punctuation">,</span> <span class="token string">"Five"</span><span class="token punctuation">,</span> <span class="token string">"Six"</span><span class="token punctuation">,</span> <span class="token string">"Seven"</span><span class="token punctuation">,</span> <span class="token string">"Eight"</span><span class="token punctuation">,</span> <span class="token string">"Nine"</span><span class="token punctuation">,</span>
        <span class="token operator">--</span> 小键盘
        <span class="token string">"NumPadOne"</span><span class="token punctuation">,</span> <span class="token string">"NumPadTwo"</span><span class="token punctuation">,</span> <span class="token string">"NumPadThree"</span><span class="token punctuation">,</span> <span class="token string">"NumPadFour"</span><span class="token punctuation">,</span> <span class="token string">"NumPadFive"</span><span class="token punctuation">,</span> <span class="token string">"NumPadSix"</span><span class="token punctuation">,</span> <span class="token string">"NumPadSeven"</span><span class="token punctuation">,</span> <span class="token string">"NumPadEight"</span><span class="token punctuation">,</span> <span class="token string">"NumPadNine"</span><span class="token punctuation">,</span>
        <span class="token operator">--</span> 方向键
        <span class="token string">"Up"</span><span class="token punctuation">,</span> <span class="token string">"Down"</span><span class="token punctuation">,</span> <span class="token string">"Left"</span><span class="token punctuation">,</span> <span class="token string">"Right"</span><span class="token punctuation">,</span>
        <span class="token operator">--</span> ProjectSettings <span class="token operator">-&gt;</span> Engine <span class="token operator">-</span> Input <span class="token operator">-&gt;</span> Action Mappings
        <span class="token string">"Fire"</span><span class="token punctuation">,</span> <span class="token string">"Aim"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> key_name in <span class="token function">ipairs</span><span class="token punctuation">(</span>key_names<span class="token punctuation">)</span> <span class="token keyword">do</span>
        M<span class="token punctuation">[</span>key_name <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">"_Pressed"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
            <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"按下了%s"</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>KeyName<span class="token punctuation">)</span><span class="token punctuation">)</span>
        end
    end
end

local function <span class="token function">SetupAxisBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local axis_names <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"MoveForward"</span><span class="token punctuation">,</span> <span class="token string">"MoveRight"</span><span class="token punctuation">,</span> <span class="token string">"Turn"</span><span class="token punctuation">,</span> <span class="token string">"LookUp"</span><span class="token punctuation">,</span> <span class="token string">"LookUpRate"</span><span class="token punctuation">,</span> <span class="token string">"TurnRate"</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> _<span class="token punctuation">,</span> axis_name in <span class="token function">ipairs</span><span class="token punctuation">(</span>axis_names<span class="token punctuation">)</span> <span class="token keyword">do</span>
        M<span class="token punctuation">[</span>axis_name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">if</span> value <span class="token operator">~</span><span class="token operator">=</span> <span class="token number">0</span> then
                <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s(%f)"</span><span class="token punctuation">,</span> axis_name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
            end
        end
    end
end

<span class="token function">SetupKeyBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span> 在require的时候会执行
<span class="token function">SetupAxisBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

local BindKey <span class="token operator">=</span> UnLua<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>BindKey

<span class="token function">BindKey</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"Pressed"</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Key<span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"按下了C"</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>

<span class="token function">BindKey</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"Pressed"</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Key<span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"复制"</span><span class="token punctuation">)</span>
end<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Ctrl <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">BindKey</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token string">"Pressed"</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Key<span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"按下了V"</span><span class="token punctuation">)</span>
end<span class="token punctuation">)</span>

<span class="token function">BindKey</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">"V"</span><span class="token punctuation">,</span> <span class="token string">"Pressed"</span><span class="token punctuation">,</span> <span class="token function">function</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Key<span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"粘贴"</span><span class="token punctuation">)</span>
end<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Ctrl <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> M
</code></pre> 
<h4><a id="Lua_154"></a>动态绑定Lua脚本</h4> 
<p>Actor:</p> 
<pre><code class="prism language-cpp">    local World <span class="token operator">=</span> self<span class="token operator">:</span><span class="token function">GetWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local SpawnClass <span class="token operator">=</span> self<span class="token punctuation">.</span>SpawnClass
    local Transform <span class="token operator">=</span> self<span class="token punctuation">.</span>SpawnPointActor<span class="token operator">:</span><span class="token function">GetTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local AlwaysSpawn <span class="token operator">=</span> UE<span class="token punctuation">.</span>ESpawnActorCollisionHandlingMethod<span class="token punctuation">.</span>AlwaysSpawn
    World<span class="token operator">:</span><span class="token function">SpawnActor</span><span class="token punctuation">(</span>SpawnClass<span class="token punctuation">,</span> Transform<span class="token punctuation">,</span> AlwaysSpawn<span class="token punctuation">,</span> self<span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token string">"XXX.XXX"</span><span class="token punctuation">)</span>
</code></pre> 
<p>Object:</p> 
<pre><code class="prism language-cpp">local WidgetClass <span class="token operator">=</span> self<span class="token punctuation">.</span>WidgetClass
local img <span class="token operator">=</span> <span class="token function">NewObject</span><span class="token punctuation">(</span>WidgetClass<span class="token punctuation">,</span> self<span class="token punctuation">,</span> nil<span class="token punctuation">,</span> <span class="token string">"XXX.XXX"</span><span class="token punctuation">)</span>
img<span class="token operator">:</span><span class="token function">AddToViewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token operator">:</span><span class="token function">RandomPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_172"></a>委托</h4> 
<pre><code class="prism language-cpp">local FLinearColor <span class="token operator">=</span> UE<span class="token punctuation">.</span>FLinearColor

local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

function M<span class="token operator">:</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">--</span> Bind
    self<span class="token punctuation">.</span>ClickMeButton<span class="token punctuation">.</span>OnClicked<span class="token operator">:</span><span class="token function">Add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnButtonClicked<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ClickMeCheckBox<span class="token punctuation">.</span>OnCheckStateChanged<span class="token operator">:</span><span class="token function">Add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnCheckBoxToggled<span class="token punctuation">)</span>
    <span class="token operator">--</span> SetTimerByEvent
    self<span class="token punctuation">.</span>TimerHandle <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span><span class="token function">K2_SetTimerDelegate</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnTimer <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">OnButtonClicked</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local r <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local g <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local b <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>ClickMeButton<span class="token operator">:</span><span class="token function">SetBackgroundColor</span><span class="token punctuation">(</span><span class="token function">FLinearColor</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">OnCheckBoxToggled</span><span class="token punctuation">(</span>on<span class="token punctuation">)</span>
    <span class="token keyword">if</span> on then
        self<span class="token punctuation">.</span>CheckBoxText<span class="token operator">:</span><span class="token function">SetText</span><span class="token punctuation">(</span><span class="token string">"已选中"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        self<span class="token punctuation">.</span>CheckBoxText<span class="token operator">:</span><span class="token function">SetText</span><span class="token punctuation">(</span><span class="token string">"未选中"</span><span class="token punctuation">)</span>
    end
end

function M<span class="token operator">:</span><span class="token function">OnTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">Destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">--</span> Unbind
    self<span class="token punctuation">.</span>ClickMeButton<span class="token punctuation">.</span>OnClicked<span class="token operator">:</span><span class="token function">Remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnButtonClicked<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>ClickMeCheckBox<span class="token punctuation">.</span>OnCheckStateChanged<span class="token operator">:</span><span class="token function">Remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnCheckBoxToggled<span class="token punctuation">)</span>
    <span class="token operator">--</span> ClearTimer
    UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span><span class="token function">K2_ClearAndInvalidateTimerHandle</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>TimerHandle<span class="token punctuation">)</span>
end

<span class="token keyword">return</span> M
</code></pre> 
<h4><a id="_217"></a>容器使用</h4> 
<p>创建原生容器时通常需要指定参数类型，来确定容器内存放的数据类型</p> 
<table><thead><tr><th>参数类型</th><th>示例</th><th>实际类型</th></tr></thead><tbody><tr><td>boolean</td><td>true</td><td>Boolean</td></tr><tr><td>number</td><td>0</td><td>Interge</td></tr><tr><td>string</td><td>“”</td><td>String</td></tr><tr><td>table</td><td>FVector</td><td>Vector</td></tr><tr><td>userdata</td><td>FVector(1,1,1)</td><td>Vector</td></tr></tbody></table> 
<p>例：</p> 
<pre><code class="prism language-cpp">local array <span class="token operator">=</span> <span class="token function">TArray</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>ElementType<span class="token punctuation">}</span><span class="token punctuation">)</span>
local set <span class="token operator">=</span> <span class="token function">TSet</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>ElementType<span class="token punctuation">}</span><span class="token punctuation">)</span>
local map <span class="token operator">=</span> <span class="token function">TMap</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>KeyType<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>ValueType<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-cpp">local array <span class="token operator">=</span> UE<span class="token punctuation">.</span><span class="token function">TArray</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
local set <span class="token operator">=</span> UE<span class="token punctuation">.</span><span class="token function">TSet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
local map <span class="token operator">=</span> UE<span class="token punctuation">.</span><span class="token function">TMap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_239"></a>延迟与协程的使用</h3> 
<p>local M = UnLua.Class()</p> 
<pre><code class="prism language-cpp">local Latent <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span>XXXLatentFunction 

<span class="token operator">--</span> 定义一个协程函数
function M<span class="token operator">:</span><span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local co <span class="token operator">=</span> coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"开始等待..."</span><span class="token punctuation">)</span>
        Latent<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">)</span> 
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"等待结束"</span><span class="token punctuation">)</span>
    end<span class="token punctuation">)</span>
    coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>co<span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token operator">:</span><span class="token function">StartCoroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end

<span class="token keyword">return</span> M
</code></pre> 
<pre><code class="prism language-cpp">local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

local PrintString <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span>PrintString

local function <span class="token function">Print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token function">PrintString</span><span class="token punctuation">(</span>nil<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> UE<span class="token punctuation">.</span><span class="token function">FLinearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
end

local function <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
   <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"协程%s：启动"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token keyword">do</span>
        UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"协程%s：%d"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    end
   <span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"协程%s：结束"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
    —— ReceiveBeginPlay"
    <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>

    coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">)</span>
    coroutine<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span>coroutine<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>run<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">)</span>
end

<span class="token keyword">return</span> M
</code></pre> 
<h4><a id="C_Lua_291"></a>C++ 调用Lua</h4> 
<p>C++部分</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">UTutorialBlueprintFunctionLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">CallLuaByFLuaTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]CallLuaByFLuaTable 开始"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    UnLua<span class="token double-colon punctuation">::</span>FLuaEnv Env<span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> Require <span class="token operator">=</span> <span class="token class-name">UnLua</span><span class="token double-colon punctuation">::</span><span class="token function">FLuaFunction</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Env<span class="token punctuation">,</span> <span class="token string">"_G"</span><span class="token punctuation">,</span> <span class="token string">"require"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> RetValues1 <span class="token operator">=</span> Require<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token string">"Tutorials.08_CppCallLua"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>RetValues1<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> RetValue <span class="token operator">=</span> RetValues1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> LuaTable <span class="token operator">=</span> <span class="token class-name">UnLua</span><span class="token double-colon punctuation">::</span><span class="token function">FLuaTable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Env<span class="token punctuation">,</span> RetValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> RetValues2 <span class="token operator">=</span> LuaTable<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token string">"CallMe"</span><span class="token punctuation">,</span> <span class="token number">3.3f</span><span class="token punctuation">,</span> <span class="token number">4.4f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>RetValues2<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> Msg <span class="token operator">=</span> <span class="token class-name">FString</span><span class="token double-colon punctuation">::</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]收到来自Lua的返回，结果=%f"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RetValues2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Value</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]CallLuaByFLuaTable 结束"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">UTutorialBlueprintFunctionLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">CallLuaByGlobalTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]CallLuaByGlobalTable 开始"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    UnLua<span class="token double-colon punctuation">::</span>FLuaEnv Env<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> bSuccess <span class="token operator">=</span> Env<span class="token punctuation">.</span><span class="token function">DoString</span><span class="token punctuation">(</span><span class="token string">"G_08_CppCallLua = require 'Tutorials.08_CppCallLua'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>bSuccess<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> RetValues <span class="token operator">=</span> <span class="token class-name">UnLua</span><span class="token double-colon punctuation">::</span><span class="token function">CallTableFunc</span><span class="token punctuation">(</span>Env<span class="token punctuation">.</span><span class="token function">GetMainState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"G_08_CppCallLua"</span><span class="token punctuation">,</span> <span class="token string">"CallMe"</span><span class="token punctuation">,</span> <span class="token number">1.1f</span><span class="token punctuation">,</span> <span class="token number">2.2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">check</span><span class="token punctuation">(</span>RetValues<span class="token punctuation">.</span><span class="token function">Num</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> Msg <span class="token operator">=</span> <span class="token class-name">FString</span><span class="token double-colon punctuation">::</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]收到来自Lua的返回，结果=%f"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RetValues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Value</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span>Msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintScreen</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"[C++]CallLuaByGlobalTable 结束"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">PrintScreen</span><span class="token punctuation">(</span><span class="token keyword">const</span> FString<span class="token operator">&amp;</span> Msg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UKismetSystemLibrary</span><span class="token double-colon punctuation">::</span><span class="token function">PrintString</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> Msg<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token function">FLinearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.66</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>lua 部分</p> 
<pre><code class="prism language-cpp">local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

local PrintString <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span>PrintString

local function <span class="token function">Print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token function">PrintString</span><span class="token punctuation">(</span>nil<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> UE<span class="token punctuation">.</span><span class="token function">FLinearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local msg <span class="token operator">=</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>
    —— ReceiveBeginPlay
    <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    UE<span class="token punctuation">.</span>UTutorialBlueprintFunctionLibrary<span class="token punctuation">.</span><span class="token function">CallLuaByGlobalTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"================="</span><span class="token punctuation">)</span>
    UE<span class="token punctuation">.</span>UTutorialBlueprintFunctionLibrary<span class="token punctuation">.</span><span class="token function">CallLuaByFLuaTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end

function M<span class="token punctuation">.</span><span class="token function">CallMe</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
    local ret <span class="token operator">=</span> a <span class="token operator">+</span> b
    local msg <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"[Lua]收到来自C++的调用，a=%f b=%f，返回%f"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">return</span> ret
end

<span class="token keyword">return</span> M
</code></pre> 
<h3><a id="Lua_364"></a>静态导出自定义类型到Lua使用</h3> 
<p>C++.h</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CoreMinimal.h"</span></span>

<span class="token keyword">struct</span> <span class="token class-name">FTutorialObject</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	FString Name<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">FTutorialObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">explicit</span> <span class="token function">FTutorialObject</span><span class="token punctuation">(</span><span class="token keyword">const</span> FString<span class="token operator">&amp;</span> Name<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">Name</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>

	FString <span class="token function">GetTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token class-name">FString</span><span class="token double-colon punctuation">::</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"《%s》"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	FString <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">GetTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>c++ cpp</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"TutorialObject.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LuaCore.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"UnLua.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"UnLuaEx.h"</span></span>

<span class="token class-name">FTutorialObject</span><span class="token double-colon punctuation">::</span><span class="token function">FTutorialObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> int32 <span class="token function">FTutorialObject_New</span><span class="token punctuation">(</span>lua_State<span class="token operator">*</span> L<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> NumParams <span class="token operator">=</span> <span class="token function">lua_gettop</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>NumParams <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">UNLUA_LOGERROR</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> LogUnLua<span class="token punctuation">,</span> Log<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"%s: Invalid parameters!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ANSI_TO_TCHAR</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> NameChars <span class="token operator">=</span> <span class="token function">lua_tostring</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>NameChars<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">UE_LOG</span><span class="token punctuation">(</span>LogUnLua<span class="token punctuation">,</span> Log<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"%s: Invalid tutorial name!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ANSI_TO_TCHAR</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> <span class="token keyword">auto</span> UserData <span class="token operator">=</span> <span class="token function">NewUserdataWithPadding</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>FTutorialObject<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"FTutorialObject"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">new</span><span class="token punctuation">(</span>UserData<span class="token punctuation">)</span> <span class="token function">FTutorialObject</span><span class="token punctuation">(</span><span class="token function">UTF8_TO_TCHAR</span><span class="token punctuation">(</span>NameChars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">const</span> luaL_Reg FTutorialObjectLib<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span> <span class="token string">"__call"</span><span class="token punctuation">,</span> FTutorialObject_New <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">BEGIN_EXPORT_CLASS</span><span class="token punctuation">(</span>FTutorialObject<span class="token punctuation">)</span>
<span class="token function">ADD_FUNCTION</span><span class="token punctuation">(</span>GetTitle<span class="token punctuation">)</span>
<span class="token function">ADD_LIB</span><span class="token punctuation">(</span>FTutorialObjectLib<span class="token punctuation">)</span>
<span class="token function">END_EXPORT_CLASS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">IMPLEMENT_EXPORTED_CLASS</span><span class="token punctuation">(</span>FTutorialObject<span class="token punctuation">)</span>
</code></pre> 
<p>lua部分</p> 
<pre><code class="prism language-c">local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
local PrintString <span class="token operator">=</span> UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span>PrintString

local function <span class="token function">Print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token function">PrintString</span><span class="token punctuation">(</span>nil<span class="token punctuation">,</span> text<span class="token punctuation">,</span> true<span class="token punctuation">,</span> false<span class="token punctuation">,</span> UE<span class="token punctuation">.</span><span class="token function">FLinearColor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local msg <span class="token operator">=</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>
    <span class="token operator">--</span> ReceiveBeginPlay
    <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    
    local tutorial <span class="token operator">=</span> UE<span class="token punctuation">.</span><span class="token function">FTutorialObject</span><span class="token punctuation">(</span><span class="token string">"教程"</span><span class="token punctuation">)</span>
    msg <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"tutorial -&gt; %s\n\ntutorial:GetTitle() -&gt; %s"</span><span class="token punctuation">,</span> <span class="token function">tostring</span><span class="token punctuation">(</span>tutorial<span class="token punctuation">)</span><span class="token punctuation">,</span> tutorial<span class="token operator">:</span><span class="token function">GetTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   <span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
end
</code></pre> 
<h4><a id="_464"></a>网络</h4> 
<p>使用 {函数名}<em>RPC 可以覆盖蓝图中RPC函数的实现<br> 使用 OnRep</em>{变量名} 可以覆盖蓝图中变量同步消息的处理</p> 
<p>蓝图里面添加多人联机复制广播之类的<br> <img src="https://images2.imgbox.com/c1/ed/89u6MZ9P_o.png" alt="在这里插入图片描述"><br> lua里写真正调用的方法<br> <img src="https://images2.imgbox.com/db/41/eHdFKggB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="UMG_473"></a>UMG资源释放</h4> 
<p>这部分直接附着官方内容<br> UMG：</p> 
<pre><code class="prism language-cpp"><span class="token operator">--</span><span class="token operator">-</span>@type ReleaseUMG_Root_C
local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

function M<span class="token operator">:</span><span class="token function">Construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Root Construct"</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Button_AddNew<span class="token punctuation">.</span>OnClicked<span class="token operator">:</span><span class="token function">Add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnAddNew<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>Button_ReleaseAll<span class="token punctuation">.</span>OnClicked<span class="token operator">:</span><span class="token function">Add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> self<span class="token punctuation">.</span>OnReleaseAll<span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">OnAddNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Root Add New"</span><span class="token punctuation">)</span>
    local widget_class <span class="token operator">=</span> UE<span class="token punctuation">.</span>UClass<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"/Game/Tutorials/11_ReleaseUMG/ReleaseUMG_ItemParent.ReleaseUMG_ItemParent_C"</span><span class="token punctuation">)</span>
    local widget <span class="token operator">=</span> <span class="token function">NewObject</span><span class="token punctuation">(</span>widget_class<span class="token punctuation">,</span> self<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>VerticalBox_Panel<span class="token operator">:</span><span class="token function">AddChildToVerticalBox</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">OnReleaseAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token operator">:</span><span class="token function">RemoveFromViewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">Destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Root Destruct"</span><span class="token punctuation">)</span>
    self<span class="token operator">:</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end

<span class="token keyword">return</span> M
</code></pre> 
<p>测试部分：</p> 
<pre><code class="prism language-cpp"><span class="token operator">--</span><span class="token punctuation">[</span><span class="token punctuation">[</span>
    说明：

    UMG对象的释放流程：
    <span class="token number">1</span>、调用self<span class="token operator">:</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>，解除LuaTable在C<span class="token operator">++</span>侧的引用
    <span class="token number">2</span>、确保LuaTable在Lua侧没有其他引用，触发LuaGC
    <span class="token number">3</span>、C<span class="token operator">++</span>侧收到UObject_Delete回调，解除UMG在C<span class="token operator">++</span>侧的引用
    <span class="token number">4</span>、确保UMG在C<span class="token operator">++</span>侧没有其他引用，触发UEGC

    小提示：

    使用控制台命令查看对象和类的引用情况：
    
    查看指定类的引用列表：Obj List Class<span class="token operator">=</span>ReleaseUMG_Root_C
    查看指定对象的引用链：Obj Refs Name<span class="token operator">=</span>ReleaseUMG_Root_C_0
<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">--</span>

local Screen <span class="token operator">=</span> require <span class="token string">"Tutorials.Screen"</span>

local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

local function <span class="token function">print_intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local msg <span class="token operator">=</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>
使用以下按键进行一次强制垃圾回收：

C：强制 C<span class="token operator">++</span> GC
L：强制 Lua GC

—— 本示例来自 <span class="token string">"Content/Script/Tutorials.11_ReleaseUMG.lua"</span>
<span class="token punctuation">]</span><span class="token punctuation">]</span>
    Screen<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">ReceiveBeginPlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    local widget_class <span class="token operator">=</span> UE<span class="token punctuation">.</span>UClass<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token string">"/Game/Tutorials/11_ReleaseUMG/ReleaseUMG_Root.ReleaseUMG_Root_C"</span><span class="token punctuation">)</span>
    local widget_root <span class="token operator">=</span> <span class="token function">NewObject</span><span class="token punctuation">(</span>widget_class<span class="token punctuation">,</span> self<span class="token punctuation">)</span>
    widget_root<span class="token operator">:</span><span class="token function">AddToViewport</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">print_intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">L_Pressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">collectgarbage</span><span class="token punctuation">(</span><span class="token string">"collect"</span><span class="token punctuation">)</span>
    Screen<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token char">'collectgarbage("collect")'</span><span class="token punctuation">)</span>
end

function M<span class="token operator">:</span><span class="token function">C_Pressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    UE<span class="token punctuation">.</span>UKismetSystemLibrary<span class="token punctuation">.</span><span class="token function">CollectGarbage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    Screen<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">"UKismetSystemLibrary.CollectGarbage()"</span><span class="token punctuation">)</span>
end

<span class="token keyword">return</span> M
</code></pre> 
<h4><a id="_560"></a>自定义加载器</h4> 
<pre><code>说明：通过绑定 FUnLuaDelegates::CustomLoadLuaFile 可以实现自定义Lua加载器
方式1：查找路径固定，性能更好
方式2：通过package.path查找，更加灵活
</code></pre> 
<p>lua部分：</p> 
<pre><code class="prism language-cpp">UE<span class="token punctuation">.</span>UTutorialBlueprintFunctionLibrary<span class="token punctuation">.</span><span class="token function">SetupCustomLoader</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
Screen<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"FromCustomLoader1:%s"</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"Tutorials"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

package<span class="token punctuation">.</span>loaded<span class="token punctuation">[</span><span class="token string">"Tutorials"</span><span class="token punctuation">]</span> <span class="token operator">=</span> nil

package<span class="token punctuation">.</span>path <span class="token operator">=</span> package<span class="token punctuation">.</span>path <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token string">";./?/Index.lua"</span>
UE<span class="token punctuation">.</span>UTutorialBlueprintFunctionLibrary<span class="token punctuation">.</span><span class="token function">SetupCustomLoader</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
Screen<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"FromCustomLoader2:%s"</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"Tutorials"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

UE<span class="token punctuation">.</span>UTutorialBlueprintFunctionLibrary<span class="token punctuation">.</span><span class="token function">SetupCustomLoader</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>C++部分</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">CustomLoader1</span><span class="token punctuation">(</span>UnLua<span class="token double-colon punctuation">::</span>FLuaEnv<span class="token operator">&amp;</span> Env<span class="token punctuation">,</span> <span class="token keyword">const</span> FString<span class="token operator">&amp;</span> RelativePath<span class="token punctuation">,</span> TArray<span class="token operator">&lt;</span>uint8<span class="token operator">&gt;</span><span class="token operator">&amp;</span> Data<span class="token punctuation">,</span> FString<span class="token operator">&amp;</span> FullPath<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> SlashedRelativePath <span class="token operator">=</span> RelativePath<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    FullPath <span class="token operator">=</span> <span class="token class-name">FString</span><span class="token double-colon punctuation">::</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"%s%s.lua"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>GLuaSrcFullPath<span class="token punctuation">,</span> <span class="token operator">*</span>SlashedRelativePath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FFileHelper</span><span class="token double-colon punctuation">::</span><span class="token function">LoadFileToArray</span><span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token operator">*</span>FullPath<span class="token punctuation">,</span> FILEREAD_Silent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    FullPath<span class="token punctuation">.</span><span class="token function">ReplaceInline</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">".lua"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"/Index.lua"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FFileHelper</span><span class="token double-colon punctuation">::</span><span class="token function">LoadFileToArray</span><span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token operator">*</span>FullPath<span class="token punctuation">,</span> FILEREAD_Silent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token function">CustomLoader2</span><span class="token punctuation">(</span>UnLua<span class="token double-colon punctuation">::</span>FLuaEnv<span class="token operator">&amp;</span> Env<span class="token punctuation">,</span> <span class="token keyword">const</span> FString<span class="token operator">&amp;</span> RelativePath<span class="token punctuation">,</span> TArray<span class="token operator">&lt;</span>uint8<span class="token operator">&gt;</span><span class="token operator">&amp;</span> Data<span class="token punctuation">,</span> FString<span class="token operator">&amp;</span> FullPath<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> SlashedRelativePath <span class="token operator">=</span> RelativePath<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">auto</span> L <span class="token operator">=</span> Env<span class="token punctuation">.</span><span class="token function">GetMainState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lua_getglobal</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token string">"package"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lua_getfield</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> Path <span class="token operator">=</span> <span class="token function">lua_tostring</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lua_pop</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Path<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    TArray<span class="token operator">&lt;</span>FString<span class="token operator">&gt;</span> Parts<span class="token punctuation">;</span>
    <span class="token function">FString</span><span class="token punctuation">(</span>Path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ParseIntoArray</span><span class="token punctuation">(</span>Parts<span class="token punctuation">,</span> <span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> Part <span class="token operator">:</span> Parts<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Part<span class="token punctuation">.</span><span class="token function">ReplaceInline</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span>SlashedRelativePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FPaths</span><span class="token double-colon punctuation">::</span><span class="token function">CollapseRelativeDirectories</span><span class="token punctuation">(</span>Part<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FPaths</span><span class="token double-colon punctuation">::</span><span class="token function">IsRelative</span><span class="token punctuation">(</span>Part<span class="token punctuation">)</span><span class="token punctuation">)</span>
            FullPath <span class="token operator">=</span> <span class="token class-name">FPaths</span><span class="token double-colon punctuation">::</span><span class="token function">ConvertRelativePathToFull</span><span class="token punctuation">(</span>GLuaSrcFullPath<span class="token punctuation">,</span> Part<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            FullPath <span class="token operator">=</span> Part<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">FFileHelper</span><span class="token double-colon punctuation">::</span><span class="token function">LoadFileToArray</span><span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token operator">*</span>FullPath<span class="token punctuation">,</span> FILEREAD_Silent<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_626"></a>动画通知</h4> 
<pre><code class="prism language-cpp">local M <span class="token operator">=</span> UnLua<span class="token punctuation">.</span><span class="token function">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

function M<span class="token operator">:</span><span class="token function">Received_Notify</span><span class="token punctuation">(</span>MeshComp<span class="token punctuation">,</span> Animation<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
end

<span class="token keyword">return</span> M
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7bc6d62a12f853bd5cc7d88e21ab016c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">高性能Web服务器-Nginx的常用模块</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/856440bc05556a933bd1a0a202a6e680/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Springboot项目连接多数据源（MySQL和SQLServer）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>