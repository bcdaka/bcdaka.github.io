<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Python】详解打包代码为可执行文件.exe（pyinstaller模块） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/70ee355f542cfb122cc927e858122104/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Python】详解打包代码为可执行文件.exe（pyinstaller模块）">
  <meta property="og:description" content="为什么要打包.py为.exe文件? 我们在编写代码时依赖的是本地环境，使用的是本地代码编译器。我们可以设想一种情况：当我们做好一个脚本或者工具，想要给其他人用，这个时候还需要在别人的电脑上装好python环境和编译器吗？那肯定比较麻烦，最快捷的方式就是将本地的.py文件直接打包成.exe的可执行文件，这样在任何电脑上只需要点击可执行文件那么代码就可以运行。
在python中，最常用的打包方式就是使用pyinstaller包，接下来我将详细介绍其用法~
1.打包机制 类似我们在本地使用编译器进行代码运行，打包时会将编译器进行打包。同时我们写的代码所依赖的所有包都会被一同打包，为了防止漏打包的情况，pyinstaller进行打包时往往可能会多打包而基本不会漏打。
2.安装pyinstaller包 首先我们需要使用pip安装pyinstaller模块，在终端中输入：
pip install pyinstaller 3.基本用法和参数介绍 打开编译器终端（terminal），使用pyinstaller语句对py文件进行打包，最基础的打包语句如下：
pyinstaller -F xxx.py 语句中xxx.py指的是需要打包的.py文件名，打包完之后可以在项目文件的dist文件夹中找到.exe可执行文件。
加入-w可以关闭点击exe文件后启动的黑色控制台，如下：
pyinstaller -F -w xxx.py 此外pyinstaller还有其他可选的参数，如果我们想要改变.exe可执行文件的图标可以使用以下语句:
pyinstaller -F -w -i xxx.ico xxx.py 其中xxx.ico的位置是ico类型文件的名称，可以填写ico图标的路径或者把ico图标放在和.py文件相同的文件夹下，才可顺利打包，推荐两个ico图标相关的网站：
ico图标在线转换工具https://ico.nyaasu.top/
阿里巴巴矢量库https://www.iconfont.cn/?spm=a313x.search_index.i3.d4d0a486a.350c3a81r6W4KE
类似的还可以把-F替换成其他参数，参考下表：
参数描述-F只会打包为一个单独的.exe文件，所有的依赖包括库之类的全部都被打包进exe文件（单文件模式）-D打包后会产生一个.exe文件和其依赖文件的文件夹（多文件模式）-C产生一个黑色控制台（默认）调试时常常需要使用-w隐藏黑色控制台，一般是在写一个GUI应用时使用，只显示GUI窗口而隐藏控制台-i 或 -icon 将可执行文件的图标改成指定的ico图标-n 重命名.exe文件的名称--splash 添加启动文件画面图，用于等待加载 通用打包语句如下，大家可以按自己需求删改：
pyinstaller -F -w xxx.py -i xxx.ico -n xxx --splash xxx.png 四个xxx的位置中第一个是当前.py文件的文件名，第二个是ico图标的文件名，第三个是要重命名的名称，第四个是启动图片名称，默认把所有相关图片都放在与py文件同一个文件夹下，也可以使用图片文件的绝对路径引用。
4.用法演示： 如下图，我们准备好三个文件，分别是.py文件，ico图标文件和png加载图片的文件。
在终端中输入如下指令：
pyinstaller -F -w test.py -i money.ico -n test_rename --splash img.png 按照我们的预想，应该生成一个带ico图标的在，单文件的，无黑色控制台的，名称为test_rename的.exe可执行文件，同时在启动时，还会有一个加载图片动画img.png。
打包完成后的情况的确如此：
主文件夹中会生成一个build文件夹，一个dist文件夹，一个spec文件，dist文件夹中存有.exe文件，其为单文件模式，exe文件中打包了所有依赖库，可以直接拿来使用
5.如何降低打包文件大小 在我们使用pyinstaller模块直接对.py文件进行打包时，常常会发现打包出来的文件异常的大，尤其是当代码中需要使用到numpy，pandas，pyside这种大型库，打包出来的文件往往可能达到百兆大小的级别，因此如何降低打包出来的文件大小是非常重要的，我整合了网上的一些方法，结合了一些自己的理解，提供给大家参考。
(1)在虚拟环境中打包 直接使用pyinstaller打包时，可能会把其所有可能用到的包和依赖项全部打包，有些时候我们可能没有用到某个包，但是也import了，就会导打包文件偏大。此时若我们创建一个全新的虚拟环境，打包出来的效果可能会更好，包大小也可能会显著减小。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-29T21:45:41+08:00">
    <meta property="article:modified_time" content="2024-06-29T21:45:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Python】详解打包代码为可执行文件.exe（pyinstaller模块）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>为什么要打包.py为.exe文件?</h2> 
<blockquote> 
 <p>我们在编写代码时依赖的是本地环境，使用的是本地代码编译器。我们可以设想一种情况：当我们做好一个脚本或者工具，想要给其他人用，这个时候还需要在别人的电脑上装好python环境和编译器吗？那肯定比较麻烦，最快捷的方式就是将本地的.py文件直接打包成.exe的可执行文件，这样在任何电脑上只需要点击可执行文件那么代码就可以运行。</p> 
 <p>在python中，最常用的打包方式就是使用pyinstaller包，接下来我将详细介绍其用法~</p> 
</blockquote> 
<h2>1.打包机制</h2> 
<p>类似我们在本地使用编译器进行代码运行，打包时会将编译器进行打包。同时我们写的代码所依赖的所有包都会被一同打包，为了防止漏打包的情况，pyinstaller进行打包时往往可能会多打包而基本不会漏打。</p> 
<h2>2.安装pyinstaller包</h2> 
<p>首先我们需要使用pip安装pyinstaller模块，在终端中输入：</p> 
<pre><code class="language-python">pip install pyinstaller</code></pre> 
<h2>3.基本用法和参数介绍</h2> 
<p>打开编译器终端（terminal），使用pyinstaller语句对py文件进行打包，最基础的打包语句如下：</p> 
<pre><code class="language-python">pyinstaller -F xxx.py</code></pre> 
<p>语句中xxx.py指的是需要打包的.py文件名，打包完之后可以在项目文件的dist文件夹中找到.exe可执行文件。</p> 
<p>加入-w可以关闭点击exe文件后启动的黑色控制台，如下：</p> 
<pre><code class="language-python">pyinstaller -F -w xxx.py</code></pre> 
<p>此外pyinstaller还有其他可选的参数，如果我们想要改变.exe可执行文件的图标可以使用以下语句:</p> 
<pre><code class="language-python">pyinstaller -F -w -i xxx.ico xxx.py</code></pre> 
<p>其中xxx.ico的位置是ico类型文件的名称，可以填写ico图标的路径或者把ico图标放在和.py文件相同的文件夹下，才可顺利打包，推荐两个ico图标相关的网站：</p> 
<p><a class="link-info has-card" href="https://ico.nyaasu.top/" rel="nofollow" title=" ico图标在线转换工具"><span class="link-card-box"><span class="link-title"> ico图标在线转换工具</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/45/0c/YvKMVXZZ_o.png" alt="icon-default.png?t=N7T8">https://ico.nyaasu.top/</span></span></a></p> 
<p><a class="link-info has-card" href="https://www.iconfont.cn/?spm=a313x.search_index.i3.d4d0a486a.350c3a81r6W4KE" rel="nofollow" title="阿里巴巴矢量库"><span class="link-card-box"><span class="link-title">阿里巴巴矢量库</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/75/3a/J74JmM4A_o.png" alt="icon-default.png?t=N7T8">https://www.iconfont.cn/?spm=a313x.search_index.i3.d4d0a486a.350c3a81r6W4KE</span></span></a></p> 
<p>类似的还可以把-F替换成其他参数，参考下表：</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="width:93px;"><strong>参数</strong></td><td style="width:406px;"><strong>描述</strong></td></tr><tr><td style="width:93px;">-F</td><td style="width:406px;">只会打包为一个单独的.exe文件，所有的依赖包括库之类的全部都被打包进exe文件（单文件模式）</td></tr><tr><td style="width:93px;">-D</td><td style="width:406px;">打包后会产生一个.exe文件和其依赖文件的文件夹（多文件模式）</td></tr><tr><td style="width:93px;">-C</td><td style="width:406px;">产生一个黑色控制台（默认）调试时常常需要使用</td></tr><tr><td style="width:93px;">-w</td><td style="width:406px;">隐藏黑色控制台，一般是在写一个GUI应用时使用，只显示GUI窗口而隐藏控制台</td></tr><tr><td style="width:93px;">-i 或 -icon </td><td style="width:406px;">将可执行文件的图标改成指定的ico图标</td></tr><tr><td style="width:93px;">-n </td><td style="width:406px;">重命名.exe文件的名称</td></tr><tr><td style="width:93px;">--splash </td><td style="width:406px;">添加启动文件画面图，用于等待加载</td></tr></tbody></table> 
<p>通用打包语句如下，大家可以按自己需求删改：</p> 
<pre><code>pyinstaller -F -w xxx.py -i xxx.ico -n xxx --splash xxx.png</code></pre> 
<p>四个xxx的位置中第一个是当前.py文件的文件名，第二个是ico图标的文件名，第三个是要重命名的名称，第四个是启动图片名称，默认把所有相关图片都放在与py文件同一个文件夹下，也可以使用图片文件的绝对路径引用。</p> 
<h2>4.用法演示：</h2> 
<p>如下图，我们准备好三个文件，分别是.py文件，ico图标文件和png加载图片的文件。</p> 
<p style="text-align:center;"><img alt="" height="150" src="https://images2.imgbox.com/8f/a0/TtoPVGB2_o.png" width="335"></p> 
<p>在终端中输入如下指令：</p> 
<pre><code>pyinstaller -F -w test.py -i money.ico -n test_rename --splash img.png
</code></pre> 
<p>按照我们的预想，应该生成一个带ico图标的在，单文件的，无黑色控制台的，名称为test_rename的.exe可执行文件，同时在启动时，还会有一个加载图片动画img.png。</p> 
<p> 打包完成后的情况的确如此：</p> 
<p style="text-align:center;"><img alt="" height="107" src="https://images2.imgbox.com/7f/d3/1rxuq5zG_o.png" width="489"></p> 
<p>主文件夹中会生成一个build文件夹，一个dist文件夹，一个spec文件，dist文件夹中存有.exe文件，其为单文件模式，exe文件中打包了所有依赖库，可以直接拿来使用</p> 
<p style="text-align:center;"><img alt="" height="107" src="https://images2.imgbox.com/dd/fa/DeuNhGjd_o.png" width="329"></p> 
<h2>5.如何降低打包文件大小</h2> 
<blockquote> 
 <p>在我们使用pyinstaller模块直接对.py文件进行打包时，常常会发现打包出来的文件异常的大，尤其是当代码中需要使用到numpy，pandas，pyside这种大型库，打包出来的文件往往可能达到百兆大小的级别，因此如何降低打包出来的文件大小是非常重要的，我整合了网上的一些方法，结合了一些自己的理解，提供给大家参考。</p> 
</blockquote> 
<h3>(1)在虚拟环境中打包</h3> 
<p>直接使用pyinstaller打包时，可能会把其所有可能用到的包和依赖项全部打包，有些时候我们可能没有用到某个包，但是也import了，就会导打包文件偏大。此时若我们创建一个全新的虚拟环境，打包出来的效果可能会更好，包大小也可能会显著减小。</p> 
<p>安装pipenv环境：</p> 
<pre><code class="language-python">pip install pipenv</code></pre> 
<p>在虚拟环境中安装python，不指定版本则会默认安装： </p> 
<pre><code class="language-python">pip install</code></pre> 
<p>进入虚拟环境：</p> 
<pre><code class="language-python">pipenv shell</code></pre> 
<p>在虚拟环境中安装要用到的各种包：</p> 
<pre><code class="language-python">pip install xxx</code></pre> 
<p>查看当前虚拟环境中包的数量：</p> 
<pre><code class="language-python">pip list</code></pre> 
<p>确认需要的所有包都安装完成后，再使用前面的方法进行打包操作：</p> 
<pre><code class="language-python">pyinstaller -F xxx.py</code></pre> 
<h3>(2)使用UPX压缩降低打包文件大小</h3> 
<blockquote> 
 <p>upx (the Ultimate Packer for eXecutables)是一款先进的可执行<a href="https://baike.baidu.com/item/%E7%A8%8B%E5%BA%8F%E6%96%87%E4%BB%B6/10510952?fromModule=lemma_inlink" rel="nofollow" title="程序文件">程序文件</a>压缩器，压缩过的<a href="https://baike.baidu.com/item/%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/2885816?fromModule=lemma_inlink" rel="nofollow" title="可执行文件">可执行文件</a>体积缩小50%-70% ，这样减少了磁盘<a href="https://baike.baidu.com/item/%E5%8D%A0%E7%94%A8%E7%A9%BA%E9%97%B4/5891606?fromModule=lemma_inlink" rel="nofollow" title="占用空间">占用空间</a>、网络上传下载的时间和其它分布以及存储费用（百度百科）</p> 
</blockquote> 
<p>虽然话是这么说，但实际上在使用时往往会发现UPX可能只能减少很有限的大小，还是需要去尝试一下看看效果。</p> 
<p>pyinstaller在进行打包时自动会检测调用UPX，一般情况下UPX是缺失的，需要我们手动下载。在使用pyinstaller进行打包时指定其目录即可，例如下载到E盘，E:\UPX，在打包时的语句如下：</p> 
<pre><code>pyinstaller -F -i xxx.ico xxx.py --upx-dir E:\UPX\</code></pre> 
<p>UPX的官方下载网站如下： </p> 
<p><a class="link-info has-card" href="https://upx.github.io/" rel="nofollow" title="点击打开UPX下载网站"><span class="link-card-box"><span class="link-title">点击打开UPX下载网站</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/3f/96/n9ZBbnPI_o.png" alt="icon-default.png?t=N7T8">https://upx.github.io/</span></span></a></p> 
<p>当然，以上只是两种主流解决办法，网络上还有很多方法，例如使用pyinstaller的docker镜像打包，如果使用上述两种方法没有解决问题的话还可以去网上查阅。 </p> 
<h2>6.问题记录</h2> 
<h3>使用pyinstaller打包时报毒（2024/5/31）</h3> 
<p>今天在打包时发现被防火墙拦截了，使用的是pyinstaller -F -w xxx.py的语句，经检查发现使用-w去除控制台后才会被拦截，如果不使用-w，使用pyinstaller -F 的语句就不会报毒；还有一种方式是去尝试或降低版本，可能就能够解决这个问题。</p> 
<p></p> 
<h2>想要了解更多，可以查阅官方中文文档：</h2> 
<p><a class="link-info has-card" href="https://muzing.gitbook.io/pyinstaller-docs-zh-cn" rel="nofollow" title="Pyinstaller中文文档"><span class="link-card-box"><span class="link-title">Pyinstaller中文文档</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/8b/3c/Eq3zQ1EP_o.png" alt="icon-default.png?t=N7T8">https://muzing.gitbook.io/pyinstaller-docs-zh-cn</span></span></a></p> 
<p><u><em><strong>后续也会分享更多有用的知识，有什么问题都可以在评论区中指出来，感谢各位支持！</strong> </em></u></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/59754cd70313cdf6cc490899e47cf7c7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43; | 委托构造函数】委托构造函数 详解 及 例子源码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba76db743625337b05c915b1f09d9692/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI绘画：Stable Diffusion WebUI与ComfyUI该怎么选？一文对比优缺点</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>