<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>鸿蒙NEXT实战开发： 依据前端对http请求进行二次简单封装 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/20a51e01b08afedf9f7bd0677cac2295/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="鸿蒙NEXT实战开发： 依据前端对http请求进行二次简单封装">
  <meta property="og:description" content="一、为什么要对http请求进行封装？ 在我看来二次封装有一下几点好处
代码封装之后，开发人员只用关注业务层面的东西，不用去过多浪费时间在接口请求数据处理上。封装之后代码更加简洁，通俗易懂，方便后期维护，统一管理。对经验不足的开发人员友好，只需要依葫芦画瓢，参照之前的例子就可以进行开发。随着团队规模变大，代码封装之后，减少代码冗余，防止屎山代码。统一处理token修改配置项，统一对数据错误和数据返回进行处理提示等。 二、注意事项 使用HTTP数据请求需要申请ohos.permission.INTERNET权限权，限申请请参考访问控制（权限）开发指导。此次封装功能并没有像axios 里面一样有响应拦截器和请求拦截前。没有取消重复请求、错误请求重连的功能,所以只适合较小的项目。 三、开始进行封装 1. 创建请求实体类 在ets/common/utils下创建文件request.ets
import http from &#39;@ohos.net.http&#39;; export interface httpConfig{ url:string; method:http.RequestMethod; timeOut?: number; data?: string | Object | ArrayBuffer; header?: Object; expectDataType?: http.HttpDataType; } interface HttpResponse{ code:string|number; message:string; data:string|Object|unknown[] } export default (config: httpConfig): Promise&lt;HttpResponse&gt;=&gt; { // 创建请求实例 const service = http.createHttp(); } 2. 对请求实体类进行 Promise 封装 这里面加入了Authorization 身份信息、 Content-Type响应方式、connectTimeout连接超时等 自己需要根据实际业务情况更换
import http from &#39;@ohos.net.http&#39;; export interface httpConfig{ url:string; method:http.RequestMethod; timeOut?: number; data?">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-21T16:55:49+08:00">
    <meta property="article:modified_time" content="2024-06-21T16:55:49+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">鸿蒙NEXT实战开发： 依据前端对http请求进行二次简单封装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4> 一、为什么要对http请求进行封装？</h4> 
<p>在我看来二次封装有一下几点好处</p> 
<ul><li>代码封装之后，开发人员只用关注业务层面的东西，不用去过多浪费时间在接口请求数据处理上。</li><li>封装之后代码更加简洁，通俗易懂，方便后期维护，统一管理。</li><li>对经验不足的开发人员友好，只需要依葫芦画瓢，参照之前的例子就可以进行开发。</li><li>随着团队规模变大，代码封装之后，减少代码冗余，防止屎山代码。</li><li>统一处理token修改配置项，统一对数据错误和数据返回进行处理提示等。</li></ul> 
<h4>二、注意事项</h4> 
<ul><li>使用HTTP数据请求需要申请ohos.permission.INTERNET权限权，限申请请参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V2%2Faccesstoken-guidelines-0000001493744016-V2" rel="nofollow" title="访问控制（权限）开发指导">访问控制（权限）开发指导</a>。</li><li>此次封装功能并没有像axios 里面一样有响应拦截器和请求拦截前。</li><li>没有取消重复请求、错误请求重连的功能,所以只适合较小的项目。</li></ul> 
<h4>三、开始进行封装</h4> 
<h6>1. 创建请求实体类</h6> 
<p>在ets/common/utils下创建文件request.ets</p> 
<pre><code class="hljs">
import http from '@ohos.net.http';

export  interface  httpConfig{
  url:string;
  method:http.RequestMethod;
  timeOut?: number;
  data?: string | Object | ArrayBuffer;
  header?: Object;
  expectDataType?: http.HttpDataType;
}
interface HttpResponse{
   code:string|number;
   message:string;
   data:string|Object|unknown[]
}

export default  (config: httpConfig): Promise&lt;HttpResponse&gt;=&gt; {
  // 创建请求实例
  const service = http.createHttp();


}
</code></pre> 
<h6>2. 对请求实体类进行 Promise 封装</h6> 
<p>这里面加入了Authorization 身份信息、 Content-Type响应方式、connectTimeout连接超时等 自己需要根据实际业务情况更换</p> 
<pre><code class="hljs">
import http from '@ohos.net.http';

export  interface  httpConfig{
  url:string;
  method:http.RequestMethod;
  timeOut?: number;
  data?: string | Object | ArrayBuffer;
  header?: Object;
  expectDataType?: http.HttpDataType;
}
interface HttpResponse{
   code:string|number;
   message:string;
   data:string|Object|unknown[]
}

export default  (config: httpConfig): Promise&lt;HttpResponse&gt;=&gt; {
  // 创建请求实例
  const service = http.createHttp();
  //请求地址
  const url ='http://XXX.XXX' +config.url;

  return new Promise((resolve, reject) =&gt; {
    service.request(
      url,
      {
        method: config.method,
        expectDataType: config.expectDataType, //数据类型
        header: {
          "Content-Type":"application/json",
          //header中存放身份信息
          Authorization:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
          ...config.header,
        },
        extraData: config.data,
        readTimeout:config.timeOut|| 50000,
        connectTimeout:config.timeOut|| 50000
      },
      (err, response)=&gt;{
        if (!err &amp;&amp; response.responseCode === 200) { //请求200
          if (typeof response.result === 'string') {
            const resData=  JSON.parse(response.result)
            if(resData.code==2001){ //接口状态成功
              resolve(resData)
            }else{
              // 接口约定好的状态码 例如登录过期 等等
              reject(response)
            }
          } else {
            //接口返回数据异常
            reject(response)
          }
        } else {
          // 状态码异常 例如 404 502 503 等等
          // 请求失败通常是后端问题或者网络问题
          reject(response)
        }
       }
    )
  })


}
</code></pre> 
<h6>3. 封装一个公共提示框</h6> 
<p></p> 
<p>                                     <img alt="" height="95" src="https://images2.imgbox.com/b3/68/nglJEAxk_o.png" width="265"></p> 
<p>在 ets/common/utils 下创建文件DialogUtils.ets 内容如下</p> 
<pre><code class="hljs">

/**
 * This is a pop-up window tool class, which is used to encapsulate dialog code.
 * Developers can directly invoke the methods in.
 */
export class DialogUtils {
  /**
   * 轻提示
   */
  toast(content:{message:string}) {
    AlertDialog.show({
      message: content.message,
      alignment: DialogAlignment.Center,
      primaryButton: {
        value: '取消',
        action: () =&gt; {

        }
      },
      secondaryButton: {
        value: '确认',
        action: () =&gt; {
        }
      }
    });
  }


}

export default new DialogUtils();
</code></pre> 
<h6>4. 在请求里面多错误状态进行相应判断处理提示</h6> 
<pre><code class="hljs">
import http from '@ohos.net.http';
import  DialogUtils from "./DialogUtils"
export  interface  httpConfig{
  url:string;
  method:http.RequestMethod;
  timeOut?: number;
  data?: string | Object | ArrayBuffer;
  header?: Object;
  expectDataType?: http.HttpDataType;
}
interface HttpResponse{
   code:string|number;
   message:string;
   data:string|Object|unknown[]
}

export default  (config: httpConfig): Promise&lt;HttpResponse&gt;=&gt; {
  // 创建请求实例
  const service = http.createHttp();
  //请求地址
  const url ='http://XXX.XXX' +config.url;

  return new Promise((resolve, reject) =&gt; {
    service.request(
      url,
      {
        method: config.method,
        expectDataType: config.expectDataType, //数据类型
        header: {
          "Content-Type":"application/json",
          //header中存放身份信息
          Authorization:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
          ...config.header,
        },
        extraData: config.data,
        readTimeout:config.timeOut|| 50000,
        connectTimeout:config.timeOut|| 50000
      },
      (err, response)=&gt;{
        if (!err &amp;&amp; response.responseCode === 200) { //请求200
          if (typeof response.result === 'string') {
            const resData=  JSON.parse(response.result)
            if(resData.code==2001){ //接口状态成功
              resolve(resData)
            }else{
              // 接口约定好的状态码 例如登录过期 等等
              DialogUtils.toast({message:'身份信息已失效,请重新登录'})
              reject(response)
            }
          } else {
            //接口返回数据异常
            DialogUtils.toast({message:'网络请求错误,请稍后再试'})
            reject(response)
          }
        } else {
          // 状态码异常 例如 404 502 503 等等
          // 请求失败通常是后端问题或者网络问题
          checkStatus(response.responseCode)
          reject(response)
        }
       }
    )
  })

 function  checkStatus(status: number): void {
  let errMessage = '';
  switch (status) {
    case 400:
      errMessage =  '网络请求超时!';
      break;
    case 401:
      errMessage =  '用户没有权限（令牌、用户名、密码错误）!';
      break;
    case 403:
      errMessage = '用户得到授权，但是访问是被禁止的!';
      break;
    case 404:
      errMessage = '网络请求错误,未找到该资源!';
      break;
    case 405:
      errMessage = '网络请求错误,请求方法未允许!';
      break;
    case 408:
      errMessage = '网络请求超时!';
      break;
    case 500:
      errMessage = '服务器错误,请联系管理员!';
      break;
    case 501:
      errMessage = '网络未实现!';
      break;
    case 502:
      errMessage = '网络错误!';
      break;
    case 503:
      errMessage = '服务不可用，服务器暂时过载或维护!';
      break;
    case 504:
      errMessage = '网络超时!';
      break;
    case 505:
      errMessage = 'http版本不支持该请求!';
      break;
    default:
  }

  if (errMessage) {
    // 进行错误提示
    console.log('errMessage',errMessage)
    DialogUtils.toast({message:errMessage})
  }
}

}
</code></pre> 
<p></p> 
<h6>5. 封装业务接口</h6> 
<p>在ets/common/api下创建文件 index.ets 自己要根据实际业务进行调整这里只是示例 ，我在这里封装了一个 GET 一个POST 请求。</p> 
<pre><code class="hljs">import request from "../utils/request";
import http from '@ohos.net.http';
// 数据列表
export const listByCondition = (data:Record&lt;string, string|number&gt;) =&gt; {
  return request({
    url: "/wms/isoftstone-form-onlineoperation/listByCondition",
    method: http.RequestMethod.POST,
    data:data
  });
};
// 字典列表
export const dictList = (data:Record&lt;string, string|number&gt;) =&gt; {
  return request({
    url: "/wms/dict/list2",
    method: http.RequestMethod.GET,
    data:data
  });
};
</code></pre> 
<h6>6. 项目中使用且请求接口</h6> 
<p></p> 
<p>                                            <img alt="" height="300" src="https://images2.imgbox.com/ac/4e/Ris7kvyt_o.png" width="271"></p> 
<p>在ets/pages/Index.ets 页面写入以下代码进行测试</p> 
<pre><code class="hljs">import  {listByCondition,dictList} from "../common/api/index"

@Entry
@Component
struct Index {
  @State listData:unknown[] = [];//数据列表
  @State dicData:unknown[] = [];//字典列表
  // 获取数据列表
  async  getListByCondition(){
    let res = await listByCondition({
      "tableName":"cd_warehouse",
      "columnName":"park_code",
      "columnValue":"DCYQ01",
      "filterType":1
    });
    this.listData = res.data as unknown[];
  };
  // 获取字典
  async getDictList(){
    let res = await dictList({
      "code":"SYS_WMS_WORK_TYPE",
    });
    this.dicData = res.data as unknown[];
  };

  onPageShow(){
    this.getListByCondition();
    this.getDictList();
  };

  build() {
    Column(){
      Column(){
        ForEach(this.listData, (item) =&gt; {
          Row(){
            Text(item.wh_code)
            Text(item.cdwh_name)
          }
        })
      }
      Column(){
        ForEach(this.dicData, (item) =&gt; {
          Row(){
            Text(item.value)
            Text(item.label)
          }
        })
      }
    }
    .height('100%')
  }
}
</code></pre> 
<p>到这里对http请求二次封装就已经基本完成，本文只做了一些简单封装，主要是按照前端开发习惯进行封装，大家有需要可以参考学习。</p> 
<p><br><br><strong>最后</strong></p> 
<p>有很多小伙伴不知道学习哪些鸿蒙开发技术？不知道需要重点掌握哪些鸿蒙应用开发知识点？但是又不知道从哪里下手，而且学习时频繁踩坑，最终浪费大量时间。所以本人整理了一些比较合适的鸿蒙<strong>（HarmonyOS NEXT）</strong>学习路径和一些资料的整理供小伙伴学习</p> 
<p><strong>点击领取→</strong><a href="https://docs.qq.com/doc/DZVVBYlhuRkZQZlB3" rel="nofollow" title="纯血鸿蒙Next全套最新学习资料">纯血鸿蒙Next全套最新学习资料</a><strong>（安全链接，放心点击</strong>）</p> 
<p><strong>希望这一份鸿蒙学习资料能够给大家带来帮助，有需要的小伙伴自行领取，限时开源，先到先得~无套路领取！！</strong></p> 
<div> 
 <div> 
  <p style="margin-left:0;text-align:left;"><span style="color:#000000;"><strong><span style="color:#ff0000;">一、</span></strong></span><span style="color:#fe2c24;"><strong>鸿蒙（HarmonyOS NEXT）最新学习路线</strong></span></p> 
 </div> 
</div> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/d1/b7/FfO0gP99_o.png" width="1200">​</p> 
<p><strong>有了路线图，怎么能没有学习资料呢，小编也准备了一份联合鸿蒙官方发布笔记整理收纳的一套系统性的鸿蒙（OpenHarmony ）学习手册（共计1236页）与鸿蒙（OpenHarmony ）开发入门教学视频，内容包含：</strong><span style="color:#fe2c24;"><strong>（ArkTS、ArkUI开发组件、Stage模型、多端部署、分布式应用开发、音频、视频、WebGL、OpenHarmony多媒体技术、Napi组件、OpenHarmony内核、Harmony南向开发、鸿蒙项目实战等等）鸿蒙（HarmonyOS NEXT）</strong></span><strong>…等技术</strong><strong>知识点。</strong></p> 
<p>获取以上完整版高清<a href="https://so.csdn.net/so/search?q=%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF&amp;spm=1001.2101.3001.7020" title="学习路线">学习路线</a>，请点击→<a href="https://docs.qq.com/doc/DU3NSUFZrUE9ZRVRC" rel="nofollow" title="纯血版全套鸿蒙HarmonyOS学习资料">纯血版全套鸿蒙HarmonyOS学习资料</a></p> 
<p><span style="color:#fe2c24;"><strong>二、HarmonyOS Next 最新全套视频教程</strong></span></p> 
<p><img alt="" height="804" src="https://images2.imgbox.com/6b/82/3pwxXV7N_o.png" width="1088">​</p> 
<p></p> 
<p><span style="color:#fe2c24;"><strong>三、《鸿蒙 (OpenHarmony)开发基础到实战手册》</strong></span></p> 
<p>OpenHarmony北向、南向开发环境搭建</p> 
<p><img alt="" height="507" src="https://images2.imgbox.com/33/21/Iv91UtbN_o.png" width="1080">​</p> 
<p><strong>《鸿蒙开发基础》</strong></p> 
<ul><li>ArkTS语言</li><li>安装DevEco Studio</li><li>运用你的第一个ArkTS应用</li><li>ArkUI声明式UI开发</li><li>.……<img alt="" height="384" src="https://images2.imgbox.com/7a/f1/VCSt9wd3_o.png" width="720">​</li></ul> 
<p><strong>《鸿蒙开发进阶》</strong></p> 
<ul><li>Stage模型入门</li><li>网络管理</li><li>数据管理</li><li>电话服务</li><li>分布式应用开发</li><li>通知与窗口管理</li><li>多媒体技术</li><li>安全技能</li><li>任务管理</li><li>WebGL</li><li>国际化开发</li><li>应用测试</li><li>DFX面向未来设计</li><li>鸿蒙系统移植和裁剪定制</li><li>……</li></ul> 
<p><img alt="" height="357" src="https://images2.imgbox.com/53/bb/5fwCUM9q_o.png" width="720">​</p> 
<p><strong>《鸿蒙进阶实战》</strong></p> 
<ul><li>ArkTS实践</li><li>UIAbility应用</li><li>网络案例</li><li>……</li></ul> 
<p><img alt="" height="357" src="https://images2.imgbox.com/43/c3/ab8VlmOw_o.png" width="720">​</p> 
<p><span style="color:#fe2c24;">四、大厂面试必问面试题</span></p> 
<p><img alt="" height="171" src="https://images2.imgbox.com/5d/75/LVfRUxy1_o.png" width="637">​</p> 
<p><span style="color:#fe2c24;">五、鸿蒙南向开发技术</span></p> 
<p><img alt="" height="245" src="https://images2.imgbox.com/c1/d9/WrhDPiU6_o.png" width="618">​</p> 
<p><span style="color:#fe2c24;">六、鸿蒙APP开发必备</span></p> 
<p><img alt="" height="176" src="https://images2.imgbox.com/73/51/Cv1WS0NF_o.png" width="621">​</p> 
<p><span style="color:#fe2c24;"><strong>七、鸿蒙生态应用开发白皮书V2.0PDF</strong></span></p> 
<p><img alt="" src="https://images2.imgbox.com/f8/a5/zsr0WAvy_o.png">​</p> 
<p><br><strong>完整鸿蒙HarmonyOS学习资料，请点击→<strong><a href="https://docs.qq.com/doc/DU3NSUFZrUE9ZRVRC" rel="nofollow" title="纯血版全套鸿蒙HarmonyOS学习资料">纯血版全套鸿蒙HarmonyOS学习资料</a></strong></strong></p> 
<p><strong><strong>总结<br> 总的来说，华为鸿蒙不再兼容安卓，对中年程序员来说是一个挑战，也是一个机会。只有积极应对变化，不断学习和提升自己，他们才能在这个变革的时代中立于不败之地。 </strong></strong></p> 
<p>                        <img alt="" height="187" src="https://images2.imgbox.com/3e/36/uU3jVaMH_o.png" width="486"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b05de7e7ba06f3781058936449a3c99e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Stable Diffusion使用技巧｜夏至节气海报</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6cc3912085c5f4efe23e7ecaf1b8e55f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java 抽象类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>