<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Androidæ‰“é€ ä¸æ»‘çš„Activity recreateé‡å»ºï¼ˆä¸»é¢˜åˆ‡æ¢ï¼‰è¿‡æ¸¡åŠ¨ç”» - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2a48618e9d2276198c193fdcdcb65db7/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="Androidæ‰“é€ ä¸æ»‘çš„Activity recreateé‡å»ºï¼ˆä¸»é¢˜åˆ‡æ¢ï¼‰è¿‡æ¸¡åŠ¨ç”»">
  <meta property="og:description" content="å‰è¨€ å½“åº”ç”¨ç¨‹åºæ”¯æŒå¤šç§è¯­è¨€æˆ–ä¸»é¢˜æ—¶ï¼Œåˆ‡æ¢è¯­è¨€æˆ–ä¸»é¢˜é€šå¸¸éœ€è¦é‡æ–°å¯åŠ¨ Activity ä»¥é‡æ–°åŠ è½½é…ç½®ã€‚è™½ç„¶ recreate æ˜¯ä¸€ç§å¸¸ç”¨çš„é‡å»º Activity æ–¹æ³•ï¼Œä½†å®ƒä¸æ”¯æŒåƒåœ¨ Activity ä¹‹é—´åˆ‡æ¢æ—¶é‚£æ ·ä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»ã€‚ç‰¹åˆ«æ˜¯åœ¨åˆ‡æ¢ æµ…è‰²/æ·±è‰² ä¸»é¢˜æ—¶ï¼Œç”±äºç¼ºä¹è¿‡æ¸¡åŠ¨ç”»è€Œæ˜¾å¾—å¾ˆç”Ÿç¡¬ã€‚ä¸ºäº†æå‡æ”¹å–„è¿™ä¸€ç‚¹ï¼Œåªèƒ½è‡ªå·±å®ç°è¿‡æ¸¡åŠ¨ç”»ä»¥æä¾›æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚
ä¸€å¼€å§‹ï¼Œæˆ‘è€ƒè™‘åœ¨ä¿å­˜çŠ¶æ€æ—¶ä½¿ç”¨ onSaveInstanceState å°† activity.window.decorView ç»˜åˆ¶æˆä½å›¾å¹¶ä¿å­˜åˆ° outState ä¸­ã€‚ç„¶ååœ¨ onCreate ä¸­è¯»å–è¯¥ä½å›¾ï¼Œå¹¶é€šè¿‡ WindowManager åœ¨æ•´ä¸ªå±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªé“ºæ»¡çš„ ImageViewï¼Œå°†ä½å›¾æ˜¾ç¤ºåœ¨ ImageView ä¸Šå¹¶æ‰§è¡ŒåŠ¨ç”»ã€‚ç„¶è€Œï¼Œæˆ‘å°è¯•åå‘ç° WindowManager çš„æ˜¾ç¤ºä¼šæ¯” Activity æ™šä¸€äº›ï¼Œå¯¼è‡´å‡ºç°äº†é—ªå±çš„æƒ…å†µã€‚
åœ¨æˆ‘ç»§ç»­æ€è€ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¶ç„¶å‘ç°äº†ä¸€ç¯‡åšå®¢ï¼šChange Theme Dynamically with Circular Reveal Animation on Androidã€‚åŸæ¥æˆ‘ä¸å¤§ä½¬çš„æƒ³æ³•åªæœ‰ä¸€æ­¥ä¹‹å·®ã€‚è¯¥åšå®¢ä¸­çš„æ–¹æ³•æ˜¯åœ¨ Activity çš„å¸ƒå±€ä¸­æ·»åŠ ä¸€ä¸ªé“ºæ»¡å…¨å±çš„ ImageViewï¼Œå¹¶å°†å…¶ visibility è®¾ç½®ä¸º goneã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨éœ€è¦æ—¶å°†ä½å›¾æ˜¾ç¤ºåœ¨ ImageView ä¸Šï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ WindowManagerã€‚æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ€ä¹ˆæ²¡æƒ³åˆ°å‘¢ï¼ğŸŒŸ
æ•ˆæœ åºŸè¯ä¸å¤šè¯´ï¼Œä»¥ä¸‹æ˜¯ Demo å®ç°çš„æ•ˆæœ
Demoæºç æ”¾åœ¨äº†æœ€ä¸‹é¢
æ­¥éª¤ å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š
è®¾ç½®Activityä¸ºå…¨å±æ˜¾ç¤º
ç¡®ä¿Activityå æ®æ•´ä¸ªå±å¹•ç©ºé—´ï¼Œå»é™¤çŠ¶æ€æ å’Œå¯¼èˆªæ çš„å½±å“ã€‚æ·»åŠ éšè—çš„ImageView
åœ¨ActivityåŸæœ‰çš„å¸ƒå±€é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªå æ»¡å…¨å±çš„ImageViewï¼Œé»˜è®¤éšè—ã€‚
ç”¨äºåœ¨ä¸»é¢˜åˆ‡æ¢åæ˜¾ç¤ºActivityé‡å»ºå‰ä¿å­˜çš„Bitmapä¿®æ”¹ä¸»é¢˜åä¿å­˜çŠ¶æ€å¹¶é‡å»ºactivity
å½“ç”¨æˆ·åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œå…ˆå°†å½“å‰Activityçš„decorViewç»˜åˆ¶ä¸ºBitmapä¿å­˜åˆ°çŠ¶æ€
recreateé‡æ–°åˆ›å»ºActivityä»¥æ›´æ–°ä¸»é¢˜activityé‡å¯åé€šè¿‡ä¿å­˜çš„çŠ¶æ€æ‰§è¡ŒåŠ¨ç”»
åœ¨Activityé‡å»ºåï¼Œé€šè¿‡ä¹‹å‰ä¿å­˜çš„çŠ¶æ€æ¢å¤ç•Œé¢å†…å®¹å¹¶æ‰§è¡Œæ­éœ²åŠ¨ç”» å°†Activityè®¾ç½®ä¸ºå…¨å± æˆ‘è¿™é‡Œä½¿ç”¨ä¸€ä¸ªBaseActivityæ¥ä½œä¸ºåŸºç¡€activityï¼Œå®ç°äº†ä¸»é¢˜é…ç½®çš„åŠ è½½å’Œactivityå…¨å±çš„è®¾ç½®
/** * åŸºç¡€ Activity * å®ç°äº†åŠ è½½æœ¬åœ°é…ç½®çš„ä¸»é¢˜å’Œè¯­è¨€ * @author Thousand-Dust */ abstract class BaseActivity : AppCompatActivity() { override fun attachBaseContext(newBase: Context) { // åŠ è½½æœ¬åœ°é…ç½®çš„ä¸»é¢˜ val theme = AppGlobals.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-19T13:36:46+08:00">
    <meta property="article:modified_time" content="2024-02-19T13:36:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Androidæ‰“é€ ä¸æ»‘çš„Activity recreateé‡å»ºï¼ˆä¸»é¢˜åˆ‡æ¢ï¼‰è¿‡æ¸¡åŠ¨ç”»</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>å‰è¨€</h3> 
<p>å½“åº”ç”¨ç¨‹åºæ”¯æŒå¤šç§è¯­è¨€æˆ–ä¸»é¢˜æ—¶ï¼Œåˆ‡æ¢è¯­è¨€æˆ–ä¸»é¢˜é€šå¸¸éœ€è¦é‡æ–°å¯åŠ¨ <em>Activity</em> ä»¥é‡æ–°åŠ è½½é…ç½®ã€‚è™½ç„¶ <em>recreate</em> æ˜¯ä¸€ç§å¸¸ç”¨çš„é‡å»º Activity æ–¹æ³•ï¼Œä½†å®ƒä¸æ”¯æŒåƒåœ¨ Activity ä¹‹é—´åˆ‡æ¢æ—¶é‚£æ ·ä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»ã€‚ç‰¹åˆ«æ˜¯åœ¨åˆ‡æ¢ <em>æµ…è‰²/æ·±è‰²</em> ä¸»é¢˜æ—¶ï¼Œç”±äºç¼ºä¹è¿‡æ¸¡åŠ¨ç”»è€Œæ˜¾å¾—å¾ˆç”Ÿç¡¬ã€‚ä¸ºäº†æå‡æ”¹å–„è¿™ä¸€ç‚¹ï¼Œåªèƒ½è‡ªå·±å®ç°è¿‡æ¸¡åŠ¨ç”»ä»¥æä¾›æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚</p> 
<p>ä¸€å¼€å§‹ï¼Œæˆ‘è€ƒè™‘åœ¨ä¿å­˜çŠ¶æ€æ—¶ä½¿ç”¨ <em>onSaveInstanceState</em> å°† activity.window.decorView ç»˜åˆ¶æˆä½å›¾å¹¶ä¿å­˜åˆ° outState ä¸­ã€‚ç„¶ååœ¨ onCreate ä¸­è¯»å–è¯¥ä½å›¾ï¼Œå¹¶é€šè¿‡ <em>WindowManager</em> åœ¨æ•´ä¸ªå±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªé“ºæ»¡çš„ ImageViewï¼Œå°†ä½å›¾æ˜¾ç¤ºåœ¨ ImageView ä¸Šå¹¶æ‰§è¡ŒåŠ¨ç”»ã€‚ç„¶è€Œï¼Œæˆ‘å°è¯•åå‘ç° WindowManager çš„æ˜¾ç¤ºä¼šæ¯” Activity æ™šä¸€äº›ï¼Œå¯¼è‡´å‡ºç°äº†é—ªå±çš„æƒ…å†µã€‚</p> 
<p>åœ¨æˆ‘ç»§ç»­æ€è€ƒçš„è¿‡ç¨‹ä¸­ï¼Œå¶ç„¶å‘ç°äº†ä¸€ç¯‡åšå®¢ï¼š<a href="https://proandroiddev.com/change-theme-dynamically-with-circular-reveal-animation-on-android-8cd574f5f0d8" rel="nofollow">Change Theme Dynamically with Circular Reveal Animation on Android</a>ã€‚åŸæ¥æˆ‘ä¸å¤§ä½¬çš„æƒ³æ³•åªæœ‰ä¸€æ­¥ä¹‹å·®ã€‚è¯¥åšå®¢ä¸­çš„æ–¹æ³•æ˜¯åœ¨ <strong>Activity çš„å¸ƒå±€ä¸­æ·»åŠ ä¸€ä¸ªé“ºæ»¡å…¨å±çš„ ImageView</strong>ï¼Œå¹¶å°†å…¶ visibility è®¾ç½®ä¸º goneã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨éœ€è¦æ—¶å°†ä½å›¾æ˜¾ç¤ºåœ¨ ImageView ä¸Šï¼Œè€Œä¸éœ€è¦ä½¿ç”¨ WindowManagerã€‚æç„¶å¤§æ‚Ÿï¼Œæˆ‘æ€ä¹ˆæ²¡æƒ³åˆ°å‘¢ï¼ğŸŒŸ</p> 
<h3><a id="_6"></a>æ•ˆæœ</h3> 
<p>åºŸè¯ä¸å¤šè¯´ï¼Œä»¥ä¸‹æ˜¯ Demo å®ç°çš„æ•ˆæœ<br> <img src="https://images2.imgbox.com/37/00/DTR2moV9_o.gif" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°" width="380"></p> 
<p><strong>Demoæºç æ”¾åœ¨äº†æœ€ä¸‹é¢</strong></p> 
<h2><a id="_11"></a>æ­¥éª¤</h2> 
<p>å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p> 
<ol><li><strong>è®¾ç½®Activityä¸ºå…¨å±æ˜¾ç¤º</strong><br> ç¡®ä¿Activityå æ®æ•´ä¸ªå±å¹•ç©ºé—´ï¼Œå»é™¤çŠ¶æ€æ å’Œå¯¼èˆªæ çš„å½±å“ã€‚</li><li><strong>æ·»åŠ éšè—çš„ImageView</strong><br> åœ¨ActivityåŸæœ‰çš„å¸ƒå±€é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªå æ»¡å…¨å±çš„ImageViewï¼Œé»˜è®¤éšè—ã€‚<br> ç”¨äºåœ¨ä¸»é¢˜åˆ‡æ¢åæ˜¾ç¤ºActivityé‡å»ºå‰ä¿å­˜çš„Bitmap</li><li><strong>ä¿®æ”¹ä¸»é¢˜åä¿å­˜çŠ¶æ€å¹¶é‡å»ºactivity</strong><br> å½“ç”¨æˆ·åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œå…ˆå°†å½“å‰Activityçš„decorViewç»˜åˆ¶ä¸ºBitmapä¿å­˜åˆ°çŠ¶æ€<br> recreateé‡æ–°åˆ›å»ºActivityä»¥æ›´æ–°ä¸»é¢˜</li><li><strong>activityé‡å¯åé€šè¿‡ä¿å­˜çš„çŠ¶æ€æ‰§è¡ŒåŠ¨ç”»</strong><br> åœ¨Activityé‡å»ºåï¼Œé€šè¿‡ä¹‹å‰ä¿å­˜çš„çŠ¶æ€æ¢å¤ç•Œé¢å†…å®¹å¹¶æ‰§è¡Œæ­éœ²åŠ¨ç”»</li></ol> 
<h3><a id="Activity_23"></a>å°†Activityè®¾ç½®ä¸ºå…¨å±</h3> 
<p>æˆ‘è¿™é‡Œä½¿ç”¨ä¸€ä¸ªBaseActivityæ¥ä½œä¸ºåŸºç¡€activityï¼Œå®ç°äº†ä¸»é¢˜é…ç½®çš„åŠ è½½å’Œactivityå…¨å±çš„è®¾ç½®</p> 
<pre><code class="prism language-kotlin"><span class="token comment">/**
 * åŸºç¡€ Activity
 * å®ç°äº†åŠ è½½æœ¬åœ°é…ç½®çš„ä¸»é¢˜å’Œè¯­è¨€
 * @author Thousand-Dust
 */</span>
<span class="token keyword">abstract</span> <span class="token keyword">class</span> BaseActivity <span class="token operator">:</span> <span class="token function">AppCompatActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">attachBaseContext</span><span class="token punctuation">(</span>newBase<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// åŠ è½½æœ¬åœ°é…ç½®çš„ä¸»é¢˜</span>
        <span class="token keyword">val</span> theme <span class="token operator">=</span> AppGlobals<span class="token punctuation">.</span><span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        delegate<span class="token punctuation">.</span>localNightMode <span class="token operator">=</span> theme<span class="token punctuation">.</span>mode

<span class="token comment">//        val config = newBase.resources.configuration</span>
        <span class="token comment">// åŠ è½½æœ¬åœ°é…ç½®çš„è¯­è¨€</span>
<span class="token comment">//        val language = AppGlobals.getLanguage()</span>
<span class="token comment">//        config.setLocale(language.locale)</span>
<span class="token comment">//        val context = newBase.createConfigurationContext(config)</span>
<span class="token comment">//        super.attachBaseContext(context)</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">attachBaseContext</span><span class="token punctuation">(</span>newBase<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token comment">// Activityå…¨å±æ˜¾ç¤ºï¼Œéšè—çŠ¶æ€æ å’Œå¯¼èˆªæ </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>R<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            window<span class="token punctuation">.</span><span class="token function">setDecorFitsSystemWindows</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            window<span class="token punctuation">.</span>decorView<span class="token punctuation">.</span>systemUiVisibility <span class="token operator">=</span> window<span class="token punctuation">.</span>decorView<span class="token punctuation">.</span>systemUiVisibility <span class="token operator">or</span>
                    View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_STABLE <span class="token operator">or</span>
                    View<span class="token punctuation">.</span>SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION
        <span class="token punctuation">}</span>
        window<span class="token punctuation">.</span>statusBarColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>TRANSPARENT
        window<span class="token punctuation">.</span>navigationBarColor <span class="token operator">=</span> Color<span class="token punctuation">.</span>TRANSPARENT
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="ActivityImageView_65"></a>åœ¨ActivityåŸæœ‰çš„å¸ƒå±€é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªéšè—çš„ImageView</h3> 
<p>éšä¾¿å†™çš„å¸ƒå±€ï¼Œåªéœ€è¦å…³æ³¨ClipImageViewå°±å¥½äº†</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.appcompat.widget.Toolbar</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/toolbar<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/app_name<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?attr/colorPrimary<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>paddingTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>menu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@menu/main_menu<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/textView<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Hello World!<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.355<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>48dp<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Hello World!<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/textView<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.td.demoactivityrecreatetransition.ClipImageView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/iv_transition<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>å¸ƒå±€çš„æ˜¾ç¤ºæ•ˆæœ<br> <img src="https://images2.imgbox.com/79/f4/s3GOPbnd_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="380"></p> 
<p>ClipImageViewæ˜¯æˆ‘ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨åŠ¨ç”»å®ç°çš„ä¸€ä¸ªç»§æ‰¿è‡ªImageViewçš„è‡ªå®šä¹‰Viewï¼Œåœ¨åé¢æ‰§è¡ŒåŠ¨ç”»æ—¶ç”¨åˆ°</p> 
<pre><code class="prism language-kotlin"><span class="token comment">/**
 * å¯ä»¥è£åˆ‡çš„ImageView
 * @author Thousand-Dust
 */</span>
<span class="token keyword">class</span> ClipImageView <span class="token operator">:</span> androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>widget<span class="token punctuation">.</span><span class="token function">AppCompatImageView</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * è£åˆ‡ç±»å‹
     */</span>
    <span class="token keyword">enum</span> <span class="token keyword">class</span> ClipType <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * åœ†å½¢
         */</span>
        CIRCLE<span class="token punctuation">,</span>
        <span class="token comment">/**
         * åœ†å½¢ï¼ˆåå‘è£åˆ‡ï¼‰
         */</span>
        CIRCLE_REVERSE<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è£åˆ‡ç±»å‹
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> clipType <span class="token operator">=</span> ClipType<span class="token punctuation">.</span>CIRCLE

    <span class="token comment">/**
     * è£åˆ‡åŒºåŸŸ
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> clipPath <span class="token operator">=</span> <span class="token function">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> attrs<span class="token operator">:</span> AttributeSet<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">,</span> attrs<span class="token operator">:</span> AttributeSet<span class="token punctuation">,</span> defStyleAttr<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyleAttr<span class="token punctuation">)</span>

    <span class="token comment">/**
     * æ¸…ç©ºè£åˆ‡
     */</span>
    <span class="token keyword">fun</span> <span class="token function">clearClip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        clipPath<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è£åˆ‡åœ†å½¢
     * @param centerX åœ†å¿ƒX
     * @param centerY åœ†å¿ƒY
     * @param radius åŠå¾„
     * @param clipType è£åˆ‡ç±»å‹
     */</span>
    <span class="token keyword">fun</span> <span class="token function">clipCircle</span><span class="token punctuation">(</span>centerX<span class="token operator">:</span> Float<span class="token punctuation">,</span> centerY<span class="token operator">:</span> Float<span class="token punctuation">,</span> radius<span class="token operator">:</span> Float<span class="token punctuation">,</span> clipType<span class="token operator">:</span> ClipType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        clipPath<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        clipPath<span class="token punctuation">.</span><span class="token function">addCircle</span><span class="token punctuation">(</span>centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction<span class="token punctuation">.</span>CW<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>clipType <span class="token operator">=</span> clipType
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token operator">:</span> Canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clipPath<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">when</span> <span class="token punctuation">(</span>clipType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                ClipType<span class="token punctuation">.</span>CIRCLE <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// è£åˆ‡åœ†å½¢</span>
                    canvas<span class="token punctuation">.</span><span class="token function">clipPath</span><span class="token punctuation">(</span>clipPath<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>

                ClipType<span class="token punctuation">.</span>CIRCLE_REVERSE <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// åå‘è£åˆ‡åœ†å½¢</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>O<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        canvas<span class="token punctuation">.</span><span class="token function">clipOutPath</span><span class="token punctuation">(</span>clipPath<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        canvas<span class="token punctuation">.</span><span class="token function">clipPath</span><span class="token punctuation">(</span>clipPath<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op<span class="token punctuation">.</span>DIFFERENCE<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ç»˜åˆ¶å›¾ç‰‡</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>clipPath<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="activity_208"></a>ä¿®æ”¹ä¸»é¢˜åä¿å­˜çŠ¶æ€å¹¶é‡å»ºactivity</h3> 
<p>è¿™ä¸ªActivityç»§æ‰¿è‡ªä¸Šé¢å®ç°çš„BaseActivityï¼Œå› æ­¤æ— éœ€å…³å¿ƒè®¾ç½®ä¸»é¢˜å’Œactivityå…¨å±æ˜¾ç¤ºçš„é—®é¢˜ã€‚<br> MainActivity çš„ transitionRecreate æ–¹æ³•å®ç°äº†ä»¥ä¸‹æ­¥éª¤ï¼š</p> 
<ol><li>è·å–åˆ‡æ¢ä¸»é¢˜çš„ Toolbar ä¸­çš„ menu æŒ‰é’®ä¸­å¿ƒç‚¹ï¼ˆåé¢ç”¨ä½œåœ†å½¢æ­éœ²åŠ¨ç”»çš„ä¸­å¿ƒç‚¹ï¼‰</li><li>å°†å½“å‰ Activity ç»˜åˆ¶åˆ° Bitmap</li><li>å°†è¿™äº›æ•°æ®èµ‹å€¼ç»™ recreateTransitionData å±æ€§</li><li>è°ƒç”¨ recreate æ–¹æ³•å¼€å§‹é‡å»º Activity</li></ol> 
<p>åœ¨recreateè°ƒç”¨åï¼ŒonSaveInstanceState ä¼šè¢«è°ƒç”¨ä»¥ä¿å­˜çŠ¶æ€ï¼Œåœ¨è¿™é‡Œå°† recreateTransitionData å±æ€§å€¼ä¿å­˜åˆ°çŠ¶æ€ä¸­</p> 
<pre><code class="prism language-kotlin"><span class="token keyword">class</span> MainActivity <span class="token operator">:</span> <span class="token function">BaseActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> toolbar<span class="token operator">:</span> Toolbar
    <span class="token keyword">private</span> <span class="token keyword">var</span> recreateTransitionData<span class="token operator">:</span> TransitionData<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token operator">..</span><span class="token punctuation">.</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

        <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token operator">:</span> Bundle<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span>outState<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>recreateTransitionData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ä¿å­˜é‡å»ºè¿‡æ¸¡åŠ¨ç”» data åˆ°çŠ¶æ€</span>
            outState<span class="token punctuation">.</span><span class="token function">putParcelable</span><span class="token punctuation">(</span>TRANSITION_DATA_KEY<span class="token punctuation">,</span> recreateTransitionData<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * ä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»é‡å»ºï¼ˆrecreateï¼‰Activity
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">transitionRecreate</span><span class="token punctuation">(</span>type<span class="token operator">:</span> TransitionType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// è·å–åˆ‡æ¢ä¸»é¢˜menuçš„åæ ‡ï¼ˆä»¥menuçš„ä¸­å¿ƒç‚¹ä¸ºåœ†å½¢æ­éœ²åŠ¨ç”»çš„ä¸­å¿ƒç‚¹ï¼‰</span>
        <span class="token keyword">val</span> menuItemView <span class="token operator">=</span> toolbar<span class="token punctuation">.</span>menu<span class="token punctuation">.</span><span class="token function">findItem</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>menu_theme_toggle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span>
            toolbar<span class="token punctuation">.</span>findViewById<span class="token operator">&lt;</span>View<span class="token operator">&gt;</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">val</span> location <span class="token operator">=</span> <span class="token function">IntArray</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        menuItemView<span class="token punctuation">.</span><span class="token function">getLocationOnScreen</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span>
        <span class="token keyword">val</span> centerX <span class="token operator">=</span> location<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> menuItemView<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2f</span>
        <span class="token keyword">val</span> centerY <span class="token operator">=</span> location<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> menuItemView<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2f</span>
        <span class="token comment">// Activityæˆªå›¾</span>
        <span class="token keyword">val</span> screenBitmap <span class="token operator">=</span> window<span class="token punctuation">.</span>decorView<span class="token punctuation">.</span><span class="token function">drawToBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        recreateTransitionData <span class="token operator">=</span> <span class="token function">TransitionData</span><span class="token punctuation">(</span>centerX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> screenBitmap<span class="token punctuation">,</span> type<span class="token punctuation">)</span>
        <span class="token comment">// é‡å»ºActivity</span>
        <span class="token function">recreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        toolbar <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>toolbar<span class="token punctuation">)</span>
        <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>è¿˜æœ‰ä»¥ä¸Šä»£ç ç”¨åˆ°çš„ç±»ä»£ç è´´åœ¨ä¸‹è¾¹</p> 
<pre><code class="prism language-kotlin"><span class="token comment">// -------- AppGlobals.kt --------</span>
<span class="token keyword">object</span> AppGlobals <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">const</span> <span class="token keyword">val</span> THEME_KEY <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"theme"</span></span>

    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> appContext<span class="token operator">:</span> Context
        <span class="token keyword">private</span> <span class="token keyword">set</span>

    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> appConfigSP<span class="token operator">:</span> SharedPreferences

    <span class="token comment">/**
     * Applicationåˆ›å»ºæ—¶è°ƒç”¨åˆå§‹åŒ–
     */</span>
    <span class="token keyword">fun</span> <span class="token keyword">init</span><span class="token punctuation">(</span>appContext<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>appContext <span class="token operator">=</span> appContext
        appConfigSP <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appContext<span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"AppConfig"</span></span><span class="token punctuation">,</span> Context<span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å–ä¸»é¢˜é…ç½®
     */</span>
    <span class="token keyword">fun</span> <span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AppTheme <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> name <span class="token operator">=</span> appConfigSP<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>THEME_KEY<span class="token punctuation">,</span> AppTheme<span class="token punctuation">.</span>AUTO<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token operator">!!</span>
        <span class="token keyword">return</span> AppTheme<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å†™å…¥ä¸»é¢˜é…ç½®
     */</span>
    <span class="token keyword">fun</span> <span class="token function">setTheme</span><span class="token punctuation">(</span>theme<span class="token operator">:</span> AppTheme<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>theme <span class="token operator">==</span> AppTheme<span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// delete theme</span>
            appConfigSP<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>THEME_KEY<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        appConfigSP<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>THEME_KEY<span class="token punctuation">,</span> theme<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
 * æ”¯æŒçš„ä¸»é¢˜
 */</span>
<span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token function">AppTheme</span><span class="token punctuation">(</span><span class="token keyword">val</span> mode<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">AUTO</span><span class="token punctuation">(</span>AppCompatDelegate<span class="token punctuation">.</span>MODE_NIGHT_FOLLOW_SYSTEM<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">LIGHT</span><span class="token punctuation">(</span>AppCompatDelegate<span class="token punctuation">.</span>MODE_NIGHT_NO<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">DARK</span><span class="token punctuation">(</span>AppCompatDelegate<span class="token punctuation">.</span>MODE_NIGHT_YES<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">fun</span> <span class="token function">byMode</span><span class="token punctuation">(</span>mode<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> AppTheme <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">firstOrNull</span> <span class="token punctuation">{<!-- --></span> it<span class="token punctuation">.</span>mode <span class="token operator">==</span> mode <span class="token punctuation">}</span> <span class="token operator">?:</span> AUTO
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// -------- RecreateTransition.kt --------</span>
<span class="token keyword">enum</span> <span class="token keyword">class</span> TransitionType <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * è¿›å…¥
     */</span>
    ENTER<span class="token punctuation">,</span>

    <span class="token comment">/**
     * é€€å‡º
     */</span>
    EXIT
<span class="token punctuation">}</span>

<span class="token comment">/**
 * é‡å»ºè¿‡æ¸¡åŠ¨ç”» data
 * å®ç°Parcelableæ¥å£ï¼Œç”¨äºActivityé‡å»ºæ—¶ä¿å­˜å’Œæ¢å¤æ•°æ®
 */</span>
<span class="token keyword">class</span> <span class="token function">TransitionData</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> centerX<span class="token operator">:</span> Float<span class="token punctuation">,</span>
    <span class="token keyword">val</span> centerY<span class="token operator">:</span> Float<span class="token punctuation">,</span>
    <span class="token keyword">val</span> screenBitmap<span class="token operator">:</span> Bitmap<span class="token punctuation">,</span>
    <span class="token keyword">val</span> type<span class="token operator">:</span> TransitionType<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">:</span> Parcelable <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Parcel<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">(</span>
        parcel<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        parcel<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        parcel<span class="token punctuation">.</span><span class="token function">readParcelable</span><span class="token punctuation">(</span>Bitmap<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">.</span>classLoader<span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">,</span>
        TransitionType<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>parcel<span class="token punctuation">.</span><span class="token function">readString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!!</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">writeToParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Parcel<span class="token punctuation">,</span> flags<span class="token operator">:</span> Int<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        parcel<span class="token punctuation">.</span><span class="token function">writeFloat</span><span class="token punctuation">(</span>centerX<span class="token punctuation">)</span>
        parcel<span class="token punctuation">.</span><span class="token function">writeFloat</span><span class="token punctuation">(</span>centerY<span class="token punctuation">)</span>
        parcel<span class="token punctuation">.</span><span class="token function">writeParcelable</span><span class="token punctuation">(</span>screenBitmap<span class="token punctuation">,</span> flags<span class="token punctuation">)</span>
        parcel<span class="token punctuation">.</span><span class="token function">writeString</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">describeContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Int <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">companion</span> <span class="token keyword">object</span> CREATOR <span class="token operator">:</span> Parcelable<span class="token punctuation">.</span>Creator<span class="token operator">&lt;</span>TransitionData<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">createFromParcel</span><span class="token punctuation">(</span>parcel<span class="token operator">:</span> android<span class="token punctuation">.</span>os<span class="token punctuation">.</span>Parcel<span class="token punctuation">)</span><span class="token operator">:</span> TransitionData <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">TransitionData</span><span class="token punctuation">(</span>parcel<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">newArray</span><span class="token punctuation">(</span>size<span class="token operator">:</span> Int<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>TransitionData<span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">arrayOfNulls</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="activity_379"></a>activityé‡å¯åé€šè¿‡ä¿å­˜çš„çŠ¶æ€æ‰§è¡ŒåŠ¨ç”»</h3> 
<p>åœ¨onCreateè¢«è°ƒç”¨æ—¶ï¼Œé€šè¿‡ä¿å­˜çš„çŠ¶æ€åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œè¿‡æ¸¡åŠ¨ç”»</p> 
<p>transitionAnimation æ–¹æ³•è´Ÿè´£ä¸ºActivityåˆ›å»ºè¿‡æ¸¡åŠ¨ç”»ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªTransitionDataç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°åŒ…å«äº†åŠ¨ç”»æ‰€éœ€çš„ä¿¡æ¯ã€‚<br> åœ¨æ–¹æ³•çš„å¼€å§‹ï¼ŒImageView ivTransitionè¢«è®¾ç½®ä¸ºå¯è§ï¼Œå¹¶ä¸”å…¶ä½å›¾è¢«è®¾ç½®ä¸ºtransitionDataå¯¹è±¡ä¸­çš„screenBitmapï¼ˆActivityé‡å»ºå‰ç»˜åˆ¶ä¿å­˜çš„æ˜¾ç¤ºå†…å®¹ï¼‰ã€‚<br> æ­¤æ—¶ç”¨æˆ·çœ‹åˆ°çš„ Activity å°†å‘ˆç°å‡º Activity é‡å»ºå‰çš„æ•ˆæœï¼Œä»è€Œè¥é€ å‡º Activity å°šæœªå‘ç”Ÿå˜åŒ–çš„å‡è±¡ã€‚</p> 
<pre><code class="prism language-kotlin"><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span>

    <span class="token operator">..</span><span class="token punctuation">.</span>
    <span class="token comment">// é‡å»ºè¿‡æ¸¡åŠ¨ç”»</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>savedInstanceState <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        savedInstanceState<span class="token punctuation">.</span>getParcelable<span class="token operator">&lt;</span>TransitionData<span class="token operator">&gt;</span><span class="token punctuation">(</span>TRANSITION_DATA_KEY<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">transitionAnimation</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * è¿‡æ¸¡åŠ¨ç”»
 */</span>
<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">transitionAnimation</span><span class="token punctuation">(</span>transitionData<span class="token operator">:</span> TransitionData<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ä½¿ç”¨éšè—çš„ ImageView æ˜¾ç¤ºbitmap</span>
    ivTransition<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>VISIBLE
    ivTransition<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>transitionData<span class="token punctuation">.</span>screenBitmap<span class="token punctuation">)</span>

    ivTransition<span class="token punctuation">.</span><span class="token function">post</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> animator <span class="token operator">=</span> ValueAnimator<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">var</span> clipType <span class="token operator">=</span> ClipImageView<span class="token punctuation">.</span>ClipType<span class="token punctuation">.</span>CIRCLE
        <span class="token keyword">when</span> <span class="token punctuation">(</span>transitionData<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            TransitionType<span class="token punctuation">.</span>ENTER <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">// è¿›å…¥åŠ¨ç”»ï¼Œè£åˆ‡æ‰åœ†å†…çš„åŒºåŸŸ åœ†ç”±å°å˜å¤§</span>
                animator<span class="token punctuation">.</span><span class="token function">setFloatValues</span><span class="token punctuation">(</span>
                    <span class="token number">0f</span><span class="token punctuation">,</span>
                    <span class="token function">hypot</span><span class="token punctuation">(</span>ivTransition<span class="token punctuation">.</span>width<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ivTransition<span class="token punctuation">.</span>height<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                clipType <span class="token operator">=</span> ClipImageView<span class="token punctuation">.</span>ClipType<span class="token punctuation">.</span>CIRCLE_REVERSE
            <span class="token punctuation">}</span>

            TransitionType<span class="token punctuation">.</span>EXIT <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">// é€€å‡ºåŠ¨ç”»ï¼Œè£åˆ‡æ‰åœ†å¤–çš„åŒºåŸŸ åœ†ç”±å¤§å˜å°</span>
                animator<span class="token punctuation">.</span><span class="token function">setFloatValues</span><span class="token punctuation">(</span>
                    <span class="token function">hypot</span><span class="token punctuation">(</span>
                        ivTransition<span class="token punctuation">.</span>width<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        ivTransition<span class="token punctuation">.</span>height<span class="token punctuation">.</span><span class="token function">toFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token number">0f</span>
                <span class="token punctuation">)</span>
                clipType <span class="token operator">=</span> ClipImageView<span class="token punctuation">.</span>ClipType<span class="token punctuation">.</span>CIRCLE
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        animator<span class="token punctuation">.</span>duration <span class="token operator">=</span>
            resources<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>android<span class="token punctuation">.</span>R<span class="token punctuation">.</span>integer<span class="token punctuation">.</span>config_longAnimTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        animator<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
            onEnd <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            	<span class="token comment">// åŠ¨ç”»ç»“æŸåéšè— ImageView</span>
                ivTransition<span class="token punctuation">.</span>visibility <span class="token operator">=</span> View<span class="token punctuation">.</span>GONE
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
        animator<span class="token punctuation">.</span><span class="token function">addUpdateListener</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">val</span> radius <span class="token operator">=</span> it<span class="token punctuation">.</span>animatedValue <span class="token keyword">as</span> Float
            <span class="token comment">// æ›´æ–°è£åˆ‡åŒºåŸŸ</span>
            ivTransition<span class="token punctuation">.</span><span class="token function">clipCircle</span><span class="token punctuation">(</span>
                transitionData<span class="token punctuation">.</span>centerX<span class="token punctuation">,</span>
                transitionData<span class="token punctuation">.</span>centerY<span class="token punctuation">,</span>
                radius<span class="token punctuation">,</span>
                clipType
            <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>OKï¼Œå¤§åŠŸå‘Šæˆã€‚åªéœ€è¦åœ¨åˆ‡æ¢ä¸»é¢˜æ—¶è°ƒç”¨transitionRecreateæ–¹æ³•å³å¯å®ç°ä½¿ç”¨è¿‡æ¸¡åŠ¨ç”»é‡å»ºactivity</p> 
<h2><a id="Demo_456"></a>Demoæºç </h2> 
<p><a href="https://github.com/Thousand-Dust/DemoActivityRecreateTransition">https://github.com/Thousand-Dust/DemoActivityRecreateTransition</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f141660085f4725e50662058a5980e61/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å…³äºPythonçš„ç”µå½±ä¿¡æ¯çˆ¬å–ä¸æ•°æ®å¯è§†åŒ–åˆ†ææŠ¥å‘Š</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b427300f51e5369b179a03ad58439195/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Stable Diffusionã€åŸºç¡€ç¯‡ã€‘ï¼šé™å™ªå¼ºåº¦ï¼ˆdenoising strengthï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>