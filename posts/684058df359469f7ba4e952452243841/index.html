<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络爬虫设置代理服务器 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/684058df359469f7ba4e952452243841/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="网络爬虫设置代理服务器">
  <meta property="og:description" content="目录
1．获取代理 IP
2．设置代理 IP
3. 检测代理 IP 的有效性
4. 处理异常
如果希望在网络爬虫程序中使用代理服务器，就需要为网络爬虫程序设置代理服务器。 设置代理服务器一般分为获取代理 IP 、设置代理 IP 两步。接下来，分别对获取代理 IP 和设 置代理 IP 进行详细介绍。 1．获取代理 IP 代理 IP 主要有 3 种获取方式，它们分别是获取免费代理 IP 、获取付费代理 IP 和 ADSL 拨号，关于它们的介绍如下。 （1 ）获取免费代理 IP 。免费代理 IP 基本没有成本，可以从免费代理网站（如快代理、全 网代理 IP 等）上找一些免费代理 IP ，测试可用后便可以收集起来备用，但使用这种方式获取 的可用代理 IP 相对较少。 （2 ）获取付费代理 IP 。互联网上存在许多代理商，用户付费后便可以获得一些高质量的 代理 IP 。 （3 ） ADSL 拨号。 ADSL （ Asymmetric Digital Subscriber Line ，非对称数字用户线路）通 过拨号的方式上网，需要输入 ADSL 账号和密码。每次拨号都会更换一个新的 IP 地址，不过 ADSL 拨号操作起来比较麻烦。每切换一次 IP 地址，都要重新拨号。重拨期间还会处于短暂 断网的状态。 综上所述，免费代理 IP 是比较容易获取的，不过这类代理 IP 的质量不高，高度匿名代理 IP 比较少，有的代理 IP 很快会失效。如果大家对代理 IP 的质量要求比较高，或者需要大量 稳定的代理 IP ，那么建议选择一些正规的代理商进行购买。 2．设置代理 IP 在 Requests 中，设置代理 IP 的方式非常简单：只需要在调用请求函数时为 proxies 参数 传入一个字典。该字典包含了所需要的代理 IP ，其中字典的键为代理类型（如 http 或 https ）， 字典的值为“代理类型 ://IP 地址 : 端口号”格式的字符串。例如，定义一个包含两个代理 IP 的 字典，代码如下。 proxies = { &#39;http&#39;: &#39;http://127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-21T20:09:39+08:00">
    <meta property="article:modified_time" content="2024-06-21T20:09:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络爬虫设置代理服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <span style="color:#000000;">      </span> 
 <p id="main-toc"><strong>目录</strong></p> 
 <p id="1%EF%BC%8E%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%90%86%20IP-toc" style="margin-left:0px;"><a href="#1%EF%BC%8E%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%90%86%20IP" rel="nofollow">1．获取代理 IP</a></p> 
 <p id="2%EF%BC%8E%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%20IP-toc" style="margin-left:0px;"><a href="#2%EF%BC%8E%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%20IP" rel="nofollow">2．设置代理 IP</a></p> 
 <p id="3.%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%20IP%20%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7-toc" style="margin-left:0px;"><a href="#3.%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%20IP%20%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7" rel="nofollow">3. 检测代理 IP 的有效性</a></p> 
 <p id="4.%20%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8-toc" style="margin-left:0px;"><a href="#4.%20%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8" rel="nofollow">4. 处理异常</a></p> 
 <hr id="hr-toc"> 
 <p></p> 
 <span style="color:#000000;">         如果希望在网络爬虫程序中使用代理服务器，就需要为网络爬虫程序设置代理服务器。 </span> 
</div> 
<div> 
 <span style="color:#000000;">设置代理服务器一般分为获取代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">、设置代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">两步。接下来，分别对获取代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">和设 </span> 
</div> 
<div> 
 <span style="color:#000000;">置代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">进行详细介绍。 </span> 
</div> 
<h2 id="1%EF%BC%8E%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%90%86%20IP"><span style="color:#000000;">1．获取代理 IP </span></h2> 
<div> 
 <span style="color:#000000;">        代理 IP </span> 
 <span style="color:#000000;">主要有 </span> 
 <span style="color:#000000;">3 </span> 
 <span style="color:#000000;">种获取方式，它们分别是获取免费代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">、获取付费代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">和 </span> 
 <span style="color:#000000;">ADSL </span> 
</div> 
<div> 
 <span style="color:#000000;">拨号，关于它们的介绍如下。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        （1</span> 
 <span style="color:#000000;">）获取免费代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">。免费代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">基本没有成本，可以从免费代理网站（如快代理、全 </span> 
</div> 
<div> 
 <span style="color:#000000;">网代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">等）上找一些免费代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">，测试可用后便可以收集起来备用，但使用这种方式获取 </span> 
</div> 
<div> 
 <span style="color:#000000;">的可用代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">相对较少。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        （2</span> 
 <span style="color:#000000;">）获取付费代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">。互联网上存在许多代理商，用户付费后便可以获得一些高质量的 </span> 
</div> 
<div> 
 <span style="color:#000000;">代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        （3</span> 
 <span style="color:#000000;">）</span> 
 <span style="color:#000000;">ADSL </span> 
 <span style="color:#000000;">拨号。</span> 
 <span style="color:#000000;">ADSL</span> 
 <span style="color:#000000;">（</span> 
 <span style="color:#000000;">Asymmetric Digital Subscriber Line</span> 
 <span style="color:#000000;">，非对称数字用户线路）通 </span> 
</div> 
<div> 
 <span style="color:#000000;">过拨号的方式上网，需要输入 </span> 
 <span style="color:#000000;">ADSL </span> 
 <span style="color:#000000;">账号和密码。每次拨号都会更换一个新的 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址，不过 </span> 
</div> 
<div> 
 <span style="color:#000000;">ADSL </span> 
 <span style="color:#000000;">拨号操作起来比较麻烦。每切换一次 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址，都要重新拨号。重拨期间还会处于短暂 </span> 
</div> 
<div> 
 <span style="color:#000000;">断网的状态。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        综上所述，免费代理 IP </span> 
 <span style="color:#000000;">是比较容易获取的，不过这类代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">的质量不高，高度匿名代理 </span> 
</div> 
<div> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">比较少，有的代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">很快会失效。如果大家对代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">的质量要求比较高，或者需要大量 </span> 
</div> 
<div> 
 <span style="color:#000000;">稳定的代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">，那么建议选择一些正规的代理商进行购买。</span> 
</div> 
<h2 id="2%EF%BC%8E%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86%20IP"><span style="color:#000000;">2．设置代理 IP </span></h2> 
<div> 
 <span style="color:#000000;">        在 Requests </span> 
 <span style="color:#000000;">中，设置代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">的方式非常简单：只需要在调用请求函数时为 </span> 
 <span style="color:#000000;">proxies </span> 
 <span style="color:#000000;">参数 </span> 
</div> 
<div> 
 <span style="color:#000000;">传入一个字典。该字典包含了所需要的代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">，其中字典的键为代理类型（如 </span> 
 <span style="color:#000000;">http </span> 
 <span style="color:#000000;">或 </span> 
 <span style="color:#000000;">https</span> 
 <span style="color:#000000;">）， </span> 
</div> 
<div> 
 <span style="color:#000000;">字典的值为“代理类型</span> 
 <span style="color:#000000;">://IP </span> 
 <span style="color:#000000;">地址</span> 
 <span style="color:#000000;">:</span> 
 <span style="color:#000000;">端口号”格式的字符串。例如，定义一个包含两个代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">的 </span> 
</div> 
<div> 
 <span style="color:#000000;">字典，代码如下。</span> 
</div> 
<div> 
 <pre><code class="hljs">proxies = { 
 'http': 'http://127.0.0.1:8070', 
 'https': 'https://10.10.1.10:1080', 
}</code></pre> 
 <div> 
  <span style="color:#000000;">        接下来，通过一个例子演示如何从 IP </span> 
  <span style="color:#000000;">地址列表中随机选择一个 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址，将该 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">地址设 </span> 
 </div> 
 <div> 
  <span style="color:#000000;">置为代理 </span> 
  <span style="color:#000000;">IP</span> 
  <span style="color:#000000;">，之后基于该代理 </span> 
  <span style="color:#000000;">IP </span> 
  <span style="color:#000000;">请求小兔鲜儿网首页，具体代码如下。</span> 
 </div> 
</div> 
<pre><code class="hljs">import requests 
import random 
# 代理 IP 地址的列表
proxy_list = [ 
 {"http" : "http://101.200.127.149:3129"}, 
 {"http" : "http://59.55.162.4:3256"}, 
 {"http" : "http://180.122.147.76:3000"}, 
 {"http" : "http://114.230.107.102:3256"}, 
 {"http" : "http://121.230.211.163:3256"} 
] 
base_url = 'http://erabbit.itheima.net/#/' 
header = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64' 
 'AppleWebKit/537.36 (KHTML, like Gecko)' 
 'Chrome/90.0.4430.212 Safari/537.36'} 
# 发送 GET 请求，将 proxy_list 中任意一个 IP 地址设为代理
response = requests.get(base_url, headers=header, 
 proxies= random.choice(proxy_list)) 
print(response.status_code)</code></pre> 
<p>        header请求头字段可以在网页按F12键，上方找到网络标识，然后点击下方有一个名称点进去，右边窗口下面就有User-Agent字段。</p> 
<p> <img alt="" height="543" src="https://images2.imgbox.com/9a/a3/VarJ3dXi_o.png" width="911"></p> 
<p><img alt="" height="543" src="https://images2.imgbox.com/39/58/4VSX3D5p_o.png" width="855"> </p> 
<div> 
 <span style="color:#000000;">        上述代码中，首先创建了包含 5 </span> 
 <span style="color:#000000;">个 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址的列表 </span> 
 <span style="color:#000000;">proxy_list</span> 
 <span style="color:#000000;">，定义了代表小兔鲜儿网首页 </span> 
</div> 
<div> 
 <span style="color:#000000;">URL </span> 
 <span style="color:#000000;">的变量 </span> 
 <span style="color:#000000;">base_url</span> 
 <span style="color:#000000;">，定义了表示请求头的变量 </span> 
 <span style="color:#000000;">header</span> 
 <span style="color:#000000;">；然后调用 </span> 
 <span style="color:#000000;">get()</span> 
 <span style="color:#000000;">函数根据 </span> 
 <span style="color:#000000;">base_url </span> 
 <span style="color:#000000;">请求 </span> 
</div> 
<div> 
 <span style="color:#000000;">小兔鲜儿网首页，同时指定该请求的请求头为 </span> 
 <span style="color:#000000;">header </span> 
 <span style="color:#000000;">且代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">为 </span> 
 <span style="color:#000000;">proxy_list </span> 
 <span style="color:#000000;">中的任意一个 </span> 
 <span style="color:#000000;">IP </span> 
</div> 
<div> 
 <span style="color:#000000;">地址，以防止服务器识别出网络爬虫的身份而被禁止访问，并将服务器返回的响应赋值给变 </span> 
</div> 
<div> 
 <span style="color:#000000;">量 </span> 
 <span style="color:#000000;">response</span> 
 <span style="color:#000000;">；最后访问 </span> 
 <span style="color:#000000;">response </span> 
 <span style="color:#000000;">的 </span> 
 <span style="color:#000000;">status_code </span> 
 <span style="color:#000000;">属性获取响应状态码。 </span> 
</div> 
<div> 
 <span style="color:#000000;">运行代码，输出如下结果。</span> 
</div> 
<blockquote> 
 <div> 
  <span style="color:#000000;"> 200</span> 
 </div> 
</blockquote> 
<div> 
 <span style="color:#000000;">        从输出结果可以看出，程序成功访问了小兔鲜儿网首页。 </span> 
</div> 
<div> 
 <span style="color:#000000;">需要说明的是，上述程序中使用的代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">是免费的。由于使用时间不固定，这些代理 </span> 
 <span style="color:#000000;">IP </span> 
</div> 
<div> 
 <span style="color:#000000;">一旦超出使用时间范围就会失效，此时再运行上述程序则会出现 </span> 
 <span style="color:#000000;">ProxyError </span> 
 <span style="color:#000000;">异常，所以我们 </span> 
</div> 
<div> 
 <span style="color:#000000;">在这里建议大家换用自己查找的代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">。 </span> 
</div> 
<h2 id="3.%20%E6%A3%80%E6%B5%8B%E4%BB%A3%E7%90%86%20IP%20%E7%9A%84%E6%9C%89%E6%95%88%E6%80%A7"><span style="color:#000000;">3. 检测代理 IP 的有效性 </span></h2> 
<div> 
 <span style="color:#000000;">        互联网上有很多免费的代理 IP</span> 
 <span style="color:#000000;">，但这些 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址并不都是有效的。因此需要对获取的免费 </span> 
</div> 
<div> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址进行检测，确定 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址是否有效。检测代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">有效性的过程比较简单，需要先遍历 </span> 
</div> 
<div> 
 <span style="color:#000000;">收集的所有代理 </span> 
 <span style="color:#000000;">IP</span> 
 <span style="color:#000000;">，将获取的每个代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">依次设为代理，再通过该 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址向网站发送请求。</span> 
</div> 
<div> 
 <span style="color:#000000;">如果请求成功，则说明该 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址是有效的；如果请求失败，则说明该 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址是无效的，需要 </span> 
</div> 
<div> 
 <span style="color:#000000;">被剔除。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        下面以 3.4.2 </span> 
 <span style="color:#000000;">节的代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">为例，为大家演示如何检测代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">的有效性，具体代码如下</span> 
</div> 
<p> </p> 
<pre><code class="hljs">import requests 
proxy_list = [ 
 {"http" : "http://101.200.127.149:3129"}, 
 {"http" : "http://59.55.162.4:3256"}, 
 {"http" : "http://180.122.147.76:3000"}, 
 {"http" : "http://114.230.107.102:3256"}, 
 {"http" : "http://121.230.211.163:3256"} 
] 
base_url = 'http://erabbit.itheima.net/#/' 
header = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64' 
 'AppleWebKit/537.36 (KHTML, like Gecko)' 
 'Chrome/90.0.4430.212 Safari/537.36'} 
# 遍历代理 IP 
for per_ip in proxy_list.copy(): 
 try: 
 # 发送 GET 请求，将获取的每个 IP 地址设置为代理
 response = requests.get(base_url, headers=header, 
 proxies=per_ip, timeout=3) 
 except: 
 # 失败则输出 IP 地址无效，并将该 IP 地址从 proxy_list 列表中移除
 print(f'IP 地址：{per_ip.get("http")}无效') 
 proxy_list.remove(per_ip) 
 else: 
 # 成功则输出 IP 地址有效
 print(f'IP 地址：{per_ip.get("http")}有效')</code></pre> 
<div> 
 <span style="color:#000000;">        上述加粗部分的代码中，首先从 proxy_list </span> 
 <span style="color:#000000;">列表的副本遍历了每个 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址 </span> 
 <span style="color:#000000;">per_ip</span> 
 <span style="color:#000000;">；然后在 </span> 
 <span style="color:#000000;">try </span> 
</div> 
<div> 
 <span style="color:#000000;">子句中调用 </span> 
 <span style="color:#000000;">get()</span> 
 <span style="color:#000000;">函数发送了一个 </span> 
 <span style="color:#000000;">GET </span> 
 <span style="color:#000000;">请求，并在发送该请求时将 </span> 
 <span style="color:#000000;">per_ip </span> 
 <span style="color:#000000;">依次设置为代理，由代 </span> 
</div> 
<div> 
 <span style="color:#000000;">理服务器代替程序向服务器转发请求；接着在 </span> 
 <span style="color:#000000;">except </span> 
 <span style="color:#000000;">子句中处理了请求失败的情况，输出“</span> 
 <span style="color:#000000;">IP </span> 
</div> 
<div> 
 <span style="color:#000000;">地址：</span> 
 <span style="color:#000000;">×××</span> 
 <span style="color:#000000;">无效”，并将该 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址从 </span> 
 <span style="color:#000000;">proxy_list </span> 
 <span style="color:#000000;">列表中移除，确保 </span> 
 <span style="color:#000000;">proxy_list </span> 
 <span style="color:#000000;">列表中只保留有效 </span> 
</div> 
<div> 
 <span style="color:#000000;">的 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址；最后在 </span> 
 <span style="color:#000000;">else </span> 
 <span style="color:#000000;">子句中处理了请求成功的情况，输出“</span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">地址：</span> 
 <span style="color:#000000;">×××</span> 
 <span style="color:#000000;">有效”。 </span> 
</div> 
<div> 
 <span style="color:#000000;">运行代码，输出如下结果。</span> 
</div> 
<pre><code class="hljs">IP 地址：http://101.200.127.149:3129 有效
IP 地址：http://59.55.162.4:3256 无效
IP 地址：http://180.122.147.76:3000 无效
IP 地址：http://114.230.107.102:3256 无效
IP 地址：http://121.230.211.163:3256 有效</code></pre> 
<div> 
 <span style="color:#000000;">        从输出结果可以看出，这 5 </span> 
 <span style="color:#000000;">个代理 </span> 
 <span style="color:#000000;">IP </span> 
 <span style="color:#000000;">中有两个是有效的，其余 </span> 
 <span style="color:#000000;">3 </span> 
 <span style="color:#000000;">个都是无效的。 </span> 
</div> 
<h2 id="4.%20%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8"><span style="color:#000000;">4. 处理异常 </span></h2> 
<div> 
 <span style="color:#000000;">        每个程序在运行过程中可能会遇到各种各样的问题，网络爬虫自然也不例外。</span> 
</div> 
<div> 
 <span style="color:#000000;">        访问网站离不开网络的支撑。由于网络环境十分复杂，具有一定的不可控性，所以网络爬虫 </span> 
</div> 
<div> 
 <span style="color:#000000;">每次访问网站后不一定能够成功地获得从服务器返回的数据。网络爬虫一旦在访问过程中遇 </span> 
</div> 
<div> 
 <span style="color:#000000;">到一些网络问题（如 </span> 
 <span style="color:#000000;">DNS </span> 
 <span style="color:#000000;">故障、拒绝连接等），就会导致程序引发异常并停止运行。 </span> 
</div> 
<div> 
 <span style="color:#000000;">requests.exceptions </span> 
 <span style="color:#000000;">模块中定义了很多异常类型，常见的异常类型如表 </span> 
 <span style="color:#000000;">3-2 </span> 
 <span style="color:#000000;">所示。</span> 
</div> 
<p><img alt="" height="416" src="https://images2.imgbox.com/ec/a0/ZfmHXbnT_o.png" width="1183"> <span style="color:#000000;">        表 3-2 中罗列了一些常见的异常类型。其中，</span><span style="color:#000000;">Timeout </span><span style="color:#000000;">继承自 </span><span style="color:#000000;">RequestException</span><span style="color:#000000;">，</span><span style="color:#000000;">Connect Timeout 和 ReadTimeout </span><span style="color:#000000;">继承自 </span><span style="color:#000000;">Timeout</span><span style="color:#000000;">。 为保证程序能够正常终止，我们可以使用 try-except </span><span style="color:#000000;">语句捕获相应的异常，并对异常进行 相应的处理。 由于谷歌网站服务器的原因，访问该网站必定会出现连接超时的问题。下面以访问谷歌 网站为例，为大家演示如何使用 try-except </span><span style="color:#000000;">语句捕获 </span><span style="color:#000000;">RequestException </span><span style="color:#000000;">异常，具体代码如下。</span></p> 
<pre><code class="hljs">1 import time 
2 import requests 
3 # 记录请求的发起时间
4 print(time.strftime('开始时间：%Y-%m-%d %H:%M:%S')) 
5 # 捕获 RequestException 异常
6 try: 
7 html_str = requests.get('http://www.google.com').text 
8 print('访问成功') 
9 except requests.exceptions.RequestException as error: 
10 print(error) 
11 # 记录请求的终止时间
12 print(time.strftime('结束时间：%Y-%m-%d %H:%M:%S'))</code></pre> 
<div> 
 <span style="color:#000000;">        上述代码中，第 4 </span> 
 <span style="color:#000000;">行代码记录了发送请求之后的时间。第 </span> 
 <span style="color:#000000;">6</span> 
 <span style="color:#000000;">～</span> 
 <span style="color:#000000;">10 </span> 
 <span style="color:#000000;">行代码使用 </span> 
 <span style="color:#000000;">try-except </span> 
 <span style="color:#000000;">语 </span> 
</div> 
<div> 
 <span style="color:#000000;">句尝试捕获与处理 </span> 
 <span style="color:#000000;">RequestException </span> 
 <span style="color:#000000;">异常。其中，第 </span> 
 <span style="color:#000000;">6</span> 
 <span style="color:#000000;">～</span> 
 <span style="color:#000000;">8 </span> 
 <span style="color:#000000;">行代码在 </span> 
 <span style="color:#000000;">try </span> 
 <span style="color:#000000;">子句中调用 </span> 
 <span style="color:#000000;">get()</span> 
 <span style="color:#000000;">函数 </span> 
</div> 
<div> 
 <span style="color:#000000;">访问谷歌网站，并在访问成功后输出“访问成功”。第 </span> 
 <span style="color:#000000;">9</span> 
 <span style="color:#000000;">～</span> 
 <span style="color:#000000;">10 </span> 
 <span style="color:#000000;">行代码在 </span> 
 <span style="color:#000000;">except </span> 
 <span style="color:#000000;">子句中指定了捕 </span> 
</div> 
<div> 
 <span style="color:#000000;">获的异常类型为 </span> 
 <span style="color:#000000;">RequestException</span> 
 <span style="color:#000000;">。程序监测到 </span> 
 <span style="color:#000000;">try </span> 
 <span style="color:#000000;">子句中的代码抛出 </span> 
 <span style="color:#000000;">RequestException </span> 
 <span style="color:#000000;">异常 </span> 
</div> 
<div> 
 <span style="color:#000000;">时，会捕获 </span> 
 <span style="color:#000000;">RequestException </span> 
 <span style="color:#000000;">和所有继承自 </span> 
 <span style="color:#000000;">RequestException </span> 
 <span style="color:#000000;">的异常，并在捕获异常后输出详 </span> 
</div> 
<div> 
 <span style="color:#000000;">细的异常信息。第 </span> 
 <span style="color:#000000;">12 </span> 
 <span style="color:#000000;">行代码记录了终止请求之后的时间。 </span> 
</div> 
<div> 
 <span style="color:#000000;">运行代码，输出如下结果。</span> 
</div> 
<pre><code class="hljs">开始时间：2021-06-16 13:50:53 
HTTPConnectionPool(host='www.google.com', port=80): Max retries exceeded with url: 
/ (Caused by NewConnectionError('&lt;urllib3.connection.HTTPConnection object at 
0x00000000034D6790&gt;: Failed to establish a new connection: [WinError 10060] 由于连接方
在一段时间后没有正确答复或连接的主机没有反应，连接尝试失败。')) 
结束时间：2021-06-16 13:51:14</code></pre> 
<div> 
 <span style="color:#000000;">        通过对比结束时间与开始时间可知，我们等待了约 20 </span> 
 <span style="color:#000000;">秒，这个时间相对来说有些长，这 </span> 
</div> 
<div> 
 <span style="color:#000000;">种长时间的等待是没有任何意义的。 </span> 
</div> 
<div> 
 <span style="color:#000000;">        为了减少无意义的等待，我们在发送 HTTP </span> 
 <span style="color:#000000;">请求时可以设置超时时长，即调用 </span> 
 <span style="color:#000000;">get()</span> 
 <span style="color:#000000;">函数 </span> 
</div> 
<div> 
 <span style="color:#000000;">时传入 </span> 
 <span style="color:#000000;">timeout </span> 
 <span style="color:#000000;">参数，并给该参数指定代表超时时长的值。如果超过该时长，服务器仍然没有 </span> 
</div> 
<div> 
 <span style="color:#000000;">返回任何响应内容，就让程序立即引发一个超时异常。在以上示例中，为请求设置超时时长 </span> 
</div> 
<div> 
 <span style="color:#000000;">为 </span> 
 <span style="color:#000000;">5 </span> 
 <span style="color:#000000;">秒，具体代码如下。</span> 
</div> 
<pre><code class="hljs"># 发送 GET 请求，设置超时时长
html_str = requests.get('http://www.google.com', timeout=5).text</code></pre> 
<p><span style="color:#000000;">        再次运行代码，输出如下结果。</span> </p> 
<pre><code class="hljs">开始时间：2021-06-16 14:30:01 
HTTPConnectionPool(host='www.google.com', port=80): Max retries exceeded with url: 
/ (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPConnection object at 
0x00000000033E23D0&gt;, 'Connection to www.google.com timed out. (connect timeout=5)')) 
结束时间：2021-06-16 14:30:06</code></pre> 
<div> 
 <span style="color:#000000;">        通过对比结果中的结束时间和开始时间可知，程序执行了 5 </span> 
 <span style="color:#000000;">秒后便直接结束，并抛出 </span> 
</div> 
<div> 
 <span style="color:#000000;">ConnectTimeoutError </span> 
 <span style="color:#000000;">异常及提示信息“</span> 
 <span style="color:#000000;">Connection to www.google.com timed out</span> 
 <span style="color:#000000;">”。这说明连接 </span> 
</div> 
<div> 
 <span style="color:#000000;">谷歌网站时超过了预设的等待时长而导致访问失败。</span> 
</div> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/91dd46c7fafa6e5a1add7050347eabef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">内网安全[3]-代理Socks协议&amp;路由不出网&amp;后渗透通讯&amp;CS-MSF控制上线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/abda529f268fc5c8f1539bc9cfe1e05c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Rustdesk客户端本地编译安装教程(window环境)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>