<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【雷丰阳-谷粒商城 】【分布式高级篇-微服务架构篇】【20】认证服务04—SSO单点登录 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e639908c772e815f6d123c87bdf3c00e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【雷丰阳-谷粒商城 】【分布式高级篇-微服务架构篇】【20】认证服务04—SSO单点登录">
  <meta property="og:description" content="持续学习&amp;持续更新中…
守破离
【雷丰阳-谷粒商城 】【分布式高级篇-微服务架构篇】【20】认证服务04—SSO单点登录 xxl-sso多系统-单点登录单点登录流程原理图单点登录流程简单实现参考 xxl-sso https://gitee.com/xuxueli0323/xxl-sso
xxl-sso是开源的一个单点登录框架
一个分布式单点登录框架。只需要登录一次就可以访问所有相互信任的应用系统。 拥有&#34;轻量级、分布式、跨域、Cookie&#43;Token均支持、Web&#43;APP均支持&#34;等特性；。现已开放源代码，开箱即用。
C:\Windows\System32\drivers\etc\hosts（模仿三个域名）
#模拟单点登录 127.0.0.1 xxlssoserver.com 127.0.0.1 client1.com 127.0.0.1 client2.com 打包之前修改这三个的配置文件：
举例：修改客户端：
修改完成打包命令：（打包所有）
启动服务器
启动两个客户端：
自己测试：
C:\Users\lenovo\Desktop\xxl-sso\xxl-sso-server\target&gt;java -jar xxl-sso-server-1.1.1-SNAPSHOT.jar C:\Users\lenovo\Desktop\xxl-sso\xxl-sso-samples\xxl-sso-web-sample-springboot\target&gt;java -jar xxl-sso-web-sample-springboot-1.1.1-SNAPSHOT.jar --server.port=13000 C:\Users\lenovo\Desktop\xxl-sso\xxl-sso-samples\xxl-sso-web-sample-springboot\target&gt;java -jar xxl-sso-web-sample-springboot-1.1.1-SNAPSHOT.jar --server.port=12000 http://xxlssoserver.com:8080/xxl-sso-server/login
http://client1.com:12000/xxl-sso-web-sample-springboot/
http://client2.com:13000/xxl-sso-web-sample-springboot/
上面这三个地址，无论访问哪个都要求登录，并且一处登录，处处可用
多系统-单点登录 Single Sign On 一处登陆、处处可用（运行）
单点登录流程原理图 单点登录流程简单实现 认证服务：ssoserver.com:8080
@Controller public class LoginController { @Autowired StringRedisTemplate redisTemplate; /** * TODO 开放接口给其他系统，让它们用来查询 token 对应的用户信息，判断该用户是否登录过，实现单点登录 */ @ResponseBody @GetMapping(&#34;/userInfo&#34;) public String userInfo(@RequestParam(&#34;token&#34;) String token){ String s = redisTemplate.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-05T20:47:55+08:00">
    <meta property="article:modified_time" content="2024-07-05T20:47:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【雷丰阳-谷粒商城 】【分布式高级篇-微服务架构篇】【20】认证服务04—SSO单点登录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p><font color="orange"><strong>持续学习&amp;持续更新中…</strong></font></p> 
<p><font color="red"><strong>守破离</strong></font></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4><font color="#4ea1db">【雷丰阳-谷粒商城 】【分布式高级篇-微服务架构篇】【20】认证服务04—SSO单点登录</font></h4> 
 <ul><li><a href="#xxlsso_16" rel="nofollow">xxl-sso</a></li><li><a href="#_120" rel="nofollow">多系统-单点登录</a></li><li><a href="#_149" rel="nofollow">单点登录流程原理图</a></li><li><a href="#_161" rel="nofollow">单点登录流程简单实现</a></li><li><a href="#_335" rel="nofollow">参考</a></li></ul> 
</div> 
<p></p> 
<h2><a id="xxlsso_16"></a>xxl-sso</h2> 
<blockquote> 
 <p>https://gitee.com/xuxueli0323/xxl-sso<br> xxl-sso是开源的一个单点登录框架<br> 一个分布式单点登录框架。只需要登录一次就可以访问所有相互信任的应用系统。 拥有"轻量级、分布式、跨域、Cookie+Token均支持、Web+APP均支持"等特性；。现已开放源代码，开箱即用。</p> 
</blockquote> 
<p>C:\Windows\System32\drivers\etc\hosts（模仿三个域名）</p> 
<pre><code>#模拟单点登录
127.0.0.1 xxlssoserver.com
127.0.0.1 client1.com
127.0.0.1 client2.com
</code></pre> 
<p>打包之前修改这三个的配置文件：</p> 
<p><img src="https://images2.imgbox.com/7d/ab/V3z7jZEp_o.png" alt="在这里插入图片描述"></p> 
<p>举例：修改客户端：</p> 
<p><img src="https://images2.imgbox.com/1a/86/X9UQHs0N_o.png" alt="在这里插入图片描述"></p> 
<p>修改完成打包命令：（打包所有）</p> 
<p><img src="https://images2.imgbox.com/d2/7f/ycf6GQIm_o.png" alt="在这里插入图片描述"></p> 
<p>启动服务器<br> <img src="https://images2.imgbox.com/74/27/T1UBheuo_o.png" alt="在这里插入图片描述"></p> 
<p>启动两个客户端：</p> 
<p><img src="https://images2.imgbox.com/4f/6a/F4YF1FEn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/54/10/acNNjtwj_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>自己测试：</p> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>lenovo<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>xxl-sso<span class="token punctuation">\</span>xxl-sso-server<span class="token punctuation">\</span>target<span class="token operator">&gt;</span>java <span class="token parameter variable">-jar</span> xxl-sso-server-1.1.1-SNAPSHOT.jar
</code></pre> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>lenovo<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>xxl-sso<span class="token punctuation">\</span>xxl-sso-samples<span class="token punctuation">\</span>xxl-sso-web-sample-springboot<span class="token punctuation">\</span>target<span class="token operator">&gt;</span>java <span class="token parameter variable">-jar</span> xxl-sso-web-sample-springboot-1.1.1-SNAPSHOT.jar <span class="token parameter variable">--server.port</span><span class="token operator">=</span><span class="token number">13000</span>
</code></pre> 
<pre><code class="prism language-bash">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>lenovo<span class="token punctuation">\</span>Desktop<span class="token punctuation">\</span>xxl-sso<span class="token punctuation">\</span>xxl-sso-samples<span class="token punctuation">\</span>xxl-sso-web-sample-springboot<span class="token punctuation">\</span>target<span class="token operator">&gt;</span>java <span class="token parameter variable">-jar</span> xxl-sso-web-sample-springboot-1.1.1-SNAPSHOT.jar <span class="token parameter variable">--server.port</span><span class="token operator">=</span><span class="token number">12000</span>
</code></pre> 
<p>http://xxlssoserver.com:8080/xxl-sso-server/login<br> http://client1.com:12000/xxl-sso-web-sample-springboot/<br> http://client2.com:13000/xxl-sso-web-sample-springboot/</p> 
<p>上面这三个地址，无论访问哪个都要求登录，并且一处登录，处处可用</p> 
<h2><a id="_120"></a>多系统-单点登录</h2> 
<blockquote> 
 <p>Single Sign On 一处登陆、处处可用（运行）</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/af/38/zbixQyDw_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/19/df/uMBYTm0a_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1d/7b/FDO1usJG_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_149"></a>单点登录流程原理图</h2> 
<p><img src="https://images2.imgbox.com/b7/24/dDxgMSHk_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_161"></a>单点登录流程简单实现</h2> 
<p>认证服务：ssoserver.com:8080</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">/**
     * TODO 开放接口给其他系统，让它们用来查询 token 对应的用户信息，判断该用户是否登录过，实现单点登录
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/userInfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/login.html"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"redirect_url"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Model</span> model<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"sso_token"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> sso_token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>sso_token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//说明之前有人登录过，浏览器留下了痕迹</span>
            <span class="token keyword">return</span> <span class="token string">"redirect:"</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">"?token="</span><span class="token operator">+</span>sso_token<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/doLogin"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token class-name">String</span> password<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span><span class="token class-name">String</span> url<span class="token punctuation">,</span>
                          <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

		<span class="token comment">// 假设用户名密码不为空就登录成功</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//把登录成功的用户存起来。</span>
            <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>uuid<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给浏览器留下登录痕迹</span>
            <span class="token class-name">Cookie</span> sso_token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"sso_token"</span><span class="token punctuation">,</span>uuid<span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>sso_token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//登录成功，跳回之前页面，并带上token</span>
            <span class="token keyword">return</span> <span class="token string">"redirect:"</span><span class="token operator">+</span>url<span class="token operator">+</span><span class="token string">"?token="</span><span class="token operator">+</span>uuid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//登录失败，展示登录页</span>
        <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>客户端1：client1.com:8081</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${sso.server.url}"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> ssoServerUrl<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 无需登录就可访问
     * @return
     */</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * TODO 如下判断，可以抽取出来放在一个Filter中，放在任何系统中，实现单点登录
     */</span>
    <span class="token comment">/**
     * 感知这次是在 ssoserver 登录成功跳回来的。
     * @param model
     * @param session
     * @param token 只要去ssoserver登录成功跳回来就会带上
     * @return
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/employees"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">employees</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"token"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//TODO 应该去ssoserver获取当前token真正对应的用户信息</span>
            <span class="token comment">// 如果我们并不知道ssoserver的redis地址，也就是说客户端并不知道认证服务器将用户信息保存在哪里</span>
            <span class="token comment">// 我们就得用令牌去认证服务器再查一次用户信息，查询用户信息成功，表明登录成功</span>
            <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> forEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">"http://ssoserver.com:8080/userInfo?token="</span> <span class="token operator">+</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> body <span class="token operator">=</span> forEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"loginUser"</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Object</span> loginUser <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"loginUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>loginUser<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//没登录，跳转到登录服务器进行登录</span>
            <span class="token comment">//跳转过去以后，使用url上的查询参数标识我们自己是哪个页面</span>
            <span class="token comment">//redirect_url=http://client1.com:8080/employees</span>
            <span class="token keyword">return</span> <span class="token string">"redirect:"</span><span class="token operator">+</span>ssoServerUrl<span class="token operator">+</span><span class="token string">"?redirect_url=http://client1.com:8081/employees"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> emps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            emps<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"emps"</span><span class="token punctuation">,</span>emps<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">"list"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>客户端2：client1.com:8082</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${sso.server.url}"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> ssoServerUrl<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/boss"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">boss</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span>
                            <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"token"</span><span class="token punctuation">,</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">RestTemplate</span> restTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> forEntity <span class="token operator">=</span>
                    restTemplate<span class="token punctuation">.</span><span class="token function">getForEntity</span><span class="token punctuation">(</span><span class="token string">"http://ssoserver.com:8080/userInfo?token="</span> <span class="token operator">+</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> body <span class="token operator">=</span> forEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"loginUser"</span><span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Object</span> loginUser <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"loginUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>loginUser<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"redirect:"</span><span class="token operator">+</span>ssoServerUrl<span class="token operator">+</span><span class="token string">"?redirect_url=http://client2.com:8082/boss"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            boss<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            boss<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"777"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"boss"</span><span class="token punctuation">,</span>boss<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">"list"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_335"></a>参考</h2> 
<p>雷丰阳: <a href="https://www.bilibili.com/video/BV1np4y1C7Yf/" rel="nofollow">Java项目《谷粒商城》Java架构师 | 微服务 | 大型电商项目</a>.</p> 
<hr> 
<p><font color="orange"><strong>本文完，感谢您的关注支持！</strong></font></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b2346caf8ed33d49527ce3a7e3e346a7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">零门槛用AI大模型，AI全能工具箱302.AI让人工智能AIGC变得简单易用！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3bfb9c62fc6168b34d52f8d1dbea9430/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【AI 大模型】提示工程 ④ ( 自然语言处理 NLG | 自然语言理解 NLU | 自然语言生成 NLG | 使用 提示词 &#43; 大模型 实现 NLU | 使用 提示词 &#43; 大模型 实现 NLG )</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>