<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Go 如何通过 Kafka 客户端库 生产与消费消息 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9d08d2910ba1e608765564a5050cebb4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Go 如何通过 Kafka 客户端库 生产与消费消息">
  <meta property="og:description" content="文章目录 0.前置说明1. confluent-kafka-go2. sarama3. segmentio/kafka-go4. franz-go选择建议 1.启动 kafka 集群2.安装 confluent-kafka-go 库3.创建生产者特殊文件说明如何查看.log文件内容 4.创建消费者 0.前置说明 Go 语言中有一些流行的 Kafka 客户端库。以下是几个常用的库及其优劣与区别：
1. confluent-kafka-go 优点：
高性能：基于 librdkafka，性能非常高。功能全面：支持 Kafka 的所有高级功能，如事务、压缩、认证等。社区支持：由 Confluent 维护，社区活跃，文档丰富。稳定性：广泛使用于生产环境，经过大量测试和验证。 缺点：
依赖性：依赖于 librdkafka，需要额外安装该库。复杂性：配置和使用相对复杂，特别是对于新手。 2. sarama 优点：
纯 Go 实现：不依赖于任何 C 库，安装和使用非常方便。社区活跃：由 Shopify 维护，社区支持良好，文档齐全。灵活性：提供了丰富的配置选项，适用于各种使用场景。 缺点：
性能：相对于 confluent-kafka-go，性能稍逊一筹。功能：不支持 Kafka 的一些高级功能，如事务。 3. segmentio/kafka-go 优点：
纯 Go 实现：不依赖于任何 C 库，安装和使用非常方便。简洁易用：API 设计简洁，易于上手。灵活性：支持多种配置选项，适用于各种使用场景。 缺点：
性能：相对于 confluent-kafka-go，性能稍逊一筹。功能：不支持 Kafka 的一些高级功能，如事务。 4. franz-go 优点：
纯 Go 实现：不依赖于任何 C 库，安装和使用非常方便。高性能：在纯 Go 实现中性能较为优越。功能全面：支持 Kafka 的大部分功能，包括事务。 缺点：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-27T12:24:01+08:00">
    <meta property="article:modified_time" content="2024-05-27T12:24:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Go 如何通过 Kafka 客户端库 生产与消费消息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0_1" rel="nofollow">0.前置说明</a></li><li><ul><li><a href="#1_confluentkafkago_4" rel="nofollow">1. confluent-kafka-go</a></li><li><a href="#2_sarama_16" rel="nofollow">2. sarama</a></li><li><a href="#3_segmentiokafkago_27" rel="nofollow">3. segmentio/kafka-go</a></li><li><a href="#4_franzgo_38" rel="nofollow">4. franz-go</a></li><li><ul><li><a href="#_49" rel="nofollow">选择建议</a></li></ul> 
  </li></ul> 
  </li><li><a href="#1_kafka__57" rel="nofollow">1.启动 kafka 集群</a></li><li><a href="#2_confluentkafkago__83" rel="nofollow">2.安装 confluent-kafka-go 库</a></li><li><a href="#3_108" rel="nofollow">3.创建生产者</a></li><li><ul><li><a href="#_205" rel="nofollow">特殊文件说明</a></li><li><a href="#log_232" rel="nofollow">如何查看.log文件内容</a></li></ul> 
  </li><li><a href="#4_259" rel="nofollow">4.创建消费者</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0_1"></a>0.前置说明</h2> 
<p>Go 语言中有一些流行的 Kafka 客户端库。以下是几个常用的库及其优劣与区别：</p> 
<h3><a id="1_confluentkafkago_4"></a>1. confluent-kafka-go</h3> 
<ul><li> <p><strong>优点</strong>：</p> 
  <ul><li><strong>高性能</strong>：基于 <code>librdkafka</code>，性能非常高。</li><li><strong>功能全面</strong>：支持 Kafka 的所有高级功能，如事务、压缩、认证等。</li><li><strong>社区支持</strong>：由 Confluent 维护，社区活跃，文档丰富。</li><li><strong>稳定性</strong>：广泛使用于生产环境，经过大量测试和验证。</li></ul> </li><li> <p><strong>缺点</strong>：</p> 
  <ul><li><strong>依赖性</strong>：依赖于 <code>librdkafka</code>，需要额外安装该库。</li><li><strong>复杂性</strong>：配置和使用相对复杂，特别是对于新手。</li></ul> </li></ul> 
<h3><a id="2_sarama_16"></a>2. sarama</h3> 
<ul><li> <p><strong>优点</strong>：</p> 
  <ul><li><strong>纯 Go 实现</strong>：不依赖于任何 C 库，安装和使用非常方便。</li><li><strong>社区活跃</strong>：由 Shopify 维护，社区支持良好，文档齐全。</li><li><strong>灵活性</strong>：提供了丰富的配置选项，适用于各种使用场景。</li></ul> </li><li> <p><strong>缺点</strong>：</p> 
  <ul><li><strong>性能</strong>：相对于 <code>confluent-kafka-go</code>，性能稍逊一筹。</li><li><strong>功能</strong>：不支持 Kafka 的一些高级功能，如事务。</li></ul> </li></ul> 
<h3><a id="3_segmentiokafkago_27"></a>3. segmentio/kafka-go</h3> 
<ul><li> <p><strong>优点</strong>：</p> 
  <ul><li><strong>纯 Go 实现</strong>：不依赖于任何 C 库，安装和使用非常方便。</li><li><strong>简洁易用</strong>：API 设计简洁，易于上手。</li><li><strong>灵活性</strong>：支持多种配置选项，适用于各种使用场景。</li></ul> </li><li> <p><strong>缺点</strong>：</p> 
  <ul><li><strong>性能</strong>：相对于 <code>confluent-kafka-go</code>，性能稍逊一筹。</li><li><strong>功能</strong>：不支持 Kafka 的一些高级功能，如事务。</li></ul> </li></ul> 
<h3><a id="4_franzgo_38"></a>4. franz-go</h3> 
<ul><li> <p><strong>优点</strong>：</p> 
  <ul><li><strong>纯 Go 实现</strong>：不依赖于任何 C 库，安装和使用非常方便。</li><li><strong>高性能</strong>：在纯 Go 实现中性能较为优越。</li><li><strong>功能全面</strong>：支持 Kafka 的大部分功能，包括事务。</li></ul> </li><li> <p><strong>缺点</strong>：</p> 
  <ul><li><strong>社区支持</strong>：相对于 <code>sarama</code> 和 <code>confluent-kafka-go</code>，社区支持稍弱。</li><li><strong>文档</strong>：文档相对较少，需要更多的社区贡献。</li></ul> </li></ul> 
<h4><a id="_49"></a>选择建议</h4> 
<ul><li><strong>高性能和高级功能需求</strong>：如果你需要高性能和 Kafka 的高级功能（如事务、压缩、认证等），<code>confluent-kafka-go</code> 是一个不错的选择。</li><li><strong>纯 Go 实现和易用性</strong>：如果你更倾向于使用纯 Go 实现的库，并且希望安装和使用更加简便，可以选择 <code>sarama</code> 或 <code>segmentio/kafka-go</code>。</li><li><strong>平衡性能和功能</strong>：如果你希望在纯 Go 实现中获得较好的性能和功能支持，可以考虑 <code>franz-go</code>。</li></ul> 
<p>本文我们就以<code>confluent-kafka-go</code>库为例来编写代码。</p> 
<h2><a id="1_kafka__57"></a>1.启动 kafka 集群</h2> 
<p><strong>不知道如何搭建集群请点击这里</strong> ----》<a href="https://blog.csdn.net/gllll_yu/article/details/139183016?spm=1001.2014.3001.5501">Kafka 集群部署（CentOS 单机模拟版）</a></p> 
<p>如果你懒得启动集群，那么<strong>直接跳过</strong>。</p> 
<ol><li>在<code>cluster</code>目录下运行集群启动脚本 <code>cluster.sh</code>;</li></ol> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> cluster
./cluster.sh
</code></pre> 
<ol start="2"><li>检查是否启动成功；</li></ol> 
<pre><code class="prism language-bash">ll zookeeper-data/
total <span class="token number">4</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> May <span class="token number">27</span> <span class="token number">10</span>:20 zookeeper

ll broker-data/
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">27</span> <span class="token number">10</span>:21 broker-1
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">27</span> <span class="token number">10</span>:21 broker-2
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">27</span> <span class="token number">10</span>:21 broker-3
</code></pre> 
<h2><a id="2_confluentkafkago__83"></a>2.安装 confluent-kafka-go 库</h2> 
<ol><li>查看你的<code>go工作目录</code></li></ol> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">$GOPATH</span>
</code></pre> 
<ol start="2"><li>在<code>GOPATH</code>目录下的<code>src</code>目录下新建 <code>produce</code> 项目</li></ol> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> src/produce
<span class="token builtin class-name">cd</span> src/produce
</code></pre> 
<ol start="3"><li>在你的项目目录中运行 <code>go mod init</code> 命令来初始化一个新的 <code>Go 模块</code></li></ol> 
<pre><code class="prism language-bash">go mod init produce
</code></pre> 
<ol start="4"><li>安装 <code>confluent-kafka-go</code> 库</li></ol> 
<pre><code class="prism language-bash">go get github.com/confluentinc/confluent-kafka-go/kafka
</code></pre> 
<h2><a id="3_108"></a>3.创建生产者</h2> 
<ol><li>新建文件 <code>producer.go</code></li></ol> 
<pre><code class="prism language-bash"><span class="token function">touch</span> producer.go
</code></pre> 
<ol start="2"><li>编写代码</li></ol> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token string">"github.com/confluentinc/confluent-kafka-go/kafka"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// 创建生产者实例</span>
	broker <span class="token operator">:=</span> <span class="token string">"localhost:9091"</span> <span class="token comment">// 集群地址</span>
	topic <span class="token operator">:=</span> <span class="token string">"test"</span>            <span class="token comment">// 主题名称</span>

	producer<span class="token punctuation">,</span> err <span class="token operator">:=</span> kafka<span class="token punctuation">.</span><span class="token function">NewProducer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>kafka<span class="token punctuation">.</span>ConfigMap<span class="token punctuation">{<!-- --></span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">:</span> broker<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 创建生产者实例</span>
	<span class="token comment">// 检查错误</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Failed to create producer: %s"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> producer<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Created Producer %v\n"</span><span class="token punctuation">,</span> producer<span class="token punctuation">)</span>

	<span class="token comment">// 生产消息</span>
	message <span class="token operator">:=</span> <span class="token string">"hello kafka"</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{<!-- --></span>
		producer<span class="token punctuation">.</span><span class="token function">Produce</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>kafka<span class="token punctuation">.</span>Message<span class="token punctuation">{<!-- --></span>
			TopicPartition<span class="token punctuation">:</span> kafka<span class="token punctuation">.</span>TopicPartition<span class="token punctuation">{<!-- --></span>Topic<span class="token punctuation">:</span> <span class="token operator">&amp;</span>topic<span class="token punctuation">,</span> Partition<span class="token punctuation">:</span> kafka<span class="token punctuation">.</span>PartitionAny<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 任题名称</span>
			Value<span class="token punctuation">:</span>          <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>message <span class="token operator">+</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                             <span class="token comment">// 消息内容</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">"Failed to produce message: %v"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 等待消息发送完成</span>
	e <span class="token operator">:=</span> <span class="token operator">&lt;-</span>producer<span class="token punctuation">.</span><span class="token function">Events</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 阻塞直到消息发送完成</span>
	<span class="token keyword">switch</span> ev <span class="token operator">:=</span> e<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> <span class="token operator">*</span>kafka<span class="token punctuation">.</span>Message<span class="token punctuation">:</span>
		<span class="token keyword">if</span> ev<span class="token punctuation">.</span>TopicPartition<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Failed to deliver message: %v"</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>TopicPartition<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Delivered message: %s to %v\n"</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">,</span> ev<span class="token punctuation">.</span>TopicPartition<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 冲刷缓冲区消息</span>
	producer<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token number">15</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><em><strong>代码说明</strong></em></p> 
<ol><li>创建生产者时需要指定<code>集群地址</code>以及<code>主题信息</code>，如果没有该主题则<code>自动创建</code>。</li><li>生产者会<code>异步</code>地将消息发送到 Kafka，因此你需要处理交付报告以确保消息成功发送。</li></ol> 
<p>我们需要了解一下Go语言和Kafka之间的关系：Go是一种静态类型、编译型的编程语言，由Google开发并开源。它适用于构建高性能服务器端应用程序和网络服务。而Apache Kafka是一个分布式流处理平台，主要面向大规模数据传输和存储。</p> 
<p>在这个例子中，我们有一个生产者程序，它使用Kafka的客户端库来连接到Kafka集群，然后通过创建一个生产者实例来开始发送消息。当生产者准备好要发送的消息时，它就会调用<code>Send()</code>方法将其添加到缓冲区中。一旦缓冲区满了或者用户主动触发了<code>Flush()</code>方法，生产者就会把缓冲区里的所有消息一起发送给Kafka集群。</p> 
<ol start="3"><li>编译运行，生产者发送消息</li></ol> 
<pre><code class="prism language-bash">go build producer.go 
./producer 
Created Producer rdkafka<span class="token comment">#producer-1</span>
Delivered message: hello kafka0 to test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>@0
</code></pre> 
<ol start="4"><li>查看消息</li></ol> 
<pre><code class="prism language-bash">ll cluster/broker-data/broker-1
total <span class="token number">20</span>
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> May <span class="token number">27</span> <span class="token number">10</span>:20 cleaner-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">4</span> May <span class="token number">27</span> <span class="token number">11</span>:36 log-start-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">88</span> May <span class="token number">27</span> <span class="token number">10</span>:20 meta.properties
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">13</span> May <span class="token number">27</span> <span class="token number">11</span>:36 recovery-point-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">14</span> May <span class="token number">27</span> <span class="token number">11</span>:36 replication-offset-checkpoint
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> May <span class="token number">27</span> <span class="token number">11</span>:21 test-0 <span class="token comment"># 我们创建的主题 数字代表分区号</span>

ll cluster/broker-data/broker-1/test-0/
total <span class="token number">12</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">10485760</span> May <span class="token number">27</span> <span class="token number">11</span>:21 00000000000000000000.index
-rw-r--r-- <span class="token number">1</span> root root      <span class="token number">251</span> May <span class="token number">27</span> <span class="token number">11</span>:21 00000000000000000000.log
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">10485756</span> May <span class="token number">27</span> <span class="token number">11</span>:21 00000000000000000000.timeindex
-rw-r--r-- <span class="token number">1</span> root root        <span class="token number">8</span> May <span class="token number">27</span> <span class="token number">11</span>:21 leader-epoch-checkpoint
-rw-r--r-- <span class="token number">1</span> root root       <span class="token number">43</span> May <span class="token number">27</span> <span class="token number">11</span>:21 partition.metadata
</code></pre> 
<h3><a id="_205"></a>特殊文件说明</h3> 
<p>Kafka 的数据文件存储在每个分区的目录中，这些文件包括 <code>.index</code>、<code>.log</code>、<code>.timeindex</code>、<code>leader-epoch-checkpoint</code> 和 <code>partition.metadata</code> 文件。每个文件都有其特定的用途，下面是对这些文件的详细解释：</p> 
<ol><li> <p><strong><code>.log</code> 文件</strong>：</p> 
  <ul><li><strong>用途</strong>：存储实际的消息数据。</li><li><strong>描述</strong>：这是 Kafka 中最重要的文件，包含了生产者发送到 Kafka 的消息。每个 <code>.log</code> 文件代表一个日志段（log segment），文件名通常是该段的起始偏移量（offset）。</li></ul> </li><li> <p><strong><code>.index</code> 文件</strong>：</p> 
  <ul><li><strong>用途</strong>：存储消息偏移量到物理文件位置的映射。</li><li><strong>描述</strong>：这个文件是一个稀疏索引，允许 Kafka 快速查找特定偏移量的消息。通过这个索引，Kafka 可以避免从头开始扫描整个日志文件，从而提高查找效率。</li></ul> </li><li> <p><strong><code>.timeindex</code> 文件</strong>：</p> 
  <ul><li><strong>用途</strong>：存储消息时间戳到物理文件位置的映射。</li><li><strong>描述</strong>：这个文件允许 Kafka 根据时间戳快速查找消息。它是一个稀疏索引，类似于 <code>.index</code> 文件，但索引的是时间戳而不是偏移量。</li></ul> </li><li> <p><strong><code>leader-epoch-checkpoint</code> 文件</strong>：</p> 
  <ul><li><strong>用途</strong>：记录分区的领导者纪元（leader epoch）信息。</li><li><strong>描述</strong>：这个文件包含了每个纪元的起始偏移量。领导者纪元是 Kafka 用来跟踪分区领导者变化的机制。每次分区领导者发生变化时，纪元号会增加。这个文件帮助 Kafka 在领导者变更时进行数据恢复和一致性检查。</li></ul> </li><li> <p><strong><code>partition.metadata</code> 文件</strong>：</p> 
  <ul><li><strong>用途</strong>：存储分区的元数据信息。</li><li><strong>描述</strong>：这个文件包含了分区的一些基本信息，如分区的版本号等。它帮助 Kafka 管理和维护分区的元数据。</li></ul> </li></ol> 
<p>这些文件共同作用，确保 Kafka 能够高效、可靠地存储和检索消息数据。</p> 
<h3><a id="log_232"></a>如何查看.log文件内容</h3> 
<ul><li>执行指令</li></ul> 
<pre><code class="prism language-bash"> ~/cluster/broker-1/bin/kafka-run-class.sh kafka.tools.DumpLogSegments <span class="token parameter variable">--files</span> ./00000000000000000000.log --print-data-log
</code></pre> 
<pre><code class="prism language-bash">~/cluster/broker-1/bin/kafka-run-class.sh kafka.tools.DumpLogSegments <span class="token parameter variable">--files</span> ./00000000000000000000.log --print-data-log
Dumping ./00000000000000000000.log
Log starting offset: <span class="token number">0</span>
baseOffset: <span class="token number">0</span> lastOffset: <span class="token number">9</span> count: <span class="token number">10</span> baseSequence: <span class="token parameter variable">-1</span> lastSequence: <span class="token parameter variable">-1</span> producerId: <span class="token parameter variable">-1</span> producerEpoch: <span class="token parameter variable">-1</span> partitionLeaderEpoch: <span class="token number">0</span> isTransactional: <span class="token boolean">false</span> isControl: <span class="token boolean">false</span> deleteHorizonMs: OptionalLong.empty position: <span class="token number">0</span> CreateTime: <span class="token number">1716780091840</span> size: <span class="token number">251</span> magic: <span class="token number">2</span> compresscodec: none crc: <span class="token number">997822510</span> isvalid: <span class="token boolean">true</span>
<span class="token operator">|</span> offset: <span class="token number">0</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka0
<span class="token operator">|</span> offset: <span class="token number">1</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka1
<span class="token operator">|</span> offset: <span class="token number">2</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka2
<span class="token operator">|</span> offset: <span class="token number">3</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka3
<span class="token operator">|</span> offset: <span class="token number">4</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka4
<span class="token operator">|</span> offset: <span class="token number">5</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka5
<span class="token operator">|</span> offset: <span class="token number">6</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka6
<span class="token operator">|</span> offset: <span class="token number">7</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka7
<span class="token operator">|</span> offset: <span class="token number">8</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka8
<span class="token operator">|</span> offset: <span class="token number">9</span> CreateTime: <span class="token number">1716780091840</span> keySize: <span class="token parameter variable">-1</span> valueSize: <span class="token number">12</span> sequence: <span class="token parameter variable">-1</span> headerKeys: <span class="token punctuation">[</span><span class="token punctuation">]</span> payload: hello kafka9
</code></pre> 
<p>如上我们可以看到消息已经成功的发送。</p> 
<h2><a id="4_259"></a>4.创建消费者</h2> 
<ol><li>创建消费者项目</li></ol> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> src/consume
<span class="token builtin class-name">cd</span> src/consume
</code></pre> 
<ol start="2"><li>在你的项目目录中运行 <code>go mod init</code> 命令来初始化一个新的 <code>Go 模块</code></li></ol> 
<pre><code class="prism language-bash">go mod init consume
</code></pre> 
<ol start="3"><li>安装 <code>confluent-kafka-go</code> 库</li></ol> 
<pre><code class="prism language-bash">go get github.com/confluentinc/confluent-kafka-go/kafka
</code></pre> 
<ol start="4"><li>新建文件</li></ol> 
<pre><code class="prism language-bash"><span class="token function">touch</span> consumer.go
</code></pre> 
<ol start="5"><li>编写代码</li></ol> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"fmt"</span>
	<span class="token string">"log"</span>

	<span class="token string">"github.com/confluentinc/confluent-kafka-go/kafka"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 创建消费者实例</span>
	broker <span class="token operator">:=</span> <span class="token string">"localhost:9091"</span> <span class="token comment">// 集群地址</span>
	topic <span class="token operator">:=</span> <span class="token string">"test"</span>            <span class="token comment">// 主题名称</span>
	c<span class="token punctuation">,</span> err <span class="token operator">:=</span> kafka<span class="token punctuation">.</span><span class="token function">NewConsumer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>kafka<span class="token punctuation">.</span>ConfigMap<span class="token punctuation">{<!-- --></span>
		<span class="token string">"bootstrap.servers"</span><span class="token punctuation">:</span> broker<span class="token punctuation">,</span>     <span class="token comment">// 集群地址</span>
		<span class="token string">"group.id"</span><span class="token punctuation">:</span>          <span class="token string">"my-group"</span><span class="token punctuation">,</span> <span class="token comment">// 消费者组</span>
		<span class="token string">"auto.offset.reset"</span><span class="token punctuation">:</span> <span class="token string">"earliest"</span><span class="token punctuation">,</span> <span class="token comment">// 设置偏移量 从头开始消费</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// 检查错误</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Failed to create consumer: %s\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">defer</span> c<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// 描述订阅主题</span>
	c<span class="token punctuation">.</span><span class="token function">SubscribeTopics</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{<!-- --></span>topic<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Consuming topic %s\n"</span><span class="token punctuation">,</span> topic<span class="token punctuation">)</span>

	<span class="token comment">// 消费消息</span>
	<span class="token keyword">for</span> <span class="token punctuation">{<!-- --></span>
		msg<span class="token punctuation">,</span> err <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">ReadMessage</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 阻塞直到消息到达</span>
		<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{<!-- --></span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Consumed message: %s\n"</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span>Value<span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 消费者错误</span>
			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"Consumer error: %v (%v)\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="6"><li>编译并运行</li></ol> 
<pre><code class="prism language-bash">go build consumer.go 
./consumer 
Consuming topic <span class="token builtin class-name">test</span>
Consumed message: hello kafka0
Consumed message: hello kafka1
Consumed message: hello kafka2
Consumed message: hello kafka3
Consumed message: hello kafka4
Consumed message: hello kafka5
Consumed message: hello kafka6
Consumed message: hello kafka7
Consumed message: hello kafka8
Consumed message: hello kafka9

</code></pre> 
<p>可以看到已经成功的消费刚才生产的消息。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd8068c732487e9f8ae2ade0d77a818f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 实现腾讯云点播之媒体管理常用接口</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7cebdbd150b05dbb8a323767b74a1a9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【iOS】Block总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>