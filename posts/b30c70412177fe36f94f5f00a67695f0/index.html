<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å° - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b30c70412177fe36f94f5f00a67695f0/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°">
  <meta property="og:description" content="ç³»åˆ—ç¯‡ç« ğŸ’¥ AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶
AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°
ç›®å½• ç³»åˆ—ç¯‡ç« ğŸ’¥ä¸€ã€å‰è¨€äºŒã€å®ç°æœ¬åœ°Pythonä»£ç è§£é‡Šå™¨1ã€å®šä¹‰æ•°æ®æå–å‡½æ•°2ã€æ•°æ®æŸ¥è¯¢æ±²å–æµ‹è¯•3ã€å˜é‡æ•°æ®æŸ¥çœ‹4ã€æ•°æ®æ±²å–å‡½æ•°ä¿¡æ¯ç”Ÿæˆ5ã€å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•6ã€å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°7ã€è‡ªåŠ¨ç”Ÿæˆpythonä»£ç æ‰§è¡Œå‡½æ•°çš„ä¿¡æ¯8ã€ç¬¬ä¸€æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•ï¼ˆpythonä»£ç æ‰§è¡Œå‡½æ•°è°ƒç”¨æµ‹è¯•ï¼‰9ã€ç¬¬äºŒæ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•10ã€ç¬¬ä¸‰æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯• ä¸‰ã€å¯è§†åŒ–å±•ç¤ºæ•°æ®1ã€è·å–æ•°æ®2ã€å¯è§†åŒ–å±•ç¤º å››ã€æŠŠå¯è§†åŒ–å›¾ç‰‡å­˜å…¥äº‘ç›˜æ–‡æ¡£1ã€å›¾å½¢ç»˜åˆ¶æµ‹è¯•2ã€å®šä¹‰å›¾ç‰‡å­˜å‚¨æœåŠ¡ äº”ã€ å®ç°æŠŠå›¾ç‰‡å˜ä¸ºfigå¯¹è±¡çš„ä»£ç é€»è¾‘1ã€è·å–æ•°æ®2ã€æŸ¥çœ‹ä»£ç 3ã€æ‰§è¡Œä»£ç ï¼ˆå¯è§†åŒ–å±•ç¤ºï¼‰4ã€å®šä¹‰insert_fig_objecå‡½æ•°ï¼Œæ’å…¥matplotlibå›¾å½¢å¯¹è±¡5ã€insert_fig_objecå‡½æ•°æµ‹è¯•6ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ17ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ28ã€æå–ä»£ç æ ¼å¼åŒ–è¾“å‡º9ã€é‡æ–°å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°10ã€æŸ¥çœ‹fgå¯¹è±¡ å…­ã€å¤šè½®å¯¹è¯å¢åŠ Pythonä»£ç è§£é‡Šå™¨æ•ˆæœ1ã€å®šä¹‰Pythonä»£ç æå–å‡½æ•°2ã€å¤§æ¨¡å‹ä¸¤æ¬¡è°ƒç”¨å°è£…3ã€å¤šè½®å¯¹è¯å‡½æ•°å®šä¹‰4ã€å®šä¹‰å·¥å…·åˆ—è¡¨5ã€å¤šè½®å¯¹è¯æµ‹è¯• ä¸ƒã€ç»“è¯­ ä¸€ã€å‰è¨€ åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å¤§å‹æ¨¡å‹çš„æ¨ç†èƒ½åŠ›å’ŒFunction CallingæŠ€æœ¯å®ç°ä»è‡ªç„¶è¯­è¨€åˆ°æ•°æ®æŸ¥è¯¢åˆ†æå¤„ç†çš„è½¬å˜ã€‚ç„¶è€Œï¼Œé™¤äº†ä¾èµ–å¤§æ¨¡å‹è‡ªèº«çš„èƒ½åŠ›ä¹‹å¤–ï¼Œæœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ä¸€äº›è¶…å‡ºå¤§æ¨¡å‹èƒ½åŠ›èŒƒå›´çš„ä»»åŠ¡ï¼Œä¾‹å¦‚è°ƒç”¨æœ¬åœ°ä»£ç åº“è¿›è¡Œæ•°æ®çš„å¯è§†åŒ–å±•ç¤ºã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡ä¸ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°å¢æ·»æ–°å¤–æŒ‚â€”â€”Pythonä»£ç è§£é‡Šå™¨ï¼Œæ¥è¿›ä¸€æ­¥å¢å¼ºå…¶èƒ½åŠ›ã€‚
äºŒã€å®ç°æœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ 1ã€å®šä¹‰æ•°æ®æå–å‡½æ•° å®šä¹‰ä¸€ä¸ªæ•°æ®æå–æœåŠ¡ï¼Œç”¨äºè¯»å–æ•°æ®åº“è¡¨ä¿¡æ¯ï¼Œæ”¾å…¥åˆ°dfå˜é‡ä¸­ï¼Œå¹¶è®¾ç½®æˆå…¨å±€å˜é‡
def extract_data(sql_query,df_name): &#34;&#34;&#34; ç”¨äºå€ŸåŠ©pymysqlï¼Œå°†MySQLä¸­çš„iqueryæ•°æ®åº“ä¸­çš„è¡¨è¯»å–å¹¶ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ã€‚ :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæå–MySQLä¸­iqueryæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ã€‚ :param df_name: å°†MySQLæ•°æ®åº“ä¸­æå–çš„è¡¨æ ¼è¿›è¡Œæœ¬åœ°ä¿å­˜æ—¶çš„å˜é‡åï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚ :returnï¼šè¡¨æ ¼è¯»å–å’Œä¿å­˜ç»“æœ &#34;&#34;&#34; mysql_pw = &#34;iquery_agent&#34; connection = pymysql.connect( host=&#39;localhost&#39;, # æ•°æ®åº“åœ°å€ user=&#39;iquery_agent&#39;, # æ•°æ®åº“ç”¨æˆ·å passwd=mysql_pw, # æ•°æ®åº“å¯†ç  db=&#39;iquery&#39;, # æ•°æ®åº“å charset=&#39;utf8&#39; # å­—ç¬¦é›†é€‰æ‹©utf8 ) # ä½¿ç”¨pandasçš„read_sqlæ–¹æ³•ï¼Œæ ¹æ®SQLæŸ¥è¯¢è¯­å¥ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°æœ¬åœ°å˜é‡ä¸­ globals()[df_name] = pd.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-03T07:30:00+08:00">
    <meta property="article:modified_time" content="2024-06-03T07:30:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡14ï¼š é›†æˆæœ¬åœ°Pythonä»£ç è§£é‡Šå™¨ï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>ç³»åˆ—ç¯‡ç« ğŸ’¥</h2> 
<p><a href="https://xundaomalu.blog.csdn.net/article/details/139169884" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡4ï¼šæ·±å…¥DB-GPTæ•°æ®åº”ç”¨å¼€å‘æ¡†æ¶è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139190028" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡5ï¼šæ¢ç´¢Open Interpreterå¼€æ”¾ä»£ç è§£é‡Šå™¨è°ƒç ”</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139186663" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡6ï¼šæŒæ¡Function Callingçš„è¯¦ç»†æµç¨‹</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139193382" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡7ï¼šFunction CallingæŠ€æœ¯å®æˆ˜è‡ªåŠ¨ç”Ÿæˆå‡½æ•°</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139194151" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡8ï¼šå¤šè½®å¯¹è¯ä¸Function CallingæŠ€æœ¯åº”ç”¨</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139205615" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡9ï¼šæ¢ç©¶Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„æ¶æ„ä¸åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216544" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡10ï¼šæ•°æ®é¢„å¤„ç†çš„è‰ºæœ¯ï¼šæ„å»ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°çš„åŸºç¡€</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139216752" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡11ï¼š Function CallingæŠ€æœ¯æ•´åˆï¼šå¼ºåŒ–Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŠŸèƒ½</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139372376" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡12ï¼š æ„å»ºäº’åŠ¨å¼Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼šå®ç°å¤šè½®å¯¹è¯æ§åˆ¶</a><br> <a href="https://xundaomalu.blog.csdn.net/article/details/139391333?spm=1001.2014.3001.5502" rel="nofollow">AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯-å®æˆ˜ç¯‡13ï¼š ä»å¯¹è¯åˆ°æŠ¥å‘Šï¼šæ‰“é€ èƒ½è®°å½•å’Œåˆ†æçš„Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#_0" rel="nofollow">ç³»åˆ—ç¯‡ç« ğŸ’¥</a></li><li><a href="#_21" rel="nofollow">ä¸€ã€å‰è¨€</a></li><li><a href="#Python_23" rel="nofollow">äºŒã€å®ç°æœ¬åœ°Pythonä»£ç è§£é‡Šå™¨</a></li><li><ul><li><a href="#1_24" rel="nofollow">1ã€å®šä¹‰æ•°æ®æå–å‡½æ•°</a></li><li><a href="#2_53" rel="nofollow">2ã€æ•°æ®æŸ¥è¯¢æ±²å–æµ‹è¯•</a></li><li><a href="#3_65" rel="nofollow">3ã€å˜é‡æ•°æ®æŸ¥çœ‹</a></li><li><a href="#4_75" rel="nofollow">4ã€æ•°æ®æ±²å–å‡½æ•°ä¿¡æ¯ç”Ÿæˆ</a></li><li><a href="#5_90" rel="nofollow">5ã€å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</a></li><li><a href="#6python_112" rel="nofollow">6ã€å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°</a></li><li><a href="#7python_150" rel="nofollow">7ã€è‡ªåŠ¨ç”Ÿæˆpythonä»£ç æ‰§è¡Œå‡½æ•°çš„ä¿¡æ¯</a></li><li><a href="#8python_163" rel="nofollow">8ã€ç¬¬ä¸€æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•ï¼ˆpythonä»£ç æ‰§è¡Œå‡½æ•°è°ƒç”¨æµ‹è¯•ï¼‰</a></li><li><a href="#9_215" rel="nofollow">9ã€ç¬¬äºŒæ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</a></li><li><a href="#10_253" rel="nofollow">10ã€ç¬¬ä¸‰æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</a></li></ul> 
  </li><li><a href="#_300" rel="nofollow">ä¸‰ã€å¯è§†åŒ–å±•ç¤ºæ•°æ®</a></li><li><ul><li><a href="#1_302" rel="nofollow">1ã€è·å–æ•°æ®</a></li><li><a href="#2_332" rel="nofollow">2ã€å¯è§†åŒ–å±•ç¤º</a></li></ul> 
  </li><li><a href="#_342" rel="nofollow">å››ã€æŠŠå¯è§†åŒ–å›¾ç‰‡å­˜å…¥äº‘ç›˜æ–‡æ¡£</a></li><li><ul><li><a href="#1_343" rel="nofollow">1ã€å›¾å½¢ç»˜åˆ¶æµ‹è¯•</a></li><li><a href="#2_363" rel="nofollow">2ã€å®šä¹‰å›¾ç‰‡å­˜å‚¨æœåŠ¡</a></li></ul> 
  </li><li><a href="#_fig_412" rel="nofollow">äº”ã€ å®ç°æŠŠå›¾ç‰‡å˜ä¸ºfigå¯¹è±¡çš„ä»£ç é€»è¾‘</a></li><li><ul><li><a href="#1_413" rel="nofollow">1ã€è·å–æ•°æ®</a></li><li><a href="#2_434" rel="nofollow">2ã€æŸ¥çœ‹ä»£ç </a></li><li><a href="#3_444" rel="nofollow">3ã€æ‰§è¡Œä»£ç ï¼ˆå¯è§†åŒ–å±•ç¤ºï¼‰</a></li><li><a href="#4insert_fig_objecmatplotlib_451" rel="nofollow">4ã€å®šä¹‰insert_fig_objecå‡½æ•°ï¼Œæ’å…¥matplotlibå›¾å½¢å¯¹è±¡</a></li><li><a href="#5insert_fig_objec_491" rel="nofollow">5ã€insert_fig_objecå‡½æ•°æµ‹è¯•</a></li><li><a href="#6gender1_502" rel="nofollow">6ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ1</a></li><li><a href="#7gender2_529" rel="nofollow">7ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ2</a></li><li><a href="#8_549" rel="nofollow">8ã€æå–ä»£ç æ ¼å¼åŒ–è¾“å‡º</a></li><li><a href="#9python_567" rel="nofollow">9ã€é‡æ–°å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°</a></li><li><a href="#10fg_601" rel="nofollow">10ã€æŸ¥çœ‹fgå¯¹è±¡</a></li></ul> 
  </li><li><a href="#Python_609" rel="nofollow">å…­ã€å¤šè½®å¯¹è¯å¢åŠ Pythonä»£ç è§£é‡Šå™¨æ•ˆæœ</a></li><li><ul><li><a href="#1Python_610" rel="nofollow">1ã€å®šä¹‰Pythonä»£ç æå–å‡½æ•°</a></li><li><a href="#2_624" rel="nofollow">2ã€å¤§æ¨¡å‹ä¸¤æ¬¡è°ƒç”¨å°è£…</a></li><li><a href="#3_732" rel="nofollow">3ã€å¤šè½®å¯¹è¯å‡½æ•°å®šä¹‰</a></li><li><a href="#4_838" rel="nofollow">4ã€å®šä¹‰å·¥å…·åˆ—è¡¨</a></li><li><a href="#5_845" rel="nofollow">5ã€å¤šè½®å¯¹è¯æµ‹è¯•</a></li></ul> 
  </li><li><a href="#_883" rel="nofollow">ä¸ƒã€ç»“è¯­</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_21"></a>ä¸€ã€å‰è¨€</h2> 
<p>åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å¤§å‹æ¨¡å‹çš„æ¨ç†èƒ½åŠ›å’ŒFunction CallingæŠ€æœ¯å®ç°ä»è‡ªç„¶è¯­è¨€åˆ°æ•°æ®æŸ¥è¯¢åˆ†æå¤„ç†çš„è½¬å˜ã€‚ç„¶è€Œï¼Œé™¤äº†ä¾èµ–å¤§æ¨¡å‹è‡ªèº«çš„èƒ½åŠ›ä¹‹å¤–ï¼Œæœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†ä¸€äº›è¶…å‡ºå¤§æ¨¡å‹èƒ½åŠ›èŒƒå›´çš„ä»»åŠ¡ï¼Œä¾‹å¦‚è°ƒç”¨æœ¬åœ°ä»£ç åº“è¿›è¡Œæ•°æ®çš„å¯è§†åŒ–å±•ç¤ºã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡ä¸ºAgentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°å¢æ·»æ–°å¤–æŒ‚â€”â€”Pythonä»£ç è§£é‡Šå™¨ï¼Œæ¥è¿›ä¸€æ­¥å¢å¼ºå…¶èƒ½åŠ›ã€‚</p> 
<h2><a id="Python_23"></a>äºŒã€å®ç°æœ¬åœ°Pythonä»£ç è§£é‡Šå™¨</h2> 
<h3><a id="1_24"></a>1ã€å®šä¹‰æ•°æ®æå–å‡½æ•°</h3> 
<p>å®šä¹‰ä¸€ä¸ªæ•°æ®æå–æœåŠ¡ï¼Œç”¨äºè¯»å–æ•°æ®åº“è¡¨ä¿¡æ¯ï¼Œæ”¾å…¥åˆ°dfå˜é‡ä¸­ï¼Œå¹¶è®¾ç½®æˆå…¨å±€å˜é‡</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract_data</span><span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span>df_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºå€ŸåŠ©pymysqlï¼Œå°†MySQLä¸­çš„iqueryæ•°æ®åº“ä¸­çš„è¡¨è¯»å–å¹¶ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ã€‚
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæå–MySQLä¸­iqueryæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ã€‚
    :param df_name: å°†MySQLæ•°æ®åº“ä¸­æå–çš„è¡¨æ ¼è¿›è¡Œæœ¬åœ°ä¿å­˜æ—¶çš„å˜é‡åï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚
    :returnï¼šè¡¨æ ¼è¯»å–å’Œä¿å­˜ç»“æœ
    """</span>
    
    mysql_pw <span class="token operator">=</span> <span class="token string">"iquery_agent"</span>
    
    connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
            host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>
            user<span class="token operator">=</span><span class="token string">'iquery_agent'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>
            passwd<span class="token operator">=</span>mysql_pw<span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>
            db<span class="token operator">=</span><span class="token string">'iquery'</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>
            charset<span class="token operator">=</span><span class="token string">'utf8'</span>  <span class="token comment"># å­—ç¬¦é›†é€‰æ‹©utf8</span>
        <span class="token punctuation">)</span>
    
    <span class="token comment"># ä½¿ç”¨pandasçš„read_sqlæ–¹æ³•ï¼Œæ ¹æ®SQLæŸ¥è¯¢è¯­å¥ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°æœ¬åœ°å˜é‡ä¸­</span>
    <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>df_name<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span> connection<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token string">"å·²æˆåŠŸå®Œæˆ%så˜é‡åˆ›å»º"</span> <span class="token operator">%</span> df_name
</code></pre> 
<h3><a id="2_53"></a>2ã€æ•°æ®æŸ¥è¯¢æ±²å–æµ‹è¯•</h3> 
<p>æµ‹è¯•æ•°æ®æŸ¥è¯¢ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªæœ¬åœ°å˜é‡ç”¨äºæ¥æ”¶æŸ¥è¯¢åˆ°çš„æ•°æ®</p> 
<pre><code class="prism language-python">sql_query <span class="token operator">=</span> <span class="token string">"SELECT * FROM user_demographics LIMIT 10"</span>
data_name <span class="token operator">=</span> <span class="token string">"test_dataframe"</span>
extract_data<span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span>data_name<span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/44/02/8gRZlzNq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3_65"></a>3ã€å˜é‡æ•°æ®æŸ¥çœ‹</h3> 
<p>æŸ¥çœ‹æœ¬åœ°çš„å…¨å±€å˜é‡ï¼Œç¡®è®¤æ˜¯å¦æœ‰æ¥æ”¶åˆ°æ•°æ®</p> 
<pre><code class="prism language-python">test_dataframe
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/a1/a2/rmCZvZPA_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4_75"></a>4ã€æ•°æ®æ±²å–å‡½æ•°ä¿¡æ¯ç”Ÿæˆ</h3> 
<p>ä½¿ç”¨å‡½æ•°è‡ªåŠ¨ç”Ÿæˆå™¨ï¼Œç”Ÿæˆæ•°æ®åº“æŸ¥è¯¢å‡½æ•°çš„ä¿¡æ¯</p> 
<pre><code class="prism language-python"><span class="token comment">#å®šä¹‰å‡½æ•°åˆ—è¡¨</span>
functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>extract_data<span class="token punctuation">]</span>
<span class="token comment">#å‡½æ•°ä¿¡æ¯ç”Ÿæˆæµ‹è¯•</span>
tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
tools
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/8c/43/Il7br8Pi_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><code> æ³¨æ„ï¼šè¯»å–æ•°æ®åº“å’Œpythonä»£ç è§£æçš„å‡½æ•°ä¿¡æ¯å»ºè®®é‡‡ç”¨è‡ªå·±æ‰‹å†™çš„æ–¹å¼ï¼Œé¿å…å¤§æ¨¡å‹ä¸ç¨³å®šï¼Œæœ‰æ—¶å€™ç”Ÿæˆçš„æ ¼å¼ä¸å¯¹</code></p> 
<h3><a id="5_90"></a>5ã€å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</h3> 
<p>æµ‹è¯•å¤§æ¨¡å‹èƒ½å¦æ­£å¸¸æ‰¾åˆ°å¯¹äºçš„æ•°æ®æ±²å–çš„å‡½æ•°</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsï¼Œå¹¶ä¿å­˜è‡³æœ¬åœ°"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/cd/8d/OSwPNlU2_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="6python_112"></a>6ã€å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°</h3> 
<p>å®šä¹‰ä¸€ä¸ªèƒ½å¤Ÿåœ¨æœ¬åœ°æ‰§è¡Œpythonä»£ç çš„å·¥å…·å‡½æ•°</p> 
<pre><code class="prism language-python"><span class="token comment"># èƒ½å¤Ÿåœ¨æœ¬åœ°æ‰§è¡Œpythonä»£ç çš„å¤–éƒ¨å‡½æ•°</span>
<span class="token comment"># å®šä¹‰ä¸€ä¸ªåä¸ºpython_interçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„pythonä»£ç ä½œä¸ºå‚æ•°</span>
<span class="token keyword">def</span> <span class="token function">python_inter</span><span class="token punctuation">(</span>py_code<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    è¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢å’Œå¤„ç†ï¼Œå¹¶è·å–æœ€ç»ˆæŸ¥è¯¢æˆ–å¤„ç†ç»“æœã€‚
    :param py_code: å­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ï¼Œæ­¤ä»£ç ç”¨äºæ‰§è¡Œå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡Œæ“ä½œ
    :returnï¼šè¿”å›ä»£ç è¿è¡Œçš„æœ€ç»ˆç»“æœ
    """</span>    
    <span class="token comment"># è®°å½•å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶ï¼Œå…¨å±€ä½œç”¨åŸŸå†…çš„å˜é‡å</span>
    global_vars_before <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment"># å°è¯•æ‰§è¡Œä¼ å…¥çš„ä»£ç ï¼Œä»£ç çš„ä½œç”¨åŸŸä¸ºå…¨å±€ä½œç”¨åŸŸ</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token comment"># å¦‚æœä»£ç æ‰§è¡Œå‡ºé”™ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token comment"># è®°å½•ä»£ç æ‰§è¡Œåï¼Œå…¨å±€ä½œç”¨åŸŸå†…çš„å˜é‡å</span>
    global_vars_after <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># è·å–æ‰§è¡Œä»£ç åæ–°äº§ç”Ÿçš„å…¨å±€å˜é‡å</span>
    new_vars <span class="token operator">=</span> global_vars_after <span class="token operator">-</span> global_vars_before
    <span class="token comment"># å¦‚æœæœ‰æ–°çš„å…¨å±€å˜é‡äº§ç”Ÿ</span>
    <span class="token keyword">if</span> new_vars<span class="token punctuation">:</span>
        <span class="token comment"># è¿”å›æ–°çš„å…¨å±€å˜é‡åŠå…¶å€¼</span>
        result <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>var<span class="token punctuation">:</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>var<span class="token punctuation">]</span> <span class="token keyword">for</span> var <span class="token keyword">in</span> new_vars<span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># å¦‚æœæ²¡æœ‰æ–°çš„å…¨å±€å˜é‡äº§ç”Ÿï¼Œå°è¯•è®¡ç®—å¹¶è¿”å›ä»£ç çš„æ‰§è¡Œç»“æœ</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token comment"># å¦‚æœè®¡ç®—ä»£ç æ‰§è¡Œç»“æœä¹Ÿå‡ºé”™ï¼Œè¿”å›æˆåŠŸæ‰§è¡Œä»£ç çš„æ¶ˆæ¯</span>
            <span class="token keyword">return</span> <span class="token string">"å·²ç»é¡ºåˆ©æ‰§è¡Œä»£ç "</span>
</code></pre> 
<h3><a id="7python_150"></a>7ã€è‡ªåŠ¨ç”Ÿæˆpythonä»£ç æ‰§è¡Œå‡½æ•°çš„ä¿¡æ¯</h3> 
<p>åˆ©ç”¨å¤§æ¨¡å‹ç”Ÿæˆfuncation callingéœ€è¦çš„å‡½æ•°ä¿¡æ¯ï¼ˆ<strong>å®è·µè¿ç”¨æ—¶å»ºè®®æ‰‹å†™ï¼Œé¿å…å¤§æ¨¡å‹ä¸ç¨³å®šç”Ÿæˆæ ¼å¼ä¸å¯¹</strong>ï¼‰</p> 
<pre><code class="prism language-python">functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>python_inter<span class="token punctuation">]</span>
tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
tools
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/68/f6/OJn1W7pD_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="8python_163"></a>8ã€ç¬¬ä¸€æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•ï¼ˆpythonä»£ç æ‰§è¡Œå‡½æ•°è°ƒç”¨æµ‹è¯•ï¼‰</h3> 
<p><strong>1ï¼‰è°ƒç”¨å¤§æ¨¡å‹ï¼Œå¹¶æ‰¾åˆ°å·¥å…·å‡½æ•°</strong><br> é€šè¿‡å¤§æ¨¡å‹APIè‡ªåŠ¨è°ƒç”¨pythonä»£ç æ‰§è¡Œå‡½æ•°ï¼Œæ£€æŸ¥ç¡®è®¤å¤§æ¨¡å‹æ˜¯å¦èƒ½æ‰¾çš„å·¥å…·å‡½æ•°python_inter</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"å·²ç»è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ä¿å­˜ä¸ºtest_dataframe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"test_dataframeæ˜¯å·²ç»å®šä¹‰å¥½çš„å˜é‡"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘æ£€æŸ¥test_dataframeä¸­æ€»å…±åŒ…å«å‡ ä¸ªå­—æ®µ"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/46/e7/D8rJxWMw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>2ï¼‰è·å–ä»£ç å˜é‡</strong></p> 
<pre><code class="prism language-python">py_code<span class="token operator">=</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments
<span class="token comment">#æ ¼å¼è½¬æ¢</span>
code <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>py_code<span class="token punctuation">)</span>
<span class="token comment">#æŸ¥çœ‹ä»£ç </span>
code
</code></pre> 
<p>è¾“å‡ºï¼šï¼ˆæŸ¥çœ‹å˜é‡ï¼‰<br> <img src="https://images2.imgbox.com/d9/7a/BevPTGMW_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>3ï¼‰å–å‡ºå˜é‡ä¿¡æ¯</strong></p> 
<pre><code class="prism language-python">code_str <span class="token operator">=</span> code<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"py_code"</span><span class="token punctuation">)</span>
<span class="token comment">#å–å‡ºä»£ç </span>
code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/c0/18/5oi91NcZ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <strong>4ï¼‰æ‰§è¡Œä»£ç ï¼Œçœ‹ç»“æœ</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#Pythonä»£ç æ‰§è¡Œæµ‹è¯•ï¼ˆæŸ¥çœ‹ç»è¿‡pythonä»£ç æ ¼å¼åŒ–ä¹‹åçš„æ•°æ®åº“æ•°æ®ï¼‰</span>
python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f4/b8/dN1PwB1Z_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="9_215"></a>9ã€ç¬¬äºŒæ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</h3> 
<p>ç¬¬äºŒæ¬¡å¤§æ¨¡å‹APIè°ƒç”¨æµ‹è¯•ï¼Œè·å–æŸ¥è¯¢user_paymentsæ•°æ®è¡¨ï¼Œè·å–å­—æ®µä¿¡æ¯å’Œå–å€¼èŒƒå›´ã€‚</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"å·²ç»è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ä¿å­˜ä¸ºtest_dataframe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"test_dataframeæ˜¯å·²ç»å®šä¹‰å¥½çš„å˜é‡"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘æ£€æŸ¥test_dataframeä¸­å„å­—æ®µçš„åŸºæœ¬ç±»å‹å’Œå–å€¼èŒƒå›´"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo-16k"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/45/e7/d11dlwML_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å‡½æ•°ä¿¡æ¯æŸ¥çœ‹ã€æå–</p> 
<pre><code class="prism language-python">code <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
code_str <span class="token operator">=</span> code<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"py_code"</span><span class="token punctuation">)</span>
code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/80/ff/1vHSmV7x_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä»£ç æ‰§è¡Œæµ‹è¯•</p> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/d2/vYf0lz0O_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="10_253"></a>10ã€ç¬¬ä¸‰æ¬¡å¤§æ¨¡å‹è°ƒç”¨æµ‹è¯•</h3> 
<p>ç¬¬ä¸‰æ¬¡å¤§æ¨¡å‹APIè°ƒç”¨æµ‹è¯•ï¼Œè·å–æŸ¥è¯¢user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ç»Ÿè®¡ç¼ºå¤±åˆ—ã€‚</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"å·²ç»è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ä¿å­˜ä¸ºtest_dataframe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"test_dataframeæ˜¯å·²ç»å®šä¹‰å¥½çš„å˜é‡"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘æ£€æŸ¥test_dataframeä¸­å„åˆ—çš„ç¼ºå¤±å€¼æƒ…å†µï¼Œå¹¶å°†ç»Ÿè®¡ç»“æœä¿å­˜ä¸ºmissing_valueå¯¹è±¡"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/97/af/Y8mOiiXy_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æŸ¥çœ‹å˜é‡ä¿¡æ¯ï¼šmissing_value<br> è·å–æŸ¥çœ‹å‡½æ•°</p> 
<pre><code class="prism language-python">code <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
code_str <span class="token operator">=</span> code<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"py_code"</span><span class="token punctuation">)</span>
code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/ea/53/6niAWAhn_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä»£ç æ‰§è¡Œ</p> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c7/6f/iTmmbFOi_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æŸ¥çœ‹æ‰§è¡Œåçš„å˜é‡</p> 
<pre><code class="prism language-python">missing_value
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/b6/gGj7Hymh_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_300"></a>ä¸‰ã€å¯è§†åŒ–å±•ç¤ºæ•°æ®</h2> 
<p>å€ŸåŠ©Pythonä»£ç è§£é‡Šå™¨è¿›è¡Œå¯è§†åŒ–æ•°æ®å±•ç¤º</p> 
<h3><a id="1_302"></a>1ã€è·å–æ•°æ®</h3> 
<p>æ ¹æ®å¤§æ¨¡å‹è·å–test_dataframeä¸­genderå­—æ®µä¿¡æ¯</p> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"å·²ç»è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ä¿å­˜ä¸ºtest_dataframe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"test_dataframeæ˜¯å·²ç»å®šä¹‰å¥½çš„å˜é‡"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘ç»Ÿè®¡test_dataframeä¸­genderå­—æ®µçš„ä¸åŒå–å€¼åˆ†å¸ƒæƒ…å†µï¼Œå¹¶ä»¥å¯è§†åŒ–å½¢å¼è¿›è¡Œå±•ç¤º"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/40/47/VjQw9h4U_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æŸ¥çœ‹å‡½æ•°ä¿¡æ¯</p> 
<pre><code class="prism language-python">code <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
code_str <span class="token operator">=</span> code<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"py_code"</span><span class="token punctuation">)</span>
code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/11/d3/NRM7oZZc_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="2_332"></a>2ã€å¯è§†åŒ–å±•ç¤º</h3> 
<p>æ‰§è¡Œpythonä»£ç è§£é‡Šå™¨ï¼Œè¿›è¡Œå¯è§†åŒ–å±•ç¤º</p> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/16/46/EZBrcBBP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_342"></a>å››ã€æŠŠå¯è§†åŒ–å›¾ç‰‡å­˜å…¥äº‘ç›˜æ–‡æ¡£</h2> 
<h3><a id="1_343"></a>1ã€å›¾å½¢ç»˜åˆ¶æµ‹è¯•</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># åˆ›å»ºä¸€ä¸ªå›¾å½¢</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/88/34/rwu8M9Lv_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æŸ¥çœ‹ç±»å‹</p> 
<pre><code class="prism language-python"><span class="token builtin">type</span><span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/de/87/uRgRGAto_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="2_363"></a>2ã€å®šä¹‰å›¾ç‰‡å­˜å‚¨æœåŠ¡</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> docx <span class="token keyword">import</span> Document
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> os
<span class="token keyword">import</span> tempfile

<span class="token keyword">def</span> <span class="token function">append_img_in_doc</span><span class="token punctuation">(</span>folder_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""""
    å¾€æ–‡ä»¶é‡Œè¿½åŠ å›¾ç‰‡
    @param folder_name=ç›®å½•åï¼Œdoc_name=æ–‡ä»¶åï¼Œimg=å›¾ç‰‡å¯¹è±¡ï¼Œæ•°æ®ç±»å‹ä¸ºmatplotlib.figure.Figureå¯¹è±¡
    """</span>
    base_path <span class="token operator">=</span> <span class="token string">"/root/autodl-tmp/iqueryé¡¹ç›®/iqueryäº‘ç›˜"</span>
    <span class="token comment">## ç›®å½•åœ°å€</span>
    full_path_folder<span class="token operator">=</span>base_path<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>folder_name
    <span class="token comment">## æ–‡ä»¶åœ°å€</span>
    full_path_doc <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">,</span> doc_name<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".doc"</span>
    

    <span class="token comment"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>full_path_folder<span class="token punctuation">)</span>
    
    <span class="token comment"># æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
        <span class="token comment"># æ–‡ä»¶å­˜åœ¨ï¼Œæ‰“å¼€å¹¶è¿½åŠ å†…å®¹</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£å¯¹è±¡</span>
        document <span class="token operator">=</span> Document<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># è¿½åŠ å›¾ç‰‡</span>
    <span class="token comment"># å°†matplotlibçš„Figureå¯¹è±¡ä¿å­˜ä¸ºä¸´æ—¶å›¾ç‰‡æ–‡ä»¶</span>
    <span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> suffix<span class="token operator">=</span><span class="token string">'.png'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tmpfile<span class="token punctuation">:</span>
        fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span>tmpfile<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'png'</span><span class="token punctuation">)</span>
        <span class="token comment"># å°†å›¾ç‰‡æ’å…¥åˆ°.docxæ–‡æ¡£ä¸­</span>
        document<span class="token punctuation">.</span>add_picture<span class="token punctuation">(</span>tmpfile<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    
    <span class="token comment"># ä¿å­˜æ–‡æ¡£</span>
    document<span class="token punctuation">.</span>save<span class="token punctuation">(</span>full_path_doc<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"å›¾ç‰‡å·²è¿½åŠ åˆ° </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>doc_name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    
append_img_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span><span class="token string">"ç”µä¿¡ç”¨æˆ·è¡Œä¸ºåˆ†æ"</span><span class="token punctuation">,</span> doc_name<span class="token operator">=</span><span class="token string">"æ•°æ®åˆ†æé—®ç­”"</span><span class="token punctuation">,</span> img<span class="token operator">=</span>fig<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/5d/46t5xEcp_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_fig_412"></a>äº”ã€ å®ç°æŠŠå›¾ç‰‡å˜ä¸ºfigå¯¹è±¡çš„ä»£ç é€»è¾‘</h2> 
<h3><a id="1_413"></a>1ã€è·å–æ•°æ®</h3> 
<pre><code class="prism language-python">messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"å·²ç»è¯»å–iqueryæ•°æ®åº“ä¸­çš„user_paymentsæ•°æ®è¡¨ï¼Œå¹¶ä¿å­˜ä¸ºtest_dataframe"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"test_dataframeæ˜¯å·²ç»å®šä¹‰å¥½çš„å˜é‡"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"è¯·å¸®æˆ‘ç»Ÿè®¡test_dataframeä¸­genderå­—æ®µçš„ä¸åŒå–å€¼åˆ†å¸ƒæƒ…å†µï¼Œå¹¶ä»¥å¯è§†åŒ–å½¢å¼è¿›è¡Œå±•ç¤ºï¼Œå¯è§†åŒ–å±•ç¤ºæ—¶è¯·å°½é‡ç»˜åˆ¶æ›´åŠ æ¸…æ™°ç¾è§‚çš„å›¾ç‰‡"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    
response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span>  
    <span class="token punctuation">)</span>

response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/87/saCdhppq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="2_434"></a>2ã€æŸ¥çœ‹ä»£ç </h3> 
<pre><code class="prism language-python">code <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
code_str <span class="token operator">=</span> code<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"py_code"</span><span class="token punctuation">)</span>
code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/8a/a0/T9rRlFNj_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="3_444"></a>3ã€æ‰§è¡Œä»£ç ï¼ˆå¯è§†åŒ–å±•ç¤ºï¼‰</h3> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/74/cDSPWbFd_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="4insert_fig_objecmatplotlib_451"></a>4ã€å®šä¹‰insert_fig_objecå‡½æ•°ï¼Œæ’å…¥matplotlibå›¾å½¢å¯¹è±¡</h3> 
<p>1ï¼‰æŸ¥çœ‹ä»£ç </p> 
<pre><code class="prism language-python">code_str
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/d9/VMa2uybb_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>2ï¼‰åœ¨ç»™å®šçš„ä»£ç å­—ç¬¦ä¸²ï¼ˆcode_strï¼‰ä¸­æ’å…¥ä¸€ä¸ªåä¸ºfigçš„matplotlibå›¾å½¢å¯¹è±¡<br> æ£€æŸ¥ä»£ç å­—ç¬¦ä¸²ä¸­æ˜¯å¦å·²ç»å­˜åœ¨figå¯¹è±¡çš„åˆ›å»ºï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åœ¨ç¬¬ä¸€æ¬¡å‡ºç°ç»˜å›¾ç›¸å…³ä»£ç çš„ä½ç½®ä¹‹å‰æ’å…¥figå¯¹è±¡çš„åˆ›å»ºã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨matplotlibç»˜å›¾æ—¶ï¼Œæ‰€æœ‰çš„ç»˜å›¾æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªå›¾å½¢å¯¹è±¡ä¸Šè¿›è¡Œ</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">insert_fig_object</span><span class="token punctuation">(</span>code_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> fig
    <span class="token comment"># æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ fig å¯¹è±¡çš„åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token string">'fig = plt.figure'</span> <span class="token keyword">in</span> code_str<span class="token punctuation">:</span>
        <span class="token keyword">return</span> code_str  <span class="token comment"># å¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›åŸå§‹ä»£ç å­—ç¬¦ä¸²</span>

    <span class="token comment"># å®šä¹‰å¯èƒ½çš„åº“åˆ«åå’Œå…¨å</span>
    plot_aliases <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'plt.'</span><span class="token punctuation">,</span> <span class="token string">'matplotlib.pyplot.'</span><span class="token punctuation">,</span><span class="token string">'plot'</span><span class="token punctuation">]</span>
    sns_aliases <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sns.'</span><span class="token punctuation">,</span> <span class="token string">'seaborn.'</span><span class="token punctuation">]</span>

    <span class="token comment"># å¯»æ‰¾ç¬¬ä¸€æ¬¡å‡ºç°ç»˜å›¾ç›¸å…³ä»£ç çš„ä½ç½®</span>
    first_plot_occurrence <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">(</span>code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span>alias<span class="token punctuation">)</span> <span class="token keyword">for</span> alias <span class="token keyword">in</span> plot_aliases <span class="token operator">+</span> sns_aliases <span class="token keyword">if</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span>alias<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
 
    <span class="token comment"># å¦‚æœæ‰¾åˆ°ç»˜å›¾ä»£ç ï¼Œåˆ™åœ¨è¯¥ä½ç½®ä¹‹å‰æ’å…¥ fig å¯¹è±¡çš„åˆ›å»º</span>
    <span class="token keyword">if</span> first_plot_occurrence <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        plt_figure_index <span class="token operator">=</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'plt.figure'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> plt_figure_index <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token comment"># å¯»æ‰¾ plt.figure åçš„æ‹¬å·ä½ç½®ï¼Œä»¥ç¡®å®šæ˜¯å¦æœ‰å‚æ•°</span>
            closing_bracket_index <span class="token operator">=</span> code_str<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">,</span> plt_figure_index<span class="token punctuation">)</span>
            <span class="token comment"># å¦‚æœæ‰¾åˆ°äº† plt.figure()ï¼Œåˆ™æ›¿æ¢ä¸º fig = plt.figure()</span>
            modified_str <span class="token operator">=</span> code_str<span class="token punctuation">[</span><span class="token punctuation">:</span>plt_figure_index<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'fig = '</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>plt_figure_index<span class="token punctuation">:</span>closing_bracket_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>closing_bracket_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            modified_str <span class="token operator">=</span> code_str<span class="token punctuation">[</span><span class="token punctuation">:</span>first_plot_occurrence<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'fig = plt.figure()\n'</span> <span class="token operator">+</span> code_str<span class="token punctuation">[</span>first_plot_occurrence<span class="token punctuation">:</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> modified_str
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> code_str  <span class="token comment"># å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç»˜å›¾ä»£ç ï¼Œåˆ™è¿”å›åŸå§‹ä»£ç å­—ç¬¦ä¸²</span>
</code></pre> 
<h3><a id="5insert_fig_objec_491"></a>5ã€insert_fig_objecå‡½æ•°æµ‹è¯•</h3> 
<pre><code class="prism language-python">code_temp1<span class="token operator">=</span><span class="token punctuation">(</span>
<span class="token string">"import matplotlib.pyplot as plt\n\n# ç»Ÿè®¡genderå­—æ®µçš„ä¸åŒå–å€¼åˆ†å¸ƒæƒ…å†µ\ngender_counts = test_dataframe['gender'].value_counts()\n\n# ç»˜åˆ¶æŸ±çŠ¶å›¾\nplt.figure(figsize=(8, 6))\nplt.bar(gender_counts.index, gender_counts.values)\nplt.xlabel('Gender')\nplt.ylabel('Count')\nplt.title('Distribution of Gender')\n\n# å±•ç¤ºå›¾å½¢\nplt.show()"</span>
<span class="token punctuation">)</span>
modified_str <span class="token operator">=</span> insert_fig_object<span class="token punctuation">(</span>code_temp1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>modified_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/07/8Xhp3dOX_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="6gender1_502"></a>6ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ1</h3> 
<ol><li>å¯¼å…¥matplotlib.pyplotåº“ï¼Œå¹¶å°†å…¶åˆ«åä¸ºpltã€‚</li><li>ç»Ÿè®¡test_dataframeä¸­genderå­—æ®µçš„ä¸åŒå–å€¼åˆ†å¸ƒæƒ…å†µï¼Œå°†ç»“æœå­˜å‚¨åœ¨gender_countså˜é‡ä¸­ã€‚</li><li>åˆ›å»ºä¸€ä¸ª8x6å¤§å°çš„å›¾å½¢å¯¹è±¡figã€‚</li><li>ä½¿ç”¨plt.bar()å‡½æ•°ç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œæ¨ªåæ ‡ä¸ºgender_countsçš„ç´¢å¼•ï¼ˆå³ä¸åŒçš„æ€§åˆ«å–å€¼ï¼‰ï¼Œçºµåæ ‡ä¸ºgender_countsçš„å€¼ï¼ˆå³æ¯ä¸ªæ€§åˆ«å–å€¼çš„æ•°é‡ï¼‰ã€‚</li><li>è®¾ç½®æ¨ªè½´æ ‡ç­¾ä¸ºâ€™Genderâ€™ï¼Œçºµè½´æ ‡ç­¾ä¸ºâ€™Countâ€™ï¼Œæ ‡é¢˜ä¸ºâ€™Distribution of Genderâ€™ã€‚</li><li>ä½¿ç”¨plt.show()å‡½æ•°å±•ç¤ºå›¾å½¢ã€‚</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># ç»Ÿè®¡genderå­—æ®µçš„ä¸åŒå–å€¼åˆ†å¸ƒæƒ…å†µ</span>
gender_counts <span class="token operator">=</span> test_dataframe<span class="token punctuation">[</span><span class="token string">'gender'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># ç»˜åˆ¶æŸ±çŠ¶å›¾</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>gender_counts<span class="token punctuation">.</span>index<span class="token punctuation">,</span> gender_counts<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Count'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Distribution of Gender'</span><span class="token punctuation">)</span>

<span class="token comment"># å±•ç¤ºå›¾å½¢</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º<br> <img src="https://images2.imgbox.com/e5/91/5cZel0s7_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="7gender2_529"></a>7ã€å¯è§†åŒ–å±•ç¤ºgenderå­—æ®µå–å€¼åˆ†å¸ƒ2</h3> 
<p>ä½¿ç”¨äº†seabornåº“æ¥è®¾ç½®å›¾å½¢æ ·å¼å’Œç»˜åˆ¶æŸ±çŠ¶å›¾</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns

counts <span class="token operator">=</span> test_dataframe<span class="token punctuation">[</span><span class="token string">'gender'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token string">'whitegrid'</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>barplot<span class="token punctuation">(</span>x<span class="token operator">=</span>counts<span class="token punctuation">.</span>index<span class="token punctuation">,</span> y<span class="token operator">=</span>counts<span class="token punctuation">.</span>values<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Distribution of Gender in test_dataframe'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Gender'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Count'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡º<br> <img src="https://images2.imgbox.com/ab/d4/ufXkuh0x_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="8_549"></a>8ã€æå–ä»£ç æ ¼å¼åŒ–è¾“å‡º</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract_python</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token comment"># ä½¿ç”¨literal_evalå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—å…¸</span>
    dict_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
    <span class="token comment"># æå–'sql_query'çš„å€¼</span>
    py_code_value <span class="token operator">=</span> dict_data<span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">]</span>
    <span class="token comment"># æå–å¹¶è¿”å›'sql_query'çš„å€¼</span>
    <span class="token keyword">return</span> py_code_value
    
json_str <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>tool_calls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments
<span class="token keyword">print</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>extract_python<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¾“å‡ºï¼š<br> <img src="https://images2.imgbox.com/3b/e5/G7BcShGD_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="9python_567"></a>9ã€é‡æ–°å®šä¹‰pythonä»£ç æ‰§è¡Œå‡½æ•°</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">python_inter</span><span class="token punctuation">(</span>py_code<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    ç”¨äºå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢å’Œå¤„ç†ï¼Œå¹¶è·å–æœ€ç»ˆæŸ¥è¯¢æˆ–å¤„ç†ç»“æœã€‚
    :param py_code: å­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ï¼Œç”¨äºæ‰§è¡Œå¯¹iqueryæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡Œæ“ä½œ
    :returnï¼šä»£ç è¿è¡Œçš„æœ€ç»ˆç»“æœ
    """</span>    
    <span class="token comment"># æ·»åŠ å›¾ç‰‡å¯¹è±¡ï¼Œå¦‚æœå­˜åœ¨ç»˜å›¾ä»£ç ï¼Œåˆ™åˆ›å»ºfigå¯¹è±¡</span>
    py_code <span class="token operator">=</span> insert_fig_object<span class="token punctuation">(</span>py_code<span class="token punctuation">)</span>
    global_vars_before <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">exec</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    global_vars_after <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    new_vars <span class="token operator">=</span> global_vars_after <span class="token operator">-</span> global_vars_before
    <span class="token keyword">if</span> new_vars<span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>var<span class="token punctuation">:</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>var<span class="token punctuation">]</span> <span class="token keyword">for</span> var <span class="token keyword">in</span> new_vars<span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span>py_code<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"å·²ç»é¡ºåˆ©æ‰§è¡Œä»£ç "</span>
</code></pre> 
<p>æµ‹è¯•</p> 
<pre><code class="prism language-python">python_inter<span class="token punctuation">(</span>code_str<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ff/ee/JruMbm1R_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="10fg_601"></a>10ã€æŸ¥çœ‹fgå¯¹è±¡</h3> 
<pre><code class="prism language-python">fig
</code></pre> 
<p><img src="https://images2.imgbox.com/82/15/8MsjMEmt_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="Python_609"></a>å…­ã€å¤šè½®å¯¹è¯å¢åŠ Pythonä»£ç è§£é‡Šå™¨æ•ˆæœ</h2> 
<h3><a id="1Python_610"></a>1ã€å®šä¹‰Pythonä»£ç æå–å‡½æ•°</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">extract_python</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>json_str<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> json_str<span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">]</span>   
       <span class="token comment"># ä½¿ç”¨literal_evalå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—å…¸</span>
    dict_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
    <span class="token comment"># æå–'sql_query'çš„å€¼</span>
    py_code_value <span class="token operator">=</span> dict_data<span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">]</span>
    <span class="token comment"># æå–å¹¶è¿”å›'sql_query'çš„å€¼</span>
    <span class="token keyword">return</span> py_code_value
</code></pre> 
<h3><a id="2_624"></a>2ã€å¤§æ¨¡å‹ä¸¤æ¬¡è°ƒç”¨å°è£…</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">check_code_run</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span>
                   project_name<span class="token punctuation">,</span>
                   doc_name<span class="token punctuation">,</span>
                   functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                   tools<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                   model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span>
                   auto_run <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œå¤–éƒ¨å‡½æ•°è°ƒç”¨çš„å¯¹è¯æ¨¡å‹
    :param messages: å¿…è¦å‚æ•°ï¼Œå­—å…¸ç±»å‹ï¼Œè¾“å…¥åˆ°Chatæ¨¡å‹çš„messageså‚æ•°å¯¹è±¡
    :param prject_name: é¡¹ç›®å
    :param doc_name: æ–‡ä»¶å
    :param functions_list: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œå¯ä»¥è®¾ç½®ä¸ºåŒ…å«å…¨éƒ¨å¤–éƒ¨å‡½æ•°çš„åˆ—è¡¨å¯¹è±¡
    :param model: Chatæ¨¡å‹ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ¨¡å‹ä¸ºgpt-3.5-turbo
    :returnï¼šChatæ¨¡å‹è¾“å‡ºç»“æœ
    """</span>
    code <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™æ‰§è¡Œæ™®é€šçš„å¯¹è¯ä»»åŠ¡</span>
    <span class="token keyword">if</span> functions_list <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
        
    <span class="token comment"># è‹¥å­˜åœ¨å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™éœ€è¦çµæ´»é€‰å–å¤–éƒ¨å‡½æ•°å¹¶è¿›è¡Œå›ç­”</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>

        <span class="token comment"># åˆ›å»ºå¤–éƒ¨å‡½æ•°åº“å­—å…¸</span>
        available_functions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">:</span> func <span class="token keyword">for</span> func <span class="token keyword">in</span> functions_list<span class="token punctuation">}</span>

        <span class="token comment"># ç¬¬ä¸€æ¬¡è°ƒç”¨å¤§æ¨¡å‹</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
                        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        tool_calls <span class="token operator">=</span> response_message<span class="token punctuation">.</span>tool_calls
        <span class="token keyword">if</span> tool_calls<span class="token punctuation">:</span>
            messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response_message<span class="token punctuation">)</span> 
            <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> tool_calls<span class="token punctuation">:</span>
                function_name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
                function_to_call <span class="token operator">=</span> available_functions<span class="token punctuation">[</span>function_name<span class="token punctuation">]</span>
                function_args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
                <span class="token comment">#########################################</span>
                    <span class="token comment"># åˆ›å»ºcodeå¯¹è±¡</span>
                <span class="token keyword">if</span> <span class="token string">'sql_inter'</span> <span class="token keyword">in</span> function_name <span class="token keyword">or</span> <span class="token string">'extract_data'</span> <span class="token keyword">in</span> function_name<span class="token punctuation">:</span>
                    code <span class="token operator">=</span> extract_sql<span class="token punctuation">(</span>function_args<span class="token punctuation">)</span>
                    <span class="token comment"># å°†ä»£ç å­—ç¬¦ä¸²è½¬æ¢ä¸ºMarkdownæ ¼å¼</span>
                    markdown_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"```sql\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">\n```"</span></span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    code <span class="token operator">=</span> extract_python<span class="token punctuation">(</span>function_args<span class="token punctuation">)</span>
                    
                    code <span class="token operator">=</span> insert_fig_object<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
                    <span class="token comment"># å°†ä»£ç å­—ç¬¦ä¸²è½¬æ¢ä¸ºMarkdownæ ¼å¼</span>
                    markdown_code <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"```python\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">\n```"</span></span>
                <span class="token comment">#########################################</span>
              
                <span class="token keyword">if</span> auto_run <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">:</span> 
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²å°†é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä¸‹ä»£ç å‡†å¤‡è¿è¡Œï¼š"</span><span class="token punctuation">)</span>
                    <span class="token comment"># åœ¨Jupyter Notebookä¸­å±•ç¤ºMarkdownæ ¼å¼çš„ä»£ç </span>
                    display<span class="token punctuation">(</span>Markdown<span class="token punctuation">(</span>markdown_code<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token comment">#sql_query = extract_sql_by_str(function_args)</span>
                    <span class="token comment">#print("æŠ½å–å‡ºæ¥çš„SQLï¼š" + sql_query)</span>

                    res <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'æ˜¯å¦ç¡®è®¤å¹¶ç»§ç»­æ‰§è¡Œï¼ˆ1ï¼‰ï¼Œæˆ–è€…é€€å‡ºæœ¬æ¬¡è¿è¡Œè¿‡ç¨‹ï¼ˆ2ï¼‰'</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ç»ˆæ­¢è¿è¡Œ"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token boolean">None</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ‰§è¡Œä»£ç ï¼Œè¯·ç¨å..."</span><span class="token punctuation">)</span>
                        
                function_response <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span><span class="token operator">**</span>function_args<span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"tool_call_id"</span><span class="token punctuation">:</span> tool_call<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"tool"</span><span class="token punctuation">,</span>
                        <span class="token string">"name"</span><span class="token punctuation">:</span> function_name<span class="token punctuation">,</span>
                        <span class="token string">"content"</span><span class="token punctuation">:</span> function_response<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span> 
            <span class="token comment">## ç¬¬äºŒæ¬¡è°ƒç”¨æ¨¡å‹</span>
            second_response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
            <span class="token punctuation">)</span> 
            <span class="token comment"># è·å–æœ€ç»ˆç»“æœ</span>
            final_response <span class="token operator">=</span> second_response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
    <span class="token keyword">del</span> messages
    <span class="token comment">##################################</span>
    <span class="token keyword">if</span> code<span class="token punctuation">:</span>
        substrings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'plt.'</span><span class="token punctuation">,</span> <span class="token string">'matplotlib.pyplot.'</span><span class="token punctuation">,</span> <span class="token string">'sns.'</span><span class="token punctuation">,</span> <span class="token string">'seaborn.'</span><span class="token punctuation">,</span><span class="token string">'plot'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>substring <span class="token keyword">in</span> code <span class="token keyword">for</span> substring <span class="token keyword">in</span> substrings<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">global</span> fig
            append_img_in_doc<span class="token punctuation">(</span>project_name<span class="token punctuation">,</span> doc_name<span class="token punctuation">,</span> img<span class="token operator">=</span>fig<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å›¾ç‰‡ä¿å­˜æˆåŠŸï¼"</span><span class="token punctuation">)</span>
    <span class="token comment">################################</span>
                
    <span class="token keyword">return</span> final_response
</code></pre> 
<h3><a id="3_732"></a>3ã€å¤šè½®å¯¹è¯å‡½æ•°å®šä¹‰</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tiktoken

<span class="token keyword">def</span> <span class="token function">chat_with_inter</span><span class="token punctuation">(</span>functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> 
                    prompt<span class="token operator">=</span><span class="token string">"ä½ å¥½å‘€"</span><span class="token punctuation">,</span> 
                    model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
                    system_message<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ã€‚"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    auto_run <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨åˆå§‹åŒ–å¤–éƒ¨å‡½æ•°åº“"</span><span class="token punctuation">)</span>
    <span class="token comment"># åˆ›å»ºå‡½æ•°åˆ—è¡¨å¯¹åº”çš„å‚æ•°è§£é‡Šåˆ—è¡¨</span>
    functions <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
    <span class="token comment">#print(functions)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¤–éƒ¨å‡½æ•°åº“åˆå§‹åŒ–å®Œæˆ"</span><span class="token punctuation">)</span>
    project_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥å½“å‰åˆ†æé¡¹ç›®åç§°ï¼š"</span><span class="token punctuation">)</span>
    folder_name <span class="token operator">=</span> create_directory<span class="token punctuation">(</span>project_name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å·²å®Œæˆæ•°æ®åˆ†ææ–‡ä»¶åˆ›å»º"</span><span class="token punctuation">)</span>
    doc_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥å½“å‰åˆ†æé˜¶æ®µï¼Œå¦‚æ•°æ®æ¢ç´¢é˜¶æ®µå’Œç†è§£ã€æ•°æ®æ¸…æ´—é˜¶æ®µç­‰ï¼š"</span><span class="token punctuation">)</span>
    doc_name <span class="token operator">+=</span> <span class="token string">'é—®ç­”'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"å¥½çš„ï¼Œå³å°†è¿›å…¥äº¤äº’å¼åˆ†ææµç¨‹"</span><span class="token punctuation">)</span>
    <span class="token comment"># å¤šè½®å¯¹è¯é˜ˆå€¼</span>
    <span class="token keyword">if</span> <span class="token string">'gpt-4'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">6000</span>
    <span class="token keyword">elif</span> <span class="token string">'16k'</span> <span class="token keyword">in</span> model<span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">14000</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        tokens_thr <span class="token operator">=</span> <span class="token number">3000</span>
    
    messages <span class="token operator">=</span> system_message
    <span class="token comment">## å®Œæˆç»™ç”¨æˆ·è¾“å…¥çš„é—®é¢˜èµ‹å€¼</span>
    user_input <span class="token operator">=</span> prompt
    messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> prompt<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">## è®¡ç®—tokenå¤§å°</span>
    embedding_model <span class="token operator">=</span> <span class="token string">"text-embedding-ada-002"</span>
    <span class="token comment"># æ¨¡å‹å¯¹åº”çš„åˆ†è¯å™¨ï¼ˆTOKENIZERï¼‰</span>
    embedding_encoding <span class="token operator">=</span> <span class="token string">"cl100k_base"</span>
    encoding <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>get_encoding<span class="token punctuation">(</span>embedding_encoding<span class="token punctuation">)</span>
    tokens_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">(</span>prompt <span class="token operator">+</span> system_message<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           
        answer <span class="token operator">=</span> check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span>
                                project_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span>
                                doc_name <span class="token operator">=</span> doc_name<span class="token punctuation">,</span>
                                functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
                                tools<span class="token operator">=</span>functions<span class="token punctuation">,</span>
                                model<span class="token operator">=</span>model<span class="token punctuation">,</span> 
                                auto_run <span class="token operator">=</span> auto_run<span class="token punctuation">)</span>
        
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¨¡å‹å›ç­”: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>answer<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment">#####################åˆ¤æ–­æ˜¯å¦è®°å½•æ–‡æ¡£ start#######################</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            record <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'æ˜¯å¦è®°å½•æœ¬æ¬¡å›ç­”ï¼ˆ1ï¼‰ï¼Œè¿˜æ˜¯å†æ¬¡è¾“å…¥é—®é¢˜å¹¶ç”Ÿæˆè¯¥é—®é¢˜ç­”æ¡ˆï¼ˆ2ï¼‰'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> record <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
                
                Q_temp <span class="token operator">=</span> <span class="token string">'Q:'</span> <span class="token operator">+</span> user_input
                A_temp <span class="token operator">=</span> <span class="token string">'A:'</span> <span class="token operator">+</span> answer
                
                append_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span> 
                                               doc_name<span class="token operator">=</span>doc_name<span class="token punctuation">,</span> 
                                               qa_string<span class="token operator">=</span>Q_temp<span class="token punctuation">)</span>
                append_in_doc<span class="token punctuation">(</span>folder_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span> 
                                               doc_name<span class="token operator">=</span>doc_name<span class="token punctuation">,</span> 
                                               qa_string<span class="token operator">=</span>A_temp<span class="token punctuation">)</span>
                
                <span class="token comment"># è®°å½•æœ¬è½®é—®é¢˜ç­”æ¡ˆ</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> answer<span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'å¥½çš„ï¼Œè¯·å†æ¬¡è¾“å…¥é—®é¢˜'</span><span class="token punctuation">)</span>
                user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                messages<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_input
                answer <span class="token operator">=</span> check_code_run<span class="token punctuation">(</span>messages<span class="token punctuation">,</span> 
                                        project_name<span class="token operator">=</span>project_name<span class="token punctuation">,</span>
                                        doc_name <span class="token operator">=</span> doc_name<span class="token punctuation">,</span>
                                        functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span>
                                        tools<span class="token operator">=</span>functions<span class="token punctuation">,</span>
                                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>                                       
                                        auto_run <span class="token operator">=</span> auto_run<span class="token punctuation">)</span>  
                
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"æ¨¡å‹å›ç­”: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>answer<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                
        <span class="token comment">########################åˆ¤æ–­æ˜¯å¦è®°å½•æ–‡æ¡£ stop #######################</span>
        

        <span class="token comment"># è¯¢é—®ç”¨æˆ·æ˜¯å¦è¿˜æœ‰å…¶ä»–é—®é¢˜</span>
        user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯): "</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> user_input <span class="token operator">==</span> <span class="token string">"é€€å‡º"</span><span class="token punctuation">:</span>
            <span class="token keyword">del</span> messages
            <span class="token keyword">break</span>

        <span class="token comment"># è®°å½•æ–°ä¸€è½®é—®ç­”</span>
        messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> answer<span class="token punctuation">}</span><span class="token punctuation">)</span>
        messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_input<span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token comment"># è®¡ç®—å½“å‰æ€»tokenæ•°</span>
        tokens_count <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">(</span>answer <span class="token operator">+</span> user_input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># åˆ é™¤è¶…å‡ºtokené˜ˆå€¼çš„å¯¹è¯å†…å®¹</span>
        <span class="token keyword">while</span> tokens_count <span class="token operator">&gt;=</span> tokens_thr<span class="token punctuation">:</span>
            tokens_count <span class="token operator">-=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>messages<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4_838"></a>4ã€å®šä¹‰å·¥å…·åˆ—è¡¨</h3> 
<pre><code class="prism language-python"><span class="token comment">#sql_inter,</span>
functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>extract_data<span class="token punctuation">,</span> python_inter<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="5_845"></a>5ã€å¤šè½®å¯¹è¯æµ‹è¯•</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> IPython<span class="token punctuation">.</span>display <span class="token keyword">import</span> display<span class="token punctuation">,</span> Markdown<span class="token punctuation">,</span> Code

chat_with_inter<span class="token punctuation">(</span>functions_list<span class="token operator">=</span>functions_list<span class="token punctuation">,</span> 
                prompt<span class="token operator">=</span><span class="token string">"è¯·å°†iqueryæ•°æ®åº“ä¸­çš„user_demographicsè¡¨ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ï¼Œå¹¶å‘½åä¸ºuser_demographics_df"</span><span class="token punctuation">,</span> 
                model<span class="token operator">=</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">,</span> 
                system_message<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> md_content<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                auto_run <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¯¹è¯æ•ˆæœ</p> 
<pre><code class="prism language-python">æ­£åœ¨åˆå§‹åŒ–å¤–éƒ¨å‡½æ•°åº“
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'extract_data'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨äºå€ŸåŠ©pymysqlï¼Œå°†MySQLä¸­çš„iqueryæ•°æ®åº“ä¸­çš„è¡¨è¯»å–å¹¶ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ã€‚'</span><span class="token punctuation">,</span> <span class="token string">'parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span> <span class="token string">'properties'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'sql_query'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæå–MySQLä¸­iqueryæ•°æ®åº“ä¸­çš„æŸå¼ è¡¨ã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'df_name'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å°†MySQLæ•°æ®åº“ä¸­æå–çš„è¡¨æ ¼è¿›è¡Œæœ¬åœ°ä¿å­˜æ—¶çš„å˜é‡åï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sql_query'</span><span class="token punctuation">,</span> <span class="token string">'df_name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'function'</span><span class="token punctuation">,</span> <span class="token string">'function'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'python_inter'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'ç”¨äºå¯¹chatbiæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡ŒæŸ¥è¯¢å’Œå¤„ç†ï¼Œå¹¶è·å–æœ€ç»ˆæŸ¥è¯¢æˆ–å¤„ç†ç»“æœã€‚'</span><span class="token punctuation">,</span> <span class="token string">'parameters'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span> <span class="token string">'properties'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'py_code'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'å­—ç¬¦ä¸²å½¢å¼çš„Pythonä»£ç ï¼Œç”¨äºæ‰§è¡Œå¯¹chatbiæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨è¿›è¡Œæ“ä½œ'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'py_code'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
å¤–éƒ¨å‡½æ•°åº“åˆå§‹åŒ–å®Œæˆ
è¯·è¾“å…¥å½“å‰åˆ†æé¡¹ç›®åç§°ï¼š ç”µä¿¡ç”¨æˆ·è¡Œä¸ºåˆ†æç›®å½• ç”µä¿¡ç”¨æˆ·è¡Œä¸ºåˆ†æ å·²å­˜åœ¨
å·²å®Œæˆæ•°æ®åˆ†ææ–‡ä»¶åˆ›å»º
è¯·è¾“å…¥å½“å‰åˆ†æé˜¶æ®µï¼Œå¦‚æ•°æ®æ¢ç´¢é˜¶æ®µå’Œç†è§£ã€æ•°æ®æ¸…æ´—é˜¶æ®µç­‰ï¼š æ•°æ®å¯è§†åŒ–
å¥½çš„ï¼Œå³å°†è¿›å…¥äº¤äº’å¼åˆ†ææµç¨‹
å·²å°†é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä¸‹ä»£ç å‡†å¤‡è¿è¡Œï¼š

æ˜¯å¦ç¡®è®¤å¹¶ç»§ç»­æ‰§è¡Œï¼ˆ<span class="token number">1</span>ï¼‰ï¼Œæˆ–è€…é€€å‡ºæœ¬æ¬¡è¿è¡Œè¿‡ç¨‹ï¼ˆ<span class="token number">2</span>ï¼‰ <span class="token number">1</span>
æ­£åœ¨æ‰§è¡Œä»£ç ï¼Œè¯·ç¨å<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">/</span>tmp<span class="token operator">/</span>ipykernel_150812<span class="token operator">/</span><span class="token number">966933623</span><span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span> UserWarning<span class="token punctuation">:</span> pandas only supports SQLAlchemy connectable <span class="token punctuation">(</span>engine<span class="token operator">/</span>connection<span class="token punctuation">)</span> <span class="token keyword">or</span> database string URI <span class="token keyword">or</span> sqlite3 DBAPI2 connection<span class="token punctuation">.</span> Other DBAPI2 objects are <span class="token keyword">not</span> tested<span class="token punctuation">.</span> Please consider using SQLAlchemy<span class="token punctuation">.</span>
<span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>df_name<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_sql<span class="token punctuation">(</span>sql_query<span class="token punctuation">,</span> connection<span class="token punctuation">)</span>

æ¨¡å‹å›ç­”<span class="token punctuation">:</span> å·²å°†iqueryæ•°æ®åº“ä¸­çš„user_demographicsæ•°æ®è¡¨ä¿å­˜åˆ°æœ¬åœ°Pythonç¯å¢ƒä¸­ï¼Œå¹¶å‘½åä¸ºuser_demographics_dfã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥å˜é‡è¿›è¡Œè¿›ä¸€æ­¥çš„æ•°æ®åˆ†æå’Œå¤„ç†äº†ã€‚
æ˜¯å¦è®°å½•æœ¬æ¬¡å›ç­”ï¼ˆ<span class="token number">1</span>ï¼‰ï¼Œè¿˜æ˜¯å†æ¬¡è¾“å…¥é—®é¢˜å¹¶ç”Ÿæˆè¯¥é—®é¢˜ç­”æ¡ˆï¼ˆ<span class="token number">2</span>ï¼‰ <span class="token number">1</span>
å†…å®¹å·²è¿½åŠ åˆ° æ•°æ®å¯è§†åŒ–é—®ç­”
å†…å®¹å·²è¿½åŠ åˆ° æ•°æ®å¯è§†åŒ–é—®ç­”
æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ<span class="token punctuation">(</span>è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯<span class="token punctuation">)</span><span class="token punctuation">:</span>  ç”¨å¯è§†åŒ–çš„æ–¹å¼å±•ç¤ºuser_demographics_dfæ•°æ®é›†ä¸­genderå­—æ®µä¸åŒå–å€¼çš„å æ¯”æƒ…å†µ
å·²å°†é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä¸‹ä»£ç å‡†å¤‡è¿è¡Œï¼š
æ˜¯å¦ç¡®è®¤å¹¶ç»§ç»­æ‰§è¡Œï¼ˆ<span class="token number">1</span>ï¼‰ï¼Œæˆ–è€…é€€å‡ºæœ¬æ¬¡è¿è¡Œè¿‡ç¨‹ï¼ˆ<span class="token number">2</span>ï¼‰ <span class="token number">1</span>
æ­£åœ¨æ‰§è¡Œä»£ç ï¼Œè¯·ç¨å<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/73/c7/XQdLabAO_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_883"></a>ä¸ƒã€ç»“è¯­</h2> 
<p>é€šè¿‡ä¸Šè¿°æ­¥éª¤çš„å®è·µåº”ç”¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå°†æœ¬åœ°pythonä»£ç è§£é‡Šå™¨æ•´åˆè¿›å…¥äº†Agentæ™ºèƒ½æ•°æ®åˆ†æå¹³å°ï¼Œåˆ°æ­¤ï¼Œæ™ºèƒ½æ•°æ®åˆ†æå¹³å°åŒæ—¶å…¼å®¹äº†æˆ‘ä»¬è°ƒç ”é¡¹ç›®ä¸­çš„DB-GPTå’ŒOpen Interpreterä¸¤è€…çš„ä¼˜åŠ¿ç‰¹ç‚¹ã€‚ç›¸å½“äºç»™å¹³å°è£…ä¸Šäº†ä¸¤ä¸ªç¿…è†€ï¼Œä¸€ä¸ªç”¨äºSQLè§£æã€ä¸€ä¸ªç”¨äºä»£ç è§£é‡Šï¼›ä»è€Œè®©å¹³å°çš„æ•°æ®å¤„ç†èƒ½åŠ›æ›´ä¸Šä¸€å±‚æ¥¼ã€‚</p> 
<p><img src="https://images2.imgbox.com/d4/84/oQv0HOm1_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ¯ğŸ”–æ›´å¤šä¸“æ ç³»åˆ—æ–‡ç« ï¼š<a href="https://blog.csdn.net/xiaobing259/category_12628007.html?spm=1001.2014.3001.5482"><strong>AIGC-AIå¤§æ¨¡å‹æ¢ç´¢ä¹‹è·¯</strong></a></p> 
<blockquote> 
 <p>ğŸ˜ <strong>ä½œè€…ä»‹ç»</strong>ï¼šæˆ‘æ˜¯å¯»é“AIå°å…µï¼Œèµ„æ·±ç¨‹åºè€çŒ¿ï¼Œä»ä¸š10å¹´+ã€äº’è”ç½‘ç³»ç»Ÿæ¶æ„å¸ˆï¼Œç›®å‰ä¸“æ³¨äºAIGCçš„æ¢ç´¢ã€‚<br> ğŸ“– <strong>æŠ€æœ¯äº¤æµ</strong>ï¼šå»ºç«‹æœ‰æŠ€æœ¯äº¤æµç¾¤ï¼Œå¯ä»¥æ‰«ç ğŸ‘‡ åŠ å…¥ç¤¾ç¾¤ï¼Œ500æœ¬å„ç±»ç¼–ç¨‹ä¹¦ç±ã€AIæ•™ç¨‹ã€AIå·¥å…·ç­‰ä½ é¢†å–ï¼<br> <strong>å¦‚æœæ–‡ç« å†…å®¹å¯¹æ‚¨æœ‰æ‰€è§¦åŠ¨ï¼Œåˆ«å¿˜äº†<font color="red"><strong>ç‚¹èµã€â­å…³æ³¨ï¼Œæ”¶è—</strong></font>ï¼åŠ å…¥æˆ‘ï¼Œè®©æˆ‘ä»¬æºæ‰‹åŒè¡ŒAIçš„æ¢ç´¢ä¹‹æ—…ï¼Œä¸€èµ·å¼€å¯æ™ºèƒ½æ—¶ä»£çš„å¤§é—¨ï¼</strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36f9407cfb1f4da7a2378dd78c0a59b5/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å¦‚ä½•åœ¨iPadpro2021åŠä»¥ä¸Šå‹å·çš„iOS 17ç³»ç»Ÿä¸‹å®‰è£…UTMè™šæ‹Ÿæœºè¿è¡ŒWindows 11</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e54f09b77c230aa7d7a445751d8edd36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">åª³å¦‡é¢è¯•äº†ä¸€å®¶å…¬å¸ï¼ŒæœŸæœ›æœˆè–ª20Kï¼Œå¯¹æ–¹æ²¡å¤šé—®å°±ç­”åº”äº†ï¼Œåªè¦æ±‚3å¤©å†…åˆ°å²—ï¼Œå¯æˆ‘æ€»è§‰å¾—å“ªé‡Œä¸å¯¹åŠ²ã€‚</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>