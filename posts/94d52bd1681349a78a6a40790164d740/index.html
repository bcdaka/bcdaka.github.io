<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Flink-CDC解析（第47天） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/94d52bd1681349a78a6a40790164d740/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Flink-CDC解析（第47天）">
  <meta property="og:description" content="前言 本文主要概述了Flink-CDC.
1. CDC 概述 1.1 什么是CDC？ CDC是（Change Data Capture 变更数据获取）的简称 ，在广义的概念上，只要是能捕获数据变更的技术，都可以称之为 CDC。
核心思想是，监测并捕获数据库的变动（包括数据 或 数据表的插入INSERT、更新UPDATE、删除DELETE等），将这些变更按发生的顺序完整记录下来，写入到消息中间件中以供其他服务进行订阅及消费。
CDC 技术的应用场景非常广泛：
数据同步：用于数据备份，容灾；数据分发：一个数据源分发给多个下游系统；数据采集：面向数据仓库 / 数据湖的 ETL 数据集成，是非常重要的数据源。 1.2 CDC的实现机制 CDC 的技术方案非常多，目前业界主流的实现机制可以分为两种：
1) 基于主动查询的 CDC： 用户通常会在数据源表的某个字段中，保存上次更新的时间戳或版本号等信息，然后下游通过不断的查询和与上次的记录做对比，来确定数据是否有变动，是否需要同步。
特点：
 离线调度查询作业，批处理。把一张表同步到其他系统，每次通过查询去获取表中最新的数据;
 无法保障数据一致性，查的过程中有可能数据已经发生了多次变更；
 持续的频繁查询对数据库的压力较大。
 不保障实时性，基于离线调度存在天然的延迟。
2) 基于事件接收CDC： 可以通过触发器（Trigger）或者日志（例如 Transaction log、Binary log、Write-ahead log 等）来实现。当数据源表发生变动时，会通过附加在表上的触发器或者 binlog 等途径，将操作记录下来。下游可以通过数据库底层的协议，订阅并消费这些事件，然后对数据库变动记录做重放，从而实现同步。
 实时消费日志，流处理，例如 MySQL 的 binlog 日志完整记录了数据库中的变更，可以把 binlog 文件当作流的数据源；
 保障数据一致性，因为 binlog 文件包含了所有历史变更明细；
 保障实时性，因为类似 binlog 的日志文件是可以流式消费的，提供的是实时数据。
基于查询的CDC 基于Binlog的CDC
经过以上对比，可以发现基于日志CDC 有以下这几种优势：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-27T17:46:58+08:00">
    <meta property="article:modified_time" content="2024-07-27T17:46:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flink-CDC解析（第47天）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>前言</h2> 
<p>本文主要概述了Flink-CDC.</p> 
<h3><a id="1_%09CDC__4"></a>1. CDC 概述</h3> 
<h4><a id="11_%09CDC_5"></a>1.1 什么是CDC？</h4> 
<p>CDC是（Change Data Capture 变更数据获取）的简称 ，在广义的概念上，只要是能捕获数据变更的技术，都可以称之为 CDC。<br> 核心思想是，监测并捕获数据库的变动（包括数据 或 数据表的插入INSERT、更新UPDATE、删除DELETE等），将这些变更按发生的顺序完整记录下来，写入到消息中间件中以供其他服务进行订阅及消费。<br> CDC 技术的应用场景非常广泛：</p> 
<ol><li>数据同步：用于数据备份，容灾；</li><li>数据分发：一个数据源分发给多个下游系统；</li><li>数据采集：面向数据仓库 / 数据湖的 ETL 数据集成，是非常重要的数据源。</li></ol> 
<h4><a id="12_%09CDC_12"></a>1.2 CDC的实现机制</h4> 
<p>CDC 的技术方案非常多，目前业界主流的实现机制可以分为两种：</p> 
<h4><a id="1%09_CDC_14"></a>1) 基于主动查询的 CDC：</h4> 
<p>用户通常会在数据源表的某个字段中，保存上次更新的时间戳或版本号等信息，然后下游通过不断的查询和与上次的记录做对比，来确定数据是否有变动，是否需要同步。<br> 特点：<br>  离线调度查询作业，批处理。把一张表同步到其他系统，每次通过查询去获取表中最新的数据;<br>  无法保障数据一致性，查的过程中有可能数据已经发生了多次变更；<br>  持续的频繁查询对数据库的压力较大。<br>  不保障实时性，基于离线调度存在天然的延迟。</p> 
<h4><a id="2%09CDC_21"></a>2) 基于事件接收CDC：</h4> 
<p>可以通过触发器（Trigger）或者日志（例如 Transaction log、Binary log、Write-ahead log 等）来实现。当数据源表发生变动时，会通过附加在表上的触发器或者 binlog 等途径，将操作记录下来。下游可以通过数据库底层的协议，订阅并消费这些事件，然后对数据库变动记录做重放，从而实现同步。<br>  实时消费日志，流处理，例如 MySQL 的 binlog 日志完整记录了数据库中的变更，可以把 binlog 文件当作流的数据源；<br>  保障数据一致性，因为 binlog 文件包含了所有历史变更明细；<br>  保障实时性，因为类似 binlog 的日志文件是可以流式消费的，提供的是实时数据。<br> 基于查询的CDC 基于Binlog的CDC<br> <img src="https://images2.imgbox.com/6a/e5/l8k6UI83_o.png" alt="在这里插入图片描述"></p> 
<p>经过以上对比，可以发现基于日志CDC 有以下这几种优势：</p> 
<ol><li> <p>能够捕获所有数据的变化，捕获完整的变更记录。在异地容灾，数据备份等场景中得到广泛应用，如果是基于查询的 CDC 有可能导致两次查询的中间一部分数据丢失</p> </li><li> <p>每次 DML 操作均有记录无需像查询 CDC 这样发起全表扫描进行过滤，拥有更高的效率和性能，具有低延迟，不增加数据库负载的优势</p> </li><li> <p>无需入侵业务，业务解耦，无需更改业务模型<br> 1.3 常见的开源 CDC 方案</p> </li><li> <p>对比全量同步能力:<br>  基于查询或者日志的 CDC 方案基本都支持，除了 Canal(仅支持增量)。<br>  对比全量 + 增量同步的能力，只有 Flink CDC、Debezium、Oracle Goldengate 支持较好。</p> </li><li> <p>对比增量同步能力:<br>  基于日志的方式，可以很好的做到增量同步；<br>  而基于查询的方式是很难做到增量同步的。</p> </li><li> <p>从架构角度去看：<br> 该表将架构分为单机和分布式，这里的分布式架构不单纯体现在数据读取能力的水平扩展上，更重要的是在大数据场景下分布式系统接入能力。例如 Flink CDC 的数据入湖或者入仓的时候，下游通常是分布式的系统，如 Hive、HDFS、Iceberg、Hudi 等，那么从对接入分布式系统能力上看，Flink CDC 的架构能够很好地接入此类系统。</p> </li><li> <p>在数据转换 / 数据清洗能力上：<br> 当数据进入到 CDC 工具的时候是否能较方便的对数据做一些过滤或者清洗，甚至聚合。<br>  在 Flink CDC 上操作相当简单，可以通过 Flink SQL 去操作这些数据；<br>  DataX、Debezium 等则需要通过脚本或者模板去做，所以用户的使用门槛会比较高。</p> </li><li> <p>在生态扩展方面:<br> 这里指的是下游的一些数据库或者数据源的支持。Flink CDC 下游有丰富的 Connector，例如写入到 TiDB、MySQL、Pg、HBase、Kafka、ClickHouse 等常见的一些系统，也支持各种自定义 connector。</p> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/468ae3f43271125a80a556cbaef9c2df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[CISCN2019 华东南赛区]Web11</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35a53ce593d4b2b0c12cb3b768683d52/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构】优先级队列(堆)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>