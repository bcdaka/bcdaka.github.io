<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PHP进阶-CentOS7部署LNMP服务架构的项目 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f44e2938f65f61e79044967429c57d98/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="PHP进阶-CentOS7部署LNMP服务架构的项目">
  <meta property="og:description" content="在开发和部署Web应用时，LNMP（Linux、Nginx、MySQL、PHP）的组合是非常常见的。这篇博客将介绍如何通过一个简单的脚本，在CentOS 7上部署LNMP，并将PHP项目自动部署到服务器上。这不仅可以节省大量的时间，还能确保环境配置的一致性。这个一键部署的脚本不仅简化了部署过程，还能确保配置的正确性和一致性。使用这样的部署方法，可以极大地节省时间和精力，特别是对于频繁需要部署新环境的开发团队而言，效率提升显著。
一、架构简述 1. LNMP简介 LNMP是一种流行的Web服务架构，其中：
Linux是操作系统，用于托管Web服务器。Nginx是一款高性能的HTTP和反向代理服务器，用于处理HTTP请求。MySQL是一个关系型数据库管理系统，用于存储和管理应用数据。PHP是一种服务器端脚本语言，用于生成动态Web内容。 2. 常见的PHP项目部署结构 在实际项目中，PHP项目通常会与nginx和MySQL搭配使用，形成一个完整的Web应用架构。以下是一些常见的部署结构：
LAMP（Linux、Apache、MySQL、PHP）：使用Apache作为Web服务器，适合需要.htaccess支持的项目。LNMP（Linux、Nginx、MySQL、PHP）：使用Nginx作为Web服务器，适合高并发和静态文件较多的项目。LEMP（Linux、Nginx、MariaDB、PHP）：使用MariaDB替代MySQL，适合需要更高性能和更多功能的数据库需求。 以下是这些结构的比较：
架构Web服务器数据库适用场景LAMPApacheMySQL需要.htaccess支持的项目LNMPNginxMySQL高并发和静态文件较多的项目LEMPNginxMariaDB需要更高性能和更多功能的项目 二、部署步骤 1. 移除现有的项目 首先，我们需要清理现有的项目目录，删除/var/www/html目录下的所有文件。这通常是Web项目的默认目录，清理这个目录可以避免旧项目文件的干扰。
sudo rm -rf /var/www/html 2. 安装并配置Nginx和PHP-FPM 安装Nginx和PHP-FPM。这两个软件是运行PHP应用的核心组件。
安装Nginx：Nginx是一款高性能的HTTP和反向代理服务器。我们将使用yum包管理器来安装Nginx。
yum install -y nginx 安装EPEL和yum-utils：EPEL（Extra Packages for Enterprise Linux）提供了高质量的附加软件包，yum-utils包含了yum-config-manager等实用工具。
yum install -y epel-release yum-utils 安装Remi仓库和PHP：Remi仓库提供最新版本的PHP。启用remi-php74仓库并安装PHP 7.4及其常用模块，如php-fpm、php-mysql、php-gd等。
yum install -y https://rpms.remirepo.net/enterprise/remi-release-7.rpm yum-config-manager --enable remi-php74 yum install -y php php-common php-cli php-fpm php-mysql php-gd php-xml php-mbstring php-json php-soap php-xmlrpc 配置PHP-FPM：修改PHP-FPM的配置文件，使其监听127.0.0.1的9000端口，这样Nginx可以通过这个端口与PHP-FPM通信。
sudo sed -i &#39;s#listen = /run/php-fpm/www.sock#listen = 127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-31T12:37:25+08:00">
    <meta property="article:modified_time" content="2024-07-31T12:37:25+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PHP进阶-CentOS7部署LNMP服务架构的项目</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在开发和部署Web应用时，LNMP（Linux、Nginx、MySQL、PHP）的组合是非常常见的。这篇博客将介绍如何通过一个简单的脚本，在CentOS 7上部署LNMP，并将PHP项目自动部署到服务器上。这不仅可以节省大量的时间，还能确保环境配置的一致性。这个一键部署的脚本不仅简化了部署过程，还能确保配置的正确性和一致性。使用这样的部署方法，可以极大地节省时间和精力，特别是对于频繁需要部署新环境的开发团队而言，效率提升显著。</p> 
<hr> 
<h3><a id="_4"></a>一、架构简述</h3> 
<h4><a id="1_LNMP_6"></a>1. LNMP简介</h4> 
<p>LNMP是一种流行的Web服务架构，其中：</p> 
<ul><li><strong>Linux</strong>是操作系统，用于托管Web服务器。</li><li><strong>Nginx</strong>是一款高性能的HTTP和反向代理服务器，用于处理HTTP请求。</li><li><strong>MySQL</strong>是一个关系型数据库管理系统，用于存储和管理应用数据。</li><li><strong>PHP</strong>是一种服务器端脚本语言，用于生成动态Web内容。</li></ul> 
<h4><a id="2_PHP_14"></a>2. 常见的PHP项目部署结构</h4> 
<p>在实际项目中，PHP项目通常会与nginx和MySQL搭配使用，形成一个完整的Web应用架构。以下是一些常见的部署结构：</p> 
<ul><li><strong>LAMP</strong>（Linux、Apache、MySQL、PHP）：使用Apache作为Web服务器，适合需要.htaccess支持的项目。</li><li><strong>LNMP</strong>（Linux、Nginx、MySQL、PHP）：使用Nginx作为Web服务器，适合高并发和静态文件较多的项目。</li><li><strong>LEMP</strong>（Linux、Nginx、MariaDB、PHP）：使用MariaDB替代MySQL，适合需要更高性能和更多功能的数据库需求。</li></ul> 
<p>以下是这些结构的比较：</p> 
<table><thead><tr><th>架构</th><th>Web服务器</th><th>数据库</th><th>适用场景</th></tr></thead><tbody><tr><td>LAMP</td><td>Apache</td><td>MySQL</td><td>需要.htaccess支持的项目</td></tr><tr><td>LNMP</td><td>Nginx</td><td>MySQL</td><td>高并发和静态文件较多的项目</td></tr><tr><td>LEMP</td><td>Nginx</td><td>MariaDB</td><td>需要更高性能和更多功能的项目</td></tr></tbody></table> 
<hr> 
<h3><a id="_31"></a>二、部署步骤</h3> 
<h4><a id="1__33"></a>1. 移除现有的项目</h4> 
<p>首先，我们需要清理现有的项目目录，删除<code>/var/www/html</code>目录下的所有文件。这通常是Web项目的默认目录，清理这个目录可以避免旧项目文件的干扰。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/www/html
</code></pre> 
<hr> 
<h4><a id="2_NginxPHPFPM_42"></a>2. 安装并配置Nginx和PHP-FPM</h4> 
<p>安装Nginx和PHP-FPM。这两个软件是运行PHP应用的核心组件。</p> 
<p><strong>安装Nginx</strong>：Nginx是一款高性能的HTTP和反向代理服务器。我们将使用yum包管理器来安装Nginx。</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx
</code></pre> 
<p><strong>安装EPEL和yum-utils</strong>：EPEL（Extra Packages for Enterprise Linux）提供了高质量的附加软件包，yum-utils包含了yum-config-manager等实用工具。</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> epel-release yum-utils
</code></pre> 
<p><strong>安装Remi仓库和PHP</strong>：Remi仓库提供最新版本的PHP。启用remi-php74仓库并安装PHP 7.4及其常用模块，如php-fpm、php-mysql、php-gd等。</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://rpms.remirepo.net/enterprise/remi-release-7.rpm
yum-config-manager <span class="token parameter variable">--enable</span> remi-php74
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> php php-common php-cli php-fpm php-mysql php-gd php-xml php-mbstring php-json php-soap php-xmlrpc
</code></pre> 
<p><strong>配置PHP-FPM</strong>：修改PHP-FPM的配置文件，使其监听127.0.0.1的9000端口，这样Nginx可以通过这个端口与PHP-FPM通信。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s#listen = /run/php-fpm/www.sock#listen = 127.0.0.1:9000#'</span> /etc/php-fpm.d/www.conf
</code></pre> 
<p><strong>启动并设置Nginx和PHP-FPM为开机自启</strong>：确保Nginx和PHP-FPM在服务器重启后自动启动。</p> 
<pre><code class="prism language-bash">systemctl start nginx
systemctl <span class="token builtin class-name">enable</span> nginx
systemctl start php-fpm
systemctl <span class="token builtin class-name">enable</span> php-fpm
</code></pre> 
<hr> 
<h4><a id="3_PHP_83"></a>3. 克隆PHP项目代码</h4> 
<p>这里使用到的也是我创作的开源项目，感兴趣的朋友可以去GItee上查看，CSDN资源也已上传，欢迎下载。<br> 项目地址：https://gitee.com/damon_liu_code/WeeklyReport</p> 
<p><img src="https://images2.imgbox.com/bf/a7/3oC93FqA_o.png" alt="在这里插入图片描述"></p> 
<p>下面，我们来发布这个项目到我们自己的服务器上。</p> 
<p><strong>安装git</strong>：git是一个分布式版本控制系统，我们将使用git从代码库克隆PHP项目。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span>
</code></pre> 
<p><strong>创建项目目录并克隆代码</strong>：在<code>/var/www/html</code>目录下创建项目目录，并使用git克隆项目代码。</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/www/html
<span class="token function">sudo</span> <span class="token function">git</span> clone https://gitee.com/damon_liu_code/WeeklyReport.git /var/www/html
</code></pre> 
<p><strong>设置权限</strong>：确保Nginx用户对项目目录有正确的权限。</p> 
<pre><code class="prism language-bash"><span class="token function">chown</span> <span class="token parameter variable">-R</span> nginx:nginx /var/www/html/WeeklyReport
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /var/www/html/WeeklyReport
</code></pre> 
<hr> 
<h4><a id="4_Nginx_116"></a>4. 创建Nginx配置文件</h4> 
<p><strong>创建并编辑Nginx配置文件</strong>：配置Nginx处理PHP请求。设置根目录、索引文件、PHP文件处理方式等。</p> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/nginx/nginx.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    log_format main '\<span class="token variable">$remote_addr</span> - \<span class="token variable">$remote_user</span> [\<span class="token variable">$time_local</span>] "\<span class="token variable">$request</span>" \<span class="token variable">$status</span> \<span class="token variable">$body_bytes_sent</span> "\<span class="token variable">$http_referer</span>" "\<span class="token variable">$http_user_agent</span>" "\<span class="token variable">$http_x_forwarded_for</span>"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    server {
        listen       80;
        listen       [::]:80;
        server_name  _;
        index index.php index.html index.htm;
        root         /var/www/html/WeeklyReport/public;

        location ~ \.php\$ {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME \<span class="token variable">$document_root</span>\<span class="token variable">$fastcgi_script_name</span>;
            include fastcgi_params;
        }

        location / {
            if (!-e \<span class="token variable">$request_filename</span>){
                rewrite  ^(.*)\$  /index.php?s=\<span class="token variable">$1</span>  last;
                break;
            }
        }

        location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md) {
            return 404;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)\$ {
            expires      30d;
            error_log /dev/null;
            access_log /dev/null;
        }

        location ~ .*\.(js|css)?\$ {
            expires      12h;
            error_log /dev/null;
            access_log /dev/null;
        }
    }
}
EOF</span>
</code></pre> 
<hr> 
<h4><a id="5_MySQL_187"></a>5. 安装并配置MySQL</h4> 
<p><strong>导入MySQL GPG密钥和安装MySQL仓库</strong>：确保系统信任MySQL的安装包，并从官方仓库安装MySQL。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://repo.mysql.com/RPM-GPG-KEY-mysql-2022
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://repo.mysql.com/mysql57-community-release-el7.rpm
</code></pre> 
<p><strong>安装MySQL</strong>：使用yum包管理器安装MySQL社区服务器。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-community-server
</code></pre> 
<p><strong>启动并设置MySQL为开机自启</strong>：确保MySQL在服务器重启后自动启动。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl start mysqld
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> mysqld
</code></pre> 
<p><strong>获取MySQL初始临时密码</strong>：MySQL安装后会生成一个初始临时密码，我们需要获取这个密码以便进行后续配置。</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">TEMP_PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">sudo</span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $NF}'</span><span class="token variable">)</span></span>
</code></pre> 
<p><strong>修改root用户密码</strong>：使用初始密码登录MySQL并修改root用户的密码，设置为简单易记的密码（如：root）。</p> 
<pre><code class="prism language-bash">mysql <span class="token parameter variable">-u</span> root -p<span class="token string">"<span class="token variable">$TEMP_PASS</span>"</span> --connect-expired-password <span class="token operator">&lt;&lt;</span><span class="token string">EOF
SET GLOBAL validate_password_policy=LOW;
SET GLOBAL validate_password_length=4;
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
EOF</span>
</code></pre> 
<hr> 
<h4><a id="6_SQL_226"></a>6. 导入SQL文件到数据库</h4> 
<p><strong>创建数据库</strong>：在MySQL中创建项目所需的数据库。</p> 
<pre><code class="prism language-bash">mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-proot</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
CREATE DATABASE IF NOT EXISTS weekly_report CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
EOF</span>
</code></pre> 
<p><strong>导入SQL文件</strong>：将项目的SQL文件导入到新创建的数据库中，完成数据库初始化。</p> 
<pre><code class="prism language-bash">mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-proot</span> weekly_report <span class="token operator">&lt;</span> /var/www/html/WeeklyReport/weekly_report.sql
</code></pre> 
<hr> 
<h4><a id="7_Nginx_245"></a>7. 重启Nginx服务</h4> 
<p>重启Nginx服务，使新配置生效，并确保Nginx可以正确处理和转发请求。</p> 
<pre><code class="prism language-bash">systemctl restart nginx
</code></pre> 
<hr> 
<h4><a id="8__256"></a>8. 配置防火墙</h4> 
<p><strong>开放80端口</strong>：为了确保外部能够访问到我们的Nginx服务，需要开放80端口。使用firewall-cmd来配置防火墙，允许HTTP访问。</p> 
<pre><code class="prism language-bash">firewall-cmd <span class="token parameter variable">--permanent</span> --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp
firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre> 
<hr> 
<h4><a id="9_IP_266"></a>9. 获取服务器公网IP地址</h4> 
<p>使用curl命令获取服务器的公网IP地址，并打印出来，方便通过该IP直接访问部署好的PHP项目。</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> ifconfig.me<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"你的服务器公网IP地址是: <span class="token variable">$IP</span>"</span>
</code></pre> 
<p>我们测试访问：</p> 
<p><img src="https://images2.imgbox.com/16/10/YZlDZ3HH_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/85/57/ilOlS6TR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/69/agG7UD2o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0b/12/KVhjVWSt_o.png" alt="在这里插入图片描述"></p> 
<p>项目部署成功！</p> 
<hr> 
<h3><a id="_285"></a>三、部署总结</h3> 
<h4><a id="1__287"></a>1. 步骤总结</h4> 
<p>部署过程中涉及到的每个步骤都有其特定的作用：</p> 
<ul><li>清理现有的项目和软件，确保新部署不受旧环境的影响。</li><li>安装和配置Nginx、PHP和MySQL，建立起Web服务器和数据库的基础环境。</li><li>克隆项目代码并设置权限，使得Web服务器可以访问和执行项目代码。</li><li>创建Nginx配置文件，定义Web服务器的行为，包括请求处理和静态资源缓存。</li><li>初始化和配置MySQL数据库，导入项目所需的数据库结构和初始数据。</li><li>配置防火墙，确保服务器对外部HTTP请求的访问。</li></ul> 
<hr> 
<h4><a id="2__300"></a>2. 教程源码</h4> 
<p>下面是全部代码（可以直接一键部署）：</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 移除现有的项目</span>
<span class="token function">sudo</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/www/html

<span class="token comment"># 移除现有的Apache</span>
yum remove httpd <span class="token parameter variable">-y</span>

<span class="token comment"># 安装Nginx和PHP-FPM</span>
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> epel-release yum-utils
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://rpms.remirepo.net/enterprise/remi-release-7.rpm
yum-config-manager <span class="token parameter variable">--enable</span> remi-php74
yum <span class="token function">install</span> <span class="token parameter variable">-y</span> php php-common php-cli php-fpm php-mysql php-gd php-xml php-mbstring php-json php-soap php-xmlrpc
<span class="token function">sudo</span> <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s#listen = /run/php-fpm/www.sock#listen = 127.0.0.1:9000#'</span> /etc/php-fpm.d/www.conf

<span class="token comment"># 启动并启用Nginx和PHP-FPM</span>
systemctl start nginx
systemctl <span class="token builtin class-name">enable</span> nginx
systemctl start php-fpm
systemctl <span class="token builtin class-name">enable</span> php-fpm

<span class="token comment"># 创建PHP项目的目录并克隆代码库</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/www/html
<span class="token function">sudo</span> <span class="token function">git</span> clone https://gitee.com/damon_liu_code/WeeklyReport.git /var/www/html
<span class="token function">chown</span> <span class="token parameter variable">-R</span> nginx:nginx /var/www/html/WeeklyReport
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /var/www/html/WeeklyReport

<span class="token comment"># 创建Nginx配置文件</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/nginx/nginx.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    log_format main '\<span class="token variable">$remote_addr</span> - \<span class="token variable">$remote_user</span> [\<span class="token variable">$time_local</span>] "\<span class="token variable">$request</span>" \<span class="token variable">$status</span> \<span class="token variable">$body_bytes_sent</span> "\<span class="token variable">$http_referer</span>" "\<span class="token variable">$http_user_agent</span>" "\<span class="token variable">$http_x_forwarded_for</span>"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 4096;

    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    server {
        listen       80;
        listen       [::]:80;
        server_name  _;
        index index.php index.html index.htm;
        root         /var/www/html/WeeklyReport/public;

        location ~ \.php\$ {
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
            fastcgi_param SCRIPT_FILENAME \<span class="token variable">$document_root</span>\<span class="token variable">$fastcgi_script_name</span>;
            include fastcgi_params;
        }

        location / {
            if (!-e \<span class="token variable">$request_filename</span>){
                rewrite  ^(.*)\$  /index.php?s=\<span class="token variable">$1</span>  last;
                break;
            }
        }

        location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md) {
            return 404;
        }

        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)\$ {
            expires      30d;
            error_log /dev/null;
            access_log /dev/null;
        }

        location ~ .*\.(js|css)?\$ {
            expires      12h;
            error_log /dev/null;
            access_log /dev/null;
        }
    }
}
EOF</span>

<span class="token comment"># 删除原有MySQL</span>
<span class="token function">sudo</span> yum remove mysql57-community-release-el7 <span class="token parameter variable">-y</span>

<span class="token comment"># 安装并配置MySQL</span>
<span class="token function">sudo</span> <span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://repo.mysql.com/RPM-GPG-KEY-mysql-2022
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> https://repo.mysql.com/mysql57-community-release-el7.rpm
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-community-server
<span class="token function">sudo</span> systemctl start mysqld
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> mysqld

<span class="token comment"># 获取MySQL初始临时密码</span>
<span class="token assign-left variable">TEMP_PASS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">sudo</span> <span class="token function">grep</span> <span class="token string">'temporary password'</span> /var/log/mysqld.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $NF}'</span><span class="token variable">)</span></span>

<span class="token comment"># 使用初始密码登录并修改root用户密码</span>
mysql <span class="token parameter variable">-u</span> root -p<span class="token string">"<span class="token variable">$TEMP_PASS</span>"</span> --connect-expired-password <span class="token operator">&lt;&lt;</span><span class="token string">EOF
SET GLOBAL validate_password_policy=LOW;
SET GLOBAL validate_password_length=4;
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
EOF</span>

<span class="token comment"># 导入SQL文件到数据库</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-proot</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
CREATE DATABASE IF NOT EXISTS weekly_report CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION;
FLUSH PRIVILEGES;
EOF</span>

mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-proot</span> weekly_report <span class="token operator">&lt;</span> /var/www/html/WeeklyReport/weekly_report.sql


<span class="token comment"># 重启Nginx服务</span>
systemctl restart nginx

<span class="token comment"># 确保防火墙设置允许80端口访问</span>
firewall-cmd <span class="token parameter variable">--permanent</span> --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp
firewall-cmd <span class="token parameter variable">--reload</span>

<span class="token comment"># 获取服务器公网IP地址</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> ifconfig.me<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"你的服务器公网IP地址是: <span class="token variable">$IP</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"脚本执行完毕，请通过该IP访问你的PHP项目。"</span>

</code></pre> 
<p>通过这个脚本，我们可以轻松地在CentOS 7服务器上部署Nginx、PHP和MySQL，并自动配置和部署一个PHP项目。这个一键部署的脚本不仅简化了部署过程，还能确保配置的正确性和一致性。使用这样的部署方法，可以极大地节省时间和精力，特别是对于频繁需要部署新环境的开发团队而言，效率提升显著。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6c90cbd89480a98f63f79466bcf38f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">丹摩智算：如何在云端开发一个AI应用——基于UNet的眼底血管分割案例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f063881cc61233dbbb83690fdcb5bc0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一文通透位置编码：从标准位置编码、旋转位置编码RoPE到ALiBi、LLaMA 2 Long(含NTK-aware简介)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>