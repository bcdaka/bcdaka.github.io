<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>阿里最强开源大模型本地部署、API调用和WebUI对话机器人 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/79a50e655c390f4aee1f8fc7af8dc96d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="阿里最强开源大模型本地部署、API调用和WebUI对话机器人">
  <meta property="og:description" content="阿里巴巴通义千问团队发布了Qwen2系列开源模型，该系列模型包括5个尺寸的预训练和指令微调模型：Qwen2-0.5B、Qwen2-1.5B、Qwen2-7B、Qwen2-57B-A14B以及Qwen2-72B。对比当前最优的开源模型，Qwen2-72B在包括自然语言理解、知识、代码、数学及多语言等多项能力上均显著超越当前领先的Llama3-70B等大模型。
老牛同学今天部署和体验Qwen2-7B-Instruct指令微调的中等尺寸模型，相比近期推出同等规模的开源最好的Llama3-8B、GLM4-9B等模型，Qwen2-7B-Instruct依然能在多个评测上取得显著的优势，尤其是代码及中文理解上。
特别注意： 虽然Qwen2开源了，但仍然需要遵循其模型许可，除Qwen2-72B依旧使用此前的Qianwen License外，其余系列版本模型，包括Qwen2-0.5B、Qwen2-1.5B、Qwen2-7B以及Qwen2-57B-A14B等在内，均采用Apache 2.0许可协议。
下载Qwen2-7B-instruct模型文件 为了简化模型的部署过程，我们直接下载GGUF文件。
我们可以根据自己需要，选择下载其它版本的模型文件！
启动Qwen2-7B-Instruct大模型 GGUF模型量化文件下载完成后，我们就可以来运行Qwen2-7B大模型了。
在启动Qwen2-7B大模型之前，我们首先需要安装Python依赖包列表：
pip install llama-cpp-python pip install openai pip install uvicorn pip install starlette pip install fastapi pip install sse_starlette pip install starlette_context pip install pydantic_settings 然后打开一个Terminal终端窗口，切换到GGUF模型文件目录，启动Qwen2-7B大模型（./qwen2-7b-instruct-q5_k_m.gguf即为上一步下载的模型文件路径）：
# 启动Qwen2大模型 # n_ctx=20480代表单次回话最大20480个Token数量 python -m llama_cpp.server \ --host 0.0.0.0 \ --model ./qwen2-7b-instruct-q5_k_m.gguf \ --n_ctx 20480 Qwen2-7B-instruct 命令行对话客户端 # client.py from openai import OpenAI # 注意服务端端口，因为是本地，所以不需要api_key client = OpenAI(base_url=&#34;http://127.0.0.1:8000/v1&#34;, api_key=&#34;not-needed&#34;) # 对话历史：设定系统角色是一个只能助理，同时提交“自我介绍”问题 history = [ {&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-13T09:44:45+08:00">
    <meta property="article:modified_time" content="2024-06-13T09:44:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">阿里最强开源大模型本地部署、API调用和WebUI对话机器人</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>阿里巴巴通义千问团队发布了<strong>Qwen2</strong>系列开源模型，该系列模型包括5个尺寸的预训练和指令微调模型：<strong>Qwen2-0.5B</strong>、<strong>Qwen2-1.5B</strong>、<strong>Qwen2-7B</strong>、<strong>Qwen2-57B-A14B</strong>以及<strong>Qwen2-72B</strong>。对比当前最优的开源模型，<strong>Qwen2-72B</strong>在包括自然语言理解、知识、代码、数学及多语言等多项能力上均显著超越当前领先的<strong>Llama3-70B</strong>等大模型。</p> 
<p><img src="https://images2.imgbox.com/5d/2f/T6yYG6cw_o.jpg" alt="Qwen2-72B模型评测"></p> 
<p>老牛同学今天部署和体验<strong>Qwen2-7B-Instruct</strong>指令微调的中等尺寸模型，相比近期推出同等规模的开源最好的<strong>Llama3-8B</strong>、<strong>GLM4-9B</strong>等模型，<strong>Qwen2-7B-Instruct</strong>依然能在多个评测上取得显著的优势，尤其是代码及中文理解上。</p> 
<p><img src="https://images2.imgbox.com/f0/5f/f0bFPXbi_o.jpg" alt="Qwen2-7B模型"></p> 
<p><strong>特别注意：</strong> 虽然<strong>Qwen2</strong>开源了，但仍然需要遵循其模型许可，除<strong>Qwen2-72B</strong>依旧使用此前的<strong>Qianwen License</strong>外，其余系列版本模型，包括<strong>Qwen2-0.5B</strong>、<strong>Qwen2-1.5B</strong>、<strong>Qwen2-7B</strong>以及<strong>Qwen2-57B-A14B</strong>等在内，均采用<strong>Apache 2.0</strong>许可协议。</p> 
<h3><a id="Qwen27Binstruct_10"></a>下载Qwen2-7B-instruct模型文件</h3> 
<p>为了简化模型的部署过程，我们直接下载GGUF文件。</p> 
<p><img src="https://images2.imgbox.com/02/bf/JfOUInHN_o.jpg" alt="Qwen2-7B量化模型文件"></p> 
<p>我们可以根据自己需要，选择下载其它版本的模型文件！</p> 
<h3><a id="Qwen27BInstruct_20"></a>启动Qwen2-7B-Instruct大模型</h3> 
<p>GGUF模型量化文件下载完成后，我们就可以来运行<strong>Qwen2-7B</strong>大模型了。</p> 
<p>在启动<strong>Qwen2-7B</strong>大模型之前，我们首先需要安装Python依赖包列表：</p> 
<pre><code>pip install llama-cpp-python
pip install openai
pip install uvicorn
pip install starlette
pip install fastapi
pip install sse_starlette
pip install starlette_context
pip install pydantic_settings

</code></pre> 
<p>然后打开一个Terminal终端窗口，切换到GGUF模型文件目录，启动<strong>Qwen2-7B</strong>大模型（<code>./qwen2-7b-instruct-q5_k_m.gguf</code>即为上一步下载的模型文件路径）：</p> 
<pre><code># 启动Qwen2大模型

# n_ctx=20480代表单次回话最大20480个Token数量
python -m llama_cpp.server \
   --host 0.0.0.0 \
   --model ./qwen2-7b-instruct-q5_k_m.gguf \
   --n_ctx 20480

</code></pre> 
<p><img src="https://images2.imgbox.com/3a/de/OrnW1E7a_o.jpg" alt="Qwen2-7B启动成功"></p> 
<h3><a id="Qwen27Binstruct__54"></a>Qwen2-7B-instruct 命令行对话客户端</h3> 
<pre><code># client.py

from openai import OpenAI

# 注意服务端端口，因为是本地，所以不需要api_key
client = OpenAI(base_url="http://127.0.0.1:8000/v1",
                api_key="not-needed")

# 对话历史：设定系统角色是一个只能助理，同时提交“自我介绍”问题
history = [
    {"role": "system", "content": "你是一个智能助理，你的回答总是容易理解的、正确的、有用的和内容非常精简."},
]

# 首次自我介绍完毕，接下来是等代码我们的提示
while True:
    completion = client.chat.completions.create(
        model="local-model",
        messages=history,
        temperature=0.7,
        stream=True,
    )

    new_message = {"role": "assistant", "content": ""}

    for chunk in completion:
        if chunk.choices[0].delta.content:
            print(chunk.choices[0].delta.content, end="", flush=True)
            new_message["content"] += chunk.choices[0].delta.content

    history.append(new_message)
    print("\033[91;1m")

    user_input = input("&gt; ")
    if user_input.lower() in ["bye", "quit", "exit"]:  # 我们输入bye/quit/exit等均退出客户端
        print("\033[0mBYE BYE!")
        break

    history.append({"role": "user", "content": user_input})
    print("\033[92;1m")

</code></pre> 
<p>启动CLI对话客户端：<code>python client.py</code></p> 
<p>至此，我们可以与<strong>Qwen2-7B-Instruct</strong>进行对话，体验Qwen2大模型的魅力了。</p> 
<p>如果我们主要是通过API的方式使用<strong>Qwen2</strong>大模型，那么Qwen2部署就到此结束了。</p> 
<p>接下来的章节，我们部署WebUI对话客户端，通过Web界面的方式使用<strong>Qwen2</strong>大模型，并且可以分享出去~</p> 
<h3><a id="Qwen27BInstruct_WebUI_110"></a>Qwen2-7B-Instruct WebUI客户端</h3> 
<p><strong>第一步：</strong> 我们需要下载安装<strong>Ollama</strong>本地大模型管理工具：</p> 
<p><code>Ollama</code>提供了<strong>MacOS</strong>、<strong>Linux</strong>和<strong>Windows</strong>操作系统的安装包，大家可根据自己的操作系统，下载安装即可：</p> 
<p><img src="https://images2.imgbox.com/f1/9c/K42YKj3M_o.jpg" alt="Ollama下载"></p> 
<p>安装包下载之后的安装过程，和日常安装其他软件没有差别，包括点击<code>Next</code>以及<code>Install</code>等安装<code>ollama</code>到命令行。安装后续步骤中，我们可无需安装任何模型，因为我们在上文中我们已经安装了<code>Qwen2-7B</code>大模型，后面可以直接使用。</p> 
<p><strong>第二步：</strong> 安装<code>Node.js</code>编程语言工具包</p> 
<p>安装<code>Node.js</code>编程语言工具包和安装其他软件包一样</p> 
<p>安装完成之后，可以验证一下 Node.js 的版本，建议用目前的最新<strong>v20</strong>版本：</p> 
<pre><code>node -v

</code></pre> 
<p>老牛同学安装的版本：<strong>v20.13.1</strong>（最新版本）</p> 
<p><strong>第三步：</strong> 基于GGUF模型文件创建<code>Ollama</code>模型</p> 
<p>在我们存放<code>Qwen2-7B</code>的 GGUF 模型文件目录中，创建一个文件名为<code>Modelfile</code>的文件，该文件的内容如下：</p> 
<pre><code>FROM ./qwen2-7b-instruct-q5_k_m.gguf

</code></pre> 
<p>然后在Terminal终端，使用这个文件创建<code>Ollama</code>模型，这里我把<code>Ollama</code>的模型取名为<strong>Qwen2-7B</strong>：</p> 
<pre><code>$ ollama create Qwen2-7B -f ./Modelfile
transferring model data 
using existing layer sha256:258dd2fa1bdf98b85327774e1fd36e2268c2a4b68eb9021d71106449ee4ba9d5 
creating new layer sha256:14f4474ef69698bf4dbbc7409828341fbd85923319a801035e651d9fe6a9e9c9 
writing manifest 
success

</code></pre> 
<p>最后，通过<code>Ollama</code>启动我们刚创建的大语言模型：</p> 
<pre><code>ollama run Qwen2-7B

</code></pre> 
<p>启动完毕，其实我们已经有了一个和之前差不多的控制台对话界面，也可以与<code>Qwen2-7B</code>对话了。</p> 
<p>如果我们不想要这个模型了，也可以通过命令行删除模型文件：<code>ollama rm Qwen2-7B</code></p> 
<p>我们也可以查看本地<strong>Ollama</strong>管理的模型列表：<code>ollama list</code></p> 
<p><code>Ollama</code>存放模型文件根目录：<code>~/.ollama</code></p> 
<p><strong>第四步：</strong> 部署<code>Ollama</code>大模型Web对话界面</p> 
<p>控制台聊天对话界面体验总归是不太好，接下来部署 Web 可视化聊天界面。</p> 
<p>首先，下载<code>ollama-webui</code>Web 工程代码：<code>git clone https://github.com/ollama-webui/ollama-webui-lite</code></p> 
<p>然后切换<code>ollama-webui</code>代码的目录：<code>cd ollama-webui-lite</code></p> 
<p>设置 Node.js 工具包镜像源，以接下来下载 Node.js 的依赖包更加快速：<code>npm config set registry http://mirrors.cloud.tencent.com/npm/</code></p> 
<p>安装 Node.js 依赖的工具包：<code>npm install</code></p> 
<p>最后，启动 Web 可视化界面：<code>npm run dev</code></p> 
<p><img src="https://images2.imgbox.com/c0/0e/RMezkczd_o.jpg" alt="WebUI启动成功"></p> 
<p>如果看到以上输出，代表 Web 可视化界面已经成功了！</p> 
<p><strong>第五步：</strong> 通过WebUI愉快与<strong>Qwen2-7B</strong>对话</p> 
<p>浏览器打开 Web 可视化界面：</p> 
<p>可以看到<code>Ollama</code>的初始化页面，默认没有模型，需要选择，我们选择刚创建并部署的<code>Qwen2-7B</code>模型：</p> 
<p><img src="https://images2.imgbox.com/0e/6b/QeKiUPJi_o.jpg" alt="选择Qwen2-7B大模型"></p> 
<p>底部就是聊天输入框，至此可以愉快的与<code>Qwen2-7B</code>聊天对话了：</p> 
<h3><a id="Qwen27BLlama38B_202"></a>总结：Qwen2-7B比Llama3-8B快</h3> 
<p>老牛同学验证和对比，在文本推理上，<strong>Qwen2-7B</strong>确实比<strong>Llama3-8B</strong>要快很多。后续老牛同学中文文本推理相关的API接口，就主要采用更快<strong>Qwen2-7B</strong>大模型了~</p> 
<h3><a id="Ollama_207"></a>其他：<code>Ollama</code>工具常用用法</h3> 
<p>从上文的介绍可以看到，基于<code>Ollama</code>部署一个大模型的 Web 可视化对话机器人，还是非常方便。下面整理了部分<code>Ollama</code>提供的用法或者。</p> 
<p><strong>Ollama 命令</strong>工具</p> 
<pre><code># 查看当前Ollama的模型
ollama list

# 增量更新当前部署的模型
ollama pull Qwen2-7B

# 删除一个模型文件
ollama rm Qwen2-7B

# 复制一个模型
ollama cp Qwen2-7B Qwen2-newModel

</code></pre> 
<p><strong>Ollama API</strong>结果返回</p> 
<pre><code>curl http://localhost:11434/api/generate -d '{
  "model": "Qwen2-7B",
  "prompt":"为什么天空是蓝色的？"
}'

</code></pre> 
<p><strong>Ollama API</strong>聊天对话</p> 
<pre><code>curl http://localhost:11434/api/chat -d '{
  "model": "Qwen2-7B",
  "messages": [
    { "role": "user", "content": "为什么天空是蓝色的？" }
  ]
}'

</code></pre> 
<hr> 
<p>可能大家都想学习AI大模型技术，也想通过这项技能真正达到升职加薪，就业或是副业的目的，但是不知道该如何开始学习，因为网上的资料太多太杂乱了，如果不能系统的学习就相当于是白学。为了让大家少走弯路，少碰壁，这里我直接把全套AI技术和大模型入门资料、操作变现玩法都打包整理好，希望能够真正帮助到大家。</p> 
<p>👉AI大模型学习路线汇总👈<br> 大模型学习路线图，整体分为7个大的阶段：（全套教程文末领取哈）<br> <img src="https://images2.imgbox.com/c6/81/x7x9f0Ap_o.png" alt="在这里插入图片描述"></p> 
<p>第一阶段： 从大模型系统设计入手，讲解大模型的主要方法；</p> 
<p>第二阶段： 在通过大模型提示词工程从Prompts角度入手更好发挥模型的作用；</p> 
<p>第三阶段： 大模型平台应用开发借助阿里云PAI平台构建电商领域虚拟试衣系统；</p> 
<p>第四阶段： 大模型知识库应用开发以LangChain框架为例，构建物流行业咨询智能问答系统；</p> 
<p>第五阶段： 大模型微调开发借助以大健康、新零售、新媒体领域构建适合当前领域大模型；</p> 
<p>第六阶段： 以SD多模态大模型为主，搭建了文生图小程序案例；</p> 
<p>第七阶段： 以大模型平台应用与开发为主，通过星火大模型，文心大模型等成熟大模型构建大模型行业应用。</p> 
<p>👉大模型实战案例👈<br> 光学理论是没用的，要学会跟着一起做，要动手实操，才能将自己的所学运用到实际当中去，这时候可以搞点实战案例来学习。<br> <img src="https://images2.imgbox.com/f9/74/j7eLQAE1_o.jpg" alt="在这里插入图片描述"></p> 
<p>👉大模型视频和PDF合集👈<br> 观看零基础学习书籍和视频，看书籍和视频学习是最快捷也是最有效果的方式，跟着视频中老师的思路，从基础到深入，还是很容易入门的。<br> <img src="https://images2.imgbox.com/82/e7/ankXm645_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/3a/e3/bLMeClja_o.png" alt="在这里插入图片描述"></p> 
<p>👉学会后的收获：👈<br> • 基于大模型全栈工程实现（前端、后端、产品经理、设计、数据分析等），通过这门课可获得不同能力；</p> 
<p>• 能够利用大模型解决相关实际项目需求： 大数据时代，越来越多的企业和机构需要处理海量数据，利用大模型技术可以更好地处理这些数据，提高数据分析和决策的准确性。因此，掌握大模型应用开发技能，可以让程序员更好地应对实际项目需求；</p> 
<p>• 基于大模型和企业数据AI应用开发，实现大模型理论、掌握GPU算力、硬件、LangChain开发框架和项目实战技能， 学会Fine-tuning垂直训练大模型（数据准备、数据蒸馏、大模型部署）一站式掌握；</p> 
<p>• 能够完成时下热门大模型垂直领域模型训练能力，提高程序员的编码能力： 大模型应用开发需要掌握机器学习算法、深度学习框架等技术，这些技术的掌握可以提高程序员的编码能力和分析能力，让程序员更加熟练地编写高质量的代码。</p> 
<p>👉获取方式：<br> 😝有需要的小伙伴，可以保存图片到wx扫描二v码免费领取【保证100%免费】🆓</p> 
<p><img src="https://images2.imgbox.com/70/11/hdtVoWIe_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4f393a890035d3ef59c2d1d33ee17bac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于Mysql 中 Row size too large (＞ 8126) 错误的解决和理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6806aabf5ec92a9cae482756ba825f9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构】第十五弹---C语言实现直接插入排序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>