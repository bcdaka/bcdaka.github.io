<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot与flowable（8）：候选人 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e5d926cffde71f9d00ce65e4cd67207a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="springboot与flowable（8）：候选人">
  <meta property="og:description" content="一、流程绘制和部署 创建流程图
绘制如下流程图
给人事审批添加候选人
给经理审批添加两个候选人
保存导出流程图
部署流程定义
@Test void contextLoads() { DeploymentBuilder deployment = repositoryService.createDeployment(); deployment.addClasspathResource(&#34;process01/HolidayDemo1.bpmn20.xml&#34;); deployment.name(&#34;候选人案例&#34;); Deployment deploy = deployment.deploy(); System.out.println(&#34;deploy.getId() = &#34; &#43; deploy.getId()); } 二、拾取操作 发起流程
/** * 发起流程 */ @Test public void startProcess() { String id = &#34;HolidayDemo1:1:93caf684-2af9-11ef-910c-644ed7087863&#34;; // 给人事审批候选人进行赋值 Map&lt;String, Object&gt; variables = new HashMap&lt;&gt;(); variables.put(&#34;candidate1&#34;, &#34;zhangsan&#34;); variables.put(&#34;candidate2&#34;, &#34;lisi&#34;); variables.put(&#34;candidate3&#34;, &#34;wangwu&#34;); // 根据流程定义ID启动流程 ProcessInstance processInstance = runtimeService.startProcessInstanceById(id, variables); } 查看act_ru_task表发现assignee字段中审批人是空的。
根据候选人查询待办信息，并将候选人变更为审批人，进行审批。
/** * 根据用户查询待办信息 */ @Test public void findFlow() { List&lt;Task&gt; list = taskService.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-15T18:19:39+08:00">
    <meta property="article:modified_time" content="2024-06-15T18:19:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot与flowable（8）：候选人</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、流程绘制和部署</h2> 
<p>        创建流程图</p> 
<p><img alt="" height="825" src="https://images2.imgbox.com/e1/14/vrp8iI1Y_o.png" width="901"></p> 
<p>        绘制如下流程图</p> 
<p><img alt="" height="204" src="https://images2.imgbox.com/5b/ec/O7ScDwxc_o.png" width="679"></p> 
<p>        给人事审批添加候选人</p> 
<p><img alt="" height="1007" src="https://images2.imgbox.com/cd/ba/r2AEXUhM_o.png" width="901"></p> 
<p>        给经理审批添加两个候选人</p> 
<p><img alt="" height="929" src="https://images2.imgbox.com/1b/71/8cy4vGww_o.png" width="901"></p> 
<p>        保存导出流程图</p> 
<p><img alt="" height="796" src="https://images2.imgbox.com/39/7e/rrRLGs9W_o.png" width="1200"></p> 
<p>        部署流程定义</p> 
<pre><code class="language-java"> @Test
    void contextLoads() {
        DeploymentBuilder deployment = repositoryService.createDeployment();
        deployment.addClasspathResource("process01/HolidayDemo1.bpmn20.xml");
        deployment.name("候选人案例");
        Deployment deploy = deployment.deploy();
        System.out.println("deploy.getId() = " + deploy.getId());
    }</code></pre> 
<p><img alt="" height="438" src="https://images2.imgbox.com/6f/6b/Gjg4W7uD_o.png" width="1200"></p> 
<h2>二、拾取操作</h2> 
<p>        发起流程</p> 
<pre><code class="language-java">    /**
     * 发起流程
     */
    @Test
    public void startProcess() {
        String id = "HolidayDemo1:1:93caf684-2af9-11ef-910c-644ed7087863";
        // 给人事审批候选人进行赋值
        Map&lt;String, Object&gt; variables = new HashMap&lt;&gt;();
        variables.put("candidate1", "zhangsan");
        variables.put("candidate2", "lisi");
        variables.put("candidate3", "wangwu");
        // 根据流程定义ID启动流程
        ProcessInstance processInstance = runtimeService.startProcessInstanceById(id, variables);
    }</code></pre> 
<p>        查看act_ru_task表发现assignee字段中审批人是空的。</p> 
<p><img alt="" height="319" src="https://images2.imgbox.com/5a/ed/e1Fvy9UR_o.png" width="1200"></p> 
<p>        根据候选人查询待办信息，并将候选人变更为审批人，进行审批。</p> 
<pre><code class="language-java">    /**
     * 根据用户查询待办信息
     */
    @Test
    public void findFlow() {
        List&lt;Task&gt; list = taskService.createTaskQuery().taskCandidateUser("zhangsan").list();
        // 根据id进行审批
        for (Task task : list) {
            // 把zhangsan由候选人变更为审批人
            taskService.claim(task.getId(), "zhangsan");
            completeTask(task.getId());
        }
    }

    /**
     * 根据Id审批任务
     */
    public void completeTask(String taskId) {
        // 定义经理审批候选人
        Map&lt;String, Object&gt; variables = new HashMap&lt;&gt;();
        variables.put("candidate4", "youwangzi1");
        variables.put("candidate5", "youwangzi2");
        taskService.complete(taskId, variables);
    }</code></pre> 
<h2><img alt="" height="320" src="https://images2.imgbox.com/ef/33/4rBXEUKc_o.png" width="783"></h2> 
<p>        查看运行时用户关系信息表。</p> 
<p><img alt="" height="520" src="https://images2.imgbox.com/33/7f/vmx7UENO_o.png" width="1014"></p> 
<h2>三、归还与指派</h2> 
<p>        归还操作：审批人 -&gt; 候选人</p> 
<pre><code class="language-java">    /**
     * 根据用户查询待办信息
     */
    @Test
    public void findFlow() {
        List&lt;Task&gt; list = taskService.createTaskQuery().taskCandidateUser("zhangsan").list();
        // 根据id进行审批
        for (Task task : list) {
            // 把zhangsan由候选人变更为审批人
            taskService.claim(task.getId(), "zhangsan");
            // 可以通过unclaim()方法将审批人归还回候选人。
            taskService.unclaim(task.getId());
            // completeTask(task.getId());
        }
    }</code></pre> 
<p>        指派新的审批人</p> 
<pre><code class="language-java">    /**
     * 根据用户查询待办信息
     */
    @Test
    public void findFlow() {
        List&lt;Task&gt; list = taskService.createTaskQuery().taskCandidateUser("zhangsan").list();
        // 根据id进行审批
        for (Task task : list) {
            // 将当前任务指派给youwangzi用户进行审批
            task.setAssignee("youwangzi");
        }
    }</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc8ea860675ac2ac60f641086c2174ac/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MacOS安装redis</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2142607c90e551b9804588538b8ffc36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为什么说Python 是胶水语言?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>